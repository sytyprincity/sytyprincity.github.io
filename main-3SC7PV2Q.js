var R4=Object.create;var Jw=Object.defineProperty,O4=Object.defineProperties,k4=Object.getOwnPropertyDescriptor,L4=Object.getOwnPropertyDescriptors,F4=Object.getOwnPropertyNames,U0=Object.getOwnPropertySymbols,N4=Object.getPrototypeOf,eE=Object.prototype.hasOwnProperty,m2=Object.prototype.propertyIsEnumerable;var p2=(o,i,l)=>i in o?Jw(o,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[i]=l,vt=(o,i)=>{for(var l in i||={})eE.call(i,l)&&p2(o,l,i[l]);if(U0)for(var l of U0(i))m2.call(i,l)&&p2(o,l,i[l]);return o},lr=(o,i)=>O4(o,L4(i));var ns=(o,i)=>{var l={};for(var c in o)eE.call(o,c)&&i.indexOf(c)<0&&(l[c]=o[c]);if(o!=null&&U0)for(var c of U0(o))i.indexOf(c)<0&&m2.call(o,c)&&(l[c]=o[c]);return l};var z4=(o,i)=>()=>(i||o((i={exports:{}}).exports,i),i.exports);var B4=(o,i,l,c)=>{if(i&&typeof i=="object"||typeof i=="function")for(let f of F4(i))!eE.call(o,f)&&f!==l&&Jw(o,f,{get:()=>i[f],enumerable:!(c=k4(i,f))||c.enumerable});return o};var tE=(o,i,l)=>(l=o!=null?R4(N4(o)):{},B4(i||!o||!o.__esModule?Jw(l,"default",{value:o,enumerable:!0}):l,o));var hg=(o,i,l)=>new Promise((c,f)=>{var r=A=>{try{C(l.next(A))}catch(L){f(L)}},w=A=>{try{C(l.throw(A))}catch(L){f(L)}},C=A=>A.done?c(A.value):Promise.resolve(A.value).then(r,w);C((l=l.apply(o,i)).next())});var _1=z4((JC,eI)=>{"use strict";(function(o,i){typeof JC=="object"&&typeof eI<"u"?eI.exports=i():typeof define=="function"&&define.amd?define(i):(o=typeof globalThis<"u"?globalThis:o||self,o.mapboxgl=i())})(JC,function(){"use strict";var o,i,l;function c(r,w){if(!o)o=w;else if(!i)i=w;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",A={};o(A),l=w(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}c(["exports"],function(r){var w="3.5.0";let C,A={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{C=t}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!A.API_URL)return null;try{let t=new URL(A.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function L(t){return A.API_URL_REGEX.test(t)}function U(t){return t.indexOf("mapbox:")===0}function Q(t){return A.API_CDN_URL_REGEX.test(t)}function me(t){return A.API_SPRITE_REGEX.test(t)}function he(t){return A.API_STYLE_REGEX.test(t)&&!me(t)}let be={create:"create",load:"load",fullLoad:"fullLoad"},Ie={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function Qe(t){let e=t.name.split("?")[0];return Q(e)&&e.includes("mapbox-gl.js")?"javascript":Q(e)&&e.includes("mapbox-gl.css")?"css":function(n){return A.API_FONTS_REGEX.test(n)}(e)?"fontRange":me(e)?"sprite":he(e)?"style":function(n){return A.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function ze(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nt={},ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.setMatrixArrayType=function(t){ft.ARRAY_TYPE=Nt=t},ft.toRadian=function(t){return t*Jt},ft.equals=function(t,e){return Math.abs(t-e)<=Ue*Math.max(1,Math.abs(t),Math.abs(e))},ft.RANDOM=ft.ARRAY_TYPE=ft.EPSILON=void 0;var Ue=1e-6;ft.EPSILON=Ue;var Nt=typeof Float32Array<"u"?Float32Array:Array;ft.ARRAY_TYPE=Nt;var Yt=Math.random;ft.RANDOM=Yt;var Jt=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Et={};function tr(t){return tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr(t)}Object.defineProperty(Et,"__esModule",{value:!0}),Et.create=function(){var t=new Ct.ARRAY_TYPE(4);return Ct.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Et.clone=function(t){var e=new Ct.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Et.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Et.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Et.fromValues=function(t,e,n,a){var u=new Ct.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=a,u},Et.set=function(t,e,n,a,u){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t},Et.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Et.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n*d-u*a;return p?(t[0]=d*(p=1/p),t[1]=-a*p,t[2]=-u*p,t[3]=n*p,t):null},Et.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Et.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Et.multiply=br,Et.rotate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+d*_,t[1]=u*y+p*_,t[2]=a*-_+d*y,t[3]=u*-_+p*y,t},Et.scale=function(t,e,n){var a=e[1],u=e[2],d=e[3],p=n[0],_=n[1];return t[0]=e[0]*p,t[1]=a*p,t[2]=u*_,t[3]=d*_,t},Et.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},Et.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Et.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Et.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Et.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},Et.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Et.subtract=zr,Et.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Et.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(n-p)<=Ct.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-_)<=Ct.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-y)<=Ct.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-b)<=Ct.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Et.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Et.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Et.sub=Et.mul=void 0;var Ct=function(t,e){if(t&&t.__esModule)return t;if(t===null||tr(t)!=="object"&&typeof t!="function")return{default:t};var n=_r(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function _r(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(_r=function(a){return a?n:e})(t)}function br(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*_+d*y,t[1]=u*_+p*y,t[2]=a*b+d*T,t[3]=u*b+p*T,t}function zr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Et.mul=br,Et.sub=zr;var xn={};function jo(t){return jo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jo(t)}Object.defineProperty(xn,"__esModule",{value:!0}),xn.create=function(){var t=new wt.ARRAY_TYPE(6);return wt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},xn.clone=function(t){var e=new wt.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},xn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},xn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},xn.fromValues=function(t,e,n,a,u,d){var p=new wt.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=n,p[3]=a,p[4]=u,p[5]=d,p},xn.set=function(t,e,n,a,u,d,p){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t},xn.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=n*d-a*u;return y?(t[0]=d*(y=1/y),t[1]=-a*y,t[2]=-u*y,t[3]=n*y,t[4]=(u*_-d*p)*y,t[5]=(a*p-n*_)*y,t):null},xn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},xn.multiply=Ht,xn.rotate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=Math.sin(n),T=Math.cos(n);return t[0]=a*T+d*b,t[1]=u*T+p*b,t[2]=a*-b+d*T,t[3]=u*-b+p*T,t[4]=_,t[5]=y,t},xn.scale=function(t,e,n){var a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=n[0],b=n[1];return t[0]=e[0]*y,t[1]=a*y,t[2]=u*b,t[3]=d*b,t[4]=p,t[5]=_,t},xn.translate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=n[0],T=n[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=a*b+d*T+_,t[5]=u*b+p*T+y,t},xn.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},xn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},xn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},xn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},xn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},xn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},xn.subtract=_n,xn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},xn.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},xn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},xn.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=e[0],b=e[1],T=e[2],I=e[3],D=e[4],R=e[5];return Math.abs(n-y)<=wt.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-b)<=wt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(u-T)<=wt.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(d-I)<=wt.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-D)<=wt.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(_-R)<=wt.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},xn.sub=xn.mul=void 0;var wt=function(t,e){if(t&&t.__esModule)return t;if(t===null||jo(t)!=="object"&&typeof t!="function")return{default:t};var n=zt(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function zt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(zt=function(a){return a?n:e})(t)}function Ht(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=n[0],T=n[1],I=n[2],D=n[3],R=n[4],O=n[5];return t[0]=a*b+d*T,t[1]=u*b+p*T,t[2]=a*I+d*D,t[3]=u*I+p*D,t[4]=a*R+d*O+_,t[5]=u*R+p*O+y,t}function _n(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}xn.mul=Ht,xn.sub=_n;var kt={};function li(t){return li=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},li(t)}Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=function(){var t=new Qn.ARRAY_TYPE(9);return Qn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},kt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},kt.clone=function(t){var e=new Qn.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},kt.fromValues=function(t,e,n,a,u,d,p,_,y){var b=new Qn.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=n,b[3]=a,b[4]=u,b[5]=d,b[6]=p,b[7]=_,b[8]=y,b},kt.set=function(t,e,n,a,u,d,p,_,y,b){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=b,t},kt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},kt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},kt.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],I=T*p-_*b,D=-T*d+_*y,R=b*d-p*y,O=n*I+a*D+u*R;return O?(t[0]=I*(O=1/O),t[1]=(-T*a+u*b)*O,t[2]=(_*a-u*p)*O,t[3]=D*O,t[4]=(T*n-u*y)*O,t[5]=(-_*n+u*d)*O,t[6]=R*O,t[7]=(-b*n+a*y)*O,t[8]=(p*n-a*d)*O,t):null},kt.adjoint=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8];return t[0]=p*T-_*b,t[1]=u*b-a*T,t[2]=a*_-u*p,t[3]=_*y-d*T,t[4]=n*T-u*y,t[5]=u*d-n*_,t[6]=d*b-p*y,t[7]=a*y-n*b,t[8]=n*p-a*d,t},kt.determinant=function(t){var e=t[3],n=t[4],a=t[5],u=t[6],d=t[7],p=t[8];return t[0]*(p*n-a*d)+t[1]*(-p*e+a*u)+t[2]*(d*e-n*u)},kt.multiply=dr,kt.translate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=n[0],R=n[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=D*a+R*p+b,t[7]=D*u+R*_+T,t[8]=D*d+R*y+I,t},kt.rotate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=Math.sin(n),R=Math.cos(n);return t[0]=R*a+D*p,t[1]=R*u+D*_,t[2]=R*d+D*y,t[3]=R*p-D*a,t[4]=R*_-D*u,t[5]=R*y-D*d,t[6]=b,t[7]=T,t[8]=I,t},kt.scale=function(t,e,n){var a=n[0],u=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},kt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},kt.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},kt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},kt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},kt.fromQuat=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n+n,_=a+a,y=u+u,b=n*p,T=a*p,I=a*_,D=u*p,R=u*_,O=u*y,F=d*p,z=d*_,j=d*y;return t[0]=1-I-O,t[3]=T-j,t[6]=D+z,t[1]=T+j,t[4]=1-b-O,t[7]=R-F,t[2]=D-z,t[5]=R+F,t[8]=1-b-I,t},kt.normalFromMat4=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],I=e[9],D=e[10],R=e[11],O=e[12],F=e[13],z=e[14],j=e[15],X=n*_-a*p,Y=n*y-u*p,K=n*b-d*p,le=a*y-u*_,se=a*b-d*_,pe=u*b-d*y,_e=T*F-I*O,Ee=T*z-D*O,Oe=T*j-R*O,De=I*z-D*F,Ne=I*j-R*F,Xe=D*j-R*z,Le=X*Xe-Y*Ne+K*De+le*Oe-se*Ee+pe*_e;return Le?(t[0]=(_*Xe-y*Ne+b*De)*(Le=1/Le),t[1]=(y*Oe-p*Xe-b*Ee)*Le,t[2]=(p*Ne-_*Oe+b*_e)*Le,t[3]=(u*Ne-a*Xe-d*De)*Le,t[4]=(n*Xe-u*Oe+d*Ee)*Le,t[5]=(a*Oe-n*Ne-d*_e)*Le,t[6]=(F*pe-z*se+j*le)*Le,t[7]=(z*K-O*pe-j*Y)*Le,t[8]=(O*se-F*K+j*X)*Le,t):null},kt.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},kt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},kt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},kt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},kt.subtract=Sa,kt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},kt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},kt.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],T=t[8],I=e[0],D=e[1],R=e[2],O=e[3],F=e[4],z=e[5],j=e[6],X=e[7],Y=e[8];return Math.abs(n-I)<=Qn.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(a-D)<=Qn.EPSILON*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(u-R)<=Qn.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-O)<=Qn.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(p-F)<=Qn.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(_-z)<=Qn.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(y-j)<=Qn.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-X)<=Qn.EPSILON*Math.max(1,Math.abs(b),Math.abs(X))&&Math.abs(T-Y)<=Qn.EPSILON*Math.max(1,Math.abs(T),Math.abs(Y))},kt.sub=kt.mul=void 0;var Qn=function(t,e){if(t&&t.__esModule)return t;if(t===null||li(t)!=="object"&&typeof t!="function")return{default:t};var n=Zi(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function Zi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Zi=function(a){return a?n:e})(t)}function dr(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=n[0],R=n[1],O=n[2],F=n[3],z=n[4],j=n[5],X=n[6],Y=n[7],K=n[8];return t[0]=D*a+R*p+O*b,t[1]=D*u+R*_+O*T,t[2]=D*d+R*y+O*I,t[3]=F*a+z*p+j*b,t[4]=F*u+z*_+j*T,t[5]=F*d+z*y+j*I,t[6]=X*a+Y*p+K*b,t[7]=X*u+Y*_+K*T,t[8]=X*d+Y*y+K*I,t}function Sa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}kt.mul=dr,kt.sub=Sa;var Pt={};function Dr(t){return Dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dr(t)}Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=function(){var t=new zn.ARRAY_TYPE(16);return zn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Pt.clone=function(t){var e=new zn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Pt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Pt.fromValues=function(t,e,n,a,u,d,p,_,y,b,T,I,D,R,O,F){var z=new zn.ARRAY_TYPE(16);return z[0]=t,z[1]=e,z[2]=n,z[3]=a,z[4]=u,z[5]=d,z[6]=p,z[7]=_,z[8]=y,z[9]=b,z[10]=T,z[11]=I,z[12]=D,z[13]=R,z[14]=O,z[15]=F,z},Pt.set=function(t,e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=b,t[9]=T,t[10]=I,t[11]=D,t[12]=R,t[13]=O,t[14]=F,t[15]=z,t},Pt.identity=cs,Pt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],u=e[3],d=e[6],p=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=d,t[11]=e[14],t[12]=u,t[13]=p,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Pt.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],I=e[9],D=e[10],R=e[11],O=e[12],F=e[13],z=e[14],j=e[15],X=n*_-a*p,Y=n*y-u*p,K=n*b-d*p,le=a*y-u*_,se=a*b-d*_,pe=u*b-d*y,_e=T*F-I*O,Ee=T*z-D*O,Oe=T*j-R*O,De=I*z-D*F,Ne=I*j-R*F,Xe=D*j-R*z,Le=X*Xe-Y*Ne+K*De+le*Oe-se*Ee+pe*_e;return Le?(t[0]=(_*Xe-y*Ne+b*De)*(Le=1/Le),t[1]=(u*Ne-a*Xe-d*De)*Le,t[2]=(F*pe-z*se+j*le)*Le,t[3]=(D*se-I*pe-R*le)*Le,t[4]=(y*Oe-p*Xe-b*Ee)*Le,t[5]=(n*Xe-u*Oe+d*Ee)*Le,t[6]=(z*K-O*pe-j*Y)*Le,t[7]=(T*pe-D*K+R*Y)*Le,t[8]=(p*Ne-_*Oe+b*_e)*Le,t[9]=(a*Oe-n*Ne-d*_e)*Le,t[10]=(O*se-F*K+j*X)*Le,t[11]=(I*K-T*se-R*X)*Le,t[12]=(_*Ee-p*De-y*_e)*Le,t[13]=(n*De-a*Ee+u*_e)*Le,t[14]=(F*Y-O*le-z*X)*Le,t[15]=(T*le-I*Y+D*X)*Le,t):null},Pt.adjoint=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],I=e[9],D=e[10],R=e[11],O=e[12],F=e[13],z=e[14],j=e[15];return t[0]=_*(D*j-R*z)-I*(y*j-b*z)+F*(y*R-b*D),t[1]=-(a*(D*j-R*z)-I*(u*j-d*z)+F*(u*R-d*D)),t[2]=a*(y*j-b*z)-_*(u*j-d*z)+F*(u*b-d*y),t[3]=-(a*(y*R-b*D)-_*(u*R-d*D)+I*(u*b-d*y)),t[4]=-(p*(D*j-R*z)-T*(y*j-b*z)+O*(y*R-b*D)),t[5]=n*(D*j-R*z)-T*(u*j-d*z)+O*(u*R-d*D),t[6]=-(n*(y*j-b*z)-p*(u*j-d*z)+O*(u*b-d*y)),t[7]=n*(y*R-b*D)-p*(u*R-d*D)+T*(u*b-d*y),t[8]=p*(I*j-R*F)-T*(_*j-b*F)+O*(_*R-b*I),t[9]=-(n*(I*j-R*F)-T*(a*j-d*F)+O*(a*R-d*I)),t[10]=n*(_*j-b*F)-p*(a*j-d*F)+O*(a*b-d*_),t[11]=-(n*(_*R-b*I)-p*(a*R-d*I)+T*(a*b-d*_)),t[12]=-(p*(I*z-D*F)-T*(_*z-y*F)+O*(_*D-y*I)),t[13]=n*(I*z-D*F)-T*(a*z-u*F)+O*(a*D-u*I),t[14]=-(n*(_*z-y*F)-p*(a*z-u*F)+O*(a*y-u*_)),t[15]=n*(_*D-y*I)-p*(a*D-u*I)+T*(a*y-u*_),t},Pt.determinant=function(t){var e=t[0],n=t[1],a=t[2],u=t[3],d=t[4],p=t[5],_=t[6],y=t[7],b=t[8],T=t[9],I=t[10],D=t[11],R=t[12],O=t[13],F=t[14],z=t[15];return(e*p-n*d)*(I*z-D*F)-(e*_-a*d)*(T*z-D*O)+(e*y-u*d)*(T*F-I*O)+(n*_-a*p)*(b*z-D*R)-(n*y-u*p)*(b*F-I*R)+(a*y-u*_)*(b*O-T*R)},Pt.multiply=Vs,Pt.translate=function(t,e,n){var a,u,d,p,_,y,b,T,I,D,R,O,F=n[0],z=n[1],j=n[2];return e===t?(t[12]=e[0]*F+e[4]*z+e[8]*j+e[12],t[13]=e[1]*F+e[5]*z+e[9]*j+e[13],t[14]=e[2]*F+e[6]*z+e[10]*j+e[14],t[15]=e[3]*F+e[7]*z+e[11]*j+e[15]):(u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=e[9],R=e[10],O=e[11],t[0]=a=e[0],t[1]=u,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=b,t[7]=T,t[8]=I,t[9]=D,t[10]=R,t[11]=O,t[12]=a*F+_*z+I*j+e[12],t[13]=u*F+y*z+D*j+e[13],t[14]=d*F+b*z+R*j+e[14],t[15]=p*F+T*z+O*j+e[15]),t},Pt.scale=function(t,e,n){var a=n[0],u=n[1],d=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Pt.rotate=function(t,e,n,a){var u,d,p,_,y,b,T,I,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne=a[0],Xe=a[1],Le=a[2],qe=Math.hypot(Ne,Xe,Le);return qe<zn.EPSILON?null:(Ne*=qe=1/qe,Xe*=qe,Le*=qe,u=Math.sin(n),d=Math.cos(n),y=e[1],b=e[2],T=e[3],D=e[5],R=e[6],O=e[7],z=e[9],j=e[10],X=e[11],Y=Ne*Ne*(p=1-d)+d,se=Ne*Xe*p-Le*u,pe=Xe*Xe*p+d,_e=Le*Xe*p+Ne*u,Ee=Ne*Le*p+Xe*u,Oe=Xe*Le*p-Ne*u,De=Le*Le*p+d,t[0]=(_=e[0])*Y+(I=e[4])*(K=Xe*Ne*p+Le*u)+(F=e[8])*(le=Le*Ne*p-Xe*u),t[1]=y*Y+D*K+z*le,t[2]=b*Y+R*K+j*le,t[3]=T*Y+O*K+X*le,t[4]=_*se+I*pe+F*_e,t[5]=y*se+D*pe+z*_e,t[6]=b*se+R*pe+j*_e,t[7]=T*se+O*pe+X*_e,t[8]=_*Ee+I*Oe+F*De,t[9]=y*Ee+D*Oe+z*De,t[10]=b*Ee+R*Oe+j*De,t[11]=T*Ee+O*Oe+X*De,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Pt.rotateX=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),d=e[4],p=e[5],_=e[6],y=e[7],b=e[8],T=e[9],I=e[10],D=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*u+b*a,t[5]=p*u+T*a,t[6]=_*u+I*a,t[7]=y*u+D*a,t[8]=b*u-d*a,t[9]=T*u-p*a,t[10]=I*u-_*a,t[11]=D*u-y*a,t},Pt.rotateY=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),d=e[0],p=e[1],_=e[2],y=e[3],b=e[8],T=e[9],I=e[10],D=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u-b*a,t[1]=p*u-T*a,t[2]=_*u-I*a,t[3]=y*u-D*a,t[8]=d*a+b*u,t[9]=p*a+T*u,t[10]=_*a+I*u,t[11]=y*a+D*u,t},Pt.rotateZ=function(t,e,n){var a=Math.sin(n),u=Math.cos(n),d=e[0],p=e[1],_=e[2],y=e[3],b=e[4],T=e[5],I=e[6],D=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u+b*a,t[1]=p*u+T*a,t[2]=_*u+I*a,t[3]=y*u+D*a,t[4]=b*u-d*a,t[5]=T*u-p*a,t[6]=I*u-_*a,t[7]=D*u-y*a,t},Pt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Pt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromRotation=function(t,e,n){var a,u,d,p=n[0],_=n[1],y=n[2],b=Math.hypot(p,_,y);return b<zn.EPSILON?null:(p*=b=1/b,_*=b,y*=b,a=Math.sin(e),u=Math.cos(e),t[0]=p*p*(d=1-u)+u,t[1]=_*p*d+y*a,t[2]=y*p*d-_*a,t[3]=0,t[4]=p*_*d-y*a,t[5]=_*_*d+u,t[6]=y*_*d+p*a,t[7]=0,t[8]=p*y*d+_*a,t[9]=_*y*d-p*a,t[10]=y*y*d+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Pt.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromRotationTranslation=au,Pt.fromQuat2=function(t,e){var n=new zn.ARRAY_TYPE(3),a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=a*a+u*u+d*d+p*p;return I>0?(n[0]=2*(_*p+T*a+y*d-b*u)/I,n[1]=2*(y*p+T*u+b*a-_*d)/I,n[2]=2*(b*p+T*d+_*u-y*a)/I):(n[0]=2*(_*p+T*a+y*d-b*u),n[1]=2*(y*p+T*u+b*a-_*d),n[2]=2*(b*p+T*d+_*u-y*a)),au(t,e,n),t},Pt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Pt.getScaling=bl,Pt.getRotation=function(t,e){var n=new zn.ARRAY_TYPE(3);bl(n,e);var a=1/n[0],u=1/n[1],d=1/n[2],p=e[0]*a,_=e[1]*u,y=e[2]*d,b=e[4]*a,T=e[5]*u,I=e[6]*d,D=e[8]*a,R=e[9]*u,O=e[10]*d,F=p+T+O,z=0;return F>0?(z=2*Math.sqrt(F+1),t[3]=.25*z,t[0]=(I-R)/z,t[1]=(D-y)/z,t[2]=(_-b)/z):p>T&&p>O?(z=2*Math.sqrt(1+p-T-O),t[3]=(I-R)/z,t[0]=.25*z,t[1]=(_+b)/z,t[2]=(D+y)/z):T>O?(z=2*Math.sqrt(1+T-p-O),t[3]=(D-y)/z,t[0]=(_+b)/z,t[1]=.25*z,t[2]=(I+R)/z):(z=2*Math.sqrt(1+O-p-T),t[3]=(_-b)/z,t[0]=(D+y)/z,t[1]=(I+R)/z,t[2]=.25*z),t},Pt.fromRotationTranslationScale=function(t,e,n,a){var u=e[0],d=e[1],p=e[2],_=e[3],y=u+u,b=d+d,T=p+p,I=u*y,D=u*b,R=u*T,O=d*b,F=d*T,z=p*T,j=_*y,X=_*b,Y=_*T,K=a[0],le=a[1],se=a[2];return t[0]=(1-(O+z))*K,t[1]=(D+Y)*K,t[2]=(R-X)*K,t[3]=0,t[4]=(D-Y)*le,t[5]=(1-(I+z))*le,t[6]=(F+j)*le,t[7]=0,t[8]=(R+X)*se,t[9]=(F-j)*se,t[10]=(1-(I+O))*se,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Pt.fromRotationTranslationScaleOrigin=function(t,e,n,a,u){var d=e[0],p=e[1],_=e[2],y=e[3],b=d+d,T=p+p,I=_+_,D=d*b,R=d*T,O=d*I,F=p*T,z=p*I,j=_*I,X=y*b,Y=y*T,K=y*I,le=a[0],se=a[1],pe=a[2],_e=u[0],Ee=u[1],Oe=u[2],De=(1-(F+j))*le,Ne=(R+K)*le,Xe=(O-Y)*le,Le=(R-K)*se,qe=(1-(D+j))*se,ke=(z+X)*se,We=(O+Y)*pe,Je=(z-X)*pe,Ze=(1-(D+F))*pe;return t[0]=De,t[1]=Ne,t[2]=Xe,t[3]=0,t[4]=Le,t[5]=qe,t[6]=ke,t[7]=0,t[8]=We,t[9]=Je,t[10]=Ze,t[11]=0,t[12]=n[0]+_e-(De*_e+Le*Ee+We*Oe),t[13]=n[1]+Ee-(Ne*_e+qe*Ee+Je*Oe),t[14]=n[2]+Oe-(Xe*_e+ke*Ee+Ze*Oe),t[15]=1,t},Pt.fromQuat=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n+n,_=a+a,y=u+u,b=n*p,T=a*p,I=a*_,D=u*p,R=u*_,O=u*y,F=d*p,z=d*_,j=d*y;return t[0]=1-I-O,t[1]=T+j,t[2]=D-z,t[3]=0,t[4]=T-j,t[5]=1-b-O,t[6]=R+F,t[7]=0,t[8]=D+z,t[9]=R-F,t[10]=1-b-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.frustum=function(t,e,n,a,u,d,p){var _=1/(n-e),y=1/(u-a),b=1/(d-p);return t[0]=2*d*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*y,t[6]=0,t[7]=0,t[8]=(n+e)*_,t[9]=(u+a)*y,t[10]=(p+d)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*d*2*b,t[15]=0,t},Pt.perspectiveNO=wo,Pt.perspectiveZO=function(t,e,n,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(d=1/(a-u)),t[14]=u*a*d):(t[10]=-1,t[14]=-a),t},Pt.perspectiveFromFieldOfView=function(t,e,n,a){var u=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+_),b=2/(u+d);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(p-_)*y*.5,t[9]=(u-d)*b*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},Pt.orthoNO=Eo,Pt.orthoZO=function(t,e,n,a,u,d,p){var _=1/(e-n),y=1/(a-u),b=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+n)*_,t[13]=(u+a)*y,t[14]=d*b,t[15]=1,t},Pt.lookAt=function(t,e,n,a){var u,d,p,_,y,b,T,I,D,R,O=e[0],F=e[1],z=e[2],j=a[0],X=a[1],Y=a[2],K=n[0],le=n[1],se=n[2];return Math.abs(O-K)<zn.EPSILON&&Math.abs(F-le)<zn.EPSILON&&Math.abs(z-se)<zn.EPSILON?cs(t):(T=O-K,I=F-le,D=z-se,u=X*(D*=R=1/Math.hypot(T,I,D))-Y*(I*=R),d=Y*(T*=R)-j*D,p=j*I-X*T,(R=Math.hypot(u,d,p))?(u*=R=1/R,d*=R,p*=R):(u=0,d=0,p=0),_=I*p-D*d,y=D*u-T*p,b=T*d-I*u,(R=Math.hypot(_,y,b))?(_*=R=1/R,y*=R,b*=R):(_=0,y=0,b=0),t[0]=u,t[1]=_,t[2]=T,t[3]=0,t[4]=d,t[5]=y,t[6]=I,t[7]=0,t[8]=p,t[9]=b,t[10]=D,t[11]=0,t[12]=-(u*O+d*F+p*z),t[13]=-(_*O+y*F+b*z),t[14]=-(T*O+I*F+D*z),t[15]=1,t)},Pt.targetTo=function(t,e,n,a){var u=e[0],d=e[1],p=e[2],_=a[0],y=a[1],b=a[2],T=u-n[0],I=d-n[1],D=p-n[2],R=T*T+I*I+D*D;R>0&&(T*=R=1/Math.sqrt(R),I*=R,D*=R);var O=y*D-b*I,F=b*T-_*D,z=_*I-y*T;return(R=O*O+F*F+z*z)>0&&(O*=R=1/Math.sqrt(R),F*=R,z*=R),t[0]=O,t[1]=F,t[2]=z,t[3]=0,t[4]=I*z-D*F,t[5]=D*O-T*z,t[6]=T*F-I*O,t[7]=0,t[8]=T,t[9]=I,t[10]=D,t[11]=0,t[12]=u,t[13]=d,t[14]=p,t[15]=1,t},Pt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Pt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Pt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Pt.subtract=lu,Pt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Pt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},Pt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Pt.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],T=t[8],I=t[9],D=t[10],R=t[11],O=t[12],F=t[13],z=t[14],j=t[15],X=e[0],Y=e[1],K=e[2],le=e[3],se=e[4],pe=e[5],_e=e[6],Ee=e[7],Oe=e[8],De=e[9],Ne=e[10],Xe=e[11],Le=e[12],qe=e[13],ke=e[14],We=e[15];return Math.abs(n-X)<=zn.EPSILON*Math.max(1,Math.abs(n),Math.abs(X))&&Math.abs(a-Y)<=zn.EPSILON*Math.max(1,Math.abs(a),Math.abs(Y))&&Math.abs(u-K)<=zn.EPSILON*Math.max(1,Math.abs(u),Math.abs(K))&&Math.abs(d-le)<=zn.EPSILON*Math.max(1,Math.abs(d),Math.abs(le))&&Math.abs(p-se)<=zn.EPSILON*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(_-pe)<=zn.EPSILON*Math.max(1,Math.abs(_),Math.abs(pe))&&Math.abs(y-_e)<=zn.EPSILON*Math.max(1,Math.abs(y),Math.abs(_e))&&Math.abs(b-Ee)<=zn.EPSILON*Math.max(1,Math.abs(b),Math.abs(Ee))&&Math.abs(T-Oe)<=zn.EPSILON*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(I-De)<=zn.EPSILON*Math.max(1,Math.abs(I),Math.abs(De))&&Math.abs(D-Ne)<=zn.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ne))&&Math.abs(R-Xe)<=zn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Xe))&&Math.abs(O-Le)<=zn.EPSILON*Math.max(1,Math.abs(O),Math.abs(Le))&&Math.abs(F-qe)<=zn.EPSILON*Math.max(1,Math.abs(F),Math.abs(qe))&&Math.abs(z-ke)<=zn.EPSILON*Math.max(1,Math.abs(z),Math.abs(ke))&&Math.abs(j-We)<=zn.EPSILON*Math.max(1,Math.abs(j),Math.abs(We))},Pt.sub=Pt.mul=Pt.ortho=Pt.perspective=void 0;var zn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Dr(t)!=="object"&&typeof t!="function")return{default:t};var n=ci(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function ci(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ci=function(a){return a?n:e})(t)}function cs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Vs(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=e[9],R=e[10],O=e[11],F=e[12],z=e[13],j=e[14],X=e[15],Y=n[0],K=n[1],le=n[2],se=n[3];return t[0]=Y*a+K*_+le*I+se*F,t[1]=Y*u+K*y+le*D+se*z,t[2]=Y*d+K*b+le*R+se*j,t[3]=Y*p+K*T+le*O+se*X,t[4]=(Y=n[4])*a+(K=n[5])*_+(le=n[6])*I+(se=n[7])*F,t[5]=Y*u+K*y+le*D+se*z,t[6]=Y*d+K*b+le*R+se*j,t[7]=Y*p+K*T+le*O+se*X,t[8]=(Y=n[8])*a+(K=n[9])*_+(le=n[10])*I+(se=n[11])*F,t[9]=Y*u+K*y+le*D+se*z,t[10]=Y*d+K*b+le*R+se*j,t[11]=Y*p+K*T+le*O+se*X,t[12]=(Y=n[12])*a+(K=n[13])*_+(le=n[14])*I+(se=n[15])*F,t[13]=Y*u+K*y+le*D+se*z,t[14]=Y*d+K*b+le*R+se*j,t[15]=Y*p+K*T+le*O+se*X,t}function au(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=a+a,y=u+u,b=d+d,T=a*_,I=a*y,D=a*b,R=u*y,O=u*b,F=d*b,z=p*_,j=p*y,X=p*b;return t[0]=1-(R+F),t[1]=I+X,t[2]=D-j,t[3]=0,t[4]=I-X,t[5]=1-(T+F),t[6]=O+z,t[7]=0,t[8]=D+j,t[9]=O-z,t[10]=1-(T+R),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function bl(t,e){var n=e[4],a=e[5],u=e[6],d=e[8],p=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,u),t[2]=Math.hypot(d,p,_),t}function wo(t,e,n,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+a)*(d=1/(a-u)),t[14]=2*u*a*d):(t[10]=-1,t[14]=-2*a),t}function Eo(t,e,n,a,u,d,p){var _=1/(e-n),y=1/(a-u),b=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+n)*_,t[13]=(u+a)*y,t[14]=(p+d)*b,t[15]=1,t}function lu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Pt.perspective=wo,Pt.ortho=Eo,Pt.mul=Vs,Pt.sub=lu;var Rt={},Lt={};function wl(t){return wl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wl(t)}Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.create=El,Lt.clone=function(t){var e=new Bi.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Lt.length=Tl,Lt.fromValues=function(t,e,n){var a=new Bi.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},Lt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Lt.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},Lt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Lt.subtract=cu,Lt.multiply=js,Lt.divide=Ia,Lt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Lt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Lt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Lt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Lt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Lt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Lt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},Lt.distance=Sl,Lt.squaredDistance=uu,Lt.squaredLength=Cl,Lt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Lt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Lt.normalize=function(t,e){var n=e[0],a=e[1],u=e[2],d=n*n+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},Lt.dot=Il,Lt.cross=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=n[0],_=n[1],y=n[2];return t[0]=u*y-d*_,t[1]=d*p-a*y,t[2]=a*_-u*p,t},Lt.lerp=function(t,e,n,a){var u=e[0],d=e[1],p=e[2];return t[0]=u+a*(n[0]-u),t[1]=d+a*(n[1]-d),t[2]=p+a*(n[2]-p),t},Lt.hermite=function(t,e,n,a,u,d){var p=d*d,_=p*(2*d-3)+1,y=p*(d-2)+d,b=p*(d-1),T=p*(3-2*d);return t[0]=e[0]*_+n[0]*y+a[0]*b+u[0]*T,t[1]=e[1]*_+n[1]*y+a[1]*b+u[1]*T,t[2]=e[2]*_+n[2]*y+a[2]*b+u[2]*T,t},Lt.bezier=function(t,e,n,a,u,d){var p=1-d,_=p*p,y=d*d,b=_*p,T=3*d*_,I=3*y*p,D=y*d;return t[0]=e[0]*b+n[0]*T+a[0]*I+u[0]*D,t[1]=e[1]*b+n[1]*T+a[1]*I+u[1]*D,t[2]=e[2]*b+n[2]*T+a[2]*I+u[2]*D,t},Lt.random=function(t,e){e=e||1;var n=2*Bi.RANDOM()*Math.PI,a=2*Bi.RANDOM()-1,u=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*u,t[1]=Math.sin(n)*u,t[2]=a*e,t},Lt.transformMat4=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=n[3]*a+n[7]*u+n[11]*d+n[15];return t[0]=(n[0]*a+n[4]*u+n[8]*d+n[12])/(p=p||1),t[1]=(n[1]*a+n[5]*u+n[9]*d+n[13])/p,t[2]=(n[2]*a+n[6]*u+n[10]*d+n[14])/p,t},Lt.transformMat3=function(t,e,n){var a=e[0],u=e[1],d=e[2];return t[0]=a*n[0]+u*n[3]+d*n[6],t[1]=a*n[1]+u*n[4]+d*n[7],t[2]=a*n[2]+u*n[5]+d*n[8],t},Lt.transformQuat=function(t,e,n){var a=n[0],u=n[1],d=n[2],p=e[0],_=e[1],y=e[2],b=u*y-d*_,T=d*p-a*y,I=a*_-u*p,D=u*I-d*T,R=d*b-a*I,O=a*T-u*b,F=2*n[3];return T*=F,I*=F,R*=2,O*=2,t[0]=p+(b*=F)+(D*=2),t[1]=_+T+R,t[2]=y+I+O,t},Lt.rotateX=function(t,e,n,a){var u=[],d=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],d[0]=u[0],d[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),d[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Lt.rotateY=function(t,e,n,a){var u=[],d=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],d[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),d[1]=u[1],d[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Lt.rotateZ=function(t,e,n,a){var u=[],d=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],d[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),d[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),d[2]=u[2],t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Lt.angle=function(t,e){var n=t[0],a=t[1],u=t[2],d=e[0],p=e[1],_=e[2],y=Math.sqrt(n*n+a*a+u*u)*Math.sqrt(d*d+p*p+_*_),b=y&&Il(t,e)/y;return Math.acos(Math.min(Math.max(b,-1),1))},Lt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Lt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Lt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Lt.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=e[0],p=e[1],_=e[2];return Math.abs(n-d)<=Bi.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=Bi.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(u-_)<=Bi.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))},Lt.forEach=Lt.sqrLen=Lt.len=Lt.sqrDist=Lt.dist=Lt.div=Lt.mul=Lt.sub=void 0;var Bi=function(t,e){if(t&&t.__esModule)return t;if(t===null||wl(t)!=="object"&&typeof t!="function")return{default:t};var n=Ca(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function Ca(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ca=function(a){return a?n:e})(t)}function El(){var t=new Bi.ARRAY_TYPE(3);return Bi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Tl(t){return Math.hypot(t[0],t[1],t[2])}function cu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function js(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ia(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Sl(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function uu(t,e){var n=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2];return n*n+a*a+u*u}function Cl(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function Il(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Lt.sub=cu,Lt.mul=js,Lt.div=Ia,Lt.dist=Sl,Lt.sqrDist=uu,Lt.len=Tl,Lt.sqrLen=Cl;var oo,Qh=(oo=El(),function(t,e,n,a,u,d){var p,_;for(e||(e=3),n||(n=0),_=a?Math.min(a*e+n,t.length):t.length,p=n;p<_;p+=e)oo[0]=t[p],oo[1]=t[p+1],oo[2]=t[p+2],u(oo,oo,d),t[p]=oo[0],t[p+1]=oo[1],t[p+2]=oo[2];return t});Lt.forEach=Qh;var Ft={};function hu(t){return hu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hu(t)}Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=Da,Ft.clone=function(t){var e=new xr.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ft.fromValues=function(t,e,n,a){var u=new xr.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=a,u},Ft.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ft.set=function(t,e,n,a,u){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t},Ft.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ft.subtract=Uo,Ft.multiply=$o,Ft.divide=du,Ft.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Ft.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Ft.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Ft.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Ft.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Ft.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Ft.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Ft.distance=Us,Ft.squaredDistance=$s,Ft.length=Ml,Ft.squaredLength=Al,Ft.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Ft.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Ft.normalize=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n*n+a*a+u*u+d*d;return p>0&&(p=1/Math.sqrt(p)),t[0]=n*p,t[1]=a*p,t[2]=u*p,t[3]=d*p,t},Ft.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ft.cross=function(t,e,n,a){var u=n[0]*a[1]-n[1]*a[0],d=n[0]*a[2]-n[2]*a[0],p=n[0]*a[3]-n[3]*a[0],_=n[1]*a[2]-n[2]*a[1],y=n[1]*a[3]-n[3]*a[1],b=n[2]*a[3]-n[3]*a[2],T=e[0],I=e[1],D=e[2],R=e[3];return t[0]=I*b-D*y+R*_,t[1]=-T*b+D*p-R*d,t[2]=T*y-I*p+R*u,t[3]=-T*_+I*d-D*u,t},Ft.lerp=function(t,e,n,a){var u=e[0],d=e[1],p=e[2],_=e[3];return t[0]=u+a*(n[0]-u),t[1]=d+a*(n[1]-d),t[2]=p+a*(n[2]-p),t[3]=_+a*(n[3]-_),t},Ft.random=function(t,e){var n,a,u,d,p,_;e=e||1;do p=(n=2*xr.RANDOM()-1)*n+(a=2*xr.RANDOM()-1)*a;while(p>=1);do _=(u=2*xr.RANDOM()-1)*u+(d=2*xr.RANDOM()-1)*d;while(_>=1);var y=Math.sqrt((1-p)/_);return t[0]=e*n,t[1]=e*a,t[2]=e*u*y,t[3]=e*d*y,t},Ft.transformMat4=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3];return t[0]=n[0]*a+n[4]*u+n[8]*d+n[12]*p,t[1]=n[1]*a+n[5]*u+n[9]*d+n[13]*p,t[2]=n[2]*a+n[6]*u+n[10]*d+n[14]*p,t[3]=n[3]*a+n[7]*u+n[11]*d+n[15]*p,t},Ft.transformQuat=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=n[0],_=n[1],y=n[2],b=n[3],T=b*a+_*d-y*u,I=b*u+y*a-p*d,D=b*d+p*u-_*a,R=-p*a-_*u-y*d;return t[0]=T*b+R*-p+I*-y-D*-_,t[1]=I*b+R*-_+D*-p-T*-y,t[2]=D*b+R*-y+T*-_-I*-p,t[3]=e[3],t},Ft.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Ft.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ft.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ft.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(n-p)<=xr.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-_)<=xr.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-y)<=xr.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-b)<=xr.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Ft.forEach=Ft.sqrLen=Ft.len=Ft.sqrDist=Ft.dist=Ft.div=Ft.mul=Ft.sub=void 0;var xr=function(t,e){if(t&&t.__esModule)return t;if(t===null||hu(t)!=="object"&&typeof t!="function")return{default:t};var n=Dl(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function Dl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Dl=function(a){return a?n:e})(t)}function Da(){var t=new xr.ARRAY_TYPE(4);return xr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Uo(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function $o(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function du(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Us(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function $s(t,e){var n=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2],d=e[3]-t[3];return n*n+a*a+u*u+d*d}function Ml(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Al(t){var e=t[0],n=t[1],a=t[2],u=t[3];return e*e+n*n+a*a+u*u}Ft.sub=Uo,Ft.mul=$o,Ft.div=du,Ft.dist=Us,Ft.sqrDist=$s,Ft.len=Ml,Ft.sqrLen=Al;var Jh=function(){var t=Da();return function(e,n,a,u,d,p){var _,y;for(n||(n=4),a||(a=0),y=u?Math.min(u*n+a,e.length):e.length,_=a;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],d(t,t,p),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function Pl(t){return Pl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pl(t)}Ft.forEach=Jh,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=Rl,Rt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Rt.setAxisAngle=fu,Rt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>so.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},Rt.getAngle=function(t,e){var n=fe(t,e);return Math.acos(2*n*n-1)},Rt.multiply=Ol,Rt.rotateX=function(t,e,n){n*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+p*_,t[1]=u*y+d*_,t[2]=d*y-u*_,t[3]=p*y-a*_,t},Rt.rotateY=function(t,e,n){n*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y-d*_,t[1]=u*y+p*_,t[2]=d*y+a*_,t[3]=p*y-u*_,t},Rt.rotateZ=function(t,e,n){n*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+u*_,t[1]=u*y-a*_,t[2]=d*y+p*_,t[3]=p*y-d*_,t},Rt.calculateW=function(t,e){var n=e[0],a=e[1],u=e[2];return t[0]=n,t[1]=a,t[2]=u,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-u*u)),t},Rt.exp=ye,Rt.ln=$,Rt.pow=function(t,e,n){return $(t,e),de(t,t,n),ye(t,t),t},Rt.slerp=Z,Rt.random=function(t){var e=so.RANDOM(),n=so.RANDOM(),a=so.RANDOM(),u=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*n),t[1]=u*Math.cos(2*Math.PI*n),t[2]=d*Math.sin(2*Math.PI*a),t[3]=d*Math.cos(2*Math.PI*a),t},Rt.invert=function(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=n*n+a*a+u*u+d*d,_=p?1/p:0;return t[0]=-n*_,t[1]=-a*_,t[2]=-u*_,t[3]=d*_,t},Rt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Rt.fromMat3=oe,Rt.fromEuler=function(t,e,n,a){var u=.5*Math.PI/180;e*=u,n*=u,a*=u;var d=Math.sin(e),p=Math.cos(e),_=Math.sin(n),y=Math.cos(n),b=Math.sin(a),T=Math.cos(a);return t[0]=d*y*T-p*_*b,t[1]=p*_*T+d*y*b,t[2]=p*y*b-d*_*T,t[3]=p*y*T+d*_*b,t},Rt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Rt.setAxes=Rt.sqlerp=Rt.rotationTo=Rt.equals=Rt.exactEquals=Rt.normalize=Rt.sqrLen=Rt.squaredLength=Rt.len=Rt.length=Rt.lerp=Rt.dot=Rt.scale=Rt.mul=Rt.add=Rt.set=Rt.copy=Rt.fromValues=Rt.clone=void 0;var so=Ma(ft),Gs=Ma(kt),ao=Ma(Lt),Jr=Ma(Ft);function ed(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ed=function(a){return a?n:e})(t)}function Ma(t,e){if(t&&t.__esModule)return t;if(t===null||Pl(t)!=="object"&&typeof t!="function")return{default:t};var n=ed(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function Rl(){var t=new so.ARRAY_TYPE(4);return so.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function fu(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function Ol(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*T+p*_+u*b-d*y,t[1]=u*T+p*y+d*_-a*b,t[2]=d*T+p*b+a*y-u*_,t[3]=p*T-a*_-u*y-d*b,t}function ye(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(n*n+a*a+u*u),_=Math.exp(d),y=p>0?_*Math.sin(p)/p:0;return t[0]=n*y,t[1]=a*y,t[2]=u*y,t[3]=_*Math.cos(p),t}function $(t,e){var n=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(n*n+a*a+u*u),_=p>0?Math.atan2(p,d)/p:0;return t[0]=n*_,t[1]=a*_,t[2]=u*_,t[3]=.5*Math.log(n*n+a*a+u*u+d*d),t}function Z(t,e,n,a){var u,d,p,_,y,b=e[0],T=e[1],I=e[2],D=e[3],R=n[0],O=n[1],F=n[2],z=n[3];return(d=b*R+T*O+I*F+D*z)<0&&(d=-d,R=-R,O=-O,F=-F,z=-z),1-d>so.EPSILON?(u=Math.acos(d),p=Math.sin(u),_=Math.sin((1-a)*u)/p,y=Math.sin(a*u)/p):(_=1-a,y=a),t[0]=_*b+y*R,t[1]=_*T+y*O,t[2]=_*I+y*F,t[3]=_*D+y*z,t}function oe(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var d=(u+1)%3,p=(u+2)%3;n=Math.sqrt(e[3*u+u]-e[3*d+d]-e[3*p+p]+1),t[u]=.5*n,t[3]=(e[3*d+p]-e[3*p+d])*(n=.5/n),t[d]=(e[3*d+u]+e[3*u+d])*n,t[p]=(e[3*p+u]+e[3*u+p])*n}return t}Rt.clone=Jr.clone,Rt.fromValues=Jr.fromValues,Rt.copy=Jr.copy,Rt.set=Jr.set,Rt.add=Jr.add,Rt.mul=Ol;var de=Jr.scale;Rt.scale=de;var fe=Jr.dot;Rt.dot=fe,Rt.lerp=Jr.lerp;var we=Jr.length;Rt.length=we,Rt.len=we;var Ae=Jr.squaredLength;Rt.squaredLength=Ae,Rt.sqrLen=Ae;var ve=Jr.normalize;Rt.normalize=ve,Rt.exactEquals=Jr.exactEquals,Rt.equals=Jr.equals;var Pe,rt,Ke,_t=(Pe=ao.create(),rt=ao.fromValues(1,0,0),Ke=ao.fromValues(0,1,0),function(t,e,n){var a=ao.dot(e,n);return a<-.999999?(ao.cross(Pe,rt,e),ao.len(Pe)<1e-6&&ao.cross(Pe,Ke,e),ao.normalize(Pe,Pe),fu(t,Pe,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ao.cross(Pe,e,n),t[0]=Pe[0],t[1]=Pe[1],t[2]=Pe[2],t[3]=1+a,ve(t,t))});Rt.rotationTo=_t;var Mt,Kt,en=(Mt=Rl(),Kt=Rl(),function(t,e,n,a,u,d){return Z(Mt,e,u,d),Z(Kt,n,a,d),Z(t,Mt,Kt,2*d*(1-d)),t});Rt.sqlerp=en;var jt,an=(jt=Gs.create(),function(t,e,n,a){return jt[0]=n[0],jt[3]=n[1],jt[6]=n[2],jt[1]=a[0],jt[4]=a[1],jt[7]=a[2],jt[2]=-e[0],jt[5]=-e[1],jt[8]=-e[2],ve(t,oe(t,jt))});Rt.setAxes=an;var mt={};function rr(t){return rr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rr(t)}Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var t=new Nn.ARRAY_TYPE(8);return Nn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},mt.clone=function(t){var e=new Nn.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},mt.fromValues=function(t,e,n,a,u,d,p,_){var y=new Nn.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=a,y[4]=u,y[5]=d,y[6]=p,y[7]=_,y},mt.fromRotationTranslationValues=function(t,e,n,a,u,d,p){var _=new Nn.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=n,_[3]=a;var y=.5*u,b=.5*d,T=.5*p;return _[4]=y*a+b*n-T*e,_[5]=b*a+T*t-y*n,_[6]=T*a+y*e-b*t,_[7]=-y*t-b*e-T*n,_},mt.fromRotationTranslation=ui,mt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},mt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.fromMat4=function(t,e){var n=pn.create();Tr.getRotation(n,e);var a=new Nn.ARRAY_TYPE(3);return Tr.getTranslation(a,e),ui(t,n,a),t},mt.copy=hi,mt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.set=function(t,e,n,a,u,d,p,_,y){return t[0]=e,t[1]=n,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t},mt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},mt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},mt.getTranslation=function(t,e){var n=e[4],a=e[5],u=e[6],d=e[7],p=-e[0],_=-e[1],y=-e[2],b=e[3];return t[0]=2*(n*b+d*p+a*y-u*_),t[1]=2*(a*b+d*_+u*p-n*y),t[2]=2*(u*b+d*y+n*_-a*p),t},mt.translate=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=.5*n[0],y=.5*n[1],b=.5*n[2],T=e[4],I=e[5],D=e[6],R=e[7];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=p*_+u*b-d*y+T,t[5]=p*y+d*_-a*b+I,t[6]=p*b+a*y-u*_+D,t[7]=-a*_-u*y-d*b+R,t},mt.rotateX=function(t,e,n){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=_*p+T*a+y*d-b*u,D=y*p+T*u+b*a-_*d,R=b*p+T*d+_*u-y*a,O=T*p-_*a-y*u-b*d;return pn.rotateX(t,e,n),t[4]=I*(p=t[3])+O*(a=t[0])+D*(d=t[2])-R*(u=t[1]),t[5]=D*p+O*u+R*a-I*d,t[6]=R*p+O*d+I*u-D*a,t[7]=O*p-I*a-D*u-R*d,t},mt.rotateY=function(t,e,n){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=_*p+T*a+y*d-b*u,D=y*p+T*u+b*a-_*d,R=b*p+T*d+_*u-y*a,O=T*p-_*a-y*u-b*d;return pn.rotateY(t,e,n),t[4]=I*(p=t[3])+O*(a=t[0])+D*(d=t[2])-R*(u=t[1]),t[5]=D*p+O*u+R*a-I*d,t[6]=R*p+O*d+I*u-D*a,t[7]=O*p-I*a-D*u-R*d,t},mt.rotateZ=function(t,e,n){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],I=_*p+T*a+y*d-b*u,D=y*p+T*u+b*a-_*d,R=b*p+T*d+_*u-y*a,O=T*p-_*a-y*u-b*d;return pn.rotateZ(t,e,n),t[4]=I*(p=t[3])+O*(a=t[0])+D*(d=t[2])-R*(u=t[1]),t[5]=D*p+O*u+R*a-I*d,t[6]=R*p+O*d+I*u-D*a,t[7]=O*p-I*a-D*u-R*d,t},mt.rotateByQuatAppend=function(t,e,n){var a=n[0],u=n[1],d=n[2],p=n[3],_=e[0],y=e[1],b=e[2],T=e[3];return t[0]=_*p+T*a+y*d-b*u,t[1]=y*p+T*u+b*a-_*d,t[2]=b*p+T*d+_*u-y*a,t[3]=T*p-_*a-y*u-b*d,t[4]=(_=e[4])*p+(T=e[7])*a+(y=e[5])*d-(b=e[6])*u,t[5]=y*p+T*u+b*a-_*d,t[6]=b*p+T*d+_*u-y*a,t[7]=T*p-_*a-y*u-b*d,t},mt.rotateByQuatPrepend=function(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*T+p*_+u*b-d*y,t[1]=u*T+p*y+d*_-a*b,t[2]=d*T+p*b+a*y-u*_,t[3]=p*T-a*_-u*y-d*b,t[4]=a*(T=n[7])+p*(_=n[4])+u*(b=n[6])-d*(y=n[5]),t[5]=u*T+p*y+d*_-a*b,t[6]=d*T+p*b+a*y-u*_,t[7]=p*T-a*_-u*y-d*b,t},mt.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<Nn.EPSILON)return hi(t,e);var u=Math.hypot(n[0],n[1],n[2]);a*=.5;var d=Math.sin(a),p=d*n[0]/u,_=d*n[1]/u,y=d*n[2]/u,b=Math.cos(a),T=e[0],I=e[1],D=e[2],R=e[3];t[0]=T*b+R*p+I*y-D*_,t[1]=I*b+R*_+D*p-T*y,t[2]=D*b+R*y+T*_-I*p,t[3]=R*b-T*p-I*_-D*y;var O=e[4],F=e[5],z=e[6],j=e[7];return t[4]=O*b+j*p+F*y-z*_,t[5]=F*b+j*_+z*p-O*y,t[6]=z*b+j*y+O*_-F*p,t[7]=j*b-O*p-F*_-z*y,t},mt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},mt.multiply=Aa,mt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},mt.lerp=function(t,e,n,a){var u=1-a;return vp(e,n)<0&&(a=-a),t[0]=e[0]*u+n[0]*a,t[1]=e[1]*u+n[1]*a,t[2]=e[2]*u+n[2]*a,t[3]=e[3]*u+n[3]*a,t[4]=e[4]*u+n[4]*a,t[5]=e[5]*u+n[5]*a,t[6]=e[6]*u+n[6]*a,t[7]=e[7]*u+n[7]*a,t},mt.invert=function(t,e){var n=pu(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},mt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},mt.normalize=function(t,e){var n=pu(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,u=e[1]/n,d=e[2]/n,p=e[3]/n,_=e[4],y=e[5],b=e[6],T=e[7],I=a*_+u*y+d*b+p*T;t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=(_-a*I)/n,t[5]=(y-u*I)/n,t[6]=(b-d*I)/n,t[7]=(T-p*I)/n}return t},mt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},mt.equals=function(t,e){var n=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],T=e[0],I=e[1],D=e[2],R=e[3],O=e[4],F=e[5],z=e[6],j=e[7];return Math.abs(n-T)<=Nn.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-I)<=Nn.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(u-D)<=Nn.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(d-R)<=Nn.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-O)<=Nn.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(_-F)<=Nn.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(y-z)<=Nn.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(b-j)<=Nn.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))},mt.sqrLen=mt.squaredLength=mt.len=mt.length=mt.dot=mt.mul=mt.setReal=mt.getReal=void 0;var Nn=Rr(ft),pn=Rr(Rt),Tr=Rr(Pt);function ir(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ir=function(a){return a?n:e})(t)}function Rr(t,e){if(t&&t.__esModule)return t;if(t===null||rr(t)!=="object"&&typeof t!="function")return{default:t};var n=ir(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function ui(t,e,n){var a=.5*n[0],u=.5*n[1],d=.5*n[2],p=e[0],_=e[1],y=e[2],b=e[3];return t[0]=p,t[1]=_,t[2]=y,t[3]=b,t[4]=a*b+u*y-d*_,t[5]=u*b+d*p-a*y,t[6]=d*b+a*_-u*p,t[7]=-a*p-u*_-d*y,t}function hi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Aa(t,e,n){var a=e[0],u=e[1],d=e[2],p=e[3],_=n[4],y=n[5],b=n[6],T=n[7],I=e[4],D=e[5],R=e[6],O=e[7],F=n[0],z=n[1],j=n[2],X=n[3];return t[0]=a*X+p*F+u*j-d*z,t[1]=u*X+p*z+d*F-a*j,t[2]=d*X+p*j+a*z-u*F,t[3]=p*X-a*F-u*z-d*j,t[4]=a*T+p*_+u*b-d*y+I*X+O*F+D*j-R*z,t[5]=u*T+p*y+d*_-a*b+D*X+O*z+R*F-I*j,t[6]=d*T+p*b+a*y-u*_+R*X+O*j+I*z-D*F,t[7]=p*T-a*_-u*y-d*b+O*X-I*F-D*z-R*j,t}mt.getReal=pn.copy,mt.setReal=pn.copy,mt.mul=Aa;var vp=pn.dot;mt.dot=vp;var B_=pn.length;mt.length=B_,mt.len=B_;var pu=pn.squaredLength;mt.squaredLength=pu,mt.sqrLen=pu;var Zt={};function xp(t){return xp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xp(t)}Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=wp,Zt.clone=function(t){var e=new Hs.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Zt.fromValues=function(t,e){var n=new Hs.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Zt.set=function(t,e,n){return t[0]=e,t[1]=n,t},Zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Zt.subtract=Ep,Zt.multiply=Tp,Zt.divide=Sp,Zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Zt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Zt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Zt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Zt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},Zt.distance=Cp,Zt.squaredDistance=Ip,Zt.length=Dp,Zt.squaredLength=Mp,Zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Zt.normalize=function(t,e){var n=e[0],a=e[1],u=n*n+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},Zt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Zt.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},Zt.lerp=function(t,e,n,a){var u=e[0],d=e[1];return t[0]=u+a*(n[0]-u),t[1]=d+a*(n[1]-d),t},Zt.random=function(t,e){e=e||1;var n=2*Hs.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Zt.transformMat2=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[2]*u,t[1]=n[1]*a+n[3]*u,t},Zt.transformMat2d=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[2]*u+n[4],t[1]=n[1]*a+n[3]*u+n[5],t},Zt.transformMat3=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[3]*u+n[6],t[1]=n[1]*a+n[4]*u+n[7],t},Zt.transformMat4=function(t,e,n){var a=e[0],u=e[1];return t[0]=n[0]*a+n[4]*u+n[12],t[1]=n[1]*a+n[5]*u+n[13],t},Zt.rotate=function(t,e,n,a){var u=e[0]-n[0],d=e[1]-n[1],p=Math.sin(a),_=Math.cos(a);return t[0]=u*_-d*p+n[0],t[1]=u*p+d*_+n[1],t},Zt.angle=function(t,e){var n=t[0],a=t[1],u=e[0],d=e[1],p=Math.sqrt(n*n+a*a)*Math.sqrt(u*u+d*d);return Math.acos(Math.min(Math.max(p&&(n*u+a*d)/p,-1),1))},Zt.zero=function(t){return t[0]=0,t[1]=0,t},Zt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Zt.equals=function(t,e){var n=t[0],a=t[1],u=e[0],d=e[1];return Math.abs(n-u)<=Hs.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-d)<=Hs.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},Zt.forEach=Zt.sqrLen=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=Zt.len=void 0;var Hs=function(t,e){if(t&&t.__esModule)return t;if(t===null||xp(t)!=="object"&&typeof t!="function")return{default:t};var n=bp(void 0);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function bp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(bp=function(a){return a?n:e})(t)}function wp(){var t=new Hs.ARRAY_TYPE(2);return Hs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Ep(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Tp(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Sp(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Cp(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Ip(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function Dp(t){return Math.hypot(t[0],t[1])}function Mp(t){var e=t[0],n=t[1];return e*e+n*n}Zt.len=Dp,Zt.sub=Ep,Zt.mul=Tp,Zt.div=Sp,Zt.dist=Cp,Zt.sqrDist=Ip,Zt.sqrLen=Mp;var V_=function(){var t=wp();return function(e,n,a,u,d,p){var _,y;for(n||(n=2),a||(a=0),y=u?Math.min(u*n+a,e.length):e.length,_=a;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],d(t,t,p),e[_]=t[0],e[_+1]=t[1];return e}}();function kl(t){return kl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kl(t)}Zt.forEach=V_,Object.defineProperty(nt,"__esModule",{value:!0}),r.aA=nt.vec4=r._=nt.vec3=nt.vec2=nt.quat2=r.av=nt.quat=r.ad=nt.mat4=r.bC=nt.mat3=nt.mat2d=r.aC=nt.mat2=nt.glMatrix=void 0;var td=Go(ft);nt.glMatrix=td;var nd=Go(Et);r.aC=nt.mat2=nd;var j_=Go(xn);nt.mat2d=j_;var U_=Go(kt);r.bC=nt.mat3=U_;var $_=Go(Pt);r.ad=nt.mat4=$_;var Ll=Go(Rt);r.av=nt.quat=Ll;var rn=Go(mt);nt.quat2=rn;var U1=Go(Zt);nt.vec2=U1;var $1=Go(Lt);r._=nt.vec3=$1;var G1=Go(Ft);function Ap(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ap=function(a){return a?n:e})(t)}function Go(t,e){if(t&&t.__esModule)return t;if(t===null||kl(t)!=="object"&&typeof t!="function")return{default:t};var n=Ap(e);if(n&&n.has(t))return n.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}r.aA=nt.vec4=G1;var Pp=mu;function mu(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}mu.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=u/d}var p=0,_=1;for(n=t,a=0;a<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));a++)t>u?p=n:_=n,n=.5*(_-p)+p;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var gu=ze(Pp),rd=Pa;function Pa(t,e){this.x=t,this.y=e}Pa.prototype={clone:function(){return new Pa(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),u=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pa.convert=function(t){return t instanceof Pa?t:Array.isArray(t)?new Pa(t[0],t[1]):t};var lt=ze(rd);let G_=Math.PI/180,_u=180/Math.PI;function ln(t){return t*G_}function di(t){return t*_u}let H_=[[0,0],[1,0],[1,1],[0,1]];function Rp(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function yu(t,e,n,a){let u=new gu(t,e,n,a);return function(d){return u.solve(d)}}let Fl=yu(.25,.1,.25,1);function Qt(t,e,n){return Math.min(n,Math.max(e,t))}function Ra(t,e,n){return(n=Qt((n-t)/(e-t),0,1))*n*(3-2*n)}function Oa(t,e,n){let a=n-e,u=((t-e)%a+a)%a+e;return u===e?n:u}function Nl(t,e,n){if(!t.length)return n(null,[]);let a=t.length,u=new Array(t.length),d=null;t.forEach((p,_)=>{e(p,(y,b)=>{y&&(d=y),u[_]=b,--a==0&&n(d,u)})})}function lo(t){let e=[];for(let n in t)e.push(t[n]);return e}function fi(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}let H1=1;function id(){return H1++}function od(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Op(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function kp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function sd(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function vu(t,e){return t.indexOf(e,t.length-e.length)!==-1}function zl(t,e,n){let a={};for(let u in t)a[u]=e.call(this,t[u],u,t);return a}function ka(t,e,n){let a={};for(let u in t)e.call(this,t[u],u,t)&&(a[u]=t[u]);return a}function Ho(t){return Array.isArray(t)?t.map(Ho):typeof t=="object"&&t?zl(t,Ho):t}let Lp={};function Sr(t){Lp[t]||(typeof console<"u"&&console.warn(t),Lp[t]=!0)}function qo(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Ti(t){let e=0;for(let n,a,u=0,d=t.length,p=d-1;u<d;p=u++)n=t[u],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function us([t,e,n]){let a=ln(e+90),u=ln(n);return{x:t*Math.cos(a)*Math.sin(u),y:t*Math.sin(a)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:n}}function ei(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Fp(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,u,d)=>{let p=u||d;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Np,ad,Bl,xu,hs,bu,ld=null;function La(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function wu(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function zp(t,e,n,a){for(;e<n;){let u=e+n>>1;t[u]<a?e=u+1:n=u}return e}function q_(t,e,n,a){for(;e<n;){let u=e+n>>1;t[u]<=a?e=u+1:n=u}return e}function cd(t){return t>0?1/(1.001-t):1+t}function ud(t){return t>0?1-1/(1.001-t):-t}function Vl(){return Np==null&&(Np=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Np}let ti={now:()=>xu!==void 0?xu:performance.now(),setNow(t){xu=t},restoreNow(){xu=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:a}=t;hs||(hs=document.createElement("canvas"));let u=hs.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>hs.width||a>hs.height)&&(hs.width=n,hs.height=a),u.clearRect(-e,-e,n+2*e,a+2*e),u.drawImage(t,0,0,n,a),u.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(ad||(ad=document.createElement("a")),ad.href=t,ad.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Bl==null&&(Bl=window.matchMedia("(prefers-reduced-motion: reduce)")),Bl.matches)},hasCanvasFingerprintNoise(){if(bu!==void 0)return bu;if(!Vl())return bu=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);let a=e.getImageData(0,0,t.width,t.height);n=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&n++!==a.data[u])return bu=!0,!0;return bu=!1,!1}};function hd(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(n));for(let u in e)a.set(u,e[u]);return`${t.slice(0,n)}?${a.toString()}`}function Bp(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let a=new URLSearchParams,u=new URLSearchParams(t.slice(n));for(let p of e.persistentParams){let _=u.get(p);_&&a.set(p,_)}let d=a.toString();return`${t.slice(0,n)}${d.length>0?`?${d}`:""}`}let W_="mapbox-tiles",Vp=500,jp=50,ds,dd;function Z_(){try{return caches}catch{}}function Eu(){let t=Z_();t&&!ds&&(ds=t.open(W_))}let fd=1/0,pd={supported:!1,testSupport:function(t){!Up&&Ul&&($p?X_(t):jl=t)}},jl,Ul,Up=!1,$p=!1,Gp=typeof self<"u"?self:{};function X_(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ul),t.isContextLost())return;pd.supported=!0}catch{}t.deleteTexture(e),Up=!0}Gp.document&&(Ul=Gp.document.createElement("img"),Ul.onload=function(){jl&&X_(jl),jl=null,$p=!0},Ul.onerror=function(){Up=!0,jl=null},Ul.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let md={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(md);class Hp extends Error{constructor(e,n,a){n===401&&L(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let gd=ei()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Tu=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(gd())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){let d=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:gd(),referrerPolicy:a.referrerPolicy,signal:d.signal}),_=!1,y=!1,b=(T=p.url).indexOf("sku=")>0&&L(T);var T;a.type==="json"&&p.headers.set("Accept","application/json");let I=(R,O,F)=>{if(y)return;if(R&&R.message!=="SecurityError"&&Sr(R.toString()),O&&F)return D(O);let z=Date.now();fetch(p).then(j=>{if(j.ok){let X=b?j.clone():null;return D(j,X,z)}return u(new Hp(j.statusText,j.status,a.url))}).catch(j=>{j.name!=="AbortError"&&u(new Error(`${j.message} ${a.url}`))})},D=(R,O,F)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then(z=>{y||(O&&F&&function(j,X,Y){if(Eu(),!ds)return;let K=Fp(X.headers.get("Cache-Control")||"");if(K["no-store"])return;let le={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((_e,Ee)=>le.headers.set(Ee,_e)),K["max-age"]&&le.headers.set("Expires",new Date(Y+1e3*K["max-age"]).toUTCString());let se=le.headers.get("Expires");if(!se||new Date(se).getTime()-Y<42e4)return;let pe=Bp(j.url,{persistentParams:["language","worldview"]});if(X.status===206){let _e=j.headers.get("Range");if(!_e)return;le.status=200,pe=hd(pe,{range:_e})}(function(_e,Ee){if(dd===void 0)try{new Response(new ReadableStream),dd=!0}catch{dd=!1}dd?Ee(_e.body):_e.blob().then(Ee)})(X,_e=>{let Ee=new Response((Oe=X.status)!==200&&Oe!==404&&[101,103,204,205,304].includes(Oe)?null:_e,le);var Oe;Eu(),ds&&ds.then(De=>De.put(pe,Ee)).catch(De=>Sr(De.message))})}(p,O,F),_=!0,u(null,z,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(z=>{y||u(new Error(z.message))})};return b?function(R,O){if(Eu(),!ds)return O(null);ds.then(F=>{let z=Bp(R.url,{persistentParams:["language","worldview"]}),j=R.headers.get("Range");j&&(z=hd(z,{range:j})),F.match(z).then(X=>{let Y=function(K){if(!K)return!1;let le=new Date(K.headers.get("Expires")||0),se=Fp(K.headers.get("Cache-Control")||"");return le>Date.now()&&!se["no-cache"]}(X);F.delete(z),Y&&F.put(z,X.clone()),O(null,X,Y)}).catch(O)}).catch(O)}(p,I):I(null,null),{cancel:()=>{y=!0,_||d.abort()}}}(t,e);if(ei()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,u){let d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let p in a.headers)d.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(a.type==="json")try{p=JSON.parse(d.response)}catch(_){return u(_)}u(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new Hp(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(t,e)},Fa=function(t,e){return Tu(fi(t,{type:"arrayBuffer"}),e)};function Y_(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let qp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Su,Cu;Su=[],Cu=0;let qs=function(t,e){if(pd.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Cu>=A.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Su.push(d),d}Cu++;let n=!1,a=()=>{if(!n)for(n=!0,Cu--;Su.length&&Cu<A.MAX_PARALLEL_IMAGE_REQUESTS;){let d=Su.shift(),{requestParameters:p,callback:_,cancelled:y}=d;y||(d.cancel=qs(p,_).cancel)}},u=Fa(t,(d,p,_,y)=>{a(),d?e(d):p&&(self.createImageBitmap?function(b,T){let I=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(I).then(D=>{T(null,D)}).catch(D=>{T(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(b,T)=>e(b,T,_,y)):function(b,T){let I=new Image;I.onload=()=>{T(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=qp})},I.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(b)],{type:"image/png"});I.src=b.byteLength?URL.createObjectURL(D):qp}(p,(b,T)=>e(b,T,_,y)))});return{cancel:()=>{u.cancel(),a()}}},Wp="01",Zp="NO_ACCESS_TOKEN",q1=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function To(t){let e=t.match(q1);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function $l(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let _d="mapbox.eventData";function K_(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Iu{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=K_(A.ACCESS_TOKEN),a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(+("0x"+d)))):A.ACCESS_TOKEN||"",e?`${_d}.${e}:${a}`:`${_d}:${a}`}fetchEventData(){let e=La("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let u=localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));let d=localStorage.getItem(a);d&&(this.anonId=d)}catch{Sr("Unable to read from LocalStorage")}}saveEventData(){let e=La("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(a,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Sr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,u){if(!A.EVENTS_URL)return;let d=To(A.EVENTS_URL);d.params.push(`access_token=${u||A.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},_=n?fi(p,n):p,y={url:$l(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,T){return Tu(fi(b,{method:"POST"}),T)}(y,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(u)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Q_=new class extends Iu{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){A.EVENTS_URL&&A.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>U(n)||L(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=K_(A.ACCESS_TOKEN),n=e?e.u:A.ACCESS_TOKEN,a=n!==this.eventData.tokenU;kp(this.anonId)||(this.anonId=od(),a=!0);let u=this.queue.shift();if(this.eventData.lastSuccess){let d=new Date(this.eventData.lastSuccess),p=new Date(u),_=(u-this.eventData.lastSuccess)/864e5;a=a||_>=1||_<-1||d.getDate()!==p.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:Wp,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},Xp=Q_.postTurnstileEvent.bind(Q_),Du=new class extends Iu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,A.EVENTS_URL&&(n||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Zp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),kp(this.anonId)||(this.anonId=od()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:Wp,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},J_=Du.postMapLoadEvent.bind(Du),ey=new class extends Iu{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=od(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:a,importedStyles:u}=e;if(!A.EVENTS_URL||!t&&!A.ACCESS_TOKEN)return;let d=this.getMapInstanceId(n),p={mapInstanceId:d,eventId:this.getEventId(d),style:a};u.length&&(p.importedStyles=u),this.queueRequest({timestamp:Date.now(),payload:p},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},W1=ey.postStyleLoadEvent.bind(ey),yd=new class extends Iu{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){A.EVENTS_URL&&(t||A.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(u){let d=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),_=function(R){let O={};if(R){for(let F in R)if(F!=="other")for(let z of R[F]){let j=`${F}ResolveRangeMin`,X=`${F}ResolveRangeMax`,Y=`${F}RequestCount`,K=`${F}RequestCachedCount`;O[j]=Math.min(O[j]||1/0,z.startTime),O[X]=Math.max(O[X]||-1/0,z.responseEnd);let le=se=>{O[se]===void 0&&(O[se]=0),++O[se]};z.transferSize!==void 0&&z.transferSize===0&&le(K),le(Y)}}return O}(function(R,O){let F={};if(R)for(let z of R){let j=O(z);F[j]===void 0&&(F[j]=[]),F[j].push(z)}return F}(d,Qe)),y=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=b?b.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},D=(R,O,F)=>{F!=null&&R.push({name:O,value:F.toString()})};for(let R in _)D(I.counters,R,_[R]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(D(I.counters,"interactionRangeMin",u.interactionRange[0]),D(I.counters,"interactionRangeMax",u.interactionRange[1])),p)for(let R of Object.keys(be)){let O=be[R],F=p.find(z=>z.name===O);F&&D(I.counters,O,F.startTime)}return D(I.counters,"visibilityHidden",u.visibilityHidden),D(I.attributes,"style",function(R){if(R)for(let O of R){let F=O.name.split("?")[0];if(he(F)){let z=F.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(d)),D(I.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),D(I.attributes,"fogEnabled",u.fogEnabled?"true":"false"),D(I.attributes,"projection",u.projection),D(I.attributes,"zoom",u.zoom),D(I.metadata,"devicePixelRatio",y),D(I.metadata,"connectionEffectiveType",T),D(I.metadata,"navigatorUserAgent",navigator.userAgent),D(I.metadata,"screenWidth",window.screen.width),D(I.metadata,"screenHeight",window.screen.height),D(I.metadata,"windowWidth",window.innerWidth),D(I.metadata,"windowHeight",window.innerHeight),D(I.metadata,"mapWidth",u.width/y),D(I.metadata,"mapHeight",u.height/y),D(I.metadata,"webglRenderer",u.renderer),D(I.metadata,"webglVendor",u.vendor),D(I.metadata,"sdkVersion",w),D(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(let u of a.metadata);for(let u of a.counters);for(let u of a.attributes);this.postEvent(e,a,()=>{},t)}},Z1=yd.postPerformanceEvent.bind(yd),Gl=new class extends Iu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!A.API_URL||!A.SESSION_PATH)return;let u=To(A.API_URL+A.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||A.ACCESS_TOKEN||""}`);let d={url:$l(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,_){return Tu(fi(p,{method:"GET"}),_)}(d,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,A.SESSION_PATH&&A.API_URL&&(n||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Zp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},vd=Gl.getSessionAPI.bind(Gl),Mu=new Set;var Na={exports:{}},ty={exports:function(t,e){var n,a,u,d,p,_,y,b;for(a=t.length-(n=3&t.length),u=e,p=3432918353,_=461845907,b=0;b<a;)y=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,u=27492+(65535&(d=5*(65535&(u=(u^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(b+2))<<16;case 2:y^=(255&t.charCodeAt(b+1))<<8;case 1:u^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(b)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}},X1={exports:function(t,e){for(var n,a=t.length,u=e^a,d=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:u^=(255&t.charCodeAt(d+2))<<16;case 2:u^=(255&t.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}},ny=ty.exports,Yp=X1.exports;Na.exports=ny,Na.exports.murmur3=ny,Na.exports.murmur2=Yp;var Hl=ze(Na.exports);function Kp(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function ql(t,e,n){if(n&&n[t]){let a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class Ri{constructor(e,n={}){fi(this,n),this.type=e}}class xd extends Ri{constructor(e,n={}){super("error",fi({error:e},n))}}class za{on(e,n){return this._listeners=this._listeners||{},Kp(e,n,this._listeners),this}off(e,n){return ql(e,n,this._listeners),ql(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Kp(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new Ri(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let _ of u)_.call(this,e);let d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let _ of d)ql(a,_,this._oneTimeListeners),_.call(this,e);let p=this._eventedParent;p&&(fi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof xd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}r.F=void 0;var ry={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function bd(t){return(t=Math.round(t))<0?0:t>255?255:t}function Qp(t){return bd(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Au(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Pu(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{r.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in ry)return ry[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),u=n.indexOf(")");if(a!==-1&&u+1===n.length){var d=n.substr(0,a),p=n.substr(a+1,u-(a+1)).split(","),_=1;switch(d){case"rgba":if(p.length!==4)return null;_=Au(p.pop());case"rgb":return p.length!==3?null:[Qp(p[0]),Qp(p[1]),Qp(p[2]),_];case"hsla":if(p.length!==4)return null;_=Au(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,b=Au(p[1]),T=Au(p[2]),I=T<=.5?T*(b+1):T+b-T*b,D=2*T-I;return[bd(255*Pu(D,I,y+1/3)),bd(255*Pu(D,I,y)),bd(255*Pu(D,I,y-1/3)),_];default:return null}}return null}}catch{}class bn{constructor(e,n,a,u=1){this.r=e,this.g=n,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof bn)return e;if(typeof e!="string")return;let n=r.F(e);return n?new bn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${u})`}toRenderColor(e){let{r:n,g:a,b:u,a:d}=this;return new Y1(e,n,a,u,d)}}class Y1{constructor(e,n,a,u,d){if(e){let p=e.image.height,_=p*p;n=d===0?0:n/d*(p-1),a=d===0?0:a/d*(p-1),u=d===0?0:u/d*(p-1);let y=Math.floor(n),b=Math.floor(a),T=Math.floor(u),I=Math.ceil(n),D=Math.ceil(a),R=Math.ceil(u),O=n-y,F=a-b,z=u-T,j=e.image.data,X=4*(y+b*_+T*p),Y=4*(y+b*_+R*p),K=4*(y+D*_+T*p),le=4*(y+D*_+R*p),se=4*(I+b*_+T*p),pe=4*(I+b*_+R*p),_e=4*(I+D*_+T*p),Ee=4*(I+D*_+R*p);if(X<0||Ee>=j.length)throw new Error("out of range");this.r=It(It(It(j[X],j[Y],z),It(j[K],j[le],z),F),It(It(j[se],j[pe],z),It(j[_e],j[Ee],z),F),O)/255*d,this.g=It(It(It(j[X+1],j[Y+1],z),It(j[K+1],j[le+1],z),F),It(It(j[se+1],j[pe+1],z),It(j[_e+1],j[Ee+1],z),F),O)/255*d,this.b=It(It(It(j[X+2],j[Y+2],z),It(j[K+2],j[le+2],z),F),It(It(j[se+2],j[pe+2],z),It(j[_e+2],j[Ee+2],z),F),O)/255*d,this.a=d}else this.r=n,this.g=a,this.b=u,this.a=d}toArray(){let{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*n/u,255*a/u,u]}toArray01(){let{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,n/u,a/u,u]}toArray01Scaled(e){let{r:n,g:a,b:u,a:d}=this;return d===0?[0,0,0]:[n/d*e,a/d*e,u/d*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:u}=this;return[e,n,a,u]}toArray01Linear(){let{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(n/u,2.2),Math.pow(a/u,2.2),u]}}function It(t,e,n){return t*(1-n)+e*n}function iy(t,e,n){return t.map((a,u)=>It(a,e[u],n))}bn.black=new bn(0,0,0,1),bn.white=new bn(1,1,1,1),bn.transparent=new bn(0,0,0,0),bn.red=new bn(1,0,0,1),bn.blue=new bn(0,0,1,1);var wd=Object.freeze({__proto__:null,array:iy,color:function(t,e,n){return new bn(It(t.r,e.r,n),It(t.g,e.g,n),It(t.b,e.b,n),It(t.a,e.a,n))},number:It});function Jp(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}class Wo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class em{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,u]of n)this.bindings[a]=u}concat(e){return new em(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Wl={kind:"null"},dt={kind:"number"},wn={kind:"string"},En={kind:"boolean"},Oi={kind:"color"},Zl={kind:"object"},yn={kind:"value"},So={kind:"collator"},Xl={kind:"formatted"},Zo={kind:"resolvedImage"};function Vi(t,e){return{kind:"array",itemType:t,N:e}}function Cr(t){if(t.kind==="array"){let e=Cr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let K1=[Wl,dt,wn,En,Oi,Xl,Zl,Vi(yn),Zo];function Ru(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ru(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of K1)if(!Ru(n,e))return null}}return`Expected ${Cr(t)} but found ${Cr(e)} instead.`}function tm(t,e){return e.some(n=>n.kind===t.kind)}function Yl(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class Ou{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ba{constructor(e,n,a,u,d){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=u,this.textColor=d}}class pi{constructor(e){this.sections=e}static fromString(e){return new pi([new Ba(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof pi?e:pi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class ki{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new ki({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function oy(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Li(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof bn||t instanceof Ou||t instanceof pi||t instanceof ki)return!0;if(Array.isArray(t)){for(let e of t)if(!Li(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Li(t[e]))return!1;return!0}return!1}function Or(t){if(t===null)return Wl;if(typeof t=="string")return wn;if(typeof t=="boolean")return En;if(typeof t=="number")return dt;if(t instanceof bn)return Oi;if(t instanceof Ou)return So;if(t instanceof pi)return Xl;if(t instanceof ki)return Zo;if(Array.isArray(t)){let e=t.length,n;for(let a of t){let u=Or(a);if(n){if(n===u)continue;n=yn;break}n=u}return Vi(n||yn,e)}return Zl}function co(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof bn||t instanceof pi||t instanceof ki?t.toString():JSON.stringify(t)}class fs{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Li(e[1]))return n.error("invalid value");let a=e[1],u=Or(a),d=n.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new fs(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof pi?this.value.serialize():this.value}}class Ur{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let nm={string:wn,number:dt,boolean:En,object:Zl};class Co{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,u=1,d=e[0];if(d==="array"){let _,y;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in nm)||b==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=nm[b],u++}else _=yn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],u++}a=Vi(_,y)}else a=nm[d];let p=[];for(;u<e.length;u++){let _=n.parse(e[u],u,yn);if(!_)return null;p.push(_)}return new Co(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!Ru(this.type,Or(a)))return a;if(n===this.args.length-1)throw new Ur(`Expected value to be of type ${Cr(this.type)}, but found ${Cr(Or(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(a=>a.serialize()))}}class ku{constructor(e){this.type=Xl,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let u=[],d=!1;for(let p=1;p<=e.length-1;++p){let _=e[p];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let y=null;if(_["font-scale"]&&(y=n.parse(_["font-scale"],1,dt),!y))return null;let b=null;if(_["text-font"]&&(b=n.parse(_["text-font"],1,Vi(wn)),!b))return null;let T=null;if(_["text-color"]&&(T=n.parse(_["text-color"],1,Oi),!T))return null;let I=u[u.length-1];I.scale=y,I.font=b,I.textColor=T}else{let y=n.parse(e[p],1,yn);if(!y)return null;let b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:y,scale:null,font:null,textColor:null})}}return new ku(u)}evaluate(e){return new pi(this.sections.map(n=>{let a=n.content.evaluate(e);return Or(a)===Zo?new Ba("",a,null,null,null):new Ba(co(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class Lu{constructor(e,n){this.type=Zo,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=n.parse(e[1],1,wn);if(!a)return n.error("No image name provided.");if(e.length===2)return new Lu(a);let u=n.parse(e[2],1,wn);return u?new Lu(a,u):n.error("Secondary image variant is not a string.")}evaluate(e){let n=ki.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Va(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let Q1={"to-boolean":En,"to-color":Oi,"to-number":dt,"to-string":wn};class Io{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0],u=[],d=Wl;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);d=Vi(n.expectedType.itemType,p)}else{if(!(p>0&&Li(e[1][0])))return null;d=Vi(Or(e[1][0]),p)}for(let _=0;_<p;_++){let y=e[1][_],b;if(Va(y)==="array")b=n.parse(y,void 0,d.itemType);else{let T=Va(y);if(T!==d.itemType.kind)return n.error(`Expected ${d.itemType.kind} but found ${T}.`);b=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!b)return null;u.push(b)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");d=Q1[a];for(let p=1;p<e.length;p++){let _=n.parse(e[p],p,yn);if(!_)return null;u.push(_)}}return new Io(d,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let u of this.args){if(n=u.evaluate(e),a=null,n instanceof bn)return n;if(typeof n=="string"){let d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:oy(n[0],n[1],n[2],n[3]),!a))return new bn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ur(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let u=Number(n);if(!isNaN(u))return u}throw new Ur(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?pi.fromString(co(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ki.fromString(co(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):co(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ku([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lu(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let sy=["Unknown","Point","LineString","Polygon"];class ay{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(u*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=bn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Si{constructor(e,n,a,u,d){this.name=e,this.type=n,this._evaluate=a,this.args=u,this._overloadIndex=d}evaluate(e){if(!this._evaluate){let n=Si.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],u=Si.definitions[a];if(!u)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=[],y=null,b=-1;for(let[T,I]of p){if(Array.isArray(T)&&T.length!==e.length-1)continue;_.push(T),b++,y=new yy(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let D=[],R=!1;for(let O=1;O<e.length;O++){let F=e[O],z=Array.isArray(T)?T[O-1]:T.type,j=y.parse(F,1+D.length,z);if(!j){R=!0;break}D.push(j)}if(!R)if(Array.isArray(T)&&T.length!==D.length)y.error(`Expected ${T.length} arguments, but found ${D.length} instead.`);else{for(let O=0;O<D.length;O++){let F=Array.isArray(T)?T[O]:T.type,z=D[O];y.concat(O+1).checkSubtype(F,z.type)}if(y.errors.length===0)return new Si(a,d,I,D,b)}}if(_.length===1)n.errors.push(...y.errors);else{let T=(_.length?_:p.map(([D])=>D)).map(rm).join(" | "),I=[];for(let D=1;D<e.length;D++){let R=n.parse(e[D],1+I.length);if(!R)return null;I.push(Cr(R.type))}n.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Si.definitions=n;for(let a in n)e[a]=Si}}function rm(t){return Array.isArray(t)?`(${t.map(Cr).join(", ")})`:`(${Cr(t.type)}...)`}class Ws{constructor(e,n,a){this.type=So,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let u=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,En);if(!u)return null;let d=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,En);if(!d)return null;let p=null;return a.locale&&(p=n.parse(a.locale,1,wn),!p)?null:new Ws(u,d,p)}evaluate(e){return new Ou(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var im={exports:{}};im.exports=function(){function t(a,u,d,p,_){for(;p>d;){if(p-d>600){var y=p-d+1,b=u-d+1,T=Math.log(y),I=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*I*(y-I)/y)*(b-y/2<0?-1:1);t(a,u,Math.max(d,Math.floor(u-b*I/y+D)),Math.min(p,Math.floor(u+(y-b)*I/y+D)),_)}var R=a[u],O=d,F=p;for(e(a,d,u),_(a[p],R)>0&&e(a,d,p);O<F;){for(e(a,O,F),O++,F--;_(a[O],R)<0;)O++;for(;_(a[F],R)>0;)F--}_(a[d],R)===0?e(a,d,F):e(a,++F,p),F<=u&&(d=F+1),u<=F&&(p=F-1)}}function e(a,u,d){var p=a[u];a[u]=a[d],a[d]=p}function n(a,u){return a<u?-1:a>u?1:0}return function(a,u,d,p,_){t(a,u,d||0,p||a.length-1,_||n)}}();var J1=ze(im.exports);function eb(t){let e=0;for(let n,a,u=0,d=t.length,p=d-1;u<d;p=u++)n=t[u],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function Fu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Kl(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function tb(t,e,n){let a=t[0]-e[0],u=t[1]-e[1],d=t[0]-n[0],p=t[1]-n[1];return a*p-d*u==0&&a*d<=0&&u*p<=0}function Ql(t,e,n=!1){let a=!1;for(let _=0,y=e.length;_<y;_++){let b=e[_];for(let T=0,I=b.length,D=I-1;T<I;D=T++){let R=b[D],O=b[T];if(tb(t,R,O))return n;(d=R)[1]>(u=t)[1]!=(p=O)[1]>u[1]&&u[0]<(p[0]-d[0])*(u[1]-d[1])/(p[1]-d[1])+d[0]&&(a=!a)}}var u,d,p;return a}function om(t,e,n,a){let u=a[0]-n[0],d=a[1]-n[1],p=(t[0]-n[0])*d-u*(t[1]-n[1]),_=(e[0]-n[0])*d-u*(e[1]-n[1]);return p>0&&_<0||p<0&&_>0}function mn(t,e,n,a){return(u=[a[0]-n[0],a[1]-n[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*d[0]!=0&&!(!om(t,e,n,a)||!om(n,a,t,e));var u,d}let ps=8192;function ly(t,e){let n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*ps),Math.round(a*u*ps)]}function nb(t,e){for(let n=0;n<e.length;n++)if(Ql(t,e[n]))return!0;return!1}function rb(t,e,n){for(let a of n)for(let u=0,d=a.length,p=d-1;u<d;p=u++)if(mn(t,e,a[p],a[u]))return!0;return!1}function Nu(t,e){for(let n=0;n<t.length;++n)if(!Ql(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(rb(t[n],t[n+1],e))return!1;return!0}function Ed(t,e){for(let n=0;n<e.length;n++)if(Nu(t,e[n]))return!0;return!1}function Jl(t,e,n){let a=[];for(let u=0;u<t.length;u++){let d=[];for(let p=0;p<t[u].length;p++){let _=ly(t[u][p],n);Fu(e,_),d.push(_)}a.push(d)}return a}function cy(t,e,n){let a=[];for(let u=0;u<t.length;u++){let d=Jl(t[u],e,n);a.push(d)}return a}function sm(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){let u=.5*a,d=t[0]-n[0]>u?-a:n[0]-t[0]>u?a:0;d===0&&(d=t[0]-n[2]>u?-a:n[2]-t[0]>u?a:0),t[0]+=d}Fu(e,t)}function Do(t,e,n,a){let u=Math.pow(2,a.z)*ps,d=[a.x*ps,a.y*ps],p=[];if(!t)return p;for(let _ of t)for(let y of _){let b=[y.x+d[0],y.y+d[1]];sm(b,e,n,u),p.push(b)}return p}function uy(t,e,n,a){let u=Math.pow(2,a.z)*ps,d=[a.x*ps,a.y*ps],p=[];if(!t)return p;for(let y of t){let b=[];for(let T of y){let I=[T.x+d[0],T.y+d[1]];Fu(e,I),b.push(I)}p.push(b)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let y of p)for(let b of y)sm(b,e,n,u)}var _;return p}class Zs{constructor(e,n){this.type=En,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Li(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){let d=a.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Zs(a,a.features[u].geometry)}else if(a.type==="Feature"){let u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Zs(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Zs(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let _=Jl(a.coordinates,d,p),y=Do(n.geometry(),u,d,p);if(!Kl(u,d))return!1;for(let b of y)if(!Ql(b,_))return!1}if(a.type==="MultiPolygon"){let _=cy(a.coordinates,d,p),y=Do(n.geometry(),u,d,p);if(!Kl(u,d))return!1;for(let b of y)if(!nb(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let _=Jl(a.coordinates,d,p),y=uy(n.geometry(),u,d,p);if(!Kl(u,d))return!1;for(let b of y)if(!Nu(b,_))return!1}if(a.type==="MultiPolygon"){let _=cy(a.coordinates,d,p),y=uy(n.geometry(),u,d,p);if(!Kl(u,d))return!1;for(let b of y)if(!Ed(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Xs={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Td=1/298.257223563,hy=Td*(2-Td),zu=Math.PI/180;class Bu{static fromTile(e,n,a){let u=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),d=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/zu;return new Bu(d,a)}static get units(){return Xs}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Xs[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Xs).join(", ")}`);let a=6378.137*zu*(n?Xs[n]:1),u=Math.cos(e*zu),d=1/(1-hy*(1-u*u)),p=Math.sqrt(d);this.kx=a*p*u,this.ky=a*p*d*(1-hy)}distance(e,n){let a=uo(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+u*u)}bearing(e,n){let a=uo(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/zu}destination(e,n,a){let u=a*zu;return this.offset(e,Math.sin(u)*n,Math.cos(u)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){let u=e[a];for(let d=0,p=u.length,_=p-1;d<p;_=d++)n+=uo(u[d][0]-u[_][0])*(u[d][1]+u[_][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let u=0;u<e.length-1;u++){let d=e[u],p=e[u+1],_=this.distance(d,p);if(a+=_,a>n)return Vu(d,p,(n-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[u,d]=n,p=uo(a[0]-u)*this.kx,_=(a[1]-d)*this.ky;if(p!==0||_!==0){let y=(uo(e[0]-u)*this.kx*p+(e[1]-d)*this.ky*_)/(p*p+_*_);y>1?(u=a[0],d=a[1]):y>0&&(u+=p/this.kx*y,d+=_/this.ky*y)}return p=uo(e[0]-u)*this.kx,_=(e[1]-d)*this.ky,Math.sqrt(p*p+_*_)}pointOnLine(e,n){let a=1/0,u=e[0][0],d=e[0][1],p=0,_=0;for(let y=0;y<e.length-1;y++){let b=e[y][0],T=e[y][1],I=uo(e[y+1][0]-b)*this.kx,D=(e[y+1][1]-T)*this.ky,R=0;I===0&&D===0||(R=(uo(n[0]-b)*this.kx*I+(n[1]-T)*this.ky*D)/(I*I+D*D),R>1?(b=e[y+1][0],T=e[y+1][1]):R>0&&(b+=I/this.kx*R,T+=D/this.ky*R)),I=uo(n[0]-b)*this.kx,D=(n[1]-T)*this.ky;let O=I*I+D*D;O<a&&(a=O,u=b,d=T,p=y,_=R)}return{point:[u,d],index:p,t:Math.max(0,Math.min(1,_))}}lineSlice(e,n,a){let u=this.pointOnLine(a,e),d=this.pointOnLine(a,n);if(u.index>d.index||u.index===d.index&&u.t>d.t){let b=u;u=d,d=b}let p=[u.point],_=u.index+1,y=d.index;!am(a[_],p[0])&&_<=y&&p.push(a[_]);for(let b=_+1;b<=y;b++)p.push(a[b]);return am(a[y],d.point)||p.push(d.point),p}lineSliceAlong(e,n,a){let u=0,d=[];for(let p=0;p<a.length-1;p++){let _=a[p],y=a[p+1],b=this.distance(_,y);if(u+=b,u>e&&d.length===0&&d.push(Vu(_,y,(e-(u-b))/b)),u>=n)return d.push(Vu(_,y,(n-(u-b))/b)),d;u>e&&d.push(y)}return d}bufferPoint(e,n){let a=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-a,e[0]+u,e[1]+a]}bufferBBox(e,n){let a=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-a,e[2]+u,e[3]+a]}insideBBox(e,n){return uo(e[0]-n[0])>=0&&uo(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function am(t,e){return t[0]===e[0]&&t[1]===e[1]}function Vu(t,e,n){let a=uo(e[0]-t[0]);return[t[0]+a*n,t[1]+(e[1]-t[1])*n]}function uo(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var ju={exports:{}};(function(t,e){t.exports=function(){var n=function(u,d){if(u===void 0&&(u=[]),d===void 0&&(d=a),this.data=u,this.length=this.data.length,this.compare=d,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function a(u,d){return u<d?-1:u>d?1:0}return n.prototype.push=function(u){this.data.push(u),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var u=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),u}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(u){for(var d=this.data,p=this.compare,_=d[u];u>0;){var y=u-1>>1,b=d[y];if(p(_,b)>=0)break;d[u]=b,u=y}d[u]=_},n.prototype._down=function(u){for(var d=this.data,p=this.compare,_=this.length>>1,y=d[u];u<_;){var b=1+(u<<1),T=d[b],I=b+1;if(I<this.length&&p(d[I],T)<0&&(b=I,T=d[I]),p(T,y)>=0)break;d[u]=T,u=b}d[u]=y},n}()})(ju);var lm=ze(ju.exports),it=8192;function dy(t,e){return e.dist-t.dist}let cm=100,um=50;function fy(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Sd(t){return t[1]-t[0]+1}function Xo(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Ys(t,e){if(t[0]>t[1])return[null,null];let n=Sd(t);if(e){if(n===2)return[t,null];let a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];let a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function ja(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Xo(e,t.length))return n;for(let a=e[0];a<=e[1];++a)Fu(n,t[a]);return n}function Cd(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)Fu(e,t[n][a]);return e}function Ks(t,e,n){if(fy(t)||fy(e))return NaN;let a=0,u=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),n.distance([0,0],[a,u])}function ib(t){return 360*t-180}function ob(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function hm(t,e){let n=Math.pow(2,e.z),a=(t.y/it+e.y)/n;return[ib((t.x/it+e.x)/n),ob(a)]}function sb(t,e){let n=[];for(let a=0;a<t.length;++a)n.push(hm(t[a],e));return n}function py(t,e,n){let a=n.pointOnLine(e,t).point;return n.distance(t,a)}function Qs(t,e,n,a,u){let d=n.slice(a[0],a[1]+1),p=1/0;for(let _=e[0];_<=e[1];++_)if((p=Math.min(p,py(t[_],d,u)))===0)return 0;return p}function dm(t,e,n,a,u){let d=Math.min(u.pointToSegmentDistance(t,n,a),u.pointToSegmentDistance(e,n,a)),p=Math.min(u.pointToSegmentDistance(n,t,e),u.pointToSegmentDistance(a,t,e));return Math.min(d,p)}function ab(t,e,n,a,u){if(!Xo(e,t.length)||!Xo(a,n.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let _=a[0];_<a[1];++_){if(mn(t[p],t[p+1],n[_],n[_+1]))return 0;d=Math.min(d,dm(t[p],t[p+1],n[_],n[_+1],u))}return d}function my(t,e,n,a,u){if(!Xo(e,t.length)||!Xo(a,n.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let _=a[0];_<=a[1];++_)if((d=Math.min(d,u.distance(t[p],n[_])))===0)return d;return d}function gy(t,e,n){if(Ql(t,e,!0))return 0;let a=1/0;for(let u of e){let d=u.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[d-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,u[d-1],u[0])))===0||(a=Math.min(a,py(t,u,n)))===0)return a}return a}function Mo(t,e,n,a){if(!Xo(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Ql(t[d],n,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d)for(let p of n)for(let _=0,y=p.length,b=y-1;_<y;b=_++){if(mn(t[d],t[d+1],p[b],p[_]))return 0;u=Math.min(u,dm(t[d],t[d+1],p[b],p[_],a))}return u}function fm(t,e){for(let n of t)for(let a=0;a<=n.length-1;++a)if(Ql(n[a],e,!0))return!0;return!1}function lb(t,e,n,a=1/0){let u=Cd(t),d=Cd(e);if(a!==1/0&&Ks(u,d,n)>=a)return a;if(Kl(u,d)){if(fm(t,e))return 0}else if(fm(e,t))return 0;let p=a;for(let _ of t)for(let y=0,b=_.length,T=b-1;y<b;T=y++)for(let I of e)for(let D=0,R=I.length,O=R-1;D<R;O=D++){if(mn(_[T],_[y],I[O],I[D]))return 0;p=Math.min(p,dm(_[T],_[y],I[O],I[D],n))}return p}function Uu(t,e,n,a,u,d,p){if(d===null||p===null)return;let _=Ks(ja(a,d),ja(u,p),n);_<e&&t.push({dist:_,range1:d,range2:p})}function Id(t,e,n,a,u=1/0){let d=Math.min(a.distance(t[0],n[0][0]),u);if(d===0)return d;let p=new lm([{dist:0,range1:[0,t.length-1],range2:[0,0]}],dy),_=e?um:cm,y=Cd(n);for(;p.length;){let b=p.pop();if(b.dist>=d)continue;let T=b.range1;if(Sd(T)<=_){if(!Xo(T,t.length))return NaN;if(e){let I=Mo(t,T,n,a);if((d=Math.min(d,I))===0)return d}else for(let I=T[0];I<=T[1];++I){let D=gy(t[I],n,a);if((d=Math.min(d,D))===0)return d}}else{let I=Ys(T,e);if(I[0]!==null){let D=Ks(ja(t,I[0]),y,a);D<d&&p.push({dist:D,range1:I[0],range2:[0,0]})}if(I[1]!==null){let D=Ks(ja(t,I[1]),y,a);D<d&&p.push({dist:D,range1:I[1],range2:[0,0]})}}}return d}function _y(t,e,n,a,u,d=1/0){let p=Math.min(d,u.distance(t[0],n[0]));if(p===0)return p;let _=new lm([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],dy),y=e?um:cm,b=a?um:cm;for(;_.length;){let T=_.pop();if(T.dist>=p)continue;let I=T.range1,D=T.range2;if(Sd(I)<=y&&Sd(D)<=b){if(!Xo(I,t.length)||!Xo(D,n.length))return NaN;if(e&&a?p=Math.min(p,ab(t,I,n,D,u)):e||a?e&&!a?p=Math.min(p,Qs(n,D,t,I,u)):!e&&a&&(p=Math.min(p,Qs(t,I,n,D,u))):p=Math.min(p,my(t,I,n,D,u)),p===0)return p}else{let R=Ys(I,e),O=Ys(D,a);Uu(_,p,u,t,n,R[0],O[0]),Uu(_,p,u,t,n,R[0],O[1]),Uu(_,p,u,t,n,R[1],O[0]),Uu(_,p,u,t,n,R[1],O[1])}}return p}function pm(t,e,n,a,u=1/0){let d=u,p=ja(t,[0,t.length-1]);for(let _ of n)if(!(d!==1/0&&Ks(p,ja(_,[0,_.length-1]),a)>=d)&&(d=Math.min(d,_y(t,e,_,!0,a,d)),d===0))return d;return d}function Dd(t,e,n,a,u=1/0){let d=u,p=ja(t,[0,t.length-1]);for(let _ of n){if(d!==1/0&&Ks(p,Cd(_),a)>=d)continue;let y=Id(t,e,_,a,d);if(isNaN(y))return y;if((d=Math.min(d,y))===0)return d}return d}function mm(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ua{constructor(e,n){this.type=dt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Li(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(mm(a.features[u].geometry.type))return new Ua(a,a.features[u].geometry)}else if(a.type==="Feature"){if(mm(a.geometry.type))return new Ua(a,a.geometry)}else if(mm(a.type))return new Ua(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(u,d,p){let _=[];for(let b of u)for(let T of b)_.push(hm(T,d));let y=new Bu(_[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?_y(_,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?pm(_,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?Dd(_,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(u,d,p){let _=[];for(let b of u){let T=[];for(let I of b)T.push(hm(I,d));_.push(T)}let y=new Bu(_[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return pm(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let b=1/0;for(let T=0;T<p.coordinates.length;T++){let I=pm(p.coordinates[T],!0,_,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}if(p.type==="Polygon"||p.type==="MultiPolygon"){let b=1/0;for(let T=0;T<_.length;T++){let I=Dd(_[T],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,d,p){let _=[];for(let b of function(T,I){let D=T.length;if(D<=1)return[T];let R=[],O,F;for(let z=0;z<D;z++){let j=eb(T[z]);j!==0&&(T[z].area=Math.abs(j),F===void 0&&(F=j<0),F===j<0?(O&&R.push(O),O=[T[z]]):O.push(T[z]))}return O&&R.push(O),R}(u)){let T=[];for(let I=0;I<b.length;++I)T.push(sb(b[I],d));_.push(T)}let y=new Bu(_[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Dd(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let b=1/0;for(let T=0;T<p.coordinates.length;T++){let I=Dd(p.coordinates[T],!0,_,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return p.type==="Polygon"||p.type==="MultiPolygon"?function(b,T,I){let D=1/0;for(let R of b)for(let O of T){let F=lb(R,O,I,D);if(isNaN(F))return F;if((D=Math.min(D,F))===0)return D}return D}(p.type==="Polygon"?[p.coordinates]:p.coordinates,_,y):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ec(t,e){switch(t){case"string":return co(e);case"number":return+e;case"boolean":return!!e;case"color":return bn.parse(e);case"formatted":return pi.fromString(co(e));case"resolvedImage":return ki.fromString(co(e))}return e}function $u(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class ni{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=yn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let u=n.parse(e[1],1);if(!(u instanceof fs))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let d=n.parse(e[2],2);return d instanceof fs?new ni(a,co(u.value),co(d.value)):n.error("Scope of 'config' expression must be a string literal.")}return new ni(a,co(u.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;let{type:u,value:d,values:p,minValue:_,maxValue:y,stepValue:b}=a,T=a.default.evaluate(e),I=T;if(d){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),I=d.evaluate(e),e.scope=D}return u&&(I=ec(u,I)),I===void 0||_===void 0&&y===void 0&&b===void 0||(typeof I=="number"?I=$u(I,_,y,b):Array.isArray(I)&&(I=I.map(D=>typeof D=="number"?$u(D,_,y,b):D))),d!==void 0&&I!==void 0&&p&&!p.includes(I)&&(I=T,u&&(I=ec(u,I))),(u&&u!==this.type||I!==void 0&&Or(I)!==this.type)&&(I=ec(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Js(t){if(t instanceof Si&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Zs||t instanceof Ua)return!1;let e=!0;return t.eachChild(n=>{e&&!Js(n)&&(e=!1)}),e}function Md(t){if(t instanceof Si&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Md(n)&&(e=!1)}),e}function gm(t){if(t instanceof ni)return!1;let e=!0;return t.eachChild(n=>{e&&!gm(n)&&(e=!1)}),e}function Gu(t,e){if(t instanceof Si&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!Gu(a,e)&&(n=!1)}),n}class Ad{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new Ad(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Hu{constructor(e,n=[],a,u=new em,d=[],p,_){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=u,this.errors=d,this.expectedType=a,this._scope=p,this.options=_}parse(e,n,a,u,d={}){return n||a?this.concat(n,a,u)._parse(e,d):this._parse(e,d)}_parse(e,n){function a(u,d,p){return p==="assert"?new Co(d,[u]):p==="coerce"?new Io(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){let p=this.expectedType,_=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||_.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(p,_))return null}else d=a(d,p,n.typeAnnotation||"coerce");else d=a(d,p,n.typeAnnotation||"assert")}if(!(d instanceof fs)&&d.type.kind!=="resolvedImage"&&qu(d)){let p=new ay(this._scope,this.options);try{d=new fs(d.type,d.evaluate(p))}catch(_){return this.error(_.message),null}}return d}return Io.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let u=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new Hu(this.registry,u,n||null,d,this.errors,this._scope,this.options)}error(e,...n){let a=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Wo(a,e))}checkSubtype(e,n){let a=Ru(e,n);return a&&this.error(a),a}}var yy=Hu;function qu(t){if(t instanceof Ad)return qu(t.boundExpression);if(t instanceof Si&&t.name==="error"||t instanceof Ws||t instanceof Zs||t instanceof Ua||t instanceof ni)return!1;let e=t instanceof Io||t instanceof Co,n=!0;return t.eachChild(a=>{n=e?n&&qu(a):n&&a instanceof fs}),!!n&&Js(t)&&Gu(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Pd(t,e){let n=t.length-1,a,u,d=0,p=n,_=0;for(;d<=p;)if(_=Math.floor((d+p)/2),a=t[_],u=t[_+1],a<=e){if(_===n||e<u)return _;d=_+1}else{if(!(a>e))throw new Ur("Input is not a number.");p=_-1}return 0}class Wu{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[u,d]of a)this.labels.push(u),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,dt);if(!a)return null;let u=[],d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let p=1;p<e.length;p+=2){let _=p===1?-1/0:e[p],y=e[p+1],b=p,T=p+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(u.length&&u[u.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let I=n.parse(y,T,d);if(!I)return null;d=d||I.type,u.push([_,I])}return new Wu(d,a,u)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);let d=n.length;return u>=n[d-1]?a[d-1].evaluate(e):a[Pd(n,u)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let Rd=.95047,vy=1.08883,_m=4/29,$a=6/29,xy=3*$a*$a,ym=$a*$a*$a,Od=Math.PI/180,by=180/Math.PI;function vm(t){return t>ym?Math.pow(t,1/3):t/xy+_m}function kd(t){return t>$a?t*t*t:xy*(t-_m)}function xm(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Zu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function wy(t){let e=Zu(t.r),n=Zu(t.g),a=Zu(t.b),u=vm((.4124564*e+.3575761*n+.1804375*a)/Rd),d=vm((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-vm((.0193339*e+.119192*n+.9503041*a)/vy)),alpha:t.a}}function Ey(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*kd(e),n=Rd*kd(n),a=vy*kd(a),new bn(xm(3.2404542*n-1.5371385*e-.4985314*a),xm(-.969266*n+1.8760108*e+.041556*a),xm(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function cb(t,e,n){let a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let Xu={forward:wy,reverse:Ey,interpolate:function(t,e,n){return{l:It(t.l,e.l,n),a:It(t.a,e.a,n),b:It(t.b,e.b,n),alpha:It(t.alpha,e.alpha,n)}}},tc={forward:function(t){let{l:e,a:n,b:a}=wy(t),u=Math.atan2(a,n)*by;return{h:u<0?u+360:u,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Od,n=t.c;return Ey({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:cb(t.h,e.h,n),c:It(t.c,e.c,n),l:It(t.l,e.l,n),alpha:It(t.alpha,e.alpha,n)}}};var Ty=Object.freeze({__proto__:null,hcl:tc,lab:Xu});class Xi{constructor(e,n,a,u,d){this.type=e,this.operator=n,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(let[p,_]of d)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,n,a,u){let d=0;if(e.name==="exponential")d=bm(n,e.base,a,u);else if(e.name==="linear")d=bm(n,1,a,u);else if(e.name==="cubic-bezier"){let p=e.controlPoints;d=new gu(p[0],p[1],p[2],p[3]).solve(bm(n,1,a,u))}return d}static parse(e,n){let[a,u,d,...p]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){let b=u[1];if(typeof b!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:b}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{let b=u.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,dt),!d)return null;let _=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=Oi:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let b=0;b<p.length;b+=2){let T=p[b],I=p[b+1],D=b+3,R=b+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let O=n.parse(I,R,y);if(!O)return null;y=y||O.type,_.push([T,O])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Xi(y,a,u,d,_):n.error(`Type ${Cr(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);let d=n.length;if(u>=n[d-1])return a[d-1].evaluate(e);let p=Pd(n,u),_=Xi.interpolationFactor(this.interpolation,u,n[p],n[p+1]),y=a[p].evaluate(e),b=a[p+1].evaluate(e);return this.operator==="interpolate"?wd[this.type.kind.toLowerCase()](y,b,_):this.operator==="interpolate-hcl"?tc.reverse(tc.interpolate(tc.forward(y),tc.forward(b),_)):Xu.reverse(Xu.interpolate(Xu.forward(y),Xu.forward(b),_))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function bm(t,e,n,a){let u=a-n,d=t-n;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}class Ld{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,u=n.expectedType;u&&u.kind!=="value"&&(a=u);let d=[];for(let _ of e.slice(1)){let y=n.parse(_,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,d.push(y)}let p=u&&d.some(_=>Ru(u,_.type));return new Ld(p?yn:a,d)}evaluate(e){let n,a=null,u=0;for(let d of this.args){if(u++,a=d.evaluate(e),a&&a instanceof ki&&!a.available&&(n||(n=a),a=null,u===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Fd{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let d=1;d<e.length-1;d+=2){let p=e[d];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);let _=n.parse(e[d+1],d+1);if(!_)return null;a.push([p,_])}let u=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return u?new Fd(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class wm{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,dt),u=n.parse(e[2],2,Vi(n.expectedType||yn));return a&&u?new wm(u.type.itemType,a,u):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new Ur(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Ur(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Ur(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Em{constructor(e,n){this.type=En,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,yn),u=n.parse(e[2],2,yn);return a&&u?tm(a.type,[En,wn,dt,Wl,yn])?new Em(a,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Yl(n,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(Or(n))} instead.`);if(!Yl(a,["string","array"]))throw new Ur(`Expected second argument to be of type array or string, but found ${Cr(Or(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Nd{constructor(e,n,a){this.type=dt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,yn),u=n.parse(e[2],2,yn);if(!a||!u)return null;if(!tm(a.type,[En,wn,dt,Wl,yn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(a.type)} instead`);if(e.length===4){let d=n.parse(e[3],3,dt);return d?new Nd(a,u,d):null}return new Nd(a,u)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Yl(n,["boolean","string","number","null"]))throw new Ur(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(Or(n))} instead.`);if(!Yl(a,["string","array"]))throw new Ur(`Expected second argument to be of type array or string, but found ${Cr(Or(a))} instead.`);if(this.fromIndex){let u=this.fromIndex.evaluate(e);return a.indexOf(n,u)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class nc{constructor(e,n,a,u,d,p){this.inputType=e,this.type=n,this.input=a,this.cases=u,this.outputs=d,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);let d={},p=[];for(let b=2;b<e.length-1;b+=2){let T=e[b],I=e[b+1];Array.isArray(T)||(T=[T]);let D=n.concat(b);if(T.length===0)return D.error("Expected at least one branch label.");for(let O of T){if(typeof O!="number"&&typeof O!="string")return D.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,Or(O)))return null}else a=Or(O);if(d[String(O)]!==void 0)return D.error("Branch labels must be unique.");d[String(O)]=p.length}let R=n.parse(I,b,u);if(!R)return null;u=u||R.type,p.push(R)}let _=n.parse(e[1],1,yn);if(!_)return null;let y=n.parse(e[e.length-1],e.length-1,u);return y?_.type.kind!=="value"&&n.concat(1).checkSubtype(a,_.type)?null:new nc(a,u,_,d,p,y):null}evaluate(e){let n=this.input.evaluate(e);return(Or(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],u={};for(let p of n){let _=u[this.cases[p]];_===void 0?(u[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[_][1].push(p)}let d=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,_]of a)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Tm{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let u=[];for(let p=1;p<e.length-1;p+=2){let _=n.parse(e[p],p,En);if(!_)return null;let y=n.parse(e[p+1],p+1,a);if(!y)return null;u.push([_,y]),a=a||y.type}let d=n.parse(e[e.length-1],e.length-1,a);return d?new Tm(a,u,d):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class zd{constructor(e,n,a,u){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,yn),u=n.parse(e[2],2,dt);if(!a||!u)return null;if(!tm(a.type,[Vi(yn),wn,yn]))return n.error(`Expected first argument to be of type array or string, but found ${Cr(a.type)} instead`);if(e.length===4){let d=n.parse(e[3],3,dt);return d?new zd(a.type,a,u,d):null}return new zd(a.type,a,u)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Yl(n,["string","array"]))throw new Ur(`Expected first argument to be of type array or string, but found ${Cr(Or(n))} instead.`);if(this.endIndex){let u=this.endIndex.evaluate(e);return n.slice(a,u)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Yu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sy(t,e,n,a){return a.compare(e,n)===0}function Ga(t,e,n){let a=t!=="=="&&t!=="!=";return class $N{constructor(d,p,_){this.type=En,this.lhs=d,this.rhs=p,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");let _=d[0],y=p.parse(d[1],1,yn);if(!y)return null;if(!Yu(_,y.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${Cr(y.type)}'.`);let b=p.parse(d[2],2,yn);if(!b)return null;if(!Yu(_,b.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${Cr(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${Cr(y.type)}' and '${Cr(b.type)}'.`);a&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new Co(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new Co(y.type,[b])));let T=null;if(d.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(d[3],3,So),!T)return null}return new $N(y,b,T)}evaluate(d){let p=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){let y=Or(p),b=Or(_);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new Ur(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=Or(p),b=Or(_);if(y.kind!=="string"||b.kind!=="string")return e(d,p,_)}return this.collator?n(d,p,_,this.collator.evaluate(d)):e(d,p,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[t];return this.eachChild(p=>{d.push(p.serialize())}),d}}}let ub=Ga("==",function(t,e,n){return e===n},Sy),Cy=Ga("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!Sy(0,e,n,a)}),Iy=Ga("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),Dy=Ga(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),My=Ga("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),Sm=Ga(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class Ku{constructor(e,n,a,u,d,p){this.type=wn,this.number=e,this.locale=n,this.currency=a,this.unit=u,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,dt);if(!a)return null;let u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=n.parse(u.locale,1,wn),!d))return null;let p=null;if(u.currency&&(p=n.parse(u.currency,1,wn),!p))return null;let _=null;if(u.unit&&(_=n.parse(u.unit,1,wn),!_))return null;let y=null;if(u["min-fraction-digits"]&&(y=n.parse(u["min-fraction-digits"],1,dt),!y))return null;let b=null;return u["max-fraction-digits"]&&(b=n.parse(u["max-fraction-digits"],1,dt),!b)?null:new Ku(a,d,p,_,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Cm{constructor(e){this.type=dt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Cr(a.type)} instead.`):new Cm(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Ur(`Expected value to be of type string or array, but found ${Cr(Or(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Ay(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Ha={"==":ub,"!=":Cy,">":Dy,"<":Iy,">=":Sm,"<=":My,array:Co,at:wm,boolean:Co,case:Tm,coalesce:Ld,collator:Ws,format:ku,image:Lu,in:Em,"index-of":Nd,interpolate:Xi,"interpolate-hcl":Xi,"interpolate-lab":Xi,length:Cm,let:Fd,literal:fs,match:nc,number:Co,"number-format":Ku,object:Co,slice:zd,step:Wu,string:Co,"to-boolean":Io,"to-color":Io,"to-number":Io,"to-string":Io,var:Ad,within:Zs,distance:Ua,config:ni};function Py(t,[e,n,a,u]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let d=u?u.evaluate(t):1,p=oy(e,n,a,d);if(p)throw new Ur(p);return new bn(e/255*d,n/255*d,a/255*d,d)}function Ry(t,[e,n,a,u]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let d=u?u.evaluate(t):1,p=function(b,T,I,D){return typeof b=="number"&&b>=0&&b<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[b,T,I,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[b,T,I,D]:[b,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[b,T,I,D]:[b,T,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,d);if(p)throw new Ur(p);let _=`hsla(${e}, ${n}%, ${a}%, ${d})`,y=bn.parse(_);if(!y)throw new Ur(`Failed to parse HSLA color: ${_}`);return y}function Oy(t,e){return t in e}function Im(t,e){let n=e[t];return n===void 0?null:n}function qa(t){return{type:t}}function ky(t){return{result:"success",value:t}}function Wa(t){return{result:"error",value:t}}function Ly(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Bd(t){return t["property-type"]==="data-driven"}function hb(t){return Ly(t.expression,"measure-light")}function m(t){return Ly(t.expression,"zoom")}function s(t){return!!t.expression&&t.expression.interpolated}function h(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function v(t,e){let n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",u=a||!(a||t.property!==void 0),d=t.type||(s(e)?"exponential":"interval");if(n&&((t=Jp({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],bn.parse(b[1])])),t.default=bn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Ty[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,_,y;if(d==="exponential")p=M;else if(d==="interval")p=S;else if(d==="categorical"){p=E,_=Object.create(null);for(let b of t.stops)_[b[0]]=b[1];y=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=P}if(a){let b={},T=[];for(let R=0;R<t.stops.length;R++){let O=t.stops[R],F=O[0].zoom;b[F]===void 0&&(b[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},T.push(F)),b[F].stops.push([O[0].value,O[1]])}let I=[];for(let R of T)I.push([b[R].zoom,v(b[R],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Xi.interpolationFactor.bind(void 0,D),zoomStops:I.map(R=>R[0]),evaluate:({zoom:R},O)=>M({stops:I,base:t.base},e,R).evaluate(R,O)}}if(u){let b=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Xi.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(t,e,T,_,y)}}return{kind:"source",evaluate(b,T){let I=T&&T.properties?T.properties[t.property]:void 0;return I===void 0?x(t.default,e.default):p(t,e,I,_,y)}}}function x(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function E(t,e,n,a,u){return x(typeof n===u?a[n]:void 0,t.default,e.default)}function S(t,e,n){if(Va(n)!=="number")return x(t.default,e.default);let a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];let u=Pd(t.stops.map(d=>d[0]),n);return t.stops[u][1]}function M(t,e,n){let a=t.base!==void 0?t.base:1;if(Va(n)!=="number")return x(t.default,e.default);let u=t.stops.length;if(u===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];let d=Pd(t.stops.map(T=>T[0]),n),p=function(T,I,D,R){let O=R-D,F=T-D;return O===0?0:I===1?F/O:(Math.pow(I,F)-1)/(Math.pow(I,O)-1)}(n,a,t.stops[d][0],t.stops[d+1][0]),_=t.stops[d][1],y=t.stops[d+1][1],b=wd[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=Ty[t.colorSpace];b=(I,D)=>T.reverse(T.interpolate(T.forward(I),T.forward(D),p))}return typeof _.evaluate=="function"?{evaluate(...T){let I=_.evaluate.apply(void 0,T),D=y.evaluate.apply(void 0,T);if(I!==void 0&&D!==void 0)return b(I,D,p)}}:b(_,y,p)}function P(t,e,n){return e.type==="color"?n=bn.parse(n):e.type==="formatted"?n=pi.fromString(n.toString()):e.type==="resolvedImage"?n=ki.fromString(n.toString()):Va(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,t.default,e.default)}Si.register(Ha,{error:[{kind:"error"},[wn],(t,[e])=>{throw new Ur(e.evaluate(t))}],typeof:[wn,[yn],(t,[e])=>Cr(Or(e.evaluate(t)))],"to-rgba":[Vi(dt,4),[Oi],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[Oi,[dt,dt,dt],Py],rgba:[Oi,[dt,dt,dt,dt],Py],hsl:[Oi,[dt,dt,dt],Ry],hsla:[Oi,[dt,dt,dt,dt],Ry],has:{type:En,overloads:[[[wn],(t,[e])=>Oy(e.evaluate(t),t.properties())],[[wn,Zl],(t,[e,n])=>Oy(e.evaluate(t),n.evaluate(t))]]},get:{type:yn,overloads:[[[wn],(t,[e])=>Im(e.evaluate(t),t.properties())],[[wn,Zl],(t,[e,n])=>Im(e.evaluate(t),n.evaluate(t))]]},"feature-state":[yn,[wn],(t,[e])=>Im(e.evaluate(t),t.featureState||{})],properties:[Zl,[],t=>t.properties()],"geometry-type":[wn,[],t=>t.geometryType()],id:[yn,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],pitch:[dt,[],t=>t.globals.pitch||0],"distance-from-center":[dt,[],t=>t.distanceFromCenter()],"measure-light":[dt,[wn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],"raster-value":[dt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[dt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[dt,[],t=>t.globals.skyRadialProgress||0],accumulated:[yn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[dt,qa(dt),(t,e)=>{let n=0;for(let a of e)n+=a.evaluate(t);return n}],"*":[dt,qa(dt),(t,e)=>{let n=1;for(let a of e)n*=a.evaluate(t);return n}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,qa(dt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[dt,qa(dt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[En,[wn,yn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[En,[yn],(t,[e])=>t.id()===e.value],"filter-type-==":[En,[wn],(t,[e])=>t.geometryType()===e.value],"filter-<":[En,[wn,yn],(t,[e,n])=>{let a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a<u}],"filter-id-<":[En,[yn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[En,[wn,yn],(t,[e,n])=>{let a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a>u}],"filter-id->":[En,[yn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[En,[wn,yn],(t,[e,n])=>{let a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[En,[yn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[En,[wn,yn],(t,[e,n])=>{let a=t.properties()[e.value],u=n.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[En,[yn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[En,[yn],(t,[e])=>e.value in t.properties()],"filter-has-id":[En,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[En,[Vi(wn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[En,[Vi(yn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[En,[wn,Vi(yn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[En,[wn,Vi(yn)],(t,[e,n])=>function(a,u,d,p){for(;d<=p;){let _=d+p>>1;if(u[_]===a)return!0;u[_]>a?p=_-1:d=_+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:En,overloads:[[[En,En],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[qa(En),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:En,overloads:[[[En,En],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[qa(En),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[En,[En],(t,[e])=>!e.evaluate(t)],"is-supported-script":[En,[wn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[wn,[wn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[wn,[wn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[wn,qa(yn),(t,e)=>e.map(n=>co(n.evaluate(t))).join("")],"resolved-locale":[wn,[So],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[dt,[dt,dt,yn],(t,e)=>{let[n,a,u]=e.map(p=>p.evaluate(t));if(n>a||n===a)return n;let d;if(typeof u=="string")d=function(p){let _=0;if(p.length===0)return _;for(let y=0;y<p.length;y++)_=(_<<5)-_+p.charCodeAt(y),_|=0;return _}(u);else{if(typeof u!="number")throw new Ur(`Invalid seed input: ${u}`);d=u}return n+Ay(d)()*(a-n)}]});class k{constructor(e,n,a,u){this.expression=e,this._warningHistory={},this._evaluator=new ay(a,u),this._defaultValue=n?function(d){return d.type==="color"&&(h(d.default)||Array.isArray(d.default))?new bn(0,0,0,0):d.type==="color"?bn.parse(d.default)||null:d.default===void 0?null:d.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,u,d,p,_,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,u,d,p,_,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Ur(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function N(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ha}function B(t,e,n,a){let u=new yy(Ha,[],e?function(p){let _={color:Oi,string:wn,number:dt,enum:wn,boolean:En,formatted:Xl,resolvedImage:Zo};return p.type==="array"?Vi(_[p.value]||yn,p.length):_[p.type]}(e):void 0,void 0,void 0,n,a),d=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?ky(new k(d,e,n,a)):Wa(u.errors)}class V{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!Md(n.expression),this.isConfigDependent=!gm(n.expression)}evaluateWithoutErrorHandling(e,n,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,d,p)}evaluate(e,n,a,u,d,p){return this._styleExpression.evaluate(e,n,a,u,d,p)}}class G{constructor(e,n,a,u,d){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Md(n.expression),this.isLightConstant=d,this.isConfigDependent=!gm(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,d,p)}evaluate(e,n,a,u,d,p){return this._styleExpression.evaluate(e,n,a,u,d,p)}interpolationFactor(e,n,a){return this.interpolationType?Xi.interpolationFactor(this.interpolationType,e,n,a):0}}function H(t,e,n,a){if((t=B(t,e,n,a)).result==="error")return t;let u=t.value.expression,d=Js(u);if(!d&&!Bd(e))return Wa([new Wo("","data expressions not supported")]);let p=Gu(u,["zoom","pitch","distance-from-center"]);if(!p&&!m(e))return Wa([new Wo("","zoom expressions not supported")]);let _=Gu(u,["measure-light"]);if(!_&&!hb(e))return Wa([new Wo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,b=W(u);return b||p||y?b instanceof Wo?Wa([b]):b instanceof Xi&&!s(e)?Wa([new Wo("",'"interpolate" expressions cannot be used with this property')]):ky(b?new G(d?"camera":"composite",t.value,b.labels,b instanceof Xi?b.interpolation:void 0,_):new V(d?"constant":"source",t.value,_)):Wa([new Wo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class q{constructor(e,n){this._parameters=e,this._specification=n,Jp(this,v(this._parameters,this._specification))}static deserialize(e){return new q(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function W(t){let e=null;if(t instanceof Fd)e=W(t.result);else if(t instanceof Ld){for(let n of t.args)if(e=W(n),e)break}else(t instanceof Wu||t instanceof Xi)&&t.input instanceof Si&&t.input.name==="zoom"&&(e=t);return e instanceof Wo||t.eachChild(n=>{let a=W(n);a instanceof Wo?e=a:e&&a&&e!==a&&(e=new Wo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ee=ne,te=3;function ne(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var d=0;d<this.d*this.d;d++){var p=u[te+d],_=u[te+d+1];a.push(p===_?null:u.subarray(p,_))}var y=u[te+a.length+1];this.keys=u.subarray(u[te+a.length],y),this.bboxes=u.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var T=n/e*t;this.min=-T,this.max=t+T}ne.prototype.insert=function(t,e,n,a,u){this._forEachCell(e,n,a,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(u)},ne.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ne.prototype._insertCell=function(t,e,n,a,u,d){this.cells[u].push(d)},ne.prototype.query=function(t,e,n,a,u){var d=this.min,p=this.max;if(t<=d&&e<=d&&p<=n&&p<=a&&!u)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,n,a,this._queryCell,_,{},u),_},ne.prototype._queryCell=function(t,e,n,a,u,d,p,_){var y=this.cells[u];if(y!==null)for(var b=this.keys,T=this.bboxes,I=0;I<y.length;I++){var D=y[I];if(p[D]===void 0){var R=4*D;(_?_(T[R+0],T[R+1],T[R+2],T[R+3]):t<=T[R+2]&&e<=T[R+3]&&n>=T[R+0]&&a>=T[R+1])?(p[D]=!0,d.push(b[D])):p[D]=!1}}},ne.prototype._forEachCell=function(t,e,n,a,u,d,p,_){for(var y=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(n),I=this._convertToCellCoord(a),D=y;D<=T;D++)for(var R=b;R<=I;R++){var O=this.d*R+D;if((!_||_(this._convertFromCellCoord(D),this._convertFromCellCoord(R),this._convertFromCellCoord(D+1),this._convertFromCellCoord(R+1)))&&u.call(this,t,e,n,a,O,d,p,_))return}},ne.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ne.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ne.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=te+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,p=0;p<t.length;p++){var _=t[p];u[te+p]=d,u.set(_,d),d+=_.length}return u[te+t.length]=d,u.set(this.keys,d),u[te+t.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};var ue=ze(ee);let ce={};function J(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),ce[e]={klass:t,omit:n.omit||[]}}J(Object,"Object"),ue.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ue.deserialize=function(t){return new ue(t.buffer)},Object.defineProperty(ue,"name",{value:"Grid"}),J(ue,"Grid"),J(bn,"Color"),J(Error,"Error"),J(pi,"Formatted"),J(Ba,"FormattedSection"),J(Hp,"AJAXError"),J(ki,"ResolvedImage"),J(q,"StylePropertyFunction"),J(k,"StyleExpression",{omit:["_evaluator"]}),J(G,"ZoomDependentExpression"),J(V,"ZoomConstantExpression"),J(Si,"CompoundExpression",{omit:["_evaluate"]});for(let t in Ha)ce[Ha[t]._classRegistryKey]||J(Ha[t],`Expression${t}`);function re(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ie(t){return self.ImageBitmap&&t instanceof ImageBitmap}function ge(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(re(t)||ie(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let a of t)n.push(ge(a,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[a,u]of t.entries())n[a]=ge(u);return n}if(typeof t=="object"){let n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let d in t)t.hasOwnProperty(d)&&(ce[a].omit.indexOf(d)>=0||(u[d]=ge(t[d],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof t)}function Se(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||re(t)||ie(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Se);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let u=new Map;for(let d of Object.keys(t))d!=="$name"&&u.set(d,Se(t[d]));return u}let{klass:n}=ce[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let a=Object.create(n.prototype);for(let u of Object.keys(t))u!=="$name"&&(a[u]=Se(t[u]));return a}throw new Error("can't deserialize object of type "+typeof t)}let ae={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ce(t){for(let e of t)if(Ge(e.charCodeAt(0)))return!0;return!1}function Me(t){for(let e of t)if(!$e(e.charCodeAt(0)))return!1;return!0}function $e(t){return!(ae.Arabic(t)||ae["Arabic Supplement"](t)||ae["Arabic Extended-A"](t)||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t))}function Ge(t){return!(t!==746&&t!==747&&(t<4352||!(ae["Bopomofo Extended"](t)||ae.Bopomofo(t)||ae["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ae["CJK Compatibility Ideographs"](t)||ae["CJK Compatibility"](t)||ae["CJK Radicals Supplement"](t)||ae["CJK Strokes"](t)||!(!ae["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ae["CJK Unified Ideographs Extension A"](t)||ae["CJK Unified Ideographs"](t)||ae["Enclosed CJK Letters and Months"](t)||ae["Hangul Compatibility Jamo"](t)||ae["Hangul Jamo Extended-A"](t)||ae["Hangul Jamo Extended-B"](t)||ae["Hangul Jamo"](t)||ae["Hangul Syllables"](t)||ae.Hiragana(t)||ae["Ideographic Description Characters"](t)||ae.Kanbun(t)||ae["Kangxi Radicals"](t)||ae["Katakana Phonetic Extensions"](t)||ae.Katakana(t)&&t!==12540||!(!ae["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ae["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ae["Unified Canadian Aboriginal Syllabics"](t)||ae["Unified Canadian Aboriginal Syllabics Extended"](t)||ae["Vertical Forms"](t)||ae["Yijing Hexagram Symbols"](t)||ae["Yi Syllables"](t)||ae["Yi Radicals"](t))))}function Ve(t){return!(Ge(t)||function(e){return!!(ae["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ae["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ae["Letterlike Symbols"](e)||ae["Number Forms"](e)||ae["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ae["Control Pictures"](e)&&e!==9251||ae["Optical Character Recognition"](e)||ae["Enclosed Alphanumerics"](e)||ae["Geometric Shapes"](e)||ae["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ae["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ae["CJK Symbols and Punctuation"](e)||ae.Katakana(e)||ae["Private Use Area"](e)||ae["CJK Compatibility Forms"](e)||ae["Small Form Variants"](e)||ae["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function xe(t){return t>=1424&&t<=2303||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t)}function Re(t,e){return!(!e&&xe(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ae.Khmer(t))}function Fe(t){for(let e of t)if(xe(e.charCodeAt(0)))return!0;return!1}let ot="deferred",ct="loading",at="loaded",je=null,He="unavailable",st=null,pt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(He="error"),je&&je(t)};function Ot(){Gt.fire(new Ri("pluginStateChange",{pluginStatus:He,pluginURL:st}))}let Gt=new za,cn=function(){return He},on=function(){if(He!==ot||!st)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");He=ct,Ot(),st&&Fa({url:st},t=>{t?pt(t):(He=at,Ot())})},Rn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>He===at||Rn.applyArabicShaping!=null,isLoading:()=>He===ct,setState(t){He=t.pluginStatus,st=t.pluginURL},isParsed:()=>Rn.applyArabicShaping!=null&&Rn.processBidirectionalText!=null&&Rn.processStyledBidirectionalText!=null,getPluginURL:()=>st};class Bt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(let u of n)if(!Re(u.charCodeAt(0),a))return!1;return!0}(e,Rn.isLoaded())}}class Dn{constructor(e,n,a,u){this.property=e,this.value=n,this.expression=function(d,p,_,y){if(h(d))return new q(d,p);if(N(d)||Array.isArray(d)&&d.length>0){let b=H(d,p,_,y);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=d;return typeof d=="string"&&p.type==="color"&&(b=bn.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(n===void 0?e.specification.default:n,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class Gn{constructor(e,n,a){this.property=e,this.value=new Dn(e,void 0,n,a)}transitioned(e,n){return new tn(this.property,this.value,n,fi({},e.transition,this.transition),e.now)}untransitioned(){return new tn(this.property,this.value,null,{},0)}}class kn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Ho(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Gn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Dn(this._values[e].property,n===null?void 0:Ho(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let a=this._properties.properties;if(e)for(let u in e){let d=e[u];if(vu(u,"-transition")){let p=u.slice(0,-11);a[p]&&this.setTransition(p,d)}else a.hasOwnProperty(u)&&this.setValue(u,d)}}getTransition(e){return Ho(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Gn(this._values[e].property)),this._values[e].transition=Ho(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){let a=new Vt(this._properties);for(let u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,n._values[u]);return a}untransitioned(){let e=new Vt(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class tn{constructor(e,n,a,u,d){let p=u.delay||0,_=u.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+p,this.end=this.begin+_,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let u=e.now||0,d=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return p.possiblyEvaluate(e,n,a);{let _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),d,Rp(_))}}return d}}class Vt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let u=new un(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,n,a);return u}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Ho(this._values[e].value)}setValue(e,n){this._values[e]=new Dn(this._values[e].property,n===null?void 0:Ho(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let u=new un(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,n,a);return u}}class Jn{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,u){return this.property.evaluate(this.value,this.parameters,e,n,a,u)}}class un{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Be{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let u=wd[this.specification.type];return u?u(e,n,a):e}}class ut{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,u){return new Jn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,u)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Jn(this,{kind:"constant",value:void 0},e.parameters);let u=wd[this.specification.type];return u?new Jn(this,{kind:"constant",value:u(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,u,d,p){return e.kind==="constant"?e.value:e.evaluate(n,a,u,d,p)}}class Br{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,u){return!!e.expression.evaluate(n,null,{},a,u)}interpolate(){return!1}}class On{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Bt(0,{});for(let a in e){let u=e[a];u.specification.overridable&&this.overridableProperties.push(a);let d=this.defaultPropertyValues[a]=new Dn(u,void 0),p=this.defaultTransitionablePropertyValues[a]=new Gn(u);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(n)}}}J(ut,"DataDrivenProperty"),J(Be,"DataConstantProperty"),J(Br,"ColorRampProperty");var Te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Fi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function mi(t){if(Array.isArray(t))return t.map(mi);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=mi(t[n]);return e}return Fi(t)}function $r(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!$r(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ci(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$r(t)||(t=Yo(t));let n=t,a=!0;try{a=function(b){if(!Yi(b))return b;let T=mi(b);return ho(T),T=ji(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let u=Te[`filter_${e}`],d=B(a,u),p=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));p=(b,T,I)=>d.value.evaluate(b,T,{},I);let _=null,y=null;if(a!==n){let b=B(n,u);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,I,D,R,O)=>b.value.evaluate(T,I,{},D,void 0,void 0,R,O),y=!Js(b.value.expression)}return{filter:p,dynamicFilter:_||void 0,needGeometry:ms(a),needFeature:!!y}}function ji(t){if(!Array.isArray(t))return t;let e=function(n){if(ea.has(n[0])){for(let a=1;a<n.length;a++)if(Yi(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>ji(n))}function ho(t){let e=!1,n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||Yi(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Yi(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Yi(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)ho(t[a])}function Yi(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Yi(t[n]))return!0;return!1}let ea=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ta(t,e){return t<e?-1:t>e?1:0}function ms(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(ms(t[e]))return!0;return!1}function Yo(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?gs(t[1],t[2],"=="):e==="!="?ic(gs(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?gs(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Yo))):e==="all"?["all"].concat(t.slice(1).map(Yo)):e==="none"?["all"].concat(t.slice(1).map(Yo).map(ic)):e==="in"?rc(t[1],t.slice(2)):e==="!in"?ic(rc(t[1],t.slice(2))):e==="has"?Qu(t[1]):e!=="!has"||ic(Qu(t[1]));var n}function gs(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function rc(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(ta)]]:["filter-in-small",t,["literal",e]]}}function Qu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ic(t){return["!",t]}let oc="";function Vd(t,e){return e?`${t}${oc}${e}`:t}let jd="-transition",Za=new Set(["fill","line","background","hillshade","raster"]);class gi extends za{constructor(e,n,a,u,d){if(super(),this.id=e.id,this.fqid=Vd(this.id,a),this.type=e.type,this.scope=a,this.lut=u,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Xn(n.layout,this.scope,d),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new kn(n.paint,this.scope,d);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new un(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Za.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return vu(e,jd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let a=this._transitionablePaint,u=a._properties.properties;if(vu(e,jd)){let I=e.slice(0,-11);return u[I]&&a.setTransition(I,n||void 0),!1}if(!u[e])return!1;let d=a._values[e],p=d.value.isDataDriven(),_=d.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,b=y.isDataDriven(),T=vu(e,"pattern")||e==="line-dasharray";return b||p||T||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return ka({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof Jn&&Bd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ci(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,u,d,p,_,y,b){}queryIntersectsMatchingFeature(e,n,a,u){}}let Dm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fy{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class or{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Mn(t,e=1){let n=0,a=0;return{members:t.map(u=>{let d=Dm[u.type].BYTES_PER_ELEMENT,p=n=zI(n,Math.max(e,d)),_=u.components||1;return a=Math.max(a,d),n+=d*_,{name:u.name,type:u.type,components:_,offset:p}}),size:zI(n,Math.max(a,e)),alignment:e}}function zI(t,e){return Math.ceil(t/e)*e}class _s extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let u=2*e;return this.int16[u+0]=n,this.int16[u+1]=a,e}}_s.prototype.bytesPerElement=4,J(_s,"StructArrayLayout2i4");class Ny extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){let d=3*e;return this.int16[d+0]=n,this.int16[d+1]=a,this.int16[d+2]=u,e}}Ny.prototype.bytesPerElement=6,J(Ny,"StructArrayLayout3i6");class sc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){let p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=u,this.int16[p+3]=d,e}}sc.prototype.bytesPerElement=8,J(sc,"StructArrayLayout4i8");class db extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){let _=5*e;return this.int16[_+0]=n,this.int16[_+1]=a,this.int16[_+2]=u,this.int16[_+3]=d,this.int16[_+4]=p,e}}db.prototype.bytesPerElement=10,J(db,"StructArrayLayout5i10");class fb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,d,p,_)}emplace(e,n,a,u,d,p,_,y){let b=6*e,T=12*e,I=3*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.uint8[T+4]=u,this.uint8[T+5]=d,this.uint8[T+6]=p,this.uint8[T+7]=_,this.float32[I+2]=y,e}}fb.prototype.bytesPerElement=12,J(fb,"StructArrayLayout2i4ub1f12");class ac extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){let p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=u,this.float32[p+3]=d,e}}ac.prototype.bytesPerElement=16,J(ac,"StructArrayLayout4f16");class lc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){let d=3*e;return this.float32[d+0]=n,this.float32[d+1]=a,this.float32[d+2]=u,e}}lc.prototype.bytesPerElement=12,J(lc,"StructArrayLayout3f12");class cc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){let _=6*e,y=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=a,this.uint16[_+2]=u,this.uint16[_+3]=d,this.float32[y+2]=p,e}}cc.prototype.bytesPerElement=12,J(cc,"StructArrayLayout4ui1f12");class zy extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){let p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=u,this.uint16[p+3]=d,e}}zy.prototype.bytesPerElement=8,J(zy,"StructArrayLayout4ui8");class By extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,u,d,p)}emplace(e,n,a,u,d,p,_){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=d,this.int16[y+4]=p,this.int16[y+5]=_,e}}By.prototype.bytesPerElement=12,J(By,"StructArrayLayout6i12");class pb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_,y,b,T,I,D){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,u,d,p,_,y,b,T,I,D)}emplace(e,n,a,u,d,p,_,y,b,T,I,D,R){let O=12*e;return this.int16[O+0]=n,this.int16[O+1]=a,this.int16[O+2]=u,this.int16[O+3]=d,this.uint16[O+4]=p,this.uint16[O+5]=_,this.uint16[O+6]=y,this.uint16[O+7]=b,this.int16[O+8]=T,this.int16[O+9]=I,this.int16[O+10]=D,this.int16[O+11]=R,e}}pb.prototype.bytesPerElement=24,J(pb,"StructArrayLayout4i4ui4i24");class mb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,u,d,p)}emplace(e,n,a,u,d,p,_){let y=10*e,b=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=u,this.float32[b+2]=d,this.float32[b+3]=p,this.float32[b+4]=_,e}}mb.prototype.bytesPerElement=20,J(mb,"StructArrayLayout3i3f20");class gb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}gb.prototype.bytesPerElement=4,J(gb,"StructArrayLayout1ul4");class Ju extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Ju.prototype.bytesPerElement=4,J(Ju,"StructArrayLayout1f4");class uc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=a,e}}uc.prototype.bytesPerElement=4,J(uc,"StructArrayLayout2ui4");class _b extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_,y,b,T,I,D,R){let O=this.length;return this.resize(O+1),this.emplace(O,e,n,a,u,d,p,_,y,b,T,I,D,R)}emplace(e,n,a,u,d,p,_,y,b,T,I,D,R,O){let F=20*e,z=10*e;return this.int16[F+0]=n,this.int16[F+1]=a,this.int16[F+2]=u,this.int16[F+3]=d,this.int16[F+4]=p,this.float32[z+3]=_,this.float32[z+4]=y,this.float32[z+5]=b,this.float32[z+6]=T,this.int16[F+14]=I,this.uint32[z+8]=D,this.uint16[F+18]=R,this.uint16[F+19]=O,e}}_b.prototype.bytesPerElement=40,J(_b,"StructArrayLayout5i4f1i1ul2ui40");class Vy extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,d,p,_)}emplace(e,n,a,u,d,p,_,y){let b=8*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+4]=d,this.int16[b+5]=p,this.int16[b+6]=_,this.int16[b+7]=y,e}}Vy.prototype.bytesPerElement=16,J(Vy,"StructArrayLayout3i2i2i16");class yb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){let _=4*e,y=8*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=u,this.int16[y+6]=d,this.int16[y+7]=p,e}}yb.prototype.bytesPerElement=16,J(yb,"StructArrayLayout2f1f2i16");class vb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){let p=12*e,_=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=a,this.float32[_+1]=u,this.float32[_+2]=d,e}}vb.prototype.bytesPerElement=12,J(vb,"StructArrayLayout2ub2f12");class Zr extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){let d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=a,this.uint16[d+2]=u,e}}Zr.prototype.bytesPerElement=6,J(Zr,"StructArrayLayout3ui6");class xb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j,X,Y,K,le){let se=this.length;return this.resize(se+1),this.emplace(se,e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j,X,Y,K,le)}emplace(e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j,X,Y,K,le,se){let pe=30*e,_e=15*e,Ee=60*e;return this.int16[pe+0]=n,this.int16[pe+1]=a,this.int16[pe+2]=u,this.float32[_e+2]=d,this.float32[_e+3]=p,this.uint16[pe+8]=_,this.uint16[pe+9]=y,this.uint32[_e+5]=b,this.uint32[_e+6]=T,this.uint32[_e+7]=I,this.uint16[pe+16]=D,this.uint16[pe+17]=R,this.uint16[pe+18]=O,this.float32[_e+10]=F,this.float32[_e+11]=z,this.uint8[Ee+48]=j,this.uint8[Ee+49]=X,this.uint8[Ee+50]=Y,this.uint32[_e+13]=K,this.int16[pe+28]=le,this.uint8[Ee+58]=se,e}}xb.prototype.bytesPerElement=60,J(xb,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class bb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We,Je){let Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We,Je)}emplace(e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We,Je,Ze){let ht=22*e,Ye=44*e,tt=88*e;return this.float32[ht+0]=n,this.float32[ht+1]=a,this.int16[Ye+4]=u,this.int16[Ye+5]=d,this.int16[Ye+6]=p,this.int16[Ye+7]=_,this.int16[Ye+8]=y,this.int16[Ye+9]=b,this.int16[Ye+10]=T,this.int16[Ye+11]=I,this.int16[Ye+12]=D,this.uint16[Ye+13]=R,this.uint16[Ye+14]=O,this.uint16[Ye+15]=F,this.uint16[Ye+16]=z,this.uint16[Ye+17]=j,this.uint16[Ye+18]=X,this.uint16[Ye+19]=Y,this.uint16[Ye+20]=K,this.uint16[Ye+21]=le,this.uint16[Ye+22]=se,this.uint16[Ye+23]=pe,this.uint16[Ye+24]=_e,this.uint16[Ye+25]=Ee,this.uint16[Ye+26]=Oe,this.uint16[Ye+27]=De,this.uint32[ht+14]=Ne,this.float32[ht+15]=Xe,this.float32[ht+16]=Le,this.float32[ht+17]=qe,this.float32[ht+18]=ke,this.float32[ht+19]=We,this.float32[ht+20]=Je,this.uint8[tt+84]=Ze,e}}bb.prototype.bytesPerElement=88,J(bb,"StructArrayLayout2f9i15ui1ul6f1ub88");class eh extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,u,d)}emplace(e,n,a,u,d,p){let _=5*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=u,this.float32[_+3]=d,this.float32[_+4]=p,e}}eh.prototype.bytesPerElement=20,J(eh,"StructArrayLayout5f20");class wb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,d,p,_)}emplace(e,n,a,u,d,p,_,y){let b=7*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=u,this.float32[b+3]=d,this.float32[b+4]=p,this.float32[b+5]=_,this.float32[b+6]=y,e}}wb.prototype.bytesPerElement=28,J(wb,"StructArrayLayout7f28");class Ud extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let u=2*e;return this.float32[u+0]=n,this.float32[u+1]=a,e}}Ud.prototype.bytesPerElement=8,J(Ud,"StructArrayLayout2f8");class Eb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,u)}emplace(e,n,a,u,d){let p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=u,this.uint16[p+4]=d,e}}Eb.prototype.bytesPerElement=12,J(Eb,"StructArrayLayout1ul3ui12");class Mm extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Mm.prototype.bytesPerElement=2,J(Mm,"StructArrayLayout1ui2");class Tb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z){let j=this.length;return this.resize(j+1),this.emplace(j,e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z)}emplace(e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j){let X=16*e;return this.float32[X+0]=n,this.float32[X+1]=a,this.float32[X+2]=u,this.float32[X+3]=d,this.float32[X+4]=p,this.float32[X+5]=_,this.float32[X+6]=y,this.float32[X+7]=b,this.float32[X+8]=T,this.float32[X+9]=I,this.float32[X+10]=D,this.float32[X+11]=R,this.float32[X+12]=O,this.float32[X+13]=F,this.float32[X+14]=z,this.float32[X+15]=j,e}}Tb.prototype.bytesPerElement=64,J(Tb,"StructArrayLayout16f64");class jy extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,d,p,_)}emplace(e,n,a,u,d,p,_,y){let b=10*e,T=5*e;return this.uint16[b+0]=n,this.uint16[b+1]=a,this.uint16[b+2]=u,this.uint16[b+3]=d,this.float32[T+2]=p,this.float32[T+3]=_,this.float32[T+4]=y,e}}jy.prototype.bytesPerElement=20,J(jy,"StructArrayLayout4ui3f20");class Sb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Sb.prototype.bytesPerElement=2,J(Sb,"StructArrayLayout1i2");class Cb extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Cb.prototype.bytesPerElement=1,J(Cb,"StructArrayLayout1ub1");class BI extends Fy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}BI.prototype.size=40;class Ib extends _b{get(e){return new BI(this,e)}}J(Ib,"CollisionBoxArray");class VI extends Fy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}VI.prototype.size=60;class jI extends xb{get(e){return new VI(this,e)}}J(jI,"PlacedSymbolArray");class UI extends Fy{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}UI.prototype.size=88;class $I extends bb{get(e){return new UI(this,e)}}J($I,"SymbolInstanceArray");class GI extends Ju{getoffsetX(e){return this.float32[1*e+0]}}J(GI,"GlyphOffsetArray");class HI extends _s{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}J(HI,"SymbolLineVertexArray");class qI extends Fy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qI.prototype.size=12;class WI extends Eb{get(e){return new qI(this,e)}}J(WI,"FeatureIndexArray");class ZI extends uc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}J(ZI,"FillExtrusionCentroidArray");let W3=Mn([{name:"a_pos",components:2,type:"Int16"}],4),Z3=Mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,u){let d=this.segments[this.segments.length-1];return e>fr.MAX_VERTEX_ARRAY_LENGTH&&Sr(`Max vertices per segment is ${fr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>fr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}prepareSegment(e,n,a,u){return this._prepareSegment(e,n.length,a.length,u)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,u){return new fr([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function XI(t,e){return 256*(t=Qt(Math.floor(t),0,255))+Qt(Math.floor(e),0,255)}fr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,J(fr,"SegmentVector");let X3=Mn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Y3=Mn([{name:"a_dash",components:4,type:"Uint16"}]);class Am{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,u){this.ids.push(YI(e)),this.positions.push(n,a,u)}eachPosition(e,n){let a=YI(e),u=0,d=this.ids.length-1;for(;u<d;){let p=u+d>>1;this.ids[p]>=a?d=p:u=p+1}for(;this.ids[u]===a;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){let a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Db(a,u,0,a.length-1),n&&(n.add(a.buffer),n.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){let n=new Am,a;n.ids=e.ids,n.positions=e.positions;for(let u of n.ids)u!==a&&n.uniqueIds.push(u),a=u;return n.indexed=!0,n}}function YI(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Hl(String(t))}function Db(t,e,n,a){for(;n<a;){let u=t[n+a>>1],d=n-1,p=a+1;for(;;){do d++;while(t[d]<u);do p--;while(t[p]>u);if(d>=p)break;Uy(t,d,p),Uy(e,3*d,3*p),Uy(e,3*d+1,3*p+1),Uy(e,3*d+2,3*p+2)}p-n<a-p?(Db(t,e,n,p),n=p+1):(Db(t,e,p+1,a),a=p)}}function Uy(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}J(Am,"FeaturePositionMap");class Xa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class $y extends Xa{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Ui extends Xa{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ya extends Xa{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Mb extends Xa{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Ab extends Xa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class KI extends Xa{constructor(e){super(e),this.current=bn.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let K3=new Float32Array(16);class Pm extends Xa{constructor(e){super(e),this.current=K3}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let Q3=new Float32Array(9),J3=new Float32Array(4);class Pb extends Xa{constructor(e){super(e),this.current=J3}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Rb(t){return[XI(255*t.r,255*t.g),XI(255*t.b,255*t.a)]}class Rm{constructor(e,n,a,u){this.value=e,this.uniformNames=n.map(d=>`u_${d}`),this.type=a,this.context=u}setUniform(e,n,a,u,d){let p=u.constantOr(this.value);n.set(e,d,p instanceof bn?p.toRenderColor(this.context.lut):p)}getBinding(e,n){return this.type==="color"?new KI(e):new Ui(e)}}class $d{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,u,d){let p=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,d,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Ab(e):new Ui(e)}}class Ka{constructor(e,n,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,a,u,d,p,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new Bt(0,{brightness:p}),n,{},d,u,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b,this.context)}updatePaintArray(e,n,a,u,d,p,_){let y=this.expression.evaluate({zoom:0,brightness:_},a,u,void 0,d);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,a,u){if(this.type==="color"){let d=Rb(a.toRenderColor(u.lut));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,d[0],d[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ys{constructor(e,n,a,u,d,p){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=u,this.context=d,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,u,d,p,_){let y=this.expression.evaluate(new Bt(this.context.zoom,{brightness:p}),n,{},d,u,_),b=this.expression.evaluate(new Bt(this.context.zoom+1,{brightness:p}),n,{},d,u,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,b,this.context)}updatePaintArray(e,n,a,u,d,p,_){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:_},a,u,void 0,d),b=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},a,u,void 0,d);this._setPaintValue(e,n,y,b,this.context)}_setPaintValue(e,n,a,u,d){if(this.type==="color"){let p=Rb(a.toRenderColor(d.lut)),_=Rb(a.toRenderColor(d.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,p[0],p[1],_[0],_[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,u,d){let p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=Qt(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,d,_)}getBinding(e,n){return new Ui(e)}}class hc{constructor(e,n,a,u,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?Y3:X3).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new u}populatePaintArray(e,n,a,u){let d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,u,d,p,_){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,u){if(!u||!a)return;let d=u[a];if(!d)return;let{tl:p,br:_,pixelRatio:y}=d;for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,p[0],p[1],_[0],_[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class th{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;let u=[];for(let d in e.paint._values){let p=e.paint.get(d);if(!a(d)||!(p instanceof Jn&&Bd(p.property.specification)))continue;let _=tz(d,e.type),y=p.value,b=p.property.specification.type,T=!!p.property.useIntegerZoom,I=d==="line-dasharray"||d.endsWith("pattern"),D=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||D)if(y.kind==="source"||D||I){let R=QI(d,b,"source");this.binders[d]=I?new hc(y,_,b,R,e.id):new Ka(y,_,b,R),u.push(`/a_${d}`)}else{let R=QI(d,b,"composite");this.binders[d]=new ys(y,_,b,T,n,R),u.push(`/z_${d}`)}else this.binders[d]=I?new $d(y.value,_):new Rm(y.value,_,b,n),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Ka||n instanceof ys?n.maxValue:0}populatePaintArrays(e,n,a,u,d,p,_){for(let y in this.binders){let b=this.binders[y];b.context=this.context,(b instanceof Ka||b instanceof ys||b instanceof hc)&&b.populatePaintArray(e,n,a,u,d,p,_)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof $d&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,u,d,p,_,y){let b=!1,T=Object.keys(e),I=T.length!==0,D=I?T:n.uniqueIds;this.context.lut=d.lut;for(let R in this.binders){let O=this.binders[R];if(O.context=this.context,(O instanceof Ka||O instanceof ys||O instanceof hc)&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){let F=d.paint.get(R);O.expression=F.value;for(let z of D){let j=e[z.toString()];n.eachPosition(z,(X,Y,K)=>{let le=u.feature(X);O.updatePaintArray(Y,K,le,j,p,_,y)})}if(!I)for(let z of a.uniqueIds){let j=e[z.toString()];a.eachPosition(z,(X,Y,K)=>{let le=u.feature(X);O.updatePaintArray(Y,K,le,j,p,_,y)})}b=!0}}return b}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof Rm||a instanceof $d)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Ka||a instanceof ys||a instanceof hc)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Rm||a instanceof $d||a instanceof ys)for(let u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let u=this.binders[a];if(u instanceof Rm||u instanceof $d||u instanceof ys)for(let d of u.uniformNames)n.push({name:d,property:a,binding:u.getBinding(e,d)})}return n}setUniforms(e,n,a,u,d){for(let{name:p,property:_,binding:y}of a)this.binders[_].setUniform(e,y,d,u.get(_),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Ka||n instanceof ys||n instanceof hc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof Ka||a instanceof ys||a instanceof hc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Ka||n instanceof ys||n instanceof hc)&&n.destroy()}}}class dc{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let u of e)this.programConfigurations[u.id]=new th(u,n,a);this.needsUpload=!1,this._featureMap=new Am,this._featureMapWithoutIds=new Am,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,u,d,p,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,u,d,p,_,y);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,u,d,p){for(let _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,_,u,d,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let ez={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function tz(t,e){return ez[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let nz={"line-pattern":{source:cc,composite:cc},"fill-pattern":{source:cc,composite:cc},"fill-extrusion-pattern":{source:cc,composite:cc},"line-dasharray":{source:zy,composite:zy}},rz={color:{source:Ud,composite:ac},number:{source:Ju,composite:Ud}};function QI(t,e,n){let a=nz[t];return a&&a[n]||rz[e][n]}J(Rm,"ConstantBinder"),J($d,"PatternConstantBinder"),J(Ka,"SourceExpressionBinder"),J(hc,"PatternCompositeBinder"),J(ys,"CompositeExpressionBinder"),J(th,"ProgramConfiguration",{omit:["_buffers"]}),J(dc,"ProgramConfigurationSet");let $i=it/Math.PI/2,Ob=5,JI=6,iz=16383,Gd=64,kb=[Gd,32,16],Ko=-$i,Qo=$i;function Hd(t,e,n,a=$i){return n=ln(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function nh(t,e,n){return Hd(Math.cos(ln(t)),Math.sin(ln(t)),e,n)}let qd=63710088e-1,Lb=2*Math.PI*qd;class vn{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vn(Oa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,u=e.lat*n,d=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return qd*Math.acos(Math.min(d,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new fc({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return nh(this.lat,this.lng,$i+e*$i/qd)}static convert(e){if(e instanceof vn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new vn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new vn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class fc{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof vn?new vn(e.lng,e.lat):vn.convert(e),this}setSouthWest(e){return this._sw=e instanceof vn?new vn(e.lng,e.lat):vn.convert(e),this}extend(e){let n=this._sw,a=this._ne,u,d;if(e instanceof vn)u=e,d=e;else{if(!(e instanceof fc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(fc.convert(e)):this.extend(vn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(vn.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return n||a?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new vn(u.lng,u.lat),this._ne=new vn(d.lng,d.lat)),this}getCenter(){return new vn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vn(this.getWest(),this.getNorth())}getSouthEast(){return new vn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=vn.convert(e),u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof fc?e:new fc(e)}}var eD={};(function(t,e){(function(n){function a(d,p,_){var y=u(256*d,256*(p=Math.pow(2,_)-p-1),_),b=u(256*(d+1),256*(p+1),_);return y[0]+","+y[1]+","+b[0]+","+b[1]}function u(d,p,_){var y=2*Math.PI*6378137/256/Math.pow(2,_);return[d*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}n.getURL=function(d,p,_,y,b,T){return T=T||{},d+"?"+["bbox="+a(_,y,b),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+p].join("&")},n.getTileBBox=a,n.getMercCoords=u,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,eD);var oz=eD;class rh{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=Om(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=oz.getTileBBox(this.x,this.y,this.z),u=function(d,p,_){let y,b="";for(let T=d;T>0;T--)y=1<<T-1,b+=(p&y?1:0)+(_&y?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tD{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Om(e,n.z,n.z,n.x,n.y)}}class Vr{constructor(e,n,a,u,d){this.overscaledZ=e,this.wrap=n,this.canonical=new rh(a,+u,+d),this.key=n===0&&e===a?this.canonical.key:Om(n,e,a,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Vr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Om(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return Om(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Vr(n,this.wrap,n,a,u),new Vr(n,this.wrap,n,a+1,u),new Vr(n,this.wrap,n,a,u+1),new Vr(n,this.wrap,n,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Vr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tD(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Om(t,e,n,a,u){let d=1<<Math.min(n,22),p=d*(u%d)+a%d;return t&&n<22&&(p+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}let sz=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Vr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Vr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Vr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Vr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];J(rh,"CanonicalTileID"),J(Vr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let az=0,lz=25.5;function Fb(t){return Lb*Math.cos(t*Math.PI/180)}function na(t){return(180+t)/360}function ra(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Gi(t,e){return t/Fb(e)}function Ki(t){return 360*t-180}function ri(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function nD(t,e){return t*Fb(ri(e))}let Ir=85.051129;function rD(t){return Math.cos(ln(Qt(t,-Ir,Ir)))}function ih(t,e){let n=Qt(e,az,lz),a=Math.pow(2,n);return rD(t)*Lb/(512*a)}function iD(t){return 1/Math.cos(t*Math.PI/180)}function Gy(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/it)/(1<<t.z)*2));return 80150034*n/(n*n+1)/it/(1<<t.z)}class Ii{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=vn.convert(e);return new Ii(na(a.lng),ra(a.lat),Gi(n,a.lat))}toLngLat(){return new vn(Ki(this.x),ri(this.y))}toAltitude(){return nD(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Lb*iD(ri(this.y))}}function Nb(t,e,n,a,u,d,p,_,y){let b=(e+a)/2,T=(n+u)/2,I=new lt(b,T);_(I),function(D,R,O,F,z,j){let X=O-z,Y=F-j;return Math.abs((F-R)*X-(O-D)*Y)/Math.hypot(X,Y)}(I.x,I.y,d.x,d.y,p.x,p.y)>=y?(Nb(t,e,n,b,T,d,I,_,y),Nb(t,b,T,a,u,I,p,_,y)):t.push(p)}function oD(t,e,n){let a=t[0],u=a.x,d=a.y;e(a);let p=[a];for(let _=1;_<t.length;_++){let y=t[_],{x:b,y:T}=y;e(y),Nb(p,u,d,b,T,a,y,e,n),u=b,d=T,a=y}return p}function zb(t,e,n,a){if(a(e,n)){let u=e.add(n)._mult(.5);zb(t,e,u,a),zb(t,u,n,a)}else t.push(n)}function cz(t,e){let n=t[0],a=[n];for(let u=1;u<t.length;u++){let d=t[u];zb(a,n,d,e),n=d}return a}let Bb=Math.pow(2,14)-1,sD=-Bb-1;function uz(t,e){let n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=Qt(n,sD,Bb),t.y=Qt(a,sD,Bb),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&Sr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function vs(t,e,n){let a=t.loadGeometry(),u=t.extent,d=it/u;if(e&&n&&n.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:_,x:y,y:b,projection:T}=n,I=D=>{let R=Ki((e.x+D.x/u)/p),O=ri((e.y+D.y/u)/p),F=T.project(R,O);D.x=(F.x*_-y)*u,D.y=(F.y*_-b)*u};for(let D=0;D<a.length;D++)if(t.type!==1)a[D]=oD(a[D],I,1);else{let R=[];for(let O of a[D])O.x<0||O.x>=u||O.y<0||O.y>=u||(I(O),R.push(O));a[D]=R}}for(let p of a)for(let _ of p)uz(_,d);return a}function Qa(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?vs(t):[]}}function Hy(t,e,n,a,u){t.emplaceBack(2*e+(a+1)/2,2*n+(u+1)/2)}function qy(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Vb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new _s,this.indexArray=new Zr,this.segments=new fr,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,u){let d=this.layers[0],p=[],_=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(let{feature:b,id:T,index:I,sourceLayerIndex:D}of e){let R=this.layers[0]._featureFilter.needGeometry,O=Qa(b,R);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),O,a))continue;let F=_?_.evaluate(O,{},a):void 0,z={id:T,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:R?O.geometry:vs(b,a,u),patterns:{},sortKey:F};p.push(z)}_&&p.sort((b,T)=>b.sortKey-T.sortKey);let y=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new By,y=u.projection);for(let b of p){let{geometry:T,index:I,sourceLayerIndex:D}=b,R=e[I].feature;this.addFeature(b,T,I,n.availableImages,a,y,n.brightness),n.featureIndex.insert(R,T,I,D,this.index)}}update(e,n,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,W3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Z3.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,u,d,p,_){for(let y of n)for(let b of y){let T=b.x,I=b.y;if(T<0||T>=it||I<0||I>=it)continue;if(p){let O=p.projectTilePoint(T,I,d),F=p.upVector(d,T,I),z=this.globeExtVertexArray;qy(z,O,F),qy(z,O,F),qy(z,O,F),qy(z,O,F)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=D.vertexLength;Hy(this.layoutVertexArray,T,I,-1,-1),Hy(this.layoutVertexArray,T,I,1,-1),Hy(this.layoutVertexArray,T,I,1,1),Hy(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,d,_)}}function jb(t,e){for(let n=0;n<t.length;n++)if(pc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(pc(t,e[n]))return!0;return!!Ub(t,e)}function hz(t,e,n){return!!pc(t,e)||!!$b(e,t,n)}function aD(t,e){if(t.length===1)return cD(e,t[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let u=0;u<a.length;u++)if(pc(t,a[u]))return!0}for(let n=0;n<t.length;n++)if(cD(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ub(t,e[n]))return!0;return!1}function dz(t,e,n){if(t.length>1){if(Ub(t,e))return!0;for(let a=0;a<e.length;a++)if($b(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if($b(t[a],e,n))return!0;return!1}function Ub(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let a=t[n],u=t[n+1];for(let d=0;d<e.length-1;d++)if(fz(a,u,e[d],e[d+1]))return!0}return!1}function fz(t,e,n,a){return qo(t,n,a)!==qo(e,n,a)&&qo(t,e,n)!==qo(t,e,a)}function $b(t,e,n){let a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(lD(t,e[u-1],e[u])<a)return!0;return!1}function lD(t,e,n){let a=e.distSqr(n);if(a===0)return t.distSqr(e);let u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function cD(t,e){let n,a,u,d=!1;for(let p=0;p<t.length;p++){n=t[p];for(let _=0,y=n.length-1;_<n.length;y=_++)a=n[_],u=n[y],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(d=!d)}return d}function pc(t,e){let n=!1;for(let a=0,u=t.length-1;a<t.length;u=a++){let d=t[a],p=t[u];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(n=!n)}return n}function uD(t,e,n,a,u){for(let p of t)if(e<=p.x&&n<=p.y&&a>=p.x&&u>=p.y)return!0;let d=[new lt(e,n),new lt(e,u),new lt(a,u),new lt(a,n)];if(t.length>2){for(let p of d)if(pc(t,p))return!0}for(let p=0;p<t.length-1;p++)if(pz(t[p],t[p+1],d))return!0;return!1}function pz(t,e,n){let a=n[0],u=n[2];if(t.x<a.x&&e.x<a.x||t.x>u.x&&e.x>u.x||t.y<a.y&&e.y<a.y||t.y>u.y&&e.y>u.y)return!1;let d=qo(t,e,n[0]);return d!==qo(t,e,n[1])||d!==qo(t,e,n[2])||d!==qo(t,e,n[3])}function Wd(t,e,n,a,u,d){let p=e.y-t.y,_=t.x-e.x;if(d=d||0){let y=p*p+_*_;if(y===0)return!0;let b=Math.sqrt(y);p/=b,_/=b}return!((n.x-t.x)*p+(n.y-t.y)*_-d<0||(a.x-t.x)*p+(a.y-t.y)*_-d<0||(u.x-t.x)*p+(u.y-t.y)*_-d<0)}function Gb(t,e,n,a,u,d,p){return!(Wd(t,e,a,u,d,p)||Wd(e,n,a,u,d,p)||Wd(n,t,a,u,d,p)||Wd(a,u,t,e,n,p)||Wd(u,d,t,e,n,p)||Wd(d,a,t,e,n,p))}function Zd(t,e,n){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Wy(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function hD(t,e,n,a,u){if(!e[0]&&!e[1])return t;let d=lt.convert(e)._mult(u);n==="viewport"&&d._rotate(-a);let p=[];for(let _=0;_<t.length;_++)p.push(t[_].sub(d));return p}function dD(t,e,n,a){let u=lt.convert(t)._mult(a);return e==="viewport"&&u._rotate(-n),u}J(Vb,"CircleBucket",{omit:["layers"]});let mz=new On({"circle-sort-key":new ut(Te.layout_circle["circle-sort-key"]),visibility:new Be(Te.layout_circle.visibility)});var gz={paint:new On({"circle-radius":new ut(Te.paint_circle["circle-radius"]),"circle-color":new ut(Te.paint_circle["circle-color"]),"circle-blur":new ut(Te.paint_circle["circle-blur"]),"circle-opacity":new ut(Te.paint_circle["circle-opacity"]),"circle-translate":new Be(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Be(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Be(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Be(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(Te.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Be(Te.paint_circle["circle-emissive-strength"])}),layout:mz};class Hb{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let u=r._.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;let d=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,n,a){if(r._.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[u,d,p]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],b=this.pos[2]-e[2],T=u*u+d*d+p*p,I=2*(_*u+y*d+b*p),D=I*I-4*T*(_*_+y*y+b*b-n*n);if(D<0){let R=Math.max(-I/2,0),O=_+u*R,F=y+d*R,z=b+p*R,j=Math.hypot(O,F,z);return a[0]=O*n/j,a[1]=F*n/j,a[2]=z*n/j,!1}{let R=(-I-Math.sqrt(D))/(2*T);if(R<0){let O=Math.hypot(_,y,b);return a[0]=_*n/O,a[1]=y*n/O,a[2]=b*n/O,!1}return a[0]=_+u*R,a[1]=y+d*R,a[2]=b+p*R,!0}}}class qb{constructor(e,n,a,u,d){this.TL=e,this.TR=n,this.BR=a,this.BL=u,this.horizon=d}static fromInvProjectionMatrix(e,n,a){let u=[-1,1,1],d=[1,1,1],p=[1,-1,1],_=[-1,-1,1],y=r._.transformMat4(u,u,e),b=r._.transformMat4(d,d,e),T=r._.transformMat4(p,p,e),I=r._.transformMat4(_,_,e);return new qb(y,b,T,I,n/a)}}function km(t,e,n){let a=1/0,u=-1/0,d=[];for(let p of t){r._.sub(d,p,e);let _=r._.dot(d,n);a=Math.min(a,_),u=Math.max(u,_)}return[a,u]}function fD(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){let u=t.planes[a],d=0;for(let p=0;p<e.length;p++)d+=r._.dot(u,e[p])+u[3]>=0;if(d===0)return 0;d!==e.length&&(n=!1)}return n?2:1}function pD(t,e){for(let n of t.projections){let a=km(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function mD(t,e){let n=0,a=[0,0,0,0];for(let u=0;u<t.length;u++)a[0]=t[u][0],a[1]=t[u][1],a[2]=t[u][2],a[3]=1,r.aA.dot(a,e)>=0&&n++;return n}class Wb{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=pr.fromPoints(this.points),this.projections=[],this.frustumEdges=[r._.sub([],this.points[2],this.points[3]),r._.sub([],this.points[0],this.points[3]),r._.sub([],this.points[4],this.points[0]),r._.sub([],this.points[5],this.points[1]),r._.sub([],this.points[6],this.points[2]),r._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let u=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:u,projection:km(this.points,this.points[0],u)}),this.projections.push({axis:d,projection:km(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,n,a,u){let d=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let T=r.aA.transformMat4([],b,e),I=1/T[3]/n*d;return r.aA.mul(T,T,[I,I,u?1/T[3]:I,I])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let T=r._.sub([],p[b[0]],p[b[1]]),I=r._.sub([],p[b[2]],p[b[1]]),D=r._.normalize([],r._.cross([],T,I)),R=-r._.dot(D,p[b[1]]);return D.concat(R)}),y=[];for(let b=0;b<p.length;b++)y.push([p[b][0],p[b][1],p[b][2]]);return new Wb(y,_)}intersectsPrecise(e,n,a){for(let u=0;u<n.length;u++)if(!mD(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!mD(e,this.planes[u]))return 0;for(let u of a)for(let d of this.frustumEdges){let p=r._.cross([],u,d),_=r._.length(p);if(_===0)continue;r._.scale(p,p,1/_);let y=km(this.points,this.points[0],p),b=km(e,this.points[0],p);if(y[0]>b[1]||b[0]>y[1])return 0}return 1}}class pr{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let u of e)r._.min(n,n,u),r._.max(a,a,u);return new pr(n,a)}static fromTileIdAndHeight(e,n,a){let u=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new pr([d/u,p/u,n],[(d+1)/u,(p+1)/u,a])}static applyTransform(e,n){let a=e.getCorners();for(let u=0;u<a.length;++u)r._.transformMat4(a[u],a[u],n);return pr.fromPoints(a)}static projectAabbCorners(e,n){let a=e.getCorners();for(let u=0;u<a.length;++u)r._.transformMat4(a[u],a[u],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=r._.scale([],r._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=r._.clone(this.min),u=r._.clone(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],u[d]=n[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new pr(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?fD(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?fD(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?pD(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?pD(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}J(pr,"Aabb");let _z=Mn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Zy}=_z,gD=Mn([{name:"a_pos_3",components:3,type:"Int16"}]);var Lm=Mn([{name:"a_pos",type:"Int16",components:2}]);function Xy(t){return t*$i/qd}let yz=[new pr([Ko,Ko,Ko],[Qo,Qo,Qo]),new pr([Ko,Ko,Ko],[0,0,Qo]),new pr([0,Ko,Ko],[Qo,0,Qo]),new pr([Ko,0,Ko],[0,Qo,Qo]),new pr([0,0,Ko],[Qo,Qo,Qo])];function _D(t,e,n,a=!0){let u=r._.scale([],t._camera.position,t.worldSize),d=[e,n,1,1];r.aA.transformMat4(d,d,t.pixelMatrixInverse),r.aA.scale(d,d,1/d[3]);let p=r._.sub([],d,u),_=r._.normalize([],p),y=t.globeMatrix,b=[y[12],y[13],y[14]],T=r._.sub([],b,u),I=r._.length(T),D=r._.normalize([],T),R=t.worldSize/(2*Math.PI),O=r._.dot(D,_),F=Math.asin(R/I);if(F<Math.acos(O)){if(!a)return null;let De=[],Ne=[];r._.scale(De,_,I/O),r._.normalize(Ne,r._.sub(Ne,De,T)),r._.normalize(_,r._.add(_,T,r._.scale(_,Ne,Math.tan(F)*I)))}let z=[];new Hb(u,_).closestPointOnSphere(b,R,z);let j=r._.normalize([],wu(y,0)),X=r._.normalize([],wu(y,1)),Y=r._.normalize([],wu(y,2)),K=r._.dot(j,z),le=r._.dot(X,z),se=r._.dot(Y,z),pe=di(Math.asin(-le/R)),_e=di(Math.atan2(K,se));_e=t.center.lng+function(De,Ne){let Xe=(Ne-De+180)%360-180;return Xe<-180?Xe+360:Xe}(t.center.lng,_e);let Ee=na(_e),Oe=Qt(ra(pe),0,1);return new Ii(Ee,Oe)}class vz{constructor(e,n,a){this.a=r._.sub([],e,a),this.b=r._.sub([],n,a),this.center=a;let u=r._.normalize([],this.a),d=r._.normalize([],this.b);this.angle=Math.acos(r._.dot(u,d))}}function Zb(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,u,d,p){let _=Math.sin(d);return a*(Math.sin((1-p)*d)/_)+u*(Math.sin(p*d)/_)}(t.a[e],t.b[e],t.angle,Qt(n,0,1))+t.center[e]}function ia(t){if(t.z<=1)return yz[t.z+2*t.y+t.x];let e=Xb(Yy(t));return pr.fromPoints(e)}function Ja(t,e,n){return r._.scale(t,t,1-n),r._.scaleAndAdd(t,t,e,n)}function yD(t,e){let n=el(e.zoom);if(n===0)return ia(t);let a=Yy(t),u=Xb(a),d=na(a.getWest())*e.worldSize,p=na(a.getEast())*e.worldSize,_=ra(a.getNorth())*e.worldSize,y=ra(a.getSouth())*e.worldSize,b=[d,_,0],T=[p,_,0],I=[d,y,0],D=[p,y,0],R=r.ad.invert([],e.globeMatrix);return r._.transformMat4(b,b,R),r._.transformMat4(T,T,R),r._.transformMat4(I,I,R),r._.transformMat4(D,D,R),u[0]=Ja(u[0],I,n),u[1]=Ja(u[1],D,n),u[2]=Ja(u[2],T,n),u[3]=Ja(u[3],b,n),pr.fromPoints(u)}function vD(t,e,n){for(let a of t)r._.transformMat4(a,a,e),r._.scale(a,a,n)}function xD(t,e,n,a){let u=e/t.worldSize,d=t.globeMatrix;if(n.z<=1){let Ee=ia(n).getCorners();return vD(Ee,d,u),pr.fromPoints(Ee)}let p=Yy(n,a),_=Xb(p,$i+Xy(t._tileCoverLift));vD(_,d,u);let y=Number.MAX_VALUE,b=[-y,-y,-y],T=[y,y,y];if(p.contains(t.center)){for(let De of _)r._.min(T,T,De),r._.max(b,b,De);b[2]=0;let Ee=t.point,Oe=[Ee.x*u,Ee.y*u,0];return r._.min(T,T,Oe),r._.max(b,b,Oe),new pr(T,b)}if(t._tileCoverLift>0){for(let Ee of _)r._.min(T,T,Ee),r._.max(b,b,Ee);return new pr(T,b)}let I=[d[12]*u,d[13]*u,d[14]*u],D=p.getCenter(),R=Qt(t.center.lat,-Ir,Ir),O=Qt(D.lat,-Ir,Ir),F=na(t.center.lng),z=ra(R),j=F-na(D.lng),X=z-ra(O);j>.5?j-=1:j<-.5&&(j+=1);let Y=0;if(Math.abs(j)>Math.abs(X))Y=j>=0?1:3;else{Y=X>=0?0:2;let Ee=[d[4]*u,d[5]*u,d[6]*u],Oe=-Math.sin(ln(X>=0?p.getSouth():p.getNorth()))*$i;r._.scaleAndAdd(I,I,Ee,Oe)}let K=_[Y],le=_[(Y+1)%4],se=new vz(K,le,I),pe=[Zb(se,0)||K[0],Zb(se,1)||K[1],Zb(se,2)||K[2]],_e=el(t.zoom);if(_e>0){let Ee=function({x:De,y:Ne,z:Xe},Le,qe,ke,We){let Je=1/(1<<Xe),Ze=De*Je,ht=Ze+Je,Ye=Ne*Je,tt=Ye+Je,Tt=0,yt=(Ze+ht)/2-ke;return yt>.5?Tt=-1:yt<-.5&&(Tt=1),Ze=((Ze+Tt)*Le-(ke*=Le))*qe+ke,ht=((ht+Tt)*Le-ke)*qe+ke,Ye=(Ye*Le-(We*=Le))*qe+We,tt=(tt*Le-We)*qe+We,[[Ze,tt,0],[ht,tt,0],[ht,Ye,0],[Ze,Ye,0]]}(n,e,t._pixelsPerMercatorPixel,F,z);for(let De=0;De<_.length;De++)Ja(_[De],Ee[De],_e);let Oe=r._.add([],Ee[Y],Ee[(Y+1)%4]);r._.scale(Oe,Oe,.5),Ja(pe,Oe,_e)}for(let Ee of _)r._.min(T,T,Ee),r._.max(b,b,Ee);return T[2]=Math.min(K[2],le[2]),r._.min(T,T,pe),r._.max(b,b,pe),new pr(T,b)}function Yy({x:t,y:e,z:n},a=!1){let u=1/(1<<n),d=new vn(Ki(t*u),e===(1<<n)-1&&a?-90:ri((e+1)*u)),p=new vn(Ki((t+1)*u),e===0&&a?90:ri(e*u));return new fc(d,p)}function Xb(t,e=$i){let n=ln(t.getNorth()),a=ln(t.getSouth()),u=Math.cos(n),d=Math.cos(a),p=Math.sin(n),_=Math.sin(a),y=t.getWest(),b=t.getEast();return[Hd(d,_,y,e),Hd(d,_,b,e),Hd(u,p,b,e),Hd(u,p,y,e)]}function Fm(t,e,n,a){let u=1<<n.z,d=(t/it+n.x)/u;return nh(ri((e/it+n.y)/u),Ki(d),a)}function Ky({min:t,max:e}){return iz/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let bD=new Float64Array(16);function Nm(t){let e=Ky(t),n=r.ad.fromScaling(bD,[e,e,e]);return r.ad.translate(n,n,r._.negate([],t.min))}function Yb(t){let e=r.ad.fromTranslation(bD,t.min),n=1/Ky(t);return r.ad.scale(e,e,[n,n,n])}function Kb(t){let e=it/(2*Math.PI);return t/(2*Math.PI)/e}function wD(t,e){return it/(512*Math.pow(2,t))*Ky(ia(e))}function ED(t,e,n,a,u){let d=Kb(n),p=[t,e,-n/(2*Math.PI)],_=r.ad.identity(new Float64Array(16));return r.ad.translate(_,_,p),r.ad.scale(_,_,[d,d,d]),r.ad.rotateX(_,_,ln(-u)),r.ad.rotateY(_,_,ln(-a)),_}function el(t){return Ra(Ob,JI,t)}function TD(t,e){let n=nh(e.lat,e.lng),a=function(d){let p=nh(d._center.lat,d._center.lng),_=r._.fromValues(0,1,0),y=r._.cross([],_,p),b=r.ad.fromRotation([],-d.angle,p);y=r._.transformMat4(y,y,b),r.ad.fromRotation(b,-d._pitch,y);let T=r._.normalize([],p);return r._.scale(T,T,Xy(d.cameraToCenterDistance/d.pixelsPerMeter)),r._.transformMat4(T,T,b),r._.add([],p,T)}(t),u=r._.subtract([],a,n);return r._.angle(u,n)}function Qb(t,e){return TD(t,e)>Math.PI/2*1.01}let SD=ln(85),xz=Math.cos(SD),bz=Math.sin(SD),wz=r.ad.create(),CD=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function ID(t,e,n,a,u,d,p,_,y){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(y*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,T=n.projection.upVectorScale(b,n.center.lat,n.worldSize).metersToTile;for(let I of e)for(let D of I){let R=D.add(_),O=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(R.x,R.y,!0):0,F=n.projection.projectTilePoint(R.x,R.y,b);if(O>0){let Y=n.projection.upVector(b,R.x,R.y);F.x+=Y[0]*T*O,F.y+=Y[1]*T*O,F.z+=Y[2]*T*O}let z=d?R:Ez(F.x,F.y,F.z,a),j=d?t.tilespaceRays.map(Y=>Sz(Y,O)):t.queryGeometry.screenGeometry,X=r.aA.transformMat4([],[F.x,F.y,F.z,1],a);if(!p&&d?y*=X[3]/n.cameraToCenterDistance:p&&!d&&(y*=n.cameraToCenterDistance/X[3]),d){let Y=ri((D.y/it+b.y)/(1<<b.z));y/=n.projection.pixelsPerMeter(Y,1)/Gi(1,Y)}if(hz(j,z,y))return!0}return!1}function Ez(t,e,n,a){let u=r.aA.transformMat4([],[t,e,n,1],a);return new lt(u[0]/u[3],u[1]/u[3])}let DD=r._.fromValues(0,0,0),Tz=r._.fromValues(0,0,1);function Sz(t,e){let n=r._.create();return DD[2]=e,t.intersectsPlane(DD,Tz,n),new lt(n[0],n[1])}class MD extends Vb{}function AD(t,{width:e,height:n},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=u,t}function PD(t,e,n){let{width:a,height:u}=e;a===t.width&&u===t.height||(Jb(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,u)},n,null),t.width=a,t.height=u,t.data=e.data)}function Jb(t,e,n,a,u,d,p,_){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,b=e.data,T=d===4&&_;for(let I=0;I<u.height;I++){let D=((n.y+I)*t.width+n.x)*d,R=((a.y+I)*e.width+a.x)*d;if(T)for(let O=0;O<u.width;O++){let F=D+O*d+3,z=R+O*d;b[z+0]=255,b[z+1]=255,b[z+2]=255,b[z+3]=y[F]}else if(p)for(let O=0;O<u.width;O++){let F=D+O*d,z=R+O*d,j=y[F+3],X=new bn(y[F+0]/255*j,y[F+1]/255*j,y[F+2]/255*j,j).toRenderColor(p).toArray();b[z+0]=X[0],b[z+1]=X[1],b[z+2]=X[2],b[z+3]=X[3]}else for(let O=0;O<u.width*d;O++)b[R+O]=y[D+O]}return e}J(MD,"HeatmapBucket",{omit:["layers"]});class mc{constructor(e,n){AD(this,e,1,n)}resize(e){PD(this,new mc(e),1)}clone(){return new mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,d){Jb(e,n,a,u,d,1,null)}}class Ao{constructor(e,n){AD(this,e,4,n)}resize(e){PD(this,new Ao(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,d,p,_){Jb(e,n,a,u,d,4,p,_)}}class RD{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}J(mc,"AlphaImage"),J(Ao,"RGBAImage");let Cz=new On({visibility:new Be(Te.layout_heatmap.visibility)});var Iz={paint:new On({"heatmap-radius":new ut(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Be(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Br(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Be(Te.paint_heatmap["heatmap-opacity"])}),layout:Cz};function zm(t){let e={},n=t.resolution||256,a=t.clips?t.clips.length:1,u=t.image||new Ao({width:n,height:a}),d=(p,_,y)=>{e[t.evaluationKey]=y;let b=t.expression.evaluate(e);b&&(u.data[p+_+0]=Math.floor(255*b.r/b.a),u.data[p+_+1]=Math.floor(255*b.g/b.a),u.data[p+_+2]=Math.floor(255*b.b/b.a),u.data[p+_+3]=Math.floor(255*b.a))};if(t.clips)for(let p=0,_=0;p<a;++p,_+=4*n)for(let y=0,b=0;y<n;y++,b+=4){let T=y/(n-1),{start:I,end:D}=t.clips[p];d(_,b,I*(1-T)+D*T)}else for(let p=0,_=0;p<n;p++,_+=4)d(0,_,p/(n-1));return u}let Dz=new On({visibility:new Be(Te.layout_hillshade.visibility)});var Mz={paint:new On({"hillshade-illumination-direction":new Be(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Be(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Be(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Be(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Be(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Be(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Be(Te.paint_hillshade["hillshade-emissive-strength"])}),layout:Dz};let Az=Mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pz}=Az;function Bm(t,e,n=2){let a=e&&e.length,u=a?e[0]*n:t.length,d=OD(t,0,u,n,!0),p=[];if(!d||d.next===d.prev)return p;let _,y,b;if(a&&(d=function(T,I,D,R){let O=[];for(let F=0,z=I.length;F<z;F++){let j=OD(T,I[F]*R,F<z-1?I[F+1]*R:T.length,R,!1);j===j.next&&(j.steiner=!0),O.push(Bz(j))}O.sort(Fz);for(let F=0;F<O.length;F++)D=Nz(O[F],D);return D}(t,e,d,n)),t.length>80*n){_=1/0,y=1/0;let T=-1/0,I=-1/0;for(let D=n;D<u;D+=n){let R=t[D],O=t[D+1];R<_&&(_=R),O<y&&(y=O),R>T&&(T=R),O>I&&(I=O)}b=Math.max(T-_,I-y),b=b!==0?32767/b:0}return Vm(d,p,n,_,y,b,0),p}function OD(t,e,n,a,u){let d;if(u===function(p,_,y,b){let T=0;for(let I=_,D=y-b;I<y;I+=b)T+=(p[D]-p[I])*(p[I+1]+p[D+1]),D=I;return T}(t,e,n,a)>0)for(let p=e;p<n;p+=a)d=FD(p/a|0,t[p],t[p+1],d);else for(let p=n-a;p>=e;p-=a)d=FD(p/a|0,t[p],t[p+1],d);return d&&Qy(d,d.next)&&(Um(d),d=d.next),d}function oh(t,e){if(!t)return t;e||(e=t);let n,a=t;do if(n=!1,a.steiner||!Qy(a,a.next)&&jr(a.prev,a,a.next)!==0)a=a.next;else{if(Um(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function Vm(t,e,n,a,u,d,p){if(!t)return;!p&&d&&function(y,b,T,I){let D=y;do D.z===0&&(D.z=ew(D.x,D.y,b,T,I)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==y);D.prevZ.nextZ=null,D.prevZ=null,function(R){let O,F=1;do{let z,j=R;R=null;let X=null;for(O=0;j;){O++;let Y=j,K=0;for(let se=0;se<F&&(K++,Y=Y.nextZ,Y);se++);let le=F;for(;K>0||le>0&&Y;)K!==0&&(le===0||!Y||j.z<=Y.z)?(z=j,j=j.nextZ,K--):(z=Y,Y=Y.nextZ,le--),X?X.nextZ=z:R=z,z.prevZ=X,X=z;j=Y}X.nextZ=null,F*=2}while(O>1)}(D)}(t,a,u,d);let _=t;for(;t.prev!==t.next;){let y=t.prev,b=t.next;if(d?Oz(t,a,u,d):Rz(t))e.push(y.i,t.i,b.i),Um(t),t=b.next,_=b.next;else if((t=b)===_){p?p===1?Vm(t=kz(oh(t),e),e,n,a,u,d,2):p===2&&Lz(t,e,n,a,u,d):Vm(oh(t),e,n,a,u,d,1);break}}}function Rz(t){let e=t.prev,n=t,a=t.next;if(jr(e,n,a)>=0)return!1;let u=e.x,d=n.x,p=a.x,_=e.y,y=n.y,b=a.y,T=u<d?u<p?u:p:d<p?d:p,I=_<y?_<b?_:b:y<b?y:b,D=u>d?u>p?u:p:d>p?d:p,R=_>y?_>b?_:b:y>b?y:b,O=a.next;for(;O!==e;){if(O.x>=T&&O.x<=D&&O.y>=I&&O.y<=R&&Xd(u,_,d,y,p,b,O.x,O.y)&&jr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Oz(t,e,n,a){let u=t.prev,d=t,p=t.next;if(jr(u,d,p)>=0)return!1;let _=u.x,y=d.x,b=p.x,T=u.y,I=d.y,D=p.y,R=_<y?_<b?_:b:y<b?y:b,O=T<I?T<D?T:D:I<D?I:D,F=_>y?_>b?_:b:y>b?y:b,z=T>I?T>D?T:D:I>D?I:D,j=ew(R,O,e,n,a),X=ew(F,z,e,n,a),Y=t.prevZ,K=t.nextZ;for(;Y&&Y.z>=j&&K&&K.z<=X;){if(Y.x>=R&&Y.x<=F&&Y.y>=O&&Y.y<=z&&Y!==u&&Y!==p&&Xd(_,T,y,I,b,D,Y.x,Y.y)&&jr(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,K.x>=R&&K.x<=F&&K.y>=O&&K.y<=z&&K!==u&&K!==p&&Xd(_,T,y,I,b,D,K.x,K.y)&&jr(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;Y&&Y.z>=j;){if(Y.x>=R&&Y.x<=F&&Y.y>=O&&Y.y<=z&&Y!==u&&Y!==p&&Xd(_,T,y,I,b,D,Y.x,Y.y)&&jr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;K&&K.z<=X;){if(K.x>=R&&K.x<=F&&K.y>=O&&K.y<=z&&K!==u&&K!==p&&Xd(_,T,y,I,b,D,K.x,K.y)&&jr(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function kz(t,e){let n=t;do{let a=n.prev,u=n.next.next;!Qy(a,u)&&kD(a,n,n.next,u)&&jm(a,u)&&jm(u,a)&&(e.push(a.i,n.i,u.i),Um(n),Um(n.next),n=t=u),n=n.next}while(n!==t);return oh(n)}function Lz(t,e,n,a,u,d){let p=t;do{let _=p.next.next;for(;_!==p.prev;){if(p.i!==_.i&&Vz(p,_)){let y=LD(p,_);return p=oh(p,p.next),y=oh(y,y.next),Vm(p,e,n,a,u,d,0),void Vm(y,e,n,a,u,d,0)}_=_.next}p=p.next}while(p!==t)}function Fz(t,e){return t.x-e.x}function Nz(t,e){let n=function(u,d){let p=d,_=u.x,y=u.y,b,T=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){let F=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=_&&F>T&&(T=F,b=p.x<p.next.x?p:p.next,F===_))return b}p=p.next}while(p!==d);if(!b)return null;let I=b,D=b.x,R=b.y,O=1/0;p=b;do{if(_>=p.x&&p.x>=D&&_!==p.x&&Xd(y<R?_:T,y,D,R,y<R?T:_,y,p.x,p.y)){let F=Math.abs(y-p.y)/(_-p.x);jm(p,u)&&(F<O||F===O&&(p.x>b.x||p.x===b.x&&zz(b,p)))&&(b=p,O=F)}p=p.next}while(p!==I);return b}(t,e);if(!n)return e;let a=LD(n,t);return oh(a,a.next),oh(n,n.next)}function zz(t,e){return jr(t.prev,t,e.prev)<0&&jr(e.next,t,t.next)<0}function ew(t,e,n,a,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Bz(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Xd(t,e,n,a,u,d,p,_){return(u-p)*(e-_)>=(t-p)*(d-_)&&(t-p)*(a-_)>=(n-p)*(e-_)&&(n-p)*(d-_)>=(u-p)*(a-_)}function Vz(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==a.i&&u.next.i!==a.i&&kD(u,u.next,n,a))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(jm(t,e)&&jm(e,t)&&function(n,a){let u=n,d=!1,p=(n.x+a.x)/2,_=(n.y+a.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&p<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==n);return d}(t,e)&&(jr(t.prev,t,e.prev)||jr(t,e.prev,e))||Qy(t,e)&&jr(t.prev,t,t.next)>0&&jr(e.prev,e,e.next)>0)}function jr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Qy(t,e){return t.x===e.x&&t.y===e.y}function kD(t,e,n,a){let u=e0(jr(t,e,n)),d=e0(jr(t,e,a)),p=e0(jr(n,a,t)),_=e0(jr(n,a,e));return u!==d&&p!==_||!(u!==0||!Jy(t,n,e))||!(d!==0||!Jy(t,a,e))||!(p!==0||!Jy(n,t,a))||!(_!==0||!Jy(n,e,a))}function Jy(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function e0(t){return t>0?1:t<0?-1:0}function jm(t,e){return jr(t.prev,t,t.next)<0?jr(t,e,t.next)>=0&&jr(t,t.prev,e)>=0:jr(t,e,t.prev)<0||jr(t,t.next,e)<0}function LD(t,e){let n=tw(t.i,t.x,t.y),a=tw(e.i,e.x,e.y),u=t.next,d=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,a.next=n,n.prev=a,d.next=a,a.prev=d,a}function FD(t,e,n,a){let u=tw(t,e,n);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Um(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function tw(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function t0(t,e){let n=t.length;if(n<=1)return[t];let a=[],u,d;for(let p=0;p<n;p++){let _=Ti(t[p]);_!==0&&(t[p].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(u&&a.push(u),u=[t[p]]):u.push(t[p]))}if(u&&a.push(u),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(J1(a[p],e,1,a[p].length-1,jz),a[p]=a[p].slice(0,e));return a}function jz(t,e){return e.area-t.area}function nw(t,e,n){let a=n.patternDependencies,u=!1;for(let d of e){let p=d.paint.get(`${t}-pattern`);p.isConstant()||(u=!0);let _=p.constantOr(null);_&&(u=!0,a[_]=!0)}return u}function rw(t,e,n,a,u){let d=u.patternDependencies;for(let p of e){let _=p.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:a},n,{},u.availableImages);y=y&&y.name?y.name:y,d[y]=!0,n.patterns[p.id]=y}}return n}class n0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _s,this.indexArray=new Zr,this.indexArray2=new uc,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new fr,this.segments2=new fr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,a,u){this.hasPattern=nw("fill",this.layers,n);let d=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:_,id:y,index:b,sourceLayerIndex:T}of e){let I=this.layers[0]._featureFilter.needGeometry,D=Qa(_,I);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),D,a))continue;let R=d?d.evaluate(D,{},a,n.availableImages):void 0,O={id:y,properties:_.properties,type:_.type,sourceLayerIndex:T,index:b,geometry:I?D.geometry:vs(_,a,u),patterns:{},sortKey:R};p.push(O)}d&&p.sort((_,y)=>_.sortKey-y.sortKey);for(let _ of p){let{geometry:y,index:b,sourceLayerIndex:T}=_;if(this.hasPattern){let I=rw("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(_,y,b,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,n,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,n,a,u,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pz),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,u,d,p=[],_){for(let y of t0(n,500)){let b=0;for(let F of y)b+=F.length;let T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=T.vertexLength,D=[],R=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&R.push(D.length/2);let z=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),j=z.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(j+F.length-1,j),D.push(F[0].x),D.push(F[0].y);for(let X=1;X<F.length;X++)this.layoutVertexArray.emplaceBack(F[X].x,F[X].y),this.indexArray2.emplaceBack(j+X-1,j+X),D.push(F[X].x),D.push(F[X].y);z.vertexLength+=F.length,z.primitiveLength+=F.length}let O=Bm(D,R);for(let F=0;F<O.length;F+=3)this.indexArray.emplaceBack(I+O[F],I+O[F+1],I+O[F+2]);T.vertexLength+=b,T.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,_)}}J(n0,"FillBucket",{omit:["layers","patternFeatures"]});let Uz=new On({"fill-sort-key":new ut(Te.layout_fill["fill-sort-key"]),visibility:new Be(Te.layout_fill.visibility)});var $z={paint:new On({"fill-antialias":new Be(Te.paint_fill["fill-antialias"]),"fill-opacity":new ut(Te.paint_fill["fill-opacity"]),"fill-color":new ut(Te.paint_fill["fill-color"]),"fill-outline-color":new ut(Te.paint_fill["fill-outline-color"]),"fill-translate":new Be(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Be(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new ut(Te.paint_fill["fill-pattern"]),"fill-emissive-strength":new Be(Te.paint_fill["fill-emissive-strength"])}),layout:Uz};class iw{constructor(e,n,a,u){if(this.triangleCount=n.length/3,this.min=new lt(0,0),this.max=new lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[d,p]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){let D=e[I];d.x=Math.min(d.x,D.x),d.y=Math.min(d.y,D.y),p.x=Math.max(p.x,D.x),p.y=Math.max(p.y,D.y)}if(u){let I=Math.ceil(Math.max(p.x-d.x,p.y-d.y)/u);a=Math.max(a,I)}if(a===0)return;this.min=d,this.max=p;let _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);let y=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/y)),this.cellsY=Math.max(1,Math.ceil(_.y/y)),this.xScale=1/y,this.yScale=1/y;let b=[];for(let I=0;I<this.triangleCount;I++){let D=e[n[3*I+0]].sub(this.min),R=e[n[3*I+1]].sub(this.min),O=e[n[3*I+2]].sub(this.min),F=oa(Math.floor(Math.min(D.x,R.x,O.x)),this.xScale,this.cellsX),z=oa(Math.floor(Math.max(D.x,R.x,O.x)),this.xScale,this.cellsX),j=oa(Math.floor(Math.min(D.y,R.y,O.y)),this.yScale,this.cellsY),X=oa(Math.floor(Math.max(D.y,R.y,O.y)),this.yScale,this.cellsY),Y=new lt(0,0),K=new lt(0,0),le=new lt(0,0),se=new lt(0,0);for(let pe=j;pe<=X;++pe){Y.y=K.y=pe*y,le.y=se.y=(pe+1)*y;for(let _e=F;_e<=z;++_e)Y.x=le.x=_e*y,K.x=se.x=(_e+1)*y,(Gb(D,R,O,Y,K,se)||Gb(D,R,O,Y,se,le))&&b.push({cellIdx:pe*this.cellsX+_e,triIdx:I})}}if(b.length===0)return;b.sort((I,D)=>I.cellIdx-D.cellIdx||I.triIdx-D.triIdx);let T=0;for(;T<b.length;){let I=b[T].cellIdx,D={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===I;)++D.len,this.payload.push(b[T++].triIdx);this.cells[I]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=oa(e.x-this.min.x,this.xScale,this.cellsX),u=oa(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[u*this.cellsX+a];if(d){this._lazyInitLookup();for(let p=0;p<d.len;p++){let _=this.payload[d.start+p],y=Math.floor(_/8),b=1<<_%8;if(!(this.lookup[y]&b)&&(this.lookup[y]|=b,n.push(_),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let u=oa(e.x-this.min.x,this.xScale,this.cellsX),d=oa(n.x-this.min.x,this.xScale,this.cellsX),p=oa(e.y-this.min.y,this.yScale,this.cellsY),_=oa(n.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=_;y++)for(let b=u;b<=d;b++){let T=this.cells[y*this.cellsX+b];if(T)for(let I=0;I<T.len;I++){let D=this.payload[T.start+I],R=Math.floor(D/8),O=1<<D%8;if(!(this.lookup[R]&O)&&(this.lookup[R]|=O,a.push(D),a.length===this.triangleCount))return}}}}function oa(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}J(iw,"TriangleGridIndex");class ND{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,u){let d=[];for(let{feature:p,id:_,index:y,sourceLayerIndex:b}of e){let T=this.layers[0]._featureFilter.needGeometry,I=Qa(p,T);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),I,a))continue;let D={id:_,properties:p.properties,type:p.type,sourceLayerIndex:b,index:y,geometry:T?I.geometry:vs(p,a,u),patterns:{}};d.push(D)}for(let p of d){let{geometry:_,index:y,sourceLayerIndex:b}=p;this.addFeature(p,_,y,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,_,y,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,u,d){}destroy(){}addFeature(e,n,a,u,d,p=[],_){for(let y of t0(n,2)){let b=[],T=[],I=[],D=new lt(1/0,1/0),R=new lt(-1/0,-1/0);for(let z of y)if(z.length!==0){z!==y[0]&&I.push(T.length/2);for(let j=0;j<z.length;j++)T.push(z[j].x),T.push(z[j].y),b.push(z[j]),D.x=Math.min(D.x,z[j].x),D.y=Math.min(D.y,z[j].y),R.x=Math.max(R.x,z[j].x),R.y=Math.max(R.y,z[j].y)}let O=Bm(T,I),F=new iw(b,O,8,256);this.footprints.push({vertices:b,indices:O,grid:F,min:D,max:R})}}}J(ND,"ClipBucket",{omit:["layers"]});let Gz=new On({"clip-layer-types":new Be(Te.layout_clip["clip-layer-types"])});var Hz={paint:new On({}),layout:Gz};let qz=Mn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Wz=Mn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Zz=Mn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Xz=Mn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Yz=Mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Kz}=qz;var r0={},Qz=rd,zD=Yd;function Yd(t,e,n,a,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=u,t.readFields(Jz,this,e)}function Jz(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,u){for(var d=a.readVarint()+a.pos;a.pos<d;){var p=u._keys[a.readVarint()],_=u._values[a.readVarint()];u.properties[p]=_}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function eB(t){for(var e,n,a=0,u=0,d=t.length,p=d-1;u<d;p=u++)a+=((n=t[p]).x-(e=t[u]).x)*(e.y+n.y);return a}Yd.types=["Unknown","Point","LineString","Polygon"],Yd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,u=0,d=0,p=0,_=[];t.pos<n;){if(u<=0){var y=t.readVarint();a=7&y,u=y>>3}if(u--,a===1||a===2)d+=t.readSVarint(),p+=t.readSVarint(),a===1&&(e&&_.push(e),e=[]),e.push(new Qz(d,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Yd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,u=0,d=0,p=1/0,_=-1/0,y=1/0,b=-1/0;t.pos<e;){if(a<=0){var T=t.readVarint();n=7&T,a=T>>3}if(a--,n===1||n===2)(u+=t.readSVarint())<p&&(p=u),u>_&&(_=u),(d+=t.readSVarint())<y&&(y=d),d>b&&(b=d);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,_,b]},Yd.prototype.toGeoJSON=function(t,e,n){var a,u,d=this.extent*Math.pow(2,n),p=this.extent*t,_=this.extent*e,y=this.loadGeometry(),b=Yd.types[this.type];function T(R){for(var O=0;O<R.length;O++){var F=R[O];R[O]=[360*(F.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(a=0;a<y.length;a++)I[a]=y[a][0];T(y=I);break;case 2:for(a=0;a<y.length;a++)T(y[a]);break;case 3:for(y=function(R){var O=R.length;if(O<=1)return[R];for(var F,z,j=[],X=0;X<O;X++){var Y=eB(R[X]);Y!==0&&(z===void 0&&(z=Y<0),z===Y<0?(F&&j.push(F),F=[R[X]]):F.push(R[X]))}return F&&j.push(F),j}(y),a=0;a<y.length;a++)for(u=0;u<y[a].length;u++)T(y[a][u])}y.length===1?y=y[0]:b="Multi"+b;var D={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(D.id=this.id),D};var tB=zD,BD=VD;function VD(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(nB,this,e),this.length=this._features.length}function nB(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var u=null,d=a.readVarint()+a.pos;a.pos<d;){var p=a.readVarint()>>3;u=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return u}(n))}VD.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new tB(this._pbf,e,this.extent,this._keys,this._values)};var rB=BD;function iB(t,e,n){if(t===3){var a=new rB(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var ow=r0.VectorTile=function(t,e){this.layers=t.readFields(iB,{},e)},i0=r0.VectorTileFeature=zD;r0.VectorTileLayer=BD;class sh extends lt{constructor(e,n,a){super(e,n),this.z=a}}class jD extends sh{constructor(e,n,a,u){super(e,n,a),this.w=u}}function o0(t,e,n,a){let u=[],d=a===0?(p,_,y,b,T,I)=>{p.push(new lt(I,y+(I-_)/(b-_)*(T-y)))}:(p,_,y,b,T,I)=>{p.push(new lt(_+(I-y)/(T-y)*(b-_),I))};for(let p of t){let _=[];for(let y of p){if(y.length<=2)continue;let b=[];for(let D=0;D<y.length-1;D++){let R=y[D].x,O=y[D].y,F=y[D+1].x,z=y[D+1].y,j=a===0?R:O,X=a===0?F:z;j<e?X>e&&d(b,R,O,F,z,e):j>n?X<n&&d(b,R,O,F,z,n):b.push(y[D]),X<e&&j>=e&&d(b,R,O,F,z,e),X>n&&j<=n&&d(b,R,O,F,z,n)}let T=y[y.length-1],I=a===0?T.x:T.y;I>=e&&I<=n&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),_.push(b))}_.length&&u.push(_)}return u}function UD(t,e,n,a){let u=n==="x"?"y":"x",d=(a-t[n])/(e[n]-t[n]);t[u]=t[u]+(e[u]-t[u])*d,t[n]=a,t.hasOwnProperty("z")&&(t.z=It(t.z,e.z,d)),t.hasOwnProperty("w")&&(t.w=It(t.w,e.w,d))}function $D(t,e,n,a){let u=n,d=a;for(let p of["x","y"]){let _=t,y=e;_[p]>=y[p]&&(_=e,y=t),_[p]<u&&y[p]>u&&UD(_,y,p,u),_[p]<d&&y[p]>d&&UD(y,_,p,d)}}function s0(t,e){return t.x-e.x||t.y-e.y}function GD(t,e){return s0(t.min,e.min)===0&&s0(t.max,e.max)===0}function sw(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function aw(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!GD(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function HD(t,e,n){let a=1/it,u=1/(1<<n.canonical.z),d=(e.x*a+n.canonical.x)*u+n.wrap,p=(e.y*a+n.canonical.y)*u;return{min:new lt((t.x*a+n.canonical.x)*u+n.wrap,(t.y*a+n.canonical.y)*u),max:new lt(d,p)}}function oB(t,e,n){let a=1<<n.canonical.z,u=((e.x-n.wrap)*a-n.canonical.x)*it,d=(e.y*a-n.canonical.y)*it;return{min:new lt(((t.x-n.wrap)*a-n.canonical.x)*it,(t.y*a-n.canonical.y)*it),max:new lt(u,d)}}function qD(t,e,n,a,u,d,p){let _=t.indices,y=t.vertices,b=[];for(let T=a;T<a+u;T+=3){let I=e[n[T+0]+d],D=e[n[T+1]+d],R=e[n[T+2]+d],O=Math.min(I.x,D.x,R.x),F=Math.max(I.x,D.x,R.x),z=Math.min(I.y,D.y,R.y),j=Math.max(I.y,D.y,R.y);b.length=0,t.grid.query(new lt(O,z),new lt(F,j),b);for(let X=0;X<b.length;X++){let Y=b[X];if(Gb(y[_[3*Y+0]],y[_[3*Y+1]],y[_[3*Y+2]],I,D,R,p))return!0}}return!1}function WD(t,e,n,a){if(!t||!n)return!1;let u=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return WD(n,a,t,e);let d=e.canonical,p=a.canonical,_=Math.pow(2,p.z-d.z);u=t.vertices.map(y=>new lt((y.x+d.x*it)*_-p.x*it,(y.y+d.y*it)*_-p.y*it))}return qD(n,u,t.indices,0,t.indices.length,0,0)}function ZD(t,e,n,a){let u=Math.pow(2,a.z-n.z);return new lt((t+n.x*it)*u-a.x*it,(e+n.y*it)*u-a.y*it)}function XD(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let a=e.footprint.indices,u=e.footprint.vertices;for(let d=0;d<n.length;d++){let p=n[d];if(pc([u[a[3*p+0]],u[a[3*p+1]],u[a[3*p+2]]],t))return!0}return!1}class YD{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function KD(t,e,n,a){let u=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<t[p]||n[p]>e[p])return null}else{let _=1/a[p],y=(t[p]-n[p])*_,b=(e[p]-n[p])*_;if(y>b){let T=y;y=b,b=T}if(y>u&&(u=y),b<d&&(d=b),u>d)return null}return u}function QD(t,e,n,a,u,d,p,_,y,b,T){let I=a-t,D=u-e,R=d-n,O=p-t,F=_-e,z=y-n,j=T[1]*z-T[2]*F,X=T[2]*O-T[0]*z,Y=T[0]*F-T[1]*O,K=I*j+D*X+R*Y;if(Math.abs(K)<1e-15)return null;let le=1/K,se=b[0]-t,pe=b[1]-e,_e=b[2]-n,Ee=(se*j+pe*X+_e*Y)*le;if(Ee<0||Ee>1)return null;let Oe=pe*R-_e*D,De=_e*I-se*R,Ne=se*D-pe*I,Xe=(T[0]*Oe+T[1]*De+T[2]*Ne)*le;return Xe<0||Ee+Xe>1?null:(O*Oe+F*De+z*Ne)*le}function JD(t,e,n){return(t-e)/(n-e)}function eM(t,e,n,a,u,d,p,_,y){let b=1<<n,T=d-a,I=p-u,D=(t+1)/b*T+a,R=(e+0)/b*I+u,O=(e+1)/b*I+u;_[0]=(t+0)/b*T+a,_[1]=R,y[0]=D,y[1]=O}class tM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(d){let p=Math.ceil(Math.log2(d.dim/8)),_=[],y=Math.ceil(Math.pow(2,p)),b=1/y,T=(R,O,F,z,j)=>{let X=z?1:0,Y=(R+1)*F-X,K=O*F,le=(O+1)*F-X;j[0]=R*F,j[1]=K,j[2]=Y,j[3]=le},I=new YD(y),D=[];for(let R=0;R<y*y;R++){T(R%y,Math.floor(R/y),b,!1,D);let O=gc(D[0],D[1],d),F=gc(D[2],D[1],d),z=gc(D[2],D[3],d),j=gc(D[0],D[3],d);I.minimums.push(Math.min(O,F,z,j)),I.maximums.push(Math.max(O,F,z,j)),I.leaves.push(1)}for(_.push(I),y/=2;y>=1;y/=2){let R=_[_.length-1];I=new YD(y);for(let O=0;O<y*y;O++){T(O%y,Math.floor(O/y),2,!0,D);let F=R.getElevation(D[0],D[1]),z=R.getElevation(D[2],D[1]),j=R.getElevation(D[2],D[3]),X=R.getElevation(D[0],D[3]),Y=R.isLeaf(D[0],D[1]),K=R.isLeaf(D[2],D[1]),le=R.isLeaf(D[2],D[3]),se=R.isLeaf(D[0],D[3]),pe=Math.min(F.min,z.min,j.min,X.min),_e=Math.max(F.max,z.max,j.max,X.max),Ee=Y&&K&&le&&se;I.maximums.push(_e),I.minimums.push(pe),I.leaves.push(_e-pe<=5&&Ee?1:0)}_.push(I)}return _}(this.dem),a=n.length-1,u=n[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,u,d,p,_=1){return KD([e,n,-100],[a,u,this.maximums[0]*_],d,p)}raycast(e,n,a,u,d,p,_=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,a,u,d,p,_);if(y==null)return null;let b=[],T=[],I=[],D=[],R=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;R.length>0;){let{idx:O,t:F,nodex:z,nodey:j,depth:X}=R.pop();if(this.leaves[O]){eM(z,j,X,e,n,a,u,I,D);let K=1<<X,le=(z+0)/K,se=(z+1)/K,pe=(j+0)/K,_e=(j+1)/K,Ee=gc(le,pe,this.dem)*_,Oe=gc(se,pe,this.dem)*_,De=gc(se,_e,this.dem)*_,Ne=gc(le,_e,this.dem)*_,Xe=QD(I[0],I[1],Ee,D[0],I[1],Oe,D[0],D[1],De,d,p),Le=QD(D[0],D[1],De,I[0],D[1],Ne,I[0],I[1],Ee,d,p),qe=Math.min(Xe!==null?Xe:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{let ke=r._.scaleAndAdd([],d,p,F);if(nM(Ee,Oe,Ne,De,JD(ke[0],I[0],D[0]),JD(ke[1],I[1],D[1]))>=ke[2])return F}continue}let Y=0;for(let K=0;K<this._siblingOffset.length;K++){eM((z<<1)+this._siblingOffset[K][0],(j<<1)+this._siblingOffset[K][1],X+1,e,n,a,u,I,D),I[2]=-100,D[2]=this.maximums[this.childOffsets[O]+K]*_;let le=KD(I,D,d,p);if(le!=null){let se=le;b[K]=se;let pe=!1;for(let _e=0;_e<Y&&!pe;_e++)se>=b[T[_e]]&&(T.splice(_e,0,K),pe=!0);pe||(T[Y]=K),Y++}}for(let K=0;K<Y;K++){let le=T[K];R.push({idx:this.childOffsets[O]+le,t:b[le],nodex:(z<<1)+this._siblingOffset[le][0],nodey:(j<<1)+this._siblingOffset[le][1],depth:X+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,u,d){if(e[u].isLeaf(n,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let p=u-1,_=e[p],y=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*n+this._siblingOffset[T][0],D=2*a+this._siblingOffset[T][1],R=_.getElevation(I,D),O=_.isLeaf(I,D),F=this._addNode(R.min,R.max,O);O&&(y|=1<<T),b||(b=F)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*a+this._siblingOffset[T][1],p,b+T)}}function nM(t,e,n,a,u,d){return It(It(t,n,d),It(e,a,d),u)}function gc(t,e,n){let a=n.dim,u=Qt(t*a-.5,0,a-1),d=Qt(e*a-.5,0,a-1),p=Math.floor(u),_=Math.floor(d),y=Math.min(p+1,a-1),b=Math.min(_+1,a-1);return nM(n.get(p,_),n.get(y,_),n.get(p,b),n.get(y,b),u-p,d-_)}let sB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function aB(t,e,n){return(256*t*256+256*e+n)/10-1e4}function lB(t,e,n){return 256*t+e+n/256-32768}class a0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Sr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let d=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let y=0;y<d;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(d,y)]=p[this._idx(d-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,d)]=p[this._idx(y,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}let _=a==="terrarium"?lB:aB;for(let y=0;y<p.length;++y){let b=4*y;this.floatView[y]=_(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=ti.now()}_buildQuadTree(){this._tree=new tM(this)}get(e,n,a=!1){a&&(e=Qt(e,-1,this.dim),n=Qt(n,-1,this.dim));let u=this._idx(e,n);return this.floatView[u]}set(e,n,a){let u=this._idx(e,n),d=this.floatView[u];return this.floatView[u]=a,a-d}static getUnpackVector(e){return sB[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],u=a0.getUnpackVector(n),d=Math.floor((e+u[3])/u[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new RD({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,d=n*this.dim+this.dim,p=a*this.dim,_=a*this.dim+this.dim;switch(n){case-1:u=d-1;break;case 1:d=u+1}switch(a){case-1:p=_-1;break;case 1:_=p+1}let y=-n*this.dim,b=-a*this.dim;for(let T=p;T<_;T++)for(let I=u;I<d;I++){let D=4*this._idx(I,T),R=4*this._idx(I+y,T+b);this.pixels[D+0]=e.pixels[R+0],this.pixels[D+1]=e.pixels[R+1],this.pixels[D+2]=e.pixels[R+2],this.pixels[D+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}J(a0,"DEMData"),J(tM,"DemMinMaxQuadTree",{omit:["dem"]});class Kd{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let u=a||e.findDEMTileFor(n);if(!u||!u.dem)return;let d=u.dem,p=u.tileID,_=1<<n.canonical.z-p.canonical.z;return new Kd(u,d.dim/it/_,[(n.canonical.x/_-p.canonical.x)*d.dim,(n.canonical.y/_-p.canonical.y)*d.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new lt(u,d)}getElevationAt(e,n,a,u){let d=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],_=Math.floor(d),y=Math.floor(p),b=this._dem;return u=!!u,a?It(It(b.get(_,y,u),b.get(_,y+1,u),p-y),It(b.get(_+1,y,u),b.get(_+1,y+1,u),p-y),d-_):b.get(_,y,u)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Gi(1,e)*this._dem.stride}}let rM={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},cB=i0.types,uB=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],hB=["fill-extrusion-flood-light-ground-radius"],dB=Math.pow(2,13),fB=Math.pow(2,15)-1,iM=new lt(0,1),_c=2147483648;function $m(t,e,n,a,u,d,p,_){t.emplaceBack((e<<1)+p,(n<<1)+d,(Math.floor(a*dB)<<1)+u,Math.round(_))}function l0(t,e,n,a,u,d){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+u,d)}function Gm(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class oM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sM{constructor(){this.centroidXY=new lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class aM{constructor(){this.acc=new lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===it)&&n.x===a.x)!=((n.y===0||n.y===it)&&n.y===a.y)&&this.processBorderOverlap(n,a),u&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,It(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>it!=e.x>it&&this.addBorderIntersection(1,It(n.y,e.y,(it-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,It(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>it!=e.y>it&&this.addBorderIntersection(3,It(n.x,e.x,(it-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new lt(0,0):new lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function lM(t,e){let n=t.add(e)._unit(),a=Qt(t.x*n.x+t.y*n.y,-1,1);var u,d,p;return u=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(u)))/4*fB*((d=t).x*(p=e).y-d.y*p.x<0?-1:1)}let pB=[t=>t.x<0,t=>t.x>it,t=>t.y<0,t=>t.y>it];function mB(t,e,n,a){let u=[4];if(a===0)return u;n._mult(a);let d=t.sub(n),p=e.sub(n),_=[t,e,d,p];for(let y=0;y<4;y++)for(let b of _)if(pB[y](b)){u.push(y);break}return u}class cM{constructor(e){this.vertexArray=new db,this.indexArray=new Zr,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut},n=>hB.includes(n)),this._segments=new fr,this.hiddenByLandmarkVertexArray=new Cb,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new fr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,u=!1){let d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let b=e[0],T=e[1];y=lM(b.sub(e[d-1])._perp()._unit(),T.sub(b)._perp()._unit())}for(let b=0;b<d;b++){let T=b===d-1?0:b+1,I=e[b],D=e[T],R=e[T===d-1?0:T+1],O=D.sub(I)._perp()._unit(),F=lM(O,R.sub(D)._perp()._unit()),z=y,j=F;if(lw(I,D,n)||u&&dM(I,n)&&dM(D,n)){y=F;continue}let X=_.vertexLength;l0(this.vertexArray,I,D,1,1,z),l0(this.vertexArray,I,D,1,0,z),l0(this.vertexArray,I,D,0,1,j),l0(this.vertexArray,I,D,0,0,j),_.vertexLength+=4;let Y=mB(I,D,O,a);for(let K of Y)this._segmentToGroundQuads[p].push({id:X,region:K}),this._segmentToRegionTriCounts[p][K]+=2,_.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((u,d)=>u.region-d.region);for(let a=0;a<n;a++){let u=this._segmentToGroundQuads[a],d=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((y,b)=>y+b,0);let _=0;for(let y=0;y<=4;y++){let b=p[y];if(b!==0){let T=this.regionSegments[y];T||(T=this.regionSegments[y]=new fr);let I={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:b};T.get().push(I)}_+=b}for(let y=0;y<u.length;y++){let b=u[y].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,u,d,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,u,d,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Wz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,u,d,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,u,d,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&_c?1:0;for(let u=e.groundVertexArrayOffset;u<n;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Xz.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class c0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Zr,this.footprintVertices=new _s,this.footprintSegments=[],this.layoutVertexArray=new sc,this.centroidVertexArray=new ZI,this.indexArray=new Zr,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut},n=>uB.includes(n)),this.segments=new fr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new cM(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,u){this.features=[],this.hasPattern=nw("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Gy(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:d,id:p,index:_,sourceLayerIndex:y}of e){let b=this.layers[0]._featureFilter.needGeometry,T=Qa(d,b);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),T,a))continue;let I={id:p,sourceLayerIndex:y,index:_,geometry:b?T.geometry:vs(d,a,u),properties:d.properties,type:d.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(rw("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,_,a,{},n.availableImages,u,n.brightness),n.featureIndex.insert(d,I.geometry,_,y,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,u,d,p){for(let _ of this.features){let{geometry:y}=_;this.addFeature(_,y,_.index,n,a,u,d,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,u,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,_,a,u,d),this.groundEffect.update(e,n,_,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kz),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Yz.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Zz.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,u,d,p,_,y){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new lt(0,0),new lt(it,it)],I=_.projection,D=I.name==="globe",R=cB[e.type]==="Polygon",O=new aM;O.centroidDataIndex=this.centroidData.length;let F=new sM,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);F.height=j,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new By);let X=t0(n,500);for(let _e=X.length-1;_e>=0;_e--){let Ee=X[_e];(Ee.length===0||(Y=Ee[0]).every(Oe=>Oe.x<=0)||Y.every(Oe=>Oe.x>=it)||Y.every(Oe=>Oe.y<=0)||Y.every(Oe=>Oe.y>=it))&&X.splice(_e,1)}var Y;let K;if(D)K=gM(X,T,u);else{K=[];for(let _e of X)K.push({polygon:_e,bounds:T})}let le=R?this.edgeRadius:0,se=le>0&&this.zoom<17,pe=(_e,Ee)=>{if(_e.length===0)return!1;let Oe=_e[_e.length-1];return Ee.x===Oe.x&&Ee.y===Oe.y};for(let{polygon:_e,bounds:Ee}of K){let Oe=0,De=0;for(let qe of _e)R&&!qe[0].equals(qe[qe.length-1])&&qe.push(qe[0]),De+=R?qe.length-1:qe.length;let Ne=this.segments.prepareSegment((R?5:4)*De,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let Xe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Le=new oM;if(Le.vertexOffset=this.footprintVertices.length,Le.indexOffset=3*this.footprintIndices.length,Le.ringIndices=[],R){let qe=[],ke=[];Oe=Ne.vertexLength;for(let Je=0;Je<_e.length;Je++){let Ze=_e[Je];Ze.length&&Je!==0&&ke.push(qe.length/2);let ht=[],Ye,tt;Ye=Ze[1].sub(Ze[0])._perp()._unit(),Le.ringIndices.push(Ze.length-1);for(let Tt=1;Tt<Ze.length;Tt++){let yt=Ze[Tt],gt=Ze[Tt===Ze.length-1?1:Tt+1],et=yt.clone();if(le){tt=gt.sub(yt)._perp()._unit();let St=Ye.add(tt)._unit(),qt=le*Math.min(4,1/(Ye.x*St.x+Ye.y*St.y));et.x+=qt*St.x,et.y+=qt*St.y,et.x=Math.round(et.x),et.y=Math.round(et.y),Ye=tt}!z||le!==0&&!se||pe(ht,et)||ht.push(et),$m(this.layoutVertexArray,et.x,et.y,0,0,1,1,0),Ne.vertexLength++,this.footprintVertices.emplaceBack(yt.x,yt.y),qe.push(yt.x,yt.y),D&&Gm(this.layoutVertexExtArray,I.projectTilePoint(et.x,et.y,u),I.upVector(u,et.x,et.y))}z&&(le===0||se)&&(ht.length!==0&&pe(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,Ee,b))}let We=Bm(qe,ke);for(let Je=0;Je<We.length;Je+=3)this.footprintIndices.emplaceBack(Le.vertexOffset+We[Je+0],Le.vertexOffset+We[Je+1],Le.vertexOffset+We[Je+2]),this.indexArray.emplaceBack(Oe+We[Je],Oe+We[Je+2],Oe+We[Je+1]),Ne.primitiveLength++;Le.indexCount+=We.length,Le.vertexCount+=this.footprintVertices.length-Le.vertexOffset}for(let qe=0;qe<_e.length;qe++){let ke=_e[qe];O.startRing(F,ke[0]);let We=ke.length>4&&fM(ke[ke.length-2],ke[0],ke[1]),Je=le?gB(ke[ke.length-2],ke[0],ke[1],le):0,Ze=[],ht,Ye,tt;Ye=ke[1].sub(ke[0])._perp()._unit();let Tt=!0;for(let yt=1,gt=0;yt<ke.length;yt++){let et=ke[yt-1],St=ke[yt],qt=ke[yt===ke.length-1?1:yt+1];if(O.appendEdge(F,St,et),lw(St,et,Ee)){le&&(Ye=qt.sub(St)._perp()._unit(),Tt=!Tt);continue}let At=St.sub(et)._perp(),Xt=At.x/(Math.abs(At.x)+Math.abs(At.y)),Wt=At.y>0?1:0,nn=et.dist(St);if(gt+nn>32768&&(gt=0),le){tt=qt.sub(St)._perp()._unit();let Tn=hM(et,St,qt,uM(Ye,tt),le);isNaN(Tn)&&(Tn=0);let hn=St.sub(et)._unit();et=et.add(hn.mult(Je))._round(),St=St.add(hn.mult(-Tn))._round(),Je=Tn,Ye=tt,z&&this.zoom>=17&&(pe(Ze,et)||Ze.push(et),pe(Ze,St)||Ze.push(St))}let Dt=Ne.vertexLength,jn=ke.length>4&&fM(et,St,qt),Bn=pM(gt,We,Tt);if($m(this.layoutVertexArray,et.x,et.y,Xt,Wt,0,0,Bn),$m(this.layoutVertexArray,et.x,et.y,Xt,Wt,0,1,Bn),gt+=nn,Bn=pM(gt,jn,!Tt),We=jn,$m(this.layoutVertexArray,St.x,St.y,Xt,Wt,0,0,Bn),$m(this.layoutVertexArray,St.x,St.y,Xt,Wt,0,1,Bn),Ne.vertexLength+=4,this.indexArray.emplaceBack(Dt+0,Dt+1,Dt+2),this.indexArray.emplaceBack(Dt+1,Dt+3,Dt+2),Ne.primitiveLength+=2,le){let Tn=Oe+(yt===1?ke.length-2:yt-2),hn=yt===1?Oe:Tn+1;if(this.indexArray.emplaceBack(Dt+1,Tn,Dt+3),this.indexArray.emplaceBack(Tn,hn,Dt+3),Ne.primitiveLength+=2,ht===void 0&&(ht=Dt),!lw(qt,ke[yt],Ee)){let Sn=yt===ke.length-1?ht:Ne.vertexLength;this.indexArray.emplaceBack(Dt+2,Dt+3,Sn),this.indexArray.emplaceBack(Dt+3,Sn+1,Sn),this.indexArray.emplaceBack(Dt+3,hn,Sn+1),Ne.primitiveLength+=3}Tt=!Tt}if(D){let Tn=this.layoutVertexExtArray,hn=I.projectTilePoint(et.x,et.y,u),Sn=I.projectTilePoint(St.x,St.y,u),Yn=I.upVector(u,et.x,et.y),Hn=I.upVector(u,St.x,St.y);Gm(Tn,hn,Yn),Gm(Tn,hn,Yn),Gm(Tn,Sn,Hn),Gm(Tn,Sn,Hn)}}R&&(Oe+=ke.length-1),z&&le&&this.zoom>=17&&(Ze.length!==0&&pe(Ze,Ze[0])&&Ze.pop(),this.groundEffect.addData(Ze,Ee,b,le>0))}this.footprintSegments.push(Le),Xe.triangleCount=this.indexArray.length-Xe.triangleArrayOffset,this.polygonSegments.push(Xe),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=O.borders?iM:this.encodeCentroid(O,F),this.centroidData.push(F),O.borders){this.featuresOnBorder.push(O);let _e=this.featuresOnBorder.length-1;for(let Ee=0;Ee<O.borders.length;Ee++)O.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(_e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,y),this.groundEffect.addPaintPropertiesData(e,a,d,p,u,y),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let y=this.centroidData[_],b=+(y.min.y+y.max.y>it),T=2*b+(+(y.min.x+y.max.x>it)^b);for(let I=0;I<y.polygonSegLen;I++){let D=y.polygonSegIdx+I;e.push({centroidIdx:_,subtile:T,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let n=new Zr;e.sort((_,y)=>_.triangleSegmentIdx===y.triangleSegmentIdx?_.subtile-y.subtile:_.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,u=0,d=0;for(let _ of e){if(_.triangleSegmentIdx!==a)break;d++}let p=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let _=0,y=u,b=u;for(let T=y;T<d&&e[T].subtile===_;T++)b++;for(;y!==d;){let T=e[y];_=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),D=this.centroidData[T.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=y;O<b;O++){let F=e[O],z=this.polygonSegments[F.polygonSegmentIdx],j=this.centroidData[F.centroidIdx].min,X=this.centroidData[F.centroidIdx].max,Y=this.indexArray.uint16;for(let K=z.triangleArrayOffset;K<z.triangleArrayOffset+z.triangleCount;K++)n.emplaceBack(Y[3*K],Y[3*K+1],Y[3*K+2]);R.primitiveLength+=z.triangleCount,I.x=Math.min(I.x,j.x),I.y=Math.min(I.y,j.y),D.x=Math.max(D.x,X.x),D.y=Math.max(D.y,X.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:I,max:D}),y=b;for(let O=y;O<d&&e[O].subtile===e[y].subtile;O++)b++}u=d;for(let T=u;T<p&&e[T].triangleSegmentIdx===e[u].triangleSegmentIdx;T++)d++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let u=0,d=0,p=1<<e.canonical.z;if(n){let F=n.getMinMaxForTile(e);F&&(u=F.min,d=F.max)}d+=this.maxHeight;let _=e.toUnwrapped(),y,b=[_.canonical.x/p+_.wrap,_.canonical.y/p],T=[(_.canonical.x+1)/p+_.wrap,(_.canonical.y+1)/p],I=new fr,D=(F,z,j)=>[F[0]*(1-j[0])+z[0]*j[0],F[1]*(1-j[1])+z[1]*j[1]],R=[],O=[];for(let F of this.triangleSubSegments){R[0]=F.min.x/it,R[1]=F.min.y/it,O[0]=F.max.x/it,O[1]=F.max.y/it;let z=D(b,T,R),j=D(b,T,O);if(new pr([z[0],z[1],u],[j[0],j[1],d]).intersectsPrecise(a)===0){y&&(I.segments.push(y),y=void 0);continue}let X=F.segment;y&&y.vertexOffset!==X.vertexOffset&&(I.segments.push(y),y=void 0),y?(y.vertexLength+=X.vertexLength,y.primitiveLength+=X.primitiveLength):y={vertexOffset:X.vertexOffset,primitiveLength:X.primitiveLength,vertexLength:X.vertexLength,primitiveOffset:X.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&I.segments.push(y),I}encodeCentroid(e,n){let a=e.centroid(),u=n.span(),d=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new lt(Qt(a.x,1,it-1)<<3|d,Qt(a.y,1,it-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new lt(0,0);let n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){let u=n[0][0]!==a?0:1;return new lt(6|(n[0][0]!==a?0:65528),(n[u][0]+n[u][1])/2<<3|6)}{let u=n[2][0]!==a?2:3;return new lt((n[u][0]+n[u][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=_c,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&_c?iM:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||d!==u.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let u=n.getReplacementRegionsForTile(e.toUnwrapped());if(aw(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let d=[];for(let p of this.activeReplacements){if(p.order<a)continue;let _=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&_c||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let b=0;b<y.footprintSegLen;b++){let T=this.footprintSegments[y.footprintSegIdx+b];if(d.length=0,_B(this.footprintVertices,T.vertexOffset,T.vertexCount,p.footprintTileId.canonical,e.canonical,d),qD(p.footprint,d,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-_)){y.flags|=_c;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let u=!1;for(let d=0;d<a.footprintSegLen;d++){let p=this.footprintSegments[a.footprintSegIdx+d],_=0;for(let y of p.ringIndices){for(let b=_,T=y+_-1;b<y+_;T=b++){let I=this.footprintVertices.int16[2*(b+p.vertexOffset)+0],D=this.footprintVertices.int16[2*(b+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(T+p.vertexOffset)+1];D>n!=R>n&&e<(this.footprintVertices.int16[2*(T+p.vertexOffset)+0]-I)*(n-D)/(R-D)+I&&(u=!u)}_=y}}return u}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,u=!0,d=4*(e+it)*it+(n+it);if(this.partLookup.hasOwnProperty(d)){let p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&_c)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>a&&(a=p.height,this.partLookup[d]=p,u=!!(p.flags&_c));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[d]=void 0}}function uM(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function gB(t,e,n,a){let u=e.sub(t)._perp()._unit(),d=n.sub(e)._perp()._unit();return hM(t,e,n,uM(u,d),a)}function hM(t,e,n,a,u){let d=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,u*d/a)}function lw(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function dM(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function fM(t,e,n){if(t.x<0||t.x>=it||e.x<0||e.x>=it||n.x<0||n.x>=it)return!1;let a=n.sub(e),u=a.perp(),d=t.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&u.x*d.x+u.y*d.y<0}function pM(t,e,n){let a=e?2|t:-3&t;return n?1|a:-2&a}function mM(){let t=Math.PI/32,e=Math.tan(t),n=qd;return n*Math.sqrt(1+2*e*e)-n}function gM(t,e,n){let a=1<<n.z,u=Ki(n.x/a),d=Ki((n.x+1)/a),p=ri(n.y/a),_=ri((n.y+1)/a);return function(y,b,T,I,D=0,R){let O=[];if(!y.length||!T||!I)return O;let F=(se,pe)=>{for(let _e of se)O.push({polygon:_e,bounds:pe})},z=Math.ceil(Math.log2(T)),j=Math.ceil(Math.log2(I)),X=z-j,Y=[];for(let se=0;se<Math.abs(X);se++)Y.push(X>0?0:1);for(let se=0;se<Math.min(z,j);se++)Y.push(0),Y.push(1);let K=y;if(K=o0(K,b[0].y-D,b[1].y+D,1),K=o0(K,b[0].x-D,b[1].x+D,0),!K.length)return O;let le=[];for(Y.length?le.push({polygons:K,bounds:b,depth:0}):F(K,b);le.length;){let se=le.pop(),pe=se.depth,_e=Y[pe],Ee=se.bounds[0],Oe=se.bounds[1],De=_e===0?Ee.x:Ee.y,Ne=_e===0?Oe.x:Oe.y,Xe=R?R(_e,De,Ne):.5*(De+Ne),Le=o0(se.polygons,De-D,Xe+D,_e),qe=o0(se.polygons,Xe-D,Ne+D,_e);if(Le.length){let ke=[Ee,new lt(_e===0?Xe:Oe.x,_e===1?Xe:Oe.y)];Y.length>pe+1?le.push({polygons:Le,bounds:ke,depth:pe+1}):F(Le,ke)}if(qe.length){let ke=[new lt(_e===0?Xe:Ee.x,_e===1?Xe:Ee.y),Oe];Y.length>pe+1?le.push({polygons:qe,bounds:ke,depth:pe+1}):F(qe,ke)}}return O}(t,e,Math.ceil((d-u)/11.25),Math.ceil((p-_)/11.25),1,(y,b,T)=>{if(y===0)return .5*(b+T);{let I=ri((n.y+b/it)/a);return(ra(.5*(ri((n.y+T/it)/a)+I))*a-n.y)*it}})}function _B(t,e,n,a,u,d){let p=Math.pow(2,a.z-u.z);for(let _=0;_<n;_++){let y=t.int16[2*(_+e)+0],b=t.int16[2*(_+e)+1];y=(y+u.x*it)*p-a.x*it,b=(b+u.y*it)*p-a.y*it,d.push(new lt(y,b))}}J(c0,"FillExtrusionBucket",{omit:["layers","features"]}),J(sM,"PartData"),J(oM,"FootprintSegment"),J(aM,"BorderCentroidData"),J(cM,"GroundEffect");let yB=new On({visibility:new Be(Te["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Be(Te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var vB={paint:new On({"fill-extrusion-opacity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Be(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Be(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ut(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Be(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Be(Te["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Be(Te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Be(Te["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Be(Te["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:yB};function Hm(t,e){return t.x*e.x+t.y*e.y}function _M(t,e){if(t.length===1){let n=0,a=e[n++],u;for(;!u||a.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){let d=e[n],p=t[0],_=u.sub(a),y=d.sub(a),b=p.sub(a),T=Hm(_,_),I=Hm(_,y),D=Hm(y,y),R=Hm(b,_),O=Hm(b,y),F=T*D-I*I,z=(D*R-I*O)/F,j=(T*O-I*R)/F,X=a.z*(1-z-j)+u.z*z+d.z*j;if(isFinite(X))return X}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function yM(t,e,n,a,u,d,p,_){let y=p*u.getElevationAt(t,e,!0,!0),b=d[0]!==0,T=b?d[1]===0?p*(d[0]/7-450):p*function(I,D,R){let O=Math.floor(D[0]/8),F=Math.floor(D[1]/8),z=10*(D[0]-8*O),j=10*(D[1]-8*F),X=I.getElevationAt(O,F,!0,!0),Y=I.getMeterToDEM(R),K=Math.floor(.5*(z*Y-1)),le=Math.floor(.5*(j*Y-1)),se=I.tileCoordToPixel(O,F),pe=2*K+1,_e=2*le+1,Ee=function(qe,ke,We,Je,Ze){return[qe.getElevationAtPixel(ke,We,!0),qe.getElevationAtPixel(ke+Ze,We,!0),qe.getElevationAtPixel(ke,We+Ze,!0),qe.getElevationAtPixel(ke+Je,We+Ze,!0)]}(I,se.x-K,se.y-le,pe,_e),Oe=Math.abs(Ee[0]-Ee[1]),De=Math.abs(Ee[2]-Ee[3]),Ne=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),Xe=Math.min(.25,.5*Y*(Oe+De)/pe),Le=Math.min(.25,.5*Y*Ne/_e);return X+Math.max(Xe*z,Le*j)}(u,d,_):y;return{base:y+(n===0)?-1:n,top:b?Math.max(T+a,y+n+2):y+a}}let xB=Mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:bB}=xB,wB=Mn([{name:"a_packed",components:4,type:"Float32"}]),{members:EB}=wB,TB=Mn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:SB}=TB,CB=Mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),IB=Mn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),DB=Mn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let cw=Mn([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),vM=Mn([{name:"a_z_offset",components:1,type:"Float32"}],4),MB=Mn([{name:"a_texb",components:2,type:"Uint16"}]),AB=Mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),PB=Mn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let xM=Mn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),RB=Mn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mn([{name:"triangle",components:3,type:"Uint16"}]),Mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Mn([{type:"Float32",name:"offsetX"}]),Mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class bM{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new mc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=Op(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let u=[],d=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,_=!0;u.push({left:d,right:p,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){_=!_;let T=e[b];d=y*a,y+=T,p=y*a,u.push({left:d,right:p,isDash:_,zeroLength:T===0})}return u}addRoundDash(e,n,a){let u=n/2;for(let d=-a;d<=a;d++){let p=this.width*(this.nextRow+a+d),_=0,y=e[_];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++_]);let T=Math.abs(b-y.left),I=Math.abs(b-y.right),D=Math.min(T,I),R,O=d/a*(u+1);if(y.isDash){let F=u-Math.abs(O);R=Math.sqrt(D*D+F*F)}else R=u-Math.sqrt(D*D+O*O);this.image.data[p+b]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let b=e[y],T=e[y+1];b.zeroLength?e.splice(y,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(y,1))}let a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);let d=this.width*this.nextRow,p=0,_=e[p];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++p]);let b=Math.abs(y-_.left),T=Math.abs(y-_.right),I=Math.min(b,T);this.image.data[d+y]=Math.max(0,Math.min(255,(_.isDash?I:-I)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let u=n==="round",d=u?7:0,p=2*d+1;if(this.nextRow+p>this.height)return Sr("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let T=0;T<e.length;T++)e[T]<0&&(Sr("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),_+=e[T];if(_!==0){let T=this.width/_,I=this.getDashRanges(e,this.width,T);u?this.addRoundDash(I,T,d):this.addRegularDash(I,n==="square"?.5*T:0)}let y=this.nextRow+d;this.nextRow+=p;let b={tl:[y,d],br:[_,0]};return this.positions[a]=b,b}}J(bM,"LineAtlas");let OB=i0.types,kB=Math.cos(Math.PI/180*37.5),LB=Math.cos(Math.PI/180*5);class u0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new fb,this.layoutVertexArray2=new ac,this.patternVertexArray=new lc,this.indexArray=new Zr,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new fr,this.maxLineLength=0,this.zOffsetVertexArray=new Ju,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:it/64}updateFootprints(e,n){}populate(e,n,a,u){this.hasPattern=nw("line",this.layers,n);let d=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let _=[];for(let{feature:I,id:D,index:R,sourceLayerIndex:O}of e){let F=this.layers[0]._featureFilter.needGeometry,z=Qa(I,F);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),z,a))continue;let j=d?d.evaluate(z,{},a):void 0,X={id:D,properties:I.properties,type:I.type,sourceLayerIndex:O,index:R,geometry:F?z.geometry:vs(I,a,u),patterns:{},sortKey:j};_.push(X)}d&&_.sort((I,D)=>I.sortKey-D.sortKey);let{lineAtlas:y,featureIndex:b}=n,T=this.addConstantDashes(y);for(let I of _){let{geometry:D,index:R,sourceLayerIndex:O}=I;if(T&&this.addFeatureDashes(I,y),this.hasPattern){let F=rw("line",this.layers,I,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(I,D,R,a,y.positions,n.availableImages,n.brightness);b.insert(e[R].feature,D,R,O,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")n=!0;else{let p=d.value,_=u.value;if(!_)continue;e.addDash(_,p)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let u of this.layers){let d=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let _,y;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:a},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(_,y),e.patterns[u.id]=n.getKey(_,y)}}update(e,n,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,n,a,u,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,EB)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,SB)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,vM.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bB),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,u,d,p,_){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),I=y.get("line-miter-limit"),D=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let R of n)this.addLine(R,e,u,b,T,I,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,_)}addLine(e,n,a,u,d,p,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},b=this.layers[0].layout,T=u==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<e.length-1;se++)this.totalDistance+=e[se].dist(e[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let I=OB[n.type]==="Polygon",D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let R=0;for(;R<D-1&&e[R].equals(e[R+1]);)R++;if(D<(I?3:2))return;u==="bevel"&&(p=1.05);let O=this.overscaling<=16?15*it/(512*this.overscaling):0,F=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),z,j,X,Y,K,le;this.e1=this.e2=-1,I&&(z=e[D-2],K=e[R].sub(z)._unit()._perp());for(let se=R;se<D;se++){if(X=se===D-1?I?e[R+1]:void 0:e[se+1],X&&e[se].equals(X))continue;if(K&&(Y=K),z&&(j=z),z=e[se],this.hasZOffset){let ke=b.get("line-z-offset").value;if(ke.kind==="constant")le=ke.value;else{if(this.lineClips){let We=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(We*this.lineClips.start+this.distance+(j?j.dist(z):0))/We}else Sr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;le=ke.evaluate(y,n)}le=le||0}K=X?X.sub(z)._unit()._perp():Y,Y=Y||K;let pe=j&&X,_e=pe?u:I||T?"butt":d,Ee=Y.x*K.x+Y.y*K.y;if(T){let ke=function(We){if(We.patternJoinNone){let Je=We.segmentPoints.length/2,Ze=We.lineSoFar-We.segmentStart;for(let ht=0;ht<Je;++ht){let Ye=We.segmentPoints[2*ht+1],tt=Math.round(We.segmentPoints[2*ht])+.5+.25*Ye;We.patternVertexArray.emplaceBack(tt,Ze,We.segmentStart),We.patternVertexArray.emplaceBack(tt,Ze,We.segmentStart)}We.segmentPoints.length=0}We.e1=We.e2=-1};if(pe&&Ee<LB){this.updateDistance(j,z),this.addCurrentVertex(z,Y,1,1,F,le),ke(this),this.addCurrentVertex(z,K,-1,-1,F,le);continue}if(j){if(!X){this.updateDistance(j,z),this.addCurrentVertex(z,Y,1,1,F,le),ke(this);continue}_e="miter"}}let Oe=Y.add(K);Oe.x===0&&Oe.y===0||Oe._unit();let De=Oe.x*K.x+Oe.y*K.y,Ne=De!==0?1/De:1/0,Xe=2*Math.sqrt(2-2*De),Le=De<kB&&j&&X,qe=Y.x*K.y-Y.y*K.x>0;if(Le&&se>R){let ke=z.dist(j);if(ke>2*O){let We=z.sub(z.sub(j)._mult(O/ke)._round());this.updateDistance(j,We),this.addCurrentVertex(We,Y,0,0,F,le),j=We}}if(pe&&_e==="round"&&(Ne<_?_e="miter":Ne<=2&&(_e="fakeround")),_e==="miter"&&Ne>p&&(_e="bevel"),_e==="bevel"&&(Ne>2&&(_e="flipbevel"),Ne<p&&(_e="miter")),j&&this.updateDistance(j,z),_e==="miter")Oe._mult(Ne),this.addCurrentVertex(z,Oe,0,0,F,le);else if(_e==="flipbevel"){if(Ne>100)Oe=K.mult(-1);else{let ke=Ne*Y.add(K).mag()/Y.sub(K).mag();Oe._perp()._mult(ke*(qe?-1:1))}this.addCurrentVertex(z,Oe,0,0,F,le),this.addCurrentVertex(z,Oe.mult(-1),0,0,F,le)}else if(_e==="bevel"||_e==="fakeround"){let ke=-Math.sqrt(Ne*Ne-1),We=qe?ke:0,Je=qe?0:ke;if(j&&this.addCurrentVertex(z,Y,We,Je,F,le),_e==="fakeround"){let Ze=Math.round(180*Xe/Math.PI/20);for(let ht=1;ht<Ze;ht++){let Ye=ht/Ze;if(Ye!==.5){let Tt=Ye-.5;Ye+=Ye*Tt*(Ye-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Tt*Tt+(.848013+Ee*(.215638*Ee-1.06021)))}let tt=K.sub(Y)._mult(Ye)._add(Y)._unit()._mult(qe?-1:1);this.addHalfVertex(z,tt.x,tt.y,!1,qe,0,F,le)}}X&&this.addCurrentVertex(z,K,-We,-Je,F,le)}else _e==="butt"?this.addCurrentVertex(z,Oe,0,0,F,le):_e==="square"?(j||this.addCurrentVertex(z,Oe,-1,-1,F,le),this.addCurrentVertex(z,Oe,0,0,F,le),j&&this.addCurrentVertex(z,Oe,1,1,F,le)):_e==="round"&&(j&&(this.addCurrentVertex(z,Y,0,0,F,le),this.addCurrentVertex(z,Y,1,1,F,le,!0)),X&&(this.addCurrentVertex(z,K,-1,-1,F,le,!0),this.addCurrentVertex(z,K,0,0,F,le)));if(Le&&se<D-1){let ke=z.dist(X);if(ke>2*O){let We=z.add(X.sub(z)._mult(O/ke)._round());this.updateDistance(z,We),this.addCurrentVertex(We,K,0,0,F,le),z=We}}}}addVerticesTo(e,n,a,u,d,p,_,y,b,T){let I=(n.w-e.w)/this.tessellationStep|0;if(I>1){this.lineSoFar=e.w;let D=(n.x-e.x)/I,R=(n.y-e.y)/I,O=(n.z-e.z)/I,F=(n.w-e.w)/I;for(let z=1;z<I;++z)e.x+=D,e.y+=R,e.z+=O,this.lineSoFar+=F,this.addHalfVertex(e,a,u,T,!1,_,b,e.z),this.addHalfVertex(e,d,p,T,!0,-y,b,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,a,u,T,!1,_,b,n.z),this.addHalfVertex(n,d,p,T,!0,-y,b,n.z)}addCurrentVertex(e,n,a,u,d,p,_=!1){let y=n.x+n.y*a,b=n.y-n.x*a,T=n.y*u-n.x,I=-n.y-n.x*u;if(p!=null){let R=it+10,O=p,F=new jD(e.x,e.y,O,this.lineSoFar),z=wM(e,-10,R),j=this.lineSoFar;if(this.currentVertex)if(z){let X=this.currentVertexIsOutside,Y=this.currentVertex,K=new jD(e.x,e.y,O,this.lineSoFar);$D(Y,K,-10,R),wM(K,-10,R)||(X&&(this.e1=this.e2=-1,this.lineSoFar=Y.w,this.addHalfVertex(Y,y,b,_,!1,a,d,Y.z),this.addHalfVertex(Y,T,I,_,!0,-u,d,Y.z)),this.addVerticesTo(Y,K,y,b,T,I,a,u,d,_))}else{let X=this.currentVertex;this.currentVertexIsOutside&&($D(X,F,-10,R),this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,y,b,_,!1,a,d,X.z),this.addHalfVertex(X,T,I,_,!0,-u,d,X.z)),this.addVerticesTo(X,F,y,b,T,I,a,u,d,_)}else z||(this.addHalfVertex(e,y,b,_,!1,a,d,p),this.addHalfVertex(e,T,I,_,!0,-u,d,p));this.currentVertex=F,this.currentVertexIsOutside=z,this.lineSoFar=j}else this.addHalfVertex(e,y,b,_,!1,a,d,p),this.addHalfVertex(e,T,I,_,!0,-u,d,p)}addHalfVertex({x:e,y:n},a,u,d,p,_,y,b){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let T=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),y.primitiveLength++),p?this.e2=T:this.e1=T,b!=null&&this.zOffsetVertexArray.emplaceBack(b)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function wM(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}J(u0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let FB=new On({"line-cap":new ut(Te.layout_line["line-cap"]),"line-join":new ut(Te.layout_line["line-join"]),"line-miter-limit":new Be(Te.layout_line["line-miter-limit"]),"line-round-limit":new Be(Te.layout_line["line-round-limit"]),"line-sort-key":new ut(Te.layout_line["line-sort-key"]),"line-z-offset":new ut(Te.layout_line["line-z-offset"]),visibility:new Be(Te.layout_line.visibility)});var h0={paint:new On({"line-opacity":new ut(Te.paint_line["line-opacity"]),"line-color":new ut(Te.paint_line["line-color"]),"line-translate":new Be(Te.paint_line["line-translate"]),"line-translate-anchor":new Be(Te.paint_line["line-translate-anchor"]),"line-width":new ut(Te.paint_line["line-width"]),"line-gap-width":new ut(Te.paint_line["line-gap-width"]),"line-offset":new ut(Te.paint_line["line-offset"]),"line-blur":new ut(Te.paint_line["line-blur"]),"line-dasharray":new ut(Te.paint_line["line-dasharray"]),"line-pattern":new ut(Te.paint_line["line-pattern"]),"line-gradient":new Br(Te.paint_line["line-gradient"]),"line-trim-offset":new Be(Te.paint_line["line-trim-offset"]),"line-trim-fade-range":new Be(Te.paint_line["line-trim-fade-range"]),"line-trim-color":new Be(Te.paint_line["line-trim-color"]),"line-emissive-strength":new Be(Te.paint_line["line-emissive-strength"]),"line-border-width":new ut(Te.paint_line["line-border-width"]),"line-border-color":new ut(Te.paint_line["line-border-color"]),"line-occlusion-opacity":new Be(Te.paint_line["line-occlusion-opacity"])}),layout:FB};function EM(t,e,n){return e*(it/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function TM(t,e){return 1/EM(t,1,e.tileZoom)}function SM(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let CM=t=>{let e=[];IM(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",u=!!t.paint.get("line-pattern").constantOr(1);return a&&u&&e.push("LINE_JOIN_NONE"),e};function IM(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class DM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var NB={read:function(t,e,n,a,u){var d,p,_=8*u-a-1,y=(1<<_)-1,b=y>>1,T=-7,I=n?u-1:0,D=n?-1:1,R=t[e+I];for(I+=D,d=R&(1<<-T)-1,R>>=-T,T+=_;T>0;d=256*d+t[e+I],I+=D,T-=8);for(p=d&(1<<-T)-1,d>>=-T,T+=a;T>0;p=256*p+t[e+I],I+=D,T-=8);if(d===0)d=1-b;else{if(d===y)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,a),d-=b}return(R?-1:1)*p*Math.pow(2,d-a)},write:function(t,e,n,a,u,d){var p,_,y,b=8*d-u-1,T=(1<<b)-1,I=T>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:d-1,O=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+I>=1?D/y:D*Math.pow(2,1-I))*y>=2&&(p++,y/=2),p+I>=T?(_=0,p=T):p+I>=1?(_=(e*y-1)*Math.pow(2,u),p+=I):(_=e*Math.pow(2,I-1)*Math.pow(2,u),p=0));u>=8;t[n+R]=255&_,R+=O,_/=256,u-=8);for(p=p<<u|_,b+=u;b>0;t[n+R]=255&p,R+=O,p/=256,b-=8);t[n+R-O]|=128*F}},MM=sr,d0=NB;function sr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}sr.Varint=0,sr.Fixed64=1,sr.Bytes=2,sr.Fixed32=5;var uw=4294967296,AM=1/uw,PM=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function tl(t){return t.type===sr.Bytes?t.readVarint()+t.pos:t.pos+1}function Qd(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function RM(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var u=n.pos-1;u>=t;u--)n.buf[u+a]=n.buf[u]}function zB(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function BB(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function VB(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function jB(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function UB(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function $B(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function GB(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function HB(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function qB(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function f0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Jd(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function OM(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}sr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),u=a>>3,d=this.pos;this.type=7&a,t(u,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=f0(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=OM(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=f0(this.buf,this.pos)+f0(this.buf,this.pos+4)*uw;return this.pos+=8,t},readSFixed64:function(){var t=f0(this.buf,this.pos)+OM(this.buf,this.pos+4)*uw;return this.pos+=8,t},readFloat:function(){var t=d0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=d0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(u,d,p){var _,y,b=p.buf;if(_=(112&(y=b[p.pos++]))>>4,y<128||(_|=(127&(y=b[p.pos++]))<<3,y<128)||(_|=(127&(y=b[p.pos++]))<<10,y<128)||(_|=(127&(y=b[p.pos++]))<<17,y<128)||(_|=(127&(y=b[p.pos++]))<<24,y<128)||(_|=(1&(y=b[p.pos++]))<<31,y<128))return Qd(u,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&PM?function(n,a,u){return PM.decode(n.subarray(a,u))}(this.buf,e,t):function(n,a,u){for(var d="",p=a;p<u;){var _,y,b,T=n[p],I=null,D=T>239?4:T>223?3:T>191?2:1;if(p+D>u)break;D===1?T<128&&(I=T):D===2?(192&(_=n[p+1]))==128&&(I=(31&T)<<6|63&_)<=127&&(I=null):D===3?(y=n[p+2],(192&(_=n[p+1]))==128&&(192&y)==128&&((I=(15&T)<<12|(63&_)<<6|63&y)<=2047||I>=55296&&I<=57343)&&(I=null)):D===4&&(y=n[p+2],b=n[p+3],(192&(_=n[p+1]))==128&&(192&y)==128&&(192&b)==128&&((I=(15&T)<<18|(63&_)<<12|(63&y)<<6|63&b)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,D=1):I>65535&&(I-=65536,d+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),d+=String.fromCharCode(I),p+=D}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==sr.Bytes)return t.push(this.readVarint(e));var n=tl(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==sr.Bytes)return t.push(this.readSVarint());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==sr.Bytes)return t.push(this.readBoolean());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==sr.Bytes)return t.push(this.readFloat());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==sr.Bytes)return t.push(this.readDouble());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==sr.Bytes)return t.push(this.readFixed32());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==sr.Bytes)return t.push(this.readSFixed32());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==sr.Bytes)return t.push(this.readFixed64());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==sr.Bytes)return t.push(this.readSFixed64());var e=tl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===sr.Varint)for(;this.buf[this.pos++]>127;);else if(e===sr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===sr.Fixed32)this.pos+=4;else{if(e!==sr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Jd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Jd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Jd(this.buf,-1&t,this.pos),Jd(this.buf,Math.floor(t*AM),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Jd(this.buf,-1&t,this.pos),Jd(this.buf,Math.floor(t*AM),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,p,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(a,0,n),function(d,p){var _=(7&d)<<4;p.buf[p.pos++]|=_|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,u,d){for(var p,_,y=0;y<u.length;y++){if((p=u.charCodeAt(y))>55295&&p<57344){if(!_){p>56319||y+1===u.length?(a[d++]=239,a[d++]=191,a[d++]=189):_=p;continue}if(p<56320){a[d++]=239,a[d++]=191,a[d++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(a[d++]=239,a[d++]=191,a[d++]=189,_=null);p<128?a[d++]=p:(p<2048?a[d++]=p>>6|192:(p<65536?a[d++]=p>>12|224:(a[d++]=p>>18|240,a[d++]=p>>12&63|128),a[d++]=p>>6&63|128),a[d++]=63&p|128)}return d}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&RM(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),d0.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),d0.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&RM(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,sr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,zB,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,BB,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,UB,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,VB,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,jB,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,$B,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,GB,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,HB,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,qB,e)},writeBytesField:function(t,e){this.writeTag(t,sr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,sr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,sr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,sr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,sr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,sr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,sr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,sr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,sr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,sr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var ef=ze(MM);let WB=["id","tile","layer","source","sourceLayer","state"];class kM{constructor(e,n,a,u,d){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of WB)this[n]!==void 0&&(e[n]=this[n]);return e}}class ZB{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){let u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},fi(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(let d in this.state[e][u])a[d]||(this.deletedStates[e][u][d]=null)}else for(let d in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;let u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){let a=String(n),u=fi({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let d=this.deletedStates[e][n];if(d===null)return{};for(let p in d)delete u[p]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let a={};for(let u in this.stateChanges){this.state[u]=this.state[u]||{};let d={};for(let p in this.stateChanges[u])this.state[u][p]||(this.state[u][p]={}),fi(this.state[u][p],this.stateChanges[u][p]),d[p]=this.state[u][p];a[u]=d}for(let u in this.deletedStates){this.state[u]=this.state[u]||{};let d={};if(this.deletedStates[u]===null)for(let p in this.state[u])d[p]={},this.state[u][p]={};else for(let p in this.deletedStates[u]){if(this.deletedStates[u][p]===null)this.state[u][p]={};else if(this.state[u][p])for(let _ of Object.keys(this.deletedStates[u][p]))delete this.state[u][p][_];d[p]=this.state[u][p]}a[u]=a[u]||{},fi(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let u in e)e[u].setFeatureState(a,n)}}class LM{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ue(it,16,0),this.featureIndexArray=new WI,this.promoteId=n,this.is3DTile=!1}insert(e,n,a,u,d,p=0,_=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,d,p);let b=this.grid;for(let T=0;T<n.length;T++){let I=n[T],D=[1/0,1/0,-1/0,-1/0];for(let R=0;R<I.length;R++){let O=I[R];D[0]=Math.min(D[0],O.x),D[1]=Math.min(D[1],O.y),D[2]=Math.max(D[2],O.x),D[3]=Math.max(D[3],O.y)}_!==0&&(D[0]-=_,D[1]-=_,D[2]+=_,D[3]+=_),D[0]<it&&D[1]<it&&D[2]>=0&&D[3]>=0&&b.insert(y,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ow(new ef(this.rawTileData)).layers,this.sourceLayerCoder=new DM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,u){this.loadVTLayers();let d=e.params||{},p=Ci(d.filter),_=e.tileResult,y=e.transform,b=_.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(O,F,z,j)=>uD(_.bufferedTilespaceGeometry,O,F,z,j));T.sort(XB);let I=null;y.elevation&&T.length>0&&(I=Kd.create(y.elevation,this.tileID));let D={},R;for(let O=0;O<T.length;O++){let F=T[O];if(F===R)continue;R=F;let z=this.featureIndexArray.get(F),j=null;if(this.is3DTile){let X=this.bucketLayerIDs[0][0],Y=n[X];if(Y.type!=="model")continue;let{queryFeature:K,intersectionZ:le}=Y.queryIntersectsMatchingFeature(_,z.featureIndex,p,y);K&&this.appendToResult(D,X,z.featureIndex,K,le)}else this.loadMatchingFeature(D,z,p,d.layers,d.availableImages,n,a,u,(X,Y,K,le=0)=>(j||(j=vs(X,this.tileID.canonical,e.tileTransform)),Y.queryIntersectsFeature(_,X,K,j,this.z,e.transform,e.pixelPosMatrix,I,le)))}return D}loadMatchingFeature(e,n,a,u,d,p,_,y,b){let{featureIndex:T,bucketIndex:I,sourceLayerIndex:D,layoutVertexArrayOffset:R}=n,O=this.bucketLayerIDs[I];if(u&&!function(X,Y){for(let K=0;K<X.length;K++)if(Y.indexOf(X[K])>=0)return!0;return!1}(u,O))return;let F=this.sourceLayerCoder.decode(D),z=this.vtLayers[F].feature(T);if(a.needGeometry){let X=Qa(z,!0);if(!a.filter(new Bt(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!a.filter(new Bt(this.tileID.overscaledZ),z))return;let j=this.getId(z,F);for(let X=0;X<O.length;X++){let Y=O[X];if(u&&u.indexOf(Y)<0)continue;let K=p[Y];if(!K)continue;let le={};j!==void 0&&y&&(le=y.getState(K.sourceLayer||"_geojsonTileLayer",j));let se=!b||b(z,K,le,R);if(!se)continue;let pe=new kM(z,this.z,this.x,this.y,j),_e=fi({},_[Y]);_e.paint=FM(_e.paint,K.paint,z,le,d),_e.layout=FM(_e.layout,K.layout,z,le,d),pe.layer=_e,this.appendToResult(e,Y,T,pe,se)}}appendToResult(e,n,a,u,d){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:a,feature:u,intersectionZ:d})}lookupSymbolFeatures(e,n,a,u,d,p,_,y){let b={};this.loadVTLayers();let T=Ci(d);for(let I of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},T,p,_,y,n);return b}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let u=this.sourceLayerCoder.decode(a),d=this.vtFeatures[u];if(d[n])return d[n];let p=this.vtLayers[u].feature(n);return d[n]=p,p}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function FM(t,e,n,a,u){return zl(t,(d,p)=>{let _=e instanceof un?e.get(p):null;return _&&_.evaluate?_.evaluate(n,a,u):_})}function XB(t,e){return e-t}J(LM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var _i=24;let xs=128;function hw(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Bt(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:u}=n,d=0;for(;d<a.length&&a[d]<=t;)d++;d=Math.max(0,d-1);let p=d;for(;p<a.length&&a[p]<t+1;)p++;p=Math.min(a.length-1,p);let _=a[d],y=a[p];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:y,minSize:n.evaluate(new Bt(_)),maxSize:n.evaluate(new Bt(y)),interpolationType:u}}}function p0(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:u}){return t.kind==="source"?a/xs:t.kind==="composite"?It(a/xs,u/xs,n):e}function tf(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:u,minZoom:d,maxZoom:p}=t,_=u?Qt(Xi.interpolationFactor(u,e,d,p),0,1):0;t.kind==="camera"?a=It(t.minSize,t.maxSize,_):n=_}return{uSizeT:n,uSize:a}}var YB=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:xs,evaluateSizeForFeature:p0,evaluateSizeForZoom:tf,getSizeData:hw});function KB(t,e,n){return t.sections.forEach(a=>{a.text=function(u,d,p){let _=d.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),Rn.applyArabicShaping&&(u=Rn.applyArabicShaping(u)),u}(a.text,e,n)}),t}let qm={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function QB(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function JB(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let dw=3;function e5(t,e,n){e.glyphs=[],t===1&&n.readMessage(t5,e)}function t5(t,e,n){if(t===3){let{id:a,bitmap:u,width:d,height:p,left:_,top:y,advance:b}=n.readMessage(n5,{});e.glyphs.push({id:a,bitmap:new mc({width:d+2*dw,height:p+2*dw},u),metrics:{width:d,height:p,left:_,top:y,advance:b}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function n5(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let NM=dw,Po={horizontal:1,vertical:2,horizontalOnly:3};class Wm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new Wm;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new Wm;return n.imageName=e,n}}class nf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new nf;for(let u=0;u<e.sections.length;u++){let d=e.sections[u];d.image?a.addImageSection(d):a.addTextSection(d,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let u="";for(let d=0;d<n.length;d++){let p=n.charCodeAt(d+1)||null,_=n.charCodeAt(d-1)||null;u+=!a&&(p&&Ve(p)&&!qm[n[d+1]]||_&&Ve(_)&&!qm[n[d-1]])||!qm[n[d]]?n[d]:qm[n[d]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&m0[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&m0[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new nf;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Wm.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Sr("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Wm.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Sr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fw(t,e,n,a,u,d,p,_,y,b,T,I,D,R,O){let F=nf.fromFeature(t,u);I===Po.vertical&&F.verticalizePunctuation(D);let z=[],j=function(se,pe,_e,Ee,Oe,De){if(!se)return[];let Ne=[],Xe=function(We,Je,Ze,ht,Ye,tt){let Tt=0;for(let yt=0;yt<We.length();yt++){let gt=We.getSection(yt);Tt+=zM(We.getCodePoint(yt),gt,ht,Ye,Je,tt)}return Tt/Math.max(1,Math.ceil(Tt/Ze))}(se,pe,_e,Ee,Oe,De),Le=se.text.indexOf("\u200B")>=0,qe=0;for(let We=0;We<se.length();We++){let Je=se.getSection(We),Ze=se.getCodePoint(We);if(m0[Ze]||(qe+=zM(Ze,Je,Ee,Oe,pe,De)),We<se.length()-1){let ht=!((ke=Ze)<11904||!(ae["Bopomofo Extended"](ke)||ae.Bopomofo(ke)||ae["CJK Compatibility Forms"](ke)||ae["CJK Compatibility Ideographs"](ke)||ae["CJK Compatibility"](ke)||ae["CJK Radicals Supplement"](ke)||ae["CJK Strokes"](ke)||ae["CJK Symbols and Punctuation"](ke)||ae["CJK Unified Ideographs Extension A"](ke)||ae["CJK Unified Ideographs"](ke)||ae["Enclosed CJK Letters and Months"](ke)||ae["Halfwidth and Fullwidth Forms"](ke)||ae.Hiragana(ke)||ae["Ideographic Description Characters"](ke)||ae["Kangxi Radicals"](ke)||ae["Katakana Phonetic Extensions"](ke)||ae.Katakana(ke)||ae["Vertical Forms"](ke)||ae["Yi Radicals"](ke)||ae["Yi Syllables"](ke)));(r5[Ze]||ht||Je.imageName)&&Ne.push(VM(We+1,qe,Xe,Ne,i5(Ze,se.getCodePoint(We+1),ht&&Le),!1))}}var ke;return jM(VM(se.length(),qe,Xe,Ne,0,!0))}(F,b,d,e,a,R),{processBidirectionalText:X,processStyledBidirectionalText:Y}=Rn;if(X&&F.sections.length===1){let se=X(F.toString(),j);for(let pe of se){let _e=new nf;_e.text=pe,_e.sections=F.sections;for(let Ee=0;Ee<pe.length;Ee++)_e.sectionIndex.push(0);z.push(_e)}}else if(Y){let se=Y(F.text,F.sectionIndex,j);for(let pe of se){let _e=new nf;_e.text=pe[0],_e.sectionIndex=pe[1],_e.sections=F.sections,z.push(_e)}}else z=function(se,pe){let _e=[],Ee=se.text,Oe=0;for(let De of pe)_e.push(se.substring(Oe,De)),Oe=De;return Oe<Ee.length&&_e.push(se.substring(Oe,Ee.length)),_e}(F,j);let K=[],le={positionedLines:K,text:F.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We){let Je=0,Ze=0,ht=0,Ye=Xe==="right"?1:Xe==="left"?0:.5,tt=!1;for(let qt of Oe){let At=qt.getSections();for(let Xt of At){if(Xt.imageName)continue;let Wt=pe[Xt.fontStack];if(Wt&&(tt=Wt.ascender!==void 0&&Wt.descender!==void 0,!tt))break}if(!tt)break}let Tt=0;for(let qt of Oe){qt.trim();let At=qt.getMaxScale(),Xt=(At-1)*_i,Wt={positionedGlyphs:[],lineOffset:0};se.positionedLines[Tt]=Wt;let nn=Wt.positionedGlyphs,Dt=0;if(!qt.length()){Ze+=De,++Tt;continue}let jn=0,Bn=0;for(let hn=0;hn<qt.length();hn++){let Sn=qt.getSection(hn),Yn=qt.getSectionIndex(hn),Hn=qt.getCodePoint(hn),yr=Sn.scale,mr=null,Di=null,wr=null,ar=_i,kr=0,ii=!(Le===Po.horizontal||!ke&&!Ge(Hn)||ke&&(m0[Hn]||(yt=Hn,ae.Arabic(yt)||ae["Arabic Supplement"](yt)||ae["Arabic Extended-A"](yt)||ae["Arabic Presentation Forms-A"](yt)||ae["Arabic Presentation Forms-B"](yt))));if(Sn.imageName){let oi=Ee[Sn.imageName];if(!oi)continue;wr=Sn.imageName,se.iconsInText=se.iconsInText||!0,Di=oi.paddedRect;let Wn=oi.displaySize;yr=yr*_i/We,mr={width:Wn[0],height:Wn[1],left:0,top:-NM,advance:ii?Wn[1]:Wn[0],localGlyph:!1},kr=tt?-mr.height*yr:At*_i-17-Wn[1]*yr,ar=mr.advance;let Hi=(ii?Wn[0]:Wn[1])*yr-_i*At;Hi>0&&Hi>Dt&&(Dt=Hi)}else{let oi=_e[Sn.fontStack];if(!oi)continue;oi[Hn]&&(Di=oi[Hn]);let Wn=pe[Sn.fontStack];if(!Wn)continue;let Hi=Wn.glyphs[Hn];if(!Hi)continue;if(mr=Hi.metrics,ar=Hn!==8203?_i:0,tt){let rl=Wn.ascender!==void 0?Math.abs(Wn.ascender):0,ts=Wn.descender!==void 0?Math.abs(Wn.descender):0,Is=(rl+ts)*yr;jn<Is&&(jn=Is,Bn=(rl-ts)/2*yr),kr=-rl*yr}else kr=(At-yr)*_i-17}ii?(se.verticalizable=!0,nn.push({glyph:Hn,imageName:wr,x:Je,y:Ze+kr,vertical:ii,scale:yr,localGlyph:mr.localGlyph,fontStack:Sn.fontStack,sectionIndex:Yn,metrics:mr,rect:Di}),Je+=ar*yr+qe):(nn.push({glyph:Hn,imageName:wr,x:Je,y:Ze+kr,vertical:ii,scale:yr,localGlyph:mr.localGlyph,fontStack:Sn.fontStack,sectionIndex:Yn,metrics:mr,rect:Di}),Je+=mr.advance*yr+qe)}nn.length!==0&&(ht=Math.max(Je-qe,ht),tt?UM(nn,Ye,Dt,Bn,De*At/2):UM(nn,Ye,Dt,0,De/2)),Je=0;let Tn=De*At+Dt;Wt.lineOffset=Math.max(Dt,Xt),Ze+=Tn,++Tt}var yt;let gt=Ze,{horizontalAlign:et,verticalAlign:St}=pw(Ne);(function(qt,At,Xt,Wt,nn,Dt){let jn=(At-Xt)*nn,Bn=-Dt*Wt;for(let Tn of qt)for(let hn of Tn.positionedGlyphs)hn.x+=jn,hn.y+=Bn})(se.positionedLines,Ye,et,St,ht,gt),se.top+=-St*gt,se.bottom=se.top+gt,se.left+=-et*ht,se.right=se.left+ht,se.hasBaseline=tt}(le,e,n,a,z,p,_,y,I,b,D,O),!function(se){for(let pe of se)if(pe.positionedGlyphs.length!==0)return!1;return!0}(K)&&le}let m0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},r5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zM(t,e,n,a,u,d){if(e.imageName){let p=a[e.imageName];return p?p.displaySize[0]*e.scale*_i/d+u:0}{let p=n[e.fontStack],_=p&&p.glyphs[t];return _?_.metrics.advance*e.scale+u:0}}function BM(t,e,n,a){let u=Math.pow(t-e,2);return a?t<e?u/2:2*u:u+Math.abs(n)*n}function i5(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function VM(t,e,n,a,u,d){let p=null,_=BM(e,n,u,d);for(let y of a){let b=BM(e-y.x,n,u,d)+y.badness;b<=_&&(p=y,_=b)}return{index:t,x:e,priorBreak:p,badness:_}}function jM(t){return t?jM(t.priorBreak).concat(t.index):[]}function pw(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function UM(t,e,n,a,u){if(!(e||n||a||u))return;let d=t.length-1,p=t[d],_=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=d;y++)t[y].x-=_,t[y].y+=n+a+u}function o5(t,e,n,a){let{horizontalAlign:u,verticalAlign:d}=pw(a),p=n[0]-t.displaySize[0]*u,_=n[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function $M(t,e,n,a,u,d){let p=t.imagePrimary,_;if(p.content){let z=p.content,j=p.pixelRatio||1;_=[z[0]/j,z[1]/j,p.displaySize[0]-z[2]/j,p.displaySize[1]-z[3]/j]}let y=e.left*d,b=e.right*d,T,I,D,R;n==="width"||n==="both"?(R=u[0]+y-a[3],I=u[0]+b+a[1]):(R=u[0]+(y+b-p.displaySize[0])/2,I=R+p.displaySize[0]);let O=e.top*d,F=e.bottom*d;return n==="height"||n==="both"?(T=u[1]+O-a[0],D=u[1]+F+a[2]):(T=u[1]+(O+F-p.displaySize[1])/2,D=T+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:T,right:I,bottom:D,left:R,collisionPadding:_}}class nl extends lt{constructor(e,n,a,u,d){super(e,n),this.angle=u,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new nl(this.x,this.y,this.z,this.angle,this.segment)}}function GM(t,e,n,a,u){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,_=0;for(;_>-n/2;){if(p--,p<0)return!1;_-=t[p].dist(d),d=t[p]}_+=t[p].dist(t[p+1]),p++;let y=[],b=0;for(;_<n/2;){let T=t[p],I=t[p+1];if(!I)return!1;let D=t[p-1].angleTo(T)-T.angleTo(I);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:D}),b+=D;_-y[0].distance>a;)b-=y.shift().angleDelta;if(b>u)return!1;p++,_+=T.dist(I)}return!0}function HM(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function qM(t,e,n){return t?.6*e*n:0}function WM(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function s5(t,e,n,a,u,d){let p=qM(n,u,d),_=WM(n,a)*d,y=0,b=HM(t)/2;for(let T=0;T<t.length-1;T++){let I=t[T],D=t[T+1],R=I.dist(D);if(y+R>b){let O=(b-y)/R,F=It(I.x,D.x,O),z=It(I.y,D.y,O),j=new nl(F,z,0,D.angleTo(I),T);return!p||GM(t,j,_,p,e)?j:void 0}y+=R}}function a5(t,e,n,a,u,d,p,_,y){let b=qM(a,d,p),T=WM(a,u),I=T*p,D=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-I<e/4&&(e=I+e/4),ZM(t,D?e/2*_%e:(T/2+2*d)*p*_%e,e,b,n,I,D,!1,y)}function ZM(t,e,n,a,u,d,p,_,y){let b=d/2,T=HM(t),I=0,D=e-n,R=[];for(let O=0;O<t.length-1;O++){let F=t[O],z=t[O+1],j=F.dist(z),X=z.angleTo(F);for(;D+n<I+j;){D+=n;let Y=(D-I)/j,K=It(F.x,z.x,Y),le=It(F.y,z.y,Y);if(K>=0&&K<y&&le>=0&&le<y&&D-b>=0&&D+b<=T){let se=new nl(K,le,0,X,O);a&&!GM(t,se,d,a,u)||R.push(se)}}I+=j}return _||R.length||p||(R=ZM(t,I/2,n,a,u,d,p,!0,y)),R}function XM(t,e,n,a,u){let d=[];for(let p=0;p<t.length;p++){let _=t[p],y;for(let b=0;b<_.length-1;b++){let T=_[b],I=_[b+1];T.x<e&&I.x<e||(T.x<e?T=new lt(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x<e&&(I=new lt(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y<n&&I.y<n||(T.y<n?T=new lt(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round():I.y<n&&(I=new lt(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round()),T.x>=a&&I.x>=a||(T.x>=a?T=new lt(a,T.y+(a-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x>=a&&(I=new lt(a,T.y+(a-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y>=u&&I.y>=u||(T.y>=u?T=new lt(T.x+(u-T.y)/(I.y-T.y)*(I.x-T.x),u)._round():I.y>=u&&(I=new lt(T.x+(u-T.y)/(I.y-T.y)*(I.x-T.x),u)._round()),y&&T.equals(y[y.length-1])||(y=[T],d.push(y)),y.push(I)))))}}return d}function YM(t){let e=0,n=0;for(let p of t)e+=p.w*p.h,n=Math.max(n,p.w);t.sort((p,_)=>_.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],u=0,d=0;for(let p of t)for(let _=a.length-1;_>=0;_--){let y=a[_];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,d=Math.max(d,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===y.w&&p.h===y.h){let b=a.pop();_<a.length&&(a[_]=b)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(a.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}J(nl,"Anchor");let fo=1;class mw{constructor(e,{pixelRatio:n,version:a,stretchX:u,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=d,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+fo,this.paddedRect.y+fo]}get br(){return[this.paddedRect.x+this.paddedRect.w-fo,this.paddedRect.y+this.paddedRect.h-fo]}get displaySize(){return[(this.paddedRect.w-2*fo)/this.pixelRatio,(this.paddedRect.h-2*fo)/this.pixelRatio]}}class KM{constructor(e,n,a){let u={},d={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,u,p),this.addImages(n,d,p);let{w:_,h:y}=YM(p),b=new Ao({width:_||1,height:y||1});for(let T in e){let I=e[T],D=u[T].paddedRect;Ao.copy(I.data,b,{x:0,y:0},{x:D.x+fo,y:D.y+fo},I.data,a,I.sdf)}for(let T in n){let I=n[T],D=d[T].paddedRect,R=D.x+fo,O=D.y+fo,F=I.data.width,z=I.data.height;Ao.copy(I.data,b,{x:0,y:0},{x:R,y:O},I.data,a),Ao.copy(I.data,b,{x:0,y:z-1},{x:R,y:O-1},{width:F,height:1},a),Ao.copy(I.data,b,{x:0,y:0},{x:R,y:O+z},{width:F,height:1},a),Ao.copy(I.data,b,{x:F-1,y:0},{x:R-1,y:O},{width:1,height:z},a),Ao.copy(I.data,b,{x:0,y:0},{x:R+F,y:O},{width:1,height:z},a)}this.image=b,this.iconPositions=u,this.patternPositions=d}addImages(e,n,a){for(let u in e){let d=e[u],p={x:0,y:0,w:d.data.width+2*fo,h:d.data.height+2*fo};a.push(p),n[u]=new mw(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let u in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,a),n),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[u,d]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:p},{x:u,y:d})}}J(mw,"ImagePosition"),J(KM,"ImageAtlas");let Zm=1e20;function QM(t,e,n,a,u,d,p,_,y){for(let b=e;b<e+a;b++)JM(t,n*d+b,d,u,p,_,y);for(let b=n;b<n+u;b++)JM(t,b*d+e,1,a,p,_,y)}function JM(t,e,n,a,u,d,p){d[0]=0,p[0]=-Zm,p[1]=Zm,u[0]=t[e];for(let _=1,y=0,b=0;_<a;_++){u[_]=t[e+_*n];let T=_*_;do{let I=d[y];b=(u[_]-u[I]+T-I*I)/(_-I)/2}while(b<=p[y]&&--y>-1);y++,d[y]=_,p[y]=b,p[y+1]=Zm}for(let _=0,y=0;_<a;_++){for(;p[y+1]<_;)y++;let b=d[y],T=_-b;t[e+_*n]=u[b]+T*T}}let bs=2,gw={none:0,ideographs:1,all:2};class rf{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){let u=[],d=this.urls[n]||A.GLYPHS_URL;for(let p in e)for(let _ of e[p])u.push({stack:p,id:_});Nl(u,({stack:p,id:_},y)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[_];if(T!==void 0)return void y(null,{stack:p,id:_,glyph:T});if(T=this._tinySDF(b,p,_),T)return b.glyphs[_]=T,void y(null,{stack:p,id:_,glyph:T});let I=Math.floor(_/256);if(256*I>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[I])return void y(null,{stack:p,id:_,glyph:T});let D=b.requests[I];D||(D=b.requests[I]=[],rf.loadGlyphRange(p,I,d,this.requestManager,(R,O)=>{if(O){b.ascender=O.ascender,b.descender=O.descender;for(let F in O.glyphs)this._doesCharSupportLocalGlyph(+F)||(b.glyphs[+F]=O.glyphs[+F]);b.ranges[I]=!0}for(let F of D)F(R,O);delete b.requests[I]})),D.push((R,O)=>{R?y(R):O&&y(null,{stack:p,id:_,glyph:O.glyphs[_]||null})})},(p,_)=>{if(p)a(p);else if(_){let y={};for(let{stack:b,id:T,glyph:I}of _)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==gw.none&&(this.localGlyphMode===gw.all?!!this.localFontFamily:!!this.localFontFamily&&(ae["CJK Unified Ideographs"](e)||ae["Hangul Syllables"](e)||ae.Hiragana(e)||ae.Katakana(e)||ae["CJK Symbols and Punctuation"](e)||ae["CJK Unified Ideographs Extension A"](e)||ae["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){let u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(n)?F="900":/medium/i.test(n)?F="500":/light/i.test(n)&&(F="200"),d=e.tinySDF=new rf.TinySDF({fontFamily:u,fontWeight:F,fontSize:24*bs,buffer:3*bs,radius:8*bs}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];let p=String.fromCodePoint(a),{data:_,width:y,height:b,glyphWidth:T,glyphHeight:I,glyphLeft:D,glyphTop:R,glyphAdvance:O}=d.draw(p);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new mc({width:y,height:b},_),metrics:{width:T/bs,height:I/bs,left:D/bs,top:R/bs-27,advance:O/bs,localGlyph:!0}}}}rf.loadGlyphRange=function(t,e,n,a,u){let d=256*e,p=d+255,_=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${d}-${p}`),md.Glyphs);Fa(_,(y,b)=>{if(y)u(y);else if(b){let T={},I=function(D){return new ef(D).readFields(e5,{})}(b);for(let D of I.glyphs)T[D.id]=D;u(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},rf.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let _=this.size=t+4*e,y=this._createCanvas(_),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${p} ${d} ${t}px ${u}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(t),p=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),y=Math.min(this.size-this.buffer,p+Math.ceil(a)),b=_+2*this.buffer,T=y+2*this.buffer,I=Math.max(b*T,0),D=new Uint8ClampedArray(I),R={data:D,width:b,height:T,glyphWidth:_,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return R;let{ctx:O,buffer:F,gridInner:z,gridOuter:j}=this;O.clearRect(F,F,_,y),O.fillText(t,F,F+p);let X=O.getImageData(F,F,_,y);j.fill(Zm,0,I),z.fill(0,0,I);for(let Y=0;Y<y;Y++)for(let K=0;K<_;K++){let le=X.data[4*(Y*_+K)+3]/255;if(le===0)continue;let se=(Y+F)*b+K+F;if(le===1)j[se]=0,z[se]=Zm;else{let pe=.5-le;j[se]=pe>0?pe*pe:0,z[se]=pe<0?pe*pe:0}}QM(j,0,0,b,T,b,this.f,this.v,this.z),QM(z,F,F,_,y,b,this.f,this.v,this.z);for(let Y=0;Y<I;Y++){let K=Math.sqrt(j[Y])-Math.sqrt(z[Y]);D[Y]=Math.round(255-255*(K/this.radius+this.cutoff))}return R}};let yc=fo;function eA(t,e,n,a){let u=[],d=t.imagePrimary,p=d.pixelRatio,_=d.paddedRect.w-2*yc,y=d.paddedRect.h-2*yc,b=t.right-t.left,T=t.bottom-t.top,I=d.stretchX||[[0,_]],D=d.stretchY||[[0,y]],R=(De,Ne)=>De+Ne[1]-Ne[0],O=I.reduce(R,0),F=D.reduce(R,0),z=_-O,j=y-F,X=0,Y=O,K=0,le=F,se=0,pe=z,_e=0,Ee=j;if(d.content&&a){let De=d.content;X=g0(I,0,De[0]),K=g0(D,0,De[1]),Y=g0(I,De[0],De[2]),le=g0(D,De[1],De[3]),se=De[0]-X,_e=De[1]-K,pe=De[2]-De[0]-Y,Ee=De[3]-De[1]-le}let Oe=(De,Ne,Xe,Le)=>{let qe=_0(De.stretch-X,Y,b,t.left),ke=y0(De.fixed-se,pe,De.stretch,O),We=_0(Ne.stretch-K,le,T,t.top),Je=y0(Ne.fixed-_e,Ee,Ne.stretch,F),Ze=_0(Xe.stretch-X,Y,b,t.left),ht=y0(Xe.fixed-se,pe,Xe.stretch,O),Ye=_0(Le.stretch-K,le,T,t.top),tt=y0(Le.fixed-_e,Ee,Le.stretch,F),Tt=new lt(qe,We),yt=new lt(Ze,We),gt=new lt(Ze,Ye),et=new lt(qe,Ye),St=new lt(ke/p,Je/p),qt=new lt(ht/p,tt/p),At=e*Math.PI/180;if(At){let Bn=Math.sin(At),Tn=Math.cos(At),hn=[Tn,-Bn,Bn,Tn];Tt._matMult(hn),yt._matMult(hn),et._matMult(hn),gt._matMult(hn)}let Xt=De.stretch+De.fixed,Wt=Xe.stretch+Xe.fixed,nn=Ne.stretch+Ne.fixed,Dt=Le.stretch+Le.fixed,jn=t.imageSecondary;return{tl:Tt,tr:yt,bl:et,br:gt,texPrimary:{x:d.paddedRect.x+yc+Xt,y:d.paddedRect.y+yc+nn,w:Wt-Xt,h:Dt-nn},texSecondary:jn?{x:jn.paddedRect.x+yc+Xt,y:jn.paddedRect.y+yc+nn,w:Wt-Xt,h:Dt-nn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:St,pixelOffsetBR:qt,minFontScaleX:pe/p/b,minFontScaleY:Ee/p/T,isSDF:n}};if(a&&(d.stretchX||d.stretchY)){let De=tA(I,z,O),Ne=tA(D,j,F);for(let Xe=0;Xe<De.length-1;Xe++){let Le=De[Xe],qe=De[Xe+1];for(let ke=0;ke<Ne.length-1;ke++)u.push(Oe(Le,Ne[ke],qe,Ne[ke+1]))}}else u.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return u}function g0(t,e,n){let a=0;for(let u of t)a+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return a}function tA(t,e,n){let a=[{fixed:-yc,stretch:0}];for(let[u,d]of t){let p=a[a.length-1];a.push({fixed:u-p.stretch,stretch:p.stretch}),a.push({fixed:u-p.stretch,stretch:p.stretch+(d-u)})}return a.push({fixed:e+yc,stretch:n}),a}function _0(t,e,n,a){return t/e*n+a}function y0(t,e,n,a){return t-e*n/a}function l5(t,e,n,a){let u=e+t.positionedLines[a].lineOffset;return a===0?n+u/2:n+(u+(e+t.positionedLines[a-1].lineOffset))/2}function c5(t,e=1,n=!1){let a=1/0,u=1/0,d=-1/0,p=-1/0,_=t[0];for(let R=0;R<_.length;R++){let O=_[R];(!R||O.x<a)&&(a=O.x),(!R||O.y<u)&&(u=O.y),(!R||O.x>d)&&(d=O.x),(!R||O.y>p)&&(p=O.y)}let y=Math.min(d-a,p-u),b=y/2,T=new lm([],u5);if(y===0)return new lt(a,u);for(let R=a;R<d;R+=y)for(let O=u;O<p;O+=y)T.push(new of(R+b,O+b,b,t));let I=function(R){let O=0,F=0,z=0,j=R[0];for(let X=0,Y=j.length,K=Y-1;X<Y;K=X++){let le=j[X],se=j[K],pe=le.x*se.y-se.x*le.y;F+=(le.x+se.x)*pe,z+=(le.y+se.y)*pe,O+=3*pe}return new of(F/O,z/O,0,R)}(t),D=T.length;for(;T.length;){let R=T.pop();(R.d>I.d||!I.d)&&(I=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,D)),R.max-I.d<=e||(b=R.h/2,T.push(new of(R.p.x-b,R.p.y-b,b,t)),T.push(new of(R.p.x+b,R.p.y-b,b,t)),T.push(new of(R.p.x-b,R.p.y+b,b,t)),T.push(new of(R.p.x+b,R.p.y+b,b,t)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${I.d}`)),I.p}function u5(t,e){return e.max-t.max}class of{constructor(e,n,a,u){this.p=new lt(e,n),this.h=a,this.d=function(d,p){let _=!1,y=1/0;for(let b=0;b<p.length;b++){let T=p[b];for(let I=0,D=T.length,R=D-1;I<D;R=I++){let O=T[I],F=T[R];O.y>d.y!=F.y>d.y&&d.x<(F.x-O.x)*(d.y-O.y)/(F.y-O.y)+O.x&&(_=!_),y=Math.min(y,lD(d,O,F))}}return(_?1:-1)*Math.sqrt(y)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}let _w=Number.POSITIVE_INFINITY,h5=Math.sqrt(2);function nA(t,[e,n]){let a=0,u=0;if(n===_w){e<0&&(e=0);let d=e/h5;switch(t){case"top-right":case"top-left":u=d-7;break;case"bottom-right":case"bottom-left":u=7-d;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function yw(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function d5(t,e,n,a,u,d,p,_,y,b,T,I,D,R,O){let F=d.textMaxSize.evaluate(e,{},I);F===void 0&&(F=p);let z=t.layers[0].layout,j=z.get("icon-offset").evaluate(e,{},I),X=iA(n.horizontal)||n.vertical,Y=D.name==="globe",K=_i,le=p/K,se=t.tilePixelRatio*F/K,pe=(qe=t.overscaling,t.zoom>18&&qe>2&&(qe>>=1),Math.max(it/(512*qe),1)*z.get("symbol-spacing")),_e=z.get("text-padding")*t.tilePixelRatio,Ee=z.get("icon-padding")*t.tilePixelRatio,Oe=ln(z.get("text-max-angle")),De=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ne=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Xe=z.get("symbol-placement"),Le=pe/2;var qe;let ke=z.get("icon-text-fit").evaluate(e,{},I),We=z.get("icon-text-fit-padding").evaluate(e,{},I),Je=ke!=="none",Ze;t.hasAnyIconTextFit===!1&&Je&&(t.hasAnyIconTextFit=!0),a&&Je&&(t.allowVerticalPlacement&&n.vertical&&(Ze=$M(a,n.vertical,ke,We,j,le)),X&&(a=$M(a,X,ke,We,j,le)));let ht=(Ye,tt,Tt)=>{if(tt.x<0||tt.x>=it||tt.y<0||tt.y>=it)return;let yt=null;if(Y){let{x:gt,y:et,z:St}=D.projectTilePoint(tt.x,tt.y,Tt);yt={anchor:new nl(gt,et,St,0,void 0),up:D.upVector(Tt,tt.x,tt.y)}}(function(gt,et,St,qt,At,Xt,Wt,nn,Dt,jn,Bn,Tn,hn,Sn,Yn,Hn,yr,mr,Di,wr,ar,kr,ii,oi,Wn,Hi,rl){let ts=gt.addToLineVertexArray(et,qt),Is,Sc,Cc,dh,o2,s2,a2,l2=0,c2=0,u2=0,h2=0,Ww=-1,Zw=-1,la={},d2=Hl(""),fh=St?St.anchor:et,Xw=Dt.layout.get("icon-text-fit").evaluate(ar,{},Wn)!=="none",Yw=0,Kw=0;if(Dt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Yw,Kw]=Dt.layout.get("text-offset").evaluate(ar,{},Wn).map(mo=>mo*_i):(Yw=Dt.layout.get("text-radial-offset").evaluate(ar,{},Wn)*_i,Kw=_w),gt.allowVerticalPlacement&&At.vertical){let mo=At.vertical;if(Yn)s2=vw(mo),nn&&(a2=vw(nn));else{let go=Dt.layout.get("text-rotate").evaluate(ar,{},Wn)+90;Cc=v0(jn,fh,et,Bn,Tn,hn,mo,Sn,go,Hn),nn&&(dh=v0(jn,fh,et,Bn,Tn,hn,nn,mr,go))}}if(Xt){let mo=Dt.layout.get("icon-rotate").evaluate(ar,{},Wn),go=eA(Xt,mo,ii,Xw),pf=nn?eA(nn,mo,ii,Xw):void 0;Sc=v0(jn,fh,et,Bn,Tn,hn,Xt,mr,mo),l2=4*go.length;let f2=gt.iconSizeData,ph=null;f2.kind==="source"?(ph=[xs*Dt.layout.get("icon-size").evaluate(ar,{},Wn)],ph[0]>vc&&Sr(`${gt.layerIds[0]}: Value for "icon-size" is >= ${Xm}. Reduce your "icon-size".`)):f2.kind==="composite"&&(ph=[xs*kr.compositeIconSizes[0].evaluate(ar,{},Wn),xs*kr.compositeIconSizes[1].evaluate(ar,{},Wn)],(ph[0]>vc||ph[1]>vc)&&Sr(`${gt.layerIds[0]}: Value for "icon-size" is >= ${Xm}. Reduce your "icon-size".`)),gt.addSymbols(gt.icon,go,ph,wr,Di,ar,!1,St,et,ts.lineStartIndex,ts.lineLength,-1,oi,Wn,Hi,rl),Ww=gt.icon.placedSymbolArray.length-1,pf&&(c2=4*pf.length,gt.addSymbols(gt.icon,pf,ph,wr,Di,ar,Po.vertical,St,et,ts.lineStartIndex,ts.lineLength,-1,oi,Wn,Hi,rl),Zw=gt.icon.placedSymbolArray.length-1)}for(let mo in At.horizontal){let go=At.horizontal[mo];Is||(d2=Hl(go.text),Yn?o2=vw(go):Is=v0(jn,fh,et,Bn,Tn,hn,go,Sn,Dt.layout.get("text-rotate").evaluate(ar,{},Wn),Hn));let pf=go.positionedLines.length===1;if(u2+=rA(gt,St,et,go,Wt,Dt,Yn,ar,Hn,ts,At.vertical?Po.horizontal:Po.horizontalOnly,pf?Object.keys(At.horizontal):[mo],la,Ww,kr,oi,Wn,Hi),pf)break}At.vertical&&(h2+=rA(gt,St,et,At.vertical,Wt,Dt,Yn,ar,Hn,ts,Po.vertical,["vertical"],la,Zw,kr,oi,Wn,Hi));let Ic=-1,Qw=(mo,go)=>mo?Math.max(mo,go):go;Ic=Qw(o2,Ic),Ic=Qw(s2,Ic),Ic=Qw(a2,Ic);let P4=Ic>-1?1:0;gt.glyphOffsetArray.length>=65535&&Sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ar.sortKey!==void 0&&gt.addToSortKeyRanges(gt.symbolInstances.length,ar.sortKey),gt.symbolInstances.emplaceBack(et.x,et.y,fh.x,fh.y,fh.z,la.right>=0?la.right:-1,la.center>=0?la.center:-1,la.left>=0?la.left:-1,la.vertical>=0?la.vertical:-1,Ww,Zw,d2,Is!==void 0?Is:gt.collisionBoxArray.length,Is!==void 0?Is+1:gt.collisionBoxArray.length,Cc!==void 0?Cc:gt.collisionBoxArray.length,Cc!==void 0?Cc+1:gt.collisionBoxArray.length,Sc!==void 0?Sc:gt.collisionBoxArray.length,Sc!==void 0?Sc+1:gt.collisionBoxArray.length,dh||gt.collisionBoxArray.length,dh?dh+1:gt.collisionBoxArray.length,Bn,u2,h2,l2,c2,P4,0,Yw,Kw,Ic,0,1,1,Xw?1:0)})(t,tt,yt,Ye,n,a,u,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,De,y,0,Ee,Ne,j,e,d,b,T,I,R,O)};if(Xe==="line")for(let Ye of XM(e.geometry,0,0,it,it)){let tt=a5(Ye,pe,Oe,n.vertical||X,a,K,se,t.overscaling,it);for(let Tt of tt)X&&f5(t,X.text,Le,Tt)||ht(Ye,Tt,I)}else if(Xe==="line-center"){for(let Ye of e.geometry)if(Ye.length>1){let tt=s5(Ye,Oe,n.vertical||X,a,K,se);tt&&ht(Ye,tt,I)}}else if(e.type==="Polygon")for(let Ye of t0(e.geometry,0)){let tt=c5(Ye,16);ht(Ye[0],new nl(tt.x,tt.y,0,0,void 0),I)}else if(e.type==="LineString")for(let Ye of e.geometry)ht(Ye,new nl(Ye[0].x,Ye[0].y,0,0,void 0),I);else if(e.type==="Point")for(let Ye of e.geometry)for(let tt of Ye)ht([tt],new nl(tt.x,tt.y,0,0,void 0),I)}let Xm=255,vc=Xm*xs;function rA(t,e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z,j){let X=function(le,se,pe,_e,Ee,Oe,De,Ne){let Xe=[];if(se.positionedLines.length===0)return Xe;let Le=_e.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,qe=function(ht){let Ye=ht[0],tt=ht[1],Tt=Ye*tt;return Tt>0?[Ye,-tt]:Tt<0?[-Ye,tt]:Ye===0?[tt,Ye]:[tt,-Ye]}(pe),ke=Math.abs(se.top-se.bottom);for(let ht of se.positionedLines)ke-=ht.lineOffset;let We=se.positionedLines.length,Je=ke/We,Ze=se.top-pe[1];for(let ht=0;ht<We;++ht){let Ye=se.positionedLines[ht];Ze=l5(se,Je,Ze,ht);for(let tt of Ye.positionedGlyphs){if(!tt.rect)continue;let Tt=tt.rect||{},yt=NM+1,gt=!0,et=1,St=0;if(tt.imageName){let wr=De[tt.imageName];if(!wr)continue;if(wr.sdf){Sr("SDF images are not supported in formatted text and will be ignored.");continue}gt=!1,et=wr.pixelRatio,yt=fo/et}let qt=(Ee||Ne)&&tt.vertical,At=tt.metrics.advance*tt.scale/2,Xt=tt.metrics,Wt=tt.rect;if(Wt===null)continue;Ne&&se.verticalizable&&(St=tt.imageName?At-tt.metrics.width*tt.scale/2:0);let nn=Ee?[tt.x+At,tt.y]:[0,0],Dt=[0,0],jn=[0,0],Bn=!1;Ee||(qt?(jn=[tt.x+At+qe[0],tt.y+qe[1]-St],Bn=!0):Dt=[tt.x+At+pe[0],tt.y+pe[1]-St]);let Tn=Wt.w*tt.scale/(et*(tt.localGlyph?bs:1)),hn=Wt.h*tt.scale/(et*(tt.localGlyph?bs:1)),Sn,Yn,Hn,yr;if(qt){let wr=tt.y-Ze,ar=new lt(-At,At-wr),kr=-Math.PI/2,ii=new lt(...jn);Sn=new lt(-At+Dt[0],Dt[1]),Sn._rotateAround(kr,ar)._add(ii),Sn.x+=-wr+At,Sn.y-=(Xt.left-yt)*tt.scale;let oi=tt.imageName?Xt.advance*tt.scale:_i*tt.scale,Wn=String.fromCodePoint(tt.glyph);QB(Wn)?Sn.x+=(1-yt)*tt.scale:JB(Wn)?Sn.x+=oi-Xt.height*tt.scale+(-yt-1)*tt.scale:Sn.x+=tt.imageName||Xt.width+2*yt===Wt.w&&Xt.height+2*yt===Wt.h?(oi-hn)/2:(oi-(Xt.height+2*yt)*tt.scale)/2,Yn=new lt(Sn.x,Sn.y-Tn),Hn=new lt(Sn.x+hn,Sn.y),yr=new lt(Sn.x+hn,Sn.y-Tn)}else{let wr=(Xt.left-yt)*tt.scale-At+Dt[0],ar=(-Xt.top-yt)*tt.scale+Dt[1],kr=wr+Tn,ii=ar+hn;Sn=new lt(wr,ar),Yn=new lt(kr,ar),Hn=new lt(wr,ii),yr=new lt(kr,ii)}if(Le){let wr;wr=Ee?new lt(0,0):Bn?new lt(qe[0],qe[1]):new lt(pe[0],pe[1]),Sn._rotateAround(Le,wr),Yn._rotateAround(Le,wr),Hn._rotateAround(Le,wr),yr._rotateAround(Le,wr)}let mr=new lt(0,0),Di=new lt(0,0);Xe.push({tl:Sn,tr:Yn,bl:Hn,br:yr,texPrimary:Tt,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:nn,sectionIndex:tt.sectionIndex,isSDF:gt,pixelOffsetTL:mr,pixelOffsetBR:Di,minFontScaleX:0,minFontScaleY:0})}}return Xe}(0,a,y,d,p,_,u,t.allowVerticalPlacement),Y=t.textSizeData,K=null;Y.kind==="source"?(K=[xs*d.layout.get("text-size").evaluate(_,{},z)],K[0]>vc&&Sr(`${t.layerIds[0]}: Value for "text-size" is >= ${Xm}. Reduce your "text-size".`)):Y.kind==="composite"&&(K=[xs*O.compositeTextSizes[0].evaluate(_,{},z),xs*O.compositeTextSizes[1].evaluate(_,{},z)],(K[0]>vc||K[1]>vc)&&Sr(`${t.layerIds[0]}: Value for "text-size" is >= ${Xm}. Reduce your "text-size".`)),t.addSymbols(t.text,X,K,y,p,_,T,e,n,b.lineStartIndex,b.lineLength,R,F,z,j,!1);for(let le of I)D[le]=t.text.placedSymbolArray.length-1;return 4*X.length}function iA(t){for(let e in t)return t[e];return null}function v0(t,e,n,a,u,d,p,_,y,b){let T=p.top,I=p.bottom,D=p.left,R=p.right,O=p.collisionPadding;if(O&&(D-=O[0],T-=O[1],R+=O[2],I+=O[3]),y){let F=new lt(D,T),z=new lt(R,T),j=new lt(D,I),X=new lt(R,I),Y=ln(y),K=new lt(0,0);b&&(K=new lt(b[0],b[1])),F._rotateAround(Y,K),z._rotateAround(Y,K),j._rotateAround(Y,K),X._rotateAround(Y,K),D=Math.min(F.x,z.x,j.x,X.x),R=Math.max(F.x,z.x,j.x,X.x),T=Math.min(F.y,z.y,j.y,X.y),I=Math.max(F.y,z.y,j.y,X.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,D,T,R,I,_,a,u,d),t.length-1}function vw(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function f5(t,e,n,a){let u=t.compareText;if(e in u){let d=u[e];for(let p=d.length-1;p>=0;p--)if(a.dist(d[p])<n)return!0}else u[e]=[];return u[e].push(a),!1}function oA(t,e){let n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),d=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),p=Math.sin(t._pitch)*d+u;return Math.min(1.01*p,u*(1/t._horizonShift))}function ah(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),a=t.x*n,u=(t.x+1)*n,d=t.y*n,p=(t.y+1)*n,_=Ki(a),y=Ki(u),b=ri(d),T=ri(p),I=e.project(_,b),D=e.project(y,b),R=e.project(y,T),O=e.project(_,T),F=Math.min(I.x,D.x,R.x,O.x),z=Math.min(I.y,D.y,R.y,O.y),j=Math.max(I.x,D.x,R.x,O.x),X=Math.max(I.y,D.y,R.y,O.y),Y=n/16;function K(se,pe,_e,Ee,Oe,De){let Ne=(_e+Oe)/2,Xe=(Ee+De)/2,Le=e.project(Ki(Ne),ri(Xe)),qe=Math.max(0,F-Le.x,z-Le.y,Le.x-j,Le.y-X);F=Math.min(F,Le.x),j=Math.max(j,Le.x),z=Math.min(z,Le.y),X=Math.max(X,Le.y),qe>Y&&(K(se,Le,_e,Ee,Ne,Xe),K(Le,pe,Ne,Xe,Oe,De))}K(I,D,a,d,u,d),K(D,R,u,d,u,p),K(R,O,u,p,a,p),K(O,I,a,p,a,d),F-=Y,z-=Y,j+=Y,X+=Y;let le=1/Math.max(j-F,X-z);return{scale:le,x:F*le,y:z*le,x2:j*le,y2:X*le,projection:e}}function sA(t,{x:e,y:n},a=0){return new lt(((e-a)*t.scale-t.x)*it,(n*t.scale-t.y)*it)}let p5=r.ad.identity(new Float32Array(16));class xc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new vn(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return Gi(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return oA(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,u){let d=e.horizonLineFromTop(!1),p=new lt(n,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,n,a){let u=new lt(n,a);if(e.elevation)return e.elevation.pointCoordinate(u);{let d=this.pointCoordinate(e,u.x,u.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return p5}createTileMatrix(e,n,a){let u,d,p,_=a.canonical,y=r.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=ah(_,this);u=1,d=b.x+a.wrap*b.scale,p=b.y,r.ad.scale(y,y,[u/b.scale,u/b.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*a.wrap)*u,p=_.y*u;return r.ad.translate(y,y,[d,p,0]),r.ad.scale(y,y,[u/it,u/it,1]),y}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class m5 extends xc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(ln(n));this.n=(u+Math.sin(ln(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c:u,r0:d}=this,p=ln(e-this.center[0]),_=ln(n),y=Math.sqrt(u-2*a*Math.sin(_))/a;return{x:y*Math.sin(p*a),y:y*Math.cos(p*a)-d,z:0}}unproject(e,n){let{n:a,c:u,r0:d}=this,p=d+n,_=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));let y=ln(this.center[0])*a;_=Oa(_,-Math.PI-y,Math.PI-y);let b=Qt(di(_/a)+this.center[0],-180,180),T=Math.asin(Qt((u-(e*e+p*p)*a*a)/(2*a),-1,1)),I=Qt(di(T),-Ir,Ir);return new vn(b,I)}}let Ym=1.340264,Km=-.081106,Qm=893e-6,Jm=.003796,x0=Math.sqrt(3)/2;class g5 extends xc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(x0*Math.sin(n)),u=a*a,d=u*u*u;return{x:.5*(e*Math.cos(a)/(x0*(Ym+3*Km*u+d*(7*Qm+9*Jm*u)))/Math.PI+.5),y:1-.5*(a*(Ym+Km*u+d*(Qm+Jm*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=a*a,d=u*u*u;for(let T,I,D,R=0;R<12&&(I=a*(Ym+Km*u+d*(Qm+Jm*u))-n,D=Ym+3*Km*u+d*(7*Qm+9*Jm*u),T=I/D,a=Qt(a-T,-Math.PI/3,Math.PI/3),u=a*a,d=u*u*u,!(Math.abs(T)<1e-12));++R);let p=x0*e*(Ym+3*Km*u+d*(7*Qm+9*Jm*u))/Math.cos(a),_=Math.asin(Math.sin(a)/x0),y=Qt(180*p/Math.PI,-180,180),b=Qt(180*_/Math.PI,-Ir,Ir);return new vn(y,b)}}class _5 extends xc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),u=Qt(360*(.5-n),-Ir,Ir);return new vn(a,u)}}let sf=Math.PI/2;function b0(t){return Math.tan((sf+t)/2)}class y5 extends xc{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],u=ln(n),d=ln(a);this.southernCenter=u+d<0,this.southernCenter&&(u=-u,d=-d);let p=Math.cos(u),_=b0(u);this.n=u===d?Math.sin(u):Math.log(p/Math.cos(d))/Math.log(b0(d)/_),this.f=p*Math.pow(b0(u),this.n)/this.n}project(e,n){n=ln(n),this.southernCenter&&(n=-n),e=ln(e-this.center[0]);let a=1e-6,{n:u,f:d}=this;d>0?n<-sf+a&&(n=-sf+a):n>sf-a&&(n=sf-a);let p=d/Math.pow(b0(n),u),_=p*Math.sin(u*e),y=d-p*Math.cos(u*e);return _=.5*(_/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:_,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:u}=this,d=u-n,p=Math.sign(d),_=Math.sign(a)*Math.sqrt(e*e+d*d),y=Math.atan2(e,Math.abs(d))*p;d*a<0&&(y-=Math.PI*Math.sign(e)*p);let b=Qt(di(y/a)+this.center[0],-180,180),T=Qt(di(2*Math.atan(Math.pow(u/_,1/a))-sf),-Ir,Ir);return new vn(b,this.southernCenter?-T:T)}}class aA extends xc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:na(e),y:ra(n),z:0}}unproject(e,n){let a=Ki(e),u=ri(n);return new vn(a,u)}}let lA=ln(Ir);class v5 extends xc{project(e,n){let a=(n=ln(n))*n,u=a*a;return{x:.5*((e=ln(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=25,d=0,p=a*a;do{p=a*a;let b=p*p;d=(a*(1.007226+p*(.015085+b*(.028874*p-.044475-.005916*b)))-n)/(1.007226+p*(.045255+b*(.259866*p-.311325-.005916*11*b))),a=Qt(a-d,-lA,lA)}while(Math.abs(d)>1e-6&&--u>0);p=a*a;let _=Qt(di(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=di(a);return new vn(_,y)}}let cA=ln(Ir);class x5 extends xc{project(e,n){n=ln(n),e=ln(e);let a=Math.cos(n),u=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),p=Math.sin(d)/d,_=.5*(e*u+2*a*Math.sin(e/2)/p)||0,y=.5*(n+Math.sin(n)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,d=25,p=1e-6,_=0,y=0;do{let b=Math.cos(u),T=Math.sin(u),I=2*T*b,D=T*T,R=b*b,O=Math.cos(a/2),F=Math.sin(a/2),z=2*O*F,j=F*F,X=1-R*O*O,Y=X?1/X:0,K=X?Math.acos(b*O)*Math.sqrt(1/X):0,le=.5*(2*K*b*F+2*a/Math.PI)-e,se=.5*(K*T+u)-n,pe=.5*Y*(R*j+K*b*O*D)+1/Math.PI,_e=Y*(z*I/4-K*T*F),Ee=.125*Y*(I*F-K*T*R*z),Oe=.5*Y*(D*O+K*j*b)+.5,De=_e*Ee-Oe*pe;_=(se*_e-le*Oe)/De,y=(le*Ee-se*pe)/De,a=Qt(a-_,-Math.PI,Math.PI),u=Qt(u-y,-cA,cA)}while((Math.abs(_)>p||Math.abs(y)>p)&&--d>0);return new vn(di(a),di(u))}}class uA extends xc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ln(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:u}=this;return{x:ln(e)*u*a+.5,y:-Math.sin(ln(n))/u*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:u}=this,d=-(n-.5)/a,p=Qt(di((e-.5)/a)/u,-180,180),_=Math.asin(Qt(d*u,-1,1)),y=Qt(di(_),-Ir,Ir);return new vn(p,y)}}class b5 extends aA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let u=Fm(e,n,a),d=Nm(ia(a));return r._.transformMat4(u,u,d),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){let a=nh(n.lat,n.lng),u=r._.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=Gi(1,0)*it*d;r._.scaleAndAdd(a,a,u,p);let _=r.ad.identity(new Float64Array(16));return r.ad.multiply(_,e.pixelMatrix,e.globeMatrix),r._.transformMat4(a,a,_),new lt(a[0],a[1])}pixelsPerMeter(e,n){return Gi(1,0)*n}pixelSpaceConversion(e,n,a){let u=Gi(1,e)*n,d=It(Gi(1,45)*n,u,a);return this.pixelsPerMeter(e,n)/d}createTileMatrix(e,n,a){let u=Yb(ia(a.canonical));return r.ad.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){let{center:a}=e,u=Nm(ia(n));return r.ad.rotateY(u,u,ln(a.lng)),r.ad.rotateX(u,u,ln(a.lat)),r.ad.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,a,u){return _D(e,n,a,!0)||new Ii(0,0)}pointCoordinate3D(e,n,a){let u=this.pointCoordinate(e,n,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!_D(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(u,d){let p=u.cameraToCenterDistance,_=u._centerAltitude*d,y=u._camera,b=u._camera.forward(),T=r._.add([],r._.scale([],b,-p),[0,0,_]),I=u.worldSize/(2*Math.PI),D=[0,0,-I],R=u.width/u.height,O=Math.tan(u.fovAboveCenter),F=r._.scale([],y.up(),O),z=r._.scale([],y.right(),O*R),j=r._.normalize([],r._.add([],r._.add([],b,F),z)),X=[],Y;if(new Hb(T,j).closestPointOnSphere(D,I,X)){let K=r._.add([],X,D),le=r._.sub([],K,T);Y=Math.cos(u.fovAboveCenter)*r._.length(le)}else{let K=r._.sub([],T,D),le=r._.sub([],D,T);r._.normalize(le,le);let se=r._.length(K)-I;Y=Math.sqrt(se*(se+2*I));let pe=Math.acos(Y/(I+se))-Math.acos(r._.dot(b,le));Y*=Math.cos(pe)}return 1.01*Y}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=el(e.zoom);if(a>0){let u=oA(e,Gi(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return It(n,u+d*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return Fm(n,a,e,1)}upVectorScale(e){return{metersToTile:Xy(Ky(ia(e)))}}}function hA(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new aA(t);case"equirectangular":return new _5(t);case"naturalEarth":return new v5(t);case"equalEarth":return new g5(t);case"winkelTripel":return new x5(t);case"albers":return n?new uA(t):new m5(t);case"lambertConformalConic":return n?new uA(t):new y5(t);case"globe":return new b5(t)}throw new Error(`Invalid projection name: ${t.name}`)}let w5=(()=>{class t{constructor(n,a,u,d){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||d||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class af{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}af.ReadOnly=!1,af.ReadWrite=!0,af.disabled=new af(519,af.ReadOnly,[0,1]);let xw=7680;class bw{constructor(e,n,a,u,d,p){this.test=e,this.ref=n,this.mask=a,this.fail=u,this.depthFail=d,this.pass=p}}bw.disabled=new bw({func:519,mask:0},0,0,xw,xw,xw);let eg=771;class po{constructor(e,n,a,u){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=u}}po.Replace=[1,0,1,0],po.disabled=new po(po.Replace,bn.transparent,[!1,!1,!1,!1]),po.unblended=new po(po.Replace,bn.transparent,[!0,!0,!0,!0]),po.alphaBlended=new po([1,eg,1,eg],bn.transparent,[!0,!0,!0,!0]),po.alphaBlendedNonPremultiplied=new po([770,eg,770,eg],bn.transparent,[!0,!0,!0,!0]),po.multiply=new po([774,0,774,0],bn.transparent,[!0,!0,!0,!0]);let ww=1029,Ew=2305;class ws{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}ws.disabled=new ws(!1,ww,Ew),ws.backCCW=new ws(!0,ww,Ew),ws.backCW=new ws(!0,ww,2304),ws.frontCW=new ws(!0,1028,2304),ws.frontCCW=new ws(!0,1028,Ew);let E5=i0.types,T5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function w0(t,e,n,a,u,d,p,_,y,b,T,I,D){let R=_?Math.min(vc,Math.round(_[0])):0,O=_?Math.min(vc,Math.round(_[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*u),d,p,(R<<1)+(y?1:0),O,16*b,16*T,256*I,256*D)}function E0(t,e,n){t.emplaceBack(e,n)}function T0(t,e,n,a,u,d,p){t.emplaceBack(e,n,a,u,d,p)}function S0(t,e,n,a,u){t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u),t.emplaceBack(e,n,a,u)}function S5(t){for(let e of t.sections)if(Fe(e.text))return!0;return!1}class Tw{constructor(e){this.layoutVertexArray=new pb,this.indexArray=new Zr,this.programConfigurations=e,this.segments=new fr,this.dynamicLayoutVertexArray=new ac,this.opacityVertexArray=new gb,this.occlusionQueryOpacityVertexArray=new Ju,this.placedSymbolArray=new jI,this.iconTransitioningVertexArray=new uc,this.globeExtVertexArray=new mb,this.zOffsetVertexArray=new Ju}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,u,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,DB.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,T5,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,cw.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,MB.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,IB.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,vM.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}J(Tw,"SymbolBuffers");class Sw{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new fr,this.collisionVertexArray=new vb,this.collisionVertexArrayExt=new ac}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,AB.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,PB.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}J(Sw,"CollisionBuffers");class lf{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.ad.identity([]),this.placementViewportMatrix=r.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hw(this.zoom,n["text-size"]),this.iconSizeData=hw(this.zoom,n["icon-size"]);let a=this.layers[0].layout,u=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>Po[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Tw(new dc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new Tw(new dc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new GI,this.lineVertexArray=new HI,this.symbolInstances=new $I}calculateGlyphDependencies(e,n,a,u,d){for(let p=0;p<e.length;p++){let _=e.codePointAt(p);if(_===void 0)break;if(n[_]=!0,u&&d&&_<=65535){let y=qm[e.charAt(p)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!aw(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,u){let d=this.layers[0],p=d.layout,_=this.projection.name==="globe",y=p.get("text-font"),b=p.get("text-field"),T=p.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof pi&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!I&&!D)return;let O=n.iconDependencies,F=n.glyphDependencies,z=n.availableImages,j=new Bt(this.zoom);for(let{feature:X,id:Y,index:K,sourceLayerIndex:le}of e){let se=d._featureFilter.needGeometry,pe=Qa(X,se);if(!d._featureFilter.filter(j,pe,a))continue;if(se||(pe.geometry=vs(X,a,u)),_&&X.type!==1&&a.z<=5){let De=pe.geometry,Ne=.98078528056,Xe=(Le,qe)=>{let ke=Fm(Le.x,Le.y,a,1),We=Fm(qe.x,qe.y,a,1);return r._.dot(ke,We)<Ne};for(let Le=0;Le<De.length;Le++)De[Le]=cz(De[Le],Xe)}let _e,Ee;if(I){let De=d.getValueAndResolveTokens("text-field",pe,a,z),Ne=pi.factory(De);S5(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||cn()==="unavailable"||this.hasRTLText&&Rn.isParsed())&&(_e=KB(Ne,d,pe))}if(D){let De=d.getValueAndResolveTokens("icon-image",pe,a,z);Ee=De instanceof ki?De:ki.fromString(De)}if(!_e&&!Ee)continue;let Oe=this.sortFeaturesByKey?R.evaluate(pe,{},a):void 0;if(this.features.push({id:Y,text:_e,icon:Ee,index:K,sourceLayerIndex:le,geometry:pe.geometry,properties:X.properties,type:E5[X.type],sortKey:Oe}),Ee&&(O[Ee.namePrimary]=!0,Ee.nameSecondary&&(O[Ee.nameSecondary]=!0)),_e){let De=y.evaluate(pe,{},a).join(","),Ne=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Po.vertical)>=0;for(let Xe of _e.sections)if(Xe.image)O[Xe.image.namePrimary]=!0;else{let Le=Ce(_e.toString()),qe=Xe.fontStack||De,ke=F[qe]=F[qe]||{};this.calculateGlyphDependencies(Xe.text,ke,Ne,this.allowVerticalPlacement,Le)}}}p.get("symbol-placement")==="line"&&(this.features=function(X){let Y={},K={},le=[],se=0;function pe(De){le.push(X[De]),se++}function _e(De,Ne,Xe){let Le=K[De];return delete K[De],K[Ne]=Le,le[Le].geometry[0].pop(),le[Le].geometry[0]=le[Le].geometry[0].concat(Xe[0]),Le}function Ee(De,Ne,Xe){let Le=Y[Ne];return delete Y[Ne],Y[De]=Le,le[Le].geometry[0].shift(),le[Le].geometry[0]=Xe[0].concat(le[Le].geometry[0]),Le}function Oe(De,Ne,Xe){let Le=Xe?Ne[0][Ne[0].length-1]:Ne[0][0];return`${De}:${Le.x}:${Le.y}`}for(let De=0;De<X.length;De++){let Ne=X[De],Xe=Ne.geometry,Le=Ne.text?Ne.text.toString():null;if(!Le){pe(De);continue}let qe=Oe(Le,Xe),ke=Oe(Le,Xe,!0);if(qe in K&&ke in Y&&K[qe]!==Y[ke]){let We=Ee(qe,ke,Xe),Je=_e(qe,ke,le[We].geometry);delete Y[qe],delete K[ke],K[Oe(Le,le[Je].geometry,!0)]=Je,le[We].geometry=null}else qe in K?_e(qe,ke,Xe):ke in Y?Ee(qe,ke,Xe):(pe(De),Y[qe]=se-1,K[ke]=se-1)}return le.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,Y)=>X.sortKey-Y.sortKey)}update(e,n,a,u,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,_,a,u,d),this.icon.programConfigurations.updatePaintArrays(e,n,_,a,u,d)}updateOcclusionOpacities(e,n,a){if(!n.useOcclusionQueries)return!1;let u=this;if(u.projection.name==="globe")return!1;let d=!1;u.hasTextData()&&(d=d||u.text.occlusionQueryOpacityVertexArray.length!==0),u.hasIconData()&&(d=d||u.icon.occlusionQueryOpacityVertexArray.length!==0);let p=u.layers[0].paint,_=p.get("icon-occlusion-opacity").constantOr(0)!==1,y=p.get("text-occlusion-opacity").constantOr(0)!==1;if(!_&&!y)return!1;let b=!d;for(let R=0;R<u.symbolInstances.length;R++){let O=u.symbolInstances.get(R),F=O.occlusionOpacity;O.occlusionOpacity+=(O.occlusionState>.5?1:-1)*n.fadeSpeed*a*.001,O.occlusionOpacity=Qt(O.occlusionOpacity,0,1),b=b||O.occlusionOpacity!==F}if(!b)return!1;let T=0,I=0,D=(R,O,F,z)=>{let j=0,X=0;F?(j=I,I+=z,X=I):(j=T,T+=z,X=T),X>O.occlusionQueryOpacityVertexArray.length&&O.occlusionQueryOpacityVertexArray.resize(X);let Y=R.occlusionOpacity;for(let K=0;K<z;K++)O.occlusionQueryOpacityVertexArray.emplace(K+j,Y)};for(let R=0;R<u.symbolInstances.length;R++){let O=u.symbolInstances.get(R),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:z,numIconVertices:j}=O,X=j>0;if((F>0||z>0)&&(D(O,u.text,!1,F),D(O,u.text,!1,z)),X){let{placedIconSymbolIndex:Y,verticalPlacedIconSymbolIndex:K}=O;Y>=0&&D(O,u.icon,!0,j),K>=0&&D(O,u.icon,!0,O.numVerticalIconVertices)}}return u.hasTextData()&&u.text.occlusionQueryOpacityVertexBuffer&&(u.text.occlusionQueryOpacityVertexBuffer.length<u.text.occlusionQueryOpacityVertexArray.length?u.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.text.occlusionQueryOpacityVertexArray,cw.members,!0):u.text.occlusionQueryOpacityVertexBuffer.updateData(u.text.occlusionQueryOpacityVertexArray)),u.hasIconData()&&u.icon.occlusionQueryOpacityVertexBuffer&&(u.icon.occlusionQueryOpacityVertexBuffer.length<u.icon.occlusionQueryOpacityVertexArray.length?u.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.icon.occlusionQueryOpacityVertexArray,cw.members,!0):u.icon.occlusionQueryOpacityVertexBuffer.updateData(u.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(d,p,_)=>{a+=p,a>d.length&&d.resize(a);for(let y=-p;y<0;y++)d.emplace(y+a,_)},n=(d,p,_)=>{u+=p,u>d.length&&d.resize(u);for(let y=-p;y<0;y++)d.emplace(y+u,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:y,numIconVertices:b}=p,T=p.zOffset,I=b>0;if((_>0||y>0)&&(e(this.text.zOffsetVertexArray,_,T),e(this.text.zOffsetVertexArray,y,T)),I){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:R}=p;D>=0&&n(this.icon.zOffsetVertexArray,b,T),R>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:u,y:d}of n)this.lineVertexArray.emplaceBack(u,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,u,d,p,_,y,b,T,I,D,R,O,F,z){let j=e.indexArray,X=e.layoutVertexArray,Y=e.globeExtVertexArray,K=e.segments.prepareSegment(4*n.length,X,j,this.canOverlap?p.sortKey:void 0),le=this.glyphOffsetArray.length,se=K.vertexLength,pe=this.allowVerticalPlacement&&_===Po.vertical?Math.PI/2:0,_e=p.text&&p.text.sections;for(let Oe=0;Oe<n.length;Oe++){let{tl:De,tr:Ne,bl:Xe,br:Le,texPrimary:qe,texSecondary:ke,pixelOffsetTL:We,pixelOffsetBR:Je,minFontScaleX:Ze,minFontScaleY:ht,glyphOffset:Ye,isSDF:tt,sectionIndex:Tt}=n[Oe],yt=K.vertexLength,gt=Ye[1];if(w0(X,b.x,b.y,De.x,gt+De.y,qe.x,qe.y,a,tt,We.x,We.y,Ze,ht),w0(X,b.x,b.y,Ne.x,gt+Ne.y,qe.x+qe.w,qe.y,a,tt,Je.x,We.y,Ze,ht),w0(X,b.x,b.y,Xe.x,gt+Xe.y,qe.x,qe.y+qe.h,a,tt,We.x,Je.y,Ze,ht),w0(X,b.x,b.y,Le.x,gt+Le.y,qe.x+qe.w,qe.y+qe.h,a,tt,Je.x,Je.y,Ze,ht),y){let{x:et,y:St,z:qt}=y.anchor,[At,Xt,Wt]=y.up;T0(Y,et,St,qt,At,Xt,Wt),T0(Y,et,St,qt,At,Xt,Wt),T0(Y,et,St,qt,At,Xt,Wt),T0(Y,et,St,qt,At,Xt,Wt),S0(e.dynamicLayoutVertexArray,et,St,qt,pe)}else S0(e.dynamicLayoutVertexArray,b.x,b.y,b.z,pe);if(z){let et=ke||qe;E0(e.iconTransitioningVertexArray,et.x,et.y),E0(e.iconTransitioningVertexArray,et.x+et.w,et.y),E0(e.iconTransitioningVertexArray,et.x,et.y+et.h),E0(e.iconTransitioningVertexArray,et.x+et.w,et.y+et.h)}j.emplaceBack(yt,yt+1,yt+2),j.emplaceBack(yt+1,yt+2,yt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ye[0]),Oe!==n.length-1&&Tt===n[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,p,p.index,{},R,O,F,_e&&_e[Tt])}let Ee=y?y.anchor:b;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,b.x,b.y,le,this.glyphOffsetArray.length-le,se,T,I,b.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],_,0,!1,0,D,0)}_commitLayoutVertex(e,n,a,u,d,p,_){e.emplaceBack(n,a,u,d,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,a,u,d,p,_){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=y.vertexLength,T=_.tileAnchorX,I=_.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,I,new lt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,I,new lt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,I,new lt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,I,new lt(e.x1,e.y2)),y.vertexLength+=4;let D=a.indexArray;D.emplaceBack(b,b+1),D.emplaceBack(b+1,b+2),D.emplaceBack(b+2,b+3),D.emplaceBack(b+3,b),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,p,n,_);this._addCollisionDebugVertices(y,b,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,b,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sw(Vy,xM.members,uc),this.iconCollisionBox=new Sw(Vy,xM.members,uc);let a=tf(this.iconSizeData,e),u=tf(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,a,u){let d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),p=p0(this.textSizeData,e,d)/_i;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){let u=this.icon.placedSymbolArray.get(a),d=p0(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,a,u){e.emplaceBack(n,-a,-a,u),e.emplaceBack(n,a,-a,u),e.emplaceBack(n,a,a,u),e.emplaceBack(n,-a,a,u)}_updateTextDebugCollisionBoxes(e,n,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,p,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=tf(this.iconSizeData,e),u=tf(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,u,d,p,_,y,b){let T={};if(n<a){let{x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(n);T.textBox={x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.textFeatureIndex=le}if(u<d){let{x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(u);T.verticalTextBox={x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.verticalTextFeatureIndex=le}if(p<_){let{x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(p);T.iconBox={x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.iconFeatureIndex=le}if(y<b){let{x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(y);T.verticalIconBox={x1:I,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.verticalIconFeatureIndex=le}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),u=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),u=[],d=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);let y=this.symbolInstances.get(_);u.push(0|Math.round(n*y.tileAnchorX+a*y.tileAnchorY)),d.push(y.featureIndex)}return p.sort((_,y)=>u[_]-u[y]||d[y]-d[_]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:b}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&d!==u&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}J(lf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),lf.addDynamicAttributes=S0;class Jo{constructor(e,n,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,a){let{width:u,height:d}=e,{context:p}=this,{gl:_}=p;if(_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===d){let{x:y,y:b}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,y,b,_.RGBA,_.UNSIGNED_BYTE,e);else{let T=this.format,I=_.UNSIGNED_BYTE;this.format===_.R32F&&(T=_.RED,I=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,y,b,u,d,T,I,e.data)}}else if(this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===_.R8&&(y=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,y,_.UNSIGNED_BYTE,e)}else{let y=this.format,b=this.format,T=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,T=_.UNSIGNED_SHORT),this.format===_.R8&&(b=_.RED),this.format===_.R32F&&(T=_.FLOAT,b=_.RED),_.texImage2D(_.TEXTURE_2D,0,y,u,d,0,b,T,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,a=!1){let{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,u){let{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class C0{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}let es=32,sa=33,bc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,u=0,d=0,p=0,_=0;for(1&e?u=d=p=es:n=a=_=es;(e>>=1)>1;){let b=n+u>>1,T=a+d>>1;1&e?(u=n,d=a,n=p,a=_):(n=u,a=d,u=p,d=_),p=b,_=T}let y=4*t;bc[y+0]=n,bc[y+1]=a,bc[y+2]=u,bc[y+3]=d}let aa=new Uint16Array(2178),wc=new Uint8Array(1089),I0=new Uint16Array(1089);function dA(t){return t===0?-.03125:t===32?.03125:0}var D0=Mn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),C5=Mn([{name:"a_index",type:"Int16",components:1}]);let fA={type:2,extent:it,loadGeometry:()=>[[new lt(0,0),new lt(it+1,0),new lt(it+1,it+1),new lt(0,it+1),new lt(0,0)]]};class M0{constructor(e,n,a,u,d){this.tileID=e,this.uid=id(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<ti.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ah(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){let p={};if(!d)return p;for(let _ of u){let y=_.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(let b of y)p[b.fqid]=_}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let u in this.buckets){let d=this.buckets[u];if(d instanceof lf){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let u in this.buckets){let d=this.buckets[u];if(d instanceof lf&&d.hasRTLText){this.hasRTLText=!0,Rn.isLoading()||Rn.isLoaded()||cn()!=="deferred"||on();break}}this.queryPadding=0;for(let u in this.buckets){let d=this.buckets[u],p=n.style.getOwnLayer(u);if(!p)continue;let _=p.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Ib}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let u in this.buckets){let d=this.buckets[u];d.uploadPending()&&d.upload(e)}let n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let u=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new Jo(e,a.image,n.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Jo(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Jo(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let u=n.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,u,d,p,_,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:_,transform:p,params:d,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let u=a.loadVTLayers(),d=n?n.sourceLayer:"",p=u._geojsonTileLayer||u[d];if(!p)return;let _=Ci(n&&n.filter),{z:y,x:b,y:T}=this.tileID.canonical,I={z:y,x:b,y:T};for(let D=0;D<p.length;D++){let R=p.feature(D);if(_.needGeometry){let z=Qa(R,!0);if(!_.filter(new Bt(this.tileID.overscaledZ),z,this.tileID.canonical))continue}else if(!_.filter(new Bt(this.tileID.overscaledZ),R))continue;let O=a.getId(R,d),F=new kM(R,y,b,T,O);F.tile=I,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let a=Fp(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),u=!1;if(this.expirationTime>a)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{let d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages(),d=n.style.getBrightness();for(let p in this.buckets){if(!n.style.hasLayer(p))continue;let _=this.buckets[p],y=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],T={};if(e&&(T=e[y],!b||!T||Object.keys(T).length===0))continue;if(_.update(T,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),_ instanceof u0||_ instanceof n0){let D=n.style.getOwnSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&D&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(D.id,this.tileID)}let I=n&&n.style&&n.style.getOwnLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ti.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ti.now()+e}setTexture(e,n){let a=n.context,u=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Jo?this.texture.update(e,{useMipmap:!0}):(this.texture=new Jo(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,n){let a={};for(let u of n)a[u]=!0;this.dependencies[e]=a}hasDependency(e,n){for(let a of e){let u=this.dependencies[a];if(u){for(let d of n)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let a=vs(fA,this.tileID.canonical,this.tileTransform)[0],u=new _s,d=new Mm;for(let p=0;p<a.length;p++){let{x:_,y}=a[p];u.emplaceBack(_,y),d.emplaceBack(p)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,Lm.members),this._tileDebugSegments=fr.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let a=vs(fA,this.tileID.canonical,this.tileTransform)[0],u,d;if(this.isRaster){let p=function(_,y){let b=ah(_,y),T=Math.pow(2,_.z);for(let z=0;z<sa;z++)for(let j=0;j<sa;j++){let X=Ki((_.x+(j+dA(j))/es)/T),Y=ri((_.y+(z+dA(z))/es)/T),K=y.project(X,Y),le=z*sa+j;aa[2*le+0]=Math.round((K.x*b.scale-b.x)*it),aa[2*le+1]=Math.round((K.y*b.scale-b.y)*it)}wc.fill(0),I0.fill(0);for(let z=2045;z>=0;z--){let j=4*z,X=bc[j+0],Y=bc[j+1],K=bc[j+2],le=bc[j+3],se=X+K>>1,pe=Y+le>>1,_e=se+pe-Y,Ee=pe+X-se,Oe=Y*sa+X,De=le*sa+K,Ne=pe*sa+se,Xe=Math.hypot((aa[2*Oe+0]+aa[2*De+0])/2-aa[2*Ne+0],(aa[2*Oe+1]+aa[2*De+1])/2-aa[2*Ne+1])>=16;wc[Ne]=wc[Ne]||(Xe?1:0),z<1022&&(wc[Ne]=wc[Ne]||wc[(Y+Ee>>1)*sa+(X+_e>>1)]||wc[(le+Ee>>1)*sa+(K+_e>>1)])}let I=new sc,D=new Zr,R=0;function O(z,j){let X=j*sa+z;return I0[X]===0&&(I.emplaceBack(aa[2*X+0],aa[2*X+1],z*it/es,j*it/es),I0[X]=++R),I0[X]-1}function F(z,j,X,Y,K,le){let se=z+X>>1,pe=j+Y>>1;if(Math.abs(z-K)+Math.abs(j-le)>1&&wc[pe*sa+se])F(K,le,z,j,se,pe),F(X,Y,K,le,se,pe);else{let _e=O(z,j),Ee=O(X,Y),Oe=O(K,le);D.emplaceBack(_e,Ee,Oe)}}return F(0,0,es,es,es,0),F(es,es,0,0,0,es),{vertices:I,indices:D}}(this.tileID.canonical,n);u=p.vertices,d=p.indices}else{u=new sc,d=new Zr;for(let{x:_,y}of a)u.emplaceBack(_,y,0,0);let p=Bm(u.int16,void 0,4);for(let _=0;_<p.length;_+=3)d.emplaceBack(p[_],p[_+1],p[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,D0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=fr.simpleSegment(0,0,u.length,d.length)}_makeGlobeTileDebugBuffers(e,n){let a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;let u=this.tileID.canonical,d=Nm(yD(u,n)),p=el(n.zoom),_;p>0&&(_=r.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,d,_,p),this._makeGlobeTileDebugTextBuffer(e,u,n,d,_,p)}_globePoint(e,n,a,u,d,p,_){let y=Fm(e,n,a);if(p){let b=1<<a.z,T=na(u.center.lng),I=ra(u.center.lat),D=(a.x+.5)/b-T,R=0;D>.5?R=-1:D<-.5&&(R=1);let O=(e/it+a.x)/b+R,F=(n/it+a.y)/b;O=(O-T)*u._pixelsPerMercatorPixel+T,F=(F-I)*u._pixelsPerMercatorPixel+I;let z=[O*u.worldSize,F*u.worldSize,0];r._.transformMat4(z,z,p),y=Ja(y,z,_)}return r._.transformMat4(y,y,d)}_makeGlobeTileDebugBorderBuffer(e,n,a,u,d,p){let _=new _s,y=new Mm,b=new Ny,T=(D,R,O,F,z)=>{let j=(O-D)/(z-1),X=(F-R)/(z-1),Y=_.length;for(let K=0;K<z;K++){let le=D+K*j,se=R+K*X;_.emplaceBack(le,se);let pe=this._globePoint(le,se,n,a,u,d,p);b.emplaceBack(pe[0],pe[1],pe[2]),y.emplaceBack(Y+K)}},I=it;T(0,0,I,0,16),T(I,0,I,I,16),T(I,I,0,I,16),T(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(_,Lm.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,gD.members),this._tileDebugSegments=fr.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,a,u,d,p){let _=it/4,y=new _s,b=new Zr,T=new Ny,I=25;b.reserve(32),y.reserve(I),T.reserve(I);let D=(R,O)=>I*R+O;for(let R=0;R<I;R++){let O=R*_;for(let F=0;F<I;F++){let z=F*_;y.emplaceBack(z,O);let j=this._globePoint(z,O,n,a,u,d,p);T.emplaceBack(j[0],j[1],j[2])}}for(let R=0;R<4;R++)for(let O=0;O<4;O++){let F=D(R,O),z=D(R,O+1),j=D(R+1,O),X=D(R+1,O+1);b.emplaceBack(F,z,j),b.emplaceBack(j,z,X)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(y,Lm.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,gD.members),this._tileDebugTextSegments=fr.simpleSegment(0,0,I,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Jo&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Ut={read:function(t,e){return t.readFields(Ut._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(Ut.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Ut.Filter.read=function(t,e){return t.readFields(Ut.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Ut.Filter._readField=function(t,e,n){t===1?(e.delta_filter=Ut.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Ut.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Ut.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Ut.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},Ut.Filter.Delta={},Ut.Filter.Delta.read=function(t,e){return t.readFields(Ut.Filter.Delta._readField,{block_size:0},e)},Ut.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},Ut.Filter.Zigzag={},Ut.Filter.Zigzag.read=function(t,e){return t.readFields(Ut.Filter.Zigzag._readField,{},e)},Ut.Filter.Zigzag._readField=function(t,e,n){},Ut.Filter.BitShuffle={},Ut.Filter.BitShuffle.read=function(t,e){return t.readFields(Ut.Filter.BitShuffle._readField,{},e)},Ut.Filter.BitShuffle._readField=function(t,e,n){},Ut.Filter.ByteShuffle={},Ut.Filter.ByteShuffle.read=function(t,e){return t.readFields(Ut.Filter.ByteShuffle._readField,{},e)},Ut.Filter.ByteShuffle._readField=function(t,e,n){},Ut.Codec={},Ut.Codec.read=function(t,e){return t.readFields(Ut.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Ut.Codec._readField=function(t,e,n){t===1?(e.gzip_data=Ut.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Ut.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Ut.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=Ut.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},Ut.Codec.GzipData={},Ut.Codec.GzipData.read=function(t,e){return t.readFields(Ut.Codec.GzipData._readField,{},e)},Ut.Codec.GzipData._readField=function(t,e,n){},Ut.Codec.JpegImage={},Ut.Codec.JpegImage.read=function(t,e){return t.readFields(Ut.Codec.JpegImage._readField,{},e)},Ut.Codec.JpegImage._readField=function(t,e,n){},Ut.Codec.WebpImage={},Ut.Codec.WebpImage.read=function(t,e){return t.readFields(Ut.Codec.WebpImage._readField,{},e)},Ut.Codec.WebpImage._readField=function(t,e,n){},Ut.Codec.PngImage={},Ut.Codec.PngImage.read=function(t,e){return t.readFields(Ut.Codec.PngImage._readField,{},e)},Ut.Codec.PngImage._readField=function(t,e,n){},Ut.DataIndexEntry={},Ut.DataIndexEntry.read=function(t,e){return t.readFields(Ut.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Ut.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(Ut.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=Ut.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},Ut.Layer={},Ut.Layer.read=function(t,e){return t.readFields(Ut.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Ut.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(Ut.DataIndexEntry.read(n,n.readVarint()+n.pos))};let Es={read:function(t,e){return t.readFields(Es._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=Es.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Es.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};Es.Uint32Values.read=function(t,e){return t.readFields(Es.Uint32Values._readField,{values:[]},e)},Es.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let u=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(a),d=a.pos;return a.pos=u,function(p){a.pos=d;let _=0;for(;a.pos<u;){let y=a.readVarint();p[_++]=y}return p}}(n))},Es.Fixed32Values={},Es.Fixed32Values.read=function(t,e){return t.readFields(Es.Fixed32Values._readField,{values:[]},e)},Es.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class I5{constructor(e=0,n=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(n=a.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,a=!1,u=this.resetTtl){let d;if(a||this.has(e)){if(d=this.items[e],d.value=n,a===!1&&u&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){let p=this.last,_=d.next,y=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,p.next=d,y!==null&&(y.next=_),_!==null&&(_.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=d:this.last.next=d;return this.last=d,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function D5(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){let u=a===1?1:0,d=a===2?1:0;for(let p=0;p<e[0];p++){let _=e[1]*p;for(let y=u;y<e[1];y++){let b=e[2]*(y+_);for(let T=d;T<e[2];T++){let I=e[3]*(T+b);for(let D=0;D<e[3];D++){let R=I+D;t[R]+=t[R-n]}}}}n*=e[a]}return t}function M5(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function A5(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let a=t[n],u=t[n+1];t[n]=(240&a)>>4|(61440&a)>>8|(240&u)<<4|61440&u,t[n+1]=15&a|(3840&a)>>4|(15&u)<<8|(3840&u)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let a=t[n],u=t[n+1],d=t[n+2],p=t[n+3];t[n+0]=(192&a)>>6|(192&u)>>4|(192&d)>>2|192&p,t[n+1]=(48&a)>>4|(48&u)>>2|48&d|(48&p)<<2,t[n+2]=(12&a)>>2|12&u|(12&d)<<2|(12&p)<<4,t[n+3]=3&a|(3&u)<<2|(3&d)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Ec extends Error{constructor(e){super(e),this.name="MRTError"}}var Ro=Uint8Array,cf=Uint16Array,P5=Int32Array,pA=new Ro([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mA=new Ro([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),R5=new Ro([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gA=function(t,e){for(var n=new cf(31),a=0;a<31;++a)n[a]=e+=1<<t[a-1];var u=new P5(n[30]);for(a=1;a<30;++a)for(var d=n[a];d<n[a+1];++d)u[d]=d-n[a]<<5|a;return{b:n,r:u}},_A=gA(pA,2),yA=_A.b,O5=_A.r;yA[28]=258,O5[258]=28;for(var k5=gA(mA,0).b,Cw=new cf(32768),Mr=0;Mr<32768;++Mr){var uf=(43690&Mr)>>1|(21845&Mr)<<1;Cw[Mr]=((65280&(uf=(61680&(uf=(52428&uf)>>2|(13107&uf)<<2))>>4|(3855&uf)<<4))>>8|(255&uf)<<8)>>1}var tg=function(t,e,n){for(var a=t.length,u=0,d=new cf(e);u<a;++u)t[u]&&++d[t[u]-1];var p,_=new cf(e);for(u=1;u<e;++u)_[u]=_[u-1]+d[u-1]<<1;if(n){p=new cf(1<<e);var y=15-e;for(u=0;u<a;++u)if(t[u])for(var b=u<<4|t[u],T=e-t[u],I=_[t[u]-1]++<<T,D=I|(1<<T)-1;I<=D;++I)p[Cw[I]>>y]=b}else for(p=new cf(a),u=0;u<a;++u)t[u]&&(p[u]=Cw[_[t[u]-1]++]>>15-t[u]);return p},ng=new Ro(288);for(Mr=0;Mr<144;++Mr)ng[Mr]=8;for(Mr=144;Mr<256;++Mr)ng[Mr]=9;for(Mr=256;Mr<280;++Mr)ng[Mr]=7;for(Mr=280;Mr<288;++Mr)ng[Mr]=8;var vA=new Ro(32);for(Mr=0;Mr<32;++Mr)vA[Mr]=5;var L5=tg(ng,9,1),F5=tg(vA,5,1),Iw=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Ts=function(t,e,n){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&n},Dw=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},N5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ss=function(t,e,n){var a=new Error(e||N5[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,Ss),!n)throw a;return a},z5=new Ro(0),B5=typeof TextDecoder<"u"&&new TextDecoder;try{B5.decode(z5,{stream:!0})}catch{}let V5={gzip_data:"gzip"},j5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},U5={uint32:1,uint16:2,uint8:4},$5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class Mw{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new Ec("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new Ec(`Expected header with length >= ${a} but got buffer of length ${n.length}`);let u=new ef(n.subarray(0,a)),d=Ut.read(u);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Ec(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let p of d.layers)this.layers[p.name]=new G5(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],a=this.getLayer(e.layerName);for(let u=0;u<a.dataIndex.length;u++){let d=a.dataIndex[u],p=d.first_byte-e.firstByte,_=d.last_byte+1-e.firstByte;if(u<e.firstBlock||u>e.lastBlock||a._blocksInProgress.has(u))continue;let y={layerName:a.name,firstByte:p,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:u,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(b=>b.filter)};a._blocksInProgress.add(u),n.push(y)}return new xA(n,()=>{n.forEach(u=>a._blocksInProgress.delete(u.blockIndex))},(u,d)=>{if(n.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),u)throw u;d.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class G5{constructor({version:e,name:n,units:a,tilesize:u,pixel_format:d,buffer:p,data_index:_},y){if(this.version=e,this.version!==1)throw new Ec(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=u,this.buffer=p,this.pixelFormat=j5[d],this.dataIndex=_,this.bandShape=[u+2*p,u+2*p,U5[this.pixelFormat]],this._decodedBlocks=function(b=1e3,T=0,I=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new I5(b,T,I)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[a,u]of this.dataIndex.entries()){for(let[d,p]of u.bands.entries())if(p===e)return{bandIndex:n+d,blockIndex:a,blockBandIndex:d};n+=u.bands.length}break;case"number":for(let[a,u]of this.dataIndex.entries()){if(e>=n&&e<n+u.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=u.bands.length}break;default:throw new Ec(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ec(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0,u=1/0,d=-1/0;for(let p of e){let{blockIndex:_}=this.getBlockForBand(p);if(_<0)throw new Ec(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[_];u=Math.min(u,_),d=Math.max(d,_),n=Math.min(n,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:a,firstBlock:u,lastBlock:d}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),u=this._decodedBlocks.get(n.toString());if(!u)throw new Ec(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let d=this.dataIndex[n],p=this.bandShape.reduce((b,T)=>b*T,1),_=a*p,y=u.subarray(_,_+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class xA{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}Mw.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:a,firstByte:u,lastByte:d,pixelFormat:p,blockShape:_,blockIndex:y,filters:b,codec:T}=n,I=new Uint8Array(t).subarray(u,d+1),D=new Uint32Array(_[0]*_[1]*_[2]),R;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return R=function(O,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((Y=function(se){se[0]==31&&se[1]==139&&se[2]==8||Ss(6,"invalid gzip data");var pe=se[3],_e=10;4&pe&&(_e+=2+(se[10]|se[11]<<8));for(var Ee=(pe>>3&1)+(pe>>4&1);Ee>0;Ee-=!se[_e++]);return _e+(2&pe)}(X=O))+8>X.length&&Ss(6,"invalid gzip data"),function(se,pe,_e,Ee){var Oe=se.length;if(!Oe||pe.f&&!pe.l)return _e||new Ro(0);var De=!_e,Ne=De||pe.i!=2,Xe=pe.i;De&&(_e=new Ro(3*Oe));var Le,qe,ke=function(Sc){var Cc=_e.length;if(Sc>Cc){var dh=new Ro(Math.max(2*Cc,Sc));dh.set(_e),_e=dh}},We=pe.f||0,Je=pe.p||0,Ze=pe.b||0,ht=pe.l,Ye=pe.d,tt=pe.m,Tt=pe.n,yt=8*Oe;do{if(!ht){We=Ts(se,Je,1);var gt=Ts(se,Je+1,3);if(Je+=3,!gt){var et=se[(hn=4+((Je+7)/8|0))-4]|se[hn-3]<<8,St=hn+et;if(St>Oe){Xe&&Ss(0);break}Ne&&ke(Ze+et),_e.set(se.subarray(hn,St),Ze),pe.b=Ze+=et,pe.p=Je=8*St,pe.f=We;continue}if(gt==1)ht=L5,Ye=F5,tt=9,Tt=5;else if(gt==2){var qt=Ts(se,Je,31)+257,At=Ts(se,Je+10,15)+4,Xt=qt+Ts(se,Je+5,31)+1;Je+=14;for(var Wt=new Ro(Xt),nn=new Ro(19),Dt=0;Dt<At;++Dt)nn[R5[Dt]]=Ts(se,Je+3*Dt,7);Je+=3*At;var jn=Iw(nn),Bn=(1<<jn)-1,Tn=tg(nn,jn,1);for(Dt=0;Dt<Xt;){var hn,Sn=Tn[Ts(se,Je,Bn)];if(Je+=15&Sn,(hn=Sn>>4)<16)Wt[Dt++]=hn;else{var Yn=0,Hn=0;for(hn==16?(Hn=3+Ts(se,Je,3),Je+=2,Yn=Wt[Dt-1]):hn==17?(Hn=3+Ts(se,Je,7),Je+=3):hn==18&&(Hn=11+Ts(se,Je,127),Je+=7);Hn--;)Wt[Dt++]=Yn}}var yr=Wt.subarray(0,qt),mr=Wt.subarray(qt);tt=Iw(yr),Tt=Iw(mr),ht=tg(yr,tt,1),Ye=tg(mr,Tt,1)}else Ss(1);if(Je>yt){Xe&&Ss(0);break}}Ne&&ke(Ze+131072);for(var Di=(1<<tt)-1,wr=(1<<Tt)-1,ar=Je;;ar=Je){var kr=(Yn=ht[Dw(se,Je)&Di])>>4;if((Je+=15&Yn)>yt){Xe&&Ss(0);break}if(Yn||Ss(2),kr<256)_e[Ze++]=kr;else{if(kr==256){ar=Je,ht=null;break}var ii=kr-254;kr>264&&(ii=Ts(se,Je,(1<<(Hi=pA[Dt=kr-257]))-1)+yA[Dt],Je+=Hi);var oi=Ye[Dw(se,Je)&wr],Wn=oi>>4;if(oi||Ss(3),Je+=15&oi,mr=k5[Wn],Wn>3){var Hi=mA[Wn];mr+=Dw(se,Je)&(1<<Hi)-1,Je+=Hi}if(Je>yt){Xe&&Ss(0);break}Ne&&ke(Ze+131072);var rl=Ze+ii;if(Ze<mr){var ts=0-mr,Is=Math.min(mr,rl);for(ts+Ze<0&&Ss(3);Ze<Is;++Ze)_e[Ze]=(void 0)[ts+Ze]}for(;Ze<rl;++Ze)_e[Ze]=_e[Ze-mr]}}pe.l=ht,pe.p=ar,pe.b=Ze,pe.f=We,ht&&(We=1,pe.m=tt,pe.d=Ye,pe.n=Tt)}while(!We);return Ze!=_e.length&&De?(Le=_e,((qe=Ze)==null||qe>Le.length)&&(qe=Le.length),new Ro(Le.subarray(0,qe))):_e.subarray(0,Ze)}(X.subarray(Y,-8),{i:2},new Ro(((z=X)[(j=z.length)-4]|z[j-3]<<8|z[j-2]<<16|z[j-1]<<24)>>>0))));var z,j,X,Y;let K=V5[F];if(!K)throw new Error(`Unhandled codec: ${F}`);let le=new globalThis.DecompressionStream(K);return new Response(new Blob([O]).stream().pipeThrough(le)).arrayBuffer().then(se=>new Uint8Array(se))}(I,T).then(O=>{let F=Es.read(new ef(O));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(D),new $5[p](D.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),R.then(O=>{for(let F=b.length-1;F>=0;F--)switch(b[F]){case"delta_filter":D5(O,_);break;case"zigzag_filter":M5(O);break;case"bitshuffle_filter":A5(O,p);break;default:throw new Error(`Unhandled filter "${b[F]}"`)}return{layerName:a,blockIndex:y,data:O}}).catch(O=>{throw O})}))};class bA extends M0{constructor(e,n,a,u,d){super(e,n,a,u,d),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let a=n.context,u=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Jo?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Jo(a,e,u.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let a=this._mrt=new Mw(30),u=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Fa(u,(d,p,_,y)=>{if(d)n(d);else try{let b=a.getHeaderLength(p);if(b>e)return void(this.request=this.fetchHeader(b,n));a.parseHeader(p),this._isHeaderLoaded=!0;let T=0;for(let I of Object.values(a.layers))T=Math.max(T,I.dataIndex[I.dataIndex.length-1].last_byte);p.byteLength>=T&&(this.entireBuffer=p),n(null,this.entireBuffer||p,_,y)}catch(b){n(b)}}),this.request}fetchBand(e,n,a){let u=this._mrt;if(!this._isHeaderLoaded||!u)return void a(new Error("Tile header is not ready"));let d=this.actor;if(!d)return void a(new Error("Can't fetch tile band without an actor"));let p,_=(I,D)=>{p.complete(I,D),I?a(I):(this.updateTextureDescriptor(e,n),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(I,D)=>{if(I)return a(I);let R=d.send("decodeRasterArray",{buffer:D,task:p},_,void 0,!0);this._workQueue.push(()=>{R&&R.cancel(),p.cancel()})},b=u.getLayer(e);if(!b)return void a(new Error(`Unknown sourceLayer "${e}"`));if(b.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let T=b.getDataRange([n]);if(p=u.createDecodingTask(T),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(T.firstByte,T.lastByte+1));else{let I=Object.assign({},this.requestParams,{headers:{Range:`bytes=${T.firstByte}-${T.lastByte}`}}),D=Fa(I,y);this._fetchQueue.push(()=>{D.cancel(),p.cancel()})}else a(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(n)||!a.hasDataForBand(n))return;let{bytes:u,tileSize:d,buffer:p,offset:_,scale:y}=a.getBandView(n),b=d+2*p,T={data:u,width:b,height:b},I=this.texture;I&&I instanceof Jo&&I.update(T,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:T,buffer:p,offset:_,tileSize:d,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class H5{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){let u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);let d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let a=e.wrapped().key,u=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let a in this.data)for(let u of this.data[a])e(u.value)||n.push(u);for(let a of n)this.remove(a.value.tileID,a)}}class lh extends za{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new H5(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ZB,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return lo(this._tiles).map(e=>e.tileID).sort(wA).map(e=>e.key)}getRenderableIds(e,n){let a=[];for(let u in this._tiles)this._isIdRenderable(+u,e,n)&&a.push(this._tiles[u]);return e?a.sort((u,d)=>{let p=u.tileID,_=d.tileID,y=new lt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new lt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||b.y-y.y||b.x-y.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(wA).map(u=>u.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new xd(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Ri("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=ti.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ri("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let u=0;u<n.length;u++){let d=n[u];if(e.neighboringTiles&&e.neighboringTiles[d]){let p=this.getTileByID(d);a(e,p),a(p,e)}}function a(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let p=d.tileID.canonical.x-u.tileID.canonical.x,_=d.tileID.canonical.y-u.tileID.canonical.y,y=Math.pow(2,u.tileID.canonical.z),b=d.tileID.key;p===0&&_===0||Math.abs(_)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,p,_),u.neighboringTiles&&u.neighboringTiles[b]&&(u.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,u){for(let d in this._tiles){let p=this._tiles[d];if(u[d]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>a)continue;let _=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){let b=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[b.key],p&&p.hasData()&&(_=b)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){u[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){let u=e.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let a=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,d=Math.floor(a*u*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(_)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let a={};for(let u in this._tiles){let d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(let u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(let u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,a,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Vr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,d=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(d.push(new Vr(1,0,1,0,0)),d.push(new Vr(1,0,1,1,0)),d.push(new Vr(1,0,1,0,1)),d.push(new Vr(1,0,1,1,1)))}else if(d=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);d=d.filter(b=>y(b))}}else d=[];if(d.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Aw(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),b=Math.min(y,this._source.maxzoom),T=e.extendTileCoverForShadows(d,u,b);for(let I of T)this._shadowCasterTiles[I.key]=!0,d.push(I)}let p=this._updateRetainedTiles(d);if(Aw(this._source.type)&&d.length!==0){let y={},b={},T=Object.keys(p);for(let D of T){let R=p[D],O=this._tiles[D];if(!O||O.fadeEndTime&&O.fadeEndTime<=ti.now())continue;let F=this.findLoadedParent(R,Math.max(R.overscaledZ-lh.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),b[D]=R}let I=d[d.length-1].overscaledZ;for(let D in this._tiles){let R=this._tiles[D];if(p[D]||!R.hasData())continue;let O=R.tileID;for(;O.overscaledZ>I;){O=O.scaledTo(O.overscaledZ-1);let F=this._tiles[O.key];if(F&&F.hasData()&&b[O.key]){p[D]=R.tileID;break}}}for(let D in y)p[D]||(this._coveredTiles[D]=!0,p[D]=y[D])}for(let y in p)this._tiles[y].clearFadeHold();let _=function(y,b){let T=[];for(let I in y)I in b||T.push(I);return T}(this._tiles,p);for(let y of _){let b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let a={},u=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),d=e[0].overscaledZ,p=Math.max(d-lh.maxOverzooming,this._source.minzoom),_=Math.max(d+lh.maxUnderzooming,this._source.minzoom),y={};for(let b of e){let T=this._addTile(b);n[b.key]=b,T.hasData()||u<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,u,_,n);for(let b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){let D=b.children(this._source.maxzoom)[0],R=this.getTile(D);if(R&&R.hasData()){n[D.key]=D;continue}}else{let D=b.children(this._source.maxzoom);if(n[D[0].key]&&n[D[1].key]&&n[D[2].key]&&n[D[3].key])continue}let I=T.wasRequested();for(let D=b.overscaledZ-1;D>=p;--D){let R=b.scaledTo(D);if(a[R.key]||(a[R.key]=!0,T=this.getTile(R),!T&&I&&(T=this._addTile(R)),T&&(n[R.key]=R,I=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}n.push(u.key);let d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(let d of n)this._loadedParentTiles[d]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let a=!!n;if(!a){let u=this.map?this.map.painter:null,d=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new bA(e,d,this.transform.tileZoom,u,this._isRaster):new M0(e,d,this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new Ri("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){let u=[],d=this.transform;if(!d)return u;let p=d.projection.name==="globe",_=na(d.center.lng);for(let y in this._tiles){let b=this._tiles[y];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(p){let I=b.tileID.canonical;if(I.z===0){let D=[Math.abs(Qt(_,...rg(I,-1))-_),Math.abs(Qt(_,...rg(I,1))-_)];T=[0,2*D.indexOf(Math.min(...D))-1]}else{let D=[Math.abs(Qt(_,...rg(I,-1))-_),Math.abs(Qt(_,...rg(I,0))-_),Math.abs(Qt(_,...rg(I,1))-_)];T=[D.indexOf(Math.min(...D))-1]}}else T=[0];for(let I of T){let D=e.containsTile(b,d,n,I);D&&u.push(D)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let a=this.getRenderableIds(e,n).map(d=>this._tiles[d].tileID),u=this.transform.projection.name==="globe";for(let d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=u?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){let n=e.slice(),a=this.transform._camera.position,u=this.transform._camera.forward(),d={};for(let p of n){let _=1/(1<<p.canonical.z);d[p.key]=((p.canonical.x+.5)*_+p.wrap-a[0])*u[0]+((p.canonical.y+.5)*_-a[1])*u[1]-a[2]*u[2]}return n.sort((p,_)=>d[p.key]-d[_.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Aw(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=ti.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){let u=this._tiles[e];u&&u.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(let a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,n))};return void this._source.on("data",_)}let a=new Map,u=Array.isArray(e)?e:[e],d=this.map.painter.terrain,p=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(let _ of u){let y=_.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let b of y)a.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}Nl(Array.from(a.values()),(_,y)=>{let b=new M0(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),y(T,b)})},n)}}function wA(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Aw(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function rg(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}lh.maxOverzooming=10,lh.maxUnderzooming=3;let EA=new class extends ut{possiblyEvaluate(t,e){return e=new Bt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=fi({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(h0.paint.properties["line-width"].specification);function TA(t,e){return e>0?e+2*t:t}EA.useIntegerZoom=!0;let q5=new On({"symbol-placement":new Be(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Be(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Be(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Be(Te.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Be(Te.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Be(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Be(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Be(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Be(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(Te.layout_symbol["icon-size"]),"icon-text-fit":new ut(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(Te.layout_symbol["icon-image"]),"icon-rotate":new ut(Te.layout_symbol["icon-rotate"]),"icon-padding":new Be(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Be(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(Te.layout_symbol["icon-offset"]),"icon-anchor":new ut(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Be(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Be(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Be(Te.layout_symbol["text-rotation-alignment"]),"text-field":new ut(Te.layout_symbol["text-field"]),"text-font":new ut(Te.layout_symbol["text-font"]),"text-size":new ut(Te.layout_symbol["text-size"]),"text-max-width":new ut(Te.layout_symbol["text-max-width"]),"text-line-height":new ut(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(Te.layout_symbol["text-letter-spacing"]),"text-justify":new ut(Te.layout_symbol["text-justify"]),"text-radial-offset":new ut(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Be(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new ut(Te.layout_symbol["text-anchor"]),"text-max-angle":new Be(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Be(Te.layout_symbol["text-writing-mode"]),"text-rotate":new ut(Te.layout_symbol["text-rotate"]),"text-padding":new Be(Te.layout_symbol["text-padding"]),"text-keep-upright":new Be(Te.layout_symbol["text-keep-upright"]),"text-transform":new ut(Te.layout_symbol["text-transform"]),"text-offset":new ut(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Be(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Be(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Be(Te.layout_symbol["text-optional"]),visibility:new Be(Te.layout_symbol.visibility)});var Pw={paint:new On({"icon-opacity":new ut(Te.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ut(Te.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ut(Te.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ut(Te.paint_symbol["text-emissive-strength"]),"icon-color":new ut(Te.paint_symbol["icon-color"]),"icon-halo-color":new ut(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Be(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Be(Te.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Te.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ut(Te.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ut(Te.paint_symbol["text-occlusion-opacity"]),"text-color":new ut(Te.paint_symbol["text-color"],{runtimeType:Oi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ut(Te.paint_symbol["text-halo-color"]),"text-halo-width":new ut(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(Te.paint_symbol["text-halo-blur"]),"text-translate":new Be(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Be(Te.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Be(Te.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Be(Te.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Be(Te.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Be(Te.paint_symbol["icon-color-brightness-max"])}),layout:q5};class SA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Wl,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}J(SA,"FormatSectionOverride",{omit:["defaultValue"]});class A0 extends gi{constructor(e,n,a,u){super(e,Pw,n,a,u),this._colorAdjustmentMatrix=r.ad.identity([])}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let u=[];for(let d of a)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,u){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(d,p,_,y){d=ud(d),p=cd(p);let b=r.ad.create(),T=d/3,I=1-2*T,D=[I,T,T,0,T,I,T,0,T,T,I,0,0,0,0,1],R=.5-.5*p,O=y-_;return r.ad.multiply(b,[O,0,0,0,0,O,0,0,0,0,O,0,_,_,_,1],[p,0,0,0,0,p,0,0,0,0,p,0,R,R,R,1]),r.ad.multiply(b,b,D),b}(e,n,a,u),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,u){let d=this.layout.get(e).evaluate(n,{},a,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||N(p.value)||!d?d:function(_,y){return y.replace(/{([^{}]+)}/g,(b,T)=>T in _?String(_[T]):"")}(n.properties,d)}createBucket(e){return new lf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Pw.paint.overridableProperties){if(!A0.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new SA(n),u=new k(a,n.property.specification,this.scope,this.options),d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new V("source",u):new G("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Jn(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&A0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),u=Pw.paint.properties[n],d=!1,p=_=>{for(let y of _)if(u.overrides&&u.overrides.hasOverride(y))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof pi)p(a.value.value.sections);else if(a.value.kind==="source"){let _=b=>{d||(b instanceof fs&&Or(b.value)===Xl?p(b.value.sections):b instanceof ku?p(b.sections):b.eachChild(_))},y=a.value;y._styleExpression&&_(y._styleExpression.expression)}return d}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n,a){return{config:new th(this,{zoom:n,lut:a}),overrideFog:!1}}}let W5=new On({visibility:new Be(Te.layout_background.visibility)});var Z5={paint:new On({"background-color":new Be(Te.paint_background["background-color"]),"background-pattern":new Be(Te.paint_background["background-pattern"]),"background-opacity":new Be(Te.paint_background["background-opacity"]),"background-emissive-strength":new Be(Te.paint_background["background-emissive-strength"])}),layout:W5};let X5=new On({visibility:new Be(Te.layout_raster.visibility)});var Y5={paint:new On({"raster-opacity":new Be(Te.paint_raster["raster-opacity"]),"raster-color":new Br(Te.paint_raster["raster-color"]),"raster-color-mix":new Be(Te.paint_raster["raster-color-mix"]),"raster-color-range":new Be(Te.paint_raster["raster-color-range"]),"raster-hue-rotate":new Be(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Be(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Be(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Be(Te.paint_raster["raster-saturation"]),"raster-contrast":new Be(Te.paint_raster["raster-contrast"]),"raster-resampling":new Be(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Be(Te.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Be(Te.paint_raster["raster-emissive-strength"]),"raster-array-band":new Be(Te.paint_raster["raster-array-band"]),"raster-elevation":new Be(Te.paint_raster["raster-elevation"])}),layout:X5};function P0(t,e,n,a,u,d,p,_){let y=[t,e,1,n,a,1,u,d,1],b=[p,_,1],T=r.bC.adjoint([],y),[I,D,R]=r._.transformMat3(b,b,T);return r.bC.multiply(y,y,[I,0,0,0,D,0,0,0,R])}function CA(t,e,n,a,u,d,p,_){let y=function(b,T,I,D,R,O,F,z){let j=P0(0,0,1,0,1,1,0,1),X=P0(b,T,I,D,R,O,F,z),Y=r.bC.adjoint([],j);return r.bC.multiply(X,X,Y)}(t,e,n,a,u,d,p,_);return[y[2]/y[8]/it,y[5]/y[8]/it]}function R0(t){return[t[0],Math.min(Math.max(t[1],-Ir),Ir)]}class IA extends za{constructor(e,n,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Ri("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=qs(this.map._requestManager.transformRequest(this.url,md.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new xd(a)):u&&(this.image=u instanceof HTMLImageElement?ti.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new C0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ri("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof C0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(let d of e)d[1]>a&&(a=d[1]),d[1]<n&&(n=d[1]);let u=(a+n)/2;if(u>Ir?this.onNorthPole=!0:u<-Ir&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let d=e.map(Ii.fromLngLat);this.tileID=function(p){let _=1/0,y=1/0,b=-1/0,T=-1/0;for(let F of p)_=Math.min(_,F.x),y=Math.min(y,F.y),b=Math.max(b,F.x),T=Math.max(T,F.y);let I=Math.max(b-_,T-y),D=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),R=Math.pow(2,D),O=Math.floor((_+b)/2*R);return O>1&&(O-=1),new rh(D,O,Math.floor((y+T)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ri("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let z in this.tiles){let j=this.tiles[z];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=ah(new rh(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(z){let j=z[1].x-z[0].x,X=z[1].y-z[0].y,Y=z[2].x-z[1].x,K=z[2].y-z[1].y,le=z[3].x-z[2].x,se=z[3].y-z[2].y,pe=z[0].x-z[3].x,_e=z[0].y-z[3].y,Ee=j*K-Y*X,Oe=Y*se-le*K,De=le*_e-pe*se,Ne=pe*X-j*_e;return Ee>0&&Oe>0&&De>0&&Ne>0||Ee<0&&Oe<0&&De<0&&Ne<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let u=ah(this.tileID,this.map.transform.projection),[d,p,_,y]=this.coordinates.map(z=>{let j=u.projection.project(z[0],z[1]);return sA(u,j)._round()});this.perspectiveTransform=CA(d.x,d.y,p.x,p.y,_.x,_.y,y.x,y.y);let b=this._boundsArray=new sc;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(p.x,p.y,it,0),b.emplaceBack(y.x,y.y,0,it),b.emplaceBack(_.x,_.y,it,it),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,D0.members),this.boundsSegments=fr.simpleSegment(0,0,4,2);let T=[],I=function(z){return[R0(z[0]),R0(z[1]),R0(z[2]),R0(z[3])]}(this.coordinates),[D,R,O,F]=function(z){let j=z[0][0],X=j,Y=z[0][1],K=Y;for(let le=1;le<z.length;le++)z[le][0]<j?j=z[le][0]:z[le][0]>X&&(X=z[le][0]),z[le][1]<Y?Y=z[le][1]:z[le][1]>K&&(K=z[le][1]);return[j,Y,X-j,K-Y]}(I);{let z=new sc,[j,X,Y,K]=function(ke){let We=ke[0].x,Je=We,Ze=ke[0].y,ht=Ze;for(let Ye=1;Ye<ke.length;Ye++)ke[Ye].x<We?We=ke[Ye].x:ke[Ye].x>Je&&(Je=ke[Ye].x),ke[Ye].y<Ze?Ze=ke[Ye].y:ke[Ye].y>ht&&(ht=ke[Ye].y);return[We,Ze,Je-We,ht-Ze]}(a),le=ke=>[(ke.x-j)/Y,(ke.y-X)/K],[se,pe,_e,Ee]=a.map(le),Oe=function(ke,We,Je,Ze,ht,Ye,tt,Tt){let yt=P0(0,0,1,0,1,1,0,1),gt=P0(ke,We,Je,Ze,ht,Ye,tt,Tt),et=r.bC.adjoint([],gt);return r.bC.multiply(yt,yt,et)}(se[0],se[1],pe[0],pe[1],_e[0],_e[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=CA(se[0],se[1],pe[0],pe[1],_e[0],_e[1],Ee[0],Ee[1]);let De=(ke,We)=>{T.push(ke.lng);let Je=Math.round((ke.lng-D)/O*it),Ze=Math.round((ke.lat-R)/F*it),ht=le(We),Ye=r._.transformMat3([],[ht[0],ht[1],1],Oe),tt=Math.round(Ye[0]/Ye[2]*it),Tt=Math.round(Ye[1]/Ye[2]*it);z.emplaceBack(Je,Ze,tt,Tt)},Ne=a[3].x-a[0].x,Xe=a[3].y-a[0].y,Le=a[2].x-a[1].x,qe=a[2].y-a[1].y;for(let ke=0;ke<65;ke++){let We=ke/64,Je=[a[0].x+We*Ne,a[0].y+We*Xe],Ze=[a[1].x+We*Le,a[1].y+We*qe],ht=Ze[0]-Je[0],Ye=Ze[1]-Je[1];for(let tt=0;tt<65;tt++){let Tt=tt/64,yt={x:Je[0]+ht*Tt,y:Je[1]+Ye*Tt,z:0};De(n.projection.unproject(yt.x,yt.y),yt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(z,D0.members)}{this.maxLongitudeTriangleSize=0;let z=[],j=new Zr,X=(Y,K,le)=>{j.emplaceBack(Y,K,le);let se=T[Y],pe=T[K],_e=T[le],Ee=Math.min(Math.min(se,pe),_e),Oe=Math.max(Math.max(se,pe),_e)-Ee;Oe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Oe),z.push(Ee+Oe/2)};for(let Y=0;Y<64;Y++)for(let K=0;K<64;K++){let le=65*Y+K,se=le+1,pe=le+65,_e=pe+1;X(le,pe,se),X(se,pe,_e)}[z,j]=function(Y,K){let le=Array.from({length:Y.length},(_e,Ee)=>Ee);le.sort((_e,Ee)=>Y[_e]-Y[Ee]);let se=[],pe=new Zr;for(let _e=0;_e<le.length;_e++){let Ee=le[_e];se.push(Y[Ee]);let Oe=3*Ee,De=Oe+1;pe.emplaceBack(K.uint16[Oe],K.uint16[De],K.uint16[De+1])}return[se,pe]}(z,j),this.elevatedGlobeTrianglesCenterLongitudes=z,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(j)}this.elevatedGlobeSegments=fr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/it,0,F/it,0,0,R,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof C0||(this.texture?this.texture.update(this.image):(this.texture=new Jo(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,u=(d=e+180)+360*Math.round((a[0]-d)/360);var d;let p=new fr,_=(I,D)=>{p.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:n.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=y){let I=q_(a,0,a.length,u+y);return I===a.length||_(I,zp(a,I+1,a.length,u+360-y)-I),p}u<a[0]&&(u+=360);let b=zp(a,0,a.length,u-y);if(b===a.length)return _(0,a.length),p;_(0,b-0);let T=q_(a,b+1,a.length,u+y);return T!==a.length&&_(T,a.length-T),p}}let K5=(Math.pow(256,2)-1)/16907520;class DA extends gi{constructor(e,n,a,u){super(e,Y5,n,a,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof IA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[a,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(u)||a===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=zm({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,u])}}let Q5=new On({visibility:new Be(Te["layout_raster-particle"].visibility)});var J5={paint:new On({"raster-particle-array-band":new Be(Te["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Be(Te["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Br(Te["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Be(Te["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Be(Te["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Be(Te["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Be(Te["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:Q5};class MA extends gi{constructor(e,n,a,u){super(e,J5,n,a,u),this._updateColorRamp(),this.lastInvalidatedAt=ti.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=zm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ti.now()}}class e4 extends gi{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let t4=new On({visibility:new Be(Te.layout_sky.visibility)});var n4={paint:new On({"sky-type":new Be(Te.paint_sky["sky-type"]),"sky-atmosphere-sun":new Be(Te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Be(Te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Be(Te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Be(Te.paint_sky["sky-gradient-radius"]),"sky-gradient":new Br(Te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Be(Te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Be(Te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Be(Te.paint_sky["sky-opacity"])}),layout:t4};function Rw(t,e,n){let a=[0,0,1],u=r.av.identity([]);return r.av.rotateY(u,u,n?-ln(t)+Math.PI:ln(t)),r.av.rotateX(u,u,-ln(e)),r._.transformQuat(a,a,u),r._.normalize(a,a)}var r4={paint:new On({})};function AA(t,e){let n=O0(t.projection,t.zoom,t.width,t.height),a=function(d,p,_,y,b){let T=new vn(_.lng-180*Tc,_.lat),I=new vn(_.lng+180*Tc,_.lat),D=d.project(T.lng,T.lat),R=d.project(I.lng,I.lat),O=-Math.atan2(R.y-D.y,R.x-D.x),F=Ii.fromLngLat(_);F.y=Qt(F.y,-1+Tc,1-Tc);let z=F.toLngLat(),j=d.project(z.lng,z.lat),X=Ii.fromLngLat(z);X.x+=Tc;let Y=X.toLngLat(),K=d.project(Y.lng,Y.lat),le=OA(K.x-j.x,K.y-j.y,O),se=Ii.fromLngLat(z);se.y+=Tc;let pe=se.toLngLat(),_e=d.project(pe.lng,pe.lat),Ee=OA(_e.x-j.x,_e.y-j.y,O),Oe=Math.abs(le.x)/Math.abs(Ee.y),De=r.ad.identity([]);r.ad.rotateZ(De,De,-O*(1-(b?0:y)));let Ne=r.ad.identity([]);return r.ad.scale(Ne,Ne,[1,1-(1-Oe)*y,1]),Ne[4]=-Ee.x/Ee.y*y,r.ad.rotateZ(Ne,Ne,O),r.ad.multiply(Ne,De,Ne),Ne}(t.projection,0,t.center,n,e),u=PA(t);return r.ad.scale(a,a,[u,u,1]),a}function PA(t){let e=t.projection,n=O0(t.projection,t.zoom,t.width,t.height),a=RA(e,t.center),u=RA(e,vn.convert(e.center));return Math.pow(2,a*n+(1-n)*u)}function O0(t,e,n,a,u=1/0){let d=t.range;if(!d)return 0;let p=Math.min(u,Math.max(n,a)),_=Math.log(p/1024)/Math.LN2;return Ra(d[0]+_,d[1]+_,e)}let Tc=1/4e4;function RA(t,e){let n=Qt(e.lat,-Ir,Ir),a=new vn(e.lng-180*Tc,n),u=new vn(e.lng+180*Tc,n),d=t.project(a.lng,n),p=t.project(u.lng,n),_=Ii.fromLngLat(a),y=Ii.fromLngLat(u),b=p.x-d.x,T=p.y-d.y,I=y.x-_.x,D=y.y-_.y,R=Math.sqrt((I*I+D*D)/(b*b+T*T));return Math.log(R)/Math.LN2}function OA(t,e,n){let a=Math.cos(n),u=Math.sin(n);return{x:t*a-e*u,y:t*u+e*a}}function kA(t,e,n){r.ad.identity(t),r.ad.rotateZ(t,t,ln(e[2])),r.ad.rotateX(t,t,ln(e[0])),r.ad.rotateY(t,t,ln(e[1])),r.ad.scale(t,t,n),r.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function k0(t,e,n,a,u,d,p,_){let y=[n[0]-e[0],n[1]-e[1],0],b=[a[0]-e[0],a[1]-e[1],0];if(r._.length(y)<1e-12||r._.length(b)<1e-12)return r.av.identity(t);let T=r._.cross([],y,b);r._.normalize(T,T),r._.subtract(b,a,e),y[2]=(d-u)*_,b[2]=(p-u)*_;let I=y;return r._.cross(I,y,b),r._.normalize(I,I),r.av.rotationTo(t,T,I)}function Ow(t,e,n=!1){let a=el(e.zoom),u=function(d,p,_){let y=p.worldSize,b=[d[12],d[13],d[14]],T=ri(b[1]/y),I=Ki(b[0]/y),D=r.ad.identity([]),R=Gi(1,T)*y,O=Gi(1,0)*y*ih(T,p.zoom),F=1/Kb(y),z=O*F;if(_){let K=O0(p.projection,p.zoom,p.width,p.height,1024);z=F*p.projection.pixelSpaceConversion(p.center.lat,y,K)}let j=nh(T,I);r._.add(j,j,r._.scale([],r._.normalize([],j),R*z*b[2]));let X=function(K){let le=[K[0],K[1],K[2]],se=[0,1,0],pe=r._.cross([],se,le);return r._.cross(se,le,pe),r._.squaredLength(se)===0&&(se=[0,1,0],r._.cross(pe,le,se)),r._.normalize(pe,pe),r._.normalize(se,se),r._.normalize(le,le),[pe[0],pe[1],pe[2],0,se[0],se[1],se[2],0,le[0],le[1],le[2],0,K[0],K[1],K[2],1]}(j);r.ad.scale(D,D,[z,z,z*R]),r.ad.translate(D,D,[-b[0],-b[1],-b[2]]);let Y=r.ad.multiply([],p.globeMatrix,X);return r.ad.multiply(Y,Y,D),r.ad.multiply(Y,Y,d),Y}(t,e,n);if(a>0){let d=function(p,_){let y=_.worldSize,b=Gi(1,0)*y*ih(_.center.lat,_.zoom)/Kb(y),T=Gi(1,_.center.lat)*y,I=r.ad.identity([]);return r.ad.rotateY(I,I,ln(_.center.lng)),r.ad.rotateX(I,I,ln(_.center.lat)),r.ad.translate(I,I,[0,0,$i]),r.ad.scale(I,I,[b,b,b*T]),r.ad.translate(I,I,[_.point.x-.5*y,_.point.y-.5*y,0]),r.ad.multiply(I,I,p),r.ad.multiply(I,_.globeMatrix,I)}(t,e);return function(p,_,y){let b=(O,F,z)=>{let j=r._.length(O),X=r._.length(F),Y=Ja(O,F,z);return r._.scale(Y,Y,1/r._.length(Y)*It(j,X,z))},T=b([p[0],p[1],p[2]],[_[0],_[1],_[2]],y),I=b([p[4],p[5],p[6]],[_[4],_[5],_[6]],y),D=b([p[8],p[9],p[10]],[_[8],_[9],_[10]],y),R=Ja([p[12],p[13],p[14]],[_[12],_[13],_[14]],y);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,D[0],D[1],D[2],0,R[0],R[1],R[2],1]}(u,d,a)}return u}function LA(t,e,n,a){let u=pr.projectAabbCorners(a,n),d=Number.MAX_VALUE,p=-1;for(let b=0;b<u.length;++b){let T=u[b];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<d&&(p=b,d=T[2])}let _=b=>new lt(u[b][0],u[b][1]),y;switch(p){case 0:case 6:y=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:y=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:y=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:y=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(jb(t,y))return d}let i4=Mn([{name:"a_pos_3f",components:3,type:"Float32"}]),o4=Mn([{name:"a_color_3f",components:3,type:"Float32"}]),s4=Mn([{name:"a_color_4f",components:4,type:"Float32"}]),a4=Mn([{name:"a_uv_2f",components:2,type:"Float32"}]),l4=Mn([{name:"a_normal_3f",components:3,type:"Float32"}]),c4=Mn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),u4=Mn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class L0{constructor(e,n,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function FA(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class NA{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class zA{constructor(){this.instancedDataArray=new Tb,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class kw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,u){this.tileToMeter=Gy(a);let d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:_,index:y,sourceLayerIndex:b}of e){let T=_??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),I=Qa(p,d);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),I,a))continue;let D={id:T,sourceLayerIndex:b,index:y,geometry:d?I.geometry:vs(p,a,u),properties:p.properties,type:p.type,patterns:{}},R=this.addFeature(D,D.geometry,I);R&&n.featureIndex.insert(p,D.geometry,y,b,this.index,this.instancesPerModel[R].instancedDataArray.length,it/32)}this.lookup=null}update(e,n,a,u){for(let d in this.instancesPerModel){let p=this.instancesPerModel[d];for(let _ in e)p.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(p.features[p.idToFeaturesIndex[_]],e[_],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];for(let u of a.features){let d=this.layers[0],p=u.feature,_=this.canonical,y=d.paint.get("model-rotation").evaluate(p,{},_),b=d.paint.get("model-scale").evaluate(p,{},_),T=d.paint.get("model-translation").evaluate(p,{},_);r._.exactEquals(u.rotation,y)&&r._.exactEquals(u.scale,b)&&r._.exactEquals(u.translation,T)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let u=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(aw(this.activeReplacements,u))return!1;this.activeReplacements=u;let d=!1;for(let p in this.instancesPerModel){let _=this.instancesPerModel[p],y=_.instancedDataArray;for(let b of _.features){let T=b.instancedDataOffset,I=b.instancedDataCount;for(let D=0;D<I;D++){let R=16*(D+T),O=y.float32[R+0];O=O>it?O-it:O;let F=Math.floor(O),z=y.float32[R+1],j=!1;for(let X of this.activeReplacements)if(!(X.order<a||X.order===1/0)&&X.clipMask&rM.Model&&!(X.min.x>F||F>X.max.x||X.min.y>z||z>X.max.y)&&(j=XD(ZD(F,z,e.canonical,X.footprintTileId.canonical),X),j))break;y.float32[R]=j?O+it:O,d=d||j}}}return d}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,c4.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){let u=this.layers[0],d=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return Sr(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),d;FA(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new zA);let p=this.instancesPerModel[d],_=p.instancedDataArray,y=new NA(a,_.length);for(let b of n)for(let T of b){if(T.x<0||T.x>=it||T.y<0||T.y>=it)continue;let I=(this.lookupDim-1)/it,D=this.lookupDim*(T.y*I|0)+T.x*I|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let R=_.length;_.resize(R+1),p.instancesEvaluatedElevation.push(0),_.float32[16*R]=T.x,_.float32[16*R+1]=T.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),d}getModelUris(){return this.modelUris}evaluate(e,n,a,u){let d=this.layers[0],p=e.feature,_=this.canonical,y=e.rotation=d.paint.get("model-rotation").evaluate(p,n,_),b=e.scale=d.paint.get("model-scale").evaluate(p,n,_),T=e.translation=d.paint.get("model-translation").evaluate(p,n,_),I=d.paint.get("model-color").evaluate(p,n,_);I.a=d.paint.get("model-color-mix-intensity").evaluate(p,n,_);let D=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),kA(D,y,b);let R=Math.round(100*I.a)+I.b/1.05;for(let O=0;O<e.instancedDataCount;++O){let F=e.instancedDataOffset+O,z=16*F,j=a.instancedDataArray.float32,X=0;u&&(X=j[z+6]-a.instancesEvaluatedElevation[F]);let Y=0|j[z+1];j[z]=(0|j[z])+I.r/1.05,j[z+1]=Y+I.g/1.05,j[z+2]=R,j[z+3]=1/(_.z>10?this.tileToMeter:Gy(_,Y)),j[z+4]=T[0],j[z+5]=T[1],j[z+6]=T[2]+X,j[z+7]=D[0],j[z+8]=D[1],j[z+9]=D[2],j[z+10]=D[4],j[z+11]=D[5],j[z+12]=D[6],j[z+13]=D[8],j[z+14]=D[9],j[z+15]=D[10],a.instancesEvaluatedElevation[F]=T[2]}}}J(kw,"ModelBucket",{omit:["layers"]}),J(zA,"PerModelAttributes"),J(NA,"ModelFeature");let h4=new On({visibility:new Be(Te.layout_model.visibility),"model-id":new ut(Te.layout_model["model-id"])});var d4={paint:new On({"model-opacity":new Be(Te.paint_model["model-opacity"]),"model-rotation":new ut(Te.paint_model["model-rotation"]),"model-scale":new ut(Te.paint_model["model-scale"]),"model-translation":new ut(Te.paint_model["model-translation"]),"model-color":new ut(Te.paint_model["model-color"]),"model-color-mix-intensity":new ut(Te.paint_model["model-color-mix-intensity"]),"model-type":new Be(Te.paint_model["model-type"]),"model-cast-shadows":new Be(Te.paint_model["model-cast-shadows"]),"model-receive-shadows":new Be(Te.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Be(Te.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ut(Te.paint_model["model-emissive-strength"]),"model-roughness":new ut(Te.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ut(Te.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Be(Te.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Be(Te.paint_model["model-front-cutoff"])}),layout:h4};let ch=64,hf={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function BA(t,e,n,a,u,d,p,_,y,b=!1){let T=n.zoom,I=n.project(a),D=ih(a.lat,T),R=1/D;r.ad.identity(t),r.ad.translate(t,t,[I.x+p[0]*R,I.y+p[1]*R,p[2]]);let O=1,F=1,z=n.worldSize;if(b){if(n.projection.name==="mercator"){let K=0;n.elevation&&(K=n.elevation.getAtPointOrZero(new Ii(I.x/z,I.y/z),0));let le=r.aA.transformMat4([],[I.x,I.y,K,1],n.projMatrix)[3]/n.cameraToCenterDistance;O=le,F=le*ih(n.center.lat,T)}else if(n.projection.name==="globe"){let K=Ow(t,n),le=r.ad.multiply([],n.projMatrix,K),se=[0,0,0,1];r.aA.transformMat4(se,se,le);let pe=se[3]/n.cameraToCenterDistance,_e=el(T),Ee=n.projection.pixelsPerMeter(a.lat,z)*ih(a.lat,T),Oe=n.projection.pixelsPerMeter(n.center.lat,z)*ih(n.center.lat,T);O=pe/It(Ee,rD(n.center.lat),_e),F=pe*D/Ee,O*=Oe,F*=Oe}}else O=R;r.ad.scale(t,t,[O,O,F]);let j=[...t],X=e.orientation,Y=[];if(kA(Y,[X[0]+u[0],X[1]+u[1],X[2]+u[2]],d),r.ad.multiply(t,j,Y),_&&n.elevation){let K=0,le=[];if(y&&n.elevation){K=function(_e,Ee,Oe,De,Ne){let Xe=Ee.elevation;if(!Xe)return 0;let Le=pr.projectAabbCorners(Oe,De),qe=Gi(1,Ne.lat)*Ee.worldSize,ke=function(St,qt){let At=[0,0,1],Xt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Wt of Xt){let nn=St[Wt.corners[0]],Dt=St[Wt.corners[1]],jn=St[Wt.corners[2]],Bn=[Dt[0]-nn[0],Dt[1]-nn[1],qt*(Dt[2]-nn[2])],Tn=r._.cross(Bn,Bn,[jn[0]-nn[0],jn[1]-nn[1],qt*(jn[2]-nn[2])]);r._.normalize(Tn,Tn),Wt.dotProductWithUp=r._.dot(Tn,At)}return Xt.sort((Wt,nn)=>Wt.dotProductWithUp-nn.dotProductWithUp),Xt[0].corners}(Le,qe),We=Le[ke[0]],Je=Le[ke[1]],Ze=Le[ke[2]],ht=Le[ke[3]],Ye=Xe.getAtPointOrZero(new Ii(We[0]/Ee.worldSize,We[1]/Ee.worldSize),0),tt=Xe.getAtPointOrZero(new Ii(Je[0]/Ee.worldSize,Je[1]/Ee.worldSize),0),Tt=Xe.getAtPointOrZero(new Ii(Ze[0]/Ee.worldSize,Ze[1]/Ee.worldSize),0),yt=Xe.getAtPointOrZero(new Ii(ht[0]/Ee.worldSize,ht[1]/Ee.worldSize),0),gt=(Ye+yt)/2,et=(tt+Tt)/2;return gt>et?tt<Tt?k0(_e,Je,ht,We,tt,yt,Ye,qe):k0(_e,Ze,We,ht,Tt,Ye,yt,qe):Ye<yt?k0(_e,We,Je,Ze,Ye,tt,Tt,qe):k0(_e,ht,Ze,Je,yt,Tt,tt,qe),Math.max(gt,et)}(le,n,e.aabb,t,a);let se=r.ad.fromQuat([],le),pe=r.ad.multiply([],se,Y);r.ad.multiply(t,j,pe)}else K=n.elevation.getAtPointOrZero(new Ii(I.x/z,I.y/z),0);K!==0&&(t[14]+=K)}}function ig(t,e,n=!1){t.uploaded||(t.gfxTexture=new Jo(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function f4(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,i4.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,l4.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,a4.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?o4:s4).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,u4.members,!0)),t.segments=fr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&ig(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&ig(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&ig(a.normalTexture,e),a.occlusionTexture&&ig(a.occlusionTexture,e,n),a.emissionTexture&&ig(a.emissionTexture,e)}function Lw(t,e,n){if(t.meshes)for(let a of t.meshes)f4(a,e,n);if(t.children)for(let a of t.children)Lw(a,e,n)}function F0(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)F0(e)}function Fw(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)Fw(n)}class p4{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class m4{constructor(){this.tasks={},this.taskQueue=[],sd(["process"],this),this.invoker=new p4(this.process),this.nextId=0}add(e,n){let a=this.nextId++,u=function({type:d,isSymbolTile:p,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-_:d==="maybePrepare"&&p?400-_:500:200-_:100-_}(n);if(u===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){let d=this.tasks[this.taskQueue[u]];d.priority<n&&(n=d.priority,e=u)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class VA{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},sd(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new m4}send(e,n,a,u,d=!1,p){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[_]=a);let y=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:ge(n,y)},y),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){let n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(n.mustQueue||ei()){let u=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,n),u&&u.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Se(n.error)):a(null,Se(n.data)))}else{let a=new Set,u=n.hasCallback?(p,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?ge(p):null,data:ge(_,a)},a)}:p=>{},d=Se(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,d,u);else if(this.parent.getWorkerSource){let p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],d.source,d.scope)[p[1]](d,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Nw=(()=>{class t{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=id();let u=this.workerPool.acquire(this.id);for(let d=0;d<u.length;d++){let p=new t.Actor(u[d],a,this.id);p.name=`Worker ${d}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,u){Nl(this.actors,(d,p)=>{d.send(n,a,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=VA,t})();var og={workerUrl:"",workerClass:null,workerParams:void 0};function g4(){return og.workerClass!=null?new og.workerClass:new self.Worker(og.workerUrl,og.workerParams)}let zw="mapboxgl_preloaded_worker_pool";class sg{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<sg.workerCount;)this.workers.push(new g4);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zw]}numActive(){return Object.keys(this.active).length}}let ag;function N0(){return ag||(ag=new sg),ag}sg.workerCount=2;let z0,Bw,Cs,df,Vw,ff=null;function jA(){return ei()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Bw||A.DRACO_URL}function UA(){if(ei()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(df)return df;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return df=WebAssembly.validate(t)?A.MESHOPT_SIMD_URL:A.MESHOPT_URL,df}let B0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_4={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},lg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function $A(t,e,n){let a=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:u,byteLength:t.byteLength},n.buffers[u]=t}let jw="KHR_draco_mesh_compression";function y4(t,e){let n=t.extensions&&t.extensions[jw];if(!n)return;let a=new Cs.Decoder,u=WA(e,n.bufferView),d=new Cs.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,d))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[t.indices],_=B0[p.componentType],y=p.count*_.BYTES_PER_ELEMENT,b=Cs._malloc(y);_===Uint16Array?a.GetTrianglesUInt16Array(d,y,b):a.GetTrianglesUInt32Array(d,y,b),$A(Cs.memory.buffer.slice(b,b+y),p,e),Cs._free(b);for(let T of Object.keys(n.attributes)){let I=a.GetAttributeByUniqueId(d,n.attributes[T]),D=e.json.accessors[t.attributes[T]],R=_4[D.componentType],O=D.count*lg[D.type]*B0[D.componentType].BYTES_PER_ELEMENT,F=Cs._malloc(O);a.GetAttributeDataArrayForAllPoints(d,I,Cs[R],O,F),$A(Cs.memory.buffer.slice(F,F+O),D,e),Cs._free(F)}a.destroy(),d.destroy(),delete t.extensions[jw]}let V0="EXT_meshopt_compression";function v4(t,e){if(!t.extensions||!t.extensions[V0])return;let n=t.extensions[V0],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),u=new Uint8Array(n.count*n.byteStride);Vw.decodeGltfBuffer(u,n.count,n.byteStride,a,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=u.buffer,delete t.extensions[V0]}let GA=1179937895,HA=new TextDecoder("utf8");function qA(t,e){return new URL(t,e).href}function x4(t,e,n,a){return fetch(qA(t.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function WA(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function b4(t,e,n,a){if(t.uri){let u=qA(t.uri,a);return fetch(u).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[n]=d})}if(t.bufferView!==void 0){let u=WA(e,t.bufferView),d=new Blob([u],{type:t.mimeType});return createImageBitmap(d).then(p=>{e.images[n]=p})}}function ZA(t,e=0,n){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===GA){let T=new Uint32Array(t,e),I=2,D=(T[I++]>>2)-3,R=T[I++]>>2;if(I++,a.json=JSON.parse(HA.decode(T.subarray(I,I+R))),I+=R,I<D){let O=T[I++];I++;let F=e+(I<<2);a.buffers[0]=t.slice(F,F+O)}}else a.json=JSON.parse(HA.decode(new Uint8Array(t,e)));let{buffers:u,images:d,meshes:p,extensionsUsed:_,bufferViews:y}=a.json,b=Promise.resolve();if(u){let T=[];for(let I=0;I<u.length;I++){let D=u[I];D.uri?T.push(x4(D,a,I,n)):a.buffers[I]||(a.buffers[I]=null)}b=Promise.all(T)}return b.then(()=>{let T=[],I=_&&_.includes(jw),D=_&&_.includes(V0);if(I&&T.push(function(){if(!Cs)return z0||(z0=function(R){let O,F=null;function z(){O=new Uint8Array(F.buffer)}function j(){throw new Error("Unexpected Draco error.")}let X={a:{a:j,d:function(Y,K,le){return O.copyWithin(Y,K,K+le)},c:function(Y){let K=O.length,le=Math.max(Y>>>0,Math.ceil(1.2*K)),se=Math.ceil((le-K)/65536);try{return F.grow(se),z(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,X):R.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,X))).then(Y=>{let{Rb:K,Qb:le,P:se,T:pe,X:_e,Ja:Ee,La:Oe,Qa:De,Va:Ne,Wa:Xe,eb:Le,jb:qe,f:ke,e:We,yb:Je,zb:Ze,Ab:ht,Bb:Ye,Db:tt,Gb:Tt}=Y.instance.exports;F=We;let yt=(()=>{let gt=0,et=0,St=0,qt=0;return At=>{St&&(K(qt),K(gt),et+=St,St=gt=0),gt||(et+=128,gt=le(et));let Xt=At.length+7&-8,Wt=gt;Xt>=et&&(St=Xt,Wt=qt=le(Xt));for(let nn=0;nn<At.length;nn++)O[Wt+nn]=At[nn];return Wt}})();return z(),ke(),{memory:We,_free:K,_malloc:le,Mesh:class{constructor(){this.ptr=se()}destroy(){pe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ee()}destroy(){qe(this.ptr)}DecodeArrayToMesh(gt,et,St){let qt=yt(gt),At=Oe(this.ptr,qt,et,St.ptr);return!!_e(At)}GetAttributeByUniqueId(gt,et){return{ptr:De(this.ptr,gt.ptr,et)}}GetTrianglesUInt16Array(gt,et,St){Ne(this.ptr,gt.ptr,et,St)}GetTrianglesUInt32Array(gt,et,St){Xe(this.ptr,gt.ptr,et,St)}GetAttributeDataArrayForAllPoints(gt,et,St,qt,At){Le(this.ptr,gt.ptr,et.ptr,St,qt,At)}},DT_INT8:Je(),DT_UINT8:Ze(),DT_INT16:ht(),DT_UINT16:Ye(),DT_UINT32:tt(),DT_FLOAT32:Tt()}})}(fetch(jA())),z0.then(R=>{Cs=R,z0=void 0}))}()),D&&T.push(function(){if(Vw)return;let R=function(O){let F,z=WebAssembly.instantiateStreaming(O,{}).then(Y=>{F=Y.instance,F.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},X={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(Y,K,le,se,pe,_e){(function(Ee,Oe,De,Ne,Xe,Le,qe){let ke=Ee.exports.sbrk,We=Ne+3&-4,Je=ke(We*Xe),Ze=ke(Le.length),ht=new Uint8Array(Ee.exports.memory.buffer);ht.set(Le,Ze);let Ye=Oe(Je,Ne,Xe,Ze,Le.length);if(Ye===0&&qe&&qe(Je,We,Xe),De.set(ht.subarray(Je,Je+Ne*Xe)),ke(Je-ke(0)),Ye!==0)throw new Error(`Malformed buffer data: ${Ye}`)})(F,F.exports[X[pe]],Y,K,le,se,F.exports[j[_e]])}}}(fetch(UA()));return R.ready.then(()=>{Vw=R})}()),d)for(let R=0;R<d.length;R++)T.push(b4(d[R],a,R,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&p)for(let{primitives:R}of p)for(let O of R)y4(O,a);if(D&&p&&y)for(let R of y)v4(R,a);return a})})}function uh(t,e){let n=t.json.bufferViews[e.bufferView],a=B0[e.componentType];return new a(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==lg[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:lg[e.type]))}function Uw(t,e,n,a){let u=B0[e.componentType],d=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),p=t.json.bufferViews[e.bufferView],_=p.byteStride?p.byteStride/u.BYTES_PER_ELEMENT:lg[e.type],y=n.float32,b=y.length/n.capacity;for(let T=0,I=0;T<e.count*_;T+=_,I+=b)for(let D=0;D<b;D++)y[I+D]=a[T+D]*d;n._trim()}function w4(t,e,n){let a=t.indices,u=t.attributes,d={};d.indexArray=new Zr;let p=e.json.accessors[a],_=p.count/3;d.indexArray.reserve(_);let y=uh(e,p);for(let D=0;D<_;D++)d.indexArray.emplaceBack(y[3*D],y[3*D+1],y[3*D+2]);d.indexArray._trim(),d.vertexArray=new lc;let b=e.json.accessors[u.POSITION];d.vertexArray.reserve(b.count);let T=uh(e,b);for(let D=0;D<b.count;D++)d.vertexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);if(d.vertexArray._trim(),d.aabb=new pr(b.min,b.max),d.centroid=function(D,R){let O=[0,0,0],F=D.length;if(F>0){for(let z=0;z<F;z++){let j=3*D[z];O[0]+=R[j],O[1]+=R[j+1],O[2]+=R[j+2]}O[0]/=F,O[1]/=F,O[2]/=F}return O}(y,T),u.COLOR_0!==void 0){let D=e.json.accessors[u.COLOR_0],R=lg[D.type],O=uh(e,D);d.colorArray=R===3?new lc:new ac,d.colorArray.resize(D.count),Uw(e,D,d.colorArray,O)}if(u.NORMAL!==void 0){d.normalArray=new lc;let D=e.json.accessors[u.NORMAL];d.normalArray.resize(D.count);let R=uh(e,D);Uw(e,D,d.normalArray,R)}if(u.TEXCOORD_0!==void 0&&n.length>0){d.texcoordArray=new Ud;let D=e.json.accessors[u.TEXCOORD_0];d.texcoordArray.resize(D.count);let R=uh(e,D);Uw(e,D,d.texcoordArray,R)}if(u._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=uh(e,D))}u._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(uh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));let I=t.material;return d.material=function(D,R){let{emissiveFactor:O=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:z=.5,normalTexture:j,occlusionTexture:X,emissiveTexture:Y,doubleSided:K}=D,{baseColorFactor:le=[1,1,1,1],metallicFactor:se=1,roughnessFactor:pe=1,baseColorTexture:_e,metallicRoughnessTexture:Ee}=D.pbrMetallicRoughness||{},Oe=X?R[X.index]:void 0;if(X&&X.extensions&&X.extensions.KHR_texture_transform&&Oe){let De=X.extensions.KHR_texture_transform;Oe.offsetScale=[De.offset[0],De.offset[1],De.scale[0],De.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new bn(...le),metallicFactor:se,roughnessFactor:pe,baseColorTexture:_e?R[_e.index]:void 0,metallicRoughnessTexture:Ee?R[Ee.index]:void 0},doubleSided:K,emissiveFactor:O,alphaMode:F,alphaCutoff:z,normalTexture:j?R[j.index]:void 0,occlusionTexture:Oe,emissionTexture:Y?R[Y.index]:void 0,defined:D.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),d}function XA(t,e,n){let{matrix:a,rotation:u,translation:d,scale:p,mesh:_,extras:y,children:b}=t,T={};if(T.matrix=a||r.ad.fromRotationTranslationScale([],u||[0,0,0,1],d||[0,0,0],p||[1,1,1]),_!==void 0){T.meshes=n[_];let I=T.anchor=[0,0];for(let D of T.meshes){let{min:R,max:O}=D.aabb;I[0]+=R[0]+O[0],I[1]+=R[1]+O[1]}I[0]=Math.floor(I[0]/T.meshes.length/2),I[1]=Math.floor(I[1]/T.meshes.length/2)}if(y&&(y.id&&(T.id=y.id),y.lights&&(T.lights=function(I){if(!I.length)return[];let D=function(j){let X=atob(j),Y=new Uint8Array(X.length);for(let K=0;K<X.length;K++)Y[K]=X.codePointAt(K);return Y}(I),R=[],O=D.length/24,F=new Uint16Array(D.buffer),z=new Float32Array(D.buffer);for(let j=0;j<O;j++){let X=F[2*j*6]/30,Y=F[2*j*6+1]/30,K=F[2*j*6+10]/100,le=z[6*j+1],se=z[6*j+2],pe=z[6*j+3],_e=z[6*j+4],Ee=pe-le,Oe=_e-se,De=Math.hypot(Ee,Oe);R.push({pos:[le+.5*Ee,se+.5*Oe,Y],normal:[Oe/De,-Ee/De,0],width:De,height:X,depth:K,points:[le,se,pe,_e]})}return R}(y.lights))),b){let I=[];for(let D of b)I.push(XA(e.json.nodes[D],e,n));T.children=I}return T}function E4(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new iw(t.vertices,t.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:a}}function T4(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let a=[];for(let p of n){if(!Array.isArray(p)||p.length!==2)continue;let _=p[0],y=p[1];typeof _=="number"&&typeof y=="number"&&a.push(new lt(_,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let p=0;p<a.length;p++){let _=a[p],y=a[(p+1)%a.length],b=a[(p+2)%a.length];u+=(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)}u>0&&a.reverse();let d=Bm(a.flatMap(p=>[p.x,p.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function S4(t,e){let n=[],a=[],u=0,d=[];for(let p of t){u=n.length;let _=p.vertexArray.float32,y=p.indexArray.uint16;for(let b=0;b<p.vertexArray.length;b++)d[0]=_[3*b+0],d[1]=_[3*b+1],d[2]=_[3*b+2],r._.transformMat4(d,d,e),n.push(new lt(d[0],d[1]));for(let b=0;b<3*p.indexArray.length;b++)a.push(y[b]+u)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){let _=n[a[p+0]],y=n[a[p+1]],b=n[a[p+2]];(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:n,indices:a}}function YA(t){let e=function(y,b){let T=[],I=WebGL2RenderingContext;if(y.json.textures)for(let D of y.json.textures){let R={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};D.sampler!==void 0&&Object.assign(R,y.json.samplers[D.sampler]),T.push({image:b[D.source],sampler:R,uploaded:!1})}return T}(t,t.images),n=function(y,b){let T=[];for(let I of y.json.meshes){let D=[];for(let R of I.primitives)D.push(w4(R,y,b));T.push(D)}return T}(t,e),{scenes:a,scene:u,nodes:d}=t.json,p=a?a[u||0].nodes:d,_=[];for(let y of p)_.push(XA(d[y],t,n));return function(y,b,T){let I={},D=new Set;for(let R=0;R<y.length;R++){let O=T[b[R]];if(!O.extras)continue;let F=O.extras["mapbox:footprint:version"],z=O.extras["mapbox:footprint:id"];(F||z)&&D.add(R),F==="1.0.0"&&z&&(I[z]=R)}for(let R=0;R<y.length;R++){if(D.has(R))continue;let O=y[R],F=T[b[R]];if(!F.extras)continue;let z=null;O.id in I&&(z=S4(y[I[O.id]].meshes,O.matrix)),z||(z=T4(F)),z&&(O.footprint=E4(z))}if(D.size>0){let R=Array.from(D.values()).sort((O,F)=>O-F);for(let O=R.length-1;O>=0;O--)y.splice(R[O],1)}}(_,p,t.json.nodes),_}function C4(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,u=ch/(t.aabb.max[0]-n+2),d=ch/(t.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){let _=e[p+2],y=(e[p+0]-n)*u|0,b=(e[p+1]-a)*d|0;_>t.heightmap[b*ch+y]&&(t.heightmap[b*ch+y]=_)}}function I4(t,e){let n={};n.indexArray=new Zr,n.indexArray.reserve(4*t.length),n.vertexArray=new lc,n.vertexArray.reserve(10*t.length),n.colorArray=new ac,n.vertexArray.reserve(10*t.length);let a=0;for(let p of t){let _=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],b=Math.min(.29,.1*p.width/p.depth),T=p.width-2*p.depth*e*(b+.01),I=r._.scaleAndAdd([],p.pos,y,T/2),D=r._.scaleAndAdd([],p.pos,y,-T/2),R=[I[0],I[1],I[2]+p.height],O=[D[0],D[1],D[2]+p.height],F=r._.scaleAndAdd([],p.normal,y,b);r._.scale(F,F,_);let z=r._.scaleAndAdd([],p.normal,y,-b);r._.scale(z,z,_),r._.add(F,I,F),r._.add(z,D,z),I[2]+=.1,D[2]+=.1,n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]);let j=T/_/2;n.colorArray.emplaceBack(-j-b,-1,j,.8),n.colorArray.emplaceBack(j+b,-1,j,.8),n.colorArray.emplaceBack(-j,0,j,1.3),n.colorArray.emplaceBack(j,0,j,1.3),n.colorArray.emplaceBack(j+b,-.8,j,.7),n.colorArray.emplaceBack(j+b,-.8,j,.7),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(j+b,-1.2,j,.8),n.colorArray.emplaceBack(j+b,-1.2,j,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let u={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=bn.white,u.pbrMetallicRoughness=d,n.material=u,n.aabb=new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let $w=new Float32Array(262144),hh=new Uint8Array(262144);function KA(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,KA(n));return e}function QA(t,e,n){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&n.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)QA(a,e,n)}let JA=["","wall","door","roof","window","lamp","logo"];class e2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:KA(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=pr.applyTransform(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class j0{constructor(e,n,a,u,d,p){this.id=n,this.modelTraits|=hf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=hf.HasMapboxMeshFeatures),u&&(this.modelTraits|=hf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new e2(_)),QA(_,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let a of this.getNodesInfo()){let u=a.node;u.footprint&&n.push({footprint:u.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let a of n){let u=a.node;this.uploaded?this.updatePbrBuffer(u):Lw(u,e,!0)}for(let a of n)F0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){let u=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||cg(a.paint.get("model-color").value,p)||cg(a.paint.get("model-color-mix-intensity").value,p)||cg(a.paint.get("model-roughness").value,p)||cg(a.paint.get("model-emissive-strength").value,p)||cg(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=u,this.brightness=d,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),u=this.id.canonical;for(let d of a){let p=d.feature;d.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e){let n=this.getNodesInfo();for(let a of n){if(!a.node.meshes)continue;let u=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],_=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let b=0;b<JA.length;b++){let T=JA[b];T.length&&(u.properties.part=T);let I=e.paint.get("model-color").evaluate(u,{},y).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(u,{},y);a.evaluatedColor[b]=[I.r,I.g,I.b,D],a.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(u,{},y),a.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(u,{},y),a.evaluatedRMEA[b][3]=I.a,a.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},y),!a.hasTranslucentParts&&I.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,M4(a,p!==a.evaluatedColor[2]||_!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,u){let d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;let p=Kd.create(e,a,d);if(!p)return;this.modelTraits&hf.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,u);for(let _ of this.getNodesInfo()){let y=_.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let b=y.footprint.vertices,T=p.getElevationAt(b[0].x,b[0].y,!0,!0);for(let I=1;I<b.length;I++)T=Math.min(T,p.getElevationAt(b[I].x,b[I].y,!0,!0));y.elevation=T}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,u){let d=n._dem._modifiedForSources[u];if(d===void 0&&(n._dem._modifiedForSources[u]=[],d=n._dem._modifiedForSources[u]),d.includes(a.canonical))return;let p=n._dem.dim;d.push(a.canonical);let _=!1;for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.grid)continue;let T=b.footprint.grid,I=n.tileCoordToPixel(T.min.x,T.min.y),D=n.tileCoordToPixel(T.max.x,T.max.y),R=Math.min(Math.min(p-D.y,I.x),Math.min(I.y,p-D.x));if(R<0)continue;let O=Qt(R,2,5),F=Math.max(0,I.x-O),z=Math.max(0,I.y-O),j=Math.min(D.x+O,p-1),X=Math.min(D.y+O,p-1);for(let se=z;se<=X;++se)for(let pe=F;pe<=j;++pe)hh[se*p+pe]=255;let Y=0,K=0;for(let se=0;se<T.cellsY;++se)for(let pe=0;pe<T.cellsX;++pe){if(!T.cells[se*T.cellsX+pe])continue;let _e=n.tileCoordToPixel(T.min.x+pe/T.xScale,T.min.y+se/T.yScale),Ee=n.tileCoordToPixel(T.min.x+(pe+1)/T.xScale,T.min.y+(se+1)/T.yScale);for(let Oe=_e.y;Oe<=Math.min(Ee.y+1,p-1);++Oe)for(let De=_e.x;De<=Math.min(Ee.x+1,p-1);++De)hh[Oe*p+De]===255&&(hh[Oe*p+De]=0,Y+=n.getElevationAtPixel(De,Oe),K++)}let le=Y/K;F=Math.max(1,I.x-O),z=Math.max(1,I.y-O),j=Math.min(D.x+O,p-2),X=Math.min(D.y+O,p-2),_=!0;for(let se=z;se<=X;++se)for(let pe=F;pe<=j;++pe)hh[se*p+pe]===0&&($w[se*p+pe]=n._dem.set(pe,se,le));for(let se=1;se<O;++se){F=Math.max(1,I.x-se),z=Math.max(1,I.y-se),j=Math.min(D.x+se,p-2),X=Math.min(D.y+se,p-2);for(let pe=z;pe<=X;++pe)for(let _e=F;_e<=j;++_e){let Ee=pe*p+_e;if(hh[Ee]===255){let Oe=0,De=0,Ne=-1,Xe=-1;for(let Le=-1;Le<=1;++Le)for(let qe=-1;qe<=1;++qe){let ke=(pe+Le)*p+_e+qe;if(hh[ke]>=se)continue;let We=$w[ke],Je=Math.abs(We);Je>De&&(Oe=We,De=Je,Ne=qe,Xe=Le)}if(De>.1){let Le=1-(se+.5*Math.abs(Ne*Xe))/O,qe=n._dem.get(_e,pe)+Oe*Le,ke=n._dem.get(_e+Ne,pe+Xe),We=n._dem.get(_e-Ne,pe-Xe,!0);(qe-ke)*(qe-We)>0&&(qe=(ke+We)/2),$w[Ee]=n._dem.set(_e,pe,qe),hh[Ee]=se}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=ti.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)F0(n.node),Fw(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){let p=u[d].node;u[d].hiddenByReplacement=!!p.footprint&&!a.find(_=>_.footprint===p.footprint)}}getHeightAtTileCoord(e,n){let a=this.getNodesInfo(),u=[],d=[0,0,0],p=r.ad.identity([]);for(let _=0;_<this.nodesInfo.length;_++){let y=a[_],b=y.node.meshes[0],T=b.transformedAabb;if(e<T.min[0]||n<T.min[1]||e>T.max[0]||n>T.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};r.ad.invert(p,y.node.matrix),d[0]=e,d[1]=n,r._.transformMat4(d,d,p);let I=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*ch|0,D=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*ch|0)*ch+Math.min(63,I),R=b.heightmap[D];if(!(R<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:R,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new lt(e,n),new lt(e,n),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function cg(t,e){return!t.isLightConstant&&e}function D4(t,e,n,a,u,d,p,_){let y=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;n[3]>0&&(y=It(y,255*n[0],n[3]),b=It(b,255*n[1],n[3]),T=It(T,255*n[2],n[3]));let I=y<<8|b,D=T<<8|Math.floor(255*a[3]),R=function(se){let pe=Qt(se,0,2);return Math.min(Math.round(.5*pe*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],O=Qt(u[0],0,1),F=Qt(u[1],0,1),z=Qt(u[2],0,1),j=Qt(u[3],0,1),X,Y,K,le;if(O!==F&&p!==d&&F!==O){let se=p-d;Y=1/(se*(F-O)),K=-(d+se*O)/(se*(F-O));let pe=Qt(u[4],-1,1);le=Math.pow(10,pe),X=255*z<<8|255*j}else X=65535,Y=0,K=1,le=1;if(t.emplaceBack(I,D,R,X,Y,K,le),_){let se=_.length;_.clear();for(let pe=0;pe<se;pe++)_.emplaceBack(I,D,R,X,Y,K,le)}}function M4(t,e,n){let a=t.node,u=0,d=n&hf.HasMeshoptCompression;for(let p of a.meshes){if(a.lights&&a.lightMeshIndex===u||!p.featureData)continue;p.featureArray=new jy,p.featureArray.reserve(p.featureData.length);let _=e;for(let y of p.featureData){let b=d?65535&y:y>>16&65535,T=d?y>>16&65535:65535&y,I=(15&T)<8?15&T:0,D=t.evaluatedRMEA[I],R=t.evaluatedColor[I],O=t.emissionHeightBasedParams[I],F;if(_&&I===2&&a.lights&&(F=new jy,F.resize(10*a.lights.length)),D4(p.featureArray,b,R,D,O,p.aabb.min[2],p.aabb.max[2],F),F&&_){_=!1;let z=a.meshes[a.lightMeshIndex];z.featureArray=F,z.featureArray._trim()}}p.featureArray._trim(),u++}}function t2(t,e,n,a){let u=1<<t.z;e.lat=ri((a/it+t.y)/u),e.lng=Ki((n/it+t.x)/u)}J(j0,"Tiled3dModelBucket",{omit:["layers"]}),J(e2,"Tiled3dModelFeature");let A4={circle:class extends gi{constructor(t,e,n,a){super(t,gz,e,n,a)}createBucket(t){return new Vb(t)}queryRadius(t){let e=t;return Zd("circle-radius",this,e)+Zd("circle-stroke-width",this,e)+Wy(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,u,d,p,_){let y=dD(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return ID(t,a,d,p,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let a=CD(this);return{config:new th(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends gi{createBucket(t){return new MD(t)}constructor(t,e,n,a){super(t,Iz,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=zm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Zd("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,u,d,p,_){let y=this.paint.get("heatmap-radius").evaluate(e,n);return ID(t,a,d,p,_,!0,!0,new lt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new th(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends gi{constructor(t,e,n,a){super(t,Mz,e,n,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends gi{constructor(t,e,n,a){super(t,$z,e,n,a)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new th(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new n0(t)}queryRadius(){return Wy(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,u,d){return!t.queryGeometry.isAboveHorizon&&aD(hD(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends gi{constructor(t,e,n,a){super(t,vB,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new c0(t)}queryRadius(){return Wy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,u,d,p,_,y){let b=dD(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),D=[0,0],R=_&&d.elevation,O=d.elevation?d.elevation.exaggeration():1,F=t.tile.getBucket(this);if(R&&F instanceof c0){let K=F.centroidVertexArray,le=y+1;le<K.length&&(D[0]=K.geta_centroid_pos0(le),D[1]=K.geta_centroid_pos1(le))}if(D[0]===0&&D[1]===1)return!1;d.projection.name==="globe"&&(a=gM([a],[new lt(0,0),new lt(it,it)],t.tileID.canonical).map(K=>K.polygon).flat());let z=R?_:null,[j,X]=function(K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le){return K.projection.name==="globe"?function(qe,ke,We,Je,Ze,ht,Ye,tt,Tt,yt,gt){let et=[],St=[],qt=qe.projection.upVectorScale(gt,qe.center.lat,qe.worldSize).metersToTile,At=[0,0,0,1],Xt=[0,0,0,1],Wt=(Dt,jn,Bn,Tn)=>{Dt[0]=jn,Dt[1]=Bn,Dt[2]=Tn,Dt[3]=1},nn=mM();We>0&&(We+=nn),Je+=nn;for(let Dt of ke){let jn=[],Bn=[];for(let Tn of Dt){let hn=Tn.x+Ze.x,Sn=Tn.y+Ze.y,Yn=qe.projection.projectTilePoint(hn,Sn,gt),Hn=qe.projection.upVector(gt,Tn.x,Tn.y),yr=We,mr=Je;if(Ye){let Di=yM(hn,Sn,We,Je,Ye,tt,Tt,yt);yr+=Di.base,mr+=Di.top}We!==0?Wt(At,Yn.x+Hn[0]*qt*yr,Yn.y+Hn[1]*qt*yr,Yn.z+Hn[2]*qt*yr):Wt(At,Yn.x,Yn.y,Yn.z),Wt(Xt,Yn.x+Hn[0]*qt*mr,Yn.y+Hn[1]*qt*mr,Yn.z+Hn[2]*qt*mr),r._.transformMat4(At,At,ht),r._.transformMat4(Xt,Xt,ht),jn.push(new sh(At[0],At[1],At[2])),Bn.push(new sh(Xt[0],Xt[1],Xt[2]))}et.push(jn),St.push(Bn)}return[et,St]}(K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le):Oe?function(qe,ke,We,Je,Ze,ht,Ye,tt,Tt){let yt=[],gt=[],et=[0,0,0,1];for(let St of qe){let qt=[],At=[];for(let Xt of St){let Wt=Xt.x+Je.x,nn=Xt.y+Je.y,Dt=yM(Wt,nn,ke,We,ht,Ye,tt,Tt);et[0]=Wt,et[1]=nn,et[2]=Dt.base,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let jn=new sh(et[0]/et[3],et[1]/et[3],et[2]/et[3]);et[0]=Wt,et[1]=nn,et[2]=Dt.top,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Bn=new sh(et[0]/et[3],et[1]/et[3],et[2]/et[3]);qt.push(jn),At.push(Bn)}yt.push(qt),gt.push(At)}return[yt,gt]}(le,se,pe,_e,Ee,Oe,De,Ne,Xe):function(qe,ke,We,Je,Ze){let ht=[],Ye=[],tt=Ze[8]*ke,Tt=Ze[9]*ke,yt=Ze[10]*ke,gt=Ze[11]*ke,et=Ze[8]*We,St=Ze[9]*We,qt=Ze[10]*We,At=Ze[11]*We;for(let Xt of qe){let Wt=[],nn=[];for(let Dt of Xt){let jn=Dt.x+Je.x,Bn=Dt.y+Je.y,Tn=Ze[0]*jn+Ze[4]*Bn+Ze[12],hn=Ze[1]*jn+Ze[5]*Bn+Ze[13],Sn=Ze[2]*jn+Ze[6]*Bn+Ze[14],Yn=Ze[3]*jn+Ze[7]*Bn+Ze[15],Hn=Tn+tt,yr=hn+Tt,mr=Sn+yt,Di=Math.max(Yn+gt,1e-5),wr=Tn+et,ar=hn+St,kr=Sn+qt,ii=Math.max(Yn+At,1e-5);Wt.push(new sh(Hn/Di,yr/Di,mr/Di)),nn.push(new sh(wr/ii,ar/ii,kr/ii))}ht.push(Wt),Ye.push(nn)}return[ht,Ye]}(le,se,pe,_e,Ee)}(d,a,I,T,b,p,z,D,O,d.center.lat,t.tileID.canonical),Y=t.queryGeometry;return function(K,le,se){let pe=1/0;aD(se,le)&&(pe=_M(se,le[0]));for(let _e=0;_e<le.length;_e++){let Ee=le[_e],Oe=K[_e];for(let De=0;De<Ee.length-1;De++){let Ne=Ee[De],Xe=[Ne,Ee[De+1],Oe[De+1],Oe[De],Ne];jb(se,Xe)&&(pe=Math.min(pe,_M(se,Xe)))}}return pe!==1/0&&pe}(j,X,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends gi{constructor(t,e,n,a){super(t,h0,e,n,a),h0.layout&&(this.layout=new un(h0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Wu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=EA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new u0(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let a=CM(this);return{config:new th(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(t){let e=t,n=TA(Zd("line-width",this,e),Zd("line-gap-width",this,e)),a=Zd("line-offset",this,e);return n/2+Math.abs(a)+Wy(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,u,d){if(t.queryGeometry.isAboveHorizon)return!1;let p=hD(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*TA(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(a=function(b,T){let I=[],D=new lt(0,0);for(let R=0;R<b.length;R++){let O=b[R],F=[];for(let z=0;z<O.length;z++){let j=O[z],X=O[z+1],Y=z===0?D:j.sub(O[z-1])._unit()._perp(),K=z===O.length-1?D:X.sub(j)._unit()._perp(),le=Y._add(K)._unit();le._mult(1/(le.x*K.x+le.y*K.y)),F.push(le._mult(T)._add(j))}I.push(F)}return I}(a,y*t.pixelToTileUnitsFactor)),function(b,T,I){for(let D=0;D<T.length;D++){let R=T[D];if(b.length>=3){for(let O=0;O<R.length;O++)if(pc(b,R[O]))return!0}if(dz(b,R,I))return!0}return!1}(p,a,_)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:A0,background:class extends gi{constructor(t,e,n,a){super(t,Z5,e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:DA,"raster-particle":MA,sky:class extends gi{constructor(t,e,n,a){super(t,n4,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=zm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),u=!a,d=t.style.light,p=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&Sr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Rw(p.azimuthal,90-p.polar,e):Rw(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return Rw(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends gi{constructor(t,e,n,a){super(t,r4,e,null)}},model:class extends gi{constructor(t,e,n,a){super(t,d4,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new kw(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof j0?it-1:0}queryIntersectsFeature(t,e,n,a,u,d){if(!this.modelManager)return!1;let p=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof kw))return!1;let y=_;for(let b in y.instancesPerModel){let T=y.instancesPerModel[b],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){let D=T.features[T.idToFeaturesIndex[I]],R=p.getModel(b,this.scope);if(!R)return!1;let O=r.ad.create(),F=new vn(0,0),z=y.canonical,j=Number.MAX_VALUE;for(let X=0;X<D.instancedDataCount;++X){let Y=16*(D.instancedDataOffset+X),K=T.instancedDataArray.float32,le=[K[Y+4],K[Y+5],K[Y+6]];t2(z,F,K[Y],0|K[Y+1]),BA(O,R,d,F,D.rotation,D.scale,le,!1,!1,!1),d.projection.name==="globe"&&(O=Ow(O,d));let se=r.ad.multiply([],d.projMatrix,O),pe=t.queryGeometry,_e=LA(pe.isPointQuery()?pe.screenBounds:pe.screenGeometry,d,se,R.aabb);_e!=null&&(j=Math.min(_e,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof G}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,a){let u=t.tile,d=u.getBucket(this),p=null,_=Number.MAX_VALUE;if(!(d&&d instanceof j0))return{queryFeature:p,intersectionZ:_};let y=d.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Bt(u.tileID.overscaledZ),y.feature,u.tileID.canonical))return{queryFeature:p,intersectionZ:_};let b=y.node,T=a.calculatePosMatrix(u.tileID.toUnwrapped(),a.worldSize),I=y.evaluatedScale,D=0;a.elevation&&b.elevation&&(D=b.elevation*a.elevation.exaggeration()),r.ad.translate(T,T,[(b.anchor?b.anchor[0]:0)*(I[0]-1),(b.anchor?b.anchor[1]:0)*(I[1]-1),D]),r.ad.scale(T,T,I),r.ad.multiply(T,T,b.matrix);let R=t.queryGeometry,O=R.isPointQuery()?R.screenBounds:R.screenGeometry,F=function(j){let X=r.ad.multiply([],T,j.matrix),Y=r.ad.multiply(X,a.expandedFarZProjMatrix,X);for(let K=0;K<j.meshes.length;++K){let le=j.meshes[K];if(K===j.lightMeshIndex)continue;let se=LA(O,a,Y,le.aabb);se!=null&&(_=Math.min(se,_))}if(j.children)for(let K of j.children)F(K)};if(F(b),_===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:_};let z=new vn(0,0);return t2(u.tileID.canonical,z,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[z.lng,z.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:_}}},clip:class extends gi{constructor(t,e,n,a){super(t,Hz,e,n,a)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new ND(t)}isTileClipped(){return!0}is3D(){return!0}}};J(xA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let n2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);let d=n2[15&a];if(!d)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Gw(_,p,d,e)}constructor(e,n=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let d=n2.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Hw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:p,nodeSize:_}=this,y=[0,d.length-1,0],b=[];for(;y.length;){let T=y.pop()||0,I=y.pop()||0,D=y.pop()||0;if(I-D<=_){for(let z=D;z<=I;z++){let j=p[2*z],X=p[2*z+1];j>=e&&j<=a&&X>=n&&X<=u&&b.push(d[z])}continue}let R=D+I>>1,O=p[2*R],F=p[2*R+1];O>=e&&O<=a&&F>=n&&F<=u&&b.push(d[R]),(T===0?e<=O:n<=F)&&(y.push(D),y.push(R-1),y.push(1-T)),(T===0?a>=O:u>=F)&&(y.push(R+1),y.push(I),y.push(1-T))}return b}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:d,nodeSize:p}=this,_=[0,u.length-1,0],y=[],b=a*a;for(;_.length;){let T=_.pop()||0,I=_.pop()||0,D=_.pop()||0;if(I-D<=p){for(let z=D;z<=I;z++)i2(d[2*z],d[2*z+1],e,n)<=b&&y.push(u[z]);continue}let R=D+I>>1,O=d[2*R],F=d[2*R+1];i2(O,F,e,n)<=b&&y.push(u[R]),(T===0?e-a<=O:n-a<=F)&&(_.push(D),_.push(R-1),_.push(1-T)),(T===0?e+a>=O:n+a>=F)&&(_.push(R+1),_.push(I),_.push(1-T))}return y}}function Hw(t,e,n,a,u,d){if(u-a<=n)return;let p=a+u>>1;r2(t,e,p,a,u,d),Hw(t,e,n,a,p-1,1-d),Hw(t,e,n,p+1,u,1-d)}function r2(t,e,n,a,u,d){for(;u>a;){if(u-a>600){let b=u-a+1,T=n-a+1,I=Math.log(b),D=.5*Math.exp(2*I/3),R=.5*Math.sqrt(I*D*(b-D)/b)*(T-b/2<0?-1:1);r2(t,e,n,Math.max(a,Math.floor(n-T*D/b+R)),Math.min(u,Math.floor(n+(b-T)*D/b+R)),d)}let p=e[2*n+d],_=a,y=u;for(ug(t,e,a,n),e[2*u+d]>p&&ug(t,e,a,u);_<y;){for(ug(t,e,_,y),_++,y--;e[2*_+d]<p;)_++;for(;e[2*y+d]>p;)y--}e[2*a+d]===p?ug(t,e,a,y):(y++,ug(t,e,y,u)),y<=n&&(a=y+1),n<=y&&(u=y-1)}}function ug(t,e,n,a){qw(t,n,a),qw(e,2*n,2*a),qw(e,2*n+1,2*a+1)}function qw(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}function i2(t,e,n,a){let u=t-n,d=e-a;return u*u+d*d}r.$=Ra,r.A=Gu,r.B=Js,r.C=bn,r.D=Si,r.E=za,r.G=$r,r.H=h,r.I=w5,r.J=hb,r.K=function(t){let e=t.value,n=[];if(!e)return n;let a=Va(e);return a!=="string"?(n=n.concat([new L0(t.key,e,`string expected, "${a}" found`)]),n):(FA(e,!0)||(n=n.concat([new L0(t.key,e,`invalid url "${e}"`)])),n)},r.L=Te,r.M=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new vn(e[0],e[1]):new vn(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let a=pr.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,a,u,d,p=!1){BA(this.matrix,this,t.transform,this.position,e,n,a,u,d,p)}upload(t){if(!this.uploaded){for(let e of this.nodes)Lw(e,t);for(let e of this.nodes)F0(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)Fw(t)}},r.N=On,r.O=Be,r.P=lt,r.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return us(t.expression.evaluate(e))}interpolate(t,e,n){return{x:It(t.x,e.x,n),y:It(t.y,e.y,n),z:It(t.z,e.z,n),azimuthal:It(t.azimuthal,e.azimuthal,n),polar:It(t.polar,e.polar,n)}}},r.R=md,r.S=Sb,r.T=Jo,r.U=kn,r.V=L0,r.W=fi,r.X=Bt,r.Y=Ii,r.Z=G,r.a=po,r.a$=function(t){let{x:e,y:n}=t.point,{lng:a,lat:u}=t._center;return ED(e,n,t.worldSize,a,u)},r.a0=un,r.a1=el,r.a2=It,r.a3=it,r.a4=iy,r.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){let u=us([1,n,a]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:It(t.x,e.x,n),y:It(t.y,e.y,n),z:It(t.z,e.z,n)}}},r.a6=Pm,r.a7=$y,r.a8=Ya,r.a9=KI,r.aB=function(t,e){let{x:n,y:a}=t.point,u=ED(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.ad.multiply(u,u,Yb(ia(e)))},r.aD=tf,r.aE=Po,r.aF=p0,r.aG=function(t,e,n,a,u){let d=5*e+2;t.float32[d+0]=n,t.float32[d+1]=a,t.float32[d+2]=u},r.aH=S0,r.aI=vn,r.aJ=hA,r.aK=tD,r.aL=Vr,r.aM=Wb,r.aN=PA,r.aO=rh,r.aP=xD,r.aQ=function(t,e,n,a,u,d,p,_,y){if(y.name==="globe")return xD(t,e,new rh(n,a,u),!1);let b=ah({z:n,x:a,y:u},y);return new pr([(d+b.x/b.scale)*e,e*(b.y/b.scale),p],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},r.aR=function(t,e,n){let a=0;for(let u=0;u<2;++u)t[u]>0&&(a+=(t[u]-0)*(t[u]-0)),e[u]<0&&(a+=(0-e[u])*(0-e[u]));return a},r.aS=Ir,r.aT=Hb,r.aU=JI,r.aV=function(t){let e=r.ad.identity(new Float64Array(16));r.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,Ko,0],a=[0,Qo,0];return r._.transformMat4(n,n,e),r._.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Qb(t,new vn(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!Qb(t,new vn(t.center.lat,-90))]},r.aW=function(t,e){let{scale:n}=t.tileTransform,a=n*it/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.aX=O0,r.aY=AA,r.aZ=function(t){let e=AA(t,!0);return r.aC.invert([],[e[0],e[1],e[4],e[5]])},r.a_=qb,r.aa=Ui,r.ab=ln,r.ac=function(t,e,n){let a=Math.sqrt(t*t+e*e+n*n),u=a>0?Math.acos(n/a)*_u:0,d=t!==0||e!==0?Math.atan2(-e,-t)*_u+90:0;return d<0&&(d+=360),[a,d,u]},r.ae=af,r.af=ws,r.ag=bw,r.ah=function(t,e){let n={};for(let a=0;a<e.length;a++){let u=e[a];u in t&&(n[u]=t[u])}return n},r.ai=fc,r.aj=na,r.ak=ra,r.al=Vd,r.am=function(t){fd++,fd>jp&&(t.getActor().send("enforceCacheSizeLimit",Vp),fd=0)},r.an=Xp,r.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,a){let u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){let[d,p]=u.result;return this.scheduler?this.scheduler.add(()=>{a(d,p)},e):a(d,p),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=n((d,p)=>{u.result=[d,p];for(let _ of u.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,p)},e):_(d,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(d=>d!==a),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}},r.ap=function(t,e,n){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{let d=Fa(t.request,(p,_,y,b)=>{p?u(p):_&&u(null,{vectorTile:n?void 0:new ow(new ef(_)),rawData:_,cacheControl:y,expires:b})});return()=>{d.cancel(),u()}},e)},r.aq=Mb,r.ar=class extends Xa{constructor(t){super(t),this.current=Q3}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.as=Ab,r.at=Qt,r.au=Oa,r.aw=wu,r.ax=Gi,r.ay=ri,r.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.b=fr,r.b$=_c,r.b0=di,r.b1=Ob,r.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return H_[e]},r.b3=45,r.b4=Fb,r.b5=Gy,r.b6=pr,r.b7=us,r.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.b9=Rp,r.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bB=EM,r.bD=wD,r.bE=ud,r.bF=cd,r.bG=256,r.bH=function(t,e){let n=[0,0,0],a=Nm(ia(e.canonical));return r._.transformMat4(n,n,a),r._.transformMat4(n,n,t),n},r.bI=t=>({u_camera_to_center_distance:new Ui(t),u_extrude_scale:new Pb(t),u_device_pixel_ratio:new Ui(t),u_matrix:new Pm(t),u_inv_rot_matrix:new Pm(t),u_merc_center:new Ya(t),u_tile_id:new Mb(t),u_zoom_transition:new Ui(t),u_up_dir:new Mb(t),u_emissive_strength:new Ui(t)}),r.bJ=t=>({u_matrix:new Pm(t),u_pixels_to_tile_units:new Pb(t),u_device_pixel_ratio:new Ui(t),u_units_to_pixels:new Ya(t),u_dash_image:new $y(t),u_gradient_image:new $y(t),u_image_height:new Ui(t),u_texsize:new Ya(t),u_tile_units_to_pixels:new Ui(t),u_alpha_discard_threshold:new Ui(t),u_trim_offset:new Ya(t),u_trim_fade_range:new Ya(t),u_trim_color:new Ab(t),u_emissive_strength:new Ui(t)}),r.bK=t=>({u_matrix:new Pm(t),u_texsize:new Ya(t),u_pixels_to_tile_units:new Pb(t),u_device_pixel_ratio:new Ui(t),u_image:new $y(t),u_units_to_pixels:new Ya(t),u_tile_units_to_pixels:new Ui(t),u_alpha_discard_threshold:new Ui(t),u_trim_offset:new Ya(t)}),r.bL=yb,r.bM=RB,r.bN=_i,r.bO=YB,r.bP=nA,r.bQ=pw,r.bR=CD,r.bS=(t,e,n,a,u,d)=>{let p=t.transform,_=p.projection.name==="globe",y;if(d.paint.get("circle-pitch-alignment")==="map")if(_){let T=wD(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=p.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ti.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:wz,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){b.u_inv_rot_matrix=a,b.u_merc_center=u,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=el(p.zoom);let T=u[0]*it,I=u[1]*it;b.u_up_dir=p.projection.upVector(new rh(0,0,0),T,I)}return b},r.bT=CM,r.bU=(t,e,n,a,u,d)=>{let p=t.transform;return{u_matrix:SM(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:TM(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},r.bV=(t,e,n,a,u,d,p)=>{let _=t.transform,y=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:SM(t,e,n,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:IM(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:TM(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},r.bW=Op,r.bX=zm,r.bY=mM,r.bZ=sz,r.b_=c0,r.ba=function(t,e,n){let a=el(n.zoom),u=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!u&&!d},r.bb=function(t){let e=t.pixelsPerMeter,n=e/Gi(1,t.center.lat),a=r.ad.identity(new Float64Array(16));return r.ad.translate(a,a,[t.point.x,t.point.y,0]),r.ad.scale(a,a,[n,n,e]),Float32Array.from(a)},r.bc=Yy,r.bd=function(t){let e=Ir-5;t=Qt(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(ln(t))),3);return Math.round(n*(kb.length-1))},r.be=function(t,e,n,a){let u=e.getNorth(),d=e.getSouth(),p=e.getWest(),_=e.getEast(),y=1<<t.z,b=_-p,T=u-d,I=b/Gd,D=-T/kb[n],R=[0,I,0,D,0,0,u,p,0];if(t.z>0){let O=180/a;r.bC.multiply(R,R,[O/b+1,0,0,0,O/T+1,0,-.5*O/I,.5*O/D,1])}return R[2]=y,R[5]=t.x,R[8]=t.y,R},r.bf=Nm,r.bg=ia,r.bh=function(t,e,n){let a=r.ad.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return r.ad.rotateY(a,n.globeMatrix,u),Float32Array.from(a)},r.bi=Vl,r.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.bk=DA,r.bl=MA,r.bm=IA,r.bn=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){let u=document.createElement("source");Y_(t[a])||(n.crossOrigin="Anonymous"),u.src=t[a],n.appendChild(u)}return{cancel:()=>{}}},r.bo=C0,r.bp=sd,r.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,u=Math.floor(t.x),d=Math.floor((t.x-u)*a),p=Math.floor(t.y*a),_=this.findDEMTileFor(new Vr(n,u,n,d,p));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let u=a.getSource().maxzoom,d=1<<u,p=Math.floor(t.x),_=t.x-p,y=new Vr(u,p,u,Math.floor(_*d),Math.floor(t.y*d)),b=this.findDEMTileFor(y);if(!b||!b.dem)return e;let T=b.dem,I=1<<b.tileID.canonical.z,D=(_*I-b.tileID.canonical.x)*T.dim,R=(t.y*I-b.tileID.canonical.y)*T.dim,O=Math.floor(D),F=Math.floor(R);return(n?this.exaggeration():1)*It(It(T.get(O,F),T.get(O,F+1),R-F),It(T.get(O+1,F),T.get(O+1,F+1),R-F),D-O)}getAtTileOffset(t,e,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new Ii(t.wrap+(t.canonical.x+e/it)/a,(t.canonical.y+n/it)/a))}getAtTileOffsetFunc(t,e,n,a){return u=>{let d=this.getAtTileOffset(t,u.x,u.y),p=a.upVector(t.canonical,u.x,u.y),_=a.upVectorScale(t.canonical,e,n).metersToTile;return r._.scale(p,p,d*_),p}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;let u=Kd.create(this,t,a);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,u=1<<t.canonical.z-a.canonical.z,d=t.canonical.x/u-a.canonical.x,p=t.canonical.y/u-a.canonical.y,_=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!n.leaves[_];y++){d*=2,p*=2;let b=2*Math.floor(p)+Math.floor(d);_=n.childOffsets[_]+b,d%=1,p%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let u of t){let d=this.getMinMaxForTile(u.tileID);d&&(n=Math.min(n,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:n,max:a}:null}},r.br=Lm,r.bs=Xy,r.bt=_s,r.bu=Zr,r.bv=lh,r.bw=Nw,r.bx=N0,r.by=M0,r.bz=RD,r.c=YA,r.c$=Tu,r.c0=450,r.c1=7,r.c2=K5,r.c3=bA,r.c4=256,r.c5=yD,r.c6=Yb,r.c7=Mn,r.c8=lc,r.c9=eh,r.cA=function(t){let e=1/0,n=1/0,a=-1/0,u=-1/0;for(let d of t)e=Math.min(e,d.x),n=Math.min(n,d.y),a=Math.max(a,d.x),u=Math.max(u,d.y);return{min:new lt(e,n),max:new lt(a,u)}},r.cB=pc,r.cC=oD,r.cD=$i,r.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.cF=XM,r.cG=jb,r.cH=ZD,r.cI=XD,r.cJ=yw,r.cK=Gw,r.cL=function(t){return t({pluginStatus:He,pluginURL:st}),Gt.on("pluginStateChange",t),t},r.cM=rf,r.cN=gw,r.cO=gd,r.cP=pt,r.cQ=U,r.cR=Bp,r.cS=Hl,r.cT=Ho,r.cU=function(t){let e=t.indexOf(oc);return e>=0?t.slice(0,e):t},r.cV=function(t){return t.indexOf(oc)>=0},r.cW=function(t){let e=t.indexOf(oc);return e>=0?t.slice(e+1):""},r.cX=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cY=function(t,e,n,a){return t.type==="custom"?new e4(t,e):new A4[t.type](t,e,n,a)},r.cZ=ka,r.c_=Gt,r.ca=1,r.cb=eg,r.cc=0,r.cd=wb,r.ce=function(t,e,n,a,u){return Qt((t-e)/(n-e)*(u-a)+a,a,u)},r.cf=Ay,r.cg=ih,r.ch=class{constructor(t,e,n,a){this.context=t,this.format=a,this.size=n,this.texture=t.gl.createTexture();let[u,d,p]=this.size,{gl:_}=t;_.bindTexture(_.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,b=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,b=_.UNSIGNED_SHORT),this.format===_.R8&&(a=_.RED),this.format===_.R32F&&(b=_.FLOAT,a=_.RED),_.texImage3D(_.TEXTURE_3D,0,y,u,d,p,0,a,b,e.data)}bind(t,e){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},r.ci=Ow,r.cj=[1,1,1],r.ck=Kd,r.cl=hf,r.cm=uc,r.cn=Ud,r.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new lt(1/0,1/0),max:new lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=HD(new lt(0,0),new lt(it,it),t),a=[];if(e&&!sw(n,this._globalClipBounds))return a;for(let u of this._activeRegions){if(u.hiddenByOverlap||!sw(n,u))continue;let d=oB(u.min,u.max,t);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask})}return a}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let a of e.cache.getVisibleCoordinates()){let u=e.cache.getTile(a).buckets[e.layer];u&&u.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),a=t.getClipMask();for(let u of e){if(!u.footprint)continue;let d=HD(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:n,clipMask:a})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||s0(e.min,n.min)||s0(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],a=this._prevRegions[e];t=n.priority!==a.priority||!GD(n,a)||n.order!==a.order||n.clipMask!==a.clipMask,++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let a=this._activeRegions;if(n>=a.length)return n;let u=a[n].priority;for(;n<a.length&&a[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let u=n,d=n;for(;u!==a;){let p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let _=0;_<d;_++){let y=this._activeRegions[_];if(!y.hiddenByOverlap&&p.order===1/0&&sw(p,y)&&(p.hiddenByOverlap=WD(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++u}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cp=sc,r.cq=D0,r.cr=Mm,r.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new _s,a=new Zr,u=[],d=t+1+2,p=e[0]+1,_=e[0]+1+(1+e.length),y=(b,T,I)=>{let D=b===d-1?b-2:b===0?b:b-1;return D+=I?24575:0,[D,T]};for(let b=0;b<d;++b)n.emplaceBack(...y(b,0,!0));for(let b=0;b<p;++b)for(let T=0;T<d;++T)n.emplaceBack(...y(T,b,(T===0||T===d-1)&&!0));for(let b=0;b<e.length;++b){let T=e[b];for(let I=0;I<d;++I)n.emplaceBack(...y(I,T,!0))}for(let b=0;b<e.length;++b){let T=a.length,I=e[b]+1+2,D=new Zr;for(let F=0;F<I-1;F++){let z=F===I-2,j=z?d*(_-e.length+b-F):d;for(let X=0;X<d-1;X++){let Y=F*d+X;F===0||z||X===0||X===d-2?(D.emplaceBack(Y+1,Y,Y+j),D.emplaceBack(Y+j,Y+j+1,Y+1)):(a.emplaceBack(Y+1,Y,Y+j),a.emplaceBack(Y+j,Y+j+1,Y+1))}}let R=fr.simpleSegment(0,T,n.length,a.length-T);for(let F=0;F<D.uint16.length;F+=3)a.emplaceBack(D.uint16[F],D.uint16[F+1],D.uint16[F+2]);let O=fr.simpleSegment(0,T,n.length,a.length-T);u.push({withoutSkirts:R,withSkirts:O})}return{vertices:n,indices:a,segments:u}}_createGrid(t){let e=this._fillGridMeshWithLods(Gd,kb);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Lm.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Zr;for(let p=0;p<=Gd;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new eh,a=new eh,u=new eh,d=new eh;this._poleSegments=[];for(let p=0,_=0;p<Ob;p++){let y=360/(1<<p);n.emplaceBack(0,-$i,0,.5,0),a.emplaceBack(0,-$i,0,.5,1),u.emplaceBack(0,-$i,0,.5,.5),d.emplaceBack(0,-$i,0,.5,.5);for(let b=0;b<=Gd;b++){let T=b/Gd,I=0,D=It(0,y,T),[R,O,F]=Hd(xz,bz,D,$i);n.emplaceBack(R,O,F,T,I),a.emplaceBack(R,O,F,T,1-I);let z=ln(D);T=.5+.5*Math.sin(z),I=.5+.5*Math.cos(z),u.emplaceBack(R,O,F,T,I),d.emplaceBack(R,O,F,T,1-I)}this._poleSegments.push(fr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Zy,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,Zy,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,Zy,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,Zy,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.ct=function(t){return Mu.has(t)},r.cu=rM,r.cv=function(t,e,n=0,a=!0){let u=new lt(n,n),d=t.sub(u),p=e.add(u),_=[d,new lt(p.x,d.y),p,new lt(d.x,p.y)];return a&&_.push(d.clone()),_},r.cw=function(t,e){let n=[];for(let a=0;a<t.length;a++){let u=Oa(a-1,-1,t.length-1),d=Oa(a+1,-1,t.length-1),p=t[a],_=t[d],y=t[u].sub(p).unit(),b=_.sub(p).unit(),T=b.angleWithSep(y.x,y.y),I=y.add(b).unit().mult(-1*e/Math.sin(T/2));n.push(p.add(I))}return n},r.cx=sA,r.cy=uD,r.cz=function(t,e,n=0){return r._.fromValues(((e.x-n)*t.scale-t.x)*it,(e.y*t.scale-t.y)*it,nD(e.z,e.y))},r.d=xd,r.d$=rd,r.d0=yu,r.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d2=Fl,r.d3=iD,r.d4=nh,r.d5=function([t,e,n]){let a=Math.hypot(t,e,n),u=Math.atan2(t,n),d=.5*Math.PI-Math.acos(-e/a);return new vn(di(u),di(d))},r.d6=Ki,r.d7=qd,r.d8=A,r.d9=Qb,r.dA=function(t){let e=Z_();if(!e)return;let n=e.delete(W_);t&&n.catch(t).then(()=>t())},r.dB=og,r.dC=jA,r.dD=function(t){Bw=ti.resolveURL(t),ff||(ff=new Nw(N0(),new za)),ff.broadcast("setDracoUrl",Bw)},r.dE=UA,r.dF=function(t){df=ti.resolveURL(t),ff||(ff=new Nw(N0(),new za)),ff.broadcast("setMeshoptUrl",df)},r.dG=lo,r.dH=J,r.dI=mc,r.dJ=bs,r.dK=ah,r.dL=Ib,r.dM=DM,r.dN=LM,r.dO=bM,r.dP=zl,r.dQ=KM,r.dR=lf,r.dS=function(t,e,n,a,u,d,p,_,y,b,T){t.createArrays(),t.tilePixelRatio=it/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:X}=t.textSizeData;R.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Bt(j),_),D["text-size"].possiblyEvaluate(new Bt(X),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:X}=t.iconSizeData;R.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Bt(j),_),D["icon-size"].possiblyEvaluate(new Bt(X),_)]}R.layoutTextSize=D["text-size"].possiblyEvaluate(new Bt(y+1),_),R.layoutIconSize=D["icon-size"].possiblyEvaluate(new Bt(y+1),_),R.textMaxSize=D["text-size"].possiblyEvaluate(new Bt(18),_);let O=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",F=I.get("text-size"),z=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){z=!0;break}for(let j of t.features){let X=I.get("text-font").evaluate(j,{},_).join(","),Y=F.evaluate(j,{},_),K=R.layoutTextSize.evaluate(j,{},_),le=(R.layoutIconSize.evaluate(j,{},_),{horizontal:{},vertical:void 0}),se=j.text,pe,_e=[0,0];if(se){let De=se.toString(),Ne=I.get("text-letter-spacing").evaluate(j,{},_)*_i,Xe=I.get("text-line-height").evaluate(j,{},_)*_i,Le=Me(De)?Ne:0,qe=I.get("text-anchor").evaluate(j,{},_),ke=I.get("text-variable-anchor");if(!ke){let Ye=I.get("text-radial-offset").evaluate(j,{},_);_e=Ye?nA(qe,[Ye*_i,_w]):I.get("text-offset").evaluate(j,{},_).map(tt=>tt*_i)}let We=O?"center":I.get("text-justify").evaluate(j,{},_),Je=I.get("symbol-placement")==="point",Ze=Je?I.get("text-max-width").evaluate(j,{},_)*_i:1/0,ht=Ye=>{t.allowVerticalPlacement&&Ce(De)&&(le.vertical=fw(se,e,n,u,X,Ze,Xe,qe,Ye,Le,_e,Po.vertical,!0,K,Y))};if(!O&&ke){let Ye=We==="auto"?ke.map(Tt=>yw(Tt)):[We],tt=!1;for(let Tt=0;Tt<Ye.length;Tt++){let yt=Ye[Tt];if(!le.horizontal[yt])if(tt)le.horizontal[yt]=le.horizontal[0];else{let gt=fw(se,e,n,u,X,Ze,Xe,"center",yt,Le,_e,Po.horizontal,!1,K,Y);gt&&(le.horizontal[yt]=gt,tt=gt.positionedLines.length===1)}}ht("left")}else{if(We==="auto"&&(We=yw(qe)),Je||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ce(De)){let Ye=fw(se,e,n,u,X,Ze,Xe,qe,We,Le,_e,Po.horizontal,!1,K,Y);Ye&&(le.horizontal[We]=Ye)}ht(Je?"left":We)}}let Ee=!1;if(j.icon&&j.icon.namePrimary){let De=a[j.icon.namePrimary];De&&(pe=o5(u[j.icon.namePrimary],j.icon.nameSecondary?u[j.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(j,{},_),I.get("icon-anchor").evaluate(j,{},_)),Ee=De.sdf,t.sdfIcons===void 0?t.sdfIcons=De.sdf:t.sdfIcons!==De.sdf&&Sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Oe=iA(le.horizontal)||le.vertical;t.iconsInText||(t.iconsInText=!!Oe&&Oe.iconsInText),(Oe||pe)&&d5(t,j,le,pe,a,R,K,0,_e,Ee,p,_,b,T,z)}d&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dT=u0,r.dU=n0,r.dV=ow,r.dW=ef,r.dX=a0,r.dY=Mw,r.dZ=i0,r.d_=r0,r.da=TD,r.db=function(t){let e=[0,0,0],n=r.ad.identity(new Float64Array(16));return r.ad.multiply(n,t.pixelMatrix,t.globeMatrix),r._.transformMat4(e,e,n),new lt(e[0],e[1])},r.dc=Ie,r.dd=be,r.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(ld==null){let a=n.navigator?n.navigator.userAgent:null;ld=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ld}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.df=id,r.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Wp,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!U(t))return t;let n=To(t);return n.params.push(`sdk=js-${w}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!U(t))return t;let n=To(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!U(t))return t;let n=To(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!U(t))return t;let u=To(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){let u=To(t);return U(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${n}`,$l(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!U(t))return t;let a=To(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${pd.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${A.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${A.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${A.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${A.TILE_URL_VERSION}${a.path}`);let u=this._customAccessToken||function(d){for(let p of d){let _=p.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(a.params)||A.ACCESS_TOKEN;return A.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(t,e){let n=To(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${A.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${n.path.replace(`/${A.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${A.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(t,e){let n=!!e&&U(e),a=[];for(let u of t.tiles||[])L(u)?a.push(this.canonicalizeTileURL(u,n)):a.push(u);return a}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=To(A.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!A.REQUIRE_ACCESS_TOKEN)return $l(t);if(e=e||A.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),$l(t)}},r.dh=function(t,e){e?Mu.add(t):Mu.delete(t)},r.di=pd,r.dj=Z1,r.dk=vd,r.dl=Zp,r.dm=J_,r.dn=W1,r.dp=function(t){Mu.delete(t)},r.dq=Gl,r.dr=Du,r.ds=Nl,r.dt=w,r.du=function(t,e){Vp=t,jp=e},r.dv=function(t,e,n=!1){if(He===ot||He===ct||He===at)throw new Error("setRTLTextPlugin cannot be called multiple times.");st=ti.resolveURL(t),He=ot,je=e,Ot(),n||on()},r.dw=cn,r.dx=function(){N0().acquire(zw)},r.dy=function(){let t=ag;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(zw),ag=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dz=sg,r.e=ti,r.e0=MM,r.e1=ze,r.e2=Fa,r.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==GA){let n=new Uint32Array(t,0,7),[,,a,u,d,p]=n;e=n.byteLength+u+d+p+d,(a!==t.byteLength||e>=t.byteLength)&&Sr("Invalid b3dm header information.")}return ZA(t,e)},r.e4=function(t,e){let n=YA(t);for(let a of n){for(let u of a.meshes)C4(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(I4(a.lights,e)))}return n},r.e5=j0,r.e6=VA,r.e7=Rn,r.e8=function(t){Eu(),ds&&ds.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},r.f=Ri,r.g=function(t,e){return Tu(fi(t,{type:"json"}),e)},r.h=qs,r.i=Ao,r.j=YM,r.k=mw,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>ZA(e,0,t))},r.m=class extends L0{},r.n=Va,r.o=Jp,r.p=C5,r.q=Bd,r.r=m,r.s=s,r.t=N,r.u=Fi,r.v=mi,r.w=Sr,r.x=H,r.y=B,r.z=Md}),c(["./shared"],function(r){function w(ye){let $=ye?ye.url.toString():void 0;return $?performance.getEntriesByName($):[]}function C(ye){if(typeof ye=="number"||typeof ye=="boolean"||typeof ye=="string"||ye==null)return JSON.stringify(ye);if(Array.isArray(ye)){let Z="[";for(let oe of ye)Z+=`${C(oe)},`;return`${Z}]`}let $="{";for(let Z of Object.keys(ye).sort())$+=`${Z}:${C(ye[Z])},`;return`${$}}`}function A(ye){let $="";for(let Z of r.cE)$+=`/${C(ye[Z])}`;return $}class L{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,Z){this._layerConfigs={},this._layers={},this.update($,[],Z)}update($,Z,oe){this._options=oe;for(let fe of $)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=r.cY(fe,this.scope,null,this._options)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(let fe of Z)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};let de=function(fe,we){let Ae={};for(let Pe=0;Pe<fe.length;Pe++){let rt=we&&we[fe[Pe].id]||A(fe[Pe]);we&&(we[fe[Pe].id]=rt);let Ke=Ae[rt];Ke||(Ke=Ae[rt]=[]),Ke.push(fe[Pe])}let ve=[];for(let Pe in Ae)ve.push(Ae[Pe]);return ve}(r.dG(this._layerConfigs),this.keyCache);for(let fe of de){let we=fe.map(_t=>this._layers[_t.id]),Ae=we[0];if(Ae.visibility==="none")continue;let ve=Ae.source||"",Pe=this.familiesBySource[ve];Pe||(Pe=this.familiesBySource[ve]={});let rt=Ae.sourceLayer||"_geojsonTileLayer",Ke=Pe[rt];Ke||(Ke=Pe[rt]=[]),Ke.push(we)}}}let U=1*r.dJ;class Q{constructor($){let Z={},oe=[];for(let Ae in $){let ve=$[Ae],Pe=Z[Ae]={};for(let rt in ve.glyphs){let Ke=ve.glyphs[+rt];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;let _t=Ke.metrics.localGlyph?U:1,Mt={x:0,y:0,w:Ke.bitmap.width+2*_t,h:Ke.bitmap.height+2*_t};oe.push(Mt),Pe[rt]=Mt}}let{w:de,h:fe}=r.j(oe),we=new r.dI({width:de||1,height:fe||1});for(let Ae in $){let ve=$[Ae];for(let Pe in ve.glyphs){let rt=ve.glyphs[+Pe];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;let Ke=Z[Ae][Pe],_t=rt.metrics.localGlyph?U:1;r.dI.copy(rt.bitmap,we,{x:0,y:0},{x:Ke.x+_t,y:Ke.y+_t},rt.bitmap)}}this.image=we,this.positions=Z}}r.dH(Q,"GlyphAtlas");class me{constructor($){this.tileID=new r.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.lut=$.lut,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.scope=$.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.promoteId=$.promoteId,this.isSymbolTile=$.isSymbolTile,this.tileTransform=r.dK($.tileID.canonical,$.projection),this.projection=$.projection,this.brightness=$.brightness,this.extraShadowCaster=!!$.extraShadowCaster,this.tessellationStep=$.tessellationStep}parse($,Z,oe,de,fe){this.status="parsing",this.data=$,this.collisionBoxArray=new r.dL;let we=new r.dM(Object.keys($.layers).sort()),Ae=new r.dN(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];let ve={},Pe=new r.dO(256,256),rt={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Pe,availableImages:oe,brightness:this.brightness},Ke=Z.familiesBySource[this.source];for(let mt in Ke){let rr=$.layers[mt];if(!rr)continue;let Nn=!1,pn=!1,Tr=!1;for(let ui of Ke[mt])ui[0].type==="symbol"?Nn=!0:pn=!0,ui[0].is3D()&&ui[0].type!=="model"&&(Tr=!0);if(this.extraShadowCaster&&!Tr||this.isSymbolTile===!0&&!Nn||this.isSymbolTile===!1&&!pn)continue;rr.version===1&&r.w(`Vector tile source "${this.source}" layer "${mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ir=we.encode(mt),Rr=[];for(let ui=0;ui<rr.length;ui++){let hi=rr.feature(ui),Aa=Ae.getId(hi,mt);Rr.push({feature:hi,id:Aa,index:ui,sourceLayerIndex:ir})}for(let ui of Ke[mt]){let hi=ui[0];(!this.extraShadowCaster||hi.is3D()&&hi.type!=="model")&&(this.isSymbolTile!==void 0&&hi.type==="symbol"!==this.isSymbolTile||hi.minzoom&&this.zoom<Math.floor(hi.minzoom)||hi.maxzoom&&this.zoom>=hi.maxzoom||hi.visibility!=="none"&&(he(ui,this.zoom,rt.brightness,oe),(ve[hi.id]=hi.createBucket({index:Ae.bucketLayerIDs.length,layers:ui,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ir,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Rr,rt,this.tileID.canonical,this.tileTransform),Ae.bucketLayerIDs.push(ui.map(Aa=>Aa.id))))}}let _t,Mt,Kt,en;Pe.trim();let jt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},an=()=>{if(_t)return this.status="done",fe(_t);if(this.extraShadowCaster)this.status="done",fe(null,{buckets:r.dG(ve).filter(mt=>!mt.isEmpty()),featureIndex:Ae,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mt&&Kt&&en){let mt=new Q(Mt),rr=new r.dQ(Kt,en,this.lut);for(let Nn in ve){let pn=ve[Nn];pn instanceof r.dR?(he(pn.layers,this.zoom,rt.brightness,oe),r.dS(pn,Mt,mt.positions,Kt,rr.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):pn.hasPattern&&(pn instanceof r.dT||pn instanceof r.dU||pn instanceof r.b_)&&(he(pn.layers,this.zoom,rt.brightness,oe),pn.addFeatures(rt,this.tileID.canonical,rr.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",fe(null,{buckets:r.dG(ve).filter(Nn=>!Nn.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mt.image,lineAtlas:Pe,imageAtlas:rr,brightness:rt.brightness})}};if(!this.extraShadowCaster){let mt=r.dP(rt.glyphDependencies,pn=>Object.keys(pn).map(Number));Object.keys(mt).length?de.send("getGlyphs",{uid:this.uid,stacks:mt,scope:this.scope},(pn,Tr)=>{_t||(_t=pn,Mt=Tr,an())},void 0,!1,jt):Mt={};let rr=Object.keys(rt.iconDependencies);rr.length?de.send("getImages",{icons:rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(pn,Tr)=>{_t||(_t=pn,Kt=Tr,an())},void 0,!1,jt):Kt={};let Nn=Object.keys(rt.patternDependencies);Nn.length?de.send("getImages",{icons:Nn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(pn,Tr)=>{_t||(_t=pn,en=Tr,an())},void 0,!1,jt):en={}}an()}}function he(ye,$,Z,oe){let de=new r.X($,{brightness:Z});for(let fe of ye)fe.recalculate(de,oe)}class be extends r.E{constructor($,Z,oe,de,fe,we){super(),this.actor=$,this.layerIndex=Z,this.availableImages=oe,this.loadVectorData=fe||r.ap,this.loading={},this.loaded={},this.deduped=new r.ao($.scheduler),this.isSpriteLoaded=de,this.scheduler=$.scheduler,this.brightness=we}loadTile($,Z){let oe=$.uid,de=$&&$.request,fe=de&&de.collectResourceTiming,we=this.loading[oe]=new me($);we.abort=this.loadVectorData($,(Ae,ve)=>{let Pe=!this.loading[oe];if(delete this.loading[oe],Pe||Ae||!ve)return we.status="done",Pe||(this.loaded[oe]=we),Z(Ae);let rt=ve.rawData,Ke={};ve.expires&&(Ke.expires=ve.expires),ve.cacheControl&&(Ke.cacheControl=ve.cacheControl),we.vectorTile=ve.vectorTile||new r.dV(new r.dW(rt));let _t=()=>{we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mt,Kt)=>{if(Mt||!Kt)return Z(Mt);let en={};if(fe){let jt=w(de);jt.length>0&&(en.resourceTiming=JSON.parse(JSON.stringify(jt)))}Z(null,r.W({rawTileData:rt.slice(0)},Kt,Ke,en))})};this.isSpriteLoaded?_t():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_t,{type:"parseTile",isSymbolTile:$.isSymbolTile,zoom:$.tileZoom}):_t()}),this.loaded=this.loaded||{},this.loaded[oe]=we})}reloadTile($,Z){let oe=this.loaded,de=$.uid;if(oe&&oe[de]){let fe=oe[de];fe.showCollisionBoxes=$.showCollisionBoxes,fe.projection=$.projection,fe.brightness=$.brightness,fe.tileTransform=r.dK($.tileID.canonical,$.projection),fe.extraShadowCaster=$.extraShadowCaster,fe.lut=$.lut;let we=(Ae,ve)=>{let Pe=fe.reloadCallback;Pe&&(delete fe.reloadCallback,fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Pe)),Z(Ae,ve)};fe.status==="parsing"?fe.reloadCallback=we:fe.status==="done"&&(fe.vectorTile?fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,we):we())}else Z(null,void 0)}abortTile($,Z){let oe=$.uid,de=this.loading[oe];de&&(de.abort&&de.abort(),delete this.loading[oe]),Z()}removeTile($,Z){let oe=this.loaded,de=$.uid;oe&&oe[de]&&delete oe[de],Z()}}class Ie{loadTile($,Z){let{uid:oe,encoding:de,rawImageData:fe,padding:we}=$,Ae=ImageBitmap&&fe instanceof ImageBitmap?this.getImageData(fe,we):fe;Z(null,new r.dX(oe,Ae,de,we<1))}getImageData($,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);let oe=this.offscreenCanvasContext.getImageData(-Z,-Z,$.width+2*Z,$.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}class Qe{decodeRasterArray({task:$,buffer:Z},oe){r.dY.performDecoding(Z,$).then(de=>{oe(null,de)},de=>{oe(de)})}}let ze=r.dZ.prototype.toGeoJSON,nt=class{constructor(ye){this._feature=ye,this.extent=r.a3,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){let ye=[];for(let $ of this._feature.geometry)ye.push([new r.P($[0],$[1])]);return ye}{let ye=[];for(let $ of this._feature.geometry){let Z=[];for(let oe of $)Z.push(new r.P(oe[0],oe[1]));ye.push(Z)}return ye}}toGeoJSON(ye,$,Z){return ze.call(this,ye,$,Z)}},ft=class{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.a3,this.length=ye.length,this._features=ye}feature(ye){return new nt(this._features[ye])}},Ue=64/4096;class Nt{constructor(){this.features=new Map}clear(){this.features.clear()}load($=[],Z){for(let oe of $){let de=oe.id;if(de==null)continue;let fe=this.features.get(de);fe&&this.updateCache(fe,Z),oe.geometry?(fe=Jt(oe),this.updateCache(fe,Z),this.features.set(de,fe)):this.features.delete(de),this.updateCache(fe,Z)}}updateCache($,Z){for(let{canonical:oe,uid:de}of Object.values(Z)){let{z:fe,x:we,y:Ae}=oe;Yt($,Math.pow(2,fe),we,Ae)&&delete Z[de]}}getTile($,Z,oe){let de=Math.pow(2,$),fe=[];for(let we of this.features.values())Yt(we,de,Z,oe)&&fe.push(_r(we,de,Z,oe));return{features:fe}}getFeatures(){return[...this.features.values()]}}function Yt({minX:ye,minY:$,maxX:Z,maxY:oe},de,fe,we){return ye<(fe+1+Ue)/de&&$<(we+1+Ue)/de&&Z>(fe-Ue)/de&&oe>(we-Ue)/de}function Jt(ye){let{id:$,geometry:Z,properties:oe}=ye;if(!Z)return;if(Z.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:de,coordinates:fe}=Z,we={id:$,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ae=we.geometry;if(de==="Point")Et(fe,Ae,we);else if(de==="MultiPoint")for(let ve of fe)Et(ve,Ae,we);else if(de==="LineString")we.type=2,tr(fe,Ae,we);else if(de==="MultiLineString")we.type=2,Ct(fe,Ae,we);else if(de==="Polygon")we.type=3,Ct(fe,Ae,we,!0);else{if(de!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");we.type=3;for(let ve of fe)Ct(ve,Ae,we,!0)}return we}function Et([ye,$],Z,oe){let de=r.aj(ye),fe=r.ak($);fe=fe<0?0:fe>1?1:fe,Z.push(de,fe),oe.minX=Math.min(oe.minX,de),oe.minY=Math.min(oe.minY,fe),oe.maxX=Math.max(oe.maxX,de),oe.maxY=Math.max(oe.maxY,fe)}function tr(ye,$,Z,oe=!1,de=!1){let fe=[];for(let we of ye)Et(we,fe,Z);$.push(fe),oe&&function(we,Ae){let ve=0;for(let Pe=0,rt=we.length,Ke=rt-2;Pe<rt;Ke=Pe,Pe+=2)ve+=(we[Pe]-we[Ke])*(we[Pe+1]+we[Ke+1]);if(ve>0===Ae)for(let Pe=0,rt=we.length;Pe<rt/2;Pe+=2){let Ke=we[Pe],_t=we[Pe+1];we[Pe]=we[rt-2-Pe],we[Pe+1]=we[rt-1-Pe],we[rt-2-Pe]=Ke,we[rt-1-Pe]=_t}}(fe,de)}function Ct(ye,$,Z,oe=!1){for(let de=0;de<ye.length;de++)tr(ye[de],$,Z,oe,de===0)}function _r(ye,$,Z,oe){let{id:de,type:fe,geometry:we,tags:Ae}=ye,ve=[];if(fe===1)br(we,$,Z,oe,ve);else for(let Pe of we)ve.push(br(Pe,$,Z,oe));return{id:de,type:fe,geometry:ve,tags:Ae}}function br(ye,$,Z,oe,de=[]){for(let fe=0;fe<ye.length;fe+=2)de.push(zr(ye[fe],ye[fe+1],$,Z,oe));return de}function zr(ye,$,Z,oe,de){return[Math.round(r.a3*(ye*Z-oe)),Math.round(r.a3*($*Z-de))]}var xn={exports:{}},jo=r.d$,wt=r.d_.VectorTileFeature,zt=Ht;function Ht(ye,$){this.options=$||{},this.features=ye,this.length=ye.length}function _n(ye,$){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=$||4096}Ht.prototype.feature=function(ye){return new _n(this.features[ye],this.options.extent)},_n.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var $=0;$<ye.length;$++){for(var Z=ye[$],oe=[],de=0;de<Z.length;de++)oe.push(new jo(Z[de][0],Z[de][1]));this.geometry.push(oe)}return this.geometry},_n.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,$=1/0,Z=-1/0,oe=1/0,de=-1/0,fe=0;fe<ye.length;fe++)for(var we=ye[fe],Ae=0;Ae<we.length;Ae++){var ve=we[Ae];$=Math.min($,ve.x),Z=Math.max(Z,ve.x),oe=Math.min(oe,ve.y),de=Math.max(de,ve.y)}return[$,oe,Z,de]},_n.prototype.toGeoJSON=wt.prototype.toGeoJSON;var kt=r.e0,li=zt;function Qn(ye){var $=new kt;return function(Z,oe){for(var de in Z.layers)oe.writeMessage(3,Zi,Z.layers[de])}(ye,$),$.finish()}function Zi(ye,$){var Z;$.writeVarintField(15,ye.version||1),$.writeStringField(1,ye.name||""),$.writeVarintField(5,ye.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ye.length;Z++)oe.feature=ye.feature(Z),$.writeMessage(2,dr,oe);var de=oe.keys;for(Z=0;Z<de.length;Z++)$.writeStringField(3,de[Z]);var fe=oe.values;for(Z=0;Z<fe.length;Z++)$.writeMessage(4,ci,fe[Z])}function dr(ye,$){var Z=ye.feature;Z.id!==void 0&&$.writeVarintField(1,Z.id),$.writeMessage(2,Sa,ye),$.writeVarintField(3,Z.type),$.writeMessage(4,zn,Z)}function Sa(ye,$){var Z=ye.feature,oe=ye.keys,de=ye.values,fe=ye.keycache,we=ye.valuecache;for(var Ae in Z.properties){var ve=Z.properties[Ae],Pe=fe[Ae];if(ve!==null){Pe===void 0&&(oe.push(Ae),fe[Ae]=Pe=oe.length-1),$.writeVarint(Pe);var rt=typeof ve;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(ve=JSON.stringify(ve));var Ke=rt+":"+ve,_t=we[Ke];_t===void 0&&(de.push(ve),we[Ke]=_t=de.length-1),$.writeVarint(_t)}}}function Pt(ye,$){return($<<3)+(7&ye)}function Dr(ye){return ye<<1^ye>>31}function zn(ye,$){for(var Z=ye.loadGeometry(),oe=ye.type,de=0,fe=0,we=Z.length,Ae=0;Ae<we;Ae++){var ve=Z[Ae],Pe=1;oe===1&&(Pe=ve.length),$.writeVarint(Pt(1,Pe));for(var rt=oe===3?ve.length-1:ve.length,Ke=0;Ke<rt;Ke++){Ke===1&&oe!==1&&$.writeVarint(Pt(2,rt-1));var _t=ve[Ke].x-de,Mt=ve[Ke].y-fe;$.writeVarint(Dr(_t)),$.writeVarint(Dr(Mt)),de+=_t,fe+=Mt}oe===3&&$.writeVarint(Pt(7,1))}}function ci(ye,$){var Z=typeof ye;Z==="string"?$.writeStringField(1,ye):Z==="boolean"?$.writeBooleanField(7,ye):Z==="number"&&(ye%1!=0?$.writeDoubleField(3,ye):ye<0?$.writeSVarintField(6,ye):$.writeVarintField(5,ye))}xn.exports=Qn,xn.exports.fromVectorTileJs=Qn,xn.exports.fromGeojsonVt=function(ye,$){$=$||{};var Z={};for(var oe in ye)Z[oe]=new li(ye[oe].features,$),Z[oe].name=oe,Z[oe].version=$.version,Z[oe].extent=$.extent;return Qn({layers:Z})},xn.exports.GeoJSONWrapper=li;var cs=r.e1(xn.exports);let Vs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},au=Math.fround||(bl=new Float32Array(1),ye=>(bl[0]=+ye,bl[0]));var bl;let wo=3,Eo=5,lu=6;class Rt{constructor($){this.options=Object.assign(Object.create(Vs),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){let{log:Z,minZoom:oe,maxZoom:de}=this.options;Z&&console.time("total time");let fe=`prepare ${$.length} points`;Z&&console.time(fe),this.points=$;let we=[];for(let ve=0;ve<$.length;ve++){let Pe=$[ve];if(!Pe.geometry)continue;let[rt,Ke]=Pe.geometry.coordinates,_t=au(Bi(rt)),Mt=au(Ca(Ke));we.push(_t,Mt,1/0,ve,-1,1),this.options.reduce&&we.push(0)}let Ae=this.trees[de+1]=this._createTree(we);Z&&console.timeEnd(fe);for(let ve=de;ve>=oe;ve--){let Pe=+Date.now();Ae=this.trees[ve]=this._createTree(this._cluster(Ae,ve)),Z&&console.log("z%d: %d clusters in %dms",ve,Ae.numItems,+Date.now()-Pe)}return Z&&console.timeEnd("total time"),this}getClusters($,Z){let oe=(($[0]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,$[1])),fe=$[2]===180?180:(($[2]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)oe=-180,fe=180;else if(oe>fe){let Ke=this.getClusters([oe,de,180,we],Z),_t=this.getClusters([-180,de,fe,we],Z);return Ke.concat(_t)}let Ae=this.trees[this._limitZoom(Z)],ve=Ae.range(Bi(oe),Ca(we),Bi(fe),Ca(de)),Pe=Ae.data,rt=[];for(let Ke of ve){let _t=this.stride*Ke;rt.push(Pe[_t+Eo]>1?Lt(Pe,_t,this.clusterProps):this.points[Pe[_t+wo]])}return rt}getChildren($){let Z=this._getOriginId($),oe=this._getOriginZoom($),de="No cluster with the specified id.",fe=this.trees[oe];if(!fe)throw new Error(de);let we=fe.data;if(Z*this.stride>=we.length)throw new Error(de);let Ae=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ve=fe.within(we[Z*this.stride],we[Z*this.stride+1],Ae),Pe=[];for(let rt of ve){let Ke=rt*this.stride;we[Ke+4]===$&&Pe.push(we[Ke+Eo]>1?Lt(we,Ke,this.clusterProps):this.points[we[Ke+wo]])}if(Pe.length===0)throw new Error(de);return Pe}getLeaves($,Z,oe){let de=[];return this._appendLeaves(de,$,Z=Z||10,oe=oe||0,0),de}getTile($,Z,oe){let de=this.trees[this._limitZoom($)],fe=Math.pow(2,$),{extent:we,radius:Ae}=this.options,ve=Ae/we,Pe=(oe-ve)/fe,rt=(oe+1+ve)/fe,Ke={features:[]};return this._addTileFeatures(de.range((Z-ve)/fe,Pe,(Z+1+ve)/fe,rt),de.data,Z,oe,fe,Ke),Z===0&&this._addTileFeatures(de.range(1-ve/fe,Pe,1,rt),de.data,fe,oe,fe,Ke),Z===fe-1&&this._addTileFeatures(de.range(0,Pe,ve/fe,rt),de.data,-1,oe,fe,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom($){let Z=this._getOriginZoom($)-1;for(;Z<=this.options.maxZoom;){let oe=this.getChildren($);if(Z++,oe.length!==1)break;$=oe[0].properties.cluster_id}return Z}_appendLeaves($,Z,oe,de,fe){let we=this.getChildren(Z);for(let Ae of we){let ve=Ae.properties;if(ve&&ve.cluster?fe+ve.point_count<=de?fe+=ve.point_count:fe=this._appendLeaves($,ve.cluster_id,oe,de,fe):fe<de?fe++:$.push(Ae),$.length===oe)break}return fe}_createTree($){let Z=new r.cK($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<$.length;oe+=this.stride)Z.add($[oe],$[oe+1]);return Z.finish(),Z.data=$,Z}_addTileFeatures($,Z,oe,de,fe,we){for(let Ae of $){let ve=Ae*this.stride,Pe=Z[ve+Eo]>1,rt,Ke,_t;if(Pe)rt=wl(Z,ve,this.clusterProps),Ke=Z[ve],_t=Z[ve+1];else{let en=this.points[Z[ve+wo]];rt=en.properties;let[jt,an]=en.geometry.coordinates;Ke=Bi(jt),_t=Ca(an)}let Mt={type:1,geometry:[[Math.round(this.options.extent*(Ke*fe-oe)),Math.round(this.options.extent*(_t*fe-de))]],tags:rt},Kt;Kt=Pe||this.options.generateId?Z[ve+wo]:this.points[Z[ve+wo]].id,Kt!==void 0&&(Mt.id=Kt),we.features.push(Mt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,Z){let{radius:oe,extent:de,reduce:fe,minPoints:we}=this.options,Ae=oe/(de*Math.pow(2,Z)),ve=$.data,Pe=[],rt=this.stride;for(let Ke=0;Ke<ve.length;Ke+=rt){if(ve[Ke+2]<=Z)continue;ve[Ke+2]=Z;let _t=ve[Ke],Mt=ve[Ke+1],Kt=$.within(ve[Ke],ve[Ke+1],Ae),en=ve[Ke+Eo],jt=en;for(let an of Kt){let mt=an*rt;ve[mt+2]>Z&&(jt+=ve[mt+Eo])}if(jt>en&&jt>=we){let an,mt=_t*en,rr=Mt*en,Nn=-1,pn=(Ke/rt<<5)+(Z+1)+this.points.length;for(let Tr of Kt){let ir=Tr*rt;if(ve[ir+2]<=Z)continue;ve[ir+2]=Z;let Rr=ve[ir+Eo];mt+=ve[ir]*Rr,rr+=ve[ir+1]*Rr,ve[ir+4]=pn,fe&&(an||(an=this._map(ve,Ke,!0),Nn=this.clusterProps.length,this.clusterProps.push(an)),fe(an,this._map(ve,ir)))}ve[Ke+4]=pn,Pe.push(mt/jt,rr/jt,1/0,pn,-1,jt),fe&&Pe.push(Nn)}else{for(let an=0;an<rt;an++)Pe.push(ve[Ke+an]);if(jt>1)for(let an of Kt){let mt=an*rt;if(!(ve[mt+2]<=Z)){ve[mt+2]=Z;for(let rr=0;rr<rt;rr++)Pe.push(ve[mt+rr])}}}}return Pe}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,Z,oe){if($[Z+Eo]>1){let we=this.clusterProps[$[Z+lu]];return oe?Object.assign({},we):we}let de=this.points[$[Z+wo]].properties,fe=this.options.map(de);return oe&&fe===de?Object.assign({},fe):fe}}function Lt(ye,$,Z){return{type:"Feature",id:ye[$+wo],properties:wl(ye,$,Z),geometry:{type:"Point",coordinates:[(oe=ye[$],360*(oe-.5)),El(ye[$+1])]}};var oe}function wl(ye,$,Z){let oe=ye[$+Eo],de=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,fe=ye[$+lu],we=fe===-1?{}:Object.assign({},Z[fe]);return Object.assign(we,{cluster:!0,cluster_id:ye[$+wo],point_count:oe,point_count_abbreviated:de})}function Bi(ye){return ye/360+.5}function Ca(ye){let $=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function El(ye){let $=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function Tl(ye,$,Z,oe){let de=oe,fe=$+(Z-$>>1),we,Ae=Z-$,ve=ye[$],Pe=ye[$+1],rt=ye[Z],Ke=ye[Z+1];for(let _t=$+3;_t<Z;_t+=3){let Mt=cu(ye[_t],ye[_t+1],ve,Pe,rt,Ke);if(Mt>de)we=_t,de=Mt;else if(Mt===de){let Kt=Math.abs(_t-fe);Kt<Ae&&(we=_t,Ae=Kt)}}de>oe&&(we-$>3&&Tl(ye,$,we,oe),ye[we+2]=de,Z-we>3&&Tl(ye,we,Z,oe))}function cu(ye,$,Z,oe,de,fe){let we=de-Z,Ae=fe-oe;if(we!==0||Ae!==0){let ve=((ye-Z)*we+($-oe)*Ae)/(we*we+Ae*Ae);ve>1?(Z=de,oe=fe):ve>0&&(Z+=we*ve,oe+=Ae*ve)}return we=ye-Z,Ae=$-oe,we*we+Ae*Ae}function js(ye,$,Z,oe){let de={id:ye??null,type:$,geometry:Z,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")Ia(de,Z);else if($==="Polygon")Ia(de,Z[0]);else if($==="MultiLineString")for(let fe of Z)Ia(de,fe);else if($==="MultiPolygon")for(let fe of Z)Ia(de,fe[0]);return de}function Ia(ye,$){for(let Z=0;Z<$.length;Z+=3)ye.minX=Math.min(ye.minX,$[Z]),ye.minY=Math.min(ye.minY,$[Z+1]),ye.maxX=Math.max(ye.maxX,$[Z]),ye.maxY=Math.max(ye.maxY,$[Z+1])}function Sl(ye,$,Z,oe){if(!$.geometry)return;let de=$.geometry.coordinates;if(de&&de.length===0)return;let fe=$.geometry.type,we=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ae=[],ve=$.id;if(Z.promoteId?ve=$.properties[Z.promoteId]:Z.generateId&&(ve=oe||0),fe==="Point")uu(de,Ae);else if(fe==="MultiPoint")for(let Pe of de)uu(Pe,Ae);else if(fe==="LineString")Cl(de,Ae,we,!1);else if(fe==="MultiLineString"){if(Z.lineMetrics){for(let Pe of de)Ae=[],Cl(Pe,Ae,we,!1),ye.push(js(ve,"LineString",Ae,$.properties));return}Il(de,Ae,we,!1)}else if(fe==="Polygon")Il(de,Ae,we,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(let Pe of $.geometry.geometries)Sl(ye,{id:ve,geometry:Pe,properties:$.properties},Z,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Pe of de){let rt=[];Il(Pe,rt,we,!0),Ae.push(rt)}}ye.push(js(ve,fe,Ae,$.properties))}function uu(ye,$){$.push(oo(ye[0]),Qh(ye[1]),0)}function Cl(ye,$,Z,oe){let de,fe,we=0;for(let ve=0;ve<ye.length;ve++){let Pe=oo(ye[ve][0]),rt=Qh(ye[ve][1]);$.push(Pe,rt,0),ve>0&&(we+=oe?(de*rt-Pe*fe)/2:Math.sqrt(Math.pow(Pe-de,2)+Math.pow(rt-fe,2))),de=Pe,fe=rt}let Ae=$.length-3;$[2]=1,Tl($,0,Ae,Z),$[Ae+2]=1,$.size=Math.abs(we),$.start=0,$.end=$.size}function Il(ye,$,Z,oe){for(let de=0;de<ye.length;de++){let fe=[];Cl(ye[de],fe,Z,oe),$.push(fe)}}function oo(ye){return ye/360+.5}function Qh(ye){let $=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function Ft(ye,$,Z,oe,de,fe,we,Ae){if(oe/=$,fe>=(Z/=$)&&we<oe)return ye;if(we<Z||fe>=oe)return null;let ve=[];for(let Pe of ye){let rt=Pe.geometry,Ke=Pe.type,_t=de===0?Pe.minX:Pe.minY,Mt=de===0?Pe.maxX:Pe.maxY;if(_t>=Z&&Mt<oe){ve.push(Pe);continue}if(Mt<Z||_t>=oe)continue;let Kt=[];if(Ke==="Point"||Ke==="MultiPoint")hu(rt,Kt,Z,oe,de);else if(Ke==="LineString")xr(rt,Kt,Z,oe,de,!1,Ae.lineMetrics);else if(Ke==="MultiLineString")Da(rt,Kt,Z,oe,de,!1);else if(Ke==="Polygon")Da(rt,Kt,Z,oe,de,!0);else if(Ke==="MultiPolygon")for(let en of rt){let jt=[];Da(en,jt,Z,oe,de,!0),jt.length&&Kt.push(jt)}if(Kt.length){if(Ae.lineMetrics&&Ke==="LineString"){for(let en of Kt)ve.push(js(Pe.id,Ke,en,Pe.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(Kt.length===1?(Ke="LineString",Kt=Kt[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=Kt.length===3?"Point":"MultiPoint"),ve.push(js(Pe.id,Ke,Kt,Pe.tags))}}return ve.length?ve:null}function hu(ye,$,Z,oe,de){for(let fe=0;fe<ye.length;fe+=3){let we=ye[fe+de];we>=Z&&we<=oe&&Uo($,ye[fe],ye[fe+1],ye[fe+2])}}function xr(ye,$,Z,oe,de,fe,we){let Ae=Dl(ye),ve=de===0?$o:du,Pe,rt,Ke=ye.start;for(let jt=0;jt<ye.length-3;jt+=3){let an=ye[jt],mt=ye[jt+1],rr=ye[jt+2],Nn=ye[jt+3],pn=ye[jt+4],Tr=de===0?an:mt,ir=de===0?Nn:pn,Rr=!1;we&&(Pe=Math.sqrt(Math.pow(an-Nn,2)+Math.pow(mt-pn,2))),Tr<Z?ir>Z&&(rt=ve(Ae,an,mt,Nn,pn,Z),we&&(Ae.start=Ke+Pe*rt)):Tr>oe?ir<oe&&(rt=ve(Ae,an,mt,Nn,pn,oe),we&&(Ae.start=Ke+Pe*rt)):Uo(Ae,an,mt,rr),ir<Z&&Tr>=Z&&(rt=ve(Ae,an,mt,Nn,pn,Z),Rr=!0),ir>oe&&Tr<=oe&&(rt=ve(Ae,an,mt,Nn,pn,oe),Rr=!0),!fe&&Rr&&(we&&(Ae.end=Ke+Pe*rt),$.push(Ae),Ae=Dl(ye)),we&&(Ke+=Pe)}let _t=ye.length-3,Mt=ye[_t],Kt=ye[_t+1],en=de===0?Mt:Kt;en>=Z&&en<=oe&&Uo(Ae,Mt,Kt,ye[_t+2]),_t=Ae.length-3,fe&&_t>=3&&(Ae[_t]!==Ae[0]||Ae[_t+1]!==Ae[1])&&Uo(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&$.push(Ae)}function Dl(ye){let $=[];return $.size=ye.size,$.start=ye.start,$.end=ye.end,$}function Da(ye,$,Z,oe,de,fe){for(let we of ye)xr(we,$,Z,oe,de,fe,!1)}function Uo(ye,$,Z,oe){ye.push($,Z,oe)}function $o(ye,$,Z,oe,de,fe){let we=(fe-$)/(oe-$);return Uo(ye,fe,Z+(de-Z)*we,1),we}function du(ye,$,Z,oe,de,fe){let we=(fe-Z)/(de-Z);return Uo(ye,$+(oe-$)*we,fe,1),we}function Us(ye,$){let Z=[];for(let oe=0;oe<ye.length;oe++){let de=ye[oe],fe=de.type,we;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")we=$s(de.geometry,$);else if(fe==="MultiLineString"||fe==="Polygon"){we=[];for(let Ae of de.geometry)we.push($s(Ae,$))}else if(fe==="MultiPolygon"){we=[];for(let Ae of de.geometry){let ve=[];for(let Pe of Ae)ve.push($s(Pe,$));we.push(ve)}}Z.push(js(de.id,fe,we,de.tags))}return Z}function $s(ye,$){let Z=[];Z.size=ye.size,ye.start!==void 0&&(Z.start=ye.start,Z.end=ye.end);for(let oe=0;oe<ye.length;oe+=3)Z.push(ye[oe]+$,ye[oe+1],ye[oe+2]);return Z}function Ml(ye,$){if(ye.transformed)return ye;let Z=1<<ye.z,oe=ye.x,de=ye.y;for(let fe of ye.features){let we=fe.geometry,Ae=fe.type;if(fe.geometry=[],Ae===1)for(let ve=0;ve<we.length;ve+=2)fe.geometry.push(Al(we[ve],we[ve+1],$,Z,oe,de));else for(let ve=0;ve<we.length;ve++){let Pe=[];for(let rt=0;rt<we[ve].length;rt+=2)Pe.push(Al(we[ve][rt],we[ve][rt+1],$,Z,oe,de));fe.geometry.push(Pe)}}return ye.transformed=!0,ye}function Al(ye,$,Z,oe,de,fe){return[Math.round(Z*(ye*oe-de)),Math.round(Z*($*oe-fe))]}function Jh(ye,$,Z,oe,de){let fe=$===de.maxZoom?0:de.tolerance/((1<<$)*de.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:Z,y:oe,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ae of ye)Pl(we,Ae,fe,de);return we}function Pl(ye,$,Z,oe){let de=$.geometry,fe=$.type,we=[];if(ye.minX=Math.min(ye.minX,$.minX),ye.minY=Math.min(ye.minY,$.minY),ye.maxX=Math.max(ye.maxX,$.maxX),ye.maxY=Math.max(ye.maxY,$.maxY),fe==="Point"||fe==="MultiPoint")for(let Ae=0;Ae<de.length;Ae+=3)we.push(de[Ae],de[Ae+1]),ye.numPoints++,ye.numSimplified++;else if(fe==="LineString")so(we,de,ye,Z,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Ae=0;Ae<de.length;Ae++)so(we,de[Ae],ye,Z,fe==="Polygon",Ae===0);else if(fe==="MultiPolygon")for(let Ae=0;Ae<de.length;Ae++){let ve=de[Ae];for(let Pe=0;Pe<ve.length;Pe++)so(we,ve[Pe],ye,Z,!0,Pe===0)}if(we.length){let Ae=$.tags||null;if(fe==="LineString"&&oe.lineMetrics){Ae={};for(let Pe in $.tags)Ae[Pe]=$.tags[Pe];Ae.mapbox_clip_start=de.start/de.size,Ae.mapbox_clip_end=de.end/de.size}let ve={geometry:we,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Ae};$.id!==null&&(ve.id=$.id),ye.features.push(ve)}}function so(ye,$,Z,oe,de,fe){let we=oe*oe;if(oe>0&&$.size<(de?we:oe))return void(Z.numPoints+=$.length/3);let Ae=[];for(let ve=0;ve<$.length;ve+=3)(oe===0||$[ve+2]>we)&&(Z.numSimplified++,Ae.push($[ve],$[ve+1])),Z.numPoints++;de&&function(ve,Pe){let rt=0;for(let Ke=0,_t=ve.length,Mt=_t-2;Ke<_t;Mt=Ke,Ke+=2)rt+=(ve[Ke]-ve[Mt])*(ve[Ke+1]+ve[Mt+1]);if(rt>0===Pe)for(let Ke=0,_t=ve.length;Ke<_t/2;Ke+=2){let Mt=ve[Ke],Kt=ve[Ke+1];ve[Ke]=ve[_t-2-Ke],ve[Ke+1]=ve[_t-1-Ke],ve[_t-2-Ke]=Mt,ve[_t-1-Ke]=Kt}}(Ae,fe),ye.push(Ae)}let Gs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ao{constructor($,Z){let oe=(Z=this.options=function(fe,we){for(let Ae in we)fe[Ae]=we[Ae];return fe}(Object.create(Gs),Z)).debug;if(oe&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(fe,we){let Ae=[];if(fe.type==="FeatureCollection")for(let ve=0;ve<fe.features.length;ve++)Sl(Ae,fe.features[ve],we,ve);else Sl(Ae,fe.type==="Feature"?fe:{geometry:fe},we);return Ae}($,Z);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(fe,we){let Ae=we.buffer/we.extent,ve=fe,Pe=Ft(fe,1,-1-Ae,Ae,0,-1,2,we),rt=Ft(fe,1,1-Ae,2+Ae,0,-1,2,we);return(Pe||rt)&&(ve=Ft(fe,1,-Ae,1+Ae,0,-1,2,we)||[],Pe&&(ve=Us(Pe,1).concat(ve)),rt&&(ve=ve.concat(Us(rt,-1)))),ve}(de,Z),de.length&&this.splitTile(de,0,0,0),oe&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,Z,oe,de,fe,we,Ae){let ve=[$,Z,oe,de],Pe=this.options,rt=Pe.debug;for(;ve.length;){de=ve.pop(),oe=ve.pop(),Z=ve.pop(),$=ve.pop();let Ke=1<<Z,_t=Jr(Z,oe,de),Mt=this.tiles[_t];if(!Mt&&(rt>1&&console.time("creation"),Mt=this.tiles[_t]=Jh($,Z,oe,de,Pe),this.tileCoords.push({z:Z,x:oe,y:de}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,oe,de,Mt.numFeatures,Mt.numPoints,Mt.numSimplified),console.timeEnd("creation"));let Rr=`z${Z}`;this.stats[Rr]=(this.stats[Rr]||0)+1,this.total++}if(Mt.source=$,fe==null){if(Z===Pe.indexMaxZoom||Mt.numPoints<=Pe.indexMaxPoints)continue}else{if(Z===Pe.maxZoom||Z===fe)continue;if(fe!=null){let Rr=fe-Z;if(oe!==we>>Rr||de!==Ae>>Rr)continue}}if(Mt.source=null,$.length===0)continue;rt>1&&console.time("clipping");let Kt=.5*Pe.buffer/Pe.extent,en=.5-Kt,jt=.5+Kt,an=1+Kt,mt=null,rr=null,Nn=null,pn=null,Tr=Ft($,Ke,oe-Kt,oe+jt,0,Mt.minX,Mt.maxX,Pe),ir=Ft($,Ke,oe+en,oe+an,0,Mt.minX,Mt.maxX,Pe);$=null,Tr&&(mt=Ft(Tr,Ke,de-Kt,de+jt,1,Mt.minY,Mt.maxY,Pe),rr=Ft(Tr,Ke,de+en,de+an,1,Mt.minY,Mt.maxY,Pe),Tr=null),ir&&(Nn=Ft(ir,Ke,de-Kt,de+jt,1,Mt.minY,Mt.maxY,Pe),pn=Ft(ir,Ke,de+en,de+an,1,Mt.minY,Mt.maxY,Pe),ir=null),rt>1&&console.timeEnd("clipping"),ve.push(mt||[],Z+1,2*oe,2*de),ve.push(rr||[],Z+1,2*oe,2*de+1),ve.push(Nn||[],Z+1,2*oe+1,2*de),ve.push(pn||[],Z+1,2*oe+1,2*de+1)}}getTile($,Z,oe){$=+$,Z=+Z,oe=+oe;let de=this.options,{extent:fe,debug:we}=de;if($<0||$>24)return null;let Ae=1<<$,ve=Jr($,Z=Z+Ae&Ae-1,oe);if(this.tiles[ve])return Ml(this.tiles[ve],fe);we>1&&console.log("drilling down to z%d-%d-%d",$,Z,oe);let Pe,rt=$,Ke=Z,_t=oe;for(;!Pe&&rt>0;)rt--,Ke>>=1,_t>>=1,Pe=this.tiles[Jr(rt,Ke,_t)];return Pe&&Pe.source?(we>1&&(console.log("found parent tile z%d-%d-%d",rt,Ke,_t),console.time("drilling down")),this.splitTile(Pe.source,rt,Ke,_t,$,Z,oe),we>1&&console.timeEnd("drilling down"),this.tiles[ve]?Ml(this.tiles[ve],fe):null):null}}function Jr(ye,$,Z){return 32*((1<<ye)*Z+$)+ye}function ed(ye,$){let Z=ye.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);let oe=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!oe)return $(null,null);let de=new ft(oe.features),fe=cs(de);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),$(null,{vectorTile:de,rawData:fe.buffer})}class Ma extends be{constructor($,Z,oe,de,fe,we){super($,Z,oe,de,ed,we),fe&&(this.loadGeoJSON=fe),this._dynamicIndex=new Nt}loadData($,Z){let oe=$&&$.request,de=oe&&oe.collectResourceTiming;this.loadGeoJSON($,(fe,we)=>{if(fe||!we)return Z(fe);if(typeof we!="object")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{try{if($.filter){let ve=r.y($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));we.features=we.features.filter(Pe=>ve.value.evaluate({zoom:0},Pe))}$.dynamic?(we.type==="Feature"&&(we={type:"FeatureCollection",features:[we]}),$.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(we.features,this.loaded),$.cluster&&(we.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=$.cluster?new Rt(function({superclusterOptions:ve,clusterProperties:Pe}){if(!Pe||!ve)return ve;let rt={},Ke={},_t={accumulated:null,zoom:0},Mt={properties:null},Kt=Object.keys(Pe);for(let en of Kt){let[jt,an]=Pe[en],mt=r.y(an),rr=r.y(typeof jt=="string"?[jt,["accumulated"],["get",en]]:jt);rt[en]=mt.value,Ke[en]=rr.value}return ve.map=en=>{Mt.properties=en;let jt={};for(let an of Kt)jt[an]=rt[an].evaluate(_t,Mt);return jt},ve.reduce=(en,jt)=>{Mt.properties=jt;for(let an of Kt)_t.accumulated=en[an],en[an]=Ke[an].evaluate(_t,Mt)},ve}($)).load(we.features):$.dynamic?this._dynamicIndex:function(ve,Pe){return new ao(ve,Pe)}(we,$.geojsonVtOptions)}catch(ve){return Z(ve)}let Ae={};if(de){let ve=w(oe);ve&&(Ae.resourceTiming={},Ae.resourceTiming[$.source]=JSON.parse(JSON.stringify(ve)))}Z(null,Ae)}})}reloadTile($,Z){let oe=this.loaded;return oe&&oe[$.uid]?$.partial?Z(null,void 0):super.reloadTile($,Z):this.loadTile($,Z)}loadGeoJSON($,Z){if($.request)r.g($.request,Z);else{if(typeof $.data!="string")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse($.data))}catch{return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(oe){Z(oe)}}getClusterChildren($,Z){try{Z(null,this._geoJSONIndex.getChildren($.clusterId))}catch(oe){Z(oe)}}getClusterLeaves($,Z){try{Z(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(oe){Z(oe)}}}class Rl{constructor($,Z){this.tileID=new r.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=Z}parse($,Z,oe,de){this.status="parsing";let fe=new r.aL(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),we={},Ae=Z.familiesBySource[oe.source],ve=new r.dN(fe,oe.promoteId);return ve.bucketLayerIDs=[],ve.is3DTile=!0,r.e3($).then(Pe=>{if(!Pe)return de(new Error("Could not parse tile"));let rt=r.e4(Pe,1/r.b5(oe.tileID.canonical)),Ke=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Pe.json.asset.extras&&Pe.json.asset.extras.MAPBOX_mesh_features,_t=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("EXT_meshopt_compression"),Mt=new r.X(this.zoom,{brightness:this.brightness});for(let Kt in Ae)for(let en of Ae[Kt]){let jt=en[0];ve.bucketLayerIDs.push(en.map(mt=>mt.id)),jt.recalculate(Mt,[]);let an=new r.e5(rt,fe,Ke,_t,this.brightness,ve);Ke||(an.needsUpload=!0),we[jt.fqid]=an,an.evaluate(jt)}this.status="done",de(null,{buckets:we,featureIndex:ve})}).catch(Pe=>de(new Error(Pe.message)))}}class fu{constructor($,Z,oe,de,fe,we){this.actor=$,this.layerIndex=Z,this.brightness=we,this.loading={},this.loaded={}}loadTile($,Z){let oe=$.uid,de=this.loading[oe]=new Rl($,this.brightness);r.e2($.request,(fe,we)=>{let Ae=!this.loading[oe];return delete this.loading[oe],Ae||fe?(de.status="done",Ae||(this.loaded[oe]=de),Z(fe)):we&&we.byteLength!==0?void de.parse(we,this.layerIndex,$,(ve,Pe)=>{de.status="done",this.loaded=this.loaded||{},this.loaded[oe]=de,ve||!Pe?Z(ve):Z(null,Pe)}):(de.status="done",this.loaded[oe]=de,Z())})}reloadTile($,Z){let oe=this.loaded,de=$.uid;if(oe&&oe[de]){let fe=oe[de];fe.projection=$.projection,fe.brightness=$.brightness;let we=(Ae,ve)=>{fe.reloadCallback&&(delete fe.reloadCallback,this.loadTile($,Z)),Z(Ae,ve)};fe.status==="parsing"?fe.reloadCallback=we:fe.status==="done"&&this.loadTile($,Z)}}abortTile($,Z){let oe=$.uid;this.loading[oe]&&delete this.loading[oe],Z()}removeTile($,Z){let oe=this.loaded,de=$.uid;oe&&oe[de]&&delete oe[de],Z()}}class Ol{constructor($){this.self=$,this.actor=new r.e6($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.aJ({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:Ma,"batched-model":fu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,oe)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=oe},this.self.registerRTLTextPlugin=Z=>{if(r.e7.isParsed())throw new Error("RTL text plugin already registered.");r.e7.applyArabicShaping=Z.applyArabicShaping,r.e7.processBidirectionalText=Z.processBidirectionalText,r.e7.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches($,Z,oe){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],delete this.rasterArrayWorkerSource,oe()}checkIfReady($,Z,oe){oe()}setReferrer($,Z){this.referrer=Z}spriteLoaded($,{scope:Z,isLoaded:oe}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][Z]=oe,this.workerSources[$]&&this.workerSources[$][Z])for(let de in this.workerSources[$][Z]){let fe=this.workerSources[$][Z][de];for(let we in fe){let Ae=fe[we];Ae instanceof be&&(Ae.isSpriteLoaded=oe,Ae.fire(new r.f("isSpriteLoaded")))}}}setImages($,{scope:Z,images:oe},de){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][Z]=oe,this.workerSources[$]&&this.workerSources[$][Z]){for(let fe in this.workerSources[$][Z]){let we=this.workerSources[$][Z][fe];for(let Ae in we)we[Ae].availableImages=oe}de()}else de()}setProjection($,Z){this.projections[$]=r.aJ(Z)}setBrightness($,Z,oe){this.brightness=Z,oe()}setLayers($,Z,oe){this.getLayerIndex($,Z.scope).replace(Z.layers,Z.options),oe()}updateLayers($,Z,oe){this.getLayerIndex($,Z.scope).update(Z.layers,Z.removedIds,Z.options),oe()}loadTile($,Z,oe){Z.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source,Z.scope).loadTile(Z,oe)}loadDEMTile($,Z,oe){this.getDEMWorkerSource($,Z.source,Z.scope).loadTile(Z,oe)}decodeRasterArray($,Z,oe){this.getRasterArrayWorkerSource().decodeRasterArray(Z,oe)}reloadTile($,Z,oe){Z.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source,Z.scope).reloadTile(Z,oe)}abortTile($,Z,oe){this.getWorkerSource($,Z.type,Z.source,Z.scope).abortTile(Z,oe)}removeTile($,Z,oe){this.getWorkerSource($,Z.type,Z.source,Z.scope).removeTile(Z,oe)}removeSource($,Z,oe){if(!(this.workerSources[$]&&this.workerSources[$][Z.scope]&&this.workerSources[$][Z.scope][Z.type]&&this.workerSources[$][Z.scope][Z.type][Z.source]))return;let de=this.workerSources[$][Z.scope][Z.type][Z.source];delete this.workerSources[$][Z.scope][Z.type][Z.source],de.removeSource!==void 0?de.removeSource(Z,oe):oe()}loadWorkerSource($,Z,oe){try{this.self.importScripts(Z.url),oe()}catch(de){oe(de.toString())}}syncRTLPluginState($,Z,oe){try{r.e7.setState(Z);let de=r.e7.getPluginURL();if(r.e7.isLoaded()&&!r.e7.isParsed()&&de!=null){this.self.importScripts(de);let fe=r.e7.isParsed();oe(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),fe)}}catch(de){oe(de.toString())}}setDracoUrl($,Z){this.dracoUrl=Z}getAvailableImages($,Z){this.availableImages[$]||(this.availableImages[$]={});let oe=this.availableImages[$][Z];return oe||(oe=[]),oe}getLayerIndex($,Z){this.layerIndexes[$]||(this.layerIndexes[$]={});let oe=this.layerIndexes[$][Z];return oe||(oe=this.layerIndexes[$][Z]=new L,oe.scope=Z),oe}getWorkerSource($,Z,oe,de){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][de]||(this.workerSources[$][de]={}),this.workerSources[$][de][Z]||(this.workerSources[$][de][Z]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][de][Z][oe]||(this.workerSources[$][de][Z][oe]=new this.workerSourceTypes[Z]({send:(fe,we,Ae,ve,Pe,rt)=>{this.actor.send(fe,we,Ae,$,Pe,rt)},scheduler:this.actor.scheduler},this.getLayerIndex($,de),this.getAvailableImages($,de),this.isSpriteLoaded[$][de],void 0,this.brightness)),this.workerSources[$][de][Z][oe]}getDEMWorkerSource($,Z,oe){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][oe]||(this.demWorkerSources[$][oe]={}),this.demWorkerSources[$][oe][Z]||(this.demWorkerSources[$][oe][Z]=new Ie),this.demWorkerSources[$][oe][Z]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Qe),this.rasterArrayWorkerSource}enforceCacheSizeLimit($,Z){r.e8(Z)}getWorkerPerformanceMetrics($,Z,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ol(self)),Ol}),c(["./shared"],function(r){function w(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let h=0;h<m.length;h++)if(!w(m[h],s[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&s!==null){if(typeof s!="object"||Object.keys(m).length!==Object.keys(s).length)return!1;for(let h in m)if(!w(m[h],s[h]))return!1;return!0}return m===s}var C=A;function A(m){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{v=new Worker(E),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(E),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(L[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(L[h]=function(g){var v,x=function(E){var S=document.createElement("canvas"),M=Object.create(A.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=E,S.getContext("webgl2",M)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),L[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(m)}var L={};function U(m,s,h){let g=document.createElement(m);return s!=null&&(g.className=s),h&&h.appendChild(g),g}function Q(m,s,h){let g=document.createElementNS("http://www.w3.org/2000/svg",m);for(let v of Object.keys(s))g.setAttributeNS(null,v,String(s[v]));return h&&h.appendChild(g),g}A.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let me=typeof document<"u"?document.documentElement&&document.documentElement.style:null,he=me&&me.userSelect!==void 0?"userSelect":"WebkitUserSelect",be;function Ie(){me&&he&&(be=me[he],me[he]="none")}function Qe(){me&&he&&(me[he]=be)}function ze(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",ze,!0)}function nt(){window.addEventListener("click",ze,!0),window.setTimeout(()=>{window.removeEventListener("click",ze,!0)},0)}function ft(m,s){let h=m.getBoundingClientRect();return Yt(m,h,s)}function Ue(m,s){let h=m.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(Yt(m,h,s[v]));return g}function Nt(m){return window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function Yt(m,s,h){let g=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new r.P((h.clientX-s.left)*g,(h.clientY-s.top)*g)}class Jt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,h){this._updatedSourceCaches[s]=h,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){let h=s.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(s.id),this.setDirty()}removeLayer(s){let h=s.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][s.id]=s,this._updatedLayers[h].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){let s={};for(let h in this._updatedLayers)s[h]=s[h]||{},s[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)s[h]=s[h]||{},s[h].removedIds=Object.keys(this._removedLayers[h]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Et={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class tr{constructor(s,h,g,v,x,E){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=E,this.context=s;let S=s.gl;this.buffer=S.createBuffer(),s.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){let v=h.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],E=h.attributes[x.name];E!==void 0&&s.vertexAttribPointer(E,x.components,s[Et[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=h.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ct{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _r extends Ct{getDefault(){return r.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class br extends Ct{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class zr extends Ct{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class xn extends Ct{getDefault(){return[!0,!0,!0,!0]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class jo extends Ct{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class wt extends Ct{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class zt extends Ct{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){let h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Ht extends Ct{getDefault(){let s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class _n extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class kt extends Ct{getDefault(){return[0,1]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class li extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Qn extends Ct{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Zi extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class dr extends Ct{getDefault(){let s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Sa extends Ct{getDefault(){return r.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Pt extends Ct{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class Dr extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class zn extends Ct{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class ci extends Ct{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let cs=class extends Ct{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Vs extends Ct{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class au extends Ct{getDefault(){let s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class bl extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class wo extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Eo extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class lu extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Rt extends Ct{getDefault(){return null}set(s){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Lt extends Ct{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class wl extends Ct{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Bi extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Ca extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class El extends Ct{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Tl extends El{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class cu extends El{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class js extends El{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ia extends cu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Sl{constructor(s,h,g,v,x){this.context=s,this.width=h,this.height=g;let E=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new Tl(s,E)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new cu(s,E):new js(s,E))}destroy(){let s=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&s.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&s.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&s.deleteTexture(h)}s.deleteFramebuffer(this.framebuffer)}}class uu{constructor(s,h){this.gl=s,this.clearColor=new _r(this),this.clearDepth=new br(this),this.clearStencil=new zr(this),this.colorMask=new xn(this),this.depthMask=new jo(this),this.stencilMask=new wt(this),this.stencilFunc=new zt(this),this.stencilOp=new Ht(this),this.stencilTest=new _n(this),this.depthRange=new kt(this),this.depthTest=new li(this),this.depthFunc=new Qn(this),this.blend=new Zi(this),this.blendFunc=new dr(this),this.blendColor=new Sa(this),this.blendEquation=new Pt(this),this.cullFace=new Dr(this),this.cullFaceSide=new zn(this),this.frontFace=new ci(this),this.program=new cs(this),this.activeTexture=new Vs(this),this.viewport=new au(this),this.bindFramebuffer=new bl(this),this.bindRenderbuffer=new wo(this),this.bindTexture=new Eo(this),this.bindVertexBuffer=new lu(this),this.bindElementBuffer=new Rt(this),this.bindVertexArrayOES=new Lt(this),this.pixelStoreUnpack=new wl(this),this.pixelStoreUnpackPremultiplyAlpha=new Bi(this),this.pixelStoreUnpackFlipY=new Ca(this),this.options=h?vt({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h,g){return new r.I(this,s,h,g)}createVertexBuffer(s,h,g,v,x){return new tr(this,s,h,g,v,x)}createRenderbuffer(s,h,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),x}createFramebuffer(s,h,g,v){return new Sl(this,s,h,g,v)}clear({color:s,depth:h,stencil:g,colorMask:v}){let x=this.gl,E=0;s&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(E|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(E)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){w(s.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Cl{constructor(s){this._gl=s.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let s=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,s}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class Il{constructor(s){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,s.registerParameter(this,["Symbols"],"useOcclusionQueries"),s.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),s.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),s.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),s.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class oo{constructor(s,h,g,v){let x={width:g[0],height:g[1],data:null},E=s.gl;this.targetColorTexture=new r.T(s,x,E.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(s,x,E.RGBA,{useMipmap:!1}),this.context=s,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(s,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=h.width*h.height;this.particleTexture0=new r.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new r.S;x.reserve(v);for(let E=0;E<v;E++)x.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(x,r.p.members,!0),this.particleSegment=r.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=r.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Qh extends r.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,h){return r.l(this.requestManager.transformRequest(h,r.R.Model).url).then(g=>{if(!g)return;let v=r.c(g),x=new r.M(s,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new r.d(new Error(`Could not load model ${s} from ${h}: ${g.message}`)))})}load(s,h){this.models[h]||(this.models[h]={});let g=Object.keys(s);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,s[x]));Promise.allSettled(v).then(x=>{for(let E=0;E<x.length;E++){let{status:S,value:M}=x[E];S==="fulfilled"&&M&&(this.models[h][g[E]]={model:M,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new r.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new r.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,h){return!!this.getModel(s,h)}getModel(s,h){return this.models[h]||(this.models[h]={}),this.models[h][s]?this.models[h][s].model:void 0}addModel(s,h,g){this.models[g]||(this.models[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.load({[s]:this.requestManager.normalizeModelURL(h)},g)}addModels(s,h){this.models[h]||(this.models[h]={});let g={};for(let v in s)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(s[v]);this.load(g,h)}addModelsFromBucket(s,h){this.models[h]||(this.models[h]={});let g={};for(let v of s)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(s,h){if(this.models[h]&&this.models[h][s]&&(this.models[h][s].numReferences--,this.models[h][s].numReferences===0)){let g=this.models[h][s].model;delete this.models[h][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,h){this.models[h]||(this.models[h]={});for(let g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(s.context)}}function Ft(m){let{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class hu extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new r.i({width:1,height:1})}isLoaded(){for(let s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,h){if(this.loaded[h]!==s&&(this.loaded[h]=s,s)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(s,h){return!!this.getImage(s,h)}getImage(s,h){return this.images[h][s]}addImage(s,h,g){this._validate(s,g)&&(this.images[h][s]=g)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(let v of s){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h,g){g.version=this.images[h][s].version+1,this.images[h][s]=g,this.updatedImages[h][s]=!0}removeImage(s,h){let g=this.images[h][s];delete this.images[h][s],delete this.patterns[h][s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,h,g){let v=!0,x=!!this.loaded[h];if(!x)for(let E of s)this.images[h][E]||(v=!1);x||v?this._notify(s,h,g):this.requestors.push({ids:s,scope:h,callback:g})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,h,g){let v={};for(let x of s){this.images[h][x]||this.fire(new r.f("styleimagemissing",{id:x}));let E=this.images[h][x];E?v[x]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:r.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(s){let{width:h,height:g}=this.atlasImage[s];return{width:h,height:g}}getPattern(s,h,g){let v=this.patterns[h][s],x=this.getImage(s,h);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let E={w:x.data.width+2,h:x.data.height+2,x:0,y:0},S=new r.k(E,x);this.patterns[h][s]={bin:E,position:S}}return this._updatePatternAtlas(h,g),this.patterns[h][s].position}bind(s,h){let g=s.gl,v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new r.T(s,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,h){let g=[];for(let S in this.patterns[s])g.push(this.patterns[s][S].bin);let{w:v,h:x}=r.j(g),E=this.atlasImage[s];E.resize({width:v||1,height:x||1});for(let S in this.patterns[s]){let{bin:M}=this.patterns[s][S],P=M.x+1,k=M.y+1,N=this.images[s][S].data,B=N.width,V=N.height;r.i.copy(N,E,{x:0,y:0},{x:P,y:k},{width:B,height:V},h),r.i.copy(N,E,{x:0,y:V-1},{x:P,y:k-1},{width:B,height:1},h),r.i.copy(N,E,{x:0,y:0},{x:P,y:k+V},{width:B,height:1},h),r.i.copy(N,E,{x:B-1,y:0},{x:P-1,y:k},{width:1,height:V},h),r.i.copy(N,E,{x:0,y:0},{x:P+B,y:k},{width:1,height:V},h)}this.dirty=!0}beginFrame(){for(let s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,h){for(let g of s){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;let v=this.images[h][g];Ft(v)&&this.updateImage(g,h,v)}}}function xr(m){let s=m.key,h=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},x=m.style,E=m.styleSpec,S=[],M=r.n(h);if(M!=="object")return[new r.V(s,h,`object expected, ${M} found`)];for(let P in h){let k=P.split(".")[0],N;v[k]?N=v[k]:g[k]?N=$:v["*"]?N=v["*"]:g["*"]&&(N=$),N?S=S.concat(N({key:(s&&`${s}.`)+P,value:h[P],valueSpec:g[k]||g["*"],style:x,styleSpec:E,object:h,objectKey:P},h)):S.push(new r.m(s,h[P],`unknown property "${P}"`))}for(let P in g)v[P]||g[P].required&&g[P].default===void 0&&h[P]===void 0&&S.push(new r.V(s,h,`missing required property "${P}"`));return S}function Dl(m){let s=m.value,h=m.valueSpec,g=m.style,v=m.styleSpec,x=m.key,E=m.arrayElementValidator||$;if(r.n(s)!=="array")return[new r.V(x,s,`array expected, ${r.n(s)} found`)];if(h.length&&s.length!==h.length)return[new r.V(x,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new r.V(x,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let S={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(S.function=h.function),r.n(h.value)==="object"&&(S=h.value);let M=[];for(let P=0;P<s.length;P++)M=M.concat(E({array:s,arrayIndex:P,value:s[P],valueSpec:S,style:g,styleSpec:v,key:`${x}[${P}]`},!0));return M}function Da(m){let s=m.key,h=m.value,g=m.valueSpec,v=r.n(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new r.V(s,h,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(r.n(g.minimum)==="array"&&(x=g.minimum[m.arrayIndex]),h<x)return[new r.V(s,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(r.n(g.maximum)==="array"&&(x=g.maximum[m.arrayIndex]),h>x)return[new r.V(s,h,`${h} is greater than the maximum value ${x}`)]}return[]}function Uo(m){let s=m.valueSpec,h=r.u(m.value.type),g,v,x,E={},S=h!=="categorical"&&m.value.property===void 0,M=!S,P=r.n(m.value.stops)==="array"&&r.n(m.value.stops[0])==="array"&&r.n(m.value.stops[0][0])==="object",k=xr({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(V){if(h==="identity")return[new r.V(V.key,V.value,'identity function may not have a "stops" property')];let G=[],H=V.value;return G=G.concat(Dl({key:V.key,value:H,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),r.n(H)==="array"&&H.length===0&&G.push(new r.V(V.key,H,"array must have at least one stop")),G},default:function(V){return $({key:V.key,value:V.value,valueSpec:s,style:V.style,styleSpec:V.styleSpec})}}});return h==="identity"&&S&&k.push(new r.V(m.key,m.value,'missing required property "property"')),h==="identity"||m.value.stops||k.push(new r.V(m.key,m.value,'missing required property "stops"')),h==="exponential"&&m.valueSpec.expression&&!r.s(m.valueSpec)&&k.push(new r.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(M&&!r.q(m.valueSpec)?k.push(new r.V(m.key,m.value,"property functions not supported")):S&&!r.r(m.valueSpec)&&k.push(new r.V(m.key,m.value,"zoom functions not supported"))),h!=="categorical"&&!P||m.value.property!==void 0||k.push(new r.V(m.key,m.value,'"property" property is required')),k;function N(V){let G=[],H=V.value,q=V.key;if(r.n(H)!=="array")return[new r.V(q,H,`array expected, ${r.n(H)} found`)];if(H.length!==2)return[new r.V(q,H,`array length 2 expected, length ${H.length} found`)];if(P){if(r.n(H[0])!=="object")return[new r.V(q,H,`object expected, ${r.n(H[0])} found`)];if(H[0].zoom===void 0)return[new r.V(q,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new r.V(q,H,"object stop key must have value")];let W=r.u(H[0].zoom);if(typeof W!="number")return[new r.V(q,H[0].zoom,"stop zoom values must be numbers")];if(x&&x>W)return[new r.V(q,H[0].zoom,"stop zoom values must appear in ascending order")];W!==x&&(x=W,v=void 0,E={}),G=G.concat(xr({key:`${q}[0]`,value:H[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Da,value:B}}))}else G=G.concat(B({key:`${q}[0]`,value:H[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},H));return r.t(r.v(H[1]))?G.concat([new r.V(`${q}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat($({key:`${q}[1]`,value:H[1],valueSpec:s,style:V.style,styleSpec:V.styleSpec}))}function B(V,G){let H=r.n(V.value),q=r.u(V.value),W=V.value!==null?V.value:G;if(g){if(H!==g)return[new r.V(V.key,W,`${H} stop domain type must match previous stop domain type ${g}`)]}else g=H;if(H!=="number"&&H!=="string"&&H!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new r.V(V.key,W,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&h!=="categorical"){let ee=`number expected, ${H} found`;return r.q(s)&&h===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(V.key,W,ee)]}return h!=="categorical"||H!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?h!=="categorical"&&H==="number"&&typeof q=="number"&&typeof v=="number"&&v!==void 0&&q<v?[new r.V(V.key,W,"stop domain values must appear in ascending order")]:(v=q,h==="categorical"&&q in E?[new r.V(V.key,W,"stop domain values must be unique")]:(E[q]=!0,[])):[new r.V(V.key,W,`integer expected, found ${String(q)}`)]}}function $o(m){let s=(m.expressionContext==="property"?r.x:r.y)(r.v(m.value),m.valueSpec);if(s.result==="error")return s.value.map(g=>new r.V(`${m.key}${g.key}`,m.value,g.message));let h=s.value.expression||s.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!h.outputDefined())return[new r.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!r.z(h))return[new r.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return du(h,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!r.A(h,["zoom","feature-state"]))return[new r.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!r.B(h))return[new r.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function du(m,s){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(let v of s.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];let g=[];return m instanceof r.D&&h.has(m.name)?[new r.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(v=>{g.push(...du(v,s))}),g)}function Us(m){let s=m.key,h=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(r.u(h))===-1&&v.push(new r.V(s,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(r.u(h))===-1&&v.push(new r.V(s,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function $s(m){return r.G(r.v(m.value))?$o(r.o({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Ml(m)}function Ml(m){let s=m.value,h=m.key;if(r.n(s)!=="array")return[new r.V(h,s,`array expected, ${r.n(s)} found`)];let g=m.styleSpec,v,x=[];if(s.length<1)return[new r.V(h,s,"filter array must have at least 1 element")];switch(x=x.concat(Us({key:`${h}[0]`,value:s[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),r.u(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&r.u(s[1])==="$type"&&x.push(new r.V(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new r.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=r.n(s[1]),v!=="string"&&x.push(new r.V(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let E=2;E<s.length;E++)v=r.n(s[E]),r.u(s[1])==="$type"?x=x.concat(Us({key:`${h}[${E}]`,value:s[E],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new r.V(`${h}[${E}]`,s[E],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let E=1;E<s.length;E++)x=x.concat(Ml({key:`${h}[${E}]`,value:s[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=r.n(s[1]),s.length!==2?x.push(new r.V(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new r.V(`${h}[1]`,s[1],`string expected, ${v} found`))}return x}function Al(m,s){let h=m.key,g=m.style,v=m.layer,x=m.styleSpec,E=m.value,S=m.objectKey,M=x[`${s}_${m.layerType}`];if(!M)return[];let P=S.match(/^(.*)-transition$/);if(s==="paint"&&P&&M[P[1]]&&M[P[1]].transition)return $({key:h,value:E,valueSpec:x.transition,style:g,styleSpec:x});let k=m.valueSpec||M[S];if(!k)return[new r.m(h,E,`unknown property "${S}"`)];let N;if(r.n(E)==="string"&&r.q(k)&&!k.tokens&&(N=/^{([^}]+)}$/.exec(E))){let V=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new r.V(h,E,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}let B=[];if(m.layerType==="symbol")S!=="text-field"||!g||g.glyphs||g.imports||B.push(new r.V(h,E,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&r.H(r.v(E))&&r.u(E.type)==="identity"&&B.push(new r.V(h,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&s==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&r.q(k)&&(r.J(k)||r.r(k))){let V=r.x(r.v(E),k),G=V.value.expression||V.value._styleExpression.expression;G&&!r.A(G,["measure-light"])&&(S==="model-emissive-strength"&&r.B(G)&&r.z(G)||B.push(new r.V(h,E,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat($({key:m.key,value:E,valueSpec:k,style:g,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:S}))}function Jh(m){return Al(m,"paint")}function Pl(m){return Al(m,"layout")}function so(m){let s=[],h=m.value,g=m.key,v=m.style,x=m.styleSpec;h.type||h.ref||s.push(new r.V(g,h,'either "type" or "ref" is required'));let E=r.u(h.type),S=r.u(h.ref);if(h.id){let M=r.u(h.id);for(let P=0;P<m.arrayIndex;P++){let k=v.layers[P];r.u(k.id)===M&&s.push(new r.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${k.id.__line__}`))}}if("ref"in h){let M;["type","source","source-layer","filter","layout"].forEach(P=>{P in h&&s.push(new r.V(g,h[P],`"${P}" is prohibited for ref layers`))}),v.layers.forEach(P=>{r.u(P.id)===S&&(M=P)}),M?M.ref?s.push(new r.V(g,h.ref,"ref cannot reference another ref layer")):E=r.u(M.type):typeof S=="string"&&s.push(new r.V(g,h.ref,`ref layer "${S}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(h.source){let M=v.sources&&v.sources[h.source],P=M&&r.u(M.type);M?P==="vector"&&E==="raster"?s.push(new r.V(g,h.source,`layer "${h.id}" requires a raster source`)):P==="raster"&&E!=="raster"?s.push(new r.V(g,h.source,`layer "${h.id}" requires a vector source`)):P!=="vector"||h["source-layer"]?P==="raster-dem"&&E!=="hillshade"?s.push(new r.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(E)?E!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||P==="geojson"&&M.lineMetrics?E==="raster-particle"&&P!=="raster-array"&&s.push(new r.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):s.push(new r.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new r.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new r.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new r.V(g,h.source,`source "${h.source}" not found`))}else s.push(new r.V(g,h,'missing required property "source"'));return s=s.concat(xr({key:g,value:h,valueSpec:x.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:m.style,styleSpec:m.styleSpec,object:h,objectKey:"type"}),filter:M=>$s(r.o({layerType:E},M)),layout:M=>xr({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>Pl(r.o({layerType:E},P))}}),paint:M=>xr({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>Jh(r.o({layerType:E,layer:h},P))}})}})),s}function Gs(m){let s=m.value,h=m.key,g=r.n(s);return g!=="string"?[new r.V(h,s,`string expected, ${g} found`)]:[]}let ao={promoteId:function({key:m,value:s}){if(r.n(s)==="string")return Gs({key:m,value:s});{let h=[];for(let g in s)h.push(...Gs({key:`${m}.${g}`,value:s[g]}));return h}}};function Jr(m){let s=m.value,h=m.key,g=m.styleSpec,v=m.style;if(!s.type)return[new r.V(h,s,'"type" is required')];let x=r.u(s.type),E=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||E.push(new r.m(h,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(xr({key:h,value:s,valueSpec:g[`source_${x.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:ao})),E;case"geojson":if(E=xr({key:h,value:s,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:ao}),s.cluster)for(let S in s.clusterProperties){let[M,P]=s.clusterProperties[S],k=typeof M=="string"?[M,["accumulated"],["get",S]]:M;E.push(...$o({key:`${h}.${S}.map`,value:P,expressionContext:"cluster-map"})),E.push(...$o({key:`${h}.${S}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return E;case"video":return xr({key:h,value:s,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return xr({key:h,value:s,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new r.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Us({key:`${h}.type`,value:s.type,valueSpec:{values:ed(g)},style:v,styleSpec:g})}}function ed(m){return m.source.reduce((s,h)=>{let g=m[h];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values))),s},[])}function Ma(m){let s=m.value,h=m.styleSpec,g=h.light,v=m.style,x=[],E=r.n(s);if(s===void 0)return x;if(E!=="object")return x=x.concat([new r.V("light",s,`object expected, ${E} found`)]),x;for(let S in s){let M=S.match(/^(.*)-transition$/);x=x.concat(M&&g[M[1]]&&g[M[1]].transition?$({key:S,value:s[S],valueSpec:h.transition,style:v,styleSpec:h}):g[S]?$({key:S,value:s[S],valueSpec:g[S],style:v,styleSpec:h}):[new r.V(S,s[S],`unknown property "${S}"`)])}return x}function Rl(m){let s=m.value,h=[];if(!s)return h;let g=r.n(s);if(g!=="object")return h=h.concat([new r.V("light-3d",s,`object expected, ${g} found`)]),h;let v=m.styleSpec,x=v["light-3d"],E=m.key,S=m.style,M=m.style.lights;for(let N of["type","id"])if(!(N in s))return h=h.concat([new r.V("light-3d",s,`missing property ${N} on light`)]),h;if(s.type&&M)for(let N=0;N<m.arrayIndex;N++){let B=r.u(s.type),V=M[N];r.u(V.type)===B&&h.push(new r.V(E,s.id,`duplicate light type "${s.type}", previously defined at line ${V.id.__line__}`))}let P=`properties_light_${s.type}`;if(!(P in v))return h=h.concat([new r.V("light-3d",s,`Invalid light type ${s.type}`)]),h;let k=v[P];for(let N in s)if(N==="properties"){let B=s[N],V=r.n(B);if(V!=="object")return h=h.concat([new r.V("properties",B,`object expected, ${V} found`)]),h;for(let G in B)h=h.concat(k[G]?$({key:G,value:B[G],valueSpec:k[G],style:S,styleSpec:v}):[new r.m(m.key,B[G],`unknown property "${G}"`)])}else{let B=N.match(/^(.*)-transition$/);h=h.concat(B&&x[B[1]]&&x[B[1]].transition?$({key:N,value:s[N],valueSpec:v.transition,style:S,styleSpec:v}):x[N]?$({key:N,value:s[N],valueSpec:x[N],style:S,styleSpec:v}):[new r.m(N,s[N],`unknown property "${N}"`)])}return h}function fu(m){let s=m.value,h=m.key,g=m.style,v=m.styleSpec,x=v.terrain,E=[],S=r.n(s);if(s===void 0||S==="null")return E;if(S!=="object")return E=E.concat([new r.V("terrain",s,`object expected, ${S} found`)]),E;for(let M in s){let P=M.match(/^(.*)-transition$/);E=E.concat(P&&x[P[1]]&&x[P[1]].transition?$({key:M,value:s[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?$({key:M,value:s[M],valueSpec:x[M],style:g,styleSpec:v}):[new r.m(M,s[M],`unknown property "${M}"`)])}if(s.source){let M=g.sources&&g.sources[s.source],P=M&&r.u(M.type);M?P!=="raster-dem"&&E.push(new r.V(h,s.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):E.push(new r.V(h,s.source,`source "${s.source}" not found`))}else E.push(new r.V(h,s,'terrain is missing required property "source"'));return E}function Ol(m){let s=m.value,h=m.style,g=m.styleSpec,v=g.fog,x=[],E=r.n(s);if(s===void 0)return x;if(E!=="object")return x=x.concat([new r.V("fog",s,`object expected, ${E} found`)]),x;for(let S in s){let M=S.match(/^(.*)-transition$/);x=x.concat(M&&v[M[1]]&&v[M[1]].transition?$({key:S,value:s[S],valueSpec:g.transition,style:h,styleSpec:g}):v[S]?$({key:S,value:s[S],valueSpec:v[S],style:h,styleSpec:g}):[new r.m(S,s[S],`unknown property "${S}"`)])}return x}let ye={"*":()=>[],array:Dl,boolean:function(m){let s=m.value,h=m.key,g=r.n(s);return g!=="boolean"?[new r.V(h,s,`boolean expected, ${g} found`)]:[]},number:Da,color:function(m){let s=m.key,h=m.value,g=r.n(h);return g!=="string"?[new r.V(s,h,`color expected, ${g} found`)]:r.F(h)===null?[new r.V(s,h,`color expected, "${h}" found`)]:[]},enum:Us,filter:$s,function:Uo,layer:so,object:xr,source:Jr,model:r.K,light:Ma,"light-3d":Rl,terrain:fu,fog:Ol,string:Gs,formatted:function(m){return Gs(m).length===0?[]:$o(m)},resolvedImage:function(m){return Gs(m).length===0?[]:$o(m)},projection:function(m){let s=m.value,h=m.styleSpec,g=h.projection,v=m.style,x=[],E=r.n(s);if(E==="object")for(let S in s)x=x.concat($({key:S,value:s[S],valueSpec:g[S],style:v,styleSpec:h}));else E!=="string"&&(x=x.concat([new r.V("projection",s,`object or string expected, ${E} found`)]));return x},import:function(m){let{value:s,styleSpec:h}=m,E=s,{data:g}=E,v=ns(E,["data"]);Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let x=xr(r.o({},m,{value:v,valueSpec:h.import}));return r.u(v.id)===""&&x.push(new r.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(oe(g,h,{key:`${m.key}.data`}))),x}};function $(m,s=!1){let h=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&r.H(r.u(h)))return Uo(m);if(g.expression&&r.t(r.v(h)))return $o(m);if(g.type&&ye[g.type]){let x=ye[g.type](m);return s===!0&&x.length>0&&r.n(m.value)==="array"?$o(m):x}return xr(r.o({},m,{valueSpec:g.type?v[g.type]:g}))}function Z(m){let s=m.value,h=m.key,g=Gs(m);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new r.V(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new r.V(h,s,'"glyphs" url must include a "{range}" token'))),g}function oe(m,s=r.L,h={}){return $({key:h.key||"",value:m,valueSpec:s.$root,styleSpec:s,style:m,objectElementValidators:{glyphs:Z,"*":()=>[]}})}function de(m,s=r.L){return en(oe(m,s))}let fe=m=>en(Jr(m)),we=m=>en(Ma(m)),Ae=m=>en(Rl(m)),ve=m=>en(fu(m)),Pe=m=>en(Ol(m)),rt=m=>en(so(m)),Ke=m=>en($s(m)),_t=m=>en(Jh(m)),Mt=m=>en(Pl(m)),Kt=m=>en(r.K(m));function en(m){return m.slice().sort((s,h)=>s.line&&h.line?s.line-h.line:0)}function jt(m,s){let h=!1;if(s&&s.length)for(let g of s)g instanceof r.m?r.w(g.message):(m.fire(new r.d(new Error(g.message))),h=!0);return h}let an=new r.N({anchor:new r.O(r.L.light.anchor),position:new r.Q(r.L.light.position),color:new r.O(r.L.light.color),intensity:new r.O(r.L.light.intensity)});class mt extends r.E{constructor(s,h="flat"){super(),this._transitionable=new r.U(an),this.setLight(s,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h,g={}){this._validate(we,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=h)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&jt(this,s.call(de,r.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}let rr=new r.N({source:new r.O(r.L.terrain.source),exaggeration:new r.O(r.L.terrain.exaggeration)}),Nn=class extends r.E{constructor(m,s,h,g){super(),this.scope=h,this._transitionable=new r.U(rr,h,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new r.X(m)).get("exaggeration")}isZoomDependent(){let m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof r.Z}},pn=45,Tr=65,ir=.05;function Rr(m,s,h,g){let v=r.$(pn,Tr,h),[x,E]=ui(m,g),S=1-Math.min(1,Math.exp((s-x)/(E-x)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*v*m.alpha}function ui(m,s){let h=.5/Math.tan(.5*s);return[m.range[0]+h,m.range[1]+h]}function hi(m,s,h,g,v){let x=r._.transformMat4([],[s,h,g],v.mercatorFogMatrix);return Rr(m,r._.length(x),v.pitch,v._fov)}function Aa(m,s,h,g,v,x,E){let S=[[h,g,0],[v,g,0],[v,x,0],[h,x,0]],M=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let k of S){let N=r._.transformMat4([],k,s),B=r._.length(N);M=Math.min(M,B),P=Math.max(P,B)}return[Rr(m,M,E.pitch,E._fov),Rr(m,P,E.pitch,E._fov)]}let vp=new r.N({range:new r.O(r.L.fog.range),color:new r.O(r.L.fog.color),"high-color":new r.O(r.L.fog["high-color"]),"space-color":new r.O(r.L.fog["space-color"]),"horizon-blend":new r.O(r.L.fog["horizon-blend"]),"star-intensity":new r.O(r.L.fog["star-intensity"]),"vertical-range":new r.O(r.L.fog["vertical-range"])});class B_ extends r.E{constructor(s,h,g,v){super(),this._transitionable=new r.U(vp,g,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new r.a0(vp),this.scope=g}get state(){let s=this._transform,h=s.projection.name==="globe",g=r.a1(s.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[r.a2(x[0],v[0],g),r.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h,g={}){if(this._validate(Pe,s,g))return;let v=r.W({},s);for(let x of Object.keys(r.L.fog))v[x]===void 0&&(v[x]=r.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.$(pn,Tr,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,v,x){let E=r.Y.fromLngLat(v),S=x.elevation?x.elevation.getAtPointOrZero(E):0;return hi(g,E.x,E.y,S,x)}(this.state,s,h):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Aa(this.state,h,0,0,r.a3,r.a3,this._transform)}getOpacityForBounds(s,h,g,v,x){return this._transform.projection.supportsFog?Aa(this.state,s,h,g,v,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?ui(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let g of h){let v=s.points[g],x;if(v[2]>=0)x=v;else{let E=s.points[g-4];x=r.a4(E,v,E[2]/(E[2]-v[2]))}if(hi(this.state,x[0],x[1],0,this._transform)>=ir)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&jt(this,s.call(de,r.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}class pu extends r.E{constructor(s,h,g,v){super(),this.scope=g,this._options=s,this.properties=new r.a0(h),this._transitionable=new r.U(h,g,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,h){this._options=s,this._transitionable.setTransitionOrValue(s.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Zt=new r.N({color:new r.O(r.L.properties_light_ambient.color),intensity:new r.O(r.L.properties_light_ambient.intensity)}),xp=new r.N({direction:new r.a5(r.L.properties_light_directional.direction),color:new r.O(r.L.properties_light_directional.color),intensity:new r.O(r.L.properties_light_directional.intensity),"cast-shadows":new r.O(r.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.O(r.L.properties_light_directional["shadow-intensity"])});var Hs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,bp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,wp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ep="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Tp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Sp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Cp=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ip=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Dp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Mp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,V_=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let kl=[];Ll(Hs,kl),Ll(wp,kl),Ll(bp,kl);let td={"_prelude_fog.vertex.glsl":Sp,"_prelude_terrain.vertex.glsl":Tp,"_prelude_shadow.vertex.glsl":Mp,"_prelude_fog.fragment.glsl":Cp,"_prelude_shadow.fragment.glsl":V_,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ip,"_prelude_raster_particle.glsl":Dp},nd={};rn("",Tp),rn(Cp,Sp),rn(V_,Mp),rn(Ip,""),rn(Dp,"");let j_=rn(bp,wp),U_=Hs;var $_={background:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:rn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:rn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:rn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:rn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:rn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:rn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:rn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:rn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:rn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:rn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:rn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:rn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:rn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:rn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:rn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:rn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ep),skyboxGradient:rn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ep),skyboxCapture:rn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:rn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:rn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:rn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ll(m,s){let h=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)s.includes(x)||s.push(x)}}function rn(m,s){let h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(P=>{let k=P.split(" ");return k[k.length-1]}),v=[...new Set(v)]);let x={},E=[],S=[];if(m=m.replace(h,(P,k)=>(S.push(k),"")),(s=s.replace(h,(P,k)=>(E.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...kl];Ll(m,M),Ll(s,M);for(let P of[...E,...S])td[P]||console.error(`Undefined include: ${P}`),nd[P]||(nd[P]=[],Ll(td[P],nd[P])),M=[...M,...nd[P]];return{fragmentSource:m=m.replace(g,(P,k,N,B,V)=>(x[V]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = u_${V};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} ${V};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(g,(P,k,N,B,V)=>{let G=B==="float"?"vec2":B,H=V.match(/color/)?"color":G;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${N} ${B} a_${V};
#endif
`:x[V]?k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
out ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} a_${V};
    out ${N} ${B} ${V};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${N} ${B} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${N} ${B} ${V} = a_${V};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:v,usedDefines:M,vertexIncludes:E,fragmentIncludes:S}}class U1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,v,x,E,S,M){this.context=s;let P=this.boundPaintVertexBuffers.length!==v.length;for(let N=0;!P&&N<v.length;N++)this.boundPaintVertexBuffers[N]!==v[N]&&(P=!0);let k=this.boundDynamicVertexBuffers.length!==S.length;for(let N=0;!k&&N<S.length;N++)this.boundDynamicVertexBuffers[N]!==S[N]&&(k=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||P||k||this.boundIndexBuffer!==x||this.boundVertexOffset!==E)this.freshBind(h,g,v,x,E,S,M);else{s.bindVertexArrayOES.set(this.vao);for(let N of S)N&&(N.bind(),M&&N.instanceCount&&N.setVertexAttribDivisor(s.gl,h,M));x&&x.dynamicDraw&&x.bind()}}freshBind(s,h,g,v,x,E,S){let M=s.numAttributes,P=this.context,k=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=E,h.enableAttributes(k,s),h.bind(),h.setVertexAttribPointers(k,s,x);for(let N of g)N.enableAttributes(k,s),N.bind(),N.setVertexAttribPointers(k,s,x);for(let N of E)N&&(N.enableAttributes(k,s),N.bind(),N.setVertexAttribPointers(k,s,x),S&&N.instanceCount&&N.setVertexAttribDivisor(k,s,S));v&&v.bind(),P.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $1(m,s){let h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new r.Y(0,g/h).toLngLat().lat,new r.Y(0,(g+1)/h).toLngLat().lat]}function G1(m,s,h,g,v,x,E){let S=m.context,M=S.gl,P=h.hillshadeFBO;if(!P)return;m.prepareDrawTile();let k=m.isTileAffectedByFog(s),N=m.getOrCreateProgram("hillshade",{overrideFog:k});S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get());let B=((q,W,ee,te)=>{let ne=ee.paint.get("hillshade-shadow-color"),ue=ee.paint.get("hillshade-highlight-color"),ce=ee.paint.get("hillshade-accent-color"),J=ee.paint.get("hillshade-emissive-strength"),re=r.ab(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")re-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let ge=q.style.directionalLight.properties.get("direction"),Se=r.ac(ge.x,ge.y,ge.z);re=r.ab(Se[1])}let ie=!q.options.moving;return{u_matrix:te||q.transform.calculateProjMatrix(W.tileID.toUnwrapped(),ie),u_image:0,u_latrange:$1(0,W.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),re],u_shadow:ne.toRenderColor(ee.lut),u_highlight:ue.toRenderColor(ee.lut),u_emissive_strength:J,u_accent:ce.toRenderColor(ee.lut)}})(m,h,g,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(S,N,s.toUnwrapped());let{tileBoundsBuffer:V,tileBoundsIndexBuffer:G,tileBoundsSegments:H}=m.getTileBoundsBuffers(h);N.draw(m,M.TRIANGLES,v,x,E,r.af.disabled,B,g.id,V,G,H)}function Ap(m,s,h){if(!s.needsDEMTextureUpload)return;let g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(h.stride);let x=h.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new r.T(g,x,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Go(m,s,h){let g=m.context,v=g.gl;if(!s.dem)return;let x=s.dem;if(g.activeTexture.set(v.TEXTURE1),Ap(m,s,x),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let E=x.dim;g.activeTexture.set(v.TEXTURE0);let S=s.hillshadeFBO;if(!S){let B=new r.T(g,{width:E,height:E,data:null},v.RGBA);B.bind(v.LINEAR,v.CLAMP_TO_EDGE),S=s.hillshadeFBO=g.createFramebuffer(E,E,!0,"renderbuffer"),S.colorAttachment.set(B.texture)}g.bindFramebuffer.set(S.framebuffer),g.viewport.set([0,0,E,E]);let{tileBoundsBuffer:M,tileBoundsIndexBuffer:P,tileBoundsSegments:k}=m.getMercatorTileBoundsBuffers(),N=[];m.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(m,v.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,((B,V)=>{let G=V.stride,H=r.ad.create();return r.ad.ortho(H,0,r.a3,-r.a3,0,0,1),r.ad.translate(H,H,[0,-r.a3,0]),{u_matrix:H,u_image:1,u_dimension:[G,G],u_zoom:B.overscaledZ}})(s.tileID,x),h.id,M,P,k),s.needsHillshadePrepare=!1}function Pp(m,s,h,g,v){let x=function(E,S){if(E)return v(E);if(S){if(m.url&&S.tiles&&m.tiles&&delete m.tiles,S.variants){if(!Array.isArray(S.variants))return v(new Error("variants must be an array"));for(let P of S.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return v(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){S=r.W(S,P);break}}}let M=r.ah(r.W(S,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(M.vectorLayers=S.vector_layers,M.vectorLayerIds=M.vectorLayers.map(P=>P.id)),S.raster_layers&&(M.rasterLayers=S.raster_layers,M.rasterLayerIds=M.rasterLayers.map(P=>P.id)),M.tiles=s.canonicalizeTileset(M,m.url),v(null,M)}};return m.url?r.g(s.transformRequest(s.normalizeSourceURL(m.url,null,h,g),r.R.Source),x):r.e.frame(()=>x(null,m))}class mu{constructor(s,h,g){this.bounds=r.ai.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){let h=Math.pow(2,s.z),g=Math.floor(r.aj(this.bounds.getWest())*h),v=Math.floor(r.ak(this.bounds.getNorth())*h),x=Math.ceil(r.aj(this.bounds.getEast())*h),E=Math.ceil(r.ak(this.bounds.getSouth())*h);return s.x>=g&&s.x<x&&s.y>=v&&s.y<E}}class gu extends r.E{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.W({type:"raster"},h),r.W(this,r.ah(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Pp(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new r.d(h)):g&&(r.W(this,g),g.bounds&&(this.tileBounds=new mu(g.bounds,this.minzoom,this.maxzoom)),r.an(g.tiles),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){let g=r.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=r.h(this.map._requestManager.transformRequest(v,r.R.Tile),(x,E,S,M)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):x?(s.state="errored",h(x)):E?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:S,expires:M}),s.setTexture(E,this.map.painter),s.state="loaded",r.am(this.dispatcher),void h(null)):h(null)))}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h&&h()}unloadTile(s,h){s.texture&&s.texture instanceof r.T?(s.destroy(!0),s.texture&&s.texture instanceof r.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rd extends r.E{constructor(s,h,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.W(this,r.ah(h,["url","scheme","tileSize","promoteId"])),this._options=r.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.ao}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Pp(this._options,this.map._requestManager,h,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new r.d(v))):x&&(r.W(this,x),x.bounds&&(this.tileBounds=new mu(x.bounds,this.minzoom,this.maxzoom)),r.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,E={request:v,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(E.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",E,S.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",E,S.bind(this),void 0,!0);else{let M=r.ap.call({deduped:this._deduped},E,(P,k)=>{P||!k?S.call(this,P):(E.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},s.actor&&s.actor.send("loadTile",E,S.bind(this),void 0,!0))},!0);s.request={cancel:M}}function S(M,P){return delete s.request,s.aborted?h(null):M&&M.status!==404?h(M):(P&&P.resourceTiming&&(s.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&s.setExpiryData(P),s.loadVectorData(P,this.map.painter),r.am(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Pa=m=>({u_matrix:new r.a6(m),u_image0:new r.a7(m),u_skirt_height:new r.aa(m),u_ground_shadow_factor:new r.aq(m)}),lt=(m,s,h)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:h}),G_=(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:E,u_frustum_tr:S,u_frustum_br:M,u_frustum_bl:P,u_globe_pos:k,u_globe_radius:N,u_viewport:B,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:G});class _u{constructor(s=0,h=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=v}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=r.a2(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=r.a2(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=r.a2(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=r.a2(s.right,h.right,g)),this}getCenter(s,h){let g=r.at((this.left+s-this.right)/2,0,s),v=r.at((this.top+h-this.bottom)/2,0,h);return new r.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new _u(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ln(m,s){let h=r.aw(m,3);r.ad.fromQuat(m,s),r.az(m,3,h)}function di(m,s){let h=r.av.identity([]);return r.av.rotateZ(h,h,-s),r.av.rotateX(h,h,-m),h}function H_(m,s){let h=[m[0],m[1],0],g=[s[0],s[1],0];if(r._.length(h)>=1e-15){let E=r._.normalize([],h);r._.scale(g,E,r._.dot(g,E)),s[0]=g[0],s[1]=g[1]}let v=r._.cross([],s,m);if(r._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return di(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),x)}class Rp{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){let h=s instanceof r.Y?s:new r.Y(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=r.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.Y.fromLngLat(s)):0,x=r.Y.fromLngLat(s,v),E=[x.x-g.x,x.y-g.y,x.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=H_(E,h)}setPitchBearing(s,h){this.orientation=di(r.ab(s),r.ab(-h))}}class yu{constructor(s,h){this._transform=r.ad.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){let s=this.position;return new r.Y(s[0],s[1],s[2])}get position(){let s=r.aw(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&r.az(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||r.av.identity([]),s&&ln(this._transform,this._orientation)}getPitchBearing(){let s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=di(s,h),ln(this._transform,this._orientation)}forward(){let s=r.aw(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){let s=r.aw(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){let s=r.aw(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){let g=new Float64Array(16);return r.ad.invert(g,this.getWorldToCamera(s,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,h,g){let v=this.position;r._.scale(v,v,-s);let x=new Float64Array(16);return r.ad.fromScaling(x,[g,g,g]),r.ad.translate(x,x,v),x[10]*=h,x}getWorldToCamera(s,h){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return r.av.conjugate(v,this._orientation),r._.scale(x,x,-s),r.ad.fromQuat(g,v),r.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,v){let x=new Float64Array(16);return r.ad.perspective(x,s,h,g,v),x}getCameraToClipOrthographic(s,h,g,v,x,E){let S=new Float64Array(16);return r.ad.ortho(S,s,h,g,v,x,E),S}getDistanceToElevation(s,h=!1){let g=s===0?0:r.ax(s,h?r.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new yu([...this.position],[...this.orientation])}}let Fl={unknown:0,flipRequired:1,flipNotRequired:2},Qt=Math.tan(85*Math.PI/180);function Ra(m,s,h,g,v,x,E){let S=r.ad.create();if(h)if(x.name==="globe"){let M=r.aB(v,s);r.ad.multiply(S,S,M)}else{let M=r.aC.invert([],E);S[0]=M[0],S[1]=M[1],S[4]=M[2],S[5]=M[3],g||r.ad.rotateZ(S,S,v.angle)}else r.ad.multiply(S,v.labelPlaneMatrix,m);return S}function Oa(m,s,h,g,v,x,E){let S=Ra(m,s,h,g,v,x,E);return x.name==="globe"&&h||(S[2]=S[6]=S[10]=S[14]=0),S}function Nl(m,s,h,g,v,x,E){if(h){if(x.name==="globe"){let S=Ra(m,s,h,g,v,x,E);return r.ad.invert(S,S),r.ad.multiply(S,m,S),S}{let S=r.ad.clone(m),M=r.ad.identity([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],r.ad.multiply(S,S,M),g||r.ad.rotateZ(S,S,-v.angle),S}}return v.glCoordMatrix}function lo(m,s,h,g){let v=[m,s,h,1];h?r.aA.transformMat4(v,v,g):Ho(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function fi(m,s){return Math.min(.5+m/s*.5,1.5)}function H1(m,s){let h=m[0]/m[3],g=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function id(m,s,h,g,v,x,E,S,M,P){let k=h.transform,N=g?m.textSizeData:m.iconSizeData,B=r.aD(N,h.transform.zoom),V=k.projection.name==="globe",G=[256/h.width*2+1,256/h.height*2+1],H=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();let q=null;V&&(q=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);let W=m.lineVertexArray,ee=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,te=h.transform.width/h.transform.height,ne,ue=!1;for(let ce=0;ce<ee.length;ce++){let J=ee.get(ce),{numGlyphs:re,writingMode:ie}=J;if(ie!==r.aE.vertical||ue||ne===r.aE.horizontal||(ue=!0),ne=ie,(J.hidden||ie===r.aE.vertical)&&!ue){ka(re,H);continue}ue=!1;let ge=new r.P(J.tileAnchorX,J.tileAnchorY),{x:Se,y:ae,z:Ce}=k.projection.projectTilePoint(ge.x,ge.y,P.canonical);if(M){let[at,je,He]=M(ge);Se+=at,ae+=je,Ce+=He}let Me=[Se,ae,Ce,1];if(r.aA.transformMat4(Me,Me,s),!H1(Me,G)){ka(re,H);continue}let $e=Me[3],Ge=fi(h.transform.getCameraToCenterDistance(k.projection),$e),Ve=r.aF(N,B,J),xe=E?Ve/Ge:Ve*Ge,Re=lo(Se,ae,Ce,v);if(Re[3]<=0){ka(re,H);continue}let Fe={},ot=E?null:M,ct=kp(J,xe,!1,S,s,v,x,m.glyphOffsetArray,W,H,q,Re,ge,Fe,te,ot,k.projection,P,E);ue=ct.useVertical,ot&&ct.needsFlipping&&(Fe={}),(ct.notEnoughRoom||ue||ct.needsFlipping&&kp(J,xe,!0,S,s,v,x,m.glyphOffsetArray,W,H,q,Re,ge,Fe,te,ot,k.projection,P,E).notEnoughRoom)&&ka(re,H)}g?(m.text.dynamicLayoutVertexBuffer.updateData(H),q&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(q)):(m.icon.dynamicLayoutVertexBuffer.updateData(H),q&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(q))}function od(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H){let{lineStartIndex:q,glyphStartIndex:W,segment:ee}=S,te=W+S.numGlyphs,ne=q+S.lineLength,ue=s.getoffsetX(W),ce=s.getoffsetX(te-1),J=zl(m*ue,h,g,v,x,E,ee,q,ne,M,P,k,N,B,!0,V,G,H);if(!J)return null;let re=zl(m*ce,h,g,v,x,E,ee,q,ne,M,P,k,N,B,!0,V,G,H);return re?{first:J,last:re}:null}function Op(m,s,h,g){return m===r.aE.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:m===r.aE.vertical?g>0?{needsFlipping:!0}:null:s!==Fl.unknown&&function(v,x){return v===0||Math.abs(x/v)>Qt}(h,g)?s===Fl.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function kp(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q,W,ee){let te=s/24,ne=m.lineOffsetX*te,ue=m.lineOffsetY*te,{lineStartIndex:ce,glyphStartIndex:J,numGlyphs:re,segment:ie,writingMode:ge,flipState:Se}=m,ae=ce+m.lineLength,Ce=Me=>{if(k){let[xe,Re,Fe]=Me.up,ot=P.length;r.aG(k,ot+0,xe,Re,Fe),r.aG(k,ot+1,xe,Re,Fe),r.aG(k,ot+2,xe,Re,Fe),r.aG(k,ot+3,xe,Re,Fe)}let[$e,Ge,Ve]=Me.point;r.aH(P,$e,Ge,Ve,Me.angle)};if(re>1){let Me=od(te,S,ne,ue,h,N,B,m,M,x,V,H,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};if(g&&!h){let[$e,Ge,Ve]=Me.first.point,[xe,Re,Fe]=Me.last.point;[$e,Ge]=lo($e,Ge,Ve,E),[xe,Re]=lo(xe,Re,Fe,E);let ot=Op(ge,Se,(xe-$e)*G,Re-Ge);if(m.flipState=ot&&ot.needsFlipping?Fl.flipRequired:Fl.flipNotRequired,ot)return ot}Ce(Me.first);for(let $e=J+1;$e<J+re-1;$e++){let Ge=zl(te*S.getoffsetX($e),ne,ue,h,N,B,ie,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Ge)return P.length-=4*($e-J),{notEnoughRoom:!0};Ce(Ge)}Ce(Me.last)}else{if(g&&!h){let $e=lo(B.x,B.y,0,v),Ge=ce+ie+1,Ve=new r.P(M.getx(Ge),M.gety(Ge)),xe=lo(Ve.x,Ve.y,0,v),Re=xe[3]>0?xe:vu(B,Ve,$e,1,v,void 0,q,W.canonical),Fe=Op(ge,Se,(Re[0]-$e[0])*G,Re[1]-$e[1]);if(m.flipState=Fe&&Fe.needsFlipping?Fl.flipRequired:Fl.flipNotRequired,Fe)return Fe}let Me=zl(te*S.getoffsetX(J),ne,ue,h,N,B,ie,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};Ce(Me)}return{}}function sd(m,s,h,g,v){let{x,y:E,z:S}=g.projectTilePoint(m.x,m.y,s);if(!v)return lo(x,E,S,h);let[M,P,k]=v(m);return lo(x+M,E+P,S+k,h)}function vu(m,s,h,g,v,x,E,S){let M=sd(m.sub(s)._unit()._add(m),S,v,E,x);return r._.sub(M,h,M),r._.normalize(M,M),r._.scaleAndAdd(M,h,M,g)}function zl(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q,W){let ee=g?m-s:m+s,te=ee>0?1:-1,ne=0;g&&(te*=-1,ne=Math.PI),te<0&&(ne+=Math.PI);let ue=S+E+(te>0?0:1)|0,ce=v,J=v,re=0,ie=0,ge=Math.abs(ee),Se=[],ae=[],Ce=x,Me=Ce,$e=()=>vu(Me,Ce,J,ge-re+1,k,B,H,q.canonical);for(;re+ie<=ge;){if(ue+=te,ue<S||ue>=M)return null;if(J=ce,Me=Ce,Se.push(J),V&&ae.push(Me),Ce=new r.P(P.getx(ue),P.gety(ue)),ce=N[ue],!ce){let je=sd(Ce,q.canonical,k,H,B);ce=je[3]>0?N[ue]=je:$e()}re+=ie,ie=r._.distance(J,ce)}G&&B&&(N[ue]&&(ce=$e(),ie=r._.distance(J,ce)),N[ue]=ce);let Ge=(ge-re)/ie,Ve=Ce.sub(Me)._mult(Ge)._add(Me),xe=r._.sub([],ce,J),Re=r._.scaleAndAdd([],J,xe,Ge),Fe=[0,0,1],ot=xe[0],ct=xe[1];if(W&&(Fe=H.upVector(q.canonical,Ve.x,Ve.y),Fe[0]!==0||Fe[1]!==0||Fe[2]!==1)){let je=[Fe[2],0,-Fe[0]],He=r._.cross([],Fe,je);r._.normalize(je,je),r._.normalize(He,He),ot=r._.dot(xe,je),ct=r._.dot(xe,He)}if(h){let je=r._.cross([],Fe,xe);r._.normalize(je,je),r._.scaleAndAdd(Re,Re,je,h*te)}let at=ne+Math.atan2(ct,ot);return Se.push(Re),V&&ae.push(Ve),{point:Re,angle:at,path:Se,tilePath:ae,up:Fe}}function ka(m,s){let h=s.length,g=h+4*m;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function Ho(m,s,h){let g=s[0],v=s[1];return m[0]=h[0]*g+h[4]*v+h[12],m[1]=h[1]*g+h[5]*v+h[13],m[3]=h[3]*g+h[7]*v+h[15],m}let Lp=(m,s,h)=>(1-h)*m+h*s,Sr=m=>m*m*m*m*m;class qo{constructor(s,h,g,v,x,E,S){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new r.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _u,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new yu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let s=new qo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,h=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return r.ah(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=r.aJ(this.projectionOptions);let g=!w(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){let s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.aJ({name:"mercator"});let h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.au(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){let h=-s*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=r.aC.create(),r.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){let h=r.at(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=r.ab(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){let h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){let s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let E=0;E<h.length;E++){let S=new r.P(h[E][0]*this.width,g+h[E][1]*(this.height-g)),M=s.pointCoordinate(S);if(!M)continue;let P=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);v+=M[3]*P,x+=P}return x===0?NaN:v/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude())),g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];let v=r._.length(r._.sub([],this._camera.position,g));return r.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!r.av.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){let g=[s.position.x,s.position.y,s.position.z];r._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let s=this._camera.position,h=new Rp;return h.position=new r.Y(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!r.av.length(s))return!1;r.av.normalize(s,s);let h=r._.transformQuat([],[0,0,-1],s),g=r._.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;let v=H_(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){let h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=r.at(s[2],v/g,v/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){let h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){let h=[new r.aK(0,s)];if(this.renderWorldCopies){let g=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),E=this.pointCoordinate(new r.P(0,this.height)),S=Math.floor(Math.min(g.x,v.x,x.x,E.x)),M=Math.floor(Math.max(g.x,v.x,x.x,E.x)),P=1;for(let k=S-P;k<=M+P;k++)k!==0&&h.push(new r.aK(k,s))}return h}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(s,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(let E of s){let S=E.canonical,M=E.overscaledZ,P=E.wrap,k=1<<S.z,N=S.x+1<k,B=S.x>0,V=S.y+1<k,G=S.y>0,H=E.wrap-(B?0:1),q=E.wrap+(N?0:1),W=B?S.x-1:k-1,ee=N?S.x+1:0;h[0]<0?(v.push(new r.aL(M,q,S.z,ee,S.y)),h[1]<0&&V&&(v.push(new r.aL(M,P,S.z,S.x,S.y+1)),v.push(new r.aL(M,q,S.z,ee,S.y+1))),h[1]>0&&G&&(v.push(new r.aL(M,P,S.z,S.x,S.y-1)),v.push(new r.aL(M,q,S.z,ee,S.y-1)))):h[0]>0?(v.push(new r.aL(M,H,S.z,W,S.y)),h[1]<0&&V&&(v.push(new r.aL(M,P,S.z,S.x,S.y+1)),v.push(new r.aL(M,H,S.z,W,S.y+1))),h[1]>0&&G&&(v.push(new r.aL(M,P,S.z,S.x,S.y-1)),v.push(new r.aL(M,H,S.z,W,S.y-1)))):h[1]<0&&V?v.push(new r.aL(M,P,S.z,S.x,S.y+1)):G&&v.push(new r.aL(M,P,S.z,S.x,S.y-1))}if(v.length>1){v.sort((M,P)=>M.overscaledZ-P.overscaledZ||M.wrap-P.wrap||M.canonical.z-P.canonical.z||M.canonical.x-P.canonical.x||M.canonical.y-P.canonical.y);let E=0,S=0;for(;S<v.length;)v[S].equals(v[E])?++S:v[++E]=v[S++];v.length=E+1}let x=[];for(let E of v)v.some(S=>E.isChildOf(S))||x.push(E);return v=x.filter(E=>!s.some(S=>!!(E.overscaledZ<g&&S.isChildOf(E))||E.equals(S)||E.isChildOf(S))),v}coveringTiles(s){let h=this.coveringZoomLevel(s),g=h,v=this.elevation&&this.elevation.exaggeration(),x=v&&!s.isTerrainDEM,E=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);let S=this.locationCoordinate(this.center),M=this.center.lat,P=1<<h,k=[P*S.x,P*S.y,0],N=this.projection.name==="globe",B=!N,V=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,B),G=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=P*r.ax(1,this.center.lat),q=this._camera.position[2]/r.ax(1,this.center.lat),W=[P*G.x,P*G.y,q*(B?1:H)],ee=N||v,te=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ne=this.isLODDisabled(!0)?h:0,ue;if(this._elevation&&s.isTerrainDEM)ue=1e4*this._elevation.exaggeration();else if(this._elevation){let xe=this._elevation.getMinMaxForVisibleTiles();ue=xe?xe.max:this._centerAltitude}else ue=this._centerAltitude;let ce=s.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,J=this.projection.isReprojectedInTileSpace?r.aN(this):1,re=xe=>{let Fe=new r.Y(xe.x+25e-6,xe.y,xe.z),ot=new r.Y(xe.x,xe.y+25e-6,xe.z),ct=xe.toLngLat(),at=Fe.toLngLat(),je=ot.toLngLat(),He=this.locationCoordinate(ct),st=this.locationCoordinate(at),pt=this.locationCoordinate(je),Ot=Math.hypot(st.x-He.x,st.y-He.y),Gt=Math.hypot(pt.x-He.x,pt.y-He.y);return Math.sqrt(Ot*Gt)*J/25e-6},ie=xe=>{let Re=ue,Fe=ce;return{aabb:r.aQ(this,P,0,0,0,xe,Fe,Re,this.projection),zoom:0,x:0,y:0,minZ:Fe,maxZ:Re,wrap:xe,fullyVisible:!1}},ge=[],Se=[],ae=h,Ce=s.reparseOverscaled?g:h,Me=xe=>xe*xe,$e=Me((q-this._centerAltitude)*H),Ge=xe=>{if(!this._elevation||!xe.tileID||!E)return;let Re=this._elevation.getMinMaxForTile(xe.tileID),Fe=xe.aabb;Re?(Fe.min[2]=Re.min,Fe.max[2]=Re.max,Fe.center[2]=(Fe.min[2]+Fe.max[2])/2):(xe.shouldSplit=Ve(xe),xe.shouldSplit||(Fe.min[2]=Fe.max[2]=Fe.center[2]=this._centerAltitude))},Ve=xe=>{if(xe.zoom<ne)return!0;if(xe.zoom===ae)return!1;if(xe.shouldSplit!=null)return xe.shouldSplit;let Re=xe.aabb.distanceX(W),Fe=xe.aabb.distanceY(W),ot=$e,ct=1;if(N){ot=Me(xe.aabb.distanceZ(W));let He=Math.pow(2,xe.zoom),st=r.ay((xe.y+1)/He),pt=r.ay(xe.y/He),Ot=Math.min(Math.max(M,st),pt),Gt=r.b4(Ot)/r.b4(M);if(ct=Ot===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Gt/this._mercatorScaleRatio),this.zoom<=r.b1&&xe.zoom===ae-1&&Gt>=.9)return!0}else if(x&&(ot=Me(xe.aabb.distanceZ(W)*H)),this.projection.isReprojectedInTileSpace&&g<=5){let He=Math.pow(2,xe.zoom),st=re(new r.Y((xe.x+.5)/He,(xe.y+.5)/He));ct=st>.85?1:st}let at=Re*Re+Fe*Fe+ot,je=Me((1<<ae-xe.zoom)*te*ct*((He,st)=>{if(st*Me(.707)<He)return 1;let pt=Math.sqrt(st/He);return pt/(1.4144271570014144+(Math.pow(1.1,pt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ot,$e),at));return at<je};if(this.renderWorldCopies)for(let xe=1;xe<=3;xe++)ge.push(ie(-xe)),ge.push(ie(xe));for(ge.push(ie(0));ge.length>0;){let xe=ge.pop(),Re=xe.x,Fe=xe.y,ot=xe.fullyVisible,ct=()=>this.projection.name==="globe"&&(xe.y===0||xe.y===(1<<xe.zoom)-1);if(!ot){let at=ee?xe.aabb.intersects(V):xe.aabb.intersectsFlat(V);if(at===0&&ct()){let je=new r.aO(xe.zoom,Re,Fe);at=r.aP(this,P,je,!0).intersects(V)}if(at===0)continue;ot=at===2}if(xe.zoom!==ae&&Ve(xe))for(let at=0;at<4;at++){let je=(Re<<1)+at%2,He=(Fe<<1)+(at>>1),st={aabb:E?xe.aabb.quadrant(at):r.aQ(this,P,xe.zoom+1,je,He,xe.wrap,xe.minZ,xe.maxZ,this.projection),zoom:xe.zoom+1,x:je,y:He,wrap:xe.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:xe.minZ,maxZ:xe.maxZ};x&&!N&&(st.tileID=new r.aL(xe.zoom+1===ae?Ce:xe.zoom+1,xe.wrap,xe.zoom+1,je,He),Ge(st)),ge.push(st)}else{let at=xe.zoom===ae?Ce:xe.zoom;if(s.minzoom&&s.minzoom>at)continue;if(!ot){let pt=ee?xe.aabb.intersectsPrecise(V):xe.aabb.intersectsPreciseFlat(V);if(pt===0&&ct()){let Ot=new r.aO(xe.zoom,Re,Fe);pt=r.aP(this,P,Ot,!0).intersectsPrecise(V)}if(pt===0)continue}let je=k[0]-(.5+Re+(xe.wrap<<xe.zoom))*(1<<h-xe.zoom),He=k[1]-.5-Fe,st=xe.tileID?xe.tileID:new r.aL(at,xe.wrap,xe.zoom,Re,Fe);Se.push({tileID:st,distanceSq:je*je+He*He})}}if(this.fogCullDistSq){let xe=this.fogCullDistSq,Re=this.horizonLineFromTop();Se=Se.filter(Fe=>{let ot=[0,0,0,1],ct=[r.a3,r.a3,0,1],at=this.calculateFogTileMatrix(Fe.tileID.toUnwrapped());r.aA.transformMat4(ot,ot,at),r.aA.transformMat4(ct,ct,at);let je=r.aA.min([],ot,ct),He=r.aA.max([],ot,ct),st=r.aR(je,He);if(st===0)return!0;let pt=!1,Ot=this._elevation;if(Ot&&st>xe&&Re!==0){let Gt=this.calculateProjMatrix(Fe.tileID.toUnwrapped()),cn;s.isTerrainDEM||(cn=Ot.getMinMaxForTile(Fe.tileID)),cn||(cn={min:ce,max:ue});let on=r.b2(this.rotation),Rn=[on[0]*r.a3,on[1]*r.a3,cn.max];r._.transformMat4(Rn,Rn,Gt),pt=(1-Rn[1])*this.height*.5<Re}return st<xe||pt})}return Se.sort((xe,Re)=>xe.distanceSq-Re.distanceSq).map(xe=>xe.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){let h=r.at(s.lat,-r.aS,r.aS),g=this.projection.project(s.lng,h);return new r.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let S=this.worldSize;g=(h.x-x.x)/S,v=(h.y-x.y)/S}else{let S=this.pointCoordinate(h),M=this.pointCoordinate(x);g=S.x-M.x,v=S.y-M.y}let E=this.locationCoordinate(s);this.setLocation(new r.Y(E.x-g,E.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){let g=h?r.ax(h,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new r.Y(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){let g=h??this._centerAltitude,v=[s.x,s.y,0,1],x=[s.x,s.y,1,1];r.aA.transformMat4(v,v,this.pixelMatrixInverse),r.aA.transformMat4(x,x,this.pixelMatrixInverse);let E=x[3];r.aA.scale(v,v,1/v[3]),r.aA.scale(x,x,1/E);let S=v[2],M=x[2];return{p0:v,p1:x,t:S===M?0:(g-S)/(M-S)}}screenPointToMercatorRay(s){let h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return r.aA.transformMat4(h,h,this.pixelMatrixInverse),r.aA.transformMat4(g,g,this.pixelMatrixInverse),r.aA.scale(h,h,1/h[3]),r.aA.scale(g,g,1/g[3]),h[2]=r.ax(h[2],this._center.lat)*this.worldSize,g[2]=r.ax(g[2],this._center.lat)*this.worldSize,r.aA.scale(h,h,1/this.worldSize),r.aA.scale(g,g,1/this.worldSize),new r.aT([h[0],h[1],h[2]],r._.normalize([],r._.sub([],g,h)))}rayIntersectionCoordinate(s){let{p0:h,p1:g,t:v}=s,x=r.ax(h[2],this._center.lat),E=r.ax(g[2],this._center.lat);return new r.Y(r.a2(h[0],g[0],v)/this.worldSize,r.a2(h[1],g[1],v)/this.worldSize,r.a2(x,E,v))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new r.Y(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);let x=.02*v,E=s.clone();for(let S=0;S<10&&v-g>x;S++){E.y=r.a2(g,v,.66);let M=this.projection.pointCoordinate3D(this,E.x,E.y);M?(v=E.y,h=M):g=E.y}return h?new r.Y(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=r.aU)return!this.isPointAboveHorizon(s);let h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){let g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return r.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(h,s)),E=this.pointLocation3D(new r.P(v,s)),S=this.pointLocation3D(new r.P(v,g)),M=this.pointLocation3D(new r.P(h,g)),P=Math.min(x.lng,E.lng,S.lng,M.lng),k=Math.max(x.lng,E.lng,S.lng,M.lng),N=Math.min(x.lat,E.lat,S.lat,M.lat),B=Math.max(x.lat,E.lat,S.lat,M.lat),V=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,H=(q,W,ee,te,ne)=>{let ue=(q+ee)/2,ce=(W+te)/2,J=new r.P(ue,ce),{lng:re,lat:ie}=this.pointLocation3D(J),ge=Math.max(0,P-re,N-ie,re-k,ie-B);P=Math.min(P,re),k=Math.max(k,re),N=Math.min(N,ie),B=Math.max(B,ie),(ne<G||ge>V)&&(H(q,W,ue,ce,ne+1),H(ue,ce,ee,te,ne+1))};if(H(h,s,v,s,1),H(v,s,v,g,1),H(v,g,h,g,1),H(h,g,h,s,1),this.projection.name==="globe"){let[q,W]=r.aV(this);q?(B=90,k=180,P=-180):W&&(N=-90,k=180,P=-180)}return new r.ai(new r.aI(P,N),new r.aI(k,B))}_getBoundsRectangular(s,h){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,S=new r.P(v,g),M=new r.P(E,g),P=new r.P(E,x),k=new r.P(v,x),N=this.pointCoordinate(S,s),B=this.pointCoordinate(M,s),V=this.pointCoordinate(P,h),G=this.pointCoordinate(k,h),H=(q,W)=>(W.y-q.y)/(W.x-q.x);return N.y>1&&B.y>=0?N=new r.Y((1-G.y)/H(G,N)+G.x,1):N.y<0&&B.y<=1&&(N=new r.Y(-G.y/H(G,N)+G.x,0)),B.y>1&&N.y>=0?B=new r.Y((1-V.y)/H(V,B)+V.x,1):B.y<0&&N.y<=1&&(B=new r.Y(-V.y/H(V,B)+V.x,0)),new r.ai().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){let s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-r.aS,this.maxLat=r.aS,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aj(this.minLng)*this.tileSize,this.worldMaxX=r.aj(this.maxLng)*this.tileSize,this.worldMinY=r.ak(this.maxLat)*this.tileSize,this.worldMaxY=r.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){let h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];let v=s.canonical,x=1/this.height,E=this.cameraWorldSize,S=E/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*s.wrap)*S,P=v.y*S,k=this.point;k.x*=E/this.worldSize,k.y*=E/this.worldSize;let N=this.angle,B=Math.sin(-N),V=-Math.cos(-N);return g[h]={bearing:[B,V],center:[(k.x-M)*x,(k.y-P)*x],scale:S/r.a3*x},g[h]}calculateFogTileMatrix(s){let h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return r.ad.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(s,h=!1,g=!1){let v=s.key,x;if(x=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let E=this.calculatePosMatrix(s,this.worldSize),S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,r.ad.multiply(E,S,E),x[v]=new Float32Array(E),x[v]}calculatePixelsToTileUnitsMatrix(s){let h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];let v=r.aW(s,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let s=1/this.worldSize,h=r.ad.fromScaling([],[s,s,s]);return r.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let s=this._elevation;this._updateCameraState();let h=r.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),x=r.ax(1,this._center.lat);g[2]/=x,v[2]/=x,r._.normalize(v,v);let E=s.raycast(g,v,s.exaggeration());if(E){let S=r._.scaleAndAdd([],g,v,E),M=new r.Y(S[0],S[1],r.ax(S[2],r.ay(S[1]))),P=(M.z+r._.length([M.x-g[0],M.y-g[1],M.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;let h=this._elevation,g=r.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=h.getAtPointOrZero(new r.Y(...v)),E=this.pixelsPerMeter/this.worldSize*x,S=this._minimumHeightOverTerrain(),M=v[2]-E;if(M<=S)if(M<0||s){let P=this.locationCoordinate(this._center,this._centerAltitude),k=[v[0],v[1],P.z-v[2]],N=r._.length(k);k[2]-=(S-M)/this._pixelsPerMercatorPixel;let B=r._.length(k);if(B===0)return;r._.scale(k,k,N/B*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],P.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){let B=this.center;return B.lat=r.at(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(B.lng=r.at(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}let h=this._unmodified,{x:g,y:v}=this.point,x=0,E=g,S=v,M=this.width/2,P=this.height/2,k=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(v-P<k&&(S=k+P),v+P>N&&(S=N-P),N-k<this.height&&(x=Math.max(x,this.height/(N-k)),S=(N+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,G=this.worldSize/2-(B+V)/2;E=(g+G+this.worldSize)%this.worldSize-G,E-M<B&&(E=B+M),E+M>V&&(E=V-M),V-B<this.width&&(x=Math.max(x,this.width/(V-B)),E=(V+B)/2)}E===g&&S===v||(this.center=this.unproject(new r.P(E,S))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let s=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ax(1,this.center.lat)/r.ax(1,r.b3));let v=r.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,x),S,M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-s.x/this.width,M[9]=2*s.y/this.height,this.isOrthographic){let ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=ie*this.aspect,Se=-ge,ae=-ie;ge-=s.x,Se-=s.x,ie+=s.y,ae+=s.y,S=this._camera.getCameraToClipOrthographic(Se,ge,ae,ie,this._nearZ,this._farZ),((Ce,Me,$e,Ge)=>{for(let Ve=0;Ve<16;Ve++)Ce[Ve]=Lp(Me[Ve],$e[Ve],Ge)})(S,S,M,Sr(this.pitch>=15?1:this.pitch/15))}else S=M;let P=r.ad.mul([],M,E),k=r.ad.mul([],S,E);if(this.projection.isReprojectedInTileSpace){let ie=this.locationCoordinate(this.center),ge=r.ad.identity([]);r.ad.translate(ge,ge,[ie.x*this.worldSize,ie.y*this.worldSize,0]),r.ad.multiply(ge,ge,r.aY(this)),r.ad.translate(ge,ge,[-ie.x*this.worldSize,-ie.y*this.worldSize,0]),r.ad.multiply(k,k,ge),r.ad.multiply(P,P,ge),this.inverseAdjustmentMatrix=r.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ad.scale([],k,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=k,this.invProjMatrix=r.ad.invert(new Float64Array(16),this.projMatrix),h){let ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ie[8]=2*-s.x/this.width,ie[9]=2*s.y/this.height,this.expandedFarZProjMatrix=r.ad.mul([],ie,E)}else this.expandedFarZProjMatrix=this.projMatrix;let N=r.ad.invert([],S);this.frustumCorners=r.a_.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let B=new Float32Array(16);r.ad.identity(B),r.ad.scale(B,B,[1,-1,1]),r.ad.rotateX(B,B,this._pitch),r.ad.rotateZ(B,B,this.angle);let V=r.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ad.clone(V);let G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-s.x/this.width,V[9]=2*(s.y+G)/this.height,this.skyboxMatrix=r.ad.multiply(B,V,B);let H=this.point,q=H.x,W=H.y,ee=this.width%2/2,te=this.height%2/2,ne=Math.cos(this.angle),ue=Math.sin(this.angle),ce=q-Math.round(q)+ne*ee+ue*te,J=W-Math.round(W)+ne*te+ue*ee,re=new Float64Array(k);if(r.ad.translate(re,re,[ce>.5?ce-1:ce,J>.5?J-1:J,0]),this.alignedProjMatrix=re,k=r.ad.create(),r.ad.scale(k,k,[this.width/2,-this.height/2,1]),r.ad.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=r.ad.create(),r.ad.scale(k,k,[1,-1,1]),r.ad.translate(k,k,[-1,-1,0]),r.ad.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=r.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},k=r.ad.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.a$(this);let ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r._.transformMat4(ie,ie,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,h];r._.scale(x,x,v),r._.scale(g,g,-1),r._.multiply(g,g,x);let E=r.ad.create();r.ad.translate(E,E,g),r.ad.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,v)}_computeCameraPosition(s){let h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,s/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((h-g)/v,1)),this._camera.position=r._.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){let s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=r.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ab(this._maxPitch)),S=Math.max((s[2]-x)/Math.cos(g),E),M=this._zoomFromMercatorZ(S);r._.scaleAndAdd(s,s,h,S),this._pitch=r.at(g,r.ab(this.minPitch),r.ab(this.maxPitch)),this.angle=r.au(v,-Math.PI,Math.PI),this._setZoom(r.at(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.Y(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){let s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=r.aU,v=0,x=1/0;for(;g-h>1e-6&&g>h;){let E=h+.5*(g-h),S=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,S),P=this.scaleZoom(M/(s*this.tileSize)),k=Math.abs(E-P);k<x&&(x=k,v=E),E<P?h=E:g=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){let g=Math.min(s.x,h.x),v=Math.max(s.x,h.x),x=Math.min(s.y,h.y),E=Math.max(s.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let S=[new r.P(g,x),new r.P(v,E),new r.P(g,E),new r.P(v,x)],M=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(let k of S){let N=this.pointRayIntersection(k);if(N.t<0)return!0;let B=this.rayIntersectionCoordinate(N);if(B.x<M||B.y<0||B.x>P||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(s,h){let g=r._.length(r._.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let s=function([h,g,v],x){let E=[h,g,v,1];r.aA.transformMat4(E,E,x);let S=E[3]=Math.max(E[3],1e-6);return E[0]/=S,E[1]/=S,E[2]/=S,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(s[0],s[1])}{let s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){let v=r.aX(s,h,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,g,v),E=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(E=Lp(1,E,Sr(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){let s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ad.multiply(s,s,this.globeMatrix),s}getFrustum(s){return r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}let Ti={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},us=(m,s)=>{if(s>0&&m.terrain&&r.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=m.transform,g=Math.max(Math.abs(h._zoom-(m.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?r.$(60,45,h.pitch):r.$(30,15,h.pitch),x=h._farZ-h._nearZ,E=s*h.height,S=((1-(M=v))*h.cameraToCenterDistance+M*(h._farZ+E))*g;var M;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(S-h._nearZ)/x,(S-E-h._nearZ)/x]}}},ei={cascadeCount:2,shadowMapResolution:2048};class Fp{constructor(s,h){this.aabb=s,this.lastCascade=h}}class Np{add(s,h){let g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[s.key]=new Fp(h,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,h,g){let v=r.b6.fromPoints(s.points),x=0;for(let E in this.receivers){let S=this.receivers[E];if(!S||!v.intersectsAabb(S.aabb))continue;S.aabb.min=v.closestPoint(S.aabb.min),S.aabb.max=v.closestPoint(S.aabb.max);let M=S.aabb.getCorners();for(let P=0;P<g.length;P++){let k=!0;for(let N of M){let B=[N[0]*h,N[1]*h,N[2]];if(r._.transformMat4(B,B,g[P].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){k=!1;break}}if(S.lastCascade=P,x=Math.max(x,P),k)break}}return x+1}}class ad{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Np,this._depthMode=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(ei,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(ei,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,h){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((G,H)=>{let q=g.style._mergedLayers[H];return G+(q.hasShadowPass()&&!q.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,E=ei.shadowMapResolution,S=ei.shadowMapResolution;if(this._cascades.length===0||ei.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<ei.cascadeCount;++G){let H=g._shadowMapDebug,q=x.gl,W=x.createFramebuffer(E,S,H,"texture"),ee=new r.T(x,{width:E,height:S,data:null},q.DEPTH_COMPONENT);if(W.depthAttachment.set(ee.texture),H){let te=new r.T(x,{width:E,height:S,data:null},q.RGBA);W.colorAttachment.set(te.texture)}this._cascades.push({framebuffer:W,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.aM,scale:0})}}this.shadowDirection=xu(h);let M=0;if(s.elevation){let G=s.elevation,H=[1e4,-1e4];G.visibleDemTiles.filter(q=>q.dem).forEach(q=>{let W=q.dem.tree;H[0]=Math.min(H[0],W.minimums[0]),H[1]=Math.max(H[1],W.maximums[0])}),H[0]!==1e4&&(M=(H[1]-H[0])*G.exaggeration())}let P=1.5*s.cameraToCenterDistance,k=3*P,N=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){let H=this._cascades[G],q=s.height/50,W=1;ei.cascadeCount===1?W=k:G===0?W=P:(q=P,W=k);let[ee,te]=bu(s,this.shadowDirection,q,W,ei.shadowMapResolution,M);H.scale=s.scale,H.matrix=ee,H.boundingSphereRadius=te,r.ad.invert(N,H.matrix),H.frustum=r.aM.fromInvProjectionMatrix(N,1,0,!0),H.far=W}let B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ei.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ei.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ti.ShadowMap0,this._uniformValues.u_shadowmap_1=Ti.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let V=g.transform.elevation;for(let G of this._groundShadowTiles){let H={min:0,max:0};if(V){let q=V.getMinMaxForTile(G);q&&(H=q)}this.addShadowReceiver(G.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,h){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,ei.shadowMapResolution,ei.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:r.C.white,depth:1});for(let E of s.order){let S=s._mergedLayers[E];if(!S.hasShadowPass()||S.isHidden(g.transform.zoom))continue;let M=s.getLayerSourceCache(S),P=M?h[M.id]:void 0;(S.type==="model"||P&&P.length)&&g.renderLayer(g,M,S,P)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let s=this.painter,h=s.style,g=s.context,v=h.directionalLight,x=h.ambientLight;if(!v||!x)return;let E=[],S=us(s,s.longestCutoffRange);S.shouldRenderCutoff&&E.push("RENDER_CUTOFF");let M=hs(h,v,x),P=new r.ae(g.gl.LEQUAL,r.ae.ReadOnly,s.depthRangeFor3D);for(let k of this._groundShadowTiles){let N=k.toUnwrapped(),B=s.isTileAffectedByFog(k),V=s.getOrCreateProgram("groundShadow",{defines:E,overrideFog:B});this.setupShadows(N,V),s.uploadCommonUniforms(g,V,N,null,S);let G={u_matrix:s.transform.calculateProjMatrix(N),u_ground_shadow_factor:M};V.draw(s,g.gl.TRIANGLES,P,r.ag.disabled,r.a.multiply,r.af.disabled,G,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){let h=this.painter.transform,g=h.calculatePosMatrix(s,h.worldSize);return r.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return r.ad.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,h,g,v=0){if(!this.enabled)return;let x=this.painter.transform,E=this.painter.context,S=E.gl,M=this._uniformValues,P=new Float64Array(16),k=x.calculatePosMatrix(s,x.worldSize);for(let N=0;N<this._cascades.length;N++)r.ad.multiply(P,this._cascades[N].matrix,k),M[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),E.activeTexture.set(S.TEXTURE0+Ti.ShadowMap0+N),this._cascades[N].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let N=r.b5(s.canonical),B=2/x.tileSize*r.a3/ei.shadowMapResolution,V=B*this._cascades[0].boundingSphereRadius,G=B*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(g==="vector-tile"?1:3)/Math.pow(2,v-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));M.u_shadow_normal_offset=[N,V*H,G*H],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(E,M)}setupShadowsFromMatrix(s,h,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,E=this._uniformValues,S=new Float64Array(16);for(let M=0;M<ei.cascadeCount;M++)r.ad.multiply(S,this._cascades[M].matrix,s),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),v.activeTexture.set(x.TEXTURE0+Ti.ShadowMap0+M),this._cascades[M].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(E.u_shadow_normal_offset=[1,5,5],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,h,g,v){if(v[2]>=0)return{};let x=function(M,P,k){let N=k/(1<<M.canonical.z);return new r.b6([M.canonical.x*N+M.wrap*k,M.canonical.y*N+M.wrap*k,0],[(M.canonical.x+1)*N+M.wrap*k,(M.canonical.y+1)*N+M.wrap*k,P])}(s,h,g).getCorners(),E=h/-v[2];v[0]<0?(r._.add(x[0],x[0],[v[0]*E,0,0]),r._.add(x[3],x[3],[v[0]*E,0,0])):v[0]>0&&(r._.add(x[1],x[1],[v[0]*E,0,0]),r._.add(x[2],x[2],[v[0]*E,0,0])),v[1]<0?(r._.add(x[0],x[0],[0,v[1]*E,0]),r._.add(x[1],x[1],[0,v[1]*E,0])):v[1]>0&&(r._.add(x[2],x[2],[0,v[1]*E,0]),r._.add(x[3],x[3],[0,v[1]*E,0]));let S={};return S.vertices=x,S.planes=[Bl(x[1],x[0],x[4]),Bl(x[2],x[1],x[5]),Bl(x[3],x[2],x[6]),Bl(x[0],x[3],x[7])],S}addShadowReceiver(s,h,g){this._receivers.add(s,r.b6.fromTileIdAndHeight(s,h,g))}getMaxCascadeForTile(s){let h=this._receivers.get(s);return h&&h.lastCascade?h.lastCascade:0}}function Bl(m,s,h){let g=r._.sub([],h,s),v=r._.sub([],m,s),x=r._.cross([],g,v),E=r._.length(x);return E===0?[0,0,1,0]:(r._.scale(x,x,1/E),[x[0],x[1],x[2],-r._.dot(x,s)])}function xu(m){let s=m.properties.get("direction"),h=r.ac(s.x,s.y,s.z);h[2]=r.at(h[2],0,75);let g=r.b7([h[0],h[1],h[2]]);return r._.fromValues(g.x,g.y,g.z)}function hs(m,s,h){let g=s.properties.get("color"),v=s.properties.get("intensity"),x=s.properties.get("direction"),E=[x.x,x.y,x.z],S=h.properties.get("color"),M=h.properties.get("intensity"),P=Math.max(r._.dot([0,0,1],E),0),k=[0,0,0];r._.scale(k,S.toRenderColor(m.getLut(s.scope)).toArray01Linear().slice(0,3),M);let N=[0,0,0];return r._.scale(N,g.toRenderColor(m.getLut(h.scope)).toArray01Linear().slice(0,3),P*v),r.b8([k[0]>0?k[0]/(k[0]+N[0]):0,k[1]>0?k[1]/(k[1]+N[1]):0,k[2]>0?k[2]/(k[2]+N[2]):0])}function bu(m,s,h,g,v,x){let E=m.zoom,S=m.scale,M=m.worldSize,P=1/M,k=m.aspect,N=Math.sqrt(1+k*k)*Math.tan(.5*m.fovX),B=N*N,V=g-h,G=g+h,H,q;B>V/G?(H=g,q=g*N):(H=.5*G*(1+B),q=.5*Math.sqrt(V*V+2*(g*g+h*h)*B+G*G*B*B));let W=m.projection.pixelsPerMeter(m.center.lat,M),ee=m._camera.getCameraToWorldMercator(),te=[0,0,-H*P];r._.transformMat4(te,te,ee);let ne=q*P,ue=m._edgeInsets;if(!(ue.left===0&&ue.top===0&&ue.right===0&&ue.bottom===0||ue.left===ue.right&&ue.top===ue.bottom)){let ot=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?W:1),ct=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,h,g);ct[8]=2*-m.centerOffset.x/m.width,ct[9]=2*m.centerOffset.y/m.height;let at=new Float64Array(16);r.ad.mul(at,ct,ot);let je=new Float64Array(16);r.ad.invert(je,at);let He=r.aM.fromInvProjectionMatrix(je,M,E,!0);for(let st of He.points){let pt=((ce=st)[0]/=S,ce[1]/=S,ce[2]=r.ax(ce[2],m._center.lat),ce);ne=Math.max(ne,r._.len(r._.subtract([],te,pt)))}}var ce;ne*=v/(v-1);let J=Math.acos(s[2]),re=Math.atan2(-s[0],-s[1]),ie=new yu;ie.position=te,ie.setPitchBearing(J,re);let ge=ie.getWorldToCamera(M,W),Se=ne*M,ae=Math.min(m._mercatorZfromZoom(17)*M*-2,-2*Se),Ce=ie.getCameraToClipOrthographic(-Se,Se,-Se,Se,ae,(Se+x*W)/s[2]),Me=new Float64Array(16);r.ad.multiply(Me,Ce,ge);let $e=r._.fromValues(Math.floor(1e6*te[0])/1e6*M,Math.floor(1e6*te[1])/1e6*M,0),Ge=.5*v,Ve=[0,0,0];r._.transformMat4(Ve,$e,Me),r._.scale(Ve,Ve,Ge);let xe=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],Re=[0,0,0];r._.sub(Re,Ve,xe),r._.scale(Re,Re,-1/Ge);let Fe=new Float64Array(16);return r.ad.identity(Fe),r.ad.translate(Fe,Fe,Re),r.ad.multiply(Me,Fe,Me),[Me,Se]}function ld(m,s){return m!=null&&s!=null&&!(!m.hasData()||!s.hasData())&&m.demTexture!=null&&s.demTexture!=null&&m.tileID.key!==s.tileID.key}let La=new class{constructor(){this.operations={}}newMorphing(m,s,h,g,v){if(m in this.operations){let x=this.operations[m];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[m]={startTime:g,phase:0,duration:v,from:s,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;let s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(let s in this.operations){let h=this.operations[s];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},wu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function zp(m,s,h){if(s===0)return 0;let g=s<1&&h===514?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*g}function q_(m,s){let h=1<<m.z;return!s&&(m.x===0||m.x===h-1)||m.y===0||m.y===h-1}let cd=m=>({u_matrix:m});function ud(m,s,h,g,v){if(v>0){let x=r.e.now(),E=(x-m.timeAdded)/v,S=s?(x-s.timeAdded)/v:-1,M=h.getSource(),P=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),k=!s||Math.abs(s.tileID.overscaledZ-P)>Math.abs(m.tileID.overscaledZ-P),N=k&&m.refreshedUponExpiration?1:r.at(k?E:1-S,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Vl extends gu{constructor(s,h,g,v){super(s,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=r.W({type:"raster-array"},h)}triggerRepaint(s){let h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,r.R.Tile);s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(x,E,S,M)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(x)return x.code===20?void 0:(s.state="errored",h(x));this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:S,expires:M}),s.state="empty",h(null)})}unloadTile(s,h){let g=s.texture;g&&g instanceof r.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,h,g){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(h,g,(v,x)=>{if(v)return s.state="errored",this.fire(new r.d(v)),void this.triggerRepaint(s);x&&(s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:x})=>x===s),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(s,h,g){if(!s)return;let v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;h instanceof r.bk?x=h.paint.get("raster-array-band"):h instanceof r.bl&&(x=h.paint.get("raster-particle-array-band"));let E=x||this.getInitialBand(v);if(E!=null)if(s.textureDescriptor){if(!s.updateNeeded(v,E)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,E)}}let ti={vector:rd,raster:gu,"raster-dem":class extends gu{constructor(m,s,h,g){super(m,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=r.W({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){let h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(m.state="errored",s(v)),x&&(m.dem=x,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=r.h(this.map._requestManager.transformRequest(h,r.R.Tile),(function(v,x,E,S){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(v)m.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:S});let M=ImageBitmap&&x instanceof ImageBitmap&&r.bi(),P=1-(x.width-r.bj(x.width))/2;P<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));let k=M?x:r.e.getImageData(x,P),N={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:P};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",N,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){let s=m.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,v=s.x===0?m.wrap-1:m.wrap,x=(s.x+1+h)%h,E=s.x+1===h?m.wrap+1:m.wrap,S={};return S[new r.aL(m.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},S[new r.aL(m.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(S[new r.aL(m.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},S[new r.aL(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new r.aL(m.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<h&&(S[new r.aL(m.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},S[new r.aL(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new r.aL(m.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),S}},"raster-array":Vl,geojson:class extends r.E{constructor(m,s,h,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=r.W({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;let v=r.a3/this.tileSize;this.workerOptions=r.W({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:r.a3,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:r.a3,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){return this._options.dynamic?typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection")?this.fire(new r.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...m.features):this._data=m,this._updateWorkerData(!0),this):this.fire(new r.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:h},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.f("dataloading",{dataType:"source"})),this._loaded=!1;let s=r.W({append:m},this.workerOptions);s.scope=this.scope;let h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(r.e.resolveURL(h),r.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new r.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new r.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,s){let h=m.actor?"reloadTile":"loadTile";m.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};m.request=this.actor.send(h,x,(E,S)=>v&&!S?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):E?s(E):(m.loadVectorData(S,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.bm{constructor(m,s,h,g){super(m,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;let m=this.options;this.urls=[];for(let s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,r.R.Source).url);r.bn(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new r.d(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){let s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new r.d(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(m,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.bm,model:class extends r.E{constructor(m,s,h,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){let m=[];for(let s in this._options.models){let h=this._options.models[s],g=r.l(this.map._requestManager.transformRequest(h.uri,r.R.Model).url).then(v=>{if(!v)return;let x=r.c(v),E=new r.M(s,h.position,h.orientation,x);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(v=>{this.fire(new r.d(new Error(`Could not load model ${s} from ${h.uri}: ${v.message}`)))});m.push(g)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new r.d(new Error(`Could not load models: ${s.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(m,s,h,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Pp(this._options,this.map._requestManager,s,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new r.d(g))):v&&(r.W(this,v),v.bounds&&(this.tileBounds=new mu(v.bounds,this.minzoom,this.maxzoom)),r.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){let h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,r.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=s;else{if(m.buckets){let x=Object.values(m.buckets);for(let E of x)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,E){return m.aborted?s(null):x&&x.status!==404?s(x):(E&&(E.resourceTiming&&(m.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&m.setExpiryData(E),m.buckets=vt(vt({},m.buckets),E.buckets),E.featureIndex&&(m.latestFeatureIndex=E.featureIndex)),m.state="loaded",void s(null))}}serialize(){return r.W({},this._options)}},canvas:class extends r.bm{constructor(m,s,h,g){super(m,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new r.d(new r.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.d(new r.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new r.d(new r.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new r.d(new r.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.d(new r.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof r.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends r.E{constructor(m,s,h,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new mu(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),r.W(this,r.ah(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){let{x:s,y:h,z:g}=m.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){let{x:h,y:g,z:v}=m.tileID.canonical,x=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:x.signal})).then((function(E){return delete m.request,m.aborted?(m.state="unloaded",s(null)):E===void 0?(m.state="errored",s(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(E)?(this.loadTileData(m,E),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(m.state="errored",s(E))}),m.request.cancel=()=>x.abort()}loadTileData(m,s){m.setTexture(s,this._map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof r.T?(m.destroy(!0),m.texture&&m.texture instanceof r.T&&this._map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){let{x:h,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){let m=r.al(this.id,this.scope);this._map.style.clearSource(m)}_update(){this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}}},hd=function(m,s,h,g){let v=new ti[s.type](m,s,h,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return r.bp(["load","abort","unload","serialize","prepare"],v),v};class Bp extends r.bv{constructor(s){let h={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new r.bw(r.bx(),null),v=hd("mock-dem",h,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class W_ extends r.bv{constructor(s){let h=hd("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new r.bw(r.bx(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;let v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){let S=new r.by(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);S.state="loaded",this._tiles[E.key]=S}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){let h=this.proxyCachedFBO[s];if(h!==void 0){let g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Vp extends r.aL{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class jp extends r.bq{constructor(s,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(M){let P=new r.bt,k=new r.bu,N=131;P.reserve(17161),k.reserve(33800);let B=r.a3/128,V=r.a3+B/2,G=V+B;for(let q=-B;q<G;q+=B)for(let W=-B;W<G;W+=B){let ee=W<0||W>V||q<0||q>V?24575:0,te=r.at(Math.round(W),0,r.a3),ne=r.at(Math.round(q),0,r.a3);P.emplaceBack(te+ee,ne)}let H=(q,W)=>{let ee=W*N+q;k.emplaceBack(ee+1,ee,ee+N),k.emplaceBack(ee+N,ee+N+1,ee+1)};for(let q=1;q<129;q++)for(let W=1;W<129;W++)H(W,q);return[0,129].forEach(q=>{for(let W=0;W<130;W++)H(W,q),H(q,W)}),[P,k,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(g,r.br.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=r.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=r.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new W_(h.map),this.orthoMatrix=r.ad.create(),r.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.a3,0,r.a3,0,1);let S=E.gl;this._overlapStencilMode=new r.ag({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Bp(h.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);let v=s.terrain.properties,x=s.terrain.drapeRenderMode===0,E=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.e.now();let S=s.terrain&&s.terrain.scope,M=v.get("source"),P=x?this._mockSourceCache:s.getSourceCache(M,S);if(!P)return void r.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=P,this._exaggeration=E?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;let k=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let N=this.getScaledDemTileSize();this.sourceCache.update(h,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(s){let h=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;let v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=s.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(x);let S=x-this._previousZoom,M=this._previousUpdateTimestamp,P=x;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(x-P)>.5&&(S=.5*(x-P+S)),S*v<0&&(P+=S)),this._evaluationZoom=P;let k=E.getExaggeration(P),N=k===E.getExaggeration(Math.max(0,P-.1));if(N&&Math.abs(k-this._exaggeration)<.01)return k;let B=Math.min(.1,.00375*(this._updateTimestamp-M));return(N||k<.1||Math.abs(S)<1e-4)&&(B=Math.min(.2,4*B)),r.a2(this._exaggeration,k,B)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(r.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(M=>{let P=h.getTileByID(M).tileID;return P.projMatrix=g.calculateProjMatrix(P.toUnwrapped()),P});(function(M,P){let k=P.transform.pointCoordinate(P.transform.getCameraPoint()),N=new r.P(k.x,k.y);M.sort((B,V)=>{if(V.overscaledZ-B.overscaledZ)return V.overscaledZ-B.overscaledZ;let G=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),H=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),q=N.mult(1<<B.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(G)-q.distSqr(H)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};let E=this._style._mergedSourceCaches;for(let M in E){let P=E[M];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,s[M],x),P.usedForTerrain))continue;let k=s[M];P.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[h.id]=v.map(M=>new Vp(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let S={};this._visibleDemTiles=[];for(let M of this.proxyCoords){let P=this.terrainTileForTile[M.key];if(!P)continue;let k=P.tileID.key;k in S||(this._visibleDemTiles.push(P),S[k]=k)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;let g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){let s=this.painter.context,h=s.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),Ap(this.painter,v,x))}}_prepareDemTileUniforms(s,h,g,v){if(!h||h.demTexture==null)return!1;let x=s.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-x.z),S=v||"";return g[`u_dem_tl${S}`]=[x.x*E%1,x.y*E%1],g[`u_dem_scale${S}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){let g=new r.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(s,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0,h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&s++,g+x},0);return s?h/s:0}_updateEmptyDEMTexture(){let s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let S=new r.bz({width:1,height:1},new Float32Array([g]));return[h.R32F,S]})();this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(x,{premultiply:!1}):E=this._emptyDEMTexture=new r.T(s,x,v,{premultiply:!1}),E}setupElevationDraw(s,h,g){let v=this.painter.context,x=v.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};E.u_exaggeration=this.exaggeration();let S=null,M=null,P=1;if(g&&g.morphing&&this._useVertexMorphing){let V=g.morphing.srcDemTile,G=g.morphing.dstDemTile;P=g.morphing.phase,V&&G&&(this._prepareDemTileUniforms(s,V,E,"_prev")&&(M=V),this._prepareDemTileUniforms(s,G,E)&&(S=G))}let k=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,N=null;var B;if(this.enabled?M&&S?(N=S.demTexture,v.activeTexture.set(x.TEXTURE4),M.demTexture.bind(k(M),x.CLAMP_TO_EDGE),E.u_dem_lerp=P):(S=this.terrainTileForTile[s.tileID.key],N=this._prepareDemTileUniforms(s,S,E)?S.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),N&&(E.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(k(S),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&S){let V=(1<<S.tileID.canonical.z)*r.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=V}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,E),this.painter.transform.projection.name==="globe"){let V=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,V)}}globeUniformValues(s,h,g){let v=s.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,r.a3,0),u_tile_br_up:v.upVector(h,r.a3,r.a3),u_tile_bl_up:v.upVector(h,0,r.a3),u_tile_up_scale:g?r.bs(1):v.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){let h=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,E,S,M){if(v.transform.projection.name==="globe")(function(P,k,N,B,V){let G=P.context,H=G.gl,q,W,ee=P.transform,te=r.ba(P,G,ee),ne=(Ce,Me)=>{if(W===Me)return;let $e=[wu[Me],"PROJECTION_GLOBE_VIEW"];te&&$e.push("CUSTOM_ANTIALIASING");let Ge=P.isTileAffectedByFog(Ce);q=P.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:Ge}),W=Me},ue=P.colorModeForRenderPass(),ce=new r.ae(H.LEQUAL,r.ae.ReadWrite,P.depthRangeFor3D);La.update(V);let J=r.bb(ee),re=[r.aj(ee.center.lng),r.ak(ee.center.lat)],ie=P.globeSharedBuffers,ge=[ee.width*r.e.devicePixelRatio,ee.height*r.e.devicePixelRatio],Se=Float32Array.from(ee.globeMatrix),ae={useDenormalizedUpVectorScale:!0};{let Ce=P.transform,Me=zp(Ce.zoom,k.exaggeration(),k.sourceCache._source.tileSize);W=-1;let $e=H.TRIANGLES;for(let Ge of B){let Ve=N.getTile(Ge),xe=r.ag.disabled,Re=k.prevTerrainTileForTile[Ge.key],Fe=k.terrainTileForTile[Ge.key];ld(Re,Fe)&&La.newMorphing(Ge.key,Re,Fe,V,250),G.activeTexture.set(H.TEXTURE0),Ve.texture&&Ve.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let ot=La.getMorphValuesForProxy(Ge.key),ct=ot?1:0;ot&&r.o(ae,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:r.b9(ot.phase)}});let at=r.bc(Ge.canonical),je=r.bd(at.getCenter().lat),He=r.be(Ge.canonical,at,je,Ce.worldSize/Ce._pixelsPerMercatorPixel),st=r.bf(r.bg(Ge.canonical)),pt=G_(Ce.expandedFarZProjMatrix,Se,J,st,r.a1(Ce.zoom),re,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,ge,Me,Ce._farZ,He);if(ne(Ge,ct),q&&(k.setupElevationDraw(Ve,q,ae),P.uploadCommonUniforms(G,q,Ge.toUnwrapped()),ie)){let[Ot,Gt,cn]=ie.getGridBuffers(je,Me!==0);q.draw(P,$e,ce,xe,ue,r.af.backCCW,pt,"globe_raster",Ot,Gt,cn)}}}if(ie&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){let Ce=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&Ce.push("CUSTOM_ANTIALIASING"),q=P.getOrCreateProgram("globeRaster",{defines:Ce});for(let Me of B){let{x:$e,y:Ge,z:Ve}=Me.canonical,xe=Ge===0,Re=Ge===(1<<Ve)-1,[Fe,ot,ct,at]=ie.getPoleBuffers(Ve,!1);if(at&&(xe||Re)){let je=N.getTile(Me);G.activeTexture.set(H.TEXTURE0),je.texture&&je.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let He=r.bh(Ve,$e,ee),st=r.bf(r.bg(Me.canonical)),pt=(Ot,Gt)=>Ot.draw(P,H.TRIANGLES,ce,r.ag.disabled,ue,r.af.disabled,G_(ee.expandedFarZProjMatrix,He,He,st,0,re,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,ge,0,ee._farZ),"globe_pole_raster",Gt,ct,at);k.setupElevationDraw(je,q,ae),P.uploadCommonUniforms(G,q,Me.toUnwrapped()),xe&&P.renderDefaultNorthPole&&pt(q,Fe),Re&&P.renderDefaultSouthPole&&(He=r.ad.scale(r.ad.create(),He,[1,-1,1]),pt(q,ot))}}}})(v,x,E,S,M);else{let P=v.context,k=P.gl,N,B,V=v.shadowRenderer,G=us(v,v.longestCutoffRange),H=ue=>{if(B===ue)return;let ce=[];ce.push(wu[ue]),G.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),N=v.getOrCreateProgram("terrainRaster",{defines:ce}),B=ue},q=v.colorModeForRenderPass(),W=new r.ae(k.LEQUAL,r.ae.ReadWrite,v.depthRangeFor3D);La.update(M);let ee=v.transform,te=zp(ee.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ne=[0,0,0];if(V){let ue=v.style.directionalLight,ce=v.style.ambientLight;ue&&ce&&(ne=hs(v.style,ue,ce))}{B=-1;let ue=k.TRIANGLES,[ce,J]=[x.gridIndexBuffer,x.gridSegments];for(let re of S){let ie=E.getTile(re),ge=r.ag.disabled,Se=x.prevTerrainTileForTile[re.key],ae=x.terrainTileForTile[re.key];ld(Se,ae)&&La.newMorphing(re.key,Se,ae,M,250),P.activeTexture.set(k.TEXTURE0),ie.texture&&ie.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);let Ce=La.getMorphValuesForProxy(re.key),Me=Ce?1:0,$e;Ce&&($e={morphing:{srcDemTile:Ce.from,dstDemTile:Ce.to,phase:r.b9(Ce.phase)}});let Ge=lt(re.projMatrix,q_(re.canonical,ee.renderWorldCopies)?te/10:te,ne);if(H(Me),!N)continue;x.setupElevationDraw(ie,N,$e);let Ve=re.toUnwrapped();V&&V.setupShadows(Ve,N),v.uploadCommonUniforms(P,N,Ve,null,G),N.draw(v,ue,W,ge,q,r.af.backCCW,Ge,"terrain_raster",x.gridBuffer,ce,J)}}}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;let h=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),S=h.style.order,M=[],P=0;for(let k of x){let N=v.getTileByID(k.proxyTileKey),B=v.proxyCachedFBO[k.key]?v.proxyCachedFBO[k.key][s]:void 0,V=B!==void 0?v.renderCache[B]:this.pool[P++],G=B!==void 0;if(N.texture=V.tex,G&&!V.dirty){M.push(N.tileID);continue}let H;g.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(g.clear({color:r.C.transparent,stencil:0}),V.dirty=!1);for(let q=E.start;q<=E.end;++q){let W=h.style._mergedLayers[S[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[k.key][ee.id]:[k];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}if(this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let W=h.style._mergedLayers[S[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[k.key][ee.id]:[k];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}this.renderedToTile?(V.dirty=!0,M.push(N.tileID)):G||--P,P===5&&(P=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}isLayerOrderingCorrect(s){let h=s.order.length,g=-1,v=h;for(let x=0;x<h;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let E=x.tileID,S=1<<E.overscaledZ,{x:M,y:P}=E.canonical,k=M/S,N=(M+1)/S,B=P/S,V=(P+1)/S;return{minx:k,miny:B,maxx:N,maxy:V,t:x.dem.tree.raycastRoot(k,B,N,V,s,h,g),tile:x}});v.sort((x,E)=>(x.t!==null?x.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,h,g);if(E!=null)return E}return null}_createFBO(){let s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);let v=new r.T(s,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=s.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new Ia(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{let h=this._style._mergedLayers[s],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(let g of this._style.getSources())if(g instanceof rd){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!h[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.Z){h[x.id]=!0;for(let E of this.proxyCoords){let S=this.proxyToSource[E.key][x.id];if(S)for(let M of S)this._clearRenderCacheForTile(x.id,M)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof gu){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||h[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let E=v.paint.get("raster-fade-duration");for(let S of this.proxyCoords){let M=this.proxyToSource[S.key][x.id];if(M)for(let P of M){let k=ud(x.getTile(P),x.findLoadedParent(P,0),x,this.painter.transform,E);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(x.id,P)}}}}_setupDrapedRenderBatches(){let s=this._style.order,h=s.length;if(h===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,E=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<h;)E=this._style._mergedLayers[s[x]];for(;x<h;++x){let S=this._style._mergedLayers[s[x]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?v===void 0&&(v=x):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let S=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>S.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let S=0;S<E.length;++S){let M=Object.values(E[S]);h.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let E=g.length-1;E>=0;E--){let S=g[E];if(h.getTileByID(S.key),h.proxyCachedFBO[S.key]!==void 0){let M=s[S.key],P=this.proxyToSource[S.key],k=0;for(let N in P){let B=P[N],V=M[N];if(!V||V.length!==B.length||B.some((G,H)=>G!==V[H]||v[N]&&v[N].hasOwnProperty(G.key))){k=-1;break}++k}for(let N in h.proxyCachedFBO[S.key])h.renderCache[h.proxyCachedFBO[S.key][N]].dirty=k<0||k!==Object.values(M).length}}let x=[...this._drapedRenderBatches];x.sort((E,S)=>S.end-S.start-(E.end-E.start));for(let E of x)for(let S of g){if(h.proxyCachedFBO[S.key])continue;let M=h.renderCachePool.pop();M===void 0&&h.renderCache.length<50&&(M=h.renderCache.length,h.renderCache.push(this._createFBO())),M!==void 0&&(h.proxyCachedFBO[S.key]={},h.proxyCachedFBO[S.key][E.start]=M,h.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,E=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let S;if(g.isTileClipped())S=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):r.ag.disabled}_renderTileClippingMasks(s,h){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let E=g.getOrCreateProgram("clippingMask");for(let S of s){let M=g._tileClippingMaskIDs[S.key]=--h;E.draw(g,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,cd(S.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){let h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;let g=[s.x,s.y,1,1];r.aA.transformMat4(g,g,h.pixelMatrixInverse),r.aA.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;let v=h._camera.position,x=r.ax(1,h.center.lat),E=[v[0],v[1],v[2]/x,0],S=r._.subtract([],g.slice(0,3),E);r._.normalize(S,S);let M=this.raycast(E,S,this._exaggeration);return M!==null&&M?(r._.scaleAndAdd(E,E,S,M),E[3]=E[2],E[2]*=x,E):null}drawDepth(){let s=this.painter,h=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let E=h.gl,S=h.createFramebuffer(v,x,!0,"renderbuffer");h.activeTexture.set(E.TEXTURE0);let M=new r.T(h,{width:v,height:x,data:null},E.RGBA);M.bind(E.NEAREST,E.CLAMP_TO_EDGE),S.colorAttachment.set(M.texture);let P=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);S.depthAttachment.set(P),this._depthFBO=S,this._depthTexture=M}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(E,S,M,P){if(E.transform.projection.name==="globe")return;let k=E.context,N=k.gl;k.clear({depth:1});let B=E.getOrCreateProgram("terrainDepth"),V=new r.ae(N.LESS,r.ae.ReadWrite,E.depthRangeFor3D);for(let G of P){let H=M.getTile(G),q=lt(G.projMatrix,0,[0,0,0]);S.setupElevationDraw(H,B),B.draw(E,N.TRIANGLES,V,r.ag.disabled,r.a.unblended,r.af.backCCW,q,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof r.bm)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let M=0;M<x.length;M++){let P=x[M],k=this._findTileCoveringTileID(P,s);if(k){let N=this._createProxiedId(P,k,g[P.key]&&g[P.key][s.id]);v.push(N),this.proxyToSource[P.key][s.id]=[N]}}let E=!1,S=new Set;for(let M=0;M<h.length;M++){let P=s.getTile(h[M]);if(!P||!P.hasData())continue;let k=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==P.tileID.canonical.z){let N=this.proxyToSource[k.tileID.key][s.id],B=this._createProxiedId(k.tileID,P,g[k.tileID.key]&&g[k.tileID.key][s.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[k.tileID.key][s.id]=[B];let V=this.proxyToSource[k.tileID.key][s.id];S.has(V)||S.add(V),v.push(B),E=!0}}if(this._sourceTilesOverlap[s.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(let M of S)M.sort((P,k)=>k.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords,E=s.getSource(),S=E.tileID;if(!S)return;let M=new r.P(S.x,S.y)._div(1<<S.z),P=E.coordinates.map(r.Y.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-M.x),N.min.y=Math.min(N.min.y,B.y-M.y),N.max.x=Math.max(N.max.x,B.x-M.x),N.max.y=Math.max(N.max.y,B.y-M.y),N),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(N,B)=>{let V=N.wrap+N.canonical.x/(1<<N.canonical.z),G=N.canonical.y/(1<<N.canonical.z),H=r.a3/(1<<N.canonical.z),q=B.wrap+B.canonical.x/(1<<B.canonical.z),W=B.canonical.y/(1<<B.canonical.z);return V+H<q+P.min.x||V>q+P.max.x||G+H<W+P.min.y||G>W+P.max.y};for(let N=0;N<x.length;N++){let B=x[N];for(let V=0;V<h.length;V++){let G=s.getTile(h[V]);if(!G||!G.hasData()||k(B,G.tileID))continue;let H=this._createProxiedId(B,G,g[B.key]&&g[B.key][s.id]),q=this.proxyToSource[B.key][s.id];q?q.push(H):this.proxyToSource[B.key][s.id]=[H],v.push(H)}}}_createProxiedId(s,h,g){let v=this.orthoMatrix;if(g){let x=g.find(E=>E.key===h.tileID.key);if(x)return x}if(h.tileID.key!==s.key){let x=s.canonical.z-h.tileID.canonical.z,E,S,M;v=r.ad.create();let P=h.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(E=r.a3>>x,S=E*((h.tileID.canonical.x<<x)-s.canonical.x+P),M=E*((h.tileID.canonical.y<<x)-s.canonical.y)):(E=r.a3<<-x,S=r.a3*(h.tileID.canonical.x-(s.canonical.x+P<<-x)),M=r.a3*(h.tileID.canonical.y-(s.canonical.y<<-x))),r.ad.ortho(v,0,E,0,E,0,1),r.ad.translate(v,v,[S,M,0])}return new Vp(h.tileID,s.key,v)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[h.id],x=v[s.key];if(g=x?h.getTileByID(x):null,g&&g.hasData()||x===null)return g;let E=g?g.tileID:s,S=E.overscaledZ,M=h.getSource().minzoom,P=[];if(!x){let N=h.getSource().maxzoom;if(s.canonical.z>=N){let B=s.canonical.z-N;h.getSource().reparseOverscaled?(S=Math.max(s.canonical.z+2,h.transform.tileZoom),E=new r.aL(S,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B)):B!==0&&(S=N,E=new r.aL(S,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B))}E.key!==s.key&&(P.push(E.key),g=h.getTile(E))}let k=N=>{P.forEach(B=>{v[B]=N}),P.length=0};for(S-=1;S>=M&&(!g||!g.hasData());S--){g&&k(g.tileID.key);let N=E.calculateScaledKey(S);if(g=h.getTileByID(N),g&&g.hasData())break;let B=v[N];if(B===null)break;B===void 0?P.push(N):g=h.getTileByID(B)}return k(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}}function ds(m,s,h){let g=function(S,M,P){let k=r._.dot(M,S),N=r._.dot(P,[.2126,.7152,.0722]),B=(G,H,q)=>(1-q)*G+q*H,V=B(1-.3*Math.min(N,1),1,Math.min(k+1,1));return B(.92,1,Math.asin(r.at(M[2],-1,1))/Math.PI+.5)*V}(m,[0,0,1],s),v=[0,0,0];r._.scale(v,h.slice(0,3),g);let x=[0,0,0];r._.scale(x,s.slice(0,3),m[2]);let E=[0,0,0];return r._.add(E,v,x),r.b8(E)}let dd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Z_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Eu{static cacheKey(s,h,g,v){let x=`${h}${v?v.cacheKey:""}`;for(let E of g)s.usedDefines.includes(E)&&(x+=`/${E}`);return x}constructor(s,h,g,v,x,E){let S=s.gl;this.program=S.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...E];let M=v?v.getBinderAttributes():[],P=(g.staticAttributes||[]).concat(M),k=v?v.defines():[];k=k.concat(E.map(q=>`#define ${q}`));let N=`#version 300 es
`,B=N+k.concat("precision mediump float;",U_,j_.fragmentSource).join(`
`);for(let q of g.fragmentIncludes)B+=`
${td[q]}`;B+=`
${g.fragmentSource}`;let V=N+k.concat("precision highp float;",U_,j_.vertexSource).join(`
`);for(let q of g.vertexIncludes)V+=`
${td[q]}`;V+=`
${g.vertexSource}`;let G=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(G,B),S.compileShader(G),S.attachShader(this.program,G);let H=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(H,V),S.compileShader(H),S.attachShader(this.program,H),this.attributes={},this.numAttributes=P.length;for(let q=0;q<this.numAttributes;q++)if(P[q]){let W=P[q].startsWith("a_")?P[q]:`a_${P[q]}`;S.bindAttribLocation(this.program,q,W),this.attributes[W]=q}S.linkProgram(this.program),S.deleteShader(H),S.deleteShader(G),this.fixedUniforms=x(s),this.binderUniforms=v?v.getUniforms(s):[],E.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new r.a7(q),u_dem_prev:new r.a7(q),u_dem_tl:new r.a8(q),u_dem_scale:new r.aa(q),u_dem_tl_prev:new r.a8(q),u_dem_scale_prev:new r.aa(q),u_dem_size:new r.aa(q),u_dem_lerp:new r.aa(q),u_exaggeration:new r.aa(q),u_depth:new r.a7(q),u_depth_size_inv:new r.a8(q),u_meter_to_dem:new r.aa(q),u_label_plane_matrix_inv:new r.a6(q)}))(s)),E.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new r.aq(q),u_tile_tr_up:new r.aq(q),u_tile_br_up:new r.aq(q),u_tile_bl_up:new r.aq(q),u_tile_up_scale:new r.aa(q)}))(s)),E.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new r.a6(q),u_fog_range:new r.a8(q),u_fog_color:new r.as(q),u_fog_horizon_blend:new r.aa(q),u_fog_vertical_limit:new r.a8(q),u_fog_temporal_offset:new r.aa(q),u_frustum_tl:new r.aq(q),u_frustum_tr:new r.aq(q),u_frustum_br:new r.aq(q),u_frustum_bl:new r.aq(q),u_globe_pos:new r.aq(q),u_globe_radius:new r.aa(q),u_globe_transition:new r.aa(q),u_is_globe:new r.a7(q),u_viewport:new r.a8(q)}))(s)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new r.as(q)}))(s)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new r.aq(q),u_lighting_directional_dir:new r.aq(q),u_lighting_directional_color:new r.aq(q),u_ground_radiance:new r.aq(q)}))(s)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new r.a6(q),u_light_matrix_1:new r.a6(q),u_fade_range:new r.a8(q),u_shadow_normal_offset:new r.aq(q),u_shadow_intensity:new r.aa(q),u_shadow_texel_size:new r.aa(q),u_shadow_map_resolution:new r.aa(q),u_shadow_direction:new r.aq(q),u_shadow_bias:new r.aq(q),u_shadowmap_0:new r.a7(q),u_shadowmap_1:new r.a7(q)}))(s))}}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(s,h){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(s,h){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(s,h){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(s,h,g,v,x,E,S,M,P,k){let N=s.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;let B=s.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||s._terrain&&s._terrain.renderingToTexture||!dd.includes(this.name))||!(!N.layers3D||!Z_.includes(this.name))))return;let V=B.gl,G=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,B);if(!G)return;let H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");let q=s.getOrCreateProgram(this.name,{config:this.configuration,defines:H});B.program.set(q.program);let W=(ne,ue,ce)=>{if(ue[ne]&&ce[ne])for(let J in ue[ne])ce[ne][J]&&ce[ne][J].set(ce.program,J,ue[ne][J].current)};P&&P.setUniforms(q.program,B,q.binderUniforms,S,{zoom:M}),W("fixedUniforms",this,q),W("terrainUniforms",this,q),W("globeUniforms",this,q),W("fogUniforms",this,q),W("lightsUniforms",this,q),W("shadowUniforms",this,q),G.bind(),B.setColorMode(new r.a([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.C.transparent,[!0,!0,!0,!1])),B.setDepthMode(new r.ae(h.func===V.LESS?V.LEQUAL:h.func,r.ae.ReadOnly,h.range)),B.setStencilMode(r.ag.disabled);let ee=3*E.primitiveLength*2,te=3*E.primitiveOffset*2*2;k&&k>1?V.drawElementsInstanced(V.LINES,ee,V.UNSIGNED_SHORT,te,k):V.drawElements(V.LINES,ee,V.UNSIGNED_SHORT,te),x.bind(),B.program.set(this.program),B.setDepthMode(h),B.setStencilMode(g),B.setColorMode(v)}draw(s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q){let W=s.context,ee=W.gl;if(this.failedToCreate)return;W.program.set(this.program),W.setDepthMode(g),W.setStencilMode(v),W.setColorMode(x),W.setCullFace(E);for(let ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,S[ue]);G&&G.setUniforms(this.program,W,this.binderUniforms,B,{zoom:V});let te={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[h],ne=q&&q>0?1:void 0;for(let ue of N.get()){let ce=ue.vaos||(ue.vaos={});(ce[M]||(ce[M]=new U1)).bind(W,this,P,G?G.getPaintVertexBuffers():[],k,ue.vertexOffset,H||[],ne),q&&q>1?ee.drawElementsInstanced(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2,q):k?ee.drawElements(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2):ee.drawArrays(h,ue.vertexOffset,ue.vertexLength),h===ee.TRIANGLES&&k&&this._drawDebugWireframe(s,g,v,x,k,ue,B,V,G,q)}}}function fd(m,s){let h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,m.transform.tileZoom)/h,v=g*(s.tileID.canonical.x+s.tileID.wrap*h),x=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.bB(s,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let pd=r.ad.create(),jl=(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H)=>{let q=s.style.light,W=q.properties.get("position"),ee=[W.x,W.y,W.z],te=r.bC.create();q.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(te,-s.transform.angle),r._.transformMat3(ee,ee,te));let ne=q.properties.get("color"),ue=s.transform,ce={u_matrix:m,u_lightpos:ee,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:N,u_vertical_scale:B,u_flood_light_intensity:V,u_ground_shadow_factor:G,u_emissive_strength:H};return ue.projection.name==="globe"&&(ce.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ce.u_zoom_transition=M,ce.u_inv_rot_matrix=k,ce.u_merc_center=P,ce.u_up_dir=ue.projection.upVector(new r.aO(0,0,0),P[0]*r.a3,P[1]*r.a3),ce.u_height_lift=S),ce},Ul=(m,s,h)=>({u_matrix:m,u_edge_radius:s,u_vertical_scale:h}),Up=(m,s,h,g,v,x,E,S,M,P,k,N,B,V)=>{let G=jl(m,s,h,g,v,x,E,M,P,k,N,B,V,1,[0,0,0],0),H={u_height_factor:-Math.pow(2,E.overscaledZ)/S.tileSize/8};return r.W(G,fd(s,S),H)},$p=(m,s)=>({u_matrix:m,u_emissive_strength:s}),Gp=(m,s,h,g)=>r.W($p(m,s),fd(h,g)),X_=(m,s,h)=>({u_matrix:m,u_world:h,u_emissive_strength:s}),md=(m,s,h,g,v)=>r.W(Gp(m,s,h,g),{u_world:v}),Hp=(m,s,h,g)=>{let v=r.a3/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},gd=(m,s,h=1)=>({u_matrix:m,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),Tu=r.ad.create(),Fa=(m,s,h,g,v,x,E)=>{let S=m.transform,M=S.projection.name==="globe",P=M?r.bD(S.zoom,s.canonical)*S._pixelsPerMercatorPixel:r.bB(h,1,x),k={u_matrix:s.projMatrix,u_extrude_scale:P,u_intensity:E,u_inv_rot_matrix:Tu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){k.u_inv_rot_matrix=g,k.u_merc_center=v,k.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],k.u_zoom_transition=r.a1(S.zoom);let N=v[0]*r.a3,B=v[1]*r.a3;k.u_up_dir=S.projection.upVector(new r.aO(0,0,0),N,B)}return k};function Y_(m,[s,h,g,v],[x,E]){if(x===E)return[0,0,0,0];let S=255*(m-1)/(m*(E-x));return[s*S,h*S,g*S,v*S]}function qp(m,s,[h,g]){return h===g?0:.5/m+(s-h)*(m-1)/(m*(g-h))}let Su=(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q,W,ee,te,ne)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:k.mix,u_opacity:k.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:r.bE(N.paint.get("raster-saturation")),u_contrast_factor:r.bF(N.paint.get("raster-contrast")),u_spin_weights:Cu(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:V,u_zoom_transition:E,u_merc_center:S,u_cutoff_params:M,u_colorization_mix:Y_(r.bG,H,W),u_colorization_offset:qp(r.bG,q,W),u_color_ramp:G,u_texture_offset:[te/(ee+2*te),ee/(ee+2*te)],u_texture_res:[ee+2*te,ee+2*te],u_emissive_strength:ne});function Cu(m){m*=Math.PI/180;let s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}let qs=.15,Wp=(m,s,h,g,v,x,E,S,M,P,k,N)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:E,u_merc_center:S,u_cutoff_params:M}),Zp=(m,s,h,g,v,x,E,S,M,P)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:h,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:E,u_uv_offset:S,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[qs,qs]}),q1=(m,s,h,g,v,x,E,S,M,P)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[qs,qs]}),To=r.ad.create(),$l=(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q,W)=>{let ee=v.transform,te={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ee.getCameraToCenterDistance(H),u_rotate_symbol:+h,u_aspect_ratio:ee.width/ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+M,u_pitch_with_map:+g,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:To,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:To,u_up_vector:[0,-1,0],u_color_adj_mat:q,u_icon_transition:W||0};return H.name==="globe"&&(te.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],te.u_zoom_transition=N,te.u_inv_rot_matrix=V,te.u_merc_center=B,te.u_camera_forward=ee._camera.forward(),te.u_ecef_origin=r.bH(ee.globeMatrix,k.toUnwrapped()),te.u_tile_matrix=Float32Array.from(ee.globeMatrix),te.u_up_vector=G),te},_d=(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q)=>r.W($l(m,s,h,g,v,x,E,S,M,P,N,B,V,G,H,q),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(q)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.e.devicePixelRatio,u_is_halo:+k,undefined:void 0}),K_=(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H)=>r.W(_d(m,s,h,g,v,x,E,S,!0,M,!0,k,N,B,V,G,H),{u_texsize_icon:P,u_texture_icon:1}),Iu=(m,s,h,g)=>({u_matrix:m,u_emissive_strength:s,u_opacity:h,u_color:g}),Q_=(m,s,h,g,v,x,E,S)=>r.W(function(M,P,k,N,B){let{width:V,height:G}=N.imageManager.getPixelSize(P),H=Math.pow(2,B.tileID.overscaledZ),q=B.tileSize*Math.pow(2,N.transform.tileZoom)/H,W=q*(B.tileID.canonical.x+B.tileID.wrap*H),ee=q*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[V,G],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/r.bB(B,1,N.transform.tileZoom),u_pixel_coord_upper:[W>>16,ee>>16],u_pixel_coord_lower:[65535&W,65535&ee]}}(0,x,E,g,S),{u_matrix:m,u_emissive_strength:s,u_opacity:h}),Xp=new Float32Array(r.ad.identity([])),Du=(m,s,h,g,v,x,E,S,M,P,k,N,B,V=[0,0,0],G)=>{let H=v.style.light,q=H.properties.get("position"),W=[-q.x,-q.y,q.z],ee=r.bC.create();H.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(ee,-v.transform.angle),r._.transformMat3(W,W,ee));let te=k.alphaMode==="MASK",ne=H.properties.get("color").toRenderColor(null),ue=B.paint.get("model-ambient-occlusion-intensity"),ce=B.paint.get("model-color").constantOr(r.C.white).toRenderColor(null),J=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:h,u_node_matrix:g||Xp,u_lightpos:W,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:V,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+te,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[S[0],S[1],S[2],1],u_metallicFactor:M,u_roughnessFactor:P,u_baseColorTexture:Ti.BaseColor,u_metallicRoughnessTexture:Ti.MetallicRoughness,u_normalTexture:Ti.Normal,u_occlusionTexture:Ti.Occlusion,u_emissionTexture:Ti.Emission,u_lutTexture:Ti.LUT,u_color_mix:[ce.r,ce.g,ce.b,J],u_aoIntensity:ue,u_emissive_strength:N,u_occlusionTextureTransform:G||[0,0,0,0]}},J_=(m,s=Xp,h=Xp)=>({u_matrix:m,u_instance:s,u_node_matrix:h}),ey=(m,s,h,g,v)=>({u_matrix:Float32Array.from(m),u_anchorPos:s,u_screenSizePx:h,u_occluderSizePx:g,u_color:v}),W1={fillExtrusion:m=>({u_matrix:new r.a6(m),u_lightpos:new r.aq(m),u_lightintensity:new r.aa(m),u_lightcolor:new r.aq(m),u_vertical_gradient:new r.aa(m),u_opacity:new r.aa(m),u_edge_radius:new r.aa(m),u_ao:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_up_dir:new r.aq(m),u_height_lift:new r.aa(m),u_flood_light_color:new r.aq(m),u_vertical_scale:new r.aa(m),u_flood_light_intensity:new r.aa(m),u_ground_shadow_factor:new r.aq(m),u_emissive_strength:new r.aa(m)}),fillExtrusionDepth:m=>({u_matrix:new r.a6(m),u_edge_radius:new r.aa(m),u_vertical_scale:new r.aa(m)}),fillExtrusionPattern:m=>({u_matrix:new r.a6(m),u_lightpos:new r.aq(m),u_lightintensity:new r.aa(m),u_lightcolor:new r.aq(m),u_vertical_gradient:new r.aa(m),u_height_factor:new r.aa(m),u_edge_radius:new r.aa(m),u_ao:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_up_dir:new r.aq(m),u_height_lift:new r.aa(m),u_image:new r.a7(m),u_texsize:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m),u_opacity:new r.aa(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new r.a6(m),u_opacity:new r.aa(m),u_ao_pass:new r.aa(m),u_meter_to_tile:new r.aa(m),u_ao:new r.a8(m),u_flood_light_intensity:new r.aa(m),u_flood_light_color:new r.aq(m),u_attenuation:new r.aa(m),u_edge_radius:new r.aa(m),u_fb:new r.a7(m),u_fb_size:new r.aa(m)}),fill:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m)}),fillPattern:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_image:new r.a7(m),u_texsize:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m)}),fillOutline:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_world:new r.a8(m)}),fillOutlinePattern:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_world:new r.a8(m),u_image:new r.a7(m),u_texsize:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m)}),circle:r.bI,collisionBox:m=>({u_matrix:new r.a6(m),u_camera_to_center_distance:new r.aa(m),u_extrude_scale:new r.a8(m)}),collisionCircle:m=>({u_matrix:new r.a6(m),u_inv_matrix:new r.a6(m),u_camera_to_center_distance:new r.aa(m),u_viewport_size:new r.a8(m)}),debug:m=>({u_color:new r.a9(m),u_matrix:new r.a6(m),u_overlay:new r.a7(m),u_overlay_scale:new r.aa(m)}),clippingMask:m=>({u_matrix:new r.a6(m)}),heatmap:m=>({u_extrude_scale:new r.aa(m),u_intensity:new r.aa(m),u_matrix:new r.a6(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_up_dir:new r.aq(m)}),heatmapTexture:m=>({u_image:new r.a7(m),u_color_ramp:new r.a7(m),u_opacity:new r.aa(m)}),hillshade:m=>({u_matrix:new r.a6(m),u_image:new r.a7(m),u_latrange:new r.a8(m),u_light:new r.a8(m),u_shadow:new r.a9(m),u_highlight:new r.a9(m),u_emissive_strength:new r.aa(m),u_accent:new r.a9(m)}),hillshadePrepare:m=>({u_matrix:new r.a6(m),u_image:new r.a7(m),u_dimension:new r.a8(m),u_zoom:new r.aa(m)}),line:r.bJ,linePattern:r.bK,raster:m=>({u_matrix:new r.a6(m),u_normalize_matrix:new r.a6(m),u_globe_matrix:new r.a6(m),u_merc_matrix:new r.a6(m),u_grid_matrix:new r.ar(m),u_tl_parent:new r.a8(m),u_scale_parent:new r.aa(m),u_fade_t:new r.aa(m),u_opacity:new r.aa(m),u_image0:new r.a7(m),u_image1:new r.a7(m),u_brightness_low:new r.aa(m),u_brightness_high:new r.aa(m),u_saturation_factor:new r.aa(m),u_contrast_factor:new r.aa(m),u_spin_weights:new r.aq(m),u_perspective_transform:new r.a8(m),u_raster_elevation:new r.aa(m),u_zoom_transition:new r.aa(m),u_merc_center:new r.a8(m),u_cutoff_params:new r.as(m),u_colorization_mix:new r.as(m),u_colorization_offset:new r.aa(m),u_color_ramp:new r.a7(m),u_texture_offset:new r.a8(m),u_texture_res:new r.a8(m),u_emissive_strength:new r.aa(m)}),rasterParticle:m=>({u_matrix:new r.a6(m),u_normalize_matrix:new r.a6(m),u_globe_matrix:new r.a6(m),u_merc_matrix:new r.a6(m),u_grid_matrix:new r.ar(m),u_tl_parent:new r.a8(m),u_scale_parent:new r.aa(m),u_fade_t:new r.aa(m),u_opacity:new r.aa(m),u_image0:new r.a7(m),u_image1:new r.a7(m),u_raster_elevation:new r.aa(m),u_zoom_transition:new r.aa(m),u_merc_center:new r.a8(m),u_cutoff_params:new r.as(m)}),rasterParticleTexture:m=>({u_texture:new r.a7(m),u_opacity:new r.aa(m)}),rasterParticleDraw:m=>({u_particle_texture:new r.a7(m),u_particle_texture_side_len:new r.aa(m),u_tile_offset:new r.a8(m),u_velocity:new r.a7(m),u_color_ramp:new r.a7(m),u_velocity_res:new r.a8(m),u_max_speed:new r.aa(m),u_uv_offset:new r.a8(m),u_data_scale:new r.as(m),u_data_offset:new r.aa(m),u_particle_pos_scale:new r.aa(m),u_particle_pos_offset:new r.a8(m)}),rasterParticleUpdate:m=>({u_particle_texture:new r.a7(m),u_particle_texture_side_len:new r.aa(m),u_velocity:new r.a7(m),u_velocity_res:new r.a8(m),u_max_speed:new r.aa(m),u_speed_factor:new r.aa(m),u_reset_rate:new r.aa(m),u_rand_seed:new r.aa(m),u_uv_offset:new r.a8(m),u_data_scale:new r.as(m),u_data_offset:new r.aa(m),u_particle_pos_scale:new r.aa(m),u_particle_pos_offset:new r.a8(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new r.a7(m),u_is_size_feature_constant:new r.a7(m),u_size_t:new r.aa(m),u_size:new r.aa(m),u_camera_to_center_distance:new r.aa(m),u_rotate_symbol:new r.a7(m),u_aspect_ratio:new r.aa(m),u_fade_change:new r.aa(m),u_matrix:new r.a6(m),u_label_plane_matrix:new r.a6(m),u_coord_matrix:new r.a6(m),u_is_text:new r.a7(m),u_pitch_with_map:new r.a7(m),u_texsize:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_camera_forward:new r.aq(m),u_tile_matrix:new r.a6(m),u_up_vector:new r.aq(m),u_ecef_origin:new r.aq(m),u_texture:new r.a7(m),u_icon_transition:new r.aa(m),u_color_adj_mat:new r.a6(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new r.a7(m),u_is_size_feature_constant:new r.a7(m),u_size_t:new r.aa(m),u_size:new r.aa(m),u_camera_to_center_distance:new r.aa(m),u_rotate_symbol:new r.a7(m),u_aspect_ratio:new r.aa(m),u_fade_change:new r.aa(m),u_matrix:new r.a6(m),u_label_plane_matrix:new r.a6(m),u_coord_matrix:new r.a6(m),u_is_text:new r.a7(m),u_pitch_with_map:new r.a7(m),u_texsize:new r.a8(m),u_texture:new r.a7(m),u_gamma_scale:new r.aa(m),u_device_pixel_ratio:new r.aa(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_camera_forward:new r.aq(m),u_tile_matrix:new r.a6(m),u_up_vector:new r.aq(m),u_ecef_origin:new r.aq(m),u_is_halo:new r.a7(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new r.a7(m),u_is_size_feature_constant:new r.a7(m),u_size_t:new r.aa(m),u_size:new r.aa(m),u_camera_to_center_distance:new r.aa(m),u_rotate_symbol:new r.a7(m),u_aspect_ratio:new r.aa(m),u_fade_change:new r.aa(m),u_matrix:new r.a6(m),u_label_plane_matrix:new r.a6(m),u_coord_matrix:new r.a6(m),u_is_text:new r.a7(m),u_pitch_with_map:new r.a7(m),u_texsize:new r.a8(m),u_texsize_icon:new r.a8(m),u_texture:new r.a7(m),u_texture_icon:new r.a7(m),u_gamma_scale:new r.aa(m),u_device_pixel_ratio:new r.aa(m),u_is_halo:new r.a7(m)}),background:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_opacity:new r.aa(m),u_color:new r.a9(m)}),backgroundPattern:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_opacity:new r.aa(m),u_image:new r.a7(m),u_pattern_tl:new r.a8(m),u_pattern_br:new r.a8(m),u_texsize:new r.a8(m),u_pattern_size:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m)}),terrainRaster:Pa,terrainDepth:Pa,skybox:m=>({u_matrix:new r.a6(m),u_sun_direction:new r.aq(m),u_cubemap:new r.a7(m),u_opacity:new r.aa(m),u_temporal_offset:new r.aa(m)}),skyboxGradient:m=>({u_matrix:new r.a6(m),u_color_ramp:new r.a7(m),u_center_direction:new r.aq(m),u_radius:new r.aa(m),u_opacity:new r.aa(m),u_temporal_offset:new r.aa(m)}),skyboxCapture:m=>({u_matrix_3f:new r.ar(m),u_sun_direction:new r.aq(m),u_sun_intensity:new r.aa(m),u_color_tint_r:new r.as(m),u_color_tint_m:new r.as(m),u_luminance:new r.aa(m)}),globeRaster:m=>({u_proj_matrix:new r.a6(m),u_globe_matrix:new r.a6(m),u_normalize_matrix:new r.a6(m),u_merc_matrix:new r.a6(m),u_zoom_transition:new r.aa(m),u_merc_center:new r.a8(m),u_image0:new r.a7(m),u_grid_matrix:new r.ar(m),u_skirt_height:new r.aa(m),u_far_z_cutoff:new r.aa(m),u_frustum_tl:new r.aq(m),u_frustum_tr:new r.aq(m),u_frustum_br:new r.aq(m),u_frustum_bl:new r.aq(m),u_globe_pos:new r.aq(m),u_globe_radius:new r.aa(m),u_viewport:new r.a8(m)}),globeAtmosphere:m=>({u_frustum_tl:new r.aq(m),u_frustum_tr:new r.aq(m),u_frustum_br:new r.aq(m),u_frustum_bl:new r.aq(m),u_horizon:new r.aa(m),u_transition:new r.aa(m),u_fadeout_range:new r.aa(m),u_color:new r.as(m),u_high_color:new r.as(m),u_space_color:new r.as(m),u_temporal_offset:new r.aa(m),u_horizon_angle:new r.aa(m)}),model:m=>({u_matrix:new r.a6(m),u_lighting_matrix:new r.a6(m),u_normal_matrix:new r.a6(m),u_node_matrix:new r.a6(m),u_lightpos:new r.aq(m),u_lightintensity:new r.aa(m),u_lightcolor:new r.aq(m),u_camera_pos:new r.aq(m),u_opacity:new r.aa(m),u_baseColorFactor:new r.as(m),u_emissiveFactor:new r.as(m),u_metallicFactor:new r.aa(m),u_roughnessFactor:new r.aa(m),u_baseTextureIsAlpha:new r.a7(m),u_alphaMask:new r.a7(m),u_alphaCutoff:new r.aa(m),u_baseColorTexture:new r.a7(m),u_metallicRoughnessTexture:new r.a7(m),u_normalTexture:new r.a7(m),u_occlusionTexture:new r.a7(m),u_emissionTexture:new r.a7(m),u_lutTexture:new r.a7(m),u_color_mix:new r.as(m),u_aoIntensity:new r.aa(m),u_emissive_strength:new r.aa(m),u_occlusionTextureTransform:new r.as(m)}),modelDepth:m=>({u_matrix:new r.a6(m),u_instance:new r.a6(m),u_node_matrix:new r.a6(m)}),groundShadow:m=>({u_matrix:new r.a6(m),u_ground_shadow_factor:new r.aq(m)}),stars:m=>({u_matrix:new r.a6(m),u_up:new r.aq(m),u_right:new r.aq(m),u_intensity_multiplier:new r.aa(m)}),occlusion:m=>({u_matrix:new r.a6(m),u_anchorPos:new r.aq(m),u_screenSizePx:new r.a8(m),u_occluderSizePx:new r.a8(m),u_color:new r.as(m)})};function yd(m,s,h){let g=s.createTileMatrix(m,m.worldSize,h.toUnwrapped());return r.ad.multiply(new Float32Array(16),m.projMatrix,g)}function Z1(m,s,h){if(s.projection.name===h.projection.name)return m.projMatrix;let g=h.clone();return g.setProjection(s.projection),yd(g,s.getProjection(),m)}function Gl(m,s,h){return s.name===h.projection.name?m.projMatrix:yd(h,s,m)}let vd;function Mu(m,s,h,g,v,x,E){let S=m.context,M=S.gl,P=m.transform,k=m.getOrCreateProgram("collisionBox"),N=[],B=0,V=0;for(let ne=0;ne<g.length;ne++){let ue=g[ne],ce=s.getTile(ue),J=ce.getBucket(h);if(!J)continue;let re=Z1(ue,J,P),ie=re;v[0]===0&&v[1]===0||(ie=m.translatePosMatrix(re,ce,v,x));let ge=E?J.textCollisionBox:J.iconCollisionBox,Se=J.collisionCircleArray;if(Se.length>0){let ae=r.ad.create(),Ce=ie;r.ad.mul(ae,J.placementInvProjMatrix,P.glCoordMatrix),r.ad.mul(ae,ae,J.placementViewportMatrix),N.push({circleArray:Se,circleOffset:V,transform:Ce,invTransform:ae,projection:J.getProjection()}),B+=Se.length/4,V=B}ge&&(m.terrain&&m.terrain.setupElevationDraw(ce,k),k.draw(m,M.LINES,r.ae.disabled,r.ag.disabled,m.colorModeForRenderPass(),r.af.disabled,Hp(ie,P,ce,J.getProjection()),h.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,P.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!E||!N.length)return;let G=m.getOrCreateProgram("collisionCircle"),H=new r.bL;H.resize(4*B),H._trim();let q=0;for(let ne of N)for(let ue=0;ue<ne.circleArray.length/4;ue++){let ce=4*ue,J=ne.circleArray[ce+0],re=ne.circleArray[ce+1],ie=ne.circleArray[ce+2],ge=ne.circleArray[ce+3];H.emplace(q++,J,re,ie,ge,0),H.emplace(q++,J,re,ie,ge,1),H.emplace(q++,J,re,ie,ge,2),H.emplace(q++,J,re,ie,ge,3)}(!vd||vd.length<2*B)&&(vd=function(ne){let ue=2*ne,ce=new r.bu;ce.resize(ue),ce._trim();for(let J=0;J<ue;J++){let re=6*J;ce.uint16[re+0]=4*J+0,ce.uint16[re+1]=4*J+1,ce.uint16[re+2]=4*J+2,ce.uint16[re+3]=4*J+2,ce.uint16[re+4]=4*J+3,ce.uint16[re+5]=4*J+0}return ce}(B));let W=S.createIndexBuffer(vd,!0),ee=S.createVertexBuffer(H,r.bM.members,!0);for(let ne of N){let ue={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(te=P).getCameraToCenterDistance(ne.projection),u_viewport_size:[te.width,te.height]};G.draw(m,M.TRIANGLES,r.ae.disabled,r.ag.disabled,m.colorModeForRenderPass(),r.af.disabled,ue,h.id,ee,W,r.b.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,P.zoom)}var te;ee.destroy(),W.destroy()}let Na=r.ad.create();function ty(m){let s=m._camera.getWorldToCamera(m.worldSize,1),h=r.ad.multiply([],s,m.globeMatrix);r.ad.invert(h,h);let g=[0,0,0],v=[0,1,0,0];return r.aA.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],r._.normalize(g,g),g}function X1({width:m,height:s,anchor:h,textOffset:g,textScale:v},x){let{horizontalAlign:E,verticalAlign:S}=r.bQ(h),M=-(E-.5)*m,P=-(S-.5)*s,k=r.bP(h,g);return new r.P((M/v+k[0])*x,(P/v+k[1])*x)}function ny(m,s,h,g,v,x,E,S,M,P,k){let N=m.text.placedSymbolArray,B=m.text.dynamicLayoutVertexArray,V=m.icon.dynamicLayoutVertexArray,G={},H=m.getProjection(),q=Gl(S,H,x),W=x.elevation,ee=H.upVectorScale(S.canonical,x.center.lat,x.worldSize).metersToTile;B.clear();for(let te=0;te<N.length;te++){let ne=N.get(te),{tileAnchorX:ue,tileAnchorY:ce,numGlyphs:J}=ne,re=ne.hidden||!ne.crossTileID||m.allowVerticalPlacement&&!ne.placedOrientation?null:g[ne.crossTileID];if(re){let ie=0,ge=0,Se=0;if(W){let Fe=W?W.getAtTileOffset(S,ue,ce):0,[ot,ct,at]=H.upVector(S.canonical,ue,ce);ie=Fe*ot*ee,ge=Fe*ct*ee,Se=Fe*at*ee}let[ae,Ce,Me,$e]=lo(ne.projectedAnchorX+ie,ne.projectedAnchorY+ge,ne.projectedAnchorZ+Se,h?q:E),Ge=fi(x.getCameraToCenterDistance(H),$e),Ve=v.evaluateSizeForFeature(m.textSizeData,P,ne)*Ge/r.bN;h&&(Ve*=m.tilePixelRatio/M);let xe=X1(re,Ve);h?({x:ae,y:Ce,z:Me}=H.projectTilePoint(ue+xe.x,ce+xe.y,S.canonical),[ae,Ce,Me]=lo(ae+ie,Ce+ge,Me+Se,E)):(s&&xe._rotate(-x.angle),ae+=xe.x,Ce+=xe.y,Me=0);let Re=m.allowVerticalPlacement&&ne.placedOrientation===r.aE.vertical?Math.PI/2:0;for(let Fe=0;Fe<J;Fe++)r.aH(B,ae,Ce,Me,Re);k&&ne.associatedIconIndex>=0&&(G[ne.associatedIconIndex]={x:ae,y:Ce,z:Me,angle:Re})}else ka(J,B)}if(k){V.clear();let te=m.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){let ue=te.get(ne),{numGlyphs:ce}=ue,J=G[ne];if(ue.hidden||!J)ka(ce,V);else{let{x:re,y:ie,z:ge,angle:Se}=J;for(let ae=0;ae<ce;ae++)r.aH(V,re,ie,ge,Se)}}m.icon.dynamicLayoutVertexBuffer.updateData(V)}m.text.dynamicLayoutVertexBuffer.updateData(B)}function Yp(m,s,h,g,v,x,E={}){let S=h.paint.get("icon-translate"),M=h.paint.get("text-translate"),P=h.paint.get("icon-translate-anchor"),k=h.paint.get("text-translate-anchor"),N=h.layout.get("icon-rotation-alignment"),B=h.layout.get("text-rotation-alignment"),V=h.layout.get("icon-pitch-alignment"),G=h.layout.get("text-pitch-alignment"),H=h.layout.get("icon-keep-upright"),q=h.layout.get("text-keep-upright"),W=h.paint.get("icon-color-saturation"),ee=h.paint.get("icon-color-contrast"),te=h.paint.get("icon-color-brightness-min"),ne=h.paint.get("icon-color-brightness-max"),ue=h.paint.get("icon-occlusion-opacity").constantOr(0),ce=h.paint.get("text-occlusion-opacity").constantOr(0),J=m.context,re=J.gl,ie=m.transform,ge=N==="map",Se=B==="map",ae=V==="map",Ce=G==="map",Me=ue!==1||ce!==1,$e=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ge=!1,Ve=m.depthModeForSublayer(0,r.ae.ReadOnly),xe=[r.aj(ie.center.lng),r.ak(ie.center.lat)],Re=h.layout.get("text-variable-anchor"),Fe=ie.projection.name==="globe",ot=[],ct=[0,-1,0];for(let at of g){let je=s.getTile(at),He=je.getBucket(h);if(!He||He.projection.name==="mercator"&&Fe||He.fullyClipped)continue;let st=He.projection.name==="globe",pt=st?r.a1(ie.zoom):0,Ot=Gl(at,He.getProjection(),ie),Gt=ie.calculatePixelsToTileUnitsMatrix(je),cn=Re&&He.hasTextData(),on=He.hasIconTextFit()&&cn&&He.hasIconData(),Rn=He.getProjection().createInversionMatrix(ie,at.canonical),Bt=()=>{let un=ge&&h.layout.get("symbol-placement")!=="point",Be=[];Me&&m.symbolParams.useOcclusionQueries&&!st&&!Fe&&Be.push("OCCLUSION_QUERIES");let ut=un||on,Br=h.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&ae&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),Br>0&&Be.push("ICON_TRANSITION"),He.icon.zOffsetVertexBuffer&&Be.push("Z_OFFSET"),W===0&&ee===0&&te===0&&ne===1||Be.push("COLOR_ADJUSTMENT");let On=He.icon.programConfigurations.get(h.id),Te=m.getOrCreateProgram(He.sdfIcons?"symbolSDF":"symbolIcon",{config:On,defines:Be}),Fi,mi=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],$r=He.iconSizeData,Ci=r.aD($r,ie.zoom),ji=ae||ie.pitch!==0,ho=Ra(Ot,je.tileID.canonical,ae,ge,ie,He.getProjection(),Gt),Yi=Nl(Ot,je.tileID.canonical,ae,ge,ie,He.getProjection(),Gt),ea=m.translatePosMatrix(Yi,je,S,P,!0),ta=m.translatePosMatrix(Ot,je,S,P),ms=ut?Na:ho,Yo=ge&&!ae&&!un,gs=ct;!Fe&&!ie.mercatorFromTransition||ge||(gs=ty(ie));let rc=st?gs:ct;if(He.sdfIcons&&!He.iconsInText)Fi=_d($r.kind,Ci,Yo,ae,m,ta,ms,ea,!1,mi,!0,at,pt,xe,Rn,rc,He.getProjection());else{let Za=h.getColorAdjustmentMatrix(W,ee,te,ne);Fi=$l($r.kind,Ci,Yo,ae,m,ta,ms,ea,!1,mi,at,pt,xe,Rn,rc,He.getProjection(),Za,Br)}let Qu=je.imageAtlasTexture?je.imageAtlasTexture:null,ic=h.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear,oc=He.sdfIcons||m.options.rotating||m.options.zooming||ic||ji?re.LINEAR:re.NEAREST,Vd=He.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,jd=m.terrain&&ae&&un?r.ad.invert(r.ad.create(),ho):Na;if(un&&He.icon){let Za=ie.elevation,gi=Za?Za.getAtTileOffsetFunc(at,ie.center.lat,ie.worldSize,He.getProjection()):null,Dm=Oa(Ot,je.tileID.canonical,ae,ge,ie,He.getProjection(),Gt);id(He,Ot,m,!1,Dm,Yi,ae,H,gi,at)}return{program:Te,buffers:He.icon,uniformValues:Fi,atlasTexture:Qu,atlasTextureIcon:null,atlasInterpolation:oc,atlasInterpolationIcon:null,isSDF:He.sdfIcons,hasHalo:Vd,tile:je,labelPlaneMatrixInv:jd}},Dn=()=>{let un=Se&&h.layout.get("symbol-placement")!=="point",Be=[],ut=un||Re||on;Me&&m.symbolParams.useOcclusionQueries&&!st&&!Fe&&Be.push("OCCLUSION_QUERIES"),m.terrainRenderModeElevated()&&Ce&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),He.text.zOffsetVertexBuffer&&Be.push("Z_OFFSET");let Br=He.text.programConfigurations.get(h.id),On=m.getOrCreateProgram(He.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Br,defines:Be}),Te,Fi=[0,0],mi=null,$r=He.textSizeData;He.iconsInText&&(Fi=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],mi=je.imageAtlasTexture?je.imageAtlasTexture:null,Te=Ce||ie.pitch!==0||m.options.rotating||m.options.zooming||$r.kind==="composite"||$r.kind==="camera"?re.LINEAR:re.NEAREST);let Ci=je.glyphAtlasTexture?je.glyphAtlasTexture.size:[0,0],ji=r.aD($r,ie.zoom),ho=Ra(Ot,je.tileID.canonical,Ce,Se,ie,He.getProjection(),Gt),Yi=Nl(Ot,je.tileID.canonical,Ce,Se,ie,He.getProjection(),Gt),ea=m.translatePosMatrix(Yi,je,M,k,!0),ta=m.translatePosMatrix(Ot,je,M,k),ms=ut?Na:ho,Yo=Se&&!Ce&&!un,gs=ct;!Fe&&!ie.mercatorFromTransition||Se||(gs=ty(ie));let rc=st?gs:ct,Qu;Qu=He.iconsInText?K_($r.kind,ji,Yo,Ce,m,ta,ms,ea,Ci,Fi,at,pt,xe,Rn,rc,He.getProjection()):_d($r.kind,ji,Yo,Ce,m,ta,ms,ea,!0,Ci,!0,at,pt,xe,Rn,rc,He.getProjection());let ic=je.glyphAtlasTexture?je.glyphAtlasTexture:null,oc=re.LINEAR,Vd=h.paint.get("text-halo-width").constantOr(1)!==0,jd=m.terrain&&Ce&&un?r.ad.invert(r.ad.create(),ho):Na;if(un&&He.text){let Za=ie.elevation,gi=Za?Za.getAtTileOffsetFunc(at,ie.center.lat,ie.worldSize,He.getProjection()):null,Dm=Oa(Ot,je.tileID.canonical,Ce,Se,ie,He.getProjection(),Gt);id(He,Ot,m,!0,Dm,Yi,Ce,q,gi,at)}return{program:On,buffers:He.text,uniformValues:Qu,atlasTexture:ic,atlasTextureIcon:mi,atlasInterpolation:oc,atlasInterpolationIcon:Te,isSDF:!0,hasHalo:Vd,tile:je,labelPlaneMatrixInv:jd}},Gn=He.icon.segments.get().length,kn=He.text.segments.get().length,tn=Gn&&!E.onlyText?Bt():null,Vt=kn&&!E.onlyIcons?Dn():null,Xn=h.paint.get("icon-opacity").constantOr(1),Jn=h.paint.get("text-opacity").constantOr(1);if($e&&He.canOverlap){Ge=!0;let un=Xn&&!E.onlyText?He.icon.segments.get():[],Be=Jn&&!E.onlyIcons?He.text.segments.get():[];for(let ut of un)ot.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:tn});for(let ut of Be)ot.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:Vt})}else E.onlyText||ot.push({segments:Xn?He.icon.segments:new r.b([]),sortKey:0,state:tn}),E.onlyIcons||ot.push({segments:Jn?He.text.segments:new r.b([]),sortKey:0,state:Vt})}Ge&&ot.sort((at,je)=>at.sortKey-je.sortKey);for(let at of ot){let je=at.state;if(je)if(m.terrain&&m.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!1,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),J.activeTexture.set(re.TEXTURE0),je.atlasTexture&&je.atlasTexture.bind(je.atlasInterpolation,re.CLAMP_TO_EDGE,!0),je.atlasTextureIcon&&(J.activeTexture.set(re.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,re.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,je.program),je.hasHalo){let He=je.uniformValues;He.u_is_halo=1,Hl(je.buffers,at.segments,h,m,je.program,Ve,v,x,He,2),He.u_is_halo=0}else{if(je.isSDF){let He=je.uniformValues;je.hasHalo&&(He.u_is_halo=1,Hl(je.buffers,at.segments,h,m,je.program,Ve,v,x,He,1)),He.u_is_halo=0}Hl(je.buffers,at.segments,h,m,je.program,Ve,v,x,je.uniformValues,1)}}}function Hl(m,s,h,g,v,x,E,S,M,P){let k=g.context.gl,N=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];m.occlusionQueryOpacityVertexBuffer.length>0&&N.push(m.occlusionQueryOpacityVertexBuffer),v.draw(g,k.TRIANGLES,x,E,S,r.af.disabled,M,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,g.transform.zoom,m.programConfigurations.get(h.id),N,P)}function Kp(m,s,h,g,v,x,E){let S=m.context.gl,M=h.paint.get("fill-pattern"),P=M&&M.constantOr(1),k,N,B,V,G;E?(N=P&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=S.LINES):(N=P?"fillPattern":"fill",k=S.TRIANGLES);for(let H of g){let q=s.getTile(H);if(P&&!q.patternsLoaded())continue;let W=q.getBucket(h);if(!W)continue;m.prepareDrawTile();let ee=W.programConfigurations.get(h.id),te=m.isTileAffectedByFog(H),ne=m.getOrCreateProgram(N,{config:ee,overrideFog:te});P&&(m.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ee.updatePaintBuffers());let ue=M.constantOr(null);if(ue&&q.imageAtlas){let re=q.imageAtlas.patternPositions[ue.toString()];re&&ee.setConstantPatternPositions(re)}let ce=m.translatePosMatrix(H.projMatrix,q,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),J=h.paint.get("fill-emissive-strength");if(E){V=W.indexBuffer2,G=W.segments2;let re=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];B=N==="fillOutlinePattern"&&P?md(ce,J,m,q,re):X_(ce,J,re)}else V=W.indexBuffer,G=W.segments,B=P?Gp(ce,J,m,q):$p(ce,J);m.uploadCommonUniforms(m.context,ne,H.toUnwrapped()),ne.draw(m,k,v,m.stencilModeForClipping(H),x,r.af.disabled,B,h.id,W.layoutVertexBuffer,V,G,h.paint,m.transform.zoom,ee,void 0)}}function ql(m,s,h,g,v,x,E,S){h.resetLayerRenderingStats(m);let M=m.context,P=M.gl,k=m.transform,N=h.paint.get("fill-extrusion-pattern"),B=N.constantOr(1),V=h.paint.get("fill-extrusion-opacity"),G=m.style.enable3dLights(),H=h.paint.get(G&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H],W=h.layout.get("fill-extrusion-edge-radius"),ee=W>0&&!h.paint.get("fill-extrusion-rounded-roof"),te=ee?0:W,ne=k.projection.name==="globe"?r.bY():0,ue=k.projection.name==="globe",ce=ue?r.a1(k.zoom):0,J=[r.aj(k.center.lng),r.ak(k.center.lat)],re=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ie=h.paint.get("fill-extrusion-flood-light-intensity"),ge=h.paint.get("fill-extrusion-vertical-scale"),Se=us(m,h.paint.get("fill-extrusion-cutoff-fade-range")),ae=h.paint.get("fill-extrusion-emissive-strength"),Ce=[],Me;ue&&Ce.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Ce.push("FAUX_AO"),ee&&Ce.push("ZERO_ROOF_RADIUS"),S&&Ce.push("HAS_CENTROID"),ie>0&&Ce.push("FLOOD_LIGHT"),Se.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");let $e=m.renderPass==="shadow",Ge=m.shadowRenderer,Ve=$e&&!!Ge;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let xe=[0,0,0];if(Ge){let ot=m.style.directionalLight,ct=m.style.ambientLight;ot&&ct&&(xe=hs(m.style,ot,ct)),Me=Ce.concat(["SHADOWS_SINGLE_CASCADE"])}let Re=Ve?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",Fe=h.getLayerRenderingStats();for(let ot of g){let ct=s.getTile(ot),at=ct.getBucket(h);if(!at||at.projection.name!==k.projection.name)continue;let je=!1;Ge&&(je=Ge.getMaxCascadeForTile(ot.toUnwrapped())===0);let He=m.isTileAffectedByFog(ot),st=at.programConfigurations.get(h.id),pt=m.getOrCreateProgram(Re,{config:st,defines:je?Me:Ce,overrideFog:He});if(m.terrain&&m.terrain.setupElevationDraw(ct,pt,{useMeterToDem:!0}),!at.centroidVertexBuffer){let Bt=pt.attributes.a_centroid_pos;Bt!==void 0&&P.vertexAttrib2f(Bt,0,0)}!$e&&Ge&&Ge.setupShadows(ct.tileID.toUnwrapped(),pt,"vector-tile",ct.tileID.overscaledZ),B&&(m.context.activeTexture.set(P.TEXTURE0),ct.imageAtlasTexture&&ct.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),st.updatePaintBuffers());let Ot=N.constantOr(null);if(Ot&&ct.imageAtlas){let Bt=ct.imageAtlas.patternPositions[Ot.toString()];Bt&&st.setConstantPatternPositions(Bt)}let Gt=h.paint.get("fill-extrusion-vertical-gradient"),cn;if($e&&Ge){if(Qp(ct.tileID,at,m))continue;let Bt=Ge.calculateShadowPassMatrixFromTile(ct.tileID.toUnwrapped());cn=Ul(Bt,te,ge)}else{let Bt=m.translatePosMatrix(ot.expandedProjMatrix,ct,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Dn=k.projection.createInversionMatrix(k,ot.canonical);cn=B?Up(Bt,m,Gt,V,q,te,ot,ct,ne,ce,J,Dn,re,ge):jl(Bt,m,Gt,V,q,te,ot,ne,ce,J,Dn,re,ge,ie,xe,ae)}m.uploadCommonUniforms(M,pt,ot.toUnwrapped(),null,Se);let on=at.segments;if(k.projection.name==="mercator"&&!$e&&(on=at.getVisibleSegments(ct.tileID,m.terrain,m.transform.getFrustum(0)),!on.get().length))continue;if(Fe)if($e)for(let Bt of on.get())Fe.numRenderedVerticesInShadowPass+=Bt.primitiveLength;else for(let Bt of on.get())Fe.numRenderedVerticesInTransparentPass+=Bt.primitiveLength;let Rn=[];(m.terrain||S)&&Rn.push(at.centroidVertexBuffer),ue&&Rn.push(at.layoutVertexExtBuffer),pt.draw(m,M.gl.TRIANGLES,v,x,E,r.af.backCCW,cn,h.id,at.layoutVertexBuffer,at.indexBuffer,on,h.paint,m.transform.zoom,st,Rn)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Ri(m,s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q,W,ee){let te=m.context,ne=te.gl,ue=m.transform,ce=m.transform.zoom,J=[],re=us(m,h.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(J.push("CLEAR_SUBPASS"),ee&&(J.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(ne.TEXTURE0),ee.bind(ne.LINEAR,ne.CLAMP_TO_EDGE))):P==="sdf"&&J.push("SDF_SUBPASS"),q&&J.push("HAS_CENTROID"),re.shouldRenderCutoff&&J.push("RENDER_CUTOFF");let ie=h.layout.get("fill-extrusion-edge-radius"),ge=(Se,ae,Ce,Me,$e)=>{let Ge=ae.programConfigurations.get(h.id),Ve=m.isTileAffectedByFog(Se),xe=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ge,defines:J,overrideFog:Ve}),Re=((ot,ct,at,je,He,st,pt,Ot,Gt,cn,on)=>({u_matrix:ct,u_opacity:at,u_ao_pass:je?1:0,u_meter_to_tile:He,u_ao:st,u_flood_light_intensity:pt,u_flood_light_color:Ot,u_attenuation:Gt,u_edge_radius:cn,u_fb:0,u_fb_size:on}))(0,Me,k,M,$e,[N,B*$e],V,G,H,ce>=17?0:ie*$e,ee?ee.size[0]:0),Fe=[];q&&Fe.push(ae.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(te,xe,Se.toUnwrapped(),null,re),xe.draw(m,te.gl.TRIANGLES,v,x,E,S,Re,h.id,ae.vertexBuffer,ae.indexBuffer,Ce,h.paint,ce,Ge,Fe)};for(let Se of g){let ae=s.getTile(Se),Ce=ae.getBucket(h);if(!Ce||Ce.projection.name!==ue.projection.name||!Ce.groundEffect||Ce.groundEffect&&!Ce.groundEffect.hasData())continue;let Me=Ce.groundEffect,$e=1/Ce.tileToMeter;{let Ge=m.translatePosMatrix(Se.projMatrix,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ve=Me.getDefaultSegment();ge(Se,Me,Ve,Ge,$e)}if(W)for(let Ge=0;Ge<4;Ge++){let Ve=r.bZ[Ge](Se),xe=s.getTile(Ve);if(!xe)continue;let Re=xe.getBucket(h);if(!Re||Re.projection.name!==ue.projection.name||!Re.groundEffect||Re.groundEffect&&!Re.groundEffect.hasData())continue;let Fe=Re.groundEffect,ot,ct;Ge===0?(ot=[-r.a3,0,0],ct=1):Ge===1?(ot=[r.a3,0,0],ct=0):Ge===2?(ot=[0,-r.a3,0],ct=3):(ot=[0,r.a3,0],ct=2);let at=Fe.regionSegments[ct];if(!at)continue;let je=new Float32Array(16);r.ad.translate(je,Se.projMatrix,ot),ge(Se,Fe,at,m.translatePosMatrix(je,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$e)}}}function xd(m,s,h,g,v,x,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let S=x?x.findDEMTileFor(h):null;if(!(S&&S.dem||E))return;let M=W=>new r.P(Math.ceil((W+r.c0)*r.c1),0),P=W=>{let ee=s.getSource().minzoom,te=ue=>{let ce=s.getTileByID(ue);if(ce&&ce.hasData())return ce.getBucket(v)},ne=[0,-1,1];for(let ue of ne){if(W.overscaledZ+ue<ee)continue;let ce=te(W.calculateScaledKey(W.overscaledZ+ue));if(ce)return ce}},k=[0,0,0],N=(W,ee)=>(k[0]=Math.min(W.min.y,ee.min.y),k[1]=Math.max(W.max.y,ee.max.y),k[2]=r.a3-ee.min.x>W.max.x?ee.min.x-r.a3:W.max.x,k),B=(W,ee)=>(k[0]=Math.min(W.min.x,ee.min.x),k[1]=Math.max(W.max.x,ee.max.x),k[2]=r.a3-ee.min.y>W.max.y?ee.min.y-r.a3:W.max.y,k),V=[(W,ee)=>N(W,ee),(W,ee)=>N(ee,W),(W,ee)=>B(W,ee),(W,ee)=>B(ee,W)],G=(W,ee,te,ne,ue,ce,J)=>{if(!x)return 0;let re=[[ce?te:W,ce?W:te,0],[ce?te:ee,ce?ee:te,0]],ie=J<0?r.a3+J:J,ge=[ce?ie:(W+ee)/2,ce?(W+ee)/2:ie,0];return te===0&&J<0||te!==0&&J>0?x.getForTilePoints(ue,[ge],!0,ne):re.push(ge),x.getForTilePoints(h,re,!0,S),Math.max(re[0][2],re[1][2],ge[2])/x.exaggeration()};for(let W=0;W<4;W++){let ee=g.borderFeatureIndices[W];if(ee.length===0)continue;let te=r.bZ[W](h),ne=P(te);if(!(ne&&ne instanceof r.b_)||g.borderDoneWithNeighborZ[W]===ne.canonical.z)continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();let ue=x?x.findDEMTileFor(te):null;if(!(ue&&ue.dem||E))continue;let ce=(W<2?1:5)-W,J=ne.borderDoneWithNeighborZ[ce]!==g.canonical.z,re=ne.borderFeatureIndices[ce],ie=0;if(g.canonical.z!==ne.canonical.z){for(let ge of ee)g.showCentroid(g.featuresOnBorder[ge]);if(J)for(let ge of re)ne.showCentroid(ne.featuresOnBorder[ge]);g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}for(let ge of ee){let Se=g.featuresOnBorder[ge],ae=g.centroidData[Se.centroidDataIndex],Ce=Se.borders[W],Me;for(;ie<re.length;){Me=ne.featuresOnBorder[re[ie]];let $e=Me.borders[ce];if($e[1]>Ce[0]+3||$e[0]>Ce[0]-3)break;ne.showCentroid(Me),ie++}if(Me&&ie<re.length){let $e=ie,Ge=0;for(;!(Me.borders[ce][0]>Ce[1]-3)&&(Ge++,++ie!==re.length);)Me=ne.featuresOnBorder[re[ie]];if(Me=ne.featuresOnBorder[re[$e]],Ge>1){let Re=Me.borders[ce];Math.abs(Ce[0]-Re[0])<3&&Math.abs(Ce[1]-Re[1])<3&&(Ge=1,ie=$e+1)}else if(Ge===0){g.showCentroid(Se);continue}let Ve=ne.centroidData[Me.centroidDataIndex];E&&Ge===1&&(((H=ae).flags|(q=Ve).flags)&r.b$?(H.flags|=r.b$,q.flags|=r.b$):(H.flags&=~r.b$,q.flags&=~r.b$));let xe=Se.intersectsCount()>1||Me.intersectsCount()>1;if(Ge>1)ie=$e,ae.centroidXY=Ve.centroidXY=new r.P(0,0);else if(ue&&ue.dem&&!xe){let Re=V[W](ae,Ve),Fe=W%2?r.a3-1:0,ot=G(Re[0],Math.min(r.a3-1,Re[1]),Fe,ue,te,W<2,Re[2]);ae.centroidXY=Ve.centroidXY=M(ot)}else xe?ae.centroidXY=Ve.centroidXY=new r.P(0,0):(ae.centroidXY=g.encodeBorderCentroid(Se),Ve.centroidXY=ne.encodeBorderCentroid(Me));g.writeCentroidToBuffer(ae),ne.writeCentroidToBuffer(Ve)}else g.showCentroid(Se)}g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}var H,q;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}let za=[1,0,0],ry=[0,1,0],bd=[0,0,1];function Qp(m,s,h){let g=h.transform,v=h.shadowRenderer;if(!v)return!0;let x=m.toUnwrapped(),E=g.tileSize*v._cascades[h.currentShadowCascade].scale,S=s.maxHeight;if(g.elevation){let H=g.elevation.getMinMaxForTile(m);H&&(S+=H.max)}let M=[...v.shadowDirection];M[2]=-M[2];let P=v.computeSimplifiedTileShadowVolume(x,S,E,M);if(!P)return!1;let k=[za,ry,bd,M,[M[0],0,M[2]],[0,M[1],M[2]]],N=g.projection.name==="globe",B=g.scaleZoom(E),V=r.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,B,!N),G=v.getCurrentCascadeFrustum();return V.intersectsPrecise(P.vertices,P.planes,k)===0||G.intersectsPrecise(P.vertices,P.planes,k)===0}function Au(m){return[m[0]*r.c2,m[1]*r.c2,m[2]*r.c2,0]}function Pu(m,s,h,g,v,x,E,S,M){let P=g.getSource(),k=h.globeSharedBuffers;if(!k)return;let N,B,V;if(s&&(N=g.getTile(s)),P instanceof r.bm?(B=P.texture,V=r.bh(0,0,h.transform)):N&&s&&(B=N.texture,V=r.bh(s.canonical.z,s.canonical.x,h.transform)),!B||!V)return;m||(V=r.ad.scale(r.ad.create(),V,[1,-1,1]));let G=h.context,H=G.gl,q=v.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR,W=h.colorModeForDrapableLayerRenderPass(x),ee=E.defines;ee.push("GLOBE_POLES");let te=new r.ae(H.LEQUAL,r.ae.ReadWrite,h.depthRangeFor3D),ne=Float32Array.from(h.transform.expandedFarZProjMatrix),ue=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),G.activeTexture.set(H.TEXTURE0),B.bind(q,H.CLAMP_TO_EDGE),G.activeTexture.set(H.TEXTURE1),B.bind(q,H.CLAMP_TO_EDGE),B.useMipmap&&G.extTextureFilterAnisotropic&&h.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);let[ce,J,re,ie]=s?k.getPoleBuffers(s.canonical.z,!1):k.getPoleBuffers(0,!0),ge=v.paint.get("raster-elevation"),Se;m?(Se=ce,h.renderDefaultNorthPole=ge!==0):(Se=J,h.renderDefaultSouthPole=ge!==0);let ae=Au(E.mix),Ce=(($e,Ge,Ve,xe,Re,Fe,ot,ct,at,je,He,st,pt)=>Su($e,Ge,Ve,new Float32Array(16),new Float32Array(9),[0,0],xe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Fe,[0,0],ct,2,je,He,st,1,0,pt))(ne,ue,V,r.a1(h.transform.zoom),0,v,0,ge,0,ae,E.offset,E.range,x),Me=h.getOrCreateProgram("raster",{defines:ee});h.uploadCommonUniforms(G,Me,null),Me.draw(h,H.TRIANGLES,te,M,W,S,Ce,v.id,Se,re,ie)}function bn(m){let s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,v=.2*m.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}function Y1(m,s,h,g){if(m)return s instanceof Vl&&m instanceof r.c3?s.getTextureDescriptor(m,h,!0):{texture:m.texture,mix:Au(g.mix),offset:g.offset,buffer:0,tileSize:1}}function It(m,s,h){if(!m)return null;let g=s.getTextureDescriptor(m,h,!0);if(!g)return null;let{texture:v,mix:x,offset:E,tileSize:S,buffer:M,format:P}=g;if(!v||!P)return null;let k=!1;return P==="uint32"&&(k=!0,x[3]=0,x=Y_(r.c4,x,[0,h.paint.get("raster-particle-max-speed")]),E=qp(r.c4,E,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[M/(S+2*M),S/(S+2*M)],tileSize:S,scalarData:k,scale:x,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function iy(m){let s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,v=.2*m.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}let wd=new r.C(1,0,0,1),Jp=new r.C(0,1,0,1),Wo=new r.C(0,0,1,1),em=new r.C(1,0,1,1),Wl=new r.C(0,1,1,1);function dt(m,s,h,g,v,x,E){let S=m.context,M=m.transform,P=S.gl,k=M.projection.name==="globe",N=k?["PROJECTION_GLOBE_VIEW"]:[],B=r.ad.clone(h.projMatrix);if(k&&r.a1(M.zoom)>0){let ae=r.c5(h.canonical,M),Ce=r.c6(ae);B=r.ad.multiply(new Float32Array(16),M.globeMatrix,Ce),r.ad.multiply(B,M.projMatrix,B)}let V=r.ad.create();V[12]+=2*v/(r.e.devicePixelRatio*M.width),V[13]+=2*x/(r.e.devicePixelRatio*M.height),r.ad.multiply(B,V,B);let G=m.getOrCreateProgram("debug",{defines:N}),H=s.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(H,G);let q=r.ae.disabled,W=r.ag.disabled,ee=m.colorModeForRenderPass(),te="$debug";S.activeTexture.set(P.TEXTURE0),m.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),k?H._makeGlobeTileDebugBuffers(m.context,M):H._makeDebugTileBoundsBuffers(m.context,M.projection);let ne=H._tileDebugBuffer||m.debugBuffer,ue=H._tileDebugIndexBuffer||m.debugIndexBuffer,ce=H._tileDebugSegments||m.debugSegments;if(G.draw(m,P.LINE_STRIP,q,W,ee,r.af.disabled,gd(B,g),te,ne,ue,ce,null,null,null,[H._globeTileDebugBorderBuffer]),E){let ae=H.latestRawTileData,Ce=Math.floor((ae&&ae.byteLength||0)/1024),Me=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Me+=` => ${h.overscaledZ}`),Me+=` ${H.state}`,Me+=` ${Ce}kb`,function($e,Ge){$e.initDebugOverlayCanvas();let Ve=$e.debugOverlayCanvas,xe=$e.context.gl,Re=$e.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,Ve.width,Ve.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(Ge,5,5),Re.strokeText(Ge,5,5),$e.debugOverlayTexture.update(Ve),$e.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(m,Me)}let J=s.getTile(h).tileSize,re=512/Math.min(J,512)*(h.overscaledZ/M.zoom)*.5,ie=H._tileDebugTextBuffer||m.debugBuffer,ge=H._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Se=H._tileDebugTextSegments||m.debugSegments;G.draw(m,P.TRIANGLES,q,W,r.a.alphaBlended,r.af.disabled,gd(B,r.C.transparent,re),te,ie,ge,Se,null,null,null,[H._globeTileDebugTextBuffer])}function wn(m,s,h,g){Oi(m,0,s+h/2,m.transform.width,h,g)}function En(m,s,h,g){Oi(m,s-h/2,0,h,m.transform.height,g)}function Oi(m,s,h,g,v,x){let E=m.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*r.e.devicePixelRatio,h*r.e.devicePixelRatio,g*r.e.devicePixelRatio,v*r.e.devicePixelRatio),E.clear({color:x}),S.disable(S.SCISSOR_TEST)}let Zl=r.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:yn}=Zl;function So(m,s,h,g){m.emplaceBack(s,h,g)}class Xl{constructor(s){this.vertexArray=new r.c8,this.indices=new r.bu,So(this.vertexArray,-1,-1,1),So(this.vertexArray,1,-1,1),So(this.vertexArray,-1,1,1),So(this.vertexArray,1,1,1),So(this.vertexArray,-1,-1,-1),So(this.vertexArray,1,-1,-1),So(this.vertexArray,-1,1,-1),So(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,yn),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=r.b.simpleSegment(0,0,36,12)}}function Zo(m,s,h,g,v,x){let E=m.context.gl,S=s.paint.get("sky-atmosphere-color"),M=s.paint.get("sky-atmosphere-halo-color"),P=s.paint.get("sky-atmosphere-sun-intensity"),k=((N,B,V,G,H)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:V,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(r.bC.fromMat4(r.bC.create(),g),v,P,S,M);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),h.draw(m,E.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.frontCW,k,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}let Vi=r.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cr{constructor(s){let h=new r.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let g=new r.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Vi.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=r.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let K1=r.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ru{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class tm{constructor(s){this.colorModeAlphaBlendedWriteRGB=new r.a([r.ca,r.cb,r.ca,r.cb],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.ca,r.cc,r.ca,r.cc],r.C.transparent,[!1,!1,!1,!0]),this.params=new Ru,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){let h=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Cr(h);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(k){let N=r.cf(30),B=[];for(let V=0;V<k;++V){let G=2*Math.PI*N(),H=Math.acos(1-2*N())-.5*Math.PI;B.push(r._.fromValues(Math.cos(H)*Math.cos(G),Math.cos(H)*Math.sin(G),Math.sin(H)))}return B}(this.params.starsCount),E=r.cf(300),S=new r.cd,M=new r.bu,P=0;for(let k=0;k<x.length;++k){let N=r._.scale([],x[k],200),B=Math.max(0,1+.01*g*(1*E()-.5)),V=Math.max(0,1+.01*v*(1*E()-.5));S.emplaceBack(N[0],N[1],N[2],-1,-1,B,V),S.emplaceBack(N[0],N[1],N[2],1,-1,B,V),S.emplaceBack(N[0],N[1],N[2],1,1,B,V),S.emplaceBack(N[0],N[1],N[2],-1,1,B,V),M.emplaceBack(P+0,P+1,P+2),M.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=h.createVertexBuffer(S,K1.members),this.starsIdx=h.createIndexBuffer(M),this.starsSegments=r.b.simpleSegment(0,0,S.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,h){let g=s.context,v=g.gl,x=s.transform,E=new r.ae(v.LEQUAL,r.ae.ReadOnly,[0,1]),S=r.a1(x.zoom),M=s.style.getLut(h.scope),P=h.properties.get("color").toRenderColor(M).toArray01(),k=h.properties.get("high-color").toRenderColor(M).toArray01(),N=h.properties.get("space-color").toRenderColor(M).toArray01PremultipliedAlpha(),B=5e-4,V=r.ce(h.properties.get("horizon-blend"),0,1,B,.25),G=r.ba(s,g,x)&&V===B?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,H=s.frameCounter/1e3%1,q=r._.length(x.globeCenterInViewSpace),W=Math.sqrt(Math.pow(q,2)-Math.pow(G,2)),ee=Math.acos(W/q),te=ne=>{let ue=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&ue.push("ALPHA_PASS");let ce=s.getOrCreateProgram("globeAtmosphere",{defines:ue}),J=((ie,ge,Se,ae,Ce,Me,$e,Ge,Ve,xe,Re,Fe)=>({u_frustum_tl:ie,u_frustum_tr:ge,u_frustum_br:Se,u_frustum_bl:ae,u_horizon:Ce,u_transition:Me,u_fadeout_range:$e,u_color:Ge,u_high_color:Ve,u_space_color:xe,u_temporal_offset:Re,u_horizon_angle:Fe}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,S,V,P,k,N,H,ee);s.uploadCommonUniforms(g,ce);let re=this.atmosphereBuffer;re&&ce.draw(s,v.TRIANGLES,E,r.ag.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.af.backCW,J,ne?"atmosphere_glow_alpha":"atmosphere_glow",re.vertexBuffer,re.indexBuffer,re.segments)};te(!1),te(!0)}drawStars(s,h){let g=r.at(h.properties.get("star-intensity"),0,1);if(g===0)return;let v=s.context,x=v.gl,E=s.transform,S=s.getOrCreateProgram("stars"),M=r.av.identity([]);r.av.rotateX(M,M,-E._pitch),r.av.rotateZ(M,M,-E.angle),r.av.rotateX(M,M,r.ab(E._center.lat)),r.av.rotateY(M,M,-r.ab(E._center.lng));let P=r.ad.fromQuat(new Float32Array(16),M),k=r.ad.multiply([],E.starsProjMatrix,P),N=r.bC.fromMat4([],P),B=r.bC.invert([],N),V=[0,1,0];r._.transformMat3(V,V,B),r._.scale(V,V,this.params.sizeMultiplier);let G=[1,0,0];r._.transformMat3(G,G,B),r._.scale(G,G,this.params.sizeMultiplier);let H=(q=V,W=G,ee=g,{u_matrix:Float32Array.from(k),u_up:q,u_right:W,u_intensity_multiplier:ee});var q,W,ee;s.uploadCommonUniforms(v,S),this.starsVx&&this.starsIdx&&S.draw(s,x.TRIANGLES,r.ae.disabled,r.ag.disabled,this.colorModeAlphaBlendedWriteRGB,r.af.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Yl(m,s){let h=[...m],g=s.cameraWorldSizeForFog/s.worldSize,v=r.ad.identity([]);return r.ad.scale(v,v,[g,g,1]),r.ad.multiply(h,v,h),r.ad.multiply(h,s.worldToFogMatrix,h),h}function Ou(m,s,h,g,v){let x=h.material,E=g.context,{baseColorTexture:S,metallicRoughnessTexture:M}=x.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:k,emissionTexture:N}=x;function B(V,G,H){if(V&&(m.push(G),E.activeTexture.set(E.gl.TEXTURE0+H),V.gfxTexture)){let{minFilter:q,magFilter:W,wrapS:ee,wrapT:te}=V.sampler;V.gfxTexture.bindExtraParam(q,W,ee,te)}}B(S,"HAS_TEXTURE_u_baseColorTexture",Ti.BaseColor),B(M,"HAS_TEXTURE_u_metallicRoughnessTexture",Ti.MetallicRoughness),B(P,"HAS_TEXTURE_u_normalTexture",Ti.Normal),B(k,"HAS_TEXTURE_u_occlusionTexture",Ti.Occlusion),B(N,"HAS_TEXTURE_u_emissionTexture",Ti.Emission),v&&(v.texture||(v.texture=new r.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],E.gl.RGBA)),E.activeTexture.set(E.gl.TEXTURE0+Ti.LUT),v.texture&&v.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(h.texcoordBuffer)),h.colorBuffer&&(m.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(h.colorBuffer)),h.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(h.normalBuffer)),h.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(h.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES")}function Ba(m,s,h,g,v,x){let E=h.paint.get("model-opacity"),S=s.context,M=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,s.depthRangeFor3D),P=s.transform,k=m.mesh,N=k.material,B=N.pbrMetallicRoughness,V=s.style.fog,G;G=s.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:r.ad.multiply([],g.zScaleMatrix,m.nodeModelMatrix),r.ad.multiply(G,g.negCameraPosMatrix,G);let H=r.ad.invert([],G);r.ad.transpose(H,H);let q=h.paint.get("model-emissive-strength").constantOr(0),W=Du(new Float32Array(m.worldViewProjection),new Float32Array(G),new Float32Array(H),null,s,E,B.baseColorFactor.toRenderColor(null),N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,q,h),ee={defines:[]},te=[];Ou(ee.defines,te,k,s,h.lut);let ne=s.shadowRenderer;ne&&(ne.useNormalOffset=!1);let ue=null;if(V){let re=Yl(m.nodeModelMatrix,s.transform);if(ue=new Float32Array(re),P.projection.name!=="globe"){let ie=k.aabb.min,ge=k.aabb.max,[Se,ae]=V.getOpacityForBounds(re,ie[0],ie[1],ge[0],ge[1]);ee.overrideFog=Se>=ir||ae>=ir}}let ce=us(s,h.paint.get("model-cutoff-fade-range"));ce.shouldRenderCutoff&&ee.defines.push("RENDER_CUTOFF");let J=s.getOrCreateProgram("model",ee);s.uploadCommonUniforms(S,J,null,ue,ce),s.renderPass!=="shadow"&&ne&&ne.setupShadowsFromMatrix(m.nodeModelMatrix,J),J.draw(s,S.gl.TRIANGLES,M,v,x,k.material.doubleSided?r.af.disabled:r.af.backCCW,W,h.id,k.vertexBuffer,k.indexBuffer,k.segments,h.paint,s.transform.zoom,void 0,te)}function pi(m,s,h,g,v,x,E){let S;S=m.projection.name==="globe"?r.ci(h,m):[...h],r.ad.multiply(S,S,s.matrix);let M=r.ad.multiply([],g,S);if(s.meshes)for(let P of s.meshes){if(P.material.alphaMode!=="BLEND"){E.push({mesh:P,depth:0,modelIndex:v,worldViewProjection:M,nodeModelMatrix:S});continue}let k=r._.transformMat4([],P.centroid,M);k[2]>0&&x.push({mesh:P,depth:k[2],modelIndex:v,worldViewProjection:M,nodeModelMatrix:S})}if(s.children)for(let P of s.children)pi(m,P,h,g,v,x,E)}function ki(m,s,h,g){let v=h.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),E=v.getShadowPassColorMode(),S=v.calculateShadowPassMatrixFromMatrix(s),M=J_(S);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,x,r.ag.disabled,E,r.af.backCCW,M,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,h.transform.zoom,void 0,void 0)}function oy(m,s,h){let g=s.updateZoomBasedPaintProperties(),v=function(x,E,S){let M,P,k,N=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&N>0){let B=x.terrain,V=B.findDEMTileFor(S);V&&V.dem?M=r.ck.create(B,S,V):N=0}if(N===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),N===E.validForExaggeration&&(N===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(let B in E.instancesPerModel){let V=E.instancesPerModel[B];for(let G=0;G<V.instancedDataArray.length;++G){let H=(M?N*M.getElevationAt(0|V.instancedDataArray.float32[16*G],0|V.instancedDataArray.float32[16*G+1],!0,!0):0)+V.instancesEvaluatedElevation[G];V.instancedDataArray.float32[16*G+6]=H,P=P?Math.min(E.terrainElevationMin,H):H,k=k?Math.max(E.terrainElevationMax,H):H}}return E.terrainElevationMin=P||0,E.terrainElevationMax=k||0,E.validForExaggeration=N,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,h);(g||v)&&(s.uploaded=!1,s.upload(m.context))}let Li={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.b6([0,0,0],[r.a3,r.a3,0])};function Or(m,s){let h=1<<m.canonical.z,g=s.getFreeCameraOptions().position,v=s.elevation,x=m.canonical.x/h,E=(m.canonical.x+1)/h,S=m.canonical.y/h,M=(m.canonical.y+1)/h,P=s._centerAltitude;if(v){let V=v.getMinMaxForTile(m);V&&V.max>P&&(P=V.max)}let k=r.at(g.x,x,E)-g.x,N=r.at(g.y,S,M)-g.y,B=r.ax(P,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(k*k+N*N+B*B))}function co(m,s,h,g,v,x,E){let S=m.context,M=m.renderPass==="shadow",P=m.shadowRenderer,k=M&&P?P.getShadowPassDepthMode():new r.ae(S.gl.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D),N=m.isTileAffectedByFog(x);if(h.meshes)for(let B of h.meshes){let V=["MODEL_POSITION_ON_GPU"],G=[],H,q,W;g.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");let ee=us(m,s.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),M&&P)H=m.getOrCreateProgram("modelDepth",{defines:V}),q=J_(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(h.matrix)),W=P.getShadowPassColorMode();else{Ou(V,G,B,m,s.lut),H=m.getOrCreateProgram("model",{defines:V,overrideFog:N});let ne=B.material,ue=ne.pbrMetallicRoughness,ce=s.paint.get("model-opacity"),J=s.paint.get("model-emissive-strength").constantOr(0);q=Du(x.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,m,ce,ue.baseColorFactor.toRenderColor(null),ne.emissiveFactor,ue.metallicFactor,ue.roughnessFactor,ne,J,s,v),P&&(E.shadowUniformsInitialized?H.setShadowUniformValues(S,P.getShadowUniformValues()):(P.setupShadows(x.toUnwrapped(),H,"model-tile",x.overscaledZ),E.shadowUniformsInitialized=!0)),W=ee.shouldRenderCutoff||ce<1||ne.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}m.uploadCommonUniforms(S,H,x.toUnwrapped(),null,ee);let te=B.material.doubleSided?r.af.disabled:r.af.backCCW;if(g.instancedDataArray.length>20)G.push(g.instancedDataBuffer),H.draw(m,S.gl.TRIANGLES,k,r.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,m.transform.zoom,void 0,G,g.instancedDataArray.length);else{let ne=M?"u_instance":"u_normal_matrix";for(let ue=0;ue<g.instancedDataArray.length;++ue)q[ne]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ue,16),H.draw(m,S.gl.TRIANGLES,k,r.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,m.transform.zoom,void 0,G)}}if(h.children)for(let B of h.children)co(m,s,B,g,v,x,E)}let fs=[1,-1,1];function Ur(m,s,h,g){if(!h.modelManager)return!0;let v=h.modelManager;if(!h.shadowRenderer)return!0;let x=h.shadowRenderer,E=s.aabb,S=!0,M=m.maxHeight;if(M===0){let k=0;for(let N in m.instancesPerModel){let B=v.getModel(N,g);B?k=Math.max(k,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):S=!1}M=m.maxScale*k*1.41+m.maxVerticalOffset,S&&(m.maxHeight=M)}E.max[2]=M,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,r._.transformMat4(E.min,E.min,s.tileMatrix),r._.transformMat4(E.max,E.max,s.tileMatrix);let P=E.intersects(x.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=P===2),P===0}function nm(m,s){let h=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],x=m.uniformValues.u_cutoff_params[3];return g===h||x===v?1:r.at(((s-h)/(g-h)-v)/(x-v),0,1)}function Co(m,s,h,g){if(s.pitch<20)return 1;let v=s.getWorldToCameraMatrix(),x=r.ad.multiply([],v,m),E=[...h.min,1],S=r.aA.transformMat4([],E,x),M=S,P=S;E[1]=h.max[1],S=r.aA.transformMat4([],E,x),M=S[1]<M[1]?S:M,P=S[1]>P[1]?S:P,E[0]=h.max[0],S=r.aA.transformMat4([],E,x),M=S[1]<M[1]?S:M,P=S[1]>P[1]?S:P,E[1]=h.min[1],S=r.aA.transformMat4([],E,x),M=S[1]<M[1]?S:M,P=S[1]>P[1]?S:P;let k=r.at(g[0],0,1),N=100*s.pixelsPerMeter*r.at(g[1],0,1),B=r.at(g[2],0,1),V=r._.lerp([],M,P,k),G=Math.tan(.5*s.fovX),H=-V[2]*G;if(N===0)return V[1]<-Math.abs(H)?B:1;let q=(-Math.abs(H)-V[1])/N,W=(te,ne,ue)=>(1-ue)*te+ue*ne,ee=r.at(W(1,B,q),B,1);return W(1,ee,r.at((s.pitch-20)/20,0,1))}class ku{}class Lu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,h,g){{let N=this._storage.get(h.id);if(N)return N.lastUsedFrameIdx=s,N.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),E=new ArrayBuffer(x),S=new Int16Array(E);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));let M=new r.cm;for(let N=0;N<x/2;N+=3){let B=S[N],V=S[N+1],G=S[N+2];M.emplaceBack(B,V),M.emplaceBack(V,G),M.emplaceBack(G,B)}let P=g.bindVertexArrayOES.current,k=new ku;return k.buf=new r.I(g,M),k.lastUsedFrameIdx=s,this._storage.set(h.id,k),g.bindVertexArrayOES.set(P),k.buf}update(s){for(let[h,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(let[s,h]of this._storage)h.buf.destroy(),this._storage.delete(s)}}let Va=r.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class Q1{constructor(s){let h=new r.cn,g=new r.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=r.b.simpleSegment(0,0,h.length,g.length),this.vx=s.createVertexBuffer(h,Va.members),this.idx=s.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let Io={symbol:function(m,s,h,g,v){if(m.renderPass!=="translucent")return;let x=r.ag.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(P,k,N,B,V,G,H){let q=k.transform,W=V==="map",ee=G==="map";for(let te of P){let ne=B.getTile(te),ue=ne.getBucket(N);if(!ue||!ue.text||!ue.text.segments.get().length)continue;let ce=r.aD(ue.textSizeData,q.zoom),J=Gl(te,ue.getProjection(),q),re=q.calculatePixelsToTileUnitsMatrix(ne),ie=Ra(J,ne.tileID.canonical,ee,W,q,ue.getProjection(),re),ge=ue.hasIconTextFit()&&ue.hasIconData();if(ce){let Se=Math.pow(2,q.zoom-ne.tileID.overscaledZ);ny(ue,W,ee,H,r.bO,q,ie,te,Se,ce,ge)}}}(g,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);let S=h.paint.get("icon-opacity").constantOr(1)!==0,M=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(S||M)?Yp(m,s,h,g,x,E):(S&&Yp(m,s,h,g,x,E,{onlyIcons:!0}),M&&Yp(m,s,h,g,x,E,{onlyText:!0}),function(P,k,N,B){if(!P.symbolParams.useOcclusionQueries)return;let V=P.context.gl,G=P.transform,H=N.paint,q=H.get("icon-occlusion-opacity").constantOr(0)!==1,W=H.get("text-occlusion-opacity").constantOr(0)!==1;if(!q&&!W)return;let ee=G.projection.name==="globe";for(let te of B){let ne=k.getTile(te),ue=ne.getBucket(N);if(!ue||ue.projection.name==="mercator"&&ee||ue.fullyClipped)continue;if(ue.projection.name==="globe"){r.w(`Occlusion not supported for globe mode. Layer: ${N.type}`);continue}let ce=Gl(te,ue.getProjection(),G),J=r.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,P.symbolParams.depthOffset,1),re=r.ad.multiply([],J,ce),ie=P.symbolParams.visualizeOcclusions!=="none"?1:P.symbolParams.occlusionQueryFrameWindow;for(let ge=0;ge<ue.symbolInstances.length;ge++){let Se=ue.symbolInstances.get(ge),ae=P.style.placement.opacities[Se.crossTileID];if(ae&&ae.isHidden()||(P.frameCounter+ge)%ie!=0)continue;let Ce=Se.tileAnchorX,Me=Se.tileAnchorY,$e=Se.zOffset,Ge;if(P.symbolParams.visualizeOcclusions==="none"){let ot=ue.queries.get(ge);if(ot){if(!ot.isFree()){if(!ot.isResultAvailable())continue;let ct=ot.consumeResult();Se.occlusionState=ct===0?0:1;continue}Ge=ot}else Ge=new Cl(P.context),ue.queries.set(ge,Ge)}let Ve=P.getOrCreateProgram("occlusion"),xe=P.symbolParams.occluderSize,Re=ey(re,[Ce,Me,$e],[G.width,G.height],[xe,xe],P.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);P.terrain&&P.terrain.setupElevationDraw(ne,Ve,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.begin();let Fe=new r.ae(P.symbolParams.visualizeOcclusions==="zPass"?P.context.gl.ALWAYS:P.context.gl.LEQUAL,r.ae.ReadOnly,P.depthRangeFor3D);Ve.draw(P,V.TRIANGLES,Fe,r.ag.disabled,P.symbolParams.visualizeOcclusions!=="none"?r.a.alphaBlendedNonPremultiplied:r.a.disabled,r.af.disabled,Re,"occlusion",P.occlusionBuffers.vx,P.occlusionBuffers.idx,P.occlusionBuffers.segments),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.end()}}}(m,s,h,g)),s.map.showCollisionBoxes&&(Mu(m,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Mu(m,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,g){if(m.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),S=h.layout.get("circle-sort-key").constantOr(1)!==void 0,M=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;let P=m.context,k=P.gl,N=m.transform,B=m.depthModeForSublayer(0,r.ae.ReadOnly),V=r.ag.disabled,G=m.colorModeForDrapableLayerRenderPass(M),H=N.projection.name==="globe",q=[r.aj(N.center.lng),r.ak(N.center.lat)],W=[];for(let te=0;te<g.length;te++){let ne=g[te],ue=s.getTile(ne),ce=ue.getBucket(h);if(!ce||ce.projection.name!==N.projection.name)continue;let J=ce.programConfigurations.get(h.id),re=r.bR(h),ie=m.isTileAffectedByFog(ne);H&&re.push("PROJECTION_GLOBE_VIEW");let ge=m.getOrCreateProgram("circle",{config:J,defines:re,overrideFog:ie}),Se=ce.layoutVertexBuffer,ae=ce.globeExtVertexBuffer,Ce=ce.indexBuffer,Me=N.projection.createInversionMatrix(N,ne.canonical),$e={programConfiguration:J,program:ge,layoutVertexBuffer:Se,globeExtVertexBuffer:ae,indexBuffer:Ce,uniformValues:r.bS(m,ne,ue,Me,q,h),tile:ue};if(S){let Ge=ce.segments.get();for(let Ve of Ge)W.push({segments:new r.b([Ve]),sortKey:Ve.sortKey,state:$e})}else W.push({segments:ce.segments,sortKey:0,state:$e})}S&&W.sort((te,ne)=>te.sortKey-ne.sortKey);let ee={useDepthForOcclusion:N.depthOcclusionForCircles};for(let te of W){let{programConfiguration:ne,program:ue,layoutVertexBuffer:ce,globeExtVertexBuffer:J,indexBuffer:re,uniformValues:ie,tile:ge}=te.state,Se=te.segments;m.terrain&&m.terrain.setupElevationDraw(ge,ue,ee),m.uploadCommonUniforms(P,ue,ge.tileID.toUnwrapped()),ue.draw(m,k.TRIANGLES,B,V,G,r.af.disabled,ie,h.id,ce,re,Se,h.paint,N.zoom,ne,[J])}},heatmap:function(m,s,h,g){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){let v=m.context,x=v.gl,E=r.ag.disabled,S=new r.a([x.ONE,x.ONE,x.ONE,x.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(V,G,H,q){let W=V.gl,ee=G.width*q,te=G.height*q;V.activeTexture.set(W.TEXTURE1),V.viewport.set([0,0,ee,te]);let ne=H.heatmapFbo;if(!ne||ne&&(ne.width!==ee||ne.height!==te)){ne&&ne.destroy();let ue=W.createTexture();W.bindTexture(W.TEXTURE_2D,ue),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ne=H.heatmapFbo=V.createFramebuffer(ee,te,!0,null),function(ce,J,re,ie,ge,Se){let ae=ce.gl;ae.texImage2D(ae.TEXTURE_2D,0,ce.extRenderToTextureHalfFloat?ae.RGBA16F:ae.RGBA,ge,Se,0,ae.RGBA,ce.extRenderToTextureHalfFloat?ae.HALF_FLOAT:ae.UNSIGNED_BYTE,null),ie.colorAttachment.set(re)}(V,0,ue,ne,ee,te)}else W.bindTexture(W.TEXTURE_2D,ne.colorAttachment.get()),V.bindFramebuffer.set(ne.framebuffer)})(v,m,h,m.transform.projection.name==="globe"?.5:.25),v.clear({color:r.C.transparent});let M=m.transform,P=M.projection.name==="globe",k=P?["PROJECTION_GLOBE_VIEW"]:[],N=P?r.af.frontCCW:r.af.disabled,B=[r.aj(M.center.lng),r.ak(M.center.lat)];for(let V=0;V<g.length;V++){let G=g[V];if(s.hasRenderableParent(G))continue;let H=s.getTile(G),q=H.getBucket(h);if(!q||q.projection.name!==M.projection.name)continue;let W=m.isTileAffectedByFog(G),ee=q.programConfigurations.get(h.id),te=m.getOrCreateProgram("heatmap",{config:ee,defines:k,overrideFog:W}),{zoom:ne}=m.transform;m.terrain&&m.terrain.setupElevationDraw(H,te),m.uploadCommonUniforms(v,te,G.toUnwrapped());let ue=M.projection.createInversionMatrix(M,G.canonical);te.draw(m,x.TRIANGLES,r.ae.disabled,E,S,N,Fa(m,G,H,ue,B,ne,h.paint.get("heatmap-intensity")),h.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,h.paint,m.transform.zoom,ee,P?[q.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,x){let E=v.context,S=E.gl,M=x.heatmapFbo;if(!M)return;E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment.get()),E.activeTexture.set(S.TEXTURE1);let P=x.colorRampTexture;P||(P=x.colorRampTexture=new r.T(E,x.colorRamp,S.RGBA)),P.bind(S.LINEAR,S.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,S.TRIANGLES,r.ae.disabled,r.ag.disabled,v.colorModeForRenderPass(),r.af.disabled,((k,N,B,V)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(m,h))},line:function(m,s,h,g){if(m.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let E=h.paint.get("line-emissive-strength"),S=h.paint.get("line-occlusion-opacity"),M=m.context,P=M.gl,k=h.layout.get("line-z-offset"),N=!k.isConstant()||!!k.constantOr(0),B=N?new r.ae(m.depthOcclusion?P.GREATER:P.LEQUAL,r.ae.ReadOnly,m.depthRangeFor3D):m.depthModeForSublayer(0,r.ae.ReadOnly),V=m.colorModeForDrapableLayerRenderPass(E),G=m.terrain&&m.terrain.renderingToTexture,H=G?1:r.e.devicePixelRatio,q=h.paint.get("line-dasharray"),W=q.constantOr(1),ee=h.layout.get("line-cap"),te=q.constantOr(null),ne=ee.constantOr(null),ue=h.paint.get("line-pattern"),ce=ue.constantOr(1),J=ue.constantOr(null),re=h.paint.get("line-opacity").constantOr(1),ie=!ce&&re!==1||m.depthOcclusion&&S>0&&S<1,ge=h.paint.get("line-gradient"),Se=ce?"linePattern":"line",ae=r.bT(h),Ce;if(G&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(ie=!1),S!==0&&m.depthOcclusion){let $e=h.paint._values["line-opacity"];$e&&$e.value&&$e.value.kind==="constant"?Ce=$e.value:r.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(N&&(m.forceTerrainMode=!0),!N&&S!==0&&m.terrain&&!G)return void r.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Me=ie&&N?m.stencilModeFor3D():r.ag.disabled;for(let $e of g){let Ge=s.getTile($e);if(ce&&!Ge.patternsLoaded())continue;let Ve=Ge.getBucket(h);if(!Ve)continue;m.prepareDrawTile();let xe=Ve.programConfigurations.get(h.id),Re=m.isTileAffectedByFog($e),Fe=m.getOrCreateProgram(Se,{config:xe,defines:N?[...ae,"ELEVATED"]:ae,overrideFog:Re});if(J&&Ge.imageAtlas){let st=Ge.imageAtlas.patternPositions[J.toString()];st&&xe.setConstantPatternPositions(st)}if(!ce&&te&&ne&&Ge.lineAtlas){let st=Ge.lineAtlas.getDash(te,ne);st&&xe.setConstantPatternPositions(st)}let[ot,ct]=h.paint.get("line-trim-offset");(ne==="round"||ne==="square")&&ot!==ct&&(ot===0&&(ot-=1),ct===1&&(ct+=1));let at=G?$e.projMatrix:null,je=ce?r.bU(m,Ge,h,at,H,[ot,ct]):r.bV(m,Ge,h,at,Ve.lineClipsArray.length,H,[ot,ct]);if(ge){let st=Ve.gradients[h.id],pt=st.texture;if(h.gradientVersion!==st.version){let Ot=256;if(h.stepInterpolant){let Gt=s.getSource().maxzoom,cn=$e.canonical.z===Gt?Math.ceil(1<<m.transform.maxZoom-$e.canonical.z):1;Ot=r.at(r.bW(Ve.maxLineLength/r.a3*1024*cn),256,M.maxTextureSize)}st.gradient=r.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:st.gradient||void 0,clips:Ve.lineClipsArray}),st.texture?st.texture.update(st.gradient):st.texture=new r.T(M,st.gradient,P.RGBA),st.version=h.gradientVersion,pt=st.texture}M.activeTexture.set(P.TEXTURE1),pt.bind(h.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}W&&(M.activeTexture.set(P.TEXTURE0),Ge.lineAtlasTexture&&Ge.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),xe.updatePaintBuffers()),ce&&(M.activeTexture.set(P.TEXTURE0),Ge.imageAtlasTexture&&Ge.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xe.updatePaintBuffers()),N&&m.terrain.setupElevationDraw(Ge,Fe),m.uploadCommonUniforms(M,Fe,$e.toUnwrapped());let He=st=>{Ce!=null&&(Ce.value=re*S),Fe.draw(m,P.TRIANGLES,B,st,V,r.af.disabled,je,h.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,h.paint,m.transform.zoom,xe,[Ve.layoutVertexBuffer2,Ve.patternVertexBuffer,Ve.zOffsetVertexBuffer]),Ce!=null&&(Ce.value=re)};if(ie&&!N){let st=m.stencilModeForClipping($e).ref;st===0&&G&&M.clear({stencil:0});let pt={func:P.EQUAL,mask:255};je.u_alpha_discard_threshold=.8,He(new r.ag(pt,st,255,P.KEEP,P.KEEP,P.INVERT)),je.u_alpha_discard_threshold=0,He(new r.ag(pt,st,255,P.KEEP,P.KEEP,P.KEEP))}else ie&&N&&(je.u_alpha_discard_threshold=.001),He(N?Me:m.stencilModeForClipping($e))}ie&&(m.resetStencilClippingMasks(),G&&M.clear({stencil:0})),S===0||m.depthOcclusion||G||m.layersWithOcclusionOpacity.push(m.currentLayer),N&&(m.forceTerrainMode=!1)},fill:function(m,s,h,g){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let E=h.paint.get("fill-emissive-strength"),S=m.colorModeForDrapableLayerRenderPass(E),M=h.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&v.constantOr(r.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===P){let k=m.depthModeForSublayer(1,m.renderPass==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly);Kp(m,s,h,g,k,S,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){let k=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,r.ae.ReadOnly);Kp(m,s,h,g,k,S,!0)}},"fill-extrusion":function(m,s,h,g){let v=h.paint.get("fill-extrusion-opacity"),x=m.context,E=x.gl,S=m.terrain,M=S&&S.renderingToTexture;if(v===0)return;let P=m.conflationActive&&m.style.isLayerClipped(h,s.getSource()),k=m.style.order.indexOf(h.fqid);if(P&&function(N,B,V,G,H){for(let q of G){let W=B.getTile(q).getBucket(V);W&&(W.updateReplacement(q,N.replacementSource,H),W.uploadCentroid(N.context))}}(m,s,h,g,k),S||P)for(let N of g){let B=s.getTile(N).getBucket(h);B&&xd(m.context,s,N,B,h,S,P)}if(m.renderPass==="shadow"&&m.shadowRenderer){let N=m.shadowRenderer;if(S&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let B=N.getShadowPassDepthMode(),V=N.getShadowPassColorMode();ql(m,s,h,g,B,r.ag.disabled,V,P)}else if(m.renderPass==="translucent"){let N=!h.paint.get("fill-extrusion-pattern").constantOr(1),B=h.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!M&&B.a!==0){let V=new r.ae(m.context.gl.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D);v===1&&N?ql(m,s,h,g,V,r.ag.disabled,r.a.unblended,P):(ql(m,s,h,g,V,r.ag.disabled,r.a.disabled,P),ql(m,s,h,g,V,m.stencilModeFor3D(),m.colorModeForRenderPass(),P),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&N&&(!S&&m.transform.projection.name!=="globe"||M)){let V=h.paint.get("fill-extrusion-opacity"),G=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=h.paint.get("fill-extrusion-flood-light-intensity"),W=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ee=G>0&&H>0,te=q>0,ne=(ce,J,re)=>(1-re)*ce+re*J,ue=ce=>{let J=m.depthModeForSublayer(1,r.ae.ReadOnly,E.LEQUAL,!0),re=h.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ie=ne(.1,3,re),ge=m._showOverdrawInspector;if(!ge){let Se=new r.ag({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ae=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);Ri(m,s,h,g,J,Se,ae,r.af.disabled,ce,"sdf",V,G,H,q,W,ie,P,!1)}{let Se=ge?r.ag.disabled:new r.ag({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),ae=ge?m.colorModeForRenderPass():new r.a([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],r.C.transparent,[!0,!0,!0,!0]);Ri(m,s,h,g,J,Se,ae,r.af.disabled,ce,"color",V,G,H,q,W,ie,P,!1)}};if(M){let ce=(J,re,ie)=>{let ge=m.depthModeForSublayer(1,r.ae.ReadOnly,E.LEQUAL,!1),Se=h.paint.get(J?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ae=ne(.1,3,Se);{let Ce=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0]);Ri(m,s,h,g,ge,r.ag.disabled,Ce,r.af.disabled,J,"clear",V,G,H,q,W,ae,P,re)}{let Ce=new r.ag({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Me=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);Ri(m,s,h,g,ge,Ce,Me,r.af.disabled,J,"sdf",V,G,H,q,W,ae,P,re)}{let Ce=J?E.ZERO:E.ONE_MINUS_DST_ALPHA,Me=new r.ag({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),$e=new r.a([Ce,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],r.C.transparent,[!0,!0,!0,!0]);Ri(m,s,h,g,ge,Me,$e,r.af.disabled,J,"color",V,G,H,q,W,ae,P,re)}{let Ce=new r.a([E.ONE,E.ONE,E.ONE,J?E.ZERO:E.ONE],r.C.transparent,[!1,!1,!1,!0],J?E.FUNC_ADD:E.MAX);Ri(m,s,h,g,ge,r.ag.disabled,Ce,r.af.disabled,J,"clear",V,G,H,q,W,ae,P,re,ie)}};if(ee||te){let J;if(m.prepareDrawTile(),S){let re=S.drapeBufferSize[0],ie=S.drapeBufferSize[1];J=S.framebufferCopyTexture,J&&(!J||J.size[0]===re&&J.size[1]===ie)||(J&&J.destroy(),J=S.framebufferCopyTexture=new r.T(x,new r.i({width:re,height:ie}),E.RGBA)),J.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,re,ie,0)}ee&&ce(!0,!1,J),te&&ce(!1,!0,J)}}else ee&&ue(!0),te&&ue(!1)}}},hillshade:function(m,s,h,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;let v=m.context,x=m.terrain&&m.terrain.renderingToTexture,[E,S]=m.renderPass!=="translucent"||x?[{},g]:m.stencilConfigForOverlap(g);for(let M of S){let P=s.getTile(M);if(P.needsHillshadePrepare&&m.renderPass==="offscreen")Go(m,P,h);else if(m.renderPass==="translucent"){let k=m.depthModeForSublayer(0,r.ae.ReadOnly),N=h.paint.get("hillshade-emissive-strength"),B=m.colorModeForDrapableLayerRenderPass(N),V=x&&m.terrain?m.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];G1(m,M,P,h,k,V,B)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,h,g,v,x){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let E=m.transform.projection.name==="globe",S=h.paint.get("raster-elevation")!==0,M=S&&E;if(m.renderElevatedRasterBackface&&!M)return;let P=m.context,k=P.gl,N=s.getSource(),B=function(ce,J,re,ie){let ge=J.paint.get("raster-color"),Se=ce.type==="raster-array",ae=[],Ce=J.paint.get("raster-resampling"),Me=J.paint.get("raster-color-mix"),$e=J.paint.get("raster-color-range"),Ge=[Me[0],Me[1],Me[2],0],Ve=Me[3],xe=Ce==="nearest"?ie.NEAREST:ie.LINEAR;if(Se&&(ae.push("RASTER_ARRAY"),ge||ae.push("RASTER_COLOR"),Ce==="linear"&&ae.push("RASTER_ARRAY_LINEAR"),xe=ie.NEAREST,!$e&&ce.rasterLayers)){let Re=ce.rasterLayers.find(({id:Fe})=>Fe===J.sourceLayer);Re&&Re.fields&&Re.fields.range&&($e=Re.fields.range)}if($e=$e||[0,1],ge){ae.push("RASTER_COLOR"),re.activeTexture.set(ie.TEXTURE2),J.updateColorRamp($e);let Re=J.colorRampTexture;Re||(Re=J.colorRampTexture=new r.T(re,J.colorRamp,ie.RGBA)),Re.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)}return{mix:Ge,range:$e,offset:Ve,defines:ae,resampling:xe}}(N,h,P,k);if(N instanceof r.bm&&!g.length&&!E)return;let V=h.paint.get("raster-emissive-strength"),G=m.colorModeForDrapableLayerRenderPass(V),H=m.terrain&&m.terrain.renderingToTexture,q=!m.options.moving,W=h.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(N instanceof r.bm&&!g.length&&(N.onNorthPole||N.onSouthPole)){let ce=S?m.stencilModeFor3D():r.ag.disabled;return void Pu(!!N.onNorthPole,null,m,s,h,V,B,r.af.disabled,ce)}if(!g.length)return;let[ee,te]=N instanceof r.bm||H?[{},g]:m.stencilConfigForOverlap(g),ne=te[te.length-1].overscaledZ;M&&B.defines.push("PROJECTION_GLOBE_VIEW"),S&&B.defines.push("RENDER_CUTOFF");let ue=(ce,J,re)=>{for(let ie of ce){let ge=ie.toUnwrapped(),Se=s.getTile(ie);if(H&&(!Se||!Se.hasData()))continue;P.activeTexture.set(k.TEXTURE0);let ae=Y1(Se,N,h,B);if(!ae||!ae.texture)continue;let{texture:Ce,mix:Me,offset:$e,tileSize:Ge,buffer:Ve}=ae,xe,Re;H?(xe=r.ae.disabled,Re=ie.projMatrix):S?(xe=new r.ae(k.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D),Re=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(ge,q)):(xe=m.depthModeForSublayer(ie.overscaledZ-ne,h.paint.get("raster-opacity")===1?r.ae.ReadWrite:r.ae.ReadOnly,k.LESS),Re=m.transform.calculateProjMatrix(ge,q));let Fe=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(ie):ee[ie.overscaledZ],ot=x?0:h.paint.get("raster-fade-duration");Se.registerFadeDuration(ot);let ct=s.findLoadedParent(ie,0),at=ud(Se,ct,s,m.transform,ot),je,He;m.terrain&&m.terrain.prepareDrawTile(),P.activeTexture.set(k.TEXTURE0),Ce.bind(W,k.CLAMP_TO_EDGE),P.activeTexture.set(k.TEXTURE1),ct?(ct.texture&&ct.texture.bind(W,k.CLAMP_TO_EDGE),je=Math.pow(2,ct.tileID.overscaledZ-Se.tileID.overscaledZ),He=[Se.tileID.canonical.x*je%1,Se.tileID.canonical.y*je%1]):Ce.bind(W,k.CLAMP_TO_EDGE),Ce.useMipmap&&P.extTextureFilterAnisotropic&&m.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);let st=m.transform,pt,Ot=S?bn(st):[0,0,0,0],Gt,cn,on,Rn,Bt,Dn=0;if(M&&N instanceof r.bm&&N.coordinates.length>3)Gt=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0)))),cn=Float32Array.from(st.globeMatrix),on=Float32Array.from(r.bb(st)),Rn=[r.aj(st.center.lng),r.ak(st.center.lat)],pt=N.elevatedGlobePerspectiveTransform,Bt=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){let Vt=r.bc(ie.canonical);Dn=r.bd(Vt.getCenter().lat),Gt=Float32Array.from(r.bf(r.bg(ie.canonical))),cn=Float32Array.from(st.globeMatrix),on=Float32Array.from(r.bb(st)),Rn=[r.aj(st.center.lng),r.ak(st.center.lat)],pt=[0,0],Bt=Float32Array.from(r.be(ie.canonical,Vt,Dn,st.worldSize/st._pixelsPerMercatorPixel))}else pt=N instanceof r.bm?N.perspectiveTransform:[0,0],Gt=new Float32Array(16),cn=new Float32Array(9),on=new Float32Array(16),Rn=[0,0],Bt=new Float32Array(9);let Gn=Su(Re,Gt,cn,on,Bt,He||[0,0],r.a1(m.transform.zoom),Rn,Ot,je||1,at,h,pt,S?h.paint.get("raster-elevation"):0,2,Me,$e,B.range,Ge,Ve,V),kn=m.isTileAffectedByFog(ie),tn=m.getOrCreateProgram("raster",{defines:B.defines,overrideFog:kn});if(m.uploadCommonUniforms(P,tn,ge),N instanceof r.bm){let Vt=N.elevatedGlobeVertexBuffer,Xn=N.elevatedGlobeIndexBuffer;if(H||!E)N.boundsBuffer&&N.boundsSegments&&tn.draw(m,k.TRIANGLES,xe,r.ag.disabled,G,r.af.disabled,Gn,h.id,N.boundsBuffer,m.quadTriangleIndexBuffer,N.boundsSegments);else if(Vt&&Xn){let Jn=st.zoom<=r.b1?N.elevatedGlobeSegments:N.getSegmentsForLongitude(st.center.lng);Jn&&tn.draw(m,k.TRIANGLES,xe,r.ag.disabled,G,J,Gn,h.id,Vt,Xn,Jn)}}else if(M){xe=new r.ae(k.LEQUAL,r.ae.ReadOnly,m.depthRangeFor3D);let Vt=m.globeSharedBuffers;if(Vt){let[Xn,Jn,un]=Vt.getGridBuffers(Dn,!1);tn.draw(m,k.TRIANGLES,xe,re||Fe,m.colorModeForRenderPass(),J,Gn,h.id,Xn,Jn,un)}}else{let{tileBoundsBuffer:Vt,tileBoundsIndexBuffer:Xn,tileBoundsSegments:Jn}=m.getTileBoundsBuffers(Se);tn.draw(m,k.TRIANGLES,xe,Fe,G,r.af.disabled,Gn,h.id,Vt,Xn,Jn)}}if(!(N instanceof r.bm)&&M)for(let ie of ce){let ge=ie.canonical.y===(1<<ie.canonical.z)-1;ie.canonical.y===0&&Pu(!0,ie,m,s,h,V,B,J,re||r.ag.disabled),ge&&Pu(!1,ie,m,s,h,V,B,J===r.af.frontCW?r.af.backCW:r.af.frontCW,re||r.ag.disabled)}};M?ue(te,m.renderElevatedRasterBackface?r.af.backCW:r.af.frontCW,m.stencilModeFor3D()):ue(te,r.af.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,h,g,v,x){m.renderPass==="offscreen"&&function(E,S,M,P){if(!P.length)return;let k=E.context,N=k.gl,B=S.getSource();if(!(B instanceof Vl))return;let V=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count"))),G=M.particlePositionRGBAImage;if(!G||G.width!==V){let te=function(ne){let ue=ne*ne,ce=new Uint8Array(4*ue),J=function(ie){return ie|=0,ie=Math.imul(2747636419^ie,2654435769),ie=Math.imul(ie^ie>>>16,2654435769),((ie=Math.imul(ie^ie>>>16,2654435769))>>>0)/4294967296},re=1/1.3;for(let ie=0;ie<ue;ie++){let ge=re*(J(2*ie+0)+qs),Se=re*(J(2*ie+1)+qs),ae=255*ge%1,Ce=255*Se%1,Me=ae,$e=Se-Ce/255,Ge=Ce;ce[4*ie+0]=255*(ge-ae/255),ce[4*ie+1]=255*Me,ce[4*ie+2]=255*$e,ce[4*ie+3]=255*Ge}return ce}(V);G=M.particlePositionRGBAImage=new r.i({width:V,height:V},te)}let H=M.particleFramebuffer;H?H.width!==V&&(H.destroy(),H=M.particleFramebuffer=k.createFramebuffer(V,V,!0,null)):H=M.particleFramebuffer=k.createFramebuffer(V,V,!0,null);let q=[];for(let te of P){let ne=S.getTile(te);if(!(ne instanceof r.c3))continue;let ue=It(ne,B,M);if(!ue)continue;let ce=[ne.tileSize,ne.tileSize],J=M.tileFramebuffer;J||(J=M.tileFramebuffer=k.createFramebuffer(ce[0],ce[1],!0,null));let re=ne.rasterParticleState;re||(re=ne.rasterParticleState=new oo(k,te,ce,G));let ie=re.update(M.lastInvalidatedAt);re.particleTextureDimension!==V&&re.updateParticleTexture(te,G);let ge=re.targetColorTexture;re.targetColorTexture=re.backgroundColorTexture,re.backgroundColorTexture=ge;let Se=re.particleTexture0;re.particleTexture0=re.particleTexture1,re.particleTexture1=Se,q.push([te,ue,re,ie])}if(q.length===0)return;let W=r.e.now(),ee=M.previousDrawTimestamp?.001*(W-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=W,M.hasColorMap()){k.activeTexture.set(N.TEXTURE0+2);let te=M.colorRampTexture;te||(te=M.colorRampTexture=new r.T(k,M.colorRamp,N.RGBA)),te.bind(N.LINEAR,N.CLAMP_TO_EDGE)}k.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(te,ne,ue){let ce=te.context,J=ce.gl,re=ne.tileFramebuffer;ce.activeTexture.set(J.TEXTURE0);let ie={u_texture:0,u_opacity:1.05*(Se=ne.paint.get("raster-particle-fade-opacity-factor"))/(Se+.05)},ge=te.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Se;for(let ae of ue){let[,,Ce,Me]=ae;re.colorAttachment.set(Ce.targetColorTexture.texture),ce.viewport.set([0,0,re.width,re.height]),ce.clear({color:r.C.transparent}),Me&&(Ce.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),ge.draw(te,J.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,ie,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments))}}(E,M,q),function(te,ne,ue,ce){let J=te.context,re=J.gl,ie=ue.tileFramebuffer,ge=te.transform.projection.name==="globe",Se=ue.paint.get("raster-particle-max-speed");for(let ae of ce){let[Ce,Me,$e]=ae;J.activeTexture.set(re.TEXTURE0+0),Me.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE),ie.colorAttachment.set($e.targetColorTexture.texture);let Ge=te.getOrCreateProgram("rasterParticleDraw",{defines:Me.defines,overrideFog:!1});J.activeTexture.set(re.TEXTURE0+1);let Ve=Me.scalarData?[]:[0,1,2,3].map(Fe=>r.bZ[Fe](Ce));Ve.push(Ce);let xe=Ce.canonical.x,Re=Ce.canonical.y;for(let Fe of Ve){let ot=ne.getTile(ge?Fe.wrapped():Fe);if(!ot)continue;let ct=ot.rasterParticleState;if(!ct)continue;let at=Fe.canonical.x+(1<<Fe.canonical.z)*(Fe.wrap-Ce.wrap),je=Fe.canonical.y;ct.particleTexture0.bind(re.NEAREST,re.CLAMP_TO_EDGE);let He=Zp(1,ct.particleTexture0.size[0],[at-xe,je-Re],0,Me.texture.size,2,Se,Me.textureOffset,Me.scale,Me.offset);Ge.draw(te,re.POINTS,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,He,ue.id,ct.particleIndexBuffer,void 0,ct.particleSegment)}}}(E,S,M,q),k.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(te,ne,ue,ce){let J=te.context,re=J.gl,ie=ne.paint.get("raster-particle-max-speed"),ge=ce*ne.paint.get("raster-particle-speed-factor")*.15,Se=function(Ce){return Math.pow(Ce,6)}(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),ae=ne.particleFramebuffer;J.viewport.set([0,0,ae.width,ae.height]);for(let Ce of ue){let[,Me,$e]=Ce;J.activeTexture.set(re.TEXTURE0+0),Me.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE),J.activeTexture.set(re.TEXTURE0+1);let Ge=$e.particleTexture0;Ge.bind(re.NEAREST,re.CLAMP_TO_EDGE);let Ve=q1(1,Ge.size[0],0,Me.texture.size,ie,ge,Se,Me.textureOffset,Me.scale,Me.offset);ae.colorAttachment.set($e.particleTexture1.texture),J.clear({color:r.C.transparent}),te.getOrCreateProgram("rasterParticleUpdate",{defines:Me.defines}).draw(te,re.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,Ve,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments)}}(E,M,q,ee)}(m,s,h,g),m.renderPass==="translucent"&&(function(E,S,M,P,k){let N=E.context,B=N.gl,V=!E.options.moving,G=E.transform.projection.name==="globe";if(!P.length)return;let[H,q]=E.stencilConfigForOverlap(P),W=[];G&&W.push("PROJECTION_GLOBE_VIEW");let ee=E.stencilModeFor3D();for(let te of q){let ne=te.toUnwrapped(),ue=S.getTile(te);if(!ue.rasterParticleState)continue;let ce=ue.rasterParticleState,J=100;ue.registerFadeDuration(J);let re=S.findLoadedParent(te,0),ie=ud(ue,re,S,E.transform,J),ge,Se;E.terrain&&E.terrain.prepareDrawTile(),N.activeTexture.set(B.TEXTURE0),ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),N.activeTexture.set(B.TEXTURE1),re&&re.rasterParticleState?(re.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ge=Math.pow(2,re.tileID.overscaledZ-ue.tileID.overscaledZ),Se=[ue.tileID.canonical.x*ge%1,ue.tileID.canonical.y*ge%1]):ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let ae=G?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(ne,V),Ce=E.transform,Me=iy(Ce),$e=r.bc(te.canonical),Ge=r.bd($e.getCenter().lat),Ve,xe,Re,Fe,ot;G?(Ve=Float32Array.from(r.bf(r.bg(te.canonical))),xe=Float32Array.from(Ce.globeMatrix),Re=Float32Array.from(r.bb(Ce)),Fe=[r.aj(Ce.center.lng),r.ak(Ce.center.lat)],ot=Float32Array.from(r.be(te.canonical,$e,Ge,Ce.worldSize/Ce._pixelsPerMercatorPixel))):(Ve=new Float32Array(16),xe=new Float32Array(9),Re=new Float32Array(16),Fe=[0,0],ot=new Float32Array(9));let ct=Wp(ae,Ve,xe,Re,ot,Se||[0,0],r.a1(E.transform.zoom),Fe,Me,ge||1,ie,250),at=E.isTileAffectedByFog(te),je=E.getOrCreateProgram("rasterParticle",{defines:W,overrideFog:at});if(E.uploadCommonUniforms(N,je,ne),G){let He=new r.ae(B.LEQUAL,r.ae.ReadWrite,E.depthRangeFor3D),st=0,pt=E.globeSharedBuffers;if(pt){let[Ot,Gt,cn]=pt.getGridBuffers(Ge,st!==0);je.draw(E,B.TRIANGLES,He,ee,r.a.alphaBlended,r.af.backCCW,ct,M.id,Ot,Gt,cn)}}else{let He=E.depthModeForSublayer(0,r.ae.ReadOnly),st=H[te.overscaledZ],{tileBoundsBuffer:pt,tileBoundsIndexBuffer:Ot,tileBoundsSegments:Gt}=E.getTileBoundsBuffers(ue);je.draw(E,B.TRIANGLES,He,st,r.a.alphaBlended,r.af.disabled,ct,M.id,pt,Ot,Gt)}}E.resetStencilClippingMasks()}(m,s,h,g),m.style.map.triggerRepaint())},background:function(m,s,h,g){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity"),E=h.paint.get("background-emissive-strength");if(x===0)return;let S=m.context,M=S.gl,P=m.transform,k=P.tileSize,N=h.paint.get("background-pattern"),B;if(N!==void 0&&(N===null||(B=m.imageManager.getPattern(N.toString(),h.scope,m.style.getLut(h.scope)),!B)))return;let V=!N&&v.a===1&&x===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==V)return;let G=r.ag.disabled,H=m.depthModeForSublayer(0,V==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly),q=m.colorModeForDrapableLayerRenderPass(E),W=N?"backgroundPattern":"background",ee,te=g;te||(ee=m.getBackgroundTiles(),te=Object.values(ee).map(ne=>ne.tileID)),N&&(S.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context,h.scope));for(let ne of te){let ue=m.isTileAffectedByFog(ne),ce=m.getOrCreateProgram(W,{overrideFog:ue}),J=ne.toUnwrapped(),re=g?ne.projMatrix:m.transform.calculateProjMatrix(J);m.prepareDrawTile();let ie=s?s.getTile(ne):ee?ee[ne.key]:new r.by(ne,k,P.zoom,m),ge=N?Q_(re,E,x,m,0,h.scope,B,{tileID:ne,tileSize:k}):Iu(re,E,x,v.toRenderColor(h.lut));m.uploadCommonUniforms(S,ce,J);let{tileBoundsBuffer:Se,tileBoundsIndexBuffer:ae,tileBoundsSegments:Ce}=m.getTileBoundsBuffers(ie);ce.draw(m,M.TRIANGLES,H,G,q,r.af.disabled,ge,h.id,Se,ae,Ce)}},sky:function(m,s,h){let g=m._atmosphere?r.a1(m.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;let x=m.context,E=h.paint.get("sky-type"),S=new r.ae(x.gl.LEQUAL,r.ae.ReadOnly,[0,1]),M=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?h.needsSkyboxCapture(m)&&(function(P,k,N,B){let V=P.context,G=V.gl,H=k.skyboxFbo;if(!H){H=k.skyboxFbo=V.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new Xl(V),k.skyboxTexture=V.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,k.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let te=0;te<6;++te)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(H.framebuffer),V.viewport.set([0,0,32,32]);let q=k.getCenter(P,!0),W=P.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);r.ad.identity(ee),r.ad.rotateY(ee,ee,.5*-Math.PI),Zo(P,k,W,ee,q,0),r.ad.identity(ee),r.ad.rotateY(ee,ee,.5*Math.PI),Zo(P,k,W,ee,q,1),r.ad.identity(ee),r.ad.rotateX(ee,ee,.5*-Math.PI),Zo(P,k,W,ee,q,2),r.ad.identity(ee),r.ad.rotateX(ee,ee,.5*Math.PI),Zo(P,k,W,ee,q,3),r.ad.identity(ee),Zo(P,k,W,ee,q,4),r.ad.identity(ee),r.ad.rotateY(ee,ee,Math.PI),Zo(P,k,W,ee,q,5),V.viewport.set([0,0,P.width,P.height])}(m,h),h.markSkyboxValid(m)):m.renderPass==="sky"&&function(P,k,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skybox");G.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,k.skyboxTexture);let ee=((te,ne,ue,ce,J)=>({u_matrix:te,u_sun_direction:ne,u_cubemap:0,u_opacity:ce,u_temporal_offset:J}))(q.skyboxMatrix,k.getCenter(P,!1),0,B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,r.ag.disabled,P.colorModeForRenderPass(),r.af.backCW,ee,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(m,h,S,v,M):E==="gradient"&&m.renderPass==="sky"&&function(P,k,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new Xl(G)),G.activeTexture.set(H.TEXTURE0);let ee=k.colorRampTexture;ee||(ee=k.colorRampTexture=new r.T(G,k.colorRamp,H.RGBA)),ee.bind(H.LINEAR,H.CLAMP_TO_EDGE);let te=((ne,ue,ce,J,re)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ue,u_radius:r.ab(ce),u_opacity:J,u_temporal_offset:re}))(q.skyboxMatrix,k.getCenter(P,!1),k.paint.get("sky-gradient-radius"),B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,r.ag.disabled,P.colorModeForRenderPass(),r.af.backCW,te,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(m,h,S,v,M)},debug:function(m,s,h,g,v,x){for(let E=0;E<h.length;E++)if(v){let P=new r.C(g.r*.8,g.g*.8,g.b*.8,1);dt(m,s,h[E],g,-1,-1,x),dt(m,s,h[E],g,-1,1,x),dt(m,s,h[E],g,1,1,x),dt(m,s,h[E],g,1,-1,x),dt(m,s,h[E],P,0,0,x)}else dt(m,s,h[E],g,0,0,x)},custom:function(m,s,h,g){let v=m.context,x=h.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&h.isDraped(s)){if(m.renderPass==="offscreen"){let E=x.prerender;if(E){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){let S=m.transform.pointMerc;E.call(x,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.a1(m.transform.zoom),[S.x,S.y],m.transform.pixelsPerMeterRatio)}else E.call(x,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){let S=x.renderToTile;if(S){let M=g[0].canonical,P=new r.Y(M.x+g[0].wrap*(1<<M.z),M.y,M.z);v.setDepthMode(r.ae.disabled),v.setStencilMode(r.ag.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),S.call(x,v.gl,P),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(r.ag.disabled);let E=x.renderingMode==="3d"?new r.ae(m.context.gl.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,r.ae.ReadOnly);if(v.setDepthMode(E),m.transform.projection.name==="globe"){let S=m.transform.pointMerc;x.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.a1(m.transform.zoom),[S.x,S.y],m.transform.pixelsPerMeterRatio)}else x.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,h,g){if(m.renderPass==="opaque")return;let v=h.paint.get("model-opacity");if(v===0)return;let x=h.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!x||m.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let E=m.shadowRenderer,S=h.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,S||(E.enabled=!1));let M=()=>{E&&(E.useNormalOffset=!0,S||(E.enabled=!0))},P=s.getSource();if(m.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(W,ee,te,ne,ue){let ce=W.transform;if(ce.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${ce.projection.name} projection is not yet implemented`);let J=ce.getFreeCameraOptions().position;if(!W.modelManager)return;let re=W.modelManager;te.modelManager=re;let ie=W.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ge=te._unevaluatedLayout._values["model-id"],Se=vt({},te.layout.get("model-id").parameters),ae=W.style.order.indexOf(te.fqid);for(let Ce of ne){let Me=ee.getTile(Ce).getBucket(te);if(!Me||Me.projection.name!==ce.projection.name)continue;let $e=Me.getModelUris();$e&&!Me.modelsRequested&&(re.addModelsFromBucket($e,ue),Me.modelsRequested=!0);let Ge=Or(Ce,ce);Se.zoom=Ge;let Ve=ge.possiblyEvaluate(Se);if(oy(W,Me,Ce),Li.shadowUniformsInitialized=!1,Li.useSingleShadowCascade=!!ie&&ie.getMaxCascadeForTile(Ce.toUnwrapped())===0,W.renderPass==="shadow"&&ie){if(W.currentShadowCascade===1&&Me.isInsideFirstShadowMapFrustum)continue;let Fe=ce.calculatePosMatrix(Ce.toUnwrapped(),ce.worldSize);if(Li.tileMatrix.set(Fe),Li.shadowTileMatrix=Float32Array.from(ie.calculateShadowPassMatrixFromMatrix(Fe)),Li.aabb.min.fill(0),Li.aabb.max[0]=Li.aabb.max[1]=r.a3,Li.aabb.max[2]=0,Ur(Me,Li,W,te.scope))continue}let xe=1<<Ce.canonical.z,Re=[((J.x-Ce.wrap)*xe-Ce.canonical.x)*r.a3,(J.y*xe-Ce.canonical.y)*r.a3,J.z*xe*r.a3];W.conflationActive&&Object.keys(Me.instancesPerModel).length>0&&W.style.isLayerClipped(te,ee.getSource())&&Me.updateReplacement(Ce,W.replacementSource,ae)&&(Me.uploaded=!1,Me.upload(W.context));for(let Fe in Me.instancesPerModel){let ot=Me.instancesPerModel[Fe];ot.features.length>0&&(Fe=Ve.evaluate(ot.features[0].feature,{}));let ct=re.getModel(Fe,ue);if(ct&&ct.uploaded)for(let at of ct.nodes)co(W,te,at,ot,Re,Ce,Li)}}}(m,s,h,g,P.type==="vector"?h.scope:""),void M();if(!P.loaded())return;if(P.type==="batched-model")return function(W,ee,te,ne){te.resetLayerRenderingStats(W);let ue=W.context,ce=W.transform,J=W.style.fog,re=W.shadowRenderer;if(ce.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ce.projection.name} projection is not yet implemented`);let ie=W.transform.getFreeCameraOptions().position,ge=r._.scale([],[ie.x,ie.y,ie.z],W.transform.worldSize);r._.negate(ge,ge);let Se=r.ad.identity([]),ae=r.cg(ce.center.lat,ce.zoom),Ce=r.ad.fromScaling([],[1,1,1/ae]);r.ad.translate(Se,Se,ge);let Me=te.paint.get("model-opacity"),$e=new r.ae(ue.gl.LEQUAL,r.ae.ReadWrite,W.depthRangeFor3D),Ge=new r.ae(ue.gl.LEQUAL,r.ae.ReadOnly,W.depthRangeFor3D),Ve=new r.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xe=W.renderPass==="shadow",Re=xe&&re?re.getCurrentCascadeFrustum():ce.getFrustum(ce.scaleZoom(ce.worldSize)),Fe=te.paint.get("model-front-cutoff"),ot=Fe[2]<1,ct=us(W,te.paint.get("model-cutoff-fade-range")),at=te.getLayerRenderingStats();(function(je,He,st,pt){let Ot=je.terrain?je.terrain.exaggeration():0,Gt=je.transform.zoom;for(let cn of pt){let on=He.getTile(cn).getBucket(st);on&&(je.conflationActive&&on.updateReplacement(cn,je.replacementSource),on.evaluateScale(je,st),je.terrain&&Ot>0&&on.elevationUpdate(je.terrain,Ot,cn,st.source),on.needsReEvaluation(je,Gt,st)&&on.evaluate(st))}})(W,ee,te,ne),function(){let je,He,st;ot?(je=ne.length-1,He=-1,st=-1):(je=0,He=ne.length,st=1);for(let pt=je;pt!==He;pt+=st){let Ot=ne[pt],Gt=ee.getTile(Ot).getBucket(te);if(!Gt||!Gt.uploaded)continue;let cn=!1;re&&(cn=re.getMaxCascadeForTile(Ot.toUnwrapped())===0);let on=ce.calculatePosMatrix(Ot.toUnwrapped(),ce.worldSize),Rn=Gt.modelTraits,Bt=[];for(let Dn of Gt.getNodesInfo()){if(Dn.hiddenByReplacement||!Dn.node.meshes)continue;let Gn=Dn.node,kn=0;W.terrain&&Gn.elevation&&(kn=Gn.elevation*W.terrain.exaggeration());let tn=Dn.evaluatedScale;if(tn[0]<=1&&tn[1]<=1&&tn[2]<=1&&(()=>{let Te=Dn.aabb;return Ve.min=[...Te.min],Ve.max=[...Te.max],Ve.min[2]+=kn,Ve.max[2]+=kn,r._.transformMat4(Ve.min,Ve.min,on),r._.transformMat4(Ve.max,Ve.max,on),Ve})().intersects(Re)===0)continue;let Vt=[...on],Xn=Gn.anchor?Gn.anchor[0]:0,Jn=Gn.anchor?Gn.anchor[1]:0;r.ad.translate(Vt,Vt,[Xn*(tn[0]-1),Jn*(tn[1]-1),kn]),r._.exactEquals(tn,r.cj)||r.ad.scale(Vt,Vt,tn);let un=r.ad.multiply([],Vt,Gn.matrix),Be=r.ad.multiply([],ce.expandedFarZProjMatrix,un),ut=r.ad.multiply([],ce.expandedFarZProjMatrix,Vt),Br=r.aA.transformMat4([],[Xn,Jn,kn,1],Be)[2];Gn.hidden=!1;let On=Me;xe||(ot&&(On*=Co(Vt,ce,Dn.aabb,Fe)),On*=nm(ct,Br)),On!==0?Bt.push({nodeInfo:Dn,depth:Br,opacity:On,wvpForNode:Be,wvpForTile:ut,nodeModelMatrix:un,tileModelMatrix:Vt}):Gn.hidden=!0}xe||Bt.sort((Dn,Gn)=>!ot||Dn.opacity===1&&Gn.opacity===1?Dn.depth<Gn.depth?-1:1:Dn.opacity===1?-1:Gn.opacity===1?1:Dn.depth>Gn.depth?-1:1);for(let Dn of Bt){let Gn=Dn.nodeInfo,kn=Gn.node,tn=r.ad.multiply([],Ce,Dn.tileModelMatrix);r.ad.multiply(tn,Se,tn);let Vt=r.ad.invert([],tn);r.ad.transpose(Vt,Vt),r.ad.scale(Vt,Vt,fs),tn=r.ad.multiply(tn,tn,kn.matrix);let Xn=W.renderPass==="light-beam",Jn=Rn&r.cl.HasMapboxMeshFeatures,un=Jn?0:Gn.evaluatedRMEA[0][2];for(let Be=0;Be<kn.meshes.length;++Be){let ut=kn.meshes[Be],Br=Be===kn.lightMeshIndex,On=Dn.wvpForNode;if(Br){if(!Xn&&!W.terrain&&W.shadowRenderer){W.currentLayer<W.firstLightBeamLayer&&(W.firstLightBeamLayer=W.currentLayer);continue}On=Dn.wvpForTile}else if(Xn)continue;let Te={defines:[]},Fi=[];if(Ou(Te.defines,Fi,ut,W,te.lut),Jn||Te.defines.push("DIFFUSE_SHADED"),cn&&Te.defines.push("SHADOWS_SINGLE_CASCADE"),at&&(xe?at.numRenderedVerticesInShadowPass+=ut.vertexArray.length:at.numRenderedVerticesInTransparentPass+=ut.vertexArray.length),xe){ki(ut,Dn.nodeModelMatrix,W,te);continue}let mi=null;if(J){let ea=Yl(Dn.nodeModelMatrix,W.transform);if(mi=new Float32Array(ea),ce.projection.name!=="globe"){let ta=ut.aabb.min,ms=ut.aabb.max,[Yo,gs]=J.getOpacityForBounds(ea,ta[0],ta[1],ms[0],ms[1]);Te.overrideFog=Yo>=ir||gs>=ir}}let $r=ut.material,Ci;$r.occlusionTexture&&$r.occlusionTexture.offsetScale&&(Ci=$r.occlusionTexture.offsetScale,Te.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!xe&&re&&(re.useNormalOffset=!!ut.normalBuffer);let ji=W.getOrCreateProgram("model",Te);!xe&&re&&re.setupShadowsFromMatrix(Dn.tileModelMatrix,ji,re.useNormalOffset),W.uploadCommonUniforms(ue,ji,null,mi);let ho=$r.pbrMetallicRoughness;ho.metallicFactor=.9,ho.roughnessFactor=.5;let Yi=Du(new Float32Array(On),new Float32Array(tn),new Float32Array(Vt),new Float32Array(kn.matrix),W,Dn.opacity,ho.baseColorFactor.toRenderColor(null),$r.emissiveFactor,ho.metallicFactor,ho.roughnessFactor,$r,un,te,[0,0,0],Ci);!Br&&(Gn.hasTranslucentParts||Dn.opacity<1)&&ji.draw(W,ue.gl.TRIANGLES,$e,r.ag.disabled,r.a.disabled,r.af.backCCW,Yi,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Fi),ji.draw(W,ue.gl.TRIANGLES,Br?Ge:$e,r.ag.disabled,Br||Dn.opacity<1||Gn.hasTranslucentParts?r.a.alphaBlended:r.a.unblended,r.af.backCCW,Yi,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Fi)}}}}()}(m,s,h,g),void M();let k=P.getModels(),N=[],B=m.transform.getFreeCameraOptions().position,V=r._.scale([],[B.x,B.y,B.z],m.transform.worldSize);r._.negate(V,V);let G=[],H=[],q=0;for(let W of k){let ee=h.paint.get("model-rotation").constantOr(null),te=h.paint.get("model-scale").constantOr(null),ne=h.paint.get("model-translation").constantOr(null);W.computeModelMatrix(m,ee,te,ne,!0,!0,!1);let ue=r.ad.identity([]),ce=r.cg(W.position.lat,m.transform.zoom),J=r.ad.fromScaling([],[1,1,1/ce]);r.ad.translate(ue,ue,V),N.push({zScaleMatrix:J,negCameraPosMatrix:ue});for(let re of W.nodes)pi(m.transform,re,W.matrix,m.transform.expandedFarZProjMatrix,q,G,H);q++}if(G.sort((W,ee)=>ee.depth-W.depth),m.renderPass!=="shadow"){if(v===1)for(let W of H)Ba(W,m,h,N[W.modelIndex],r.ag.disabled,m.colorModeForRenderPass());else{for(let W of H)Ba(W,m,h,N[W.modelIndex],r.ag.disabled,r.a.disabled);for(let W of H)Ba(W,m,h,N[W.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(let W of G)Ba(W,m,h,N[W.modelIndex],r.ag.disabled,m.colorModeForRenderPass());M()}else{for(let W of H)ki(W.mesh,W.nodeModelMatrix,m,h);for(let W of G)ki(W.mesh,W.nodeModelMatrix,m,h);M()}}},sy={model:function(m,s,h){let g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?m.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(h.context)},raster:function(m,s,h){let g=s.getSource();if(!(g instanceof Vl&&g.loaded()))return;let v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=m.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let E=s.getIds().map(S=>s.getTileByID(S));for(let S of E)S.updateNeeded(v,x)&&g.prepareTile(S,v,x)},"raster-particle":function(m,s,h){let g=s.getSource();if(!(g instanceof Vl&&g.loaded()))return;let v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let E=s.getIds().map(S=>s.getTileByID(S));for(let S of E)S.updateNeeded(v,x)&&g.prepareTile(S,v,x)}};class ay{constructor(s,h,g,v){this.context=new uu(s,h),this.occlusionBuffers=new Q1(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=r.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let E of x)this._debugParams.enabledLayers[E]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let E of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],E);this.symbolParams=new Il(v),this.setup(),this.numSublayers=r.bv.maxUnderzooming+r.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ad(this),this._wireframeDebugCache=new Lu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(s,h){let g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jp(this,s));let v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){let h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new jp(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,h){if(this.width=s*r.e.devicePixelRatio,this.height=h*r.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let s=this.context,h=new r.bt;h.emplaceBack(0,0),h.emplaceBack(r.a3,0),h.emplaceBack(0,r.a3),h.emplaceBack(r.a3,r.a3),this.tileExtentBuffer=s.createVertexBuffer(h,r.br.members),this.tileExtentSegments=r.b.simpleSegment(0,0,4,2);let g=new r.bt;g.emplaceBack(0,0),g.emplaceBack(r.a3,0),g.emplaceBack(0,r.a3),g.emplaceBack(r.a3,r.a3),this.debugBuffer=s.createVertexBuffer(g,r.br.members),this.debugSegments=r.b.simpleSegment(0,0,4,5);let v=new r.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,r.br.members),this.viewportSegments=r.b.simpleSegment(0,0,4,2);let x=new r.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(r.a3,0,r.a3,0),x.emplaceBack(0,r.a3,0,r.a3),x.emplaceBack(r.a3,r.a3,r.a3,r.a3),this.mercatorBoundsBuffer=s.createVertexBuffer(x,r.cq.members),this.mercatorBoundsSegments=r.b.simpleSegment(0,0,4,2);let E=new r.bu;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);let S=new r.cr;for(let P of[0,1,3,2,0])S.emplaceBack(P);this.debugIndexBuffer=s.createIndexBuffer(S),this.emptyTexture=new r.T(s,new r.i({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=r.ad.create();let M=this.context.gl;this.stencilClearMode=new r.ag({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,r.ae.disabled,this.stencilClearMode,r.a.disabled,r.af.disabled,cd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(let M of g)if(this._tileClippingMaskIDs[M.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let S of g){let M=h.getTile(S),P=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(M);E.draw(this,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,cd(S.projMatrix),"$clipping",k,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let s=this.nextStencilID++,h=this.context.gl;return new r.ag({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);let h=this.context.gl;return new r.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){let h=this.context.gl,g=s.sort((E,S)=>S.overscaledZ-E.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let E={};for(let S=0;S<x;S++)E[S+v]=new r.ag({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,g]}return[{[v]:r.ag.disabled},g]}colorModeForRenderPass(){let s=this.context.gl;return this._showOverdrawInspector?new r.a([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(s){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new r.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,h,g,v=!1){if(this.depthOcclusion)return new r.ae(this.context.gl.GREATER,r.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return r.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new r.ae(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,h)=>s+h/this._fpsHistory.length,0))}render(s,h){let g=r.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=h;let v=this.style._mergedLayers,x=this.style.order.filter(re=>{let ie=v[re];return!(ie.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ie.type]}),E=x.map(re=>v[re]),S=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(r.e.now()),this.imageManager.beginFrame();let M=0,P=!1;for(let re in S){let ie=S[re];ie.used&&(ie.prepare(this.context),ie.getSource().usedInConflation&&++M)}let k=!1;for(let re of E)re.isHidden(this.transform.zoom)||(re.type==="clip"&&(k=!0),this.prepareLayer(re));let N={},B={},V={},G={},H={};for(let re in S){let ie=S[re];N[re]=ie.getVisibleCoordinates(),B[re]=N[re].slice().reverse(),V[re]=ie.getVisibleCoordinates(!0).reverse(),G[re]=ie.getShadowCasterCoordinates(),H[re]=ie.sortCoordinatesByDistance(N[re])}let q=re=>{let ie=this.style.getLayerSourceCache(re);return ie&&ie.used?ie.getSource():null};if(M||k){let re=[],ie=[],ge=0;for(let Se of E)this.isSourceForClippingOrConflation(Se,q(Se))&&(re.push(Se),ie.push(ge)),ge++;if(re&&(k||re.length>1)){let Se=[];for(let ae=0;ae<re.length;ae++){let Ce=re[ae],Me=ie[ae],$e=this.style.getLayerSourceCache(Ce);if(!$e||!$e.used||!$e.getSource().usedInConflation&&Ce.type!=="clip")continue;let Ge=1/0,Ve=r.cu.None;if(Ce.type==="clip"){Ge=Me;for(let xe of Ce.layout.get("clip-layer-types"))Ve|=xe==="model"?r.cu.Model:xe==="symbol"?r.cu.Symbol:r.cu.FillExtrusion}Se.push({layer:Ce.fqid,cache:$e,order:Ge,clipMask:Ve})}this.replacementSource.setSources(Se),P=!0}}P||this.replacementSource.clear(),this.conflationActive=P,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let re=0;re<E.length;re++){let ie=E[re],ge=ie.cutoffRange();if(this.longestCutoffRange=Math.max(ge,this.longestCutoffRange),ge>0){let Se=q(ie);Se&&(this.minCutoffZoom=Math.max(Se.minzoom,this.minCutoffZoom)),ie.minzoom&&(this.minCutoffZoom=Math.max(ie.minzoom,this.minCutoffZoom))}ie.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=re),this._lastOcclusionLayer=re)}let W=this.style&&this.style.fog;W?(this._fogVisible=W.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=W.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(V),this.opaquePassCutoff=0);let ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(let re in S)for(let ie of N[re]){let ge={min:0,max:0};this.terrain&&(ge=this.terrain.getMinMaxForTile(ie)||ge),ee.addShadowReceiver(ie.toUnwrapped(),ge.min,ge.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new tm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.ct(this.context.gl))return;this.renderPass="offscreen";for(let re of E){let ie=s.getLayerSourceCache(re);if(!re.hasOffscreenPass()||re.isHidden(this.transform.zoom))continue;let ge=ie?B[ie.id]:void 0;(re.type==="custom"||re.type==="raster"||re.type==="raster-particle"||re.isSky()||ge&&ge.length)&&this.renderLayer(this,ie,re,ge)}this.depthRangeFor3D=[0,1-(E.length+2)*this.numSublayers*this.depthEpsilon];let te=this.terrain;te&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&te.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,G)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ne=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ue=(()=>{if(h.showOverdrawInspector)return r.C.black;let re=this.style.fog;if(re&&this.transform.projection.supportsFog){let ie=this.style.getLut(re.scope);if(!ne){let ge=re.properties.get("color").toRenderColor(ie).toArray01();return new r.C(...ge)}if(ne){let ge=re.properties.get("space-color").toRenderColor(ie).toArray01();return new r.C(...ge)}}return r.C.transparent})();if(this.context.clear({color:ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let re=E[this.currentLayer],ie=s.getLayerSourceCache(re);if(re.isSky())continue;let ge=ie?(re.is3D()?H:B)[ie.id]:void 0;this._renderTileClippingMasks(re,ie,ge),this.renderLayer(this,ie,re,ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let re=E[this.currentLayer],ie=s.getLayerSourceCache(re);re.isSky()&&this.renderLayer(this,ie,re,ie?B[ie.id]:void 0)}function ce(re,ie){let ge;return ie&&(ge=(re.type==="symbol"?V:re.is3D()?H:B)[ie.id]),ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let re=E[this.currentLayer];if(re.type==="raster"){let ie=s.getLayerSourceCache(re);this.renderLayer(this,ie,re,ce(re,ie))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let J=0;for(ee&&(J=ee.getShadowCastingLayerCount());this.currentLayer<x.length;){let re=E[this.currentLayer],ie=s.getLayerSourceCache(re);if(re.isSky())++this.currentLayer;else if(te&&this.style.isLayerDraped(re)){if(re.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=te.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(re.is3D()||this.terrain||this._renderTileClippingMasks(re,ie,ie?N[ie.id]:void 0),this.renderLayer(this,ie,re,ce(re,ie)),!te&&ee&&J>0&&re.hasShadowPass()&&--J==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ge;this.currentLayer++){let Se=E[this.currentLayer];if(!Se.hasLightBeamPass())continue;let ae=s.getLayerSourceCache(Se);this.renderLayer(this,ae,Se,ae?B[ae.id]:void 0)}this.currentLayer=ge,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let ge=this.currentLayer;this.depthOcclusion=!0;for(let Se of this.layersWithOcclusionOpacity){this.currentLayer=Se;let ae=E[this.currentLayer],Ce=s.getLayerSourceCache(ae),Me=Ce?B[Ce.id]:void 0;ae.is3D()||this.terrain||this._renderTileClippingMasks(ae,Ce,Ce?N[Ce.id]:void 0),this.renderLayer(this,Ce,ae,Me)}this.depthOcclusion=!1,this.currentLayer=ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let re=null;E.forEach(ie=>{let ge=s.getLayerSourceCache(ie);ge&&!ie.isHidden(this.transform.zoom)&&ge.getVisibleCoordinates().length&&(!re||re.getSource().maxzoom<ge.getSource().maxzoom)&&(re=ge)}),re&&this.options.showTileBoundaries&&Io.debug(this,re,re.getVisibleCoordinates(),r.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Io.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(re){let ie=re.transform.padding;wn(re,re.transform.height-(ie.top||0),3,wd),wn(re,ie.bottom||0,3,Jp),En(re,ie.left||0,3,Wo),En(re,re.transform.width-(ie.right||0),3,em);let ge=re.transform.centerPoint;(function(Se,ae,Ce,Me){Oi(Se,ae-1,Ce-10,2,20,Me),Oi(Se,ae-10,Ce-1,20,2,Me)})(re,ge.x,re.transform.height-ge.y,Wl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),P||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);let{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(s.type);if(sy[s.type]&&(g||this.terrain&&s.type==="custom")){let v=this.style.getLayerSourceCache(s);sy[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||Io[g.type](s,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let s=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){let s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){let h={};for(let g in s){let v=s[g],x=this.context.extTimerQuery,E=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),h[g]=E}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of s)v+=h.getQueryParameter(x,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(x);return v}translatePosMatrix(s,h,g,v,x){if(!g[0]&&!g[1])return s;let E=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(E){let P=Math.sin(E),k=Math.cos(E);g=[g[0]*k-g[1]*P,g[0]*P+g[1]*k]}let S=[x?g[0]:r.bB(h,g[0],this.transform.zoom),x?g[1]:r.bB(h,g[1],this.transform.zoom),0],M=new Float32Array(16);return r.ad.translate(M,s,S),M}saveTileTexture(s){let h=s.size[0],g=this._tileTextures[h];g?g.push(s):this._tileTextures[h]=[s]}getTileTexture(s){let h=this._tileTextures[s];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,h,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(s,h){this.cache=this.cache||{};let g=h&&h.defines||[],v=h&&h.config,x=this.currentGlobalDefines(s,h&&h.overrideFog,h&&h.overrideRtt).concat(g),E=Eu.cacheKey($_[s],s,x,v);return this.cache[E]||(this.cache[E]=new Eu(this.context,s,$_[s],v,W1[s],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,h){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((E,S,M)=>{let P=E.properties.get("direction"),k=E.properties.get("color").toRenderColor(M.getLut(E.scope)).toArray01(),N=E.properties.get("intensity"),B=S.properties.get("color").toRenderColor(M.getLut(S.scope)).toArray01(),V=S.properties.get("intensity"),G=[P.x,P.y,P.z],H=r.bA(B,V),q=r.bA(k,N);return{u_lighting_ambient_color:H,u_lighting_directional_dir:G,u_lighting_directional_color:q,u_ground_radiance:ds(G,q,H)}})(g,v,this.style);h.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,h,g,v,x){if(this.uploadCommonLightUniforms(s,h),this.terrain&&this.terrain.renderingToTexture)return;let E=this.style.fog;if(E){let S=E.getOpacity(this.transform.pitch),M=((P,k,N,B,V,G,H,q,W,ee,te,ne)=>{let ue=P.transform,ce=k.properties.get("color").toRenderColor(P.style.getLut(k.scope)).toArray01();ce[3]=B;let J=P.frameCounter/1e3%1,[re,ie]=k.properties.get("vertical-range");return{u_fog_matrix:N?ue.calculateFogTileMatrix(N):ne||P.identityMat,u_fog_range:k.getFovAdjustedRange(ue._fov),u_fog_color:ce,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(re,ie),ie],u_fog_temporal_offset:J,u_frustum_tl:V,u_frustum_tr:G,u_frustum_br:H,u_frustum_bl:q,u_globe_pos:W,u_globe_radius:ee,u_viewport:te,u_globe_transition:r.a1(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,E,g,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.e.devicePixelRatio,this.transform.height*r.e.devicePixelRatio],v);h.setFogUniformValues(s,M)}x&&h.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){let s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){let s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)h[v.key]=s[v.key]||new r.by(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,h){return!(!s.is3D()||s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||s.sourceLayer!=="building")&&s.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[s.key];return h||(this._cachedTileFogOpacities[s.key]=h=this.style.fog.getOpacityForTile(s)),h[0]>=ir||h[1]>=ir}}class Si{constructor(s,h,g,v){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let g,v;if(s instanceof r.P||typeof s[0]=="number"){let x=r.P.convert(s);g=[x],v=h.isPointAboveHorizon(x)}else{let x=r.P.convert(s[0]),E=r.P.convert(s[1]);g=[x,E],v=r.cv(x,E).every(S=>h.isPointAboveHorizon(S))}return new Si(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return r.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),r.cw(v,s)}bufferedCameraGeometryGlobe(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(h,g,s),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>g.y))+((x.x>h.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(s,h,g,v=0){let x=s.queryPadding/h._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),S=s.tileID.wrap+(E.unwrapped?v:0),M=E.polygon.map(q=>r.cx(s.tileTransform,q,S));if(!r.cy(M,0,0,r.a3,r.a3))return;S=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let P=this.screenGeometryMercator.polygon.map(q=>r.cz(s.tileTransform,q,S)),k=P.map(q=>new r.P(q[0],q[1])),N=h.getFreeCameraOptions().position||new r.Y(0,0,0),B=r.cz(s.tileTransform,N,S),V=P.map(q=>{let W=r._.sub(q,q,B);return r._.normalize(W,W),new r.aT(B,W)}),G=r.bB(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:V,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(H=r.cA(M),H.min.x=r.at(H.min.x,0,r.a3),H.min.y=r.at(H.min.y,0,r.a3),H.max.x=r.at(H.max.x,0,r.a3),H.max.y=r.at(H.max.y,0,r.a3),H),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:G};var H}_bufferedScreenMercator(s,h){let g=im(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,h){let g=im(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,h){let g=function(x,E){let S=r.ad.multiply([],E.pixelMatrix,E.globeMatrix),M=[0,-r.cD,0,1],P=[0,r.cD,0,1],k=[0,0,0,1];r.aA.transformMat4(M,M,S),r.aA.transformMat4(P,P,S),r.aA.transformMat4(k,k,S);let N=new r.P(M[0]/M[3],M[1]/M[3]),B=new r.P(P[0]/P[3],P[1]/P[3]),V=r.cB(x,N)&&M[3]<k[3],G=r.cB(x,B)&&P[3]<k[3];if(!V&&!G)return null;let H=function(J,re,ie){for(let ge=1;ge<J.length;ge++){let Se=Ws(re.pointCoordinate3D(J[ge-1]).x),ae=Ws(re.pointCoordinate3D(J[ge]).x);if(ie<0){if(Se<ae)return{idx:ge,t:-Se/(ae-1-Se)}}else if(ae<Se)return{idx:ge,t:(1-Se)/(ae+1-Se)}}return null}(x,E,V?-1:1);if(!H)return null;let{idx:q,t:W}=H,ee=q>1?rm(x.slice(0,q),E):[],te=q<x.length?rm(x.slice(q),E):[];ee=ee.map(J=>new r.P(Ws(J.x),J.y)),te=te.map(J=>new r.P(Ws(J.x),J.y));let ne=[...ee];ne.length===0&&ne.push(te[te.length-1]);let ue=r.a2(ne[ne.length-1].y,(te.length===0?ee[0]:te[0]).y,W),ce;return ce=V?[new r.P(0,ue),new r.P(0,0),new r.P(1,0),new r.P(1,ue)]:[new r.P(1,ue),new r.P(1,1),new r.P(0,1),new r.P(0,ue)],ne.push(...ce),te.length===0?ne.push(ee[0]):ne.push(...te),{polygon:ne.map(J=>new r.Y(J.x,J.y)),unwrapped:!1}}(s,h);if(g)return g;let v=function(x,E){let S=!1,M=-1/0,P=0;for(let N=0;N<x.length-1;N++)x[N].x>M&&(M=x[N].x,P=N);for(let N=0;N<x.length-1;N++){let B=(P+N)%(x.length-1),V=x[B],G=x[B+1];Math.abs(V.x-G.x)>.5&&(V.x<G.x?(V.x+=1,B===0&&(x[x.length-1].x+=1)):(G.x+=1,B+1===x.length-1&&(x[0].x+=1)),S=!0)}let k=r.aj(E.center.lng);return S&&k<Math.abs(k-1)&&x.forEach(N=>{N.x-=1}),{polygon:x,unwrapped:S}}(rm(s,h).map(x=>new r.P(Ws(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new r.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function rm(m,s){return r.cC(m,h=>{let g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function Ws(m){return m<0?1+m%1:m%1}function im(m){return 100*m|0}function J1(m,s){let h=r.ad.identity([]);return r.ad.scale(h,h,[.5*m.width,.5*-m.height,1]),r.ad.translate(h,h,[1,-1,0]),r.ad.multiply(h,h,m.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function eb(m,s,h,g,v,x,E,S=!1){let M=m.tilesIn(g,E,S);M.sort(Kl);let P=[];for(let N of M)P.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,h,m._state,N,v,x,J1(m.transform,N.tile.tileID),S)});let k=function(N){let B={},V={};for(let G of N){let H=G.queryResults,q=G.wrappedTileID,W=V[q]=V[q]||{};for(let ee in H){let te=H[ee],ne=W[ee]=W[ee]||{},ue=B[ee]=B[ee]||[];for(let ce of te)ne[ce.featureIndex]||(ne[ce.featureIndex]=!0,ue.push(ce))}}return B}(P);for(let N in k)k[N].forEach(B=>{let V=B.feature,G=V.layer;G&&G.type!=="background"&&G.type!=="sky"&&G.type!=="slot"&&(V.source=G.source,G["source-layer"]&&(V.sourceLayer=G["source-layer"]),V.state=V.id!==void 0?m.getFeatureState(G["source-layer"],V.id):{})});return k}function Fu(m,s){let h=m.getRenderableIds().map(x=>m.getTileByID(x)),g=[],v={};for(let x=0;x<h.length;x++){let E=h[x],S=E.tileID.canonical.key;v[S]||(v[S]=!0,E.querySourceFeatures(g,s))}return g}function Kl(m,s){let h=m.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class tb{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let s=!1,h=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:s,visibilityChanged:h});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:s,visibilityChanged:h})}}}onNewFrame(s){this.layersGotHidden=!1;for(let h of this.layers){let g=h.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(s)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(s,h){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,E=this.style.getLayerSourceCache(x),S=1;x.type==="fill-extrusion"&&(S=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let M=E?E.getTile(h):null;if(!M&&E&&h.canonical.z>E.getSource().minzoom){let P=h.scaledTo(Math.min(E.getSource().maxzoom,h.overscaledZ-1));for(;P.overscaledZ>=E.getSource().minzoom&&(M=E.getTile(P),!M&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(x):null,tileID:M?M.tileID:h,verticalScale:S})}s.hasAnyZOffset=!1;let g=!1;for(let v=0;v<s.symbolInstances.length;v++){let x=s.symbolInstances.get(v),E=x.zOffset,S=this._getHeightAtTileOffset(h,x.tileAnchorX,x.tileAnchorY);x.zOffset=S!==Number.NEGATIVE_INFINITY?S:E,g||E===x.zOffset||(g=!0),s.hasAnyZOffset||x.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,h,g,v){let x=h,E=g;if(s.canonical.z!==v.canonical.z){let S=v.canonical,M=1/(1<<s.canonical.z-S.z);x=(h+s.canonical.x*r.a3)*M-S.x*r.a3|0,E=(g+s.canonical.y*r.a3)*M-S.y*r.a3|0}return{tileX:x,tileY:E}}_getHeightAtTileOffset(s,h,g){let v,x;for(let E=0;E<this.layers.length;++E){if(this.layers[E].layer.type!=="fill-extrusion")continue;let{bucket:S,tileID:M,verticalScale:P}=this.currentBuildingBuckets[E];if(!S)continue;let{tileX:k,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,M),B=S.getHeightAtTileCoord(k,N);B&&B.height!==void 0&&(B.hidden?v=B.height:x=Math.max(B.height*P,x||0))}if(x!==void 0)return x;for(let E=0;E<this.layers.length;++E){let S=this.layers[E];if(S.layer.type!=="model"||!S.visible)continue;let{bucket:M,tileID:P}=this.currentBuildingBuckets[E];if(!M)continue;let{tileX:k,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,P),B=M.getHeightAtTileCoord(k,N);if(B&&!B.hidden)return B.height===void 0&&v!==void 0?Math.min(B.maxHeight,v)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ql(m,s){let h={};for(let g in m)g!=="ref"&&(h[g]=m[g]);return r.cE.forEach(g=>{g in s&&(h[g]=s[g])}),h}function om(m){m=m.slice();let s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=Ql(m[h],s[m[h].ref]));return m}let mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ps(m,s,h){h.push({command:mn.addSource,args:[m,s[m]]})}function ly(m,s,h){s.push({command:mn.removeSource,args:[m]}),h[m]=!0}function nb(m,s,h,g){ly(m,h,g),ps(m,s,h)}function rb(m,s,h){let g;for(g in m[h])if(m[h].hasOwnProperty(g)&&g!=="data"&&!w(m[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&g!=="data"&&!w(m[h][g],s[h][g]))return!1;return!0}function Nu(m,s,h,g,v,x){let E;for(E in s=s||{},m=m||{})m.hasOwnProperty(E)&&(w(m[E],s[E])||h.push({command:x,args:[g,E,s[E],v]}));for(E in s)s.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(w(m[E],s[E])||h.push({command:x,args:[g,E,s[E],v]}))}function Ed(m){return m.id}function Jl(m,s){return m[s.id]=s,m}class cy{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=r.at(s,0,1);let h=1,g=this._distances[h],v=s*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];let x=h-1,E=this._distances[x],S=g-E,M=S>0?(v-E)/S:0;return this.points[x].mult(1-M).add(this.points[h].mult(M))}}class sm{constructor(s,h,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,v,x){this._forEachCell(h,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(s,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,h,g,v,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,h,g,v,x,E){this.circleCells[x].push(E)}_query(s,h,g,v,x,E){if(g<0||s>this.width||v<0||h>this.height)return!x&&[];let S=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)S.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){let P=this.circles[3*M],k=this.circles[3*M+1],N=this.circles[3*M+2];S.push({key:this.circleKeys[M],x1:P-N,y1:k-N,x2:P+N,y2:k+N})}return E?S.filter(E):S}return this._forEachCell(s,h,g,v,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?S.length>0:S}_queryCircle(s,h,g,v,x){let E=s-g,S=s+g,M=h-g,P=h+g;if(S<0||E>this.width||P<0||M>this.height)return!v&&[];let k=[];return this._forEachCell(E,M,S,P,this._queryCellCircle,k,{hitTest:v,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},x),v?k.length>0:k}query(s,h,g,v,x){return this._query(s,h,g,v,!1,x)}hitTest(s,h,g,v,x){return this._query(s,h,g,v,!0,x)}hitTestCircle(s,h,g,v){return this._queryCircle(s,h,g,!0,v)}_queryCell(s,h,g,v,x,E,S,M){let P=S.seenUids,k=this.boxCells[x];if(k!==null){let B=this.bboxes;for(let V of k)if(!P.box[V]){P.box[V]=!0;let G=4*V;if(s<=B[G+2]&&h<=B[G+3]&&g>=B[G+0]&&v>=B[G+1]&&(!M||M(this.boxKeys[V]))){if(S.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[V],x1:B[G],y1:B[G+1],x2:B[G+2],y2:B[G+3]})}}}let N=this.circleCells[x];if(N!==null){let B=this.circles;for(let V of N)if(!P.circle[V]){P.circle[V]=!0;let G=3*V;if(this._circleAndRectCollide(B[G],B[G+1],B[G+2],s,h,g,v)&&(!M||M(this.circleKeys[V]))){if(S.hitTest)return E.push(!0),!0;{let H=B[G],q=B[G+1],W=B[G+2];E.push({key:this.circleKeys[V],x1:H-W,y1:q-W,x2:H+W,y2:q+W})}}}}}_queryCellCircle(s,h,g,v,x,E,S,M){let P=S.circle,k=S.seenUids,N=this.boxCells[x];if(N!==null){let V=this.bboxes;for(let G of N)if(!k.box[G]){k.box[G]=!0;let H=4*G;if(this._circleAndRectCollide(P.x,P.y,P.radius,V[H+0],V[H+1],V[H+2],V[H+3])&&(!M||M(this.boxKeys[G])))return E.push(!0),!0}}let B=this.circleCells[x];if(B!==null){let V=this.circles;for(let G of B)if(!k.circle[G]){k.circle[G]=!0;let H=3*G;if(this._circlesCollide(V[H],V[H+1],V[H+2],P.x,P.y,P.radius)&&(!M||M(this.circleKeys[G])))return E.push(!0),!0}}}_forEachCell(s,h,g,v,x,E,S,M){let P=this._convertToXCellCoord(s),k=this._convertToYCellCoord(h),N=this._convertToXCellCoord(g),B=this._convertToYCellCoord(v);for(let V=P;V<=N;V++)for(let G=k;G<=B;G++)if(x.call(this,s,h,g,v,this.xCellCount*G+V,E,S,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,v,x,E){let S=v-s,M=x-h,P=g+E;return P*P>S*S+M*M}_circleAndRectCollide(s,h,g,v,x,E,S){let M=(E-v)/2,P=Math.abs(s-(v+M));if(P>M+g)return!1;let k=(S-x)/2,N=Math.abs(h-(x+k));if(N>k+g)return!1;if(P<=M||N<=k)return!0;let B=P-M,V=N-k;return B*B+V*V<=g*g}}let Do=100;class uy{constructor(s,h,g=new sm(s.width+200,s.height+200,25),v=new sm(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Do,this.screenBottomBoundary=s.height+Do,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,v,x,E,S,M){let P=g.projectedAnchorX,k=g.projectedAnchorY,N=g.projectedAnchorZ,B=g.elevation,V=g.tileID,G=s.getProjection();if(B&&V){let[ce,J,re]=G.upVector(V.canonical,g.tileAnchorX,g.tileAnchorY),ie=G.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ce*B*ie,k+=J*B*ie,N+=re*B*ie}let H=this.projectAndGetPerspectiveRatio(S,P,k,N,g.tileID,G.name==="globe"||!!B||this.transform.pitch>0,G),q=E*H.perspectiveRatio,W=(g.x1*h+v.x-g.padding)*q+H.point.x,ee=(g.y1*h+v.y-g.padding)*q+H.point.y,te=(g.x2*h+v.x+g.padding)*q+H.point.x,ne=(g.y2*h+v.y+g.padding)*q+H.point.y,ue=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(W,ee,te,ne)||!x&&this.grid.hitTest(W,ee,te,ne,M)||ue?{box:[],offscreen:!1,occluded:H.occluded}:{box:[W,ee,te,ne],offscreen:this.isOffscreen(W,ee,te,ne),occluded:!1}}placeCollisionCircles(s,h,g,v,x,E,S,M,P,k,N,B,V,G,H){let q=[],W=this.transform.elevation,ee=s.getProjection(),te=W?W.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,ee):null,ne=new r.P(g.tileAnchorX,g.tileAnchorY),{x:ue,y:ce,z:J}=ee.projectTilePoint(ne.x,ne.y,H.canonical);if(te){let[Ve,xe,Re]=te(ne);ue+=Ve,ce+=xe,J+=Re}let re=ee.name==="globe",ie=this.projectAndGetPerspectiveRatio(S,ue,ce,J,H,re||!!W||this.transform.pitch>0,ee),{perspectiveRatio:ge}=ie,Se=(N?E/ge:E*ge)/r.bN,ae=lo(ue,ce,J,M),Ce=ie.signedDistanceFromCamera>0?od(Se,x,g.lineOffsetX*Se,g.lineOffsetY*Se,!1,ae,ne,g,v,M,{},W&&!N?te:null,N&&!!W,ee,H,N):null,Me=!1,$e=!1,Ge=!0;if(Ce&&!ie.occluded){let Ve=.5*V*ge+G,xe=new r.P(-100,-100),Re=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Fe=new cy,{first:ot,last:ct}=Ce,at=ot.path.length,je=[];for(let pt=at-1;pt>=1;pt--)je.push(ot.path[pt]);for(let pt=1;pt<ct.path.length;pt++)je.push(ct.path[pt]);let He=2.5*Ve;P&&(je=je.map(([pt,Ot,Gt],cn)=>(te&&!re&&(Gt=te(cn<at-1?ot.tilePath[at-1-cn]:ct.tilePath[cn-at+2])[2]),lo(pt,Ot,Gt,P))),je.some(pt=>pt[3]<=0)&&(je=[]));let st=[];if(je.length>0){let pt=1/0,Ot=-1/0,Gt=1/0,cn=-1/0;for(let on of je)pt=Math.min(pt,on[0]),Gt=Math.min(Gt,on[1]),Ot=Math.max(Ot,on[0]),cn=Math.max(cn,on[1]);Ot>=xe.x&&pt<=Re.x&&cn>=xe.y&&Gt<=Re.y&&(st=[je.map(on=>new r.P(on[0],on[1]))],(pt<xe.x||Ot>Re.x||Gt<xe.y||cn>Re.y)&&(st=r.cF(st,xe.x,xe.y,Re.x,Re.y)))}for(let pt of st){Fe.reset(pt,.25*Ve);let Ot=0;Ot=Fe.length<=.5*Ve?1:Math.ceil(Fe.paddedLength/He)+1;for(let Gt=0;Gt<Ot;Gt++){let cn=Gt/Math.max(Ot-1,1),on=Fe.lerp(cn),Rn=on.x+Do,Bt=on.y+Do;q.push(Rn,Bt,Ve,0);let Dn=Rn-Ve,Gn=Bt-Ve,kn=Rn+Ve,tn=Bt+Ve;if(Ge=Ge&&this.isOffscreen(Dn,Gn,kn,tn),$e=$e||this.isInsideGrid(Dn,Gn,kn,tn),!h&&this.grid.hitTestCircle(Rn,Bt,Ve,B)&&(Me=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Me,occluded:!1}}}}return{circles:!k&&Me||!$e?[]:q,offscreen:Ge,collisionDetected:Me,occluded:ie.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],g=1/0,v=1/0,x=-1/0,E=-1/0;for(let k of s){let N=new r.P(k.x+Do,k.y+Do);g=Math.min(g,N.x),v=Math.min(v,N.y),x=Math.max(x,N.x),E=Math.max(E,N.y),h.push(N)}let S=this.grid.query(g,v,x,E).concat(this.ignoredGrid.query(g,v,x,E)),M={},P={};for(let k of S){let N=k.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;let B=[new r.P(k.x1,k.y1),new r.P(k.x2,k.y1),new r.P(k.x2,k.y2),new r.P(k.x1,k.y2)];r.cG(h,B)&&(M[N.bucketInstanceId][N.featureIndex]=!0,P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]=[]),P[N.bucketInstanceId].push(N.featureIndex))}return P}insertCollisionBox(s,h,g,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,v,x){let E=h?this.ignoredGrid:this.grid,S={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let M=0;M<s.length;M+=4)E.insertCircle(S,s[M],s[M+1],s[M+2])}projectAndGetPerspectiveRatio(s,h,g,v,x,E,S){let M=[h,g,v,1],P=!1;v||this.transform.pitch>0?(r.aA.transformMat4(M,M,s),this.fogState&&x&&S.name!=="globe"&&(P=function(B,V,G,H,q,W){let ee=W.calculateFogTileMatrix(q),te=[V,G,H];return r._.transformMat4(te,te,ee),Rr(B,r._.length(te),W.pitch,W._fov)}(this.fogState,h,g,v,x.toUnwrapped(),this.transform)>.9)):Ho(M,M,s);let k=M[3];return{point:new r.P((M[0]/k+1)/2*this.transform.width+Do,(-M[1]/k+1)/2*this.transform.height+Do),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/k*.5,1.5),signedDistanceFromCamera:k,occluded:E&&M[2]>k||P}}isOffscreen(s,h,g,v){return g<Do||s>=this.screenRightBoundary||v<Do||h>this.screenBottomBoundary}isInsideGrid(s,h,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let s=r.ad.identity([]);return r.ad.translate(s,s,[-100,-100,0]),s}}class Zs{constructor(s,h,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Xs{constructor(s,h,g,v,x,E=!1){this.text=new Zs(s?s.text:null,h,g,x),this.icon=new Zs(s?s.icon:null,h,v,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Td{constructor(s,h,g,v=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=v}}class hy{constructor(){this.invProjMatrix=r.ad.create(),this.viewportMatrix=r.ad.create(),this.circles=[]}}class zu{constructor(s,h,g,v,x){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class Bu{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){let h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function am(m,s,h,g,v){let{horizontalAlign:x,verticalAlign:E}=r.bQ(m),S=-(x-.5)*s,M=-(E-.5)*h,P=r.bP(m,g);return new r.P(S+P[0]*v,M+P[1]*v)}function Vu(m,s,h,g,v){let x=new r.P(m,s);return h&&x._rotate(g?v:-v),x}class uo{constructor(s,h,g,v,x,E){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new uy(this.transform,x),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Bu(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,g,v){let x=g.getBucket(h),E=g.latestFeatureIndex;if(!x||!E||h.fqid!==x.layerIds[0])return;let S=x.layers[0].layout,M=g.collisionBoxArray,P=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),k=g.tileSize/r.a3,N=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let B=(V=g.tileID,G=x.getProjection(),H=this.transform,G.name===this.projection?H.calculateProjMatrix(V.toUnwrapped()):yd(H,G,V));var V,G,H;let q=S.get("text-pitch-alignment")==="map",W=S.get("text-rotation-alignment")==="map";h.compileFilter();let ee=h.dynamicFilter(),te=h.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(g),ue=Oa(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne),ce=null;if(q){let ie=Nl(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne);ce=r.ad.multiply([],this.transform.labelPlaneMatrix,ie)}let J=null;ee&&g.latestFeatureIndex&&(J={unwrappedTileID:N,dynamicFilter:ee,dynamicFilterNeedsFeature:te,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new zu(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,g.tileID);let re={bucket:x,layout:S,posMatrix:B,textLabelPlaneMatrix:ue,labelToScreenMatrix:ce,clippingData:J,scale:P,textPixelRatio:k,holdingForFade:g.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:r.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let ie of x.sortKeyRanges){let{sortKey:ge,symbolInstanceStart:Se,symbolInstanceEnd:ae}=ie;s.push({sortKey:ge,symbolInstanceStart:Se,symbolInstanceEnd:ae,parameters:re})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:re})}attemptAnchorPlacement(s,h,g,v,x,E,S,M,P,k,N,B,V,G,H,q,W,ee){let{textOffset0:te,textOffset1:ne,crossTileID:ue}=B,ce=[te,ne],J=am(s,g,v,ce,x),re=this.collisionIndex.placeCollisionBox(G,x,h,Vu(J.x,J.y,E,S,this.transform.angle),N,M,P,k.predicate);if(q){let ie=G.getSymbolInstanceIconSize(ee,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,ie,q,Vu(J.x,J.y,E,S,this.transform.angle),N,M,P,k.predicate).box.length===0)return}if(re.box.length>0){let ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(ie=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:ce,width:g,height:v,anchor:s,textScale:x,prevAnchor:ie},this.markUsedJustification(G,s,B,H),G.allowVerticalPlacement&&(this.markUsedOrientation(G,H,B),this.placedOrientations[ue]=H),{shift:J,placedGlyphBoxes:re}}}placeLayerBucketPart(s,h,g,v){let{bucket:x,layout:E,posMatrix:S,textLabelPlaneMatrix:M,labelToScreenMatrix:P,clippingData:k,textPixelRatio:N,holdingForFade:B,collisionBoxArray:V,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:H,collisionGroup:q}=s.parameters,W=E.get("text-optional"),ee=E.get("icon-optional"),te=E.get("text-allow-overlap"),ne=E.get("icon-allow-overlap"),ue=E.get("text-rotation-alignment")==="map",ce=E.get("text-pitch-alignment")==="map",J=E.get("symbol-z-order")==="viewport-y",re=E.get("symbol-z-elevate");this.transform.setProjection(x.projection);let ie=te&&(ne||!x.hasIconData()||ee),ge=ne&&(te||!x.hasTextData()||W);!x.collisionArrays&&V&&x.deserializeCollisionBoxes(V),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,V);let Se=(ae,Ce,Me)=>{let{crossTileID:$e,numVerticalGlyphVertices:Ge}=ae;if(k){let kn={zoom:this.transform.zoom,pitch:this.transform.pitch},tn=null;if(k.dynamicFilterNeedsFeature){let Vt=this.retainedQueryData[x.bucketInstanceId];tn=k.featureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:Vt.bucketIndex,sourceLayerIndex:Vt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(kn,tn,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(ae.tileAnchorX,ae.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[$e]=new Td(!1,!1,!1,!0),void h.add($e)}if(h.has($e))return;if(B)return void(this.placements[$e]=new Td(!1,!1,!1));let Ve=!1,xe=!1,Re=!0,Fe=!1,ot=!1,ct=null,at={box:null,offscreen:null,occluded:null},je={box:null,offscreen:null,occluded:null},He=null,st=null,pt=null,Ot=0,Gt=0,cn=0;Me.textFeatureIndex?Ot=Me.textFeatureIndex:ae.useRuntimeCollisionCircles&&(Ot=ae.featureIndex),Me.verticalTextFeatureIndex&&(Gt=Me.verticalTextFeatureIndex);let on=kn=>{kn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let tn=this.transform.elevation;kn.elevation=ae.zOffset+(tn?tn.getAtTileOffset(kn.tileID,kn.tileAnchorX,kn.tileAnchorY):0)},Rn=Me.textBox;if(Rn){on(Rn);let kn=Vt=>{let Xn=r.aE.horizontal;if(x.allowVerticalPlacement&&!Vt&&this.prevPlacement){let Jn=this.prevPlacement.placedOrientations[$e];Jn&&(this.placedOrientations[$e]=Jn,Xn=Jn,this.markUsedOrientation(x,Xn,ae))}return Xn},tn=(Vt,Xn)=>{if(x.allowVerticalPlacement&&Ge>0&&Me.verticalTextBox){for(let Jn of x.writingModes)if(Jn===r.aE.vertical?(at=Xn(),je=at):at=Vt(),at&&at.box&&at.box.length)break}else at=Vt()};if(E.get("text-variable-anchor")){let Vt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e]){let un=this.prevPlacement.variableOffsets[$e];Vt.indexOf(un.anchor)>0&&(Vt=Vt.filter(Be=>Be!==un.anchor),Vt.unshift(un.anchor))}let Xn=(un,Be,ut)=>{let Br=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Ce),On=(un.x2-un.x1)*Br+2*un.padding,Te=(un.y2-un.y1)*Br+2*un.padding,Fi=ae.hasIconTextFit&&!ne?Be:null;Fi&&on(Fi);let mi={box:[],offscreen:!1,occluded:!1},$r=te?2*Vt.length:Vt.length;for(let Ci=0;Ci<$r;++Ci){let ji=this.attemptAnchorPlacement(Vt[Ci%Vt.length],un,On,Te,Br,ue,ce,N,S,q,Ci>=Vt.length,ae,Ce,x,ut,Fi,G,H);if(ji&&(mi=ji.placedGlyphBoxes,mi&&mi.box&&mi.box.length)){Ve=!0,ct=ji.shift;break}}return mi};tn(()=>Xn(Rn,Me.iconBox,r.aE.horizontal),()=>{let un=Me.verticalTextBox;return un&&on(un),x.allowVerticalPlacement&&!(at&&at.box&&at.box.length)&&Ge>0&&un?Xn(un,Me.verticalIconBox,r.aE.vertical):{box:null,offscreen:null,occluded:null}}),at&&(Ve=at.box,Re=at.offscreen,Fe=at.occluded);let Jn=kn(!(!at||!at.box));if(!Ve&&this.prevPlacement){let un=this.prevPlacement.variableOffsets[$e];un&&(this.variableOffsets[$e]=un,this.markUsedJustification(x,un.anchor,ae,Jn))}}else{let Vt=(Xn,Jn)=>{let un=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Ce),Be=this.collisionIndex.placeCollisionBox(x,un,Xn,new r.P(0,0),te,N,S,q.predicate);return Be&&Be.box&&Be.box.length&&(this.markUsedOrientation(x,Jn,ae),this.placedOrientations[$e]=Jn),Be};tn(()=>Vt(Rn,r.aE.horizontal),()=>{let Xn=Me.verticalTextBox;return x.allowVerticalPlacement&&Ge>0&&Xn?(on(Xn),Vt(Xn,r.aE.vertical)):{box:null,offscreen:null,occluded:null}}),kn(!!(at&&at.box&&at.box.length))}}if(He=at,Ve=He&&He.box&&He.box.length>0,Re=He&&He.offscreen,Fe=He&&He.occluded,ae.useRuntimeCollisionCircles){let kn=x.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex>=0?ae.centerJustifiedTextSymbolIndex:ae.verticalPlacedTextSymbolIndex),tn=r.aF(x.textSizeData,G,kn),Vt=E.get("text-padding");st=this.collisionIndex.placeCollisionCircles(x,te,kn,x.lineVertexArray,x.glyphOffsetArray,tn,S,M,P,g,ce,q.predicate,ae.collisionCircleDiameter*tn/r.bN,Vt,this.retainedQueryData[x.bucketInstanceId].tileID),Ve=te||st.circles.length>0&&!st.collisionDetected,Re=Re&&st.offscreen,Fe=st.occluded}if(Me.iconFeatureIndex&&(cn=Me.iconFeatureIndex),Me.iconBox){let kn=tn=>{on(tn);let Vt=ae.hasIconTextFit&&ct?Vu(ct.x,ct.y,ue,ce,this.transform.angle):new r.P(0,0),Xn=x.getSymbolInstanceIconSize(H,this.transform.zoom,ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Xn,tn,Vt,ne,N,S,q.predicate)};je&&je.box&&je.box.length&&Me.verticalIconBox?(pt=kn(Me.verticalIconBox),xe=pt.box.length>0):(pt=kn(Me.iconBox),xe=pt.box.length>0),Re=Re&&pt.offscreen,ot=pt.occluded}let Bt=W||ae.numHorizontalGlyphVertices===0&&Ge===0,Dn=ee||ae.numIconVertices===0;if(Bt||Dn?Dn?Bt||(xe=xe&&Ve):Ve=xe&&Ve:xe=Ve=xe&&Ve,Ve&&He&&He.box&&this.collisionIndex.insertCollisionBox(He.box,E.get("text-ignore-placement"),x.bucketInstanceId,je&&je.box&&Gt?Gt:Ot,q.ID),xe&&pt&&this.collisionIndex.insertCollisionBox(pt.box,E.get("icon-ignore-placement"),x.bucketInstanceId,cn,q.ID),st&&(Ve&&this.collisionIndex.insertCollisionCircles(st.circles,E.get("text-ignore-placement"),x.bucketInstanceId,Ot,q.ID),g)){let kn=x.bucketInstanceId,tn=this.collisionCircleArrays[kn];tn===void 0&&(tn=this.collisionCircleArrays[kn]=new hy);for(let Vt=0;Vt<st.circles.length;Vt+=4)tn.circles.push(st.circles[Vt+0]),tn.circles.push(st.circles[Vt+1]),tn.circles.push(st.circles[Vt+2]),tn.circles.push(st.collisionDetected?1:0)}let Gn=x.projection.name!=="globe";ie=ie&&(Gn||!Fe),ge=ge&&(Gn||!ot),this.placements[$e]=new Td(Ve||ie,xe||ge,Re||x.justReloaded),h.add($e)};if(re&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),J){let ae=x.getSortedSymbolIndexes(this.transform.angle);for(let Ce=ae.length-1;Ce>=0;--Ce){let Me=ae[Ce];Se(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let ae=x.getSortedIndexesByZOffset();for(let Ce=0;Ce<ae.length;++Ce){let Me=ae[Ce];Se(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}}else for(let ae=s.symbolInstanceStart;ae<s.symbolInstanceEnd;ae++)Se(x.symbolInstances.get(ae),ae,x.collisionArrays[ae]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let ae=this.collisionCircleArrays[x.bucketInstanceId];r.ad.invert(ae.invProjMatrix,S),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,h,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M,crossTileID:P}=g,k=r.cJ(h),N=v===r.aE.vertical?M:k==="left"?x:k==="center"?E:k==="right"?S:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=N>=0&&x!==N?0:P),E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=N>=0&&E!==N?0:P),S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=N>=0&&S!==N?0:P),M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:P)}markUsedOrientation(s,h,g){let v=h===r.aE.horizontal||h===r.aE.horizontalOnly?h:0,x=h===r.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P}=g,k=s.text.placedSymbolArray;E>=0&&(k.get(E).placedOrientation=v),S>=0&&(k.get(S).placedOrientation=v),M>=0&&(k.get(M).placedOrientation=v),P>=0&&(k.get(P).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(s):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(let M in this.placements){let P=this.placements[M],k=x[M];k?(this.opacities[M]=new Xs(k,v,P.text,P.icon,null,P.clipped),g=g||P.text!==k.text.placed||P.icon!==k.icon.placed):(this.opacities[M]=new Xs(null,v,P.text,P.icon,P.skipFade,P.clipped),g=g||P.text||P.icon)}for(let M in x){let P=x[M];if(!this.opacities[M]){let k=new Xs(P,v,!1,!1);k.isHidden()||(this.opacities[M]=k,g=g||P.text.placed||P.icon.placed)}}for(let M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(let M in S)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=S[M]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h,g,v){let x=new Set;for(let E of h){let S=E.getBucket(s);S&&E.latestFeatureIndex&&s.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,x,E.collisionBoxArray,g,v,E.tileID),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,E.tileID),S.updateZOffset()))}}updateBucketOpacities(s,h,g,v,x,E){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();let S=s.layers[0].layout,M=!!s.layers[0].dynamicFilter(),P=new Xs(null,0,!1,!1,!0),k=S.get("text-allow-overlap"),N=S.get("icon-allow-overlap"),B=S.get("text-variable-anchor"),V=S.get("text-rotation-alignment")==="map",G=S.get("text-pitch-alignment")==="map",H=new Xs(null,0,k&&(N||!s.hasIconData()||S.get("icon-optional")),N&&(k||!s.hasTextData()||S.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);let q=(ee,te,ne)=>{for(let ue=0;ue<te/4;ue++)ee.opacityVertexArray.emplaceBack(ne)},W=0;x&&s.updateReplacement(E,x);for(let ee=0;ee<s.symbolInstances.length;ee++){let te=s.symbolInstances.get(ee),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ue,crossTileID:ce,numIconVertices:J,tileAnchorX:re,tileAnchorY:ie}=te,ge=h.has(ce),Se=this.opacities[ce];ge?Se=P:Se||(Se=H,this.opacities[ce]=Se),h.add(ce);let ae=ne>0||ue>0,Ce=J>0,Me=this.placedOrientations[ce],$e=Me===r.aE.vertical,Ge=Me===r.aE.horizontal||Me===r.aE.horizontalOnly;!ae&&!Ce||Se.isHidden()||W++;let Ve=!1;if((ae||Ce)&&x)for(let xe of s.activeReplacements){if(xe.order<v||xe.order===1/0||!(xe.clipMask&r.cu.Symbol)||xe.min.x>re||re>xe.max.x||xe.min.y>ie||ie>xe.max.y)continue;let Re=r.cH(re,ie,E.canonical,xe.footprintTileId.canonical);if(Ve=r.cI(Re,xe),Ve)break}if(ae){let xe=Ve?Ys:Xo(Se.text);q(s.text,ne,$e?Ys:xe),q(s.text,ue,Ge?Ys:xe);let Re=Se.text.isHidden(),{leftJustifiedTextSymbolIndex:Fe,centerJustifiedTextSymbolIndex:ot,rightJustifiedTextSymbolIndex:ct,verticalPlacedTextSymbolIndex:at}=te,je=s.text.placedSymbolArray,He=Re||$e?1:0;Fe>=0&&(je.get(Fe).hidden=He),ot>=0&&(je.get(ot).hidden=He),ct>=0&&(je.get(ct).hidden=He),at>=0&&(je.get(at).hidden=Re||Ge?1:0);let st=this.variableOffsets[ce];st&&this.markUsedJustification(s,st.anchor,te,Me);let pt=this.placedOrientations[ce];pt&&(this.markUsedJustification(s,"left",te,pt),this.markUsedOrientation(s,pt,te))}if(Ce){let xe=Ve?Ys:Xo(Se.icon),{placedIconSymbolIndex:Re,verticalPlacedIconSymbolIndex:Fe}=te,ot=s.icon.placedSymbolArray,ct=Se.icon.isHidden()?1:0;Re>=0&&(q(s.icon,J,$e?Ys:xe),ot.get(Re).hidden=ct),Fe>=0&&(q(s.icon,te.numVerticalIconVertices,Ge?Ys:xe),ot.get(Fe).hidden=ct)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){let xe=s.collisionArrays[ee];if(xe){let Re=new r.P(0,0),Fe=!0;if(xe.textBox||xe.verticalTextBox){if(B){let ct=this.variableOffsets[ce];ct?(Re=am(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textScale),V&&Re._rotate(G?this.transform.angle:-this.transform.angle)):Fe=!1}M&&(Fe=!Se.clipped),xe.textBox&&ju(s.textCollisionBox.collisionVertexArray,Se.text.placed,!Fe||$e,Re.x,Re.y),xe.verticalTextBox&&ju(s.textCollisionBox.collisionVertexArray,Se.text.placed,!Fe||Ge,Re.x,Re.y)}let ot=Fe&&!!(!Ge&&xe.verticalIconBox);xe.iconBox&&ju(s.iconCollisionBox.collisionVertexArray,Se.icon.placed,ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0),xe.verticalIconBox&&ju(s.iconCollisionBox.collisionVertexArray,Se.icon.placed,!ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0)}}}if(s.fullyClipped=W===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){let ee=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ee.invProjMatrix,s.placementViewportMatrix=ee.viewportMatrix,s.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){let g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function ju(m,s,h,g,v){m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0)}let lm=Math.pow(2,25),it=Math.pow(2,24),dy=Math.pow(2,17),cm=Math.pow(2,16),um=Math.pow(2,9),fy=Math.pow(2,8),Sd=Math.pow(2,1);function Xo(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*lm+s*it+h*dy+s*cm+h*um+s*fy+h*Sd+s}let Ys=0;class ja{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,g,v,x){let E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<E.length;){let S=E[this._currentPartIndex];if(h.placeLayerBucketPart(S,this._seenCrossTileIDs,g,S.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Cd{constructor(s,h,g,v,x,E,S,M,P){this.placement=new uo(s,x,E,S,M,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g,v){let x=r.e.now(),E=()=>{let S=r.e.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){let S=h[s[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){let P=S,k=P.layout.get("symbol-z-elevate"),N=this._inProgressLayer=this._inProgressLayer||new ja(P),B=r.al(S.source,S.scope);if(N.continuePlacement(k?v[B]:g[B],this.placement,this._showCollisionBoxes,S,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}let Ks=512/r.a3/2;class ib{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this.index=new r.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=s.canonical.x*r.a3,x=s.canonical.y*r.a3;for(let E=0;E<h.length;E++){let{key:S,crossTileID:M,tileAnchorX:P,tileAnchorY:k}=h.get(E),N=Math.floor((v+P)*Ks),B=Math.floor((x+k)*Ks);this.index.add(N,B),this.keys.push(S),this.crossTileIDs.push(M)}this.index.finish()}findMatches(s,h,g){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=Ks/Math.pow(2,h.canonical.z-this.tileID.canonical.z),E=h.canonical.x*r.a3,S=h.canonical.y*r.a3;for(let M=0;M<s.length;M++){let P=s.get(M);if(P.crossTileID)continue;let{key:k,tileAnchorX:N,tileAnchorY:B}=P,V=Math.floor((E+N)*x),G=Math.floor((S+B)*x),H=this.index.range(V-v,G-v,V+v,G+v);for(let q of H){let W=this.crossTileIDs[q];if(this.keys[q]===k&&!g.has(W)){g.add(W),P.crossTileID=W;break}}}}}class ob{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){let h=Math.round((s-this.lng)/360);if(h!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let E in v){let S=v[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),x[S.tileID.key]=S}this.indexes[g]=x}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);let v=this.usedCrossTileIDs[s.overscaledZ];for(let x in this.indexes){let E=this.indexes[x];if(Number(x)>s.overscaledZ)for(let S in E){let M=E[S];M.tileID.isChildOf(s)&&M.findMatches(h.symbolInstances,s,v)}else{let S=E[s.scaledTo(Number(x)).key];S&&S.findMatches(h.symbolInstances,s,v)}}for(let x=0;x<h.symbolInstances.length;x++){let E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=g.generate(),v.add(E.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new ib(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(let g of h.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let h=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)s[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],h=!0)}return h}}class sb{constructor(){this.layerIndexes={},this.crossTileIDs=new ob,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,v){let x=this.layerIndexes[s.fqid];x===void 0&&(x=this.layerIndexes[s.fqid]=new hm);let E=!1,S={};v.name!=="globe"&&x.handleWrapJump(g);for(let M of h){let P=M.getBucket(s);P&&s.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,P,this.crossTileIDs)&&(E=!0),S[P.bucketInstanceId]=!0)}return x.removeStaleBuckets(S)&&(E=!0),E}pruneUnusedLayers(s){let h={};s.forEach(g=>{h[g]=!0});for(let g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}let py=new r.N({data:new r.O(r.L.colorTheme.data)}),Qs=(m,s)=>jt(m,s&&s.filter(h=>h.identifier!=="source.canvas")),dm=r.ah(mn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),ab=r.ah(mn,["setCenter","setZoom","setBearing","setPitch"]),my={version:8,layers:[],sources:{}},gy={duration:300,delay:0};class Mo extends r.E{constructor(s,h={}){super(),this.map=s,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=r.W({},gy),this._buildingIndex=new tb(this),this.crossTileSymbolIndex=new sb,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Jt,this.dispatcher=h.dispatcher?h.dispatcher:new r.bw(r.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new hu,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new r.cM(s._requestManager,h.localFontFamily?r.cN.all:h.localIdeographFontFamily?r.cN.ideographs:r.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new Qh(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",r.cO());let g=this;this._rtlTextPluginCallback=Mo.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,E)=>{if(r.cP(x),E&&E.every(S=>S))for(let S in g._sourceCaches){let M=g._sourceCaches[S],P=M.getSource().type;P!=="vector"&&P!=="geojson"||M.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let E in this._layers){let S=this._layers[E];S.source===x.id&&this._validateLayer(S)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(r.cQ(s))return s;let h=r.cR(s);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${r.cS(JSON.stringify(s))}`}_diffStyle(s,h,g){this.globalId=this._getGlobalId(s);let v=(x,E)=>{try{E(null,this.setState(x,g))}catch(S){E(S,!1)}};if(typeof s=="string"){let x=this.map._requestManager.normalizeStyleURL(s),E=this.map._requestManager.transformRequest(x,r.R.Style);r.g(E,(S,M)=>{S?this.fire(new r.d(S)):M&&v(M,h)})}else typeof s=="object"&&v(s,h)}loadURL(s,h={}){this.fire(new r.f("dataloading",{dataType:"style"}));let g=typeof h.validate=="boolean"?h.validate:!r.cQ(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,h.accessToken),this.resolvedImports.add(s);let v=this.importsCache.get(s);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(s,r.R.Style);this._request=r.g(x,(E,S)=>{if(this._request=null,E)this.fire(new r.d(E));else if(S)return this.importsCache.set(s,S),this._load(S,g)})}loadJSON(s,h={}){this.fire(new r.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=r.e.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new r.f("dataloading",{dataType:"style"})),this._load(my,!1)}_loadImports(s,h,g){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of s){let E=this._createFragmentStyle(x),S=new Promise(k=>{E.once("style.import.load",k),E.once("error",k)}).then(()=>this.mergeAll());if(v.push(S),this.resolvedImports.has(x.url)){E.loadEmpty();continue}let M=x.data||this.importsCache.get(x.url);M?(E.loadJSON(M,{validate:h}),this._isInternalStyle(M)&&(E.globalId=null)):x.url?E.loadURL(x.url,{validate:h}):E.loadEmpty();let P={style:E,id:x.id,config:x.config};if(g){let k=this.fragments.findIndex(({id:N})=>N===g);this.fragments=this.fragments.slice(0,k).concat(P).concat(this.fragments.slice(k))}else this.fragments.push(P)}return Promise.allSettled(v)}getImportGlobalIds(s=this,h=new Set){for(let g of s.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(s){let h=this.scope?r.al(s.id,this.scope):s.id,g,v=this._initialConfig&&this._initialConfig[h];(s.config||v)&&(g=r.W({},s.config,v));let x=new Mo(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,h){let g=s.schema;if(this._isInternalStyle(s)){let E=r.W({},my,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(E,h)}if(this.updateConfig(this._config,g),h&&Qs(this,de(s)))return;this._loaded=!0,this.stylesheet=r.cT(s);let v=()=>{for(let P in s.sources)this.addSource(P,s.sources[P],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);let E=om(this.stylesheet.layers);if(this._order=E.map(P=>P.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let P=this.stylesheet.lights[0];this.light=new mt(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new mt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let P of E){let k=r.cY(P,this.scope,this._styleColorTheme.lut,this.options);k.isConfigDependent&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize();let N=this.getOwnLayerSourceCache(k),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&k.canCastShadows()&&B&&(N.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.f("data",{dataType:"style"}));let M=this.isRootStyle();s.imports?this._loadImports(s.imports,h).then(()=>{this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let E=this._evaluateColorThemeData(x);this._loadColorTheme(E).then(()=>{v()}).catch(S=>{r.w(`Couldn't load color theme from the stylesheet: ${S}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,h,g,v,x,E,S,M,P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(k.light!=null&&(s=k.light),k.stylesheet.lights)for(let N of k.stylesheet.lights)N.type==="ambient"&&k.ambientLight!=null&&(h=k.ambientLight),N.type==="directional"&&k.directionalLight!=null&&(g=k.directionalLight);v=this._prioritizeTerrain(v,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&k.fog!=null&&(x=k.fog),k.stylesheet.camera!=null&&(M=k.stylesheet.camera),k.stylesheet.projection!=null&&(E=k.stylesheet.projection),k.stylesheet.transition!=null&&(S=k.stylesheet.transition),P[k.scope]=k._styleColorTheme}}),this.light=s,this.ambientLight=h,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=P,v===null?delete this.terrain:this.terrain=v,this.camera=M||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=r.W({},gy,S),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){let h=g=>{for(let v of g.fragments)h(v.style);s(g)};h(this)}_prioritizeTerrain(s,h,g){let v=s&&s.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?s:null:h!=null&&(!s||v||h&&h.drapeRenderMode===1)?h:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{s=this._prioritizeTerrain(s,h.terrain,h.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(s=h.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){let s={},h={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let E=r.al(x,v.scope);s[E]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let E=r.al(x,v.scope);h[E]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let E=r.al(x,v.scope);g[E]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){let s={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(let S of E._order){let M=E._layers[S];if(M.type==="slot"){let P=r.cU(S);if(s[P])continue;s[P]=[]}M.slot&&s[M.slot]?s[M.slot].push(M):h.push(M)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(E=[])=>{for(let S of E)if(S.type==="slot"){let M=r.cU(S.id);s[M]&&x(s[M]),this._mergedSlots.push(M)}else{let M=r.al(S.id,S.scope);this._mergedOrder.push(M),g[M]=S,S.is3D()&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=r.W({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(h,g,v){let x=r.W({},g);for(let S of Object.keys(r.L.colorTheme))x[S]===void 0&&(x[S]=r.L.colorTheme[S].default);let E=new r.U(py,h,new Map(v));return E.setTransitionOrValue(x,v),E.untransitioned().possiblyEvaluate(new r.X(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){return this._styleColorTheme.lutLoading=!0,new Promise((h,g)=>{let v="data:image/png;base64,";if(s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();s.startsWith(v)||(s=v+s);let x="mapbox-reserved-lut",E=new Image;E.src=s,E.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},E.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:S,height:M,data:P}=r.e.getImageData(E);if(M>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(S!==M*M)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new r.i({width:S,height:M},P),pixelRatio:1,sdf:!1,version:0});let k=this.imageManager.getImage(x,this.scope);k?(this._styleColorTheme.lut={image:k.data,data:s},h()):g(new Error("Missing LUT image."))}})}getLut(s){let h=this._styleColorThemeForScope[s];return h?h.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(h,g,v){let x,E,S,M=r.e.devicePixelRatio>1?"@2x":"",P=r.g(g.transformRequest(g.normalizeSpriteURL(h,M,".json"),r.R.SpriteJSON),(B,V)=>{P=null,S||(S=B,x=V,N())}),k=r.h(g.transformRequest(g.normalizeSpriteURL(h,M,".png"),r.R.SpriteImage),(B,V)=>{k=null,S||(S=B,E=V,N())});function N(){if(S)v(S);else if(x&&E){let B=r.e.getImageData(E),V={};for(let G in x){let{width:H,height:q,x:W,y:ee,sdf:te,pixelRatio:ne,stretchX:ue,stretchY:ce,content:J}=x[G],re=new r.i({width:H,height:q});r.i.copy(B,re,{x:W,y:ee},{x:0,y:0},{width:H,height:q},null),V[G]={data:re,pixelRatio:ne,sdf:te,stretchX:ue,stretchY:ce,content:J}}v(null,V)}}return{cancel(){P&&(P.cancel(),P=null),k&&(k.cancel(),k=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new r.d(h));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.f("data",{dataType:"style"}))})}_validateLayer(s){let h=this.getOwnSource(s.source);if(!h)return;let g=s.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new r.d(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,h)=>{let g=this.fragments[h];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){let s={};for(let h in this._sourceCaches){let g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){let h=[];for(let g of s){let v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(let s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){let h=this.getOwnLayer(s);if(h)return h;this.fire(new r.d(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){let h=this.getOwnSource(s);if(h)return h;this.fire(new r.d(new Error(`The source '${s}' does not exist in the map's style.`)))}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);let h=this.calculateLightsBrightness();s.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let E=this._changes.getLayerUpdatesByScope();for(let S in E){let{updatedIds:M,removedIds:P}=E[S];(M||P)&&(this._updateWorkerLayers(S,M,P),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}let x={};for(let E in this._mergedSourceCaches){let S=this._mergedSourceCaches[E];x[E]=S.used,S.used=!1,S.tileCoverLift=0}for(let E of this._mergedOrder){let S=this._mergedLayers[E];if(S.recalculate(s,this._availableImages),!S.isHidden(s.zoom)){let M=this.getLayerSourceCache(S);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,S.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let M=S.minzoom||0;M<(S.maxzoom||25.5);M++){let P=this.map.painter;if(P){let k=S.getProgramIds();if(!k)continue;for(let N of k){let B=S.getDefaultProgramParams(N,s.zoom,this._styleColorTheme.lut);B&&(P.style=this,this.fog&&(P._fogVisible=!0,B.overrideFog=!0,P.getOrCreateProgram(N,B)),P._fogVisible=!1,B.overrideFog=!1,P.getOrCreateProgram(N,B),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(B.overrideRtt=!0,P.getOrCreateProgram(N,B)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let E in x){let S=this._mergedSourceCaches[E];x[E]!==S.used&&S.getSource().fire(new r.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new r.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let s=this._changes.getUpdatedImages();if(s.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,h,g){let v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:s,removedIds:g||[],options:v.options})}setState(s,h){if(this._checkLoaded(),Qs(this,de(s)))return!1;(s=r.cT(s)).layers=om(s.layers);let g=function(E,S){if(!E)return[{command:mn.setStyle,args:[S]}];let M=[];try{if(!w(E.version,S.version))return[{command:mn.setStyle,args:[S]}];if(w(E.center,S.center)||M.push({command:mn.setCenter,args:[S.center]}),w(E.zoom,S.zoom)||M.push({command:mn.setZoom,args:[S.zoom]}),w(E.bearing,S.bearing)||M.push({command:mn.setBearing,args:[S.bearing]}),w(E.pitch,S.pitch)||M.push({command:mn.setPitch,args:[S.pitch]}),w(E.sprite,S.sprite)||M.push({command:mn.setSprite,args:[S.sprite]}),w(E.glyphs,S.glyphs)||M.push({command:mn.setGlyphs,args:[S.glyphs]}),w(E.imports,S.imports)||function(V=[],G=[],H){G=G||[];let q=(V=V||[]).map(Ed),W=G.map(Ed),ee=V.reduce(Jl,{}),te=G.reduce(Jl,{}),ne=q.slice(),ue,ce,J,re;for(ue=0,ce=0;ue<q.length;ue++)J=q[ue],te.hasOwnProperty(J)?ce++:(H.push({command:mn.removeImport,args:[J]}),ne.splice(ne.indexOf(J,ce),1));for(ue=0,ce=0;ue<W.length;ue++)J=W[W.length-1-ue],ne[ne.length-1-ue]!==J&&(ee.hasOwnProperty(J)?(H.push({command:mn.removeImport,args:[J]}),ne.splice(ne.lastIndexOf(J,ne.length-ce),1)):ce++,re=ne[ne.length-ue],H.push({command:mn.addImport,args:[te[J],re]}),ne.splice(ne.length-ue,0,J));for(let ie of G){let ge=ee[ie.id];ge&&!w(ge,ie)&&H.push({command:mn.updateImport,args:[ie.id,ie]})}}(E.imports,S.imports,M),w(E.transition,S.transition)||M.push({command:mn.setTransition,args:[S.transition]}),w(E.light,S.light)||M.push({command:mn.setLight,args:[S.light]}),w(E.fog,S.fog)||M.push({command:mn.setFog,args:[S.fog]}),w(E.projection,S.projection)||M.push({command:mn.setProjection,args:[S.projection]}),w(E.lights,S.lights)||M.push({command:mn.setLights,args:[S.lights]}),w(E.camera,S.camera)||M.push({command:mn.setCamera,args:[S.camera]}),!w(E["color-theme"],S["color-theme"]))return[{command:mn.setStyle,args:[S]}];let P={},k=[];(function(V,G,H,q){let W;for(W in G=G||{},V=V||{})V.hasOwnProperty(W)&&(G.hasOwnProperty(W)||ly(W,H,q));for(W in G){if(!G.hasOwnProperty(W))continue;let ee=G[W];V.hasOwnProperty(W)?w(V[W],ee)||(V[W].type==="geojson"&&ee.type==="geojson"&&rb(V,G,W)?H.push({command:mn.setGeoJSONSourceData,args:[W,ee.data]}):nb(W,G,H,q)):ps(W,G,H)}})(E.sources,S.sources,k,P);let N=[];E.layers&&E.layers.forEach(V=>{V.source&&P[V.source]?M.push({command:mn.removeLayer,args:[V.id]}):N.push(V)});let B=E.terrain;B&&P[B.source]&&(M.push({command:mn.setTerrain,args:[void 0]}),B=void 0),M=M.concat(k),w(B,S.terrain)||M.push({command:mn.setTerrain,args:[S.terrain]}),function(V,G,H){G=G||[];let q=(V=V||[]).map(Ed),W=G.map(Ed),ee=V.reduce(Jl,{}),te=G.reduce(Jl,{}),ne=q.slice(),ue=Object.create(null),ce,J,re,ie,ge,Se,ae;for(ce=0,J=0;ce<q.length;ce++)re=q[ce],te.hasOwnProperty(re)?J++:(H.push({command:mn.removeLayer,args:[re]}),ne.splice(ne.indexOf(re,J),1));for(ce=0,J=0;ce<W.length;ce++)re=W[W.length-1-ce],ne[ne.length-1-ce]!==re&&(ee.hasOwnProperty(re)?(H.push({command:mn.removeLayer,args:[re]}),ne.splice(ne.lastIndexOf(re,ne.length-J),1)):J++,Se=ne[ne.length-ce],H.push({command:mn.addLayer,args:[te[re],Se]}),ne.splice(ne.length-ce,0,re),ue[re]=!0);for(ce=0;ce<W.length;ce++)if(re=W[ce],ie=ee[re],ge=te[re],!ue[re]&&!w(ie,ge))if(w(ie.source,ge.source)&&w(ie["source-layer"],ge["source-layer"])&&w(ie.type,ge.type)){for(ae in Nu(ie.layout,ge.layout,H,re,null,mn.setLayoutProperty),Nu(ie.paint,ge.paint,H,re,null,mn.setPaintProperty),w(ie.slot,ge.slot)||H.push({command:mn.setSlot,args:[re,ge.slot]}),w(ie.filter,ge.filter)||H.push({command:mn.setFilter,args:[re,ge.filter]}),w(ie.minzoom,ge.minzoom)&&w(ie.maxzoom,ge.maxzoom)||H.push({command:mn.setLayerZoomRange,args:[re,ge.minzoom,ge.maxzoom]}),ie)ie.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?Nu(ie[ae],ge[ae],H,re,ae.slice(6),mn.setPaintProperty):w(ie[ae],ge[ae])||H.push({command:mn.setLayerProperty,args:[re,ae,ge[ae]]}));for(ae in ge)ge.hasOwnProperty(ae)&&!ie.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?Nu(ie[ae],ge[ae],H,re,ae.slice(6),mn.setPaintProperty):w(ie[ae],ge[ae])||H.push({command:mn.setLayerProperty,args:[re,ae,ge[ae]]}))}else H.push({command:mn.removeLayer,args:[re]}),Se=ne[ne.lastIndexOf(re)+1],H.push({command:mn.addLayer,args:[ge,Se]})}(N,S.layers,M)}catch(P){console.warn("Unable to compute style diff:",P),M=[{command:mn.setStyle,args:[S]}]}return M}(this.serialize(),s).filter(E=>!(E.command in ab));if(g.length===0)return!1;let v=g.filter(E=>!(E.command in dm));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);let x=[];return g.forEach(E=>{x.push(this[E.command].apply(this,E.args))}),h&&Promise.all(x).then(h),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,h){return this.getImage(s)?this.fire(new r.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,this.scope,h)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new r.d(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,h,g={}){return this._checkLoaded(),this._validate(Kt,`models.${s}`,h,null,g)||(this.modelManager.addModel(s,h,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new r.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,h,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(fe,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=hd(s,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=E=>{let S=(E?"symbol:":"other:")+v.id,M=r.al(S,this.scope),P=this._sourceCaches[S]=new r.bv(M,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=P,P.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();let h=this.getOwnSource(s);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(s);for(let v of g){let x=r.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getOwnSource(s).setData(h),this._changes.setDirty()}getOwnSource(s){let h=this.getOwnSourceCache(s);return h&&h.getSource()}getOwnSources(){let s=[];for(let h in this._otherSourceCaches){let g=this.getOwnSourceCache(h);g&&s.push(g.getSource())}return s}areTilesLoaded(){let s=this._mergedSourceCaches;for(let h in s){let g=s[h]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let v of s){if(this._validate(Ae,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(h)}else this.ambientLight=new pu(v,Zt,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(h)}else this.directionalLight=new pu(v,xp,this.scope,this.options)}}let g=new r.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let s=this.directionalLight,h=this.ambientLight;if(!s||!h)return;let g=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),x=s.properties.get("intensity"),E=s.properties.get("direction"),S=1-r.ac(E.x,E.y,E.z)[2]/90,M=g(v)*x*S,P=h.properties.get("color").toRenderColor(null).toArray01(),k=h.properties.get("intensity");return(M+g(P)*k)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(r.cV(s)){let h=r.cW(s),g=this.fragments.find(({id:x})=>x===h);if(!g)throw new Error(`Style import not found: ${s}`);let v=r.cU(s);return g.style.getFragmentStyle(v)}{let h=this.fragments.find(({id:g})=>g===s);if(!h)throw new Error(`Style import not found: ${s}`);return h.style}}getConfigProperty(s,h){let g=this.getFragmentStyle(s);if(!g)return null;let v=r.al(h,g.scope),x=g.options.get(v),E=x?x.value||x.default:null;return E?E.serialize():null}setConfigProperty(s,h,g){let v=this.getFragmentStyle(s);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[h])return;let E=r.y(g);if(E.result!=="success")return void Qs(this,E.value);let S=E.value.expression,M=r.al(h,v.scope),P=v.options.get(M);if(!P)return;let k,{minValue:N,maxValue:B,stepValue:V,type:G,values:H}=x[h],q=r.y(x[h].default);q.result==="success"&&(k=q.value.expression),k?(this.options.set(M,lr(vt({},P),{value:S,default:k,minValue:N,maxValue:B,stepValue:V,type:G,values:H})),this.updateConfigDependencies()):this.fire(new r.d(new Error(`No schema defined for the config option "${h}" in the "${s}" fragment.`)))}getConfig(s){let h=this.getFragmentStyle(s);if(!h)return null;let g=h.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let E=r.al(x,h.scope),S=h.options.get(E),M=S?S.value||S.default:null;v[x]=M?M.serialize():null}return v}setConfig(s,h){let g=this.getFragmentStyle(s);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){let h=this.getFragmentStyle(s);return h?h.stylesheet.schema:null}setSchema(s,h){let g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(s,h){if(this._config=s,s||h)if(h)for(let g in h){let v,x,E=r.y(h[g].default);if(E.result==="success"&&(v=E.value.expression),s&&s[g]!==void 0){let B=r.y(s[g]);B.result==="success"&&(x=B.value.expression)}let{minValue:S,maxValue:M,stepValue:P,type:k,values:N}=h[g];if(v){let B=r.al(g,this.scope);this.options.set(B,{default:v,value:x,minValue:S,maxValue:M,stepValue:P,type:k,values:N})}else this.fire(new r.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new r.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let s of this._configDependentLayers){let h=this.getLayer(s);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){let h=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut||s._styleColorTheme.lut&&h!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(s,h,g={}){this._checkLoaded();let v=s.id;if(this._layers[v])return void this.fire(new r.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(s.type==="custom"){if(Qs(this,r.cX(s)))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=r.cT(s),s=r.W(s,{source:v})),this._validate(rt,`layers.${v}`,s,{arrayIndex:-1},g))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let E=this._order.length;if(h){let k=this._order.indexOf(h);if(k===-1)return void this.fire(new r.d(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?E=k:r.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let S=this.getOwnLayerSourceCache(x),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&x.canCastShadows()&&M&&(S.castsShadows=!0);let P=this._changes.getRemovedLayer(x);if(P&&x.source&&S&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let k=r.al(x.source,x.scope);P.type!==x.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),S.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,h){this._checkLoaded();let g=this._checkLayer(s);if(!g||s===h)return;let v=this._order.indexOf(s);this._order.splice(v,1);let x=this._order.length;if(h){let E=this._order.indexOf(h);if(E===-1)return void this.fire(new r.d(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?x=E:r.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();let h=this._checkLayer(s);if(!h)return;h.setEventedParent(null);let g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],delete this._serializedLayers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let x=!1;for(let E in this._layers)if(this._layers[E].source===h.source&&this._layers[E].canCastShadows()){x=!0;break}v.castsShadows=x}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(let h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();let v=this._checkLayer(s);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,h){this._checkLoaded();let g=this._checkLayer(s);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(s,h,g={}){this._checkLoaded();let v=this._checkLayer(s);if(v&&!w(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Ke,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=r.cT(h),this._updateLayer(v)))}getFilter(s){let h=this._checkLayer(s);if(h)return r.cT(h.filter)}setLayoutProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(x&&!w(x.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&Qs(x,Mt.call(de,{key:`layers.${s}.layout.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:r.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(h,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,h){let g=this._checkLayer(s);if(g)return g.getLayoutProperty(h)}setPaintProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(!x||w(x.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&Qs(x,_t.call(de,{key:`layers.${s}.paint.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:r.L})))return;let E=x.setPaintProperty(h,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),E&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,h){let g=this._checkLayer(s);if(g)return g.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();let g=s.source,v=s.sourceLayer,x=this._checkSource(g);if(!x)return;let E=x.type;if(E==="geojson"&&v)return void this.fire(new r.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!v)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided.")));let S=this.getOwnSourceCaches(g);for(let M of S)M.setFeatureState(v,s.id,h)}removeFeatureState(s,h){this._checkLoaded();let g=s.source,v=this._checkSource(g);if(!v)return;let x=v.type,E=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!E)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new r.d(new Error("A feature id is required to remove its specific state property.")));let S=this.getOwnSourceCaches(g);for(let M of S)M.removeFeatureState(E,s.id,h)}getFeatureState(s){this._checkLoaded();let h=s.source,g=s.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=r.W({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return r.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let s=this.getTerrain(),h=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return r.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(s){this._changes.updateLayer(s);let h=this.getLayerSourceCache(s),g=r.al(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){let h=S=>this._mergedLayers[S].type==="fill-extrusion"||this._mergedLayers[S].type==="model",g=this.order,v={},x=[];for(let S=g.length-1;S>=0;S--){let M=g[S];if(h(M)){v[M]=S;for(let P of s){let k=P[M];if(k)for(let N of k)x.push(N)}}}x.sort((S,M)=>M.intersectionZ-S.intersectionZ);let E=[];for(let S=g.length-1;S>=0;S--){let M=g[S];if(h(M))for(let P=x.length-1;P>=0;P--){let k=x[P].feature;if(k.layer&&v[k.layer.id]<S)break;E.push(k),x.pop()}else for(let P of s){let k=P[M];if(k)for(let N of k)E.push(N.feature)}}return E}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(Ke,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new r.d(new Error("parameters.layers must be an Array."))),[];for(let P of h.layers){let k=this._mergedLayers[P];if(!k)return this.fire(new r.d(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v[k.source]=!0}}let x=[],E=h.serializedLayers||{},S=h&&h.layers?h.layers.some(P=>{let k=this.getLayer(P);return k&&k.is3D()}):this.has3DLayers(),M=Si.createFromScreenPoints(s,g);for(let P in this._mergedSourceCaches){let k=this._mergedSourceCaches[P].getSource();if(!k||k.scope!==h.scope)continue;let N=this._mergedSourceCaches[P].getSource().id;h.layers&&!v[N]||x.push(eb(this._mergedSourceCaches[P],this._mergedLayers,E,M,h,g,S,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,k,N,B,V,G,H){let q={},W=G.queryRenderedSymbols(B),ee=[];for(let te of Object.keys(W).map(Number))ee.push(H[te]);ee.sort(Kl);for(let te of ee){let ne=te.featureIndex.lookupSymbolFeatures(W[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,V.filter,V.layers,V.availableImages,P);for(let ue in ne){let ce=q[ue]=q[ue]||[],J=ne[ue];J.sort((re,ie)=>{let ge=te.featureSortOrder;if(ge){let Se=ge.indexOf(re.featureIndex);return ge.indexOf(ie.featureIndex)-Se}return ie.featureIndex-re.featureIndex});for(let re of J)ce.push(re)}}for(let te in q)q[te].forEach(ne=>{let ue=ne.feature,ce=N(P[te]);if(!ce)return;let J=ce.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=J});return q}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,h){h&&h.filter&&this._validate(Ke,"querySourceFeatures.filter",h.filter,null,h);let g=this.getOwnSourceCaches(s),v=[];for(let x of g)v=v.concat(Fu(x,h));return v}addSourceType(s,h,g){return Mo.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Mo.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,h,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let S in s)if(!w(s[S],v[S])){x=!0;break}if(!x)return;let E=this._getTransitionParameters();this.light.setLight(s,h,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,h=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s,v=s.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let S="terrain-dem-src";this.addSource(S,g.source),g=r.cT(g),g=r.W(g,{source:S})}let x=r.W({},g),E={};if(this.terrain&&v){x.source=this.terrain.get().source;let S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(E.style=S.serialize())}if(this._validate(ve,"terrain",x,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new r.f("data",{dataType:"style"}))}else{let x=this.terrain,E=x.get();for(let S of Object.keys(r.L.terrain))!g.hasOwnProperty(S)&&r.L.terrain[S].default&&(g[S]=r.L.terrain[S].default);for(let S in s)if(!w(s[S],E[S])){x.set(s,this.options),this.stylesheet.terrain=s;let M=this._getTransitionParameters({duration:0});x.updateTransitions(M),this.fire(new r.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){let h=this.fog=new B_(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!w(h.get(),s)){h.set(s,this.options),this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}setColorTheme(s){this._checkLoaded();let h=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=s,!s)return this._styleColorTheme.lut=null,void h();let g=this._evaluateColorThemeData(s);this._loadColorTheme(g).then(()=>{h()}).catch(v=>{r.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(s){return{now:r.e.now(),transition:r.W(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;let s=[],h=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?s.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){let g=this.terrain=new Nn(s,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,g,v,x={}){if(x&&x.validate===!1)return!1;let E=r.W({},this.serialize());return Qs(this,s.call(de,r.W({key:h,style:E,value:g,styleSpec:r.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){let h=this.getSourceCaches(s);for(let g of h)g.clearTiles()}clearSources(){for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){let h=this.getSourceCaches(s);for(let g of h)g.resume(),g.reload()}reloadSources(){for(let s of this.getSources())s.reload&&s.reload()}updateSources(s){let h;this.directionalLight&&(h=xu(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,h)}_generateCollisionBoxes(){for(let s in this._sourceCaches){let h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,g,v,x,E,S=!1){let M=!1,P=!1,k={},N={};for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=r.al(G.source,G.scope),q=k[H];if(!q){let ee=this.getLayerSourceCache(G);if(!ee)continue;let te=ee.getRenderableIds(!0).map(ne=>ee.getTileByID(ne));N[H]=te.slice(),q=k[H]=te.sort((ne,ue)=>ue.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ue.tileID)?-1:1))}let W=this.crossTileSymbolIndex.addLayer(G,q,h.center.lng,h.projection);M=M||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new r.f("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.e.now(),h.zoom))&&(this.pauseablePlacement=new Cd(h,this._mergedOrder,S,g,v,x,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.e.now()),P=!0),M&&this.pauseablePlacement.placement.setStale()),P||M){this._buildingIndex.onNewFrame(h.zoom);for(let V=0;V<this._mergedOrder.length;V++){let G=this._mergedLayers[this._mergedOrder[V]];if(G.type!=="symbol")continue;let H=this.isLayerClipped(G)&&this._clipLayerIndices.some(q=>V<q);this.placement.updateLayerOpacities(G,k[r.al(G.source,G.scope)],V,H?E:null)}}let B=!1;for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=k[r.al(G.source,G.scope)];for(let q of H){let W=q.getBucket(G);W&&q.latestFeatureIndex&&G.fqid===W.layerIds[0]&&(B=W.updateOcclusionOpacities(s.context,s.symbolParams,s._dt)||B)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.e.now())||B,occlusionQueryBasedOpacityChanged:B}}_releaseSymbolFadeTiles(){for(let s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,h){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===s.id)!==-1)return void this.fire(new r.d(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!h)return g.push(s),this._loadImports([s],!0);let v=g.findIndex(({id:x})=>x===h);return v===-1&&this.fire(new r.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(s).concat(g.slice(v)),this._loadImports([s],!0,h)}updateImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);return v===-1?this:typeof h=="string"?(this.setImportUrl(s,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(s,h.url),w(h.config,g[v].config)||this.setImportConfig(s,h.config),w(h.data,g[v].data)||this.setImportData(s,h.data),this)}moveImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;let x=this.getImportIndex(h);if(x===-1)return this;let E=g[v],S=this.fragments[v];return g=g.filter(({id:M})=>M!==s),this.fragments=this.fragments.filter(({id:M})=>M!==s),this.stylesheet.imports=g.slice(0,x).concat(E).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(S).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;g[v].url=h;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(h),this}setImportData(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(s,v[g].url))}setImportConfig(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;let x=this.fragments[g],E=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=h,x.style.updateConfig(h,E),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){let h=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return h===-1&&this.fire(new r.d(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),h}getLayer(s){return this._mergedLayers[s]}getSources(){let s=[];for(let h in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[h];g&&s.push(g.getSource())}return s}getSource(s,h){let g=this.getSourceCache(s,h);return g&&g.getSource()}getLayerSource(s){let h=this.getLayerSourceCache(s);return h&&h.getSource()}getSourceCache(s,h){let g=r.al(s,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){let h=r.al(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[s]&&h.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&h.push(this._mergedSymbolSourceCaches[s]),h}updateSourceCaches(){let s=this._changes.getUpdatedSourceCaches();for(let h in s){let g=s[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(s){let h=this._changes.getUpdatedPaintProperties();for(let g of h){let v=this.getLayer(g);v&&v.updateTransitions(s)}}getImages(s,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(s,h,g){return r.c$(h,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){let h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){let h=this.getOwnSourceCaches(s);return h.length===0?(this.fire(new r.d(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,h){if(this._clipLayerIndices.length===0&&s.type!=="fill-extrusion")return!1;let g=s.type==="fill-extrusion"&&s.sourceLayer==="building",v=0;if(s.is3D()){if(g||h&&h.type==="batched-model")return!0;s.type==="model"&&(v=r.cu.Model)}else s.type==="symbol"&&(v=r.cu.Symbol);for(let x of this._clipLayerIndices){let E=this._mergedLayers[this._mergedOrder[x]];if(!E)continue;let S=[];for(let M of E.layout.get("clip-layer-types"))S.push(M==="model"?r.cu.Model:M==="symbol"?r.cu.Symbol:r.cu.FillExtrusion);for(let M of S)if(v&M)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function fm(m,s){let h=!1,g=null,v=()=>{g=null,h&&(m(),g=setTimeout(v,s),h=!1)};return()=>(h=!0,g||v(),g)}Mo.getSourceType=function(m){return ti[m]},Mo.setSourceType=function(m,s){ti[m]=s},Mo.registerForPluginStateChange=r.cL;class lb{constructor(s){this._hashName=s&&encodeURIComponent(s),r.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=fm(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let s=this._map;if(!s)return"";let h=Uu(s);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(E=>{let S=E.split("=")[0];return S===g?(v=!0,`${S}=${h}`):E}).filter(E=>E);return v||x.push(`${g}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let s=location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){let s=this._map;if(!s)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){let g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Uu(m,s){let h=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),E=Math.round(h.lng*x)/x,S=Math.round(h.lat*x)/x,M=m.getBearing(),P=m.getPitch(),k=s?`/${E}/${S}/${g}`:`${g}/${S}/${E}`;return(M||P)&&(k+="/"+Math.round(10*M)/10),P&&(k+=`/${Math.round(P)}`),k}let Id={linearity:.3,easing:r.d0(0,0,.3,1)},_y=r.W({deceleration:2500,maxSpeed:1400},Id),pm=r.W({deceleration:20,maxSpeed:1400},Id),Dd=r.W({deceleration:1e3,maxSpeed:360},Id),mm=r.W({deceleration:1e3,maxSpeed:90},Id);class Ua{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.e.now(),settings:s})}_drainInertiaBuffer(){let s=this._inertiaBuffer,h=r.e.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=$u(h.pan.mag(),g,r.W({},_y,s||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,ec(v,x)}if(h.zoom){let x=$u(h.zoom,g,pm);v.zoom=this._map.transform.zoom+x.amount,ec(v,x)}if(h.bearing){let x=$u(h.bearing,g,Dd);v.bearing=this._map.transform.bearing+r.at(x.amount,-179,179),ec(v,x)}if(h.pitch){let x=$u(h.pitch,g,mm);v.pitch=this._map.transform.pitch+x.amount,ec(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function ec(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function $u(m,s,h){let{maxSpeed:g,linearity:v,deceleration:x}=h,E=r.at(m*v/(s/1e3),-g,g),S=Math.abs(E)/(x*v);return{easing:h.easing,duration:1e3*S,amount:E*(S/2)}}class ni extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,v={}){let x=ft(h.getCanvasContainer(),g),E=h.unproject(x);super(s,r.W({point:x,lngLat:E,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class Js extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){let v=s==="touchend"?g.changedTouches:g.touches,x=Ue(h.getCanvasContainer(),v),E=x.map(M=>h.unproject(M)),S=x.reduce((M,P,k,N)=>M.add(P.div(N.length)),new r.P(0,0));super(s,{points:x,point:S,lngLats:E,lngLat:h.unproject(S),originalEvent:g}),this._defaultPrevented=!1}}class Md extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class gm{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Md(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new ni(s.type,this._map,s))}mouseup(s){this._map.fire(new ni(s.type,this._map,s))}preclick(s){let h=r.W({},s);h.type="preclick",this._map.fire(new ni(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new ni(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new ni(s.type,this._map,s))}mouseover(s){this._map.fire(new ni(s.type,this._map,s))}mouseout(s){this._map.fire(new ni(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Js(s.type,this._map,s))}touchmove(s){this._map.fire(new Js(s.type,this._map,s))}touchend(s){this._map.fire(new Js(s.type,this._map,s))}touchcancel(s){this._map.fire(new Js(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gu{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new ni(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ni("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new ni(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ad{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(Ie(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;let g=h,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));let E=Math.min(v.x,g.x),S=Math.max(v.x,g.x),M=Math.min(v.y,g.y),P=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=S-E+"px",this._box.style.height=P-M+"px")})}mouseupWindow(s,h){if(!this._active)return;let g=this._startPos,v=h;if(g&&s.button===0){if(this.reset(),nt(),g.x!==v.x||g.y!==v.y)return this._map.fire(new r.f("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Qe(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new r.f(s,{originalEvent:h}))}}function Hu(m,s){let h={};for(let g=0;g<m.length;g++)h[m[g].identifier]=s[g];return h}class yy{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new r.P(0,0);for(let E of v)x._add(E);return x.div(v.length)}(h),this.touches=Hu(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;let v=Hu(g,h);for(let x in this.touches){let E=v[x];(!E||E.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class qu{constructor(s){this.singleTap=new yy(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){let v=this.singleTap.touchend(s,h,g);if(v){let x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Pd{constructor(){this._zoomIn=new qu({numTouches:1,numTaps:2}),this._zoomOut=new qu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){let v=this._zoomIn.touchend(s,h,g),x=this._zoomOut.touchend(s,h,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Wu={0:1,2:2};class Rd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;let g=Nt(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){let g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(v,x){let E=Wu[x];return v.buttons===void 0||(v.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(s){this._lastPoint&&Nt(s)===this._eventButton&&(this._moved&&nt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vy extends Rd{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class _m extends Rd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class $a extends Rd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class xy{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),r.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!r.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);let v=Hu(g,h),x=new r.P(0,0),E=new r.P(0,0),S=0;for(let P in v){let k=v[P],N=this._touches[P];N&&(x._add(k),E._add(k.sub(N)),S++,v[P]=k)}if(this._touches=v,S<this._minTouches||!E.mag())return;let M=E.div(S);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ym{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){let v=this._firstTwoTouches;if(!v)return;s.preventDefault();let[x,E]=v,S=Od(g,h,x),M=Od(g,h,E);if(!S||!M)return;let P=this._aroundCenter?null:S.add(M).div(2);return this._move([S,M],P,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,E=Od(g,h,v),S=Od(g,h,x);E&&S||(this._active&&nt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Od(m,s,h){for(let g=0;g<m.length;g++)if(m[g].identifier===h)return s[g]}function by(m,s){return Math.log(m/s)/Math.LN2}class vm extends ym{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){let g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(by(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:by(this._distance,g),pinchAround:h}}}function kd(m,s){return 180*m.angleWith(s)/Math.PI}class xm extends ym{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){let g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kd(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());let h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=kd(s,g);return Math.abs(v)<h}}function Zu(m){return Math.abs(m.y)>Math.abs(m.x)}class wy extends ym{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Zu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){let v=this._lastPoints;if(!v)return;let x=s[0].sub(v[0]),E=s[1].sub(v[1]);return this._map._cooperativeGestures&&!r.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+E.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;let v=s.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let E=s.y>0==h.y>0;return Zu(s)&&Zu(h)&&E}}let Ey={panStep:100,bearingStep:15,pitchStep:10};class cb{constructor(){let s=Ey;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,v=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:S=>{let M=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Xu,zoom:h?Math.round(M)+h*(s.shiftKey?2:1):M,bearing:S.getBearing()+g*this._bearingStep,pitch:S.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:S.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xu(m){return m*(2-m)}let tc=4.000244140625,Ty=1/450;class Xi{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ty,r.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||r.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,g=r.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%tc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=ft(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){let P=this._type==="wheel"&&Math.abs(this._delta)>tc?this._wheelZoomRate:this._defaultZoomRate,k=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&k!==0&&(k=1/k);let N=h(),B=Math.pow(2,N),V=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(V*k))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,E,S=!1;if(this._type==="wheel"&&v&&x){let P=Math.min((r.e.now()-this._lastWheelEventTime)/200,1),k=x(P);E=r.a2(v,g,k),P<1?this._frameId||(this._frameId=!0):S=!0}else E=g,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-h();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=r.d2;if(this._prevEase){let g=this._prevEase,v=(r.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),E=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-E*E);h=r.d0(E,S,.25,1)}return this._prevEase={start:r.e.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class bm{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ld{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fd{constructor(){this._tap=new qu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wm{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Em{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nd{constructor(s,h,g,v){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let nc=m=>m.zoom||m.drag||m.pitch||m.rotate;class Tm extends r.f{}class zd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){let g=r._.sub([],h,s);this.radius=r._.length(g[2]<0?r._.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){r._.div(s,s,this.constants),r._.normalize(s,s),r._.mul(s,s,this.constants);let h=r._.scale([],s,this.radius);if(h[2]>0){let g=r._.scale([],[0,0,1],r._.dot(h,[0,0,1])),v=r._.scale([],r._.normalize([],[h[0],h[1],0]),this.radius),x=r._.add([],h,r._.scale([],r._.sub([],r._.add([],v,g),h),2));h[0]=x[0],h[1]=x[1]}return h}}function Yu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Sy{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ua(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),r.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,E]of this._listeners){let S=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,S,E)}}destroy(){for(let[s,h,g]of this._listeners){let v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(h,v,g)}}_addDefaultHandlers(s){let h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new gm(h,s));let v=h.boxZoom=new Ad(h,s);this._add("boxZoom",v);let x=new Pd,E=new Ld;h.doubleClickZoom=new bm(E,x),this._add("tapZoom",x),this._add("clickZoom",E);let S=new Fd;this._add("tapDragZoom",S);let M=h.touchPitch=new wy(h);this._add("touchPitch",M);let P=new _m(s),k=new $a(s);h.dragRotate=new Em(s,P,k),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);let N=new vy(s),B=new xy(h,s);h.dragPan=new wm(g,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);let V=new xm,G=new vm;h.touchZoomRotate=new Nd(g,G,V,S),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Gu(h));let H=h.scrollZoom=new Xi(h,this);this._add("scrollZoom",H,["mousePan"]);let q=h.keyboard=new cb;this._add("keyboard",q);for(let W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[W]&&h[W].enable(s[W])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(let v in s)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){let h=[];for(let g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;let g=s.type==="renderFrame",v=g?void 0:s,x={needsRenderFrame:!1},E={},S={},M=s.touches?this._getMapTouches(s.touches):void 0,P=M?Ue(this._el,M):g?void 0:ft(this._el,s);for(let{handlerName:B,handler:V,allowed:G}of this._handlers){if(!V.isEnabled())continue;let H;this._blockedByActive(S,G,B)?V.reset():V[h||s.type]&&(H=V[h||s.type](s,P,M),this.mergeHandlerResult(x,E,H,B,v),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||V.isActive())&&(S[B]=V)}let k={};for(let B in this._previousActiveHandlers)S[B]||(k[B]=v);this._previousActiveHandlers=S,(Object.keys(k).length||Yu(x))&&(this._changes.push([x,E,k]),this._triggerRenderFrame()),(Object.keys(S).length||Yu(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:N}=x;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(s,h,g,v,x){if(!g)return;r.W(s,g);let E={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(h.zoom=E),g.panDelta!==void 0&&(h.drag=E),g.pitchDelta!==void 0&&(h.pitch=E),g.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){let s={},h={},g={};for(let[v,x,E]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),r.W(h,x),r.W(g,E);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){let v=this._map,x=v.transform,E=ee=>[ee.x,ee.y,ee.z];if((ee=>{let te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!Yu(s)){let ee=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ee!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!Yu(s))return void this._fireEvents(h,g,!0);let{panDelta:S,zoomDelta:M,bearingDelta:P,pitchDelta:k,around:N,aroundCoord:B,pinchAround:V}=s;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),V!==void 0&&(N=V),(M||(ee=>h[ee]&&!this._eventsInProgress[ee])("drag"))&&N&&(this._dragOrigin=E(x.pointCoordinate3D(N)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),N=N||v.transform.centerPoint,P&&(x.bearing+=P),k&&(x.pitch+=k),x._updateCameraState();let G=[0,0,0];if(S)if(x.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N).dir),te=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N.sub(S)).dir);G[0]=te[0]-ee[0],G[1]=te[1]-ee[1]}else{let ee=x.pointCoordinate(N);if(x.projection.name==="globe"){S=S.rotate(-x.angle);let te=x._pixelsPerMercatorPixel/x.worldSize;G[0]=-S.x*r.d3(r.ay(ee.y))*te,G[1]=-S.y*r.d3(x.center.lat)*te}else{let te=x.pointCoordinate(N.sub(S));ee&&te&&(G[0]=te.x-ee.x,G[1]=te.y-ee.y)}}let H=x.zoom,q=[0,0,0];if(M){let ee=E(B||x.pointCoordinate3D(N)),te={dir:r._.normalize([],r._.sub([],ee,x._camera.position))};if(te.dir[2]<0){let ne=x.zoomDeltaToMovement(ee,M);r._.scale(q,te.dir,ne)}}let W=r._.add(G,G,q);x._translateCameraConstrained(W),M&&Math.abs(x.zoom-H)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){let v=nc(this._eventsInProgress),x=nc(s),E={};for(let k in s){let{originalEvent:N}=s[k];this._eventsInProgress[k]||(E[`${k}start`]=N),this._eventsInProgress[k]=s[k]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let k in E)this._fireEvent(k,E[k]);x&&this._fireEvent("move",x.originalEvent);for(let k in s){let{originalEvent:N}=s[k];this._fireEvent(k,N)}let S={},M;for(let k in this._eventsInProgress){let{handlerName:N,originalEvent:B}=this._eventsInProgress[k];this._handlersById[N].isActive()||(delete this._eventsInProgress[k],M=h[N]||B,S[`${k}end`]=M)}for(let k in S)this._fireEvent(k,S[k]);let P=nc(this._eventsInProgress);if(g&&(v||x)&&!P){this._updatingCamera=!0;let k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;k?(N(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:M})):(this._map.fire(new r.f("moveend",{originalEvent:M})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new r.f(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Tm("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Ga="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ub extends r.E{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,r.bp(["_renderFrameCallback"],this)}getCenter(){return new r.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=r.P.convert(s).mult(-1),this.panTo(this.transform.center,r.W({offset:s},h),g)}panTo(s,h,g){return this.easeTo(r.W({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(r.W({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(r.W({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,r.W({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(r.W({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=r.ai.convert(s);let g=h&&h.bearing||0,v=h&&h.pitch||0,x=s.getNorthWest(),E=s.getSouthEast();return this._cameraForBounds(this.transform,x,E,g,v,h)}_extendPadding(s){let h={top:0,right:0,bottom:0,left:0};return s==null?r.W({},h,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:r.W({},h,s)}_extendCameraOptions(s){return(s=r.W({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,h){let g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,v,x,E){let S=s.clone(),M=this._extendCameraOptions(E);S.bearing=v,S.pitch=x;let P=r.aI.convert(h),k=r.aI.convert(g),N=.5*(P.lat+k.lat),B=.5*(P.lng+k.lng),V=r.d4(N,B),G=r._.normalize([],V),H=r._.normalize([],r._.cross([],G,[0,1,0])),q=r._.cross([],H,G),W=[H[0],H[1],H[2],0,q[0],q[1],q[2],0,G[0],G[1],G[2],0,0,0,0,1],ee=[V,r.d4(P.lat,P.lng),r.d4(k.lat,P.lng),r.d4(k.lat,k.lng),r.d4(P.lat,k.lng),r.d4(N,P.lng),r.d4(N,k.lng),r.d4(P.lat,B),r.d4(k.lat,B)],te=r.b6.fromPoints(ee.map(Fe=>[r._.dot(H,Fe),r._.dot(q,Fe),r._.dot(G,Fe)])),ne=r._.transformMat4([],te.center,W);r._.squaredLength(ne)===0&&r._.set(ne,0,0,1),r._.normalize(ne,ne),r._.scale(ne,ne,r.cD),S.center=r.d5(ne);let ue=S.getWorldToCameraMatrix(),ce=r.ad.invert(new Float64Array(16),ue);te=r.b6.applyTransform(te,r.ad.multiply([],ue,W));let J=this._extendAABB(te,S,M,v);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=J,r._.transformMat4(ne,ne,ue);let re=.5*(te.max[2]-te.min[2]),ie=this._minimumAABBFrustumDistance(S,te),ge=r._.scale([],[0,0,1],re),Se=r._.add(ge,ne,ge),ae=ie+(S.pitch===0?0:r._.distance(ne,Se)),Ce=S.globeCenterInViewSpace,Me=r._.sub([],ne,[Ce[0],Ce[1],Ce[2]]);r._.normalize(Me,Me),r._.scale(Me,Me,ae);let $e=r._.add([],ne,Me);r._.transformMat4($e,$e,ce);let Ge=r.d7/r.cD,Ve=r._.length($e),xe=r.ax(Math.max(Ve*Ge-r.d7,Number.EPSILON),0),Re=Math.min(S.zoomFromMercatorZAdjusted(xe),M.maxZoom);return Re>.5*(r.b1+r.aU)?(S.setProjection({name:"mercator"}),S.zoom=Re,this._cameraForBounds(S,h,g,v,x,E)):{center:S.center,zoom:Re,bearing:v,pitch:x}}_extendAABB(s,h,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),S=E,M=x,P=x,k=E,N=h.width-(M+P),B=h.height-(S+k),V=r._.sub([],s.max,s.min),G=Math.min(N/V[0],B/V[1]),H=Math.min(h.scaleZoom(h.scale*G),g.maxZoom);if(isNaN(H))return null;let q=h.scale/h.zoomScale(H),W=new r.b6([s.min[0]-M*q,s.min[1]-k*q,s.min[2]],[s.max[0]+P*q,s.max[1]+S*q,s.max[2]]),ee=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new r.P(g.offset.x,g.offset.y):r.P.convert(g.offset)).rotate(-r.ab(v));return W.center[0]-=ee.x*q,W.center[1]+=ee.y*q,W}queryTerrainElevation(s,h){let g=this.transform.elevation;return g?(h=r.W({},{exaggerated:!0},h),g.getAtPoint(r.Y.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,v,x,E){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,g,v,x,E);let S=s.clone(),M=this._extendCameraOptions(E);S.bearing=v,S.pitch=x;let P=r.aI.convert(h),k=r.aI.convert(g),N=new r.aI(P.lng,k.lat),B=new r.aI(k.lng,P.lat),V=S.project(P),G=S.project(k),H=this.queryTerrainElevation(P),q=this.queryTerrainElevation(k),W=this.queryTerrainElevation(N),ee=this.queryTerrainElevation(B),te=[[V.x,V.y,Math.min(H||0,q||0,W||0,ee||0)],[G.x,G.y,Math.max(H||0,q||0,W||0,ee||0)]],ne=r.b6.fromPoints(te),ue=S.getWorldToCameraMatrix(),ce=r.ad.invert(new Float64Array(16),ue);ne=r.b6.applyTransform(ne,ue);let J=this._extendAABB(ne,S,M,v);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=J;let re=.5*r._.sub([],ne.max,ne.min)[2],ie=this._minimumAABBFrustumDistance(S,ne),ge=[0,0,1,0];r.aA.transformMat4(ge,ge,ue),r.aA.normalize(ge,ge);let Se=r._.scale([],ge,ie+re),ae=r._.add([],ne.center,Se);r._.transformMat4(ne.center,ne.center,ce),r._.transformMat4(ae,ae,ce);let Ce=[ne.center[0],ne.center[1],ae[2]*S.pixelsPerMeter];r._.scale(Ce,Ce,1/S.worldSize);let Me=r.d6(Ce[0]),$e=r.ay(Ce[1]),Ge=Math.min(S._zoomFromMercatorZ(Ce[2]),M.maxZoom),Ve=new r.aI(Me,$e);return S.mercatorFromTransition&&Ge<.5*(r.b1+r.aU)?(S.setProjection({name:"globe"}),S.zoom=Ge,this._cameraForBounds(S,h,g,v,x,E)):{center:Ve,zoom:Ge,bearing:v,pitch:x}}fitBounds(s,h,g){let v=this.cameraForBounds(s,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(s,h,g,v,x){let E=r.P.convert(s),S=r.P.convert(h),M=new r.P(Math.min(E.x,S.x),Math.min(E.y,S.y)),P=new r.P(Math.max(E.x,S.x),Math.max(E.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,S))return this;let k=this.transform.pointLocation3D(M),N=this.transform.pointLocation3D(P),B=this.transform.pointLocation3D(new r.P(M.x,P.y)),V=this.transform.pointLocation3D(new r.P(P.x,M.y)),G=[Math.min(k.lng,N.lng,B.lng,V.lng),Math.min(k.lat,N.lat,B.lat,V.lat)],H=[Math.max(k.lng,N.lng,B.lng,V.lng),Math.max(k.lat,N.lat,B.lat,V.lat)],q=v&&v.pitch?v.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,G,H,g,q,v);return this._fitInternal(W,v,x)}_fitInternal(s,h,g){return s?(h=r.W(s,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(s,h){this.stop();let g=s.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,E=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=r.aI.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(x=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(E=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new r.f("movestart",h)).fire(new r.f("move",h)),v&&this.fire(new r.f("zoomstart",h)).fire(new r.f("zoom",h)).fire(new r.f("zoomend",h)),x&&this.fire(new r.f("rotatestart",h)).fire(new r.f("rotate",h)).fire(new r.f("rotateend",h)),E&&this.fire(new r.f("pitchstart",h)).fire(new r.f("pitch",h)).fire(new r.f("pitchend",h)),this.fire(new r.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Ga),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){let g=this.transform;if(!g.projection.supportsFreeCamera)return r.w(Ga),this;this.stop();let v=g.zoom,x=g.pitch,E=g.bearing;g.setFreeCameraOptions(s);let S=v!==g.zoom,M=x!==g.pitch,P=E!==g.bearing;return this.fire(new r.f("movestart",h)).fire(new r.f("move",h)),S&&this.fire(new r.f("zoomstart",h)).fire(new r.f("zoom",h)).fire(new r.f("zoomend",h)),P&&this.fire(new r.f("rotatestart",h)).fire(new r.f("rotate",h)).fire(new r.f("rotateend",h)),M&&this.fire(new r.f("pitchstart",h)).fire(new r.f("pitch",h)).fire(new r.f("pitchend",h)),this.fire(new r.f("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=r.W({offset:[0,0],duration:500,easing:r.d2},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),S=this.getPadding(),M="zoom"in s?+s.zoom:v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,k="pitch"in s?+s.pitch:E,N=this._extendPadding(s.padding),B=r.P.convert(s.offset),V,G,H;if(g.projection.name==="globe"){let ie=r.Y.fromLngLat(g.center),ge=B.rotate(-g.angle);ie.x+=ge.x/g.worldSize,ie.y+=ge.y/g.worldSize;let Se=ie.toLngLat(),ae=r.aI.convert(s.center||Se);this._normalizeCenter(ae),V=g.centerPoint.add(ge),G=new r.P(ie.x,ie.y).mult(g.worldSize),H=new r.P(r.aj(ae.lng),r.ak(ae.lat)).mult(g.worldSize).sub(G)}else{V=g.centerPoint.add(B);let ie=g.pointLocation(V),ge=r.aI.convert(s.center||ie);this._normalizeCenter(ge),G=g.project(ie),H=g.project(ge).sub(G)}let q=g.zoomScale(M-v),W,ee;s.around&&(W=r.aI.convert(s.around),ee=g.locationPoint(W));let te=this._zooming||M!==v,ne=this._rotating||x!==P,ue=this._pitching||k!==E,ce=!g.isPaddingEqual(N),J=ie=>ge=>{if(te&&(ie.zoom=r.a2(v,M,ge)),ne&&(ie.bearing=r.a2(x,P,ge)),ue&&(ie.pitch=r.a2(E,k,ge)),ce&&(ie.interpolatePadding(S,N,ge),V=ie.centerPoint.add(B)),W)ie.setLocationAtPoint(W,ee);else{let Se=ie.zoomScale(ie.zoom-v),ae=M>v?Math.min(2,q):Math.max(.5,q),Ce=Math.pow(ae,1-ge),Me=ie.unproject(G.add(H.mult(ge*Ce)).mult(Se));ie.setLocationAtPoint(ie.renderWorldCopies?Me.wrap():Me,V)}return s.preloadOnly||this._fireMoveEvents(h),ie};if(s.preloadOnly){let ie=this._emulate(J,s.duration,g);return this._preloadTiles(ie),this}let re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=ne,this._pitching=ue,this._padding=ce,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,re),this._ease(J(g),ie=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,ie)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new r.f("movestart",s)),this._zooming&&!g.zooming&&this.fire(new r.f("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new r.f("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new r.f("pitchstart",s))}_fireMoveEvents(s){this.fire(new r.f("move",s)),this._zooming&&this.fire(new r.f("zoom",s)),this._rotating&&this.fire(new r.f("rotate",s)),this._pitching&&this.fire(new r.f("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new r.f("zoomend",s)),v&&this.fire(new r.f("rotateend",s)),x&&this.fire(new r.f("pitchend",s)),this.fire(new r.f("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){let Re=r.ah(s,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Re,h)}this.stop(),s=r.W({offset:[0,0],speed:1.2,curve:1.42,easing:r.d2},s);let g=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),S=this.getPadding(),M="zoom"in s?r.at(+s.zoom,g.minZoom,g.maxZoom):v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,k="pitch"in s?+s.pitch:E,N=this._extendPadding(s.padding),B=g.zoomScale(M-v),V=r.P.convert(s.offset),G=g.centerPoint.add(V),H=g.pointLocation(G),q=r.aI.convert(s.center||H);this._normalizeCenter(q);let W=g.project(H),ee=g.project(q).sub(W),te=s.curve,ne=Math.max(g.width,g.height),ue=ne/B,ce=ee.mag();if("minZoom"in s){let Re=r.at(Math.min(s.minZoom,v,M),g.minZoom,g.maxZoom),Fe=ne/g.zoomScale(Re-v);te=Math.sqrt(Fe/ce*2)}let J=te*te;function re(Re){let Fe=(ue*ue-ne*ne+(Re?-1:1)*J*J*ce*ce)/(2*(Re?ue:ne)*J*ce);return Math.log(Math.sqrt(Fe*Fe+1)-Fe)}function ie(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ge(Re){return(Math.exp(Re)+Math.exp(-Re))/2}let Se=re(0),ae=function(Re){return ge(Se)/ge(Se+te*Re)},Ce=function(Re){return ne*((ge(Se)*(ie(Fe=Se+te*Re)/ge(Fe))-ie(Se))/J)/ce;var Fe},Me=(re(1)-Se)/te;if(Math.abs(ce)<1e-6||!isFinite(Me)){if(Math.abs(ne-ue)<1e-6)return this.easeTo(s,h);let Re=ue<ne?-1:1;Me=Math.abs(Math.log(ue/ne))/te,Ce=function(){return 0},ae=function(Fe){return Math.exp(Re*te*Fe)}}s.duration="duration"in s?+s.duration:1e3*Me/("screenSpeed"in s?+s.screenSpeed/te:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);let $e=x!==P,Ge=k!==E,Ve=!g.isPaddingEqual(N),xe=Re=>Fe=>{let ot=Fe*Me,ct=1/ae(ot);Re.zoom=Fe===1?M:v+Re.scaleZoom(ct),$e&&(Re.bearing=r.a2(x,P,Fe)),Ge&&(Re.pitch=r.a2(E,k,Fe)),Ve&&(Re.interpolatePadding(S,N,Fe),G=Re.centerPoint.add(V));let at=Fe===1?q:Re.unproject(W.add(ee.mult(Ce(ot))).mult(ct));return Re.setLocationAtPoint(Re.renderWorldCopies?at.wrap():at,G),Re._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),Re};if(s.preloadOnly){let Re=this._emulate(xe,s.duration,g);return this._preloadTiles(Re),this}return this._zooming=!0,this._rotating=$e,this._pitching=Ge,this._padding=Ve,this._prepareEase(h,!1),this._ease(xe(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){let g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=r.e.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let s=Math.min((r.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=r.au(s,-180,180);let g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&r.e.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,g){let v=Math.ceil(15*h/1e3),x=[],E=s(g.clone());for(let S=0;S<=v;S++){let M=E(S/v);x.push(M.clone())}return x}_preloadTiles(s,h){}}class Cy{constructor(s={}){this.options=s,r.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){let h=this.options&&this.options.compact;return this._map=s,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),U("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){let g=this._map._getUIString(`AttributionControl.${h}`);s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d8.ACCESS_TOKEN}];if(s){let g=h.reduce((v,x,E)=>(x.value&&(v+=`${x.key}=${x.value}${E<h.length-1?"&":""}`),v),"?");s.href=`${r.d8.FEEDBACK_URL}/${g}#${Uu(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._mergedSourceCaches;for(let v in h){let x=h[v];if(x.used){let E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((v,x)=>v.length-x.length),s=s.filter((v,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));let g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Iy{constructor(){r.bp(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=U("div","mapboxgl-ctrl");let h=U("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(let h in s){let g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let s=this._container.children;if(s.length){let h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Dy{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){let h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){let h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(let v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function My(m,s,h){if(m=new r.aI(m.lng,m.lat),s){let g=new r.aI(m.lng-360,m.lat),v=new r.aI(m.lng+360,m.lat),x=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),E=h.locationPoint(m).distSqr(s),S=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(g).distSqr(s)<E&&(S||Math.abs(g.lng-h.center.lng)<x)?m=g:h.locationPoint(v).distSqr(s)<E&&(S||Math.abs(v.lng-h.center.lng)<x)&&(m=v)}for(;Math.abs(m.lng-h.center.lng)>180;){let g=h.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}let Sm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ku extends r.E{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=r.W({element:s},h)),r.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=r.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=U("div");let x=41,E=27,S=Q("svg",{display:"block",height:x*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${x}`},this._element),M=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},S));Q("stop",{offset:"10%","stop-opacity":.4},M),Q("stop",{offset:"100%","stop-opacity":.05},M),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=r.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in Sm)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=s&&s.className?s.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){let s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=r.aI.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){let h=s.code,g=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){let h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let s=this._map,h=this._pos;if(!s||!h)return!1;let g=s.unproject(h),v=s.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let s=this._map;if(!s)return;let h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();let g=s.unproject(h),v;s._showingGlobe()&&r.d9(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let s=this._pos;if(!s||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Sm[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||g!=="map")return"";if(!h._showingGlobe()){let M=h.getPitch();return M?`rotateX(${M}deg)`:""}let v=r.b0(r.da(h.transform,this._lngLat)),x=s.sub(r.db(h.transform)),E=Math.abs(x.x)+Math.abs(x.y);if(E===0)return"";let S=v/E;return`rotateX(${-x.y*S}deg) rotateY(${x.x*S}deg)`}_calculateZTransform(){let s=this._pos,h=this._map;if(!h||!s)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new r.aI(this._lngLat.lng,this._lngLat.lat+.001)),E=h.project(new r.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=r.b0(Math.atan2(E.y,E.x))-90}else g=-h.getBearing();else if(v==="horizon"){let x=r.$(4,6,h.getZoom()),E=r.db(h.transform);E.y+=x*h.transform.height;let S=s.sub(E),M=r.b0(Math.atan2(S.y,S.x));g=(M>90?M-270:M+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=My(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=r.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){let h=this._map;if(!h)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<x)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.f("dragstart"))),this.fire(new r.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.f("dragend")),this._state="inactive"}_addDragHandler(s){let h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;let h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Cm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ay=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ha(m=new r.P(0,0),s="bottom"){if(typeof m=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new r.P(0,m);case"top-left":return new r.P(h,h);case"top-right":return new r.P(-h,h);case"bottom":return new r.P(0,-m);case"bottom-left":return new r.P(h,-h);case"bottom-right":return new r.P(-h,-h);case"left":return new r.P(m,0);case"right":return new r.P(-m,0)}return new r.P(0,0)}return m instanceof r.P||Array.isArray(m)?r.P.convert(m):r.P.convert(m[s]||[0,0])}class Py{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;let h=r.b9((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}let Ry={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Oy{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let Im={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},qa={showCompass:!0,showZoom:!0,visualizePitch:!1};class ky{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new _m({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new $a({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),r.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),Ie()}move(s,h){let g=this.map,v=this.mouseRotate.mousemoveWindow(s,h),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let E=this.mousePitch.mousemoveWindow(s,h),S=E&&E.pitchDelta;S&&g.setPitch(g.getPitch()+S)}}off(){let s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Qe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(r.W({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),ft(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,ft(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ue(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ue(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Wa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ly={maxWidth:100,unit:"metric"},Bd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dt,supported:C,setRTLTextPlugin:r.dv,getRTLTextPluginStatus:r.dw,Map:class extends ub{constructor(m){r.dc.mark(r.dd.create);let s=m;if((m=r.W({},Im,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&r.de(window)&&(m.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new qo(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Dy,this._domRenderTaskQueue=new Dy,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.df(),this._locale=r.W({},Ry,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Py(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new r.dg(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?vt({},m.contextCreateOptions):{},typeof m.container=="string"){let h=document.getElementById(m.container);if(!h)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=h}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),r.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Oy),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Sy(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||r.d8.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new lb(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});let h=m.bounds;h&&(this.resize(),this.fitBounds(h,r.W({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Cy({customAttribution:m.customAttribution})),this._logoControl=new Iy,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new r.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new r.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new r.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=m.onAdd(this);this._controls.push(m);let g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new r.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let s=!this._moving;return s&&this.fire(new r.f("movestart",m)).fire(new r.f("move",m)),this.fire(new r.f("resize",m)),s&&this.fire(new r.f("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(r.ai.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(s=>s==="auto"?navigator.language:s):m}setLanguage(m){let s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let m=this.transform,s=m.projection.name,h;s==="globe"&&m.zoom>=r.aU?(m.setMercatorFromTransition(),h=!0):s==="mercator"&&m.zoom<r.aU&&(m.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s=m.name==="globe"&&this.transform.zoom>=r.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(r.aI.convert(m))}unproject(m){return this.transform.pointLocation3D(r.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let g=!1,v=E=>{let S=s.filter(P=>this.getLayer(P)),M=S.length?this.queryRenderedFeatures(E.point,{layers:S}):[];M.length?g||(g=!0,h.call(this,new ni(m,this,E.originalEvent,{features:M}))):g=!1},x=()=>{g=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}if(m==="mouseleave"||m==="mouseout"){let g=!1,v=E=>{let S=s.filter(M=>this.getLayer(M));(S.length?this.queryRenderedFeatures(E.point,{layers:S}):[]).length?g=!0:g&&(g=!1,h.call(this,new ni(m,this,E.originalEvent)))},x=E=>{g&&(g=!1,h.call(this,new ni(m,this,E.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=s.filter(S=>this.getLayer(S)),E=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];E.length&&(v.features=E,h.call(this,v),delete v.features)};return{layers:new Set(s),listener:h,delegates:{[m]:g}}}}on(m,s,h){if(typeof s=="function"||h===void 0)return super.on(m,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,s,h){if(typeof s=="function"||h===void 0)return super.once(m,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(m,s,h);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,s,h){if(typeof s=="function"||h===void 0)return super.off(m,s);let g=new Set(Array.isArray(s)?s:[s]);for(let E of g)if(!this._isValidId(E))return this;let v=(E,S)=>{if(E.size!==S.size)return!1;for(let M of E)if(!S.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(E=>{for(let S=0;S<E.length;S++){let M=E[S];if(M.listener===h&&v(M.layers,g)){for(let P in M.delegates)this.off(P,M.delegates[P]);return E.splice(S,1),this}}})(x),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(s!==void 0||m===void 0||m instanceof r.P||Array.isArray(m)||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],(s=s||{}).layers&&Array.isArray(s.layers)){for(let h of s.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(m,s,this.transform)}querySourceFeatures(m,s){return this._isValidId(m)?this.style.querySourceFeatures(m,s):[]}isPointOnSurface(m){let{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&r.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(m))}setStyle(m,s){return s=r.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(h,g)=>{h?(r.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(m,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){let s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){let h=r.W({},s);s&&s.config&&(h.initialConfig=s.config,delete h.config),this.style=new Mo(this,h).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Mo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new r.d(new Error("IDs can't be empty."))),!1):!r.cV(m)||(this.fire(new r.d(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){let{width:S,height:M,data:P}=r.e.getImageData(s);this.style.addImage(m,{data:new r.i({width:S,height:M},P),pixelRatio:h,stretchX:v,stretchY:x,content:E,sdf:g,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new r.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:S,height:M}=s,P=s;this.style.addImage(m,{data:new r.i({width:S,height:M},new Uint8Array(P.data)),pixelRatio:h,stretchX:v,stretchY:x,content:E,sdf:g,version:0,userImage:P}),P.onAdd&&P.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();let h=this.style.getImage(m);if(!h)return void this.fire(new r.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?r.e.getImageData(s):s,{width:v,height:x,data:E}=g;if(v===void 0||x===void 0)return void this.fire(new r.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||x!==h.data.height)return void this.fire(new r.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let S=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);h.data.replace(E,S),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new r.d(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){r.h(this._requestManager.transformRequest(m,r.R.Image),(h,g)=>{s(h,g instanceof HTMLImageElement?r.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new r.d(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){let s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s),this}updateImport(m,s){return typeof s!="string"&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){return this._isValidId(m)?this.style.getOwnLayer(m):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,h){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,h),this._update(!0)):this}setFilter(m,s,h={}){return this._isValidId(m)?(this.style.setFilter(m,s,h),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,h,g),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,h,g),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,h){return this.style.setConfigProperty(m,s,h),this._update(!0)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){let s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aI.convert(m),this.transform):0}setFeatureState(m,s){return this._isValidId(m.source)?(this.style.setFeatureState(m,s),this._update()):this}removeFeatureState(m,s){return this._isValidId(m.source)?(this.style.removeFeatureState(m,s),this._update()):this}getFeatureState(m){return this._isValidId(m.source)?this.style.getFeatureState(m):null}_updateContainerDimensions(){if(!this._container)return;let m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300,h,g,v,x=this._container;for(;x&&(!g||!v);){let E=window.getComputedStyle(x).transform;E&&E!=="none"&&(h=E.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();let s=this._canvasContainer=U("div","mapboxgl-canvas-container",m);this._canvas=U("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=U("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=U("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){let h=r.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){let s=this._markers.indexOf(m);s!==-1&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){let s=this._popups.indexOf(m);s!==-1&&this._popups.splice(s,1)}_setupPainter(){let m=r.W({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(r.dh(s,!0),this.painter=new ay(s,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.di.testSupport(s)):this.fire(new r.d(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.f("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new r.f("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new r.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,g=r.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let P=this.transform.zoom,k=this.transform.pitch,N=r.e.now(),B=new r.X(P,{now:N,fadeDuration:x,pitch:k,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g);let S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(S&&(this._placementDirty=S.needsRerender,this._occlusionOpacityChanged=S.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.dc.mark(r.dd.load),this.fire(new r.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){let P=r.e.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let k=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new r.f("gpu-timing-frame",{cpuTime:P,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){let P=this.painter.collectGpuTimers();setTimeout(()=>{let k=this.painter.queryGpuTimers(P);this.fire(new r.f("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){let P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let k=this.painter.queryGpuTimeDeferredRender(P);this.fire(new r.f("gpu-timing-deferred-render",{gpuTime:k}))},50)}let M=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||E;if((this._sourcesDirty||this._styleDirty||E||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),M||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let P=!this.isMoving()&&this.loaded();if(P&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new r.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let k=this._calculateSpeedIndex();this.fire(new r.f("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!M&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,r.dc.mark(r.dd.fullLoad),this._performanceMetricsCollection&&r.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(let s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(let s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){let h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;let E=Math.abs(v-x);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){r.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===r.dl||m.status===401)){let s=this.painter.context.gl;r.dh(s,!1),this._logoControl instanceof Iy&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){let m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());let h=this.painter.context.gl,g=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(m,s,h){let g=h[1]-h[0],v=m.length/4;for(let x=0;x<s.length;x++){let E=s[x],S=0;for(let M=0;M<E.length;M+=4)E[M]===m[M]&&E[M+1]===m[M+1]&&E[M+2]===m[M+2]&&E[M+3]===m[M+3]&&(S+=1);g+=(h[x+2]-h[x+1])*(1-S/v)}return g}remove(){this._hash&&this._hash.remove();for(let s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dp(this.painter.context.gl),r.dq.remove(),r.dr.remove(),this._removed=!0,this.fire(new r.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=r.e.frame(s=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(m){let s=this.style?this.style.getSourceCaches():[];return r.ds(s,(h,g)=>h._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){r.du(m,s)}_occlusionCriteriaSatisfied(){let m=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&m&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return r.dt}},NavigationControl:class{constructor(m){this.options=r.W({},qa,m),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(r.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let m=this._map;if(!m)return;let s=m.getZoom(),h=s===m.getMaxZoom(),g=s===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let m=this._map;if(!m)return;let s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ky(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){let m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){let h=U("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends r.E{constructor(m){super();let s=navigator.geolocation;this.options=r.W({geolocation:s},Wa,m),r.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=fm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){let s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,m(h)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){let s=this._map.getMaxBounds(),h=m.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new r.f("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("geolocate",m)),this._finish()}}_updateCamera(m){let s=new r.aI(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,g=this._map.getBearing(),v=r.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),v,{geolocateSource:!0})}_updateMarker(m){if(m){let s=new r.aI(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let m=this._map.transform,s=r.ax(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{let s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ku({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ku({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.f("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cy,ScaleControl:class{constructor(m){this.options=r.W({},Ly,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let m=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-m/2,v=s.unproject([g,h]),x=s.unproject([g+m,h]),E=v.distanceTo(x);if(this.options.unit==="imperial"){let S=3.2808*E;S>5280?this._setScale(m,S/5280,"mile"):this._setScale(m,S,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,s,h){this._map._requestDomTask(()=>{let g=function(x){let E=Math.pow(10,`${Math.floor(x)}`.length-1),S=x/E;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(M){let P=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*P)/P}(S),E*S}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${Bd[h]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:r.w("Full screen control 'container' must be a DOM element.")),r.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let m=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(m){super(),this.options=r.W(Object.create(Cm),m),r.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new r.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new r.f("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=r.aI.convert(m),this._pos=null,this._trackPointer=!1,this._update();let s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let s=document.createDocumentFragment(),h=document.createElement("body"),g;for(h.innerHTML=m;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){let h=this._closeButton=U("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;let s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,E=g.x<v/2,S=g.x>s.transform.width-v/2;if(g.y+m<x)return E?"top-left":S?"top-right":"top";if(g.y>s.transform.height-x){if(E)return"bottom-left";if(S)return"bottom-right"}return E?"left":S?"right":"bottom"}_updateClassList(){let m=this._container;if(!m)return;let s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){let s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=U("div","mapboxgl-popup",s.getContainer()),this._tip=U("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=My(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){let v=this._pos=this._trackPointer&&m?m:s.project(this._lngLat),x=Ha(this.options.offset),E=this._anchor=this._getAnchor(x.y),S=Ha(this.options.offset,E),M=v.add(S).round();s._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Sm[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&s._showingGlobe()){let v=r.d9(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(Ay);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Ku,Style:Mo,LngLat:r.aI,LngLatBounds:r.ai,Point:r.P,MercatorCoordinate:r.Y,FreeCameraOptions:Rp,Evented:r.E,config:r.d8,prewarm:r.dx,clearPrewarmedResources:r.dy,get accessToken(){return r.d8.ACCESS_TOKEN},set accessToken(m){r.d8.ACCESS_TOKEN=m},get baseApiUrl(){return r.d8.API_URL},set baseApiUrl(m){r.d8.API_URL=m},get workerCount(){return r.dz.workerCount},set workerCount(m){r.dz.workerCount=m},get maxParallelImageRequests(){return r.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){r.d8.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){r.dA(m)},get workerUrl(){return r.dB.workerUrl},set workerUrl(m){r.dB.workerUrl=m},get workerClass(){return r.dB.workerClass},set workerClass(m){r.dB.workerClass=m},get workerParams(){return r.dB.workerParams},set workerParams(m){r.dB.workerParams=m},get dracoUrl(){return r.dC()},set dracoUrl(m){r.dD(m)},get meshoptUrl(){return r.dE()},set meshoptUrl(m){r.dF(m)},setNow:r.e.setNow,restoreNow:r.e.restoreNow}});var f=l;return f})});function V4(o,i){return Object.is(o,i)}var Mi=null,dg=!1,$0=1,Dc=Symbol("SIGNAL");function cr(o){let i=Mi;return Mi=o,i}function j4(){return dg}var G0={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function rE(o){if(dg)throw new Error("");if(Mi===null)return;Mi.consumerOnSignalRead(o);let i=Mi.nextProducerIndex++;if(mf(Mi),i<Mi.producerNode.length&&Mi.producerNode[i]!==o&&fg(Mi)){let l=Mi.producerNode[i];q0(l,Mi.producerIndexOfThis[i])}Mi.producerNode[i]!==o&&(Mi.producerNode[i]=o,Mi.producerIndexOfThis[i]=fg(Mi)?v2(o,Mi,i):0),Mi.producerLastReadVersion[i]=o.version}function U4(){$0++}function $4(o){if(!(fg(o)&&!o.dirty)&&!(!o.dirty&&o.lastCleanEpoch===$0)){if(!o.producerMustRecompute(o)&&!H0(o)){o.dirty=!1,o.lastCleanEpoch=$0;return}o.producerRecomputeValue(o),o.dirty=!1,o.lastCleanEpoch=$0}}function g2(o){if(o.liveConsumerNode===void 0)return;let i=dg;dg=!0;try{for(let l of o.liveConsumerNode)l.dirty||y2(l)}finally{dg=i}}function _2(){return Mi?.consumerAllowSignalWrites!==!1}function y2(o){o.dirty=!0,g2(o),o.consumerMarkedDirty?.(o)}function iE(o){return o&&(o.nextProducerIndex=0),cr(o)}function oE(o,i){if(cr(i),!(!o||o.producerNode===void 0||o.producerIndexOfThis===void 0||o.producerLastReadVersion===void 0)){if(fg(o))for(let l=o.nextProducerIndex;l<o.producerNode.length;l++)q0(o.producerNode[l],o.producerIndexOfThis[l]);for(;o.producerNode.length>o.nextProducerIndex;)o.producerNode.pop(),o.producerLastReadVersion.pop(),o.producerIndexOfThis.pop()}}function H0(o){mf(o);for(let i=0;i<o.producerNode.length;i++){let l=o.producerNode[i],c=o.producerLastReadVersion[i];if(c!==l.version||($4(l),c!==l.version))return!0}return!1}function sE(o){if(mf(o),fg(o))for(let i=0;i<o.producerNode.length;i++)q0(o.producerNode[i],o.producerIndexOfThis[i]);o.producerNode.length=o.producerLastReadVersion.length=o.producerIndexOfThis.length=0,o.liveConsumerNode&&(o.liveConsumerNode.length=o.liveConsumerIndexOfThis.length=0)}function v2(o,i,l){if(x2(o),mf(o),o.liveConsumerNode.length===0)for(let c=0;c<o.producerNode.length;c++)o.producerIndexOfThis[c]=v2(o.producerNode[c],o,c);return o.liveConsumerIndexOfThis.push(l),o.liveConsumerNode.push(i)-1}function q0(o,i){if(x2(o),mf(o),o.liveConsumerNode.length===1)for(let c=0;c<o.producerNode.length;c++)q0(o.producerNode[c],o.producerIndexOfThis[c]);let l=o.liveConsumerNode.length-1;if(o.liveConsumerNode[i]=o.liveConsumerNode[l],o.liveConsumerIndexOfThis[i]=o.liveConsumerIndexOfThis[l],o.liveConsumerNode.length--,o.liveConsumerIndexOfThis.length--,i<o.liveConsumerNode.length){let c=o.liveConsumerIndexOfThis[i],f=o.liveConsumerNode[i];mf(f),f.producerIndexOfThis[c]=i}}function fg(o){return o.consumerIsAlwaysLive||(o?.liveConsumerNode?.length??0)>0}function mf(o){o.producerNode??=[],o.producerIndexOfThis??=[],o.producerLastReadVersion??=[]}function x2(o){o.liveConsumerNode??=[],o.liveConsumerIndexOfThis??=[]}function G4(){throw new Error}var b2=G4;function w2(){b2()}function E2(o){b2=o}var H4=null;function T2(o){let i=Object.create(aE);i.value=o;let l=()=>(rE(i),i.value);return l[Dc]=i,l}function W0(o,i){_2()||w2(),o.equal(o.value,i)||(o.value=i,q4(o))}function S2(o,i){_2()||w2(),W0(o,i(o.value))}var aE=lr(vt({},G0),{equal:V4,value:void 0});function q4(o){o.version++,U4(),g2(o),H4?.()}function C2(o,i,l){let c=Object.create(W4);l&&(c.consumerAllowSignalWrites=!0),c.fn=o,c.schedule=i;let f=A=>{c.cleanupFn=A};function r(A){return A.fn===null&&A.schedule===null}function w(A){r(A)||(sE(A),A.cleanupFn(),A.fn=null,A.schedule=null,A.cleanupFn=nE)}let C=()=>{if(c.fn===null)return;if(j4())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(c.dirty=!1,c.hasRun&&!H0(c))return;c.hasRun=!0;let A=iE(c);try{c.cleanupFn(),c.cleanupFn=nE,c.fn(f)}finally{oE(c,A)}};return c.ref={notify:()=>y2(c),run:C,cleanup:()=>c.cleanupFn(),destroy:()=>w(c),[Dc]:c},c.ref}var nE=()=>{},W4=lr(vt({},G0),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:o=>{o.schedule!==null&&o.schedule(o.ref)},hasRun:!1,cleanupFn:nE});function An(o){return typeof o=="function"}function gf(o){let l=o(c=>{Error.call(c),c.stack=new Error().stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}var Z0=gf(o=>function(l){o(this),this.message=l?`${l.length} errors occurred during unsubscription:
${l.map((c,f)=>`${f+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=l});function pg(o,i){if(o){let l=o.indexOf(i);0<=l&&o.splice(l,1)}}var yi=class o{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;let{_parentage:l}=this;if(l)if(this._parentage=null,Array.isArray(l))for(let r of l)r.remove(this);else l.remove(this);let{initialTeardown:c}=this;if(An(c))try{c()}catch(r){i=r instanceof Z0?r.errors:[r]}let{_finalizers:f}=this;if(f){this._finalizers=null;for(let r of f)try{I2(r)}catch(w){i=i??[],w instanceof Z0?i=[...i,...w.errors]:i.push(w)}}if(i)throw new Z0(i)}}add(i){var l;if(i&&i!==this)if(this.closed)I2(i);else{if(i instanceof o){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=(l=this._finalizers)!==null&&l!==void 0?l:[]).push(i)}}_hasParent(i){let{_parentage:l}=this;return l===i||Array.isArray(l)&&l.includes(i)}_addParent(i){let{_parentage:l}=this;this._parentage=Array.isArray(l)?(l.push(i),l):l?[l,i]:i}_removeParent(i){let{_parentage:l}=this;l===i?this._parentage=null:Array.isArray(l)&&pg(l,i)}remove(i){let{_finalizers:l}=this;l&&pg(l,i),i instanceof o&&i._removeParent(this)}};yi.EMPTY=(()=>{let o=new yi;return o.closed=!0,o})();var lE=yi.EMPTY;function X0(o){return o instanceof yi||o&&"closed"in o&&An(o.remove)&&An(o.add)&&An(o.unsubscribe)}function I2(o){An(o)?o():o.unsubscribe()}var Ds={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var _f={setTimeout(o,i,...l){let{delegate:c}=_f;return c?.setTimeout?c.setTimeout(o,i,...l):setTimeout(o,i,...l)},clearTimeout(o){let{delegate:i}=_f;return(i?.clearTimeout||clearTimeout)(o)},delegate:void 0};function Y0(o){_f.setTimeout(()=>{let{onUnhandledError:i}=Ds;if(i)i(o);else throw o})}function mg(){}var D2=cE("C",void 0,void 0);function M2(o){return cE("E",void 0,o)}function A2(o){return cE("N",o,void 0)}function cE(o,i,l){return{kind:o,value:i,error:l}}var mh=null;function yf(o){if(Ds.useDeprecatedSynchronousErrorHandling){let i=!mh;if(i&&(mh={errorThrown:!1,error:null}),o(),i){let{errorThrown:l,error:c}=mh;if(mh=null,l)throw c}}else o()}function P2(o){Ds.useDeprecatedSynchronousErrorHandling&&mh&&(mh.errorThrown=!0,mh.error=o)}var gh=class extends yi{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,X0(i)&&i.add(this)):this.destination=Y4}static create(i,l,c){return new il(i,l,c)}next(i){this.isStopped?hE(A2(i),this):this._next(i)}error(i){this.isStopped?hE(M2(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?hE(D2,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Z4=Function.prototype.bind;function uE(o,i){return Z4.call(o,i)}var dE=class{constructor(i){this.partialObserver=i}next(i){let{partialObserver:l}=this;if(l.next)try{l.next(i)}catch(c){K0(c)}}error(i){let{partialObserver:l}=this;if(l.error)try{l.error(i)}catch(c){K0(c)}else K0(i)}complete(){let{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(l){K0(l)}}},il=class extends gh{constructor(i,l,c){super();let f;if(An(i)||!i)f={next:i??void 0,error:l??void 0,complete:c??void 0};else{let r;this&&Ds.useDeprecatedNextContext?(r=Object.create(i),r.unsubscribe=()=>this.unsubscribe(),f={next:i.next&&uE(i.next,r),error:i.error&&uE(i.error,r),complete:i.complete&&uE(i.complete,r)}):f=i}this.destination=new dE(f)}};function K0(o){Ds.useDeprecatedSynchronousErrorHandling?P2(o):Y0(o)}function X4(o){throw o}function hE(o,i){let{onStoppedNotification:l}=Ds;l&&_f.setTimeout(()=>l(o,i))}var Y4={closed:!0,next:mg,error:X4,complete:mg};var vf=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Oo(o){return o}function fE(...o){return pE(o)}function pE(o){return o.length===0?Oo:o.length===1?o[0]:function(l){return o.reduce((c,f)=>f(c),l)}}var ur=(()=>{class o{constructor(l){l&&(this._subscribe=l)}lift(l){let c=new o;return c.source=this,c.operator=l,c}subscribe(l,c,f){let r=Q4(l)?l:new il(l,c,f);return yf(()=>{let{operator:w,source:C}=this;r.add(w?w.call(r,C):C?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(l){try{return this._subscribe(l)}catch(c){l.error(c)}}forEach(l,c){return c=R2(c),new c((f,r)=>{let w=new il({next:C=>{try{l(C)}catch(A){r(A),w.unsubscribe()}},error:r,complete:f});this.subscribe(w)})}_subscribe(l){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(l)}[vf](){return this}pipe(...l){return pE(l)(this)}toPromise(l){return l=R2(l),new l((c,f)=>{let r;this.subscribe(w=>r=w,w=>f(w),()=>c(r))})}}return o.create=i=>new o(i),o})();function R2(o){var i;return(i=o??Ds.Promise)!==null&&i!==void 0?i:Promise}function K4(o){return o&&An(o.next)&&An(o.error)&&An(o.complete)}function Q4(o){return o&&o instanceof gh||K4(o)&&X0(o)}function mE(o){return An(o?.lift)}function qn(o){return i=>{if(mE(i))return i.lift(function(l){try{return o(l,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Kn(o,i,l,c,f){return new gE(o,i,l,c,f)}var gE=class extends gh{constructor(i,l,c,f,r,w){super(i),this.onFinalize=r,this.shouldUnsubscribe=w,this._next=l?function(C){try{l(C)}catch(A){i.error(A)}}:super._next,this._error=f?function(C){try{f(C)}catch(A){i.error(A)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(C){i.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:l}=this;super.unsubscribe(),!l&&((i=this.onFinalize)===null||i===void 0||i.call(this))}}};function xf(){return qn((o,i)=>{let l=null;o._refCount++;let c=Kn(i,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount){l=null;return}let f=o._connection,r=l;l=null,f&&(!r||f===r)&&f.unsubscribe(),i.unsubscribe()});o.subscribe(c),c.closed||(l=o.connect())})}var bf=class extends ur{constructor(i,l){super(),this.source=i,this.subjectFactory=l,this._subject=null,this._refCount=0,this._connection=null,mE(i)&&(this.lift=i.lift)}_subscribe(i){return this.getSubject().subscribe(i)}getSubject(){let i=this._subject;return(!i||i.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:i}=this;this._subject=this._connection=null,i?.unsubscribe()}connect(){let i=this._connection;if(!i){i=this._connection=new yi;let l=this.getSubject();i.add(this.source.subscribe(Kn(l,void 0,()=>{this._teardown(),l.complete()},c=>{this._teardown(),l.error(c)},()=>this._teardown()))),i.closed&&(this._connection=null,i=yi.EMPTY)}return i}refCount(){return xf()(this)}};var O2=gf(o=>function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ai=(()=>{class o extends ur{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(l){let c=new Q0(this,this);return c.operator=l,c}_throwIfClosed(){if(this.closed)throw new O2}next(l){yf(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(l)}})}error(l){yf(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=l;let{observers:c}=this;for(;c.length;)c.shift().error(l)}})}complete(){yf(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:l}=this;for(;l.length;)l.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var l;return((l=this.observers)===null||l===void 0?void 0:l.length)>0}_trySubscribe(l){return this._throwIfClosed(),super._trySubscribe(l)}_subscribe(l){return this._throwIfClosed(),this._checkFinalizedStatuses(l),this._innerSubscribe(l)}_innerSubscribe(l){let{hasError:c,isStopped:f,observers:r}=this;return c||f?lE:(this.currentObservers=null,r.push(l),new yi(()=>{this.currentObservers=null,pg(r,l)}))}_checkFinalizedStatuses(l){let{hasError:c,thrownError:f,isStopped:r}=this;c?l.error(f):r&&l.complete()}asObservable(){let l=new ur;return l.source=this,l}}return o.create=(i,l)=>new Q0(i,l),o})(),Q0=class extends Ai{constructor(i,l){super(),this.destination=i,this.source=l}next(i){var l,c;(c=(l=this.destination)===null||l===void 0?void 0:l.next)===null||c===void 0||c.call(l,i)}error(i){var l,c;(c=(l=this.destination)===null||l===void 0?void 0:l.error)===null||c===void 0||c.call(l,i)}complete(){var i,l;(l=(i=this.destination)===null||i===void 0?void 0:i.complete)===null||l===void 0||l.call(i)}_subscribe(i){var l,c;return(c=(l=this.source)===null||l===void 0?void 0:l.subscribe(i))!==null&&c!==void 0?c:lE}};var vi=class extends Ai{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){let l=super._subscribe(i);return!l.closed&&i.next(this._value),l}getValue(){let{hasError:i,thrownError:l,_value:c}=this;if(i)throw l;return this._throwIfClosed(),c}next(i){super.next(this._value=i)}};var ko=new ur(o=>o.complete());function k2(o){return o&&An(o.schedule)}function L2(o){return o[o.length-1]}function F2(o){return An(L2(o))?o.pop():void 0}function Mc(o){return k2(L2(o))?o.pop():void 0}function z2(o,i,l,c){function f(r){return r instanceof l?r:new l(function(w){w(r)})}return new(l||(l=Promise))(function(r,w){function C(U){try{L(c.next(U))}catch(Q){w(Q)}}function A(U){try{L(c.throw(U))}catch(Q){w(Q)}}function L(U){U.done?r(U.value):f(U.value).then(C,A)}L((c=c.apply(o,i||[])).next())})}function N2(o){var i=typeof Symbol=="function"&&Symbol.iterator,l=i&&o[i],c=0;if(l)return l.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&c>=o.length&&(o=void 0),{value:o&&o[c++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function _h(o){return this instanceof _h?(this.v=o,this):new _h(o)}function B2(o,i,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=l.apply(o,i||[]),f,r=[];return f={},C("next"),C("throw"),C("return",w),f[Symbol.asyncIterator]=function(){return this},f;function w(he){return function(be){return Promise.resolve(be).then(he,Q)}}function C(he,be){c[he]&&(f[he]=function(Ie){return new Promise(function(Qe,ze){r.push([he,Ie,Qe,ze])>1||A(he,Ie)})},be&&(f[he]=be(f[he])))}function A(he,be){try{L(c[he](be))}catch(Ie){me(r[0][3],Ie)}}function L(he){he.value instanceof _h?Promise.resolve(he.value.v).then(U,Q):me(r[0][2],he)}function U(he){A("next",he)}function Q(he){A("throw",he)}function me(he,be){he(be),r.shift(),r.length&&A(r[0][0],r[0][1])}}function V2(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],l;return i?i.call(o):(o=typeof N2=="function"?N2(o):o[Symbol.iterator](),l={},c("next"),c("throw"),c("return"),l[Symbol.asyncIterator]=function(){return this},l);function c(r){l[r]=o[r]&&function(w){return new Promise(function(C,A){w=o[r](w),f(C,A,w.done,w.value)})}}function f(r,w,C,A){Promise.resolve(A).then(function(L){r({value:L,done:C})},w)}}var J0=o=>o&&typeof o.length=="number"&&typeof o!="function";function ev(o){return An(o?.then)}function tv(o){return An(o[vf])}function nv(o){return Symbol.asyncIterator&&An(o?.[Symbol.asyncIterator])}function rv(o){return new TypeError(`You provided ${o!==null&&typeof o=="object"?"an invalid object":`'${o}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function J4(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var iv=J4();function ov(o){return An(o?.[iv])}function sv(o){return B2(this,arguments,function*(){let l=o.getReader();try{for(;;){let{value:c,done:f}=yield _h(l.read());if(f)return yield _h(void 0);yield yield _h(c)}}finally{l.releaseLock()}})}function av(o){return An(o?.getReader)}function Xr(o){if(o instanceof ur)return o;if(o!=null){if(tv(o))return eV(o);if(J0(o))return tV(o);if(ev(o))return nV(o);if(nv(o))return j2(o);if(ov(o))return rV(o);if(av(o))return iV(o)}throw rv(o)}function eV(o){return new ur(i=>{let l=o[vf]();if(An(l.subscribe))return l.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function tV(o){return new ur(i=>{for(let l=0;l<o.length&&!i.closed;l++)i.next(o[l]);i.complete()})}function nV(o){return new ur(i=>{o.then(l=>{i.closed||(i.next(l),i.complete())},l=>i.error(l)).then(null,Y0)})}function rV(o){return new ur(i=>{for(let l of o)if(i.next(l),i.closed)return;i.complete()})}function j2(o){return new ur(i=>{oV(o,i).catch(l=>i.error(l))})}function iV(o){return j2(sv(o))}function oV(o,i){var l,c,f,r;return z2(this,void 0,void 0,function*(){try{for(l=V2(o);c=yield l.next(),!c.done;){let w=c.value;if(i.next(w),i.closed)return}}catch(w){f={error:w}}finally{try{c&&!c.done&&(r=l.return)&&(yield r.call(l))}finally{if(f)throw f.error}}i.complete()})}function _o(o,i,l,c=0,f=!1){let r=i.schedule(function(){l(),f?o.add(this.schedule(null,c)):this.unsubscribe()},c);if(o.add(r),!f)return r}function lv(o,i=0){return qn((l,c)=>{l.subscribe(Kn(c,f=>_o(c,o,()=>c.next(f),i),()=>_o(c,o,()=>c.complete(),i),f=>_o(c,o,()=>c.error(f),i)))})}function cv(o,i=0){return qn((l,c)=>{c.add(o.schedule(()=>l.subscribe(c),i))})}function U2(o,i){return Xr(o).pipe(cv(i),lv(i))}function $2(o,i){return Xr(o).pipe(cv(i),lv(i))}function G2(o,i){return new ur(l=>{let c=0;return i.schedule(function(){c===o.length?l.complete():(l.next(o[c++]),l.closed||this.schedule())})})}function H2(o,i){return new ur(l=>{let c;return _o(l,i,()=>{c=o[iv](),_o(l,i,()=>{let f,r;try{({value:f,done:r}=c.next())}catch(w){l.error(w);return}r?l.complete():l.next(f)},0,!0)}),()=>An(c?.return)&&c.return()})}function uv(o,i){if(!o)throw new Error("Iterable cannot be null");return new ur(l=>{_o(l,i,()=>{let c=o[Symbol.asyncIterator]();_o(l,i,()=>{c.next().then(f=>{f.done?l.complete():l.next(f.value)})},0,!0)})})}function q2(o,i){return uv(sv(o),i)}function W2(o,i){if(o!=null){if(tv(o))return U2(o,i);if(J0(o))return G2(o,i);if(ev(o))return $2(o,i);if(nv(o))return uv(o,i);if(ov(o))return H2(o,i);if(av(o))return q2(o,i)}throw rv(o)}function Yr(o,i){return i?W2(o,i):Xr(o)}function sn(...o){let i=Mc(o);return Yr(o,i)}function ol(o,i){let l=An(o)?o:()=>o,c=f=>f.error(l());return new ur(i?f=>i.schedule(c,0,f):c)}function _E(o){return!!o&&(o instanceof ur||An(o.lift)&&An(o.subscribe))}var sl=gf(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});function Ln(o,i){return qn((l,c)=>{let f=0;l.subscribe(Kn(c,r=>{c.next(o.call(i,r,f++))}))})}var{isArray:sV}=Array;function aV(o,i){return sV(i)?o(...i):o(i)}function Z2(o){return Ln(i=>aV(o,i))}var{isArray:lV}=Array,{getPrototypeOf:cV,prototype:uV,keys:hV}=Object;function X2(o){if(o.length===1){let i=o[0];if(lV(i))return{args:i,keys:null};if(dV(i)){let l=hV(i);return{args:l.map(c=>i[c]),keys:l}}}return{args:o,keys:null}}function dV(o){return o&&typeof o=="object"&&cV(o)===uV}function Y2(o,i){return o.reduce((l,c,f)=>(l[c]=i[f],l),{})}function gg(...o){let i=Mc(o),l=F2(o),{args:c,keys:f}=X2(o);if(c.length===0)return Yr([],i);let r=new ur(fV(c,i,f?w=>Y2(f,w):Oo));return l?r.pipe(Z2(l)):r}function fV(o,i,l=Oo){return c=>{K2(i,()=>{let{length:f}=o,r=new Array(f),w=f,C=f;for(let A=0;A<f;A++)K2(i,()=>{let L=Yr(o[A],i),U=!1;L.subscribe(Kn(c,Q=>{r[A]=Q,U||(U=!0,C--),C||c.next(l(r.slice()))},()=>{--w||c.complete()}))},c)},c)}}function K2(o,i,l){o?_o(l,o,i):i()}function Q2(o,i,l,c,f,r,w,C){let A=[],L=0,U=0,Q=!1,me=()=>{Q&&!A.length&&!L&&i.complete()},he=Ie=>L<c?be(Ie):A.push(Ie),be=Ie=>{r&&i.next(Ie),L++;let Qe=!1;Xr(l(Ie,U++)).subscribe(Kn(i,ze=>{f?.(ze),r?he(ze):i.next(ze)},()=>{Qe=!0},void 0,()=>{if(Qe)try{for(L--;A.length&&L<c;){let ze=A.shift();w?_o(i,w,()=>be(ze)):be(ze)}me()}catch(ze){i.error(ze)}}))};return o.subscribe(Kn(i,he,()=>{Q=!0,me()})),()=>{C?.()}}function xi(o,i,l=1/0){return An(i)?xi((c,f)=>Ln((r,w)=>i(c,r,f,w))(Xr(o(c,f))),l):(typeof i=="number"&&(l=i),qn((c,f)=>Q2(c,f,o,l)))}function yE(o=1/0){return xi(Oo,o)}function J2(){return yE(1)}function wf(...o){return J2()(Yr(o,Mc(o)))}function hv(o){return new ur(i=>{Xr(o()).subscribe(i)})}function Lo(o,i){return qn((l,c)=>{let f=0;l.subscribe(Kn(c,r=>o.call(i,r,f++)&&c.next(r)))})}function ca(o){return qn((i,l)=>{let c=null,f=!1,r;c=i.subscribe(Kn(l,void 0,void 0,w=>{r=Xr(o(w,ca(o)(i))),c?(c.unsubscribe(),c=null,r.subscribe(l)):f=!0})),f&&(c.unsubscribe(),c=null,r.subscribe(l))})}function eP(o,i,l,c,f){return(r,w)=>{let C=l,A=i,L=0;r.subscribe(Kn(w,U=>{let Q=L++;A=C?o(A,U,Q):(C=!0,U),c&&w.next(A)},f&&(()=>{C&&w.next(A),w.complete()})))}}function Ac(o,i){return An(i)?xi(o,i,1):xi(o,1)}function Pc(o){return qn((i,l)=>{let c=!1;i.subscribe(Kn(l,f=>{c=!0,l.next(f)},()=>{c||l.next(o),l.complete()}))})}function al(o){return o<=0?()=>ko:qn((i,l)=>{let c=0;i.subscribe(Kn(l,f=>{++c<=o&&(l.next(f),o<=c&&l.complete())}))})}function vE(o){return Ln(()=>o)}function dv(o=pV){return qn((i,l)=>{let c=!1;i.subscribe(Kn(l,f=>{c=!0,l.next(f)},()=>c?l.complete():l.error(o())))})}function pV(){return new sl}function ua(o){return qn((i,l)=>{try{i.subscribe(l)}finally{l.add(o)}})}function ha(o,i){let l=arguments.length>=2;return c=>c.pipe(o?Lo((f,r)=>o(f,r,c)):Oo,al(1),l?Pc(i):dv(()=>new sl))}function Ef(o){return o<=0?()=>ko:qn((i,l)=>{let c=[];i.subscribe(Kn(l,f=>{c.push(f),o<c.length&&c.shift()},()=>{for(let f of c)l.next(f);l.complete()},void 0,()=>{c=null}))})}function xE(o,i){let l=arguments.length>=2;return c=>c.pipe(o?Lo((f,r)=>o(f,r,c)):Oo,Ef(1),l?Pc(i):dv(()=>new sl))}function bE(o,i){return qn(eP(o,i,arguments.length>=2,!0))}function EE(o={}){let{connector:i=()=>new Ai,resetOnError:l=!0,resetOnComplete:c=!0,resetOnRefCountZero:f=!0}=o;return r=>{let w,C,A,L=0,U=!1,Q=!1,me=()=>{C?.unsubscribe(),C=void 0},he=()=>{me(),w=A=void 0,U=Q=!1},be=()=>{let Ie=w;he(),Ie?.unsubscribe()};return qn((Ie,Qe)=>{L++,!Q&&!U&&me();let ze=A=A??i();Qe.add(()=>{L--,L===0&&!Q&&!U&&(C=wE(be,f))}),ze.subscribe(Qe),!w&&L>0&&(w=new il({next:nt=>ze.next(nt),error:nt=>{Q=!0,me(),C=wE(he,l,nt),ze.error(nt)},complete:()=>{U=!0,me(),C=wE(he,c),ze.complete()}}),Xr(Ie).subscribe(w))})(r)}}function wE(o,i,...l){if(i===!0){o();return}if(i===!1)return;let c=new il({next:()=>{c.unsubscribe(),o()}});return Xr(i(...l)).subscribe(c)}function TE(...o){let i=Mc(o);return qn((l,c)=>{(i?wf(o,l,i):wf(o,l)).subscribe(c)})}function yo(o,i){return qn((l,c)=>{let f=null,r=0,w=!1,C=()=>w&&!f&&c.complete();l.subscribe(Kn(c,A=>{f?.unsubscribe();let L=0,U=r++;Xr(o(A,U)).subscribe(f=Kn(c,Q=>c.next(i?i(A,Q,U,L++):Q),()=>{f=null,C()}))},()=>{w=!0,C()}))})}function SE(o){return qn((i,l)=>{Xr(o).subscribe(Kn(l,()=>l.complete(),mg)),!l.closed&&i.subscribe(l)})}function si(o,i,l){let c=An(o)||i||l?{next:o,error:i,complete:l}:o;return c?qn((f,r)=>{var w;(w=c.subscribe)===null||w===void 0||w.call(c);let C=!0;f.subscribe(Kn(r,A=>{var L;(L=c.next)===null||L===void 0||L.call(c,A),r.next(A)},()=>{var A;C=!1,(A=c.complete)===null||A===void 0||A.call(c),r.complete()},A=>{var L;C=!1,(L=c.error)===null||L===void 0||L.call(c,A),r.error(A)},()=>{var A,L;C&&((A=c.unsubscribe)===null||A===void 0||A.call(c)),(L=c.finalize)===null||L===void 0||L.call(c)}))}):Oo}var jP="https://g.co/ng/security#xss",xt=class extends Error{constructor(i,l){super(jv(i,l)),this.code=i}};function jv(o,i){return`${`NG0${Math.abs(o)}`}${i?": "+i:""}`}var UP=Symbol("InputSignalNode#UNSET"),mV=lr(vt({},aE),{transformFn:void 0,applyValueToInputSignal(o,i){W0(o,i)}});function $P(o,i){let l=Object.create(mV);l.value=o,l.transformFn=i?.transform;function c(){if(rE(l),l.value===UP)throw new xt(-950,!1);return l.value}return c[Dc]=l,c}function Dg(o){return{toString:o}.toString()}var fv="__parameters__";function gV(o){return function(...l){if(o){let c=o(...l);for(let f in c)this[f]=c[f]}}}function GP(o,i,l){return Dg(()=>{let c=gV(i);function f(...r){if(this instanceof f)return c.apply(this,r),this;let w=new f(...r);return C.annotation=w,C;function C(A,L,U){let Q=A.hasOwnProperty(fv)?A[fv]:Object.defineProperty(A,fv,{value:[]})[fv];for(;Q.length<=U;)Q.push(null);return(Q[U]=Q[U]||[]).push(w),A}}return l&&(f.prototype=Object.create(l.prototype)),f.prototype.ngMetadataName=o,f.annotationCls=f,f})}var yh=globalThis;function Er(o){for(let i in o)if(o[i]===Er)return i;throw Error("Could not find renamed property on target object.")}function eo(o){if(typeof o=="string")return o;if(Array.isArray(o))return"["+o.map(eo).join(", ")+"]";if(o==null)return""+o;if(o.overriddenName)return`${o.overriddenName}`;if(o.name)return`${o.name}`;let i=o.toString();if(i==null)return""+i;let l=i.indexOf(`
`);return l===-1?i:i.substring(0,l)}function tP(o,i){return o==null||o===""?i===null?"":i:i==null||i===""?o:o+" "+i}var _V=Er({__forward_ref__:Er});function HP(o){return o.__forward_ref__=HP,o.toString=function(){return eo(this())},o}function Qi(o){return qP(o)?o():o}function qP(o){return typeof o=="function"&&o.hasOwnProperty(_V)&&o.__forward_ref__===HP}function $t(o){return{token:o.token,providedIn:o.providedIn||null,factory:o.factory,value:void 0}}function ll(o){return{providers:o.providers||[],imports:o.imports||[]}}function Uv(o){return nP(o,ZP)||nP(o,XP)}function WP(o){return Uv(o)!==null}function nP(o,i){return o.hasOwnProperty(i)?o[i]:null}function yV(o){let i=o&&(o[ZP]||o[XP]);return i||null}function rP(o){return o&&(o.hasOwnProperty(iP)||o.hasOwnProperty(vV))?o[iP]:null}var ZP=Er({\u0275prov:Er}),iP=Er({\u0275inj:Er}),XP=Er({ngInjectableDef:Er}),vV=Er({ngInjectorDef:Er}),dn=class{constructor(i,l){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof l=="number"?this.__NG_ELEMENT_ID__=l:l!==void 0&&(this.\u0275prov=$t({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function YP(o){return o&&!!o.\u0275providers}var xV=Er({\u0275cmp:Er}),bV=Er({\u0275dir:Er}),wV=Er({\u0275pipe:Er}),EV=Er({\u0275mod:Er}),wv=Er({\u0275fac:Er}),_g=Er({__NG_ELEMENT_ID__:Er}),oP=Er({__NG_ENV_ID__:Er});function vh(o){return typeof o=="string"?o:o==null?"":String(o)}function TV(o){return typeof o=="function"?o.name||o.toString():typeof o=="object"&&o!=null&&typeof o.type=="function"?o.type.name||o.type.toString():vh(o)}function SV(o,i){let l=i?`. Dependency path: ${i.join(" > ")} > ${o}`:"";throw new xt(-200,o)}function PT(o,i){throw new xt(-201,!1)}var Un=function(o){return o[o.Default=0]="Default",o[o.Host=1]="Host",o[o.Self=2]="Self",o[o.SkipSelf=4]="SkipSelf",o[o.Optional=8]="Optional",o}(Un||{}),VE;function KP(){return VE}function rs(o){let i=VE;return VE=o,i}function QP(o,i,l){let c=Uv(o);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(l&Un.Optional)return null;if(i!==void 0)return i;PT(o,"Injector")}var CV={},yg=CV,jE="__NG_DI_FLAG__",Ev="ngTempTokenPath",IV="ngTokenPath",DV=/\n/gm,MV="\u0275",sP="__source",Df;function AV(){return Df}function Rc(o){let i=Df;return Df=o,i}function PV(o,i=Un.Default){if(Df===void 0)throw new xt(-203,!1);return Df===null?QP(o,void 0,i):Df.get(o,i&Un.Optional?null:void 0,i)}function fn(o,i=Un.Default){return(KP()||PV)(Qi(o),i)}function bt(o,i=Un.Default){return fn(o,$v(i))}function $v(o){return typeof o>"u"||typeof o=="number"?o:0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)}function UE(o){let i=[];for(let l=0;l<o.length;l++){let c=Qi(o[l]);if(Array.isArray(c)){if(c.length===0)throw new xt(900,!1);let f,r=Un.Default;for(let w=0;w<c.length;w++){let C=c[w],A=RV(C);typeof A=="number"?A===-1?f=C.token:r|=A:f=C}i.push(fn(f,r))}else i.push(fn(c))}return i}function JP(o,i){return o[jE]=i,o.prototype[jE]=i,o}function RV(o){return o[jE]}function OV(o,i,l,c){let f=o[Ev];throw i[sP]&&f.unshift(i[sP]),o.message=kV(`
`+o.message,f,l,c),o[IV]=f,o[Ev]=null,o}function kV(o,i,l,c=null){o=o&&o.charAt(0)===`
`&&o.charAt(1)==MV?o.slice(2):o;let f=eo(i);if(Array.isArray(i))f=i.map(eo).join(" -> ");else if(typeof i=="object"){let r=[];for(let w in i)if(i.hasOwnProperty(w)){let C=i[w];r.push(w+":"+(typeof C=="string"?JSON.stringify(C):eo(C)))}f=`{${r.join(", ")}}`}return`${l}${c?"("+c+")":""}[${f}]: ${o.replace(DV,`
  `)}`}var Vf=JP(GP("Optional"),8);var Mg=JP(GP("SkipSelf"),4);function Af(o,i){let l=o.hasOwnProperty(wv);return l?o[wv]:null}function RT(o,i){o.forEach(l=>Array.isArray(l)?RT(l,i):i(l))}function eR(o,i,l){i>=o.length?o.push(l):o.splice(i,0,l)}function Tv(o,i){return i>=o.length-1?o.pop():o.splice(i,1)[0]}function LV(o,i){let l=[];for(let c=0;c<o;c++)l.push(i);return l}function FV(o,i,l,c){let f=o.length;if(f==i)o.push(l,c);else if(f===1)o.push(c,o[0]),o[0]=l;else{for(f--,o.push(o[f-1],o[f]);f>i;){let r=f-2;o[f]=o[r],f--}o[i]=l,o[i+1]=c}}function NV(o,i,l){let c=Ag(o,i);return c>=0?o[c|1]=l:(c=~c,FV(o,c,i,l)),c}function CE(o,i){let l=Ag(o,i);if(l>=0)return o[l|1]}function Ag(o,i){return zV(o,i,1)}function zV(o,i,l){let c=0,f=o.length>>l;for(;f!==c;){let r=c+(f-c>>1),w=o[r<<l];if(i===w)return r<<l;w>i?f=r:c=r+1}return~(f<<l)}var vg={},As=[],Pf=new dn(""),tR=new dn("",-1),nR=new dn(""),Sv=class{get(i,l=yg){if(l===yg){let c=new Error(`NullInjectorError: No provider for ${eo(i)}!`);throw c.name="NullInjectorError",c}return l}},rR=function(o){return o[o.OnPush=0]="OnPush",o[o.Default=1]="Default",o}(rR||{}),pa=function(o){return o[o.Emulated=0]="Emulated",o[o.None=2]="None",o[o.ShadowDom=3]="ShadowDom",o}(pa||{}),Gr=function(o){return o[o.None=0]="None",o[o.SignalBased=1]="SignalBased",o[o.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",o}(Gr||{});function BV(o,i,l){let c=o.length;for(;;){let f=o.indexOf(i,l);if(f===-1)return f;if(f===0||o.charCodeAt(f-1)<=32){let r=i.length;if(f+r===c||o.charCodeAt(f+r)<=32)return f}l=f+1}}function $E(o,i,l){let c=0;for(;c<l.length;){let f=l[c];if(typeof f=="number"){if(f!==0)break;c++;let r=l[c++],w=l[c++],C=l[c++];o.setAttribute(i,w,C,r)}else{let r=f,w=l[++c];VV(r)?o.setProperty(i,r,w):o.setAttribute(i,r,w),c++}}return c}function iR(o){return o===3||o===4||o===6}function VV(o){return o.charCodeAt(0)===64}function OT(o,i){if(!(i===null||i.length===0))if(o===null||o.length===0)o=i.slice();else{let l=-1;for(let c=0;c<i.length;c++){let f=i[c];typeof f=="number"?l=f:l===0||(l===-1||l===2?aP(o,l,f,null,i[++c]):aP(o,l,f,null,null))}}return o}function aP(o,i,l,c,f){let r=0,w=o.length;if(i===-1)w=-1;else for(;r<o.length;){let C=o[r++];if(typeof C=="number"){if(C===i){w=-1;break}else if(C>i){w=r-1;break}}}for(;r<o.length;){let C=o[r];if(typeof C=="number")break;if(C===l){if(c===null){f!==null&&(o[r+1]=f);return}else if(c===o[r+1]){o[r+2]=f;return}}r++,c!==null&&r++,f!==null&&r++}w!==-1&&(o.splice(w,0,i),r=w+1),o.splice(r++,0,l),c!==null&&o.splice(r++,0,c),f!==null&&o.splice(r++,0,f)}var oR="ng-template";function jV(o,i,l,c){let f=0;if(c){for(;f<i.length&&typeof i[f]=="string";f+=2)if(i[f]==="class"&&BV(i[f+1].toLowerCase(),l,0)!==-1)return!0}else if(kT(o))return!1;if(f=i.indexOf(1,f),f>-1){let r;for(;++f<i.length&&typeof(r=i[f])=="string";)if(r.toLowerCase()===l)return!0}return!1}function kT(o){return o.type===4&&o.value!==oR}function UV(o,i,l){let c=o.type===4&&!l?oR:o.value;return i===c}function $V(o,i,l){let c=4,f=o.attrs,r=f!==null?qV(f):0,w=!1;for(let C=0;C<i.length;C++){let A=i[C];if(typeof A=="number"){if(!w&&!Ms(c)&&!Ms(A))return!1;if(w&&Ms(A))continue;w=!1,c=A|c&1;continue}if(!w)if(c&4){if(c=2|c&1,A!==""&&!UV(o,A,l)||A===""&&i.length===1){if(Ms(c))return!1;w=!0}}else if(c&8){if(f===null||!jV(o,f,A,l)){if(Ms(c))return!1;w=!0}}else{let L=i[++C],U=GV(A,f,kT(o),l);if(U===-1){if(Ms(c))return!1;w=!0;continue}if(L!==""){let Q;if(U>r?Q="":Q=f[U+1].toLowerCase(),c&2&&L!==Q){if(Ms(c))return!1;w=!0}}}}return Ms(c)||w}function Ms(o){return(o&1)===0}function GV(o,i,l,c){if(i===null)return-1;let f=0;if(c||!l){let r=!1;for(;f<i.length;){let w=i[f];if(w===o)return f;if(w===3||w===6)r=!0;else if(w===1||w===2){let C=i[++f];for(;typeof C=="string";)C=i[++f];continue}else{if(w===4)break;if(w===0){f+=4;continue}}f+=r?1:2}return-1}else return WV(i,o)}function sR(o,i,l=!1){for(let c=0;c<i.length;c++)if($V(o,i[c],l))return!0;return!1}function HV(o){let i=o.attrs;if(i!=null){let l=i.indexOf(5);if(!(l&1))return i[l+1]}return null}function qV(o){for(let i=0;i<o.length;i++){let l=o[i];if(iR(l))return i}return o.length}function WV(o,i){let l=o.indexOf(4);if(l>-1)for(l++;l<o.length;){let c=o[l];if(typeof c=="number")return-1;if(c===i)return l;l++}return-1}function ZV(o,i){e:for(let l=0;l<i.length;l++){let c=i[l];if(o.length===c.length){for(let f=0;f<o.length;f++)if(o[f]!==c[f])continue e;return!0}}return!1}function lP(o,i){return o?":not("+i.trim()+")":i}function XV(o){let i=o[0],l=1,c=2,f="",r=!1;for(;l<o.length;){let w=o[l];if(typeof w=="string")if(c&2){let C=o[++l];f+="["+w+(C.length>0?'="'+C+'"':"")+"]"}else c&8?f+="."+w:c&4&&(f+=" "+w);else f!==""&&!Ms(w)&&(i+=lP(r,f),f=""),c=w,r=r||!Ms(c);l++}return f!==""&&(i+=lP(r,f)),i}function YV(o){return o.map(XV).join(",")}function KV(o){let i=[],l=[],c=1,f=2;for(;c<o.length;){let r=o[c];if(typeof r=="string")f===2?r!==""&&i.push(r,o[++c]):f===8&&l.push(r);else{if(!Ms(f))break;f=r}c++}return{attrs:i,classes:l}}function Lr(o){return Dg(()=>{let i=hR(o),l=lr(vt({},i),{decls:o.decls,vars:o.vars,template:o.template,consts:o.consts||null,ngContentSelectors:o.ngContentSelectors,onPush:o.changeDetection===rR.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&o.dependencies||null,getStandaloneInjector:null,signals:o.signals??!1,data:o.data||{},encapsulation:o.encapsulation||pa.Emulated,styles:o.styles||As,_:null,schemas:o.schemas||null,tView:null,id:""});dR(l);let c=o.dependencies;return l.directiveDefs=uP(c,!1),l.pipeDefs=uP(c,!0),l.id=ej(l),l})}function QV(o){return kc(o)||aR(o)}function JV(o){return o!==null}function cl(o){return Dg(()=>({type:o.type,bootstrap:o.bootstrap||As,declarations:o.declarations||As,imports:o.imports||As,exports:o.exports||As,transitiveCompileScopes:null,schemas:o.schemas||null,id:o.id||null}))}function cP(o,i){if(o==null)return vg;let l={};for(let c in o)if(o.hasOwnProperty(c)){let f=o[c],r,w,C=Gr.None;Array.isArray(f)?(C=f[0],r=f[1],w=f[2]??r):(r=f,w=f),i?(l[r]=C!==Gr.None?[c,C]:c,i[r]=w):l[r]=c}return l}function zc(o){return Dg(()=>{let i=hR(o);return dR(i),i})}function kc(o){return o[xV]||null}function aR(o){return o[bV]||null}function lR(o){return o[wV]||null}function cR(o){let i=kc(o)||aR(o)||lR(o);return i!==null?i.standalone:!1}function uR(o,i){let l=o[EV]||null;if(!l&&i===!0)throw new Error(`Type ${eo(o)} does not have '\u0275mod' property.`);return l}function hR(o){let i={};return{type:o.type,providersResolver:null,factory:null,hostBindings:o.hostBindings||null,hostVars:o.hostVars||0,hostAttrs:o.hostAttrs||null,contentQueries:o.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:o.inputs||vg,exportAs:o.exportAs||null,standalone:o.standalone===!0,signals:o.signals===!0,selectors:o.selectors||As,viewQuery:o.viewQuery||null,features:o.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:cP(o.inputs,i),outputs:cP(o.outputs),debugInfo:null}}function dR(o){o.features?.forEach(i=>i(o))}function uP(o,i){if(!o)return null;let l=i?lR:QV;return()=>(typeof o=="function"?o():o).map(c=>l(c)).filter(JV)}function ej(o){let i=0,l=[o.selectors,o.ngContentSelectors,o.hostVars,o.hostAttrs,o.consts,o.vars,o.decls,o.encapsulation,o.standalone,o.signals,o.exportAs,JSON.stringify(o.inputs),JSON.stringify(o.outputs),Object.getOwnPropertyNames(o.type.prototype),!!o.contentQueries,!!o.viewQuery].join("|");for(let f of l)i=Math.imul(31,i)+f.charCodeAt(0)<<0;return i+=2147483648,"c"+i}function Bc(o){return{\u0275providers:o}}function tj(...o){return{\u0275providers:fR(!0,o),\u0275fromNgModule:!0}}function fR(o,...i){let l=[],c=new Set,f,r=w=>{l.push(w)};return RT(i,w=>{let C=w;GE(C,r,[],c)&&(f||=[],f.push(C))}),f!==void 0&&pR(f,r),l}function pR(o,i){for(let l=0;l<o.length;l++){let{ngModule:c,providers:f}=o[l];LT(f,r=>{i(r,c)})}}function GE(o,i,l,c){if(o=Qi(o),!o)return!1;let f=null,r=rP(o),w=!r&&kc(o);if(!r&&!w){let A=o.ngModule;if(r=rP(A),r)f=A;else return!1}else{if(w&&!w.standalone)return!1;f=o}let C=c.has(f);if(w){if(C)return!1;if(c.add(f),w.dependencies){let A=typeof w.dependencies=="function"?w.dependencies():w.dependencies;for(let L of A)GE(L,i,l,c)}}else if(r){if(r.imports!=null&&!C){c.add(f);let L;try{RT(r.imports,U=>{GE(U,i,l,c)&&(L||=[],L.push(U))})}finally{}L!==void 0&&pR(L,i)}if(!C){let L=Af(f)||(()=>new f);i({provide:f,useFactory:L,deps:As},f),i({provide:nR,useValue:f,multi:!0},f),i({provide:Pf,useValue:()=>fn(f),multi:!0},f)}let A=r.providers;if(A!=null&&!C){let L=o;LT(A,U=>{i(U,L)})}}else return!1;return f!==o&&o.providers!==void 0}function LT(o,i){for(let l of o)YP(l)&&(l=l.\u0275providers),Array.isArray(l)?LT(l,i):i(l)}var nj=Er({provide:String,useValue:Er});function mR(o){return o!==null&&typeof o=="object"&&nj in o}function rj(o){return!!(o&&o.useExisting)}function ij(o){return!!(o&&o.useFactory)}function Rf(o){return typeof o=="function"}function oj(o){return!!o.useClass}var Gv=new dn(""),gv={},sj={},IE;function FT(){return IE===void 0&&(IE=new Sv),IE}var vo=class{},xg=class extends vo{get destroyed(){return this._destroyed}constructor(i,l,c,f){super(),this.parent=l,this.source=c,this.scopes=f,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,qE(i,w=>this.processProvider(w)),this.records.set(tR,Tf(void 0,this)),f.has("environment")&&this.records.set(vo,Tf(void 0,this));let r=this.records.get(Gv);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(nR,As,Un.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let i=cr(null);try{for(let c of this._ngOnDestroyHooks)c.ngOnDestroy();let l=this._onDestroyHooks;this._onDestroyHooks=[];for(let c of l)c()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),cr(i)}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();let l=Rc(this),c=rs(void 0),f;try{return i()}finally{Rc(l),rs(c)}}get(i,l=yg,c=Un.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(oP))return i[oP](this);c=$v(c);let f,r=Rc(this),w=rs(void 0);try{if(!(c&Un.SkipSelf)){let A=this.records.get(i);if(A===void 0){let L=hj(i)&&Uv(i);L&&this.injectableDefInScope(L)?A=Tf(HE(i),gv):A=null,this.records.set(i,A)}if(A!=null)return this.hydrate(i,A)}let C=c&Un.Self?FT():this.parent;return l=c&Un.Optional&&l===yg?null:l,C.get(i,l)}catch(C){if(C.name==="NullInjectorError"){if((C[Ev]=C[Ev]||[]).unshift(eo(i)),r)throw C;return OV(C,i,"R3InjectorError",this.source)}else throw C}finally{rs(w),Rc(r)}}resolveInjectorInitializers(){let i=cr(null),l=Rc(this),c=rs(void 0),f;try{let r=this.get(Pf,As,Un.Self);for(let w of r)w()}finally{Rc(l),rs(c),cr(i)}}toString(){let i=[],l=this.records;for(let c of l.keys())i.push(eo(c));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new xt(205,!1)}processProvider(i){i=Qi(i);let l=Rf(i)?i:Qi(i&&i.provide),c=lj(i);if(!Rf(i)&&i.multi===!0){let f=this.records.get(l);f||(f=Tf(void 0,gv,!0),f.factory=()=>UE(f.multi),this.records.set(l,f)),l=i,f.multi.push(i)}this.records.set(l,c)}hydrate(i,l){let c=cr(null);try{return l.value===gv&&(l.value=sj,l.value=l.factory()),typeof l.value=="object"&&l.value&&uj(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}finally{cr(c)}}injectableDefInScope(i){if(!i.providedIn)return!1;let l=Qi(i.providedIn);return typeof l=="string"?l==="any"||this.scopes.has(l):this.injectorDefTypes.has(l)}removeOnDestroy(i){let l=this._onDestroyHooks.indexOf(i);l!==-1&&this._onDestroyHooks.splice(l,1)}};function HE(o){let i=Uv(o),l=i!==null?i.factory:Af(o);if(l!==null)return l;if(o instanceof dn)throw new xt(204,!1);if(o instanceof Function)return aj(o);throw new xt(204,!1)}function aj(o){if(o.length>0)throw new xt(204,!1);let l=yV(o);return l!==null?()=>l.factory(o):()=>new o}function lj(o){if(mR(o))return Tf(void 0,o.useValue);{let i=gR(o);return Tf(i,gv)}}function gR(o,i,l){let c;if(Rf(o)){let f=Qi(o);return Af(f)||HE(f)}else if(mR(o))c=()=>Qi(o.useValue);else if(ij(o))c=()=>o.useFactory(...UE(o.deps||[]));else if(rj(o))c=()=>fn(Qi(o.useExisting));else{let f=Qi(o&&(o.useClass||o.provide));if(cj(o))c=()=>new f(...UE(o.deps));else return Af(f)||HE(f)}return c}function Tf(o,i,l=!1){return{factory:o,value:i,multi:l?[]:void 0}}function cj(o){return!!o.deps}function uj(o){return o!==null&&typeof o=="object"&&typeof o.ngOnDestroy=="function"}function hj(o){return typeof o=="function"||typeof o=="object"&&o instanceof dn}function qE(o,i){for(let l of o)Array.isArray(l)?qE(l,i):l&&YP(l)?qE(l.\u0275providers,i):i(l)}function Fs(o,i){o instanceof xg&&o.assertNotDestroyed();let l,c=Rc(o),f=rs(void 0);try{return i()}finally{Rc(c),rs(f)}}function _R(){return KP()!==void 0||AV()!=null}function yR(o){if(!_R())throw new xt(-203,!1)}function dj(o){return typeof o=="function"}var ul=0,Zn=1,gn=2,qi=3,Ps=4,Fo=5,bg=6,wg=7,Rs=8,Of=9,Os=10,ai=11,Eg=12,hP=13,jf=14,ks=15,Hv=16,Sf=17,kf=18,qv=19,vR=20,Oc=21,_v=22,wh=23,ma=25,xR=1;var Eh=7,Cv=8,Iv=9,is=10,NT=function(o){return o[o.None=0]="None",o[o.HasTransplantedViews=2]="HasTransplantedViews",o}(NT||{});function xh(o){return Array.isArray(o)&&typeof o[xR]=="object"}function hl(o){return Array.isArray(o)&&o[xR]===!0}function zT(o){return(o.flags&4)!==0}function Wv(o){return o.componentOffset>-1}function Zv(o){return(o.flags&1)===1}function Uf(o){return!!o.template}function fj(o){return(o[gn]&512)!==0}var WE=class{constructor(i,l,c){this.previousValue=i,this.currentValue=l,this.firstChange=c}isFirstChange(){return this.firstChange}};function bR(o,i,l,c){i!==null?i.applyValueToInputSignal(i,c):o[l]=c}function Mh(){return wR}function wR(o){return o.type.prototype.ngOnChanges&&(o.setInput=mj),pj}Mh.ngInherit=!0;function pj(){let o=TR(this),i=o?.current;if(i){let l=o.previous;if(l===vg)o.previous=i;else for(let c in i)l[c]=i[c];o.current=null,this.ngOnChanges(i)}}function mj(o,i,l,c,f){let r=this.declaredInputs[c],w=TR(o)||gj(o,{previous:vg,current:null}),C=w.current||(w.current={}),A=w.previous,L=A[r];C[r]=new WE(L&&L.currentValue,l,A===vg),bR(o,i,f,l)}var ER="__ngSimpleChanges__";function TR(o){return o[ER]||null}function gj(o,i){return o[ER]=i}var dP=null;var da=function(o,i,l){dP?.(o,i,l)},SR="svg",_j="math",yj=!1;function vj(){return yj}function ga(o){for(;Array.isArray(o);)o=o[ul];return o}function CR(o,i){return ga(i[o])}function os(o,i){return ga(i[o.index])}function IR(o,i){return o.data[i]}function Vc(o,i){let l=i[o];return xh(l)?l:l[ul]}function BT(o){return(o[gn]&128)===128}function xj(o){return hl(o[qi])}function Lf(o,i){return i==null?null:o[i]}function DR(o){o[Sf]=0}function bj(o){o[gn]&1024||(o[gn]|=1024,BT(o)&&Tg(o))}function wj(o,i){for(;o>0;)i=i[jf],o--;return i}function VT(o){return!!(o[gn]&9216||o[wh]?.dirty)}function ZE(o){o[Os].changeDetectionScheduler?.notify(1),VT(o)?Tg(o):o[gn]&64&&(vj()?(o[gn]|=1024,Tg(o)):o[Os].changeDetectionScheduler?.notify())}function Tg(o){o[Os].changeDetectionScheduler?.notify();let i=Sg(o);for(;i!==null&&!(i[gn]&8192||(i[gn]|=8192,!BT(i)));)i=Sg(i)}function MR(o,i){if((o[gn]&256)===256)throw new xt(911,!1);o[Oc]===null&&(o[Oc]=[]),o[Oc].push(i)}function Ej(o,i){if(o[Oc]===null)return;let l=o[Oc].indexOf(i);l!==-1&&o[Oc].splice(l,1)}function Sg(o){let i=o[qi];return hl(i)?i[qi]:i}var Vn={lFrame:BR(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Tj(){return Vn.lFrame.elementDepthCount}function Sj(){Vn.lFrame.elementDepthCount++}function Cj(){Vn.lFrame.elementDepthCount--}function AR(){return Vn.bindingsEnabled}function PR(){return Vn.skipHydrationRootTNode!==null}function Ij(o){return Vn.skipHydrationRootTNode===o}function Dj(){Vn.skipHydrationRootTNode=null}function hr(){return Vn.lFrame.lView}function to(){return Vn.lFrame.tView}function RR(o){return Vn.lFrame.contextLView=o,o[Rs]}function OR(o){return Vn.lFrame.contextLView=null,o}function xo(){let o=kR();for(;o!==null&&o.type===64;)o=o.parent;return o}function kR(){return Vn.lFrame.currentTNode}function Mj(){let o=Vn.lFrame,i=o.currentTNode;return o.isParent?i:i.parent}function Ah(o,i){let l=Vn.lFrame;l.currentTNode=o,l.isParent=i}function jT(){return Vn.lFrame.isParent}function UT(){Vn.lFrame.isParent=!1}function $T(){let o=Vn.lFrame,i=o.bindingRootIndex;return i===-1&&(i=o.bindingRootIndex=o.tView.bindingStartIndex),i}function Aj(){return Vn.lFrame.bindingIndex}function Pj(o){return Vn.lFrame.bindingIndex=o}function GT(){return Vn.lFrame.bindingIndex++}function LR(o){let i=Vn.lFrame,l=i.bindingIndex;return i.bindingIndex=i.bindingIndex+o,l}function Rj(){return Vn.lFrame.inI18n}function Oj(o,i){let l=Vn.lFrame;l.bindingIndex=l.bindingRootIndex=o,XE(i)}function kj(){return Vn.lFrame.currentDirectiveIndex}function XE(o){Vn.lFrame.currentDirectiveIndex=o}function Lj(o){let i=Vn.lFrame.currentDirectiveIndex;return i===-1?null:o[i]}function FR(o){Vn.lFrame.currentQueryIndex=o}function Fj(o){let i=o[Zn];return i.type===2?i.declTNode:i.type===1?o[Fo]:null}function NR(o,i,l){if(l&Un.SkipSelf){let f=i,r=o;for(;f=f.parent,f===null&&!(l&Un.Host);)if(f=Fj(r),f===null||(r=r[jf],f.type&10))break;if(f===null)return!1;i=f,o=r}let c=Vn.lFrame=zR();return c.currentTNode=i,c.lView=o,!0}function HT(o){let i=zR(),l=o[Zn];Vn.lFrame=i,i.currentTNode=l.firstChild,i.lView=o,i.tView=l,i.contextLView=o,i.bindingIndex=l.bindingStartIndex,i.inI18n=!1}function zR(){let o=Vn.lFrame,i=o===null?null:o.child;return i===null?BR(o):i}function BR(o){let i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:o,child:null,inI18n:!1};return o!==null&&(o.child=i),i}function VR(){let o=Vn.lFrame;return Vn.lFrame=o.parent,o.currentTNode=null,o.lView=null,o}var jR=VR;function qT(){let o=VR();o.isParent=!0,o.tView=null,o.selectedIndex=-1,o.contextLView=null,o.elementDepthCount=0,o.currentDirectiveIndex=-1,o.currentNamespace=null,o.bindingRootIndex=-1,o.bindingIndex=-1,o.currentQueryIndex=0}function Nj(o){return(Vn.lFrame.contextLView=wj(o,Vn.lFrame.contextLView))[Rs]}function Ph(){return Vn.lFrame.selectedIndex}function Th(o){Vn.lFrame.selectedIndex=o}function WT(){let o=Vn.lFrame;return IR(o.tView,o.selectedIndex)}function UR(){Vn.lFrame.currentNamespace=SR}function zj(){return Vn.lFrame.currentNamespace}var $R=!0;function Xv(){return $R}function Yv(o){$R=o}function Bj(o,i,l){let{ngOnChanges:c,ngOnInit:f,ngDoCheck:r}=i.type.prototype;if(c){let w=wR(i);(l.preOrderHooks??=[]).push(o,w),(l.preOrderCheckHooks??=[]).push(o,w)}f&&(l.preOrderHooks??=[]).push(0-o,f),r&&((l.preOrderHooks??=[]).push(o,r),(l.preOrderCheckHooks??=[]).push(o,r))}function Kv(o,i){for(let l=i.directiveStart,c=i.directiveEnd;l<c;l++){let r=o.data[l].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:C,ngAfterViewInit:A,ngAfterViewChecked:L,ngOnDestroy:U}=r;w&&(o.contentHooks??=[]).push(-l,w),C&&((o.contentHooks??=[]).push(l,C),(o.contentCheckHooks??=[]).push(l,C)),A&&(o.viewHooks??=[]).push(-l,A),L&&((o.viewHooks??=[]).push(l,L),(o.viewCheckHooks??=[]).push(l,L)),U!=null&&(o.destroyHooks??=[]).push(l,U)}}function yv(o,i,l){GR(o,i,3,l)}function vv(o,i,l,c){(o[gn]&3)===l&&GR(o,i,l,c)}function DE(o,i){let l=o[gn];(l&3)===i&&(l&=16383,l+=1,o[gn]=l)}function GR(o,i,l,c){let f=c!==void 0?o[Sf]&65535:0,r=c??-1,w=i.length-1,C=0;for(let A=f;A<w;A++)if(typeof i[A+1]=="number"){if(C=i[A],c!=null&&C>=c)break}else i[A]<0&&(o[Sf]+=65536),(C<r||r==-1)&&(Vj(o,l,i,A),o[Sf]=(o[Sf]&4294901760)+A+2),A++}function fP(o,i){da(4,o,i);let l=cr(null);try{i.call(o)}finally{cr(l),da(5,o,i)}}function Vj(o,i,l,c){let f=l[c]<0,r=l[c+1],w=f?-l[c]:l[c],C=o[w];f?o[gn]>>14<o[Sf]>>16&&(o[gn]&3)===i&&(o[gn]+=16384,fP(C,r)):fP(C,r)}var Mf=-1,Sh=class{constructor(i,l,c){this.factory=i,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=c}};function jj(o){return o instanceof Sh}function Uj(o){return(o.flags&8)!==0}function $j(o){return(o.flags&16)!==0}function HR(o){return o!==Mf}function Dv(o){return o&32767}function Gj(o){return o>>16}function Mv(o,i){let l=Gj(o),c=i;for(;l>0;)c=c[jf],l--;return c}var YE=!0;function pP(o){let i=YE;return YE=o,i}var Hj=256,qR=Hj-1,WR=5,qj=0,fa={};function Wj(o,i,l){let c;typeof l=="string"?c=l.charCodeAt(0)||0:l.hasOwnProperty(_g)&&(c=l[_g]),c==null&&(c=l[_g]=qj++);let f=c&qR,r=1<<f;i.data[o+(f>>WR)]|=r}function Av(o,i){let l=ZR(o,i);if(l!==-1)return l;let c=i[Zn];c.firstCreatePass&&(o.injectorIndex=i.length,ME(c.data,o),ME(i,null),ME(c.blueprint,null));let f=ZT(o,i),r=o.injectorIndex;if(HR(f)){let w=Dv(f),C=Mv(f,i),A=C[Zn].data;for(let L=0;L<8;L++)i[r+L]=C[w+L]|A[w+L]}return i[r+8]=f,r}function ME(o,i){o.push(0,0,0,0,0,0,0,0,i)}function ZR(o,i){return o.injectorIndex===-1||o.parent&&o.parent.injectorIndex===o.injectorIndex||i[o.injectorIndex+8]===null?-1:o.injectorIndex}function ZT(o,i){if(o.parent&&o.parent.injectorIndex!==-1)return o.parent.injectorIndex;let l=0,c=null,f=i;for(;f!==null;){if(c=JR(f),c===null)return Mf;if(l++,f=f[jf],c.injectorIndex!==-1)return c.injectorIndex|l<<16}return Mf}function KE(o,i,l){Wj(o,i,l)}function Zj(o,i){if(i==="class")return o.classes;if(i==="style")return o.styles;let l=o.attrs;if(l){let c=l.length,f=0;for(;f<c;){let r=l[f];if(iR(r))break;if(r===0)f=f+2;else if(typeof r=="number")for(f++;f<c&&typeof l[f]=="string";)f++;else{if(r===i)return l[f+1];f=f+2}}}return null}function XR(o,i,l){if(l&Un.Optional||o!==void 0)return o;PT(i,"NodeInjector")}function YR(o,i,l,c){if(l&Un.Optional&&c===void 0&&(c=null),!(l&(Un.Self|Un.Host))){let f=o[Of],r=rs(void 0);try{return f?f.get(i,c,l&Un.Optional):QP(i,c,l&Un.Optional)}finally{rs(r)}}return XR(c,i,l)}function KR(o,i,l,c=Un.Default,f){if(o!==null){if(i[gn]&2048&&!(c&Un.Self)){let w=Jj(o,i,l,c,fa);if(w!==fa)return w}let r=QR(o,i,l,c,fa);if(r!==fa)return r}return YR(i,l,c,f)}function QR(o,i,l,c,f){let r=Kj(l);if(typeof r=="function"){if(!NR(i,o,c))return c&Un.Host?XR(f,l,c):YR(i,l,c,f);try{let w;if(w=r(c),w==null&&!(c&Un.Optional))PT(l);else return w}finally{jR()}}else if(typeof r=="number"){let w=null,C=ZR(o,i),A=Mf,L=c&Un.Host?i[ks][Fo]:null;for((C===-1||c&Un.SkipSelf)&&(A=C===-1?ZT(o,i):i[C+8],A===Mf||!gP(c,!1)?C=-1:(w=i[Zn],C=Dv(A),i=Mv(A,i)));C!==-1;){let U=i[Zn];if(mP(r,C,U.data)){let Q=Xj(C,i,l,w,c,L);if(Q!==fa)return Q}A=i[C+8],A!==Mf&&gP(c,i[Zn].data[C+8]===L)&&mP(r,C,i)?(w=U,C=Dv(A),i=Mv(A,i)):C=-1}}return f}function Xj(o,i,l,c,f,r){let w=i[Zn],C=w.data[o+8],A=c==null?Wv(C)&&YE:c!=w&&(C.type&3)!==0,L=f&Un.Host&&r===C,U=Yj(C,w,l,A,L);return U!==null?Ff(i,w,U,C):fa}function Yj(o,i,l,c,f){let r=o.providerIndexes,w=i.data,C=r&1048575,A=o.directiveStart,L=o.directiveEnd,U=r>>20,Q=c?C:C+U,me=f?C+U:L;for(let he=Q;he<me;he++){let be=w[he];if(he<A&&l===be||he>=A&&be.type===l)return he}if(f){let he=w[A];if(he&&Uf(he)&&he.type===l)return A}return null}function Ff(o,i,l,c){let f=o[l],r=i.data;if(jj(f)){let w=f;w.resolving&&SV(TV(r[l]));let C=pP(w.canSeeViewProviders);w.resolving=!0;let A,L=w.injectImpl?rs(w.injectImpl):null,U=NR(o,c,Un.Default);try{f=o[l]=w.factory(void 0,r,o,c),i.firstCreatePass&&l>=c.directiveStart&&Bj(l,r[l],i)}finally{L!==null&&rs(L),pP(C),w.resolving=!1,jR()}}return f}function Kj(o){if(typeof o=="string")return o.charCodeAt(0)||0;let i=o.hasOwnProperty(_g)?o[_g]:void 0;return typeof i=="number"?i>=0?i&qR:Qj:i}function mP(o,i,l){let c=1<<o;return!!(l[i+(o>>WR)]&c)}function gP(o,i){return!(o&Un.Self)&&!(o&Un.Host&&i)}var bh=class{constructor(i,l){this._tNode=i,this._lView=l}get(i,l,c){return KR(this._tNode,this._lView,i,$v(c),l)}};function Qj(){return new bh(xo(),hr())}function XT(o){return Dg(()=>{let i=o.prototype.constructor,l=i[wv]||QE(i),c=Object.prototype,f=Object.getPrototypeOf(o.prototype).constructor;for(;f&&f!==c;){let r=f[wv]||QE(f);if(r&&r!==l)return r;f=Object.getPrototypeOf(f)}return r=>new r})}function QE(o){return qP(o)?()=>{let i=QE(Qi(o));return i&&i()}:Af(o)}function Jj(o,i,l,c,f){let r=o,w=i;for(;r!==null&&w!==null&&w[gn]&2048&&!(w[gn]&512);){let C=QR(r,w,l,c|Un.Self,fa);if(C!==fa)return C;let A=r.parent;if(!A){let L=w[vR];if(L){let U=L.get(l,fa,c);if(U!==fa)return U}A=JR(w),w=w[jf]}r=A}return f}function JR(o){let i=o[Zn],l=i.type;return l===2?i.declTNode:l===1?o[Fo]:null}function YT(o){return Zj(xo(),o)}function _P(o,i=null,l=null,c){let f=eO(o,i,l,c);return f.resolveInjectorInitializers(),f}function eO(o,i=null,l=null,c,f=new Set){let r=[l||As,tj(o)];return c=c||(typeof o=="object"?void 0:eo(o)),new xg(r,i||FT(),c||null,f)}var jc=(()=>{let i=class i{static create(c,f){if(Array.isArray(c))return _P({name:""},f,c,"");{let r=c.name??"";return _P({name:r},c.parent,c.providers,r)}}};i.THROW_IF_NOT_FOUND=yg,i.NULL=new Sv,i.\u0275prov=$t({token:i,providedIn:"any",factory:()=>fn(tR)}),i.__NG_ELEMENT_ID__=-1;let o=i;return o})();var eU="ngOriginalError";function AE(o){return o[eU]}var Ls=class{constructor(){this._console=console}handleError(i){let l=this._findOriginalError(i);this._console.error("ERROR",i),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(i){let l=i&&AE(i);for(;l&&AE(l);)l=AE(l);return l||null}},tO=new dn("",{providedIn:"root",factory:()=>bt(Ls).handleError.bind(void 0)}),Qv=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=tU,i.__NG_ENV_ID__=c=>c;let o=i;return o})(),JE=class extends Qv{constructor(i){super(),this._lView=i}onDestroy(i){return MR(this._lView,i),()=>Ej(this._lView,i)}};function tU(){return new JE(hr())}function yP(o,i){return $P(o,i)}function nU(o){return $P(UP,o)}var ya=(yP.required=nU,yP);function rU(){return Jv(xo(),hr())}function Jv(o,i){return new dl(os(o,i))}var dl=(()=>{let i=class i{constructor(c){this.nativeElement=c}};i.__NG_ELEMENT_ID__=rU;let o=i;return o})();var eT=class extends Ai{constructor(i=!1){super(),this.destroyRef=void 0,this.__isAsync=i,_R()&&(this.destroyRef=bt(Qv,{optional:!0})??void 0)}emit(i){let l=cr(null);try{super.next(i)}finally{cr(l)}}subscribe(i,l,c){let f=i,r=l||(()=>null),w=c;if(i&&typeof i=="object"){let A=i;f=A.next?.bind(A),r=A.error?.bind(A),w=A.complete?.bind(A)}this.__isAsync&&(r=PE(r),f&&(f=PE(f)),w&&(w=PE(w)));let C=super.subscribe({next:f,error:r,complete:w});return i instanceof yi&&i.add(C),C}};function PE(o){return i=>{setTimeout(o,void 0,i)}}var Ji=eT;function nO(o){return(o.flags&128)===128}var rO=new Map,iU=0;function oU(){return iU++}function sU(o){rO.set(o[qv],o)}function aU(o){rO.delete(o[qv])}var vP="__ngContext__";function Lc(o,i){xh(i)?(o[vP]=i[qv],sU(i)):o[vP]=i}function iO(o){return sO(o[Eg])}function oO(o){return sO(o[Ps])}function sO(o){for(;o!==null&&!hl(o);)o=o[Ps];return o}var tT;function aO(o){tT=o}function lU(){if(tT!==void 0)return tT;if(typeof document<"u")return document;throw new xt(210,!1)}var KT=new dn("",{providedIn:"root",factory:()=>cU}),cU="ng",QT=new dn(""),fl=new dn("",{providedIn:"platform",factory:()=>"unknown"});var JT=new dn(""),eS=new dn("",{providedIn:"root",factory:()=>lU().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var uU="h",hU="b";var dU=()=>null;function tS(o,i,l=!1){return dU(o,i,l)}var lO=!1,fU=new dn("",{providedIn:"root",factory:()=>lO});var pv;function pU(){if(pv===void 0&&(pv=null,yh.trustedTypes))try{pv=yh.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:o=>o,createScript:o=>o,createScriptURL:o=>o})}catch{}return pv}function xP(o){return pU()?.createScriptURL(o)||o}var Pv=class{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${jP})`}};function Pg(o){return o instanceof Pv?o.changingThisBreaksApplicationSecurity:o}function nS(o,i){let l=mU(o);if(l!=null&&l!==i){if(l==="ResourceURL"&&i==="URL")return!0;throw new Error(`Required a safe ${i}, got a ${l} (see ${jP})`)}return l===i}function mU(o){return o instanceof Pv&&o.getTypeName()||null}var gU=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function cO(o){return o=String(o),o.match(gU)?o:"unsafe:"+o}var ex=function(o){return o[o.NONE=0]="NONE",o[o.HTML=1]="HTML",o[o.STYLE=2]="STYLE",o[o.SCRIPT=3]="SCRIPT",o[o.URL=4]="URL",o[o.RESOURCE_URL=5]="RESOURCE_URL",o}(ex||{});function _U(o){let i=hO();return i?i.sanitize(ex.URL,o)||"":nS(o,"URL")?Pg(o):cO(vh(o))}function yU(o){let i=hO();if(i)return xP(i.sanitize(ex.RESOURCE_URL,o)||"");if(nS(o,"ResourceURL"))return xP(Pg(o));throw new xt(904,!1)}function vU(o,i){return i==="src"&&(o==="embed"||o==="frame"||o==="iframe"||o==="media"||o==="script")||i==="href"&&(o==="base"||o==="link")?yU:_U}function uO(o,i,l){return vU(i,l)(o)}function hO(){let o=hr();return o&&o[Os].sanitizer}var xU=/^>|^->|<!--|-->|--!>|<!-$/g,bU=/(<|>)/g,wU="\u200B$1\u200B";function EU(o){return o.replace(xU,i=>i.replace(bU,wU))}function dO(o){return o instanceof Function?o():o}function TU(o){return(o??bt(jc)).get(fl)==="browser"}var _a=function(o){return o[o.Important=1]="Important",o[o.DashCase=2]="DashCase",o}(_a||{}),SU;function rS(o,i){return SU(o,i)}function Cf(o,i,l,c,f){if(c!=null){let r,w=!1;hl(c)?r=c:xh(c)&&(w=!0,c=c[ul]);let C=ga(c);o===0&&l!==null?f==null?yO(i,l,C):Rv(i,l,C,f||null,!0):o===1&&l!==null?Rv(i,l,C,f||null,!0):o===2?jU(i,C,w):o===3&&i.destroyNode(C),r!=null&&$U(i,o,r,l,f)}}function CU(o,i){return o.createText(i)}function IU(o,i,l){o.setValue(i,l)}function DU(o,i){return o.createComment(EU(i))}function fO(o,i,l){return o.createElement(i,l)}function MU(o,i){pO(o,i),i[ul]=null,i[Fo]=null}function AU(o,i,l,c,f,r){c[ul]=f,c[Fo]=i,nx(o,c,l,1,f,r)}function pO(o,i){i[Os].changeDetectionScheduler?.notify(1),nx(o,i,i[ai],2,null,null)}function PU(o){let i=o[Eg];if(!i)return RE(o[Zn],o);for(;i;){let l=null;if(xh(i))l=i[Eg];else{let c=i[is];c&&(l=c)}if(!l){for(;i&&!i[Ps]&&i!==o;)xh(i)&&RE(i[Zn],i),i=i[qi];i===null&&(i=o),xh(i)&&RE(i[Zn],i),l=i&&i[Ps]}i=l}}function RU(o,i,l,c){let f=is+c,r=l.length;c>0&&(l[f-1][Ps]=i),c<r-is?(i[Ps]=l[f],eR(l,is+c,i)):(l.push(i),i[Ps]=null),i[qi]=l;let w=i[Hv];w!==null&&l!==w&&OU(w,i);let C=i[kf];C!==null&&C.insertView(o),ZE(i),i[gn]|=128}function OU(o,i){let l=o[Iv],f=i[qi][qi][ks];i[ks]!==f&&(o[gn]|=NT.HasTransplantedViews),l===null?o[Iv]=[i]:l.push(i)}function mO(o,i){let l=o[Iv],c=l.indexOf(i);l.splice(c,1)}function nT(o,i){if(o.length<=is)return;let l=is+i,c=o[l];if(c){let f=c[Hv];f!==null&&f!==o&&mO(f,c),i>0&&(o[l-1][Ps]=c[Ps]);let r=Tv(o,is+i);MU(c[Zn],c);let w=r[kf];w!==null&&w.detachView(r[Zn]),c[qi]=null,c[Ps]=null,c[gn]&=-129}return c}function gO(o,i){if(!(i[gn]&256)){let l=i[ai];l.destroyNode&&nx(o,i,l,3,null,null),PU(i)}}function RE(o,i){if(i[gn]&256)return;let l=cr(null);try{i[gn]&=-129,i[gn]|=256,i[wh]&&sE(i[wh]),LU(o,i),kU(o,i),i[Zn].type===1&&i[ai].destroy();let c=i[Hv];if(c!==null&&hl(i[qi])){c!==i[qi]&&mO(c,i);let f=i[kf];f!==null&&f.detachView(o)}aU(i)}finally{cr(l)}}function kU(o,i){let l=o.cleanup,c=i[wg];if(l!==null)for(let r=0;r<l.length-1;r+=2)if(typeof l[r]=="string"){let w=l[r+3];w>=0?c[w]():c[-w].unsubscribe(),r+=2}else{let w=c[l[r+1]];l[r].call(w)}c!==null&&(i[wg]=null);let f=i[Oc];if(f!==null){i[Oc]=null;for(let r=0;r<f.length;r++){let w=f[r];w()}}}function LU(o,i){let l;if(o!=null&&(l=o.destroyHooks)!=null)for(let c=0;c<l.length;c+=2){let f=i[l[c]];if(!(f instanceof Sh)){let r=l[c+1];if(Array.isArray(r))for(let w=0;w<r.length;w+=2){let C=f[r[w]],A=r[w+1];da(4,C,A);try{A.call(C)}finally{da(5,C,A)}}else{da(4,f,r);try{r.call(f)}finally{da(5,f,r)}}}}}function _O(o,i,l){return FU(o,i.parent,l)}function FU(o,i,l){let c=i;for(;c!==null&&c.type&40;)i=c,c=i.parent;if(c===null)return l[ul];{let{componentOffset:f}=c;if(f>-1){let{encapsulation:r}=o.data[c.directiveStart+f];if(r===pa.None||r===pa.Emulated)return null}return os(c,l)}}function Rv(o,i,l,c,f){o.insertBefore(i,l,c,f)}function yO(o,i,l){o.appendChild(i,l)}function bP(o,i,l,c,f){c!==null?Rv(o,i,l,c,f):yO(o,i,l)}function NU(o,i,l,c){o.removeChild(i,l,c)}function iS(o,i){return o.parentNode(i)}function zU(o,i){return o.nextSibling(i)}function vO(o,i,l){return VU(o,i,l)}function BU(o,i,l){return o.type&40?os(o,l):null}var VU=BU,wP;function tx(o,i,l,c){let f=_O(o,c,i),r=i[ai],w=c.parent||i[Fo],C=vO(w,c,i);if(f!=null)if(Array.isArray(l))for(let A=0;A<l.length;A++)bP(r,f,l[A],C,!1);else bP(r,f,l,C,!1);wP!==void 0&&wP(r,c,i,l,f)}function xv(o,i){if(i!==null){let l=i.type;if(l&3)return os(i,o);if(l&4)return rT(-1,o[i.index]);if(l&8){let c=i.child;if(c!==null)return xv(o,c);{let f=o[i.index];return hl(f)?rT(-1,f):ga(f)}}else{if(l&32)return rS(i,o)()||ga(o[i.index]);{let c=xO(o,i);if(c!==null){if(Array.isArray(c))return c[0];let f=Sg(o[ks]);return xv(f,c)}else return xv(o,i.next)}}}return null}function xO(o,i){if(i!==null){let c=o[ks][Fo],f=i.projection;return c.projection[f]}return null}function rT(o,i){let l=is+o+1;if(l<i.length){let c=i[l],f=c[Zn].firstChild;if(f!==null)return xv(c,f)}return i[Eh]}function jU(o,i,l){let c=iS(o,i);c&&NU(o,c,i,l)}function oS(o,i,l,c,f,r,w){for(;l!=null;){let C=c[l.index],A=l.type;if(w&&i===0&&(C&&Lc(ga(C),c),l.flags|=2),(l.flags&32)!==32)if(A&8)oS(o,i,l.child,c,f,r,!1),Cf(i,o,f,C,r);else if(A&32){let L=rS(l,c),U;for(;U=L();)Cf(i,o,f,U,r);Cf(i,o,f,C,r)}else A&16?bO(o,i,c,l,f,r):Cf(i,o,f,C,r);l=w?l.projectionNext:l.next}}function nx(o,i,l,c,f,r){oS(l,c,o.firstChild,i,f,r,!1)}function UU(o,i,l){let c=i[ai],f=_O(o,l,i),r=l.parent||i[Fo],w=vO(r,l,i);bO(c,0,i,l,f,w)}function bO(o,i,l,c,f,r){let w=l[ks],A=w[Fo].projection[c.projection];if(Array.isArray(A))for(let L=0;L<A.length;L++){let U=A[L];Cf(i,o,f,U,r)}else{let L=A,U=w[qi];nO(c)&&(L.flags|=128),oS(o,i,L,U,f,r,!0)}}function $U(o,i,l,c,f){let r=l[Eh],w=ga(l);r!==w&&Cf(i,o,c,r,f);for(let C=is;C<l.length;C++){let A=l[C];nx(A[Zn],A,o,i,c,r)}}function GU(o,i,l,c,f){if(i)f?o.addClass(l,c):o.removeClass(l,c);else{let r=c.indexOf("-")===-1?void 0:_a.DashCase;f==null?o.removeStyle(l,c,r):(typeof f=="string"&&f.endsWith("!important")&&(f=f.slice(0,-10),r|=_a.Important),o.setStyle(l,c,f,r))}}function HU(o,i,l){o.setAttribute(i,"style",l)}function wO(o,i,l){l===""?o.removeAttribute(i,"class"):o.setAttribute(i,"class",l)}function EO(o,i,l){let{mergedAttrs:c,classes:f,styles:r}=l;c!==null&&$E(o,i,c),f!==null&&wO(o,i,f),r!==null&&HU(o,i,r)}var Ns={};function vr(o=1){TO(to(),hr(),Ph()+o,!1)}function TO(o,i,l,c){if(!c)if((i[gn]&3)===3){let r=o.preOrderCheckHooks;r!==null&&yv(i,r,l)}else{let r=o.preOrderHooks;r!==null&&vv(i,r,0,l)}Th(l)}function nr(o,i=Un.Default){let l=hr();if(l===null)return fn(o,i);let c=xo();return KR(c,l,Qi(o),i)}function SO(o,i,l,c,f,r){let w=cr(null);try{let C=null;f&Gr.SignalBased&&(C=i[c][Dc]),C!==null&&C.transformFn!==void 0&&(r=C.transformFn(r)),f&Gr.HasDecoratorInputTransform&&(r=o.inputTransforms[c].call(i,r)),o.setInput!==null?o.setInput(i,C,r,l,c):bR(i,C,c,r)}finally{cr(w)}}function qU(o,i){let l=o.hostBindingOpCodes;if(l!==null)try{for(let c=0;c<l.length;c++){let f=l[c];if(f<0)Th(~f);else{let r=f,w=l[++c],C=l[++c];Oj(w,r);let A=i[r];C(2,A)}}}finally{Th(-1)}}function rx(o,i,l,c,f,r,w,C,A,L,U){let Q=i.blueprint.slice();return Q[ul]=f,Q[gn]=c|4|128|8|64,(L!==null||o&&o[gn]&2048)&&(Q[gn]|=2048),DR(Q),Q[qi]=Q[jf]=o,Q[Rs]=l,Q[Os]=w||o&&o[Os],Q[ai]=C||o&&o[ai],Q[Of]=A||o&&o[Of]||null,Q[Fo]=r,Q[qv]=oU(),Q[bg]=U,Q[vR]=L,Q[ks]=i.type==2?o[ks]:Q,Q}function $f(o,i,l,c,f){let r=o.data[i];if(r===null)r=WU(o,i,l,c,f),Rj()&&(r.flags|=32);else if(r.type&64){r.type=l,r.value=c,r.attrs=f;let w=Mj();r.injectorIndex=w===null?-1:w.injectorIndex}return Ah(r,!0),r}function WU(o,i,l,c,f){let r=kR(),w=jT(),C=w?r:r&&r.parent,A=o.data[i]=QU(o,C,l,i,c,f);return o.firstChild===null&&(o.firstChild=A),r!==null&&(w?r.child==null&&A.parent!==null&&(r.child=A):r.next===null&&(r.next=A,A.prev=r)),A}function CO(o,i,l,c){if(l===0)return-1;let f=i.length;for(let r=0;r<l;r++)i.push(c),o.blueprint.push(c),o.data.push(null);return f}function IO(o,i,l,c,f){let r=Ph(),w=c&2;try{Th(-1),w&&i.length>ma&&TO(o,i,ma,!1),da(w?2:0,f),l(c,f)}finally{Th(r),da(w?3:1,f)}}function sS(o,i,l){if(zT(i)){let c=cr(null);try{let f=i.directiveStart,r=i.directiveEnd;for(let w=f;w<r;w++){let C=o.data[w];if(C.contentQueries){let A=l[w];C.contentQueries(1,A,w)}}}finally{cr(c)}}}function aS(o,i,l){AR()&&(i6(o,i,l,os(l,i)),(l.flags&64)===64&&PO(o,i,l))}function lS(o,i,l=os){let c=i.localNames;if(c!==null){let f=i.index+1;for(let r=0;r<c.length;r+=2){let w=c[r+1],C=w===-1?l(i,o):o[w];o[f++]=C}}}function DO(o){let i=o.tView;return i===null||i.incompleteFirstPass?o.tView=cS(1,null,o.template,o.decls,o.vars,o.directiveDefs,o.pipeDefs,o.viewQuery,o.schemas,o.consts,o.id):i}function cS(o,i,l,c,f,r,w,C,A,L,U){let Q=ma+c,me=Q+f,he=ZU(Q,me),be=typeof L=="function"?L():L;return he[Zn]={type:o,blueprint:he,template:l,queries:null,viewQuery:C,declTNode:i,data:he.slice().fill(null,Q),bindingStartIndex:Q,expandoStartIndex:me,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof w=="function"?w():w,firstChild:null,schemas:A,consts:be,incompleteFirstPass:!1,ssrId:U}}function ZU(o,i){let l=[];for(let c=0;c<i;c++)l.push(c<o?null:Ns);return l}function XU(o,i,l,c){let r=c.get(fU,lO)||l===pa.ShadowDom,w=o.selectRootElement(i,r);return YU(w),w}function YU(o){KU(o)}var KU=()=>null;function QU(o,i,l,c,f,r){let w=i?i.injectorIndex:-1,C=0;return PR()&&(C|=128),{type:l,index:c,insertBeforeIndex:null,injectorIndex:w,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:C,providerIndexes:0,value:f,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function EP(o,i,l,c,f){for(let r in i){if(!i.hasOwnProperty(r))continue;let w=i[r];if(w===void 0)continue;c??={};let C,A=Gr.None;Array.isArray(w)?(C=w[0],A=w[1]):C=w;let L=r;if(f!==null){if(!f.hasOwnProperty(r))continue;L=f[r]}o===0?TP(c,l,L,C,A):TP(c,l,L,C)}return c}function TP(o,i,l,c,f){let r;o.hasOwnProperty(l)?(r=o[l]).push(i,c):r=o[l]=[i,c],f!==void 0&&r.push(f)}function JU(o,i,l){let c=i.directiveStart,f=i.directiveEnd,r=o.data,w=i.attrs,C=[],A=null,L=null;for(let U=c;U<f;U++){let Q=r[U],me=l?l.get(Q):null,he=me?me.inputs:null,be=me?me.outputs:null;A=EP(0,Q.inputs,U,A,he),L=EP(1,Q.outputs,U,L,be);let Ie=A!==null&&w!==null&&!kT(i)?m6(A,U,w):null;C.push(Ie)}A!==null&&(A.hasOwnProperty("class")&&(i.flags|=8),A.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=C,i.inputs=A,i.outputs=L}function e6(o){return o==="class"?"className":o==="for"?"htmlFor":o==="formaction"?"formAction":o==="innerHtml"?"innerHTML":o==="readonly"?"readOnly":o==="tabindex"?"tabIndex":o}function MO(o,i,l,c,f,r,w,C){let A=os(i,l),L=i.inputs,U;!C&&L!=null&&(U=L[c])?(hS(o,l,U,c,f),Wv(i)&&t6(l,i.index)):i.type&3?(c=e6(c),f=w!=null?w(f,i.value||"",c):f,r.setProperty(A,c,f)):i.type&12}function t6(o,i){let l=Vc(i,o);l[gn]&16||(l[gn]|=64)}function uS(o,i,l,c){if(AR()){let f=c===null?null:{"":-1},r=s6(o,l),w,C;r===null?w=C=null:[w,C]=r,w!==null&&AO(o,i,l,w,f,C),f&&a6(l,c,f)}l.mergedAttrs=OT(l.mergedAttrs,l.attrs)}function AO(o,i,l,c,f,r){for(let L=0;L<c.length;L++)KE(Av(l,i),o,c[L].type);c6(l,o.data.length,c.length);for(let L=0;L<c.length;L++){let U=c[L];U.providersResolver&&U.providersResolver(U)}let w=!1,C=!1,A=CO(o,i,c.length,null);for(let L=0;L<c.length;L++){let U=c[L];l.mergedAttrs=OT(l.mergedAttrs,U.hostAttrs),u6(o,l,i,A,U),l6(A,U,f),U.contentQueries!==null&&(l.flags|=4),(U.hostBindings!==null||U.hostAttrs!==null||U.hostVars!==0)&&(l.flags|=64);let Q=U.type.prototype;!w&&(Q.ngOnChanges||Q.ngOnInit||Q.ngDoCheck)&&((o.preOrderHooks??=[]).push(l.index),w=!0),!C&&(Q.ngOnChanges||Q.ngDoCheck)&&((o.preOrderCheckHooks??=[]).push(l.index),C=!0),A++}JU(o,l,r)}function n6(o,i,l,c,f){let r=f.hostBindings;if(r){let w=o.hostBindingOpCodes;w===null&&(w=o.hostBindingOpCodes=[]);let C=~i.index;r6(w)!=C&&w.push(C),w.push(l,c,r)}}function r6(o){let i=o.length;for(;i>0;){let l=o[--i];if(typeof l=="number"&&l<0)return l}return 0}function i6(o,i,l,c){let f=l.directiveStart,r=l.directiveEnd;Wv(l)&&h6(i,l,o.data[f+l.componentOffset]),o.firstCreatePass||Av(l,i),Lc(c,i);let w=l.initialInputs;for(let C=f;C<r;C++){let A=o.data[C],L=Ff(i,o,C,l);if(Lc(L,i),w!==null&&p6(i,C-f,L,A,l,w),Uf(A)){let U=Vc(l.index,i);U[Rs]=Ff(i,o,C,l)}}}function PO(o,i,l){let c=l.directiveStart,f=l.directiveEnd,r=l.index,w=kj();try{Th(r);for(let C=c;C<f;C++){let A=o.data[C],L=i[C];XE(C),(A.hostBindings!==null||A.hostVars!==0||A.hostAttrs!==null)&&o6(A,L)}}finally{Th(-1),XE(w)}}function o6(o,i){o.hostBindings!==null&&o.hostBindings(1,i)}function s6(o,i){let l=o.directiveRegistry,c=null,f=null;if(l)for(let r=0;r<l.length;r++){let w=l[r];if(sR(i,w.selectors,!1))if(c||(c=[]),Uf(w))if(w.findHostDirectiveDefs!==null){let C=[];f=f||new Map,w.findHostDirectiveDefs(w,C,f),c.unshift(...C,w);let A=C.length;iT(o,i,A)}else c.unshift(w),iT(o,i,0);else f=f||new Map,w.findHostDirectiveDefs?.(w,c,f),c.push(w)}return c===null?null:[c,f]}function iT(o,i,l){i.componentOffset=l,(o.components??=[]).push(i.index)}function a6(o,i,l){if(i){let c=o.localNames=[];for(let f=0;f<i.length;f+=2){let r=l[i[f+1]];if(r==null)throw new xt(-301,!1);c.push(i[f],r)}}}function l6(o,i,l){if(l){if(i.exportAs)for(let c=0;c<i.exportAs.length;c++)l[i.exportAs[c]]=o;Uf(i)&&(l[""]=o)}}function c6(o,i,l){o.flags|=1,o.directiveStart=i,o.directiveEnd=i+l,o.providerIndexes=i}function u6(o,i,l,c,f){o.data[c]=f;let r=f.factory||(f.factory=Af(f.type,!0)),w=new Sh(r,Uf(f),nr);o.blueprint[c]=w,l[c]=w,n6(o,i,c,CO(o,l,f.hostVars,Ns),f)}function h6(o,i,l){let c=os(i,o),f=DO(l),r=o[Os].rendererFactory,w=16;l.signals?w=4096:l.onPush&&(w=64);let C=ix(o,rx(o,f,null,w,c,i,null,r.createRenderer(c,l),null,null,null));o[i.index]=C}function d6(o,i,l,c,f,r){let w=os(o,i);f6(i[ai],w,r,o.value,l,c,f)}function f6(o,i,l,c,f,r,w){if(r==null)o.removeAttribute(i,f,l);else{let C=w==null?vh(r):w(r,c||"",f);o.setAttribute(i,f,C,l)}}function p6(o,i,l,c,f,r){let w=r[i];if(w!==null)for(let C=0;C<w.length;){let A=w[C++],L=w[C++],U=w[C++],Q=w[C++];SO(c,l,A,L,U,Q)}}function m6(o,i,l){let c=null,f=0;for(;f<l.length;){let r=l[f];if(r===0){f+=4;continue}else if(r===5){f+=2;continue}if(typeof r=="number")break;if(o.hasOwnProperty(r)){c===null&&(c=[]);let w=o[r];for(let C=0;C<w.length;C+=3)if(w[C]===i){c.push(r,w[C+1],w[C+2],l[f+1]);break}}f+=2}return c}function RO(o,i,l,c){return[o,!0,0,i,null,c,null,l,null,null]}function OO(o,i){let l=o.contentQueries;if(l!==null){let c=cr(null);try{for(let f=0;f<l.length;f+=2){let r=l[f],w=l[f+1];if(w!==-1){let C=o.data[w];FR(r),C.contentQueries(2,i[w],w)}}}finally{cr(c)}}}function ix(o,i){return o[Eg]?o[hP][Ps]=i:o[Eg]=i,o[hP]=i,i}function oT(o,i,l){FR(0);let c=cr(null);try{i(o,l)}finally{cr(c)}}function g6(o){return o[wg]||(o[wg]=[])}function _6(o){return o.cleanup||(o.cleanup=[])}function kO(o,i){let l=o[Of],c=l?l.get(Ls,null):null;c&&c.handleError(i)}function hS(o,i,l,c,f){for(let r=0;r<l.length;){let w=l[r++],C=l[r++],A=l[r++],L=i[w],U=o.data[w];SO(U,L,c,C,A,f)}}function LO(o,i,l){let c=CR(i,o);IU(o[ai],c,l)}function y6(o,i){let l=Vc(i,o),c=l[Zn];v6(c,l);let f=l[ul];f!==null&&l[bg]===null&&(l[bg]=tS(f,l[Of])),dS(c,l,l[Rs])}function v6(o,i){for(let l=i.length;l<o.blueprint.length;l++)i.push(o.blueprint[l])}function dS(o,i,l){HT(i);try{let c=o.viewQuery;c!==null&&oT(1,c,l);let f=o.template;f!==null&&IO(o,i,f,1,l),o.firstCreatePass&&(o.firstCreatePass=!1),i[kf]?.finishViewCreation(o),o.staticContentQueries&&OO(o,i),o.staticViewQueries&&oT(2,o.viewQuery,l);let r=o.components;r!==null&&x6(i,r)}catch(c){throw o.firstCreatePass&&(o.incompleteFirstPass=!0,o.firstCreatePass=!1),c}finally{i[gn]&=-5,qT()}}function x6(o,i){for(let l=0;l<i.length;l++)y6(o,i[l])}function b6(o,i,l,c){let f=cr(null);try{let r=i.tView,C=o[gn]&4096?4096:16,A=rx(o,r,l,C,null,i,null,null,c?.injector??null,c?.embeddedViewInjector??null,c?.dehydratedView??null),L=o[i.index];A[Hv]=L;let U=o[kf];return U!==null&&(A[kf]=U.createEmbeddedView(r)),dS(r,A,l),A}finally{cr(f)}}function SP(o,i){return!i||i.firstChild===null||nO(o)}function w6(o,i,l,c=!0){let f=i[Zn];if(RU(f,i,o,l),c){let w=rT(l,o),C=i[ai],A=iS(C,o[Eh]);A!==null&&AU(f,o[Fo],C,i,A,w)}let r=i[bg];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function Ov(o,i,l,c,f=!1){for(;l!==null;){let r=i[l.index];r!==null&&c.push(ga(r)),hl(r)&&E6(r,c);let w=l.type;if(w&8)Ov(o,i,l.child,c);else if(w&32){let C=rS(l,i),A;for(;A=C();)c.push(A)}else if(w&16){let C=xO(i,l);if(Array.isArray(C))c.push(...C);else{let A=Sg(i[ks]);Ov(A[Zn],A,C,c,!0)}}l=f?l.projectionNext:l.next}return c}function E6(o,i){for(let l=is;l<o.length;l++){let c=o[l],f=c[Zn].firstChild;f!==null&&Ov(c[Zn],c,f,i)}o[Eh]!==o[ul]&&i.push(o[Eh])}var FO=[];function T6(o){return o[wh]??S6(o)}function S6(o){let i=FO.pop()??Object.create(I6);return i.lView=o,i}function C6(o){o.lView[wh]!==o&&(o.lView=null,FO.push(o))}var I6=lr(vt({},G0),{consumerIsAlwaysLive:!0,consumerMarkedDirty:o=>{Tg(o.lView)},consumerOnSignalRead(){this.lView[wh]=this}}),NO=100;function zO(o,i=!0,l=0){let c=o[Os],f=c.rendererFactory,r=!1;r||f.begin?.();try{D6(o,l)}catch(w){throw i&&kO(o,w),w}finally{r||(f.end?.(),c.inlineEffectRunner?.flush())}}function D6(o,i){sT(o,i);let l=0;for(;VT(o);){if(l===NO)throw new xt(103,!1);l++,sT(o,1)}}function M6(o,i,l,c){let f=i[gn];if((f&256)===256)return;let r=!1;!r&&i[Os].inlineEffectRunner?.flush(),HT(i);let w=null,C=null;!r&&A6(o)&&(C=T6(i),w=iE(C));try{DR(i),Pj(o.bindingStartIndex),l!==null&&IO(o,i,l,2,c);let A=(f&3)===3;if(!r)if(A){let Q=o.preOrderCheckHooks;Q!==null&&yv(i,Q,null)}else{let Q=o.preOrderHooks;Q!==null&&vv(i,Q,0,null),DE(i,0)}if(P6(i),BO(i,0),o.contentQueries!==null&&OO(o,i),!r)if(A){let Q=o.contentCheckHooks;Q!==null&&yv(i,Q)}else{let Q=o.contentHooks;Q!==null&&vv(i,Q,1),DE(i,1)}qU(o,i);let L=o.components;L!==null&&jO(i,L,0);let U=o.viewQuery;if(U!==null&&oT(2,U,c),!r)if(A){let Q=o.viewCheckHooks;Q!==null&&yv(i,Q)}else{let Q=o.viewHooks;Q!==null&&vv(i,Q,2),DE(i,2)}if(o.firstUpdatePass===!0&&(o.firstUpdatePass=!1),i[_v]){for(let Q of i[_v])Q();i[_v]=null}r||(i[gn]&=-73)}catch(A){throw Tg(i),A}finally{C!==null&&(oE(C,w),C6(C)),qT()}}function A6(o){return o.type!==2}function BO(o,i){for(let l=iO(o);l!==null;l=oO(l))for(let c=is;c<l.length;c++){let f=l[c];VO(f,i)}}function P6(o){for(let i=iO(o);i!==null;i=oO(i)){if(!(i[gn]&NT.HasTransplantedViews))continue;let l=i[Iv];for(let c=0;c<l.length;c++){let f=l[c],r=f[qi];bj(f)}}}function R6(o,i,l){let c=Vc(i,o);VO(c,l)}function VO(o,i){BT(o)&&sT(o,i)}function sT(o,i){let c=o[Zn],f=o[gn],r=o[wh],w=!!(i===0&&f&16);if(w||=!!(f&64&&i===0),w||=!!(f&1024),w||=!!(r?.dirty&&H0(r)),r&&(r.dirty=!1),o[gn]&=-9217,w)M6(c,o,c.template,o[Rs]);else if(f&8192){BO(o,1);let C=c.components;C!==null&&jO(o,C,1)}}function jO(o,i,l){for(let c=0;c<i.length;c++)R6(o,i[c],l)}function fS(o){for(o[Os].changeDetectionScheduler?.notify();o;){o[gn]|=64;let i=Sg(o);if(fj(o)&&!i)return o;o=i}return null}var Ch=class{get rootNodes(){let i=this._lView,l=i[Zn];return Ov(l,i,l.firstChild,[])}constructor(i,l,c=!0){this._lView=i,this._cdRefInjectingView=l,this.notifyErrorHandler=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Rs]}set context(i){this._lView[Rs]=i}get destroyed(){return(this._lView[gn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let i=this._lView[qi];if(hl(i)){let l=i[Cv],c=l?l.indexOf(this):-1;c>-1&&(nT(i,c),Tv(l,c))}this._attachedToViewContainer=!1}gO(this._lView[Zn],this._lView)}onDestroy(i){MR(this._lView,i)}markForCheck(){fS(this._cdRefInjectingView||this._lView)}detach(){this._lView[gn]&=-129}reattach(){ZE(this._lView),this._lView[gn]|=128}detectChanges(){this._lView[gn]|=1024,zO(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new xt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,pO(this._lView[Zn],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new xt(902,!1);this._appRef=i,ZE(this._lView)}},ox=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=L6;let o=i;return o})(),O6=ox,k6=class extends O6{constructor(i,l,c){super(),this._declarationLView=i,this._declarationTContainer=l,this.elementRef=c}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,l){return this.createEmbeddedViewImpl(i,l)}createEmbeddedViewImpl(i,l,c){let f=b6(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:l,dehydratedView:c});return new Ch(f)}};function L6(){return F6(xo(),hr())}function F6(o,i){return o.type&4?new k6(i,o,Jv(o,i)):null}var see=new RegExp(`^(\\d+)*(${hU}|${uU})*(.*)`);var N6=()=>null;function CP(o,i){return N6(o,i)}var Nf=class{},aT=class{},kv=class{};function z6(o){let i=Error(`No component factory found for ${eo(o)}.`);return i[B6]=o,i}var B6="ngComponent";var lT=class{resolveComponentFactory(i){throw z6(i)}},sx=(()=>{let i=class i{};i.NULL=new lT;let o=i;return o})(),Ih=class{},Uc=(()=>{let i=class i{constructor(){this.destroyNode=null}};i.__NG_ELEMENT_ID__=()=>V6();let o=i;return o})();function V6(){let o=hr(),i=xo(),l=Vc(i.index,o);return(xh(l)?l:o)[ai]}var j6=(()=>{let i=class i{};i.\u0275prov=$t({token:i,providedIn:"root",factory:()=>null});let o=i;return o})(),OE={};var IP=new Set;function $c(o){IP.has(o)||(IP.add(o),performance?.mark?.("mark_feature_usage",{detail:{feature:o}}))}function DP(...o){}function U6(){let o=typeof yh.requestAnimationFrame=="function",i=yh[o?"requestAnimationFrame":"setTimeout"],l=yh[o?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&i&&l){let c=i[Zone.__symbol__("OriginalDelegate")];c&&(i=c);let f=l[Zone.__symbol__("OriginalDelegate")];f&&(l=f)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:l}}var Ar=class o{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ji(!1),this.onMicrotaskEmpty=new Ji(!1),this.onStable=new Ji(!1),this.onError=new Ji(!1),typeof Zone>"u")throw new xt(908,!1);Zone.assertZonePatched();let f=this;f._nesting=0,f._outer=f._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(f._inner=f._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(f._inner=f._inner.fork(Zone.longStackTraceZoneSpec)),f.shouldCoalesceEventChangeDetection=!c&&l,f.shouldCoalesceRunChangeDetection=c,f.lastRequestAnimationFrameId=-1,f.nativeRequestAnimationFrame=U6().nativeRequestAnimationFrame,H6(f)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!o.isInAngularZone())throw new xt(909,!1)}static assertNotInAngularZone(){if(o.isInAngularZone())throw new xt(909,!1)}run(i,l,c){return this._inner.run(i,l,c)}runTask(i,l,c,f){let r=this._inner,w=r.scheduleEventTask("NgZoneEvent: "+f,i,$6,DP,DP);try{return r.runTask(w,l,c)}finally{r.cancelTask(w)}}runGuarded(i,l,c){return this._inner.runGuarded(i,l,c)}runOutsideAngular(i){return this._outer.run(i)}},$6={};function pS(o){if(o._nesting==0&&!o.hasPendingMicrotasks&&!o.isStable)try{o._nesting++,o.onMicrotaskEmpty.emit(null)}finally{if(o._nesting--,!o.hasPendingMicrotasks)try{o.runOutsideAngular(()=>o.onStable.emit(null))}finally{o.isStable=!0}}}function G6(o){o.isCheckStableRunning||o.lastRequestAnimationFrameId!==-1||(o.lastRequestAnimationFrameId=o.nativeRequestAnimationFrame.call(yh,()=>{o.fakeTopEventTask||(o.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{o.lastRequestAnimationFrameId=-1,cT(o),o.isCheckStableRunning=!0,pS(o),o.isCheckStableRunning=!1},void 0,()=>{},()=>{})),o.fakeTopEventTask.invoke()}),cT(o))}function H6(o){let i=()=>{G6(o)};o._inner=o._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,c,f,r,w,C)=>{if(q6(C))return l.invokeTask(f,r,w,C);try{return MP(o),l.invokeTask(f,r,w,C)}finally{(o.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||o.shouldCoalesceRunChangeDetection)&&i(),AP(o)}},onInvoke:(l,c,f,r,w,C,A)=>{try{return MP(o),l.invoke(f,r,w,C,A)}finally{o.shouldCoalesceRunChangeDetection&&i(),AP(o)}},onHasTask:(l,c,f,r)=>{l.hasTask(f,r),c===f&&(r.change=="microTask"?(o._hasPendingMicrotasks=r.microTask,cT(o),pS(o)):r.change=="macroTask"&&(o.hasPendingMacrotasks=r.macroTask))},onHandleError:(l,c,f,r)=>(l.handleError(f,r),o.runOutsideAngular(()=>o.onError.emit(r)),!1)})}function cT(o){o._hasPendingMicrotasks||(o.shouldCoalesceEventChangeDetection||o.shouldCoalesceRunChangeDetection)&&o.lastRequestAnimationFrameId!==-1?o.hasPendingMicrotasks=!0:o.hasPendingMicrotasks=!1}function MP(o){o._nesting++,o.isStable&&(o.isStable=!1,o.onUnstable.emit(null))}function AP(o){o._nesting--,pS(o)}function q6(o){return!Array.isArray(o)||o.length!==1?!1:o[0].data?.__ignore_ng_zone__===!0}var If=function(o){return o[o.EarlyRead=0]="EarlyRead",o[o.Write=1]="Write",o[o.MixedReadWrite=2]="MixedReadWrite",o[o.Read=3]="Read",o}(If||{}),W6={destroy(){}};function mS(o,i){!i&&yR(mS);let l=i?.injector??bt(jc);if(!TU(l))return W6;$c("NgAfterNextRender");let c=l.get(gS),f=c.handler??=new hT,r=i?.phase??If.MixedReadWrite,w=()=>{f.unregister(A),C()},C=l.get(Qv).onDestroy(w),A=Fs(l,()=>new uT(r,()=>{w(),o()}));return f.register(A),{destroy:w}}var uT=class{constructor(i,l){this.phase=i,this.callbackFn=l,this.zone=bt(Ar),this.errorHandler=bt(Ls,{optional:!0}),bt(Nf,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(i){this.errorHandler?.handleError(i)}}},hT=class{constructor(){this.executingCallbacks=!1,this.buckets={[If.EarlyRead]:new Set,[If.Write]:new Set,[If.MixedReadWrite]:new Set,[If.Read]:new Set},this.deferredCallbacks=new Set}register(i){(this.executingCallbacks?this.deferredCallbacks:this.buckets[i.phase]).add(i)}unregister(i){this.buckets[i.phase].delete(i),this.deferredCallbacks.delete(i)}execute(){this.executingCallbacks=!0;for(let i of Object.values(this.buckets))for(let l of i)l.invoke();this.executingCallbacks=!1;for(let i of this.deferredCallbacks)this.buckets[i.phase].add(i);this.deferredCallbacks.clear()}destroy(){for(let i of Object.values(this.buckets))i.clear();this.deferredCallbacks.clear()}},gS=(()=>{let i=class i{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let c=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let f of c)f()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};i.\u0275prov=$t({token:i,providedIn:"root",factory:()=>new i});let o=i;return o})();function Lv(o,i,l){let c=l?o.styles:null,f=l?o.classes:null,r=0;if(i!==null)for(let w=0;w<i.length;w++){let C=i[w];if(typeof C=="number")r=C;else if(r==1)f=tP(f,C);else if(r==2){let A=C,L=i[++w];c=tP(c,A+": "+L+";")}}l?o.styles=c:o.stylesWithoutHost=c,l?o.classes=f:o.classesWithoutHost=f}var Fv=class extends sx{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){let l=kc(i);return new zf(l,this.ngModule)}};function PP(o){let i=[];for(let l in o){if(!o.hasOwnProperty(l))continue;let c=o[l];c!==void 0&&i.push({propName:Array.isArray(c)?c[0]:c,templateName:l})}return i}function Z6(o){let i=o.toLowerCase();return i==="svg"?SR:i==="math"?_j:null}var dT=class{constructor(i,l){this.injector=i,this.parentInjector=l}get(i,l,c){c=$v(c);let f=this.injector.get(i,OE,c);return f!==OE||l===OE?f:this.parentInjector.get(i,l,c)}},zf=class extends kv{get inputs(){let i=this.componentDef,l=i.inputTransforms,c=PP(i.inputs);if(l!==null)for(let f of c)l.hasOwnProperty(f.propName)&&(f.transform=l[f.propName]);return c}get outputs(){return PP(this.componentDef.outputs)}constructor(i,l){super(),this.componentDef=i,this.ngModule=l,this.componentType=i.type,this.selector=YV(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!l}create(i,l,c,f){let r=cr(null);try{f=f||this.ngModule;let w=f instanceof vo?f:f?.injector;w&&this.componentDef.getStandaloneInjector!==null&&(w=this.componentDef.getStandaloneInjector(w)||w);let C=w?new dT(i,w):i,A=C.get(Ih,null);if(A===null)throw new xt(407,!1);let L=C.get(j6,null),U=C.get(gS,null),Q=C.get(Nf,null),me={rendererFactory:A,sanitizer:L,inlineEffectRunner:null,afterRenderEventManager:U,changeDetectionScheduler:Q},he=A.createRenderer(null,this.componentDef),be=this.componentDef.selectors[0][0]||"div",Ie=c?XU(he,c,this.componentDef.encapsulation,C):fO(he,be,Z6(be)),Qe=512;this.componentDef.signals?Qe|=4096:this.componentDef.onPush||(Qe|=16);let ze=null;Ie!==null&&(ze=tS(Ie,C,!0));let nt=cS(0,null,null,1,0,null,null,null,null,null,null),ft=rx(null,nt,null,Qe,null,null,me,he,C,null,ze);HT(ft);let Ue,Nt;try{let Yt=this.componentDef,Jt,Et=null;Yt.findHostDirectiveDefs?(Jt=[],Et=new Map,Yt.findHostDirectiveDefs(Yt,Jt,Et),Jt.push(Yt)):Jt=[Yt];let tr=X6(ft,Ie),Ct=Y6(tr,Ie,Yt,Jt,ft,me,he);Nt=IR(nt,ma),Ie&&J6(he,Yt,Ie,c),l!==void 0&&e8(Nt,this.ngContentSelectors,l),Ue=Q6(Ct,Yt,Jt,Et,ft,[t8]),dS(nt,ft,null)}finally{qT()}return new fT(this.componentType,Ue,Jv(Nt,ft),ft,Nt)}finally{cr(r)}}},fT=class extends aT{constructor(i,l,c,f,r){super(),this.location=c,this._rootLView=f,this._tNode=r,this.previousInputValues=null,this.instance=l,this.hostView=this.changeDetectorRef=new Ch(f,void 0,!1),this.componentType=i}setInput(i,l){let c=this._tNode.inputs,f;if(c!==null&&(f=c[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),l))return;let r=this._rootLView;hS(r[Zn],r,f,i,l),this.previousInputValues.set(i,l);let w=Vc(this._tNode.index,r);fS(w)}}get injector(){return new bh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}};function X6(o,i){let l=o[Zn],c=ma;return o[c]=i,$f(l,c,2,"#host",null)}function Y6(o,i,l,c,f,r,w){let C=f[Zn];K6(c,o,i,w);let A=null;i!==null&&(A=tS(i,f[Of]));let L=r.rendererFactory.createRenderer(i,l),U=16;l.signals?U=4096:l.onPush&&(U=64);let Q=rx(f,DO(l),null,U,f[o.index],o,r,L,null,null,A);return C.firstCreatePass&&iT(C,o,c.length-1),ix(f,Q),f[o.index]=Q}function K6(o,i,l,c){for(let f of o)i.mergedAttrs=OT(i.mergedAttrs,f.hostAttrs);i.mergedAttrs!==null&&(Lv(i,i.mergedAttrs,!0),l!==null&&EO(c,l,i))}function Q6(o,i,l,c,f,r){let w=xo(),C=f[Zn],A=os(w,f);AO(C,f,w,l,null,c);for(let U=0;U<l.length;U++){let Q=w.directiveStart+U,me=Ff(f,C,Q,w);Lc(me,f)}PO(C,f,w),A&&Lc(A,f);let L=Ff(f,C,w.directiveStart+w.componentOffset,w);if(o[Rs]=f[Rs]=L,r!==null)for(let U of r)U(L,i);return sS(C,w,f),L}function J6(o,i,l,c){if(c)$E(o,l,["ng-version","17.3.11"]);else{let{attrs:f,classes:r}=KV(i.selectors[0]);f&&$E(o,l,f),r&&r.length>0&&wO(o,l,r.join(" "))}}function e8(o,i,l){let c=o.projection=[];for(let f=0;f<i.length;f++){let r=l[f];c.push(r!=null?Array.from(r):null)}}function t8(){let o=xo();Kv(hr()[Zn],o)}var Gf=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=n8;let o=i;return o})();function n8(){let o=xo();return i8(o,hr())}var r8=Gf,UO=class extends r8{constructor(i,l,c){super(),this._lContainer=i,this._hostTNode=l,this._hostLView=c}get element(){return Jv(this._hostTNode,this._hostLView)}get injector(){return new bh(this._hostTNode,this._hostLView)}get parentInjector(){let i=ZT(this._hostTNode,this._hostLView);if(HR(i)){let l=Mv(i,this._hostLView),c=Dv(i),f=l[Zn].data[c+8];return new bh(f,l)}else return new bh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){let l=RP(this._lContainer);return l!==null&&l[i]||null}get length(){return this._lContainer.length-is}createEmbeddedView(i,l,c){let f,r;typeof c=="number"?f=c:c!=null&&(f=c.index,r=c.injector);let w=CP(this._lContainer,i.ssrId),C=i.createEmbeddedViewImpl(l||{},r,w);return this.insertImpl(C,f,SP(this._hostTNode,w)),C}createComponent(i,l,c,f,r){let w=i&&!dj(i),C;if(w)C=l;else{let be=l||{};C=be.index,c=be.injector,f=be.projectableNodes,r=be.environmentInjector||be.ngModuleRef}let A=w?i:new zf(kc(i)),L=c||this.parentInjector;if(!r&&A.ngModule==null){let Ie=(w?L:this.parentInjector).get(vo,null);Ie&&(r=Ie)}let U=kc(A.componentType??{}),Q=CP(this._lContainer,U?.id??null),me=Q?.firstChild??null,he=A.create(L,f,me,r);return this.insertImpl(he.hostView,C,SP(this._hostTNode,Q)),he}insert(i,l){return this.insertImpl(i,l,!0)}insertImpl(i,l,c){let f=i._lView;if(xj(f)){let C=this.indexOf(i);if(C!==-1)this.detach(C);else{let A=f[qi],L=new UO(A,A[Fo],A[qi]);L.detach(L.indexOf(i))}}let r=this._adjustIndex(l),w=this._lContainer;return w6(w,f,r,c),i.attachToViewContainerRef(),eR(kE(w),r,i),i}move(i,l){return this.insert(i,l)}indexOf(i){let l=RP(this._lContainer);return l!==null?l.indexOf(i):-1}remove(i){let l=this._adjustIndex(i,-1),c=nT(this._lContainer,l);c&&(Tv(kE(this._lContainer),l),gO(c[Zn],c))}detach(i){let l=this._adjustIndex(i,-1),c=nT(this._lContainer,l);return c&&Tv(kE(this._lContainer),l)!=null?new Ch(c):null}_adjustIndex(i,l=0){return i??this.length+l}};function RP(o){return o[Cv]}function kE(o){return o[Cv]||(o[Cv]=[])}function i8(o,i){let l,c=i[o.index];return hl(c)?l=c:(l=RO(c,i,null,o),i[o.index]=l,ix(i,l)),s8(l,i,o,c),new UO(l,o,i)}function o8(o,i){let l=o[ai],c=l.createComment(""),f=os(i,o),r=iS(l,f);return Rv(l,r,c,zU(l,f),!1),c}var s8=c8,a8=()=>!1;function l8(o,i,l){return a8(o,i,l)}function c8(o,i,l,c){if(o[Eh])return;let f;l.type&8?f=ga(c):f=o8(i,l),o[Eh]=f}function $O(o,i){$c("NgSignals");let l=T2(o),c=l[Dc];return i?.equal&&(c.equal=i.equal),l.set=f=>W0(c,f),l.update=f=>S2(c,f),l.asReadonly=u8.bind(l),l}function u8(){let o=this[Dc];if(o.readonlyFn===void 0){let i=()=>this();i[Dc]=o,o.readonlyFn=i}return o.readonlyFn}function _S(o){let i=o.inputConfig,l={};for(let c in i)if(i.hasOwnProperty(c)){let f=i[c];Array.isArray(f)&&f[3]&&(l[c]=f[3])}o.inputTransforms=l}var Fc=class{},Cg=class{};var pT=class extends Fc{constructor(i,l,c){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Fv(this);let f=uR(i);this._bootstrapComponents=dO(f.bootstrap),this._r3Injector=eO(i,l,[{provide:Fc,useValue:this},{provide:sx,useValue:this.componentFactoryResolver},...c],eo(i),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(i)}get injector(){return this._r3Injector}destroy(){let i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}},mT=class extends Cg{constructor(i){super(),this.moduleType=i}create(i){return new pT(this.moduleType,i,[])}};var Nv=class extends Fc{constructor(i){super(),this.componentFactoryResolver=new Fv(this),this.instance=null;let l=new xg([...i.providers,{provide:Fc,useValue:this},{provide:sx,useValue:this.componentFactoryResolver}],i.parent||FT(),i.debugName,new Set(["environment"]));this.injector=l,i.runEnvironmentInitializers&&l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}};function yS(o,i,l=null){return new Nv({providers:o,parent:i,debugName:l,runEnvironmentInitializers:!0}).injector}var Gc=(()=>{let i=class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new vi(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let c=this.taskId++;return this.pendingTasks.add(c),c}remove(c){this.pendingTasks.delete(c),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function GO(o){return vS(o)?Array.isArray(o)||!(o instanceof Map)&&Symbol.iterator in o:!1}function h8(o,i){if(Array.isArray(o))for(let l=0;l<o.length;l++)i(o[l]);else{let l=o[Symbol.iterator](),c;for(;!(c=l.next()).done;)i(c.value)}}function vS(o){return o!==null&&(typeof o=="function"||typeof o=="object")}function xS(o,i,l){return o[i]=l}function d8(o,i){return o[i]}function Nc(o,i,l){let c=o[i];return Object.is(c,l)?!1:(o[i]=l,!0)}function HO(o,i,l,c){let f=Nc(o,i,l);return Nc(o,i+1,c)||f}function f8(o,i,l,c,f){let r=HO(o,i,l,c);return Nc(o,i+2,f)||r}function p8(o){return(o.flags&32)===32}function m8(o,i,l,c,f,r,w,C,A){let L=i.consts,U=$f(i,o,4,w||null,Lf(L,C));uS(i,l,U,Lf(L,A)),Kv(i,U);let Q=U.tView=cS(2,U,c,f,r,i.directiveRegistry,i.pipeRegistry,null,i.schemas,L,null);return i.queries!==null&&(i.queries.template(i,U),Q.queries=i.queries.embeddedTView(U)),U}function pl(o,i,l,c,f,r,w,C){let A=hr(),L=to(),U=o+ma,Q=L.firstCreatePass?m8(U,L,A,i,l,c,f,r,w):L.data[U];Ah(Q,!1);let me=g8(L,A,Q,o);Xv()&&tx(L,A,me,Q),Lc(me,A);let he=RO(me,A,me,Q);return A[U]=he,ix(A,he),l8(he,Q,A),Zv(Q)&&aS(L,A,Q),w!=null&&lS(A,Q,C),pl}var g8=_8;function _8(o,i,l,c){return Yv(!0),i[ai].createComment("")}function bS(o,i,l,c){let f=hr(),r=GT();if(Nc(f,r,i)){let w=to(),C=WT();d6(C,f,o,i,l,c)}return bS}function qO(o,i,l,c){return Nc(o,GT(),l)?i+vh(l)+c:Ns}function y8(o,i,l,c,f,r,w,C){let A=Aj(),L=f8(o,A,l,f,w);return LR(3),L?i+vh(l)+c+vh(f)+r+vh(w)+C:Ns}function mv(o,i){return o<<17|i<<2}function Dh(o){return o>>17&32767}function v8(o){return(o&2)==2}function x8(o,i){return o&131071|i<<17}function gT(o){return o|2}function Bf(o){return(o&131068)>>2}function LE(o,i){return o&-131069|i<<2}function b8(o){return(o&1)===1}function _T(o){return o|1}function w8(o,i,l,c,f,r){let w=r?i.classBindings:i.styleBindings,C=Dh(w),A=Bf(w);o[c]=l;let L=!1,U;if(Array.isArray(l)){let Q=l;U=Q[1],(U===null||Ag(Q,U)>0)&&(L=!0)}else U=l;if(f)if(A!==0){let me=Dh(o[C+1]);o[c+1]=mv(me,C),me!==0&&(o[me+1]=LE(o[me+1],c)),o[C+1]=x8(o[C+1],c)}else o[c+1]=mv(C,0),C!==0&&(o[C+1]=LE(o[C+1],c)),C=c;else o[c+1]=mv(A,0),C===0?C=c:o[A+1]=LE(o[A+1],c),A=c;L&&(o[c+1]=gT(o[c+1])),OP(o,U,c,!0),OP(o,U,c,!1),E8(i,U,o,c,r),w=mv(C,A),r?i.classBindings=w:i.styleBindings=w}function E8(o,i,l,c,f){let r=f?o.residualClasses:o.residualStyles;r!=null&&typeof i=="string"&&Ag(r,i)>=0&&(l[c+1]=_T(l[c+1]))}function OP(o,i,l,c){let f=o[l+1],r=i===null,w=c?Dh(f):Bf(f),C=!1;for(;w!==0&&(C===!1||r);){let A=o[w],L=o[w+1];T8(A,i)&&(C=!0,o[w+1]=c?_T(L):gT(L)),w=c?Dh(L):Bf(L)}C&&(o[l+1]=c?gT(f):_T(f))}function T8(o,i){return o===null||i==null||(Array.isArray(o)?o[1]:o)===i?!0:Array.isArray(o)&&typeof i=="string"?Ag(o,i)>=0:!1}function Fr(o,i,l){let c=hr(),f=GT();if(Nc(c,f,i)){let r=to(),w=WT();MO(r,w,c,o,i,c[ai],l,!1)}return Fr}function kP(o,i,l,c,f){let r=i.inputs,w=f?"class":"style";hS(o,l,r[w],w,c)}function Hf(o,i,l){return S8(o,i,l,!1),Hf}function S8(o,i,l,c){let f=hr(),r=to(),w=LR(2);if(r.firstUpdatePass&&I8(r,o,w,c),i!==Ns&&Nc(f,w,i)){let C=r.data[Ph()];R8(r,C,f,f[ai],o,f[w+1]=O8(i,l),c,w)}}function C8(o,i){return i>=o.expandoStartIndex}function I8(o,i,l,c){let f=o.data;if(f[l+1]===null){let r=f[Ph()],w=C8(o,l);k8(r,c)&&i===null&&!w&&(i=!1),i=D8(f,r,i,c),w8(f,r,i,l,w,c)}}function D8(o,i,l,c){let f=Lj(o),r=c?i.residualClasses:i.residualStyles;if(f===null)(c?i.classBindings:i.styleBindings)===0&&(l=FE(null,o,i,l,c),l=Ig(l,i.attrs,c),r=null);else{let w=i.directiveStylingLast;if(w===-1||o[w]!==f)if(l=FE(f,o,i,l,c),r===null){let A=M8(o,i,c);A!==void 0&&Array.isArray(A)&&(A=FE(null,o,i,A[1],c),A=Ig(A,i.attrs,c),A8(o,i,c,A))}else r=P8(o,i,c)}return r!==void 0&&(c?i.residualClasses=r:i.residualStyles=r),l}function M8(o,i,l){let c=l?i.classBindings:i.styleBindings;if(Bf(c)!==0)return o[Dh(c)]}function A8(o,i,l,c){let f=l?i.classBindings:i.styleBindings;o[Dh(f)]=c}function P8(o,i,l){let c,f=i.directiveEnd;for(let r=1+i.directiveStylingLast;r<f;r++){let w=o[r].hostAttrs;c=Ig(c,w,l)}return Ig(c,i.attrs,l)}function FE(o,i,l,c,f){let r=null,w=l.directiveEnd,C=l.directiveStylingLast;for(C===-1?C=l.directiveStart:C++;C<w&&(r=i[C],c=Ig(c,r.hostAttrs,f),r!==o);)C++;return o!==null&&(l.directiveStylingLast=C),c}function Ig(o,i,l){let c=l?1:2,f=-1;if(i!==null)for(let r=0;r<i.length;r++){let w=i[r];typeof w=="number"?f=w:f===c&&(Array.isArray(o)||(o=o===void 0?[]:["",o]),NV(o,w,l?!0:i[++r]))}return o===void 0?null:o}function R8(o,i,l,c,f,r,w,C){if(!(i.type&3))return;let A=o.data,L=A[C+1],U=b8(L)?LP(A,i,l,f,Bf(L),w):void 0;if(!zv(U)){zv(r)||v8(L)&&(r=LP(A,null,l,f,C,w));let Q=CR(Ph(),l);GU(c,w,Q,f,r)}}function LP(o,i,l,c,f,r){let w=i===null,C;for(;f>0;){let A=o[f],L=Array.isArray(A),U=L?A[1]:A,Q=U===null,me=l[f+1];me===Ns&&(me=Q?As:void 0);let he=Q?CE(me,c):U===c?me:void 0;if(L&&!zv(he)&&(he=CE(A,c)),zv(he)&&(C=he,w))return C;let be=o[f+1];f=w?Dh(be):Bf(be)}if(i!==null){let A=r?i.residualClasses:i.residualStyles;A!=null&&(C=CE(A,c))}return C}function zv(o){return o!==void 0}function O8(o,i){return o==null||o===""||(typeof i=="string"?o=o+i:typeof o=="object"&&(o=eo(Pg(o)))),o}function k8(o,i){return(o.flags&(i?8:16))!==0}function L8(o,i,l,c,f,r){let w=i.consts,C=Lf(w,f),A=$f(i,o,2,c,C);return uS(i,l,A,Lf(w,r)),A.attrs!==null&&Lv(A,A.attrs,!1),A.mergedAttrs!==null&&Lv(A,A.mergedAttrs,!0),i.queries!==null&&i.queries.elementStart(i,A),A}function In(o,i,l,c){let f=hr(),r=to(),w=ma+o,C=f[ai],A=r.firstCreatePass?L8(w,r,f,i,l,c):r.data[w],L=F8(r,f,A,C,i,o);f[w]=L;let U=Zv(A);return Ah(A,!0),EO(C,L,A),!p8(A)&&Xv()&&tx(r,f,L,A),Tj()===0&&Lc(L,f),Sj(),U&&(aS(r,f,A),sS(r,A,f)),c!==null&&lS(f,A),In}function Cn(){let o=xo();jT()?UT():(o=o.parent,Ah(o,!1));let i=o;Ij(i)&&Dj(),Cj();let l=to();return l.firstCreatePass&&(Kv(l,o),zT(o)&&l.queries.elementEnd(o)),i.classesWithoutHost!=null&&Uj(i)&&kP(l,i,hr(),i.classesWithoutHost,!0),i.stylesWithoutHost!=null&&$j(i)&&kP(l,i,hr(),i.stylesWithoutHost,!1),Cn}function er(o,i,l,c){return In(o,i,l,c),Cn(),er}var F8=(o,i,l,c,f,r)=>(Yv(!0),fO(c,f,zj()));function N8(o,i,l,c,f){let r=i.consts,w=Lf(r,c),C=$f(i,o,8,"ng-container",w);w!==null&&Lv(C,w,!0);let A=Lf(r,f);return uS(i,l,C,A),i.queries!==null&&i.queries.elementStart(i,C),C}function wS(o,i,l){let c=hr(),f=to(),r=o+ma,w=f.firstCreatePass?N8(r,f,c,i,l):f.data[r];Ah(w,!0);let C=z8(f,c,w,o);return c[r]=C,Xv()&&tx(f,c,C,w),Lc(C,c),Zv(w)&&(aS(f,c,w),sS(f,w,c)),l!=null&&lS(c,w),wS}function ES(){let o=xo(),i=to();return jT()?UT():(o=o.parent,Ah(o,!1)),i.firstCreatePass&&(Kv(i,o),zT(o)&&i.queries.elementEnd(o)),ES}var z8=(o,i,l,c)=>(Yv(!0),DU(i[ai],""));function WO(){return hr()}var Bv="en-US";var B8=Bv;function V8(o){typeof o=="string"&&(B8=o.toLowerCase().replace(/_/g,"-"))}function Hr(o,i,l,c){let f=hr(),r=to(),w=xo();return U8(r,f,f[ai],w,o,i,c),Hr}function j8(o,i,l,c){let f=o.cleanup;if(f!=null)for(let r=0;r<f.length-1;r+=2){let w=f[r];if(w===l&&f[r+1]===c){let C=i[wg],A=f[r+2];return C.length>A?C[A]:null}typeof w=="string"&&(r+=2)}return null}function U8(o,i,l,c,f,r,w){let C=Zv(c),L=o.firstCreatePass&&_6(o),U=i[Rs],Q=g6(i),me=!0;if(c.type&3||w){let Ie=os(c,i),Qe=w?w(Ie):Ie,ze=Q.length,nt=w?Ue=>w(ga(Ue[c.index])):c.index,ft=null;if(!w&&C&&(ft=j8(o,i,f,c.index)),ft!==null){let Ue=ft.__ngLastListenerFn__||ft;Ue.__ngNextListenerFn__=r,ft.__ngLastListenerFn__=r,me=!1}else{r=NP(c,i,U,r,!1);let Ue=l.listen(Qe,f,r);Q.push(r,Ue),L&&L.push(f,nt,ze,ze+1)}}else r=NP(c,i,U,r,!1);let he=c.outputs,be;if(me&&he!==null&&(be=he[f])){let Ie=be.length;if(Ie)for(let Qe=0;Qe<Ie;Qe+=2){let ze=be[Qe],nt=be[Qe+1],Nt=i[ze][nt].subscribe(r),Yt=Q.length;Q.push(r,Nt),L&&L.push(f,c.index,Yt,-(Yt+1))}}}function FP(o,i,l,c){let f=cr(null);try{return da(6,i,l),l(c)!==!1}catch(r){return kO(o,r),!1}finally{da(7,i,l),cr(f)}}function NP(o,i,l,c,f){return function r(w){if(w===Function)return c;let C=o.componentOffset>-1?Vc(o.index,i):i;fS(C);let A=FP(i,l,c,w),L=r.__ngNextListenerFn__;for(;L;)A=FP(i,l,L,w)&&A,L=L.__ngNextListenerFn__;return f&&A===!1&&w.preventDefault(),A}}function ZO(o=1){return Nj(o)}function $8(o,i){let l=null,c=HV(o);for(let f=0;f<i.length;f++){let r=i[f];if(r==="*"){l=f;continue}if(c===null?sR(o,r,!0):ZV(c,r))return f}return l}function XO(o){let i=hr()[ks][Fo];if(!i.projection){let l=o?o.length:1,c=i.projection=LV(l,null),f=c.slice(),r=i.child;for(;r!==null;){let w=o?$8(r,o):0;w!==null&&(f[w]?f[w].projectionNext=r:c[w]=r,f[w]=r),r=r.next}}}function YO(o,i=0,l){let c=hr(),f=to(),r=$f(f,ma+o,16,null,l||null);r.projection===null&&(r.projection=i),UT(),(!c[bg]||PR())&&(r.flags&32)!==32&&UU(f,c,r)}function TS(o,i,l){return KO(o,"",i,"",l),TS}function KO(o,i,l,c,f){let r=hr(),w=qO(r,i,l,c);if(w!==Ns){let C=to(),A=WT();MO(C,A,r,o,w,r[ai],f,!1)}return KO}function Kr(o,i=""){let l=hr(),c=to(),f=o+ma,r=c.firstCreatePass?$f(c,f,1,i,null):c.data[f],w=G8(c,l,r,i,o);l[f]=w,Xv()&&tx(c,l,w,r),Ah(r,!1)}var G8=(o,i,l,c,f)=>(Yv(!0),CU(i[ai],c));function Hc(o,i,l){let c=hr(),f=qO(c,o,i,l);return f!==Ns&&LO(c,Ph(),f),Hc}function SS(o,i,l,c,f,r,w){let C=hr(),A=y8(C,o,i,l,c,f,r,w);return A!==Ns&&LO(C,Ph(),A),SS}function H8(o,i,l){let c=to();if(c.firstCreatePass){let f=Uf(o);yT(l,c.data,c.blueprint,f,!0),yT(i,c.data,c.blueprint,f,!1)}}function yT(o,i,l,c,f){if(o=Qi(o),Array.isArray(o))for(let r=0;r<o.length;r++)yT(o[r],i,l,c,f);else{let r=to(),w=hr(),C=xo(),A=Rf(o)?o:Qi(o.provide),L=gR(o),U=C.providerIndexes&1048575,Q=C.directiveStart,me=C.providerIndexes>>20;if(Rf(o)||!o.multi){let he=new Sh(L,f,nr),be=zE(A,i,f?U:U+me,Q);be===-1?(KE(Av(C,w),r,A),NE(r,o,i.length),i.push(A),C.directiveStart++,C.directiveEnd++,f&&(C.providerIndexes+=1048576),l.push(he),w.push(he)):(l[be]=he,w[be]=he)}else{let he=zE(A,i,U+me,Q),be=zE(A,i,U,U+me),Ie=he>=0&&l[he],Qe=be>=0&&l[be];if(f&&!Qe||!f&&!Ie){KE(Av(C,w),r,A);let ze=Z8(f?W8:q8,l.length,f,c,L);!f&&Qe&&(l[be].providerFactory=ze),NE(r,o,i.length,0),i.push(A),C.directiveStart++,C.directiveEnd++,f&&(C.providerIndexes+=1048576),l.push(ze),w.push(ze)}else{let ze=QO(l[f?be:he],L,!f&&c);NE(r,o,he>-1?he:be,ze)}!f&&c&&Qe&&l[be].componentProviders++}}}function NE(o,i,l,c){let f=Rf(i),r=oj(i);if(f||r){let A=(r?Qi(i.useClass):i).prototype.ngOnDestroy;if(A){let L=o.destroyHooks||(o.destroyHooks=[]);if(!f&&i.multi){let U=L.indexOf(l);U===-1?L.push(l,[c,A]):L[U+1].push(c,A)}else L.push(l,A)}}}function QO(o,i,l){return l&&o.componentProviders++,o.multi.push(i)-1}function zE(o,i,l,c){for(let f=l;f<c;f++)if(i[f]===o)return f;return-1}function q8(o,i,l,c){return vT(this.multi,[])}function W8(o,i,l,c){let f=this.multi,r;if(this.providerFactory){let w=this.providerFactory.componentProviders,C=Ff(l,l[Zn],this.providerFactory.index,c);r=C.slice(0,w),vT(f,r);for(let A=w;A<C.length;A++)r.push(C[A])}else r=[],vT(f,r);return r}function vT(o,i){for(let l=0;l<o.length;l++){let c=o[l];i.push(c())}return i}function Z8(o,i,l,c,f){let r=new Sh(o,l,nr);return r.multi=[],r.index=i,r.componentProviders=0,QO(r,f,c&&!l),r}function ax(o,i=[]){return l=>{l.providersResolver=(c,f)=>H8(c,f?f(o):o,i)}}var X8=(()=>{let i=class i{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c)){let f=fR(!1,c.type),r=f.length>0?yS([f],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c,r)}return this.cachedInjectors.get(c)}ngOnDestroy(){try{for(let c of this.cachedInjectors.values())c!==null&&c.destroy()}finally{this.cachedInjectors.clear()}}};i.\u0275prov=$t({token:i,providedIn:"environment",factory:()=>new i(fn(vo))});let o=i;return o})();function Nr(o){$c("NgStandalone"),o.getStandaloneInjector=i=>i.get(X8).getOrCreateStandaloneInjector(o)}function JO(o,i,l){let c=$T()+o,f=hr();return f[c]===Ns?xS(f,c,l?i.call(l):i()):d8(f,c)}function ek(o,i,l,c){return Y8(hr(),$T(),o,i,l,c)}function tk(o,i,l,c,f){return K8(hr(),$T(),o,i,l,c,f)}function nk(o,i){let l=o[i];return l===Ns?void 0:l}function Y8(o,i,l,c,f,r){let w=i+l;return Nc(o,w,f)?xS(o,w+1,r?c.call(r,f):c(f)):nk(o,w+1)}function K8(o,i,l,c,f,r,w){let C=i+l;return HO(o,C,f,r)?xS(o,C+2,w?c.call(w,f,r):c(f,r)):nk(o,C+2)}var lx=(()=>{let i=class i{log(c){console.log(c)}warn(c){console.warn(c)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"platform"});let o=i;return o})();var rk=new dn("");function Rg(o){return!!o&&typeof o.then=="function"}function ik(o){return!!o&&typeof o.subscribe=="function"}var ok=new dn(""),sk=(()=>{let i=class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((c,f)=>{this.resolve=c,this.reject=f}),this.appInits=bt(ok,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let c=[];for(let r of this.appInits){let w=r();if(Rg(w))c.push(w);else if(ik(w)){let C=new Promise((A,L)=>{w.subscribe({complete:A,error:L})});c.push(C)}}let f=()=>{this.done=!0,this.resolve()};Promise.all(c).then(()=>{f()}).catch(r=>{this.reject(r)}),c.length===0&&f(),this.initialized=!0}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),cx=new dn("");function Q8(){E2(()=>{throw new xt(600,!1)})}function J8(o){return o.isBoundToModule}function e$(o,i,l){try{let c=l();return Rg(c)?c.catch(f=>{throw i.runOutsideAngular(()=>o.handleError(f)),f}):c}catch(c){throw i.runOutsideAngular(()=>o.handleError(c)),c}}var qf=(()=>{let i=class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=bt(tO),this.afterRenderEffectManager=bt(gS),this.externalTestViews=new Set,this.beforeRender=new Ai,this.afterTick=new Ai,this.componentTypes=[],this.components=[],this.isStable=bt(Gc).hasPendingTasks.pipe(Ln(c=>!c)),this._injector=bt(vo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(c,f){let r=c instanceof kv;if(!this._injector.get(sk).done){let he=!r&&cR(c),be=!1;throw new xt(405,be)}let C;r?C=c:C=this._injector.get(sx).resolveComponentFactory(c),this.componentTypes.push(C.componentType);let A=J8(C)?void 0:this._injector.get(Fc),L=f||C.selector,U=C.create(jc.NULL,[],L,A),Q=U.location.nativeElement,me=U.injector.get(rk,null);return me?.registerApplication(Q),U.onDestroy(()=>{this.detachView(U.hostView),BE(this.components,U),me?.unregisterApplication(Q)}),this._loadComponent(U),U}tick(){this._tick(!0)}_tick(c){if(this._runningTick)throw new xt(101,!1);let f=cr(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(c)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,cr(f)}}detectChangesInAttachedViews(c){let f=0,r=this.afterRenderEffectManager;for(;;){if(f===NO)throw new xt(103,!1);if(c){let w=f===0;this.beforeRender.next(w);for(let{_lView:C,notifyErrorHandler:A}of this._views)t$(C,w,A)}if(f++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>xT(w))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>xT(w))))break}}attachView(c){let f=c;this._views.push(f),f.attachToAppRef(this)}detachView(c){let f=c;BE(this._views,f),f.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);let f=this._injector.get(cx,[]);[...this._bootstrapListeners,...f].forEach(r=>r(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>BE(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new xt(406,!1);let c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function BE(o,i){let l=o.indexOf(i);l>-1&&o.splice(l,1)}function t$(o,i,l){!i&&!xT(o)||n$(o,l,i)}function xT(o){return VT(o)}function n$(o,i,l){let c;l?(c=0,o[gn]|=1024):o[gn]&64?c=0:c=1,zO(o,i,c)}var bT=class{constructor(i,l){this.ngModuleFactory=i,this.componentFactories=l}},CS=(()=>{let i=class i{compileModuleSync(c){return new mT(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){let f=this.compileModuleSync(c),r=uR(c),w=dO(r.declarations).reduce((C,A)=>{let L=kc(A);return L&&C.push(new zf(L)),C},[]);return new bT(f,w)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var r$=(()=>{let i=class i{constructor(){this.zone=bt(Ar),this.applicationRef=bt(qf)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function i$(o){return[{provide:Ar,useFactory:o},{provide:Pf,multi:!0,useFactory:()=>{let i=bt(r$,{optional:!0});return()=>i.initialize()}},{provide:Pf,multi:!0,useFactory:()=>{let i=bt(l$);return()=>{i.initialize()}}},{provide:tO,useFactory:o$}]}function o$(){let o=bt(Ar),i=bt(Ls);return l=>o.runOutsideAngular(()=>i.handleError(l))}function s$(o){let i=i$(()=>new Ar(a$(o)));return Bc([[],i])}function a$(o){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:o?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:o?.runCoalescing??!1}}var l$=(()=>{let i=class i{constructor(){this.subscription=new yi,this.initialized=!1,this.zone=bt(Ar),this.pendingTasks=bt(Gc)}initialize(){if(this.initialized)return;this.initialized=!0;let c=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(c=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Ar.assertNotInAngularZone(),queueMicrotask(()=>{c!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(c),c=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Ar.assertInAngularZone(),c??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function c$(){return typeof $localize<"u"&&$localize.locale||Bv}var IS=new dn("",{providedIn:"root",factory:()=>bt(IS,Un.Optional|Un.SkipSelf)||c$()});var ak=new dn("");var bv=null;function u$(o=[],i){return jc.create({name:i,providers:[{provide:Gv,useValue:"platform"},{provide:ak,useValue:new Set([()=>bv=null])},...o]})}function h$(o=[]){if(bv)return bv;let i=u$(o);return bv=i,Q8(),d$(i),i}function d$(o){o.get(QT,null)?.forEach(l=>l())}var Wf=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=f$;let o=i;return o})();function f$(o){return p$(xo(),hr(),(o&16)===16)}function p$(o,i,l){if(Wv(o)&&!l){let c=Vc(o.index,i);return new Ch(c,c)}else if(o.type&47){let c=i[ks];return new Ch(c,i)}return null}var wT=class{constructor(){}supports(i){return GO(i)}create(i){return new ET(i)}},m$=(o,i)=>i,ET=class{constructor(i){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=i||m$}forEachItem(i){let l;for(l=this._itHead;l!==null;l=l._next)i(l)}forEachOperation(i){let l=this._itHead,c=this._removalsHead,f=0,r=null;for(;l||c;){let w=!c||l&&l.currentIndex<zP(c,f,r)?l:c,C=zP(w,f,r),A=w.currentIndex;if(w===c)f--,c=c._nextRemoved;else if(l=l._next,w.previousIndex==null)f++;else{r||(r=[]);let L=C-f,U=A-f;if(L!=U){for(let me=0;me<L;me++){let he=me<r.length?r[me]:r[me]=0,be=he+me;U<=be&&be<L&&(r[me]=he+1)}let Q=w.previousIndex;r[Q]=U-L}}C!==A&&i(w,C,A)}}forEachPreviousItem(i){let l;for(l=this._previousItHead;l!==null;l=l._nextPrevious)i(l)}forEachAddedItem(i){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)i(l)}forEachMovedItem(i){let l;for(l=this._movesHead;l!==null;l=l._nextMoved)i(l)}forEachRemovedItem(i){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)i(l)}forEachIdentityChange(i){let l;for(l=this._identityChangesHead;l!==null;l=l._nextIdentityChange)i(l)}diff(i){if(i==null&&(i=[]),!GO(i))throw new xt(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let l=this._itHead,c=!1,f,r,w;if(Array.isArray(i)){this.length=i.length;for(let C=0;C<this.length;C++)r=i[C],w=this._trackByFn(C,r),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,r,w,C),c=!0):(c&&(l=this._verifyReinsertion(l,r,w,C)),Object.is(l.item,r)||this._addIdentityChange(l,r)),l=l._next}else f=0,h8(i,C=>{w=this._trackByFn(f,C),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,C,w,f),c=!0):(c&&(l=this._verifyReinsertion(l,C,w,f)),Object.is(l.item,C)||this._addIdentityChange(l,C)),l=l._next,f++}),this.length=f;return this._truncate(l),this.collection=i,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let i;for(i=this._previousItHead=this._itHead;i!==null;i=i._next)i._nextPrevious=i._next;for(i=this._additionsHead;i!==null;i=i._nextAdded)i.previousIndex=i.currentIndex;for(this._additionsHead=this._additionsTail=null,i=this._movesHead;i!==null;i=i._nextMoved)i.previousIndex=i.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(i,l,c,f){let r;return i===null?r=this._itTail:(r=i._prev,this._remove(i)),i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null),i!==null?(Object.is(i.item,l)||this._addIdentityChange(i,l),this._reinsertAfter(i,r,f)):(i=this._linkedRecords===null?null:this._linkedRecords.get(c,f),i!==null?(Object.is(i.item,l)||this._addIdentityChange(i,l),this._moveAfter(i,r,f)):i=this._addAfter(new TT(l,c),r,f)),i}_verifyReinsertion(i,l,c,f){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null);return r!==null?i=this._reinsertAfter(r,i._prev,f):i.currentIndex!=f&&(i.currentIndex=f,this._addToMoves(i,f)),i}_truncate(i){for(;i!==null;){let l=i._next;this._addToRemovals(this._unlink(i)),i=l}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(i,l,c){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(i);let f=i._prevRemoved,r=i._nextRemoved;return f===null?this._removalsHead=r:f._nextRemoved=r,r===null?this._removalsTail=f:r._prevRemoved=f,this._insertAfter(i,l,c),this._addToMoves(i,c),i}_moveAfter(i,l,c){return this._unlink(i),this._insertAfter(i,l,c),this._addToMoves(i,c),i}_addAfter(i,l,c){return this._insertAfter(i,l,c),this._additionsTail===null?this._additionsTail=this._additionsHead=i:this._additionsTail=this._additionsTail._nextAdded=i,i}_insertAfter(i,l,c){let f=l===null?this._itHead:l._next;return i._next=f,i._prev=l,f===null?this._itTail=i:f._prev=i,l===null?this._itHead=i:l._next=i,this._linkedRecords===null&&(this._linkedRecords=new Vv),this._linkedRecords.put(i),i.currentIndex=c,i}_remove(i){return this._addToRemovals(this._unlink(i))}_unlink(i){this._linkedRecords!==null&&this._linkedRecords.remove(i);let l=i._prev,c=i._next;return l===null?this._itHead=c:l._next=c,c===null?this._itTail=l:c._prev=l,i}_addToMoves(i,l){return i.previousIndex===l||(this._movesTail===null?this._movesTail=this._movesHead=i:this._movesTail=this._movesTail._nextMoved=i),i}_addToRemovals(i){return this._unlinkedRecords===null&&(this._unlinkedRecords=new Vv),this._unlinkedRecords.put(i),i.currentIndex=null,i._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=i,i._prevRemoved=null):(i._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=i),i}_addIdentityChange(i,l){return i.item=l,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=i:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=i,i}},TT=class{constructor(i,l){this.item=i,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},ST=class{constructor(){this._head=null,this._tail=null}add(i){this._head===null?(this._head=this._tail=i,i._nextDup=null,i._prevDup=null):(this._tail._nextDup=i,i._prevDup=this._tail,i._nextDup=null,this._tail=i)}get(i,l){let c;for(c=this._head;c!==null;c=c._nextDup)if((l===null||l<=c.currentIndex)&&Object.is(c.trackById,i))return c;return null}remove(i){let l=i._prevDup,c=i._nextDup;return l===null?this._head=c:l._nextDup=c,c===null?this._tail=l:c._prevDup=l,this._head===null}},Vv=class{constructor(){this.map=new Map}put(i){let l=i.trackById,c=this.map.get(l);c||(c=new ST,this.map.set(l,c)),c.add(i)}get(i,l){let c=i,f=this.map.get(c);return f?f.get(i,l):null}remove(i){let l=i.trackById;return this.map.get(l).remove(i)&&this.map.delete(l),i}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function zP(o,i,l){let c=o.previousIndex;if(c===null)return c;let f=0;return l&&c<l.length&&(f=l[c]),c+i+f}var CT=class{constructor(){}supports(i){return i instanceof Map||vS(i)}create(){return new IT}},IT=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(i){let l;for(l=this._mapHead;l!==null;l=l._next)i(l)}forEachPreviousItem(i){let l;for(l=this._previousMapHead;l!==null;l=l._nextPrevious)i(l)}forEachChangedItem(i){let l;for(l=this._changesHead;l!==null;l=l._nextChanged)i(l)}forEachAddedItem(i){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)i(l)}forEachRemovedItem(i){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)i(l)}diff(i){if(!i)i=new Map;else if(!(i instanceof Map||vS(i)))throw new xt(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(i,(c,f)=>{if(l&&l.key===f)this._maybeAddToChanges(l,c),this._appendAfter=l,l=l._next;else{let r=this._getOrCreateRecordForKey(f,c);l=this._insertBeforeOrAppend(l,r)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let c=l;c!==null;c=c._nextRemoved)c===this._mapHead&&(this._mapHead=null),this._records.delete(c.key),c._nextRemoved=c._next,c.previousValue=c.currentValue,c.currentValue=null,c._prev=null,c._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(i,l){if(i){let c=i._prev;return l._next=i,l._prev=c,i._prev=l,c&&(c._next=l),i===this._mapHead&&(this._mapHead=l),this._appendAfter=i,i}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(i,l){if(this._records.has(i)){let f=this._records.get(i);this._maybeAddToChanges(f,l);let r=f._prev,w=f._next;return r&&(r._next=w),w&&(w._prev=r),f._next=null,f._prev=null,f}let c=new DT(i);return this._records.set(i,c),c.currentValue=l,this._addToAdditions(c),c}_reset(){if(this.isDirty){let i;for(this._previousMapHead=this._mapHead,i=this._previousMapHead;i!==null;i=i._next)i._nextPrevious=i._next;for(i=this._changesHead;i!==null;i=i._nextChanged)i.previousValue=i.currentValue;for(i=this._additionsHead;i!=null;i=i._nextAdded)i.previousValue=i.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(i,l){Object.is(l,i.currentValue)||(i.previousValue=i.currentValue,i.currentValue=l,this._addToChanges(i))}_addToAdditions(i){this._additionsHead===null?this._additionsHead=this._additionsTail=i:(this._additionsTail._nextAdded=i,this._additionsTail=i)}_addToChanges(i){this._changesHead===null?this._changesHead=this._changesTail=i:(this._changesTail._nextChanged=i,this._changesTail=i)}_forEach(i,l){i instanceof Map?i.forEach(l):Object.keys(i).forEach(c=>l(i[c],c))}},DT=class{constructor(i){this.key=i,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function BP(){return new DS([new wT])}var DS=(()=>{let i=class i{constructor(c){this.factories=c}static create(c,f){if(f!=null){let r=f.factories.slice();c=c.concat(r)}return new i(c)}static extend(c){return{provide:i,useFactory:f=>i.create(c,f||BP()),deps:[[i,new Mg,new Vf]]}}find(c){let f=this.factories.find(r=>r.supports(c));if(f!=null)return f;throw new xt(901,!1)}};i.\u0275prov=$t({token:i,providedIn:"root",factory:BP});let o=i;return o})();function VP(){return new Og([new CT])}var Og=(()=>{let i=class i{constructor(c){this.factories=c}static create(c,f){if(f){let r=f.factories.slice();c=c.concat(r)}return new i(c)}static extend(c){return{provide:i,useFactory:f=>i.create(c,f||VP()),deps:[[i,new Mg,new Vf]]}}find(c){let f=this.factories.find(r=>r.supports(c));if(f)return f;throw new xt(901,!1)}};i.\u0275prov=$t({token:i,providedIn:"root",factory:VP});let o=i;return o})();function lk(o){try{let{rootComponent:i,appProviders:l,platformProviders:c}=o,f=h$(c),r=[s$(),...l||[]],C=new Nv({providers:r,parent:f,debugName:"",runEnvironmentInitializers:!1}).injector,A=C.get(Ar);return A.run(()=>{C.resolveInjectorInitializers();let L=C.get(Ls,null),U;A.runOutsideAngular(()=>{U=A.onError.subscribe({next:he=>{L.handleError(he)}})});let Q=()=>C.destroy(),me=f.get(ak);return me.add(Q),C.onDestroy(()=>{U.unsubscribe(),me.delete(Q)}),e$(L,A,()=>{let he=C.get(sk);return he.runInitializers(),he.donePromise.then(()=>{let be=C.get(IS,Bv);V8(be||Bv);let Ie=C.get(qf);return i!==void 0&&Ie.bootstrap(i),Ie})})})}catch(i){return Promise.reject(i)}}function kg(o){return typeof o=="boolean"?o:o!=null&&o!=="false"}var g$=new dn("",{providedIn:"root",factory:()=>bt(_$)}),_$=(()=>{let i=class i{};i.\u0275prov=$t({token:i,providedIn:"root",factory:()=>new MT});let o=i;return o})(),MT=class{constructor(){this.queuedEffectCount=0,this.queues=new Map,this.pendingTasks=bt(Gc),this.taskId=null}scheduleEffect(i){if(this.enqueue(i),this.taskId===null){let l=this.taskId=this.pendingTasks.add();queueMicrotask(()=>{this.flush(),this.pendingTasks.remove(l),this.taskId=null})}}enqueue(i){let l=i.creationZone;this.queues.has(l)||this.queues.set(l,new Set);let c=this.queues.get(l);c.has(i)||(this.queuedEffectCount++,c.add(i))}flush(){for(;this.queuedEffectCount>0;)for(let[i,l]of this.queues)i===null?this.flushQueue(l):i.run(()=>this.flushQueue(l))}flushQueue(i){for(let l of i)i.delete(l),this.queuedEffectCount--,l.run()}},AT=class{constructor(i,l,c,f,r,w){this.scheduler=i,this.effectFn=l,this.creationZone=c,this.injector=r,this.watcher=C2(C=>this.runEffect(C),()=>this.schedule(),w),this.unregisterOnDestroy=f?.onDestroy(()=>this.destroy())}runEffect(i){try{this.effectFn(i)}catch(l){this.injector.get(Ls,null,{optional:!0})?.handleError(l)}}run(){this.watcher.run()}schedule(){this.scheduler.scheduleEffect(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function va(o,i){$c("NgSignals"),!i?.injector&&yR(va);let l=i?.injector??bt(jc),c=i?.manualCleanup!==!0?l.get(Qv):null,f=new AT(l.get(g$),o,typeof Zone>"u"?null:Zone.current,c,l,i?.allowSignalWrites??!1),r=l.get(Wf,null,{optional:!0});return!r||!(r._lView[gn]&8)?f.watcher.notify():(r._lView[_v]??=[]).push(f.watcher.notify),f}function ck(o){let i=kc(o);if(!i)return null;let l=new zf(i);return{get selector(){return l.selector},get type(){return l.componentType},get inputs(){return l.inputs},get outputs(){return l.outputs},get ngContentSelectors(){return l.ngContentSelectors},get isStandalone(){return i.standalone},get isSignal(){return i.signals}}}var gk=null;function Zf(){return gk}function _k(o){gk??=o}var ux=class{};var Qr=new dn(""),yk=(()=>{let i=class i{historyGo(c){throw new Error("")}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>bt(y$),providedIn:"platform"});let o=i;return o})();var y$=(()=>{let i=class i extends yk{constructor(){super(),this._doc=bt(Qr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Zf().getBaseHref(this._doc)}onPopState(c){let f=Zf().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",c,!1),()=>f.removeEventListener("popstate",c)}onHashChange(c){let f=Zf().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",c,!1),()=>f.removeEventListener("hashchange",c)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(c){this._location.pathname=c}pushState(c,f,r){this._history.pushState(c,f,r)}replaceState(c,f,r){this._history.replaceState(c,f,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(c=0){this._history.go(c)}getState(){return this._history.state}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>new i,providedIn:"platform"});let o=i;return o})();function vk(o,i){if(o.length==0)return i;if(i.length==0)return o;let l=0;return o.endsWith("/")&&l++,i.startsWith("/")&&l++,l==2?o+i.substring(1):l==1?o+i:o+"/"+i}function uk(o){let i=o.match(/#|\?|$/),l=i&&i.index||o.length,c=l-(o[l-1]==="/"?1:0);return o.slice(0,c)+o.slice(l)}function Rh(o){return o&&o[0]!=="?"?"?"+o:o}var Yf=(()=>{let i=class i{historyGo(c){throw new Error("")}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>bt(xk),providedIn:"root"});let o=i;return o})(),v$=new dn(""),xk=(()=>{let i=class i extends Yf{constructor(c,f){super(),this._platformLocation=c,this._removeListenerFns=[],this._baseHref=f??this._platformLocation.getBaseHrefFromDOM()??bt(Qr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(c){this._removeListenerFns.push(this._platformLocation.onPopState(c),this._platformLocation.onHashChange(c))}getBaseHref(){return this._baseHref}prepareExternalUrl(c){return vk(this._baseHref,c)}path(c=!1){let f=this._platformLocation.pathname+Rh(this._platformLocation.search),r=this._platformLocation.hash;return r&&c?`${f}${r}`:f}pushState(c,f,r,w){let C=this.prepareExternalUrl(r+Rh(w));this._platformLocation.pushState(c,f,C)}replaceState(c,f,r,w){let C=this.prepareExternalUrl(r+Rh(w));this._platformLocation.replaceState(c,f,C)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(c=0){this._platformLocation.historyGo?.(c)}};i.\u0275fac=function(f){return new(f||i)(fn(yk),fn(v$,8))},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Lg=(()=>{let i=class i{constructor(c){this._subject=new Ji,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=c;let f=this._locationStrategy.getBaseHref();this._basePath=w$(uk(hk(f))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(c=!1){return this.normalize(this._locationStrategy.path(c))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(c,f=""){return this.path()==this.normalize(c+Rh(f))}normalize(c){return i.stripTrailingSlash(b$(this._basePath,hk(c)))}prepareExternalUrl(c){return c&&c[0]!=="/"&&(c="/"+c),this._locationStrategy.prepareExternalUrl(c)}go(c,f="",r=null){this._locationStrategy.pushState(r,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Rh(f)),r)}replaceState(c,f="",r=null){this._locationStrategy.replaceState(r,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Rh(f)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(c=0){this._locationStrategy.historyGo?.(c)}onUrlChange(c){return this._urlChangeListeners.push(c),this._urlChangeSubscription??=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)}),()=>{let f=this._urlChangeListeners.indexOf(c);this._urlChangeListeners.splice(f,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(c="",f){this._urlChangeListeners.forEach(r=>r(c,f))}subscribe(c,f,r){return this._subject.subscribe({next:c,error:f,complete:r})}};i.normalizeQueryParams=Rh,i.joinWithSlash=vk,i.stripTrailingSlash=uk,i.\u0275fac=function(f){return new(f||i)(fn(Yf))},i.\u0275prov=$t({token:i,factory:()=>x$(),providedIn:"root"});let o=i;return o})();function x$(){return new Lg(fn(Yf))}function b$(o,i){if(!o||!i.startsWith(o))return i;let l=i.substring(o.length);return l===""||["/",";","?","#"].includes(l[0])?l:i}function hk(o){return o.replace(/\/index.html$/,"")}function w$(o){if(new RegExp("^(https?:)?//").test(o)){let[,l]=o.split(/\/\/[^\/]+/);return l}return o}function hx(o,i){i=encodeURIComponent(i);for(let l of o.split(";")){let c=l.indexOf("="),[f,r]=c==-1?[l,""]:[l.slice(0,c),l.slice(c+1)];if(f.trim()===i)return decodeURIComponent(r)}return null}var MS=/\s+/,dk=[],Kf=(()=>{let i=class i{constructor(c,f){this._ngEl=c,this._renderer=f,this.initialClasses=dk,this.stateMap=new Map}set klass(c){this.initialClasses=c!=null?c.trim().split(MS):dk}set ngClass(c){this.rawClass=typeof c=="string"?c.trim().split(MS):c}ngDoCheck(){for(let f of this.initialClasses)this._updateState(f,!0);let c=this.rawClass;if(Array.isArray(c)||c instanceof Set)for(let f of c)this._updateState(f,!0);else if(c!=null)for(let f of Object.keys(c))this._updateState(f,!!c[f]);this._applyStateDiff()}_updateState(c,f){let r=this.stateMap.get(c);r!==void 0?(r.enabled!==f&&(r.changed=!0,r.enabled=f),r.touched=!0):this.stateMap.set(c,{enabled:f,changed:!0,touched:!0})}_applyStateDiff(){for(let c of this.stateMap){let f=c[0],r=c[1];r.changed?(this._toggleClass(f,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(f,!1),this.stateMap.delete(f)),r.touched=!1}}_toggleClass(c,f){c=c.trim(),c.length>0&&c.split(MS).forEach(r=>{f?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}};i.\u0275fac=function(f){return new(f||i)(nr(dl),nr(Uc))},i.\u0275dir=zc({type:i,selectors:[["","ngClass",""]],inputs:{klass:[Gr.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let o=i;return o})();var AS=class{constructor(i,l,c,f){this.$implicit=i,this.ngForOf=l,this.index=c,this.count=f}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},dx=(()=>{let i=class i{set ngForOf(c){this._ngForOf=c,this._ngForOfDirty=!0}set ngForTrackBy(c){this._trackByFn=c}get ngForTrackBy(){return this._trackByFn}constructor(c,f,r){this._viewContainer=c,this._template=f,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(c){c&&(this._template=c)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let c=this._ngForOf;if(!this._differ&&c)if(0)try{}catch{}else this._differ=this._differs.find(c).create(this.ngForTrackBy)}if(this._differ){let c=this._differ.diff(this._ngForOf);c&&this._applyChanges(c)}}_applyChanges(c){let f=this._viewContainer;c.forEachOperation((r,w,C)=>{if(r.previousIndex==null)f.createEmbeddedView(this._template,new AS(r.item,this._ngForOf,-1,-1),C===null?void 0:C);else if(C==null)f.remove(w===null?void 0:w);else if(w!==null){let A=f.get(w);f.move(A,C),fk(A,r)}});for(let r=0,w=f.length;r<w;r++){let A=f.get(r).context;A.index=r,A.count=w,A.ngForOf=this._ngForOf}c.forEachIdentityChange(r=>{let w=f.get(r.currentIndex);fk(w,r)})}static ngTemplateContextGuard(c,f){return!0}};i.\u0275fac=function(f){return new(f||i)(nr(Gf),nr(ox),nr(DS))},i.\u0275dir=zc({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let o=i;return o})();function fk(o,i){o.context.$implicit=i.item}var fx=(()=>{let i=class i{constructor(c,f){this._viewContainer=c,this._context=new PS,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(c){this._context.$implicit=this._context.ngIf=c,this._updateView()}set ngIfThen(c){pk("ngIfThen",c),this._thenTemplateRef=c,this._thenViewRef=null,this._updateView()}set ngIfElse(c){pk("ngIfElse",c),this._elseTemplateRef=c,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(c,f){return!0}};i.\u0275fac=function(f){return new(f||i)(nr(Gf),nr(ox))},i.\u0275dir=zc({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let o=i;return o})(),PS=class{constructor(){this.$implicit=null,this.ngIf=null}};function pk(o,i){if(!!!(!i||i.createEmbeddedView))throw new Error(`${o} must be a TemplateRef, but received '${eo(i)}'.`)}var bk=(()=>{let i=class i{constructor(c,f,r){this._ngEl=c,this._differs=f,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(c){this._ngStyle=c,!this._differ&&c&&(this._differ=this._differs.find(c).create())}ngDoCheck(){if(this._differ){let c=this._differ.diff(this._ngStyle);c&&this._applyChanges(c)}}_setStyle(c,f){let[r,w]=c.split("."),C=r.indexOf("-")===-1?void 0:_a.DashCase;f!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,w?`${f}${w}`:f,C):this._renderer.removeStyle(this._ngEl.nativeElement,r,C)}_applyChanges(c){c.forEachRemovedItem(f=>this._setStyle(f.key,null)),c.forEachAddedItem(f=>this._setStyle(f.key,f.currentValue)),c.forEachChangedItem(f=>this._setStyle(f.key,f.currentValue))}};i.\u0275fac=function(f){return new(f||i)(nr(dl),nr(Og),nr(Uc))},i.\u0275dir=zc({type:i,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let o=i;return o})();var wi=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275mod=cl({type:i}),i.\u0275inj=ll({});let o=i;return o})(),wk="browser",E$="server";function px(o){return o===E$}var Xf=class{};var Ng=class{},gx=class{},Oh=class o{constructor(i){this.normalizedNames=new Map,this.lazyUpdate=null,i?typeof i=="string"?this.lazyInit=()=>{this.headers=new Map,i.split(`
`).forEach(l=>{let c=l.indexOf(":");if(c>0){let f=l.slice(0,c),r=f.toLowerCase(),w=l.slice(c+1).trim();this.maybeSetNormalizedName(f,r),this.headers.has(r)?this.headers.get(r).push(w):this.headers.set(r,[w])}})}:typeof Headers<"u"&&i instanceof Headers?(this.headers=new Map,i.forEach((l,c)=>{this.setHeaderEntries(c,l)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(i).forEach(([l,c])=>{this.setHeaderEntries(l,c)})}:this.headers=new Map}has(i){return this.init(),this.headers.has(i.toLowerCase())}get(i){this.init();let l=this.headers.get(i.toLowerCase());return l&&l.length>0?l[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(i){return this.init(),this.headers.get(i.toLowerCase())||null}append(i,l){return this.clone({name:i,value:l,op:"a"})}set(i,l){return this.clone({name:i,value:l,op:"s"})}delete(i,l){return this.clone({name:i,value:l,op:"d"})}maybeSetNormalizedName(i,l){this.normalizedNames.has(l)||this.normalizedNames.set(l,i)}init(){this.lazyInit&&(this.lazyInit instanceof o?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(i=>this.applyUpdate(i)),this.lazyUpdate=null))}copyFrom(i){i.init(),Array.from(i.headers.keys()).forEach(l=>{this.headers.set(l,i.headers.get(l)),this.normalizedNames.set(l,i.normalizedNames.get(l))})}clone(i){let l=new o;return l.lazyInit=this.lazyInit&&this.lazyInit instanceof o?this.lazyInit:this,l.lazyUpdate=(this.lazyUpdate||[]).concat([i]),l}applyUpdate(i){let l=i.name.toLowerCase();switch(i.op){case"a":case"s":let c=i.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(i.name,l);let f=(i.op==="a"?this.headers.get(l):void 0)||[];f.push(...c),this.headers.set(l,f);break;case"d":let r=i.value;if(!r)this.headers.delete(l),this.normalizedNames.delete(l);else{let w=this.headers.get(l);if(!w)return;w=w.filter(C=>r.indexOf(C)===-1),w.length===0?(this.headers.delete(l),this.normalizedNames.delete(l)):this.headers.set(l,w)}break}}setHeaderEntries(i,l){let c=(Array.isArray(l)?l:[l]).map(r=>r.toString()),f=i.toLowerCase();this.headers.set(f,c),this.maybeSetNormalizedName(i,f)}forEach(i){this.init(),Array.from(this.normalizedNames.keys()).forEach(l=>i(this.normalizedNames.get(l),this.headers.get(l)))}};var OS=class{encodeKey(i){return Ek(i)}encodeValue(i){return Ek(i)}decodeKey(i){return decodeURIComponent(i)}decodeValue(i){return decodeURIComponent(i)}};function C$(o,i){let l=new Map;return o.length>0&&o.replace(/^\?/,"").split("&").forEach(f=>{let r=f.indexOf("="),[w,C]=r==-1?[i.decodeKey(f),""]:[i.decodeKey(f.slice(0,r)),i.decodeValue(f.slice(r+1))],A=l.get(w)||[];A.push(C),l.set(w,A)}),l}var I$=/%(\d[a-f0-9])/gi,D$={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Ek(o){return encodeURIComponent(o).replace(I$,(i,l)=>D$[l]??i)}function mx(o){return`${o}`}var Wc=class o{constructor(i={}){if(this.updates=null,this.cloneFrom=null,this.encoder=i.encoder||new OS,i.fromString){if(i.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=C$(i.fromString,this.encoder)}else i.fromObject?(this.map=new Map,Object.keys(i.fromObject).forEach(l=>{let c=i.fromObject[l],f=Array.isArray(c)?c.map(mx):[mx(c)];this.map.set(l,f)})):this.map=null}has(i){return this.init(),this.map.has(i)}get(i){this.init();let l=this.map.get(i);return l?l[0]:null}getAll(i){return this.init(),this.map.get(i)||null}keys(){return this.init(),Array.from(this.map.keys())}append(i,l){return this.clone({param:i,value:l,op:"a"})}appendAll(i){let l=[];return Object.keys(i).forEach(c=>{let f=i[c];Array.isArray(f)?f.forEach(r=>{l.push({param:c,value:r,op:"a"})}):l.push({param:c,value:f,op:"a"})}),this.clone(l)}set(i,l){return this.clone({param:i,value:l,op:"s"})}delete(i,l){return this.clone({param:i,value:l,op:"d"})}toString(){return this.init(),this.keys().map(i=>{let l=this.encoder.encodeKey(i);return this.map.get(i).map(c=>l+"="+this.encoder.encodeValue(c)).join("&")}).filter(i=>i!=="").join("&")}clone(i){let l=new o({encoder:this.encoder});return l.cloneFrom=this.cloneFrom||this,l.updates=(this.updates||[]).concat(i),l}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(i=>this.map.set(i,this.cloneFrom.map.get(i))),this.updates.forEach(i=>{switch(i.op){case"a":case"s":let l=(i.op==="a"?this.map.get(i.param):void 0)||[];l.push(mx(i.value)),this.map.set(i.param,l);break;case"d":if(i.value!==void 0){let c=this.map.get(i.param)||[],f=c.indexOf(mx(i.value));f!==-1&&c.splice(f,1),c.length>0?this.map.set(i.param,c):this.map.delete(i.param)}else{this.map.delete(i.param);break}}}),this.cloneFrom=this.updates=null)}};var kS=class{constructor(){this.map=new Map}set(i,l){return this.map.set(i,l),this}get(i){return this.map.has(i)||this.map.set(i,i.defaultValue()),this.map.get(i)}delete(i){return this.map.delete(i),this}has(i){return this.map.has(i)}keys(){return this.map.keys()}};function M$(o){switch(o){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Tk(o){return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer}function Sk(o){return typeof Blob<"u"&&o instanceof Blob}function Ck(o){return typeof FormData<"u"&&o instanceof FormData}function A$(o){return typeof URLSearchParams<"u"&&o instanceof URLSearchParams}var Fg=class o{constructor(i,l,c,f){this.url=l,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=i.toUpperCase();let r;if(M$(this.method)||f?(this.body=c!==void 0?c:null,r=f):r=c,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new Oh,this.context??=new kS,!this.params)this.params=new Wc,this.urlWithParams=l;else{let w=this.params.toString();if(w.length===0)this.urlWithParams=l;else{let C=l.indexOf("?"),A=C===-1?"?":C<l.length-1?"&":"";this.urlWithParams=l+A+w}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||Tk(this.body)||Sk(this.body)||Ck(this.body)||A$(this.body)?this.body:this.body instanceof Wc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||Ck(this.body)?null:Sk(this.body)?this.body.type||null:Tk(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Wc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(i={}){let l=i.method||this.method,c=i.url||this.url,f=i.responseType||this.responseType,r=i.transferCache??this.transferCache,w=i.body!==void 0?i.body:this.body,C=i.withCredentials??this.withCredentials,A=i.reportProgress??this.reportProgress,L=i.headers||this.headers,U=i.params||this.params,Q=i.context??this.context;return i.setHeaders!==void 0&&(L=Object.keys(i.setHeaders).reduce((me,he)=>me.set(he,i.setHeaders[he]),L)),i.setParams&&(U=Object.keys(i.setParams).reduce((me,he)=>me.set(he,i.setParams[he]),U)),new o(l,c,w,{params:U,headers:L,context:Q,reportProgress:A,responseType:f,withCredentials:C,transferCache:r})}},Qf=function(o){return o[o.Sent=0]="Sent",o[o.UploadProgress=1]="UploadProgress",o[o.ResponseHeader=2]="ResponseHeader",o[o.DownloadProgress=3]="DownloadProgress",o[o.Response=4]="Response",o[o.User=5]="User",o}(Qf||{}),zg=class{constructor(i,l=vx.Ok,c="OK"){this.headers=i.headers||new Oh,this.status=i.status!==void 0?i.status:l,this.statusText=i.statusText||c,this.url=i.url||null,this.ok=this.status>=200&&this.status<300}},LS=class o extends zg{constructor(i={}){super(i),this.type=Qf.ResponseHeader}clone(i={}){return new o({headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},_x=class o extends zg{constructor(i={}){super(i),this.type=Qf.Response,this.body=i.body!==void 0?i.body:null}clone(i={}){return new o({body:i.body!==void 0?i.body:this.body,headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},yx=class extends zg{constructor(i){super(i,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${i.url||"(unknown url)"}`:this.message=`Http failure response for ${i.url||"(unknown url)"}: ${i.status} ${i.statusText}`,this.error=i.error||null}},vx=function(o){return o[o.Continue=100]="Continue",o[o.SwitchingProtocols=101]="SwitchingProtocols",o[o.Processing=102]="Processing",o[o.EarlyHints=103]="EarlyHints",o[o.Ok=200]="Ok",o[o.Created=201]="Created",o[o.Accepted=202]="Accepted",o[o.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",o[o.NoContent=204]="NoContent",o[o.ResetContent=205]="ResetContent",o[o.PartialContent=206]="PartialContent",o[o.MultiStatus=207]="MultiStatus",o[o.AlreadyReported=208]="AlreadyReported",o[o.ImUsed=226]="ImUsed",o[o.MultipleChoices=300]="MultipleChoices",o[o.MovedPermanently=301]="MovedPermanently",o[o.Found=302]="Found",o[o.SeeOther=303]="SeeOther",o[o.NotModified=304]="NotModified",o[o.UseProxy=305]="UseProxy",o[o.Unused=306]="Unused",o[o.TemporaryRedirect=307]="TemporaryRedirect",o[o.PermanentRedirect=308]="PermanentRedirect",o[o.BadRequest=400]="BadRequest",o[o.Unauthorized=401]="Unauthorized",o[o.PaymentRequired=402]="PaymentRequired",o[o.Forbidden=403]="Forbidden",o[o.NotFound=404]="NotFound",o[o.MethodNotAllowed=405]="MethodNotAllowed",o[o.NotAcceptable=406]="NotAcceptable",o[o.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",o[o.RequestTimeout=408]="RequestTimeout",o[o.Conflict=409]="Conflict",o[o.Gone=410]="Gone",o[o.LengthRequired=411]="LengthRequired",o[o.PreconditionFailed=412]="PreconditionFailed",o[o.PayloadTooLarge=413]="PayloadTooLarge",o[o.UriTooLong=414]="UriTooLong",o[o.UnsupportedMediaType=415]="UnsupportedMediaType",o[o.RangeNotSatisfiable=416]="RangeNotSatisfiable",o[o.ExpectationFailed=417]="ExpectationFailed",o[o.ImATeapot=418]="ImATeapot",o[o.MisdirectedRequest=421]="MisdirectedRequest",o[o.UnprocessableEntity=422]="UnprocessableEntity",o[o.Locked=423]="Locked",o[o.FailedDependency=424]="FailedDependency",o[o.TooEarly=425]="TooEarly",o[o.UpgradeRequired=426]="UpgradeRequired",o[o.PreconditionRequired=428]="PreconditionRequired",o[o.TooManyRequests=429]="TooManyRequests",o[o.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",o[o.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",o[o.InternalServerError=500]="InternalServerError",o[o.NotImplemented=501]="NotImplemented",o[o.BadGateway=502]="BadGateway",o[o.ServiceUnavailable=503]="ServiceUnavailable",o[o.GatewayTimeout=504]="GatewayTimeout",o[o.HttpVersionNotSupported=505]="HttpVersionNotSupported",o[o.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",o[o.InsufficientStorage=507]="InsufficientStorage",o[o.LoopDetected=508]="LoopDetected",o[o.NotExtended=510]="NotExtended",o[o.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",o}(vx||{});function RS(o,i){return{body:i,headers:o.headers,context:o.context,observe:o.observe,params:o.params,reportProgress:o.reportProgress,responseType:o.responseType,withCredentials:o.withCredentials,transferCache:o.transferCache}}var FS=(()=>{let i=class i{constructor(c){this.handler=c}request(c,f,r={}){let w;if(c instanceof Fg)w=c;else{let L;r.headers instanceof Oh?L=r.headers:L=new Oh(r.headers);let U;r.params&&(r.params instanceof Wc?U=r.params:U=new Wc({fromObject:r.params})),w=new Fg(c,f,r.body!==void 0?r.body:null,{headers:L,context:r.context,params:U,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let C=sn(w).pipe(Ac(L=>this.handler.handle(L)));if(c instanceof Fg||r.observe==="events")return C;let A=C.pipe(Lo(L=>L instanceof _x));switch(r.observe||"body"){case"body":switch(w.responseType){case"arraybuffer":return A.pipe(Ln(L=>{if(L.body!==null&&!(L.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return L.body}));case"blob":return A.pipe(Ln(L=>{if(L.body!==null&&!(L.body instanceof Blob))throw new Error("Response is not a Blob.");return L.body}));case"text":return A.pipe(Ln(L=>{if(L.body!==null&&typeof L.body!="string")throw new Error("Response is not a string.");return L.body}));case"json":default:return A.pipe(Ln(L=>L.body))}case"response":return A;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(c,f={}){return this.request("DELETE",c,f)}get(c,f={}){return this.request("GET",c,f)}head(c,f={}){return this.request("HEAD",c,f)}jsonp(c,f){return this.request("JSONP",c,{params:new Wc().append(f,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(c,f={}){return this.request("OPTIONS",c,f)}patch(c,f,r={}){return this.request("PATCH",c,RS(r,f))}post(c,f,r={}){return this.request("POST",c,RS(r,f))}put(c,f,r={}){return this.request("PUT",c,RS(r,f))}};i.\u0275fac=function(f){return new(f||i)(fn(Ng))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})();function Ak(o,i){return i(o)}function P$(o,i){return(l,c)=>i.intercept(l,{handle:f=>o(f,c)})}function R$(o,i,l){return(c,f)=>Fs(l,()=>i(c,r=>o(r,f)))}var O$=new dn(""),NS=new dn(""),k$=new dn(""),L$=new dn("");function F$(){let o=null;return(i,l)=>{o===null&&(o=(bt(O$,{optional:!0})??[]).reduceRight(P$,Ak));let c=bt(Gc),f=c.add();return o(i,l).pipe(ua(()=>c.remove(f)))}}var Ik=(()=>{let i=class i extends Ng{constructor(c,f){super(),this.backend=c,this.injector=f,this.chain=null,this.pendingTasks=bt(Gc);let r=bt(L$,{optional:!0});this.backend=r??c}handle(c){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(NS),...this.injector.get(k$,[])]));this.chain=r.reduceRight((w,C)=>R$(w,C,this.injector),Ak)}let f=this.pendingTasks.add();return this.chain(c,r=>this.backend.handle(r)).pipe(ua(()=>this.pendingTasks.remove(f)))}};i.\u0275fac=function(f){return new(f||i)(fn(gx),fn(vo))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})();var N$=/^\)\]\}',?\n/;function z$(o){return"responseURL"in o&&o.responseURL?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):null}var Dk=(()=>{let i=class i{constructor(c){this.xhrFactory=c}handle(c){if(c.method==="JSONP")throw new xt(-2800,!1);let f=this.xhrFactory;return(f.\u0275loadImpl?Yr(f.\u0275loadImpl()):sn(null)).pipe(yo(()=>new ur(w=>{let C=f.build();if(C.open(c.method,c.urlWithParams),c.withCredentials&&(C.withCredentials=!0),c.headers.forEach((Qe,ze)=>C.setRequestHeader(Qe,ze.join(","))),c.headers.has("Accept")||C.setRequestHeader("Accept","application/json, text/plain, */*"),!c.headers.has("Content-Type")){let Qe=c.detectContentTypeHeader();Qe!==null&&C.setRequestHeader("Content-Type",Qe)}if(c.responseType){let Qe=c.responseType.toLowerCase();C.responseType=Qe!=="json"?Qe:"text"}let A=c.serializeBody(),L=null,U=()=>{if(L!==null)return L;let Qe=C.statusText||"OK",ze=new Oh(C.getAllResponseHeaders()),nt=z$(C)||c.url;return L=new LS({headers:ze,status:C.status,statusText:Qe,url:nt}),L},Q=()=>{let{headers:Qe,status:ze,statusText:nt,url:ft}=U(),Ue=null;ze!==vx.NoContent&&(Ue=typeof C.response>"u"?C.responseText:C.response),ze===0&&(ze=Ue?vx.Ok:0);let Nt=ze>=200&&ze<300;if(c.responseType==="json"&&typeof Ue=="string"){let Yt=Ue;Ue=Ue.replace(N$,"");try{Ue=Ue!==""?JSON.parse(Ue):null}catch(Jt){Ue=Yt,Nt&&(Nt=!1,Ue={error:Jt,text:Ue})}}Nt?(w.next(new _x({body:Ue,headers:Qe,status:ze,statusText:nt,url:ft||void 0})),w.complete()):w.error(new yx({error:Ue,headers:Qe,status:ze,statusText:nt,url:ft||void 0}))},me=Qe=>{let{url:ze}=U(),nt=new yx({error:Qe,status:C.status||0,statusText:C.statusText||"Unknown Error",url:ze||void 0});w.error(nt)},he=!1,be=Qe=>{he||(w.next(U()),he=!0);let ze={type:Qf.DownloadProgress,loaded:Qe.loaded};Qe.lengthComputable&&(ze.total=Qe.total),c.responseType==="text"&&C.responseText&&(ze.partialText=C.responseText),w.next(ze)},Ie=Qe=>{let ze={type:Qf.UploadProgress,loaded:Qe.loaded};Qe.lengthComputable&&(ze.total=Qe.total),w.next(ze)};return C.addEventListener("load",Q),C.addEventListener("error",me),C.addEventListener("timeout",me),C.addEventListener("abort",me),c.reportProgress&&(C.addEventListener("progress",be),A!==null&&C.upload&&C.upload.addEventListener("progress",Ie)),C.send(A),w.next({type:Qf.Sent}),()=>{C.removeEventListener("error",me),C.removeEventListener("abort",me),C.removeEventListener("load",Q),C.removeEventListener("timeout",me),c.reportProgress&&(C.removeEventListener("progress",be),A!==null&&C.upload&&C.upload.removeEventListener("progress",Ie)),C.readyState!==C.DONE&&C.abort()}})))}};i.\u0275fac=function(f){return new(f||i)(fn(Xf))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),Pk=new dn(""),B$="XSRF-TOKEN",V$=new dn("",{providedIn:"root",factory:()=>B$}),j$="X-XSRF-TOKEN",U$=new dn("",{providedIn:"root",factory:()=>j$}),xx=class{},$$=(()=>{let i=class i{constructor(c,f,r){this.doc=c,this.platform=f,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let c=this.doc.cookie||"";return c!==this.lastCookieString&&(this.parseCount++,this.lastToken=hx(c,this.cookieName),this.lastCookieString=c),this.lastToken}};i.\u0275fac=function(f){return new(f||i)(fn(Qr),fn(fl),fn(V$))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})();function G$(o,i){let l=o.url.toLowerCase();if(!bt(Pk)||o.method==="GET"||o.method==="HEAD"||l.startsWith("http://")||l.startsWith("https://"))return i(o);let c=bt(xx).getToken(),f=bt(U$);return c!=null&&!o.headers.has(f)&&(o=o.clone({headers:o.headers.set(f,c)})),i(o)}var Rk=function(o){return o[o.Interceptors=0]="Interceptors",o[o.LegacyInterceptors=1]="LegacyInterceptors",o[o.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",o[o.NoXsrfProtection=3]="NoXsrfProtection",o[o.JsonpSupport=4]="JsonpSupport",o[o.RequestsMadeViaParent=5]="RequestsMadeViaParent",o[o.Fetch=6]="Fetch",o}(Rk||{});function H$(o,i){return{\u0275kind:o,\u0275providers:i}}function zS(...o){let i=[FS,Dk,Ik,{provide:Ng,useExisting:Ik},{provide:gx,useExisting:Dk},{provide:NS,useValue:G$,multi:!0},{provide:Pk,useValue:!0},{provide:xx,useClass:$$}];for(let l of o)i.push(...l.\u0275providers);return Bc(i)}var Mk=new dn("");function q$(){return H$(Rk.LegacyInterceptors,[{provide:Mk,useFactory:F$},{provide:NS,useExisting:Mk,multi:!0}])}var bx=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275mod=cl({type:i}),i.\u0275inj=ll({providers:[zS(q$())]});let o=i;return o})();var jS=class extends ux{constructor(){super(...arguments),this.supportsDOMEvents=!0}},US=class o extends jS{static makeCurrent(){_k(new o)}onAndCancel(i,l,c){return i.addEventListener(l,c),()=>{i.removeEventListener(l,c)}}dispatchEvent(i,l){i.dispatchEvent(l)}remove(i){i.parentNode&&i.parentNode.removeChild(i)}createElement(i,l){return l=l||this.getDefaultDocument(),l.createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,l){return l==="window"?window:l==="document"?i:l==="body"?i.body:null}getBaseHref(i){let l=Z$();return l==null?null:X$(l)}resetBaseElement(){Bg=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return hx(document.cookie,i)}},Bg=null;function Z$(){return Bg=Bg||document.querySelector("base"),Bg?Bg.getAttribute("href"):null}function X$(o){return new URL(o,document.baseURI).pathname}var Y$=(()=>{let i=class i{build(){return new XMLHttpRequest}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),$S=new dn(""),Lk=(()=>{let i=class i{constructor(c,f){this._zone=f,this._eventNameToPlugin=new Map,c.forEach(r=>{r.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,f,r){return this._findPluginFor(f).addEventListener(c,f,r)}getZone(){return this._zone}_findPluginFor(c){let f=this._eventNameToPlugin.get(c);if(f)return f;if(f=this._plugins.find(w=>w.supports(c)),!f)throw new xt(5101,!1);return this._eventNameToPlugin.set(c,f),f}};i.\u0275fac=function(f){return new(f||i)(fn($S),fn(Ar))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),wx=class{constructor(i){this._doc=i}},BS="ng-app-id",Fk=(()=>{let i=class i{constructor(c,f,r,w={}){this.doc=c,this.appId=f,this.nonce=r,this.platformId=w,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=px(w),this.resetHostNodes()}addStyles(c){for(let f of c)this.changeUsageCount(f,1)===1&&this.onStyleAdded(f)}removeStyles(c){for(let f of c)this.changeUsageCount(f,-1)<=0&&this.onStyleRemoved(f)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(f=>f.remove()),c.clear());for(let f of this.getAllStyles())this.onStyleRemoved(f);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let f of this.getAllStyles())this.addStyleToHost(c,f)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let f of this.hostNodes)this.addStyleToHost(f,c)}onStyleRemoved(c){let f=this.styleRef;f.get(c)?.elements?.forEach(r=>r.remove()),f.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${BS}="${this.appId}"]`);if(c?.length){let f=new Map;return c.forEach(r=>{r.textContent!=null&&f.set(r.textContent,r)}),f}return null}changeUsageCount(c,f){let r=this.styleRef;if(r.has(c)){let w=r.get(c);return w.usage+=f,w.usage}return r.set(c,{usage:f,elements:[]}),f}getStyleElement(c,f){let r=this.styleNodesInDOM,w=r?.get(f);if(w?.parentNode===c)return r.delete(f),w.removeAttribute(BS),w;{let C=this.doc.createElement("style");return this.nonce&&C.setAttribute("nonce",this.nonce),C.textContent=f,this.platformIsServer&&C.setAttribute(BS,this.appId),c.appendChild(C),C}}addStyleToHost(c,f){let r=this.getStyleElement(c,f),w=this.styleRef,C=w.get(f)?.elements;C?C.push(r):w.set(f,{elements:[r],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}};i.\u0275fac=function(f){return new(f||i)(fn(Qr),fn(KT),fn(eS,8),fn(fl))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),VS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},HS=/%COMP%/g,Nk="%COMP%",K$=`_nghost-${Nk}`,Q$=`_ngcontent-${Nk}`,J$=!0,eG=new dn("",{providedIn:"root",factory:()=>J$});function tG(o){return Q$.replace(HS,o)}function nG(o){return K$.replace(HS,o)}function zk(o,i){return i.map(l=>l.replace(HS,o))}var Ex=(()=>{let i=class i{constructor(c,f,r,w,C,A,L,U=null){this.eventManager=c,this.sharedStylesHost=f,this.appId=r,this.removeStylesOnCompDestroy=w,this.doc=C,this.platformId=A,this.ngZone=L,this.nonce=U,this.rendererByCompId=new Map,this.platformIsServer=px(A),this.defaultRenderer=new Vg(c,C,L,this.platformIsServer)}createRenderer(c,f){if(!c||!f)return this.defaultRenderer;this.platformIsServer&&f.encapsulation===pa.ShadowDom&&(f=lr(vt({},f),{encapsulation:pa.Emulated}));let r=this.getOrCreateRenderer(c,f);return r instanceof Tx?r.applyToHost(c):r instanceof jg&&r.applyStyles(),r}getOrCreateRenderer(c,f){let r=this.rendererByCompId,w=r.get(f.id);if(!w){let C=this.doc,A=this.ngZone,L=this.eventManager,U=this.sharedStylesHost,Q=this.removeStylesOnCompDestroy,me=this.platformIsServer;switch(f.encapsulation){case pa.Emulated:w=new Tx(L,U,f,this.appId,Q,C,A,me);break;case pa.ShadowDom:return new GS(L,U,c,f,C,A,this.nonce,me);default:w=new jg(L,U,f,Q,C,A,me);break}r.set(f.id,w)}return w}ngOnDestroy(){this.rendererByCompId.clear()}};i.\u0275fac=function(f){return new(f||i)(fn(Lk),fn(Fk),fn(KT),fn(eG),fn(Qr),fn(fl),fn(Ar),fn(eS))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),Vg=class{constructor(i,l,c,f){this.eventManager=i,this.doc=l,this.ngZone=c,this.platformIsServer=f,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(i,l){return l?this.doc.createElementNS(VS[l]||l,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,l){(Ok(i)?i.content:i).appendChild(l)}insertBefore(i,l,c){i&&(Ok(i)?i.content:i).insertBefore(l,c)}removeChild(i,l){i&&i.removeChild(l)}selectRootElement(i,l){let c=typeof i=="string"?this.doc.querySelector(i):i;if(!c)throw new xt(-5104,!1);return l||(c.textContent=""),c}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,l,c,f){if(f){l=f+":"+l;let r=VS[f];r?i.setAttributeNS(r,l,c):i.setAttribute(l,c)}else i.setAttribute(l,c)}removeAttribute(i,l,c){if(c){let f=VS[c];f?i.removeAttributeNS(f,l):i.removeAttribute(`${c}:${l}`)}else i.removeAttribute(l)}addClass(i,l){i.classList.add(l)}removeClass(i,l){i.classList.remove(l)}setStyle(i,l,c,f){f&(_a.DashCase|_a.Important)?i.style.setProperty(l,c,f&_a.Important?"important":""):i.style[l]=c}removeStyle(i,l,c){c&_a.DashCase?i.style.removeProperty(l):i.style[l]=""}setProperty(i,l,c){i!=null&&(i[l]=c)}setValue(i,l){i.nodeValue=l}listen(i,l,c){if(typeof i=="string"&&(i=Zf().getGlobalEventTarget(this.doc,i),!i))throw new Error(`Unsupported event target ${i} for event ${l}`);return this.eventManager.addEventListener(i,l,this.decoratePreventDefault(c))}decoratePreventDefault(i){return l=>{if(l==="__ngUnwrap__")return i;(this.platformIsServer?this.ngZone.runGuarded(()=>i(l)):i(l))===!1&&l.preventDefault()}}};function Ok(o){return o.tagName==="TEMPLATE"&&o.content!==void 0}var GS=class extends Vg{constructor(i,l,c,f,r,w,C,A){super(i,r,w,A),this.sharedStylesHost=l,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let L=zk(f.id,f.styles);for(let U of L){let Q=document.createElement("style");C&&Q.setAttribute("nonce",C),Q.textContent=U,this.shadowRoot.appendChild(Q)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,l){return super.appendChild(this.nodeOrShadowRoot(i),l)}insertBefore(i,l,c){return super.insertBefore(this.nodeOrShadowRoot(i),l,c)}removeChild(i,l){return super.removeChild(this.nodeOrShadowRoot(i),l)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},jg=class extends Vg{constructor(i,l,c,f,r,w,C,A){super(i,r,w,C),this.sharedStylesHost=l,this.removeStylesOnCompDestroy=f,this.styles=A?zk(A,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Tx=class extends jg{constructor(i,l,c,f,r,w,C,A){let L=f+"-"+c.id;super(i,l,c,r,w,C,A,L),this.contentAttr=tG(L),this.hostAttr=nG(L)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,l){let c=super.createElement(i,l);return super.setAttribute(c,this.contentAttr,""),c}},rG=(()=>{let i=class i extends wx{constructor(c){super(c)}supports(c){return!0}addEventListener(c,f,r){return c.addEventListener(f,r,!1),()=>this.removeEventListener(c,f,r)}removeEventListener(c,f,r){return c.removeEventListener(f,r)}};i.\u0275fac=function(f){return new(f||i)(fn(Qr))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),kk=["alt","control","meta","shift"],iG={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},oG={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey},sG=(()=>{let i=class i extends wx{constructor(c){super(c)}supports(c){return i.parseEventName(c)!=null}addEventListener(c,f,r){let w=i.parseEventName(f),C=i.eventCallback(w.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Zf().onAndCancel(c,w.domEventName,C))}static parseEventName(c){let f=c.toLowerCase().split("."),r=f.shift();if(f.length===0||!(r==="keydown"||r==="keyup"))return null;let w=i._normalizeKey(f.pop()),C="",A=f.indexOf("code");if(A>-1&&(f.splice(A,1),C="code."),kk.forEach(U=>{let Q=f.indexOf(U);Q>-1&&(f.splice(Q,1),C+=U+".")}),C+=w,f.length!=0||w.length===0)return null;let L={};return L.domEventName=r,L.fullKey=C,L}static matchEventFullKeyCode(c,f){let r=iG[c.key]||c.key,w="";return f.indexOf("code.")>-1&&(r=c.code,w="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),kk.forEach(C=>{if(C!==r){let A=oG[C];A(c)&&(w+=C+".")}}),w+=r,w===f)}static eventCallback(c,f,r){return w=>{i.matchEventFullKeyCode(w,c)&&r.runGuarded(()=>f(w))}}static _normalizeKey(c){return c==="esc"?"escape":c}};i.\u0275fac=function(f){return new(f||i)(fn(Qr))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})();function Bk(o,i){return lk(vt({rootComponent:o},aG(i)))}function aG(o){return{appProviders:[...dG,...o?.providers??[]],platformProviders:hG}}function lG(){US.makeCurrent()}function cG(){return new Ls}function uG(){return aO(document),document}var hG=[{provide:fl,useValue:wk},{provide:QT,useValue:lG,multi:!0},{provide:Qr,useFactory:uG,deps:[]}];var dG=[{provide:Gv,useValue:"root"},{provide:Ls,useFactory:cG,deps:[]},{provide:$S,useClass:rG,multi:!0,deps:[Qr,Ar,fl]},{provide:$S,useClass:sG,multi:!0,deps:[Qr]},Ex,Fk,Lk,{provide:Ih,useExisting:Ex},{provide:Xf,useClass:Y$,deps:[]},[]];var Vk=(()=>{let i=class i{constructor(c){this._doc=c}getTitle(){return this._doc.title}setTitle(c){this._doc.title=c||""}};i.\u0275fac=function(f){return new(f||i)(fn(Qr))},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Fn="primary",n_=Symbol("RouteTitle"),YS=class{constructor(i){this.params=i||{}}has(i){return Object.prototype.hasOwnProperty.call(this.params,i)}get(i){if(this.has(i)){let l=this.params[i];return Array.isArray(l)?l[0]:l}return null}getAll(i){if(this.has(i)){let l=this.params[i];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}};function rp(o){return new YS(o)}function pG(o,i,l){let c=l.path.split("/");if(c.length>o.length||l.pathMatch==="full"&&(i.hasChildren()||c.length<o.length))return null;let f={};for(let r=0;r<c.length;r++){let w=c[r],C=o[r];if(w.startsWith(":"))f[w.substring(1)]=C;else if(w!==C.path)return null}return{consumed:o.slice(0,c.length),posParams:f}}function mG(o,i){if(o.length!==i.length)return!1;for(let l=0;l<o.length;++l)if(!xa(o[l],i[l]))return!1;return!0}function xa(o,i){let l=o?KS(o):void 0,c=i?KS(i):void 0;if(!l||!c||l.length!=c.length)return!1;let f;for(let r=0;r<l.length;r++)if(f=l[r],!Wk(o[f],i[f]))return!1;return!0}function KS(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function Wk(o,i){if(Array.isArray(o)&&Array.isArray(i)){if(o.length!==i.length)return!1;let l=[...o].sort(),c=[...i].sort();return l.every((f,r)=>c[r]===f)}else return o===i}function Zk(o){return o.length>0?o[o.length-1]:null}function Kc(o){return _E(o)?o:Rg(o)?Yr(Promise.resolve(o)):sn(o)}var gG={exact:Yk,subset:Kk},Xk={exact:_G,subset:yG,ignored:()=>!0};function jk(o,i,l){return gG[l.paths](o.root,i.root,l.matrixParams)&&Xk[l.queryParams](o.queryParams,i.queryParams)&&!(l.fragment==="exact"&&o.fragment!==i.fragment)}function _G(o,i){return xa(o,i)}function Yk(o,i,l){if(!Lh(o.segments,i.segments)||!Ix(o.segments,i.segments,l)||o.numberOfChildren!==i.numberOfChildren)return!1;for(let c in i.children)if(!o.children[c]||!Yk(o.children[c],i.children[c],l))return!1;return!0}function yG(o,i){return Object.keys(i).length<=Object.keys(o).length&&Object.keys(i).every(l=>Wk(o[l],i[l]))}function Kk(o,i,l){return Qk(o,i,i.segments,l)}function Qk(o,i,l,c){if(o.segments.length>l.length){let f=o.segments.slice(0,l.length);return!(!Lh(f,l)||i.hasChildren()||!Ix(f,l,c))}else if(o.segments.length===l.length){if(!Lh(o.segments,l)||!Ix(o.segments,l,c))return!1;for(let f in i.children)if(!o.children[f]||!Kk(o.children[f],i.children[f],c))return!1;return!0}else{let f=l.slice(0,o.segments.length),r=l.slice(o.segments.length);return!Lh(o.segments,f)||!Ix(o.segments,f,c)||!o.children[Fn]?!1:Qk(o.children[Fn],i,r,c)}}function Ix(o,i,l){return i.every((c,f)=>Xk[l](o[f].parameters,c.parameters))}var Zc=class{constructor(i=new gr([],{}),l={},c=null){this.root=i,this.queryParams=l,this.fragment=c}get queryParamMap(){return this._queryParamMap??=rp(this.queryParams),this._queryParamMap}toString(){return bG.serialize(this)}},gr=class{constructor(i,l){this.segments=i,this.children=l,this.parent=null,Object.values(l).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Dx(this)}},kh=class{constructor(i,l){this.path=i,this.parameters=l}get parameterMap(){return this._parameterMap??=rp(this.parameters),this._parameterMap}toString(){return eL(this)}};function vG(o,i){return Lh(o,i)&&o.every((l,c)=>xa(l.parameters,i[c].parameters))}function Lh(o,i){return o.length!==i.length?!1:o.every((l,c)=>l.path===i[c].path)}function xG(o,i){let l=[];return Object.entries(o.children).forEach(([c,f])=>{c===Fn&&(l=l.concat(i(f,c)))}),Object.entries(o.children).forEach(([c,f])=>{c!==Fn&&(l=l.concat(i(f,c)))}),l}var EC=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>new Ax,providedIn:"root"});let o=i;return o})(),Ax=class{parse(i){let l=new JS(i);return new Zc(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(i){let l=`/${Ug(i.root,!0)}`,c=TG(i.queryParams),f=typeof i.fragment=="string"?`#${wG(i.fragment)}`:"";return`${l}${c}${f}`}},bG=new Ax;function Dx(o){return o.segments.map(i=>eL(i)).join("/")}function Ug(o,i){if(!o.hasChildren())return Dx(o);if(i){let l=o.children[Fn]?Ug(o.children[Fn],!1):"",c=[];return Object.entries(o.children).forEach(([f,r])=>{f!==Fn&&c.push(`${f}:${Ug(r,!1)}`)}),c.length>0?`${l}(${c.join("//")})`:l}else{let l=xG(o,(c,f)=>f===Fn?[Ug(o.children[Fn],!1)]:[`${f}:${Ug(c,!1)}`]);return Object.keys(o.children).length===1&&o.children[Fn]!=null?`${Dx(o)}/${l[0]}`:`${Dx(o)}/(${l.join("//")})`}}function Jk(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Sx(o){return Jk(o).replace(/%3B/gi,";")}function wG(o){return encodeURI(o)}function QS(o){return Jk(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Mx(o){return decodeURIComponent(o)}function Uk(o){return Mx(o.replace(/\+/g,"%20"))}function eL(o){return`${QS(o.path)}${EG(o.parameters)}`}function EG(o){return Object.entries(o).map(([i,l])=>`;${QS(i)}=${QS(l)}`).join("")}function TG(o){let i=Object.entries(o).map(([l,c])=>Array.isArray(c)?c.map(f=>`${Sx(l)}=${Sx(f)}`).join("&"):`${Sx(l)}=${Sx(c)}`).filter(l=>l);return i.length?`?${i.join("&")}`:""}var SG=/^[^\/()?;#]+/;function qS(o){let i=o.match(SG);return i?i[0]:""}var CG=/^[^\/()?;=#]+/;function IG(o){let i=o.match(CG);return i?i[0]:""}var DG=/^[^=?&#]+/;function MG(o){let i=o.match(DG);return i?i[0]:""}var AG=/^[^&#]+/;function PG(o){let i=o.match(AG);return i?i[0]:""}var JS=class{constructor(i){this.url=i,this.remaining=i}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new gr([],{}):new gr([],this.parseChildren())}parseQueryParams(){let i={};if(this.consumeOptional("?"))do this.parseQueryParam(i);while(this.consumeOptional("&"));return i}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let i=[];for(this.peekStartsWith("(")||i.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),i.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(i.length>0||Object.keys(l).length>0)&&(c[Fn]=new gr(i,l)),c}parseSegment(){let i=qS(this.remaining);if(i===""&&this.peekStartsWith(";"))throw new xt(4009,!1);return this.capture(i),new kh(Mx(i),this.parseMatrixParams())}parseMatrixParams(){let i={};for(;this.consumeOptional(";");)this.parseParam(i);return i}parseParam(i){let l=IG(this.remaining);if(!l)return;this.capture(l);let c="";if(this.consumeOptional("=")){let f=qS(this.remaining);f&&(c=f,this.capture(c))}i[Mx(l)]=Mx(c)}parseQueryParam(i){let l=MG(this.remaining);if(!l)return;this.capture(l);let c="";if(this.consumeOptional("=")){let w=PG(this.remaining);w&&(c=w,this.capture(c))}let f=Uk(l),r=Uk(c);if(i.hasOwnProperty(f)){let w=i[f];Array.isArray(w)||(w=[w],i[f]=w),w.push(r)}else i[f]=r}parseParens(i){let l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=qS(this.remaining),f=this.remaining[c.length];if(f!=="/"&&f!==")"&&f!==";")throw new xt(4010,!1);let r;c.indexOf(":")>-1?(r=c.slice(0,c.indexOf(":")),this.capture(r),this.capture(":")):i&&(r=Fn);let w=this.parseChildren();l[r]=Object.keys(w).length===1?w[Fn]:new gr([],w),this.consumeOptional("//")}return l}peekStartsWith(i){return this.remaining.startsWith(i)}consumeOptional(i){return this.peekStartsWith(i)?(this.remaining=this.remaining.substring(i.length),!0):!1}capture(i){if(!this.consumeOptional(i))throw new xt(4011,!1)}};function tL(o){return o.segments.length>0?new gr([],{[Fn]:o}):o}function nL(o){let i={};for(let[c,f]of Object.entries(o.children)){let r=nL(f);if(c===Fn&&r.segments.length===0&&r.hasChildren())for(let[w,C]of Object.entries(r.children))i[w]=C;else(r.segments.length>0||r.hasChildren())&&(i[c]=r)}let l=new gr(o.segments,i);return RG(l)}function RG(o){if(o.numberOfChildren===1&&o.children[Fn]){let i=o.children[Fn];return new gr(o.segments.concat(i.segments),i.children)}return o}function ip(o){return o instanceof Zc}function OG(o,i,l=null,c=null){let f=rL(o);return iL(f,i,l,c)}function rL(o){let i;function l(r){let w={};for(let A of r.children){let L=l(A);w[A.outlet]=L}let C=new gr(r.url,w);return r===o&&(i=C),C}let c=l(o.root),f=tL(c);return i??f}function iL(o,i,l,c){let f=o;for(;f.parent;)f=f.parent;if(i.length===0)return WS(f,f,f,l,c);let r=kG(i);if(r.toRoot())return WS(f,f,new gr([],{}),l,c);let w=LG(r,f,o),C=w.processChildren?Hg(w.segmentGroup,w.index,r.commands):sL(w.segmentGroup,w.index,r.commands);return WS(f,w.segmentGroup,C,l,c)}function Px(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function Zg(o){return typeof o=="object"&&o!=null&&o.outlets}function WS(o,i,l,c,f){let r={};c&&Object.entries(c).forEach(([A,L])=>{r[A]=Array.isArray(L)?L.map(U=>`${U}`):`${L}`});let w;o===i?w=l:w=oL(o,i,l);let C=tL(nL(w));return new Zc(C,r,f)}function oL(o,i,l){let c={};return Object.entries(o.children).forEach(([f,r])=>{r===i?c[f]=l:c[f]=oL(r,i,l)}),new gr(o.segments,c)}var Rx=class{constructor(i,l,c){if(this.isAbsolute=i,this.numberOfDoubleDots=l,this.commands=c,i&&c.length>0&&Px(c[0]))throw new xt(4003,!1);let f=c.find(Zg);if(f&&f!==Zk(c))throw new xt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function kG(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new Rx(!0,0,o);let i=0,l=!1,c=o.reduce((f,r,w)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let C={};return Object.entries(r.outlets).forEach(([A,L])=>{C[A]=typeof L=="string"?L.split("/"):L}),[...f,{outlets:C}]}if(r.segmentPath)return[...f,r.segmentPath]}return typeof r!="string"?[...f,r]:w===0?(r.split("/").forEach((C,A)=>{A==0&&C==="."||(A==0&&C===""?l=!0:C===".."?i++:C!=""&&f.push(C))}),f):[...f,r]},[]);return new Rx(l,i,c)}var tp=class{constructor(i,l,c){this.segmentGroup=i,this.processChildren=l,this.index=c}};function LG(o,i,l){if(o.isAbsolute)return new tp(i,!0,0);if(!l)return new tp(i,!1,NaN);if(l.parent===null)return new tp(l,!0,0);let c=Px(o.commands[0])?0:1,f=l.segments.length-1+c;return FG(l,f,o.numberOfDoubleDots)}function FG(o,i,l){let c=o,f=i,r=l;for(;r>f;){if(r-=f,c=c.parent,!c)throw new xt(4005,!1);f=c.segments.length}return new tp(c,!1,f-r)}function NG(o){return Zg(o[0])?o[0].outlets:{[Fn]:o}}function sL(o,i,l){if(o??=new gr([],{}),o.segments.length===0&&o.hasChildren())return Hg(o,i,l);let c=zG(o,i,l),f=l.slice(c.commandIndex);if(c.match&&c.pathIndex<o.segments.length){let r=new gr(o.segments.slice(0,c.pathIndex),{});return r.children[Fn]=new gr(o.segments.slice(c.pathIndex),o.children),Hg(r,0,f)}else return c.match&&f.length===0?new gr(o.segments,{}):c.match&&!o.hasChildren()?eC(o,i,l):c.match?Hg(o,0,f):eC(o,i,l)}function Hg(o,i,l){if(l.length===0)return new gr(o.segments,{});{let c=NG(l),f={};if(Object.keys(c).some(r=>r!==Fn)&&o.children[Fn]&&o.numberOfChildren===1&&o.children[Fn].segments.length===0){let r=Hg(o.children[Fn],i,l);return new gr(o.segments,r.children)}return Object.entries(c).forEach(([r,w])=>{typeof w=="string"&&(w=[w]),w!==null&&(f[r]=sL(o.children[r],i,w))}),Object.entries(o.children).forEach(([r,w])=>{c[r]===void 0&&(f[r]=w)}),new gr(o.segments,f)}}function zG(o,i,l){let c=0,f=i,r={match:!1,pathIndex:0,commandIndex:0};for(;f<o.segments.length;){if(c>=l.length)return r;let w=o.segments[f],C=l[c];if(Zg(C))break;let A=`${C}`,L=c<l.length-1?l[c+1]:null;if(f>0&&A===void 0)break;if(A&&L&&typeof L=="object"&&L.outlets===void 0){if(!Gk(A,L,w))return r;c+=2}else{if(!Gk(A,{},w))return r;c++}f++}return{match:!0,pathIndex:f,commandIndex:c}}function eC(o,i,l){let c=o.segments.slice(0,i),f=0;for(;f<l.length;){let r=l[f];if(Zg(r)){let A=BG(r.outlets);return new gr(c,A)}if(f===0&&Px(l[0])){let A=o.segments[i];c.push(new kh(A.path,$k(l[0]))),f++;continue}let w=Zg(r)?r.outlets[Fn]:`${r}`,C=f<l.length-1?l[f+1]:null;w&&C&&Px(C)?(c.push(new kh(w,$k(C))),f+=2):(c.push(new kh(w,{})),f++)}return new gr(c,{})}function BG(o){let i={};return Object.entries(o).forEach(([l,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(i[l]=eC(new gr([],{}),0,c))}),i}function $k(o){let i={};return Object.entries(o).forEach(([l,c])=>i[l]=`${c}`),i}function Gk(o,i,l){return o==l.path&&xa(i,l.parameters)}var qg="imperative",Ni=function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o}(Ni||{}),ss=class{constructor(i,l){this.id=i,this.url=l}},Xg=class extends ss{constructor(i,l,c="imperative",f=null){super(i,l),this.type=Ni.NavigationStart,this.navigationTrigger=c,this.restoredState=f}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Xc=class extends ss{constructor(i,l,c){super(i,l),this.urlAfterRedirects=c,this.type=Ni.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},zo=function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o}(zo||{}),tC=function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o}(tC||{}),Yc=class extends ss{constructor(i,l,c,f){super(i,l),this.reason=c,this.code=f,this.type=Ni.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Fh=class extends ss{constructor(i,l,c,f){super(i,l),this.reason=c,this.code=f,this.type=Ni.NavigationSkipped}},Yg=class extends ss{constructor(i,l,c,f){super(i,l),this.error=c,this.target=f,this.type=Ni.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Ox=class extends ss{constructor(i,l,c,f){super(i,l),this.urlAfterRedirects=c,this.state=f,this.type=Ni.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nC=class extends ss{constructor(i,l,c,f){super(i,l),this.urlAfterRedirects=c,this.state=f,this.type=Ni.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rC=class extends ss{constructor(i,l,c,f,r){super(i,l),this.urlAfterRedirects=c,this.state=f,this.shouldActivate=r,this.type=Ni.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},iC=class extends ss{constructor(i,l,c,f){super(i,l),this.urlAfterRedirects=c,this.state=f,this.type=Ni.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},oC=class extends ss{constructor(i,l,c,f){super(i,l),this.urlAfterRedirects=c,this.state=f,this.type=Ni.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sC=class{constructor(i){this.route=i,this.type=Ni.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},aC=class{constructor(i){this.route=i,this.type=Ni.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},lC=class{constructor(i){this.snapshot=i,this.type=Ni.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},cC=class{constructor(i){this.snapshot=i,this.type=Ni.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uC=class{constructor(i){this.snapshot=i,this.type=Ni.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hC=class{constructor(i){this.snapshot=i,this.type=Ni.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Kg=class{},Qg=class{constructor(i){this.url=i}};var dC=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new sp,this.attachRef=null}},sp=(()=>{let i=class i{constructor(){this.contexts=new Map}onChildOutletCreated(c,f){let r=this.getOrCreateContext(c);r.outlet=f,this.contexts.set(c,r)}onChildOutletDestroyed(c){let f=this.getContext(c);f&&(f.outlet=null,f.attachRef=null)}onOutletDeactivated(){let c=this.contexts;return this.contexts=new Map,c}onOutletReAttached(c){this.contexts=c}getOrCreateContext(c){let f=this.getContext(c);return f||(f=new dC,this.contexts.set(c,f)),f}getContext(c){return this.contexts.get(c)||null}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),kx=class{constructor(i){this._root=i}get root(){return this._root.value}parent(i){let l=this.pathFromRoot(i);return l.length>1?l[l.length-2]:null}children(i){let l=fC(i,this._root);return l?l.children.map(c=>c.value):[]}firstChild(i){let l=fC(i,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(i){let l=pC(i,this._root);return l.length<2?[]:l[l.length-2].children.map(f=>f.value).filter(f=>f!==i)}pathFromRoot(i){return pC(i,this._root).map(l=>l.value)}};function fC(o,i){if(o===i.value)return i;for(let l of i.children){let c=fC(o,l);if(c)return c}return null}function pC(o,i){if(o===i.value)return[i];for(let l of i.children){let c=pC(o,l);if(c.length)return c.unshift(i),c}return[]}var No=class{constructor(i,l){this.value=i,this.children=l}toString(){return`TreeNode(${this.value})`}};function ep(o){let i={};return o&&o.children.forEach(l=>i[l.value.outlet]=l),i}var Lx=class extends kx{constructor(i,l){super(i),this.snapshot=l,SC(this,i)}toString(){return this.snapshot.toString()}};function aL(o){let i=VG(o),l=new vi([new kh("",{})]),c=new vi({}),f=new vi({}),r=new vi({}),w=new vi(""),C=new Nh(l,c,r,w,f,Fn,o,i.root);return C.snapshot=i.root,new Lx(new No(C,[]),i)}function VG(o){let i={},l={},c={},f="",r=new Jg([],i,c,f,l,Fn,o,null,{});return new Fx("",new No(r,[]))}var Nh=class{constructor(i,l,c,f,r,w,C,A){this.urlSubject=i,this.paramsSubject=l,this.queryParamsSubject=c,this.fragmentSubject=f,this.dataSubject=r,this.outlet=w,this.component=C,this._futureSnapshot=A,this.title=this.dataSubject?.pipe(Ln(L=>L[n_]))??sn(void 0),this.url=i,this.params=l,this.queryParams=c,this.fragment=f,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Ln(i=>rp(i))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Ln(i=>rp(i))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function TC(o,i,l="emptyOnly"){let c,{routeConfig:f}=o;return i!==null&&(l==="always"||f?.path===""||!i.component&&!i.routeConfig?.loadComponent)?c={params:vt(vt({},i.params),o.params),data:vt(vt({},i.data),o.data),resolve:vt(vt(vt(vt({},o.data),i.data),f?.data),o._resolvedData)}:c={params:vt({},o.params),data:vt({},o.data),resolve:vt(vt({},o.data),o._resolvedData??{})},f&&cL(f)&&(c.resolve[n_]=f.title),c}var Jg=class{get title(){return this.data?.[n_]}constructor(i,l,c,f,r,w,C,A,L){this.url=i,this.params=l,this.queryParams=c,this.fragment=f,this.data=r,this.outlet=w,this.component=C,this.routeConfig=A,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=rp(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=rp(this.queryParams),this._queryParamMap}toString(){let i=this.url.map(c=>c.toString()).join("/"),l=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${i}', path:'${l}')`}},Fx=class extends kx{constructor(i,l){super(l),this.url=i,SC(this,l)}toString(){return lL(this._root)}};function SC(o,i){i.value._routerState=o,i.children.forEach(l=>SC(o,l))}function lL(o){let i=o.children.length>0?` { ${o.children.map(lL).join(", ")} } `:"";return`${o.value}${i}`}function ZS(o){if(o.snapshot){let i=o.snapshot,l=o._futureSnapshot;o.snapshot=l,xa(i.queryParams,l.queryParams)||o.queryParamsSubject.next(l.queryParams),i.fragment!==l.fragment&&o.fragmentSubject.next(l.fragment),xa(i.params,l.params)||o.paramsSubject.next(l.params),mG(i.url,l.url)||o.urlSubject.next(l.url),xa(i.data,l.data)||o.dataSubject.next(l.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function mC(o,i){let l=xa(o.params,i.params)&&vG(o.url,i.url),c=!o.parent!=!i.parent;return l&&!c&&(!o.parent||mC(o.parent,i.parent))}function cL(o){return typeof o.title=="string"||o.title===null}var CC=(()=>{let i=class i{constructor(){this.activated=null,this._activatedRoute=null,this.name=Fn,this.activateEvents=new Ji,this.deactivateEvents=new Ji,this.attachEvents=new Ji,this.detachEvents=new Ji,this.parentContexts=bt(sp),this.location=bt(Gf),this.changeDetector=bt(Wf),this.environmentInjector=bt(vo),this.inputBinder=bt(Bx,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(c){if(c.name){let{firstChange:f,previousValue:r}=c.name;if(f)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(c){return this.parentContexts.getContext(c)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let c=this.parentContexts.getContext(this.name);c?.route&&(c.attachRef?this.attach(c.attachRef,c.route):this.activateWith(c.route,c.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new xt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new xt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new xt(4012,!1);this.location.detach();let c=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(c.instance),c}attach(c,f){this.activated=c,this._activatedRoute=f,this.location.insert(c.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(c.instance)}deactivate(){if(this.activated){let c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(c,f){if(this.isActivated)throw new xt(4013,!1);this._activatedRoute=c;let r=this.location,C=c.snapshot.component,A=this.parentContexts.getOrCreateContext(this.name).children,L=new gC(c,A,r.injector);this.activated=r.createComponent(C,{index:r.length,injector:L,environmentInjector:f??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275dir=zc({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Mh]});let o=i;return o})(),gC=class o{__ngOutletInjector(i){return new o(this.route,this.childContexts,i)}constructor(i,l,c){this.route=i,this.childContexts=l,this.parent=c}get(i,l){return i===Nh?this.route:i===sp?this.childContexts:this.parent.get(i,l)}},Bx=new dn(""),Hk=(()=>{let i=class i{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(c){this.unsubscribeFromRouteData(c),this.subscribeToRouteData(c)}unsubscribeFromRouteData(c){this.outletDataSubscriptions.get(c)?.unsubscribe(),this.outletDataSubscriptions.delete(c)}subscribeToRouteData(c){let{activatedRoute:f}=c,r=gg([f.queryParams,f.params,f.data]).pipe(yo(([w,C,A],L)=>(A=vt(vt(vt({},w),C),A),L===0?sn(A):Promise.resolve(A)))).subscribe(w=>{if(!c.isActivated||!c.activatedComponentRef||c.activatedRoute!==f||f.component===null){this.unsubscribeFromRouteData(c);return}let C=ck(f.component);if(!C){this.unsubscribeFromRouteData(c);return}for(let{templateName:A}of C.inputs)c.activatedComponentRef.setInput(A,w[A])});this.outletDataSubscriptions.set(c,r)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})();function jG(o,i,l){let c=e_(o,i._root,l?l._root:void 0);return new Lx(c,i)}function e_(o,i,l){if(l&&o.shouldReuseRoute(i.value,l.value.snapshot)){let c=l.value;c._futureSnapshot=i.value;let f=UG(o,i,l);return new No(c,f)}else{if(o.shouldAttach(i.value)){let r=o.retrieve(i.value);if(r!==null){let w=r.route;return w.value._futureSnapshot=i.value,w.children=i.children.map(C=>e_(o,C)),w}}let c=$G(i.value),f=i.children.map(r=>e_(o,r));return new No(c,f)}}function UG(o,i,l){return i.children.map(c=>{for(let f of l.children)if(o.shouldReuseRoute(c.value,f.value.snapshot))return e_(o,c,f);return e_(o,c)})}function $G(o){return new Nh(new vi(o.url),new vi(o.params),new vi(o.queryParams),new vi(o.fragment),new vi(o.data),o.outlet,o.component,o)}var uL="ngNavigationCancelingError";function hL(o,i){let{redirectTo:l,navigationBehaviorOptions:c}=ip(i)?{redirectTo:i,navigationBehaviorOptions:void 0}:i,f=dL(!1,zo.Redirect);return f.url=l,f.navigationBehaviorOptions=c,f}function dL(o,i){let l=new Error(`NavigationCancelingError: ${o||""}`);return l[uL]=!0,l.cancellationCode=i,l}function GG(o){return fL(o)&&ip(o.url)}function fL(o){return!!o&&o[uL]}var HG=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["ng-component"]],standalone:!0,features:[Nr],decls:1,vars:0,template:function(f,r){f&1&&er(0,"router-outlet")},dependencies:[CC],encapsulation:2});let o=i;return o})();function qG(o,i){return o.providers&&!o._injector&&(o._injector=yS(o.providers,i,`Route: ${o.path}`)),o._injector??i}function IC(o){let i=o.children&&o.children.map(IC),l=i?lr(vt({},o),{children:i}):vt({},o);return!l.component&&!l.loadComponent&&(i||l.loadChildren)&&l.outlet&&l.outlet!==Fn&&(l.component=HG),l}function ba(o){return o.outlet||Fn}function WG(o,i){let l=o.filter(c=>ba(c)===i);return l.push(...o.filter(c=>ba(c)!==i)),l}function r_(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let i=o.parent;i;i=i.parent){let l=i.routeConfig;if(l?._loadedInjector)return l._loadedInjector;if(l?._injector)return l._injector}return null}var ZG=(o,i,l,c)=>Ln(f=>(new _C(i,f.targetRouterState,f.currentRouterState,l,c).activate(o),f)),_C=class{constructor(i,l,c,f,r){this.routeReuseStrategy=i,this.futureState=l,this.currState=c,this.forwardEvent=f,this.inputBindingEnabled=r}activate(i){let l=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,c,i),ZS(this.futureState.root),this.activateChildRoutes(l,c,i)}deactivateChildRoutes(i,l,c){let f=ep(l);i.children.forEach(r=>{let w=r.value.outlet;this.deactivateRoutes(r,f[w],c),delete f[w]}),Object.values(f).forEach(r=>{this.deactivateRouteAndItsChildren(r,c)})}deactivateRoutes(i,l,c){let f=i.value,r=l?l.value:null;if(f===r)if(f.component){let w=c.getContext(f.outlet);w&&this.deactivateChildRoutes(i,l,w.children)}else this.deactivateChildRoutes(i,l,c);else r&&this.deactivateRouteAndItsChildren(l,c)}deactivateRouteAndItsChildren(i,l){i.value.component&&this.routeReuseStrategy.shouldDetach(i.value.snapshot)?this.detachAndStoreRouteSubtree(i,l):this.deactivateRouteAndOutlet(i,l)}detachAndStoreRouteSubtree(i,l){let c=l.getContext(i.value.outlet),f=c&&i.value.component?c.children:l,r=ep(i);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,f);if(c&&c.outlet){let w=c.outlet.detach(),C=c.children.onOutletDeactivated();this.routeReuseStrategy.store(i.value.snapshot,{componentRef:w,route:i,contexts:C})}}deactivateRouteAndOutlet(i,l){let c=l.getContext(i.value.outlet),f=c&&i.value.component?c.children:l,r=ep(i);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,f);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(i,l,c){let f=ep(l);i.children.forEach(r=>{this.activateRoutes(r,f[r.value.outlet],c),this.forwardEvent(new hC(r.value.snapshot))}),i.children.length&&this.forwardEvent(new cC(i.value.snapshot))}activateRoutes(i,l,c){let f=i.value,r=l?l.value:null;if(ZS(f),f===r)if(f.component){let w=c.getOrCreateContext(f.outlet);this.activateChildRoutes(i,l,w.children)}else this.activateChildRoutes(i,l,c);else if(f.component){let w=c.getOrCreateContext(f.outlet);if(this.routeReuseStrategy.shouldAttach(f.snapshot)){let C=this.routeReuseStrategy.retrieve(f.snapshot);this.routeReuseStrategy.store(f.snapshot,null),w.children.onOutletReAttached(C.contexts),w.attachRef=C.componentRef,w.route=C.route.value,w.outlet&&w.outlet.attach(C.componentRef,C.route.value),ZS(C.route.value),this.activateChildRoutes(i,null,w.children)}else{let C=r_(f.snapshot);w.attachRef=null,w.route=f,w.injector=C,w.outlet&&w.outlet.activateWith(f,w.injector),this.activateChildRoutes(i,null,w.children)}}else this.activateChildRoutes(i,null,c)}},Nx=class{constructor(i){this.path=i,this.route=this.path[this.path.length-1]}},np=class{constructor(i,l){this.component=i,this.route=l}};function XG(o,i,l){let c=o._root,f=i?i._root:null;return $g(c,f,l,[c.value])}function YG(o){let i=o.routeConfig?o.routeConfig.canActivateChild:null;return!i||i.length===0?null:{node:o,guards:i}}function ap(o,i){let l=Symbol(),c=i.get(o,l);return c===l?typeof o=="function"&&!WP(o)?o:i.get(o):c}function $g(o,i,l,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let r=ep(i);return o.children.forEach(w=>{KG(w,r[w.value.outlet],l,c.concat([w.value]),f),delete r[w.value.outlet]}),Object.entries(r).forEach(([w,C])=>Wg(C,l.getContext(w),f)),f}function KG(o,i,l,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let r=o.value,w=i?i.value:null,C=l?l.getContext(o.value.outlet):null;if(w&&r.routeConfig===w.routeConfig){let A=QG(w,r,r.routeConfig.runGuardsAndResolvers);A?f.canActivateChecks.push(new Nx(c)):(r.data=w.data,r._resolvedData=w._resolvedData),r.component?$g(o,i,C?C.children:null,c,f):$g(o,i,l,c,f),A&&C&&C.outlet&&C.outlet.isActivated&&f.canDeactivateChecks.push(new np(C.outlet.component,w))}else w&&Wg(i,C,f),f.canActivateChecks.push(new Nx(c)),r.component?$g(o,null,C?C.children:null,c,f):$g(o,null,l,c,f);return f}function QG(o,i,l){if(typeof l=="function")return l(o,i);switch(l){case"pathParamsChange":return!Lh(o.url,i.url);case"pathParamsOrQueryParamsChange":return!Lh(o.url,i.url)||!xa(o.queryParams,i.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!mC(o,i)||!xa(o.queryParams,i.queryParams);case"paramsChange":default:return!mC(o,i)}}function Wg(o,i,l){let c=ep(o),f=o.value;Object.entries(c).forEach(([r,w])=>{f.component?i?Wg(w,i.children.getContext(r),l):Wg(w,null,l):Wg(w,i,l)}),f.component?i&&i.outlet&&i.outlet.isActivated?l.canDeactivateChecks.push(new np(i.outlet.component,f)):l.canDeactivateChecks.push(new np(null,f)):l.canDeactivateChecks.push(new np(null,f))}function i_(o){return typeof o=="function"}function JG(o){return typeof o=="boolean"}function eH(o){return o&&i_(o.canLoad)}function tH(o){return o&&i_(o.canActivate)}function nH(o){return o&&i_(o.canActivateChild)}function rH(o){return o&&i_(o.canDeactivate)}function iH(o){return o&&i_(o.canMatch)}function pL(o){return o instanceof sl||o?.name==="EmptyError"}var Cx=Symbol("INITIAL_VALUE");function op(){return yo(o=>gg(o.map(i=>i.pipe(al(1),TE(Cx)))).pipe(Ln(i=>{for(let l of i)if(l!==!0){if(l===Cx)return Cx;if(l===!1||l instanceof Zc)return l}return!0}),Lo(i=>i!==Cx),al(1)))}function oH(o,i){return xi(l=>{let{targetSnapshot:c,currentSnapshot:f,guards:{canActivateChecks:r,canDeactivateChecks:w}}=l;return w.length===0&&r.length===0?sn(lr(vt({},l),{guardsResult:!0})):sH(w,c,f,o).pipe(xi(C=>C&&JG(C)?aH(c,r,o,i):sn(C)),Ln(C=>lr(vt({},l),{guardsResult:C})))})}function sH(o,i,l,c){return Yr(o).pipe(xi(f=>dH(f.component,f.route,l,i,c)),ha(f=>f!==!0,!0))}function aH(o,i,l,c){return Yr(i).pipe(Ac(f=>wf(cH(f.route.parent,c),lH(f.route,c),hH(o,f.path,l),uH(o,f.route,l))),ha(f=>f!==!0,!0))}function lH(o,i){return o!==null&&i&&i(new uC(o)),sn(!0)}function cH(o,i){return o!==null&&i&&i(new lC(o)),sn(!0)}function uH(o,i,l){let c=i.routeConfig?i.routeConfig.canActivate:null;if(!c||c.length===0)return sn(!0);let f=c.map(r=>hv(()=>{let w=r_(i)??l,C=ap(r,w),A=tH(C)?C.canActivate(i,o):Fs(w,()=>C(i,o));return Kc(A).pipe(ha())}));return sn(f).pipe(op())}function hH(o,i,l){let c=i[i.length-1],r=i.slice(0,i.length-1).reverse().map(w=>YG(w)).filter(w=>w!==null).map(w=>hv(()=>{let C=w.guards.map(A=>{let L=r_(w.node)??l,U=ap(A,L),Q=nH(U)?U.canActivateChild(c,o):Fs(L,()=>U(c,o));return Kc(Q).pipe(ha())});return sn(C).pipe(op())}));return sn(r).pipe(op())}function dH(o,i,l,c,f){let r=i&&i.routeConfig?i.routeConfig.canDeactivate:null;if(!r||r.length===0)return sn(!0);let w=r.map(C=>{let A=r_(i)??f,L=ap(C,A),U=rH(L)?L.canDeactivate(o,i,l,c):Fs(A,()=>L(o,i,l,c));return Kc(U).pipe(ha())});return sn(w).pipe(op())}function fH(o,i,l,c){let f=i.canLoad;if(f===void 0||f.length===0)return sn(!0);let r=f.map(w=>{let C=ap(w,o),A=eH(C)?C.canLoad(i,l):Fs(o,()=>C(i,l));return Kc(A)});return sn(r).pipe(op(),mL(c))}function mL(o){return fE(si(i=>{if(ip(i))throw hL(o,i)}),Ln(i=>i===!0))}function pH(o,i,l,c){let f=i.canMatch;if(!f||f.length===0)return sn(!0);let r=f.map(w=>{let C=ap(w,o),A=iH(C)?C.canMatch(i,l):Fs(o,()=>C(i,l));return Kc(A)});return sn(r).pipe(op(),mL(c))}var t_=class{constructor(i){this.segmentGroup=i||null}},zx=class extends Error{constructor(i){super(),this.urlTree=i}};function Jf(o){return ol(new t_(o))}function mH(o){return ol(new xt(4e3,!1))}function gH(o){return ol(dL(!1,zo.GuardRejected))}var yC=class{constructor(i,l){this.urlSerializer=i,this.urlTree=l}lineralizeSegments(i,l){let c=[],f=l.root;for(;;){if(c=c.concat(f.segments),f.numberOfChildren===0)return sn(c);if(f.numberOfChildren>1||!f.children[Fn])return mH(i.redirectTo);f=f.children[Fn]}}applyRedirectCommands(i,l,c){let f=this.applyRedirectCreateUrlTree(l,this.urlSerializer.parse(l),i,c);if(l.startsWith("/"))throw new zx(f);return f}applyRedirectCreateUrlTree(i,l,c,f){let r=this.createSegmentGroup(i,l.root,c,f);return new Zc(r,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(i,l){let c={};return Object.entries(i).forEach(([f,r])=>{if(typeof r=="string"&&r.startsWith(":")){let C=r.substring(1);c[f]=l[C]}else c[f]=r}),c}createSegmentGroup(i,l,c,f){let r=this.createSegments(i,l.segments,c,f),w={};return Object.entries(l.children).forEach(([C,A])=>{w[C]=this.createSegmentGroup(i,A,c,f)}),new gr(r,w)}createSegments(i,l,c,f){return l.map(r=>r.path.startsWith(":")?this.findPosParam(i,r,f):this.findOrReturn(r,c))}findPosParam(i,l,c){let f=c[l.path.substring(1)];if(!f)throw new xt(4001,!1);return f}findOrReturn(i,l){let c=0;for(let f of l){if(f.path===i.path)return l.splice(c),f;c++}return i}},vC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function _H(o,i,l,c,f){let r=DC(o,i,l);return r.matched?(c=qG(i,c),pH(c,i,l,f).pipe(Ln(w=>w===!0?r:vt({},vC)))):sn(r)}function DC(o,i,l){if(i.path==="**")return yH(l);if(i.path==="")return i.pathMatch==="full"&&(o.hasChildren()||l.length>0)?vt({},vC):{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};let f=(i.matcher||pG)(l,o,i);if(!f)return vt({},vC);let r={};Object.entries(f.posParams??{}).forEach(([C,A])=>{r[C]=A.path});let w=f.consumed.length>0?vt(vt({},r),f.consumed[f.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:f.consumed,remainingSegments:l.slice(f.consumed.length),parameters:w,positionalParamSegments:f.posParams??{}}}function yH(o){return{matched:!0,parameters:o.length>0?Zk(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function qk(o,i,l,c){return l.length>0&&bH(o,l,c)?{segmentGroup:new gr(i,xH(c,new gr(l,o.children))),slicedSegments:[]}:l.length===0&&wH(o,l,c)?{segmentGroup:new gr(o.segments,vH(o,l,c,o.children)),slicedSegments:l}:{segmentGroup:new gr(o.segments,o.children),slicedSegments:l}}function vH(o,i,l,c){let f={};for(let r of l)if(Vx(o,i,r)&&!c[ba(r)]){let w=new gr([],{});f[ba(r)]=w}return vt(vt({},c),f)}function xH(o,i){let l={};l[Fn]=i;for(let c of o)if(c.path===""&&ba(c)!==Fn){let f=new gr([],{});l[ba(c)]=f}return l}function bH(o,i,l){return l.some(c=>Vx(o,i,c)&&ba(c)!==Fn)}function wH(o,i,l){return l.some(c=>Vx(o,i,c))}function Vx(o,i,l){return(o.hasChildren()||i.length>0)&&l.pathMatch==="full"?!1:l.path===""}function EH(o,i,l,c){return ba(o)!==c&&(c===Fn||!Vx(i,l,o))?!1:DC(i,o,l).matched}function TH(o,i,l){return i.length===0&&!o.children[l]}var xC=class{};function SH(o,i,l,c,f,r,w="emptyOnly"){return new bC(o,i,l,c,f,w,r).recognize()}var CH=31,bC=class{constructor(i,l,c,f,r,w,C){this.injector=i,this.configLoader=l,this.rootComponentType=c,this.config=f,this.urlTree=r,this.paramsInheritanceStrategy=w,this.urlSerializer=C,this.applyRedirects=new yC(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(i){return new xt(4002,`'${i.segmentGroup}'`)}recognize(){let i=qk(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(i).pipe(Ln(l=>{let c=new Jg([],Object.freeze({}),Object.freeze(vt({},this.urlTree.queryParams)),this.urlTree.fragment,{},Fn,this.rootComponentType,null,{}),f=new No(c,l),r=new Fx("",f),w=OG(c,[],this.urlTree.queryParams,this.urlTree.fragment);return w.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(w),this.inheritParamsAndData(r._root,null),{state:r,tree:w}}))}match(i){return this.processSegmentGroup(this.injector,this.config,i,Fn).pipe(ca(c=>{if(c instanceof zx)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof t_?this.noMatchError(c):c}))}inheritParamsAndData(i,l){let c=i.value,f=TC(c,l,this.paramsInheritanceStrategy);c.params=Object.freeze(f.params),c.data=Object.freeze(f.data),i.children.forEach(r=>this.inheritParamsAndData(r,c))}processSegmentGroup(i,l,c,f){return c.segments.length===0&&c.hasChildren()?this.processChildren(i,l,c):this.processSegment(i,l,c,c.segments,f,!0).pipe(Ln(r=>r instanceof No?[r]:[]))}processChildren(i,l,c){let f=[];for(let r of Object.keys(c.children))r==="primary"?f.unshift(r):f.push(r);return Yr(f).pipe(Ac(r=>{let w=c.children[r],C=WG(l,r);return this.processSegmentGroup(i,C,w,r)}),bE((r,w)=>(r.push(...w),r)),Pc(null),xE(),xi(r=>{if(r===null)return Jf(c);let w=gL(r);return IH(w),sn(w)}))}processSegment(i,l,c,f,r,w){return Yr(l).pipe(Ac(C=>this.processSegmentAgainstRoute(C._injector??i,l,C,c,f,r,w).pipe(ca(A=>{if(A instanceof t_)return sn(null);throw A}))),ha(C=>!!C),ca(C=>{if(pL(C))return TH(c,f,r)?sn(new xC):Jf(c);throw C}))}processSegmentAgainstRoute(i,l,c,f,r,w,C){return EH(c,f,r,w)?c.redirectTo===void 0?this.matchSegmentAgainstRoute(i,f,c,r,w):this.allowRedirects&&C?this.expandSegmentAgainstRouteUsingRedirect(i,f,l,c,r,w):Jf(f):Jf(f)}expandSegmentAgainstRouteUsingRedirect(i,l,c,f,r,w){let{matched:C,consumedSegments:A,positionalParamSegments:L,remainingSegments:U}=DC(l,f,r);if(!C)return Jf(l);f.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>CH&&(this.allowRedirects=!1));let Q=this.applyRedirects.applyRedirectCommands(A,f.redirectTo,L);return this.applyRedirects.lineralizeSegments(f,Q).pipe(xi(me=>this.processSegment(i,c,l,me.concat(U),w,!1)))}matchSegmentAgainstRoute(i,l,c,f,r){let w=_H(l,c,f,i,this.urlSerializer);return c.path==="**"&&(l.children={}),w.pipe(yo(C=>C.matched?(i=c._injector??i,this.getChildConfig(i,c,f).pipe(yo(({routes:A})=>{let L=c._loadedInjector??i,{consumedSegments:U,remainingSegments:Q,parameters:me}=C,he=new Jg(U,me,Object.freeze(vt({},this.urlTree.queryParams)),this.urlTree.fragment,MH(c),ba(c),c.component??c._loadedComponent??null,c,AH(c)),{segmentGroup:be,slicedSegments:Ie}=qk(l,U,Q,A);if(Ie.length===0&&be.hasChildren())return this.processChildren(L,A,be).pipe(Ln(ze=>ze===null?null:new No(he,ze)));if(A.length===0&&Ie.length===0)return sn(new No(he,[]));let Qe=ba(c)===r;return this.processSegment(L,A,be,Ie,Qe?Fn:r,!0).pipe(Ln(ze=>new No(he,ze instanceof No?[ze]:[])))}))):Jf(l)))}getChildConfig(i,l,c){return l.children?sn({routes:l.children,injector:i}):l.loadChildren?l._loadedRoutes!==void 0?sn({routes:l._loadedRoutes,injector:l._loadedInjector}):fH(i,l,c,this.urlSerializer).pipe(xi(f=>f?this.configLoader.loadChildren(i,l).pipe(si(r=>{l._loadedRoutes=r.routes,l._loadedInjector=r.injector})):gH(l))):sn({routes:[],injector:i})}};function IH(o){o.sort((i,l)=>i.value.outlet===Fn?-1:l.value.outlet===Fn?1:i.value.outlet.localeCompare(l.value.outlet))}function DH(o){let i=o.value.routeConfig;return i&&i.path===""}function gL(o){let i=[],l=new Set;for(let c of o){if(!DH(c)){i.push(c);continue}let f=i.find(r=>c.value.routeConfig===r.value.routeConfig);f!==void 0?(f.children.push(...c.children),l.add(f)):i.push(c)}for(let c of l){let f=gL(c.children);i.push(new No(c.value,f))}return i.filter(c=>!l.has(c))}function MH(o){return o.data||{}}function AH(o){return o.resolve||{}}function PH(o,i,l,c,f,r){return xi(w=>SH(o,i,l,c,w.extractedUrl,f,r).pipe(Ln(({state:C,tree:A})=>lr(vt({},w),{targetSnapshot:C,urlAfterRedirects:A}))))}function RH(o,i){return xi(l=>{let{targetSnapshot:c,guards:{canActivateChecks:f}}=l;if(!f.length)return sn(l);let r=new Set(f.map(A=>A.route)),w=new Set;for(let A of r)if(!w.has(A))for(let L of _L(A))w.add(L);let C=0;return Yr(w).pipe(Ac(A=>r.has(A)?OH(A,c,o,i):(A.data=TC(A,A.parent,o).resolve,sn(void 0))),si(()=>C++),Ef(1),xi(A=>C===w.size?sn(l):ko))})}function _L(o){let i=o.children.map(l=>_L(l)).flat();return[o,...i]}function OH(o,i,l,c){let f=o.routeConfig,r=o._resolve;return f?.title!==void 0&&!cL(f)&&(r[n_]=f.title),kH(r,o,i,c).pipe(Ln(w=>(o._resolvedData=w,o.data=TC(o,o.parent,l).resolve,null)))}function kH(o,i,l,c){let f=KS(o);if(f.length===0)return sn({});let r={};return Yr(f).pipe(xi(w=>LH(o[w],i,l,c).pipe(ha(),si(C=>{r[w]=C}))),Ef(1),vE(r),ca(w=>pL(w)?ko:ol(w)))}function LH(o,i,l,c){let f=r_(i)??c,r=ap(o,f),w=r.resolve?r.resolve(i,l):Fs(f,()=>r(i,l));return Kc(w)}function XS(o){return yo(i=>{let l=o(i);return l?Yr(l).pipe(Ln(()=>i)):sn(i)})}var yL=(()=>{let i=class i{buildTitle(c){let f,r=c.root;for(;r!==void 0;)f=this.getResolvedTitleForRoute(r)??f,r=r.children.find(w=>w.outlet===Fn);return f}getResolvedTitleForRoute(c){return c.data[n_]}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>bt(FH),providedIn:"root"});let o=i;return o})(),FH=(()=>{let i=class i extends yL{constructor(c){super(),this.title=c}updateTitle(c){let f=this.buildTitle(c);f!==void 0&&this.title.setTitle(f)}};i.\u0275fac=function(f){return new(f||i)(fn(Vk))},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),MC=new dn("",{providedIn:"root",factory:()=>({})}),AC=new dn(""),NH=(()=>{let i=class i{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=bt(CS)}loadComponent(c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return sn(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let f=Kc(c.loadComponent()).pipe(Ln(vL),si(w=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=w}),ua(()=>{this.componentLoaders.delete(c)})),r=new bf(f,()=>new Ai).pipe(xf());return this.componentLoaders.set(c,r),r}loadChildren(c,f){if(this.childrenLoaders.get(f))return this.childrenLoaders.get(f);if(f._loadedRoutes)return sn({routes:f._loadedRoutes,injector:f._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(f);let w=zH(f,this.compiler,c,this.onLoadEndListener).pipe(ua(()=>{this.childrenLoaders.delete(f)})),C=new bf(w,()=>new Ai).pipe(xf());return this.childrenLoaders.set(f,C),C}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function zH(o,i,l,c){return Kc(o.loadChildren()).pipe(Ln(vL),xi(f=>f instanceof Cg||Array.isArray(f)?sn(f):Yr(i.compileModuleAsync(f))),Ln(f=>{c&&c(o);let r,w,C=!1;return Array.isArray(f)?(w=f,C=!0):(r=f.create(l).injector,w=r.get(AC,[],{optional:!0,self:!0}).flat()),{routes:w.map(IC),injector:r}}))}function BH(o){return o&&typeof o=="object"&&"default"in o}function vL(o){return BH(o)?o.default:o}var PC=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>bt(VH),providedIn:"root"});let o=i;return o})(),VH=(()=>{let i=class i{shouldProcessUrl(c){return!0}extract(c){return c}merge(c,f){return c}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),xL=new dn(""),bL=new dn("");function jH(o,i,l){let c=o.get(bL),f=o.get(Qr);return o.get(Ar).runOutsideAngular(()=>{if(!f.startViewTransition||c.skipNextTransition)return c.skipNextTransition=!1,new Promise(L=>setTimeout(L));let r,w=new Promise(L=>{r=L}),C=f.startViewTransition(()=>(r(),UH(o))),{onViewTransitionCreated:A}=c;return A&&Fs(o,()=>A({transition:C,from:i,to:l})),w})}function UH(o){return new Promise(i=>{mS(i,{injector:o})})}var $H=(()=>{let i=class i{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ai,this.transitionAbortSubject=new Ai,this.configLoader=bt(NH),this.environmentInjector=bt(vo),this.urlSerializer=bt(EC),this.rootContexts=bt(sp),this.location=bt(Lg),this.inputBindingEnabled=bt(Bx,{optional:!0})!==null,this.titleStrategy=bt(yL),this.options=bt(MC,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=bt(PC),this.createViewTransition=bt(xL,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>sn(void 0),this.rootComponentType=null;let c=r=>this.events.next(new sC(r)),f=r=>this.events.next(new aC(r));this.configLoader.onLoadEndListener=f,this.configLoader.onLoadStartListener=c}complete(){this.transitions?.complete()}handleNavigationRequest(c){let f=++this.navigationId;this.transitions?.next(lr(vt(vt({},this.transitions.value),c),{id:f}))}setupNavigations(c,f,r){return this.transitions=new vi({id:0,currentUrlTree:f,currentRawUrl:f,extractedUrl:this.urlHandlingStrategy.extract(f),urlAfterRedirects:this.urlHandlingStrategy.extract(f),rawUrl:f,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:qg,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Lo(w=>w.id!==0),Ln(w=>lr(vt({},w),{extractedUrl:this.urlHandlingStrategy.extract(w.rawUrl)})),yo(w=>{let C=!1,A=!1;return sn(w).pipe(yo(L=>{if(this.navigationId>w.id)return this.cancelNavigationTransition(w,"",zo.SupersededByNewNavigation),ko;this.currentTransition=w,this.currentNavigation={id:L.id,initialUrl:L.rawUrl,extractedUrl:L.extractedUrl,trigger:L.source,extras:L.extras,previousNavigation:this.lastSuccessfulNavigation?lr(vt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let U=!c.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Q=L.extras.onSameUrlNavigation??c.onSameUrlNavigation;if(!U&&Q!=="reload"){let me="";return this.events.next(new Fh(L.id,this.urlSerializer.serialize(L.rawUrl),me,tC.IgnoredSameUrlNavigation)),L.resolve(null),ko}if(this.urlHandlingStrategy.shouldProcessUrl(L.rawUrl))return sn(L).pipe(yo(me=>{let he=this.transitions?.getValue();return this.events.next(new Xg(me.id,this.urlSerializer.serialize(me.extractedUrl),me.source,me.restoredState)),he!==this.transitions?.getValue()?ko:Promise.resolve(me)}),PH(this.environmentInjector,this.configLoader,this.rootComponentType,c.config,this.urlSerializer,this.paramsInheritanceStrategy),si(me=>{w.targetSnapshot=me.targetSnapshot,w.urlAfterRedirects=me.urlAfterRedirects,this.currentNavigation=lr(vt({},this.currentNavigation),{finalUrl:me.urlAfterRedirects});let he=new Ox(me.id,this.urlSerializer.serialize(me.extractedUrl),this.urlSerializer.serialize(me.urlAfterRedirects),me.targetSnapshot);this.events.next(he)}));if(U&&this.urlHandlingStrategy.shouldProcessUrl(L.currentRawUrl)){let{id:me,extractedUrl:he,source:be,restoredState:Ie,extras:Qe}=L,ze=new Xg(me,this.urlSerializer.serialize(he),be,Ie);this.events.next(ze);let nt=aL(this.rootComponentType).snapshot;return this.currentTransition=w=lr(vt({},L),{targetSnapshot:nt,urlAfterRedirects:he,extras:lr(vt({},Qe),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=he,sn(w)}else{let me="";return this.events.next(new Fh(L.id,this.urlSerializer.serialize(L.extractedUrl),me,tC.IgnoredByUrlHandlingStrategy)),L.resolve(null),ko}}),si(L=>{let U=new nC(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(U)}),Ln(L=>(this.currentTransition=w=lr(vt({},L),{guards:XG(L.targetSnapshot,L.currentSnapshot,this.rootContexts)}),w)),oH(this.environmentInjector,L=>this.events.next(L)),si(L=>{if(w.guardsResult=L.guardsResult,ip(L.guardsResult))throw hL(this.urlSerializer,L.guardsResult);let U=new rC(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot,!!L.guardsResult);this.events.next(U)}),Lo(L=>L.guardsResult?!0:(this.cancelNavigationTransition(L,"",zo.GuardRejected),!1)),XS(L=>{if(L.guards.canActivateChecks.length)return sn(L).pipe(si(U=>{let Q=new iC(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(Q)}),yo(U=>{let Q=!1;return sn(U).pipe(RH(this.paramsInheritanceStrategy,this.environmentInjector),si({next:()=>Q=!0,complete:()=>{Q||this.cancelNavigationTransition(U,"",zo.NoDataFromResolver)}}))}),si(U=>{let Q=new oC(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(Q)}))}),XS(L=>{let U=Q=>{let me=[];Q.routeConfig?.loadComponent&&!Q.routeConfig._loadedComponent&&me.push(this.configLoader.loadComponent(Q.routeConfig).pipe(si(he=>{Q.component=he}),Ln(()=>{})));for(let he of Q.children)me.push(...U(he));return me};return gg(U(L.targetSnapshot.root)).pipe(Pc(null),al(1))}),XS(()=>this.afterPreactivation()),yo(()=>{let{currentSnapshot:L,targetSnapshot:U}=w,Q=this.createViewTransition?.(this.environmentInjector,L.root,U.root);return Q?Yr(Q).pipe(Ln(()=>w)):sn(w)}),Ln(L=>{let U=jG(c.routeReuseStrategy,L.targetSnapshot,L.currentRouterState);return this.currentTransition=w=lr(vt({},L),{targetRouterState:U}),this.currentNavigation.targetRouterState=U,w}),si(()=>{this.events.next(new Kg)}),ZG(this.rootContexts,c.routeReuseStrategy,L=>this.events.next(L),this.inputBindingEnabled),al(1),si({next:L=>{C=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Xc(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects))),this.titleStrategy?.updateTitle(L.targetRouterState.snapshot),L.resolve(!0)},complete:()=>{C=!0}}),SE(this.transitionAbortSubject.pipe(si(L=>{throw L}))),ua(()=>{!C&&!A&&this.cancelNavigationTransition(w,"",zo.SupersededByNewNavigation),this.currentTransition?.id===w.id&&(this.currentNavigation=null,this.currentTransition=null)}),ca(L=>{if(A=!0,fL(L))this.events.next(new Yc(w.id,this.urlSerializer.serialize(w.extractedUrl),L.message,L.cancellationCode)),GG(L)?this.events.next(new Qg(L.url)):w.resolve(!1);else{this.events.next(new Yg(w.id,this.urlSerializer.serialize(w.extractedUrl),L,w.targetSnapshot??void 0));try{w.resolve(c.errorHandler(L))}catch(U){this.options.resolveNavigationPromiseOnError?w.resolve(!1):w.reject(U)}}return ko}))}))}cancelNavigationTransition(c,f,r){let w=new Yc(c.id,this.urlSerializer.serialize(c.extractedUrl),f,r);this.events.next(w),c.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function GH(o){return o!==qg}var HH=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>bt(qH),providedIn:"root"});let o=i;return o})(),wC=class{shouldDetach(i){return!1}store(i,l){}shouldAttach(i){return!1}retrieve(i){return null}shouldReuseRoute(i,l){return i.routeConfig===l.routeConfig}},qH=(()=>{let i=class i extends wC{};i.\u0275fac=(()=>{let c;return function(r){return(c||(c=XT(i)))(r||i)}})(),i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),wL=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:()=>bt(WH),providedIn:"root"});let o=i;return o})(),WH=(()=>{let i=class i extends wL{constructor(){super(...arguments),this.location=bt(Lg),this.urlSerializer=bt(EC),this.options=bt(MC,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=bt(PC),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Zc,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=aL(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(c){return this.location.subscribe(f=>{f.type==="popstate"&&c(f.url,f.state)})}handleRouterEvent(c,f){if(c instanceof Xg)this.stateMemento=this.createStateMemento();else if(c instanceof Fh)this.rawUrlTree=f.initialUrl;else if(c instanceof Ox){if(this.urlUpdateStrategy==="eager"&&!f.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl);this.setBrowserUrl(r,f)}}else c instanceof Kg?(this.currentUrlTree=f.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl),this.routerState=f.targetRouterState,this.urlUpdateStrategy==="deferred"&&(f.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,f))):c instanceof Yc&&(c.code===zo.GuardRejected||c.code===zo.NoDataFromResolver)?this.restoreHistory(f):c instanceof Yg?this.restoreHistory(f,!0):c instanceof Xc&&(this.lastSuccessfulId=c.id,this.currentPageId=this.browserPageId)}setBrowserUrl(c,f){let r=this.urlSerializer.serialize(c);if(this.location.isCurrentPathEqualTo(r)||f.extras.replaceUrl){let w=this.browserPageId,C=vt(vt({},f.extras.state),this.generateNgRouterState(f.id,w));this.location.replaceState(r,"",C)}else{let w=vt(vt({},f.extras.state),this.generateNgRouterState(f.id,this.browserPageId+1));this.location.go(r,"",w)}}restoreHistory(c,f=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,w=this.currentPageId-r;w!==0?this.location.historyGo(w):this.currentUrlTree===c.finalUrl&&w===0&&(this.resetState(c),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(f&&this.resetState(c),this.resetUrlToCurrentUrlTree())}resetState(c){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,c.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(c,f){return this.canceledNavigationResolution==="computed"?{navigationId:c,\u0275routerPageId:f}:{navigationId:c}}};i.\u0275fac=(()=>{let c;return function(r){return(c||(c=XT(i)))(r||i)}})(),i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),Gg=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(Gg||{});function ZH(o,i){o.events.pipe(Lo(l=>l instanceof Xc||l instanceof Yc||l instanceof Yg||l instanceof Fh),Ln(l=>l instanceof Xc||l instanceof Fh?Gg.COMPLETE:(l instanceof Yc?l.code===zo.Redirect||l.code===zo.SupersededByNewNavigation:!1)?Gg.REDIRECTING:Gg.FAILED),Lo(l=>l!==Gg.REDIRECTING),al(1)).subscribe(()=>{i()})}function XH(o){throw o}var YH={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},KH={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},o_=(()=>{let i=class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=bt(lx),this.stateManager=bt(wL),this.options=bt(MC,{optional:!0})||{},this.pendingTasks=bt(Gc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=bt($H),this.urlSerializer=bt(EC),this.location=bt(Lg),this.urlHandlingStrategy=bt(PC),this._events=new Ai,this.errorHandler=this.options.errorHandler||XH,this.navigated=!1,this.routeReuseStrategy=bt(HH),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=bt(AC,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!bt(Bx,{optional:!0}),this.eventsSubscription=new yi,this.isNgZoneEnabled=bt(Ar)instanceof Ar&&Ar.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:c=>{this.console.warn(c)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let c=this.navigationTransitions.events.subscribe(f=>{try{let r=this.navigationTransitions.currentTransition,w=this.navigationTransitions.currentNavigation;if(r!==null&&w!==null){if(this.stateManager.handleRouterEvent(f,w),f instanceof Yc&&f.code!==zo.Redirect&&f.code!==zo.SupersededByNewNavigation)this.navigated=!0;else if(f instanceof Xc)this.navigated=!0;else if(f instanceof Qg){let C=this.urlHandlingStrategy.merge(f.url,r.currentRawUrl),A={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||GH(r.source)};this.scheduleNavigation(C,qg,null,A,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}JH(f)&&this._events.next(f)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(c)}resetRootComponentType(c){this.routerState.root.component=c,this.navigationTransitions.rootComponentType=c}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),qg,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((c,f)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(c,"popstate",f)},0)})}navigateToSyncWithBrowser(c,f,r){let w={replaceUrl:!0},C=r?.navigationId?r:null;if(r){let L=vt({},r);delete L.navigationId,delete L.\u0275routerPageId,Object.keys(L).length!==0&&(w.state=L)}let A=this.parseUrl(c);this.scheduleNavigation(A,f,C,w)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(c){this.config=c.map(IC),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(c,f={}){let{relativeTo:r,queryParams:w,fragment:C,queryParamsHandling:A,preserveFragment:L}=f,U=L?this.currentUrlTree.fragment:C,Q=null;switch(A){case"merge":Q=vt(vt({},this.currentUrlTree.queryParams),w);break;case"preserve":Q=this.currentUrlTree.queryParams;break;default:Q=w||null}Q!==null&&(Q=this.removeEmptyProps(Q));let me;try{let he=r?r.snapshot:this.routerState.snapshot.root;me=rL(he)}catch{(typeof c[0]!="string"||!c[0].startsWith("/"))&&(c=[]),me=this.currentUrlTree.root}return iL(me,c,Q,U??null)}navigateByUrl(c,f={skipLocationChange:!1}){let r=ip(c)?c:this.parseUrl(c),w=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(w,qg,null,f)}navigate(c,f={skipLocationChange:!1}){return QH(c),this.navigateByUrl(this.createUrlTree(c,f),f)}serializeUrl(c){return this.urlSerializer.serialize(c)}parseUrl(c){try{return this.urlSerializer.parse(c)}catch{return this.urlSerializer.parse("/")}}isActive(c,f){let r;if(f===!0?r=vt({},YH):f===!1?r=vt({},KH):r=f,ip(c))return jk(this.currentUrlTree,c,r);let w=this.parseUrl(c);return jk(this.currentUrlTree,w,r)}removeEmptyProps(c){return Object.entries(c).reduce((f,[r,w])=>(w!=null&&(f[r]=w),f),{})}scheduleNavigation(c,f,r,w,C){if(this.disposed)return Promise.resolve(!1);let A,L,U;C?(A=C.resolve,L=C.reject,U=C.promise):U=new Promise((me,he)=>{A=me,L=he});let Q=this.pendingTasks.add();return ZH(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Q))}),this.navigationTransitions.handleNavigationRequest({source:f,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:c,extras:w,resolve:A,reject:L,promise:U,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),U.catch(me=>Promise.reject(me))}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function QH(o){for(let i=0;i<o.length;i++)if(o[i]==null)throw new xt(4008,!1)}function JH(o){return!(o instanceof Kg)&&!(o instanceof Qg)}var EL=(()=>{let i=class i{constructor(c,f,r,w,C,A){this.router=c,this.route=f,this.tabIndexAttribute=r,this.renderer=w,this.el=C,this.locationStrategy=A,this.href=null,this.commands=null,this.onChanges=new Ai,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let L=C.nativeElement.tagName?.toLowerCase();this.isAnchorElement=L==="a"||L==="area",this.isAnchorElement?this.subscription=c.events.subscribe(U=>{U instanceof Xc&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(c){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",c)}ngOnChanges(c){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(c){c!=null?(this.commands=Array.isArray(c)?c:[c],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(c,f,r,w,C){let A=this.urlTree;if(A===null||this.isAnchorElement&&(c!==0||f||r||w||C||typeof this.target=="string"&&this.target!="_self"))return!0;let L={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(A,L),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let c=this.urlTree;this.href=c!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(c)):null;let f=this.href===null?null:uO(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",f)}applyAttributeValue(c,f){let r=this.renderer,w=this.el.nativeElement;f!==null?r.setAttribute(w,c,f):r.removeAttribute(w,c)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};i.\u0275fac=function(f){return new(f||i)(nr(o_),nr(Nh),YT("tabindex"),nr(Uc),nr(dl),nr(Yf))},i.\u0275dir=zc({type:i,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(f,r){f&1&&Hr("click",function(C){return r.onClick(C.button,C.ctrlKey,C.shiftKey,C.altKey,C.metaKey)}),f&2&&bS("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Gr.HasDecoratorInputTransform,"preserveFragment","preserveFragment",kg],skipLocationChange:[Gr.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",kg],replaceUrl:[Gr.HasDecoratorInputTransform,"replaceUrl","replaceUrl",kg],routerLink:"routerLink"},standalone:!0,features:[_S,Mh]});let o=i;return o})();var eq=new dn("");function TL(o,...i){return Bc([{provide:AC,multi:!0,useValue:o},[],{provide:Nh,useFactory:tq,deps:[o_]},{provide:cx,multi:!0,useFactory:nq},i.map(l=>l.\u0275providers)])}function tq(o){return o.routerState.root}function SL(o,i){return{\u0275kind:o,\u0275providers:i}}function nq(){let o=bt(jc);return i=>{let l=o.get(qf);if(i!==l.components[0])return;let c=o.get(o_),f=o.get(rq);o.get(iq)===1&&c.initialNavigation(),o.get(oq,null,Un.Optional)?.setUpPreloading(),o.get(eq,null,Un.Optional)?.init(),c.resetRootComponentType(l.componentTypes[0]),f.closed||(f.next(),f.complete(),f.unsubscribe())}}var rq=new dn("",{factory:()=>new Ai}),iq=new dn("",{providedIn:"root",factory:()=>1});var oq=new dn("");function CL(){return SL(8,[Hk,{provide:Bx,useExisting:Hk}])}function IL(o){let i=[{provide:xL,useValue:jH},{provide:bL,useValue:vt({skipNextTransition:!!o?.skipInitialTransition},o)}];return SL(9,i)}function s_(o,i,l,c=!1){return{width:100,height:100,data:new Uint8ClampedArray(100*100*4),context:null,map:i,canvas:l,onAdd:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.context=l.getContext("2d")},render:function(){let r=this.width/2*.3,w=this.context,C=1e3,A=performance.now()%C/C;if(w){if(c){let L=this.width/2*.7*A+r;w.clearRect(0,0,this.width,this.height),w.beginPath(),w.arc(this.width/2,this.height/2,L,0,Math.PI*2),w.fillStyle=`${sq(o,A)}`,w.fill()}w.beginPath(),w.arc(this.width/2,this.height/2,r,0,Math.PI*2),w.fillStyle=o,w.strokeStyle="white",c?w.lineWidth=2+4*(1-A):w.lineWidth=4,w.fill(),w.stroke(),this.data=w.getImageData(0,0,this.width,this.height).data}return this.map?.triggerRepaint(),!0}}}function sq(o,i){let l=i-.1,c=1-l>.1?1-l:.1,f=Math.round(Math.min(Math.max(c??1,0),1)*255);return o+f.toString(16).toUpperCase()}var aq=[{id:"1",latitude:50.05423456789012,longitude:19.93845678901234},{id:"2",latitude:50.051601681737964,longitude:19.94527204613522},{id:"3",latitude:50.05773375024379,longitude:19.943222265625},{id:"4",latitude:50.05490381469543,longitude:19.93778991699219},{id:"5",latitude:50.05760487599164,longitude:19.937191009521484},{id:"6",latitude:50.05824547073284,longitude:19.930737670577457},{id:"7",latitude:50.05684123456789,longitude:19.93645678012345},{id:"8",latitude:50.05567891234567,longitude:19.94123456789012},{id:"9",latitude:50.05345678901234,longitude:19.93987654321098},{id:"10",latitude:50.05234567890123,longitude:19.93876543210987},{id:"11",latitude:50.05123456789012,longitude:19.94098765432109},{id:"12",latitude:50.05987654321098,longitude:19.93567890123456},{id:"13",latitude:50.05876543210987,longitude:19.94456789012345},{id:"14",latitude:50.05432109876543,longitude:19.94234567890123},{id:"15",latitude:50.05543210987654,longitude:19.94345678901234},{id:"16",latitude:50.05754321098765,longitude:19.94198765432109},{id:"17",latitude:50.05643210987654,longitude:19.93912345678901},{id:"18",latitude:50.05321098765432,longitude:19.9380123456789},{id:"19",latitude:50.05210987654321,longitude:19.93765432109876},{id:"20",latitude:50.05198765432109,longitude:19.93654321098765},{id:"21",latitude:50.05123456789012,longitude:19.93712345678901},{id:"22",latitude:50.05234567890123,longitude:19.94123456789012},{id:"23",latitude:50.05345678901234,longitude:19.94234567890123},{id:"24",latitude:50.05456789012345,longitude:19.93845678901234},{id:"25",latitude:50.05567890123456,longitude:19.93956789012345},{id:"26",latitude:50.05678901234567,longitude:19.94067890123456},{id:"27",latitude:50.05789012345678,longitude:19.93578901234567},{id:"28",latitude:50.05890123456789,longitude:19.93689012345678},{id:"29",latitude:50.0590123456789,longitude:19.94112345678901},{id:"30",latitude:50.05112345678901,longitude:19.94323456789012},{id:"31",latitude:50.05223456789012,longitude:19.93734567890123},{id:"32",latitude:50.05334567890123,longitude:19.94245678901234},{id:"33",latitude:50.05445678901234,longitude:19.93856789012345},{id:"34",latitude:50.05556789012345,longitude:19.93967890123456},{id:"35",latitude:50.05667890123456,longitude:19.94078901234567},{id:"36",latitude:50.05778901234567,longitude:19.93589012345678},{id:"37",latitude:50.05889012345678,longitude:19.93690123456789},{id:"38",latitude:50.05990123456789,longitude:19.9410123456789},{id:"39",latitude:50.0510123456789,longitude:19.94312345678901},{id:"40",latitude:50.05212345678901,longitude:19.93723456789012},{id:"41",latitude:50.05323456789012,longitude:19.94234567890123},{id:"42",latitude:50.05434567890123,longitude:19.93845678901234},{id:"43",latitude:50.05545678901234,longitude:19.93956789012345},{id:"44",latitude:50.05656789012345,longitude:19.94067890123456},{id:"45",latitude:50.05767890123456,longitude:19.93578901234567},{id:"46",latitude:50.05878901234567,longitude:19.93689012345678},{id:"47",latitude:50.05989012345678,longitude:19.9410123456789},{id:"48",latitude:50.05190123456789,longitude:19.94312345678901},{id:"49",latitude:50.0520123456789,longitude:19.93723456789012},{id:"50",latitude:50.05312345678901,longitude:19.94234567890123}],ML=aq;var cq=o=>({width:o}),AL=(()=>{let i=class i{constructor(){this.batteryLevel=58,this.batteryCondition=lp.Medium}ngOnInit(){this.batteryCondition=this.calculateBatteryCondition(this.batteryLevel)}calculateBatteryCondition(c){return c>75?lp.Good:c>50?lp.Medium:c>25?lp.Low:lp.Critical}};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["app-battery-level"]],inputs:{batteryLevel:"batteryLevel"},standalone:!0,features:[Nr],decls:6,vars:5,consts:[[1,"battery-label"],[1,"battery-container"],[1,"battery-level",3,"ngStyle"]],template:function(f,r){f&1&&(In(0,"div",0),Kr(1,"Battery Level"),Cn(),In(2,"div",1)(3,"div",2),Kr(4),Cn(),Kr(5),Cn()),f&2&&(vr(3),Fr("ngStyle",ek(3,cq,r.batteryLevel+"%")),vr(),Hc(" ",r.batteryLevel,"%"),vr(),Hc(" ",r.batteryCondition,`
`))},dependencies:[wi,bk],styles:[".battery-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#c2baba;border-radius:25px;display:flex;align-items:center;padding-right:10px;justify-content:space-between}.battery-container[_ngcontent-%COMP%]   .battery-level[_ngcontent-%COMP%]{height:inherit;display:flex;align-items:center;justify-content:center;border-radius:25px;background-color:#ecc6ef}.battery-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}"]});let o=i;return o})(),lp=function(o){return o.Good="GOOD",o.Medium="MEDIUM",o.Low="LOW",o.Critical="CRITICAL",o}(lp||{});function uq(o,i){if(o&1&&(In(0,"div",11),Kr(1),Cn()),o&2){let l=i.$implicit;TS("ngClass",l.alarmLevel),vr(),Hc(" ",l.alarmCount," ")}}var RC=(()=>{let i=class i{constructor(){this.showSensorDetails=!1,this.sensorId="Sensor #471",this.responsible="Deratex Polska",this.alarmsData=[{alarmLevel:"critical",alarmCount:3},{alarmLevel:"high",alarmCount:1},{alarmLevel:"low",alarmCount:2}],this.batteryLevel=78,this.location={street:"ul. Malborska",building:"85",city:"Krak\xF3w",additionalInfo:"2 pi\u0119tro, zaraz za winklem"},this.hideDetails=new Ji}emitHideDetails(){this.hideDetails.emit(!0)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["app-sensor-details"]],inputs:{showSensorDetails:"showSensorDetails",sensorId:"sensorId",responsible:"responsible",alarmsData:"alarmsData",batteryLevel:"batteryLevel",location:"location"},outputs:{hideDetails:"hideDetails"},standalone:!0,features:[Nr],decls:17,vars:7,consts:[[1,"close",3,"click"],[1,"overlay-container"],[1,"sensor-container"],[1,"responsible-label"],[1,"responsible-container"],[1,"alarms-label"],[1,"alarms-container"],["class","alarm",3,"ngClass",4,"ngFor","ngForOf"],[3,"batteryLevel"],[1,"localization-label"],[1,"localization-container"],[1,"alarm",3,"ngClass"]],template:function(f,r){f&1&&(In(0,"a",0),Hr("click",function(){return r.emitHideDetails()}),Cn(),In(1,"div",1)(2,"div",2),Kr(3),Cn(),In(4,"div",3),Kr(5,"Responsible"),Cn(),In(6,"div",4),Kr(7),Cn(),In(8,"div",5),Kr(9,"Alarms"),Cn(),In(10,"div",6),pl(11,uq,2,2,"div",7),Cn(),er(12,"app-battery-level",8),In(13,"div",9),Kr(14,"Localization"),Cn(),In(15,"div",10),Kr(16),Cn()()),f&2&&(vr(3),Hc(" ",r.sensorId," "),vr(4),Hc(" ",r.responsible," "),vr(4),Fr("ngForOf",r.alarmsData),vr(),Fr("batteryLevel",r.batteryLevel),vr(4),SS(" ",r.location.street," ",r.location.building,", ",r.location.city," "))},dependencies:[wi,Kf,dx,AL],styles:['.overlay-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:60%;height:100%;z-index:100;background-color:#fff;opacity:.9;padding-left:20%;padding-right:20%;text-wrap:nowrap;display:flex;flex-direction:column;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif;transition:all .5s}.overlay-container[_ngcontent-%COMP%]   .sensor-container[_ngcontent-%COMP%]{width:100%;margin-top:10vh;font-size:150%}.overlay-container[_ngcontent-%COMP%]   .responsible-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:10vh}.overlay-container[_ngcontent-%COMP%]   .responsible-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.overlay-container[_ngcontent-%COMP%]   .alarms-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:30px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:20px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]   .alarm[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:40px;border-radius:50%}.overlay-container[_ngcontent-%COMP%]   .localization-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}.overlay-container[_ngcontent-%COMP%]   .localization-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.critical[_ngcontent-%COMP%]{background-color:#ecc6ef}.high[_ngcontent-%COMP%]{background-color:#ffeb82}.low[_ngcontent-%COMP%]{background-color:#eaebed}.close[_ngcontent-%COMP%]{position:absolute;z-index:105;right:32px;top:20px;width:20px;height:20px;scale:.7}.close[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}.close[_ngcontent-%COMP%]:before, .close[_ngcontent-%COMP%]:after{z-index:105;position:absolute;left:15px;content:" ";height:33px;width:2px;background-color:#333}.close[_ngcontent-%COMP%]:before{transform:rotate(45deg)}.close[_ngcontent-%COMP%]:after{transform:rotate(-45deg)}']});let o=i;return o})();var OC=(()=>{let i=class i{constructor(){this.url="http://localhost:3000/places"}getAllLocations(){return hg(this,null,function*(){let f=yield(yield fetch(this.url)).text();return JSON.parse(f)??[]})}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var zh=class extends Map{constructor(i,l=fq){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:l}}),i!=null)for(let[c,f]of i)this.set(c,f)}get(i){return super.get(RL(this,i))}has(i){return super.has(RL(this,i))}set(i,l){return super.set(hq(this,i),l)}delete(i){return super.delete(dq(this,i))}};function RL({_intern:o,_key:i},l){let c=i(l);return o.has(c)?o.get(c):l}function hq({_intern:o,_key:i},l){let c=i(l);return o.has(c)?o.get(c):(o.set(c,l),l)}function dq({_intern:o,_key:i},l){let c=i(l);return o.has(c)&&(l=o.get(c),o.delete(c)),l}function fq(o){return o!==null&&typeof o=="object"?o.valueOf():o}function jx(o){return o}function Ux(o,...i){return pq(o,jx,jx,i)}function pq(o,i,l,c){return function f(r,w){if(w>=c.length)return l(r);let C=new zh,A=c[w++],L=-1;for(let U of r){let Q=A(U,++L,r),me=C.get(Q);me?me.push(U):C.set(Q,[U])}for(let[U,Q]of C)C.set(U,f(Q,w));return i(C)}(o,0)}var mq={value:()=>{}};function kL(){for(var o=0,i=arguments.length,l={},c;o<i;++o){if(!(c=arguments[o]+"")||c in l||/[\s.]/.test(c))throw new Error("illegal type: "+c);l[c]=[]}return new $x(l)}function $x(o){this._=o}function gq(o,i){return o.trim().split(/^|\s+/).map(function(l){var c="",f=l.indexOf(".");if(f>=0&&(c=l.slice(f+1),l=l.slice(0,f)),l&&!i.hasOwnProperty(l))throw new Error("unknown type: "+l);return{type:l,name:c}})}$x.prototype=kL.prototype={constructor:$x,on:function(o,i){var l=this._,c=gq(o+"",l),f,r=-1,w=c.length;if(arguments.length<2){for(;++r<w;)if((f=(o=c[r]).type)&&(f=_q(l[f],o.name)))return f;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++r<w;)if(f=(o=c[r]).type)l[f]=OL(l[f],o.name,i);else if(i==null)for(f in l)l[f]=OL(l[f],o.name,null);return this},copy:function(){var o={},i=this._;for(var l in i)o[l]=i[l].slice();return new $x(o)},call:function(o,i){if((f=arguments.length-2)>0)for(var l=new Array(f),c=0,f,r;c<f;++c)l[c]=arguments[c+2];if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(r=this._[o],c=0,f=r.length;c<f;++c)r[c].value.apply(i,l)},apply:function(o,i,l){if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(var c=this._[o],f=0,r=c.length;f<r;++f)c[f].value.apply(i,l)}};function _q(o,i){for(var l=0,c=o.length,f;l<c;++l)if((f=o[l]).name===i)return f.value}function OL(o,i,l){for(var c=0,f=o.length;c<f;++c)if(o[c].name===i){o[c]=mq,o=o.slice(0,c).concat(o.slice(c+1));break}return l!=null&&o.push({name:i,value:l}),o}var Bh=kL;var Gx="http://www.w3.org/1999/xhtml",kC={svg:"http://www.w3.org/2000/svg",xhtml:Gx,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ml(o){var i=o+="",l=i.indexOf(":");return l>=0&&(i=o.slice(0,l))!=="xmlns"&&(o=o.slice(l+1)),kC.hasOwnProperty(i)?{space:kC[i],local:o}:o}function yq(o){return function(){var i=this.ownerDocument,l=this.namespaceURI;return l===Gx&&i.documentElement.namespaceURI===Gx?i.createElement(o):i.createElementNS(l,o)}}function vq(o){return function(){return this.ownerDocument.createElementNS(o.space,o.local)}}function Hx(o){var i=ml(o);return(i.local?vq:yq)(i)}function xq(){}function Vh(o){return o==null?xq:function(){return this.querySelector(o)}}function LL(o){typeof o!="function"&&(o=Vh(o));for(var i=this._groups,l=i.length,c=new Array(l),f=0;f<l;++f)for(var r=i[f],w=r.length,C=c[f]=new Array(w),A,L,U=0;U<w;++U)(A=r[U])&&(L=o.call(A,A.__data__,U,r))&&("__data__"in A&&(L.__data__=A.__data__),C[U]=L);return new qr(c,this._parents)}function LC(o){return o==null?[]:Array.isArray(o)?o:Array.from(o)}function bq(){return[]}function a_(o){return o==null?bq:function(){return this.querySelectorAll(o)}}function wq(o){return function(){return LC(o.apply(this,arguments))}}function FL(o){typeof o=="function"?o=wq(o):o=a_(o);for(var i=this._groups,l=i.length,c=[],f=[],r=0;r<l;++r)for(var w=i[r],C=w.length,A,L=0;L<C;++L)(A=w[L])&&(c.push(o.call(A,A.__data__,L,w)),f.push(A));return new qr(c,f)}function l_(o){return function(){return this.matches(o)}}function qx(o){return function(i){return i.matches(o)}}var Eq=Array.prototype.find;function Tq(o){return function(){return Eq.call(this.children,o)}}function Sq(){return this.firstElementChild}function NL(o){return this.select(o==null?Sq:Tq(typeof o=="function"?o:qx(o)))}var Cq=Array.prototype.filter;function Iq(){return Array.from(this.children)}function Dq(o){return function(){return Cq.call(this.children,o)}}function zL(o){return this.selectAll(o==null?Iq:Dq(typeof o=="function"?o:qx(o)))}function BL(o){typeof o!="function"&&(o=l_(o));for(var i=this._groups,l=i.length,c=new Array(l),f=0;f<l;++f)for(var r=i[f],w=r.length,C=c[f]=[],A,L=0;L<w;++L)(A=r[L])&&o.call(A,A.__data__,L,r)&&C.push(A);return new qr(c,this._parents)}function Wx(o){return new Array(o.length)}function VL(){return new qr(this._enter||this._groups.map(Wx),this._parents)}function c_(o,i){this.ownerDocument=o.ownerDocument,this.namespaceURI=o.namespaceURI,this._next=null,this._parent=o,this.__data__=i}c_.prototype={constructor:c_,appendChild:function(o){return this._parent.insertBefore(o,this._next)},insertBefore:function(o,i){return this._parent.insertBefore(o,i)},querySelector:function(o){return this._parent.querySelector(o)},querySelectorAll:function(o){return this._parent.querySelectorAll(o)}};function jL(o){return function(){return o}}function Mq(o,i,l,c,f,r){for(var w=0,C,A=i.length,L=r.length;w<L;++w)(C=i[w])?(C.__data__=r[w],c[w]=C):l[w]=new c_(o,r[w]);for(;w<A;++w)(C=i[w])&&(f[w]=C)}function Aq(o,i,l,c,f,r,w){var C,A,L=new Map,U=i.length,Q=r.length,me=new Array(U),he;for(C=0;C<U;++C)(A=i[C])&&(me[C]=he=w.call(A,A.__data__,C,i)+"",L.has(he)?f[C]=A:L.set(he,A));for(C=0;C<Q;++C)he=w.call(o,r[C],C,r)+"",(A=L.get(he))?(c[C]=A,A.__data__=r[C],L.delete(he)):l[C]=new c_(o,r[C]);for(C=0;C<U;++C)(A=i[C])&&L.get(me[C])===A&&(f[C]=A)}function Pq(o){return o.__data__}function UL(o,i){if(!arguments.length)return Array.from(this,Pq);var l=i?Aq:Mq,c=this._parents,f=this._groups;typeof o!="function"&&(o=jL(o));for(var r=f.length,w=new Array(r),C=new Array(r),A=new Array(r),L=0;L<r;++L){var U=c[L],Q=f[L],me=Q.length,he=Rq(o.call(U,U&&U.__data__,L,c)),be=he.length,Ie=C[L]=new Array(be),Qe=w[L]=new Array(be),ze=A[L]=new Array(me);l(U,Q,Ie,Qe,ze,he,i);for(var nt=0,ft=0,Ue,Nt;nt<be;++nt)if(Ue=Ie[nt]){for(nt>=ft&&(ft=nt+1);!(Nt=Qe[ft])&&++ft<be;);Ue._next=Nt||null}}return w=new qr(w,c),w._enter=C,w._exit=A,w}function Rq(o){return typeof o=="object"&&"length"in o?o:Array.from(o)}function $L(){return new qr(this._exit||this._groups.map(Wx),this._parents)}function GL(o,i,l){var c=this.enter(),f=this,r=this.exit();return typeof o=="function"?(c=o(c),c&&(c=c.selection())):c=c.append(o+""),i!=null&&(f=i(f),f&&(f=f.selection())),l==null?r.remove():l(r),c&&f?c.merge(f).order():f}function HL(o){for(var i=o.selection?o.selection():o,l=this._groups,c=i._groups,f=l.length,r=c.length,w=Math.min(f,r),C=new Array(f),A=0;A<w;++A)for(var L=l[A],U=c[A],Q=L.length,me=C[A]=new Array(Q),he,be=0;be<Q;++be)(he=L[be]||U[be])&&(me[be]=he);for(;A<f;++A)C[A]=l[A];return new qr(C,this._parents)}function qL(){for(var o=this._groups,i=-1,l=o.length;++i<l;)for(var c=o[i],f=c.length-1,r=c[f],w;--f>=0;)(w=c[f])&&(r&&w.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(w,r),r=w);return this}function WL(o){o||(o=Oq);function i(Q,me){return Q&&me?o(Q.__data__,me.__data__):!Q-!me}for(var l=this._groups,c=l.length,f=new Array(c),r=0;r<c;++r){for(var w=l[r],C=w.length,A=f[r]=new Array(C),L,U=0;U<C;++U)(L=w[U])&&(A[U]=L);A.sort(i)}return new qr(f,this._parents).order()}function Oq(o,i){return o<i?-1:o>i?1:o>=i?0:NaN}function ZL(){var o=arguments[0];return arguments[0]=this,o.apply(null,arguments),this}function XL(){return Array.from(this)}function YL(){for(var o=this._groups,i=0,l=o.length;i<l;++i)for(var c=o[i],f=0,r=c.length;f<r;++f){var w=c[f];if(w)return w}return null}function KL(){let o=0;for(let i of this)++o;return o}function QL(){return!this.node()}function JL(o){for(var i=this._groups,l=0,c=i.length;l<c;++l)for(var f=i[l],r=0,w=f.length,C;r<w;++r)(C=f[r])&&o.call(C,C.__data__,r,f);return this}function kq(o){return function(){this.removeAttribute(o)}}function Lq(o){return function(){this.removeAttributeNS(o.space,o.local)}}function Fq(o,i){return function(){this.setAttribute(o,i)}}function Nq(o,i){return function(){this.setAttributeNS(o.space,o.local,i)}}function zq(o,i){return function(){var l=i.apply(this,arguments);l==null?this.removeAttribute(o):this.setAttribute(o,l)}}function Bq(o,i){return function(){var l=i.apply(this,arguments);l==null?this.removeAttributeNS(o.space,o.local):this.setAttributeNS(o.space,o.local,l)}}function eF(o,i){var l=ml(o);if(arguments.length<2){var c=this.node();return l.local?c.getAttributeNS(l.space,l.local):c.getAttribute(l)}return this.each((i==null?l.local?Lq:kq:typeof i=="function"?l.local?Bq:zq:l.local?Nq:Fq)(l,i))}function Zx(o){return o.ownerDocument&&o.ownerDocument.defaultView||o.document&&o||o.defaultView}function Vq(o){return function(){this.style.removeProperty(o)}}function jq(o,i,l){return function(){this.style.setProperty(o,i,l)}}function Uq(o,i,l){return function(){var c=i.apply(this,arguments);c==null?this.style.removeProperty(o):this.style.setProperty(o,c,l)}}function tF(o,i,l){return arguments.length>1?this.each((i==null?Vq:typeof i=="function"?Uq:jq)(o,i,l??"")):Qc(this.node(),o)}function Qc(o,i){return o.style.getPropertyValue(i)||Zx(o).getComputedStyle(o,null).getPropertyValue(i)}function $q(o){return function(){delete this[o]}}function Gq(o,i){return function(){this[o]=i}}function Hq(o,i){return function(){var l=i.apply(this,arguments);l==null?delete this[o]:this[o]=l}}function nF(o,i){return arguments.length>1?this.each((i==null?$q:typeof i=="function"?Hq:Gq)(o,i)):this.node()[o]}function rF(o){return o.trim().split(/^|\s+/)}function FC(o){return o.classList||new iF(o)}function iF(o){this._node=o,this._names=rF(o.getAttribute("class")||"")}iF.prototype={add:function(o){var i=this._names.indexOf(o);i<0&&(this._names.push(o),this._node.setAttribute("class",this._names.join(" ")))},remove:function(o){var i=this._names.indexOf(o);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(o){return this._names.indexOf(o)>=0}};function oF(o,i){for(var l=FC(o),c=-1,f=i.length;++c<f;)l.add(i[c])}function sF(o,i){for(var l=FC(o),c=-1,f=i.length;++c<f;)l.remove(i[c])}function qq(o){return function(){oF(this,o)}}function Wq(o){return function(){sF(this,o)}}function Zq(o,i){return function(){(i.apply(this,arguments)?oF:sF)(this,o)}}function aF(o,i){var l=rF(o+"");if(arguments.length<2){for(var c=FC(this.node()),f=-1,r=l.length;++f<r;)if(!c.contains(l[f]))return!1;return!0}return this.each((typeof i=="function"?Zq:i?qq:Wq)(l,i))}function Xq(){this.textContent=""}function Yq(o){return function(){this.textContent=o}}function Kq(o){return function(){var i=o.apply(this,arguments);this.textContent=i??""}}function lF(o){return arguments.length?this.each(o==null?Xq:(typeof o=="function"?Kq:Yq)(o)):this.node().textContent}function Qq(){this.innerHTML=""}function Jq(o){return function(){this.innerHTML=o}}function e9(o){return function(){var i=o.apply(this,arguments);this.innerHTML=i??""}}function cF(o){return arguments.length?this.each(o==null?Qq:(typeof o=="function"?e9:Jq)(o)):this.node().innerHTML}function t9(){this.nextSibling&&this.parentNode.appendChild(this)}function uF(){return this.each(t9)}function n9(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function hF(){return this.each(n9)}function dF(o){var i=typeof o=="function"?o:Hx(o);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function r9(){return null}function fF(o,i){var l=typeof o=="function"?o:Hx(o),c=i==null?r9:typeof i=="function"?i:Vh(i);return this.select(function(){return this.insertBefore(l.apply(this,arguments),c.apply(this,arguments)||null)})}function i9(){var o=this.parentNode;o&&o.removeChild(this)}function pF(){return this.each(i9)}function o9(){var o=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(o,this.nextSibling):o}function s9(){var o=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(o,this.nextSibling):o}function mF(o){return this.select(o?s9:o9)}function gF(o){return arguments.length?this.property("__data__",o):this.node().__data__}function a9(o){return function(i){o.call(this,i,this.__data__)}}function l9(o){return o.trim().split(/^|\s+/).map(function(i){var l="",c=i.indexOf(".");return c>=0&&(l=i.slice(c+1),i=i.slice(0,c)),{type:i,name:l}})}function c9(o){return function(){var i=this.__on;if(i){for(var l=0,c=-1,f=i.length,r;l<f;++l)r=i[l],(!o.type||r.type===o.type)&&r.name===o.name?this.removeEventListener(r.type,r.listener,r.options):i[++c]=r;++c?i.length=c:delete this.__on}}}function u9(o,i,l){return function(){var c=this.__on,f,r=a9(i);if(c){for(var w=0,C=c.length;w<C;++w)if((f=c[w]).type===o.type&&f.name===o.name){this.removeEventListener(f.type,f.listener,f.options),this.addEventListener(f.type,f.listener=r,f.options=l),f.value=i;return}}this.addEventListener(o.type,r,l),f={type:o.type,name:o.name,value:i,listener:r,options:l},c?c.push(f):this.__on=[f]}}function _F(o,i,l){var c=l9(o+""),f,r=c.length,w;if(arguments.length<2){var C=this.node().__on;if(C){for(var A=0,L=C.length,U;A<L;++A)for(f=0,U=C[A];f<r;++f)if((w=c[f]).type===U.type&&w.name===U.name)return U.value}return}for(C=i?u9:c9,f=0;f<r;++f)this.each(C(c[f],i,l));return this}function yF(o,i,l){var c=Zx(o),f=c.CustomEvent;typeof f=="function"?f=new f(i,l):(f=c.document.createEvent("Event"),l?(f.initEvent(i,l.bubbles,l.cancelable),f.detail=l.detail):f.initEvent(i,!1,!1)),o.dispatchEvent(f)}function h9(o,i){return function(){return yF(this,o,i)}}function d9(o,i){return function(){return yF(this,o,i.apply(this,arguments))}}function vF(o,i){return this.each((typeof i=="function"?d9:h9)(o,i))}function*xF(){for(var o=this._groups,i=0,l=o.length;i<l;++i)for(var c=o[i],f=0,r=c.length,w;f<r;++f)(w=c[f])&&(yield w)}var NC=[null];function qr(o,i){this._groups=o,this._parents=i}function bF(){return new qr([[document.documentElement]],NC)}function f9(){return this}qr.prototype=bF.prototype={constructor:qr,select:LL,selectAll:FL,selectChild:NL,selectChildren:zL,filter:BL,data:UL,enter:VL,exit:$L,join:GL,merge:HL,selection:f9,order:qL,sort:WL,call:ZL,nodes:XL,node:YL,size:KL,empty:QL,each:JL,attr:eF,style:tF,property:nF,classed:aF,text:lF,html:cF,raise:uF,lower:hF,append:dF,insert:fF,remove:pF,clone:mF,datum:gF,on:_F,dispatch:vF,[Symbol.iterator]:xF};var gl=bF;function no(o){return typeof o=="string"?new qr([[document.querySelector(o)]],[document.documentElement]):new qr([[o]],NC)}function wF(o){let i;for(;i=o.sourceEvent;)o=i;return o}function Xx(o,i){if(o=wF(o),i===void 0&&(i=o.currentTarget),i){var l=i.ownerSVGElement||i;if(l.createSVGPoint){var c=l.createSVGPoint();return c.x=o.clientX,c.y=o.clientY,c=c.matrixTransform(i.getScreenCTM().inverse()),[c.x,c.y]}if(i.getBoundingClientRect){var f=i.getBoundingClientRect();return[o.clientX-f.left-i.clientLeft,o.clientY-f.top-i.clientTop]}}return[o.pageX,o.pageY]}var EF={passive:!1},jh={capture:!0,passive:!1};function Yx(o){o.stopImmediatePropagation()}function Jc(o){o.preventDefault(),o.stopImmediatePropagation()}function TF(o){var i=o.document.documentElement,l=no(o).on("dragstart.drag",Jc,jh);"onselectstart"in i?l.on("selectstart.drag",Jc,jh):(i.__noselect=i.style.MozUserSelect,i.style.MozUserSelect="none")}function SF(o,i){var l=o.document.documentElement,c=no(o).on("dragstart.drag",null);i&&(c.on("click.drag",Jc,jh),setTimeout(function(){c.on("click.drag",null)},0)),"onselectstart"in l?c.on("selectstart.drag",null):(l.style.MozUserSelect=l.__noselect,delete l.__noselect)}var u_=o=>()=>o;function h_(o,{sourceEvent:i,subject:l,target:c,identifier:f,active:r,x:w,y:C,dx:A,dy:L,dispatch:U}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:i,enumerable:!0,configurable:!0},subject:{value:l,enumerable:!0,configurable:!0},target:{value:c,enumerable:!0,configurable:!0},identifier:{value:f,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:w,enumerable:!0,configurable:!0},y:{value:C,enumerable:!0,configurable:!0},dx:{value:A,enumerable:!0,configurable:!0},dy:{value:L,enumerable:!0,configurable:!0},_:{value:U}})}h_.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function p9(o){return!o.ctrlKey&&!o.button}function m9(){return this.parentNode}function g9(o,i){return i??{x:o.x,y:o.y}}function _9(){return navigator.maxTouchPoints||"ontouchstart"in this}function d_(){var o=p9,i=m9,l=g9,c=_9,f={},r=Bh("start","drag","end"),w=0,C,A,L,U,Q=0;function me(Ue){Ue.on("mousedown.drag",he).filter(c).on("touchstart.drag",Qe).on("touchmove.drag",ze,EF).on("touchend.drag touchcancel.drag",nt).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function he(Ue,Nt){if(!(U||!o.call(this,Ue,Nt))){var Yt=ft(this,i.call(this,Ue,Nt),Ue,Nt,"mouse");Yt&&(no(Ue.view).on("mousemove.drag",be,jh).on("mouseup.drag",Ie,jh),TF(Ue.view),Yx(Ue),L=!1,C=Ue.clientX,A=Ue.clientY,Yt("start",Ue))}}function be(Ue){if(Jc(Ue),!L){var Nt=Ue.clientX-C,Yt=Ue.clientY-A;L=Nt*Nt+Yt*Yt>Q}f.mouse("drag",Ue)}function Ie(Ue){no(Ue.view).on("mousemove.drag mouseup.drag",null),SF(Ue.view,L),Jc(Ue),f.mouse("end",Ue)}function Qe(Ue,Nt){if(o.call(this,Ue,Nt)){var Yt=Ue.changedTouches,Jt=i.call(this,Ue,Nt),Et=Yt.length,tr,Ct;for(tr=0;tr<Et;++tr)(Ct=ft(this,Jt,Ue,Nt,Yt[tr].identifier,Yt[tr]))&&(Yx(Ue),Ct("start",Ue,Yt[tr]))}}function ze(Ue){var Nt=Ue.changedTouches,Yt=Nt.length,Jt,Et;for(Jt=0;Jt<Yt;++Jt)(Et=f[Nt[Jt].identifier])&&(Jc(Ue),Et("drag",Ue,Nt[Jt]))}function nt(Ue){var Nt=Ue.changedTouches,Yt=Nt.length,Jt,Et;for(U&&clearTimeout(U),U=setTimeout(function(){U=null},500),Jt=0;Jt<Yt;++Jt)(Et=f[Nt[Jt].identifier])&&(Yx(Ue),Et("end",Ue,Nt[Jt]))}function ft(Ue,Nt,Yt,Jt,Et,tr){var Ct=r.copy(),_r=Xx(tr||Yt,Nt),br,zr,xn;if((xn=l.call(Ue,new h_("beforestart",{sourceEvent:Yt,target:me,identifier:Et,active:w,x:_r[0],y:_r[1],dx:0,dy:0,dispatch:Ct}),Jt))!=null)return br=xn.x-_r[0]||0,zr=xn.y-_r[1]||0,function jo(wt,zt,Ht){var _n=_r,kt;switch(wt){case"start":f[Et]=jo,kt=w++;break;case"end":delete f[Et],--w;case"drag":_r=Xx(Ht||zt,Nt),kt=w;break}Ct.call(wt,Ue,new h_(wt,{sourceEvent:zt,subject:xn,target:me,identifier:Et,active:kt,x:_r[0]+br,y:_r[1]+zr,dx:_r[0]-_n[0],dy:_r[1]-_n[1],dispatch:Ct}),Jt)}}return me.filter=function(Ue){return arguments.length?(o=typeof Ue=="function"?Ue:u_(!!Ue),me):o},me.container=function(Ue){return arguments.length?(i=typeof Ue=="function"?Ue:u_(Ue),me):i},me.subject=function(Ue){return arguments.length?(l=typeof Ue=="function"?Ue:u_(Ue),me):l},me.touchable=function(Ue){return arguments.length?(c=typeof Ue=="function"?Ue:u_(!!Ue),me):c},me.on=function(){var Ue=r.on.apply(r,arguments);return Ue===r?me:Ue},me.clickDistance=function(Ue){return arguments.length?(Q=(Ue=+Ue)*Ue,me):Math.sqrt(Q)},me}function Kx(o,i,l){o.prototype=i.prototype=l,l.constructor=o}function zC(o,i){var l=Object.create(o.prototype);for(var c in i)l[c]=i[c];return l}function m_(){}var f_=.7,e1=1/f_,cp="\\s*([+-]?\\d+)\\s*",p_="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",wa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",y9=/^#([0-9a-f]{3,8})$/,v9=new RegExp(`^rgb\\(${cp},${cp},${cp}\\)$`),x9=new RegExp(`^rgb\\(${wa},${wa},${wa}\\)$`),b9=new RegExp(`^rgba\\(${cp},${cp},${cp},${p_}\\)$`),w9=new RegExp(`^rgba\\(${wa},${wa},${wa},${p_}\\)$`),E9=new RegExp(`^hsl\\(${p_},${wa},${wa}\\)$`),T9=new RegExp(`^hsla\\(${p_},${wa},${wa},${p_}\\)$`),CF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Kx(m_,eu,{copy(o){return Object.assign(new this.constructor,this,o)},displayable(){return this.rgb().displayable()},hex:IF,formatHex:IF,formatHex8:S9,formatHsl:C9,formatRgb:DF,toString:DF});function IF(){return this.rgb().formatHex()}function S9(){return this.rgb().formatHex8()}function C9(){return kF(this).formatHsl()}function DF(){return this.rgb().formatRgb()}function eu(o){var i,l;return o=(o+"").trim().toLowerCase(),(i=y9.exec(o))?(l=i[1].length,i=parseInt(i[1],16),l===6?MF(i):l===3?new bo(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):l===8?Qx(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):l===4?Qx(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=v9.exec(o))?new bo(i[1],i[2],i[3],1):(i=x9.exec(o))?new bo(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=b9.exec(o))?Qx(i[1],i[2],i[3],i[4]):(i=w9.exec(o))?Qx(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=E9.exec(o))?RF(i[1],i[2]/100,i[3]/100,1):(i=T9.exec(o))?RF(i[1],i[2]/100,i[3]/100,i[4]):CF.hasOwnProperty(o)?MF(CF[o]):o==="transparent"?new bo(NaN,NaN,NaN,0):null}function MF(o){return new bo(o>>16&255,o>>8&255,o&255,1)}function Qx(o,i,l,c){return c<=0&&(o=i=l=NaN),new bo(o,i,l,c)}function I9(o){return o instanceof m_||(o=eu(o)),o?(o=o.rgb(),new bo(o.r,o.g,o.b,o.opacity)):new bo}function up(o,i,l,c){return arguments.length===1?I9(o):new bo(o,i,l,c??1)}function bo(o,i,l,c){this.r=+o,this.g=+i,this.b=+l,this.opacity=+c}Kx(bo,up,zC(m_,{brighter(o){return o=o==null?e1:Math.pow(e1,o),new bo(this.r*o,this.g*o,this.b*o,this.opacity)},darker(o){return o=o==null?f_:Math.pow(f_,o),new bo(this.r*o,this.g*o,this.b*o,this.opacity)},rgb(){return this},clamp(){return new bo($h(this.r),$h(this.g),$h(this.b),t1(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:AF,formatHex:AF,formatHex8:D9,formatRgb:PF,toString:PF}));function AF(){return`#${Uh(this.r)}${Uh(this.g)}${Uh(this.b)}`}function D9(){return`#${Uh(this.r)}${Uh(this.g)}${Uh(this.b)}${Uh((isNaN(this.opacity)?1:this.opacity)*255)}`}function PF(){let o=t1(this.opacity);return`${o===1?"rgb(":"rgba("}${$h(this.r)}, ${$h(this.g)}, ${$h(this.b)}${o===1?")":`, ${o})`}`}function t1(o){return isNaN(o)?1:Math.max(0,Math.min(1,o))}function $h(o){return Math.max(0,Math.min(255,Math.round(o)||0))}function Uh(o){return o=$h(o),(o<16?"0":"")+o.toString(16)}function RF(o,i,l,c){return c<=0?o=i=l=NaN:l<=0||l>=1?o=i=NaN:i<=0&&(o=NaN),new zs(o,i,l,c)}function kF(o){if(o instanceof zs)return new zs(o.h,o.s,o.l,o.opacity);if(o instanceof m_||(o=eu(o)),!o)return new zs;if(o instanceof zs)return o;o=o.rgb();var i=o.r/255,l=o.g/255,c=o.b/255,f=Math.min(i,l,c),r=Math.max(i,l,c),w=NaN,C=r-f,A=(r+f)/2;return C?(i===r?w=(l-c)/C+(l<c)*6:l===r?w=(c-i)/C+2:w=(i-l)/C+4,C/=A<.5?r+f:2-r-f,w*=60):C=A>0&&A<1?0:w,new zs(w,C,A,o.opacity)}function LF(o,i,l,c){return arguments.length===1?kF(o):new zs(o,i,l,c??1)}function zs(o,i,l,c){this.h=+o,this.s=+i,this.l=+l,this.opacity=+c}Kx(zs,LF,zC(m_,{brighter(o){return o=o==null?e1:Math.pow(e1,o),new zs(this.h,this.s,this.l*o,this.opacity)},darker(o){return o=o==null?f_:Math.pow(f_,o),new zs(this.h,this.s,this.l*o,this.opacity)},rgb(){var o=this.h%360+(this.h<0)*360,i=isNaN(o)||isNaN(this.s)?0:this.s,l=this.l,c=l+(l<.5?l:1-l)*i,f=2*l-c;return new bo(BC(o>=240?o-240:o+120,f,c),BC(o,f,c),BC(o<120?o+240:o-120,f,c),this.opacity)},clamp(){return new zs(OF(this.h),Jx(this.s),Jx(this.l),t1(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let o=t1(this.opacity);return`${o===1?"hsl(":"hsla("}${OF(this.h)}, ${Jx(this.s)*100}%, ${Jx(this.l)*100}%${o===1?")":`, ${o})`}`}}));function OF(o){return o=(o||0)%360,o<0?o+360:o}function Jx(o){return Math.max(0,Math.min(1,o||0))}function BC(o,i,l){return(o<60?i+(l-i)*o/60:o<180?l:o<240?i+(l-i)*(240-o)/60:i)*255}function VC(o,i,l,c,f){var r=o*o,w=r*o;return((1-3*o+3*r-w)*i+(4-6*r+3*w)*l+(1+3*o+3*r-3*w)*c+w*f)/6}function FF(o){var i=o.length-1;return function(l){var c=l<=0?l=0:l>=1?(l=1,i-1):Math.floor(l*i),f=o[c],r=o[c+1],w=c>0?o[c-1]:2*f-r,C=c<i-1?o[c+2]:2*r-f;return VC((l-c/i)*i,w,f,r,C)}}function NF(o){var i=o.length;return function(l){var c=Math.floor(((l%=1)<0?++l:l)*i),f=o[(c+i-1)%i],r=o[c%i],w=o[(c+1)%i],C=o[(c+2)%i];return VC((l-c/i)*i,f,r,w,C)}}var jC=o=>()=>o;function M9(o,i){return function(l){return o+l*i}}function A9(o,i,l){return o=Math.pow(o,l),i=Math.pow(i,l)-o,l=1/l,function(c){return Math.pow(o+c*i,l)}}function zF(o){return(o=+o)==1?n1:function(i,l){return l-i?A9(i,l,o):jC(isNaN(i)?l:i)}}function n1(o,i){var l=i-o;return l?M9(o,l):jC(isNaN(o)?i:o)}var r1=function o(i){var l=zF(i);function c(f,r){var w=l((f=up(f)).r,(r=up(r)).r),C=l(f.g,r.g),A=l(f.b,r.b),L=n1(f.opacity,r.opacity);return function(U){return f.r=w(U),f.g=C(U),f.b=A(U),f.opacity=L(U),f+""}}return c.gamma=o,c}(1);function BF(o){return function(i){var l=i.length,c=new Array(l),f=new Array(l),r=new Array(l),w,C;for(w=0;w<l;++w)C=up(i[w]),c[w]=C.r||0,f[w]=C.g||0,r[w]=C.b||0;return c=o(c),f=o(f),r=o(r),C.opacity=1,function(A){return C.r=c(A),C.g=f(A),C.b=r(A),C+""}}}var P9=BF(FF),R9=BF(NF);function as(o,i){return o=+o,i=+i,function(l){return o*(1-l)+i*l}}var $C=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,UC=new RegExp($C.source,"g");function O9(o){return function(){return o}}function k9(o){return function(i){return o(i)+""}}function GC(o,i){var l=$C.lastIndex=UC.lastIndex=0,c,f,r,w=-1,C=[],A=[];for(o=o+"",i=i+"";(c=$C.exec(o))&&(f=UC.exec(i));)(r=f.index)>l&&(r=i.slice(l,r),C[w]?C[w]+=r:C[++w]=r),(c=c[0])===(f=f[0])?C[w]?C[w]+=f:C[++w]=f:(C[++w]=null,A.push({i:w,x:as(c,f)})),l=UC.lastIndex;return l<i.length&&(r=i.slice(l),C[w]?C[w]+=r:C[++w]=r),C.length<2?A[0]?k9(A[0].x):O9(i):(i=A.length,function(L){for(var U=0,Q;U<i;++U)C[(Q=A[U]).i]=Q.x(L);return C.join("")})}var VF=180/Math.PI,i1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function HC(o,i,l,c,f,r){var w,C,A;return(w=Math.sqrt(o*o+i*i))&&(o/=w,i/=w),(A=o*l+i*c)&&(l-=o*A,c-=i*A),(C=Math.sqrt(l*l+c*c))&&(l/=C,c/=C,A/=C),o*c<i*l&&(o=-o,i=-i,A=-A,w=-w),{translateX:f,translateY:r,rotate:Math.atan2(i,o)*VF,skewX:Math.atan(A)*VF,scaleX:w,scaleY:C}}var o1;function jF(o){let i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(o+"");return i.isIdentity?i1:HC(i.a,i.b,i.c,i.d,i.e,i.f)}function UF(o){return o==null?i1:(o1||(o1=document.createElementNS("http://www.w3.org/2000/svg","g")),o1.setAttribute("transform",o),(o=o1.transform.baseVal.consolidate())?(o=o.matrix,HC(o.a,o.b,o.c,o.d,o.e,o.f)):i1)}function $F(o,i,l,c){function f(L){return L.length?L.pop()+" ":""}function r(L,U,Q,me,he,be){if(L!==Q||U!==me){var Ie=he.push("translate(",null,i,null,l);be.push({i:Ie-4,x:as(L,Q)},{i:Ie-2,x:as(U,me)})}else(Q||me)&&he.push("translate("+Q+i+me+l)}function w(L,U,Q,me){L!==U?(L-U>180?U+=360:U-L>180&&(L+=360),me.push({i:Q.push(f(Q)+"rotate(",null,c)-2,x:as(L,U)})):U&&Q.push(f(Q)+"rotate("+U+c)}function C(L,U,Q,me){L!==U?me.push({i:Q.push(f(Q)+"skewX(",null,c)-2,x:as(L,U)}):U&&Q.push(f(Q)+"skewX("+U+c)}function A(L,U,Q,me,he,be){if(L!==Q||U!==me){var Ie=he.push(f(he)+"scale(",null,",",null,")");be.push({i:Ie-4,x:as(L,Q)},{i:Ie-2,x:as(U,me)})}else(Q!==1||me!==1)&&he.push(f(he)+"scale("+Q+","+me+")")}return function(L,U){var Q=[],me=[];return L=o(L),U=o(U),r(L.translateX,L.translateY,U.translateX,U.translateY,Q,me),w(L.rotate,U.rotate,Q,me),C(L.skewX,U.skewX,Q,me),A(L.scaleX,L.scaleY,U.scaleX,U.scaleY,Q,me),L=U=null,function(he){for(var be=-1,Ie=me.length,Qe;++be<Ie;)Q[(Qe=me[be]).i]=Qe.x(he);return Q.join("")}}}var qC=$F(jF,"px, ","px)","deg)"),WC=$F(UF,", ",")",")");var hp=0,__=0,g_=0,HF=1e3,s1,y_,a1=0,Gh=0,l1=0,v_=typeof performance=="object"&&performance.now?performance:Date,qF=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(o){setTimeout(o,17)};function b_(){return Gh||(qF(L9),Gh=v_.now()+l1)}function L9(){Gh=0}function x_(){this._call=this._time=this._next=null}x_.prototype=dp.prototype={constructor:x_,restart:function(o,i,l){if(typeof o!="function")throw new TypeError("callback is not a function");l=(l==null?b_():+l)+(i==null?0:+i),!this._next&&y_!==this&&(y_?y_._next=this:s1=this,y_=this),this._call=o,this._time=l,ZC()},stop:function(){this._call&&(this._call=null,this._time=1/0,ZC())}};function dp(o,i,l){var c=new x_;return c.restart(o,i,l),c}function WF(){b_(),++hp;for(var o=s1,i;o;)(i=Gh-o._time)>=0&&o._call.call(void 0,i),o=o._next;--hp}function GF(){Gh=(a1=v_.now())+l1,hp=__=0;try{WF()}finally{hp=0,N9(),Gh=0}}function F9(){var o=v_.now(),i=o-a1;i>HF&&(l1-=i,a1=o)}function N9(){for(var o,i=s1,l,c=1/0;i;)i._call?(c>i._time&&(c=i._time),o=i,i=i._next):(l=i._next,i._next=null,i=o?o._next=l:s1=l);y_=o,ZC(c)}function ZC(o){if(!hp){__&&(__=clearTimeout(__));var i=o-Gh;i>24?(o<1/0&&(__=setTimeout(GF,o-v_.now()-l1)),g_&&(g_=clearInterval(g_))):(g_||(a1=v_.now(),g_=setInterval(F9,HF)),hp=1,qF(GF))}}function c1(o,i,l){var c=new x_;return i=i==null?0:+i,c.restart(f=>{c.stop(),o(f+i)},i,l),c}var z9=Bh("start","end","cancel","interrupt"),B9=[],YF=0,ZF=1,h1=2,u1=3,XF=4,d1=5,w_=6;function tu(o,i,l,c,f,r){var w=o.__transition;if(!w)o.__transition={};else if(l in w)return;V9(o,l,{name:i,index:c,group:f,on:z9,tween:B9,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:YF})}function E_(o,i){var l=Ei(o,i);if(l.state>YF)throw new Error("too late; already scheduled");return l}function zi(o,i){var l=Ei(o,i);if(l.state>u1)throw new Error("too late; already running");return l}function Ei(o,i){var l=o.__transition;if(!l||!(l=l[i]))throw new Error("transition not found");return l}function V9(o,i,l){var c=o.__transition,f;c[i]=l,l.timer=dp(r,0,l.time);function r(L){l.state=ZF,l.timer.restart(w,l.delay,l.time),l.delay<=L&&w(L-l.delay)}function w(L){var U,Q,me,he;if(l.state!==ZF)return A();for(U in c)if(he=c[U],he.name===l.name){if(he.state===u1)return c1(w);he.state===XF?(he.state=w_,he.timer.stop(),he.on.call("interrupt",o,o.__data__,he.index,he.group),delete c[U]):+U<i&&(he.state=w_,he.timer.stop(),he.on.call("cancel",o,o.__data__,he.index,he.group),delete c[U])}if(c1(function(){l.state===u1&&(l.state=XF,l.timer.restart(C,l.delay,l.time),C(L))}),l.state=h1,l.on.call("start",o,o.__data__,l.index,l.group),l.state===h1){for(l.state=u1,f=new Array(me=l.tween.length),U=0,Q=-1;U<me;++U)(he=l.tween[U].value.call(o,o.__data__,l.index,l.group))&&(f[++Q]=he);f.length=Q+1}}function C(L){for(var U=L<l.duration?l.ease.call(null,L/l.duration):(l.timer.restart(A),l.state=d1,1),Q=-1,me=f.length;++Q<me;)f[Q].call(o,U);l.state===d1&&(l.on.call("end",o,o.__data__,l.index,l.group),A())}function A(){l.state=w_,l.timer.stop(),delete c[i];for(var L in c)return;delete o.__transition}}function f1(o,i){var l=o.__transition,c,f,r=!0,w;if(l){i=i==null?null:i+"";for(w in l){if((c=l[w]).name!==i){r=!1;continue}f=c.state>h1&&c.state<d1,c.state=w_,c.timer.stop(),c.on.call(f?"interrupt":"cancel",o,o.__data__,c.index,c.group),delete l[w]}r&&delete o.__transition}}function KF(o){return this.each(function(){f1(this,o)})}function j9(o,i){var l,c;return function(){var f=zi(this,o),r=f.tween;if(r!==l){c=l=r;for(var w=0,C=c.length;w<C;++w)if(c[w].name===i){c=c.slice(),c.splice(w,1);break}}f.tween=c}}function U9(o,i,l){var c,f;if(typeof l!="function")throw new Error;return function(){var r=zi(this,o),w=r.tween;if(w!==c){f=(c=w).slice();for(var C={name:i,value:l},A=0,L=f.length;A<L;++A)if(f[A].name===i){f[A]=C;break}A===L&&f.push(C)}r.tween=f}}function QF(o,i){var l=this._id;if(o+="",arguments.length<2){for(var c=Ei(this.node(),l).tween,f=0,r=c.length,w;f<r;++f)if((w=c[f]).name===o)return w.value;return null}return this.each((i==null?j9:U9)(l,o,i))}function fp(o,i,l){var c=o._id;return o.each(function(){var f=zi(this,c);(f.value||(f.value={}))[i]=l.apply(this,arguments)}),function(f){return Ei(f,c).value[i]}}function p1(o,i){var l;return(typeof i=="number"?as:i instanceof eu?r1:(l=eu(i))?(i=l,r1):GC)(o,i)}function $9(o){return function(){this.removeAttribute(o)}}function G9(o){return function(){this.removeAttributeNS(o.space,o.local)}}function H9(o,i,l){var c,f=l+"",r;return function(){var w=this.getAttribute(o);return w===f?null:w===c?r:r=i(c=w,l)}}function q9(o,i,l){var c,f=l+"",r;return function(){var w=this.getAttributeNS(o.space,o.local);return w===f?null:w===c?r:r=i(c=w,l)}}function W9(o,i,l){var c,f,r;return function(){var w,C=l(this),A;return C==null?void this.removeAttribute(o):(w=this.getAttribute(o),A=C+"",w===A?null:w===c&&A===f?r:(f=A,r=i(c=w,C)))}}function Z9(o,i,l){var c,f,r;return function(){var w,C=l(this),A;return C==null?void this.removeAttributeNS(o.space,o.local):(w=this.getAttributeNS(o.space,o.local),A=C+"",w===A?null:w===c&&A===f?r:(f=A,r=i(c=w,C)))}}function JF(o,i){var l=ml(o),c=l==="transform"?WC:p1;return this.attrTween(o,typeof i=="function"?(l.local?Z9:W9)(l,c,fp(this,"attr."+o,i)):i==null?(l.local?G9:$9)(l):(l.local?q9:H9)(l,c,i))}function X9(o,i){return function(l){this.setAttribute(o,i.call(this,l))}}function Y9(o,i){return function(l){this.setAttributeNS(o.space,o.local,i.call(this,l))}}function K9(o,i){var l,c;function f(){var r=i.apply(this,arguments);return r!==c&&(l=(c=r)&&Y9(o,r)),l}return f._value=i,f}function Q9(o,i){var l,c;function f(){var r=i.apply(this,arguments);return r!==c&&(l=(c=r)&&X9(o,r)),l}return f._value=i,f}function eN(o,i){var l="attr."+o;if(arguments.length<2)return(l=this.tween(l))&&l._value;if(i==null)return this.tween(l,null);if(typeof i!="function")throw new Error;var c=ml(o);return this.tween(l,(c.local?K9:Q9)(c,i))}function J9(o,i){return function(){E_(this,o).delay=+i.apply(this,arguments)}}function e7(o,i){return i=+i,function(){E_(this,o).delay=i}}function tN(o){var i=this._id;return arguments.length?this.each((typeof o=="function"?J9:e7)(i,o)):Ei(this.node(),i).delay}function t7(o,i){return function(){zi(this,o).duration=+i.apply(this,arguments)}}function n7(o,i){return i=+i,function(){zi(this,o).duration=i}}function nN(o){var i=this._id;return arguments.length?this.each((typeof o=="function"?t7:n7)(i,o)):Ei(this.node(),i).duration}function r7(o,i){if(typeof i!="function")throw new Error;return function(){zi(this,o).ease=i}}function rN(o){var i=this._id;return arguments.length?this.each(r7(i,o)):Ei(this.node(),i).ease}function i7(o,i){return function(){var l=i.apply(this,arguments);if(typeof l!="function")throw new Error;zi(this,o).ease=l}}function iN(o){if(typeof o!="function")throw new Error;return this.each(i7(this._id,o))}function oN(o){typeof o!="function"&&(o=l_(o));for(var i=this._groups,l=i.length,c=new Array(l),f=0;f<l;++f)for(var r=i[f],w=r.length,C=c[f]=[],A,L=0;L<w;++L)(A=r[L])&&o.call(A,A.__data__,L,r)&&C.push(A);return new ro(c,this._parents,this._name,this._id)}function sN(o){if(o._id!==this._id)throw new Error;for(var i=this._groups,l=o._groups,c=i.length,f=l.length,r=Math.min(c,f),w=new Array(c),C=0;C<r;++C)for(var A=i[C],L=l[C],U=A.length,Q=w[C]=new Array(U),me,he=0;he<U;++he)(me=A[he]||L[he])&&(Q[he]=me);for(;C<c;++C)w[C]=i[C];return new ro(w,this._parents,this._name,this._id)}function o7(o){return(o+"").trim().split(/^|\s+/).every(function(i){var l=i.indexOf(".");return l>=0&&(i=i.slice(0,l)),!i||i==="start"})}function s7(o,i,l){var c,f,r=o7(i)?E_:zi;return function(){var w=r(this,o),C=w.on;C!==c&&(f=(c=C).copy()).on(i,l),w.on=f}}function aN(o,i){var l=this._id;return arguments.length<2?Ei(this.node(),l).on.on(o):this.each(s7(l,o,i))}function a7(o){return function(){var i=this.parentNode;for(var l in this.__transition)if(+l!==o)return;i&&i.removeChild(this)}}function lN(){return this.on("end.remove",a7(this._id))}function cN(o){var i=this._name,l=this._id;typeof o!="function"&&(o=Vh(o));for(var c=this._groups,f=c.length,r=new Array(f),w=0;w<f;++w)for(var C=c[w],A=C.length,L=r[w]=new Array(A),U,Q,me=0;me<A;++me)(U=C[me])&&(Q=o.call(U,U.__data__,me,C))&&("__data__"in U&&(Q.__data__=U.__data__),L[me]=Q,tu(L[me],i,l,me,L,Ei(U,l)));return new ro(r,this._parents,i,l)}function uN(o){var i=this._name,l=this._id;typeof o!="function"&&(o=a_(o));for(var c=this._groups,f=c.length,r=[],w=[],C=0;C<f;++C)for(var A=c[C],L=A.length,U,Q=0;Q<L;++Q)if(U=A[Q]){for(var me=o.call(U,U.__data__,Q,A),he,be=Ei(U,l),Ie=0,Qe=me.length;Ie<Qe;++Ie)(he=me[Ie])&&tu(he,i,l,Ie,me,be);r.push(me),w.push(U)}return new ro(r,w,i,l)}var l7=gl.prototype.constructor;function hN(){return new l7(this._groups,this._parents)}function c7(o,i){var l,c,f;return function(){var r=Qc(this,o),w=(this.style.removeProperty(o),Qc(this,o));return r===w?null:r===l&&w===c?f:f=i(l=r,c=w)}}function dN(o){return function(){this.style.removeProperty(o)}}function u7(o,i,l){var c,f=l+"",r;return function(){var w=Qc(this,o);return w===f?null:w===c?r:r=i(c=w,l)}}function h7(o,i,l){var c,f,r;return function(){var w=Qc(this,o),C=l(this),A=C+"";return C==null&&(A=C=(this.style.removeProperty(o),Qc(this,o))),w===A?null:w===c&&A===f?r:(f=A,r=i(c=w,C))}}function d7(o,i){var l,c,f,r="style."+i,w="end."+r,C;return function(){var A=zi(this,o),L=A.on,U=A.value[r]==null?C||(C=dN(i)):void 0;(L!==l||f!==U)&&(c=(l=L).copy()).on(w,f=U),A.on=c}}function fN(o,i,l){var c=(o+="")=="transform"?qC:p1;return i==null?this.styleTween(o,c7(o,c)).on("end.style."+o,dN(o)):typeof i=="function"?this.styleTween(o,h7(o,c,fp(this,"style."+o,i))).each(d7(this._id,o)):this.styleTween(o,u7(o,c,i),l).on("end.style."+o,null)}function f7(o,i,l){return function(c){this.style.setProperty(o,i.call(this,c),l)}}function p7(o,i,l){var c,f;function r(){var w=i.apply(this,arguments);return w!==f&&(c=(f=w)&&f7(o,w,l)),c}return r._value=i,r}function pN(o,i,l){var c="style."+(o+="");if(arguments.length<2)return(c=this.tween(c))&&c._value;if(i==null)return this.tween(c,null);if(typeof i!="function")throw new Error;return this.tween(c,p7(o,i,l??""))}function m7(o){return function(){this.textContent=o}}function g7(o){return function(){var i=o(this);this.textContent=i??""}}function mN(o){return this.tween("text",typeof o=="function"?g7(fp(this,"text",o)):m7(o==null?"":o+""))}function _7(o){return function(i){this.textContent=o.call(this,i)}}function y7(o){var i,l;function c(){var f=o.apply(this,arguments);return f!==l&&(i=(l=f)&&_7(f)),i}return c._value=o,c}function gN(o){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(o==null)return this.tween(i,null);if(typeof o!="function")throw new Error;return this.tween(i,y7(o))}function _N(){for(var o=this._name,i=this._id,l=m1(),c=this._groups,f=c.length,r=0;r<f;++r)for(var w=c[r],C=w.length,A,L=0;L<C;++L)if(A=w[L]){var U=Ei(A,i);tu(A,o,l,L,w,{time:U.time+U.delay+U.duration,delay:0,duration:U.duration,ease:U.ease})}return new ro(c,this._parents,o,l)}function yN(){var o,i,l=this,c=l._id,f=l.size();return new Promise(function(r,w){var C={value:w},A={value:function(){--f===0&&r()}};l.each(function(){var L=zi(this,c),U=L.on;U!==o&&(i=(o=U).copy(),i._.cancel.push(C),i._.interrupt.push(C),i._.end.push(A)),L.on=i}),f===0&&r()})}var v7=0;function ro(o,i,l,c){this._groups=o,this._parents=i,this._name=l,this._id=c}function vN(o){return gl().transition(o)}function m1(){return++v7}var _l=gl.prototype;ro.prototype=vN.prototype={constructor:ro,select:cN,selectAll:uN,selectChild:_l.selectChild,selectChildren:_l.selectChildren,filter:oN,merge:sN,selection:hN,transition:_N,call:_l.call,nodes:_l.nodes,node:_l.node,size:_l.size,empty:_l.empty,each:_l.each,on:aN,attr:JF,attrTween:eN,style:fN,styleTween:pN,text:mN,textTween:gN,remove:lN,tween:QF,delay:tN,duration:nN,ease:rN,easeVarying:iN,end:yN,[Symbol.iterator]:_l[Symbol.iterator]};function g1(o){return((o*=2)<=1?o*o*o:(o-=2)*o*o+2)/2}var x7={time:null,delay:0,duration:250,ease:g1};function b7(o,i){for(var l;!(l=o.__transition)||!(l=l[i]);)if(!(o=o.parentNode))throw new Error(`transition ${i} not found`);return l}function xN(o){var i,l;o instanceof ro?(i=o._id,o=o._name):(i=m1(),(l=x7).time=b_(),o=o==null?null:o+"");for(var c=this._groups,f=c.length,r=0;r<f;++r)for(var w=c[r],C=w.length,A,L=0;L<C;++L)(A=w[L])&&tu(A,o,i,L,w,l||b7(A,i));return new ro(c,this._parents,o,i)}gl.prototype.interrupt=KF;gl.prototype.transition=xN;var{abs:xae,max:bae,min:wae}=Math;function bN(o){return[+o[0],+o[1]]}function w7(o){return[bN(o[0]),bN(o[1])]}var Eae={name:"x",handles:["w","e"].map(XC),input:function(o,i){return o==null?null:[[+o[0],i[0][1]],[+o[1],i[1][1]]]},output:function(o){return o&&[o[0][0],o[1][0]]}},Tae={name:"y",handles:["n","s"].map(XC),input:function(o,i){return o==null?null:[[i[0][0],+o[0]],[i[1][0],+o[1]]]},output:function(o){return o&&[o[0][1],o[1][1]]}},Sae={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(XC),input:function(o){return o==null?null:w7(o)},output:function(o){return o}};function XC(o){return{type:o}}function wN(o){let i=+this._x.call(null,o),l=+this._y.call(null,o);return EN(this.cover(i,l),i,l,o)}function EN(o,i,l,c){if(isNaN(i)||isNaN(l))return o;var f,r=o._root,w={data:c},C=o._x0,A=o._y0,L=o._x1,U=o._y1,Q,me,he,be,Ie,Qe,ze,nt;if(!r)return o._root=w,o;for(;r.length;)if((Ie=i>=(Q=(C+L)/2))?C=Q:L=Q,(Qe=l>=(me=(A+U)/2))?A=me:U=me,f=r,!(r=r[ze=Qe<<1|Ie]))return f[ze]=w,o;if(he=+o._x.call(null,r.data),be=+o._y.call(null,r.data),i===he&&l===be)return w.next=r,f?f[ze]=w:o._root=w,o;do f=f?f[ze]=new Array(4):o._root=new Array(4),(Ie=i>=(Q=(C+L)/2))?C=Q:L=Q,(Qe=l>=(me=(A+U)/2))?A=me:U=me;while((ze=Qe<<1|Ie)===(nt=(be>=me)<<1|he>=Q));return f[nt]=r,f[ze]=w,o}function TN(o){var i,l,c=o.length,f,r,w=new Array(c),C=new Array(c),A=1/0,L=1/0,U=-1/0,Q=-1/0;for(l=0;l<c;++l)isNaN(f=+this._x.call(null,i=o[l]))||isNaN(r=+this._y.call(null,i))||(w[l]=f,C[l]=r,f<A&&(A=f),f>U&&(U=f),r<L&&(L=r),r>Q&&(Q=r));if(A>U||L>Q)return this;for(this.cover(A,L).cover(U,Q),l=0;l<c;++l)EN(this,w[l],C[l],o[l]);return this}function SN(o,i){if(isNaN(o=+o)||isNaN(i=+i))return this;var l=this._x0,c=this._y0,f=this._x1,r=this._y1;if(isNaN(l))f=(l=Math.floor(o))+1,r=(c=Math.floor(i))+1;else{for(var w=f-l||1,C=this._root,A,L;l>o||o>=f||c>i||i>=r;)switch(L=(i<c)<<1|o<l,A=new Array(4),A[L]=C,C=A,w*=2,L){case 0:f=l+w,r=c+w;break;case 1:l=f-w,r=c+w;break;case 2:f=l+w,c=r-w;break;case 3:l=f-w,c=r-w;break}this._root&&this._root.length&&(this._root=C)}return this._x0=l,this._y0=c,this._x1=f,this._y1=r,this}function CN(){var o=[];return this.visit(function(i){if(!i.length)do o.push(i.data);while(i=i.next)}),o}function IN(o){return arguments.length?this.cover(+o[0][0],+o[0][1]).cover(+o[1][0],+o[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Pi(o,i,l,c,f){this.node=o,this.x0=i,this.y0=l,this.x1=c,this.y1=f}function DN(o,i,l){var c,f=this._x0,r=this._y0,w,C,A,L,U=this._x1,Q=this._y1,me=[],he=this._root,be,Ie;for(he&&me.push(new Pi(he,f,r,U,Q)),l==null?l=1/0:(f=o-l,r=i-l,U=o+l,Q=i+l,l*=l);be=me.pop();)if(!(!(he=be.node)||(w=be.x0)>U||(C=be.y0)>Q||(A=be.x1)<f||(L=be.y1)<r))if(he.length){var Qe=(w+A)/2,ze=(C+L)/2;me.push(new Pi(he[3],Qe,ze,A,L),new Pi(he[2],w,ze,Qe,L),new Pi(he[1],Qe,C,A,ze),new Pi(he[0],w,C,Qe,ze)),(Ie=(i>=ze)<<1|o>=Qe)&&(be=me[me.length-1],me[me.length-1]=me[me.length-1-Ie],me[me.length-1-Ie]=be)}else{var nt=o-+this._x.call(null,he.data),ft=i-+this._y.call(null,he.data),Ue=nt*nt+ft*ft;if(Ue<l){var Nt=Math.sqrt(l=Ue);f=o-Nt,r=i-Nt,U=o+Nt,Q=i+Nt,c=he.data}}return c}function MN(o){if(isNaN(U=+this._x.call(null,o))||isNaN(Q=+this._y.call(null,o)))return this;var i,l=this._root,c,f,r,w=this._x0,C=this._y0,A=this._x1,L=this._y1,U,Q,me,he,be,Ie,Qe,ze;if(!l)return this;if(l.length)for(;;){if((be=U>=(me=(w+A)/2))?w=me:A=me,(Ie=Q>=(he=(C+L)/2))?C=he:L=he,i=l,!(l=l[Qe=Ie<<1|be]))return this;if(!l.length)break;(i[Qe+1&3]||i[Qe+2&3]||i[Qe+3&3])&&(c=i,ze=Qe)}for(;l.data!==o;)if(f=l,!(l=l.next))return this;return(r=l.next)&&delete l.next,f?(r?f.next=r:delete f.next,this):i?(r?i[Qe]=r:delete i[Qe],(l=i[0]||i[1]||i[2]||i[3])&&l===(i[3]||i[2]||i[1]||i[0])&&!l.length&&(c?c[ze]=l:this._root=l),this):(this._root=r,this)}function AN(o){for(var i=0,l=o.length;i<l;++i)this.remove(o[i]);return this}function PN(){return this._root}function RN(){var o=0;return this.visit(function(i){if(!i.length)do++o;while(i=i.next)}),o}function ON(o){var i=[],l,c=this._root,f,r,w,C,A;for(c&&i.push(new Pi(c,this._x0,this._y0,this._x1,this._y1));l=i.pop();)if(!o(c=l.node,r=l.x0,w=l.y0,C=l.x1,A=l.y1)&&c.length){var L=(r+C)/2,U=(w+A)/2;(f=c[3])&&i.push(new Pi(f,L,U,C,A)),(f=c[2])&&i.push(new Pi(f,r,U,L,A)),(f=c[1])&&i.push(new Pi(f,L,w,C,U)),(f=c[0])&&i.push(new Pi(f,r,w,L,U))}return this}function kN(o){var i=[],l=[],c;for(this._root&&i.push(new Pi(this._root,this._x0,this._y0,this._x1,this._y1));c=i.pop();){var f=c.node;if(f.length){var r,w=c.x0,C=c.y0,A=c.x1,L=c.y1,U=(w+A)/2,Q=(C+L)/2;(r=f[0])&&i.push(new Pi(r,w,C,U,Q)),(r=f[1])&&i.push(new Pi(r,U,C,A,Q)),(r=f[2])&&i.push(new Pi(r,w,Q,U,L)),(r=f[3])&&i.push(new Pi(r,U,Q,A,L))}l.push(c)}for(;c=l.pop();)o(c.node,c.x0,c.y0,c.x1,c.y1);return this}function LN(o){return o[0]}function FN(o){return arguments.length?(this._x=o,this):this._x}function NN(o){return o[1]}function zN(o){return arguments.length?(this._y=o,this):this._y}function Hh(o,i,l){var c=new YC(i??LN,l??NN,NaN,NaN,NaN,NaN);return o==null?c:c.addAll(o)}function YC(o,i,l,c,f,r){this._x=o,this._y=i,this._x0=l,this._y0=c,this._x1=f,this._y1=r,this._root=void 0}function BN(o){for(var i={data:o.data},l=i;o=o.next;)l=l.next={data:o.data};return i}var io=Hh.prototype=YC.prototype;io.copy=function(){var o=new YC(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root,l,c;if(!i)return o;if(!i.length)return o._root=BN(i),o;for(l=[{source:i,target:o._root=new Array(4)}];i=l.pop();)for(var f=0;f<4;++f)(c=i.source[f])&&(c.length?l.push({source:c,target:i.target[f]=new Array(4)}):i.target[f]=BN(c));return o};io.add=wN;io.addAll=TN;io.cover=SN;io.data=CN;io.extent=IN;io.find=DN;io.remove=MN;io.removeAll=AN;io.root=PN;io.size=RN;io.visit=ON;io.visitAfter=kN;io.x=FN;io.y=zN;function Wi(o){return function(){return o}}function nu(o){return(o()-.5)*1e-6}function E7(o){return o.x+o.vx}function T7(o){return o.y+o.vy}function T_(o){var i,l,c,f=1,r=1;typeof o!="function"&&(o=Wi(o==null?1:+o));function w(){for(var L,U=i.length,Q,me,he,be,Ie,Qe,ze=0;ze<r;++ze)for(Q=Hh(i,E7,T7).visitAfter(C),L=0;L<U;++L)me=i[L],Ie=l[me.index],Qe=Ie*Ie,he=me.x+me.vx,be=me.y+me.vy,Q.visit(nt);function nt(ft,Ue,Nt,Yt,Jt){var Et=ft.data,tr=ft.r,Ct=Ie+tr;if(Et){if(Et.index>me.index){var _r=he-Et.x-Et.vx,br=be-Et.y-Et.vy,zr=_r*_r+br*br;zr<Ct*Ct&&(_r===0&&(_r=nu(c),zr+=_r*_r),br===0&&(br=nu(c),zr+=br*br),zr=(Ct-(zr=Math.sqrt(zr)))/zr*f,me.vx+=(_r*=zr)*(Ct=(tr*=tr)/(Qe+tr)),me.vy+=(br*=zr)*Ct,Et.vx-=_r*(Ct=1-Ct),Et.vy-=br*Ct)}return}return Ue>he+Ct||Yt<he-Ct||Nt>be+Ct||Jt<be-Ct}}function C(L){if(L.data)return L.r=l[L.data.index];for(var U=L.r=0;U<4;++U)L[U]&&L[U].r>L.r&&(L.r=L[U].r)}function A(){if(i){var L,U=i.length,Q;for(l=new Array(U),L=0;L<U;++L)Q=i[L],l[Q.index]=+o(Q,L,i)}}return w.initialize=function(L,U){i=L,c=U,A()},w.iterations=function(L){return arguments.length?(r=+L,w):r},w.strength=function(L){return arguments.length?(f=+L,w):f},w.radius=function(L){return arguments.length?(o=typeof L=="function"?L:Wi(+L),A(),w):o},w}function VN(){let o=1;return()=>(o=(1664525*o+1013904223)%4294967296)/4294967296}function jN(o){return o.x}function UN(o){return o.y}var S7=10,C7=Math.PI*(3-Math.sqrt(5));function S_(o){var i,l=1,c=.001,f=1-Math.pow(c,1/300),r=0,w=.6,C=new Map,A=dp(Q),L=Bh("tick","end"),U=VN();o==null&&(o=[]);function Q(){me(),L.call("tick",i),l<c&&(A.stop(),L.call("end",i))}function me(Ie){var Qe,ze=o.length,nt;Ie===void 0&&(Ie=1);for(var ft=0;ft<Ie;++ft)for(l+=(r-l)*f,C.forEach(function(Ue){Ue(l)}),Qe=0;Qe<ze;++Qe)nt=o[Qe],nt.fx==null?nt.x+=nt.vx*=w:(nt.x=nt.fx,nt.vx=0),nt.fy==null?nt.y+=nt.vy*=w:(nt.y=nt.fy,nt.vy=0);return i}function he(){for(var Ie=0,Qe=o.length,ze;Ie<Qe;++Ie){if(ze=o[Ie],ze.index=Ie,ze.fx!=null&&(ze.x=ze.fx),ze.fy!=null&&(ze.y=ze.fy),isNaN(ze.x)||isNaN(ze.y)){var nt=S7*Math.sqrt(.5+Ie),ft=Ie*C7;ze.x=nt*Math.cos(ft),ze.y=nt*Math.sin(ft)}(isNaN(ze.vx)||isNaN(ze.vy))&&(ze.vx=ze.vy=0)}}function be(Ie){return Ie.initialize&&Ie.initialize(o,U),Ie}return he(),i={tick:me,restart:function(){return A.restart(Q),i},stop:function(){return A.stop(),i},nodes:function(Ie){return arguments.length?(o=Ie,he(),C.forEach(be),i):o},alpha:function(Ie){return arguments.length?(l=+Ie,i):l},alphaMin:function(Ie){return arguments.length?(c=+Ie,i):c},alphaDecay:function(Ie){return arguments.length?(f=+Ie,i):+f},alphaTarget:function(Ie){return arguments.length?(r=+Ie,i):r},velocityDecay:function(Ie){return arguments.length?(w=1-Ie,i):1-w},randomSource:function(Ie){return arguments.length?(U=Ie,C.forEach(be),i):U},force:function(Ie,Qe){return arguments.length>1?(Qe==null?C.delete(Ie):C.set(Ie,be(Qe)),i):C.get(Ie)},find:function(Ie,Qe,ze){var nt=0,ft=o.length,Ue,Nt,Yt,Jt,Et;for(ze==null?ze=1/0:ze*=ze,nt=0;nt<ft;++nt)Jt=o[nt],Ue=Ie-Jt.x,Nt=Qe-Jt.y,Yt=Ue*Ue+Nt*Nt,Yt<ze&&(Et=Jt,ze=Yt);return Et},on:function(Ie,Qe){return arguments.length>1?(L.on(Ie,Qe),i):L.on(Ie)}}}function C_(){var o,i,l,c,f=Wi(-30),r,w=1,C=1/0,A=.81;function L(he){var be,Ie=o.length,Qe=Hh(o,jN,UN).visitAfter(Q);for(c=he,be=0;be<Ie;++be)i=o[be],Qe.visit(me)}function U(){if(o){var he,be=o.length,Ie;for(r=new Array(be),he=0;he<be;++he)Ie=o[he],r[Ie.index]=+f(Ie,he,o)}}function Q(he){var be=0,Ie,Qe,ze=0,nt,ft,Ue;if(he.length){for(nt=ft=Ue=0;Ue<4;++Ue)(Ie=he[Ue])&&(Qe=Math.abs(Ie.value))&&(be+=Ie.value,ze+=Qe,nt+=Qe*Ie.x,ft+=Qe*Ie.y);he.x=nt/ze,he.y=ft/ze}else{Ie=he,Ie.x=Ie.data.x,Ie.y=Ie.data.y;do be+=r[Ie.data.index];while(Ie=Ie.next)}he.value=be}function me(he,be,Ie,Qe){if(!he.value)return!0;var ze=he.x-i.x,nt=he.y-i.y,ft=Qe-be,Ue=ze*ze+nt*nt;if(ft*ft/A<Ue)return Ue<C&&(ze===0&&(ze=nu(l),Ue+=ze*ze),nt===0&&(nt=nu(l),Ue+=nt*nt),Ue<w&&(Ue=Math.sqrt(w*Ue)),i.vx+=ze*he.value*c/Ue,i.vy+=nt*he.value*c/Ue),!0;if(he.length||Ue>=C)return;(he.data!==i||he.next)&&(ze===0&&(ze=nu(l),Ue+=ze*ze),nt===0&&(nt=nu(l),Ue+=nt*nt),Ue<w&&(Ue=Math.sqrt(w*Ue)));do he.data!==i&&(ft=r[he.data.index]*c/Ue,i.vx+=ze*ft,i.vy+=nt*ft);while(he=he.next)}return L.initialize=function(he,be){o=he,l=be,U()},L.strength=function(he){return arguments.length?(f=typeof he=="function"?he:Wi(+he),U(),L):f},L.distanceMin=function(he){return arguments.length?(w=he*he,L):Math.sqrt(w)},L.distanceMax=function(he){return arguments.length?(C=he*he,L):Math.sqrt(C)},L.theta=function(he){return arguments.length?(A=he*he,L):Math.sqrt(A)},L}function I_(o){var i=Wi(.1),l,c,f;typeof o!="function"&&(o=Wi(o==null?0:+o));function r(C){for(var A=0,L=l.length,U;A<L;++A)U=l[A],U.vx+=(f[A]-U.x)*c[A]*C}function w(){if(l){var C,A=l.length;for(c=new Array(A),f=new Array(A),C=0;C<A;++C)c[C]=isNaN(f[C]=+o(l[C],C,l))?0:+i(l[C],C,l)}}return r.initialize=function(C){l=C,w()},r.strength=function(C){return arguments.length?(i=typeof C=="function"?C:Wi(+C),w(),r):i},r.x=function(C){return arguments.length?(o=typeof C=="function"?C:Wi(+C),w(),r):o},r}function D_(o){var i=Wi(.1),l,c,f;typeof o!="function"&&(o=Wi(o==null?0:+o));function r(C){for(var A=0,L=l.length,U;A<L;++A)U=l[A],U.vy+=(f[A]-U.y)*c[A]*C}function w(){if(l){var C,A=l.length;for(c=new Array(A),f=new Array(A),C=0;C<A;++C)c[C]=isNaN(f[C]=+o(l[C],C,l))?0:+i(l[C],C,l)}}return r.initialize=function(C){l=C,w()},r.strength=function(C){return arguments.length?(i=typeof C=="function"?C:Wi(+C),w(),r):i},r.y=function(C){return arguments.length?(o=typeof C=="function"?C:Wi(+C),w(),r):o},r}function ru(o,i,l){this.k=o,this.x=i,this.y=l}ru.prototype={constructor:ru,scale:function(o){return o===1?this:new ru(this.k*o,this.x,this.y)},translate:function(o,i){return o===0&i===0?this:new ru(this.k,this.x+this.k*o,this.y+this.k*i)},apply:function(o){return[o[0]*this.k+this.x,o[1]*this.k+this.y]},applyX:function(o){return o*this.k+this.x},applyY:function(o){return o*this.k+this.y},invert:function(o){return[(o[0]-this.x)/this.k,(o[1]-this.y)/this.k]},invertX:function(o){return(o-this.x)/this.k},invertY:function(o){return(o-this.y)/this.k},rescaleX:function(o){return o.copy().domain(o.range().map(this.invertX,this).map(o.invert,o))},rescaleY:function(o){return o.copy().domain(o.range().map(this.invertY,this).map(o.invert,o))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var KC=new ru(1,0,0);QC.prototype=ru.prototype;function QC(o){for(;!o.__zoom;)if(!(o=o.parentNode))return KC;return o.__zoom}var tI=tE(_1());var yl=(()=>{let i=class i{constructor(){this.ACCESS_TOKEN="pk.eyJ1Ijoidml0YWxpaS1iaWxpbnNreWkiLCJhIjoiY2x5OGZqZDdsMDVjMjJucGh5Z2w3MmgzZSJ9.nKkXDgd7Q8u4sBZt_bsRrQ",this.mapStyle="mapbox://styles/vitalii-bilinskyi/cly8fp05900fz01pfaajw4fqa",this.map=null,this.source=null,this.layers=[],this.icons=[],this.showSensorData=new vi(!1),this.canvas=null,this.svg=null,this.height=window.innerWidth,this.width=window.innerHeight}setMap(c){this.map||(this.map=c)}setSource(c){this.source=c}setMapStyle(c){this.mapStyle=c}initializeMap(c){let A=c,{container:f,zoom:r,center:w}=A,C=ns(A,["container","zoom","center"]);this.map=new tI.default.Map(vt({accessToken:this.ACCESS_TOKEN,container:f,style:this.mapStyle,zoom:r??12,center:w},C))}addSource(c,f){if(!this.map)throw new Error("Set map before adding source!");let U=f,{data:r,cluster:w,clusterMaxZoom:C,clusterRadius:A}=U,L=ns(U,["data","cluster","clusterMaxZoom","clusterRadius"]);this.map.addSource(c,vt({type:"geojson",data:r,cluster:w,clusterMaxZoom:C??13,clusterRadius:A??100},L)),this.source=c}generatePointLayer(c){if(this.showUnconfiguredMapServiceErrors("creating point layer!"),Array.isArray(c))for(let f of c)this.createPointLayer(f);else this.createPointLayer(c)}createPointLayer(c){let U=c,{id:f,iconId:r,filter:w,layout:C,onPointClickHandler:A}=U,L=ns(U,["id","iconId","filter","layout","onPointClickHandler"]);this.map.addLayer(vt({id:f,type:"symbol",source:this.source,filter:w,layout:vt({"icon-image":r,"icon-allow-overlap":!0},C)},L)),A&&this.map.on("click",f,Q=>{A(Q,this.map,f),this.showSensorData.next(!0)}),this.layers.push(c.id),this.icons.push(c.iconId)}generateClusterLayer(c){if(this.showUnconfiguredMapServiceErrors("creating cluster layer!"),Array.isArray(c))for(let f of c)this.createClusterLayer(f);else this.createClusterLayer(c)}createClusterLayer(c){let L=c,{id:f,filter:r,paint:w,onClusterClickHandler:C}=L,A=ns(L,["id","filter","paint","onClusterClickHandler"]);this.map.addLayer(vt({id:f,type:"circle",source:this.source,filter:r,paint:vt({"circle-color":"#cd5dfc","circle-radius":20},w)},A)),this.layers.push(c.id),C&&this.map.on("click",f,U=>C(U,this.map,f))}drawD3JSCircles(){if(this.canvas=this.map.getCanvasContainer(),this.svg=no(".mapboxgl-canvas-container").append("div").style("view-transition-name","cube").style("position","absolute").style("width","100%").style("height",`${this.height}px`).style("top","0px").style("left","0px").append("svg").attr("width","100%").attr("height",this.height).style("position","absolute").style("left",0),!this.map?.getSource("workspaces")){console.error("GeoJSON source not found");return}let f=this.map?.querySourceFeatures("workspaces",{filter:["==","alarmLevel","high"]}),r=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-high"]}),w=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-moderate"]}),C=GN(r,"id"),A=GN(w,"id");console.log("uniqueFeatures1",C),console.log("uniqueFeatures2",A);let L=[...C,...A],U=C?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),Q=A?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),me=[...U,...Q];if(console.log("dataToSave",me),localStorage.setItem("pointsCoords",JSON.stringify(me)),L&&this.svg){let he=this.svg.selectAll("circle.point").data(L).enter().append("circle").attr("class","point").attr("cx",be=>this.project(be.geometry.coordinates).x).attr("cy",be=>this.project(be.geometry.coordinates).y).attr("r",5).attr("fill","red")}}project(c){return this.map?.project(new tI.default.LngLat(+c[0],+c[1]))}showUnconfiguredMapServiceErrors(c){if(!this.map)throw new Error(`Set map before ${c}`);if(!this.source)throw new Error(`Set source before ${c}`)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function GN(o,i){let l=new Set,c=[];for(let f of o){let r=f.properties[i];console.log("eature.properties[comparatorProperty];",f.properties),l.has(r)||(l.add(r),c.push(f))}return c}function I7(o,i){if(o&1){let l=WO();In(0,"app-sensor-details",3),Hr("hideDetails",function(f){RR(l);let r=ZO();return OR(r.hideDetails(f))}),Cn()}o&2&&Fr("@enter",void 0)("@fadeOutOnLeave",void 0)}var qN=(()=>{let i=class i{constructor(c,f){this.mockDataService=c,this.mapService=f,this.lat=50.049683,this.lng=19.944544,this.zoomLevel=12,this.dotSize=100,this.context=null,this.pulsingDot_low=null,this.pulsingDot_moderate=null,this.pulsingDot_high=null,this.pulsingDot_sevire=null,this.canvas_low=document.createElement("canvas"),this.canvas_moderate=document.createElement("canvas"),this.canvas_high=document.createElement("canvas"),this.canvas_sevire=document.createElement("canvas"),this.showSensorDetails=!1,this.mapService.showSensorData?.subscribe(r=>{this.showSensorDetails=r})}hideDetails(c){this.showSensorDetails=!c}ngOnInit(){this.mockDataService.getAllLocations().then(c=>{this.mockData=HN([...c]),this.renderMap()}).catch(c=>{console.error("Failed to fetch mock data",c),this.mockData=HN([...ML]),this.renderMap()})}renderMap(){this.getSavedMapData(),this.mapService.initializeMap({container:"map",zoom:this.zoomLevel,center:[this.lng,this.lat],minZoom:4}),this.createPusingDots(),this.onMapLoadHandler()}getSavedMapData(){try{let c=localStorage.getItem("center");if(console.log(c),c){let r=JSON.parse(c);this.lng=r.lng,this.lat=r.lat}let f=localStorage.getItem("zoomLevel");if(console.log(f),f){let r=JSON.parse(f);this.zoomLevel=r}}catch(c){console.log("getCenterOfMap Exception: ",c)}}createPusingDots(){this.checkMapInitialization(),this.canvas_low.className="canvas_low",this.pulsingDot_low=s_("#B3ECCD",this.mapService.map,this.canvas_low),this.canvas_moderate.className="canvas_moderate",this.pulsingDot_moderate=s_("#FFEB82",this.mapService.map,this.canvas_moderate),this.canvas_high.className="canvas_high",this.pulsingDot_high=s_("#ffb682",this.mapService.map,this.canvas_high),this.canvas_sevire.className="canvas_sevire",this.pulsingDot_sevire=s_("#ECC6EF",this.mapService.map,this.canvas_sevire,!0)}onMapLoadHandler(){this.checkMapInitialization(),this.mapService.map.on("load",()=>{this.pulsingDot_low&&this.mapService.map.addImage("pulsingDot_low",this.pulsingDot_low,{pixelRatio:2}),this.pulsingDot_moderate&&this.mapService.map.addImage("pulsingDot_moderate",this.pulsingDot_moderate,{pixelRatio:2}),this.pulsingDot_high&&this.mapService.map.addImage("pulsingDot_high",this.pulsingDot_high,{pixelRatio:2}),this.pulsingDot_sevire&&this.mapService.map.addImage("pulsingDot_sevire",this.pulsingDot_sevire,{pixelRatio:2}),this.mapService.addSource("workspaces",{data:this.mockData,cluster:!0}),this.drawData()})}drawData(){this.mapService.generateClusterLayer({id:"clusters",filter:["has","point_count"],paint:{"circle-radius":20},onClusterClickHandler:this.onClusterClickHandler}),this.mapService.map.addLayer({id:"cluster-count",type:"symbol",source:"workspaces",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"white"}});let c=[{id:"unclustered-point-animated-sevire",filter:["==","alarmLevel","sevire"],iconId:"pulsingDot_sevire",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-high",filter:["==","alarmLevel","high"],iconId:"pulsingDot_high",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-moderate",filter:["==","alarmLevel","moderate"],iconId:"pulsingDot_moderate",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-low",filter:["==","alarmLevel","low"],iconId:"pulsingDot_low",onPointClickHandler:this.onUnlcusteredPointClickHandler}];this.mapService.generatePointLayer(c)}onClusterClickHandler(c,f,r){let w=f.queryRenderedFeatures(c.point,{layers:[r]});if(w&&w[0]&&w[0]?.properties){let C=w[0]?.properties.cluster_id;if(C){let A=f.getSource("workspaces"),L=f.getZoom();A?.getClusterExpansionZoom(C,(U,Q)=>{U||!Q||w[0].geometry.type==="Point"&&f.easeTo({center:w[0].geometry.coordinates,zoom:Q,duration:L<=8?2e3:L<=10?1500:1e3,linear:!0})})}}}onUnlcusteredPointClickHandler(c,f,r){let w=f.queryRenderedFeatures(c.point,{layers:[r]});if(w&&w[0]){let C=w[0];if(console.log(C),C.geometry.type==="Point"){let A={center:[C.geometry.coordinates[0],C.geometry.coordinates[1]],zoom:18};f.flyTo(lr(vt({},A),{duration:2500,essential:!0}))}}}checkMapInitialization(){if(!this.mapService.map)throw new Error("Map is not initialized")}};i.\u0275fac=function(f){return new(f||i)(nr(OC),nr(yl))},i.\u0275cmp=Lr({type:i,selectors:[["map-view"]],standalone:!0,features:[ax([]),Nr],decls:3,vars:3,consts:[["id","map",1,"match-parent"],[2,"position","absolute","top","100px","left","100px","z-index","999"],[3,"hideDetails",4,"ngIf"],[3,"hideDetails"]],template:function(f,r){f&1&&(er(0,"div",0)(1,"div",1),pl(2,I7,1,2,"app-sensor-details",2)),f&2&&(vr(),Hf("view-transition-name","cube"),vr(),Fr("ngIf",r.showSensorDetails))},dependencies:[bx,wi,fx,RC],styles:['.match-parent[_ngcontent-%COMP%]{width:100%;height:100%}#map[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;display:block;z-index:10;pointer-events:none;-webkit-box-shadow:inset 0 0 70px 60px white;-moz-box-shadow:inset 0 0 70px 60px white;box-shadow:inset 0 0 70px 60px #fff}[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}']});let o=i;return o})(),HN=o=>{let i=[],l=["high","moderate","low"];return o.forEach(c=>{i.push({type:"Feature",id:c.id,properties:{numberOfDevices:c.devices?.length,alarmLevel:c.id==="6"?"sevire":l[Math.floor(Math.random()*l.length)],id:c.id},geometry:{type:"Point",coordinates:[c.longitude,c.latitude]}})}),{type:"FeatureCollection",features:[...i]}};var Pr=function(o){return o[o.GROUP=0]="GROUP",o[o.DEVICE=1]="DEVICE",o}(Pr||{}),Wr=function(o){return o[o.LATCH=0]="LATCH",o[o.BATTERY=1]="BATTERY",o[o.SIGNAL=2]="SIGNAL",o[o.HUMIDITY=3]="HUMIDITY",o[o.TEMPERATURE=4]="TEMPERATURE",o}(Wr||{}),$n=function(o){return o[o.LOW=0]="LOW",o[o.MODERATE=1]="MODERATE",o[o.HIGH=2]="HIGH",o[o.SEVIRE=3]="SEVIRE",o}($n||{}),D7=[{id:"id1.1",type:Pr.GROUP,deviceType:Wr.LATCH,name:"Latch",r:75},{id:"id1.2",type:Pr.GROUP,deviceType:Wr.TEMPERATURE,name:"Temperature",r:75},{id:"id1.3",type:Pr.GROUP,deviceType:Wr.BATTERY,name:"Battery",r:75},{id:"id1.4",type:Pr.GROUP,deviceType:Wr.HUMIDITY,name:"Humidity",r:75},{id:"id1.5",type:Pr.GROUP,deviceType:Wr.SIGNAL,name:"Signal",r:75},{id:"id1.1.1",type:Pr.DEVICE,deviceType:Wr.LATCH,name:"DEVICE_0",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:$n.HIGH},{id:"2",message:"Something wrong with case",priority:$n.LOW},{id:"3",message:"Something wrong with signal",priority:$n.MODERATE}]},{id:"id1.1.2",type:Pr.DEVICE,deviceType:Wr.LATCH,name:"DEVICE_1",r:30,alarms:[{id:"1",message:"Something wrong with latch",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.MODERATE},{id:"3",message:"Something wrong with signal",priority:$n.HIGH}]},{id:"id1.2.1",type:Pr.DEVICE,deviceType:Wr.TEMPERATURE,name:"DEVICE_2",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:$n.SEVIRE},{id:"2",message:"Something wrong with case",priority:$n.HIGH},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.2.2",type:Pr.DEVICE,deviceType:Wr.TEMPERATURE,name:"DEVICE_3",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:$n.LOW},{id:"2",message:"Something wrong with case",priority:$n.LOW},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.2.3",type:Pr.DEVICE,deviceType:Wr.TEMPERATURE,name:"DEVICE_4",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:$n.HIGH},{id:"2",message:"Something wrong with case",priority:$n.SEVIRE},{id:"3",message:"Something wrong with signal",priority:$n.SEVIRE}]},{id:"id1.3.1",type:Pr.DEVICE,deviceType:Wr.BATTERY,name:"DEVICE_5",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.MODERATE},{id:"3",message:"Something wrong with signal",priority:$n.MODERATE}]},{id:"id1.4.1",type:Pr.DEVICE,deviceType:Wr.HUMIDITY,name:"DEVICE_6",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:$n.LOW},{id:"2",message:"Something wrong with case",priority:$n.MODERATE},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.4.2",type:Pr.DEVICE,deviceType:Wr.HUMIDITY,name:"DEVICE_7",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:$n.SEVIRE},{id:"2",message:"Something wrong with case",priority:$n.SEVIRE},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.5.1",type:Pr.DEVICE,deviceType:Wr.SIGNAL,name:"DEVICE_8",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.SEVIRE},{id:"3",message:"Something wrong with signal",priority:$n.HIGH}]},{id:"id1.5.2",type:Pr.DEVICE,deviceType:Wr.SIGNAL,name:"DEVICE_9",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.HIGH},{id:"3",message:"Something wrong with signal",priority:$n.HIGH}]},{id:"id1.5.3",type:Pr.DEVICE,deviceType:Wr.SIGNAL,name:"DEVICE_10",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:$n.HIGH},{id:"2",message:"Something wrong with case",priority:$n.LOW},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]}];function WN(o,i){return Math.floor(Math.random()*(i-o+1)+o)}var nI=(()=>{let i=class i{constructor(c){this.mapService=c,this.simulation=new Map,this.svg=null,this.nodeGroup=null,this.nodes=[],this.textGroup=null,this.texts=[],this.iconGroup=null,this.icons=[],this.center={x:window.innerWidth/2,y:window.innerHeight/2},this.xAxis=[],this.groups=this.calculateGroups("deviceType")}ngOnInit(){this.createSVGGroups(),this.loadSimulations(),this.restartSimulations()}createSVGGroups(){let c=no(".bubbles");this.svg=c.append("svg").attr("class","gravity-container").attr("viewBox",[-this.center.y,-this.center.x,window.innerHeight,window.innerWidth]).style("height",window.innerHeight).style("width",window.innerWidth),this.nodeGroup=this.svg.append("g").attr("class","bubbles-layer"),this.textGroup=this.svg.append("g").attr("class","text-layer"),this.iconGroup=this.svg.append("g").attr("class","icon-layer"),this.groups.forEach((f,r)=>{let w=(be,Ie)=>{be.active||this.simulation.get(r)?.alphaTarget(.3).restart(),Ie.fx=Ie.x,Ie.fy=Ie.y},C=(be,Ie)=>{Ie.fx=be.x,Ie.fy=be.y},A=(be,Ie)=>{be.active||this.simulation.get(r)?.alphaTarget(0),Ie.fx=null,Ie.fy=null},L=this.nodeGroup?.selectAll("circle").data(f,be=>be.id).enter().append("circle").attr("r",be=>this.getRadius(be.type)).attr("fill",be=>this.getColor(be.type,be.priority)).attr("cx",be=>be.x).attr("cy",be=>be.y).call(d_().on("start",w).on("drag",C).on("end",A));L&&this.nodes.push(L);let U=f.filter(be=>be.type!==Pr.GROUP),Q=this.textGroup?.style("font","16px sans-serif").selectAll("text").data(U,be=>be.id).enter().append("text").attr("id",be=>be.id).attr("line-height","16px").attr("pointer-events","none").attr("text-anchor","middle").text(be=>be.count);Q&&this.texts.push(Q);let me=f.filter(be=>be.type===Pr.GROUP),he=this.iconGroup?.selectAll("image").data(me,be=>be.id).enter().append("image").attr("r",8).attr("fill","#5484d1").attr("href",be=>this.getIcon(be.deviceType)).attr("height",be=>this.getRadius(be.type)).attr("width",be=>this.getRadius(be.type)).attr("style","position: absolute;");he&&this.icons.push(he)}),this.setFixedXAxisToGroupParent()}getColor(c,f){if(c===Pr.GROUP)return"#F8F8F8";switch(f){case $n.LOW:return"#B3ECCD";case $n.MODERATE:return"#FFEB82";case $n.HIGH:return"#ffb682";case $n.SEVIRE:return"#ECC6EF";default:return"#D9D9D9"}}getRadius(c){return c===Pr.GROUP?75:30}getIcon(c){switch(c){case Wr.BATTERY:return"../assets/icon_wf_battery.svg";case Wr.HUMIDITY:return"../assets/icon_wf_humidity.svg";case Wr.LATCH:return"../assets/icon_wf_latch.svg";case Wr.SIGNAL:return"../assets/icon_wf_signal.svg";case Wr.TEMPERATURE:return"../assets/icon_wf_temperature.svg"}}calculateGroups(c){let f=Ux(D7,U=>U[c]),r=new Map([...f.entries()].sort()),w=[],C=new zh,A=localStorage.getItem("pointsCoords");if(console.log(A),A){let U=JSON.parse(A);console.log("parsedCoords",U),console.log("slicedCoordsArray",U);for(let Q of U)console.log("slicedCoord",Q),w.push(Q)}let L=0;return r.forEach((U,Q)=>{let me=[],he=[];U.forEach(ze=>{if(ze.type===Pr.DEVICE){let nt=ze,{alarms:ft}=nt,Ue=ns(nt,["alarms"]);ze.alarms.forEach(Nt=>{me.push(lr(vt(vt({},Nt),Ue),{x:WN(-750,750),y:WN(350,-350)})),console.log("index",L),L+=1})}else he.push(ze)});let be=me.reduce((ze,nt)=>(ze[nt.priority]||(ze[nt.priority]=lr(vt({},nt),{count:0})),ze[nt.priority].count+=1,ze),{}),Ie=Object.values(be),Qe=[...he,...Ie];C.set(Q,Qe)}),C}calculateXAxis(){return M7(-(window.innerWidth-100),window.innerWidth-100,this.groups.size)}setFixedXAxisToGroupParent(){this.xAxis=this.calculateXAxis(),this.groups.forEach(c=>{c.forEach((f,r)=>{f.type===Pr.GROUP&&(f.fx=this.xAxis[r],f.fy=0)})})}loadSimulations(){let c=new Map;this.groups.forEach((f,r)=>{let w=()=>{this.groups.get(r)?.forEach(A=>{A.type===Pr.GROUP&&(A.fx=this.xAxis[r],A.fy=0)}),this.nodes[r]?.attr("cx",A=>A.x).attr("cy",A=>A.y),this.texts[r]?.attr("x",A=>A.x).attr("y",A=>A.y),this.icons[r]?.attr("x",A=>A.x-this.getRadius(A.type)/2).attr("y",A=>A.y-this.getRadius(A.type)/2)},C=S_(this.groups.get(r)).alphaDecay(.01).velocityDecay(.2).force("charge",C_().strength(5)).force("x",I_(this.xAxis[r]).strength(.02)).force("y",D_().strength(.02)).force("collide",T_().radius(A=>A.type===Pr.GROUP?A.r-15:A.r).iterations(3)).on("tick",w);c.set(r,C),console.log("this.groups.get(key)",this.groups.get(r))}),this.simulation=c}restartSimulations(){for(let c of this.simulation)c[1].restart()}};i.\u0275fac=function(f){return new(f||i)(nr(yl))},i.\u0275cmp=Lr({type:i,selectors:[["app-gravity-bubbles-view"]],standalone:!0,features:[Nr],decls:3,vars:2,consts:[[1,"bubbles"],[2,"position","absolute","top","300px","left","1000px","z-index","999"],[2,"height","30px","width","30px"]],template:function(f,r){f&1&&(er(0,"div",0),In(1,"div",1),UR(),er(2,"svg",2),Cn()),f&2&&(vr(),Hf("view-transition-name","cube"))},dependencies:[wi],styles:["svg[_ngcontent-%COMP%]{view-transition-name:circle-image}img[_ngcontent-%COMP%]{view-transition-name:card-image}[_ngcontent-%COMP%]::vview-transition-group(cube){animation-duration:4s}"]});let o=i;return o})();function M7(o,i,l){let c=(i-o)/l,f=[];for(let r=0;r<l;r++){let w=o+r*c,C=w+c;f.push((w+C)/2)}return f}var ZN=(()=>{let i=class i{handleMenuClick(c,f){c.cancelBubble=!0}};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["app-sensor-overview"]],standalone:!0,features:[Nr],decls:21,vars:0,consts:[[1,"normal","menu-element",2,"text-align","left","padding-left","10px",3,"click"],["src","../../../assets/top-right-arrow.svg",2,"position","fixed","right","15px","margin-top","4px"],[1,"critical","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"high","menu-element",2,"height","fit-content","text-align","left","padding-left","10px",3,"click"],[1,"dotted"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%"],["src","../../../assets/alert-add.svg",1,"add-icon"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%","text-decoration-line","line-through","text-decoration-color","rgba(0, 0, 0, 0.5)","color","rgba(0, 0, 0, 0.5)"],["src","../../../assets/alert-close.svg",1,"add-icon"],[1,"regular","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"low","menu-element",2,"text-align","left","padding-left","10px",3,"click"]],template:function(f,r){f&1&&(In(0,"div",0),Hr("click",function(C){return r.handleMenuClick(C,"normal")}),Kr(1," 7 tasks to delegate "),er(2,"img",1),Cn(),In(3,"div",2),Hr("click",function(C){return r.handleMenuClick(C,"critical")}),Kr(4," 3 critical alerts "),Cn(),In(5,"div",3),Hr("click",function(C){return r.handleMenuClick(C,"high")}),Kr(6," 8 high priority alerts "),er(7,"hr",4),In(8,"div",5),Kr(9,"4 mice to be released "),er(10,"img",6),Cn(),In(11,"div",5),Kr(12,"2 batteries to be replaced "),er(13,"img",6),Cn(),In(14,"div",7),Kr(15," 2 roofs to be cleared of snow "),er(16,"img",8),Cn()(),In(17,"div",9),Hr("click",function(C){return r.handleMenuClick(C,"regular")}),Kr(18," 29 regular statuses "),Cn(),In(19,"div",10),Hr("click",function(C){return r.handleMenuClick(C,"low")}),Kr(20," 3 low priority statuses "),Cn())},dependencies:[wi]});let o=i;return o})();var XN=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:qN},{path:"bubbles",component:nI},{path:"sensors",component:ZN,data:{animation:"sensorsPage"}}];var A7=["*"],iu=class{},x1=(()=>{let i=class i extends iu{constructor(c){super(),this.http=c}getSvg(c){return this.http.get(c,{responseType:"text"})}};i.\u0275fac=function(f){return new(f||i)(fn(FS))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),P7=new dn("SERVER_URL"),y1=(()=>{let i=class i{constructor(){this.loader=bt(iu),this.serverUrl=bt(P7,{optional:!0}),this.document=bt(Qr),this.iconsByUrl=new Map,this.iconsLoadingByUrl=new Map}addSvg(c,f){if(!this.iconsByUrl.has(c)){let r=this.document.createElement("DIV");r.innerHTML=f;let w=r.querySelector("svg");this.iconsByUrl.set(c,w)}}loadSvg(c,f=c){if(this.serverUrl&&c.match(/^(http(s)?):/)===null&&(c=this.serverUrl+c,f=c),this.iconsByUrl.has(f))return sn(this.iconsByUrl.get(f));if(this.iconsLoadingByUrl.has(f))return this.iconsLoadingByUrl.get(f);let r=this.loader.getSvg(c).pipe(Ln(w=>{let C=this.document.createElement("DIV");return C.innerHTML=w,C.querySelector("svg")}),si(w=>this.iconsByUrl.set(f,w)),ca(w=>(console.error(w),ol(w))),ua(()=>this.iconsLoadingByUrl.delete(f)),EE());return this.iconsLoadingByUrl.set(f,r),r}getSvgByName(c){return this.iconsByUrl.has(c)?sn(this.iconsByUrl.get(c)):this.iconsLoadingByUrl.has(c)?this.iconsLoadingByUrl.get(c):ol(`No svg with name '${c}' has been loaded`)}unloadSvg(c){this.iconsByUrl.has(c)&&this.iconsByUrl.delete(c)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})();function R7(o){return o||new y1}var b1={provide:y1,deps:[[new Vf,new Mg,y1]],useFactory:R7},v1=class{constructor(){this.loaded=!1}},YN=(()=>{let i=class i{constructor(){this.element=bt(dl),this.differs=bt(Og),this.renderer=bt(Uc),this.iconReg=bt(y1),this.src=ya.required(),this.name=ya(),this.stretch=ya(!1),this.applyClass=ya(!1),this.svgClass=ya(),this.klass=ya(void 0,{alias:"class"}),this.viewBox=ya(),this.svgAriaLabel=ya(),this.svg=$O(0),this.svgStyle=ya(),this.helper=new v1,va(()=>{(this.src()||this.name())&&(this.destroy(),this.init(this.src(),this.name()))},{allowSignalWrites:!0}),va(()=>{let r=this.viewBox();this.svg()&&this.updateViewBox(r)}),va(()=>{let r=this.svgStyle()||{};this.svg()&&this.applyChanges(this.helper.differ.diff(r))}),va(()=>{let r=this.svg();this.applyClass()?this.setClass(this.elemSvg,null,this.klass()):this.setClass(this.elemSvg,this.klass(),null)});let c;va(()=>{let r=this.svg();this.setClass(this.elemSvg,c,this.svgClass()),c=this.svgClass()});let f;va(()=>{let r=this.svg(),w=this.element.nativeElement;this.setClass(w,f,this.klass()),this.setClass(this.elemSvg,f,this.applyClass()?this.klass():null),f=this.klass()}),va(()=>{let r=this.svg();this.doAria(this.svgAriaLabel())}),va(()=>{let r=this.svg();this.stylize(this.stretch())})}ngOnDestroy(){this.destroy()}get elemSvg(){return this.element.nativeElement.firstChild}init(c,f){if(f){let r=this.iconReg.getSvgByName(f);r&&(this.helper.icnSub=r.subscribe(w=>this.initSvg(w)))}else if(c){let r=this.iconReg.loadSvg(c);r&&(this.helper.icnSub=r.subscribe(w=>this.initSvg(w)))}else this.element.nativeElement.innerHTML="",this.svg.set(0)}initSvg(c){!this.helper.loaded&&c&&this.setSvg(c)}destroy(){this.helper.icnSub?.unsubscribe(),this.helper=new v1,this.helper.differ=this.differs.find({}).create()}setSvg(c){if(!this.helper.loaded&&c){this.helper.svg=c;let f=c.cloneNode(!0),r=this.element.nativeElement;r.innerHTML="",this.renderer.appendChild(r,f),this.helper.loaded=!0,this.copyNgContentAttribute(r,f),this.svg.update(w=>w+1)}}updateViewBox(c){if(c){let f=this.elemSvg;if(c==="auto"){let r=f.getAttribute("width"),w=f.getAttribute("height");if(w&&r){let C=`0 0 ${r} ${w}`;this.renderer.setAttribute(f,"viewBox",C),this.renderer.removeAttribute(f,"width"),this.renderer.removeAttribute(f,"height")}}else c!==""&&(this.renderer.setAttribute(f,"viewBox",c),this.renderer.removeAttribute(f,"width"),this.renderer.removeAttribute(f,"height"))}}copyNgContentAttribute(c,f){let r=c.attributes,w=r.length;for(let C=0;C<w;C+=1){let A=r.item(C);if(A&&A.name.startsWith("_ngcontent")){this.setNgContentAttribute(f,A.name);break}}}setNgContentAttribute(c,f){this.renderer.setAttribute(c,f,"");let r=c.childNodes.length;for(let w=0;w<r;w+=1){let C=c.childNodes[w];C instanceof Element&&this.setNgContentAttribute(C,f)}}stylize(c){if(this.helper.svg){let f=this.element.nativeElement.firstChild;c===!0?this.renderer.setAttribute(f,"preserveAspectRatio","none"):c===!1&&this.renderer.removeAttribute(f,"preserveAspectRatio")}}applyChanges(c){c&&(c.forEachRemovedItem(f=>this.setStyle(f.key,null)),c.forEachAddedItem(f=>this.setStyle(f.key,f.currentValue)),c.forEachChangedItem(f=>this.setStyle(f.key,f.currentValue)))}setStyle(c,f){let[r,w]=c.split(".");f=f!==null&&w?`${f}${w}`:f;let C=this.elemSvg;f!==null?this.renderer.setStyle(C,r,f):this.renderer.removeStyle(C,r)}setClass(c,f,r){if(c){if(f){let w=(Array.isArray(f)?f:f.split(" ")).filter(C=>C);for(let C of w)this.renderer.removeClass(c,C)}if(r){let w=(Array.isArray(r)?r:r.split(" ")).filter(C=>C);for(let C of w)this.renderer.addClass(c,C)}}}doAria(c){let f=this.element.nativeElement.firstChild;f&&!(c===void 0&&f.hasAttribute("aria-label"))&&(c===""?(this.renderer.setAttribute(f,"aria-hidden","true"),this.renderer.removeAttribute(f,"aria-label")):(this.renderer.removeAttribute(f,"aria-hidden"),this.renderer.setAttribute(f,"aria-label",c)))}};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["svg-icon"]],inputs:{src:[Gr.SignalBased,"src"],name:[Gr.SignalBased,"name"],stretch:[Gr.SignalBased,"stretch"],applyClass:[Gr.SignalBased,"applyClass"],svgClass:[Gr.SignalBased,"svgClass"],klass:[Gr.SignalBased,"class","klass"],viewBox:[Gr.SignalBased,"viewBox"],svgAriaLabel:[Gr.SignalBased,"svgAriaLabel"],svgStyle:[Gr.SignalBased,"svgStyle"]},standalone:!0,features:[Nr],ngContentSelectors:A7,decls:1,vars:0,template:function(f,r){f&1&&(XO(),YO(0))},encapsulation:2,changeDetection:0});let o=i;return o})();function KN(o={}){return Bc([b1,o.loader||{provide:iu,useClass:x1}])}var QN=(()=>{let i=class i{static forRoot(c={}){return{ngModule:i,providers:[b1,c.loader||{provide:iu,useClass:x1}]}}};i.\u0275fac=function(f){return new(f||i)},i.\u0275mod=cl({type:i}),i.\u0275inj=ll({});let o=i;return o})();var Pn=function(o){return o[o.State=0]="State",o[o.Transition=1]="Transition",o[o.Sequence=2]="Sequence",o[o.Group=3]="Group",o[o.Animate=4]="Animate",o[o.Keyframes=5]="Keyframes",o[o.Style=6]="Style",o[o.Trigger=7]="Trigger",o[o.Reference=8]="Reference",o[o.AnimateChild=9]="AnimateChild",o[o.AnimateRef=10]="AnimateRef",o[o.Query=11]="Query",o[o.Stagger=12]="Stagger",o}(Pn||{}),Ea="*";function JN(o,i){return{type:Pn.Trigger,name:o,definitions:i,options:{}}}function rI(o,i=null){return{type:Pn.Animate,styles:i,timings:o}}function e3(o,i=null){return{type:Pn.Group,steps:o,options:i}}function t3(o,i=null){return{type:Pn.Sequence,steps:o,options:i}}function vl(o){return{type:Pn.Style,styles:o,offset:null}}function n3(o,i,l=null){return{type:Pn.Transition,expr:o,animation:i,options:l}}function w1(o,i,l=null){return{type:Pn.Query,selector:o,animation:i,options:l}}var ou=class{constructor(i=0,l=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=i+l}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(i=>i()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(i){this._position=this.totalTime?i*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(i){let l=i=="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},A_=class{constructor(i){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=i;let l=0,c=0,f=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(w=>{w.onDone(()=>{++l==r&&this._onFinish()}),w.onDestroy(()=>{++c==r&&this._onDestroy()}),w.onStart(()=>{++f==r&&this._onStart()})}),this.totalTime=this.players.reduce((w,C)=>Math.max(w,C.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this.players.forEach(i=>i.init())}onStart(i){this._onStartFns.push(i)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(i=>i()),this._onStartFns=[])}onDone(i){this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(i=>i.play())}pause(){this.players.forEach(i=>i.pause())}restart(){this.players.forEach(i=>i.restart())}finish(){this._onFinish(),this.players.forEach(i=>i.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(i=>i.destroy()),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this.players.forEach(i=>i.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(i){let l=i*this.totalTime;this.players.forEach(c=>{let f=c.totalTime?Math.min(1,l/c.totalTime):1;c.setPosition(f)})}getPosition(){let i=this.players.reduce((l,c)=>l===null||c.totalTime>l.totalTime?c:l,null);return i!=null?i.getPosition():0}beforeDestroy(){this.players.forEach(i=>{i.beforeDestroy&&i.beforeDestroy()})}triggerCallback(i){let l=i=="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},E1="!";function r3(o){return new xt(3e3,!1)}function k7(){return new xt(3100,!1)}function L7(){return new xt(3101,!1)}function F7(o){return new xt(3001,!1)}function N7(o){return new xt(3003,!1)}function z7(o){return new xt(3004,!1)}function B7(o,i){return new xt(3005,!1)}function V7(){return new xt(3006,!1)}function j7(){return new xt(3007,!1)}function U7(o,i){return new xt(3008,!1)}function $7(o){return new xt(3002,!1)}function G7(o,i,l,c,f){return new xt(3010,!1)}function H7(){return new xt(3011,!1)}function q7(){return new xt(3012,!1)}function W7(){return new xt(3200,!1)}function Z7(){return new xt(3202,!1)}function X7(){return new xt(3013,!1)}function Y7(o){return new xt(3014,!1)}function K7(o){return new xt(3015,!1)}function Q7(o){return new xt(3016,!1)}function J7(o,i){return new xt(3404,!1)}function eW(o){return new xt(3502,!1)}function tW(o){return new xt(3503,!1)}function nW(){return new xt(3300,!1)}function rW(o){return new xt(3504,!1)}function iW(o){return new xt(3301,!1)}function oW(o,i){return new xt(3302,!1)}function sW(o){return new xt(3303,!1)}function aW(o,i){return new xt(3400,!1)}function lW(o){return new xt(3401,!1)}function cW(o){return new xt(3402,!1)}function uW(o,i){return new xt(3505,!1)}function su(o){switch(o.length){case 0:return new ou;case 1:return o[0];default:return new A_(o)}}function _3(o,i,l=new Map,c=new Map){let f=[],r=[],w=-1,C=null;if(i.forEach(A=>{let L=A.get("offset"),U=L==w,Q=U&&C||new Map;A.forEach((me,he)=>{let be=he,Ie=me;if(he!=="offset")switch(be=o.normalizePropertyName(be,f),Ie){case E1:Ie=l.get(he);break;case Ea:Ie=c.get(he);break;default:Ie=o.normalizeStyleValue(he,be,Ie,f);break}Q.set(be,Ie)}),U||r.push(Q),C=Q,w=L}),f.length)throw eW(f);return r}function CI(o,i,l,c){switch(i){case"start":o.onStart(()=>c(l&&iI(l,"start",o)));break;case"done":o.onDone(()=>c(l&&iI(l,"done",o)));break;case"destroy":o.onDestroy(()=>c(l&&iI(l,"destroy",o)));break}}function iI(o,i,l){let c=l.totalTime,f=!!l.disabled,r=II(o.element,o.triggerName,o.fromState,o.toState,i||o.phaseName,c??o.totalTime,f),w=o._data;return w!=null&&(r._data=w),r}function II(o,i,l,c,f="",r=0,w){return{element:o,triggerName:i,fromState:l,toState:c,phaseName:f,totalTime:r,disabled:!!w}}function Vo(o,i,l){let c=o.get(i);return c||o.set(i,c=l),c}function i3(o){let i=o.indexOf(":"),l=o.substring(1,i),c=o.slice(i+1);return[l,c]}var hW=typeof document>"u"?null:document.documentElement;function DI(o){let i=o.parentNode||o.host||null;return i===hW?null:i}function dW(o){return o.substring(1,6)=="ebkit"}var qh=null,o3=!1;function fW(o){qh||(qh=pW()||{},o3=qh.style?"WebkitAppearance"in qh.style:!1);let i=!0;return qh.style&&!dW(o)&&(i=o in qh.style,!i&&o3&&(i="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in qh.style)),i}function pW(){return typeof document<"u"?document.body:null}function y3(o,i){for(;i;){if(i===o)return!0;i=DI(i)}return!1}function v3(o,i,l){if(l)return Array.from(o.querySelectorAll(i));let c=o.querySelector(i);return c?[c]:[]}var MI=(()=>{let i=class i{validateStyleProperty(c){return fW(c)}containsElement(c,f){return y3(c,f)}getParentElement(c){return DI(c)}query(c,f,r){return v3(c,f,r)}computeStyle(c,f,r){return r||""}animate(c,f,r,w,C,A=[],L){return new ou(r,w)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})(),OI=class OI{};OI.NOOP=new MI;var Xh=OI,Yh=class{};var mW=1e3,x3="{{",gW="}}",b3="ng-enter",uI="ng-leave",T1="ng-trigger",M1=".ng-trigger",s3="ng-animating",hI=".ng-animating";function xl(o){if(typeof o=="number")return o;let i=o.match(/^(-?[\.\d]+)(m?s)/);return!i||i.length<2?0:dI(parseFloat(i[1]),i[2])}function dI(o,i){switch(i){case"s":return o*mW;default:return o}}function A1(o,i,l){return o.hasOwnProperty("duration")?o:_W(o,i,l)}function _W(o,i,l){let c=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,f,r=0,w="";if(typeof o=="string"){let C=o.match(c);if(C===null)return i.push(r3(o)),{duration:0,delay:0,easing:""};f=dI(parseFloat(C[1]),C[2]);let A=C[3];A!=null&&(r=dI(parseFloat(A),C[4]));let L=C[5];L&&(w=L)}else f=o;if(!l){let C=!1,A=i.length;f<0&&(i.push(k7()),C=!0),r<0&&(i.push(L7()),C=!0),C&&i.splice(A,0,r3(o))}return{duration:f,delay:r,easing:w}}function yW(o){return o.length?o[0]instanceof Map?o:o.map(i=>new Map(Object.entries(i))):[]}function Ta(o,i,l){i.forEach((c,f)=>{let r=AI(f);l&&!l.has(f)&&l.set(f,o.style[r]),o.style[r]=c})}function Zh(o,i){i.forEach((l,c)=>{let f=AI(c);o.style[f]=""})}function P_(o){return Array.isArray(o)?o.length==1?o[0]:t3(o):o}function vW(o,i,l){let c=i.params||{},f=w3(o);f.length&&f.forEach(r=>{c.hasOwnProperty(r)||l.push(F7(r))})}var fI=new RegExp(`${x3}\\s*(.+?)\\s*${gW}`,"g");function w3(o){let i=[];if(typeof o=="string"){let l;for(;l=fI.exec(o);)i.push(l[1]);fI.lastIndex=0}return i}function O_(o,i,l){let c=`${o}`,f=c.replace(fI,(r,w)=>{let C=i[w];return C==null&&(l.push(N7(w)),C=""),C.toString()});return f==c?o:f}var xW=/-+([a-z0-9])/g;function AI(o){return o.replace(xW,(...i)=>i[1].toUpperCase())}function bW(o,i){return o===0||i===0}function wW(o,i,l){if(l.size&&i.length){let c=i[0],f=[];if(l.forEach((r,w)=>{c.has(w)||f.push(w),c.set(w,r)}),f.length)for(let r=1;r<i.length;r++){let w=i[r];f.forEach(C=>w.set(C,PI(o,C)))}}return i}function Bo(o,i,l){switch(i.type){case Pn.Trigger:return o.visitTrigger(i,l);case Pn.State:return o.visitState(i,l);case Pn.Transition:return o.visitTransition(i,l);case Pn.Sequence:return o.visitSequence(i,l);case Pn.Group:return o.visitGroup(i,l);case Pn.Animate:return o.visitAnimate(i,l);case Pn.Keyframes:return o.visitKeyframes(i,l);case Pn.Style:return o.visitStyle(i,l);case Pn.Reference:return o.visitReference(i,l);case Pn.AnimateChild:return o.visitAnimateChild(i,l);case Pn.AnimateRef:return o.visitAnimateRef(i,l);case Pn.Query:return o.visitQuery(i,l);case Pn.Stagger:return o.visitStagger(i,l);default:throw z7(i.type)}}function PI(o,i){return window.getComputedStyle(o)[i]}var EW=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),P1=class extends Yh{normalizePropertyName(i,l){return AI(i)}normalizeStyleValue(i,l,c,f){let r="",w=c.toString().trim();if(EW.has(l)&&c!==0&&c!=="0")if(typeof c=="number")r="px";else{let C=c.match(/^[+-]?[\d\.]+([a-z]*)$/);C&&C[1].length==0&&f.push(B7(i,c))}return w+r}};var R1="*";function TW(o,i){let l=[];return typeof o=="string"?o.split(/\s*,\s*/).forEach(c=>SW(c,l,i)):l.push(o),l}function SW(o,i,l){if(o[0]==":"){let A=CW(o,l);if(typeof A=="function"){i.push(A);return}o=A}let c=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(c==null||c.length<4)return l.push(K7(o)),i;let f=c[1],r=c[2],w=c[3];i.push(a3(f,w));let C=f==R1&&w==R1;r[0]=="<"&&!C&&i.push(a3(w,f))}function CW(o,i){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(l,c)=>parseFloat(c)>parseFloat(l);case":decrement":return(l,c)=>parseFloat(c)<parseFloat(l);default:return i.push(Q7(o)),"* => *"}}var S1=new Set(["true","1"]),C1=new Set(["false","0"]);function a3(o,i){let l=S1.has(o)||C1.has(o),c=S1.has(i)||C1.has(i);return(f,r)=>{let w=o==R1||o==f,C=i==R1||i==r;return!w&&l&&typeof f=="boolean"&&(w=f?S1.has(o):C1.has(o)),!C&&c&&typeof r=="boolean"&&(C=r?S1.has(i):C1.has(i)),w&&C}}var E3=":self",IW=new RegExp(`s*${E3}s*,?`,"g");function T3(o,i,l,c){return new pI(o).build(i,l,c)}var l3="",pI=class{constructor(i){this._driver=i}build(i,l,c){let f=new mI(l);return this._resetContextStyleTimingState(f),Bo(this,P_(i),f)}_resetContextStyleTimingState(i){i.currentQuerySelector=l3,i.collectedStyles=new Map,i.collectedStyles.set(l3,new Map),i.currentTime=0}visitTrigger(i,l){let c=l.queryCount=0,f=l.depCount=0,r=[],w=[];return i.name.charAt(0)=="@"&&l.errors.push(V7()),i.definitions.forEach(C=>{if(this._resetContextStyleTimingState(l),C.type==Pn.State){let A=C,L=A.name;L.toString().split(/\s*,\s*/).forEach(U=>{A.name=U,r.push(this.visitState(A,l))}),A.name=L}else if(C.type==Pn.Transition){let A=this.visitTransition(C,l);c+=A.queryCount,f+=A.depCount,w.push(A)}else l.errors.push(j7())}),{type:Pn.Trigger,name:i.name,states:r,transitions:w,queryCount:c,depCount:f,options:null}}visitState(i,l){let c=this.visitStyle(i.styles,l),f=i.options&&i.options.params||null;if(c.containsDynamicStyles){let r=new Set,w=f||{};c.styles.forEach(C=>{C instanceof Map&&C.forEach(A=>{w3(A).forEach(L=>{w.hasOwnProperty(L)||r.add(L)})})}),r.size&&l.errors.push(U7(i.name,[...r.values()]))}return{type:Pn.State,name:i.name,style:c,options:f?{params:f}:null}}visitTransition(i,l){l.queryCount=0,l.depCount=0;let c=Bo(this,P_(i.animation),l),f=TW(i.expr,l.errors);return{type:Pn.Transition,matchers:f,animation:c,queryCount:l.queryCount,depCount:l.depCount,options:Wh(i.options)}}visitSequence(i,l){return{type:Pn.Sequence,steps:i.steps.map(c=>Bo(this,c,l)),options:Wh(i.options)}}visitGroup(i,l){let c=l.currentTime,f=0,r=i.steps.map(w=>{l.currentTime=c;let C=Bo(this,w,l);return f=Math.max(f,l.currentTime),C});return l.currentTime=f,{type:Pn.Group,steps:r,options:Wh(i.options)}}visitAnimate(i,l){let c=PW(i.timings,l.errors);l.currentAnimateTimings=c;let f,r=i.styles?i.styles:vl({});if(r.type==Pn.Keyframes)f=this.visitKeyframes(r,l);else{let w=i.styles,C=!1;if(!w){C=!0;let L={};c.easing&&(L.easing=c.easing),w=vl(L)}l.currentTime+=c.duration+c.delay;let A=this.visitStyle(w,l);A.isEmptyStep=C,f=A}return l.currentAnimateTimings=null,{type:Pn.Animate,timings:c,style:f,options:null}}visitStyle(i,l){let c=this._makeStyleAst(i,l);return this._validateStyleAst(c,l),c}_makeStyleAst(i,l){let c=[],f=Array.isArray(i.styles)?i.styles:[i.styles];for(let C of f)typeof C=="string"?C===Ea?c.push(C):l.errors.push($7(C)):c.push(new Map(Object.entries(C)));let r=!1,w=null;return c.forEach(C=>{if(C instanceof Map&&(C.has("easing")&&(w=C.get("easing"),C.delete("easing")),!r)){for(let A of C.values())if(A.toString().indexOf(x3)>=0){r=!0;break}}}),{type:Pn.Style,styles:c,easing:w,offset:i.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(i,l){let c=l.currentAnimateTimings,f=l.currentTime,r=l.currentTime;c&&r>0&&(r-=c.duration+c.delay),i.styles.forEach(w=>{typeof w!="string"&&w.forEach((C,A)=>{let L=l.collectedStyles.get(l.currentQuerySelector),U=L.get(A),Q=!0;U&&(r!=f&&r>=U.startTime&&f<=U.endTime&&(l.errors.push(G7(A,U.startTime,U.endTime,r,f)),Q=!1),r=U.startTime),Q&&L.set(A,{startTime:r,endTime:f}),l.options&&vW(C,l.options,l.errors)})})}visitKeyframes(i,l){let c={type:Pn.Keyframes,styles:[],options:null};if(!l.currentAnimateTimings)return l.errors.push(H7()),c;let f=1,r=0,w=[],C=!1,A=!1,L=0,U=i.steps.map(ze=>{let nt=this._makeStyleAst(ze,l),ft=nt.offset!=null?nt.offset:AW(nt.styles),Ue=0;return ft!=null&&(r++,Ue=nt.offset=ft),A=A||Ue<0||Ue>1,C=C||Ue<L,L=Ue,w.push(Ue),nt});A&&l.errors.push(q7()),C&&l.errors.push(W7());let Q=i.steps.length,me=0;r>0&&r<Q?l.errors.push(Z7()):r==0&&(me=f/(Q-1));let he=Q-1,be=l.currentTime,Ie=l.currentAnimateTimings,Qe=Ie.duration;return U.forEach((ze,nt)=>{let ft=me>0?nt==he?1:me*nt:w[nt],Ue=ft*Qe;l.currentTime=be+Ie.delay+Ue,Ie.duration=Ue,this._validateStyleAst(ze,l),ze.offset=ft,c.styles.push(ze)}),c}visitReference(i,l){return{type:Pn.Reference,animation:Bo(this,P_(i.animation),l),options:Wh(i.options)}}visitAnimateChild(i,l){return l.depCount++,{type:Pn.AnimateChild,options:Wh(i.options)}}visitAnimateRef(i,l){return{type:Pn.AnimateRef,animation:this.visitReference(i.animation,l),options:Wh(i.options)}}visitQuery(i,l){let c=l.currentQuerySelector,f=i.options||{};l.queryCount++,l.currentQuery=i;let[r,w]=DW(i.selector);l.currentQuerySelector=c.length?c+" "+r:r,Vo(l.collectedStyles,l.currentQuerySelector,new Map);let C=Bo(this,P_(i.animation),l);return l.currentQuery=null,l.currentQuerySelector=c,{type:Pn.Query,selector:r,limit:f.limit||0,optional:!!f.optional,includeSelf:w,animation:C,originalSelector:i.selector,options:Wh(i.options)}}visitStagger(i,l){l.currentQuery||l.errors.push(X7());let c=i.timings==="full"?{duration:0,delay:0,easing:"full"}:A1(i.timings,l.errors,!0);return{type:Pn.Stagger,animation:Bo(this,P_(i.animation),l),timings:c,options:null}}};function DW(o){let i=!!o.split(/\s*,\s*/).find(l=>l==E3);return i&&(o=o.replace(IW,"")),o=o.replace(/@\*/g,M1).replace(/@\w+/g,l=>M1+"-"+l.slice(1)).replace(/:animating/g,hI),[o,i]}function MW(o){return o?vt({},o):null}var mI=class{constructor(i){this.errors=i,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function AW(o){if(typeof o=="string")return null;let i=null;if(Array.isArray(o))o.forEach(l=>{if(l instanceof Map&&l.has("offset")){let c=l;i=parseFloat(c.get("offset")),c.delete("offset")}});else if(o instanceof Map&&o.has("offset")){let l=o;i=parseFloat(l.get("offset")),l.delete("offset")}return i}function PW(o,i){if(o.hasOwnProperty("duration"))return o;if(typeof o=="number"){let r=A1(o,i).duration;return oI(r,0,"")}let l=o;if(l.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=oI(0,0,"");return r.dynamic=!0,r.strValue=l,r}let f=A1(l,i);return oI(f.duration,f.delay,f.easing)}function Wh(o){return o?(o=vt({},o),o.params&&(o.params=MW(o.params))):o={},o}function oI(o,i,l){return{duration:o,delay:i,easing:l}}function RI(o,i,l,c,f,r,w=null,C=!1){return{type:1,element:o,keyframes:i,preStyleProps:l,postStyleProps:c,duration:f,delay:r,totalTime:f+r,easing:w,subTimeline:C}}var k_=class{constructor(){this._map=new Map}get(i){return this._map.get(i)||[]}append(i,l){let c=this._map.get(i);c||this._map.set(i,c=[]),c.push(...l)}has(i){return this._map.has(i)}clear(){this._map.clear()}},RW=1,OW=":enter",kW=new RegExp(OW,"g"),LW=":leave",FW=new RegExp(LW,"g");function S3(o,i,l,c,f,r=new Map,w=new Map,C,A,L=[]){return new gI().buildKeyframes(o,i,l,c,f,r,w,C,A,L)}var gI=class{buildKeyframes(i,l,c,f,r,w,C,A,L,U=[]){L=L||new k_;let Q=new _I(i,l,L,f,r,U,[]);Q.options=A;let me=A.delay?xl(A.delay):0;Q.currentTimeline.delayNextStep(me),Q.currentTimeline.setStyles([w],null,Q.errors,A),Bo(this,c,Q);let he=Q.timelines.filter(be=>be.containsAnimation());if(he.length&&C.size){let be;for(let Ie=he.length-1;Ie>=0;Ie--){let Qe=he[Ie];if(Qe.element===l){be=Qe;break}}be&&!be.allowOnlyTimelineStyles()&&be.setStyles([C],null,Q.errors,A)}return he.length?he.map(be=>be.buildKeyframes()):[RI(l,[],[],[],0,me,"",!1)]}visitTrigger(i,l){}visitState(i,l){}visitTransition(i,l){}visitAnimateChild(i,l){let c=l.subInstructions.get(l.element);if(c){let f=l.createSubContext(i.options),r=l.currentTimeline.currentTime,w=this._visitSubInstructions(c,f,f.options);r!=w&&l.transformIntoNewTimeline(w)}l.previousNode=i}visitAnimateRef(i,l){let c=l.createSubContext(i.options);c.transformIntoNewTimeline(),this._applyAnimationRefDelays([i.options,i.animation.options],l,c),this.visitReference(i.animation,c),l.transformIntoNewTimeline(c.currentTimeline.currentTime),l.previousNode=i}_applyAnimationRefDelays(i,l,c){for(let f of i){let r=f?.delay;if(r){let w=typeof r=="number"?r:xl(O_(r,f?.params??{},l.errors));c.delayNextStep(w)}}}_visitSubInstructions(i,l,c){let r=l.currentTimeline.currentTime,w=c.duration!=null?xl(c.duration):null,C=c.delay!=null?xl(c.delay):null;return w!==0&&i.forEach(A=>{let L=l.appendInstructionToTimeline(A,w,C);r=Math.max(r,L.duration+L.delay)}),r}visitReference(i,l){l.updateOptions(i.options,!0),Bo(this,i.animation,l),l.previousNode=i}visitSequence(i,l){let c=l.subContextCount,f=l,r=i.options;if(r&&(r.params||r.delay)&&(f=l.createSubContext(r),f.transformIntoNewTimeline(),r.delay!=null)){f.previousNode.type==Pn.Style&&(f.currentTimeline.snapshotCurrentStyles(),f.previousNode=O1);let w=xl(r.delay);f.delayNextStep(w)}i.steps.length&&(i.steps.forEach(w=>Bo(this,w,f)),f.currentTimeline.applyStylesToKeyframe(),f.subContextCount>c&&f.transformIntoNewTimeline()),l.previousNode=i}visitGroup(i,l){let c=[],f=l.currentTimeline.currentTime,r=i.options&&i.options.delay?xl(i.options.delay):0;i.steps.forEach(w=>{let C=l.createSubContext(i.options);r&&C.delayNextStep(r),Bo(this,w,C),f=Math.max(f,C.currentTimeline.currentTime),c.push(C.currentTimeline)}),c.forEach(w=>l.currentTimeline.mergeTimelineCollectedStyles(w)),l.transformIntoNewTimeline(f),l.previousNode=i}_visitTiming(i,l){if(i.dynamic){let c=i.strValue,f=l.params?O_(c,l.params,l.errors):c;return A1(f,l.errors)}else return{duration:i.duration,delay:i.delay,easing:i.easing}}visitAnimate(i,l){let c=l.currentAnimateTimings=this._visitTiming(i.timings,l),f=l.currentTimeline;c.delay&&(l.incrementTime(c.delay),f.snapshotCurrentStyles());let r=i.style;r.type==Pn.Keyframes?this.visitKeyframes(r,l):(l.incrementTime(c.duration),this.visitStyle(r,l),f.applyStylesToKeyframe()),l.currentAnimateTimings=null,l.previousNode=i}visitStyle(i,l){let c=l.currentTimeline,f=l.currentAnimateTimings;!f&&c.hasCurrentStyleProperties()&&c.forwardFrame();let r=f&&f.easing||i.easing;i.isEmptyStep?c.applyEmptyStep(r):c.setStyles(i.styles,r,l.errors,l.options),l.previousNode=i}visitKeyframes(i,l){let c=l.currentAnimateTimings,f=l.currentTimeline.duration,r=c.duration,C=l.createSubContext().currentTimeline;C.easing=c.easing,i.styles.forEach(A=>{let L=A.offset||0;C.forwardTime(L*r),C.setStyles(A.styles,A.easing,l.errors,l.options),C.applyStylesToKeyframe()}),l.currentTimeline.mergeTimelineCollectedStyles(C),l.transformIntoNewTimeline(f+r),l.previousNode=i}visitQuery(i,l){let c=l.currentTimeline.currentTime,f=i.options||{},r=f.delay?xl(f.delay):0;r&&(l.previousNode.type===Pn.Style||c==0&&l.currentTimeline.hasCurrentStyleProperties())&&(l.currentTimeline.snapshotCurrentStyles(),l.previousNode=O1);let w=c,C=l.invokeQuery(i.selector,i.originalSelector,i.limit,i.includeSelf,!!f.optional,l.errors);l.currentQueryTotal=C.length;let A=null;C.forEach((L,U)=>{l.currentQueryIndex=U;let Q=l.createSubContext(i.options,L);r&&Q.delayNextStep(r),L===l.element&&(A=Q.currentTimeline),Bo(this,i.animation,Q),Q.currentTimeline.applyStylesToKeyframe();let me=Q.currentTimeline.currentTime;w=Math.max(w,me)}),l.currentQueryIndex=0,l.currentQueryTotal=0,l.transformIntoNewTimeline(w),A&&(l.currentTimeline.mergeTimelineCollectedStyles(A),l.currentTimeline.snapshotCurrentStyles()),l.previousNode=i}visitStagger(i,l){let c=l.parentContext,f=l.currentTimeline,r=i.timings,w=Math.abs(r.duration),C=w*(l.currentQueryTotal-1),A=w*l.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":A=C-A;break;case"full":A=c.currentStaggerTime;break}let U=l.currentTimeline;A&&U.delayNextStep(A);let Q=U.currentTime;Bo(this,i.animation,l),l.previousNode=i,c.currentStaggerTime=f.currentTime-Q+(f.startTime-c.currentTimeline.startTime)}},O1={},_I=class o{constructor(i,l,c,f,r,w,C,A){this._driver=i,this.element=l,this.subInstructions=c,this._enterClassName=f,this._leaveClassName=r,this.errors=w,this.timelines=C,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=O1,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=A||new k1(this._driver,l,0),C.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(i,l){if(!i)return;let c=i,f=this.options;c.duration!=null&&(f.duration=xl(c.duration)),c.delay!=null&&(f.delay=xl(c.delay));let r=c.params;if(r){let w=f.params;w||(w=this.options.params={}),Object.keys(r).forEach(C=>{(!l||!w.hasOwnProperty(C))&&(w[C]=O_(r[C],w,this.errors))})}}_copyOptions(){let i={};if(this.options){let l=this.options.params;if(l){let c=i.params={};Object.keys(l).forEach(f=>{c[f]=l[f]})}}return i}createSubContext(i=null,l,c){let f=l||this.element,r=new o(this._driver,f,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(f,c||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(i),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(i){return this.previousNode=O1,this.currentTimeline=this.currentTimeline.fork(this.element,i),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(i,l,c){let f={duration:l??i.duration,delay:this.currentTimeline.currentTime+(c??0)+i.delay,easing:""},r=new yI(this._driver,i.element,i.keyframes,i.preStyleProps,i.postStyleProps,f,i.stretchStartingKeyframe);return this.timelines.push(r),f}incrementTime(i){this.currentTimeline.forwardTime(this.currentTimeline.duration+i)}delayNextStep(i){i>0&&this.currentTimeline.delayNextStep(i)}invokeQuery(i,l,c,f,r,w){let C=[];if(f&&C.push(this.element),i.length>0){i=i.replace(kW,"."+this._enterClassName),i=i.replace(FW,"."+this._leaveClassName);let A=c!=1,L=this._driver.query(this.element,i,A);c!==0&&(L=c<0?L.slice(L.length+c,L.length):L.slice(0,c)),C.push(...L)}return!r&&C.length==0&&w.push(Y7(l)),C}},k1=class o{constructor(i,l,c,f){this._driver=i,this.element=l,this.startTime=c,this._elementTimelineStylesLookup=f,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(l),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(l,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(i){let l=this._keyframes.size===1&&this._pendingStyles.size;this.duration||l?(this.forwardTime(this.currentTime+i),l&&this.snapshotCurrentStyles()):this.startTime+=i}fork(i,l){return this.applyStylesToKeyframe(),new o(this._driver,i,l||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=RW,this._loadKeyframe()}forwardTime(i){this.applyStylesToKeyframe(),this.duration=i,this._loadKeyframe()}_updateStyle(i,l){this._localTimelineStyles.set(i,l),this._globalTimelineStyles.set(i,l),this._styleSummary.set(i,{time:this.currentTime,value:l})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(i){i&&this._previousKeyframe.set("easing",i);for(let[l,c]of this._globalTimelineStyles)this._backFill.set(l,c||Ea),this._currentKeyframe.set(l,Ea);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(i,l,c,f){l&&this._previousKeyframe.set("easing",l);let r=f&&f.params||{},w=NW(i,this._globalTimelineStyles);for(let[C,A]of w){let L=O_(A,r,c);this._pendingStyles.set(C,L),this._localTimelineStyles.has(C)||this._backFill.set(C,this._globalTimelineStyles.get(C)??Ea),this._updateStyle(C,L)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((i,l)=>{this._currentKeyframe.set(l,i)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((i,l)=>{this._currentKeyframe.has(l)||this._currentKeyframe.set(l,i)}))}snapshotCurrentStyles(){for(let[i,l]of this._localTimelineStyles)this._pendingStyles.set(i,l),this._updateStyle(i,l)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let i=[];for(let l in this._currentKeyframe)i.push(l);return i}mergeTimelineCollectedStyles(i){i._styleSummary.forEach((l,c)=>{let f=this._styleSummary.get(c);(!f||l.time>f.time)&&this._updateStyle(c,l.value)})}buildKeyframes(){this.applyStylesToKeyframe();let i=new Set,l=new Set,c=this._keyframes.size===1&&this.duration===0,f=[];this._keyframes.forEach((C,A)=>{let L=new Map([...this._backFill,...C]);L.forEach((U,Q)=>{U===E1?i.add(Q):U===Ea&&l.add(Q)}),c||L.set("offset",A/this.duration),f.push(L)});let r=[...i.values()],w=[...l.values()];if(c){let C=f[0],A=new Map(C);C.set("offset",0),A.set("offset",1),f=[C,A]}return RI(this.element,f,r,w,this.duration,this.startTime,this.easing,!1)}},yI=class extends k1{constructor(i,l,c,f,r,w,C=!1){super(i,l,w.delay),this.keyframes=c,this.preStyleProps=f,this.postStyleProps=r,this._stretchStartingKeyframe=C,this.timings={duration:w.duration,delay:w.delay,easing:w.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let i=this.keyframes,{delay:l,duration:c,easing:f}=this.timings;if(this._stretchStartingKeyframe&&l){let r=[],w=c+l,C=l/w,A=new Map(i[0]);A.set("offset",0),r.push(A);let L=new Map(i[0]);L.set("offset",c3(C)),r.push(L);let U=i.length-1;for(let Q=1;Q<=U;Q++){let me=new Map(i[Q]),he=me.get("offset"),be=l+he*c;me.set("offset",c3(be/w)),r.push(me)}c=w,l=0,f="",i=r}return RI(this.element,i,this.preStyleProps,this.postStyleProps,c,l,f,!0)}};function c3(o,i=3){let l=Math.pow(10,i-1);return Math.round(o*l)/l}function NW(o,i){let l=new Map,c;return o.forEach(f=>{if(f==="*"){c??=i.keys();for(let r of c)l.set(r,Ea)}else for(let[r,w]of f)l.set(r,w)}),l}function u3(o,i,l,c,f,r,w,C,A,L,U,Q,me){return{type:0,element:o,triggerName:i,isRemovalTransition:f,fromState:l,fromStyles:r,toState:c,toStyles:w,timelines:C,queriedElements:A,preStyleProps:L,postStyleProps:U,totalTime:Q,errors:me}}var sI={},L1=class{constructor(i,l,c){this._triggerName=i,this.ast=l,this._stateStyles=c}match(i,l,c,f){return zW(this.ast.matchers,i,l,c,f)}buildStyles(i,l,c){let f=this._stateStyles.get("*");return i!==void 0&&(f=this._stateStyles.get(i?.toString())||f),f?f.buildStyles(l,c):new Map}build(i,l,c,f,r,w,C,A,L,U){let Q=[],me=this.ast.options&&this.ast.options.params||sI,he=C&&C.params||sI,be=this.buildStyles(c,he,Q),Ie=A&&A.params||sI,Qe=this.buildStyles(f,Ie,Q),ze=new Set,nt=new Map,ft=new Map,Ue=f==="void",Nt={params:C3(Ie,me),delay:this.ast.options?.delay},Yt=U?[]:S3(i,l,this.ast.animation,r,w,be,Qe,Nt,L,Q),Jt=0;return Yt.forEach(Et=>{Jt=Math.max(Et.duration+Et.delay,Jt)}),Q.length?u3(l,this._triggerName,c,f,Ue,be,Qe,[],[],nt,ft,Jt,Q):(Yt.forEach(Et=>{let tr=Et.element,Ct=Vo(nt,tr,new Set);Et.preStyleProps.forEach(br=>Ct.add(br));let _r=Vo(ft,tr,new Set);Et.postStyleProps.forEach(br=>_r.add(br)),tr!==l&&ze.add(tr)}),u3(l,this._triggerName,c,f,Ue,be,Qe,Yt,[...ze.values()],nt,ft,Jt))}};function zW(o,i,l,c,f){return o.some(r=>r(i,l,c,f))}function C3(o,i){let l=vt({},i);return Object.entries(o).forEach(([c,f])=>{f!=null&&(l[c]=f)}),l}var vI=class{constructor(i,l,c){this.styles=i,this.defaultParams=l,this.normalizer=c}buildStyles(i,l){let c=new Map,f=C3(i,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((w,C)=>{w&&(w=O_(w,f,l));let A=this.normalizer.normalizePropertyName(C,l);w=this.normalizer.normalizeStyleValue(C,A,w,l),c.set(C,w)})}),c}};function BW(o,i,l){return new xI(o,i,l)}var xI=class{constructor(i,l,c){this.name=i,this.ast=l,this._normalizer=c,this.transitionFactories=[],this.states=new Map,l.states.forEach(f=>{let r=f.options&&f.options.params||{};this.states.set(f.name,new vI(f.style,r,c))}),h3(this.states,"true","1"),h3(this.states,"false","0"),l.transitions.forEach(f=>{this.transitionFactories.push(new L1(i,f,this.states))}),this.fallbackTransition=VW(i,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(i,l,c,f){return this.transitionFactories.find(w=>w.match(i,l,c,f))||null}matchStyles(i,l,c){return this.fallbackTransition.buildStyles(i,l,c)}};function VW(o,i,l){let c=[(w,C)=>!0],f={type:Pn.Sequence,steps:[],options:null},r={type:Pn.Transition,animation:f,matchers:c,options:null,queryCount:0,depCount:0};return new L1(o,r,i)}function h3(o,i,l){o.has(i)?o.has(l)||o.set(l,o.get(i)):o.has(l)&&o.set(i,o.get(l))}var jW=new k_,bI=class{constructor(i,l,c){this.bodyNode=i,this._driver=l,this._normalizer=c,this._animations=new Map,this._playersById=new Map,this.players=[]}register(i,l){let c=[],f=[],r=T3(this._driver,l,c,f);if(c.length)throw tW(c);f.length&&void 0,this._animations.set(i,r)}_buildPlayer(i,l,c){let f=i.element,r=_3(this._normalizer,i.keyframes,l,c);return this._driver.animate(f,r,i.duration,i.delay,i.easing,[],!0)}create(i,l,c={}){let f=[],r=this._animations.get(i),w,C=new Map;if(r?(w=S3(this._driver,l,r,b3,uI,new Map,new Map,c,jW,f),w.forEach(U=>{let Q=Vo(C,U.element,new Map);U.postStyleProps.forEach(me=>Q.set(me,null))})):(f.push(nW()),w=[]),f.length)throw rW(f);C.forEach((U,Q)=>{U.forEach((me,he)=>{U.set(he,this._driver.computeStyle(Q,he,Ea))})});let A=w.map(U=>{let Q=C.get(U.element);return this._buildPlayer(U,new Map,Q)}),L=su(A);return this._playersById.set(i,L),L.onDestroy(()=>this.destroy(i)),this.players.push(L),L}destroy(i){let l=this._getPlayer(i);l.destroy(),this._playersById.delete(i);let c=this.players.indexOf(l);c>=0&&this.players.splice(c,1)}_getPlayer(i){let l=this._playersById.get(i);if(!l)throw iW(i);return l}listen(i,l,c,f){let r=II(l,"","","");return CI(this._getPlayer(i),c,r,f),()=>{}}command(i,l,c,f){if(c=="register"){this.register(i,f[0]);return}if(c=="create"){let w=f[0]||{};this.create(i,l,w);return}let r=this._getPlayer(i);switch(c){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(f[0]));break;case"destroy":this.destroy(i);break}}},d3="ng-animate-queued",UW=".ng-animate-queued",aI="ng-animate-disabled",$W=".ng-animate-disabled",GW="ng-star-inserted",HW=".ng-star-inserted",qW=[],I3={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},WW={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Bs="__ng_removed",L_=class{get params(){return this.options.params}constructor(i,l=""){this.namespaceId=l;let c=i&&i.hasOwnProperty("value"),f=c?i.value:i;if(this.value=XW(f),c){let r=i,{value:w}=r,C=ns(r,["value"]);this.options=C}else this.options={};this.options.params||(this.options.params={})}absorbOptions(i){let l=i.params;if(l){let c=this.options.params;Object.keys(l).forEach(f=>{c[f]==null&&(c[f]=l[f])})}}},R_="void",lI=new L_(R_),wI=class{constructor(i,l,c){this.id=i,this.hostElement=l,this._engine=c,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+i,ls(l,this._hostClassName)}listen(i,l,c,f){if(!this._triggers.has(l))throw oW(c,l);if(c==null||c.length==0)throw sW(l);if(!YW(c))throw aW(c,l);let r=Vo(this._elementListeners,i,[]),w={name:l,phase:c,callback:f};r.push(w);let C=Vo(this._engine.statesByElement,i,new Map);return C.has(l)||(ls(i,T1),ls(i,T1+"-"+l),C.set(l,lI)),()=>{this._engine.afterFlush(()=>{let A=r.indexOf(w);A>=0&&r.splice(A,1),this._triggers.has(l)||C.delete(l)})}}register(i,l){return this._triggers.has(i)?!1:(this._triggers.set(i,l),!0)}_getTrigger(i){let l=this._triggers.get(i);if(!l)throw lW(i);return l}trigger(i,l,c,f=!0){let r=this._getTrigger(l),w=new F_(this.id,l,i),C=this._engine.statesByElement.get(i);C||(ls(i,T1),ls(i,T1+"-"+l),this._engine.statesByElement.set(i,C=new Map));let A=C.get(l),L=new L_(c,this.id);if(!(c&&c.hasOwnProperty("value"))&&A&&L.absorbOptions(A.options),C.set(l,L),A||(A=lI),!(L.value===R_)&&A.value===L.value){if(!JW(A.params,L.params)){let Ie=[],Qe=r.matchStyles(A.value,A.params,Ie),ze=r.matchStyles(L.value,L.params,Ie);Ie.length?this._engine.reportError(Ie):this._engine.afterFlush(()=>{Zh(i,Qe),Ta(i,ze)})}return}let me=Vo(this._engine.playersByElement,i,[]);me.forEach(Ie=>{Ie.namespaceId==this.id&&Ie.triggerName==l&&Ie.queued&&Ie.destroy()});let he=r.matchTransition(A.value,L.value,i,L.params),be=!1;if(!he){if(!f)return;he=r.fallbackTransition,be=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:l,transition:he,fromState:A,toState:L,player:w,isFallbackTransition:be}),be||(ls(i,d3),w.onStart(()=>{mp(i,d3)})),w.onDone(()=>{let Ie=this.players.indexOf(w);Ie>=0&&this.players.splice(Ie,1);let Qe=this._engine.playersByElement.get(i);if(Qe){let ze=Qe.indexOf(w);ze>=0&&Qe.splice(ze,1)}}),this.players.push(w),me.push(w),w}deregister(i){this._triggers.delete(i),this._engine.statesByElement.forEach(l=>l.delete(i)),this._elementListeners.forEach((l,c)=>{this._elementListeners.set(c,l.filter(f=>f.name!=i))})}clearElementCache(i){this._engine.statesByElement.delete(i),this._elementListeners.delete(i);let l=this._engine.playersByElement.get(i);l&&(l.forEach(c=>c.destroy()),this._engine.playersByElement.delete(i))}_signalRemovalForInnerTriggers(i,l){let c=this._engine.driver.query(i,M1,!0);c.forEach(f=>{if(f[Bs])return;let r=this._engine.fetchNamespacesByElement(f);r.size?r.forEach(w=>w.triggerLeaveAnimation(f,l,!1,!0)):this.clearElementCache(f)}),this._engine.afterFlushAnimationsDone(()=>c.forEach(f=>this.clearElementCache(f)))}triggerLeaveAnimation(i,l,c,f){let r=this._engine.statesByElement.get(i),w=new Map;if(r){let C=[];if(r.forEach((A,L)=>{if(w.set(L,A.value),this._triggers.has(L)){let U=this.trigger(i,L,R_,f);U&&C.push(U)}}),C.length)return this._engine.markElementAsRemoved(this.id,i,!0,l,w),c&&su(C).onDone(()=>this._engine.processLeaveNode(i)),!0}return!1}prepareLeaveAnimationListeners(i){let l=this._elementListeners.get(i),c=this._engine.statesByElement.get(i);if(l&&c){let f=new Set;l.forEach(r=>{let w=r.name;if(f.has(w))return;f.add(w);let A=this._triggers.get(w).fallbackTransition,L=c.get(w)||lI,U=new L_(R_),Q=new F_(this.id,w,i);this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:w,transition:A,fromState:L,toState:U,player:Q,isFallbackTransition:!0})})}}removeNode(i,l){let c=this._engine;if(i.childElementCount&&this._signalRemovalForInnerTriggers(i,l),this.triggerLeaveAnimation(i,l,!0))return;let f=!1;if(c.totalAnimations){let r=c.players.length?c.playersByQueriedElement.get(i):[];if(r&&r.length)f=!0;else{let w=i;for(;w=w.parentNode;)if(c.statesByElement.get(w)){f=!0;break}}}if(this.prepareLeaveAnimationListeners(i),f)c.markElementAsRemoved(this.id,i,!1,l);else{let r=i[Bs];(!r||r===I3)&&(c.afterFlush(()=>this.clearElementCache(i)),c.destroyInnerAnimations(i),c._onRemovalComplete(i,l))}}insertNode(i,l){ls(i,this._hostClassName)}drainQueuedTransitions(i){let l=[];return this._queue.forEach(c=>{let f=c.player;if(f.destroyed)return;let r=c.element,w=this._elementListeners.get(r);w&&w.forEach(C=>{if(C.name==c.triggerName){let A=II(r,c.triggerName,c.fromState.value,c.toState.value);A._data=i,CI(c.player,C.phase,A,C.callback)}}),f.markedForDestroy?this._engine.afterFlush(()=>{f.destroy()}):l.push(c)}),this._queue=[],l.sort((c,f)=>{let r=c.transition.ast.depCount,w=f.transition.ast.depCount;return r==0||w==0?r-w:this._engine.driver.containsElement(c.element,f.element)?1:-1})}destroy(i){this.players.forEach(l=>l.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,i)}},EI=class{_onRemovalComplete(i,l){this.onRemovalComplete(i,l)}constructor(i,l,c){this.bodyNode=i,this.driver=l,this._normalizer=c,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(f,r)=>{}}get queuedPlayers(){let i=[];return this._namespaceList.forEach(l=>{l.players.forEach(c=>{c.queued&&i.push(c)})}),i}createNamespace(i,l){let c=new wI(i,l,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,l)?this._balanceNamespaceList(c,l):(this.newHostElements.set(l,c),this.collectEnterElement(l)),this._namespaceLookup[i]=c}_balanceNamespaceList(i,l){let c=this._namespaceList,f=this.namespacesByHostElement;if(c.length-1>=0){let w=!1,C=this.driver.getParentElement(l);for(;C;){let A=f.get(C);if(A){let L=c.indexOf(A);c.splice(L+1,0,i),w=!0;break}C=this.driver.getParentElement(C)}w||c.unshift(i)}else c.push(i);return f.set(l,i),i}register(i,l){let c=this._namespaceLookup[i];return c||(c=this.createNamespace(i,l)),c}registerTrigger(i,l,c){let f=this._namespaceLookup[i];f&&f.register(l,c)&&this.totalAnimations++}destroy(i,l){i&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let c=this._fetchNamespace(i);this.namespacesByHostElement.delete(c.hostElement);let f=this._namespaceList.indexOf(c);f>=0&&this._namespaceList.splice(f,1),c.destroy(l),delete this._namespaceLookup[i]}))}_fetchNamespace(i){return this._namespaceLookup[i]}fetchNamespacesByElement(i){let l=new Set,c=this.statesByElement.get(i);if(c){for(let f of c.values())if(f.namespaceId){let r=this._fetchNamespace(f.namespaceId);r&&l.add(r)}}return l}trigger(i,l,c,f){if(I1(l)){let r=this._fetchNamespace(i);if(r)return r.trigger(l,c,f),!0}return!1}insertNode(i,l,c,f){if(!I1(l))return;let r=l[Bs];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let w=this.collectedLeaveElements.indexOf(l);w>=0&&this.collectedLeaveElements.splice(w,1)}if(i){let w=this._fetchNamespace(i);w&&w.insertNode(l,c)}f&&this.collectEnterElement(l)}collectEnterElement(i){this.collectedEnterElements.push(i)}markElementAsDisabled(i,l){l?this.disabledNodes.has(i)||(this.disabledNodes.add(i),ls(i,aI)):this.disabledNodes.has(i)&&(this.disabledNodes.delete(i),mp(i,aI))}removeNode(i,l,c){if(I1(l)){let f=i?this._fetchNamespace(i):null;f?f.removeNode(l,c):this.markElementAsRemoved(i,l,!1,c);let r=this.namespacesByHostElement.get(l);r&&r.id!==i&&r.removeNode(l,c)}else this._onRemovalComplete(l,c)}markElementAsRemoved(i,l,c,f,r){this.collectedLeaveElements.push(l),l[Bs]={namespaceId:i,setForRemoval:f,hasAnimation:c,removedBeforeQueried:!1,previousTriggersValues:r}}listen(i,l,c,f,r){return I1(l)?this._fetchNamespace(i).listen(l,c,f,r):()=>{}}_buildInstruction(i,l,c,f,r){return i.transition.build(this.driver,i.element,i.fromState.value,i.toState.value,c,f,i.fromState.options,i.toState.options,l,r)}destroyInnerAnimations(i){let l=this.driver.query(i,M1,!0);l.forEach(c=>this.destroyActiveAnimationsForElement(c)),this.playersByQueriedElement.size!=0&&(l=this.driver.query(i,hI,!0),l.forEach(c=>this.finishActiveQueriedAnimationOnElement(c)))}destroyActiveAnimationsForElement(i){let l=this.playersByElement.get(i);l&&l.forEach(c=>{c.queued?c.markedForDestroy=!0:c.destroy()})}finishActiveQueriedAnimationOnElement(i){let l=this.playersByQueriedElement.get(i);l&&l.forEach(c=>c.finish())}whenRenderingDone(){return new Promise(i=>{if(this.players.length)return su(this.players).onDone(()=>i());i()})}processLeaveNode(i){let l=i[Bs];if(l&&l.setForRemoval){if(i[Bs]=I3,l.namespaceId){this.destroyInnerAnimations(i);let c=this._fetchNamespace(l.namespaceId);c&&c.clearElementCache(i)}this._onRemovalComplete(i,l.setForRemoval)}i.classList?.contains(aI)&&this.markElementAsDisabled(i,!1),this.driver.query(i,$W,!0).forEach(c=>{this.markElementAsDisabled(c,!1)})}flush(i=-1){let l=[];if(this.newHostElements.size&&(this.newHostElements.forEach((c,f)=>this._balanceNamespaceList(c,f)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let c=0;c<this.collectedEnterElements.length;c++){let f=this.collectedEnterElements[c];ls(f,GW)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let c=[];try{l=this._flushAnimations(c,i)}finally{for(let f=0;f<c.length;f++)c[f]()}}else for(let c=0;c<this.collectedLeaveElements.length;c++){let f=this.collectedLeaveElements[c];this.processLeaveNode(f)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(c=>c()),this._flushFns=[],this._whenQuietFns.length){let c=this._whenQuietFns;this._whenQuietFns=[],l.length?su(l).onDone(()=>{c.forEach(f=>f())}):c.forEach(f=>f())}}reportError(i){throw cW(i)}_flushAnimations(i,l){let c=new k_,f=[],r=new Map,w=[],C=new Map,A=new Map,L=new Map,U=new Set;this.disabledNodes.forEach(wt=>{U.add(wt);let zt=this.driver.query(wt,UW,!0);for(let Ht=0;Ht<zt.length;Ht++)U.add(zt[Ht])});let Q=this.bodyNode,me=Array.from(this.statesByElement.keys()),he=m3(me,this.collectedEnterElements),be=new Map,Ie=0;he.forEach((wt,zt)=>{let Ht=b3+Ie++;be.set(zt,Ht),wt.forEach(_n=>ls(_n,Ht))});let Qe=[],ze=new Set,nt=new Set;for(let wt=0;wt<this.collectedLeaveElements.length;wt++){let zt=this.collectedLeaveElements[wt],Ht=zt[Bs];Ht&&Ht.setForRemoval&&(Qe.push(zt),ze.add(zt),Ht.hasAnimation?this.driver.query(zt,HW,!0).forEach(_n=>ze.add(_n)):nt.add(zt))}let ft=new Map,Ue=m3(me,Array.from(ze));Ue.forEach((wt,zt)=>{let Ht=uI+Ie++;ft.set(zt,Ht),wt.forEach(_n=>ls(_n,Ht))}),i.push(()=>{he.forEach((wt,zt)=>{let Ht=be.get(zt);wt.forEach(_n=>mp(_n,Ht))}),Ue.forEach((wt,zt)=>{let Ht=ft.get(zt);wt.forEach(_n=>mp(_n,Ht))}),Qe.forEach(wt=>{this.processLeaveNode(wt)})});let Nt=[],Yt=[];for(let wt=this._namespaceList.length-1;wt>=0;wt--)this._namespaceList[wt].drainQueuedTransitions(l).forEach(Ht=>{let _n=Ht.player,kt=Ht.element;if(Nt.push(_n),this.collectedEnterElements.length){let Dr=kt[Bs];if(Dr&&Dr.setForMove){if(Dr.previousTriggersValues&&Dr.previousTriggersValues.has(Ht.triggerName)){let zn=Dr.previousTriggersValues.get(Ht.triggerName),ci=this.statesByElement.get(Ht.element);if(ci&&ci.has(Ht.triggerName)){let cs=ci.get(Ht.triggerName);cs.value=zn,ci.set(Ht.triggerName,cs)}}_n.destroy();return}}let li=!Q||!this.driver.containsElement(Q,kt),Qn=ft.get(kt),Zi=be.get(kt),dr=this._buildInstruction(Ht,c,Zi,Qn,li);if(dr.errors&&dr.errors.length){Yt.push(dr);return}if(li){_n.onStart(()=>Zh(kt,dr.fromStyles)),_n.onDestroy(()=>Ta(kt,dr.toStyles)),f.push(_n);return}if(Ht.isFallbackTransition){_n.onStart(()=>Zh(kt,dr.fromStyles)),_n.onDestroy(()=>Ta(kt,dr.toStyles)),f.push(_n);return}let Sa=[];dr.timelines.forEach(Dr=>{Dr.stretchStartingKeyframe=!0,this.disabledNodes.has(Dr.element)||Sa.push(Dr)}),dr.timelines=Sa,c.append(kt,dr.timelines);let Pt={instruction:dr,player:_n,element:kt};w.push(Pt),dr.queriedElements.forEach(Dr=>Vo(C,Dr,[]).push(_n)),dr.preStyleProps.forEach((Dr,zn)=>{if(Dr.size){let ci=A.get(zn);ci||A.set(zn,ci=new Set),Dr.forEach((cs,Vs)=>ci.add(Vs))}}),dr.postStyleProps.forEach((Dr,zn)=>{let ci=L.get(zn);ci||L.set(zn,ci=new Set),Dr.forEach((cs,Vs)=>ci.add(Vs))})});if(Yt.length){let wt=[];Yt.forEach(zt=>{wt.push(uW(zt.triggerName,zt.errors))}),Nt.forEach(zt=>zt.destroy()),this.reportError(wt)}let Jt=new Map,Et=new Map;w.forEach(wt=>{let zt=wt.element;c.has(zt)&&(Et.set(zt,zt),this._beforeAnimationBuild(wt.player.namespaceId,wt.instruction,Jt))}),f.forEach(wt=>{let zt=wt.element;this._getPreviousPlayers(zt,!1,wt.namespaceId,wt.triggerName,null).forEach(_n=>{Vo(Jt,zt,[]).push(_n),_n.destroy()})});let tr=Qe.filter(wt=>g3(wt,A,L)),Ct=new Map;p3(Ct,this.driver,nt,L,Ea).forEach(wt=>{g3(wt,A,L)&&tr.push(wt)});let br=new Map;he.forEach((wt,zt)=>{p3(br,this.driver,new Set(wt),A,E1)}),tr.forEach(wt=>{let zt=Ct.get(wt),Ht=br.get(wt);Ct.set(wt,new Map([...zt?.entries()??[],...Ht?.entries()??[]]))});let zr=[],xn=[],jo={};w.forEach(wt=>{let{element:zt,player:Ht,instruction:_n}=wt;if(c.has(zt)){if(U.has(zt)){Ht.onDestroy(()=>Ta(zt,_n.toStyles)),Ht.disabled=!0,Ht.overrideTotalTime(_n.totalTime),f.push(Ht);return}let kt=jo;if(Et.size>1){let Qn=zt,Zi=[];for(;Qn=Qn.parentNode;){let dr=Et.get(Qn);if(dr){kt=dr;break}Zi.push(Qn)}Zi.forEach(dr=>Et.set(dr,kt))}let li=this._buildAnimation(Ht.namespaceId,_n,Jt,r,br,Ct);if(Ht.setRealPlayer(li),kt===jo)zr.push(Ht);else{let Qn=this.playersByElement.get(kt);Qn&&Qn.length&&(Ht.parentPlayer=su(Qn)),f.push(Ht)}}else Zh(zt,_n.fromStyles),Ht.onDestroy(()=>Ta(zt,_n.toStyles)),xn.push(Ht),U.has(zt)&&f.push(Ht)}),xn.forEach(wt=>{let zt=r.get(wt.element);if(zt&&zt.length){let Ht=su(zt);wt.setRealPlayer(Ht)}}),f.forEach(wt=>{wt.parentPlayer?wt.syncPlayerEvents(wt.parentPlayer):wt.destroy()});for(let wt=0;wt<Qe.length;wt++){let zt=Qe[wt],Ht=zt[Bs];if(mp(zt,uI),Ht&&Ht.hasAnimation)continue;let _n=[];if(C.size){let li=C.get(zt);li&&li.length&&_n.push(...li);let Qn=this.driver.query(zt,hI,!0);for(let Zi=0;Zi<Qn.length;Zi++){let dr=C.get(Qn[Zi]);dr&&dr.length&&_n.push(...dr)}}let kt=_n.filter(li=>!li.destroyed);kt.length?KW(this,zt,kt):this.processLeaveNode(zt)}return Qe.length=0,zr.forEach(wt=>{this.players.push(wt),wt.onDone(()=>{wt.destroy();let zt=this.players.indexOf(wt);this.players.splice(zt,1)}),wt.play()}),zr}afterFlush(i){this._flushFns.push(i)}afterFlushAnimationsDone(i){this._whenQuietFns.push(i)}_getPreviousPlayers(i,l,c,f,r){let w=[];if(l){let C=this.playersByQueriedElement.get(i);C&&(w=C)}else{let C=this.playersByElement.get(i);if(C){let A=!r||r==R_;C.forEach(L=>{L.queued||!A&&L.triggerName!=f||w.push(L)})}}return(c||f)&&(w=w.filter(C=>!(c&&c!=C.namespaceId||f&&f!=C.triggerName))),w}_beforeAnimationBuild(i,l,c){let f=l.triggerName,r=l.element,w=l.isRemovalTransition?void 0:i,C=l.isRemovalTransition?void 0:f;for(let A of l.timelines){let L=A.element,U=L!==r,Q=Vo(c,L,[]);this._getPreviousPlayers(L,U,w,C,l.toState).forEach(he=>{let be=he.getRealPlayer();be.beforeDestroy&&be.beforeDestroy(),he.destroy(),Q.push(he)})}Zh(r,l.fromStyles)}_buildAnimation(i,l,c,f,r,w){let C=l.triggerName,A=l.element,L=[],U=new Set,Q=new Set,me=l.timelines.map(be=>{let Ie=be.element;U.add(Ie);let Qe=Ie[Bs];if(Qe&&Qe.removedBeforeQueried)return new ou(be.duration,be.delay);let ze=Ie!==A,nt=QW((c.get(Ie)||qW).map(Jt=>Jt.getRealPlayer())).filter(Jt=>{let Et=Jt;return Et.element?Et.element===Ie:!1}),ft=r.get(Ie),Ue=w.get(Ie),Nt=_3(this._normalizer,be.keyframes,ft,Ue),Yt=this._buildPlayer(be,Nt,nt);if(be.subTimeline&&f&&Q.add(Ie),ze){let Jt=new F_(i,C,Ie);Jt.setRealPlayer(Yt),L.push(Jt)}return Yt});L.forEach(be=>{Vo(this.playersByQueriedElement,be.element,[]).push(be),be.onDone(()=>ZW(this.playersByQueriedElement,be.element,be))}),U.forEach(be=>ls(be,s3));let he=su(me);return he.onDestroy(()=>{U.forEach(be=>mp(be,s3)),Ta(A,l.toStyles)}),Q.forEach(be=>{Vo(f,be,[]).push(he)}),he}_buildPlayer(i,l,c){return l.length>0?this.driver.animate(i.element,l,i.duration,i.delay,i.easing,c):new ou(i.duration,i.delay)}},F_=class{constructor(i,l,c){this.namespaceId=i,this.triggerName=l,this.element=c,this._player=new ou,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(i){this._containsRealPlayer||(this._player=i,this._queuedCallbacks.forEach((l,c)=>{l.forEach(f=>CI(i,c,void 0,f))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(i.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(i){this.totalTime=i}syncPlayerEvents(i){let l=this._player;l.triggerCallback&&i.onStart(()=>l.triggerCallback("start")),i.onDone(()=>this.finish()),i.onDestroy(()=>this.destroy())}_queueEvent(i,l){Vo(this._queuedCallbacks,i,[]).push(l)}onDone(i){this.queued&&this._queueEvent("done",i),this._player.onDone(i)}onStart(i){this.queued&&this._queueEvent("start",i),this._player.onStart(i)}onDestroy(i){this.queued&&this._queueEvent("destroy",i),this._player.onDestroy(i)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(i){this.queued||this._player.setPosition(i)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(i){let l=this._player;l.triggerCallback&&l.triggerCallback(i)}};function ZW(o,i,l){let c=o.get(i);if(c){if(c.length){let f=c.indexOf(l);c.splice(f,1)}c.length==0&&o.delete(i)}return c}function XW(o){return o??null}function I1(o){return o&&o.nodeType===1}function YW(o){return o=="start"||o=="done"}function f3(o,i){let l=o.style.display;return o.style.display=i??"none",l}function p3(o,i,l,c,f){let r=[];l.forEach(A=>r.push(f3(A)));let w=[];c.forEach((A,L)=>{let U=new Map;A.forEach(Q=>{let me=i.computeStyle(L,Q,f);U.set(Q,me),(!me||me.length==0)&&(L[Bs]=WW,w.push(L))}),o.set(L,U)});let C=0;return l.forEach(A=>f3(A,r[C++])),w}function m3(o,i){let l=new Map;if(o.forEach(C=>l.set(C,[])),i.length==0)return l;let c=1,f=new Set(i),r=new Map;function w(C){if(!C)return c;let A=r.get(C);if(A)return A;let L=C.parentNode;return l.has(L)?A=L:f.has(L)?A=c:A=w(L),r.set(C,A),A}return i.forEach(C=>{let A=w(C);A!==c&&l.get(A).push(C)}),l}function ls(o,i){o.classList?.add(i)}function mp(o,i){o.classList?.remove(i)}function KW(o,i,l){su(l).onDone(()=>o.processLeaveNode(i))}function QW(o){let i=[];return D3(o,i),i}function D3(o,i){for(let l=0;l<o.length;l++){let c=o[l];c instanceof A_?D3(c.players,i):i.push(c)}}function JW(o,i){let l=Object.keys(o),c=Object.keys(i);if(l.length!=c.length)return!1;for(let f=0;f<l.length;f++){let r=l[f];if(!i.hasOwnProperty(r)||o[r]!==i[r])return!1}return!0}function g3(o,i,l){let c=l.get(o);if(!c)return!1;let f=i.get(o);return f?c.forEach(r=>f.add(r)):i.set(o,c),l.delete(o),!0}var _p=class{constructor(i,l,c){this._driver=l,this._normalizer=c,this._triggerCache={},this.onRemovalComplete=(f,r)=>{},this._transitionEngine=new EI(i.body,l,c),this._timelineEngine=new bI(i.body,l,c),this._transitionEngine.onRemovalComplete=(f,r)=>this.onRemovalComplete(f,r)}registerTrigger(i,l,c,f,r){let w=i+"-"+f,C=this._triggerCache[w];if(!C){let A=[],L=[],U=T3(this._driver,r,A,L);if(A.length)throw J7(f,A);L.length&&void 0,C=BW(f,U,this._normalizer),this._triggerCache[w]=C}this._transitionEngine.registerTrigger(l,f,C)}register(i,l){this._transitionEngine.register(i,l)}destroy(i,l){this._transitionEngine.destroy(i,l)}onInsert(i,l,c,f){this._transitionEngine.insertNode(i,l,c,f)}onRemove(i,l,c){this._transitionEngine.removeNode(i,l,c)}disableAnimations(i,l){this._transitionEngine.markElementAsDisabled(i,l)}process(i,l,c,f){if(c.charAt(0)=="@"){let[r,w]=i3(c),C=f;this._timelineEngine.command(r,l,w,C)}else this._transitionEngine.trigger(i,l,c,f)}listen(i,l,c,f,r){if(c.charAt(0)=="@"){let[w,C]=i3(c);return this._timelineEngine.listen(w,l,C,r)}return this._transitionEngine.listen(i,l,c,f,r)}flush(i=-1){this._transitionEngine.flush(i)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(i){this._transitionEngine.afterFlushAnimationsDone(i)}};function eZ(o,i){let l=null,c=null;return Array.isArray(i)&&i.length?(l=cI(i[0]),i.length>1&&(c=cI(i[i.length-1]))):i instanceof Map&&(l=cI(i)),l||c?new TI(o,l,c):null}var gp=class gp{constructor(i,l,c){this._element=i,this._startStyles=l,this._endStyles=c,this._state=0;let f=gp.initialStylesByElement.get(i);f||gp.initialStylesByElement.set(i,f=new Map),this._initialStyles=f}start(){this._state<1&&(this._startStyles&&Ta(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ta(this._element,this._initialStyles),this._endStyles&&(Ta(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(gp.initialStylesByElement.delete(this._element),this._startStyles&&(Zh(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Zh(this._element,this._endStyles),this._endStyles=null),Ta(this._element,this._initialStyles),this._state=3)}};gp.initialStylesByElement=new WeakMap;var TI=gp;function cI(o){let i=null;return o.forEach((l,c)=>{tZ(c)&&(i=i||new Map,i.set(c,l))}),i}function tZ(o){return o==="display"||o==="position"}var F1=class{constructor(i,l,c,f){this.element=i,this.keyframes=l,this.options=c,this._specialStyles=f,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=c.duration,this._delay=c.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let i=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,i,this.options),this._finalKeyframe=i.length?i[i.length-1]:new Map;let l=()=>this._onFinish();this.domPlayer.addEventListener("finish",l),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",l)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(i){let l=[];return i.forEach(c=>{l.push(Object.fromEntries(c))}),l}_triggerWebAnimation(i,l,c){return i.animate(this._convertKeyframesToObject(l),c)}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(i=>i()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}setPosition(i){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=i*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let i=new Map;this.hasStarted()&&this._finalKeyframe.forEach((c,f)=>{f!=="offset"&&i.set(f,this._finished?c:PI(this.element,f))}),this.currentSnapshot=i}triggerCallback(i){let l=i==="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},N1=class{validateStyleProperty(i){return!0}validateAnimatableStyleProperty(i){return!0}containsElement(i,l){return y3(i,l)}getParentElement(i){return DI(i)}query(i,l,c){return v3(i,l,c)}computeStyle(i,l,c){return PI(i,l)}animate(i,l,c,f,r,w=[]){let C=f==0?"both":"forwards",A={duration:c,delay:f,fill:C};r&&(A.easing=r);let L=new Map,U=w.filter(he=>he instanceof F1);bW(c,f)&&U.forEach(he=>{he.currentSnapshot.forEach((be,Ie)=>L.set(Ie,be))});let Q=yW(l).map(he=>new Map(he));Q=wW(i,Q,L);let me=eZ(i,Q);return new F1(i,Q,A,me)}};var D1="@",M3="@.disabled",z1=class{constructor(i,l,c,f){this.namespaceId=i,this.delegate=l,this.engine=c,this._onDestroy=f,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(i){this.delegate.destroyNode?.(i)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(i,l){return this.delegate.createElement(i,l)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}appendChild(i,l){this.delegate.appendChild(i,l),this.engine.onInsert(this.namespaceId,l,i,!1)}insertBefore(i,l,c,f=!0){this.delegate.insertBefore(i,l,c),this.engine.onInsert(this.namespaceId,l,i,f)}removeChild(i,l,c){this.engine.onRemove(this.namespaceId,l,this.delegate)}selectRootElement(i,l){return this.delegate.selectRootElement(i,l)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,l,c,f){this.delegate.setAttribute(i,l,c,f)}removeAttribute(i,l,c){this.delegate.removeAttribute(i,l,c)}addClass(i,l){this.delegate.addClass(i,l)}removeClass(i,l){this.delegate.removeClass(i,l)}setStyle(i,l,c,f){this.delegate.setStyle(i,l,c,f)}removeStyle(i,l,c){this.delegate.removeStyle(i,l,c)}setProperty(i,l,c){l.charAt(0)==D1&&l==M3?this.disableAnimations(i,!!c):this.delegate.setProperty(i,l,c)}setValue(i,l){this.delegate.setValue(i,l)}listen(i,l,c){return this.delegate.listen(i,l,c)}disableAnimations(i,l){this.engine.disableAnimations(i,l)}},SI=class extends z1{constructor(i,l,c,f,r){super(l,c,f,r),this.factory=i,this.namespaceId=l}setProperty(i,l,c){l.charAt(0)==D1?l.charAt(1)=="."&&l==M3?(c=c===void 0?!0:!!c,this.disableAnimations(i,c)):this.engine.process(this.namespaceId,i,l.slice(1),c):this.delegate.setProperty(i,l,c)}listen(i,l,c){if(l.charAt(0)==D1){let f=nZ(i),r=l.slice(1),w="";return r.charAt(0)!=D1&&([r,w]=rZ(r)),this.engine.listen(this.namespaceId,f,r,w,C=>{let A=C._data||-1;this.factory.scheduleListenerCallback(A,c,C)})}return this.delegate.listen(i,l,c)}};function nZ(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}function rZ(o){let i=o.indexOf("."),l=o.substring(0,i),c=o.slice(i+1);return[l,c]}var B1=class{constructor(i,l,c){this.delegate=i,this.engine=l,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,l.onRemovalComplete=(f,r)=>{let w=r?.parentNode(f);w&&r.removeChild(w,f)}}createRenderer(i,l){let c="",f=this.delegate.createRenderer(i,l);if(!i||!l?.data?.animation){let L=this._rendererCache,U=L.get(f);if(!U){let Q=()=>L.delete(f);U=new z1(c,f,this.engine,Q),L.set(f,U)}return U}let r=l.id,w=l.id+"-"+this._currentId;this._currentId++,this.engine.register(w,i);let C=L=>{Array.isArray(L)?L.forEach(C):this.engine.registerTrigger(r,w,i,L.name,L)};return l.data.animation.forEach(C),new SI(this,w,f,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,l,c){if(i>=0&&i<this._microtaskId){this._zone.run(()=>l(c));return}let f=this._animationCallbacksBuffer;f.length==0&&queueMicrotask(()=>{this._zone.run(()=>{f.forEach(r=>{let[w,C]=r;w(C)}),this._animationCallbacksBuffer=[]})}),f.push([l,c])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var oZ=(()=>{let i=class i extends _p{constructor(c,f,r){super(c,f,r,bt(Nf,{optional:!0}))}ngOnDestroy(){this.flush()}};i.\u0275fac=function(f){return new(f||i)(fn(Qr),fn(Xh),fn(Yh))},i.\u0275prov=$t({token:i,factory:i.\u0275fac});let o=i;return o})();function sZ(){return new P1}function aZ(o,i,l){return new B1(o,i,l)}var A3=[{provide:Yh,useFactory:sZ},{provide:_p,useClass:oZ},{provide:Ih,useFactory:aZ,deps:[Ex,_p,Ar]}],lZ=[{provide:Xh,useFactory:()=>new N1},{provide:JT,useValue:"BrowserAnimations"},...A3],uhe=[{provide:Xh,useClass:MI},{provide:JT,useValue:"NoopAnimations"},...A3];function P3(){return $c("NgEagerAnimations"),[...lZ]}var R3={providers:[TL(XN,CL(),IL()),KN(),P3(),zS()]};function O3(o){return typeof o=="string"}function k3(o){return typeof o=="number"&&Number(o)==o}function j1(o,i=0,l="0"){return typeof o!="string"&&(o=o.toString()),i>o.length?Array(i-o.length+1).join(l)+o:o}function kI(o){let i,l,c,f=o.h,r=o.s,w=o.l;if(r==0)i=l=c=w;else{let C=function(Q,me,he){return he<0&&(he+=1),he>1&&(he-=1),he<.16666666666666666?Q+(me-Q)*6*he:he<.5?me:he<.6666666666666666?Q+(me-Q)*(.6666666666666666-he)*6:Q},A=w<.5?w*(1+r):w+r-w*r,L=2*w-A;i=C(L,A,f+1/3),l=C(L,A,f),c=C(L,A,f-1/3)}return{r:Math.round(i*255),g:Math.round(l*255),b:Math.round(c*255)}}function LI(o){let i=o.r/255,l=o.g/255,c=o.b/255,f=Math.max(i,l,c),r=Math.min(i,l,c),w=0,C=0,A=(f+r)/2;if(f===r)w=C=0;else{let L=f-r;switch(C=A>.5?L/(2-f-r):L/(f+r),f){case i:w=(l-c)/L+(l<c?6:0);break;case l:w=(c-i)/L+2;break;case c:w=(i-l)/L+4;break}w/=6}return{h:w,s:C,l:A}}function F3(o,i){return o&&{r:Math.max(0,Math.min(255,o.r+V1(o.r,i))),g:Math.max(0,Math.min(255,o.g+V1(o.g,i))),b:Math.max(0,Math.min(255,o.b+V1(o.b,i))),a:o.a}}function V1(o,i){let l=i>0?255-o:o;return Math.round(l*i)}function N3(o,i){if(o){let l=Math.min(Math.max(o.r,o.g,o.b),230),c=V1(l,i);return{r:Math.max(0,Math.min(255,Math.round(o.r+c))),g:Math.max(0,Math.min(255,Math.round(o.g+c))),b:Math.max(0,Math.min(255,Math.round(o.b+c))),a:o.a}}else return o}function L3(o){return(o.r*299+o.g*587+o.b*114)/1e3>=128}function z3(o,i){if(o===void 0||i==1)return o;let l=LI(o);return l.s=i,kI(l)}function B3(o,i={r:255,g:255,b:255},l={r:255,g:255,b:255}){let c=i,f=l;return L3(l)&&(c=l,f=i),L3(o)?f:c}function V3(o){return o[0]==="#"&&(o=o.substr(1)),o.length==3&&(o=o[0].repeat(2)+o[1].repeat(2)+o[2].repeat(2)),parseInt(o,16)}function dZ(o){o=o.replace(/[ ]/g,"");let i=o.match(/^rgb\(([0-9]*),([0-9]*),([0-9]*)\)/i);if(i)i.push("1");else if(i=o.match(/^rgba\(([0-9]*),([0-9]*),([0-9]*),([.0-9]*)\)/i),!i)return 0;let l="";for(let c=1;c<=3;c++){let f=parseInt(i[c]).toString(16);f.length==1&&(f="0"+f),l+=f}return V3(l)}function yp(o){return N_.fromAny(o)}var N_=class o{constructor(i){Object.defineProperty(this,"_hex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hex=i|0}get hex(){return this._hex}get r(){return this._hex>>>16}get g(){return this._hex>>8&255}get b(){return this._hex&255}toCSS(i=1){return"rgba("+this.r+", "+this.g+", "+this.b+", "+i+")"}toCSSHex(){return"#"+j1(this.r.toString(16),2)+j1(this.g.toString(16),2)+j1(this.b.toString(16),2)}toHSL(i=1){return LI({r:this.r,g:this.g,b:this.b,a:i})}static fromHSL(i,l,c){let f=kI({h:i,s:l,l:c});return this.fromRGB(f.r,f.g,f.b)}toString(){return this.toCSSHex()}static fromHex(i){return new o(i)}static fromRGB(i,l,c){return new o((c|0)+(l<<8)+(i<<16))}static fromString(i){return new o(V3(i))}static fromCSS(i){return new o(dZ(i))}static fromAny(i){if(O3(i)){if(i[0]=="#")return o.fromString(i);if(i.substr(0,3)=="rgb")return o.fromCSS(i)}else{if(k3(i))return o.fromHex(i);if(i instanceof o)return o.fromHex(i.hex)}throw new Error("Unknown color syntax: "+i)}static alternative(i,l,c){let f=B3({r:i.r,g:i.g,b:i.b},l?{r:l.r,g:l.g,b:l.b}:void 0,c?{r:c.r,g:c.g,b:c.b}:void 0);return this.fromRGB(f.r,f.g,f.b)}static interpolate(i,l,c,f="rgb"){if(f=="hsl"){let r=l.toHSL(),w=c.toHSL();return o.fromHSL(Kh(i,r.h,w.h),Kh(i,r.s,w.s),Kh(i,r.l,w.l))}else return o.fromRGB(Kh(i,l.r,c.r),Kh(i,l.g,c.g),Kh(i,l.b,c.b))}static lighten(i,l){let c=F3({r:i.r,g:i.g,b:i.b},l);return o.fromRGB(c.r,c.g,c.b)}static brighten(i,l){let c=N3({r:i.r,g:i.g,b:i.b},l);return o.fromRGB(c.r,c.g,c.b)}static saturate(i,l){let c=z3({r:i.r,g:i.g,b:i.b},l);return o.fromRGB(c.r,c.g,c.b)}};function Kh(o,i,l){return i+o*(l-i)}var Lhe=[{name:"Root",children:[{name:"Sed et nulla a enim tincidunt gravida",shortName:"Gravida",color:yp(8824281),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:80},{name:"Third",value:100},{name:"New",value:50,action:"add",color:yp(13688048),radius:35}]},{name:"Fusce ut nisi eu nibh laoreet scelerisque",shortName:"Fusce ut nisi",color:yp(8285892),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:25},{name:"Third",value:100},{name:"New",value:50,action:"add",color:yp(14210285),radius:35}]}]}];var j3=tE(_1());var U3=tE(_1());var mZ=(o,i)=>({"width.px":o,"height.px":i,margin:"auto"}),$3=(()=>{let i=class i{constructor(){this.size=z_.SM,this.name="",this.customClass="",this.customStyle={},this.iconPath="",this.IconSize=z_}ngOnInit(){this.iconPath=this.name?`assets/${this.name}`:""}ngOnChanges(c){c.name&&(this.iconPath=`assets/${c.name.currentValue}`)}};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["app-svg-icon"]],inputs:{size:"size",name:"name",customClass:"customClass",customStyle:"customStyle"},standalone:!0,features:[ax([b1,{provide:iu,useClass:x1}]),Mh,Nr],decls:1,vars:6,consts:[[1,"block",3,"svgClass","src","svgStyle"]],template:function(f,r){f&1&&er(0,"svg-icon",0),f&2&&Fr("svgClass",r.customClass)("src",r.iconPath)("svgStyle",tk(3,mZ,r.size===r.IconSize.XL?30:r.size===r.IconSize.LG?25:r.size===r.IconSize.MD?20:r.size===r.IconSize.SM?15:10,r.size===r.IconSize.XL?30:r.size===r.IconSize.LG?25:r.size===r.IconSize.MD?20:r.size===r.IconSize.SM?15:10))},dependencies:[wi,bx,QN,YN],encapsulation:2});let o=i;return o})(),z_=function(o){return o.XS="XS",o.SM="SM",o.MD="MD",o.LG="LG",o.XL="XL",o}(z_||{});var FI=(()=>{let i=class i{constructor(c,f){this.mapService=c,this.router=f,this.IconSize=z_,this.routerEvent=new Ji}onGlobeLick(){this.routerEvent.emit(!0),this.mapService.map?.zoomTo(4,{animate:!0,duration:1500})}onMenuCubeClick(){let c=this.mapService.map?.getCenter(),f=this.mapService.map?.getZoom();this.routerEvent.emit(!0),console.log("onMenuCubeClick",c),c&&localStorage.setItem("center",JSON.stringify(c)),f&&localStorage.setItem("zoomLevel",JSON.stringify(f))}onMapClick(){this.router.url.includes("map")||this.routerEvent.emit(!0)}};i.\u0275fac=function(f){return new(f||i)(nr(yl),nr(o_))},i.\u0275cmp=Lr({type:i,selectors:[["app-left-bar"]],outputs:{routerEvent:"routerEvent"},standalone:!0,features:[Nr],decls:6,vars:6,consts:[[1,"left-bar"],["name","menu-globe.svg","customClass","menu-item",3,"click","size"],[1,"solid"],["name","menu-map.svg","customClass","menu-item",3,"click","size","routerLink"],["name","menu-cube.svg","customClass","menu-item",3,"click","size","routerLink"],["name","menu-stars.svg","customClass","menu-item",3,"size"]],template:function(f,r){f&1&&(In(0,"div",0)(1,"app-svg-icon",1),Hr("click",function(){return r.onGlobeLick()}),Cn(),er(2,"hr",2),In(3,"app-svg-icon",3),Hr("click",function(){return r.onMapClick()}),Cn(),In(4,"app-svg-icon",4),Hr("click",function(){return r.onMenuCubeClick()}),Cn(),er(5,"app-svg-icon",5),Cn()),f&2&&(vr(),Fr("size",r.IconSize.XL),vr(2),Fr("size",r.IconSize.XL)("routerLink","/map"),vr(),Fr("size",r.IconSize.XL)("routerLink","/bubbles"),vr(),Fr("size",r.IconSize.XL))},dependencies:[EL,$3],styles:[".left-bar[_ngcontent-%COMP%]{opacity:1;background-color:#fff0!important;position:fixed;width:fit-content;background-color:#fff;padding:10px 20px 0;height:220px;z-index:999;top:30%;left:0;display:flex;flex-direction:column;align-items:center;row-gap:12px}.left-bar[_ngcontent-%COMP%]   app-svg-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.left-bar[_ngcontent-%COMP%]   hr.solid[_ngcontent-%COMP%]{border-top:3px solid #bbb;width:130%;margin-left:-15%}"]});let o=i;return o})();var NI=(()=>{let i=class i{constructor(){this.addMenuOpened=!1}toggleAddMenu(){this.addMenuOpened=!this.addMenuOpened}};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["app-footer"]],standalone:!0,features:[Nr],decls:9,vars:1,consts:[[1,"timeline"],["src","../../assets/timeline.svg"],[1,"add-sensor",3,"click"],["src","../../assets/add-icon.svg"],[1,"add-sensor-menu",3,"ngClass"],[1,"add-qr-wrapper"],["src","../../../assets/add-qr.svg"],[1,"add-nfc-wrapper"],["src","../../../assets/add-nfc.svg"]],template:function(f,r){f&1&&(In(0,"div",0),er(1,"img",1),Cn(),In(2,"div",2),Hr("click",function(){return r.toggleAddMenu()}),er(3,"img",3),Cn(),In(4,"div",4)(5,"div",5),er(6,"img",6),Cn(),In(7,"div",7),er(8,"img",8),Cn()()),f&2&&(vr(4),Fr("ngClass",r.addMenuOpened?"opened":"closed"))},dependencies:[wi,Kf],styles:[".timeline[_ngcontent-%COMP%]{position:fixed;padding-left:20px;padding-bottom:20px;left:0;bottom:0;z-index:95}.timeline[_ngcontent-%COMP%]:hover{cursor:pointer}.add-sensor[_ngcontent-%COMP%]{z-index:95;width:50px;height:50px;background-color:#eaebed;position:fixed;margin-bottom:20px;margin-right:5px;border-radius:50%;right:0;bottom:0;display:flex;align-items:center;justify-content:center}.add-sensor-menu[_ngcontent-%COMP%]{z-index:90;position:fixed;right:0;bottom:0;padding-bottom:30px;padding-right:30px}.add-sensor-menu[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border-radius:50%;width:60px;height:60px;background-color:#fff}.add-sensor-menu[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:hover{cursor:pointer}.add-sensor-menu[_ngcontent-%COMP%]   .add-nfc-wrapper[_ngcontent-%COMP%]{margin-left:-40px}.add-sensor[_ngcontent-%COMP%]:hover{cursor:pointer}.closed[_ngcontent-%COMP%]{scale:0%;transition:.5s}.opened[_ngcontent-%COMP%]{scale:100%;transition:.5s}"]});let o=i;return o})();var G3=JN("slideInAnimation",[n3("* <=> *",[w1(":enter, :leave",vl({position:"fixed",width:"100%",zIndex:2}),{optional:!0}),e3([w1(":enter",[vl({transform:"translateX(100%)"}),rI("0.5s ease-out",vl({transform:"translateX(0%)"}))],{optional:!0}),w1(":leave",[vl({transform:"translateX(0%)"}),rI("0.5s ease-out",vl({transform:"translateX(-100%)"}))],{optional:!0})])])]);var gZ=()=>[];function _Z(o,i){o&1&&(wS(0),In(1,"div",2),er(2,"div",3),Cn(),ES())}var H3=(()=>{let i=class i{};i.\u0275fac=function(f){return new(f||i)},i.\u0275cmp=Lr({type:i,selectors:[["app-right-bar-over"]],standalone:!0,features:[Nr],decls:2,vars:2,consts:[["id","mySidenav",1,"sidenav"],[4,"ngFor","ngForOf"],[1,"items-container"],[1,"card-container"]],template:function(f,r){f&1&&(In(0,"div",0),pl(1,_Z,3,0,"ng-container",1),Cn()),f&2&&(vr(),Fr("ngForOf",JO(1,gZ).constructor(20)))},dependencies:[wi,dx],styles:[".sidenav[_ngcontent-%COMP%]{text-wrap:nowrap}.sidenav[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;margin-top:20px}.sidenav[_ngcontent-%COMP%]   .items-container[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]{box-sizing:border-box;border:1px solid #09f;margin-left:10%;width:80%;height:200px}"]});let o=i;return o})();function yZ(o,i){o&1&&er(0,"app-footer")}var q3=(()=>{let i=class i{constructor(c,f,r){this.contexts=c,this.document=f,this.mapService=r,this.openedSidebar=!1,this.title="GraphVizualization"}toggleSideBar(c){c?this.openedSidebar=!c:this.openedSidebar=!this.openedSidebar;let f=this.document.getElementById("arrow"),r=this.document.getElementById("main"),w=this.document.querySelector(".mapboxgl-canvas");this.openedSidebar?this.openSideBar(r,f):this.closeSideBar(r,f,w)}openSideBar(c,f){let r=this.mapService.map.getCenter(),w=this.mapService.map.getZoom();c.style.marginLeft="-20vw",c.style.width="80vw",f.style.right="40vw",f.style.transform="rotate(0deg)",this.mapService.map.easeTo({center:r,zoom:w+.3,duration:1e3,linear:!0})}closeSideBar(c,f,r){let w=this.mapService.map.getCenter(),C=this.mapService.map.getZoom();c.style.marginLeft="0px",c.style.width="100%",f.style.right="30px",f.style.transform="rotate(180deg)",this.mapService.map.easeTo({center:w,zoom:C-.3,duration:1e3,linear:!0})}};i.\u0275fac=function(f){return new(f||i)(nr(sp),nr(Qr),nr(yl))},i.\u0275cmp=Lr({type:i,selectors:[["app-root"]],standalone:!0,features:[Nr],decls:7,vars:3,consts:[[2,"height","100vh","width","100vw","overflow","hidden","position","absolute","top","0","left","0"],["src","../assets/arrow-close.svg","id","arrow",3,"click"],[3,"routerEvent"],[4,"ngIf"],["id","rightBar",3,"ngClass"],["id","main",2,"height","100vh","width","100vw","overflow","hidden","position","absolute","top","0","left","0"]],template:function(f,r){f&1&&(er(0,"div",0),In(1,"img",1),Hr("click",function(){return r.toggleSideBar()}),Cn(),In(2,"app-left-bar",2),Hr("routerEvent",function(C){return r.toggleSideBar(C)}),Cn(),pl(3,yZ,1,0,"app-footer",3),er(4,"app-right-bar-over",4),In(5,"div",5),er(6,"router-outlet"),Cn()),f&2&&(vr(3),Fr("ngIf",!r.openedSidebar),vr(),Fr("ngClass",r.openedSidebar?"opened":"closed"),vr(),Fr("@slideInAnimation",void 0))},dependencies:[wi,Kf,fx,CC,FI,NI,H3],styles:["[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}#main[_ngcontent-%COMP%]{transition:all 1s}#arrow[_ngcontent-%COMP%]{position:fixed;right:30px;top:45%;transform:rotate(180deg);transition:all 1s;z-index:150}.opened[_ngcontent-%COMP%]{position:fixed;top:0;right:0;z-index:200;height:100vh;width:40vw;overflow-y:auto;transition:all 1s}.closed[_ngcontent-%COMP%]{position:fixed;top:0;right:0vw;z-index:-1;height:100vh;width:0%;transition:all 1s}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{height:5%;border-radius:50px;background:#5484d1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#2651a0}"],data:{animation:[G3]}});let o=i;return o})();Bk(q3,R3).catch(o=>console.error(o));
