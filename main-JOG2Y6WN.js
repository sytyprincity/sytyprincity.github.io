var C5=Object.create;var bw=Object.defineProperty,S5=Object.defineProperties,I5=Object.getOwnPropertyDescriptor,D5=Object.getOwnPropertyDescriptors,M5=Object.getOwnPropertyNames,C0=Object.getOwnPropertySymbols,A5=Object.getPrototypeOf,ww=Object.prototype.hasOwnProperty,C2=Object.prototype.propertyIsEnumerable;var T2=(o,i,l)=>i in o?bw(o,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[i]=l,xt=(o,i)=>{for(var l in i||={})ww.call(i,l)&&T2(o,l,i[l]);if(C0)for(var l of C0(i))C2.call(i,l)&&T2(o,l,i[l]);return o},gr=(o,i)=>S5(o,D5(i));var Ko=(o,i)=>{var l={};for(var u in o)ww.call(o,u)&&i.indexOf(u)<0&&(l[u]=o[u]);if(o!=null&&C0)for(var u of C0(o))i.indexOf(u)<0&&C2.call(o,u)&&(l[u]=o[u]);return l};var P5=(o,i)=>()=>(i||o((i={exports:{}}).exports,i),i.exports);var R5=(o,i,l,u)=>{if(i&&typeof i=="object"||typeof i=="function")for(let m of M5(i))!ww.call(o,m)&&m!==l&&bw(o,m,{get:()=>i[m],enumerable:!(u=I5(i,m))||u.enumerable});return o};var Ew=(o,i,l)=>(l=o!=null?C5(A5(o)):{},R5(i||!o||!o.__esModule?bw(l,"default",{value:o,enumerable:!0}):l,o));var Xm=(o,i,l)=>new Promise((u,m)=>{var r=A=>{try{I(l.next(A))}catch(L){m(L)}},w=A=>{try{I(l.throw(A))}catch(L){m(L)}},I=A=>A.done?u(A.value):Promise.resolve(A.value).then(r,w);I((l=l.apply(o,i)).next())});var $x=P5((uS,hS)=>{"use strict";(function(o,i){typeof uS=="object"&&typeof hS<"u"?hS.exports=i():typeof define=="function"&&define.amd?define(i):(o=typeof globalThis<"u"?globalThis:o||self,o.mapboxgl=i())})(uS,function(){"use strict";var o,i,l;function u(r,w){if(!o)o=w;else if(!i)i=w;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",A={};o(A),l=w(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}u(["exports"],function(r){var w="3.5.0";let I,A={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(I==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{I=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{I=t}}return I},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!A.API_URL)return null;try{let t=new URL(A.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function L(t){return A.API_URL_REGEX.test(t)}function $(t){return t.indexOf("mapbox:")===0}function Q(t){return A.API_CDN_URL_REGEX.test(t)}function me(t){return A.API_SPRITE_REGEX.test(t)}function he(t){return A.API_STYLE_REGEX.test(t)&&!me(t)}let be={create:"create",load:"load",fullLoad:"fullLoad"},Ie={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function Qe(t){let e=t.name.split("?")[0];return Q(e)&&e.includes("mapbox-gl.js")?"javascript":Q(e)&&e.includes("mapbox-gl.css")?"css":function(n){return A.API_FONTS_REGEX.test(n)}(e)?"fontRange":me(e)?"sprite":he(e)?"style":function(n){return A.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function ze(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nt={},ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.setMatrixArrayType=function(t){ft.ARRAY_TYPE=Nt=t},ft.toRadian=function(t){return t*Jt},ft.equals=function(t,e){return Math.abs(t-e)<=Ue*Math.max(1,Math.abs(t),Math.abs(e))},ft.RANDOM=ft.ARRAY_TYPE=ft.EPSILON=void 0;var Ue=1e-6;ft.EPSILON=Ue;var Nt=typeof Float32Array<"u"?Float32Array:Array;ft.ARRAY_TYPE=Nt;var Yt=Math.random;ft.RANDOM=Yt;var Jt=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var wt={};function er(t){return er=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},er(t)}Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=function(){var t=new St.ARRAY_TYPE(4);return St.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},wt.clone=function(t){var e=new St.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},wt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},wt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},wt.fromValues=function(t,e,n,a){var c=new St.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},wt.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},wt.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},wt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=n*d-c*a;return f?(t[0]=d*(f=1/f),t[1]=-a*f,t[2]=-c*f,t[3]=n*f,t):null},wt.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},wt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},wt.multiply=yr,wt.rotate=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+d*_,t[1]=c*y+f*_,t[2]=a*-_+d*y,t[3]=c*-_+f*y,t},wt.scale=function(t,e,n){var a=e[1],c=e[2],d=e[3],f=n[0],_=n[1];return t[0]=e[0]*f,t[1]=a*f,t[2]=c*_,t[3]=d*_,t},wt.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},wt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},wt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},wt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},wt.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},wt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},wt.subtract=kr,wt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},wt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],d=t[3],f=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(n-f)<=St.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-_)<=St.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(c-y)<=St.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(d-b)<=St.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},wt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},wt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},wt.sub=wt.mul=void 0;var St=function(t,e){if(t&&t.__esModule)return t;if(t===null||er(t)!=="object"&&typeof t!="function")return{default:t};var n=fr(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function fr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(fr=function(a){return a?n:e})(t)}function yr(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*_+d*y,t[1]=c*_+f*y,t[2]=a*b+d*T,t[3]=c*b+f*T,t}function kr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}wt.mul=yr,wt.sub=kr;var xn={};function Fo(t){return Fo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fo(t)}Object.defineProperty(xn,"__esModule",{value:!0}),xn.create=function(){var t=new bt.ARRAY_TYPE(6);return bt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},xn.clone=function(t){var e=new bt.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},xn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},xn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},xn.fromValues=function(t,e,n,a,c,d){var f=new bt.ARRAY_TYPE(6);return f[0]=t,f[1]=e,f[2]=n,f[3]=a,f[4]=c,f[5]=d,f},xn.set=function(t,e,n,a,c,d,f){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=d,t[5]=f,t},xn.invert=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=n*d-a*c;return y?(t[0]=d*(y=1/y),t[1]=-a*y,t[2]=-c*y,t[3]=n*y,t[4]=(c*_-d*f)*y,t[5]=(a*f-n*_)*y,t):null},xn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},xn.multiply=Ht,xn.rotate=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=Math.sin(n),T=Math.cos(n);return t[0]=a*T+d*b,t[1]=c*T+f*b,t[2]=a*-b+d*T,t[3]=c*-b+f*T,t[4]=_,t[5]=y,t},xn.scale=function(t,e,n){var a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=n[0],b=n[1];return t[0]=e[0]*y,t[1]=a*y,t[2]=c*b,t[3]=d*b,t[4]=f,t[5]=_,t},xn.translate=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=n[0],T=n[1];return t[0]=a,t[1]=c,t[2]=d,t[3]=f,t[4]=a*b+d*T+_,t[5]=c*b+f*T+y,t},xn.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},xn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},xn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},xn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},xn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},xn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},xn.subtract=gn,xn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},xn.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},xn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},xn.equals=function(t,e){var n=t[0],a=t[1],c=t[2],d=t[3],f=t[4],_=t[5],y=e[0],b=e[1],T=e[2],S=e[3],D=e[4],R=e[5];return Math.abs(n-y)<=bt.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-b)<=bt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-T)<=bt.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(d-S)<=bt.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(f-D)<=bt.EPSILON*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(_-R)<=bt.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},xn.sub=xn.mul=void 0;var bt=function(t,e){if(t&&t.__esModule)return t;if(t===null||Fo(t)!=="object"&&typeof t!="function")return{default:t};var n=zt(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function zt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(zt=function(a){return a?n:e})(t)}function Ht(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=n[0],T=n[1],S=n[2],D=n[3],R=n[4],O=n[5];return t[0]=a*b+d*T,t[1]=c*b+f*T,t[2]=a*S+d*D,t[3]=c*S+f*D,t[4]=a*R+d*O+_,t[5]=c*R+f*O+y,t}function gn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}xn.mul=Ht,xn.sub=gn;var kt={};function ri(t){return ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ri(t)}Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=function(){var t=new Qn.ARRAY_TYPE(9);return Qn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},kt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},kt.clone=function(t){var e=new Qn.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},kt.fromValues=function(t,e,n,a,c,d,f,_,y){var b=new Qn.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=n,b[3]=a,b[4]=c,b[5]=d,b[6]=f,b[7]=_,b[8]=y,b},kt.set=function(t,e,n,a,c,d,f,_,y,b){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=d,t[5]=f,t[6]=_,t[7]=y,t[8]=b,t},kt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},kt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},kt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],S=T*f-_*b,D=-T*d+_*y,R=b*d-f*y,O=n*S+a*D+c*R;return O?(t[0]=S*(O=1/O),t[1]=(-T*a+c*b)*O,t[2]=(_*a-c*f)*O,t[3]=D*O,t[4]=(T*n-c*y)*O,t[5]=(-_*n+c*d)*O,t[6]=R*O,t[7]=(-b*n+a*y)*O,t[8]=(f*n-a*d)*O,t):null},kt.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8];return t[0]=f*T-_*b,t[1]=c*b-a*T,t[2]=a*_-c*f,t[3]=_*y-d*T,t[4]=n*T-c*y,t[5]=c*d-n*_,t[6]=d*b-f*y,t[7]=a*y-n*b,t[8]=n*f-a*d,t},kt.determinant=function(t){var e=t[3],n=t[4],a=t[5],c=t[6],d=t[7],f=t[8];return t[0]*(f*n-a*d)+t[1]*(-f*e+a*c)+t[2]*(d*e-n*c)},kt.multiply=lr,kt.translate=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=e[8],D=n[0],R=n[1];return t[0]=a,t[1]=c,t[2]=d,t[3]=f,t[4]=_,t[5]=y,t[6]=D*a+R*f+b,t[7]=D*c+R*_+T,t[8]=D*d+R*y+S,t},kt.rotate=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=e[8],D=Math.sin(n),R=Math.cos(n);return t[0]=R*a+D*f,t[1]=R*c+D*_,t[2]=R*d+D*y,t[3]=R*f-D*a,t[4]=R*_-D*c,t[5]=R*y-D*d,t[6]=b,t[7]=T,t[8]=S,t},kt.scale=function(t,e,n){var a=n[0],c=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},kt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},kt.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},kt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},kt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},kt.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=n+n,_=a+a,y=c+c,b=n*f,T=a*f,S=a*_,D=c*f,R=c*_,O=c*y,F=d*f,z=d*_,j=d*y;return t[0]=1-S-O,t[3]=T-j,t[6]=D+z,t[1]=T+j,t[4]=1-b-O,t[7]=R-F,t[2]=D-z,t[5]=R+F,t[8]=1-b-S,t},kt.normalFromMat4=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],S=e[9],D=e[10],R=e[11],O=e[12],F=e[13],z=e[14],j=e[15],X=n*_-a*f,Y=n*y-c*f,K=n*b-d*f,le=a*y-c*_,se=a*b-d*_,pe=c*b-d*y,_e=T*F-S*O,Ee=T*z-D*O,Oe=T*j-R*O,De=S*z-D*F,Ne=S*j-R*F,Xe=D*j-R*z,Le=X*Xe-Y*Ne+K*De+le*Oe-se*Ee+pe*_e;return Le?(t[0]=(_*Xe-y*Ne+b*De)*(Le=1/Le),t[1]=(y*Oe-f*Xe-b*Ee)*Le,t[2]=(f*Ne-_*Oe+b*_e)*Le,t[3]=(c*Ne-a*Xe-d*De)*Le,t[4]=(n*Xe-c*Oe+d*Ee)*Le,t[5]=(a*Oe-n*Ne-d*_e)*Le,t[6]=(F*pe-z*se+j*le)*Le,t[7]=(z*K-O*pe-j*Y)*Le,t[8]=(O*se-F*K+j*X)*Le,t):null},kt.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},kt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},kt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},kt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},kt.subtract=wa,kt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},kt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},kt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],d=t[3],f=t[4],_=t[5],y=t[6],b=t[7],T=t[8],S=e[0],D=e[1],R=e[2],O=e[3],F=e[4],z=e[5],j=e[6],X=e[7],Y=e[8];return Math.abs(n-S)<=Qn.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(a-D)<=Qn.EPSILON*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(c-R)<=Qn.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(d-O)<=Qn.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(f-F)<=Qn.EPSILON*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(_-z)<=Qn.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(y-j)<=Qn.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-X)<=Qn.EPSILON*Math.max(1,Math.abs(b),Math.abs(X))&&Math.abs(T-Y)<=Qn.EPSILON*Math.max(1,Math.abs(T),Math.abs(Y))},kt.sub=kt.mul=void 0;var Qn=function(t,e){if(t&&t.__esModule)return t;if(t===null||ri(t)!=="object"&&typeof t!="function")return{default:t};var n=Gi(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function Gi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Gi=function(a){return a?n:e})(t)}function lr(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=e[8],D=n[0],R=n[1],O=n[2],F=n[3],z=n[4],j=n[5],X=n[6],Y=n[7],K=n[8];return t[0]=D*a+R*f+O*b,t[1]=D*c+R*_+O*T,t[2]=D*d+R*y+O*S,t[3]=F*a+z*f+j*b,t[4]=F*c+z*_+j*T,t[5]=F*d+z*y+j*S,t[6]=X*a+Y*f+K*b,t[7]=X*c+Y*_+K*T,t[8]=X*d+Y*y+K*S,t}function wa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}kt.mul=lr,kt.sub=wa;var Pt={};function Sr(t){return Sr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sr(t)}Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=function(){var t=new Fn.ARRAY_TYPE(16);return Fn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Pt.clone=function(t){var e=new Fn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Pt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Pt.fromValues=function(t,e,n,a,c,d,f,_,y,b,T,S,D,R,O,F){var z=new Fn.ARRAY_TYPE(16);return z[0]=t,z[1]=e,z[2]=n,z[3]=a,z[4]=c,z[5]=d,z[6]=f,z[7]=_,z[8]=y,z[9]=b,z[10]=T,z[11]=S,z[12]=D,z[13]=R,z[14]=O,z[15]=F,z},Pt.set=function(t,e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=d,t[5]=f,t[6]=_,t[7]=y,t[8]=b,t[9]=T,t[10]=S,t[11]=D,t[12]=R,t[13]=O,t[14]=F,t[15]=z,t},Pt.identity=is,Pt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[3],d=e[6],f=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=d,t[11]=e[14],t[12]=c,t[13]=f,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Pt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],S=e[9],D=e[10],R=e[11],O=e[12],F=e[13],z=e[14],j=e[15],X=n*_-a*f,Y=n*y-c*f,K=n*b-d*f,le=a*y-c*_,se=a*b-d*_,pe=c*b-d*y,_e=T*F-S*O,Ee=T*z-D*O,Oe=T*j-R*O,De=S*z-D*F,Ne=S*j-R*F,Xe=D*j-R*z,Le=X*Xe-Y*Ne+K*De+le*Oe-se*Ee+pe*_e;return Le?(t[0]=(_*Xe-y*Ne+b*De)*(Le=1/Le),t[1]=(c*Ne-a*Xe-d*De)*Le,t[2]=(F*pe-z*se+j*le)*Le,t[3]=(D*se-S*pe-R*le)*Le,t[4]=(y*Oe-f*Xe-b*Ee)*Le,t[5]=(n*Xe-c*Oe+d*Ee)*Le,t[6]=(z*K-O*pe-j*Y)*Le,t[7]=(T*pe-D*K+R*Y)*Le,t[8]=(f*Ne-_*Oe+b*_e)*Le,t[9]=(a*Oe-n*Ne-d*_e)*Le,t[10]=(O*se-F*K+j*X)*Le,t[11]=(S*K-T*se-R*X)*Le,t[12]=(_*Ee-f*De-y*_e)*Le,t[13]=(n*De-a*Ee+c*_e)*Le,t[14]=(F*Y-O*le-z*X)*Le,t[15]=(T*le-S*Y+D*X)*Le,t):null},Pt.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],S=e[9],D=e[10],R=e[11],O=e[12],F=e[13],z=e[14],j=e[15];return t[0]=_*(D*j-R*z)-S*(y*j-b*z)+F*(y*R-b*D),t[1]=-(a*(D*j-R*z)-S*(c*j-d*z)+F*(c*R-d*D)),t[2]=a*(y*j-b*z)-_*(c*j-d*z)+F*(c*b-d*y),t[3]=-(a*(y*R-b*D)-_*(c*R-d*D)+S*(c*b-d*y)),t[4]=-(f*(D*j-R*z)-T*(y*j-b*z)+O*(y*R-b*D)),t[5]=n*(D*j-R*z)-T*(c*j-d*z)+O*(c*R-d*D),t[6]=-(n*(y*j-b*z)-f*(c*j-d*z)+O*(c*b-d*y)),t[7]=n*(y*R-b*D)-f*(c*R-d*D)+T*(c*b-d*y),t[8]=f*(S*j-R*F)-T*(_*j-b*F)+O*(_*R-b*S),t[9]=-(n*(S*j-R*F)-T*(a*j-d*F)+O*(a*R-d*S)),t[10]=n*(_*j-b*F)-f*(a*j-d*F)+O*(a*b-d*_),t[11]=-(n*(_*R-b*S)-f*(a*R-d*S)+T*(a*b-d*_)),t[12]=-(f*(S*z-D*F)-T*(_*z-y*F)+O*(_*D-y*S)),t[13]=n*(S*z-D*F)-T*(a*z-c*F)+O*(a*D-c*S),t[14]=-(n*(_*z-y*F)-f*(a*z-c*F)+O*(a*y-c*_)),t[15]=n*(_*D-y*S)-f*(a*D-c*S)+T*(a*y-c*_),t},Pt.determinant=function(t){var e=t[0],n=t[1],a=t[2],c=t[3],d=t[4],f=t[5],_=t[6],y=t[7],b=t[8],T=t[9],S=t[10],D=t[11],R=t[12],O=t[13],F=t[14],z=t[15];return(e*f-n*d)*(S*z-D*F)-(e*_-a*d)*(T*z-D*O)+(e*y-c*d)*(T*F-S*O)+(n*_-a*f)*(b*z-D*R)-(n*y-c*f)*(b*F-S*R)+(a*y-c*_)*(b*O-T*R)},Pt.multiply=ks,Pt.translate=function(t,e,n){var a,c,d,f,_,y,b,T,S,D,R,O,F=n[0],z=n[1],j=n[2];return e===t?(t[12]=e[0]*F+e[4]*z+e[8]*j+e[12],t[13]=e[1]*F+e[5]*z+e[9]*j+e[13],t[14]=e[2]*F+e[6]*z+e[10]*j+e[14],t[15]=e[3]*F+e[7]*z+e[11]*j+e[15]):(c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=e[8],D=e[9],R=e[10],O=e[11],t[0]=a=e[0],t[1]=c,t[2]=d,t[3]=f,t[4]=_,t[5]=y,t[6]=b,t[7]=T,t[8]=S,t[9]=D,t[10]=R,t[11]=O,t[12]=a*F+_*z+S*j+e[12],t[13]=c*F+y*z+D*j+e[13],t[14]=d*F+b*z+R*j+e[14],t[15]=f*F+T*z+O*j+e[15]),t},Pt.scale=function(t,e,n){var a=n[0],c=n[1],d=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Pt.rotate=function(t,e,n,a){var c,d,f,_,y,b,T,S,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne=a[0],Xe=a[1],Le=a[2],qe=Math.hypot(Ne,Xe,Le);return qe<Fn.EPSILON?null:(Ne*=qe=1/qe,Xe*=qe,Le*=qe,c=Math.sin(n),d=Math.cos(n),y=e[1],b=e[2],T=e[3],D=e[5],R=e[6],O=e[7],z=e[9],j=e[10],X=e[11],Y=Ne*Ne*(f=1-d)+d,se=Ne*Xe*f-Le*c,pe=Xe*Xe*f+d,_e=Le*Xe*f+Ne*c,Ee=Ne*Le*f+Xe*c,Oe=Xe*Le*f-Ne*c,De=Le*Le*f+d,t[0]=(_=e[0])*Y+(S=e[4])*(K=Xe*Ne*f+Le*c)+(F=e[8])*(le=Le*Ne*f-Xe*c),t[1]=y*Y+D*K+z*le,t[2]=b*Y+R*K+j*le,t[3]=T*Y+O*K+X*le,t[4]=_*se+S*pe+F*_e,t[5]=y*se+D*pe+z*_e,t[6]=b*se+R*pe+j*_e,t[7]=T*se+O*pe+X*_e,t[8]=_*Ee+S*Oe+F*De,t[9]=y*Ee+D*Oe+z*De,t[10]=b*Ee+R*Oe+j*De,t[11]=T*Ee+O*Oe+X*De,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Pt.rotateX=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),d=e[4],f=e[5],_=e[6],y=e[7],b=e[8],T=e[9],S=e[10],D=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*c+b*a,t[5]=f*c+T*a,t[6]=_*c+S*a,t[7]=y*c+D*a,t[8]=b*c-d*a,t[9]=T*c-f*a,t[10]=S*c-_*a,t[11]=D*c-y*a,t},Pt.rotateY=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),d=e[0],f=e[1],_=e[2],y=e[3],b=e[8],T=e[9],S=e[10],D=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c-b*a,t[1]=f*c-T*a,t[2]=_*c-S*a,t[3]=y*c-D*a,t[8]=d*a+b*c,t[9]=f*a+T*c,t[10]=_*a+S*c,t[11]=y*a+D*c,t},Pt.rotateZ=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),d=e[0],f=e[1],_=e[2],y=e[3],b=e[4],T=e[5],S=e[6],D=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c+b*a,t[1]=f*c+T*a,t[2]=_*c+S*a,t[3]=y*c+D*a,t[4]=b*c-d*a,t[5]=T*c-f*a,t[6]=S*c-_*a,t[7]=D*c-y*a,t},Pt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Pt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromRotation=function(t,e,n){var a,c,d,f=n[0],_=n[1],y=n[2],b=Math.hypot(f,_,y);return b<Fn.EPSILON?null:(f*=b=1/b,_*=b,y*=b,a=Math.sin(e),c=Math.cos(e),t[0]=f*f*(d=1-c)+c,t[1]=_*f*d+y*a,t[2]=y*f*d-_*a,t[3]=0,t[4]=f*_*d-y*a,t[5]=_*_*d+c,t[6]=y*_*d+f*a,t[7]=0,t[8]=f*y*d+_*a,t[9]=_*y*d-f*a,t[10]=y*y*d+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Pt.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromRotationTranslation=Hc,Pt.fromQuat2=function(t,e){var n=new Fn.ARRAY_TYPE(3),a=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=a*a+c*c+d*d+f*f;return S>0?(n[0]=2*(_*f+T*a+y*d-b*c)/S,n[1]=2*(y*f+T*c+b*a-_*d)/S,n[2]=2*(b*f+T*d+_*c-y*a)/S):(n[0]=2*(_*f+T*a+y*d-b*c),n[1]=2*(y*f+T*c+b*a-_*d),n[2]=2*(b*f+T*d+_*c-y*a)),Hc(t,e,n),t},Pt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Pt.getScaling=fl,Pt.getRotation=function(t,e){var n=new Fn.ARRAY_TYPE(3);fl(n,e);var a=1/n[0],c=1/n[1],d=1/n[2],f=e[0]*a,_=e[1]*c,y=e[2]*d,b=e[4]*a,T=e[5]*c,S=e[6]*d,D=e[8]*a,R=e[9]*c,O=e[10]*d,F=f+T+O,z=0;return F>0?(z=2*Math.sqrt(F+1),t[3]=.25*z,t[0]=(S-R)/z,t[1]=(D-y)/z,t[2]=(_-b)/z):f>T&&f>O?(z=2*Math.sqrt(1+f-T-O),t[3]=(S-R)/z,t[0]=.25*z,t[1]=(_+b)/z,t[2]=(D+y)/z):T>O?(z=2*Math.sqrt(1+T-f-O),t[3]=(D-y)/z,t[0]=(_+b)/z,t[1]=.25*z,t[2]=(S+R)/z):(z=2*Math.sqrt(1+O-f-T),t[3]=(_-b)/z,t[0]=(D+y)/z,t[1]=(S+R)/z,t[2]=.25*z),t},Pt.fromRotationTranslationScale=function(t,e,n,a){var c=e[0],d=e[1],f=e[2],_=e[3],y=c+c,b=d+d,T=f+f,S=c*y,D=c*b,R=c*T,O=d*b,F=d*T,z=f*T,j=_*y,X=_*b,Y=_*T,K=a[0],le=a[1],se=a[2];return t[0]=(1-(O+z))*K,t[1]=(D+Y)*K,t[2]=(R-X)*K,t[3]=0,t[4]=(D-Y)*le,t[5]=(1-(S+z))*le,t[6]=(F+j)*le,t[7]=0,t[8]=(R+X)*se,t[9]=(F-j)*se,t[10]=(1-(S+O))*se,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Pt.fromRotationTranslationScaleOrigin=function(t,e,n,a,c){var d=e[0],f=e[1],_=e[2],y=e[3],b=d+d,T=f+f,S=_+_,D=d*b,R=d*T,O=d*S,F=f*T,z=f*S,j=_*S,X=y*b,Y=y*T,K=y*S,le=a[0],se=a[1],pe=a[2],_e=c[0],Ee=c[1],Oe=c[2],De=(1-(F+j))*le,Ne=(R+K)*le,Xe=(O-Y)*le,Le=(R-K)*se,qe=(1-(D+j))*se,ke=(z+X)*se,We=(O+Y)*pe,Je=(z-X)*pe,Ze=(1-(D+F))*pe;return t[0]=De,t[1]=Ne,t[2]=Xe,t[3]=0,t[4]=Le,t[5]=qe,t[6]=ke,t[7]=0,t[8]=We,t[9]=Je,t[10]=Ze,t[11]=0,t[12]=n[0]+_e-(De*_e+Le*Ee+We*Oe),t[13]=n[1]+Ee-(Ne*_e+qe*Ee+Je*Oe),t[14]=n[2]+Oe-(Xe*_e+ke*Ee+Ze*Oe),t[15]=1,t},Pt.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=n+n,_=a+a,y=c+c,b=n*f,T=a*f,S=a*_,D=c*f,R=c*_,O=c*y,F=d*f,z=d*_,j=d*y;return t[0]=1-S-O,t[1]=T+j,t[2]=D-z,t[3]=0,t[4]=T-j,t[5]=1-b-O,t[6]=R+F,t[7]=0,t[8]=D+z,t[9]=R-F,t[10]=1-b-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.frustum=function(t,e,n,a,c,d,f){var _=1/(n-e),y=1/(c-a),b=1/(d-f);return t[0]=2*d*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*y,t[6]=0,t[7]=0,t[8]=(n+e)*_,t[9]=(c+a)*y,t[10]=(f+d)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*d*2*b,t[15]=0,t},Pt.perspectiveNO=_o,Pt.perspectiveZO=function(t,e,n,a,c){var d,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=c*(d=1/(a-c)),t[14]=c*a*d):(t[10]=-1,t[14]=-a),t},Pt.perspectiveFromFieldOfView=function(t,e,n,a){var c=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),f=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),y=2/(f+_),b=2/(c+d);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(f-_)*y*.5,t[9]=(c-d)*b*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},Pt.orthoNO=yo,Pt.orthoZO=function(t,e,n,a,c,d,f){var _=1/(e-n),y=1/(a-c),b=1/(d-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+n)*_,t[13]=(c+a)*y,t[14]=d*b,t[15]=1,t},Pt.lookAt=function(t,e,n,a){var c,d,f,_,y,b,T,S,D,R,O=e[0],F=e[1],z=e[2],j=a[0],X=a[1],Y=a[2],K=n[0],le=n[1],se=n[2];return Math.abs(O-K)<Fn.EPSILON&&Math.abs(F-le)<Fn.EPSILON&&Math.abs(z-se)<Fn.EPSILON?is(t):(T=O-K,S=F-le,D=z-se,c=X*(D*=R=1/Math.hypot(T,S,D))-Y*(S*=R),d=Y*(T*=R)-j*D,f=j*S-X*T,(R=Math.hypot(c,d,f))?(c*=R=1/R,d*=R,f*=R):(c=0,d=0,f=0),_=S*f-D*d,y=D*c-T*f,b=T*d-S*c,(R=Math.hypot(_,y,b))?(_*=R=1/R,y*=R,b*=R):(_=0,y=0,b=0),t[0]=c,t[1]=_,t[2]=T,t[3]=0,t[4]=d,t[5]=y,t[6]=S,t[7]=0,t[8]=f,t[9]=b,t[10]=D,t[11]=0,t[12]=-(c*O+d*F+f*z),t[13]=-(_*O+y*F+b*z),t[14]=-(T*O+S*F+D*z),t[15]=1,t)},Pt.targetTo=function(t,e,n,a){var c=e[0],d=e[1],f=e[2],_=a[0],y=a[1],b=a[2],T=c-n[0],S=d-n[1],D=f-n[2],R=T*T+S*S+D*D;R>0&&(T*=R=1/Math.sqrt(R),S*=R,D*=R);var O=y*D-b*S,F=b*T-_*D,z=_*S-y*T;return(R=O*O+F*F+z*z)>0&&(O*=R=1/Math.sqrt(R),F*=R,z*=R),t[0]=O,t[1]=F,t[2]=z,t[3]=0,t[4]=S*z-D*F,t[5]=D*O-T*z,t[6]=T*F-S*O,t[7]=0,t[8]=T,t[9]=S,t[10]=D,t[11]=0,t[12]=c,t[13]=d,t[14]=f,t[15]=1,t},Pt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Pt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Pt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Pt.subtract=qc,Pt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Pt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},Pt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Pt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],d=t[3],f=t[4],_=t[5],y=t[6],b=t[7],T=t[8],S=t[9],D=t[10],R=t[11],O=t[12],F=t[13],z=t[14],j=t[15],X=e[0],Y=e[1],K=e[2],le=e[3],se=e[4],pe=e[5],_e=e[6],Ee=e[7],Oe=e[8],De=e[9],Ne=e[10],Xe=e[11],Le=e[12],qe=e[13],ke=e[14],We=e[15];return Math.abs(n-X)<=Fn.EPSILON*Math.max(1,Math.abs(n),Math.abs(X))&&Math.abs(a-Y)<=Fn.EPSILON*Math.max(1,Math.abs(a),Math.abs(Y))&&Math.abs(c-K)<=Fn.EPSILON*Math.max(1,Math.abs(c),Math.abs(K))&&Math.abs(d-le)<=Fn.EPSILON*Math.max(1,Math.abs(d),Math.abs(le))&&Math.abs(f-se)<=Fn.EPSILON*Math.max(1,Math.abs(f),Math.abs(se))&&Math.abs(_-pe)<=Fn.EPSILON*Math.max(1,Math.abs(_),Math.abs(pe))&&Math.abs(y-_e)<=Fn.EPSILON*Math.max(1,Math.abs(y),Math.abs(_e))&&Math.abs(b-Ee)<=Fn.EPSILON*Math.max(1,Math.abs(b),Math.abs(Ee))&&Math.abs(T-Oe)<=Fn.EPSILON*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(S-De)<=Fn.EPSILON*Math.max(1,Math.abs(S),Math.abs(De))&&Math.abs(D-Ne)<=Fn.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ne))&&Math.abs(R-Xe)<=Fn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Xe))&&Math.abs(O-Le)<=Fn.EPSILON*Math.max(1,Math.abs(O),Math.abs(Le))&&Math.abs(F-qe)<=Fn.EPSILON*Math.max(1,Math.abs(F),Math.abs(qe))&&Math.abs(z-ke)<=Fn.EPSILON*Math.max(1,Math.abs(z),Math.abs(ke))&&Math.abs(j-We)<=Fn.EPSILON*Math.max(1,Math.abs(j),Math.abs(We))},Pt.sub=Pt.mul=Pt.ortho=Pt.perspective=void 0;var Fn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Sr(t)!=="object"&&typeof t!="function")return{default:t};var n=ii(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function ii(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ii=function(a){return a?n:e})(t)}function is(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ks(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=e[8],D=e[9],R=e[10],O=e[11],F=e[12],z=e[13],j=e[14],X=e[15],Y=n[0],K=n[1],le=n[2],se=n[3];return t[0]=Y*a+K*_+le*S+se*F,t[1]=Y*c+K*y+le*D+se*z,t[2]=Y*d+K*b+le*R+se*j,t[3]=Y*f+K*T+le*O+se*X,t[4]=(Y=n[4])*a+(K=n[5])*_+(le=n[6])*S+(se=n[7])*F,t[5]=Y*c+K*y+le*D+se*z,t[6]=Y*d+K*b+le*R+se*j,t[7]=Y*f+K*T+le*O+se*X,t[8]=(Y=n[8])*a+(K=n[9])*_+(le=n[10])*S+(se=n[11])*F,t[9]=Y*c+K*y+le*D+se*z,t[10]=Y*d+K*b+le*R+se*j,t[11]=Y*f+K*T+le*O+se*X,t[12]=(Y=n[12])*a+(K=n[13])*_+(le=n[14])*S+(se=n[15])*F,t[13]=Y*c+K*y+le*D+se*z,t[14]=Y*d+K*b+le*R+se*j,t[15]=Y*f+K*T+le*O+se*X,t}function Hc(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=a+a,y=c+c,b=d+d,T=a*_,S=a*y,D=a*b,R=c*y,O=c*b,F=d*b,z=f*_,j=f*y,X=f*b;return t[0]=1-(R+F),t[1]=S+X,t[2]=D-j,t[3]=0,t[4]=S-X,t[5]=1-(T+F),t[6]=O+z,t[7]=0,t[8]=D+j,t[9]=O-z,t[10]=1-(T+R),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function fl(t,e){var n=e[4],a=e[5],c=e[6],d=e[8],f=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,c),t[2]=Math.hypot(d,f,_),t}function _o(t,e,n,a,c){var d,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+a)*(d=1/(a-c)),t[14]=2*c*a*d):(t[10]=-1,t[14]=-2*a),t}function yo(t,e,n,a,c,d,f){var _=1/(e-n),y=1/(a-c),b=1/(d-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+n)*_,t[13]=(c+a)*y,t[14]=(f+d)*b,t[15]=1,t}function qc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Pt.perspective=_o,Pt.ortho=yo,Pt.mul=ks,Pt.sub=qc;var Rt={},Lt={};function pl(t){return pl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pl(t)}Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.create=ml,Lt.clone=function(t){var e=new Li.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Lt.length=gl,Lt.fromValues=function(t,e,n){var a=new Li.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},Lt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Lt.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},Lt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Lt.subtract=Wc,Lt.multiply=Ls,Lt.divide=Ta,Lt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Lt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Lt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Lt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Lt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Lt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Lt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},Lt.distance=_l,Lt.squaredDistance=Zc,Lt.squaredLength=yl,Lt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Lt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Lt.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],d=n*n+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},Lt.dot=vl,Lt.cross=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=n[0],_=n[1],y=n[2];return t[0]=c*y-d*_,t[1]=d*f-a*y,t[2]=a*_-c*f,t},Lt.lerp=function(t,e,n,a){var c=e[0],d=e[1],f=e[2];return t[0]=c+a*(n[0]-c),t[1]=d+a*(n[1]-d),t[2]=f+a*(n[2]-f),t},Lt.hermite=function(t,e,n,a,c,d){var f=d*d,_=f*(2*d-3)+1,y=f*(d-2)+d,b=f*(d-1),T=f*(3-2*d);return t[0]=e[0]*_+n[0]*y+a[0]*b+c[0]*T,t[1]=e[1]*_+n[1]*y+a[1]*b+c[1]*T,t[2]=e[2]*_+n[2]*y+a[2]*b+c[2]*T,t},Lt.bezier=function(t,e,n,a,c,d){var f=1-d,_=f*f,y=d*d,b=_*f,T=3*d*_,S=3*y*f,D=y*d;return t[0]=e[0]*b+n[0]*T+a[0]*S+c[0]*D,t[1]=e[1]*b+n[1]*T+a[1]*S+c[1]*D,t[2]=e[2]*b+n[2]*T+a[2]*S+c[2]*D,t},Lt.random=function(t,e){e=e||1;var n=2*Li.RANDOM()*Math.PI,a=2*Li.RANDOM()-1,c=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=a*e,t},Lt.transformMat4=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=n[3]*a+n[7]*c+n[11]*d+n[15];return t[0]=(n[0]*a+n[4]*c+n[8]*d+n[12])/(f=f||1),t[1]=(n[1]*a+n[5]*c+n[9]*d+n[13])/f,t[2]=(n[2]*a+n[6]*c+n[10]*d+n[14])/f,t},Lt.transformMat3=function(t,e,n){var a=e[0],c=e[1],d=e[2];return t[0]=a*n[0]+c*n[3]+d*n[6],t[1]=a*n[1]+c*n[4]+d*n[7],t[2]=a*n[2]+c*n[5]+d*n[8],t},Lt.transformQuat=function(t,e,n){var a=n[0],c=n[1],d=n[2],f=e[0],_=e[1],y=e[2],b=c*y-d*_,T=d*f-a*y,S=a*_-c*f,D=c*S-d*T,R=d*b-a*S,O=a*T-c*b,F=2*n[3];return T*=F,S*=F,R*=2,O*=2,t[0]=f+(b*=F)+(D*=2),t[1]=_+T+R,t[2]=y+S+O,t},Lt.rotateX=function(t,e,n,a){var c=[],d=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],d[0]=c[0],d[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),d[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Lt.rotateY=function(t,e,n,a){var c=[],d=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],d[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),d[1]=c[1],d[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Lt.rotateZ=function(t,e,n,a){var c=[],d=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],d[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),d[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),d[2]=c[2],t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Lt.angle=function(t,e){var n=t[0],a=t[1],c=t[2],d=e[0],f=e[1],_=e[2],y=Math.sqrt(n*n+a*a+c*c)*Math.sqrt(d*d+f*f+_*_),b=y&&vl(t,e)/y;return Math.acos(Math.min(Math.max(b,-1),1))},Lt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Lt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Lt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Lt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],d=e[0],f=e[1],_=e[2];return Math.abs(n-d)<=Li.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-f)<=Li.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(c-_)<=Li.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},Lt.forEach=Lt.sqrLen=Lt.len=Lt.sqrDist=Lt.dist=Lt.div=Lt.mul=Lt.sub=void 0;var Li=function(t,e){if(t&&t.__esModule)return t;if(t===null||pl(t)!=="object"&&typeof t!="function")return{default:t};var n=Ea(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function Ea(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ea=function(a){return a?n:e})(t)}function ml(){var t=new Li.ARRAY_TYPE(3);return Li.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function gl(t){return Math.hypot(t[0],t[1],t[2])}function Wc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ls(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ta(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function _l(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Zc(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2];return n*n+a*a+c*c}function yl(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function vl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Lt.sub=Wc,Lt.mul=Ls,Lt.div=Ta,Lt.dist=_l,Lt.sqrDist=Zc,Lt.len=gl,Lt.sqrLen=yl;var eo,zh=(eo=ml(),function(t,e,n,a,c,d){var f,_;for(e||(e=3),n||(n=0),_=a?Math.min(a*e+n,t.length):t.length,f=n;f<_;f+=e)eo[0]=t[f],eo[1]=t[f+1],eo[2]=t[f+2],c(eo,eo,d),t[f]=eo[0],t[f+1]=eo[1],t[f+2]=eo[2];return t});Lt.forEach=zh;var Ft={};function Xc(t){return Xc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xc(t)}Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=Ca,Ft.clone=function(t){var e=new mr.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ft.fromValues=function(t,e,n,a){var c=new mr.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},Ft.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ft.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},Ft.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ft.subtract=No,Ft.multiply=zo,Ft.divide=Yc,Ft.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Ft.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Ft.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Ft.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Ft.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Ft.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Ft.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Ft.distance=Fs,Ft.squaredDistance=Ns,Ft.length=bl,Ft.squaredLength=wl,Ft.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Ft.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Ft.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=n*n+a*a+c*c+d*d;return f>0&&(f=1/Math.sqrt(f)),t[0]=n*f,t[1]=a*f,t[2]=c*f,t[3]=d*f,t},Ft.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ft.cross=function(t,e,n,a){var c=n[0]*a[1]-n[1]*a[0],d=n[0]*a[2]-n[2]*a[0],f=n[0]*a[3]-n[3]*a[0],_=n[1]*a[2]-n[2]*a[1],y=n[1]*a[3]-n[3]*a[1],b=n[2]*a[3]-n[3]*a[2],T=e[0],S=e[1],D=e[2],R=e[3];return t[0]=S*b-D*y+R*_,t[1]=-T*b+D*f-R*d,t[2]=T*y-S*f+R*c,t[3]=-T*_+S*d-D*c,t},Ft.lerp=function(t,e,n,a){var c=e[0],d=e[1],f=e[2],_=e[3];return t[0]=c+a*(n[0]-c),t[1]=d+a*(n[1]-d),t[2]=f+a*(n[2]-f),t[3]=_+a*(n[3]-_),t},Ft.random=function(t,e){var n,a,c,d,f,_;e=e||1;do f=(n=2*mr.RANDOM()-1)*n+(a=2*mr.RANDOM()-1)*a;while(f>=1);do _=(c=2*mr.RANDOM()-1)*c+(d=2*mr.RANDOM()-1)*d;while(_>=1);var y=Math.sqrt((1-f)/_);return t[0]=e*n,t[1]=e*a,t[2]=e*c*y,t[3]=e*d*y,t},Ft.transformMat4=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3];return t[0]=n[0]*a+n[4]*c+n[8]*d+n[12]*f,t[1]=n[1]*a+n[5]*c+n[9]*d+n[13]*f,t[2]=n[2]*a+n[6]*c+n[10]*d+n[14]*f,t[3]=n[3]*a+n[7]*c+n[11]*d+n[15]*f,t},Ft.transformQuat=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=n[0],_=n[1],y=n[2],b=n[3],T=b*a+_*d-y*c,S=b*c+y*a-f*d,D=b*d+f*c-_*a,R=-f*a-_*c-y*d;return t[0]=T*b+R*-f+S*-y-D*-_,t[1]=S*b+R*-_+D*-f-T*-y,t[2]=D*b+R*-y+T*-_-S*-f,t[3]=e[3],t},Ft.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Ft.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ft.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ft.equals=function(t,e){var n=t[0],a=t[1],c=t[2],d=t[3],f=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(n-f)<=mr.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-_)<=mr.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(c-y)<=mr.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(d-b)<=mr.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Ft.forEach=Ft.sqrLen=Ft.len=Ft.sqrDist=Ft.dist=Ft.div=Ft.mul=Ft.sub=void 0;var mr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Xc(t)!=="object"&&typeof t!="function")return{default:t};var n=xl(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function xl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(xl=function(a){return a?n:e})(t)}function Ca(){var t=new mr.ARRAY_TYPE(4);return mr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function No(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function zo(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Yc(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Fs(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ns(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2],d=e[3]-t[3];return n*n+a*a+c*c+d*d}function bl(t){return Math.hypot(t[0],t[1],t[2],t[3])}function wl(t){var e=t[0],n=t[1],a=t[2],c=t[3];return e*e+n*n+a*a+c*c}Ft.sub=No,Ft.mul=zo,Ft.div=Yc,Ft.dist=Fs,Ft.sqrDist=Ns,Ft.len=bl,Ft.sqrLen=wl;var Bh=function(){var t=Ca();return function(e,n,a,c,d,f){var _,y;for(n||(n=4),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,_=a;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],d(t,t,f),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function El(t){return El=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},El(t)}Ft.forEach=Bh,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=Tl,Rt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Rt.setAxisAngle=Kc,Rt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>to.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},Rt.getAngle=function(t,e){var n=fe(t,e);return Math.acos(2*n*n-1)},Rt.multiply=Cl,Rt.rotateX=function(t,e,n){n*=.5;var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+f*_,t[1]=c*y+d*_,t[2]=d*y-c*_,t[3]=f*y-a*_,t},Rt.rotateY=function(t,e,n){n*=.5;var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y-d*_,t[1]=c*y+f*_,t[2]=d*y+a*_,t[3]=f*y-c*_,t},Rt.rotateZ=function(t,e,n){n*=.5;var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+c*_,t[1]=c*y-a*_,t[2]=d*y+f*_,t[3]=f*y-d*_,t},Rt.calculateW=function(t,e){var n=e[0],a=e[1],c=e[2];return t[0]=n,t[1]=a,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-c*c)),t},Rt.exp=ye,Rt.ln=U,Rt.pow=function(t,e,n){return U(t,e),de(t,t,n),ye(t,t),t},Rt.slerp=Z,Rt.random=function(t){var e=to.RANDOM(),n=to.RANDOM(),a=to.RANDOM(),c=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=d*Math.sin(2*Math.PI*a),t[3]=d*Math.cos(2*Math.PI*a),t},Rt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=n*n+a*a+c*c+d*d,_=f?1/f:0;return t[0]=-n*_,t[1]=-a*_,t[2]=-c*_,t[3]=d*_,t},Rt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Rt.fromMat3=oe,Rt.fromEuler=function(t,e,n,a){var c=.5*Math.PI/180;e*=c,n*=c,a*=c;var d=Math.sin(e),f=Math.cos(e),_=Math.sin(n),y=Math.cos(n),b=Math.sin(a),T=Math.cos(a);return t[0]=d*y*T-f*_*b,t[1]=f*_*T+d*y*b,t[2]=f*y*b-d*_*T,t[3]=f*y*T+d*_*b,t},Rt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Rt.setAxes=Rt.sqlerp=Rt.rotationTo=Rt.equals=Rt.exactEquals=Rt.normalize=Rt.sqrLen=Rt.squaredLength=Rt.len=Rt.length=Rt.lerp=Rt.dot=Rt.scale=Rt.mul=Rt.add=Rt.set=Rt.copy=Rt.fromValues=Rt.clone=void 0;var to=Sa(ft),zs=Sa(kt),no=Sa(Lt),Xr=Sa(Ft);function Vh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Vh=function(a){return a?n:e})(t)}function Sa(t,e){if(t&&t.__esModule)return t;if(t===null||El(t)!=="object"&&typeof t!="function")return{default:t};var n=Vh(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function Tl(){var t=new to.ARRAY_TYPE(4);return to.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Kc(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function Cl(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*T+f*_+c*b-d*y,t[1]=c*T+f*y+d*_-a*b,t[2]=d*T+f*b+a*y-c*_,t[3]=f*T-a*_-c*y-d*b,t}function ye(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=Math.sqrt(n*n+a*a+c*c),_=Math.exp(d),y=f>0?_*Math.sin(f)/f:0;return t[0]=n*y,t[1]=a*y,t[2]=c*y,t[3]=_*Math.cos(f),t}function U(t,e){var n=e[0],a=e[1],c=e[2],d=e[3],f=Math.sqrt(n*n+a*a+c*c),_=f>0?Math.atan2(f,d)/f:0;return t[0]=n*_,t[1]=a*_,t[2]=c*_,t[3]=.5*Math.log(n*n+a*a+c*c+d*d),t}function Z(t,e,n,a){var c,d,f,_,y,b=e[0],T=e[1],S=e[2],D=e[3],R=n[0],O=n[1],F=n[2],z=n[3];return(d=b*R+T*O+S*F+D*z)<0&&(d=-d,R=-R,O=-O,F=-F,z=-z),1-d>to.EPSILON?(c=Math.acos(d),f=Math.sin(c),_=Math.sin((1-a)*c)/f,y=Math.sin(a*c)/f):(_=1-a,y=a),t[0]=_*b+y*R,t[1]=_*T+y*O,t[2]=_*S+y*F,t[3]=_*D+y*z,t}function oe(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var d=(c+1)%3,f=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*d+d]-e[3*f+f]+1),t[c]=.5*n,t[3]=(e[3*d+f]-e[3*f+d])*(n=.5/n),t[d]=(e[3*d+c]+e[3*c+d])*n,t[f]=(e[3*f+c]+e[3*c+f])*n}return t}Rt.clone=Xr.clone,Rt.fromValues=Xr.fromValues,Rt.copy=Xr.copy,Rt.set=Xr.set,Rt.add=Xr.add,Rt.mul=Cl;var de=Xr.scale;Rt.scale=de;var fe=Xr.dot;Rt.dot=fe,Rt.lerp=Xr.lerp;var we=Xr.length;Rt.length=we,Rt.len=we;var Ae=Xr.squaredLength;Rt.squaredLength=Ae,Rt.sqrLen=Ae;var ve=Xr.normalize;Rt.normalize=ve,Rt.exactEquals=Xr.exactEquals,Rt.equals=Xr.equals;var Pe,rt,Ke,_t=(Pe=no.create(),rt=no.fromValues(1,0,0),Ke=no.fromValues(0,1,0),function(t,e,n){var a=no.dot(e,n);return a<-.999999?(no.cross(Pe,rt,e),no.len(Pe)<1e-6&&no.cross(Pe,Ke,e),no.normalize(Pe,Pe),Kc(t,Pe,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(no.cross(Pe,e,n),t[0]=Pe[0],t[1]=Pe[1],t[2]=Pe[2],t[3]=1+a,ve(t,t))});Rt.rotationTo=_t;var Mt,Kt,en=(Mt=Tl(),Kt=Tl(),function(t,e,n,a,c,d){return Z(Mt,e,c,d),Z(Kt,n,a,d),Z(t,Mt,Kt,2*d*(1-d)),t});Rt.sqlerp=en;var jt,an=(jt=zs.create(),function(t,e,n,a){return jt[0]=n[0],jt[3]=n[1],jt[6]=n[2],jt[1]=a[0],jt[4]=a[1],jt[7]=a[2],jt[2]=-e[0],jt[5]=-e[1],jt[8]=-e[2],ve(t,oe(t,jt))});Rt.setAxes=an;var mt={};function tr(t){return tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr(t)}Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var t=new Ln.ARRAY_TYPE(8);return Ln.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},mt.clone=function(t){var e=new Ln.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},mt.fromValues=function(t,e,n,a,c,d,f,_){var y=new Ln.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=a,y[4]=c,y[5]=d,y[6]=f,y[7]=_,y},mt.fromRotationTranslationValues=function(t,e,n,a,c,d,f){var _=new Ln.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=n,_[3]=a;var y=.5*c,b=.5*d,T=.5*f;return _[4]=y*a+b*n-T*e,_[5]=b*a+T*t-y*n,_[6]=T*a+y*e-b*t,_[7]=-y*t-b*e-T*n,_},mt.fromRotationTranslation=oi,mt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},mt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.fromMat4=function(t,e){var n=fn.create();br.getRotation(n,e);var a=new Ln.ARRAY_TYPE(3);return br.getTranslation(a,e),oi(t,n,a),t},mt.copy=si,mt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.set=function(t,e,n,a,c,d,f,_,y){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=d,t[5]=f,t[6]=_,t[7]=y,t},mt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},mt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},mt.getTranslation=function(t,e){var n=e[4],a=e[5],c=e[6],d=e[7],f=-e[0],_=-e[1],y=-e[2],b=e[3];return t[0]=2*(n*b+d*f+a*y-c*_),t[1]=2*(a*b+d*_+c*f-n*y),t[2]=2*(c*b+d*y+n*_-a*f),t},mt.translate=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=.5*n[0],y=.5*n[1],b=.5*n[2],T=e[4],S=e[5],D=e[6],R=e[7];return t[0]=a,t[1]=c,t[2]=d,t[3]=f,t[4]=f*_+c*b-d*y+T,t[5]=f*y+d*_-a*b+S,t[6]=f*b+a*y-c*_+D,t[7]=-a*_-c*y-d*b+R,t},mt.rotateX=function(t,e,n){var a=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=_*f+T*a+y*d-b*c,D=y*f+T*c+b*a-_*d,R=b*f+T*d+_*c-y*a,O=T*f-_*a-y*c-b*d;return fn.rotateX(t,e,n),t[4]=S*(f=t[3])+O*(a=t[0])+D*(d=t[2])-R*(c=t[1]),t[5]=D*f+O*c+R*a-S*d,t[6]=R*f+O*d+S*c-D*a,t[7]=O*f-S*a-D*c-R*d,t},mt.rotateY=function(t,e,n){var a=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=_*f+T*a+y*d-b*c,D=y*f+T*c+b*a-_*d,R=b*f+T*d+_*c-y*a,O=T*f-_*a-y*c-b*d;return fn.rotateY(t,e,n),t[4]=S*(f=t[3])+O*(a=t[0])+D*(d=t[2])-R*(c=t[1]),t[5]=D*f+O*c+R*a-S*d,t[6]=R*f+O*d+S*c-D*a,t[7]=O*f-S*a-D*c-R*d,t},mt.rotateZ=function(t,e,n){var a=-e[0],c=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],S=_*f+T*a+y*d-b*c,D=y*f+T*c+b*a-_*d,R=b*f+T*d+_*c-y*a,O=T*f-_*a-y*c-b*d;return fn.rotateZ(t,e,n),t[4]=S*(f=t[3])+O*(a=t[0])+D*(d=t[2])-R*(c=t[1]),t[5]=D*f+O*c+R*a-S*d,t[6]=R*f+O*d+S*c-D*a,t[7]=O*f-S*a-D*c-R*d,t},mt.rotateByQuatAppend=function(t,e,n){var a=n[0],c=n[1],d=n[2],f=n[3],_=e[0],y=e[1],b=e[2],T=e[3];return t[0]=_*f+T*a+y*d-b*c,t[1]=y*f+T*c+b*a-_*d,t[2]=b*f+T*d+_*c-y*a,t[3]=T*f-_*a-y*c-b*d,t[4]=(_=e[4])*f+(T=e[7])*a+(y=e[5])*d-(b=e[6])*c,t[5]=y*f+T*c+b*a-_*d,t[6]=b*f+T*d+_*c-y*a,t[7]=T*f-_*a-y*c-b*d,t},mt.rotateByQuatPrepend=function(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*T+f*_+c*b-d*y,t[1]=c*T+f*y+d*_-a*b,t[2]=d*T+f*b+a*y-c*_,t[3]=f*T-a*_-c*y-d*b,t[4]=a*(T=n[7])+f*(_=n[4])+c*(b=n[6])-d*(y=n[5]),t[5]=c*T+f*y+d*_-a*b,t[6]=d*T+f*b+a*y-c*_,t[7]=f*T-a*_-c*y-d*b,t},mt.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<Ln.EPSILON)return si(t,e);var c=Math.hypot(n[0],n[1],n[2]);a*=.5;var d=Math.sin(a),f=d*n[0]/c,_=d*n[1]/c,y=d*n[2]/c,b=Math.cos(a),T=e[0],S=e[1],D=e[2],R=e[3];t[0]=T*b+R*f+S*y-D*_,t[1]=S*b+R*_+D*f-T*y,t[2]=D*b+R*y+T*_-S*f,t[3]=R*b-T*f-S*_-D*y;var O=e[4],F=e[5],z=e[6],j=e[7];return t[4]=O*b+j*f+F*y-z*_,t[5]=F*b+j*_+z*f-O*y,t[6]=z*b+j*y+O*_-F*f,t[7]=j*b-O*f-F*_-z*y,t},mt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},mt.multiply=Ia,mt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},mt.lerp=function(t,e,n,a){var c=1-a;return rp(e,n)<0&&(a=-a),t[0]=e[0]*c+n[0]*a,t[1]=e[1]*c+n[1]*a,t[2]=e[2]*c+n[2]*a,t[3]=e[3]*c+n[3]*a,t[4]=e[4]*c+n[4]*a,t[5]=e[5]*c+n[5]*a,t[6]=e[6]*c+n[6]*a,t[7]=e[7]*c+n[7]*a,t},mt.invert=function(t,e){var n=Qc(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},mt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},mt.normalize=function(t,e){var n=Qc(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,c=e[1]/n,d=e[2]/n,f=e[3]/n,_=e[4],y=e[5],b=e[6],T=e[7],S=a*_+c*y+d*b+f*T;t[0]=a,t[1]=c,t[2]=d,t[3]=f,t[4]=(_-a*S)/n,t[5]=(y-c*S)/n,t[6]=(b-d*S)/n,t[7]=(T-f*S)/n}return t},mt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},mt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],d=t[3],f=t[4],_=t[5],y=t[6],b=t[7],T=e[0],S=e[1],D=e[2],R=e[3],O=e[4],F=e[5],z=e[6],j=e[7];return Math.abs(n-T)<=Ln.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-S)<=Ln.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(c-D)<=Ln.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(d-R)<=Ln.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(f-O)<=Ln.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(_-F)<=Ln.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(y-z)<=Ln.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(b-j)<=Ln.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))},mt.sqrLen=mt.squaredLength=mt.len=mt.length=mt.dot=mt.mul=mt.setReal=mt.getReal=void 0;var Ln=Ar(ft),fn=Ar(Rt),br=Ar(Pt);function nr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(nr=function(a){return a?n:e})(t)}function Ar(t,e){if(t&&t.__esModule)return t;if(t===null||tr(t)!=="object"&&typeof t!="function")return{default:t};var n=nr(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function oi(t,e,n){var a=.5*n[0],c=.5*n[1],d=.5*n[2],f=e[0],_=e[1],y=e[2],b=e[3];return t[0]=f,t[1]=_,t[2]=y,t[3]=b,t[4]=a*b+c*y-d*_,t[5]=c*b+d*f-a*y,t[6]=d*b+a*_-c*f,t[7]=-a*f-c*_-d*y,t}function si(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Ia(t,e,n){var a=e[0],c=e[1],d=e[2],f=e[3],_=n[4],y=n[5],b=n[6],T=n[7],S=e[4],D=e[5],R=e[6],O=e[7],F=n[0],z=n[1],j=n[2],X=n[3];return t[0]=a*X+f*F+c*j-d*z,t[1]=c*X+f*z+d*F-a*j,t[2]=d*X+f*j+a*z-c*F,t[3]=f*X-a*F-c*z-d*j,t[4]=a*T+f*_+c*b-d*y+S*X+O*F+D*j-R*z,t[5]=c*T+f*y+d*_-a*b+D*X+O*z+R*F-S*j,t[6]=d*T+f*b+a*y-c*_+R*X+O*j+S*z-D*F,t[7]=f*T-a*_-c*y-d*b+O*X-S*F-D*z-R*j,t}mt.getReal=fn.copy,mt.setReal=fn.copy,mt.mul=Ia;var rp=fn.dot;mt.dot=rp;var w_=fn.length;mt.length=w_,mt.len=w_;var Qc=fn.squaredLength;mt.squaredLength=Qc,mt.sqrLen=Qc;var Zt={};function ip(t){return ip=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ip(t)}Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=sp,Zt.clone=function(t){var e=new Bs.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Zt.fromValues=function(t,e){var n=new Bs.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Zt.set=function(t,e,n){return t[0]=e,t[1]=n,t},Zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Zt.subtract=ap,Zt.multiply=lp,Zt.divide=cp,Zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Zt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Zt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Zt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Zt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},Zt.distance=up,Zt.squaredDistance=hp,Zt.length=dp,Zt.squaredLength=fp,Zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Zt.normalize=function(t,e){var n=e[0],a=e[1],c=n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},Zt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Zt.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},Zt.lerp=function(t,e,n,a){var c=e[0],d=e[1];return t[0]=c+a*(n[0]-c),t[1]=d+a*(n[1]-d),t},Zt.random=function(t,e){e=e||1;var n=2*Bs.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Zt.transformMat2=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c,t[1]=n[1]*a+n[3]*c,t},Zt.transformMat2d=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c+n[4],t[1]=n[1]*a+n[3]*c+n[5],t},Zt.transformMat3=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[3]*c+n[6],t[1]=n[1]*a+n[4]*c+n[7],t},Zt.transformMat4=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[4]*c+n[12],t[1]=n[1]*a+n[5]*c+n[13],t},Zt.rotate=function(t,e,n,a){var c=e[0]-n[0],d=e[1]-n[1],f=Math.sin(a),_=Math.cos(a);return t[0]=c*_-d*f+n[0],t[1]=c*f+d*_+n[1],t},Zt.angle=function(t,e){var n=t[0],a=t[1],c=e[0],d=e[1],f=Math.sqrt(n*n+a*a)*Math.sqrt(c*c+d*d);return Math.acos(Math.min(Math.max(f&&(n*c+a*d)/f,-1),1))},Zt.zero=function(t){return t[0]=0,t[1]=0,t},Zt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Zt.equals=function(t,e){var n=t[0],a=t[1],c=e[0],d=e[1];return Math.abs(n-c)<=Bs.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-d)<=Bs.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},Zt.forEach=Zt.sqrLen=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=Zt.len=void 0;var Bs=function(t,e){if(t&&t.__esModule)return t;if(t===null||ip(t)!=="object"&&typeof t!="function")return{default:t};var n=op(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(ft);function op(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(op=function(a){return a?n:e})(t)}function sp(){var t=new Bs.ARRAY_TYPE(2);return Bs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function ap(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function lp(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function cp(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function up(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function hp(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function dp(t){return Math.hypot(t[0],t[1])}function fp(t){var e=t[0],n=t[1];return e*e+n*n}Zt.len=dp,Zt.sub=ap,Zt.mul=lp,Zt.div=cp,Zt.dist=up,Zt.sqrDist=hp,Zt.sqrLen=fp;var E_=function(){var t=sp();return function(e,n,a,c,d,f){var _,y;for(n||(n=2),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,_=a;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],d(t,t,f),e[_]=t[0],e[_+1]=t[1];return e}}();function Sl(t){return Sl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sl(t)}Zt.forEach=E_,Object.defineProperty(nt,"__esModule",{value:!0}),r.aA=nt.vec4=r._=nt.vec3=nt.vec2=nt.quat2=r.av=nt.quat=r.ad=nt.mat4=r.bC=nt.mat3=nt.mat2d=r.aC=nt.mat2=nt.glMatrix=void 0;var jh=Bo(ft);nt.glMatrix=jh;var Uh=Bo(wt);r.aC=nt.mat2=Uh;var T_=Bo(xn);nt.mat2d=T_;var C_=Bo(kt);r.bC=nt.mat3=C_;var S_=Bo(Pt);r.ad=nt.mat4=S_;var Il=Bo(Rt);r.av=nt.quat=Il;var rn=Bo(mt);nt.quat2=rn;var u1=Bo(Zt);nt.vec2=u1;var h1=Bo(Lt);r._=nt.vec3=h1;var d1=Bo(Ft);function pp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(pp=function(a){return a?n:e})(t)}function Bo(t,e){if(t&&t.__esModule)return t;if(t===null||Sl(t)!=="object"&&typeof t!="function")return{default:t};var n=pp(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=c?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}r.aA=nt.vec4=d1;var mp=Jc;function Jc(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Jc.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=c/d}var f=0,_=1;for(n=t,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));a++)t>c?f=n:_=n,n=.5*(_-f)+f;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var eu=ze(mp),$h=Da;function Da(t,e){this.x=t,this.y=e}Da.prototype={clone:function(){return new Da(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),c=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Da.convert=function(t){return t instanceof Da?t:Array.isArray(t)?new Da(t[0],t[1]):t};var lt=ze($h);let I_=Math.PI/180,tu=180/Math.PI;function ln(t){return t*I_}function ai(t){return t*tu}let D_=[[0,0],[1,0],[1,1],[0,1]];function gp(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function nu(t,e,n,a){let c=new eu(t,e,n,a);return function(d){return c.solve(d)}}let Dl=nu(.25,.1,.25,1);function Qt(t,e,n){return Math.min(n,Math.max(e,t))}function Ma(t,e,n){return(n=Qt((n-t)/(e-t),0,1))*n*(3-2*n)}function Aa(t,e,n){let a=n-e,c=((t-e)%a+a)%a+e;return c===e?n:c}function Ml(t,e,n){if(!t.length)return n(null,[]);let a=t.length,c=new Array(t.length),d=null;t.forEach((f,_)=>{e(f,(y,b)=>{y&&(d=y),c[_]=b,--a==0&&n(d,c)})})}function ro(t){let e=[];for(let n in t)e.push(t[n]);return e}function li(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}let f1=1;function Gh(){return f1++}function Hh(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function _p(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function yp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function qh(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function ru(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Al(t,e,n){let a={};for(let c in t)a[c]=e.call(this,t[c],c,t);return a}function Pa(t,e,n){let a={};for(let c in t)e.call(this,t[c],c,t)&&(a[c]=t[c]);return a}function Vo(t){return Array.isArray(t)?t.map(Vo):typeof t=="object"&&t?Al(t,Vo):t}let vp={};function wr(t){vp[t]||(typeof console<"u"&&console.warn(t),vp[t]=!0)}function jo(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function vi(t){let e=0;for(let n,a,c=0,d=t.length,f=d-1;c<d;f=c++)n=t[c],a=t[f],e+=(a.x-n.x)*(n.y+a.y);return e}function os([t,e,n]){let a=ln(e+90),c=ln(n);return{x:t*Math.cos(a)*Math.sin(c),y:t*Math.sin(a)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function Yr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xp(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,d)=>{let f=c||d;return e[a]=!f||f.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let bp,Wh,Pl,iu,ss,ou,Zh=null;function Ra(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function su(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function wp(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<a?e=c+1:n=c}return e}function M_(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<=a?e=c+1:n=c}return e}function Xh(t){return t>0?1/(1.001-t):1+t}function Yh(t){return t>0?1-1/(1.001-t):-t}function Rl(){return bp==null&&(bp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),bp}let Kr={now:()=>iu!==void 0?iu:performance.now(),setNow(t){iu=t},restoreNow(){iu=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:a}=t;ss||(ss=document.createElement("canvas"));let c=ss.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>ss.width||a>ss.height)&&(ss.width=n,ss.height=a),c.clearRect(-e,-e,n+2*e,a+2*e),c.drawImage(t,0,0,n,a),c.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(Wh||(Wh=document.createElement("a")),Wh.href=t,Wh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Pl==null&&(Pl=window.matchMedia("(prefers-reduced-motion: reduce)")),Pl.matches)},hasCanvasFingerprintNoise(){if(ou!==void 0)return ou;if(!Rl())return ou=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);let a=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&n++!==a.data[c])return ou=!0,!0;return ou=!1,!1}};function Kh(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(n));for(let c in e)a.set(c,e[c]);return`${t.slice(0,n)}?${a.toString()}`}function Ep(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let a=new URLSearchParams,c=new URLSearchParams(t.slice(n));for(let f of e.persistentParams){let _=c.get(f);_&&a.set(f,_)}let d=a.toString();return`${t.slice(0,n)}${d.length>0?`?${d}`:""}`}let A_="mapbox-tiles",Tp=500,Cp=50,as,Qh;function P_(){try{return caches}catch{}}function au(){let t=P_();t&&!as&&(as=t.open(A_))}let Jh=1/0,ed={supported:!1,testSupport:function(t){!Sp&&kl&&(Ip?R_(t):Ol=t)}},Ol,kl,Sp=!1,Ip=!1,Dp=typeof self<"u"?self:{};function R_(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,kl),t.isContextLost())return;ed.supported=!0}catch{}t.deleteTexture(e),Sp=!0}Dp.document&&(kl=Dp.document.createElement("img"),kl.onload=function(){Ol&&R_(Ol),Ol=null,Ip=!0},kl.onerror=function(){Sp=!0,Ol=null},kl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let td={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(td);class Mp extends Error{constructor(e,n,a){n===401&&L(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let nd=Yr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,lu=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(nd())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){let d=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:nd(),referrerPolicy:a.referrerPolicy,signal:d.signal}),_=!1,y=!1,b=(T=f.url).indexOf("sku=")>0&&L(T);var T;a.type==="json"&&f.headers.set("Accept","application/json");let S=(R,O,F)=>{if(y)return;if(R&&R.message!=="SecurityError"&&wr(R.toString()),O&&F)return D(O);let z=Date.now();fetch(f).then(j=>{if(j.ok){let X=b?j.clone():null;return D(j,X,z)}return c(new Mp(j.statusText,j.status,a.url))}).catch(j=>{j.name!=="AbortError"&&c(new Error(`${j.message} ${a.url}`))})},D=(R,O,F)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then(z=>{y||(O&&F&&function(j,X,Y){if(au(),!as)return;let K=xp(X.headers.get("Cache-Control")||"");if(K["no-store"])return;let le={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((_e,Ee)=>le.headers.set(Ee,_e)),K["max-age"]&&le.headers.set("Expires",new Date(Y+1e3*K["max-age"]).toUTCString());let se=le.headers.get("Expires");if(!se||new Date(se).getTime()-Y<42e4)return;let pe=Ep(j.url,{persistentParams:["language","worldview"]});if(X.status===206){let _e=j.headers.get("Range");if(!_e)return;le.status=200,pe=Kh(pe,{range:_e})}(function(_e,Ee){if(Qh===void 0)try{new Response(new ReadableStream),Qh=!0}catch{Qh=!1}Qh?Ee(_e.body):_e.blob().then(Ee)})(X,_e=>{let Ee=new Response((Oe=X.status)!==200&&Oe!==404&&[101,103,204,205,304].includes(Oe)?null:_e,le);var Oe;au(),as&&as.then(De=>De.put(pe,Ee)).catch(De=>wr(De.message))})}(f,O,F),_=!0,c(null,z,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(z=>{y||c(new Error(z.message))})};return b?function(R,O){if(au(),!as)return O(null);as.then(F=>{let z=Ep(R.url,{persistentParams:["language","worldview"]}),j=R.headers.get("Range");j&&(z=Kh(z,{range:j})),F.match(z).then(X=>{let Y=function(K){if(!K)return!1;let le=new Date(K.headers.get("Expires")||0),se=xp(K.headers.get("Cache-Control")||"");return le>Date.now()&&!se["no-cache"]}(X);F.delete(z),Y&&F.put(z,X.clone()),O(null,X,Y)}).catch(O)}).catch(O)}(f,S):S(null,null),{cancel:()=>{y=!0,_||d.abort()}}}(t,e);if(Yr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,c){let d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let f in a.headers)d.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(a.type==="json")try{f=JSON.parse(d.response)}catch(_){return c(_)}c(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new Mp(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(t,e)},Oa=function(t,e){return lu(li(t,{type:"arrayBuffer"}),e)};function O_(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let Ap="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",cu,uu;cu=[],uu=0;let Vs=function(t,e){if(ed.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),uu>=A.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return cu.push(d),d}uu++;let n=!1,a=()=>{if(!n)for(n=!0,uu--;cu.length&&uu<A.MAX_PARALLEL_IMAGE_REQUESTS;){let d=cu.shift(),{requestParameters:f,callback:_,cancelled:y}=d;y||(d.cancel=Vs(f,_).cancel)}},c=Oa(t,(d,f,_,y)=>{a(),d?e(d):f&&(self.createImageBitmap?function(b,T){let S=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(S).then(D=>{T(null,D)}).catch(D=>{T(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,T)=>e(b,T,_,y)):function(b,T){let S=new Image;S.onload=()=>{T(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=Ap})},S.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(b)],{type:"image/png"});S.src=b.byteLength?URL.createObjectURL(D):Ap}(f,(b,T)=>e(b,T,_,y)))});return{cancel:()=>{c.cancel(),a()}}},Pp="01",Rp="NO_ACCESS_TOKEN",p1=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vo(t){let e=t.match(p1);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ll(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let rd="mapbox.eventData";function k_(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class hu{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=k_(A.ACCESS_TOKEN),a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(+("0x"+d)))):A.ACCESS_TOKEN||"",e?`${rd}.${e}:${a}`:`${rd}:${a}`}fetchEventData(){let e=Ra("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let d=localStorage.getItem(a);d&&(this.anonId=d)}catch{wr("Unable to read from LocalStorage")}}saveEventData(){let e=Ra("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(a,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{wr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,c){if(!A.EVENTS_URL)return;let d=vo(A.EVENTS_URL);d.params.push(`access_token=${c||A.ACCESS_TOKEN||""}`);let f={event:this.type,created:new Date(e).toISOString()},_=n?li(f,n):f,y={url:Ll(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,T){return lu(li(b,{method:"POST"}),T)}(y,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let L_=new class extends hu{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){A.EVENTS_URL&&A.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>$(n)||L(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=k_(A.ACCESS_TOKEN),n=e?e.u:A.ACCESS_TOKEN,a=n!==this.eventData.tokenU;yp(this.anonId)||(this.anonId=Hh(),a=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let d=new Date(this.eventData.lastSuccess),f=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;a=a||_>=1||_<-1||d.getDate()!==f.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:Pp,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},Op=L_.postTurnstileEvent.bind(L_),du=new class extends hu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,A.EVENTS_URL&&(n||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Rp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),yp(this.anonId)||(this.anonId=Hh()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:Pp,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},F_=du.postMapLoadEvent.bind(du),N_=new class extends hu{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=Hh(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:a,importedStyles:c}=e;if(!A.EVENTS_URL||!t&&!A.ACCESS_TOKEN)return;let d=this.getMapInstanceId(n),f={mapInstanceId:d,eventId:this.getEventId(d),style:a};c.length&&(f.importedStyles=c),this.queueRequest({timestamp:Date.now(),payload:f},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},m1=N_.postStyleLoadEvent.bind(N_),id=new class extends hu{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){A.EVENTS_URL&&(t||A.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(c){let d=performance.getEntriesByType("resource"),f=performance.getEntriesByType("mark"),_=function(R){let O={};if(R){for(let F in R)if(F!=="other")for(let z of R[F]){let j=`${F}ResolveRangeMin`,X=`${F}ResolveRangeMax`,Y=`${F}RequestCount`,K=`${F}RequestCachedCount`;O[j]=Math.min(O[j]||1/0,z.startTime),O[X]=Math.max(O[X]||-1/0,z.responseEnd);let le=se=>{O[se]===void 0&&(O[se]=0),++O[se]};z.transferSize!==void 0&&z.transferSize===0&&le(K),le(Y)}}return O}(function(R,O){let F={};if(R)for(let z of R){let j=O(z);F[j]===void 0&&(F[j]=[]),F[j].push(z)}return F}(d,Qe)),y=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=b?b.effectiveType:void 0,S={counters:[],metadata:[],attributes:[]},D=(R,O,F)=>{F!=null&&R.push({name:O,value:F.toString()})};for(let R in _)D(S.counters,R,_[R]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(D(S.counters,"interactionRangeMin",c.interactionRange[0]),D(S.counters,"interactionRangeMax",c.interactionRange[1])),f)for(let R of Object.keys(be)){let O=be[R],F=f.find(z=>z.name===O);F&&D(S.counters,O,F.startTime)}return D(S.counters,"visibilityHidden",c.visibilityHidden),D(S.attributes,"style",function(R){if(R)for(let O of R){let F=O.name.split("?")[0];if(he(F)){let z=F.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(d)),D(S.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),D(S.attributes,"fogEnabled",c.fogEnabled?"true":"false"),D(S.attributes,"projection",c.projection),D(S.attributes,"zoom",c.zoom),D(S.metadata,"devicePixelRatio",y),D(S.metadata,"connectionEffectiveType",T),D(S.metadata,"navigatorUserAgent",navigator.userAgent),D(S.metadata,"screenWidth",window.screen.width),D(S.metadata,"screenHeight",window.screen.height),D(S.metadata,"windowWidth",window.innerWidth),D(S.metadata,"windowHeight",window.innerHeight),D(S.metadata,"mapWidth",c.width/y),D(S.metadata,"mapHeight",c.height/y),D(S.metadata,"webglRenderer",c.renderer),D(S.metadata,"webglVendor",c.vendor),D(S.metadata,"sdkVersion",w),D(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(n);for(let c of a.metadata);for(let c of a.counters);for(let c of a.attributes);this.postEvent(e,a,()=>{},t)}},g1=id.postPerformanceEvent.bind(id),Fl=new class extends hu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!A.API_URL||!A.SESSION_PATH)return;let c=vo(A.API_URL+A.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||A.ACCESS_TOKEN||""}`);let d={url:Ll(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,_){return lu(li(f,{method:"GET"}),_)}(d,f=>{this.pendingRequest=null,n(f),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,A.SESSION_PATH&&A.API_URL&&(n||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Rp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},od=Fl.getSessionAPI.bind(Fl),fu=new Set;var ka={exports:{}},z_={exports:function(t,e){var n,a,c,d,f,_,y,b;for(a=t.length-(n=3&t.length),c=e,f=3432918353,_=461845907,b=0;b<a;)y=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,c=27492+(65535&(d=5*(65535&(c=(c^=y=(65535&(y=(y=(65535&y)*f+(((y>>>16)*f&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(b+2))<<16;case 2:y^=(255&t.charCodeAt(b+1))<<8;case 1:c^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(b)))*f+(((y>>>16)*f&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}},_1={exports:function(t,e){for(var n,a=t.length,c=e^a,d=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:c^=(255&t.charCodeAt(d+2))<<16;case 2:c^=(255&t.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}},B_=z_.exports,kp=_1.exports;ka.exports=B_,ka.exports.murmur3=B_,ka.exports.murmur2=kp;var Nl=ze(ka.exports);function Lp(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function zl(t,e,n){if(n&&n[t]){let a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class Ci{constructor(e,n={}){li(this,n),this.type=e}}class sd extends Ci{constructor(e,n={}){super("error",li({error:e},n))}}class La{on(e,n){return this._listeners=this._listeners||{},Lp(e,n,this._listeners),this}off(e,n){return zl(e,n,this._listeners),zl(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Lp(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new Ci(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let _ of c)_.call(this,e);let d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let _ of d)zl(a,_,this._oneTimeListeners),_.call(this,e);let f=this._eventedParent;f&&(li(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof sd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}r.F=void 0;var V_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ad(t){return(t=Math.round(t))<0?0:t>255?255:t}function Fp(t){return ad(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function pu(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function mu(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{r.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in V_)return V_[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),c=n.indexOf(")");if(a!==-1&&c+1===n.length){var d=n.substr(0,a),f=n.substr(a+1,c-(a+1)).split(","),_=1;switch(d){case"rgba":if(f.length!==4)return null;_=pu(f.pop());case"rgb":return f.length!==3?null:[Fp(f[0]),Fp(f[1]),Fp(f[2]),_];case"hsla":if(f.length!==4)return null;_=pu(f.pop());case"hsl":if(f.length!==3)return null;var y=(parseFloat(f[0])%360+360)%360/360,b=pu(f[1]),T=pu(f[2]),S=T<=.5?T*(b+1):T+b-T*b,D=2*T-S;return[ad(255*mu(D,S,y+1/3)),ad(255*mu(D,S,y)),ad(255*mu(D,S,y-1/3)),_];default:return null}}return null}}catch{}class bn{constructor(e,n,a,c=1){this.r=e,this.g=n,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof bn)return e;if(typeof e!="string")return;let n=r.F(e);return n?new bn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,c]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${c})`}toRenderColor(e){let{r:n,g:a,b:c,a:d}=this;return new y1(e,n,a,c,d)}}class y1{constructor(e,n,a,c,d){if(e){let f=e.image.height,_=f*f;n=d===0?0:n/d*(f-1),a=d===0?0:a/d*(f-1),c=d===0?0:c/d*(f-1);let y=Math.floor(n),b=Math.floor(a),T=Math.floor(c),S=Math.ceil(n),D=Math.ceil(a),R=Math.ceil(c),O=n-y,F=a-b,z=c-T,j=e.image.data,X=4*(y+b*_+T*f),Y=4*(y+b*_+R*f),K=4*(y+D*_+T*f),le=4*(y+D*_+R*f),se=4*(S+b*_+T*f),pe=4*(S+b*_+R*f),_e=4*(S+D*_+T*f),Ee=4*(S+D*_+R*f);if(X<0||Ee>=j.length)throw new Error("out of range");this.r=It(It(It(j[X],j[Y],z),It(j[K],j[le],z),F),It(It(j[se],j[pe],z),It(j[_e],j[Ee],z),F),O)/255*d,this.g=It(It(It(j[X+1],j[Y+1],z),It(j[K+1],j[le+1],z),F),It(It(j[se+1],j[pe+1],z),It(j[_e+1],j[Ee+1],z),F),O)/255*d,this.b=It(It(It(j[X+2],j[Y+2],z),It(j[K+2],j[le+2],z),F),It(It(j[se+2],j[pe+2],z),It(j[_e+2],j[Ee+2],z),F),O)/255*d,this.a=d}else this.r=n,this.g=a,this.b=c,this.a=d}toArray(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*a/c,c]}toArray01(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,a/c,c]}toArray01Scaled(e){let{r:n,g:a,b:c,a:d}=this;return d===0?[0,0,0]:[n/d*e,a/d*e,c/d*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:c}=this;return[e,n,a,c]}toArray01Linear(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(a/c,2.2),c]}}function It(t,e,n){return t*(1-n)+e*n}function j_(t,e,n){return t.map((a,c)=>It(a,e[c],n))}bn.black=new bn(0,0,0,1),bn.white=new bn(1,1,1,1),bn.transparent=new bn(0,0,0,0),bn.red=new bn(1,0,0,1),bn.blue=new bn(0,0,1,1);var ld=Object.freeze({__proto__:null,array:j_,color:function(t,e,n){return new bn(It(t.r,e.r,n),It(t.g,e.g,n),It(t.b,e.b,n),It(t.a,e.a,n))},number:It});function Np(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}class Uo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class zp{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,c]of n)this.bindings[a]=c}concat(e){return new zp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Bl={kind:"null"},dt={kind:"number"},wn={kind:"string"},En={kind:"boolean"},Si={kind:"color"},Vl={kind:"object"},_n={kind:"value"},xo={kind:"collator"},jl={kind:"formatted"},$o={kind:"resolvedImage"};function Fi(t,e){return{kind:"array",itemType:t,N:e}}function Er(t){if(t.kind==="array"){let e=Er(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let v1=[Bl,dt,wn,En,Si,jl,Vl,Fi(_n),$o];function gu(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!gu(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of v1)if(!gu(n,e))return null}}return`Expected ${Er(t)} but found ${Er(e)} instead.`}function Bp(t,e){return e.some(n=>n.kind===t.kind)}function Ul(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class _u{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fa{constructor(e,n,a,c,d){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=c,this.textColor=d}}class ci{constructor(e){this.sections=e}static fromString(e){return new ci([new Fa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof ci?e:ci.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class Ii{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Ii({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function U_(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Di(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof bn||t instanceof _u||t instanceof ci||t instanceof Ii)return!0;if(Array.isArray(t)){for(let e of t)if(!Di(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Di(t[e]))return!1;return!0}return!1}function Pr(t){if(t===null)return Bl;if(typeof t=="string")return wn;if(typeof t=="boolean")return En;if(typeof t=="number")return dt;if(t instanceof bn)return Si;if(t instanceof _u)return xo;if(t instanceof ci)return jl;if(t instanceof Ii)return $o;if(Array.isArray(t)){let e=t.length,n;for(let a of t){let c=Pr(a);if(n){if(n===c)continue;n=_n;break}n=c}return Fi(n||_n,e)}return Vl}function io(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof bn||t instanceof ci||t instanceof Ii?t.toString():JSON.stringify(t)}class ls{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Di(e[1]))return n.error("invalid value");let a=e[1],c=Pr(a),d=n.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new ls(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ci?this.value.serialize():this.value}}class zr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Vp={string:wn,number:dt,boolean:En,object:Vl};class bo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,c=1,d=e[0];if(d==="array"){let _,y;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in Vp)||b==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=Vp[b],c++}else _=_n;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}a=Fi(_,y)}else a=Vp[d];let f=[];for(;c<e.length;c++){let _=n.parse(e[c],c,_n);if(!_)return null;f.push(_)}return new bo(a,f)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!gu(this.type,Pr(a)))return a;if(n===this.args.length-1)throw new zr(`Expected value to be of type ${Er(this.type)}, but found ${Er(Pr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(a=>a.serialize()))}}class yu{constructor(e){this.type=jl,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let c=[],d=!1;for(let f=1;f<=e.length-1;++f){let _=e[f];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let y=null;if(_["font-scale"]&&(y=n.parse(_["font-scale"],1,dt),!y))return null;let b=null;if(_["text-font"]&&(b=n.parse(_["text-font"],1,Fi(wn)),!b))return null;let T=null;if(_["text-color"]&&(T=n.parse(_["text-color"],1,Si),!T))return null;let S=c[c.length-1];S.scale=y,S.font=b,S.textColor=T}else{let y=n.parse(e[f],1,_n);if(!y)return null;let b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new yu(c)}evaluate(e){return new ci(this.sections.map(n=>{let a=n.content.evaluate(e);return Pr(a)===$o?new Fa("",a,null,null,null):new Fa(io(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class vu{constructor(e,n){this.type=$o,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=n.parse(e[1],1,wn);if(!a)return n.error("No image name provided.");if(e.length===2)return new vu(a);let c=n.parse(e[2],1,wn);return c?new vu(a,c):n.error("Secondary image variant is not a string.")}evaluate(e){let n=Ii.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Na(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let x1={"to-boolean":En,"to-color":Si,"to-number":dt,"to-string":wn};class wo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0],c=[],d=Bl;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let f=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);d=Fi(n.expectedType.itemType,f)}else{if(!(f>0&&Di(e[1][0])))return null;d=Fi(Pr(e[1][0]),f)}for(let _=0;_<f;_++){let y=e[1][_],b;if(Na(y)==="array")b=n.parse(y,void 0,d.itemType);else{let T=Na(y);if(T!==d.itemType.kind)return n.error(`Expected ${d.itemType.kind} but found ${T}.`);b=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!b)return null;c.push(b)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");d=x1[a];for(let f=1;f<e.length;f++){let _=n.parse(e[f],f,_n);if(!_)return null;c.push(_)}}return new wo(d,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let c of this.args){if(n=c.evaluate(e),a=null,n instanceof bn)return n;if(typeof n=="string"){let d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:U_(n[0],n[1],n[2],n[3]),!a))return new bn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new zr(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new zr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?ci.fromString(io(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ii.fromString(io(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):io(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new yu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new vu(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let $_=["Unknown","Point","LineString","Polygon"];class G_{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=bn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class xi{constructor(e,n,a,c,d){this.name=e,this.type=n,this._evaluate=a,this.args=c,this._overloadIndex=d}evaluate(e){if(!this._evaluate){let n=xi.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],c=xi.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=[],y=null,b=-1;for(let[T,S]of f){if(Array.isArray(T)&&T.length!==e.length-1)continue;_.push(T),b++,y=new ty(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let D=[],R=!1;for(let O=1;O<e.length;O++){let F=e[O],z=Array.isArray(T)?T[O-1]:T.type,j=y.parse(F,1+D.length,z);if(!j){R=!0;break}D.push(j)}if(!R)if(Array.isArray(T)&&T.length!==D.length)y.error(`Expected ${T.length} arguments, but found ${D.length} instead.`);else{for(let O=0;O<D.length;O++){let F=Array.isArray(T)?T[O]:T.type,z=D[O];y.concat(O+1).checkSubtype(F,z.type)}if(y.errors.length===0)return new xi(a,d,S,D,b)}}if(_.length===1)n.errors.push(...y.errors);else{let T=(_.length?_:f.map(([D])=>D)).map(jp).join(" | "),S=[];for(let D=1;D<e.length;D++){let R=n.parse(e[D],1+S.length);if(!R)return null;S.push(Er(R.type))}n.error(`Expected arguments of type ${T}, but found (${S.join(", ")}) instead.`)}return null}static register(e,n){xi.definitions=n;for(let a in n)e[a]=xi}}function jp(t){return Array.isArray(t)?`(${t.map(Er).join(", ")})`:`(${Er(t.type)}...)`}class js{constructor(e,n,a){this.type=xo,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,En);if(!c)return null;let d=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,En);if(!d)return null;let f=null;return a.locale&&(f=n.parse(a.locale,1,wn),!f)?null:new js(c,d,f)}evaluate(e){return new _u(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Up={exports:{}};Up.exports=function(){function t(a,c,d,f,_){for(;f>d;){if(f-d>600){var y=f-d+1,b=c-d+1,T=Math.log(y),S=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*S*(y-S)/y)*(b-y/2<0?-1:1);t(a,c,Math.max(d,Math.floor(c-b*S/y+D)),Math.min(f,Math.floor(c+(y-b)*S/y+D)),_)}var R=a[c],O=d,F=f;for(e(a,d,c),_(a[f],R)>0&&e(a,d,f);O<F;){for(e(a,O,F),O++,F--;_(a[O],R)<0;)O++;for(;_(a[F],R)>0;)F--}_(a[d],R)===0?e(a,d,F):e(a,++F,f),F<=c&&(d=F+1),c<=F&&(f=F-1)}}function e(a,c,d){var f=a[c];a[c]=a[d],a[d]=f}function n(a,c){return a<c?-1:a>c?1:0}return function(a,c,d,f,_){t(a,c,d||0,f||a.length-1,_||n)}}();var b1=ze(Up.exports);function w1(t){let e=0;for(let n,a,c=0,d=t.length,f=d-1;c<d;f=c++)n=t[c],a=t[f],e+=(a.x-n.x)*(n.y+a.y);return e}function xu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function $l(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function E1(t,e,n){let a=t[0]-e[0],c=t[1]-e[1],d=t[0]-n[0],f=t[1]-n[1];return a*f-d*c==0&&a*d<=0&&c*f<=0}function Gl(t,e,n=!1){let a=!1;for(let _=0,y=e.length;_<y;_++){let b=e[_];for(let T=0,S=b.length,D=S-1;T<S;D=T++){let R=b[D],O=b[T];if(E1(t,R,O))return n;(d=R)[1]>(c=t)[1]!=(f=O)[1]>c[1]&&c[0]<(f[0]-d[0])*(c[1]-d[1])/(f[1]-d[1])+d[0]&&(a=!a)}}var c,d,f;return a}function $p(t,e,n,a){let c=a[0]-n[0],d=a[1]-n[1],f=(t[0]-n[0])*d-c*(t[1]-n[1]),_=(e[0]-n[0])*d-c*(e[1]-n[1]);return f>0&&_<0||f<0&&_>0}function pn(t,e,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*d[0]!=0&&!(!$p(t,e,n,a)||!$p(n,a,t,e));var c,d}let cs=8192;function H_(t,e){let n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*cs),Math.round(a*c*cs)]}function T1(t,e){for(let n=0;n<e.length;n++)if(Gl(t,e[n]))return!0;return!1}function C1(t,e,n){for(let a of n)for(let c=0,d=a.length,f=d-1;c<d;f=c++)if(pn(t,e,a[f],a[c]))return!0;return!1}function bu(t,e){for(let n=0;n<t.length;++n)if(!Gl(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(C1(t[n],t[n+1],e))return!1;return!0}function cd(t,e){for(let n=0;n<e.length;n++)if(bu(t,e[n]))return!0;return!1}function Hl(t,e,n){let a=[];for(let c=0;c<t.length;c++){let d=[];for(let f=0;f<t[c].length;f++){let _=H_(t[c][f],n);xu(e,_),d.push(_)}a.push(d)}return a}function q_(t,e,n){let a=[];for(let c=0;c<t.length;c++){let d=Hl(t[c],e,n);a.push(d)}return a}function Gp(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){let c=.5*a,d=t[0]-n[0]>c?-a:n[0]-t[0]>c?a:0;d===0&&(d=t[0]-n[2]>c?-a:n[2]-t[0]>c?a:0),t[0]+=d}xu(e,t)}function Eo(t,e,n,a){let c=Math.pow(2,a.z)*cs,d=[a.x*cs,a.y*cs],f=[];if(!t)return f;for(let _ of t)for(let y of _){let b=[y.x+d[0],y.y+d[1]];Gp(b,e,n,c),f.push(b)}return f}function W_(t,e,n,a){let c=Math.pow(2,a.z)*cs,d=[a.x*cs,a.y*cs],f=[];if(!t)return f;for(let y of t){let b=[];for(let T of y){let S=[T.x+d[0],T.y+d[1]];xu(e,S),b.push(S)}f.push(b)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let y of f)for(let b of y)Gp(b,e,n,c)}var _;return f}class Us{constructor(e,n){this.type=En,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Di(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){let d=a.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Us(a,a.features[c].geometry)}else if(a.type==="Feature"){let c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Us(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Us(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(a.type==="Polygon"){let _=Hl(a.coordinates,d,f),y=Eo(n.geometry(),c,d,f);if(!$l(c,d))return!1;for(let b of y)if(!Gl(b,_))return!1}if(a.type==="MultiPolygon"){let _=q_(a.coordinates,d,f),y=Eo(n.geometry(),c,d,f);if(!$l(c,d))return!1;for(let b of y)if(!T1(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(a.type==="Polygon"){let _=Hl(a.coordinates,d,f),y=W_(n.geometry(),c,d,f);if(!$l(c,d))return!1;for(let b of y)if(!bu(b,_))return!1}if(a.type==="MultiPolygon"){let _=q_(a.coordinates,d,f),y=W_(n.geometry(),c,d,f);if(!$l(c,d))return!1;for(let b of y)if(!cd(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let $s={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ud=1/298.257223563,Z_=ud*(2-ud),wu=Math.PI/180;class Eu{static fromTile(e,n,a){let c=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),d=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/wu;return new Eu(d,a)}static get units(){return $s}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!$s[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys($s).join(", ")}`);let a=6378.137*wu*(n?$s[n]:1),c=Math.cos(e*wu),d=1/(1-Z_*(1-c*c)),f=Math.sqrt(d);this.kx=a*f*c,this.ky=a*f*d*(1-Z_)}distance(e,n){let a=oo(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,n){let a=oo(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/wu}destination(e,n,a){let c=a*wu;return this.offset(e,Math.sin(c)*n,Math.cos(c)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){let c=e[a];for(let d=0,f=c.length,_=f-1;d<f;_=d++)n+=oo(c[d][0]-c[_][0])*(c[d][1]+c[_][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let c=0;c<e.length-1;c++){let d=e[c],f=e[c+1],_=this.distance(d,f);if(a+=_,a>n)return Tu(d,f,(n-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[c,d]=n,f=oo(a[0]-c)*this.kx,_=(a[1]-d)*this.ky;if(f!==0||_!==0){let y=(oo(e[0]-c)*this.kx*f+(e[1]-d)*this.ky*_)/(f*f+_*_);y>1?(c=a[0],d=a[1]):y>0&&(c+=f/this.kx*y,d+=_/this.ky*y)}return f=oo(e[0]-c)*this.kx,_=(e[1]-d)*this.ky,Math.sqrt(f*f+_*_)}pointOnLine(e,n){let a=1/0,c=e[0][0],d=e[0][1],f=0,_=0;for(let y=0;y<e.length-1;y++){let b=e[y][0],T=e[y][1],S=oo(e[y+1][0]-b)*this.kx,D=(e[y+1][1]-T)*this.ky,R=0;S===0&&D===0||(R=(oo(n[0]-b)*this.kx*S+(n[1]-T)*this.ky*D)/(S*S+D*D),R>1?(b=e[y+1][0],T=e[y+1][1]):R>0&&(b+=S/this.kx*R,T+=D/this.ky*R)),S=oo(n[0]-b)*this.kx,D=(n[1]-T)*this.ky;let O=S*S+D*D;O<a&&(a=O,c=b,d=T,f=y,_=R)}return{point:[c,d],index:f,t:Math.max(0,Math.min(1,_))}}lineSlice(e,n,a){let c=this.pointOnLine(a,e),d=this.pointOnLine(a,n);if(c.index>d.index||c.index===d.index&&c.t>d.t){let b=c;c=d,d=b}let f=[c.point],_=c.index+1,y=d.index;!Hp(a[_],f[0])&&_<=y&&f.push(a[_]);for(let b=_+1;b<=y;b++)f.push(a[b]);return Hp(a[y],d.point)||f.push(d.point),f}lineSliceAlong(e,n,a){let c=0,d=[];for(let f=0;f<a.length-1;f++){let _=a[f],y=a[f+1],b=this.distance(_,y);if(c+=b,c>e&&d.length===0&&d.push(Tu(_,y,(e-(c-b))/b)),c>=n)return d.push(Tu(_,y,(n-(c-b))/b)),d;c>e&&d.push(y)}return d}bufferPoint(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,n){return oo(e[0]-n[0])>=0&&oo(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Hp(t,e){return t[0]===e[0]&&t[1]===e[1]}function Tu(t,e,n){let a=oo(e[0]-t[0]);return[t[0]+a*n,t[1]+(e[1]-t[1])*n]}function oo(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var Cu={exports:{}};(function(t,e){t.exports=function(){var n=function(c,d){if(c===void 0&&(c=[]),d===void 0&&(d=a),this.data=c,this.length=this.data.length,this.compare=d,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function a(c,d){return c<d?-1:c>d?1:0}return n.prototype.push=function(c){this.data.push(c),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var c=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),c}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(c){for(var d=this.data,f=this.compare,_=d[c];c>0;){var y=c-1>>1,b=d[y];if(f(_,b)>=0)break;d[c]=b,c=y}d[c]=_},n.prototype._down=function(c){for(var d=this.data,f=this.compare,_=this.length>>1,y=d[c];c<_;){var b=1+(c<<1),T=d[b],S=b+1;if(S<this.length&&f(d[S],T)<0&&(b=S,T=d[S]),f(T,y)>=0)break;d[c]=T,c=b}d[c]=y},n}()})(Cu);var qp=ze(Cu.exports),it=8192;function X_(t,e){return e.dist-t.dist}let Wp=100,Zp=50;function Y_(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function hd(t){return t[1]-t[0]+1}function Go(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Gs(t,e){if(t[0]>t[1])return[null,null];let n=hd(t);if(e){if(n===2)return[t,null];let a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];let a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function za(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Go(e,t.length))return n;for(let a=e[0];a<=e[1];++a)xu(n,t[a]);return n}function dd(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)xu(e,t[n][a]);return e}function Hs(t,e,n){if(Y_(t)||Y_(e))return NaN;let a=0,c=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[a,c])}function S1(t){return 360*t-180}function I1(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Xp(t,e){let n=Math.pow(2,e.z),a=(t.y/it+e.y)/n;return[S1((t.x/it+e.x)/n),I1(a)]}function D1(t,e){let n=[];for(let a=0;a<t.length;++a)n.push(Xp(t[a],e));return n}function K_(t,e,n){let a=n.pointOnLine(e,t).point;return n.distance(t,a)}function qs(t,e,n,a,c){let d=n.slice(a[0],a[1]+1),f=1/0;for(let _=e[0];_<=e[1];++_)if((f=Math.min(f,K_(t[_],d,c)))===0)return 0;return f}function Yp(t,e,n,a,c){let d=Math.min(c.pointToSegmentDistance(t,n,a),c.pointToSegmentDistance(e,n,a)),f=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(a,t,e));return Math.min(d,f)}function M1(t,e,n,a,c){if(!Go(e,t.length)||!Go(a,n.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let _=a[0];_<a[1];++_){if(pn(t[f],t[f+1],n[_],n[_+1]))return 0;d=Math.min(d,Yp(t[f],t[f+1],n[_],n[_+1],c))}return d}function Q_(t,e,n,a,c){if(!Go(e,t.length)||!Go(a,n.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let _=a[0];_<=a[1];++_)if((d=Math.min(d,c.distance(t[f],n[_])))===0)return d;return d}function J_(t,e,n){if(Gl(t,e,!0))return 0;let a=1/0;for(let c of e){let d=c.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[d-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,c[d-1],c[0])))===0||(a=Math.min(a,K_(t,c,n)))===0)return a}return a}function To(t,e,n,a){if(!Go(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Gl(t[d],n,!0))return 0;let c=1/0;for(let d=e[0];d<e[1];++d)for(let f of n)for(let _=0,y=f.length,b=y-1;_<y;b=_++){if(pn(t[d],t[d+1],f[b],f[_]))return 0;c=Math.min(c,Yp(t[d],t[d+1],f[b],f[_],a))}return c}function Kp(t,e){for(let n of t)for(let a=0;a<=n.length-1;++a)if(Gl(n[a],e,!0))return!0;return!1}function A1(t,e,n,a=1/0){let c=dd(t),d=dd(e);if(a!==1/0&&Hs(c,d,n)>=a)return a;if($l(c,d)){if(Kp(t,e))return 0}else if(Kp(e,t))return 0;let f=a;for(let _ of t)for(let y=0,b=_.length,T=b-1;y<b;T=y++)for(let S of e)for(let D=0,R=S.length,O=R-1;D<R;O=D++){if(pn(_[T],_[y],S[O],S[D]))return 0;f=Math.min(f,Yp(_[T],_[y],S[O],S[D],n))}return f}function Su(t,e,n,a,c,d,f){if(d===null||f===null)return;let _=Hs(za(a,d),za(c,f),n);_<e&&t.push({dist:_,range1:d,range2:f})}function fd(t,e,n,a,c=1/0){let d=Math.min(a.distance(t[0],n[0][0]),c);if(d===0)return d;let f=new qp([{dist:0,range1:[0,t.length-1],range2:[0,0]}],X_),_=e?Zp:Wp,y=dd(n);for(;f.length;){let b=f.pop();if(b.dist>=d)continue;let T=b.range1;if(hd(T)<=_){if(!Go(T,t.length))return NaN;if(e){let S=To(t,T,n,a);if((d=Math.min(d,S))===0)return d}else for(let S=T[0];S<=T[1];++S){let D=J_(t[S],n,a);if((d=Math.min(d,D))===0)return d}}else{let S=Gs(T,e);if(S[0]!==null){let D=Hs(za(t,S[0]),y,a);D<d&&f.push({dist:D,range1:S[0],range2:[0,0]})}if(S[1]!==null){let D=Hs(za(t,S[1]),y,a);D<d&&f.push({dist:D,range1:S[1],range2:[0,0]})}}}return d}function ey(t,e,n,a,c,d=1/0){let f=Math.min(d,c.distance(t[0],n[0]));if(f===0)return f;let _=new qp([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],X_),y=e?Zp:Wp,b=a?Zp:Wp;for(;_.length;){let T=_.pop();if(T.dist>=f)continue;let S=T.range1,D=T.range2;if(hd(S)<=y&&hd(D)<=b){if(!Go(S,t.length)||!Go(D,n.length))return NaN;if(e&&a?f=Math.min(f,M1(t,S,n,D,c)):e||a?e&&!a?f=Math.min(f,qs(n,D,t,S,c)):!e&&a&&(f=Math.min(f,qs(t,S,n,D,c))):f=Math.min(f,Q_(t,S,n,D,c)),f===0)return f}else{let R=Gs(S,e),O=Gs(D,a);Su(_,f,c,t,n,R[0],O[0]),Su(_,f,c,t,n,R[0],O[1]),Su(_,f,c,t,n,R[1],O[0]),Su(_,f,c,t,n,R[1],O[1])}}return f}function Qp(t,e,n,a,c=1/0){let d=c,f=za(t,[0,t.length-1]);for(let _ of n)if(!(d!==1/0&&Hs(f,za(_,[0,_.length-1]),a)>=d)&&(d=Math.min(d,ey(t,e,_,!0,a,d)),d===0))return d;return d}function pd(t,e,n,a,c=1/0){let d=c,f=za(t,[0,t.length-1]);for(let _ of n){if(d!==1/0&&Hs(f,dd(_),a)>=d)continue;let y=fd(t,e,_,a,d);if(isNaN(y))return y;if((d=Math.min(d,y))===0)return d}return d}function Jp(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ba{constructor(e,n){this.type=dt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Di(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(Jp(a.features[c].geometry.type))return new Ba(a,a.features[c].geometry)}else if(a.type==="Feature"){if(Jp(a.geometry.type))return new Ba(a,a.geometry)}else if(Jp(a.type))return new Ba(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(c,d,f){let _=[];for(let b of c)for(let T of b)_.push(Xp(T,d));let y=new Eu(_[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?ey(_,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y):f.type==="MultiLineString"?Qp(_,!1,f.coordinates,y):f.type==="Polygon"||f.type==="MultiPolygon"?pd(_,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,y):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(c,d,f){let _=[];for(let b of c){let T=[];for(let S of b)T.push(Xp(S,d));_.push(T)}let y=new Eu(_[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Qp(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,y);if(f.type==="MultiLineString"){let b=1/0;for(let T=0;T<f.coordinates.length;T++){let S=Qp(f.coordinates[T],!0,_,y,b);if(isNaN(S))return S;if((b=Math.min(b,S))===0)return b}return b}if(f.type==="Polygon"||f.type==="MultiPolygon"){let b=1/0;for(let T=0;T<_.length;T++){let S=pd(_[T],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,y,b);if(isNaN(S))return S;if((b=Math.min(b,S))===0)return b}return b}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,d,f){let _=[];for(let b of function(T,S){let D=T.length;if(D<=1)return[T];let R=[],O,F;for(let z=0;z<D;z++){let j=w1(T[z]);j!==0&&(T[z].area=Math.abs(j),F===void 0&&(F=j<0),F===j<0?(O&&R.push(O),O=[T[z]]):O.push(T[z]))}return O&&R.push(O),R}(c)){let T=[];for(let S=0;S<b.length;++S)T.push(D1(b[S],d));_.push(T)}let y=new Eu(_[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return pd(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,y);if(f.type==="MultiLineString"){let b=1/0;for(let T=0;T<f.coordinates.length;T++){let S=pd(f.coordinates[T],!0,_,y,b);if(isNaN(S))return S;if((b=Math.min(b,S))===0)return b}return b}return f.type==="Polygon"||f.type==="MultiPolygon"?function(b,T,S){let D=1/0;for(let R of b)for(let O of T){let F=A1(R,O,S,D);if(isNaN(F))return F;if((D=Math.min(D,F))===0)return D}return D}(f.type==="Polygon"?[f.coordinates]:f.coordinates,_,y):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ql(t,e){switch(t){case"string":return io(e);case"number":return+e;case"boolean":return!!e;case"color":return bn.parse(e);case"formatted":return ci.fromString(io(e));case"resolvedImage":return Ii.fromString(io(e))}return e}function Iu(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class Qr{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=_n),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let c=n.parse(e[1],1);if(!(c instanceof ls))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let d=n.parse(e[2],2);return d instanceof ls?new Qr(a,io(c.value),io(d.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Qr(a,io(c.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;let{type:c,value:d,values:f,minValue:_,maxValue:y,stepValue:b}=a,T=a.default.evaluate(e),S=T;if(d){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),S=d.evaluate(e),e.scope=D}return c&&(S=ql(c,S)),S===void 0||_===void 0&&y===void 0&&b===void 0||(typeof S=="number"?S=Iu(S,_,y,b):Array.isArray(S)&&(S=S.map(D=>typeof D=="number"?Iu(D,_,y,b):D))),d!==void 0&&S!==void 0&&f&&!f.includes(S)&&(S=T,c&&(S=ql(c,S))),(c&&c!==this.type||S!==void 0&&Pr(S)!==this.type)&&(S=ql(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ws(t){if(t instanceof xi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Us||t instanceof Ba)return!1;let e=!0;return t.eachChild(n=>{e&&!Ws(n)&&(e=!1)}),e}function md(t){if(t instanceof xi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!md(n)&&(e=!1)}),e}function em(t){if(t instanceof Qr)return!1;let e=!0;return t.eachChild(n=>{e&&!em(n)&&(e=!1)}),e}function Du(t,e){if(t instanceof xi&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!Du(a,e)&&(n=!1)}),n}class gd{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new gd(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Mu{constructor(e,n=[],a,c=new zp,d=[],f,_){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=c,this.errors=d,this.expectedType=a,this._scope=f,this.options=_}parse(e,n,a,c,d={}){return n||a?this.concat(n,a,c)._parse(e,d):this._parse(e,d)}_parse(e,n){function a(c,d,f){return f==="assert"?new bo(d,[c]):f==="coerce"?new wo(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let d=c.parse(e,this);if(!d)return null;if(this.expectedType){let f=this.expectedType,_=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||_.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(f,_))return null}else d=a(d,f,n.typeAnnotation||"coerce");else d=a(d,f,n.typeAnnotation||"assert")}if(!(d instanceof ls)&&d.type.kind!=="resolvedImage"&&Au(d)){let f=new G_(this._scope,this.options);try{d=new ls(d.type,d.evaluate(f))}catch(_){return this.error(_.message),null}}return d}return wo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let c=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new Mu(this.registry,c,n||null,d,this.errors,this._scope,this.options)}error(e,...n){let a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Uo(a,e))}checkSubtype(e,n){let a=gu(e,n);return a&&this.error(a),a}}var ty=Mu;function Au(t){if(t instanceof gd)return Au(t.boundExpression);if(t instanceof xi&&t.name==="error"||t instanceof js||t instanceof Us||t instanceof Ba||t instanceof Qr)return!1;let e=t instanceof wo||t instanceof bo,n=!0;return t.eachChild(a=>{n=e?n&&Au(a):n&&a instanceof ls}),!!n&&Ws(t)&&Du(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function _d(t,e){let n=t.length-1,a,c,d=0,f=n,_=0;for(;d<=f;)if(_=Math.floor((d+f)/2),a=t[_],c=t[_+1],a<=e){if(_===n||e<c)return _;d=_+1}else{if(!(a>e))throw new zr("Input is not a number.");f=_-1}return 0}class Pu{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,d]of a)this.labels.push(c),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,dt);if(!a)return null;let c=[],d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let f=1;f<e.length;f+=2){let _=f===1?-1/0:e[f],y=e[f+1],b=f,T=f+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let S=n.parse(y,T,d);if(!S)return null;d=d||S.type,c.push([_,S])}return new Pu(d,a,c)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let d=n.length;return c>=n[d-1]?a[d-1].evaluate(e):a[_d(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let yd=.95047,ny=1.08883,tm=4/29,Va=6/29,ry=3*Va*Va,nm=Va*Va*Va,vd=Math.PI/180,iy=180/Math.PI;function rm(t){return t>nm?Math.pow(t,1/3):t/ry+tm}function xd(t){return t>Va?t*t*t:ry*(t-tm)}function im(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ru(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function oy(t){let e=Ru(t.r),n=Ru(t.g),a=Ru(t.b),c=rm((.4124564*e+.3575761*n+.1804375*a)/yd),d=rm((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-rm((.0193339*e+.119192*n+.9503041*a)/ny)),alpha:t.a}}function sy(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*xd(e),n=yd*xd(n),a=ny*xd(a),new bn(im(3.2404542*n-1.5371385*e-.4985314*a),im(-.969266*n+1.8760108*e+.041556*a),im(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function P1(t,e,n){let a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let Ou={forward:oy,reverse:sy,interpolate:function(t,e,n){return{l:It(t.l,e.l,n),a:It(t.a,e.a,n),b:It(t.b,e.b,n),alpha:It(t.alpha,e.alpha,n)}}},Wl={forward:function(t){let{l:e,a:n,b:a}=oy(t),c=Math.atan2(a,n)*iy;return{h:c<0?c+360:c,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*vd,n=t.c;return sy({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:P1(t.h,e.h,n),c:It(t.c,e.c,n),l:It(t.l,e.l,n),alpha:It(t.alpha,e.alpha,n)}}};var ay=Object.freeze({__proto__:null,hcl:Wl,lab:Ou});class Hi{constructor(e,n,a,c,d){this.type=e,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(let[f,_]of d)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,n,a,c){let d=0;if(e.name==="exponential")d=om(n,e.base,a,c);else if(e.name==="linear")d=om(n,1,a,c);else if(e.name==="cubic-bezier"){let f=e.controlPoints;d=new eu(f[0],f[1],f[2],f[3]).solve(om(n,1,a,c))}return d}static parse(e,n){let[a,c,d,...f]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let b=c[1];if(typeof b!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:b}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let b=c.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,dt),!d)return null;let _=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=Si:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let b=0;b<f.length;b+=2){let T=f[b],S=f[b+1],D=b+3,R=b+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let O=n.parse(S,R,y);if(!O)return null;y=y||O.type,_.push([T,O])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Hi(y,a,c,d,_):n.error(`Type ${Er(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let d=n.length;if(c>=n[d-1])return a[d-1].evaluate(e);let f=_d(n,c),_=Hi.interpolationFactor(this.interpolation,c,n[f],n[f+1]),y=a[f].evaluate(e),b=a[f+1].evaluate(e);return this.operator==="interpolate"?ld[this.type.kind.toLowerCase()](y,b,_):this.operator==="interpolate-hcl"?Wl.reverse(Wl.interpolate(Wl.forward(y),Wl.forward(b),_)):Ou.reverse(Ou.interpolate(Ou.forward(y),Ou.forward(b),_))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function om(t,e,n,a){let c=a-n,d=t-n;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}class bd{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,c=n.expectedType;c&&c.kind!=="value"&&(a=c);let d=[];for(let _ of e.slice(1)){let y=n.parse(_,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,d.push(y)}let f=c&&d.some(_=>gu(c,_.type));return new bd(f?_n:a,d)}evaluate(e){let n,a=null,c=0;for(let d of this.args){if(c++,a=d.evaluate(e),a&&a instanceof Ii&&!a.available&&(n||(n=a),a=null,c===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class wd{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let d=1;d<e.length-1;d+=2){let f=e[d];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);let _=n.parse(e[d+1],d+1);if(!_)return null;a.push([f,_])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return c?new wd(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class sm{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,dt),c=n.parse(e[2],2,Fi(n.expectedType||_n));return a&&c?new sm(c.type.itemType,a,c):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new zr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new zr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new zr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class am{constructor(e,n){this.type=En,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,_n),c=n.parse(e[2],2,_n);return a&&c?Bp(a.type,[En,wn,dt,Bl,_n])?new am(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Ul(n,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${Er(Pr(n))} instead.`);if(!Ul(a,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${Er(Pr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ed{constructor(e,n,a){this.type=dt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,_n),c=n.parse(e[2],2,_n);if(!a||!c)return null;if(!Bp(a.type,[En,wn,dt,Bl,_n]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(a.type)} instead`);if(e.length===4){let d=n.parse(e[3],3,dt);return d?new Ed(a,c,d):null}return new Ed(a,c)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Ul(n,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${Er(Pr(n))} instead.`);if(!Ul(a,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${Er(Pr(a))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return a.indexOf(n,c)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Zl{constructor(e,n,a,c,d,f){this.inputType=e,this.type=n,this.input=a,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let d={},f=[];for(let b=2;b<e.length-1;b+=2){let T=e[b],S=e[b+1];Array.isArray(T)||(T=[T]);let D=n.concat(b);if(T.length===0)return D.error("Expected at least one branch label.");for(let O of T){if(typeof O!="number"&&typeof O!="string")return D.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,Pr(O)))return null}else a=Pr(O);if(d[String(O)]!==void 0)return D.error("Branch labels must be unique.");d[String(O)]=f.length}let R=n.parse(S,b,c);if(!R)return null;c=c||R.type,f.push(R)}let _=n.parse(e[1],1,_n);if(!_)return null;let y=n.parse(e[e.length-1],e.length-1,c);return y?_.type.kind!=="value"&&n.concat(1).checkSubtype(a,_.type)?null:new Zl(a,c,_,d,f,y):null}evaluate(e){let n=this.input.evaluate(e);return(Pr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],c={};for(let f of n){let _=c[this.cases[f]];_===void 0?(c[this.cases[f]]=a.length,a.push([this.cases[f],[f]])):a[_][1].push(f)}let d=f=>this.inputType.kind==="number"?Number(f):f;for(let[f,_]of a)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class lm{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let c=[];for(let f=1;f<e.length-1;f+=2){let _=n.parse(e[f],f,En);if(!_)return null;let y=n.parse(e[f+1],f+1,a);if(!y)return null;c.push([_,y]),a=a||y.type}let d=n.parse(e[e.length-1],e.length-1,a);return d?new lm(a,c,d):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Td{constructor(e,n,a,c){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,_n),c=n.parse(e[2],2,dt);if(!a||!c)return null;if(!Bp(a.type,[Fi(_n),wn,_n]))return n.error(`Expected first argument to be of type array or string, but found ${Er(a.type)} instead`);if(e.length===4){let d=n.parse(e[3],3,dt);return d?new Td(a.type,a,c,d):null}return new Td(a.type,a,c)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Ul(n,["string","array"]))throw new zr(`Expected first argument to be of type array or string, but found ${Er(Pr(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(a,c)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ku(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ly(t,e,n,a){return a.compare(e,n)===0}function ja(t,e,n){let a=t!=="=="&&t!=="!=";return class NF{constructor(d,f,_){this.type=En,this.lhs=d,this.rhs=f,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");let _=d[0],y=f.parse(d[1],1,_n);if(!y)return null;if(!ku(_,y.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${Er(y.type)}'.`);let b=f.parse(d[2],2,_n);if(!b)return null;if(!ku(_,b.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${Er(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${Er(y.type)}' and '${Er(b.type)}'.`);a&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new bo(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new bo(y.type,[b])));let T=null;if(d.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(T=f.parse(d[3],3,xo),!T)return null}return new NF(y,b,T)}evaluate(d){let f=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){let y=Pr(f),b=Pr(_);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new zr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=Pr(f),b=Pr(_);if(y.kind!=="string"||b.kind!=="string")return e(d,f,_)}return this.collator?n(d,f,_,this.collator.evaluate(d)):e(d,f,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[t];return this.eachChild(f=>{d.push(f.serialize())}),d}}}let R1=ja("==",function(t,e,n){return e===n},ly),cy=ja("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!ly(0,e,n,a)}),uy=ja("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),hy=ja(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),dy=ja("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),cm=ja(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class Lu{constructor(e,n,a,c,d,f){this.type=wn,this.number=e,this.locale=n,this.currency=a,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,dt);if(!a)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=n.parse(c.locale,1,wn),!d))return null;let f=null;if(c.currency&&(f=n.parse(c.currency,1,wn),!f))return null;let _=null;if(c.unit&&(_=n.parse(c.unit,1,wn),!_))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,dt),!y))return null;let b=null;return c["max-fraction-digits"]&&(b=n.parse(c["max-fraction-digits"],1,dt),!b)?null:new Lu(a,d,f,_,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class um{constructor(e){this.type=dt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Er(a.type)} instead.`):new um(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new zr(`Expected value to be of type string or array, but found ${Er(Pr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function fy(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Ua={"==":R1,"!=":cy,">":hy,"<":uy,">=":cm,"<=":dy,array:bo,at:sm,boolean:bo,case:lm,coalesce:bd,collator:js,format:yu,image:vu,in:am,"index-of":Ed,interpolate:Hi,"interpolate-hcl":Hi,"interpolate-lab":Hi,length:um,let:wd,literal:ls,match:Zl,number:bo,"number-format":Lu,object:bo,slice:Td,step:Pu,string:bo,"to-boolean":wo,"to-color":wo,"to-number":wo,"to-string":wo,var:gd,within:Us,distance:Ba,config:Qr};function py(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let d=c?c.evaluate(t):1,f=U_(e,n,a,d);if(f)throw new zr(f);return new bn(e/255*d,n/255*d,a/255*d,d)}function my(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let d=c?c.evaluate(t):1,f=function(b,T,S,D){return typeof b=="number"&&b>=0&&b<=360?typeof T=="number"&&T>=0&&T<=100&&typeof S=="number"&&S>=0&&S<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[b,T,S,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[b,T,S,D]:[b,T,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[b,T,S,D]:[b,T,S]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,d);if(f)throw new zr(f);let _=`hsla(${e}, ${n}%, ${a}%, ${d})`,y=bn.parse(_);if(!y)throw new zr(`Failed to parse HSLA color: ${_}`);return y}function gy(t,e){return t in e}function hm(t,e){let n=e[t];return n===void 0?null:n}function $a(t){return{type:t}}function _y(t){return{result:"success",value:t}}function Ga(t){return{result:"error",value:t}}function yy(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Cd(t){return t["property-type"]==="data-driven"}function O1(t){return yy(t.expression,"measure-light")}function p(t){return yy(t.expression,"zoom")}function s(t){return!!t.expression&&t.expression.interpolated}function h(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function v(t,e){let n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",c=a||!(a||t.property!==void 0),d=t.type||(s(e)?"exponential":"interval");if(n&&((t=Np({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],bn.parse(b[1])])),t.default=bn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!ay[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,_,y;if(d==="exponential")f=M;else if(d==="interval")f=C;else if(d==="categorical"){f=E,_=Object.create(null);for(let b of t.stops)_[b[0]]=b[1];y=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=P}if(a){let b={},T=[];for(let R=0;R<t.stops.length;R++){let O=t.stops[R],F=O[0].zoom;b[F]===void 0&&(b[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},T.push(F)),b[F].stops.push([O[0].value,O[1]])}let S=[];for(let R of T)S.push([b[R].zoom,v(b[R],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Hi.interpolationFactor.bind(void 0,D),zoomStops:S.map(R=>R[0]),evaluate:({zoom:R},O)=>M({stops:S,base:t.base},e,R).evaluate(R,O)}}if(c){let b=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Hi.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>f(t,e,T,_,y)}}return{kind:"source",evaluate(b,T){let S=T&&T.properties?T.properties[t.property]:void 0;return S===void 0?x(t.default,e.default):f(t,e,S,_,y)}}}function x(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function E(t,e,n,a,c){return x(typeof n===c?a[n]:void 0,t.default,e.default)}function C(t,e,n){if(Na(n)!=="number")return x(t.default,e.default);let a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];let c=_d(t.stops.map(d=>d[0]),n);return t.stops[c][1]}function M(t,e,n){let a=t.base!==void 0?t.base:1;if(Na(n)!=="number")return x(t.default,e.default);let c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];let d=_d(t.stops.map(T=>T[0]),n),f=function(T,S,D,R){let O=R-D,F=T-D;return O===0?0:S===1?F/O:(Math.pow(S,F)-1)/(Math.pow(S,O)-1)}(n,a,t.stops[d][0],t.stops[d+1][0]),_=t.stops[d][1],y=t.stops[d+1][1],b=ld[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=ay[t.colorSpace];b=(S,D)=>T.reverse(T.interpolate(T.forward(S),T.forward(D),f))}return typeof _.evaluate=="function"?{evaluate(...T){let S=_.evaluate.apply(void 0,T),D=y.evaluate.apply(void 0,T);if(S!==void 0&&D!==void 0)return b(S,D,f)}}:b(_,y,f)}function P(t,e,n){return e.type==="color"?n=bn.parse(n):e.type==="formatted"?n=ci.fromString(n.toString()):e.type==="resolvedImage"?n=Ii.fromString(n.toString()):Na(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,t.default,e.default)}xi.register(Ua,{error:[{kind:"error"},[wn],(t,[e])=>{throw new zr(e.evaluate(t))}],typeof:[wn,[_n],(t,[e])=>Er(Pr(e.evaluate(t)))],"to-rgba":[Fi(dt,4),[Si],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[Si,[dt,dt,dt],py],rgba:[Si,[dt,dt,dt,dt],py],hsl:[Si,[dt,dt,dt],my],hsla:[Si,[dt,dt,dt,dt],my],has:{type:En,overloads:[[[wn],(t,[e])=>gy(e.evaluate(t),t.properties())],[[wn,Vl],(t,[e,n])=>gy(e.evaluate(t),n.evaluate(t))]]},get:{type:_n,overloads:[[[wn],(t,[e])=>hm(e.evaluate(t),t.properties())],[[wn,Vl],(t,[e,n])=>hm(e.evaluate(t),n.evaluate(t))]]},"feature-state":[_n,[wn],(t,[e])=>hm(e.evaluate(t),t.featureState||{})],properties:[Vl,[],t=>t.properties()],"geometry-type":[wn,[],t=>t.geometryType()],id:[_n,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],pitch:[dt,[],t=>t.globals.pitch||0],"distance-from-center":[dt,[],t=>t.distanceFromCenter()],"measure-light":[dt,[wn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],"raster-value":[dt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[dt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[dt,[],t=>t.globals.skyRadialProgress||0],accumulated:[_n,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[dt,$a(dt),(t,e)=>{let n=0;for(let a of e)n+=a.evaluate(t);return n}],"*":[dt,$a(dt),(t,e)=>{let n=1;for(let a of e)n*=a.evaluate(t);return n}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,$a(dt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[dt,$a(dt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[En,[wn,_n],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[En,[_n],(t,[e])=>t.id()===e.value],"filter-type-==":[En,[wn],(t,[e])=>t.geometryType()===e.value],"filter-<":[En,[wn,_n],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[En,[_n],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[En,[wn,_n],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[En,[_n],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[En,[wn,_n],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[En,[_n],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[En,[wn,_n],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[En,[_n],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[En,[_n],(t,[e])=>e.value in t.properties()],"filter-has-id":[En,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[En,[Fi(wn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[En,[Fi(_n)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[En,[wn,Fi(_n)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[En,[wn,Fi(_n)],(t,[e,n])=>function(a,c,d,f){for(;d<=f;){let _=d+f>>1;if(c[_]===a)return!0;c[_]>a?f=_-1:d=_+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:En,overloads:[[[En,En],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[$a(En),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:En,overloads:[[[En,En],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[$a(En),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[En,[En],(t,[e])=>!e.evaluate(t)],"is-supported-script":[En,[wn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[wn,[wn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[wn,[wn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[wn,$a(_n),(t,e)=>e.map(n=>io(n.evaluate(t))).join("")],"resolved-locale":[wn,[xo],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[dt,[dt,dt,_n],(t,e)=>{let[n,a,c]=e.map(f=>f.evaluate(t));if(n>a||n===a)return n;let d;if(typeof c=="string")d=function(f){let _=0;if(f.length===0)return _;for(let y=0;y<f.length;y++)_=(_<<5)-_+f.charCodeAt(y),_|=0;return _}(c);else{if(typeof c!="number")throw new zr(`Invalid seed input: ${c}`);d=c}return n+fy(d)()*(a-n)}]});class k{constructor(e,n,a,c){this.expression=e,this._warningHistory={},this._evaluator=new G_(a,c),this._defaultValue=n?function(d){return d.type==="color"&&(h(d.default)||Array.isArray(d.default))?new bn(0,0,0,0):d.type==="color"?bn.parse(d.default)||null:d.default===void 0?null:d.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,c,d,f,_,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,c,d,f,_,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new zr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function N(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ua}function B(t,e,n,a){let c=new ty(Ua,[],e?function(f){let _={color:Si,string:wn,number:dt,enum:wn,boolean:En,formatted:jl,resolvedImage:$o};return f.type==="array"?Fi(_[f.value]||_n,f.length):_[f.type]}(e):void 0,void 0,void 0,n,a),d=c.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?_y(new k(d,e,n,a)):Ga(c.errors)}class V{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!md(n.expression),this.isConfigDependent=!em(n.expression)}evaluateWithoutErrorHandling(e,n,a,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,d,f)}evaluate(e,n,a,c,d,f){return this._styleExpression.evaluate(e,n,a,c,d,f)}}class G{constructor(e,n,a,c,d){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!md(n.expression),this.isLightConstant=d,this.isConfigDependent=!em(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,a,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,d,f)}evaluate(e,n,a,c,d,f){return this._styleExpression.evaluate(e,n,a,c,d,f)}interpolationFactor(e,n,a){return this.interpolationType?Hi.interpolationFactor(this.interpolationType,e,n,a):0}}function H(t,e,n,a){if((t=B(t,e,n,a)).result==="error")return t;let c=t.value.expression,d=Ws(c);if(!d&&!Cd(e))return Ga([new Uo("","data expressions not supported")]);let f=Du(c,["zoom","pitch","distance-from-center"]);if(!f&&!p(e))return Ga([new Uo("","zoom expressions not supported")]);let _=Du(c,["measure-light"]);if(!_&&!O1(e))return Ga([new Uo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,b=W(c);return b||f||y?b instanceof Uo?Ga([b]):b instanceof Hi&&!s(e)?Ga([new Uo("",'"interpolate" expressions cannot be used with this property')]):_y(b?new G(d?"camera":"composite",t.value,b.labels,b instanceof Hi?b.interpolation:void 0,_):new V(d?"constant":"source",t.value,_)):Ga([new Uo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class q{constructor(e,n){this._parameters=e,this._specification=n,Np(this,v(this._parameters,this._specification))}static deserialize(e){return new q(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function W(t){let e=null;if(t instanceof wd)e=W(t.result);else if(t instanceof bd){for(let n of t.args)if(e=W(n),e)break}else(t instanceof Pu||t instanceof Hi)&&t.input instanceof xi&&t.input.name==="zoom"&&(e=t);return e instanceof Uo||t.eachChild(n=>{let a=W(n);a instanceof Uo?e=a:e&&a&&e!==a&&(e=new Uo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ee=ne,te=3;function ne(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var d=0;d<this.d*this.d;d++){var f=c[te+d],_=c[te+d+1];a.push(f===_?null:c.subarray(f,_))}var y=c[te+a.length+1];this.keys=c.subarray(c[te+a.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var T=n/e*t;this.min=-T,this.max=t+T}ne.prototype.insert=function(t,e,n,a,c){this._forEachCell(e,n,a,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c)},ne.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ne.prototype._insertCell=function(t,e,n,a,c,d){this.cells[c].push(d)},ne.prototype.query=function(t,e,n,a,c){var d=this.min,f=this.max;if(t<=d&&e<=d&&f<=n&&f<=a&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,n,a,this._queryCell,_,{},c),_},ne.prototype._queryCell=function(t,e,n,a,c,d,f,_){var y=this.cells[c];if(y!==null)for(var b=this.keys,T=this.bboxes,S=0;S<y.length;S++){var D=y[S];if(f[D]===void 0){var R=4*D;(_?_(T[R+0],T[R+1],T[R+2],T[R+3]):t<=T[R+2]&&e<=T[R+3]&&n>=T[R+0]&&a>=T[R+1])?(f[D]=!0,d.push(b[D])):f[D]=!1}}},ne.prototype._forEachCell=function(t,e,n,a,c,d,f,_){for(var y=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(n),S=this._convertToCellCoord(a),D=y;D<=T;D++)for(var R=b;R<=S;R++){var O=this.d*R+D;if((!_||_(this._convertFromCellCoord(D),this._convertFromCellCoord(R),this._convertFromCellCoord(D+1),this._convertFromCellCoord(R+1)))&&c.call(this,t,e,n,a,O,d,f,_))return}},ne.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ne.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ne.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=te+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,f=0;f<t.length;f++){var _=t[f];c[te+f]=d,c.set(_,d),d+=_.length}return c[te+t.length]=d,c.set(this.keys,d),c[te+t.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};var ue=ze(ee);let ce={};function J(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),ce[e]={klass:t,omit:n.omit||[]}}J(Object,"Object"),ue.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ue.deserialize=function(t){return new ue(t.buffer)},Object.defineProperty(ue,"name",{value:"Grid"}),J(ue,"Grid"),J(bn,"Color"),J(Error,"Error"),J(ci,"Formatted"),J(Fa,"FormattedSection"),J(Mp,"AJAXError"),J(Ii,"ResolvedImage"),J(q,"StylePropertyFunction"),J(k,"StyleExpression",{omit:["_evaluator"]}),J(G,"ZoomDependentExpression"),J(V,"ZoomConstantExpression"),J(xi,"CompoundExpression",{omit:["_evaluate"]});for(let t in Ua)ce[Ua[t]._classRegistryKey]||J(Ua[t],`Expression${t}`);function re(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ie(t){return self.ImageBitmap&&t instanceof ImageBitmap}function ge(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(re(t)||ie(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let a of t)n.push(ge(a,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[a,c]of t.entries())n[a]=ge(c);return n}if(typeof t=="object"){let n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let d in t)t.hasOwnProperty(d)&&(ce[a].omit.indexOf(d)>=0||(c[d]=ge(t[d],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof t)}function Ce(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||re(t)||ie(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ce);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let c=new Map;for(let d of Object.keys(t))d!=="$name"&&c.set(d,Ce(t[d]));return c}let{klass:n}=ce[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let a=Object.create(n.prototype);for(let c of Object.keys(t))c!=="$name"&&(a[c]=Ce(t[c]));return a}throw new Error("can't deserialize object of type "+typeof t)}let ae={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Se(t){for(let e of t)if(Ge(e.charCodeAt(0)))return!0;return!1}function Me(t){for(let e of t)if(!$e(e.charCodeAt(0)))return!1;return!0}function $e(t){return!(ae.Arabic(t)||ae["Arabic Supplement"](t)||ae["Arabic Extended-A"](t)||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t))}function Ge(t){return!(t!==746&&t!==747&&(t<4352||!(ae["Bopomofo Extended"](t)||ae.Bopomofo(t)||ae["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ae["CJK Compatibility Ideographs"](t)||ae["CJK Compatibility"](t)||ae["CJK Radicals Supplement"](t)||ae["CJK Strokes"](t)||!(!ae["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ae["CJK Unified Ideographs Extension A"](t)||ae["CJK Unified Ideographs"](t)||ae["Enclosed CJK Letters and Months"](t)||ae["Hangul Compatibility Jamo"](t)||ae["Hangul Jamo Extended-A"](t)||ae["Hangul Jamo Extended-B"](t)||ae["Hangul Jamo"](t)||ae["Hangul Syllables"](t)||ae.Hiragana(t)||ae["Ideographic Description Characters"](t)||ae.Kanbun(t)||ae["Kangxi Radicals"](t)||ae["Katakana Phonetic Extensions"](t)||ae.Katakana(t)&&t!==12540||!(!ae["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ae["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ae["Unified Canadian Aboriginal Syllabics"](t)||ae["Unified Canadian Aboriginal Syllabics Extended"](t)||ae["Vertical Forms"](t)||ae["Yijing Hexagram Symbols"](t)||ae["Yi Syllables"](t)||ae["Yi Radicals"](t))))}function Ve(t){return!(Ge(t)||function(e){return!!(ae["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ae["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ae["Letterlike Symbols"](e)||ae["Number Forms"](e)||ae["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ae["Control Pictures"](e)&&e!==9251||ae["Optical Character Recognition"](e)||ae["Enclosed Alphanumerics"](e)||ae["Geometric Shapes"](e)||ae["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ae["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ae["CJK Symbols and Punctuation"](e)||ae.Katakana(e)||ae["Private Use Area"](e)||ae["CJK Compatibility Forms"](e)||ae["Small Form Variants"](e)||ae["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function xe(t){return t>=1424&&t<=2303||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t)}function Re(t,e){return!(!e&&xe(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ae.Khmer(t))}function Fe(t){for(let e of t)if(xe(e.charCodeAt(0)))return!0;return!1}let ot="deferred",ct="loading",at="loaded",je=null,He="unavailable",st=null,pt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(He="error"),je&&je(t)};function Ot(){$t.fire(new Ci("pluginStateChange",{pluginStatus:He,pluginURL:st}))}let $t=new La,cn=function(){return He},on=function(){if(He!==ot||!st)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");He=ct,Ot(),st&&Oa({url:st},t=>{t?pt(t):(He=at,Ot())})},An={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>He===at||An.applyArabicShaping!=null,isLoading:()=>He===ct,setState(t){He=t.pluginStatus,st=t.pluginURL},isParsed:()=>An.applyArabicShaping!=null&&An.processBidirectionalText!=null&&An.processStyledBidirectionalText!=null,getPluginURL:()=>st};class Bt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(let c of n)if(!Re(c.charCodeAt(0),a))return!1;return!0}(e,An.isLoaded())}}class Sn{constructor(e,n,a,c){this.property=e,this.value=n,this.expression=function(d,f,_,y){if(h(d))return new q(d,f);if(N(d)||Array.isArray(d)&&d.length>0){let b=H(d,f,_,y);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=d;return typeof d=="string"&&f.type==="color"&&(b=bn.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(n===void 0?e.specification.default:n,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class Gn{constructor(e,n,a){this.property=e,this.value=new Sn(e,void 0,n,a)}transitioned(e,n){return new tn(this.property,this.value,n,li({},e.transition,this.transition),e.now)}untransitioned(){return new tn(this.property,this.value,null,{},0)}}class Rn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Vo(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Gn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Sn(this._values[e].property,n===null?void 0:Vo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let a=this._properties.properties;if(e)for(let c in e){let d=e[c];if(ru(c,"-transition")){let f=c.slice(0,-11);a[f]&&this.setTransition(f,d)}else a.hasOwnProperty(c)&&this.setValue(c,d)}}getTransition(e){return Vo(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Gn(this._values[e].property)),this._values[e].transition=Vo(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let a=new Vt(this._properties);for(let c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,n._values[c]);return a}untransitioned(){let e=new Vt(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class tn{constructor(e,n,a,c,d){let f=c.delay||0,_=c.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+f,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let c=e.now||0,d=this.value.possiblyEvaluate(e,n,a),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,n,a);{let _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,n,a),d,gp(_))}}return d}}class Vt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let c=new un(this._properties);for(let d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,a);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Vo(this._values[e].value)}setValue(e,n){this._values[e]=new Sn(this._values[e].property,n===null?void 0:Vo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let c=new un(this._properties);for(let d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,a);return c}}class Jn{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,c){return this.property.evaluate(this.value,this.parameters,e,n,a,c)}}class un{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Be{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let c=ld[this.specification.type];return c?c(e,n,a):e}}class ut{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,c){return new Jn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,c)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Jn(this,{kind:"constant",value:void 0},e.parameters);let c=ld[this.specification.type];return c?new Jn(this,{kind:"constant",value:c(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,c,d,f){return e.kind==="constant"?e.value:e.evaluate(n,a,c,d,f)}}class Lr{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,c){return!!e.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class Pn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Bt(0,{});for(let a in e){let c=e[a];c.specification.overridable&&this.overridableProperties.push(a);let d=this.defaultPropertyValues[a]=new Sn(c,void 0),f=this.defaultTransitionablePropertyValues[a]=new Gn(c);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(n)}}}J(ut,"DataDrivenProperty"),J(Be,"DataConstantProperty"),J(Lr,"ColorRampProperty");var Te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Mi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ui(t){if(Array.isArray(t))return t.map(ui);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=ui(t[n]);return e}return Mi(t)}function Br(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Br(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function bi(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Br(t)||(t=Ho(t));let n=t,a=!0;try{a=function(b){if(!qi(b))return b;let T=ui(b);return so(T),T=Ni(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=Te[`filter_${e}`],d=B(a,c),f=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));f=(b,T,S)=>d.value.evaluate(b,T,{},S);let _=null,y=null;if(a!==n){let b=B(n,c);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,S,D,R,O)=>b.value.evaluate(T,S,{},D,void 0,void 0,R,O),y=!Ws(b.value.expression)}return{filter:f,dynamicFilter:_||void 0,needGeometry:us(a),needFeature:!!y}}function Ni(t){if(!Array.isArray(t))return t;let e=function(n){if(Zs.has(n[0])){for(let a=1;a<n.length;a++)if(qi(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>Ni(n))}function so(t){let e=!1,n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||qi(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||qi(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||qi(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)so(t[a])}function qi(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(qi(t[n]))return!0;return!1}let Zs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Xs(t,e){return t<e?-1:t>e?1:0}function us(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(us(t[e]))return!0;return!1}function Ho(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?hs(t[1],t[2],"=="):e==="!="?Yl(hs(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?hs(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Ho))):e==="all"?["all"].concat(t.slice(1).map(Ho)):e==="none"?["all"].concat(t.slice(1).map(Ho).map(Yl)):e==="in"?Xl(t[1],t.slice(2)):e==="!in"?Yl(Xl(t[1],t.slice(2))):e==="has"?Fu(t[1]):e!=="!has"||Yl(Fu(t[1]));var n}function hs(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Xl(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Xs)]]:["filter-in-small",t,["literal",e]]}}function Fu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Yl(t){return["!",t]}let Kl="";function Sd(t,e){return e?`${t}${Kl}${e}`:t}let Id="-transition",Ha=new Set(["fill","line","background","hillshade","raster"]);class hi extends La{constructor(e,n,a,c,d){if(super(),this.id=e.id,this.fqid=Sd(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Xn(n.layout,this.scope,d),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Rn(n.paint,this.scope,d);for(let f in e.paint)this.setPaintProperty(f,e.paint[f]);for(let f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new un(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Ha.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return ru(e,Id)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let a=this._transitionablePaint,c=a._properties.properties;if(ru(e,Id)){let S=e.slice(0,-11);return c[S]&&a.setTransition(S,n||void 0),!1}if(!c[e])return!1;let d=a._values[e],f=d.value.isDataDriven(),_=d.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,b=y.isDataDriven(),T=ru(e,"pattern")||e==="line-dasharray";return b||f||T||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Pa({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof Jn&&Cd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=bi(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,c,d,f,_,y,b){}queryIntersectsMatchingFeature(e,n,a,c){}}let dm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vy{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function In(t,e=1){let n=0,a=0;return{members:t.map(c=>{let d=dm[c.type].BYTES_PER_ELEMENT,f=n=ZS(n,Math.max(e,d)),_=c.components||1;return a=Math.max(a,d),n+=d*_,{name:c.name,type:c.type,components:_,offset:f}}),size:ZS(n,Math.max(a,e)),alignment:e}}function ZS(t,e){return Math.ceil(t/e)*e}class ds extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,e}}ds.prototype.bytesPerElement=4,J(ds,"StructArrayLayout2i4");class xy extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let d=3*e;return this.int16[d+0]=n,this.int16[d+1]=a,this.int16[d+2]=c,e}}xy.prototype.bytesPerElement=6,J(xy,"StructArrayLayout3i6");class Ql extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,c)}emplace(e,n,a,c,d){let f=4*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=c,this.int16[f+3]=d,e}}Ql.prototype.bytesPerElement=8,J(Ql,"StructArrayLayout4i8");class k1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c,d)}emplace(e,n,a,c,d,f){let _=5*e;return this.int16[_+0]=n,this.int16[_+1]=a,this.int16[_+2]=c,this.int16[_+3]=d,this.int16[_+4]=f,e}}k1.prototype.bytesPerElement=10,J(k1,"StructArrayLayout5i10");class L1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,d,f,_)}emplace(e,n,a,c,d,f,_,y){let b=6*e,T=12*e,S=3*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.uint8[T+4]=c,this.uint8[T+5]=d,this.uint8[T+6]=f,this.uint8[T+7]=_,this.float32[S+2]=y,e}}L1.prototype.bytesPerElement=12,J(L1,"StructArrayLayout2i4ub1f12");class Jl extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,c)}emplace(e,n,a,c,d){let f=4*e;return this.float32[f+0]=n,this.float32[f+1]=a,this.float32[f+2]=c,this.float32[f+3]=d,e}}Jl.prototype.bytesPerElement=16,J(Jl,"StructArrayLayout4f16");class ec extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let d=3*e;return this.float32[d+0]=n,this.float32[d+1]=a,this.float32[d+2]=c,e}}ec.prototype.bytesPerElement=12,J(ec,"StructArrayLayout3f12");class tc extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c,d)}emplace(e,n,a,c,d,f){let _=6*e,y=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=a,this.uint16[_+2]=c,this.uint16[_+3]=d,this.float32[y+2]=f,e}}tc.prototype.bytesPerElement=12,J(tc,"StructArrayLayout4ui1f12");class by extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,c)}emplace(e,n,a,c,d){let f=4*e;return this.uint16[f+0]=n,this.uint16[f+1]=a,this.uint16[f+2]=c,this.uint16[f+3]=d,e}}by.prototype.bytesPerElement=8,J(by,"StructArrayLayout4ui8");class wy extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,c,d,f)}emplace(e,n,a,c,d,f,_){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.int16[y+3]=d,this.int16[y+4]=f,this.int16[y+5]=_,e}}wy.prototype.bytesPerElement=12,J(wy,"StructArrayLayout6i12");class F1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_,y,b,T,S,D){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,c,d,f,_,y,b,T,S,D)}emplace(e,n,a,c,d,f,_,y,b,T,S,D,R){let O=12*e;return this.int16[O+0]=n,this.int16[O+1]=a,this.int16[O+2]=c,this.int16[O+3]=d,this.uint16[O+4]=f,this.uint16[O+5]=_,this.uint16[O+6]=y,this.uint16[O+7]=b,this.int16[O+8]=T,this.int16[O+9]=S,this.int16[O+10]=D,this.int16[O+11]=R,e}}F1.prototype.bytesPerElement=24,J(F1,"StructArrayLayout4i4ui4i24");class N1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,c,d,f)}emplace(e,n,a,c,d,f,_){let y=10*e,b=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.float32[b+2]=d,this.float32[b+3]=f,this.float32[b+4]=_,e}}N1.prototype.bytesPerElement=20,J(N1,"StructArrayLayout3i3f20");class z1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}z1.prototype.bytesPerElement=4,J(z1,"StructArrayLayout1ul4");class Nu extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Nu.prototype.bytesPerElement=4,J(Nu,"StructArrayLayout1f4");class nc extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,e}}nc.prototype.bytesPerElement=4,J(nc,"StructArrayLayout2ui4");class B1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_,y,b,T,S,D,R){let O=this.length;return this.resize(O+1),this.emplace(O,e,n,a,c,d,f,_,y,b,T,S,D,R)}emplace(e,n,a,c,d,f,_,y,b,T,S,D,R,O){let F=20*e,z=10*e;return this.int16[F+0]=n,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=d,this.int16[F+4]=f,this.float32[z+3]=_,this.float32[z+4]=y,this.float32[z+5]=b,this.float32[z+6]=T,this.int16[F+14]=S,this.uint32[z+8]=D,this.uint16[F+18]=R,this.uint16[F+19]=O,e}}B1.prototype.bytesPerElement=40,J(B1,"StructArrayLayout5i4f1i1ul2ui40");class Ey extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,d,f,_)}emplace(e,n,a,c,d,f,_,y){let b=8*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+4]=d,this.int16[b+5]=f,this.int16[b+6]=_,this.int16[b+7]=y,e}}Ey.prototype.bytesPerElement=16,J(Ey,"StructArrayLayout3i2i2i16");class V1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c,d)}emplace(e,n,a,c,d,f){let _=4*e,y=8*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=c,this.int16[y+6]=d,this.int16[y+7]=f,e}}V1.prototype.bytesPerElement=16,J(V1,"StructArrayLayout2f1f2i16");class j1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,c)}emplace(e,n,a,c,d){let f=12*e,_=3*e;return this.uint8[f+0]=n,this.uint8[f+1]=a,this.float32[_+1]=c,this.float32[_+2]=d,e}}j1.prototype.bytesPerElement=12,J(j1,"StructArrayLayout2ub2f12");class Ur extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=a,this.uint16[d+2]=c,e}}Ur.prototype.bytesPerElement=6,J(Ur,"StructArrayLayout3ui6");class U1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j,X,Y,K,le){let se=this.length;return this.resize(se+1),this.emplace(se,e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j,X,Y,K,le)}emplace(e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j,X,Y,K,le,se){let pe=30*e,_e=15*e,Ee=60*e;return this.int16[pe+0]=n,this.int16[pe+1]=a,this.int16[pe+2]=c,this.float32[_e+2]=d,this.float32[_e+3]=f,this.uint16[pe+8]=_,this.uint16[pe+9]=y,this.uint32[_e+5]=b,this.uint32[_e+6]=T,this.uint32[_e+7]=S,this.uint16[pe+16]=D,this.uint16[pe+17]=R,this.uint16[pe+18]=O,this.float32[_e+10]=F,this.float32[_e+11]=z,this.uint8[Ee+48]=j,this.uint8[Ee+49]=X,this.uint8[Ee+50]=Y,this.uint32[_e+13]=K,this.int16[pe+28]=le,this.uint8[Ee+58]=se,e}}U1.prototype.bytesPerElement=60,J(U1,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class $1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We,Je){let Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We,Je)}emplace(e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j,X,Y,K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We,Je,Ze){let ht=22*e,Ye=44*e,tt=88*e;return this.float32[ht+0]=n,this.float32[ht+1]=a,this.int16[Ye+4]=c,this.int16[Ye+5]=d,this.int16[Ye+6]=f,this.int16[Ye+7]=_,this.int16[Ye+8]=y,this.int16[Ye+9]=b,this.int16[Ye+10]=T,this.int16[Ye+11]=S,this.int16[Ye+12]=D,this.uint16[Ye+13]=R,this.uint16[Ye+14]=O,this.uint16[Ye+15]=F,this.uint16[Ye+16]=z,this.uint16[Ye+17]=j,this.uint16[Ye+18]=X,this.uint16[Ye+19]=Y,this.uint16[Ye+20]=K,this.uint16[Ye+21]=le,this.uint16[Ye+22]=se,this.uint16[Ye+23]=pe,this.uint16[Ye+24]=_e,this.uint16[Ye+25]=Ee,this.uint16[Ye+26]=Oe,this.uint16[Ye+27]=De,this.uint32[ht+14]=Ne,this.float32[ht+15]=Xe,this.float32[ht+16]=Le,this.float32[ht+17]=qe,this.float32[ht+18]=ke,this.float32[ht+19]=We,this.float32[ht+20]=Je,this.uint8[tt+84]=Ze,e}}$1.prototype.bytesPerElement=88,J($1,"StructArrayLayout2f9i15ui1ul6f1ub88");class zu extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c,d)}emplace(e,n,a,c,d,f){let _=5*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=c,this.float32[_+3]=d,this.float32[_+4]=f,e}}zu.prototype.bytesPerElement=20,J(zu,"StructArrayLayout5f20");class G1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,d,f,_)}emplace(e,n,a,c,d,f,_,y){let b=7*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=c,this.float32[b+3]=d,this.float32[b+4]=f,this.float32[b+5]=_,this.float32[b+6]=y,e}}G1.prototype.bytesPerElement=28,J(G1,"StructArrayLayout7f28");class Dd extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=a,e}}Dd.prototype.bytesPerElement=8,J(Dd,"StructArrayLayout2f8");class H1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,c)}emplace(e,n,a,c,d){let f=6*e;return this.uint32[3*e+0]=n,this.uint16[f+2]=a,this.uint16[f+3]=c,this.uint16[f+4]=d,e}}H1.prototype.bytesPerElement=12,J(H1,"StructArrayLayout1ul3ui12");class fm extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}fm.prototype.bytesPerElement=2,J(fm,"StructArrayLayout1ui2");class q1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z){let j=this.length;return this.resize(j+1),this.emplace(j,e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z)}emplace(e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j){let X=16*e;return this.float32[X+0]=n,this.float32[X+1]=a,this.float32[X+2]=c,this.float32[X+3]=d,this.float32[X+4]=f,this.float32[X+5]=_,this.float32[X+6]=y,this.float32[X+7]=b,this.float32[X+8]=T,this.float32[X+9]=S,this.float32[X+10]=D,this.float32[X+11]=R,this.float32[X+12]=O,this.float32[X+13]=F,this.float32[X+14]=z,this.float32[X+15]=j,e}}q1.prototype.bytesPerElement=64,J(q1,"StructArrayLayout16f64");class Ty extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,d,f,_)}emplace(e,n,a,c,d,f,_,y){let b=10*e,T=5*e;return this.uint16[b+0]=n,this.uint16[b+1]=a,this.uint16[b+2]=c,this.uint16[b+3]=d,this.float32[T+2]=f,this.float32[T+3]=_,this.float32[T+4]=y,e}}Ty.prototype.bytesPerElement=20,J(Ty,"StructArrayLayout4ui3f20");class W1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}W1.prototype.bytesPerElement=2,J(W1,"StructArrayLayout1i2");class Z1 extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Z1.prototype.bytesPerElement=1,J(Z1,"StructArrayLayout1ub1");class XS extends vy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}XS.prototype.size=40;class X1 extends B1{get(e){return new XS(this,e)}}J(X1,"CollisionBoxArray");class YS extends vy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}YS.prototype.size=60;class KS extends U1{get(e){return new YS(this,e)}}J(KS,"PlacedSymbolArray");class QS extends vy{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}QS.prototype.size=88;class JS extends $1{get(e){return new QS(this,e)}}J(JS,"SymbolInstanceArray");class eI extends Nu{getoffsetX(e){return this.float32[1*e+0]}}J(eI,"GlyphOffsetArray");class tI extends ds{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}J(tI,"SymbolLineVertexArray");class nI extends vy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nI.prototype.size=12;class rI extends H1{get(e){return new nI(this,e)}}J(rI,"FeatureIndexArray");class iI extends nc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}J(iI,"FillExtrusionCentroidArray");let VN=In([{name:"a_pos",components:2,type:"Int16"}],4),jN=In([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class cr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,c){let d=this.segments[this.segments.length-1];return e>cr.MAX_VERTEX_ARRAY_LENGTH&&wr(`Max vertices per segment is ${cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>cr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}prepareSegment(e,n,a,c){return this._prepareSegment(e,n.length,a.length,c)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,c){return new cr([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function oI(t,e){return 256*(t=Qt(Math.floor(t),0,255))+Qt(Math.floor(e),0,255)}cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,J(cr,"SegmentVector");let UN=In([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),$N=In([{name:"a_dash",components:4,type:"Uint16"}]);class pm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,c){this.ids.push(sI(e)),this.positions.push(n,a,c)}eachPosition(e,n){let a=sI(e),c=0,d=this.ids.length-1;for(;c<d;){let f=c+d>>1;this.ids[f]>=a?d=f:c=f+1}for(;this.ids[c]===a;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){let a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Y1(a,c,0,a.length-1),n&&(n.add(a.buffer),n.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){let n=new pm,a;n.ids=e.ids,n.positions=e.positions;for(let c of n.ids)c!==a&&n.uniqueIds.push(c),a=c;return n.indexed=!0,n}}function sI(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Nl(String(t))}function Y1(t,e,n,a){for(;n<a;){let c=t[n+a>>1],d=n-1,f=a+1;for(;;){do d++;while(t[d]<c);do f--;while(t[f]>c);if(d>=f)break;Cy(t,d,f),Cy(e,3*d,3*f),Cy(e,3*d+1,3*f+1),Cy(e,3*d+2,3*f+2)}f-n<a-f?(Y1(t,e,n,f),n=f+1):(Y1(t,e,f+1,a),a=f)}}function Cy(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}J(pm,"FeaturePositionMap");class qa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Sy extends qa{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class zi extends qa{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Wa extends qa{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class K1 extends qa{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Q1 extends qa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class aI extends qa{constructor(e){super(e),this.current=bn.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let GN=new Float32Array(16);class mm extends qa{constructor(e){super(e),this.current=GN}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let HN=new Float32Array(9),qN=new Float32Array(4);class J1 extends qa{constructor(e){super(e),this.current=qN}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function eb(t){return[oI(255*t.r,255*t.g),oI(255*t.b,255*t.a)]}class gm{constructor(e,n,a,c){this.value=e,this.uniformNames=n.map(d=>`u_${d}`),this.type=a,this.context=c}setUniform(e,n,a,c,d){let f=c.constantOr(this.value);n.set(e,d,f instanceof bn?f.toRenderColor(this.context.lut):f)}getBinding(e,n){return this.type==="color"?new aI(e):new zi(e)}}class Md{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,c,d){let f=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;f&&n.set(e,d,f)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Q1(e):new zi(e)}}class Za{constructor(e,n,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,a,c,d,f,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new Bt(0,{brightness:f}),n,{},d,c,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b,this.context)}updatePaintArray(e,n,a,c,d,f,_){let y=this.expression.evaluate({zoom:0,brightness:_},a,c,void 0,d);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,a,c){if(this.type==="color"){let d=eb(a.toRenderColor(c.lut));for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fs{constructor(e,n,a,c,d,f){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=c,this.context=d,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,a,c,d,f,_){let y=this.expression.evaluate(new Bt(this.context.zoom,{brightness:f}),n,{},d,c,_),b=this.expression.evaluate(new Bt(this.context.zoom+1,{brightness:f}),n,{},d,c,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,b,this.context)}updatePaintArray(e,n,a,c,d,f,_){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:_},a,c,void 0,d),b=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},a,c,void 0,d);this._setPaintValue(e,n,y,b,this.context)}_setPaintValue(e,n,a,c,d){if(this.type==="color"){let f=eb(a.toRenderColor(d.lut)),_=eb(a.toRenderColor(d.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],_[0],_[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,c,d){let f=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=Qt(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);n.set(e,d,_)}getBinding(e,n){return new zi(e)}}class rc{constructor(e,n,a,c,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?$N:UN).members;for(let f=0;f<n.length;++f);this.paintVertexArray=new c}populatePaintArray(e,n,a,c){let d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,c,d,f,_){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,n,a,c){if(!c||!a)return;let d=c[a];if(!d)return;let{tl:f,br:_,pixelRatio:y}=d;for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,f[0],f[1],_[0],_[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bu{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;let c=[];for(let d in e.paint._values){let f=e.paint.get(d);if(!a(d)||!(f instanceof Jn&&Cd(f.property.specification)))continue;let _=ZN(d,e.type),y=f.value,b=f.property.specification.type,T=!!f.property.useIntegerZoom,S=d==="line-dasharray"||d.endsWith("pattern"),D=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||D)if(y.kind==="source"||D||S){let R=lI(d,b,"source");this.binders[d]=S?new rc(y,_,b,R,e.id):new Za(y,_,b,R),c.push(`/a_${d}`)}else{let R=lI(d,b,"composite");this.binders[d]=new fs(y,_,b,T,n,R),c.push(`/z_${d}`)}else this.binders[d]=S?new Md(y.value,_):new gm(y.value,_,b,n),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Za||n instanceof fs?n.maxValue:0}populatePaintArrays(e,n,a,c,d,f,_){for(let y in this.binders){let b=this.binders[y];b.context=this.context,(b instanceof Za||b instanceof fs||b instanceof rc)&&b.populatePaintArray(e,n,a,c,d,f,_)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof Md&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,c,d,f,_,y){let b=!1,T=Object.keys(e),S=T.length!==0,D=S?T:n.uniqueIds;this.context.lut=d.lut;for(let R in this.binders){let O=this.binders[R];if(O.context=this.context,(O instanceof Za||O instanceof fs||O instanceof rc)&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){let F=d.paint.get(R);O.expression=F.value;for(let z of D){let j=e[z.toString()];n.eachPosition(z,(X,Y,K)=>{let le=c.feature(X);O.updatePaintArray(Y,K,le,j,f,_,y)})}if(!S)for(let z of a.uniqueIds){let j=e[z.toString()];a.eachPosition(z,(X,Y,K)=>{let le=c.feature(X);O.updatePaintArray(Y,K,le,j,f,_,y)})}b=!0}}return b}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof gm||a instanceof Md)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Za||a instanceof fs||a instanceof rc)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof gm||a instanceof Md||a instanceof fs)for(let c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let c=this.binders[a];if(c instanceof gm||c instanceof Md||c instanceof fs)for(let d of c.uniformNames)n.push({name:d,property:a,binding:c.getBinding(e,d)})}return n}setUniforms(e,n,a,c,d){for(let{name:f,property:_,binding:y}of a)this.binders[_].setUniform(e,y,d,c.get(_),f)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Za||n instanceof fs||n instanceof rc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof Za||a instanceof fs||a instanceof rc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Za||n instanceof fs||n instanceof rc)&&n.destroy()}}}class ic{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new Bu(c,n,a);this.needsUpload=!1,this._featureMap=new pm,this._featureMapWithoutIds=new pm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,c,d,f,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,c,d,f,_,y);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,c,d,f){for(let _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,_,c,d,f||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let WN={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function ZN(t,e){return WN[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let XN={"line-pattern":{source:tc,composite:tc},"fill-pattern":{source:tc,composite:tc},"fill-extrusion-pattern":{source:tc,composite:tc},"line-dasharray":{source:by,composite:by}},YN={color:{source:Dd,composite:Jl},number:{source:Nu,composite:Dd}};function lI(t,e,n){let a=XN[t];return a&&a[n]||YN[e][n]}J(gm,"ConstantBinder"),J(Md,"PatternConstantBinder"),J(Za,"SourceExpressionBinder"),J(rc,"PatternCompositeBinder"),J(fs,"CompositeExpressionBinder"),J(Bu,"ProgramConfiguration",{omit:["_buffers"]}),J(ic,"ProgramConfigurationSet");let Bi=it/Math.PI/2,tb=5,cI=6,KN=16383,Ad=64,nb=[Ad,32,16],qo=-Bi,Wo=Bi;function Pd(t,e,n,a=Bi){return n=ln(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function Vu(t,e,n){return Pd(Math.cos(ln(t)),Math.sin(ln(t)),e,n)}let Rd=63710088e-1,rb=2*Math.PI*Rd;class yn{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yn(Aa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,c=e.lat*n,d=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Rd*Math.acos(Math.min(d,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new oc({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return Vu(this.lat,this.lng,Bi+e*Bi/Rd)}static convert(e){if(e instanceof yn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new yn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new yn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class oc{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof yn?new yn(e.lng,e.lat):yn.convert(e),this}setSouthWest(e){return this._sw=e instanceof yn?new yn(e.lng,e.lat):yn.convert(e),this}extend(e){let n=this._sw,a=this._ne,c,d;if(e instanceof yn)c=e,d=e;else{if(!(e instanceof oc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(oc.convert(e)):this.extend(yn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(yn.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new yn(c.lng,c.lat),this._ne=new yn(d.lng,d.lat)),this}getCenter(){return new yn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new yn(this.getWest(),this.getNorth())}getSouthEast(){return new yn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=yn.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof oc?e:new oc(e)}}var uI={};(function(t,e){(function(n){function a(d,f,_){var y=c(256*d,256*(f=Math.pow(2,_)-f-1),_),b=c(256*(d+1),256*(f+1),_);return y[0]+","+y[1]+","+b[0]+","+b[1]}function c(d,f,_){var y=2*Math.PI*6378137/256/Math.pow(2,_);return[d*y-2*Math.PI*6378137/2,f*y-2*Math.PI*6378137/2]}n.getURL=function(d,f,_,y,b,T){return T=T||{},d+"?"+["bbox="+a(_,y,b),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+f].join("&")},n.getTileBBox=a,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,uI);var QN=uI;class ju{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=_m(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=QN.getTileBBox(this.x,this.y,this.z),c=function(d,f,_){let y,b="";for(let T=d;T>0;T--)y=1<<T-1,b+=(f&y?1:0)+(_&y?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hI{constructor(e,n){this.wrap=e,this.canonical=n,this.key=_m(e,n.z,n.z,n.x,n.y)}}class Fr{constructor(e,n,a,c,d){this.overscaledZ=e,this.wrap=n,this.canonical=new ju(a,+c,+d),this.key=n===0&&e===a?this.canonical.key:_m(n,e,a,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Fr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return _m(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return _m(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Fr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Fr(n,this.wrap,n,a,c),new Fr(n,this.wrap,n,a+1,c),new Fr(n,this.wrap,n,a,c+1),new Fr(n,this.wrap,n,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Fr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Fr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hI(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _m(t,e,n,a,c){let d=1<<Math.min(n,22),f=d*(c%d)+a%d;return t&&n<22&&(f+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*f+n)+(e-n)}let JN=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Fr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Fr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Fr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Fr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];J(ju,"CanonicalTileID"),J(Fr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let e3=0,t3=25.5;function ib(t){return rb*Math.cos(t*Math.PI/180)}function Ys(t){return(180+t)/360}function Ks(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Vi(t,e){return t/ib(e)}function Wi(t){return 360*t-180}function Jr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function dI(t,e){return t*ib(Jr(e))}let Tr=85.051129;function fI(t){return Math.cos(ln(Qt(t,-Tr,Tr)))}function Uu(t,e){let n=Qt(e,e3,t3),a=Math.pow(2,n);return fI(t)*rb/(512*a)}function pI(t){return 1/Math.cos(t*Math.PI/180)}function Iy(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/it)/(1<<t.z)*2));return 80150034*n/(n*n+1)/it/(1<<t.z)}class wi{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=yn.convert(e);return new wi(Ys(a.lng),Ks(a.lat),Vi(n,a.lat))}toLngLat(){return new yn(Wi(this.x),Jr(this.y))}toAltitude(){return dI(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/rb*pI(Jr(this.y))}}function ob(t,e,n,a,c,d,f,_,y){let b=(e+a)/2,T=(n+c)/2,S=new lt(b,T);_(S),function(D,R,O,F,z,j){let X=O-z,Y=F-j;return Math.abs((F-R)*X-(O-D)*Y)/Math.hypot(X,Y)}(S.x,S.y,d.x,d.y,f.x,f.y)>=y?(ob(t,e,n,b,T,d,S,_,y),ob(t,b,T,a,c,S,f,_,y)):t.push(f)}function mI(t,e,n){let a=t[0],c=a.x,d=a.y;e(a);let f=[a];for(let _=1;_<t.length;_++){let y=t[_],{x:b,y:T}=y;e(y),ob(f,c,d,b,T,a,y,e,n),c=b,d=T,a=y}return f}function sb(t,e,n,a){if(a(e,n)){let c=e.add(n)._mult(.5);sb(t,e,c,a),sb(t,c,n,a)}else t.push(n)}function n3(t,e){let n=t[0],a=[n];for(let c=1;c<t.length;c++){let d=t[c];sb(a,n,d,e),n=d}return a}let ab=Math.pow(2,14)-1,gI=-ab-1;function r3(t,e){let n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=Qt(n,gI,ab),t.y=Qt(a,gI,ab),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&wr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ps(t,e,n){let a=t.loadGeometry(),c=t.extent,d=it/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let f=1<<e.z,{scale:_,x:y,y:b,projection:T}=n,S=D=>{let R=Wi((e.x+D.x/c)/f),O=Jr((e.y+D.y/c)/f),F=T.project(R,O);D.x=(F.x*_-y)*c,D.y=(F.y*_-b)*c};for(let D=0;D<a.length;D++)if(t.type!==1)a[D]=mI(a[D],S,1);else{let R=[];for(let O of a[D])O.x<0||O.x>=c||O.y<0||O.y>=c||(S(O),R.push(O));a[D]=R}}for(let f of a)for(let _ of f)r3(_,d);return a}function Xa(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ps(t):[]}}function Dy(t,e,n,a,c){t.emplaceBack(2*e+(a+1)/2,2*n+(c+1)/2)}function My(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class lb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ds,this.indexArray=new Ur,this.segments=new cr,this.programConfigurations=new ic(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,c){let d=this.layers[0],f=[],_=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(let{feature:b,id:T,index:S,sourceLayerIndex:D}of e){let R=this.layers[0]._featureFilter.needGeometry,O=Xa(b,R);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),O,a))continue;let F=_?_.evaluate(O,{},a):void 0,z={id:T,properties:b.properties,type:b.type,sourceLayerIndex:D,index:S,geometry:R?O.geometry:ps(b,a,c),patterns:{},sortKey:F};f.push(z)}_&&f.sort((b,T)=>b.sortKey-T.sortKey);let y=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new wy,y=c.projection);for(let b of f){let{geometry:T,index:S,sourceLayerIndex:D}=b,R=e[S].feature;this.addFeature(b,T,S,n.availableImages,a,y,n.brightness),n.featureIndex.insert(R,T,S,D,this.index)}}update(e,n,a,c,d){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,a,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,VN.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,jN.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,c,d,f,_){for(let y of n)for(let b of y){let T=b.x,S=b.y;if(T<0||T>=it||S<0||S>=it)continue;if(f){let O=f.projectTilePoint(T,S,d),F=f.upVector(d,T,S),z=this.globeExtVertexArray;My(z,O,F),My(z,O,F),My(z,O,F),My(z,O,F)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=D.vertexLength;Dy(this.layoutVertexArray,T,S,-1,-1),Dy(this.layoutVertexArray,T,S,1,-1),Dy(this.layoutVertexArray,T,S,1,1),Dy(this.layoutVertexArray,T,S,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,d,_)}}function cb(t,e){for(let n=0;n<t.length;n++)if(sc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(sc(t,e[n]))return!0;return!!ub(t,e)}function i3(t,e,n){return!!sc(t,e)||!!hb(e,t,n)}function _I(t,e){if(t.length===1)return vI(e,t[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let c=0;c<a.length;c++)if(sc(t,a[c]))return!0}for(let n=0;n<t.length;n++)if(vI(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(ub(t,e[n]))return!0;return!1}function o3(t,e,n){if(t.length>1){if(ub(t,e))return!0;for(let a=0;a<e.length;a++)if(hb(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(hb(t[a],e,n))return!0;return!1}function ub(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let a=t[n],c=t[n+1];for(let d=0;d<e.length-1;d++)if(s3(a,c,e[d],e[d+1]))return!0}return!1}function s3(t,e,n,a){return jo(t,n,a)!==jo(e,n,a)&&jo(t,e,n)!==jo(t,e,a)}function hb(t,e,n){let a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(yI(t,e[c-1],e[c])<a)return!0;return!1}function yI(t,e,n){let a=e.distSqr(n);if(a===0)return t.distSqr(e);let c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function vI(t,e){let n,a,c,d=!1;for(let f=0;f<t.length;f++){n=t[f];for(let _=0,y=n.length-1;_<n.length;y=_++)a=n[_],c=n[y],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(d=!d)}return d}function sc(t,e){let n=!1;for(let a=0,c=t.length-1;a<t.length;c=a++){let d=t[a],f=t[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(n=!n)}return n}function xI(t,e,n,a,c){for(let f of t)if(e<=f.x&&n<=f.y&&a>=f.x&&c>=f.y)return!0;let d=[new lt(e,n),new lt(e,c),new lt(a,c),new lt(a,n)];if(t.length>2){for(let f of d)if(sc(t,f))return!0}for(let f=0;f<t.length-1;f++)if(a3(t[f],t[f+1],d))return!0;return!1}function a3(t,e,n){let a=n[0],c=n[2];if(t.x<a.x&&e.x<a.x||t.x>c.x&&e.x>c.x||t.y<a.y&&e.y<a.y||t.y>c.y&&e.y>c.y)return!1;let d=jo(t,e,n[0]);return d!==jo(t,e,n[1])||d!==jo(t,e,n[2])||d!==jo(t,e,n[3])}function Od(t,e,n,a,c,d){let f=e.y-t.y,_=t.x-e.x;if(d=d||0){let y=f*f+_*_;if(y===0)return!0;let b=Math.sqrt(y);f/=b,_/=b}return!((n.x-t.x)*f+(n.y-t.y)*_-d<0||(a.x-t.x)*f+(a.y-t.y)*_-d<0||(c.x-t.x)*f+(c.y-t.y)*_-d<0)}function db(t,e,n,a,c,d,f){return!(Od(t,e,a,c,d,f)||Od(e,n,a,c,d,f)||Od(n,t,a,c,d,f)||Od(a,c,t,e,n,f)||Od(c,d,t,e,n,f)||Od(d,a,t,e,n,f))}function kd(t,e,n){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Ay(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function bI(t,e,n,a,c){if(!e[0]&&!e[1])return t;let d=lt.convert(e)._mult(c);n==="viewport"&&d._rotate(-a);let f=[];for(let _=0;_<t.length;_++)f.push(t[_].sub(d));return f}function wI(t,e,n,a){let c=lt.convert(t)._mult(a);return e==="viewport"&&c._rotate(-n),c}J(lb,"CircleBucket",{omit:["layers"]});let l3=new Pn({"circle-sort-key":new ut(Te.layout_circle["circle-sort-key"]),visibility:new Be(Te.layout_circle.visibility)});var c3={paint:new Pn({"circle-radius":new ut(Te.paint_circle["circle-radius"]),"circle-color":new ut(Te.paint_circle["circle-color"]),"circle-blur":new ut(Te.paint_circle["circle-blur"]),"circle-opacity":new ut(Te.paint_circle["circle-opacity"]),"circle-translate":new Be(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Be(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Be(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Be(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(Te.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Be(Te.paint_circle["circle-emissive-strength"])}),layout:l3};class fb{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let c=r._.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;let d=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,n,a){if(r._.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[c,d,f]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],b=this.pos[2]-e[2],T=c*c+d*d+f*f,S=2*(_*c+y*d+b*f),D=S*S-4*T*(_*_+y*y+b*b-n*n);if(D<0){let R=Math.max(-S/2,0),O=_+c*R,F=y+d*R,z=b+f*R,j=Math.hypot(O,F,z);return a[0]=O*n/j,a[1]=F*n/j,a[2]=z*n/j,!1}{let R=(-S-Math.sqrt(D))/(2*T);if(R<0){let O=Math.hypot(_,y,b);return a[0]=_*n/O,a[1]=y*n/O,a[2]=b*n/O,!1}return a[0]=_+c*R,a[1]=y+d*R,a[2]=b+f*R,!0}}}class pb{constructor(e,n,a,c,d){this.TL=e,this.TR=n,this.BR=a,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,n,a){let c=[-1,1,1],d=[1,1,1],f=[1,-1,1],_=[-1,-1,1],y=r._.transformMat4(c,c,e),b=r._.transformMat4(d,d,e),T=r._.transformMat4(f,f,e),S=r._.transformMat4(_,_,e);return new pb(y,b,T,S,n/a)}}function ym(t,e,n){let a=1/0,c=-1/0,d=[];for(let f of t){r._.sub(d,f,e);let _=r._.dot(d,n);a=Math.min(a,_),c=Math.max(c,_)}return[a,c]}function EI(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){let c=t.planes[a],d=0;for(let f=0;f<e.length;f++)d+=r._.dot(c,e[f])+c[3]>=0;if(d===0)return 0;d!==e.length&&(n=!1)}return n?2:1}function TI(t,e){for(let n of t.projections){let a=ym(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function CI(t,e){let n=0,a=[0,0,0,0];for(let c=0;c<t.length;c++)a[0]=t[c][0],a[1]=t[c][1],a[2]=t[c][2],a[3]=1,r.aA.dot(a,e)>=0&&n++;return n}class mb{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=ur.fromPoints(this.points),this.projections=[],this.frustumEdges=[r._.sub([],this.points[2],this.points[3]),r._.sub([],this.points[0],this.points[3]),r._.sub([],this.points[4],this.points[0]),r._.sub([],this.points[5],this.points[1]),r._.sub([],this.points[6],this.points[2]),r._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let c=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:c,projection:ym(this.points,this.points[0],c)}),this.projections.push({axis:d,projection:ym(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,n,a,c){let d=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let T=r.aA.transformMat4([],b,e),S=1/T[3]/n*d;return r.aA.mul(T,T,[S,S,c?1/T[3]:S,S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let T=r._.sub([],f[b[0]],f[b[1]]),S=r._.sub([],f[b[2]],f[b[1]]),D=r._.normalize([],r._.cross([],T,S)),R=-r._.dot(D,f[b[1]]);return D.concat(R)}),y=[];for(let b=0;b<f.length;b++)y.push([f[b][0],f[b][1],f[b][2]]);return new mb(y,_)}intersectsPrecise(e,n,a){for(let c=0;c<n.length;c++)if(!CI(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!CI(e,this.planes[c]))return 0;for(let c of a)for(let d of this.frustumEdges){let f=r._.cross([],c,d),_=r._.length(f);if(_===0)continue;r._.scale(f,f,1/_);let y=ym(this.points,this.points[0],f),b=ym(e,this.points[0],f);if(y[0]>b[1]||b[0]>y[1])return 0}return 1}}class ur{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let c of e)r._.min(n,n,c),r._.max(a,a,c);return new ur(n,a)}static fromTileIdAndHeight(e,n,a){let c=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new ur([d/c,f/c,n],[(d+1)/c,(f+1)/c,a])}static applyTransform(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)r._.transformMat4(a[c],a[c],n);return ur.fromPoints(a)}static projectAabbCorners(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)r._.transformMat4(a[c],a[c],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=r._.scale([],r._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=r._.clone(this.min),c=r._.clone(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],c[d]=n[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new ur(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?EI(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?EI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?TI(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?TI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}J(ur,"Aabb");let u3=In([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Py}=u3,SI=In([{name:"a_pos_3",components:3,type:"Int16"}]);var vm=In([{name:"a_pos",type:"Int16",components:2}]);function Ry(t){return t*Bi/Rd}let h3=[new ur([qo,qo,qo],[Wo,Wo,Wo]),new ur([qo,qo,qo],[0,0,Wo]),new ur([0,qo,qo],[Wo,0,Wo]),new ur([qo,0,qo],[0,Wo,Wo]),new ur([0,0,qo],[Wo,Wo,Wo])];function II(t,e,n,a=!0){let c=r._.scale([],t._camera.position,t.worldSize),d=[e,n,1,1];r.aA.transformMat4(d,d,t.pixelMatrixInverse),r.aA.scale(d,d,1/d[3]);let f=r._.sub([],d,c),_=r._.normalize([],f),y=t.globeMatrix,b=[y[12],y[13],y[14]],T=r._.sub([],b,c),S=r._.length(T),D=r._.normalize([],T),R=t.worldSize/(2*Math.PI),O=r._.dot(D,_),F=Math.asin(R/S);if(F<Math.acos(O)){if(!a)return null;let De=[],Ne=[];r._.scale(De,_,S/O),r._.normalize(Ne,r._.sub(Ne,De,T)),r._.normalize(_,r._.add(_,T,r._.scale(_,Ne,Math.tan(F)*S)))}let z=[];new fb(c,_).closestPointOnSphere(b,R,z);let j=r._.normalize([],su(y,0)),X=r._.normalize([],su(y,1)),Y=r._.normalize([],su(y,2)),K=r._.dot(j,z),le=r._.dot(X,z),se=r._.dot(Y,z),pe=ai(Math.asin(-le/R)),_e=ai(Math.atan2(K,se));_e=t.center.lng+function(De,Ne){let Xe=(Ne-De+180)%360-180;return Xe<-180?Xe+360:Xe}(t.center.lng,_e);let Ee=Ys(_e),Oe=Qt(Ks(pe),0,1);return new wi(Ee,Oe)}class d3{constructor(e,n,a){this.a=r._.sub([],e,a),this.b=r._.sub([],n,a),this.center=a;let c=r._.normalize([],this.a),d=r._.normalize([],this.b);this.angle=Math.acos(r._.dot(c,d))}}function gb(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,c,d,f){let _=Math.sin(d);return a*(Math.sin((1-f)*d)/_)+c*(Math.sin(f*d)/_)}(t.a[e],t.b[e],t.angle,Qt(n,0,1))+t.center[e]}function Qs(t){if(t.z<=1)return h3[t.z+2*t.y+t.x];let e=_b(Oy(t));return ur.fromPoints(e)}function Ya(t,e,n){return r._.scale(t,t,1-n),r._.scaleAndAdd(t,t,e,n)}function DI(t,e){let n=Ka(e.zoom);if(n===0)return Qs(t);let a=Oy(t),c=_b(a),d=Ys(a.getWest())*e.worldSize,f=Ys(a.getEast())*e.worldSize,_=Ks(a.getNorth())*e.worldSize,y=Ks(a.getSouth())*e.worldSize,b=[d,_,0],T=[f,_,0],S=[d,y,0],D=[f,y,0],R=r.ad.invert([],e.globeMatrix);return r._.transformMat4(b,b,R),r._.transformMat4(T,T,R),r._.transformMat4(S,S,R),r._.transformMat4(D,D,R),c[0]=Ya(c[0],S,n),c[1]=Ya(c[1],D,n),c[2]=Ya(c[2],T,n),c[3]=Ya(c[3],b,n),ur.fromPoints(c)}function MI(t,e,n){for(let a of t)r._.transformMat4(a,a,e),r._.scale(a,a,n)}function AI(t,e,n,a){let c=e/t.worldSize,d=t.globeMatrix;if(n.z<=1){let Ee=Qs(n).getCorners();return MI(Ee,d,c),ur.fromPoints(Ee)}let f=Oy(n,a),_=_b(f,Bi+Ry(t._tileCoverLift));MI(_,d,c);let y=Number.MAX_VALUE,b=[-y,-y,-y],T=[y,y,y];if(f.contains(t.center)){for(let De of _)r._.min(T,T,De),r._.max(b,b,De);b[2]=0;let Ee=t.point,Oe=[Ee.x*c,Ee.y*c,0];return r._.min(T,T,Oe),r._.max(b,b,Oe),new ur(T,b)}if(t._tileCoverLift>0){for(let Ee of _)r._.min(T,T,Ee),r._.max(b,b,Ee);return new ur(T,b)}let S=[d[12]*c,d[13]*c,d[14]*c],D=f.getCenter(),R=Qt(t.center.lat,-Tr,Tr),O=Qt(D.lat,-Tr,Tr),F=Ys(t.center.lng),z=Ks(R),j=F-Ys(D.lng),X=z-Ks(O);j>.5?j-=1:j<-.5&&(j+=1);let Y=0;if(Math.abs(j)>Math.abs(X))Y=j>=0?1:3;else{Y=X>=0?0:2;let Ee=[d[4]*c,d[5]*c,d[6]*c],Oe=-Math.sin(ln(X>=0?f.getSouth():f.getNorth()))*Bi;r._.scaleAndAdd(S,S,Ee,Oe)}let K=_[Y],le=_[(Y+1)%4],se=new d3(K,le,S),pe=[gb(se,0)||K[0],gb(se,1)||K[1],gb(se,2)||K[2]],_e=Ka(t.zoom);if(_e>0){let Ee=function({x:De,y:Ne,z:Xe},Le,qe,ke,We){let Je=1/(1<<Xe),Ze=De*Je,ht=Ze+Je,Ye=Ne*Je,tt=Ye+Je,Et=0,yt=(Ze+ht)/2-ke;return yt>.5?Et=-1:yt<-.5&&(Et=1),Ze=((Ze+Et)*Le-(ke*=Le))*qe+ke,ht=((ht+Et)*Le-ke)*qe+ke,Ye=(Ye*Le-(We*=Le))*qe+We,tt=(tt*Le-We)*qe+We,[[Ze,tt,0],[ht,tt,0],[ht,Ye,0],[Ze,Ye,0]]}(n,e,t._pixelsPerMercatorPixel,F,z);for(let De=0;De<_.length;De++)Ya(_[De],Ee[De],_e);let Oe=r._.add([],Ee[Y],Ee[(Y+1)%4]);r._.scale(Oe,Oe,.5),Ya(pe,Oe,_e)}for(let Ee of _)r._.min(T,T,Ee),r._.max(b,b,Ee);return T[2]=Math.min(K[2],le[2]),r._.min(T,T,pe),r._.max(b,b,pe),new ur(T,b)}function Oy({x:t,y:e,z:n},a=!1){let c=1/(1<<n),d=new yn(Wi(t*c),e===(1<<n)-1&&a?-90:Jr((e+1)*c)),f=new yn(Wi((t+1)*c),e===0&&a?90:Jr(e*c));return new oc(d,f)}function _b(t,e=Bi){let n=ln(t.getNorth()),a=ln(t.getSouth()),c=Math.cos(n),d=Math.cos(a),f=Math.sin(n),_=Math.sin(a),y=t.getWest(),b=t.getEast();return[Pd(d,_,y,e),Pd(d,_,b,e),Pd(c,f,b,e),Pd(c,f,y,e)]}function xm(t,e,n,a){let c=1<<n.z,d=(t/it+n.x)/c;return Vu(Jr((e/it+n.y)/c),Wi(d),a)}function ky({min:t,max:e}){return KN/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let PI=new Float64Array(16);function bm(t){let e=ky(t),n=r.ad.fromScaling(PI,[e,e,e]);return r.ad.translate(n,n,r._.negate([],t.min))}function yb(t){let e=r.ad.fromTranslation(PI,t.min),n=1/ky(t);return r.ad.scale(e,e,[n,n,n])}function vb(t){let e=it/(2*Math.PI);return t/(2*Math.PI)/e}function RI(t,e){return it/(512*Math.pow(2,t))*ky(Qs(e))}function OI(t,e,n,a,c){let d=vb(n),f=[t,e,-n/(2*Math.PI)],_=r.ad.identity(new Float64Array(16));return r.ad.translate(_,_,f),r.ad.scale(_,_,[d,d,d]),r.ad.rotateX(_,_,ln(-c)),r.ad.rotateY(_,_,ln(-a)),_}function Ka(t){return Ma(tb,cI,t)}function kI(t,e){let n=Vu(e.lat,e.lng),a=function(d){let f=Vu(d._center.lat,d._center.lng),_=r._.fromValues(0,1,0),y=r._.cross([],_,f),b=r.ad.fromRotation([],-d.angle,f);y=r._.transformMat4(y,y,b),r.ad.fromRotation(b,-d._pitch,y);let T=r._.normalize([],f);return r._.scale(T,T,Ry(d.cameraToCenterDistance/d.pixelsPerMeter)),r._.transformMat4(T,T,b),r._.add([],f,T)}(t),c=r._.subtract([],a,n);return r._.angle(c,n)}function xb(t,e){return kI(t,e)>Math.PI/2*1.01}let LI=ln(85),f3=Math.cos(LI),p3=Math.sin(LI),m3=r.ad.create(),FI=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function NI(t,e,n,a,c,d,f,_,y){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(y*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,T=n.projection.upVectorScale(b,n.center.lat,n.worldSize).metersToTile;for(let S of e)for(let D of S){let R=D.add(_),O=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(R.x,R.y,!0):0,F=n.projection.projectTilePoint(R.x,R.y,b);if(O>0){let Y=n.projection.upVector(b,R.x,R.y);F.x+=Y[0]*T*O,F.y+=Y[1]*T*O,F.z+=Y[2]*T*O}let z=d?R:g3(F.x,F.y,F.z,a),j=d?t.tilespaceRays.map(Y=>y3(Y,O)):t.queryGeometry.screenGeometry,X=r.aA.transformMat4([],[F.x,F.y,F.z,1],a);if(!f&&d?y*=X[3]/n.cameraToCenterDistance:f&&!d&&(y*=n.cameraToCenterDistance/X[3]),d){let Y=Jr((D.y/it+b.y)/(1<<b.z));y/=n.projection.pixelsPerMeter(Y,1)/Vi(1,Y)}if(i3(j,z,y))return!0}return!1}function g3(t,e,n,a){let c=r.aA.transformMat4([],[t,e,n,1],a);return new lt(c[0]/c[3],c[1]/c[3])}let zI=r._.fromValues(0,0,0),_3=r._.fromValues(0,0,1);function y3(t,e){let n=r._.create();return zI[2]=e,t.intersectsPlane(zI,_3,n),new lt(n[0],n[1])}class BI extends lb{}function VI(t,{width:e,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=c,t}function jI(t,e,n){let{width:a,height:c}=e;a===t.width&&c===t.height||(bb(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,c)},n,null),t.width=a,t.height=c,t.data=e.data)}function bb(t,e,n,a,c,d,f,_){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,b=e.data,T=d===4&&_;for(let S=0;S<c.height;S++){let D=((n.y+S)*t.width+n.x)*d,R=((a.y+S)*e.width+a.x)*d;if(T)for(let O=0;O<c.width;O++){let F=D+O*d+3,z=R+O*d;b[z+0]=255,b[z+1]=255,b[z+2]=255,b[z+3]=y[F]}else if(f)for(let O=0;O<c.width;O++){let F=D+O*d,z=R+O*d,j=y[F+3],X=new bn(y[F+0]/255*j,y[F+1]/255*j,y[F+2]/255*j,j).toRenderColor(f).toArray();b[z+0]=X[0],b[z+1]=X[1],b[z+2]=X[2],b[z+3]=X[3]}else for(let O=0;O<c.width*d;O++)b[R+O]=y[D+O]}return e}J(BI,"HeatmapBucket",{omit:["layers"]});class ac{constructor(e,n){VI(this,e,1,n)}resize(e){jI(this,new ac(e),1)}clone(){return new ac({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,d){bb(e,n,a,c,d,1,null)}}class Co{constructor(e,n){VI(this,e,4,n)}resize(e){jI(this,new Co(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Co({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,d,f,_){bb(e,n,a,c,d,4,f,_)}}class UI{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}J(ac,"AlphaImage"),J(Co,"RGBAImage");let v3=new Pn({visibility:new Be(Te.layout_heatmap.visibility)});var x3={paint:new Pn({"heatmap-radius":new ut(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Be(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Lr(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Be(Te.paint_heatmap["heatmap-opacity"])}),layout:v3};function wm(t){let e={},n=t.resolution||256,a=t.clips?t.clips.length:1,c=t.image||new Co({width:n,height:a}),d=(f,_,y)=>{e[t.evaluationKey]=y;let b=t.expression.evaluate(e);b&&(c.data[f+_+0]=Math.floor(255*b.r/b.a),c.data[f+_+1]=Math.floor(255*b.g/b.a),c.data[f+_+2]=Math.floor(255*b.b/b.a),c.data[f+_+3]=Math.floor(255*b.a))};if(t.clips)for(let f=0,_=0;f<a;++f,_+=4*n)for(let y=0,b=0;y<n;y++,b+=4){let T=y/(n-1),{start:S,end:D}=t.clips[f];d(_,b,S*(1-T)+D*T)}else for(let f=0,_=0;f<n;f++,_+=4)d(0,_,f/(n-1));return c}let b3=new Pn({visibility:new Be(Te.layout_hillshade.visibility)});var w3={paint:new Pn({"hillshade-illumination-direction":new Be(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Be(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Be(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Be(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Be(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Be(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Be(Te.paint_hillshade["hillshade-emissive-strength"])}),layout:b3};let E3=In([{name:"a_pos",components:2,type:"Int16"}],4),{members:T3}=E3;function Em(t,e,n=2){let a=e&&e.length,c=a?e[0]*n:t.length,d=$I(t,0,c,n,!0),f=[];if(!d||d.next===d.prev)return f;let _,y,b;if(a&&(d=function(T,S,D,R){let O=[];for(let F=0,z=S.length;F<z;F++){let j=$I(T,S[F]*R,F<z-1?S[F+1]*R:T.length,R,!1);j===j.next&&(j.steiner=!0),O.push(R3(j))}O.sort(M3);for(let F=0;F<O.length;F++)D=A3(O[F],D);return D}(t,e,d,n)),t.length>80*n){_=1/0,y=1/0;let T=-1/0,S=-1/0;for(let D=n;D<c;D+=n){let R=t[D],O=t[D+1];R<_&&(_=R),O<y&&(y=O),R>T&&(T=R),O>S&&(S=O)}b=Math.max(T-_,S-y),b=b!==0?32767/b:0}return Tm(d,f,n,_,y,b,0),f}function $I(t,e,n,a,c){let d;if(c===function(f,_,y,b){let T=0;for(let S=_,D=y-b;S<y;S+=b)T+=(f[D]-f[S])*(f[S+1]+f[D+1]),D=S;return T}(t,e,n,a)>0)for(let f=e;f<n;f+=a)d=qI(f/a|0,t[f],t[f+1],d);else for(let f=n-a;f>=e;f-=a)d=qI(f/a|0,t[f],t[f+1],d);return d&&Ly(d,d.next)&&(Sm(d),d=d.next),d}function $u(t,e){if(!t)return t;e||(e=t);let n,a=t;do if(n=!1,a.steiner||!Ly(a,a.next)&&Nr(a.prev,a,a.next)!==0)a=a.next;else{if(Sm(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function Tm(t,e,n,a,c,d,f){if(!t)return;!f&&d&&function(y,b,T,S){let D=y;do D.z===0&&(D.z=wb(D.x,D.y,b,T,S)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==y);D.prevZ.nextZ=null,D.prevZ=null,function(R){let O,F=1;do{let z,j=R;R=null;let X=null;for(O=0;j;){O++;let Y=j,K=0;for(let se=0;se<F&&(K++,Y=Y.nextZ,Y);se++);let le=F;for(;K>0||le>0&&Y;)K!==0&&(le===0||!Y||j.z<=Y.z)?(z=j,j=j.nextZ,K--):(z=Y,Y=Y.nextZ,le--),X?X.nextZ=z:R=z,z.prevZ=X,X=z;j=Y}X.nextZ=null,F*=2}while(O>1)}(D)}(t,a,c,d);let _=t;for(;t.prev!==t.next;){let y=t.prev,b=t.next;if(d?S3(t,a,c,d):C3(t))e.push(y.i,t.i,b.i),Sm(t),t=b.next,_=b.next;else if((t=b)===_){f?f===1?Tm(t=I3($u(t),e),e,n,a,c,d,2):f===2&&D3(t,e,n,a,c,d):Tm($u(t),e,n,a,c,d,1);break}}}function C3(t){let e=t.prev,n=t,a=t.next;if(Nr(e,n,a)>=0)return!1;let c=e.x,d=n.x,f=a.x,_=e.y,y=n.y,b=a.y,T=c<d?c<f?c:f:d<f?d:f,S=_<y?_<b?_:b:y<b?y:b,D=c>d?c>f?c:f:d>f?d:f,R=_>y?_>b?_:b:y>b?y:b,O=a.next;for(;O!==e;){if(O.x>=T&&O.x<=D&&O.y>=S&&O.y<=R&&Ld(c,_,d,y,f,b,O.x,O.y)&&Nr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function S3(t,e,n,a){let c=t.prev,d=t,f=t.next;if(Nr(c,d,f)>=0)return!1;let _=c.x,y=d.x,b=f.x,T=c.y,S=d.y,D=f.y,R=_<y?_<b?_:b:y<b?y:b,O=T<S?T<D?T:D:S<D?S:D,F=_>y?_>b?_:b:y>b?y:b,z=T>S?T>D?T:D:S>D?S:D,j=wb(R,O,e,n,a),X=wb(F,z,e,n,a),Y=t.prevZ,K=t.nextZ;for(;Y&&Y.z>=j&&K&&K.z<=X;){if(Y.x>=R&&Y.x<=F&&Y.y>=O&&Y.y<=z&&Y!==c&&Y!==f&&Ld(_,T,y,S,b,D,Y.x,Y.y)&&Nr(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,K.x>=R&&K.x<=F&&K.y>=O&&K.y<=z&&K!==c&&K!==f&&Ld(_,T,y,S,b,D,K.x,K.y)&&Nr(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;Y&&Y.z>=j;){if(Y.x>=R&&Y.x<=F&&Y.y>=O&&Y.y<=z&&Y!==c&&Y!==f&&Ld(_,T,y,S,b,D,Y.x,Y.y)&&Nr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;K&&K.z<=X;){if(K.x>=R&&K.x<=F&&K.y>=O&&K.y<=z&&K!==c&&K!==f&&Ld(_,T,y,S,b,D,K.x,K.y)&&Nr(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function I3(t,e){let n=t;do{let a=n.prev,c=n.next.next;!Ly(a,c)&&GI(a,n,n.next,c)&&Cm(a,c)&&Cm(c,a)&&(e.push(a.i,n.i,c.i),Sm(n),Sm(n.next),n=t=c),n=n.next}while(n!==t);return $u(n)}function D3(t,e,n,a,c,d){let f=t;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&O3(f,_)){let y=HI(f,_);return f=$u(f,f.next),y=$u(y,y.next),Tm(f,e,n,a,c,d,0),void Tm(y,e,n,a,c,d,0)}_=_.next}f=f.next}while(f!==t)}function M3(t,e){return t.x-e.x}function A3(t,e){let n=function(c,d){let f=d,_=c.x,y=c.y,b,T=-1/0;do{if(y<=f.y&&y>=f.next.y&&f.next.y!==f.y){let F=f.x+(y-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(F<=_&&F>T&&(T=F,b=f.x<f.next.x?f:f.next,F===_))return b}f=f.next}while(f!==d);if(!b)return null;let S=b,D=b.x,R=b.y,O=1/0;f=b;do{if(_>=f.x&&f.x>=D&&_!==f.x&&Ld(y<R?_:T,y,D,R,y<R?T:_,y,f.x,f.y)){let F=Math.abs(y-f.y)/(_-f.x);Cm(f,c)&&(F<O||F===O&&(f.x>b.x||f.x===b.x&&P3(b,f)))&&(b=f,O=F)}f=f.next}while(f!==S);return b}(t,e);if(!n)return e;let a=HI(n,t);return $u(a,a.next),$u(n,n.next)}function P3(t,e){return Nr(t.prev,t,e.prev)<0&&Nr(e.next,t,t.next)<0}function wb(t,e,n,a,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function R3(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ld(t,e,n,a,c,d,f,_){return(c-f)*(e-_)>=(t-f)*(d-_)&&(t-f)*(a-_)>=(n-f)*(e-_)&&(n-f)*(d-_)>=(c-f)*(a-_)}function O3(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&GI(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(Cm(t,e)&&Cm(e,t)&&function(n,a){let c=n,d=!1,f=(n.x+a.x)/2,_=(n.y+a.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&f<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==n);return d}(t,e)&&(Nr(t.prev,t,e.prev)||Nr(t,e.prev,e))||Ly(t,e)&&Nr(t.prev,t,t.next)>0&&Nr(e.prev,e,e.next)>0)}function Nr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ly(t,e){return t.x===e.x&&t.y===e.y}function GI(t,e,n,a){let c=Ny(Nr(t,e,n)),d=Ny(Nr(t,e,a)),f=Ny(Nr(n,a,t)),_=Ny(Nr(n,a,e));return c!==d&&f!==_||!(c!==0||!Fy(t,n,e))||!(d!==0||!Fy(t,a,e))||!(f!==0||!Fy(n,t,a))||!(_!==0||!Fy(n,e,a))}function Fy(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ny(t){return t>0?1:t<0?-1:0}function Cm(t,e){return Nr(t.prev,t,t.next)<0?Nr(t,e,t.next)>=0&&Nr(t,t.prev,e)>=0:Nr(t,e,t.prev)<0||Nr(t,t.next,e)<0}function HI(t,e){let n=Eb(t.i,t.x,t.y),a=Eb(e.i,e.x,e.y),c=t.next,d=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,a.next=n,n.prev=a,d.next=a,a.prev=d,a}function qI(t,e,n,a){let c=Eb(t,e,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Sm(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Eb(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function zy(t,e){let n=t.length;if(n<=1)return[t];let a=[],c,d;for(let f=0;f<n;f++){let _=vi(t[f]);_!==0&&(t[f].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(c&&a.push(c),c=[t[f]]):c.push(t[f]))}if(c&&a.push(c),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(b1(a[f],e,1,a[f].length-1,k3),a[f]=a[f].slice(0,e));return a}function k3(t,e){return e.area-t.area}function Tb(t,e,n){let a=n.patternDependencies,c=!1;for(let d of e){let f=d.paint.get(`${t}-pattern`);f.isConstant()||(c=!0);let _=f.constantOr(null);_&&(c=!0,a[_]=!0)}return c}function Cb(t,e,n,a,c){let d=c.patternDependencies;for(let f of e){let _=f.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:a},n,{},c.availableImages);y=y&&y.name?y.name:y,d[y]=!0,n.patterns[f.id]=y}}return n}class By{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ds,this.indexArray=new Ur,this.indexArray2=new nc,this.programConfigurations=new ic(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new cr,this.segments2=new cr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=Tb("fill",this.layers,n);let d=this.layers[0].layout.get("fill-sort-key"),f=[];for(let{feature:_,id:y,index:b,sourceLayerIndex:T}of e){let S=this.layers[0]._featureFilter.needGeometry,D=Xa(_,S);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),D,a))continue;let R=d?d.evaluate(D,{},a,n.availableImages):void 0,O={id:y,properties:_.properties,type:_.type,sourceLayerIndex:T,index:b,geometry:S?D.geometry:ps(_,a,c),patterns:{},sortKey:R};f.push(O)}d&&f.sort((_,y)=>_.sortKey-y.sortKey);for(let _ of f){let{geometry:y,index:b,sourceLayerIndex:T}=_;if(this.hasPattern){let S=Cb("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(S)}else this.addFeature(_,y,b,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,n,a,c,d){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,a,c,d)}addFeatures(e,n,a,c,d,f){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,T3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,c,d,f=[],_){for(let y of zy(n,500)){let b=0;for(let F of y)b+=F.length;let T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=T.vertexLength,D=[],R=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&R.push(D.length/2);let z=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),j=z.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(j+F.length-1,j),D.push(F[0].x),D.push(F[0].y);for(let X=1;X<F.length;X++)this.layoutVertexArray.emplaceBack(F[X].x,F[X].y),this.indexArray2.emplaceBack(j+X-1,j+X),D.push(F[X].x),D.push(F[X].y);z.vertexLength+=F.length,z.primitiveLength+=F.length}let O=Em(D,R);for(let F=0;F<O.length;F+=3)this.indexArray.emplaceBack(S+O[F],S+O[F+1],S+O[F+2]);T.vertexLength+=b,T.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,c,_)}}J(By,"FillBucket",{omit:["layers","patternFeatures"]});let L3=new Pn({"fill-sort-key":new ut(Te.layout_fill["fill-sort-key"]),visibility:new Be(Te.layout_fill.visibility)});var F3={paint:new Pn({"fill-antialias":new Be(Te.paint_fill["fill-antialias"]),"fill-opacity":new ut(Te.paint_fill["fill-opacity"]),"fill-color":new ut(Te.paint_fill["fill-color"]),"fill-outline-color":new ut(Te.paint_fill["fill-outline-color"]),"fill-translate":new Be(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Be(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new ut(Te.paint_fill["fill-pattern"]),"fill-emissive-strength":new Be(Te.paint_fill["fill-emissive-strength"])}),layout:L3};class Sb{constructor(e,n,a,c){if(this.triangleCount=n.length/3,this.min=new lt(0,0),this.max=new lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[d,f]=[e[0].clone(),e[0].clone()];for(let S=1;S<e.length;++S){let D=e[S];d.x=Math.min(d.x,D.x),d.y=Math.min(d.y,D.y),f.x=Math.max(f.x,D.x),f.y=Math.max(f.y,D.y)}if(c){let S=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/c);a=Math.max(a,S)}if(a===0)return;this.min=d,this.max=f;let _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);let y=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/y)),this.cellsY=Math.max(1,Math.ceil(_.y/y)),this.xScale=1/y,this.yScale=1/y;let b=[];for(let S=0;S<this.triangleCount;S++){let D=e[n[3*S+0]].sub(this.min),R=e[n[3*S+1]].sub(this.min),O=e[n[3*S+2]].sub(this.min),F=Js(Math.floor(Math.min(D.x,R.x,O.x)),this.xScale,this.cellsX),z=Js(Math.floor(Math.max(D.x,R.x,O.x)),this.xScale,this.cellsX),j=Js(Math.floor(Math.min(D.y,R.y,O.y)),this.yScale,this.cellsY),X=Js(Math.floor(Math.max(D.y,R.y,O.y)),this.yScale,this.cellsY),Y=new lt(0,0),K=new lt(0,0),le=new lt(0,0),se=new lt(0,0);for(let pe=j;pe<=X;++pe){Y.y=K.y=pe*y,le.y=se.y=(pe+1)*y;for(let _e=F;_e<=z;++_e)Y.x=le.x=_e*y,K.x=se.x=(_e+1)*y,(db(D,R,O,Y,K,se)||db(D,R,O,Y,se,le))&&b.push({cellIdx:pe*this.cellsX+_e,triIdx:S})}}if(b.length===0)return;b.sort((S,D)=>S.cellIdx-D.cellIdx||S.triIdx-D.triIdx);let T=0;for(;T<b.length;){let S=b[T].cellIdx,D={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===S;)++D.len,this.payload.push(b[T++].triIdx);this.cells[S]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=Js(e.x-this.min.x,this.xScale,this.cellsX),c=Js(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[c*this.cellsX+a];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){let _=this.payload[d.start+f],y=Math.floor(_/8),b=1<<_%8;if(!(this.lookup[y]&b)&&(this.lookup[y]|=b,n.push(_),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let c=Js(e.x-this.min.x,this.xScale,this.cellsX),d=Js(n.x-this.min.x,this.xScale,this.cellsX),f=Js(e.y-this.min.y,this.yScale,this.cellsY),_=Js(n.y-this.min.y,this.yScale,this.cellsY);for(let y=f;y<=_;y++)for(let b=c;b<=d;b++){let T=this.cells[y*this.cellsX+b];if(T)for(let S=0;S<T.len;S++){let D=this.payload[T.start+S],R=Math.floor(D/8),O=1<<D%8;if(!(this.lookup[R]&O)&&(this.lookup[R]|=O,a.push(D),a.length===this.triangleCount))return}}}}function Js(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}J(Sb,"TriangleGridIndex");class WI{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,c){let d=[];for(let{feature:f,id:_,index:y,sourceLayerIndex:b}of e){let T=this.layers[0]._featureFilter.needGeometry,S=Xa(f,T);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),S,a))continue;let D={id:_,properties:f.properties,type:f.type,sourceLayerIndex:b,index:y,geometry:T?S.geometry:ps(f,a,c),patterns:{}};d.push(D)}for(let f of d){let{geometry:_,index:y,sourceLayerIndex:b}=f;this.addFeature(f,_,y,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,_,y,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,c,d){}destroy(){}addFeature(e,n,a,c,d,f=[],_){for(let y of zy(n,2)){let b=[],T=[],S=[],D=new lt(1/0,1/0),R=new lt(-1/0,-1/0);for(let z of y)if(z.length!==0){z!==y[0]&&S.push(T.length/2);for(let j=0;j<z.length;j++)T.push(z[j].x),T.push(z[j].y),b.push(z[j]),D.x=Math.min(D.x,z[j].x),D.y=Math.min(D.y,z[j].y),R.x=Math.max(R.x,z[j].x),R.y=Math.max(R.y,z[j].y)}let O=Em(T,S),F=new Sb(b,O,8,256);this.footprints.push({vertices:b,indices:O,grid:F,min:D,max:R})}}}J(WI,"ClipBucket",{omit:["layers"]});let N3=new Pn({"clip-layer-types":new Be(Te.layout_clip["clip-layer-types"])});var z3={paint:new Pn({}),layout:N3};let B3=In([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),V3=In([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),j3=In([{name:"a_centroid_pos",components:2,type:"Uint16"}]),U3=In([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),$3=In([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:G3}=B3;var Vy={},H3=$h,ZI=Fd;function Fd(t,e,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=c,t.readFields(q3,this,e)}function q3(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,c){for(var d=a.readVarint()+a.pos;a.pos<d;){var f=c._keys[a.readVarint()],_=c._values[a.readVarint()];c.properties[f]=_}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function W3(t){for(var e,n,a=0,c=0,d=t.length,f=d-1;c<d;f=c++)a+=((n=t[f]).x-(e=t[c]).x)*(e.y+n.y);return a}Fd.types=["Unknown","Point","LineString","Polygon"],Fd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,c=0,d=0,f=0,_=[];t.pos<n;){if(c<=0){var y=t.readVarint();a=7&y,c=y>>3}if(c--,a===1||a===2)d+=t.readSVarint(),f+=t.readSVarint(),a===1&&(e&&_.push(e),e=[]),e.push(new H3(d,f));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Fd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,c=0,d=0,f=1/0,_=-1/0,y=1/0,b=-1/0;t.pos<e;){if(a<=0){var T=t.readVarint();n=7&T,a=T>>3}if(a--,n===1||n===2)(c+=t.readSVarint())<f&&(f=c),c>_&&(_=c),(d+=t.readSVarint())<y&&(y=d),d>b&&(b=d);else if(n!==7)throw new Error("unknown command "+n)}return[f,y,_,b]},Fd.prototype.toGeoJSON=function(t,e,n){var a,c,d=this.extent*Math.pow(2,n),f=this.extent*t,_=this.extent*e,y=this.loadGeometry(),b=Fd.types[this.type];function T(R){for(var O=0;O<R.length;O++){var F=R[O];R[O]=[360*(F.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(a=0;a<y.length;a++)S[a]=y[a][0];T(y=S);break;case 2:for(a=0;a<y.length;a++)T(y[a]);break;case 3:for(y=function(R){var O=R.length;if(O<=1)return[R];for(var F,z,j=[],X=0;X<O;X++){var Y=W3(R[X]);Y!==0&&(z===void 0&&(z=Y<0),z===Y<0?(F&&j.push(F),F=[R[X]]):F.push(R[X]))}return F&&j.push(F),j}(y),a=0;a<y.length;a++)for(c=0;c<y[a].length;c++)T(y[a][c])}y.length===1?y=y[0]:b="Multi"+b;var D={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(D.id=this.id),D};var Z3=ZI,XI=YI;function YI(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(X3,this,e),this.length=this._features.length}function X3(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var c=null,d=a.readVarint()+a.pos;a.pos<d;){var f=a.readVarint()>>3;c=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}return c}(n))}YI.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Z3(this._pbf,e,this.extent,this._keys,this._values)};var Y3=XI;function K3(t,e,n){if(t===3){var a=new Y3(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var Ib=Vy.VectorTile=function(t,e){this.layers=t.readFields(K3,{},e)},jy=Vy.VectorTileFeature=ZI;Vy.VectorTileLayer=XI;class Gu extends lt{constructor(e,n,a){super(e,n),this.z=a}}class KI extends Gu{constructor(e,n,a,c){super(e,n,a),this.w=c}}function Uy(t,e,n,a){let c=[],d=a===0?(f,_,y,b,T,S)=>{f.push(new lt(S,y+(S-_)/(b-_)*(T-y)))}:(f,_,y,b,T,S)=>{f.push(new lt(_+(S-y)/(T-y)*(b-_),S))};for(let f of t){let _=[];for(let y of f){if(y.length<=2)continue;let b=[];for(let D=0;D<y.length-1;D++){let R=y[D].x,O=y[D].y,F=y[D+1].x,z=y[D+1].y,j=a===0?R:O,X=a===0?F:z;j<e?X>e&&d(b,R,O,F,z,e):j>n?X<n&&d(b,R,O,F,z,n):b.push(y[D]),X<e&&j>=e&&d(b,R,O,F,z,e),X>n&&j<=n&&d(b,R,O,F,z,n)}let T=y[y.length-1],S=a===0?T.x:T.y;S>=e&&S<=n&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),_.push(b))}_.length&&c.push(_)}return c}function QI(t,e,n,a){let c=n==="x"?"y":"x",d=(a-t[n])/(e[n]-t[n]);t[c]=t[c]+(e[c]-t[c])*d,t[n]=a,t.hasOwnProperty("z")&&(t.z=It(t.z,e.z,d)),t.hasOwnProperty("w")&&(t.w=It(t.w,e.w,d))}function JI(t,e,n,a){let c=n,d=a;for(let f of["x","y"]){let _=t,y=e;_[f]>=y[f]&&(_=e,y=t),_[f]<c&&y[f]>c&&QI(_,y,f,c),_[f]<d&&y[f]>d&&QI(y,_,f,d)}}function $y(t,e){return t.x-e.x||t.y-e.y}function eD(t,e){return $y(t.min,e.min)===0&&$y(t.max,e.max)===0}function Db(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Mb(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!eD(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function tD(t,e,n){let a=1/it,c=1/(1<<n.canonical.z),d=(e.x*a+n.canonical.x)*c+n.wrap,f=(e.y*a+n.canonical.y)*c;return{min:new lt((t.x*a+n.canonical.x)*c+n.wrap,(t.y*a+n.canonical.y)*c),max:new lt(d,f)}}function Q3(t,e,n){let a=1<<n.canonical.z,c=((e.x-n.wrap)*a-n.canonical.x)*it,d=(e.y*a-n.canonical.y)*it;return{min:new lt(((t.x-n.wrap)*a-n.canonical.x)*it,(t.y*a-n.canonical.y)*it),max:new lt(c,d)}}function nD(t,e,n,a,c,d,f){let _=t.indices,y=t.vertices,b=[];for(let T=a;T<a+c;T+=3){let S=e[n[T+0]+d],D=e[n[T+1]+d],R=e[n[T+2]+d],O=Math.min(S.x,D.x,R.x),F=Math.max(S.x,D.x,R.x),z=Math.min(S.y,D.y,R.y),j=Math.max(S.y,D.y,R.y);b.length=0,t.grid.query(new lt(O,z),new lt(F,j),b);for(let X=0;X<b.length;X++){let Y=b[X];if(db(y[_[3*Y+0]],y[_[3*Y+1]],y[_[3*Y+2]],S,D,R,f))return!0}}return!1}function rD(t,e,n,a){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return rD(n,a,t,e);let d=e.canonical,f=a.canonical,_=Math.pow(2,f.z-d.z);c=t.vertices.map(y=>new lt((y.x+d.x*it)*_-f.x*it,(y.y+d.y*it)*_-f.y*it))}return nD(n,c,t.indices,0,t.indices.length,0,0)}function iD(t,e,n,a){let c=Math.pow(2,a.z-n.z);return new lt((t+n.x*it)*c-a.x*it,(e+n.y*it)*c-a.y*it)}function oD(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let a=e.footprint.indices,c=e.footprint.vertices;for(let d=0;d<n.length;d++){let f=n[d];if(sc([c[a[3*f+0]],c[a[3*f+1]],c[a[3*f+2]]],t))return!0}return!1}class sD{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function aD(t,e,n,a){let c=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(a[f])<1e-15){if(n[f]<t[f]||n[f]>e[f])return null}else{let _=1/a[f],y=(t[f]-n[f])*_,b=(e[f]-n[f])*_;if(y>b){let T=y;y=b,b=T}if(y>c&&(c=y),b<d&&(d=b),c>d)return null}return c}function lD(t,e,n,a,c,d,f,_,y,b,T){let S=a-t,D=c-e,R=d-n,O=f-t,F=_-e,z=y-n,j=T[1]*z-T[2]*F,X=T[2]*O-T[0]*z,Y=T[0]*F-T[1]*O,K=S*j+D*X+R*Y;if(Math.abs(K)<1e-15)return null;let le=1/K,se=b[0]-t,pe=b[1]-e,_e=b[2]-n,Ee=(se*j+pe*X+_e*Y)*le;if(Ee<0||Ee>1)return null;let Oe=pe*R-_e*D,De=_e*S-se*R,Ne=se*D-pe*S,Xe=(T[0]*Oe+T[1]*De+T[2]*Ne)*le;return Xe<0||Ee+Xe>1?null:(O*Oe+F*De+z*Ne)*le}function cD(t,e,n){return(t-e)/(n-e)}function uD(t,e,n,a,c,d,f,_,y){let b=1<<n,T=d-a,S=f-c,D=(t+1)/b*T+a,R=(e+0)/b*S+c,O=(e+1)/b*S+c;_[0]=(t+0)/b*T+a,_[1]=R,y[0]=D,y[1]=O}class hD{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(d){let f=Math.ceil(Math.log2(d.dim/8)),_=[],y=Math.ceil(Math.pow(2,f)),b=1/y,T=(R,O,F,z,j)=>{let X=z?1:0,Y=(R+1)*F-X,K=O*F,le=(O+1)*F-X;j[0]=R*F,j[1]=K,j[2]=Y,j[3]=le},S=new sD(y),D=[];for(let R=0;R<y*y;R++){T(R%y,Math.floor(R/y),b,!1,D);let O=lc(D[0],D[1],d),F=lc(D[2],D[1],d),z=lc(D[2],D[3],d),j=lc(D[0],D[3],d);S.minimums.push(Math.min(O,F,z,j)),S.maximums.push(Math.max(O,F,z,j)),S.leaves.push(1)}for(_.push(S),y/=2;y>=1;y/=2){let R=_[_.length-1];S=new sD(y);for(let O=0;O<y*y;O++){T(O%y,Math.floor(O/y),2,!0,D);let F=R.getElevation(D[0],D[1]),z=R.getElevation(D[2],D[1]),j=R.getElevation(D[2],D[3]),X=R.getElevation(D[0],D[3]),Y=R.isLeaf(D[0],D[1]),K=R.isLeaf(D[2],D[1]),le=R.isLeaf(D[2],D[3]),se=R.isLeaf(D[0],D[3]),pe=Math.min(F.min,z.min,j.min,X.min),_e=Math.max(F.max,z.max,j.max,X.max),Ee=Y&&K&&le&&se;S.maximums.push(_e),S.minimums.push(pe),S.leaves.push(_e-pe<=5&&Ee?1:0)}_.push(S)}return _}(this.dem),a=n.length-1,c=n[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,c,d,f,_=1){return aD([e,n,-100],[a,c,this.maximums[0]*_],d,f)}raycast(e,n,a,c,d,f,_=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,a,c,d,f,_);if(y==null)return null;let b=[],T=[],S=[],D=[],R=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;R.length>0;){let{idx:O,t:F,nodex:z,nodey:j,depth:X}=R.pop();if(this.leaves[O]){uD(z,j,X,e,n,a,c,S,D);let K=1<<X,le=(z+0)/K,se=(z+1)/K,pe=(j+0)/K,_e=(j+1)/K,Ee=lc(le,pe,this.dem)*_,Oe=lc(se,pe,this.dem)*_,De=lc(se,_e,this.dem)*_,Ne=lc(le,_e,this.dem)*_,Xe=lD(S[0],S[1],Ee,D[0],S[1],Oe,D[0],D[1],De,d,f),Le=lD(D[0],D[1],De,S[0],D[1],Ne,S[0],S[1],Ee,d,f),qe=Math.min(Xe!==null?Xe:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{let ke=r._.scaleAndAdd([],d,f,F);if(dD(Ee,Oe,Ne,De,cD(ke[0],S[0],D[0]),cD(ke[1],S[1],D[1]))>=ke[2])return F}continue}let Y=0;for(let K=0;K<this._siblingOffset.length;K++){uD((z<<1)+this._siblingOffset[K][0],(j<<1)+this._siblingOffset[K][1],X+1,e,n,a,c,S,D),S[2]=-100,D[2]=this.maximums[this.childOffsets[O]+K]*_;let le=aD(S,D,d,f);if(le!=null){let se=le;b[K]=se;let pe=!1;for(let _e=0;_e<Y&&!pe;_e++)se>=b[T[_e]]&&(T.splice(_e,0,K),pe=!0);pe||(T[Y]=K),Y++}}for(let K=0;K<Y;K++){let le=T[K];R.push({idx:this.childOffsets[O]+le,t:b[le],nodex:(z<<1)+this._siblingOffset[le][0],nodey:(j<<1)+this._siblingOffset[le][1],depth:X+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,c,d){if(e[c].isLeaf(n,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let f=c-1,_=e[f],y=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){let S=2*n+this._siblingOffset[T][0],D=2*a+this._siblingOffset[T][1],R=_.getElevation(S,D),O=_.isLeaf(S,D),F=this._addNode(R.min,R.max,O);O&&(y|=1<<T),b||(b=F)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*a+this._siblingOffset[T][1],f,b+T)}}function dD(t,e,n,a,c,d){return It(It(t,n,d),It(e,a,d),c)}function lc(t,e,n){let a=n.dim,c=Qt(t*a-.5,0,a-1),d=Qt(e*a-.5,0,a-1),f=Math.floor(c),_=Math.floor(d),y=Math.min(f+1,a-1),b=Math.min(_+1,a-1);return dD(n.get(f,_),n.get(y,_),n.get(f,b),n.get(y,b),c-f,d-_)}let J3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function ez(t,e,n){return(256*t*256+256*e+n)/10-1e4}function tz(t,e,n){return 256*t+e+n/256-32768}class Gy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return wr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let d=this.dim=n.height-2,f=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let y=0;y<d;y++)f[this._idx(-1,y)]=f[this._idx(0,y)],f[this._idx(d,y)]=f[this._idx(d-1,y)],f[this._idx(y,-1)]=f[this._idx(y,0)],f[this._idx(y,d)]=f[this._idx(y,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}let _=a==="terrarium"?tz:ez;for(let y=0;y<f.length;++y){let b=4*y;this.floatView[y]=_(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=Kr.now()}_buildQuadTree(){this._tree=new hD(this)}get(e,n,a=!1){a&&(e=Qt(e,-1,this.dim),n=Qt(n,-1,this.dim));let c=this._idx(e,n);return this.floatView[c]}set(e,n,a){let c=this._idx(e,n),d=this.floatView[c];return this.floatView[c]=a,a-d}static getUnpackVector(e){return J3[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],c=Gy.getUnpackVector(n),d=Math.floor((e+c[3])/c[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new UI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,d=n*this.dim+this.dim,f=a*this.dim,_=a*this.dim+this.dim;switch(n){case-1:c=d-1;break;case 1:d=c+1}switch(a){case-1:f=_-1;break;case 1:_=f+1}let y=-n*this.dim,b=-a*this.dim;for(let T=f;T<_;T++)for(let S=c;S<d;S++){let D=4*this._idx(S,T),R=4*this._idx(S+y,T+b);this.pixels[D+0]=e.pixels[R+0],this.pixels[D+1]=e.pixels[R+1],this.pixels[D+2]=e.pixels[R+2],this.pixels[D+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}J(Gy,"DEMData"),J(hD,"DemMinMaxQuadTree",{omit:["dem"]});class Nd{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let c=a||e.findDEMTileFor(n);if(!c||!c.dem)return;let d=c.dem,f=c.tileID,_=1<<n.canonical.z-f.canonical.z;return new Nd(c,d.dim/it/_,[(n.canonical.x/_-f.canonical.x)*d.dim,(n.canonical.y/_-f.canonical.y)*d.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new lt(c,d)}getElevationAt(e,n,a,c){let d=e*this._scale+this._offset[0],f=n*this._scale+this._offset[1],_=Math.floor(d),y=Math.floor(f),b=this._dem;return c=!!c,a?It(It(b.get(_,y,c),b.get(_,y+1,c),f-y),It(b.get(_+1,y,c),b.get(_+1,y+1,c),f-y),d-_):b.get(_,y,c)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Vi(1,e)*this._dem.stride}}let fD={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},nz=jy.types,rz=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],iz=["fill-extrusion-flood-light-ground-radius"],oz=Math.pow(2,13),sz=Math.pow(2,15)-1,pD=new lt(0,1),cc=2147483648;function Im(t,e,n,a,c,d,f,_){t.emplaceBack((e<<1)+f,(n<<1)+d,(Math.floor(a*oz)<<1)+c,Math.round(_))}function Hy(t,e,n,a,c,d){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+c,d)}function Dm(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class mD{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class gD{constructor(){this.centroidXY=new lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class _D{constructor(){this.acc=new lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===it)&&n.x===a.x)!=((n.y===0||n.y===it)&&n.y===a.y)&&this.processBorderOverlap(n,a),c&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,It(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>it!=e.x>it&&this.addBorderIntersection(1,It(n.y,e.y,(it-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,It(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>it!=e.y>it&&this.addBorderIntersection(3,It(n.x,e.x,(it-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new lt(0,0):new lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function yD(t,e){let n=t.add(e)._unit(),a=Qt(t.x*n.x+t.y*n.y,-1,1);var c,d,f;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*sz*((d=t).x*(f=e).y-d.y*f.x<0?-1:1)}let az=[t=>t.x<0,t=>t.x>it,t=>t.y<0,t=>t.y>it];function lz(t,e,n,a){let c=[4];if(a===0)return c;n._mult(a);let d=t.sub(n),f=e.sub(n),_=[t,e,d,f];for(let y=0;y<4;y++)for(let b of _)if(az[y](b)){c.push(y);break}return c}class vD{constructor(e){this.vertexArray=new k1,this.indexArray=new Ur,this.programConfigurations=new ic(e.layers,{zoom:e.zoom,lut:e.lut},n=>iz.includes(n)),this._segments=new cr,this.hiddenByLandmarkVertexArray=new Z1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new cr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,c=!1){let d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length),y;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{let b=e[0],T=e[1];y=yD(b.sub(e[d-1])._perp()._unit(),T.sub(b)._perp()._unit())}for(let b=0;b<d;b++){let T=b===d-1?0:b+1,S=e[b],D=e[T],R=e[T===d-1?0:T+1],O=D.sub(S)._perp()._unit(),F=yD(O,R.sub(D)._perp()._unit()),z=y,j=F;if(Ab(S,D,n)||c&&wD(S,n)&&wD(D,n)){y=F;continue}let X=_.vertexLength;Hy(this.vertexArray,S,D,1,1,z),Hy(this.vertexArray,S,D,1,0,z),Hy(this.vertexArray,S,D,0,1,j),Hy(this.vertexArray,S,D,0,0,j),_.vertexLength+=4;let Y=lz(S,D,O,a);for(let K of Y)this._segmentToGroundQuads[f].push({id:X,region:K}),this._segmentToRegionTriCounts[f][K]+=2,_.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((c,d)=>c.region-d.region);for(let a=0;a<n;a++){let c=this._segmentToGroundQuads[a],d=e[a],f=this._segmentToRegionTriCounts[a];f.reduce((y,b)=>y+b,0);let _=0;for(let y=0;y<=4;y++){let b=f[y];if(b!==0){let T=this.regionSegments[y];T||(T=this.regionSegments[y]=new cr);let S={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:b};T.get().push(S)}_+=b}for(let y=0;y<c.length;y++){let b=c[y].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,c,d,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,c,d,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,V3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,c,d,f){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,c,d,f)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&cc?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,U3.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class qy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ur,this.footprintVertices=new ds,this.footprintSegments=[],this.layoutVertexArray=new Ql,this.centroidVertexArray=new iI,this.indexArray=new Ur,this.programConfigurations=new ic(e.layers,{zoom:e.zoom,lut:e.lut},n=>rz.includes(n)),this.segments=new cr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new vD(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,c){this.features=[],this.hasPattern=Tb("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Iy(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:d,id:f,index:_,sourceLayerIndex:y}of e){let b=this.layers[0]._featureFilter.needGeometry,T=Xa(d,b);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),T,a))continue;let S={id:f,sourceLayerIndex:y,index:_,geometry:b?T.geometry:ps(d,a,c),properties:d.properties,type:d.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(Cb("fill-extrusion",this.layers,S,this.zoom,n)):this.addFeature(S,S.geometry,_,a,{},n.availableImages,c,n.brightness),n.featureIndex.insert(d,S.geometry,_,y,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,c,d,f){for(let _ of this.features){let{geometry:y}=_;this.addFeature(_,y,_.index,n,a,c,d,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,c,d){let f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;let _=f?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,_,a,c,d),this.groundEffect.update(e,n,_,a,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,G3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,$3.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,j3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,c,d,f,_,y){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new lt(0,0),new lt(it,it)],S=_.projection,D=S.name==="globe",R=nz[e.type]==="Polygon",O=new _D;O.centroidDataIndex=this.centroidData.length;let F=new gD,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);F.height=j,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new wy);let X=zy(n,500);for(let _e=X.length-1;_e>=0;_e--){let Ee=X[_e];(Ee.length===0||(Y=Ee[0]).every(Oe=>Oe.x<=0)||Y.every(Oe=>Oe.x>=it)||Y.every(Oe=>Oe.y<=0)||Y.every(Oe=>Oe.y>=it))&&X.splice(_e,1)}var Y;let K;if(D)K=SD(X,T,c);else{K=[];for(let _e of X)K.push({polygon:_e,bounds:T})}let le=R?this.edgeRadius:0,se=le>0&&this.zoom<17,pe=(_e,Ee)=>{if(_e.length===0)return!1;let Oe=_e[_e.length-1];return Ee.x===Oe.x&&Ee.y===Oe.y};for(let{polygon:_e,bounds:Ee}of K){let Oe=0,De=0;for(let qe of _e)R&&!qe[0].equals(qe[qe.length-1])&&qe.push(qe[0]),De+=R?qe.length-1:qe.length;let Ne=this.segments.prepareSegment((R?5:4)*De,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let Xe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Le=new mD;if(Le.vertexOffset=this.footprintVertices.length,Le.indexOffset=3*this.footprintIndices.length,Le.ringIndices=[],R){let qe=[],ke=[];Oe=Ne.vertexLength;for(let Je=0;Je<_e.length;Je++){let Ze=_e[Je];Ze.length&&Je!==0&&ke.push(qe.length/2);let ht=[],Ye,tt;Ye=Ze[1].sub(Ze[0])._perp()._unit(),Le.ringIndices.push(Ze.length-1);for(let Et=1;Et<Ze.length;Et++){let yt=Ze[Et],gt=Ze[Et===Ze.length-1?1:Et+1],et=yt.clone();if(le){tt=gt.sub(yt)._perp()._unit();let Ct=Ye.add(tt)._unit(),qt=le*Math.min(4,1/(Ye.x*Ct.x+Ye.y*Ct.y));et.x+=qt*Ct.x,et.y+=qt*Ct.y,et.x=Math.round(et.x),et.y=Math.round(et.y),Ye=tt}!z||le!==0&&!se||pe(ht,et)||ht.push(et),Im(this.layoutVertexArray,et.x,et.y,0,0,1,1,0),Ne.vertexLength++,this.footprintVertices.emplaceBack(yt.x,yt.y),qe.push(yt.x,yt.y),D&&Dm(this.layoutVertexExtArray,S.projectTilePoint(et.x,et.y,c),S.upVector(c,et.x,et.y))}z&&(le===0||se)&&(ht.length!==0&&pe(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,Ee,b))}let We=Em(qe,ke);for(let Je=0;Je<We.length;Je+=3)this.footprintIndices.emplaceBack(Le.vertexOffset+We[Je+0],Le.vertexOffset+We[Je+1],Le.vertexOffset+We[Je+2]),this.indexArray.emplaceBack(Oe+We[Je],Oe+We[Je+2],Oe+We[Je+1]),Ne.primitiveLength++;Le.indexCount+=We.length,Le.vertexCount+=this.footprintVertices.length-Le.vertexOffset}for(let qe=0;qe<_e.length;qe++){let ke=_e[qe];O.startRing(F,ke[0]);let We=ke.length>4&&ED(ke[ke.length-2],ke[0],ke[1]),Je=le?cz(ke[ke.length-2],ke[0],ke[1],le):0,Ze=[],ht,Ye,tt;Ye=ke[1].sub(ke[0])._perp()._unit();let Et=!0;for(let yt=1,gt=0;yt<ke.length;yt++){let et=ke[yt-1],Ct=ke[yt],qt=ke[yt===ke.length-1?1:yt+1];if(O.appendEdge(F,Ct,et),Ab(Ct,et,Ee)){le&&(Ye=qt.sub(Ct)._perp()._unit(),Et=!Et);continue}let At=Ct.sub(et)._perp(),Xt=At.x/(Math.abs(At.x)+Math.abs(At.y)),Wt=At.y>0?1:0,nn=et.dist(Ct);if(gt+nn>32768&&(gt=0),le){tt=qt.sub(Ct)._perp()._unit();let Tn=bD(et,Ct,qt,xD(Ye,tt),le);isNaN(Tn)&&(Tn=0);let hn=Ct.sub(et)._unit();et=et.add(hn.mult(Je))._round(),Ct=Ct.add(hn.mult(-Tn))._round(),Je=Tn,Ye=tt,z&&this.zoom>=17&&(pe(Ze,et)||Ze.push(et),pe(Ze,Ct)||Ze.push(Ct))}let Dt=Ne.vertexLength,Bn=ke.length>4&&ED(et,Ct,qt),Nn=TD(gt,We,Et);if(Im(this.layoutVertexArray,et.x,et.y,Xt,Wt,0,0,Nn),Im(this.layoutVertexArray,et.x,et.y,Xt,Wt,0,1,Nn),gt+=nn,Nn=TD(gt,Bn,!Et),We=Bn,Im(this.layoutVertexArray,Ct.x,Ct.y,Xt,Wt,0,0,Nn),Im(this.layoutVertexArray,Ct.x,Ct.y,Xt,Wt,0,1,Nn),Ne.vertexLength+=4,this.indexArray.emplaceBack(Dt+0,Dt+1,Dt+2),this.indexArray.emplaceBack(Dt+1,Dt+3,Dt+2),Ne.primitiveLength+=2,le){let Tn=Oe+(yt===1?ke.length-2:yt-2),hn=yt===1?Oe:Tn+1;if(this.indexArray.emplaceBack(Dt+1,Tn,Dt+3),this.indexArray.emplaceBack(Tn,hn,Dt+3),Ne.primitiveLength+=2,ht===void 0&&(ht=Dt),!Ab(qt,ke[yt],Ee)){let Cn=yt===ke.length-1?ht:Ne.vertexLength;this.indexArray.emplaceBack(Dt+2,Dt+3,Cn),this.indexArray.emplaceBack(Dt+3,Cn+1,Cn),this.indexArray.emplaceBack(Dt+3,hn,Cn+1),Ne.primitiveLength+=3}Et=!Et}if(D){let Tn=this.layoutVertexExtArray,hn=S.projectTilePoint(et.x,et.y,c),Cn=S.projectTilePoint(Ct.x,Ct.y,c),Yn=S.upVector(c,et.x,et.y),Hn=S.upVector(c,Ct.x,Ct.y);Dm(Tn,hn,Yn),Dm(Tn,hn,Yn),Dm(Tn,Cn,Hn),Dm(Tn,Cn,Hn)}}R&&(Oe+=ke.length-1),z&&le&&this.zoom>=17&&(Ze.length!==0&&pe(Ze,Ze[0])&&Ze.pop(),this.groundEffect.addData(Ze,Ee,b,le>0))}this.footprintSegments.push(Le),Xe.triangleCount=this.indexArray.length-Xe.triangleArrayOffset,this.polygonSegments.push(Xe),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=O.borders?pD:this.encodeCentroid(O,F),this.centroidData.push(F),O.borders){this.featuresOnBorder.push(O);let _e=this.featuresOnBorder.length-1;for(let Ee=0;Ee<O.borders.length;Ee++)O.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(_e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,c,y),this.groundEffect.addPaintPropertiesData(e,a,d,f,c,y),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let y=this.centroidData[_],b=+(y.min.y+y.max.y>it),T=2*b+(+(y.min.x+y.max.x>it)^b);for(let S=0;S<y.polygonSegLen;S++){let D=y.polygonSegIdx+S;e.push({centroidIdx:_,subtile:T,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let n=new Ur;e.sort((_,y)=>_.triangleSegmentIdx===y.triangleSegmentIdx?_.subtile-y.subtile:_.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,c=0,d=0;for(let _ of e){if(_.triangleSegmentIdx!==a)break;d++}let f=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let _=0,y=c,b=c;for(let T=y;T<d&&e[T].subtile===_;T++)b++;for(;y!==d;){let T=e[y];_=T.subtile;let S=this.centroidData[T.centroidIdx].min.clone(),D=this.centroidData[T.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=y;O<b;O++){let F=e[O],z=this.polygonSegments[F.polygonSegmentIdx],j=this.centroidData[F.centroidIdx].min,X=this.centroidData[F.centroidIdx].max,Y=this.indexArray.uint16;for(let K=z.triangleArrayOffset;K<z.triangleArrayOffset+z.triangleCount;K++)n.emplaceBack(Y[3*K],Y[3*K+1],Y[3*K+2]);R.primitiveLength+=z.triangleCount,S.x=Math.min(S.x,j.x),S.y=Math.min(S.y,j.y),D.x=Math.max(D.x,X.x),D.y=Math.max(D.y,X.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:S,max:D}),y=b;for(let O=y;O<d&&e[O].subtile===e[y].subtile;O++)b++}c=d;for(let T=c;T<f&&e[T].triangleSegmentIdx===e[c].triangleSegmentIdx;T++)d++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let c=0,d=0,f=1<<e.canonical.z;if(n){let F=n.getMinMaxForTile(e);F&&(c=F.min,d=F.max)}d+=this.maxHeight;let _=e.toUnwrapped(),y,b=[_.canonical.x/f+_.wrap,_.canonical.y/f],T=[(_.canonical.x+1)/f+_.wrap,(_.canonical.y+1)/f],S=new cr,D=(F,z,j)=>[F[0]*(1-j[0])+z[0]*j[0],F[1]*(1-j[1])+z[1]*j[1]],R=[],O=[];for(let F of this.triangleSubSegments){R[0]=F.min.x/it,R[1]=F.min.y/it,O[0]=F.max.x/it,O[1]=F.max.y/it;let z=D(b,T,R),j=D(b,T,O);if(new ur([z[0],z[1],c],[j[0],j[1],d]).intersectsPrecise(a)===0){y&&(S.segments.push(y),y=void 0);continue}let X=F.segment;y&&y.vertexOffset!==X.vertexOffset&&(S.segments.push(y),y=void 0),y?(y.vertexLength+=X.vertexLength,y.primitiveLength+=X.primitiveLength):y={vertexOffset:X.vertexOffset,primitiveLength:X.primitiveLength,vertexLength:X.vertexLength,primitiveOffset:X.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&S.segments.push(y),S}encodeCentroid(e,n){let a=e.centroid(),c=n.span(),d=Math.min(7,Math.round(c.x*this.tileToMeter/10)),f=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new lt(Qt(a.x,1,it-1)<<3|d,Qt(a.y,1,it-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new lt(0,0);let n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){let c=n[0][0]!==a?0:1;return new lt(6|(n[0][0]!==a?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{let c=n[2][0]!==a?2:3;return new lt((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=cc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&cc?pD:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||d!==c.x){for(let f=n;f<a;++f)this.centroidVertexArray.emplace(f,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped());if(Mb(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let f of this.centroidData)f.flags&=2147483647;let d=[];for(let f of this.activeReplacements){if(f.order<a)continue;let _=Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&cc||f.min.x>y.max.x||y.min.x>f.max.x||f.min.y>y.max.y||y.min.y>f.max.y))for(let b=0;b<y.footprintSegLen;b++){let T=this.footprintSegments[y.footprintSegIdx+b];if(d.length=0,uz(this.footprintVertices,T.vertexOffset,T.vertexCount,f.footprintTileId.canonical,e.canonical,d),nD(f.footprint,d,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-_)){y.flags|=cc;break}}}for(let f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let c=!1;for(let d=0;d<a.footprintSegLen;d++){let f=this.footprintSegments[a.footprintSegIdx+d],_=0;for(let y of f.ringIndices){for(let b=_,T=y+_-1;b<y+_;T=b++){let S=this.footprintVertices.int16[2*(b+f.vertexOffset)+0],D=this.footprintVertices.int16[2*(b+f.vertexOffset)+1],R=this.footprintVertices.int16[2*(T+f.vertexOffset)+1];D>n!=R>n&&e<(this.footprintVertices.int16[2*(T+f.vertexOffset)+0]-S)*(n-D)/(R-D)+S&&(c=!c)}_=y}}return c}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,c=!0,d=4*(e+it)*it+(n+it);if(this.partLookup.hasOwnProperty(d)){let f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&cc)}:void 0}for(let f of this.centroidData)e>f.max.x||f.min.x>e||n>f.max.y||f.min.y>n||this.footprintContainsPoint(e,n,f)&&f&&f.height>a&&(a=f.height,this.partLookup[d]=f,c=!!(f.flags&cc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[d]=void 0}}function xD(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function cz(t,e,n,a){let c=e.sub(t)._perp()._unit(),d=n.sub(e)._perp()._unit();return bD(t,e,n,xD(c,d),a)}function bD(t,e,n,a,c){let d=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,c*d/a)}function Ab(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function wD(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function ED(t,e,n){if(t.x<0||t.x>=it||e.x<0||e.x>=it||n.x<0||n.x>=it)return!1;let a=n.sub(e),c=a.perp(),d=t.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function TD(t,e,n){let a=e?2|t:-3&t;return n?1|a:-2&a}function CD(){let t=Math.PI/32,e=Math.tan(t),n=Rd;return n*Math.sqrt(1+2*e*e)-n}function SD(t,e,n){let a=1<<n.z,c=Wi(n.x/a),d=Wi((n.x+1)/a),f=Jr(n.y/a),_=Jr((n.y+1)/a);return function(y,b,T,S,D=0,R){let O=[];if(!y.length||!T||!S)return O;let F=(se,pe)=>{for(let _e of se)O.push({polygon:_e,bounds:pe})},z=Math.ceil(Math.log2(T)),j=Math.ceil(Math.log2(S)),X=z-j,Y=[];for(let se=0;se<Math.abs(X);se++)Y.push(X>0?0:1);for(let se=0;se<Math.min(z,j);se++)Y.push(0),Y.push(1);let K=y;if(K=Uy(K,b[0].y-D,b[1].y+D,1),K=Uy(K,b[0].x-D,b[1].x+D,0),!K.length)return O;let le=[];for(Y.length?le.push({polygons:K,bounds:b,depth:0}):F(K,b);le.length;){let se=le.pop(),pe=se.depth,_e=Y[pe],Ee=se.bounds[0],Oe=se.bounds[1],De=_e===0?Ee.x:Ee.y,Ne=_e===0?Oe.x:Oe.y,Xe=R?R(_e,De,Ne):.5*(De+Ne),Le=Uy(se.polygons,De-D,Xe+D,_e),qe=Uy(se.polygons,Xe-D,Ne+D,_e);if(Le.length){let ke=[Ee,new lt(_e===0?Xe:Oe.x,_e===1?Xe:Oe.y)];Y.length>pe+1?le.push({polygons:Le,bounds:ke,depth:pe+1}):F(Le,ke)}if(qe.length){let ke=[new lt(_e===0?Xe:Ee.x,_e===1?Xe:Ee.y),Oe];Y.length>pe+1?le.push({polygons:qe,bounds:ke,depth:pe+1}):F(qe,ke)}}return O}(t,e,Math.ceil((d-c)/11.25),Math.ceil((f-_)/11.25),1,(y,b,T)=>{if(y===0)return .5*(b+T);{let S=Jr((n.y+b/it)/a);return(Ks(.5*(Jr((n.y+T/it)/a)+S))*a-n.y)*it}})}function uz(t,e,n,a,c,d){let f=Math.pow(2,a.z-c.z);for(let _=0;_<n;_++){let y=t.int16[2*(_+e)+0],b=t.int16[2*(_+e)+1];y=(y+c.x*it)*f-a.x*it,b=(b+c.y*it)*f-a.y*it,d.push(new lt(y,b))}}J(qy,"FillExtrusionBucket",{omit:["layers","features"]}),J(gD,"PartData"),J(mD,"FootprintSegment"),J(_D,"BorderCentroidData"),J(vD,"GroundEffect");let hz=new Pn({visibility:new Be(Te["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Be(Te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var dz={paint:new Pn({"fill-extrusion-opacity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Be(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Be(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ut(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Be(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Be(Te["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Be(Te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Be(Te["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Be(Te["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:hz};function Mm(t,e){return t.x*e.x+t.y*e.y}function ID(t,e){if(t.length===1){let n=0,a=e[n++],c;for(;!c||a.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let d=e[n],f=t[0],_=c.sub(a),y=d.sub(a),b=f.sub(a),T=Mm(_,_),S=Mm(_,y),D=Mm(y,y),R=Mm(b,_),O=Mm(b,y),F=T*D-S*S,z=(D*R-S*O)/F,j=(T*O-S*R)/F,X=a.z*(1-z-j)+c.z*z+d.z*j;if(isFinite(X))return X}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function DD(t,e,n,a,c,d,f,_){let y=f*c.getElevationAt(t,e,!0,!0),b=d[0]!==0,T=b?d[1]===0?f*(d[0]/7-450):f*function(S,D,R){let O=Math.floor(D[0]/8),F=Math.floor(D[1]/8),z=10*(D[0]-8*O),j=10*(D[1]-8*F),X=S.getElevationAt(O,F,!0,!0),Y=S.getMeterToDEM(R),K=Math.floor(.5*(z*Y-1)),le=Math.floor(.5*(j*Y-1)),se=S.tileCoordToPixel(O,F),pe=2*K+1,_e=2*le+1,Ee=function(qe,ke,We,Je,Ze){return[qe.getElevationAtPixel(ke,We,!0),qe.getElevationAtPixel(ke+Ze,We,!0),qe.getElevationAtPixel(ke,We+Ze,!0),qe.getElevationAtPixel(ke+Je,We+Ze,!0)]}(S,se.x-K,se.y-le,pe,_e),Oe=Math.abs(Ee[0]-Ee[1]),De=Math.abs(Ee[2]-Ee[3]),Ne=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),Xe=Math.min(.25,.5*Y*(Oe+De)/pe),Le=Math.min(.25,.5*Y*Ne/_e);return X+Math.max(Xe*z,Le*j)}(c,d,_):y;return{base:y+(n===0)?-1:n,top:b?Math.max(T+a,y+n+2):y+a}}let fz=In([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:pz}=fz,mz=In([{name:"a_packed",components:4,type:"Float32"}]),{members:gz}=mz,_z=In([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:yz}=_z,vz=In([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xz=In([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),bz=In([{name:"a_projected_pos",components:4,type:"Float32"}],4);In([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Pb=In([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),MD=In([{name:"a_z_offset",components:1,type:"Float32"}],4),wz=In([{name:"a_texb",components:2,type:"Uint16"}]),Ez=In([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Tz=In([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let AD=In([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cz=In([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);In([{name:"triangle",components:3,type:"Uint16"}]),In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),In([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),In([{type:"Float32",name:"offsetX"}]),In([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class PD{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new ac({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=_p(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let c=[],d=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,_=!0;c.push({left:d,right:f,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){_=!_;let T=e[b];d=y*a,y+=T,f=y*a,c.push({left:d,right:f,isDash:_,zeroLength:T===0})}return c}addRoundDash(e,n,a){let c=n/2;for(let d=-a;d<=a;d++){let f=this.width*(this.nextRow+a+d),_=0,y=e[_];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++_]);let T=Math.abs(b-y.left),S=Math.abs(b-y.right),D=Math.min(T,S),R,O=d/a*(c+1);if(y.isDash){let F=c-Math.abs(O);R=Math.sqrt(D*D+F*F)}else R=c-Math.sqrt(D*D+O*O);this.image.data[f+b]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let b=e[y],T=e[y+1];b.zeroLength?e.splice(y,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(y,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let d=this.width*this.nextRow,f=0,_=e[f];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++f]);let b=Math.abs(y-_.left),T=Math.abs(y-_.right),S=Math.min(b,T);this.image.data[d+y]=Math.max(0,Math.min(255,(_.isDash?S:-S)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let c=n==="round",d=c?7:0,f=2*d+1;if(this.nextRow+f>this.height)return wr("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let T=0;T<e.length;T++)e[T]<0&&(wr("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),_+=e[T];if(_!==0){let T=this.width/_,S=this.getDashRanges(e,this.width,T);c?this.addRoundDash(S,T,d):this.addRegularDash(S,n==="square"?.5*T:0)}let y=this.nextRow+d;this.nextRow+=f;let b={tl:[y,d],br:[_,0]};return this.positions[a]=b,b}}J(PD,"LineAtlas");let Sz=jy.types,Iz=Math.cos(Math.PI/180*37.5),Dz=Math.cos(Math.PI/180*5);class Wy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new L1,this.layoutVertexArray2=new Jl,this.patternVertexArray=new ec,this.indexArray=new Ur,this.programConfigurations=new ic(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new cr,this.maxLineLength=0,this.zOffsetVertexArray=new Nu,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:it/64}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=Tb("line",this.layers,n);let d=this.layers[0].layout.get("line-sort-key"),f=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!f.isConstant()||!!f.constantOr(0);let _=[];for(let{feature:S,id:D,index:R,sourceLayerIndex:O}of e){let F=this.layers[0]._featureFilter.needGeometry,z=Xa(S,F);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),z,a))continue;let j=d?d.evaluate(z,{},a):void 0,X={id:D,properties:S.properties,type:S.type,sourceLayerIndex:O,index:R,geometry:F?z.geometry:ps(S,a,c),patterns:{},sortKey:j};_.push(X)}d&&_.sort((S,D)=>S.sortKey-D.sortKey);let{lineAtlas:y,featureIndex:b}=n,T=this.addConstantDashes(y);for(let S of _){let{geometry:D,index:R,sourceLayerIndex:O}=S;if(T&&this.addFeatureDashes(S,y),this.hasPattern){let F=Cb("line",this.layers,S,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(S,D,R,a,y.positions,n.availableImages,n.brightness);b.insert(e[R].feature,D,R,O,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")n=!0;else{let f=d.value,_=c.value;if(!_)continue;e.addDash(_,f)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let c of this.layers){let d=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let _,y;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:a},e);y=f.kind==="constant"?f.value:f.evaluate({zoom:a},e),n.addDash(_,y),e.patterns[c.id]=n.getKey(_,y)}}update(e,n,a,c,d){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,a,c,d)}addFeatures(e,n,a,c,d,f){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,yz)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,MD.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pz),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,c,d,f,_){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),S=y.get("line-miter-limit"),D=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let R of n)this.addLine(R,e,c,b,T,S,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,c,_)}addLine(e,n,a,c,d,f,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},b=this.layers[0].layout,T=c==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<e.length-1;se++)this.totalDistance+=e[se].dist(e[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let S=Sz[n.type]==="Polygon",D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let R=0;for(;R<D-1&&e[R].equals(e[R+1]);)R++;if(D<(S?3:2))return;c==="bevel"&&(f=1.05);let O=this.overscaling<=16?15*it/(512*this.overscaling):0,F=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),z,j,X,Y,K,le;this.e1=this.e2=-1,S&&(z=e[D-2],K=e[R].sub(z)._unit()._perp());for(let se=R;se<D;se++){if(X=se===D-1?S?e[R+1]:void 0:e[se+1],X&&e[se].equals(X))continue;if(K&&(Y=K),z&&(j=z),z=e[se],this.hasZOffset){let ke=b.get("line-z-offset").value;if(ke.kind==="constant")le=ke.value;else{if(this.lineClips){let We=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(We*this.lineClips.start+this.distance+(j?j.dist(z):0))/We}else wr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;le=ke.evaluate(y,n)}le=le||0}K=X?X.sub(z)._unit()._perp():Y,Y=Y||K;let pe=j&&X,_e=pe?c:S||T?"butt":d,Ee=Y.x*K.x+Y.y*K.y;if(T){let ke=function(We){if(We.patternJoinNone){let Je=We.segmentPoints.length/2,Ze=We.lineSoFar-We.segmentStart;for(let ht=0;ht<Je;++ht){let Ye=We.segmentPoints[2*ht+1],tt=Math.round(We.segmentPoints[2*ht])+.5+.25*Ye;We.patternVertexArray.emplaceBack(tt,Ze,We.segmentStart),We.patternVertexArray.emplaceBack(tt,Ze,We.segmentStart)}We.segmentPoints.length=0}We.e1=We.e2=-1};if(pe&&Ee<Dz){this.updateDistance(j,z),this.addCurrentVertex(z,Y,1,1,F,le),ke(this),this.addCurrentVertex(z,K,-1,-1,F,le);continue}if(j){if(!X){this.updateDistance(j,z),this.addCurrentVertex(z,Y,1,1,F,le),ke(this);continue}_e="miter"}}let Oe=Y.add(K);Oe.x===0&&Oe.y===0||Oe._unit();let De=Oe.x*K.x+Oe.y*K.y,Ne=De!==0?1/De:1/0,Xe=2*Math.sqrt(2-2*De),Le=De<Iz&&j&&X,qe=Y.x*K.y-Y.y*K.x>0;if(Le&&se>R){let ke=z.dist(j);if(ke>2*O){let We=z.sub(z.sub(j)._mult(O/ke)._round());this.updateDistance(j,We),this.addCurrentVertex(We,Y,0,0,F,le),j=We}}if(pe&&_e==="round"&&(Ne<_?_e="miter":Ne<=2&&(_e="fakeround")),_e==="miter"&&Ne>f&&(_e="bevel"),_e==="bevel"&&(Ne>2&&(_e="flipbevel"),Ne<f&&(_e="miter")),j&&this.updateDistance(j,z),_e==="miter")Oe._mult(Ne),this.addCurrentVertex(z,Oe,0,0,F,le);else if(_e==="flipbevel"){if(Ne>100)Oe=K.mult(-1);else{let ke=Ne*Y.add(K).mag()/Y.sub(K).mag();Oe._perp()._mult(ke*(qe?-1:1))}this.addCurrentVertex(z,Oe,0,0,F,le),this.addCurrentVertex(z,Oe.mult(-1),0,0,F,le)}else if(_e==="bevel"||_e==="fakeround"){let ke=-Math.sqrt(Ne*Ne-1),We=qe?ke:0,Je=qe?0:ke;if(j&&this.addCurrentVertex(z,Y,We,Je,F,le),_e==="fakeround"){let Ze=Math.round(180*Xe/Math.PI/20);for(let ht=1;ht<Ze;ht++){let Ye=ht/Ze;if(Ye!==.5){let Et=Ye-.5;Ye+=Ye*Et*(Ye-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Et*Et+(.848013+Ee*(.215638*Ee-1.06021)))}let tt=K.sub(Y)._mult(Ye)._add(Y)._unit()._mult(qe?-1:1);this.addHalfVertex(z,tt.x,tt.y,!1,qe,0,F,le)}}X&&this.addCurrentVertex(z,K,-We,-Je,F,le)}else _e==="butt"?this.addCurrentVertex(z,Oe,0,0,F,le):_e==="square"?(j||this.addCurrentVertex(z,Oe,-1,-1,F,le),this.addCurrentVertex(z,Oe,0,0,F,le),j&&this.addCurrentVertex(z,Oe,1,1,F,le)):_e==="round"&&(j&&(this.addCurrentVertex(z,Y,0,0,F,le),this.addCurrentVertex(z,Y,1,1,F,le,!0)),X&&(this.addCurrentVertex(z,K,-1,-1,F,le,!0),this.addCurrentVertex(z,K,0,0,F,le)));if(Le&&se<D-1){let ke=z.dist(X);if(ke>2*O){let We=z.add(X.sub(z)._mult(O/ke)._round());this.updateDistance(z,We),this.addCurrentVertex(We,K,0,0,F,le),z=We}}}}addVerticesTo(e,n,a,c,d,f,_,y,b,T){let S=(n.w-e.w)/this.tessellationStep|0;if(S>1){this.lineSoFar=e.w;let D=(n.x-e.x)/S,R=(n.y-e.y)/S,O=(n.z-e.z)/S,F=(n.w-e.w)/S;for(let z=1;z<S;++z)e.x+=D,e.y+=R,e.z+=O,this.lineSoFar+=F,this.addHalfVertex(e,a,c,T,!1,_,b,e.z),this.addHalfVertex(e,d,f,T,!0,-y,b,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,a,c,T,!1,_,b,n.z),this.addHalfVertex(n,d,f,T,!0,-y,b,n.z)}addCurrentVertex(e,n,a,c,d,f,_=!1){let y=n.x+n.y*a,b=n.y-n.x*a,T=n.y*c-n.x,S=-n.y-n.x*c;if(f!=null){let R=it+10,O=f,F=new KI(e.x,e.y,O,this.lineSoFar),z=RD(e,-10,R),j=this.lineSoFar;if(this.currentVertex)if(z){let X=this.currentVertexIsOutside,Y=this.currentVertex,K=new KI(e.x,e.y,O,this.lineSoFar);JI(Y,K,-10,R),RD(K,-10,R)||(X&&(this.e1=this.e2=-1,this.lineSoFar=Y.w,this.addHalfVertex(Y,y,b,_,!1,a,d,Y.z),this.addHalfVertex(Y,T,S,_,!0,-c,d,Y.z)),this.addVerticesTo(Y,K,y,b,T,S,a,c,d,_))}else{let X=this.currentVertex;this.currentVertexIsOutside&&(JI(X,F,-10,R),this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,y,b,_,!1,a,d,X.z),this.addHalfVertex(X,T,S,_,!0,-c,d,X.z)),this.addVerticesTo(X,F,y,b,T,S,a,c,d,_)}else z||(this.addHalfVertex(e,y,b,_,!1,a,d,f),this.addHalfVertex(e,T,S,_,!0,-c,d,f));this.currentVertex=F,this.currentVertexIsOutside=z,this.lineSoFar=j}else this.addHalfVertex(e,y,b,_,!1,a,d,f),this.addHalfVertex(e,T,S,_,!0,-c,d,f)}addHalfVertex({x:e,y:n},a,c,d,f,_,y,b){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let T=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),y.primitiveLength++),f?this.e2=T:this.e1=T,b!=null&&this.zOffsetVertexArray.emplaceBack(b)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function RD(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}J(Wy,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let Mz=new Pn({"line-cap":new ut(Te.layout_line["line-cap"]),"line-join":new ut(Te.layout_line["line-join"]),"line-miter-limit":new Be(Te.layout_line["line-miter-limit"]),"line-round-limit":new Be(Te.layout_line["line-round-limit"]),"line-sort-key":new ut(Te.layout_line["line-sort-key"]),"line-z-offset":new ut(Te.layout_line["line-z-offset"]),visibility:new Be(Te.layout_line.visibility)});var Zy={paint:new Pn({"line-opacity":new ut(Te.paint_line["line-opacity"]),"line-color":new ut(Te.paint_line["line-color"]),"line-translate":new Be(Te.paint_line["line-translate"]),"line-translate-anchor":new Be(Te.paint_line["line-translate-anchor"]),"line-width":new ut(Te.paint_line["line-width"]),"line-gap-width":new ut(Te.paint_line["line-gap-width"]),"line-offset":new ut(Te.paint_line["line-offset"]),"line-blur":new ut(Te.paint_line["line-blur"]),"line-dasharray":new ut(Te.paint_line["line-dasharray"]),"line-pattern":new ut(Te.paint_line["line-pattern"]),"line-gradient":new Lr(Te.paint_line["line-gradient"]),"line-trim-offset":new Be(Te.paint_line["line-trim-offset"]),"line-trim-fade-range":new Be(Te.paint_line["line-trim-fade-range"]),"line-trim-color":new Be(Te.paint_line["line-trim-color"]),"line-emissive-strength":new Be(Te.paint_line["line-emissive-strength"]),"line-border-width":new ut(Te.paint_line["line-border-width"]),"line-border-color":new ut(Te.paint_line["line-border-color"]),"line-occlusion-opacity":new Be(Te.paint_line["line-occlusion-opacity"])}),layout:Mz};function OD(t,e,n){return e*(it/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function kD(t,e){return 1/OD(t,1,e.tileZoom)}function LD(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let FD=t=>{let e=[];ND(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",c=!!t.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function ND(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class zD{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var Az={read:function(t,e,n,a,c){var d,f,_=8*c-a-1,y=(1<<_)-1,b=y>>1,T=-7,S=n?c-1:0,D=n?-1:1,R=t[e+S];for(S+=D,d=R&(1<<-T)-1,R>>=-T,T+=_;T>0;d=256*d+t[e+S],S+=D,T-=8);for(f=d&(1<<-T)-1,d>>=-T,T+=a;T>0;f=256*f+t[e+S],S+=D,T-=8);if(d===0)d=1-b;else{if(d===y)return f?NaN:1/0*(R?-1:1);f+=Math.pow(2,a),d-=b}return(R?-1:1)*f*Math.pow(2,d-a)},write:function(t,e,n,a,c,d){var f,_,y,b=8*d-c-1,T=(1<<b)-1,S=T>>1,D=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:d-1,O=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=T):(f=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-f))<1&&(f--,y*=2),(e+=f+S>=1?D/y:D*Math.pow(2,1-S))*y>=2&&(f++,y/=2),f+S>=T?(_=0,f=T):f+S>=1?(_=(e*y-1)*Math.pow(2,c),f+=S):(_=e*Math.pow(2,S-1)*Math.pow(2,c),f=0));c>=8;t[n+R]=255&_,R+=O,_/=256,c-=8);for(f=f<<c|_,b+=c;b>0;t[n+R]=255&f,R+=O,f/=256,b-=8);t[n+R-O]|=128*F}},BD=ir,Xy=Az;function ir(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ir.Varint=0,ir.Fixed64=1,ir.Bytes=2,ir.Fixed32=5;var Rb=4294967296,VD=1/Rb,jD=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qa(t){return t.type===ir.Bytes?t.readVarint()+t.pos:t.pos+1}function zd(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function UD(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=t;c--)n.buf[c+a]=n.buf[c]}function Pz(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Rz(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Oz(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function kz(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Lz(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Fz(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Nz(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function zz(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Bz(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Yy(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Bd(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function $D(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ir.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,d=this.pos;this.type=7&a,t(c,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Yy(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=$D(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Yy(this.buf,this.pos)+Yy(this.buf,this.pos+4)*Rb;return this.pos+=8,t},readSFixed64:function(){var t=Yy(this.buf,this.pos)+$D(this.buf,this.pos+4)*Rb;return this.pos+=8,t},readFloat:function(){var t=Xy.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xy.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(c,d,f){var _,y,b=f.buf;if(_=(112&(y=b[f.pos++]))>>4,y<128||(_|=(127&(y=b[f.pos++]))<<3,y<128)||(_|=(127&(y=b[f.pos++]))<<10,y<128)||(_|=(127&(y=b[f.pos++]))<<17,y<128)||(_|=(127&(y=b[f.pos++]))<<24,y<128)||(_|=(1&(y=b[f.pos++]))<<31,y<128))return zd(c,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&jD?function(n,a,c){return jD.decode(n.subarray(a,c))}(this.buf,e,t):function(n,a,c){for(var d="",f=a;f<c;){var _,y,b,T=n[f],S=null,D=T>239?4:T>223?3:T>191?2:1;if(f+D>c)break;D===1?T<128&&(S=T):D===2?(192&(_=n[f+1]))==128&&(S=(31&T)<<6|63&_)<=127&&(S=null):D===3?(y=n[f+2],(192&(_=n[f+1]))==128&&(192&y)==128&&((S=(15&T)<<12|(63&_)<<6|63&y)<=2047||S>=55296&&S<=57343)&&(S=null)):D===4&&(y=n[f+2],b=n[f+3],(192&(_=n[f+1]))==128&&(192&y)==128&&(192&b)==128&&((S=(15&T)<<18|(63&_)<<12|(63&y)<<6|63&b)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,D=1):S>65535&&(S-=65536,d+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),d+=String.fromCharCode(S),f+=D}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ir.Bytes)return t.push(this.readVarint(e));var n=Qa(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ir.Bytes)return t.push(this.readSVarint());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ir.Bytes)return t.push(this.readBoolean());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ir.Bytes)return t.push(this.readFloat());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ir.Bytes)return t.push(this.readDouble());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ir.Bytes)return t.push(this.readFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ir.Bytes)return t.push(this.readSFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ir.Bytes)return t.push(this.readFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ir.Bytes)return t.push(this.readSFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ir.Varint)for(;this.buf[this.pos++]>127;);else if(e===ir.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ir.Fixed32)this.pos+=4;else{if(e!==ir.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Bd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Bd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Bd(this.buf,-1&t,this.pos),Bd(this.buf,Math.floor(t*VD),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Bd(this.buf,-1&t,this.pos),Bd(this.buf,Math.floor(t*VD),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,f,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(a,0,n),function(d,f){var _=(7&d)<<4;f.buf[f.pos++]|=_|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,c,d){for(var f,_,y=0;y<c.length;y++){if((f=c.charCodeAt(y))>55295&&f<57344){if(!_){f>56319||y+1===c.length?(a[d++]=239,a[d++]=191,a[d++]=189):_=f;continue}if(f<56320){a[d++]=239,a[d++]=191,a[d++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(a[d++]=239,a[d++]=191,a[d++]=189,_=null);f<128?a[d++]=f:(f<2048?a[d++]=f>>6|192:(f<65536?a[d++]=f>>12|224:(a[d++]=f>>18|240,a[d++]=f>>12&63|128),a[d++]=f>>6&63|128),a[d++]=63&f|128)}return d}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&UD(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Xy.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Xy.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&UD(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,ir.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Pz,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Rz,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Lz,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Oz,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,kz,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Fz,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Nz,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,zz,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Bz,e)},writeBytesField:function(t,e){this.writeTag(t,ir.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ir.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ir.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ir.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ir.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ir.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ir.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ir.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ir.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ir.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Vd=ze(BD);let Vz=["id","tile","layer","source","sourceLayer","state"];class GD{constructor(e,n,a,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of Vz)this[n]!==void 0&&(e[n]=this[n]);return e}}class jz{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){let c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},li(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(let d in this.state[e][c])a[d]||(this.deletedStates[e][c][d]=null)}else for(let d in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;let c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){let a=String(n),c=li({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let d=this.deletedStates[e][n];if(d===null)return{};for(let f in d)delete c[f]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let a={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let d={};for(let f in this.stateChanges[c])this.state[c][f]||(this.state[c][f]={}),li(this.state[c][f],this.stateChanges[c][f]),d[f]=this.state[c][f];a[c]=d}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let d={};if(this.deletedStates[c]===null)for(let f in this.state[c])d[f]={},this.state[c][f]={};else for(let f in this.deletedStates[c]){if(this.deletedStates[c][f]===null)this.state[c][f]={};else if(this.state[c][f])for(let _ of Object.keys(this.deletedStates[c][f]))delete this.state[c][f][_];d[f]=this.state[c][f]}a[c]=a[c]||{},li(a[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let c in e)e[c].setFeatureState(a,n)}}class HD{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ue(it,16,0),this.featureIndexArray=new rI,this.promoteId=n,this.is3DTile=!1}insert(e,n,a,c,d,f=0,_=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,d,f);let b=this.grid;for(let T=0;T<n.length;T++){let S=n[T],D=[1/0,1/0,-1/0,-1/0];for(let R=0;R<S.length;R++){let O=S[R];D[0]=Math.min(D[0],O.x),D[1]=Math.min(D[1],O.y),D[2]=Math.max(D[2],O.x),D[3]=Math.max(D[3],O.y)}_!==0&&(D[0]-=_,D[1]-=_,D[2]+=_,D[3]+=_),D[0]<it&&D[1]<it&&D[2]>=0&&D[3]>=0&&b.insert(y,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ib(new Vd(this.rawTileData)).layers,this.sourceLayerCoder=new zD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,c){this.loadVTLayers();let d=e.params||{},f=bi(d.filter),_=e.tileResult,y=e.transform,b=_.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(O,F,z,j)=>xI(_.bufferedTilespaceGeometry,O,F,z,j));T.sort(Uz);let S=null;y.elevation&&T.length>0&&(S=Nd.create(y.elevation,this.tileID));let D={},R;for(let O=0;O<T.length;O++){let F=T[O];if(F===R)continue;R=F;let z=this.featureIndexArray.get(F),j=null;if(this.is3DTile){let X=this.bucketLayerIDs[0][0],Y=n[X];if(Y.type!=="model")continue;let{queryFeature:K,intersectionZ:le}=Y.queryIntersectsMatchingFeature(_,z.featureIndex,f,y);K&&this.appendToResult(D,X,z.featureIndex,K,le)}else this.loadMatchingFeature(D,z,f,d.layers,d.availableImages,n,a,c,(X,Y,K,le=0)=>(j||(j=ps(X,this.tileID.canonical,e.tileTransform)),Y.queryIntersectsFeature(_,X,K,j,this.z,e.transform,e.pixelPosMatrix,S,le)))}return D}loadMatchingFeature(e,n,a,c,d,f,_,y,b){let{featureIndex:T,bucketIndex:S,sourceLayerIndex:D,layoutVertexArrayOffset:R}=n,O=this.bucketLayerIDs[S];if(c&&!function(X,Y){for(let K=0;K<X.length;K++)if(Y.indexOf(X[K])>=0)return!0;return!1}(c,O))return;let F=this.sourceLayerCoder.decode(D),z=this.vtLayers[F].feature(T);if(a.needGeometry){let X=Xa(z,!0);if(!a.filter(new Bt(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!a.filter(new Bt(this.tileID.overscaledZ),z))return;let j=this.getId(z,F);for(let X=0;X<O.length;X++){let Y=O[X];if(c&&c.indexOf(Y)<0)continue;let K=f[Y];if(!K)continue;let le={};j!==void 0&&y&&(le=y.getState(K.sourceLayer||"_geojsonTileLayer",j));let se=!b||b(z,K,le,R);if(!se)continue;let pe=new GD(z,this.z,this.x,this.y,j),_e=li({},_[Y]);_e.paint=qD(_e.paint,K.paint,z,le,d),_e.layout=qD(_e.layout,K.layout,z,le,d),pe.layer=_e,this.appendToResult(e,Y,T,pe,se)}}appendToResult(e,n,a,c,d){let f=e[n];f===void 0&&(f=e[n]=[]),f.push({featureIndex:a,feature:c,intersectionZ:d})}lookupSymbolFeatures(e,n,a,c,d,f,_,y){let b={};this.loadVTLayers();let T=bi(d);for(let S of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:c,featureIndex:S,layoutVertexArrayOffset:0},T,f,_,y,n);return b}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(a),d=this.vtFeatures[c];if(d[n])return d[n];let f=this.vtLayers[c].feature(n);return d[n]=f,f}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(a=e.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function qD(t,e,n,a,c){return Al(t,(d,f)=>{let _=e instanceof un?e.get(f):null;return _&&_.evaluate?_.evaluate(n,a,c):_})}function Uz(t,e){return e-t}J(HD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var di=24;let ms=128;function Ob(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Bt(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:c}=n,d=0;for(;d<a.length&&a[d]<=t;)d++;d=Math.max(0,d-1);let f=d;for(;f<a.length&&a[f]<t+1;)f++;f=Math.min(a.length-1,f);let _=a[d],y=a[f];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:y,minSize:n.evaluate(new Bt(_)),maxSize:n.evaluate(new Bt(y)),interpolationType:c}}}function Ky(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:c}){return t.kind==="source"?a/ms:t.kind==="composite"?It(a/ms,c/ms,n):e}function jd(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:c,minZoom:d,maxZoom:f}=t,_=c?Qt(Hi.interpolationFactor(c,e,d,f),0,1):0;t.kind==="camera"?a=It(t.minSize,t.maxSize,_):n=_}return{uSizeT:n,uSize:a}}var $z=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ms,evaluateSizeForFeature:Ky,evaluateSizeForZoom:jd,getSizeData:Ob});function Gz(t,e,n){return t.sections.forEach(a=>{a.text=function(c,d,f){let _=d.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),An.applyArabicShaping&&(c=An.applyArabicShaping(c)),c}(a.text,e,n)}),t}let Am={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function Hz(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function qz(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let kb=3;function Wz(t,e,n){e.glyphs=[],t===1&&n.readMessage(Zz,e)}function Zz(t,e,n){if(t===3){let{id:a,bitmap:c,width:d,height:f,left:_,top:y,advance:b}=n.readMessage(Xz,{});e.glyphs.push({id:a,bitmap:new ac({width:d+2*kb,height:f+2*kb},c),metrics:{width:d,height:f,left:_,top:y,advance:b}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function Xz(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let WD=kb,So={horizontal:1,vertical:2,horizontalOnly:3};class Pm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new Pm;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new Pm;return n.imageName=e,n}}class Ud{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new Ud;for(let c=0;c<e.sections.length;c++){let d=e.sections[c];d.image?a.addImageSection(d):a.addTextSection(d,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let c="";for(let d=0;d<n.length;d++){let f=n.charCodeAt(d+1)||null,_=n.charCodeAt(d-1)||null;c+=!a&&(f&&Ve(f)&&!Am[n[d+1]]||_&&Ve(_)&&!Am[n[d-1]])||!Am[n[d]]?n[d]:Am[n[d]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Qy[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Qy[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new Ud;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Pm.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void wr("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Pm.forImage(n)),this.sectionIndex.push(this.sections.length-1)):wr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lb(t,e,n,a,c,d,f,_,y,b,T,S,D,R,O){let F=Ud.fromFeature(t,c);S===So.vertical&&F.verticalizePunctuation(D);let z=[],j=function(se,pe,_e,Ee,Oe,De){if(!se)return[];let Ne=[],Xe=function(We,Je,Ze,ht,Ye,tt){let Et=0;for(let yt=0;yt<We.length();yt++){let gt=We.getSection(yt);Et+=ZD(We.getCodePoint(yt),gt,ht,Ye,Je,tt)}return Et/Math.max(1,Math.ceil(Et/Ze))}(se,pe,_e,Ee,Oe,De),Le=se.text.indexOf("\u200B")>=0,qe=0;for(let We=0;We<se.length();We++){let Je=se.getSection(We),Ze=se.getCodePoint(We);if(Qy[Ze]||(qe+=ZD(Ze,Je,Ee,Oe,pe,De)),We<se.length()-1){let ht=!((ke=Ze)<11904||!(ae["Bopomofo Extended"](ke)||ae.Bopomofo(ke)||ae["CJK Compatibility Forms"](ke)||ae["CJK Compatibility Ideographs"](ke)||ae["CJK Compatibility"](ke)||ae["CJK Radicals Supplement"](ke)||ae["CJK Strokes"](ke)||ae["CJK Symbols and Punctuation"](ke)||ae["CJK Unified Ideographs Extension A"](ke)||ae["CJK Unified Ideographs"](ke)||ae["Enclosed CJK Letters and Months"](ke)||ae["Halfwidth and Fullwidth Forms"](ke)||ae.Hiragana(ke)||ae["Ideographic Description Characters"](ke)||ae["Kangxi Radicals"](ke)||ae["Katakana Phonetic Extensions"](ke)||ae.Katakana(ke)||ae["Vertical Forms"](ke)||ae["Yi Radicals"](ke)||ae["Yi Syllables"](ke)));(Yz[Ze]||ht||Je.imageName)&&Ne.push(YD(We+1,qe,Xe,Ne,Kz(Ze,se.getCodePoint(We+1),ht&&Le),!1))}}var ke;return KD(YD(se.length(),qe,Xe,Ne,0,!0))}(F,b,d,e,a,R),{processBidirectionalText:X,processStyledBidirectionalText:Y}=An;if(X&&F.sections.length===1){let se=X(F.toString(),j);for(let pe of se){let _e=new Ud;_e.text=pe,_e.sections=F.sections;for(let Ee=0;Ee<pe.length;Ee++)_e.sectionIndex.push(0);z.push(_e)}}else if(Y){let se=Y(F.text,F.sectionIndex,j);for(let pe of se){let _e=new Ud;_e.text=pe[0],_e.sectionIndex=pe[1],_e.sections=F.sections,z.push(_e)}}else z=function(se,pe){let _e=[],Ee=se.text,Oe=0;for(let De of pe)_e.push(se.substring(Oe,De)),Oe=De;return Oe<Ee.length&&_e.push(se.substring(Oe,Ee.length)),_e}(F,j);let K=[],le={positionedLines:K,text:F.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,pe,_e,Ee,Oe,De,Ne,Xe,Le,qe,ke,We){let Je=0,Ze=0,ht=0,Ye=Xe==="right"?1:Xe==="left"?0:.5,tt=!1;for(let qt of Oe){let At=qt.getSections();for(let Xt of At){if(Xt.imageName)continue;let Wt=pe[Xt.fontStack];if(Wt&&(tt=Wt.ascender!==void 0&&Wt.descender!==void 0,!tt))break}if(!tt)break}let Et=0;for(let qt of Oe){qt.trim();let At=qt.getMaxScale(),Xt=(At-1)*di,Wt={positionedGlyphs:[],lineOffset:0};se.positionedLines[Et]=Wt;let nn=Wt.positionedGlyphs,Dt=0;if(!qt.length()){Ze+=De,++Et;continue}let Bn=0,Nn=0;for(let hn=0;hn<qt.length();hn++){let Cn=qt.getSection(hn),Yn=qt.getSectionIndex(hn),Hn=qt.getCodePoint(hn),pr=Cn.scale,hr=null,Ei=null,vr=null,or=di,Rr=0,ei=!(Le===So.horizontal||!ke&&!Ge(Hn)||ke&&(Qy[Hn]||(yt=Hn,ae.Arabic(yt)||ae["Arabic Supplement"](yt)||ae["Arabic Extended-A"](yt)||ae["Arabic Presentation Forms-A"](yt)||ae["Arabic Presentation Forms-B"](yt))));if(Cn.imageName){let ti=Ee[Cn.imageName];if(!ti)continue;vr=Cn.imageName,se.iconsInText=se.iconsInText||!0,Ei=ti.paddedRect;let Wn=ti.displaySize;pr=pr*di/We,hr={width:Wn[0],height:Wn[1],left:0,top:-WD,advance:ei?Wn[1]:Wn[0],localGlyph:!1},Rr=tt?-hr.height*pr:At*di-17-Wn[1]*pr,or=hr.advance;let ji=(ei?Wn[0]:Wn[1])*pr-di*At;ji>0&&ji>Dt&&(Dt=ji)}else{let ti=_e[Cn.fontStack];if(!ti)continue;ti[Hn]&&(Ei=ti[Hn]);let Wn=pe[Cn.fontStack];if(!Wn)continue;let ji=Wn.glyphs[Hn];if(!ji)continue;if(hr=ji.metrics,or=Hn!==8203?di:0,tt){let el=Wn.ascender!==void 0?Math.abs(Wn.ascender):0,Yo=Wn.descender!==void 0?Math.abs(Wn.descender):0,ws=(el+Yo)*pr;Bn<ws&&(Bn=ws,Nn=(el-Yo)/2*pr),Rr=-el*pr}else Rr=(At-pr)*di-17}ei?(se.verticalizable=!0,nn.push({glyph:Hn,imageName:vr,x:Je,y:Ze+Rr,vertical:ei,scale:pr,localGlyph:hr.localGlyph,fontStack:Cn.fontStack,sectionIndex:Yn,metrics:hr,rect:Ei}),Je+=or*pr+qe):(nn.push({glyph:Hn,imageName:vr,x:Je,y:Ze+Rr,vertical:ei,scale:pr,localGlyph:hr.localGlyph,fontStack:Cn.fontStack,sectionIndex:Yn,metrics:hr,rect:Ei}),Je+=hr.advance*pr+qe)}nn.length!==0&&(ht=Math.max(Je-qe,ht),tt?QD(nn,Ye,Dt,Nn,De*At/2):QD(nn,Ye,Dt,0,De/2)),Je=0;let Tn=De*At+Dt;Wt.lineOffset=Math.max(Dt,Xt),Ze+=Tn,++Et}var yt;let gt=Ze,{horizontalAlign:et,verticalAlign:Ct}=Fb(Ne);(function(qt,At,Xt,Wt,nn,Dt){let Bn=(At-Xt)*nn,Nn=-Dt*Wt;for(let Tn of qt)for(let hn of Tn.positionedGlyphs)hn.x+=Bn,hn.y+=Nn})(se.positionedLines,Ye,et,Ct,ht,gt),se.top+=-Ct*gt,se.bottom=se.top+gt,se.left+=-et*ht,se.right=se.left+ht,se.hasBaseline=tt}(le,e,n,a,z,f,_,y,S,b,D,O),!function(se){for(let pe of se)if(pe.positionedGlyphs.length!==0)return!1;return!0}(K)&&le}let Qy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ZD(t,e,n,a,c,d){if(e.imageName){let f=a[e.imageName];return f?f.displaySize[0]*e.scale*di/d+c:0}{let f=n[e.fontStack],_=f&&f.glyphs[t];return _?_.metrics.advance*e.scale+c:0}}function XD(t,e,n,a){let c=Math.pow(t-e,2);return a?t<e?c/2:2*c:c+Math.abs(n)*n}function Kz(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function YD(t,e,n,a,c,d){let f=null,_=XD(e,n,c,d);for(let y of a){let b=XD(e-y.x,n,c,d)+y.badness;b<=_&&(f=y,_=b)}return{index:t,x:e,priorBreak:f,badness:_}}function KD(t){return t?KD(t.priorBreak).concat(t.index):[]}function Fb(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function QD(t,e,n,a,c){if(!(e||n||a||c))return;let d=t.length-1,f=t[d],_=(f.x+f.metrics.advance*f.scale)*e;for(let y=0;y<=d;y++)t[y].x-=_,t[y].y+=n+a+c}function Qz(t,e,n,a){let{horizontalAlign:c,verticalAlign:d}=Fb(a),f=n[0]-t.displaySize[0]*c,_=n[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function JD(t,e,n,a,c,d){let f=t.imagePrimary,_;if(f.content){let z=f.content,j=f.pixelRatio||1;_=[z[0]/j,z[1]/j,f.displaySize[0]-z[2]/j,f.displaySize[1]-z[3]/j]}let y=e.left*d,b=e.right*d,T,S,D,R;n==="width"||n==="both"?(R=c[0]+y-a[3],S=c[0]+b+a[1]):(R=c[0]+(y+b-f.displaySize[0])/2,S=R+f.displaySize[0]);let O=e.top*d,F=e.bottom*d;return n==="height"||n==="both"?(T=c[1]+O-a[0],D=c[1]+F+a[2]):(T=c[1]+(O+F-f.displaySize[1])/2,D=T+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:T,right:S,bottom:D,left:R,collisionPadding:_}}class Ja extends lt{constructor(e,n,a,c,d){super(e,n),this.angle=c,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new Ja(this.x,this.y,this.z,this.angle,this.segment)}}function eM(t,e,n,a,c){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,_=0;for(;_>-n/2;){if(f--,f<0)return!1;_-=t[f].dist(d),d=t[f]}_+=t[f].dist(t[f+1]),f++;let y=[],b=0;for(;_<n/2;){let T=t[f],S=t[f+1];if(!S)return!1;let D=t[f-1].angleTo(T)-T.angleTo(S);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:D}),b+=D;_-y[0].distance>a;)b-=y.shift().angleDelta;if(b>c)return!1;f++,_+=T.dist(S)}return!0}function tM(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function nM(t,e,n){return t?.6*e*n:0}function rM(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Jz(t,e,n,a,c,d){let f=nM(n,c,d),_=rM(n,a)*d,y=0,b=tM(t)/2;for(let T=0;T<t.length-1;T++){let S=t[T],D=t[T+1],R=S.dist(D);if(y+R>b){let O=(b-y)/R,F=It(S.x,D.x,O),z=It(S.y,D.y,O),j=new Ja(F,z,0,D.angleTo(S),T);return!f||eM(t,j,_,f,e)?j:void 0}y+=R}}function eB(t,e,n,a,c,d,f,_,y){let b=nM(a,d,f),T=rM(a,c),S=T*f,D=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-S<e/4&&(e=S+e/4),iM(t,D?e/2*_%e:(T/2+2*d)*f*_%e,e,b,n,S,D,!1,y)}function iM(t,e,n,a,c,d,f,_,y){let b=d/2,T=tM(t),S=0,D=e-n,R=[];for(let O=0;O<t.length-1;O++){let F=t[O],z=t[O+1],j=F.dist(z),X=z.angleTo(F);for(;D+n<S+j;){D+=n;let Y=(D-S)/j,K=It(F.x,z.x,Y),le=It(F.y,z.y,Y);if(K>=0&&K<y&&le>=0&&le<y&&D-b>=0&&D+b<=T){let se=new Ja(K,le,0,X,O);a&&!eM(t,se,d,a,c)||R.push(se)}}S+=j}return _||R.length||f||(R=iM(t,S/2,n,a,c,d,f,!0,y)),R}function oM(t,e,n,a,c){let d=[];for(let f=0;f<t.length;f++){let _=t[f],y;for(let b=0;b<_.length-1;b++){let T=_[b],S=_[b+1];T.x<e&&S.x<e||(T.x<e?T=new lt(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x<e&&(S=new lt(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y<n&&S.y<n||(T.y<n?T=new lt(T.x+(n-T.y)/(S.y-T.y)*(S.x-T.x),n)._round():S.y<n&&(S=new lt(T.x+(n-T.y)/(S.y-T.y)*(S.x-T.x),n)._round()),T.x>=a&&S.x>=a||(T.x>=a?T=new lt(a,T.y+(a-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x>=a&&(S=new lt(a,T.y+(a-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y>=c&&S.y>=c||(T.y>=c?T=new lt(T.x+(c-T.y)/(S.y-T.y)*(S.x-T.x),c)._round():S.y>=c&&(S=new lt(T.x+(c-T.y)/(S.y-T.y)*(S.x-T.x),c)._round()),y&&T.equals(y[y.length-1])||(y=[T],d.push(y)),y.push(S)))))}}return d}function sM(t){let e=0,n=0;for(let f of t)e+=f.w*f.h,n=Math.max(n,f.w);t.sort((f,_)=>_.h-f.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,d=0;for(let f of t)for(let _=a.length-1;_>=0;_--){let y=a[_];if(!(f.w>y.w||f.h>y.h)){if(f.x=y.x,f.y=y.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===y.w&&f.h===y.h){let b=a.pop();_<a.length&&(a[_]=b)}else f.h===y.h?(y.x+=f.w,y.w-=f.w):f.w===y.w?(y.y+=f.h,y.h-=f.h):(a.push({x:y.x+f.w,y:y.y,w:y.w-f.w,h:f.h}),y.y+=f.h,y.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}J(Ja,"Anchor");let ao=1;class Nb{constructor(e,{pixelRatio:n,version:a,stretchX:c,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=d,this.content=f,this.version=a}get tl(){return[this.paddedRect.x+ao,this.paddedRect.y+ao]}get br(){return[this.paddedRect.x+this.paddedRect.w-ao,this.paddedRect.y+this.paddedRect.h-ao]}get displaySize(){return[(this.paddedRect.w-2*ao)/this.pixelRatio,(this.paddedRect.h-2*ao)/this.pixelRatio]}}class aM{constructor(e,n,a){let c={},d={};this.haveRenderCallbacks=[];let f=[];this.addImages(e,c,f),this.addImages(n,d,f);let{w:_,h:y}=sM(f),b=new Co({width:_||1,height:y||1});for(let T in e){let S=e[T],D=c[T].paddedRect;Co.copy(S.data,b,{x:0,y:0},{x:D.x+ao,y:D.y+ao},S.data,a,S.sdf)}for(let T in n){let S=n[T],D=d[T].paddedRect,R=D.x+ao,O=D.y+ao,F=S.data.width,z=S.data.height;Co.copy(S.data,b,{x:0,y:0},{x:R,y:O},S.data,a),Co.copy(S.data,b,{x:0,y:z-1},{x:R,y:O-1},{width:F,height:1},a),Co.copy(S.data,b,{x:0,y:0},{x:R,y:O+z},{width:F,height:1},a),Co.copy(S.data,b,{x:F-1,y:0},{x:R-1,y:O},{width:1,height:z},a),Co.copy(S.data,b,{x:0,y:0},{x:R+F,y:O},{width:1,height:z},a)}this.image=b,this.iconPositions=c,this.patternPositions=d}addImages(e,n,a){for(let c in e){let d=e[c],f={x:0,y:0,w:d.data.width+2*ao,h:d.data.height+2*ao};a.push(f),n[c]=new Nb(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let c in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,a),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,d]=e.tl,f=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:f},{x:c,y:d})}}J(Nb,"ImagePosition"),J(aM,"ImageAtlas");let Rm=1e20;function lM(t,e,n,a,c,d,f,_,y){for(let b=e;b<e+a;b++)cM(t,n*d+b,d,c,f,_,y);for(let b=n;b<n+c;b++)cM(t,b*d+e,1,a,f,_,y)}function cM(t,e,n,a,c,d,f){d[0]=0,f[0]=-Rm,f[1]=Rm,c[0]=t[e];for(let _=1,y=0,b=0;_<a;_++){c[_]=t[e+_*n];let T=_*_;do{let S=d[y];b=(c[_]-c[S]+T-S*S)/(_-S)/2}while(b<=f[y]&&--y>-1);y++,d[y]=_,f[y]=b,f[y+1]=Rm}for(let _=0,y=0;_<a;_++){for(;f[y+1]<_;)y++;let b=d[y],T=_-b;t[e+_*n]=c[b]+T*T}}let gs=2,zb={none:0,ideographs:1,all:2};class $d{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){let c=[],d=this.urls[n]||A.GLYPHS_URL;for(let f in e)for(let _ of e[f])c.push({stack:f,id:_});Ml(c,({stack:f,id:_},y)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[_];if(T!==void 0)return void y(null,{stack:f,id:_,glyph:T});if(T=this._tinySDF(b,f,_),T)return b.glyphs[_]=T,void y(null,{stack:f,id:_,glyph:T});let S=Math.floor(_/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[S])return void y(null,{stack:f,id:_,glyph:T});let D=b.requests[S];D||(D=b.requests[S]=[],$d.loadGlyphRange(f,S,d,this.requestManager,(R,O)=>{if(O){b.ascender=O.ascender,b.descender=O.descender;for(let F in O.glyphs)this._doesCharSupportLocalGlyph(+F)||(b.glyphs[+F]=O.glyphs[+F]);b.ranges[S]=!0}for(let F of D)F(R,O);delete b.requests[S]})),D.push((R,O)=>{R?y(R):O&&y(null,{stack:f,id:_,glyph:O.glyphs[_]||null})})},(f,_)=>{if(f)a(f);else if(_){let y={};for(let{stack:b,id:T,glyph:S}of _)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==zb.none&&(this.localGlyphMode===zb.all?!!this.localFontFamily:!!this.localFontFamily&&(ae["CJK Unified Ideographs"](e)||ae["Hangul Syllables"](e)||ae.Hiragana(e)||ae.Katakana(e)||ae["CJK Symbols and Punctuation"](e)||ae["CJK Unified Ideographs Extension A"](e)||ae["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(n)?F="900":/medium/i.test(n)?F="500":/light/i.test(n)&&(F="200"),d=e.tinySDF=new $d.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*gs,buffer:3*gs,radius:8*gs}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];let f=String.fromCodePoint(a),{data:_,width:y,height:b,glyphWidth:T,glyphHeight:S,glyphLeft:D,glyphTop:R,glyphAdvance:O}=d.draw(f);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new ac({width:y,height:b},_),metrics:{width:T/gs,height:S/gs,left:D/gs,top:R/gs-27,advance:O/gs,localGlyph:!0}}}}$d.loadGlyphRange=function(t,e,n,a,c){let d=256*e,f=d+255,_=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${d}-${f}`),td.Glyphs);Oa(_,(y,b)=>{if(y)c(y);else if(b){let T={},S=function(D){return new Vd(D).readFields(Wz,{})}(b);for(let D of S.glyphs)T[D.id]=D;c(null,{glyphs:T,ascender:S.ascender,descender:S.descender})}})},$d.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let _=this.size=t+4*e,y=this._createCanvas(_),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${d} ${t}px ${c}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(t),f=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),y=Math.min(this.size-this.buffer,f+Math.ceil(a)),b=_+2*this.buffer,T=y+2*this.buffer,S=Math.max(b*T,0),D=new Uint8ClampedArray(S),R={data:D,width:b,height:T,glyphWidth:_,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return R;let{ctx:O,buffer:F,gridInner:z,gridOuter:j}=this;O.clearRect(F,F,_,y),O.fillText(t,F,F+f);let X=O.getImageData(F,F,_,y);j.fill(Rm,0,S),z.fill(0,0,S);for(let Y=0;Y<y;Y++)for(let K=0;K<_;K++){let le=X.data[4*(Y*_+K)+3]/255;if(le===0)continue;let se=(Y+F)*b+K+F;if(le===1)j[se]=0,z[se]=Rm;else{let pe=.5-le;j[se]=pe>0?pe*pe:0,z[se]=pe<0?pe*pe:0}}lM(j,0,0,b,T,b,this.f,this.v,this.z),lM(z,F,F,_,y,b,this.f,this.v,this.z);for(let Y=0;Y<S;Y++){let K=Math.sqrt(j[Y])-Math.sqrt(z[Y]);D[Y]=Math.round(255-255*(K/this.radius+this.cutoff))}return R}};let uc=ao;function uM(t,e,n,a){let c=[],d=t.imagePrimary,f=d.pixelRatio,_=d.paddedRect.w-2*uc,y=d.paddedRect.h-2*uc,b=t.right-t.left,T=t.bottom-t.top,S=d.stretchX||[[0,_]],D=d.stretchY||[[0,y]],R=(De,Ne)=>De+Ne[1]-Ne[0],O=S.reduce(R,0),F=D.reduce(R,0),z=_-O,j=y-F,X=0,Y=O,K=0,le=F,se=0,pe=z,_e=0,Ee=j;if(d.content&&a){let De=d.content;X=Jy(S,0,De[0]),K=Jy(D,0,De[1]),Y=Jy(S,De[0],De[2]),le=Jy(D,De[1],De[3]),se=De[0]-X,_e=De[1]-K,pe=De[2]-De[0]-Y,Ee=De[3]-De[1]-le}let Oe=(De,Ne,Xe,Le)=>{let qe=e0(De.stretch-X,Y,b,t.left),ke=t0(De.fixed-se,pe,De.stretch,O),We=e0(Ne.stretch-K,le,T,t.top),Je=t0(Ne.fixed-_e,Ee,Ne.stretch,F),Ze=e0(Xe.stretch-X,Y,b,t.left),ht=t0(Xe.fixed-se,pe,Xe.stretch,O),Ye=e0(Le.stretch-K,le,T,t.top),tt=t0(Le.fixed-_e,Ee,Le.stretch,F),Et=new lt(qe,We),yt=new lt(Ze,We),gt=new lt(Ze,Ye),et=new lt(qe,Ye),Ct=new lt(ke/f,Je/f),qt=new lt(ht/f,tt/f),At=e*Math.PI/180;if(At){let Nn=Math.sin(At),Tn=Math.cos(At),hn=[Tn,-Nn,Nn,Tn];Et._matMult(hn),yt._matMult(hn),et._matMult(hn),gt._matMult(hn)}let Xt=De.stretch+De.fixed,Wt=Xe.stretch+Xe.fixed,nn=Ne.stretch+Ne.fixed,Dt=Le.stretch+Le.fixed,Bn=t.imageSecondary;return{tl:Et,tr:yt,bl:et,br:gt,texPrimary:{x:d.paddedRect.x+uc+Xt,y:d.paddedRect.y+uc+nn,w:Wt-Xt,h:Dt-nn},texSecondary:Bn?{x:Bn.paddedRect.x+uc+Xt,y:Bn.paddedRect.y+uc+nn,w:Wt-Xt,h:Dt-nn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ct,pixelOffsetBR:qt,minFontScaleX:pe/f/b,minFontScaleY:Ee/f/T,isSDF:n}};if(a&&(d.stretchX||d.stretchY)){let De=hM(S,z,O),Ne=hM(D,j,F);for(let Xe=0;Xe<De.length-1;Xe++){let Le=De[Xe],qe=De[Xe+1];for(let ke=0;ke<Ne.length-1;ke++)c.push(Oe(Le,Ne[ke],qe,Ne[ke+1]))}}else c.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return c}function Jy(t,e,n){let a=0;for(let c of t)a+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return a}function hM(t,e,n){let a=[{fixed:-uc,stretch:0}];for(let[c,d]of t){let f=a[a.length-1];a.push({fixed:c-f.stretch,stretch:f.stretch}),a.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return a.push({fixed:e+uc,stretch:n}),a}function e0(t,e,n,a){return t/e*n+a}function t0(t,e,n,a){return t-e*n/a}function tB(t,e,n,a){let c=e+t.positionedLines[a].lineOffset;return a===0?n+c/2:n+(c+(e+t.positionedLines[a-1].lineOffset))/2}function nB(t,e=1,n=!1){let a=1/0,c=1/0,d=-1/0,f=-1/0,_=t[0];for(let R=0;R<_.length;R++){let O=_[R];(!R||O.x<a)&&(a=O.x),(!R||O.y<c)&&(c=O.y),(!R||O.x>d)&&(d=O.x),(!R||O.y>f)&&(f=O.y)}let y=Math.min(d-a,f-c),b=y/2,T=new qp([],rB);if(y===0)return new lt(a,c);for(let R=a;R<d;R+=y)for(let O=c;O<f;O+=y)T.push(new Gd(R+b,O+b,b,t));let S=function(R){let O=0,F=0,z=0,j=R[0];for(let X=0,Y=j.length,K=Y-1;X<Y;K=X++){let le=j[X],se=j[K],pe=le.x*se.y-se.x*le.y;F+=(le.x+se.x)*pe,z+=(le.y+se.y)*pe,O+=3*pe}return new Gd(F/O,z/O,0,R)}(t),D=T.length;for(;T.length;){let R=T.pop();(R.d>S.d||!S.d)&&(S=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,D)),R.max-S.d<=e||(b=R.h/2,T.push(new Gd(R.p.x-b,R.p.y-b,b,t)),T.push(new Gd(R.p.x+b,R.p.y-b,b,t)),T.push(new Gd(R.p.x-b,R.p.y+b,b,t)),T.push(new Gd(R.p.x+b,R.p.y+b,b,t)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${S.d}`)),S.p}function rB(t,e){return e.max-t.max}class Gd{constructor(e,n,a,c){this.p=new lt(e,n),this.h=a,this.d=function(d,f){let _=!1,y=1/0;for(let b=0;b<f.length;b++){let T=f[b];for(let S=0,D=T.length,R=D-1;S<D;R=S++){let O=T[S],F=T[R];O.y>d.y!=F.y>d.y&&d.x<(F.x-O.x)*(d.y-O.y)/(F.y-O.y)+O.x&&(_=!_),y=Math.min(y,yI(d,O,F))}}return(_?1:-1)*Math.sqrt(y)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let Bb=Number.POSITIVE_INFINITY,iB=Math.sqrt(2);function dM(t,[e,n]){let a=0,c=0;if(n===Bb){e<0&&(e=0);let d=e/iB;switch(t){case"top-right":case"top-left":c=d-7;break;case"bottom-right":case"bottom-left":c=7-d;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function Vb(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function oB(t,e,n,a,c,d,f,_,y,b,T,S,D,R,O){let F=d.textMaxSize.evaluate(e,{},S);F===void 0&&(F=f);let z=t.layers[0].layout,j=z.get("icon-offset").evaluate(e,{},S),X=pM(n.horizontal)||n.vertical,Y=D.name==="globe",K=di,le=f/K,se=t.tilePixelRatio*F/K,pe=(qe=t.overscaling,t.zoom>18&&qe>2&&(qe>>=1),Math.max(it/(512*qe),1)*z.get("symbol-spacing")),_e=z.get("text-padding")*t.tilePixelRatio,Ee=z.get("icon-padding")*t.tilePixelRatio,Oe=ln(z.get("text-max-angle")),De=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ne=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Xe=z.get("symbol-placement"),Le=pe/2;var qe;let ke=z.get("icon-text-fit").evaluate(e,{},S),We=z.get("icon-text-fit-padding").evaluate(e,{},S),Je=ke!=="none",Ze;t.hasAnyIconTextFit===!1&&Je&&(t.hasAnyIconTextFit=!0),a&&Je&&(t.allowVerticalPlacement&&n.vertical&&(Ze=JD(a,n.vertical,ke,We,j,le)),X&&(a=JD(a,X,ke,We,j,le)));let ht=(Ye,tt,Et)=>{if(tt.x<0||tt.x>=it||tt.y<0||tt.y>=it)return;let yt=null;if(Y){let{x:gt,y:et,z:Ct}=D.projectTilePoint(tt.x,tt.y,Et);yt={anchor:new Ja(gt,et,Ct,0,void 0),up:D.upVector(Et,tt.x,tt.y)}}(function(gt,et,Ct,qt,At,Xt,Wt,nn,Dt,Bn,Nn,Tn,hn,Cn,Yn,Hn,pr,hr,Ei,vr,or,Rr,ei,ti,Wn,ji,el){let Yo=gt.addToLineVertexArray(et,qt),ws,_c,yc,Yu,m2,g2,_2,y2=0,v2=0,x2=0,b2=0,mw=-1,gw=-1,na={},w2=Nl(""),Ku=Ct?Ct.anchor:et,_w=Dt.layout.get("icon-text-fit").evaluate(or,{},Wn)!=="none",yw=0,vw=0;if(Dt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[yw,vw]=Dt.layout.get("text-offset").evaluate(or,{},Wn).map(co=>co*di):(yw=Dt.layout.get("text-radial-offset").evaluate(or,{},Wn)*di,vw=Bb),gt.allowVerticalPlacement&&At.vertical){let co=At.vertical;if(Yn)g2=jb(co),nn&&(_2=jb(nn));else{let uo=Dt.layout.get("text-rotate").evaluate(or,{},Wn)+90;yc=n0(Bn,Ku,et,Nn,Tn,hn,co,Cn,uo,Hn),nn&&(Yu=n0(Bn,Ku,et,Nn,Tn,hn,nn,hr,uo))}}if(Xt){let co=Dt.layout.get("icon-rotate").evaluate(or,{},Wn),uo=uM(Xt,co,ei,_w),Jd=nn?uM(nn,co,ei,_w):void 0;_c=n0(Bn,Ku,et,Nn,Tn,hn,Xt,hr,co),y2=4*uo.length;let E2=gt.iconSizeData,Qu=null;E2.kind==="source"?(Qu=[ms*Dt.layout.get("icon-size").evaluate(or,{},Wn)],Qu[0]>hc&&wr(`${gt.layerIds[0]}: Value for "icon-size" is >= ${Om}. Reduce your "icon-size".`)):E2.kind==="composite"&&(Qu=[ms*Rr.compositeIconSizes[0].evaluate(or,{},Wn),ms*Rr.compositeIconSizes[1].evaluate(or,{},Wn)],(Qu[0]>hc||Qu[1]>hc)&&wr(`${gt.layerIds[0]}: Value for "icon-size" is >= ${Om}. Reduce your "icon-size".`)),gt.addSymbols(gt.icon,uo,Qu,vr,Ei,or,!1,Ct,et,Yo.lineStartIndex,Yo.lineLength,-1,ti,Wn,ji,el),mw=gt.icon.placedSymbolArray.length-1,Jd&&(v2=4*Jd.length,gt.addSymbols(gt.icon,Jd,Qu,vr,Ei,or,So.vertical,Ct,et,Yo.lineStartIndex,Yo.lineLength,-1,ti,Wn,ji,el),gw=gt.icon.placedSymbolArray.length-1)}for(let co in At.horizontal){let uo=At.horizontal[co];ws||(w2=Nl(uo.text),Yn?m2=jb(uo):ws=n0(Bn,Ku,et,Nn,Tn,hn,uo,Cn,Dt.layout.get("text-rotate").evaluate(or,{},Wn),Hn));let Jd=uo.positionedLines.length===1;if(x2+=fM(gt,Ct,et,uo,Wt,Dt,Yn,or,Hn,Yo,At.vertical?So.horizontal:So.horizontalOnly,Jd?Object.keys(At.horizontal):[co],na,mw,Rr,ti,Wn,ji),Jd)break}At.vertical&&(b2+=fM(gt,Ct,et,At.vertical,Wt,Dt,Yn,or,Hn,Yo,So.vertical,["vertical"],na,gw,Rr,ti,Wn,ji));let vc=-1,xw=(co,uo)=>co?Math.max(co,uo):uo;vc=xw(m2,vc),vc=xw(g2,vc),vc=xw(_2,vc);let T5=vc>-1?1:0;gt.glyphOffsetArray.length>=65535&&wr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),or.sortKey!==void 0&&gt.addToSortKeyRanges(gt.symbolInstances.length,or.sortKey),gt.symbolInstances.emplaceBack(et.x,et.y,Ku.x,Ku.y,Ku.z,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical>=0?na.vertical:-1,mw,gw,w2,ws!==void 0?ws:gt.collisionBoxArray.length,ws!==void 0?ws+1:gt.collisionBoxArray.length,yc!==void 0?yc:gt.collisionBoxArray.length,yc!==void 0?yc+1:gt.collisionBoxArray.length,_c!==void 0?_c:gt.collisionBoxArray.length,_c!==void 0?_c+1:gt.collisionBoxArray.length,Yu||gt.collisionBoxArray.length,Yu?Yu+1:gt.collisionBoxArray.length,Nn,x2,b2,y2,v2,T5,0,yw,vw,vc,0,1,1,_w?1:0)})(t,tt,yt,Ye,n,a,c,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,De,y,0,Ee,Ne,j,e,d,b,T,S,R,O)};if(Xe==="line")for(let Ye of oM(e.geometry,0,0,it,it)){let tt=eB(Ye,pe,Oe,n.vertical||X,a,K,se,t.overscaling,it);for(let Et of tt)X&&sB(t,X.text,Le,Et)||ht(Ye,Et,S)}else if(Xe==="line-center"){for(let Ye of e.geometry)if(Ye.length>1){let tt=Jz(Ye,Oe,n.vertical||X,a,K,se);tt&&ht(Ye,tt,S)}}else if(e.type==="Polygon")for(let Ye of zy(e.geometry,0)){let tt=nB(Ye,16);ht(Ye[0],new Ja(tt.x,tt.y,0,0,void 0),S)}else if(e.type==="LineString")for(let Ye of e.geometry)ht(Ye,new Ja(Ye[0].x,Ye[0].y,0,0,void 0),S);else if(e.type==="Point")for(let Ye of e.geometry)for(let tt of Ye)ht([tt],new Ja(tt.x,tt.y,0,0,void 0),S)}let Om=255,hc=Om*ms;function fM(t,e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z,j){let X=function(le,se,pe,_e,Ee,Oe,De,Ne){let Xe=[];if(se.positionedLines.length===0)return Xe;let Le=_e.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,qe=function(ht){let Ye=ht[0],tt=ht[1],Et=Ye*tt;return Et>0?[Ye,-tt]:Et<0?[-Ye,tt]:Ye===0?[tt,Ye]:[tt,-Ye]}(pe),ke=Math.abs(se.top-se.bottom);for(let ht of se.positionedLines)ke-=ht.lineOffset;let We=se.positionedLines.length,Je=ke/We,Ze=se.top-pe[1];for(let ht=0;ht<We;++ht){let Ye=se.positionedLines[ht];Ze=tB(se,Je,Ze,ht);for(let tt of Ye.positionedGlyphs){if(!tt.rect)continue;let Et=tt.rect||{},yt=WD+1,gt=!0,et=1,Ct=0;if(tt.imageName){let vr=De[tt.imageName];if(!vr)continue;if(vr.sdf){wr("SDF images are not supported in formatted text and will be ignored.");continue}gt=!1,et=vr.pixelRatio,yt=ao/et}let qt=(Ee||Ne)&&tt.vertical,At=tt.metrics.advance*tt.scale/2,Xt=tt.metrics,Wt=tt.rect;if(Wt===null)continue;Ne&&se.verticalizable&&(Ct=tt.imageName?At-tt.metrics.width*tt.scale/2:0);let nn=Ee?[tt.x+At,tt.y]:[0,0],Dt=[0,0],Bn=[0,0],Nn=!1;Ee||(qt?(Bn=[tt.x+At+qe[0],tt.y+qe[1]-Ct],Nn=!0):Dt=[tt.x+At+pe[0],tt.y+pe[1]-Ct]);let Tn=Wt.w*tt.scale/(et*(tt.localGlyph?gs:1)),hn=Wt.h*tt.scale/(et*(tt.localGlyph?gs:1)),Cn,Yn,Hn,pr;if(qt){let vr=tt.y-Ze,or=new lt(-At,At-vr),Rr=-Math.PI/2,ei=new lt(...Bn);Cn=new lt(-At+Dt[0],Dt[1]),Cn._rotateAround(Rr,or)._add(ei),Cn.x+=-vr+At,Cn.y-=(Xt.left-yt)*tt.scale;let ti=tt.imageName?Xt.advance*tt.scale:di*tt.scale,Wn=String.fromCodePoint(tt.glyph);Hz(Wn)?Cn.x+=(1-yt)*tt.scale:qz(Wn)?Cn.x+=ti-Xt.height*tt.scale+(-yt-1)*tt.scale:Cn.x+=tt.imageName||Xt.width+2*yt===Wt.w&&Xt.height+2*yt===Wt.h?(ti-hn)/2:(ti-(Xt.height+2*yt)*tt.scale)/2,Yn=new lt(Cn.x,Cn.y-Tn),Hn=new lt(Cn.x+hn,Cn.y),pr=new lt(Cn.x+hn,Cn.y-Tn)}else{let vr=(Xt.left-yt)*tt.scale-At+Dt[0],or=(-Xt.top-yt)*tt.scale+Dt[1],Rr=vr+Tn,ei=or+hn;Cn=new lt(vr,or),Yn=new lt(Rr,or),Hn=new lt(vr,ei),pr=new lt(Rr,ei)}if(Le){let vr;vr=Ee?new lt(0,0):Nn?new lt(qe[0],qe[1]):new lt(pe[0],pe[1]),Cn._rotateAround(Le,vr),Yn._rotateAround(Le,vr),Hn._rotateAround(Le,vr),pr._rotateAround(Le,vr)}let hr=new lt(0,0),Ei=new lt(0,0);Xe.push({tl:Cn,tr:Yn,bl:Hn,br:pr,texPrimary:Et,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:nn,sectionIndex:tt.sectionIndex,isSDF:gt,pixelOffsetTL:hr,pixelOffsetBR:Ei,minFontScaleX:0,minFontScaleY:0})}}return Xe}(0,a,y,d,f,_,c,t.allowVerticalPlacement),Y=t.textSizeData,K=null;Y.kind==="source"?(K=[ms*d.layout.get("text-size").evaluate(_,{},z)],K[0]>hc&&wr(`${t.layerIds[0]}: Value for "text-size" is >= ${Om}. Reduce your "text-size".`)):Y.kind==="composite"&&(K=[ms*O.compositeTextSizes[0].evaluate(_,{},z),ms*O.compositeTextSizes[1].evaluate(_,{},z)],(K[0]>hc||K[1]>hc)&&wr(`${t.layerIds[0]}: Value for "text-size" is >= ${Om}. Reduce your "text-size".`)),t.addSymbols(t.text,X,K,y,f,_,T,e,n,b.lineStartIndex,b.lineLength,R,F,z,j,!1);for(let le of S)D[le]=t.text.placedSymbolArray.length-1;return 4*X.length}function pM(t){for(let e in t)return t[e];return null}function n0(t,e,n,a,c,d,f,_,y,b){let T=f.top,S=f.bottom,D=f.left,R=f.right,O=f.collisionPadding;if(O&&(D-=O[0],T-=O[1],R+=O[2],S+=O[3]),y){let F=new lt(D,T),z=new lt(R,T),j=new lt(D,S),X=new lt(R,S),Y=ln(y),K=new lt(0,0);b&&(K=new lt(b[0],b[1])),F._rotateAround(Y,K),z._rotateAround(Y,K),j._rotateAround(Y,K),X._rotateAround(Y,K),D=Math.min(F.x,z.x,j.x,X.x),R=Math.max(F.x,z.x,j.x,X.x),T=Math.min(F.y,z.y,j.y,X.y),S=Math.max(F.y,z.y,j.y,X.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,D,T,R,S,_,a,c,d),t.length-1}function jb(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function sB(t,e,n,a){let c=t.compareText;if(e in c){let d=c[e];for(let f=d.length-1;f>=0;f--)if(a.dist(d[f])<n)return!0}else c[e]=[];return c[e].push(a),!1}function mM(t,e){let n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),d=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),f=Math.sin(t._pitch)*d+c;return Math.min(1.01*f,c*(1/t._horizonShift))}function Hu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),a=t.x*n,c=(t.x+1)*n,d=t.y*n,f=(t.y+1)*n,_=Wi(a),y=Wi(c),b=Jr(d),T=Jr(f),S=e.project(_,b),D=e.project(y,b),R=e.project(y,T),O=e.project(_,T),F=Math.min(S.x,D.x,R.x,O.x),z=Math.min(S.y,D.y,R.y,O.y),j=Math.max(S.x,D.x,R.x,O.x),X=Math.max(S.y,D.y,R.y,O.y),Y=n/16;function K(se,pe,_e,Ee,Oe,De){let Ne=(_e+Oe)/2,Xe=(Ee+De)/2,Le=e.project(Wi(Ne),Jr(Xe)),qe=Math.max(0,F-Le.x,z-Le.y,Le.x-j,Le.y-X);F=Math.min(F,Le.x),j=Math.max(j,Le.x),z=Math.min(z,Le.y),X=Math.max(X,Le.y),qe>Y&&(K(se,Le,_e,Ee,Ne,Xe),K(Le,pe,Ne,Xe,Oe,De))}K(S,D,a,d,c,d),K(D,R,c,d,c,f),K(R,O,c,f,a,f),K(O,S,a,f,a,d),F-=Y,z-=Y,j+=Y,X+=Y;let le=1/Math.max(j-F,X-z);return{scale:le,x:F*le,y:z*le,x2:j*le,y2:X*le,projection:e}}function gM(t,{x:e,y:n},a=0){return new lt(((e-a)*t.scale-t.x)*it,(n*t.scale-t.y)*it)}let aB=r.ad.identity(new Float32Array(16));class dc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new yn(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return Vi(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return mM(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,c){let d=e.horizonLineFromTop(!1),f=new lt(n,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,n,a){let c=new lt(n,a);if(e.elevation)return e.elevation.pointCoordinate(c);{let d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return aB}createTileMatrix(e,n,a){let c,d,f,_=a.canonical,y=r.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=Hu(_,this);c=1,d=b.x+a.wrap*b.scale,f=b.y,r.ad.scale(y,y,[c/b.scale,c/b.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*a.wrap)*c,f=_.y*c;return r.ad.translate(y,y,[d,f,0]),r.ad.scale(y,y,[c/it,c/it,1]),y}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class lB extends dc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(ln(n));this.n=(c+Math.sin(ln(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c,r0:d}=this,f=ln(e-this.center[0]),_=ln(n),y=Math.sqrt(c-2*a*Math.sin(_))/a;return{x:y*Math.sin(f*a),y:y*Math.cos(f*a)-d,z:0}}unproject(e,n){let{n:a,c,r0:d}=this,f=d+n,_=Math.atan2(e,Math.abs(f))*Math.sign(f);f*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));let y=ln(this.center[0])*a;_=Aa(_,-Math.PI-y,Math.PI-y);let b=Qt(ai(_/a)+this.center[0],-180,180),T=Math.asin(Qt((c-(e*e+f*f)*a*a)/(2*a),-1,1)),S=Qt(ai(T),-Tr,Tr);return new yn(b,S)}}let km=1.340264,Lm=-.081106,Fm=893e-6,Nm=.003796,r0=Math.sqrt(3)/2;class cB extends dc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(r0*Math.sin(n)),c=a*a,d=c*c*c;return{x:.5*(e*Math.cos(a)/(r0*(km+3*Lm*c+d*(7*Fm+9*Nm*c)))/Math.PI+.5),y:1-.5*(a*(km+Lm*c+d*(Fm+Nm*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=a*a,d=c*c*c;for(let T,S,D,R=0;R<12&&(S=a*(km+Lm*c+d*(Fm+Nm*c))-n,D=km+3*Lm*c+d*(7*Fm+9*Nm*c),T=S/D,a=Qt(a-T,-Math.PI/3,Math.PI/3),c=a*a,d=c*c*c,!(Math.abs(T)<1e-12));++R);let f=r0*e*(km+3*Lm*c+d*(7*Fm+9*Nm*c))/Math.cos(a),_=Math.asin(Math.sin(a)/r0),y=Qt(180*f/Math.PI,-180,180),b=Qt(180*_/Math.PI,-Tr,Tr);return new yn(y,b)}}class uB extends dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),c=Qt(360*(.5-n),-Tr,Tr);return new yn(a,c)}}let Hd=Math.PI/2;function i0(t){return Math.tan((Hd+t)/2)}class hB extends dc{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],c=ln(n),d=ln(a);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);let f=Math.cos(c),_=i0(c);this.n=c===d?Math.sin(c):Math.log(f/Math.cos(d))/Math.log(i0(d)/_),this.f=f*Math.pow(i0(c),this.n)/this.n}project(e,n){n=ln(n),this.southernCenter&&(n=-n),e=ln(e-this.center[0]);let a=1e-6,{n:c,f:d}=this;d>0?n<-Hd+a&&(n=-Hd+a):n>Hd-a&&(n=Hd-a);let f=d/Math.pow(i0(n),c),_=f*Math.sin(c*e),y=d-f*Math.cos(c*e);return _=.5*(_/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:_,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:c}=this,d=c-n,f=Math.sign(d),_=Math.sign(a)*Math.sqrt(e*e+d*d),y=Math.atan2(e,Math.abs(d))*f;d*a<0&&(y-=Math.PI*Math.sign(e)*f);let b=Qt(ai(y/a)+this.center[0],-180,180),T=Qt(ai(2*Math.atan(Math.pow(c/_,1/a))-Hd),-Tr,Tr);return new yn(b,this.southernCenter?-T:T)}}class _M extends dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ys(e),y:Ks(n),z:0}}unproject(e,n){let a=Wi(e),c=Jr(n);return new yn(a,c)}}let yM=ln(Tr);class dB extends dc{project(e,n){let a=(n=ln(n))*n,c=a*a;return{x:.5*((e=ln(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=25,d=0,f=a*a;do{f=a*a;let b=f*f;d=(a*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-n)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),a=Qt(a-d,-yM,yM)}while(Math.abs(d)>1e-6&&--c>0);f=a*a;let _=Qt(ai(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),y=ai(a);return new yn(_,y)}}let vM=ln(Tr);class fB extends dc{project(e,n){n=ln(n),e=ln(e);let a=Math.cos(n),c=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),f=Math.sin(d)/d,_=.5*(e*c+2*a*Math.sin(e/2)/f)||0,y=.5*(n+Math.sin(n)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,d=25,f=1e-6,_=0,y=0;do{let b=Math.cos(c),T=Math.sin(c),S=2*T*b,D=T*T,R=b*b,O=Math.cos(a/2),F=Math.sin(a/2),z=2*O*F,j=F*F,X=1-R*O*O,Y=X?1/X:0,K=X?Math.acos(b*O)*Math.sqrt(1/X):0,le=.5*(2*K*b*F+2*a/Math.PI)-e,se=.5*(K*T+c)-n,pe=.5*Y*(R*j+K*b*O*D)+1/Math.PI,_e=Y*(z*S/4-K*T*F),Ee=.125*Y*(S*F-K*T*R*z),Oe=.5*Y*(D*O+K*j*b)+.5,De=_e*Ee-Oe*pe;_=(se*_e-le*Oe)/De,y=(le*Ee-se*pe)/De,a=Qt(a-_,-Math.PI,Math.PI),c=Qt(c-y,-vM,vM)}while((Math.abs(_)>f||Math.abs(y)>f)&&--d>0);return new yn(ai(a),ai(c))}}class xM extends dc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ln(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:c}=this;return{x:ln(e)*c*a+.5,y:-Math.sin(ln(n))/c*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:c}=this,d=-(n-.5)/a,f=Qt(ai((e-.5)/a)/c,-180,180),_=Math.asin(Qt(d*c,-1,1)),y=Qt(ai(_),-Tr,Tr);return new yn(f,y)}}class pB extends _M{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let c=xm(e,n,a),d=bm(Qs(a));return r._.transformMat4(c,c,d),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let a=Vu(n.lat,n.lng),c=r._.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,f=Vi(1,0)*it*d;r._.scaleAndAdd(a,a,c,f);let _=r.ad.identity(new Float64Array(16));return r.ad.multiply(_,e.pixelMatrix,e.globeMatrix),r._.transformMat4(a,a,_),new lt(a[0],a[1])}pixelsPerMeter(e,n){return Vi(1,0)*n}pixelSpaceConversion(e,n,a){let c=Vi(1,e)*n,d=It(Vi(1,45)*n,c,a);return this.pixelsPerMeter(e,n)/d}createTileMatrix(e,n,a){let c=yb(Qs(a.canonical));return r.ad.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:a}=e,c=bm(Qs(n));return r.ad.rotateY(c,c,ln(a.lng)),r.ad.rotateX(c,c,ln(a.lat)),r.ad.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,a,c){return II(e,n,a,!0)||new wi(0,0)}pointCoordinate3D(e,n,a){let c=this.pointCoordinate(e,n,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!II(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,d){let f=c.cameraToCenterDistance,_=c._centerAltitude*d,y=c._camera,b=c._camera.forward(),T=r._.add([],r._.scale([],b,-f),[0,0,_]),S=c.worldSize/(2*Math.PI),D=[0,0,-S],R=c.width/c.height,O=Math.tan(c.fovAboveCenter),F=r._.scale([],y.up(),O),z=r._.scale([],y.right(),O*R),j=r._.normalize([],r._.add([],r._.add([],b,F),z)),X=[],Y;if(new fb(T,j).closestPointOnSphere(D,S,X)){let K=r._.add([],X,D),le=r._.sub([],K,T);Y=Math.cos(c.fovAboveCenter)*r._.length(le)}else{let K=r._.sub([],T,D),le=r._.sub([],D,T);r._.normalize(le,le);let se=r._.length(K)-S;Y=Math.sqrt(se*(se+2*S));let pe=Math.acos(Y/(S+se))-Math.acos(r._.dot(b,le));Y*=Math.cos(pe)}return 1.01*Y}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Ka(e.zoom);if(a>0){let c=mM(e,Vi(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return It(n,c+d*(1-Math.cos(f)),Math.pow(a,10))}return n}upVector(e,n,a){return xm(n,a,e,1)}upVectorScale(e){return{metersToTile:Ry(ky(Qs(e)))}}}function bM(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new _M(t);case"equirectangular":return new uB(t);case"naturalEarth":return new dB(t);case"equalEarth":return new cB(t);case"winkelTripel":return new fB(t);case"albers":return n?new xM(t):new lB(t);case"lambertConformalConic":return n?new xM(t):new hB(t);case"globe":return new pB(t)}throw new Error(`Invalid projection name: ${t.name}`)}let mB=(()=>{class t{constructor(n,a,c,d){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let f=n.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||d||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class qd{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}qd.ReadOnly=!1,qd.ReadWrite=!0,qd.disabled=new qd(519,qd.ReadOnly,[0,1]);let Ub=7680;class $b{constructor(e,n,a,c,d,f){this.test=e,this.ref=n,this.mask=a,this.fail=c,this.depthFail=d,this.pass=f}}$b.disabled=new $b({func:519,mask:0},0,0,Ub,Ub,Ub);let zm=771;class lo{constructor(e,n,a,c){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=c}}lo.Replace=[1,0,1,0],lo.disabled=new lo(lo.Replace,bn.transparent,[!1,!1,!1,!1]),lo.unblended=new lo(lo.Replace,bn.transparent,[!0,!0,!0,!0]),lo.alphaBlended=new lo([1,zm,1,zm],bn.transparent,[!0,!0,!0,!0]),lo.alphaBlendedNonPremultiplied=new lo([770,zm,770,zm],bn.transparent,[!0,!0,!0,!0]),lo.multiply=new lo([774,0,774,0],bn.transparent,[!0,!0,!0,!0]);let Gb=1029,Hb=2305;class _s{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}_s.disabled=new _s(!1,Gb,Hb),_s.backCCW=new _s(!0,Gb,Hb),_s.backCW=new _s(!0,Gb,2304),_s.frontCW=new _s(!0,1028,2304),_s.frontCCW=new _s(!0,1028,Hb);let gB=jy.types,_B=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function o0(t,e,n,a,c,d,f,_,y,b,T,S,D){let R=_?Math.min(hc,Math.round(_[0])):0,O=_?Math.min(hc,Math.round(_[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*c),d,f,(R<<1)+(y?1:0),O,16*b,16*T,256*S,256*D)}function s0(t,e,n){t.emplaceBack(e,n)}function a0(t,e,n,a,c,d,f){t.emplaceBack(e,n,a,c,d,f)}function l0(t,e,n,a,c){t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c)}function yB(t){for(let e of t.sections)if(Fe(e.text))return!0;return!1}class qb{constructor(e){this.layoutVertexArray=new F1,this.indexArray=new Ur,this.programConfigurations=e,this.segments=new cr,this.dynamicLayoutVertexArray=new Jl,this.opacityVertexArray=new z1,this.occlusionQueryOpacityVertexArray=new Nu,this.placedSymbolArray=new KS,this.iconTransitioningVertexArray=new nc,this.globeExtVertexArray=new N1,this.zOffsetVertexArray=new Nu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,c,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,bz.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,_B,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,Pb.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,wz.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,MD.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}J(qb,"SymbolBuffers");class Wb{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new cr,this.collisionVertexArray=new j1,this.collisionVertexArrayExt=new Jl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ez.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Tz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}J(Wb,"CollisionBuffers");class Wd{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.ad.identity([]),this.placementViewportMatrix=r.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ob(this.zoom,n["text-size"]),this.iconSizeData=Ob(this.zoom,n["icon-size"]);let a=this.layers[0].layout,c=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(f=>So[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new qb(new ic(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new qb(new ic(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new eI,this.lineVertexArray=new tI,this.symbolInstances=new JS}calculateGlyphDependencies(e,n,a,c,d){for(let f=0;f<e.length;f++){let _=e.codePointAt(f);if(_===void 0)break;if(n[_]=!0,c&&d&&_<=65535){let y=Am[e.charAt(f)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Mb(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,c){let d=this.layers[0],f=d.layout,_=this.projection.name==="globe",y=f.get("text-font"),b=f.get("text-field"),T=f.get("icon-image"),S=(b.value.kind!=="constant"||b.value.value instanceof ci&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,R=f.get("symbol-sort-key");if(this.features=[],!S&&!D)return;let O=n.iconDependencies,F=n.glyphDependencies,z=n.availableImages,j=new Bt(this.zoom);for(let{feature:X,id:Y,index:K,sourceLayerIndex:le}of e){let se=d._featureFilter.needGeometry,pe=Xa(X,se);if(!d._featureFilter.filter(j,pe,a))continue;if(se||(pe.geometry=ps(X,a,c)),_&&X.type!==1&&a.z<=5){let De=pe.geometry,Ne=.98078528056,Xe=(Le,qe)=>{let ke=xm(Le.x,Le.y,a,1),We=xm(qe.x,qe.y,a,1);return r._.dot(ke,We)<Ne};for(let Le=0;Le<De.length;Le++)De[Le]=n3(De[Le],Xe)}let _e,Ee;if(S){let De=d.getValueAndResolveTokens("text-field",pe,a,z),Ne=ci.factory(De);yB(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||cn()==="unavailable"||this.hasRTLText&&An.isParsed())&&(_e=Gz(Ne,d,pe))}if(D){let De=d.getValueAndResolveTokens("icon-image",pe,a,z);Ee=De instanceof Ii?De:Ii.fromString(De)}if(!_e&&!Ee)continue;let Oe=this.sortFeaturesByKey?R.evaluate(pe,{},a):void 0;if(this.features.push({id:Y,text:_e,icon:Ee,index:K,sourceLayerIndex:le,geometry:pe.geometry,properties:X.properties,type:gB[X.type],sortKey:Oe}),Ee&&(O[Ee.namePrimary]=!0,Ee.nameSecondary&&(O[Ee.nameSecondary]=!0)),_e){let De=y.evaluate(pe,{},a).join(","),Ne=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(So.vertical)>=0;for(let Xe of _e.sections)if(Xe.image)O[Xe.image.namePrimary]=!0;else{let Le=Se(_e.toString()),qe=Xe.fontStack||De,ke=F[qe]=F[qe]||{};this.calculateGlyphDependencies(Xe.text,ke,Ne,this.allowVerticalPlacement,Le)}}}f.get("symbol-placement")==="line"&&(this.features=function(X){let Y={},K={},le=[],se=0;function pe(De){le.push(X[De]),se++}function _e(De,Ne,Xe){let Le=K[De];return delete K[De],K[Ne]=Le,le[Le].geometry[0].pop(),le[Le].geometry[0]=le[Le].geometry[0].concat(Xe[0]),Le}function Ee(De,Ne,Xe){let Le=Y[Ne];return delete Y[Ne],Y[De]=Le,le[Le].geometry[0].shift(),le[Le].geometry[0]=Xe[0].concat(le[Le].geometry[0]),Le}function Oe(De,Ne,Xe){let Le=Xe?Ne[0][Ne[0].length-1]:Ne[0][0];return`${De}:${Le.x}:${Le.y}`}for(let De=0;De<X.length;De++){let Ne=X[De],Xe=Ne.geometry,Le=Ne.text?Ne.text.toString():null;if(!Le){pe(De);continue}let qe=Oe(Le,Xe),ke=Oe(Le,Xe,!0);if(qe in K&&ke in Y&&K[qe]!==Y[ke]){let We=Ee(qe,ke,Xe),Je=_e(qe,ke,le[We].geometry);delete Y[qe],delete K[ke],K[Oe(Le,le[Je].geometry,!0)]=Je,le[We].geometry=null}else qe in K?_e(qe,ke,Xe):ke in Y?Ee(qe,ke,Xe):(pe(De),Y[qe]=se-1,K[ke]=se-1)}return le.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,Y)=>X.sortKey-Y.sortKey)}update(e,n,a,c,d){let f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;let _=f?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,_,a,c,d),this.icon.programConfigurations.updatePaintArrays(e,n,_,a,c,d)}updateOcclusionOpacities(e,n,a){if(!n.useOcclusionQueries)return!1;let c=this;if(c.projection.name==="globe")return!1;let d=!1;c.hasTextData()&&(d=d||c.text.occlusionQueryOpacityVertexArray.length!==0),c.hasIconData()&&(d=d||c.icon.occlusionQueryOpacityVertexArray.length!==0);let f=c.layers[0].paint,_=f.get("icon-occlusion-opacity").constantOr(0)!==1,y=f.get("text-occlusion-opacity").constantOr(0)!==1;if(!_&&!y)return!1;let b=!d;for(let R=0;R<c.symbolInstances.length;R++){let O=c.symbolInstances.get(R),F=O.occlusionOpacity;O.occlusionOpacity+=(O.occlusionState>.5?1:-1)*n.fadeSpeed*a*.001,O.occlusionOpacity=Qt(O.occlusionOpacity,0,1),b=b||O.occlusionOpacity!==F}if(!b)return!1;let T=0,S=0,D=(R,O,F,z)=>{let j=0,X=0;F?(j=S,S+=z,X=S):(j=T,T+=z,X=T),X>O.occlusionQueryOpacityVertexArray.length&&O.occlusionQueryOpacityVertexArray.resize(X);let Y=R.occlusionOpacity;for(let K=0;K<z;K++)O.occlusionQueryOpacityVertexArray.emplace(K+j,Y)};for(let R=0;R<c.symbolInstances.length;R++){let O=c.symbolInstances.get(R),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:z,numIconVertices:j}=O,X=j>0;if((F>0||z>0)&&(D(O,c.text,!1,F),D(O,c.text,!1,z)),X){let{placedIconSymbolIndex:Y,verticalPlacedIconSymbolIndex:K}=O;Y>=0&&D(O,c.icon,!0,j),K>=0&&D(O,c.icon,!0,O.numVerticalIconVertices)}}return c.hasTextData()&&c.text.occlusionQueryOpacityVertexBuffer&&(c.text.occlusionQueryOpacityVertexBuffer.length<c.text.occlusionQueryOpacityVertexArray.length?c.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.text.occlusionQueryOpacityVertexArray,Pb.members,!0):c.text.occlusionQueryOpacityVertexBuffer.updateData(c.text.occlusionQueryOpacityVertexArray)),c.hasIconData()&&c.icon.occlusionQueryOpacityVertexBuffer&&(c.icon.occlusionQueryOpacityVertexBuffer.length<c.icon.occlusionQueryOpacityVertexArray.length?c.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.icon.occlusionQueryOpacityVertexArray,Pb.members,!0):c.icon.occlusionQueryOpacityVertexBuffer.updateData(c.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(d,f,_)=>{a+=f,a>d.length&&d.resize(a);for(let y=-f;y<0;y++)d.emplace(y+a,_)},n=(d,f,_)=>{c+=f,c>d.length&&d.resize(c);for(let y=-f;y<0;y++)d.emplace(y+c,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let d=0;d<this.symbolInstances.length;d++){let f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:y,numIconVertices:b}=f,T=f.zOffset,S=b>0;if((_>0||y>0)&&(e(this.text.zOffsetVertexArray,_,T),e(this.text.zOffsetVertexArray,y,T)),S){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:R}=f;D>=0&&n(this.icon.zOffsetVertexArray,b,T),R>=0&&n(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=bM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:d}of n)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,c,d,f,_,y,b,T,S,D,R,O,F,z){let j=e.indexArray,X=e.layoutVertexArray,Y=e.globeExtVertexArray,K=e.segments.prepareSegment(4*n.length,X,j,this.canOverlap?f.sortKey:void 0),le=this.glyphOffsetArray.length,se=K.vertexLength,pe=this.allowVerticalPlacement&&_===So.vertical?Math.PI/2:0,_e=f.text&&f.text.sections;for(let Oe=0;Oe<n.length;Oe++){let{tl:De,tr:Ne,bl:Xe,br:Le,texPrimary:qe,texSecondary:ke,pixelOffsetTL:We,pixelOffsetBR:Je,minFontScaleX:Ze,minFontScaleY:ht,glyphOffset:Ye,isSDF:tt,sectionIndex:Et}=n[Oe],yt=K.vertexLength,gt=Ye[1];if(o0(X,b.x,b.y,De.x,gt+De.y,qe.x,qe.y,a,tt,We.x,We.y,Ze,ht),o0(X,b.x,b.y,Ne.x,gt+Ne.y,qe.x+qe.w,qe.y,a,tt,Je.x,We.y,Ze,ht),o0(X,b.x,b.y,Xe.x,gt+Xe.y,qe.x,qe.y+qe.h,a,tt,We.x,Je.y,Ze,ht),o0(X,b.x,b.y,Le.x,gt+Le.y,qe.x+qe.w,qe.y+qe.h,a,tt,Je.x,Je.y,Ze,ht),y){let{x:et,y:Ct,z:qt}=y.anchor,[At,Xt,Wt]=y.up;a0(Y,et,Ct,qt,At,Xt,Wt),a0(Y,et,Ct,qt,At,Xt,Wt),a0(Y,et,Ct,qt,At,Xt,Wt),a0(Y,et,Ct,qt,At,Xt,Wt),l0(e.dynamicLayoutVertexArray,et,Ct,qt,pe)}else l0(e.dynamicLayoutVertexArray,b.x,b.y,b.z,pe);if(z){let et=ke||qe;s0(e.iconTransitioningVertexArray,et.x,et.y),s0(e.iconTransitioningVertexArray,et.x+et.w,et.y),s0(e.iconTransitioningVertexArray,et.x,et.y+et.h),s0(e.iconTransitioningVertexArray,et.x+et.w,et.y+et.h)}j.emplaceBack(yt,yt+1,yt+2),j.emplaceBack(yt+1,yt+2,yt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ye[0]),Oe!==n.length-1&&Et===n[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,f,f.index,{},R,O,F,_e&&_e[Et])}let Ee=y?y.anchor:b;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,b.x,b.y,le,this.glyphOffsetArray.length-le,se,T,S,b.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],_,0,!1,0,D,0)}_commitLayoutVertex(e,n,a,c,d,f,_){e.emplaceBack(n,a,c,d,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,a,c,d,f,_){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=y.vertexLength,T=_.tileAnchorX,S=_.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,T,S,new lt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,T,S,new lt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,T,S,new lt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,T,S,new lt(e.x1,e.y2)),y.vertexLength+=4;let D=a.indexArray;D.emplaceBack(b,b+1),D.emplaceBack(b+1,b+2),D.emplaceBack(b+2,b+3),D.emplaceBack(b+3,b),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,c,d,f){for(let _=c;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,f,n,_);this._addCollisionDebugVertices(y,b,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,n,a,c,d,f){for(let _=c;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._addCollisionDebugVertices(y,b,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wb(Ey,AD.members,nc),this.iconCollisionBox=new Wb(Ey,AD.members,nc);let a=jd(this.iconSizeData,e),c=jd(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let f=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(a,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(a,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,n,a,c){let d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),f=Ky(this.textSizeData,e,d)/di;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,n,a){let c=this.icon.placedSymbolArray.get(a),d=Ky(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,a,c){e.emplaceBack(n,-a,-a,c),e.emplaceBack(n,a,-a,c),e.emplaceBack(n,a,a,c),e.emplaceBack(n,-a,a,c)}_updateTextDebugCollisionBoxes(e,n,a,c,d,f){for(let _=c;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,f,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,y.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,c,d,f){for(let _=c;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding,f.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=jd(this.iconSizeData,e),c=jd(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let f=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(a,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._updateIconDebugCollisionBoxes(a,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,c,d,f,_,y,b){let T={};if(n<a){let{x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(n);T.textBox={x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.textFeatureIndex=le}if(c<d){let{x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(c);T.verticalTextBox={x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.verticalTextFeatureIndex=le}if(f<_){let{x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(f);T.iconBox={x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.iconFeatureIndex=le}if(y<b){let{x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K,featureIndex:le}=e.get(y);T.verticalIconBox={x1:S,y1:D,x2:R,y2:O,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:K},T.verticalIconFeatureIndex=le}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),c=[],d=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);let y=this.symbolInstances.get(_);c.push(0|Math.round(n*y.tileAnchorX+a*y.tileAnchorY)),d.push(y.featureIndex)}return f.sort((_,y)=>c[_]-c[y]||d[y]-d[_]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:b}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}J(Wd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Wd.addDynamicAttributes=l0;class Zo{constructor(e,n,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,a){let{width:c,height:d}=e,{context:f}=this,{gl:_}=f;if(_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===d){let{x:y,y:b}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,y,b,_.RGBA,_.UNSIGNED_BYTE,e);else{let T=this.format,S=_.UNSIGNED_BYTE;this.format===_.R32F&&(T=_.RED,S=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,y,b,c,d,T,S,e.data)}}else if(this.size=[c,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===_.R8&&(y=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,y,_.UNSIGNED_BYTE,e)}else{let y=this.format,b=this.format,T=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,T=_.UNSIGNED_SHORT),this.format===_.R8&&(b=_.RED),this.format===_.R32F&&(T=_.FLOAT,b=_.RED),_.texImage2D(_.TEXTURE_2D,0,y,c,d,0,b,T,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,a=!1){let{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,c){let{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class c0{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Xo=32,ea=33,fc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,c=0,d=0,f=0,_=0;for(1&e?c=d=f=Xo:n=a=_=Xo;(e>>=1)>1;){let b=n+c>>1,T=a+d>>1;1&e?(c=n,d=a,n=f,a=_):(n=c,a=d,c=f,d=_),f=b,_=T}let y=4*t;fc[y+0]=n,fc[y+1]=a,fc[y+2]=c,fc[y+3]=d}let ta=new Uint16Array(2178),pc=new Uint8Array(1089),u0=new Uint16Array(1089);function wM(t){return t===0?-.03125:t===32?.03125:0}var h0=In([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),vB=In([{name:"a_index",type:"Int16",components:1}]);let EM={type:2,extent:it,loadGeometry:()=>[[new lt(0,0),new lt(it+1,0),new lt(it+1,it+1),new lt(0,it+1),new lt(0,0)]]};class d0{constructor(e,n,a,c,d){this.tileID=e,this.uid=Gh(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Kr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Hu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){let f={};if(!d)return f;for(let _ of c){let y=_.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(let b of y)f[b.fqid]=_}}return f}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let d=this.buckets[c];if(d instanceof Wd){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let d=this.buckets[c];if(d instanceof Wd&&d.hasRTLText){this.hasRTLText=!0,An.isLoading()||An.isLoaded()||cn()!=="deferred"||on();break}}this.queryPadding=0;for(let c in this.buckets){let d=this.buckets[c],f=n.style.getOwnLayer(c);if(!f)continue;let _=f.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new X1}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let c in this.buckets){let d=this.buckets[c];d.uploadPending()&&d.upload(e)}let n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let c=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new Zo(e,a.image,n.RGBA,{useMipmap:c}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Zo(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Zo(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let c=n.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,c,d,f,_,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:_,transform:f,params:d,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let c=a.loadVTLayers(),d=n?n.sourceLayer:"",f=c._geojsonTileLayer||c[d];if(!f)return;let _=bi(n&&n.filter),{z:y,x:b,y:T}=this.tileID.canonical,S={z:y,x:b,y:T};for(let D=0;D<f.length;D++){let R=f.feature(D);if(_.needGeometry){let z=Xa(R,!0);if(!_.filter(new Bt(this.tileID.overscaledZ),z,this.tileID.canonical))continue}else if(!_.filter(new Bt(this.tileID.overscaledZ),R))continue;let O=a.getId(R,d),F=new GD(R,y,b,T,O);F.tile=S,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let a=xp(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{let d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages(),d=n.style.getBrightness();for(let f in this.buckets){if(!n.style.hasLayer(f))continue;let _=this.buckets[f],y=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],T={};if(e&&(T=e[y],!b||!T||Object.keys(T).length===0))continue;if(_.update(T,b,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),_ instanceof Wy||_ instanceof By){let D=n.style.getOwnSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&D&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(D.id,this.tileID)}let S=n&&n.style&&n.style.getOwnLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Kr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Kr.now()+e}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Zo?this.texture.update(e,{useMipmap:!0}):(this.texture=new Zo(a,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,n){let a={};for(let c of n)a[c]=!0;this.dependencies[e]=a}hasDependency(e,n){for(let a of e){let c=this.dependencies[a];if(c){for(let d of n)if(c[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let a=ps(EM,this.tileID.canonical,this.tileTransform)[0],c=new ds,d=new fm;for(let f=0;f<a.length;f++){let{x:_,y}=a[f];c.emplaceBack(_,y),d.emplaceBack(f)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,vm.members),this._tileDebugSegments=cr.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let a=ps(EM,this.tileID.canonical,this.tileTransform)[0],c,d;if(this.isRaster){let f=function(_,y){let b=Hu(_,y),T=Math.pow(2,_.z);for(let z=0;z<ea;z++)for(let j=0;j<ea;j++){let X=Wi((_.x+(j+wM(j))/Xo)/T),Y=Jr((_.y+(z+wM(z))/Xo)/T),K=y.project(X,Y),le=z*ea+j;ta[2*le+0]=Math.round((K.x*b.scale-b.x)*it),ta[2*le+1]=Math.round((K.y*b.scale-b.y)*it)}pc.fill(0),u0.fill(0);for(let z=2045;z>=0;z--){let j=4*z,X=fc[j+0],Y=fc[j+1],K=fc[j+2],le=fc[j+3],se=X+K>>1,pe=Y+le>>1,_e=se+pe-Y,Ee=pe+X-se,Oe=Y*ea+X,De=le*ea+K,Ne=pe*ea+se,Xe=Math.hypot((ta[2*Oe+0]+ta[2*De+0])/2-ta[2*Ne+0],(ta[2*Oe+1]+ta[2*De+1])/2-ta[2*Ne+1])>=16;pc[Ne]=pc[Ne]||(Xe?1:0),z<1022&&(pc[Ne]=pc[Ne]||pc[(Y+Ee>>1)*ea+(X+_e>>1)]||pc[(le+Ee>>1)*ea+(K+_e>>1)])}let S=new Ql,D=new Ur,R=0;function O(z,j){let X=j*ea+z;return u0[X]===0&&(S.emplaceBack(ta[2*X+0],ta[2*X+1],z*it/Xo,j*it/Xo),u0[X]=++R),u0[X]-1}function F(z,j,X,Y,K,le){let se=z+X>>1,pe=j+Y>>1;if(Math.abs(z-K)+Math.abs(j-le)>1&&pc[pe*ea+se])F(K,le,z,j,se,pe),F(X,Y,K,le,se,pe);else{let _e=O(z,j),Ee=O(X,Y),Oe=O(K,le);D.emplaceBack(_e,Ee,Oe)}}return F(0,0,Xo,Xo,Xo,0),F(Xo,Xo,0,0,0,Xo),{vertices:S,indices:D}}(this.tileID.canonical,n);c=f.vertices,d=f.indices}else{c=new Ql,d=new Ur;for(let{x:_,y}of a)c.emplaceBack(_,y,0,0);let f=Em(c.int16,void 0,4);for(let _=0;_<f.length;_+=3)d.emplaceBack(f[_],f[_+1],f[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,h0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=cr.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,n){let a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;let c=this.tileID.canonical,d=bm(DI(c,n)),f=Ka(n.zoom),_;f>0&&(_=r.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,n,d,_,f),this._makeGlobeTileDebugTextBuffer(e,c,n,d,_,f)}_globePoint(e,n,a,c,d,f,_){let y=xm(e,n,a);if(f){let b=1<<a.z,T=Ys(c.center.lng),S=Ks(c.center.lat),D=(a.x+.5)/b-T,R=0;D>.5?R=-1:D<-.5&&(R=1);let O=(e/it+a.x)/b+R,F=(n/it+a.y)/b;O=(O-T)*c._pixelsPerMercatorPixel+T,F=(F-S)*c._pixelsPerMercatorPixel+S;let z=[O*c.worldSize,F*c.worldSize,0];r._.transformMat4(z,z,f),y=Ya(y,z,_)}return r._.transformMat4(y,y,d)}_makeGlobeTileDebugBorderBuffer(e,n,a,c,d,f){let _=new ds,y=new fm,b=new xy,T=(D,R,O,F,z)=>{let j=(O-D)/(z-1),X=(F-R)/(z-1),Y=_.length;for(let K=0;K<z;K++){let le=D+K*j,se=R+K*X;_.emplaceBack(le,se);let pe=this._globePoint(le,se,n,a,c,d,f);b.emplaceBack(pe[0],pe[1],pe[2]),y.emplaceBack(Y+K)}},S=it;T(0,0,S,0,16),T(S,0,S,S,16),T(S,S,0,S,16),T(0,S,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(_,vm.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,SI.members),this._tileDebugSegments=cr.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,a,c,d,f){let _=it/4,y=new ds,b=new Ur,T=new xy,S=25;b.reserve(32),y.reserve(S),T.reserve(S);let D=(R,O)=>S*R+O;for(let R=0;R<S;R++){let O=R*_;for(let F=0;F<S;F++){let z=F*_;y.emplaceBack(z,O);let j=this._globePoint(z,O,n,a,c,d,f);T.emplaceBack(j[0],j[1],j[2])}}for(let R=0;R<4;R++)for(let O=0;O<4;O++){let F=D(R,O),z=D(R,O+1),j=D(R+1,O),X=D(R+1,O+1);b.emplaceBack(F,z,j),b.emplaceBack(j,z,X)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(y,vm.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,SI.members),this._tileDebugTextSegments=cr.simpleSegment(0,0,S,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Zo&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Ut={read:function(t,e){return t.readFields(Ut._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(Ut.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Ut.Filter.read=function(t,e){return t.readFields(Ut.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Ut.Filter._readField=function(t,e,n){t===1?(e.delta_filter=Ut.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Ut.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Ut.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Ut.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},Ut.Filter.Delta={},Ut.Filter.Delta.read=function(t,e){return t.readFields(Ut.Filter.Delta._readField,{block_size:0},e)},Ut.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},Ut.Filter.Zigzag={},Ut.Filter.Zigzag.read=function(t,e){return t.readFields(Ut.Filter.Zigzag._readField,{},e)},Ut.Filter.Zigzag._readField=function(t,e,n){},Ut.Filter.BitShuffle={},Ut.Filter.BitShuffle.read=function(t,e){return t.readFields(Ut.Filter.BitShuffle._readField,{},e)},Ut.Filter.BitShuffle._readField=function(t,e,n){},Ut.Filter.ByteShuffle={},Ut.Filter.ByteShuffle.read=function(t,e){return t.readFields(Ut.Filter.ByteShuffle._readField,{},e)},Ut.Filter.ByteShuffle._readField=function(t,e,n){},Ut.Codec={},Ut.Codec.read=function(t,e){return t.readFields(Ut.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Ut.Codec._readField=function(t,e,n){t===1?(e.gzip_data=Ut.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Ut.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Ut.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=Ut.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},Ut.Codec.GzipData={},Ut.Codec.GzipData.read=function(t,e){return t.readFields(Ut.Codec.GzipData._readField,{},e)},Ut.Codec.GzipData._readField=function(t,e,n){},Ut.Codec.JpegImage={},Ut.Codec.JpegImage.read=function(t,e){return t.readFields(Ut.Codec.JpegImage._readField,{},e)},Ut.Codec.JpegImage._readField=function(t,e,n){},Ut.Codec.WebpImage={},Ut.Codec.WebpImage.read=function(t,e){return t.readFields(Ut.Codec.WebpImage._readField,{},e)},Ut.Codec.WebpImage._readField=function(t,e,n){},Ut.Codec.PngImage={},Ut.Codec.PngImage.read=function(t,e){return t.readFields(Ut.Codec.PngImage._readField,{},e)},Ut.Codec.PngImage._readField=function(t,e,n){},Ut.DataIndexEntry={},Ut.DataIndexEntry.read=function(t,e){return t.readFields(Ut.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Ut.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(Ut.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=Ut.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},Ut.Layer={},Ut.Layer.read=function(t,e){return t.readFields(Ut.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Ut.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(Ut.DataIndexEntry.read(n,n.readVarint()+n.pos))};let ys={read:function(t,e){return t.readFields(ys._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=ys.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=ys.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};ys.Uint32Values.read=function(t,e){return t.readFields(ys.Uint32Values._readField,{values:[]},e)},ys.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let c=function(f){return f.type===2?f.readVarint()+f.pos:f.pos+1}(a),d=a.pos;return a.pos=c,function(f){a.pos=d;let _=0;for(;a.pos<c;){let y=a.readVarint();f[_++]=y}return f}}(n))},ys.Fixed32Values={},ys.Fixed32Values.read=function(t,e){return t.readFields(ys.Fixed32Values._readField,{values:[]},e)},ys.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class xB{constructor(e=0,n=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(n=a.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,a=!1,c=this.resetTtl){let d;if(a||this.has(e)){if(d=this.items[e],d.value=n,a===!1&&c&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){let f=this.last,_=d.next,y=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,f.next=d,y!==null&&(y.next=_),_!==null&&(_.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=d:this.last.next=d;return this.last=d,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function bB(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){let c=a===1?1:0,d=a===2?1:0;for(let f=0;f<e[0];f++){let _=e[1]*f;for(let y=c;y<e[1];y++){let b=e[2]*(y+_);for(let T=d;T<e[2];T++){let S=e[3]*(T+b);for(let D=0;D<e[3];D++){let R=S+D;t[R]+=t[R-n]}}}}n*=e[a]}return t}function wB(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function EB(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let a=t[n],c=t[n+1];t[n]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,t[n+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let a=t[n],c=t[n+1],d=t[n+2],f=t[n+3];t[n+0]=(192&a)>>6|(192&c)>>4|(192&d)>>2|192&f,t[n+1]=(48&a)>>4|(48&c)>>2|48&d|(48&f)<<2,t[n+2]=(12&a)>>2|12&c|(12&d)<<2|(12&f)<<4,t[n+3]=3&a|(3&c)<<2|(3&d)<<4|(3&f)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class mc extends Error{constructor(e){super(e),this.name="MRTError"}}var Io=Uint8Array,Zd=Uint16Array,TB=Int32Array,TM=new Io([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),CM=new Io([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),CB=new Io([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),SM=function(t,e){for(var n=new Zd(31),a=0;a<31;++a)n[a]=e+=1<<t[a-1];var c=new TB(n[30]);for(a=1;a<30;++a)for(var d=n[a];d<n[a+1];++d)c[d]=d-n[a]<<5|a;return{b:n,r:c}},IM=SM(TM,2),DM=IM.b,SB=IM.r;DM[28]=258,SB[258]=28;for(var IB=SM(CM,0).b,Zb=new Zd(32768),Ir=0;Ir<32768;++Ir){var Xd=(43690&Ir)>>1|(21845&Ir)<<1;Zb[Ir]=((65280&(Xd=(61680&(Xd=(52428&Xd)>>2|(13107&Xd)<<2))>>4|(3855&Xd)<<4))>>8|(255&Xd)<<8)>>1}var Bm=function(t,e,n){for(var a=t.length,c=0,d=new Zd(e);c<a;++c)t[c]&&++d[t[c]-1];var f,_=new Zd(e);for(c=1;c<e;++c)_[c]=_[c-1]+d[c-1]<<1;if(n){f=new Zd(1<<e);var y=15-e;for(c=0;c<a;++c)if(t[c])for(var b=c<<4|t[c],T=e-t[c],S=_[t[c]-1]++<<T,D=S|(1<<T)-1;S<=D;++S)f[Zb[S]>>y]=b}else for(f=new Zd(a),c=0;c<a;++c)t[c]&&(f[c]=Zb[_[t[c]-1]++]>>15-t[c]);return f},Vm=new Io(288);for(Ir=0;Ir<144;++Ir)Vm[Ir]=8;for(Ir=144;Ir<256;++Ir)Vm[Ir]=9;for(Ir=256;Ir<280;++Ir)Vm[Ir]=7;for(Ir=280;Ir<288;++Ir)Vm[Ir]=8;var MM=new Io(32);for(Ir=0;Ir<32;++Ir)MM[Ir]=5;var DB=Bm(Vm,9,1),MB=Bm(MM,5,1),Xb=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},vs=function(t,e,n){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&n},Yb=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},AB=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xs=function(t,e,n){var a=new Error(e||AB[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,xs),!n)throw a;return a},PB=new Io(0),RB=typeof TextDecoder<"u"&&new TextDecoder;try{RB.decode(PB,{stream:!0})}catch{}let OB={gzip_data:"gzip"},kB={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},LB={uint32:1,uint16:2,uint8:4},FB={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class Kb{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new mc("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new mc(`Expected header with length >= ${a} but got buffer of length ${n.length}`);let c=new Vd(n.subarray(0,a)),d=Ut.read(c);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new mc(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let f of d.layers)this.layers[f.name]=new NB(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],a=this.getLayer(e.layerName);for(let c=0;c<a.dataIndex.length;c++){let d=a.dataIndex[c],f=d.first_byte-e.firstByte,_=d.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||a._blocksInProgress.has(c))continue;let y={layerName:a.name,firstByte:f,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(b=>b.filter)};a._blocksInProgress.add(c),n.push(y)}return new AM(n,()=>{n.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,d)=>{if(n.forEach(f=>a._blocksInProgress.delete(f.blockIndex)),c)throw c;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class NB{constructor({version:e,name:n,units:a,tilesize:c,pixel_format:d,buffer:f,data_index:_},y){if(this.version=e,this.version!==1)throw new mc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=c,this.buffer=f,this.pixelFormat=kB[d],this.dataIndex=_,this.bandShape=[c+2*f,c+2*f,LB[this.pixelFormat]],this._decodedBlocks=function(b=1e3,T=0,S=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof S!="boolean")throw new TypeError("Invalid resetTtl value");return new xB(b,T,S)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[a,c]of this.dataIndex.entries()){for(let[d,f]of c.bands.entries())if(f===e)return{bandIndex:n+d,blockIndex:a,blockBandIndex:d};n+=c.bands.length}break;case"number":for(let[a,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new mc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new mc(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0,c=1/0,d=-1/0;for(let f of e){let{blockIndex:_}=this.getBlockForBand(f);if(_<0)throw new mc(`Invalid band: ${JSON.stringify(f)}`);let y=this.dataIndex[_];c=Math.min(c,_),d=Math.max(d,_),n=Math.min(n,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:a,firstBlock:c,lastBlock:d}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new mc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let d=this.dataIndex[n],f=this.bandShape.reduce((b,T)=>b*T,1),_=a*f,y=c.subarray(_,_+f);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class AM{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}Kb.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:a,firstByte:c,lastByte:d,pixelFormat:f,blockShape:_,blockIndex:y,filters:b,codec:T}=n,S=new Uint8Array(t).subarray(c,d+1),D=new Uint32Array(_[0]*_[1]*_[2]),R;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return R=function(O,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((Y=function(se){se[0]==31&&se[1]==139&&se[2]==8||xs(6,"invalid gzip data");var pe=se[3],_e=10;4&pe&&(_e+=2+(se[10]|se[11]<<8));for(var Ee=(pe>>3&1)+(pe>>4&1);Ee>0;Ee-=!se[_e++]);return _e+(2&pe)}(X=O))+8>X.length&&xs(6,"invalid gzip data"),function(se,pe,_e,Ee){var Oe=se.length;if(!Oe||pe.f&&!pe.l)return _e||new Io(0);var De=!_e,Ne=De||pe.i!=2,Xe=pe.i;De&&(_e=new Io(3*Oe));var Le,qe,ke=function(_c){var yc=_e.length;if(_c>yc){var Yu=new Io(Math.max(2*yc,_c));Yu.set(_e),_e=Yu}},We=pe.f||0,Je=pe.p||0,Ze=pe.b||0,ht=pe.l,Ye=pe.d,tt=pe.m,Et=pe.n,yt=8*Oe;do{if(!ht){We=vs(se,Je,1);var gt=vs(se,Je+1,3);if(Je+=3,!gt){var et=se[(hn=4+((Je+7)/8|0))-4]|se[hn-3]<<8,Ct=hn+et;if(Ct>Oe){Xe&&xs(0);break}Ne&&ke(Ze+et),_e.set(se.subarray(hn,Ct),Ze),pe.b=Ze+=et,pe.p=Je=8*Ct,pe.f=We;continue}if(gt==1)ht=DB,Ye=MB,tt=9,Et=5;else if(gt==2){var qt=vs(se,Je,31)+257,At=vs(se,Je+10,15)+4,Xt=qt+vs(se,Je+5,31)+1;Je+=14;for(var Wt=new Io(Xt),nn=new Io(19),Dt=0;Dt<At;++Dt)nn[CB[Dt]]=vs(se,Je+3*Dt,7);Je+=3*At;var Bn=Xb(nn),Nn=(1<<Bn)-1,Tn=Bm(nn,Bn,1);for(Dt=0;Dt<Xt;){var hn,Cn=Tn[vs(se,Je,Nn)];if(Je+=15&Cn,(hn=Cn>>4)<16)Wt[Dt++]=hn;else{var Yn=0,Hn=0;for(hn==16?(Hn=3+vs(se,Je,3),Je+=2,Yn=Wt[Dt-1]):hn==17?(Hn=3+vs(se,Je,7),Je+=3):hn==18&&(Hn=11+vs(se,Je,127),Je+=7);Hn--;)Wt[Dt++]=Yn}}var pr=Wt.subarray(0,qt),hr=Wt.subarray(qt);tt=Xb(pr),Et=Xb(hr),ht=Bm(pr,tt,1),Ye=Bm(hr,Et,1)}else xs(1);if(Je>yt){Xe&&xs(0);break}}Ne&&ke(Ze+131072);for(var Ei=(1<<tt)-1,vr=(1<<Et)-1,or=Je;;or=Je){var Rr=(Yn=ht[Yb(se,Je)&Ei])>>4;if((Je+=15&Yn)>yt){Xe&&xs(0);break}if(Yn||xs(2),Rr<256)_e[Ze++]=Rr;else{if(Rr==256){or=Je,ht=null;break}var ei=Rr-254;Rr>264&&(ei=vs(se,Je,(1<<(ji=TM[Dt=Rr-257]))-1)+DM[Dt],Je+=ji);var ti=Ye[Yb(se,Je)&vr],Wn=ti>>4;if(ti||xs(3),Je+=15&ti,hr=IB[Wn],Wn>3){var ji=CM[Wn];hr+=Yb(se,Je)&(1<<ji)-1,Je+=ji}if(Je>yt){Xe&&xs(0);break}Ne&&ke(Ze+131072);var el=Ze+ei;if(Ze<hr){var Yo=0-hr,ws=Math.min(hr,el);for(Yo+Ze<0&&xs(3);Ze<ws;++Ze)_e[Ze]=(void 0)[Yo+Ze]}for(;Ze<el;++Ze)_e[Ze]=_e[Ze-hr]}}pe.l=ht,pe.p=or,pe.b=Ze,pe.f=We,ht&&(We=1,pe.m=tt,pe.d=Ye,pe.n=Et)}while(!We);return Ze!=_e.length&&De?(Le=_e,((qe=Ze)==null||qe>Le.length)&&(qe=Le.length),new Io(Le.subarray(0,qe))):_e.subarray(0,Ze)}(X.subarray(Y,-8),{i:2},new Io(((z=X)[(j=z.length)-4]|z[j-3]<<8|z[j-2]<<16|z[j-1]<<24)>>>0))));var z,j,X,Y;let K=OB[F];if(!K)throw new Error(`Unhandled codec: ${F}`);let le=new globalThis.DecompressionStream(K);return new Response(new Blob([O]).stream().pipeThrough(le)).arrayBuffer().then(se=>new Uint8Array(se))}(S,T).then(O=>{let F=ys.read(new Vd(O));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(D),new FB[f](D.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),R.then(O=>{for(let F=b.length-1;F>=0;F--)switch(b[F]){case"delta_filter":bB(O,_);break;case"zigzag_filter":wB(O);break;case"bitshuffle_filter":EB(O,f);break;default:throw new Error(`Unhandled filter "${b[F]}"`)}return{layerName:a,blockIndex:y,data:O}}).catch(O=>{throw O})}))};class PM extends d0{constructor(e,n,a,c,d){super(e,n,a,c,d),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Zo?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Zo(a,e,c.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let a=this._mrt=new Kb(30),c=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Oa(c,(d,f,_,y)=>{if(d)n(d);else try{let b=a.getHeaderLength(f);if(b>e)return void(this.request=this.fetchHeader(b,n));a.parseHeader(f),this._isHeaderLoaded=!0;let T=0;for(let S of Object.values(a.layers))T=Math.max(T,S.dataIndex[S.dataIndex.length-1].last_byte);f.byteLength>=T&&(this.entireBuffer=f),n(null,this.entireBuffer||f,_,y)}catch(b){n(b)}}),this.request}fetchBand(e,n,a){let c=this._mrt;if(!this._isHeaderLoaded||!c)return void a(new Error("Tile header is not ready"));let d=this.actor;if(!d)return void a(new Error("Can't fetch tile band without an actor"));let f,_=(S,D)=>{f.complete(S,D),S?a(S):(this.updateTextureDescriptor(e,n),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(S,D)=>{if(S)return a(S);let R=d.send("decodeRasterArray",{buffer:D,task:f},_,void 0,!0);this._workQueue.push(()=>{R&&R.cancel(),f.cancel()})},b=c.getLayer(e);if(!b)return void a(new Error(`Unknown sourceLayer "${e}"`));if(b.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let T=b.getDataRange([n]);if(f=c.createDecodingTask(T),!f||f.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(T.firstByte,T.lastByte+1));else{let S=Object.assign({},this.requestParams,{headers:{Range:`bytes=${T.firstByte}-${T.lastByte}`}}),D=Oa(S,y);this._fetchQueue.push(()=>{D.cancel(),f.cancel()})}else a(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(n)||!a.hasDataForBand(n))return;let{bytes:c,tileSize:d,buffer:f,offset:_,scale:y}=a.getBandView(n),b=d+2*f,T={data:c,width:b,height:b},S=this.texture;S&&S instanceof Zo&&S.update(T,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:T,buffer:f,offset:_,tileSize:d,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class zB{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){let c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){let f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let a=e.wrapped().key,c=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][c];return this.data[a].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let a in this.data)for(let c of this.data[a])e(c.value)||n.push(c);for(let a of n)this.remove(a.value.tileID,a)}}class qu extends La{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new zB(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new jz,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ro(this._tiles).map(e=>e.tileID).sort(RM).map(e=>e.key)}getRenderableIds(e,n){let a=[];for(let c in this._tiles)this._isIdRenderable(+c,e,n)&&a.push(this._tiles[c]);return e?a.sort((c,d)=>{let f=c.tileID,_=d.tileID,y=new lt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new lt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||b.y-y.y||b.x-y.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(RM).map(c=>c.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new sd(c,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Ci("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Kr.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ci("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let c=0;c<n.length;c++){let d=n[c];if(e.neighboringTiles&&e.neighboringTiles[d]){let f=this.getTileByID(d);a(e,f),a(f,e)}}function a(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let f=d.tileID.canonical.x-c.tileID.canonical.x,_=d.tileID.canonical.y-c.tileID.canonical.y,y=Math.pow(2,c.tileID.canonical.z),b=d.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,f,_),c.neighboringTiles&&c.neighboringTiles[b]&&(c.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,c){for(let d in this._tiles){let f=this._tiles[d];if(c[d]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>a)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){let b=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[b.key],f&&f.hasData()&&(_=b)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){c[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){let c=e.scaledTo(a),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let a=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,d=Math.floor(a*c*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let a={};for(let c in this._tiles){let d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,a,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Fr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,d=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(d.push(new Fr(1,0,1,0,0)),d.push(new Fr(1,0,1,1,0)),d.push(new Fr(1,0,1,0,1)),d.push(new Fr(1,0,1,1,1)))}else if(d=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);d=d.filter(b=>y(b))}}else d=[];if(d.length>0&&this.castsShadows&&c&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Qb(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),b=Math.min(y,this._source.maxzoom),T=e.extendTileCoverForShadows(d,c,b);for(let S of T)this._shadowCasterTiles[S.key]=!0,d.push(S)}let f=this._updateRetainedTiles(d);if(Qb(this._source.type)&&d.length!==0){let y={},b={},T=Object.keys(f);for(let D of T){let R=f[D],O=this._tiles[D];if(!O||O.fadeEndTime&&O.fadeEndTime<=Kr.now())continue;let F=this.findLoadedParent(R,Math.max(R.overscaledZ-qu.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),b[D]=R}let S=d[d.length-1].overscaledZ;for(let D in this._tiles){let R=this._tiles[D];if(f[D]||!R.hasData())continue;let O=R.tileID;for(;O.overscaledZ>S;){O=O.scaledTo(O.overscaledZ-1);let F=this._tiles[O.key];if(F&&F.hasData()&&b[O.key]){f[D]=R.tileID;break}}}for(let D in y)f[D]||(this._coveredTiles[D]=!0,f[D]=y[D])}for(let y in f)this._tiles[y].clearFadeHold();let _=function(y,b){let T=[];for(let S in y)S in b||T.push(S);return T}(this._tiles,f);for(let y of _){let b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let a={},c=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),d=e[0].overscaledZ,f=Math.max(d-qu.maxOverzooming,this._source.minzoom),_=Math.max(d+qu.maxUnderzooming,this._source.minzoom),y={};for(let b of e){let T=this._addTile(b);n[b.key]=b,T.hasData()||c<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,c,_,n);for(let b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){let D=b.children(this._source.maxzoom)[0],R=this.getTile(D);if(R&&R.hasData()){n[D.key]=D;continue}}else{let D=b.children(this._source.maxzoom);if(n[D[0].key]&&n[D[1].key]&&n[D[2].key]&&n[D[3].key])continue}let S=T.wasRequested();for(let D=b.overscaledZ-1;D>=f;--D){let R=b.scaledTo(D);if(a[R.key]||(a[R.key]=!0,T=this.getTile(R),!T&&S&&(T=this._addTile(R)),T&&(n[R.key]=R,S=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}n.push(c.key);let d=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;c=d}for(let d of n)this._loadedParentTiles[d]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let a=!!n;if(!a){let c=this.map?this.map.painter:null,d=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new PM(e,d,this.transform.tileZoom,c,this._isRaster):new d0(e,d,this.transform.tileZoom,c,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new Ci("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){let c=[],d=this.transform;if(!d)return c;let f=d.projection.name==="globe",_=Ys(d.center.lng);for(let y in this._tiles){let b=this._tiles[y];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(f){let S=b.tileID.canonical;if(S.z===0){let D=[Math.abs(Qt(_,...jm(S,-1))-_),Math.abs(Qt(_,...jm(S,1))-_)];T=[0,2*D.indexOf(Math.min(...D))-1]}else{let D=[Math.abs(Qt(_,...jm(S,-1))-_),Math.abs(Qt(_,...jm(S,0))-_),Math.abs(Qt(_,...jm(S,1))-_)];T=[D.indexOf(Math.min(...D))-1]}}else T=[0];for(let S of T){let D=e.containsTile(b,d,n,S);D&&c.push(D)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let a=this.getRenderableIds(e,n).map(d=>this._tiles[d].tileID),c=this.transform.projection.name==="globe";for(let d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=c?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){let n=e.slice(),a=this.transform._camera.position,c=this.transform._camera.forward(),d={};for(let f of n){let _=1/(1<<f.canonical.z);d[f.key]=((f.canonical.x+.5)*_+f.wrap-a[0])*c[0]+((f.canonical.y+.5)*_-a[1])*c[1]-a[2]*c[2]}return n.sort((f,_)=>d[f.key]-d[_.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Qb(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Kr.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){let c=this._tiles[e];c&&c.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(let a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,n))};return void this._source.on("data",_)}let a=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,f=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(let _ of c){let y=_.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let b of y)a.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}Ml(Array.from(a.values()),(_,y)=>{let b=new d0(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),y(T,b)})},n)}}function RM(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Qb(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function jm(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}qu.maxOverzooming=10,qu.maxUnderzooming=3;let OM=new class extends ut{possiblyEvaluate(t,e){return e=new Bt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=li({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(Zy.paint.properties["line-width"].specification);function kM(t,e){return e>0?e+2*t:t}OM.useIntegerZoom=!0;let BB=new Pn({"symbol-placement":new Be(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Be(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Be(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Be(Te.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Be(Te.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Be(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Be(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Be(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Be(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(Te.layout_symbol["icon-size"]),"icon-text-fit":new ut(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(Te.layout_symbol["icon-image"]),"icon-rotate":new ut(Te.layout_symbol["icon-rotate"]),"icon-padding":new Be(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Be(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(Te.layout_symbol["icon-offset"]),"icon-anchor":new ut(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Be(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Be(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Be(Te.layout_symbol["text-rotation-alignment"]),"text-field":new ut(Te.layout_symbol["text-field"]),"text-font":new ut(Te.layout_symbol["text-font"]),"text-size":new ut(Te.layout_symbol["text-size"]),"text-max-width":new ut(Te.layout_symbol["text-max-width"]),"text-line-height":new ut(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(Te.layout_symbol["text-letter-spacing"]),"text-justify":new ut(Te.layout_symbol["text-justify"]),"text-radial-offset":new ut(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Be(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new ut(Te.layout_symbol["text-anchor"]),"text-max-angle":new Be(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Be(Te.layout_symbol["text-writing-mode"]),"text-rotate":new ut(Te.layout_symbol["text-rotate"]),"text-padding":new Be(Te.layout_symbol["text-padding"]),"text-keep-upright":new Be(Te.layout_symbol["text-keep-upright"]),"text-transform":new ut(Te.layout_symbol["text-transform"]),"text-offset":new ut(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Be(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Be(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Be(Te.layout_symbol["text-optional"]),visibility:new Be(Te.layout_symbol.visibility)});var Jb={paint:new Pn({"icon-opacity":new ut(Te.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ut(Te.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ut(Te.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ut(Te.paint_symbol["text-emissive-strength"]),"icon-color":new ut(Te.paint_symbol["icon-color"]),"icon-halo-color":new ut(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Be(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Be(Te.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Te.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ut(Te.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ut(Te.paint_symbol["text-occlusion-opacity"]),"text-color":new ut(Te.paint_symbol["text-color"],{runtimeType:Si,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ut(Te.paint_symbol["text-halo-color"]),"text-halo-width":new ut(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(Te.paint_symbol["text-halo-blur"]),"text-translate":new Be(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Be(Te.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Be(Te.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Be(Te.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Be(Te.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Be(Te.paint_symbol["icon-color-brightness-max"])}),layout:BB};class LM{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Bl,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}J(LM,"FormatSectionOverride",{omit:["defaultValue"]});class f0 extends hi{constructor(e,n,a,c){super(e,Jb,n,a,c),this._colorAdjustmentMatrix=r.ad.identity([])}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let c=[];for(let d of a)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(d,f,_,y){d=Yh(d),f=Xh(f);let b=r.ad.create(),T=d/3,S=1-2*T,D=[S,T,T,0,T,S,T,0,T,T,S,0,0,0,0,1],R=.5-.5*f,O=y-_;return r.ad.multiply(b,[O,0,0,0,0,O,0,0,0,0,O,0,_,_,_,1],[f,0,0,0,0,f,0,0,0,0,f,0,R,R,R,1]),r.ad.multiply(b,b,D),b}(e,n,a,c),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,c){let d=this.layout.get(e).evaluate(n,{},a,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||N(f.value)||!d?d:function(_,y){return y.replace(/{([^{}]+)}/g,(b,T)=>T in _?String(_[T]):"")}(n.properties,d)}createBucket(e){return new Wd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Jb.paint.overridableProperties){if(!f0.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new LM(n),c=new k(a,n.property.specification,this.scope,this.options),d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new V("source",c):new G("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Jn(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&f0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),c=Jb.paint.properties[n],d=!1,f=_=>{for(let y of _)if(c.overrides&&c.overrides.hasOverride(y))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ci)f(a.value.value.sections);else if(a.value.kind==="source"){let _=b=>{d||(b instanceof ls&&Pr(b.value)===jl?f(b.value.sections):b instanceof yu?f(b.sections):b.eachChild(_))},y=a.value;y._styleExpression&&_(y._styleExpression.expression)}return d}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n,a){return{config:new Bu(this,{zoom:n,lut:a}),overrideFog:!1}}}let VB=new Pn({visibility:new Be(Te.layout_background.visibility)});var jB={paint:new Pn({"background-color":new Be(Te.paint_background["background-color"]),"background-pattern":new Be(Te.paint_background["background-pattern"]),"background-opacity":new Be(Te.paint_background["background-opacity"]),"background-emissive-strength":new Be(Te.paint_background["background-emissive-strength"])}),layout:VB};let UB=new Pn({visibility:new Be(Te.layout_raster.visibility)});var $B={paint:new Pn({"raster-opacity":new Be(Te.paint_raster["raster-opacity"]),"raster-color":new Lr(Te.paint_raster["raster-color"]),"raster-color-mix":new Be(Te.paint_raster["raster-color-mix"]),"raster-color-range":new Be(Te.paint_raster["raster-color-range"]),"raster-hue-rotate":new Be(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Be(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Be(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Be(Te.paint_raster["raster-saturation"]),"raster-contrast":new Be(Te.paint_raster["raster-contrast"]),"raster-resampling":new Be(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Be(Te.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Be(Te.paint_raster["raster-emissive-strength"]),"raster-array-band":new Be(Te.paint_raster["raster-array-band"]),"raster-elevation":new Be(Te.paint_raster["raster-elevation"])}),layout:UB};function p0(t,e,n,a,c,d,f,_){let y=[t,e,1,n,a,1,c,d,1],b=[f,_,1],T=r.bC.adjoint([],y),[S,D,R]=r._.transformMat3(b,b,T);return r.bC.multiply(y,y,[S,0,0,0,D,0,0,0,R])}function FM(t,e,n,a,c,d,f,_){let y=function(b,T,S,D,R,O,F,z){let j=p0(0,0,1,0,1,1,0,1),X=p0(b,T,S,D,R,O,F,z),Y=r.bC.adjoint([],j);return r.bC.multiply(X,X,Y)}(t,e,n,a,c,d,f,_);return[y[2]/y[8]/it,y[5]/y[8]/it]}function m0(t){return[t[0],Math.min(Math.max(t[1],-Tr),Tr)]}class NM extends La{constructor(e,n,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Ci("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Vs(this.map._requestManager.transformRequest(this.url,td.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new sd(a)):c&&(this.image=c instanceof HTMLImageElement?Kr.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new c0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ci("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof c0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(let d of e)d[1]>a&&(a=d[1]),d[1]<n&&(n=d[1]);let c=(a+n)/2;if(c>Tr?this.onNorthPole=!0:c<-Tr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let d=e.map(wi.fromLngLat);this.tileID=function(f){let _=1/0,y=1/0,b=-1/0,T=-1/0;for(let F of f)_=Math.min(_,F.x),y=Math.min(y,F.y),b=Math.max(b,F.x),T=Math.max(T,F.y);let S=Math.max(b-_,T-y),D=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),R=Math.pow(2,D),O=Math.floor((_+b)/2*R);return O>1&&(O-=1),new ju(D,O,Math.floor((y+T)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ci("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let z in this.tiles){let j=this.tiles[z];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=Hu(new ju(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(z){let j=z[1].x-z[0].x,X=z[1].y-z[0].y,Y=z[2].x-z[1].x,K=z[2].y-z[1].y,le=z[3].x-z[2].x,se=z[3].y-z[2].y,pe=z[0].x-z[3].x,_e=z[0].y-z[3].y,Ee=j*K-Y*X,Oe=Y*se-le*K,De=le*_e-pe*se,Ne=pe*X-j*_e;return Ee>0&&Oe>0&&De>0&&Ne>0||Ee<0&&Oe<0&&De<0&&Ne<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let c=Hu(this.tileID,this.map.transform.projection),[d,f,_,y]=this.coordinates.map(z=>{let j=c.projection.project(z[0],z[1]);return gM(c,j)._round()});this.perspectiveTransform=FM(d.x,d.y,f.x,f.y,_.x,_.y,y.x,y.y);let b=this._boundsArray=new Ql;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(f.x,f.y,it,0),b.emplaceBack(y.x,y.y,0,it),b.emplaceBack(_.x,_.y,it,it),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,h0.members),this.boundsSegments=cr.simpleSegment(0,0,4,2);let T=[],S=function(z){return[m0(z[0]),m0(z[1]),m0(z[2]),m0(z[3])]}(this.coordinates),[D,R,O,F]=function(z){let j=z[0][0],X=j,Y=z[0][1],K=Y;for(let le=1;le<z.length;le++)z[le][0]<j?j=z[le][0]:z[le][0]>X&&(X=z[le][0]),z[le][1]<Y?Y=z[le][1]:z[le][1]>K&&(K=z[le][1]);return[j,Y,X-j,K-Y]}(S);{let z=new Ql,[j,X,Y,K]=function(ke){let We=ke[0].x,Je=We,Ze=ke[0].y,ht=Ze;for(let Ye=1;Ye<ke.length;Ye++)ke[Ye].x<We?We=ke[Ye].x:ke[Ye].x>Je&&(Je=ke[Ye].x),ke[Ye].y<Ze?Ze=ke[Ye].y:ke[Ye].y>ht&&(ht=ke[Ye].y);return[We,Ze,Je-We,ht-Ze]}(a),le=ke=>[(ke.x-j)/Y,(ke.y-X)/K],[se,pe,_e,Ee]=a.map(le),Oe=function(ke,We,Je,Ze,ht,Ye,tt,Et){let yt=p0(0,0,1,0,1,1,0,1),gt=p0(ke,We,Je,Ze,ht,Ye,tt,Et),et=r.bC.adjoint([],gt);return r.bC.multiply(yt,yt,et)}(se[0],se[1],pe[0],pe[1],_e[0],_e[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=FM(se[0],se[1],pe[0],pe[1],_e[0],_e[1],Ee[0],Ee[1]);let De=(ke,We)=>{T.push(ke.lng);let Je=Math.round((ke.lng-D)/O*it),Ze=Math.round((ke.lat-R)/F*it),ht=le(We),Ye=r._.transformMat3([],[ht[0],ht[1],1],Oe),tt=Math.round(Ye[0]/Ye[2]*it),Et=Math.round(Ye[1]/Ye[2]*it);z.emplaceBack(Je,Ze,tt,Et)},Ne=a[3].x-a[0].x,Xe=a[3].y-a[0].y,Le=a[2].x-a[1].x,qe=a[2].y-a[1].y;for(let ke=0;ke<65;ke++){let We=ke/64,Je=[a[0].x+We*Ne,a[0].y+We*Xe],Ze=[a[1].x+We*Le,a[1].y+We*qe],ht=Ze[0]-Je[0],Ye=Ze[1]-Je[1];for(let tt=0;tt<65;tt++){let Et=tt/64,yt={x:Je[0]+ht*Et,y:Je[1]+Ye*Et,z:0};De(n.projection.unproject(yt.x,yt.y),yt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(z,h0.members)}{this.maxLongitudeTriangleSize=0;let z=[],j=new Ur,X=(Y,K,le)=>{j.emplaceBack(Y,K,le);let se=T[Y],pe=T[K],_e=T[le],Ee=Math.min(Math.min(se,pe),_e),Oe=Math.max(Math.max(se,pe),_e)-Ee;Oe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Oe),z.push(Ee+Oe/2)};for(let Y=0;Y<64;Y++)for(let K=0;K<64;K++){let le=65*Y+K,se=le+1,pe=le+65,_e=pe+1;X(le,pe,se),X(se,pe,_e)}[z,j]=function(Y,K){let le=Array.from({length:Y.length},(_e,Ee)=>Ee);le.sort((_e,Ee)=>Y[_e]-Y[Ee]);let se=[],pe=new Ur;for(let _e=0;_e<le.length;_e++){let Ee=le[_e];se.push(Y[Ee]);let Oe=3*Ee,De=Oe+1;pe.emplaceBack(K.uint16[Oe],K.uint16[De],K.uint16[De+1])}return[se,pe]}(z,j),this.elevatedGlobeTrianglesCenterLongitudes=z,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(j)}this.elevatedGlobeSegments=cr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/it,0,F/it,0,0,R,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof c0||(this.texture?this.texture.update(this.image):(this.texture=new Zo(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,c=(d=e+180)+360*Math.round((a[0]-d)/360);var d;let f=new cr,_=(S,D)=>{f.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:n.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=y){let S=M_(a,0,a.length,c+y);return S===a.length||_(S,wp(a,S+1,a.length,c+360-y)-S),f}c<a[0]&&(c+=360);let b=wp(a,0,a.length,c-y);if(b===a.length)return _(0,a.length),f;_(0,b-0);let T=M_(a,b+1,a.length,c+y);return T!==a.length&&_(T,a.length-T),f}}let GB=(Math.pow(256,2)-1)/16907520;class zM extends hi{constructor(e,n,a,c){super(e,$B,n,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof NM&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=wm({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let HB=new Pn({visibility:new Be(Te["layout_raster-particle"].visibility)});var qB={paint:new Pn({"raster-particle-array-band":new Be(Te["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Be(Te["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Lr(Te["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Be(Te["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Be(Te["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Be(Te["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Be(Te["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:HB};class BM extends hi{constructor(e,n,a,c){super(e,qB,n,a,c),this._updateColorRamp(),this.lastInvalidatedAt=Kr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=wm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Kr.now()}}class WB extends hi{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let ZB=new Pn({visibility:new Be(Te.layout_sky.visibility)});var XB={paint:new Pn({"sky-type":new Be(Te.paint_sky["sky-type"]),"sky-atmosphere-sun":new Be(Te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Be(Te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Be(Te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Be(Te.paint_sky["sky-gradient-radius"]),"sky-gradient":new Lr(Te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Be(Te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Be(Te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Be(Te.paint_sky["sky-opacity"])}),layout:ZB};function ew(t,e,n){let a=[0,0,1],c=r.av.identity([]);return r.av.rotateY(c,c,n?-ln(t)+Math.PI:ln(t)),r.av.rotateX(c,c,-ln(e)),r._.transformQuat(a,a,c),r._.normalize(a,a)}var YB={paint:new Pn({})};function VM(t,e){let n=g0(t.projection,t.zoom,t.width,t.height),a=function(d,f,_,y,b){let T=new yn(_.lng-180*gc,_.lat),S=new yn(_.lng+180*gc,_.lat),D=d.project(T.lng,T.lat),R=d.project(S.lng,S.lat),O=-Math.atan2(R.y-D.y,R.x-D.x),F=wi.fromLngLat(_);F.y=Qt(F.y,-1+gc,1-gc);let z=F.toLngLat(),j=d.project(z.lng,z.lat),X=wi.fromLngLat(z);X.x+=gc;let Y=X.toLngLat(),K=d.project(Y.lng,Y.lat),le=$M(K.x-j.x,K.y-j.y,O),se=wi.fromLngLat(z);se.y+=gc;let pe=se.toLngLat(),_e=d.project(pe.lng,pe.lat),Ee=$M(_e.x-j.x,_e.y-j.y,O),Oe=Math.abs(le.x)/Math.abs(Ee.y),De=r.ad.identity([]);r.ad.rotateZ(De,De,-O*(1-(b?0:y)));let Ne=r.ad.identity([]);return r.ad.scale(Ne,Ne,[1,1-(1-Oe)*y,1]),Ne[4]=-Ee.x/Ee.y*y,r.ad.rotateZ(Ne,Ne,O),r.ad.multiply(Ne,De,Ne),Ne}(t.projection,0,t.center,n,e),c=jM(t);return r.ad.scale(a,a,[c,c,1]),a}function jM(t){let e=t.projection,n=g0(t.projection,t.zoom,t.width,t.height),a=UM(e,t.center),c=UM(e,yn.convert(e.center));return Math.pow(2,a*n+(1-n)*c)}function g0(t,e,n,a,c=1/0){let d=t.range;if(!d)return 0;let f=Math.min(c,Math.max(n,a)),_=Math.log(f/1024)/Math.LN2;return Ma(d[0]+_,d[1]+_,e)}let gc=1/4e4;function UM(t,e){let n=Qt(e.lat,-Tr,Tr),a=new yn(e.lng-180*gc,n),c=new yn(e.lng+180*gc,n),d=t.project(a.lng,n),f=t.project(c.lng,n),_=wi.fromLngLat(a),y=wi.fromLngLat(c),b=f.x-d.x,T=f.y-d.y,S=y.x-_.x,D=y.y-_.y,R=Math.sqrt((S*S+D*D)/(b*b+T*T));return Math.log(R)/Math.LN2}function $M(t,e,n){let a=Math.cos(n),c=Math.sin(n);return{x:t*a-e*c,y:t*c+e*a}}function GM(t,e,n){r.ad.identity(t),r.ad.rotateZ(t,t,ln(e[2])),r.ad.rotateX(t,t,ln(e[0])),r.ad.rotateY(t,t,ln(e[1])),r.ad.scale(t,t,n),r.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function _0(t,e,n,a,c,d,f,_){let y=[n[0]-e[0],n[1]-e[1],0],b=[a[0]-e[0],a[1]-e[1],0];if(r._.length(y)<1e-12||r._.length(b)<1e-12)return r.av.identity(t);let T=r._.cross([],y,b);r._.normalize(T,T),r._.subtract(b,a,e),y[2]=(d-c)*_,b[2]=(f-c)*_;let S=y;return r._.cross(S,y,b),r._.normalize(S,S),r.av.rotationTo(t,T,S)}function tw(t,e,n=!1){let a=Ka(e.zoom),c=function(d,f,_){let y=f.worldSize,b=[d[12],d[13],d[14]],T=Jr(b[1]/y),S=Wi(b[0]/y),D=r.ad.identity([]),R=Vi(1,T)*y,O=Vi(1,0)*y*Uu(T,f.zoom),F=1/vb(y),z=O*F;if(_){let K=g0(f.projection,f.zoom,f.width,f.height,1024);z=F*f.projection.pixelSpaceConversion(f.center.lat,y,K)}let j=Vu(T,S);r._.add(j,j,r._.scale([],r._.normalize([],j),R*z*b[2]));let X=function(K){let le=[K[0],K[1],K[2]],se=[0,1,0],pe=r._.cross([],se,le);return r._.cross(se,le,pe),r._.squaredLength(se)===0&&(se=[0,1,0],r._.cross(pe,le,se)),r._.normalize(pe,pe),r._.normalize(se,se),r._.normalize(le,le),[pe[0],pe[1],pe[2],0,se[0],se[1],se[2],0,le[0],le[1],le[2],0,K[0],K[1],K[2],1]}(j);r.ad.scale(D,D,[z,z,z*R]),r.ad.translate(D,D,[-b[0],-b[1],-b[2]]);let Y=r.ad.multiply([],f.globeMatrix,X);return r.ad.multiply(Y,Y,D),r.ad.multiply(Y,Y,d),Y}(t,e,n);if(a>0){let d=function(f,_){let y=_.worldSize,b=Vi(1,0)*y*Uu(_.center.lat,_.zoom)/vb(y),T=Vi(1,_.center.lat)*y,S=r.ad.identity([]);return r.ad.rotateY(S,S,ln(_.center.lng)),r.ad.rotateX(S,S,ln(_.center.lat)),r.ad.translate(S,S,[0,0,Bi]),r.ad.scale(S,S,[b,b,b*T]),r.ad.translate(S,S,[_.point.x-.5*y,_.point.y-.5*y,0]),r.ad.multiply(S,S,f),r.ad.multiply(S,_.globeMatrix,S)}(t,e);return function(f,_,y){let b=(O,F,z)=>{let j=r._.length(O),X=r._.length(F),Y=Ya(O,F,z);return r._.scale(Y,Y,1/r._.length(Y)*It(j,X,z))},T=b([f[0],f[1],f[2]],[_[0],_[1],_[2]],y),S=b([f[4],f[5],f[6]],[_[4],_[5],_[6]],y),D=b([f[8],f[9],f[10]],[_[8],_[9],_[10]],y),R=Ya([f[12],f[13],f[14]],[_[12],_[13],_[14]],y);return[T[0],T[1],T[2],0,S[0],S[1],S[2],0,D[0],D[1],D[2],0,R[0],R[1],R[2],1]}(c,d,a)}return c}function HM(t,e,n,a){let c=ur.projectAabbCorners(a,n),d=Number.MAX_VALUE,f=-1;for(let b=0;b<c.length;++b){let T=c[b];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<d&&(f=b,d=T[2])}let _=b=>new lt(c[b][0],c[b][1]),y;switch(f){case 0:case 6:y=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:y=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:y=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:y=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(cb(t,y))return d}let KB=In([{name:"a_pos_3f",components:3,type:"Float32"}]),QB=In([{name:"a_color_3f",components:3,type:"Float32"}]),JB=In([{name:"a_color_4f",components:4,type:"Float32"}]),e5=In([{name:"a_uv_2f",components:2,type:"Float32"}]),t5=In([{name:"a_normal_3f",components:3,type:"Float32"}]),n5=In([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),r5=In([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class y0{constructor(e,n,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function qM(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class WM{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ZM{constructor(){this.instancedDataArray=new q1,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class nw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,c){this.tileToMeter=Iy(a);let d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:f,id:_,index:y,sourceLayerIndex:b}of e){let T=_??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),S=Xa(f,d);if(!this.layers[0]._featureFilter.filter(new Bt(this.zoom),S,a))continue;let D={id:T,sourceLayerIndex:b,index:y,geometry:d?S.geometry:ps(f,a,c),properties:f.properties,type:f.type,patterns:{}},R=this.addFeature(D,D.geometry,S);R&&n.featureIndex.insert(f,D.geometry,y,b,this.index,this.instancesPerModel[R].instancedDataArray.length,it/32)}this.lookup=null}update(e,n,a,c){for(let d in this.instancesPerModel){let f=this.instancesPerModel[d];for(let _ in e)f.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(f.features[f.idToFeaturesIndex[_]],e[_],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];for(let c of a.features){let d=this.layers[0],f=c.feature,_=this.canonical,y=d.paint.get("model-rotation").evaluate(f,{},_),b=d.paint.get("model-scale").evaluate(f,{},_),T=d.paint.get("model-translation").evaluate(f,{},_);r._.exactEquals(c.rotation,y)&&r._.exactEquals(c.scale,b)&&r._.exactEquals(c.translation,T)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Mb(this.activeReplacements,c))return!1;this.activeReplacements=c;let d=!1;for(let f in this.instancesPerModel){let _=this.instancesPerModel[f],y=_.instancedDataArray;for(let b of _.features){let T=b.instancedDataOffset,S=b.instancedDataCount;for(let D=0;D<S;D++){let R=16*(D+T),O=y.float32[R+0];O=O>it?O-it:O;let F=Math.floor(O),z=y.float32[R+1],j=!1;for(let X of this.activeReplacements)if(!(X.order<a||X.order===1/0)&&X.clipMask&fD.Model&&!(X.min.x>F||F>X.max.x||X.min.y>z||z>X.max.y)&&(j=oD(iD(F,z,e.canonical,X.footprintTileId.canonical),X),j))break;y.float32[R]=j?O+it:O,d=d||j}}}return d}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,n5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){let c=this.layers[0],d=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return wr(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),d;qM(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new ZM);let f=this.instancesPerModel[d],_=f.instancedDataArray,y=new WM(a,_.length);for(let b of n)for(let T of b){if(T.x<0||T.x>=it||T.y<0||T.y>=it)continue;let S=(this.lookupDim-1)/it,D=this.lookupDim*(T.y*S|0)+T.x*S|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let R=_.length;_.resize(R+1),f.instancesEvaluatedElevation.push(0),_.float32[16*R]=T.x,_.float32[16*R+1]=T.y}return y.instancedDataCount=f.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(y),this.evaluate(y,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,n,a,c){let d=this.layers[0],f=e.feature,_=this.canonical,y=e.rotation=d.paint.get("model-rotation").evaluate(f,n,_),b=e.scale=d.paint.get("model-scale").evaluate(f,n,_),T=e.translation=d.paint.get("model-translation").evaluate(f,n,_),S=d.paint.get("model-color").evaluate(f,n,_);S.a=d.paint.get("model-color-mix-intensity").evaluate(f,n,_);let D=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),GM(D,y,b);let R=Math.round(100*S.a)+S.b/1.05;for(let O=0;O<e.instancedDataCount;++O){let F=e.instancedDataOffset+O,z=16*F,j=a.instancedDataArray.float32,X=0;c&&(X=j[z+6]-a.instancesEvaluatedElevation[F]);let Y=0|j[z+1];j[z]=(0|j[z])+S.r/1.05,j[z+1]=Y+S.g/1.05,j[z+2]=R,j[z+3]=1/(_.z>10?this.tileToMeter:Iy(_,Y)),j[z+4]=T[0],j[z+5]=T[1],j[z+6]=T[2]+X,j[z+7]=D[0],j[z+8]=D[1],j[z+9]=D[2],j[z+10]=D[4],j[z+11]=D[5],j[z+12]=D[6],j[z+13]=D[8],j[z+14]=D[9],j[z+15]=D[10],a.instancesEvaluatedElevation[F]=T[2]}}}J(nw,"ModelBucket",{omit:["layers"]}),J(ZM,"PerModelAttributes"),J(WM,"ModelFeature");let i5=new Pn({visibility:new Be(Te.layout_model.visibility),"model-id":new ut(Te.layout_model["model-id"])});var o5={paint:new Pn({"model-opacity":new Be(Te.paint_model["model-opacity"]),"model-rotation":new ut(Te.paint_model["model-rotation"]),"model-scale":new ut(Te.paint_model["model-scale"]),"model-translation":new ut(Te.paint_model["model-translation"]),"model-color":new ut(Te.paint_model["model-color"]),"model-color-mix-intensity":new ut(Te.paint_model["model-color-mix-intensity"]),"model-type":new Be(Te.paint_model["model-type"]),"model-cast-shadows":new Be(Te.paint_model["model-cast-shadows"]),"model-receive-shadows":new Be(Te.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Be(Te.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ut(Te.paint_model["model-emissive-strength"]),"model-roughness":new ut(Te.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ut(Te.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Be(Te.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Be(Te.paint_model["model-front-cutoff"])}),layout:i5};let Wu=64,Yd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function XM(t,e,n,a,c,d,f,_,y,b=!1){let T=n.zoom,S=n.project(a),D=Uu(a.lat,T),R=1/D;r.ad.identity(t),r.ad.translate(t,t,[S.x+f[0]*R,S.y+f[1]*R,f[2]]);let O=1,F=1,z=n.worldSize;if(b){if(n.projection.name==="mercator"){let K=0;n.elevation&&(K=n.elevation.getAtPointOrZero(new wi(S.x/z,S.y/z),0));let le=r.aA.transformMat4([],[S.x,S.y,K,1],n.projMatrix)[3]/n.cameraToCenterDistance;O=le,F=le*Uu(n.center.lat,T)}else if(n.projection.name==="globe"){let K=tw(t,n),le=r.ad.multiply([],n.projMatrix,K),se=[0,0,0,1];r.aA.transformMat4(se,se,le);let pe=se[3]/n.cameraToCenterDistance,_e=Ka(T),Ee=n.projection.pixelsPerMeter(a.lat,z)*Uu(a.lat,T),Oe=n.projection.pixelsPerMeter(n.center.lat,z)*Uu(n.center.lat,T);O=pe/It(Ee,fI(n.center.lat),_e),F=pe*D/Ee,O*=Oe,F*=Oe}}else O=R;r.ad.scale(t,t,[O,O,F]);let j=[...t],X=e.orientation,Y=[];if(GM(Y,[X[0]+c[0],X[1]+c[1],X[2]+c[2]],d),r.ad.multiply(t,j,Y),_&&n.elevation){let K=0,le=[];if(y&&n.elevation){K=function(_e,Ee,Oe,De,Ne){let Xe=Ee.elevation;if(!Xe)return 0;let Le=ur.projectAabbCorners(Oe,De),qe=Vi(1,Ne.lat)*Ee.worldSize,ke=function(Ct,qt){let At=[0,0,1],Xt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Wt of Xt){let nn=Ct[Wt.corners[0]],Dt=Ct[Wt.corners[1]],Bn=Ct[Wt.corners[2]],Nn=[Dt[0]-nn[0],Dt[1]-nn[1],qt*(Dt[2]-nn[2])],Tn=r._.cross(Nn,Nn,[Bn[0]-nn[0],Bn[1]-nn[1],qt*(Bn[2]-nn[2])]);r._.normalize(Tn,Tn),Wt.dotProductWithUp=r._.dot(Tn,At)}return Xt.sort((Wt,nn)=>Wt.dotProductWithUp-nn.dotProductWithUp),Xt[0].corners}(Le,qe),We=Le[ke[0]],Je=Le[ke[1]],Ze=Le[ke[2]],ht=Le[ke[3]],Ye=Xe.getAtPointOrZero(new wi(We[0]/Ee.worldSize,We[1]/Ee.worldSize),0),tt=Xe.getAtPointOrZero(new wi(Je[0]/Ee.worldSize,Je[1]/Ee.worldSize),0),Et=Xe.getAtPointOrZero(new wi(Ze[0]/Ee.worldSize,Ze[1]/Ee.worldSize),0),yt=Xe.getAtPointOrZero(new wi(ht[0]/Ee.worldSize,ht[1]/Ee.worldSize),0),gt=(Ye+yt)/2,et=(tt+Et)/2;return gt>et?tt<Et?_0(_e,Je,ht,We,tt,yt,Ye,qe):_0(_e,Ze,We,ht,Et,Ye,yt,qe):Ye<yt?_0(_e,We,Je,Ze,Ye,tt,Et,qe):_0(_e,ht,Ze,Je,yt,Et,tt,qe),Math.max(gt,et)}(le,n,e.aabb,t,a);let se=r.ad.fromQuat([],le),pe=r.ad.multiply([],se,Y);r.ad.multiply(t,j,pe)}else K=n.elevation.getAtPointOrZero(new wi(S.x/z,S.y/z),0);K!==0&&(t[14]+=K)}}function Um(t,e,n=!1){t.uploaded||(t.gfxTexture=new Zo(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function s5(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,KB.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,t5.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,e5.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?QB:JB).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,r5.members,!0)),t.segments=cr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&Um(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Um(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Um(a.normalTexture,e),a.occlusionTexture&&Um(a.occlusionTexture,e,n),a.emissionTexture&&Um(a.emissionTexture,e)}function rw(t,e,n){if(t.meshes)for(let a of t.meshes)s5(a,e,n);if(t.children)for(let a of t.children)rw(a,e,n)}function v0(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)v0(e)}function iw(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)iw(n)}class a5{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class l5{constructor(){this.tasks={},this.taskQueue=[],qh(["process"],this),this.invoker=new a5(this.process),this.nextId=0}add(e,n){let a=this.nextId++,c=function({type:d,isSymbolTile:f,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-_:d==="maybePrepare"&&f?400-_:500:200-_:100-_}(n);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let d=this.tasks[this.taskQueue[c]];d.priority<n&&(n=d.priority,e=c)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class YM{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},qh(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new l5}send(e,n,a,c,d=!1,f){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[_]=a);let y=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:ge(n,y)},y),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){let n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(n.mustQueue||Yr()){let c=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,n),c&&c.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Ce(n.error)):a(null,Ce(n.data)))}else{let a=new Set,c=n.hasCallback?(f,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?ge(f):null,data:ge(_,a)},a)}:f=>{},d=Ce(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,d,c);else if(this.parent.getWorkerSource){let f=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,f[0],d.source,d.scope)[f[1]](d,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let ow=(()=>{class t{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Gh();let c=this.workerPool.acquire(this.id);for(let d=0;d<c.length;d++){let f=new t.Actor(c[d],a,this.id);f.name=`Worker ${d}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,c){Ml(this.actors,(d,f)=>{d.send(n,a,f)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=YM,t})();var $m={workerUrl:"",workerClass:null,workerParams:void 0};function c5(){return $m.workerClass!=null?new $m.workerClass:new self.Worker($m.workerUrl,$m.workerParams)}let sw="mapboxgl_preloaded_worker_pool";class Gm{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Gm.workerCount;)this.workers.push(new c5);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[sw]}numActive(){return Object.keys(this.active).length}}let Hm;function x0(){return Hm||(Hm=new Gm),Hm}Gm.workerCount=2;let b0,aw,bs,Kd,lw,Qd=null;function KM(){return Yr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:aw||A.DRACO_URL}function QM(){if(Yr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Kd)return Kd;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Kd=WebAssembly.validate(t)?A.MESHOPT_SIMD_URL:A.MESHOPT_URL,Kd}let w0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},u5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},qm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function JM(t,e,n){let a=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}let cw="KHR_draco_mesh_compression";function h5(t,e){let n=t.extensions&&t.extensions[cw];if(!n)return;let a=new bs.Decoder,c=r2(e,n.bufferView),d=new bs.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,d))throw new Error("Failed to decode Draco mesh");let f=e.json.accessors[t.indices],_=w0[f.componentType],y=f.count*_.BYTES_PER_ELEMENT,b=bs._malloc(y);_===Uint16Array?a.GetTrianglesUInt16Array(d,y,b):a.GetTrianglesUInt32Array(d,y,b),JM(bs.memory.buffer.slice(b,b+y),f,e),bs._free(b);for(let T of Object.keys(n.attributes)){let S=a.GetAttributeByUniqueId(d,n.attributes[T]),D=e.json.accessors[t.attributes[T]],R=u5[D.componentType],O=D.count*qm[D.type]*w0[D.componentType].BYTES_PER_ELEMENT,F=bs._malloc(O);a.GetAttributeDataArrayForAllPoints(d,S,bs[R],O,F),JM(bs.memory.buffer.slice(F,F+O),D,e),bs._free(F)}a.destroy(),d.destroy(),delete t.extensions[cw]}let E0="EXT_meshopt_compression";function d5(t,e){if(!t.extensions||!t.extensions[E0])return;let n=t.extensions[E0],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);lw.decodeGltfBuffer(c,n.count,n.byteStride,a,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[E0]}let e2=1179937895,t2=new TextDecoder("utf8");function n2(t,e){return new URL(t,e).href}function f5(t,e,n,a){return fetch(n2(t.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function r2(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function p5(t,e,n,a){if(t.uri){let c=n2(t.uri,a);return fetch(c).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[n]=d})}if(t.bufferView!==void 0){let c=r2(e,t.bufferView),d=new Blob([c],{type:t.mimeType});return createImageBitmap(d).then(f=>{e.images[n]=f})}}function i2(t,e=0,n){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===e2){let T=new Uint32Array(t,e),S=2,D=(T[S++]>>2)-3,R=T[S++]>>2;if(S++,a.json=JSON.parse(t2.decode(T.subarray(S,S+R))),S+=R,S<D){let O=T[S++];S++;let F=e+(S<<2);a.buffers[0]=t.slice(F,F+O)}}else a.json=JSON.parse(t2.decode(new Uint8Array(t,e)));let{buffers:c,images:d,meshes:f,extensionsUsed:_,bufferViews:y}=a.json,b=Promise.resolve();if(c){let T=[];for(let S=0;S<c.length;S++){let D=c[S];D.uri?T.push(f5(D,a,S,n)):a.buffers[S]||(a.buffers[S]=null)}b=Promise.all(T)}return b.then(()=>{let T=[],S=_&&_.includes(cw),D=_&&_.includes(E0);if(S&&T.push(function(){if(!bs)return b0||(b0=function(R){let O,F=null;function z(){O=new Uint8Array(F.buffer)}function j(){throw new Error("Unexpected Draco error.")}let X={a:{a:j,d:function(Y,K,le){return O.copyWithin(Y,K,K+le)},c:function(Y){let K=O.length,le=Math.max(Y>>>0,Math.ceil(1.2*K)),se=Math.ceil((le-K)/65536);try{return F.grow(se),z(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,X):R.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,X))).then(Y=>{let{Rb:K,Qb:le,P:se,T:pe,X:_e,Ja:Ee,La:Oe,Qa:De,Va:Ne,Wa:Xe,eb:Le,jb:qe,f:ke,e:We,yb:Je,zb:Ze,Ab:ht,Bb:Ye,Db:tt,Gb:Et}=Y.instance.exports;F=We;let yt=(()=>{let gt=0,et=0,Ct=0,qt=0;return At=>{Ct&&(K(qt),K(gt),et+=Ct,Ct=gt=0),gt||(et+=128,gt=le(et));let Xt=At.length+7&-8,Wt=gt;Xt>=et&&(Ct=Xt,Wt=qt=le(Xt));for(let nn=0;nn<At.length;nn++)O[Wt+nn]=At[nn];return Wt}})();return z(),ke(),{memory:We,_free:K,_malloc:le,Mesh:class{constructor(){this.ptr=se()}destroy(){pe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ee()}destroy(){qe(this.ptr)}DecodeArrayToMesh(gt,et,Ct){let qt=yt(gt),At=Oe(this.ptr,qt,et,Ct.ptr);return!!_e(At)}GetAttributeByUniqueId(gt,et){return{ptr:De(this.ptr,gt.ptr,et)}}GetTrianglesUInt16Array(gt,et,Ct){Ne(this.ptr,gt.ptr,et,Ct)}GetTrianglesUInt32Array(gt,et,Ct){Xe(this.ptr,gt.ptr,et,Ct)}GetAttributeDataArrayForAllPoints(gt,et,Ct,qt,At){Le(this.ptr,gt.ptr,et.ptr,Ct,qt,At)}},DT_INT8:Je(),DT_UINT8:Ze(),DT_INT16:ht(),DT_UINT16:Ye(),DT_UINT32:tt(),DT_FLOAT32:Et()}})}(fetch(KM())),b0.then(R=>{bs=R,b0=void 0}))}()),D&&T.push(function(){if(lw)return;let R=function(O){let F,z=WebAssembly.instantiateStreaming(O,{}).then(Y=>{F=Y.instance,F.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},X={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(Y,K,le,se,pe,_e){(function(Ee,Oe,De,Ne,Xe,Le,qe){let ke=Ee.exports.sbrk,We=Ne+3&-4,Je=ke(We*Xe),Ze=ke(Le.length),ht=new Uint8Array(Ee.exports.memory.buffer);ht.set(Le,Ze);let Ye=Oe(Je,Ne,Xe,Ze,Le.length);if(Ye===0&&qe&&qe(Je,We,Xe),De.set(ht.subarray(Je,Je+Ne*Xe)),ke(Je-ke(0)),Ye!==0)throw new Error(`Malformed buffer data: ${Ye}`)})(F,F.exports[X[pe]],Y,K,le,se,F.exports[j[_e]])}}}(fetch(QM()));return R.ready.then(()=>{lw=R})}()),d)for(let R=0;R<d.length;R++)T.push(p5(d[R],a,R,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(S&&f)for(let{primitives:R}of f)for(let O of R)h5(O,a);if(D&&f&&y)for(let R of y)d5(R,a);return a})})}function Zu(t,e){let n=t.json.bufferViews[e.bufferView],a=w0[e.componentType];return new a(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==qm[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:qm[e.type]))}function uw(t,e,n,a){let c=w0[e.componentType],d=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),f=t.json.bufferViews[e.bufferView],_=f.byteStride?f.byteStride/c.BYTES_PER_ELEMENT:qm[e.type],y=n.float32,b=y.length/n.capacity;for(let T=0,S=0;T<e.count*_;T+=_,S+=b)for(let D=0;D<b;D++)y[S+D]=a[T+D]*d;n._trim()}function m5(t,e,n){let a=t.indices,c=t.attributes,d={};d.indexArray=new Ur;let f=e.json.accessors[a],_=f.count/3;d.indexArray.reserve(_);let y=Zu(e,f);for(let D=0;D<_;D++)d.indexArray.emplaceBack(y[3*D],y[3*D+1],y[3*D+2]);d.indexArray._trim(),d.vertexArray=new ec;let b=e.json.accessors[c.POSITION];d.vertexArray.reserve(b.count);let T=Zu(e,b);for(let D=0;D<b.count;D++)d.vertexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);if(d.vertexArray._trim(),d.aabb=new ur(b.min,b.max),d.centroid=function(D,R){let O=[0,0,0],F=D.length;if(F>0){for(let z=0;z<F;z++){let j=3*D[z];O[0]+=R[j],O[1]+=R[j+1],O[2]+=R[j+2]}O[0]/=F,O[1]/=F,O[2]/=F}return O}(y,T),c.COLOR_0!==void 0){let D=e.json.accessors[c.COLOR_0],R=qm[D.type],O=Zu(e,D);d.colorArray=R===3?new ec:new Jl,d.colorArray.resize(D.count),uw(e,D,d.colorArray,O)}if(c.NORMAL!==void 0){d.normalArray=new ec;let D=e.json.accessors[c.NORMAL];d.normalArray.resize(D.count);let R=Zu(e,D);uw(e,D,d.normalArray,R)}if(c.TEXCOORD_0!==void 0&&n.length>0){d.texcoordArray=new Dd;let D=e.json.accessors[c.TEXCOORD_0];d.texcoordArray.resize(D.count);let R=Zu(e,D);uw(e,D,d.texcoordArray,R)}if(c._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=Zu(e,D))}c._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(Zu(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));let S=t.material;return d.material=function(D,R){let{emissiveFactor:O=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:z=.5,normalTexture:j,occlusionTexture:X,emissiveTexture:Y,doubleSided:K}=D,{baseColorFactor:le=[1,1,1,1],metallicFactor:se=1,roughnessFactor:pe=1,baseColorTexture:_e,metallicRoughnessTexture:Ee}=D.pbrMetallicRoughness||{},Oe=X?R[X.index]:void 0;if(X&&X.extensions&&X.extensions.KHR_texture_transform&&Oe){let De=X.extensions.KHR_texture_transform;Oe.offsetScale=[De.offset[0],De.offset[1],De.scale[0],De.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new bn(...le),metallicFactor:se,roughnessFactor:pe,baseColorTexture:_e?R[_e.index]:void 0,metallicRoughnessTexture:Ee?R[Ee.index]:void 0},doubleSided:K,emissiveFactor:O,alphaMode:F,alphaCutoff:z,normalTexture:j?R[j.index]:void 0,occlusionTexture:Oe,emissionTexture:Y?R[Y.index]:void 0,defined:D.defined===void 0}}(S!==void 0?e.json.materials[S]:{defined:!1},n),d}function o2(t,e,n){let{matrix:a,rotation:c,translation:d,scale:f,mesh:_,extras:y,children:b}=t,T={};if(T.matrix=a||r.ad.fromRotationTranslationScale([],c||[0,0,0,1],d||[0,0,0],f||[1,1,1]),_!==void 0){T.meshes=n[_];let S=T.anchor=[0,0];for(let D of T.meshes){let{min:R,max:O}=D.aabb;S[0]+=R[0]+O[0],S[1]+=R[1]+O[1]}S[0]=Math.floor(S[0]/T.meshes.length/2),S[1]=Math.floor(S[1]/T.meshes.length/2)}if(y&&(y.id&&(T.id=y.id),y.lights&&(T.lights=function(S){if(!S.length)return[];let D=function(j){let X=atob(j),Y=new Uint8Array(X.length);for(let K=0;K<X.length;K++)Y[K]=X.codePointAt(K);return Y}(S),R=[],O=D.length/24,F=new Uint16Array(D.buffer),z=new Float32Array(D.buffer);for(let j=0;j<O;j++){let X=F[2*j*6]/30,Y=F[2*j*6+1]/30,K=F[2*j*6+10]/100,le=z[6*j+1],se=z[6*j+2],pe=z[6*j+3],_e=z[6*j+4],Ee=pe-le,Oe=_e-se,De=Math.hypot(Ee,Oe);R.push({pos:[le+.5*Ee,se+.5*Oe,Y],normal:[Oe/De,-Ee/De,0],width:De,height:X,depth:K,points:[le,se,pe,_e]})}return R}(y.lights))),b){let S=[];for(let D of b)S.push(o2(e.json.nodes[D],e,n));T.children=S}return T}function g5(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new Sb(t.vertices,t.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:a}}function _5(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let a=[];for(let f of n){if(!Array.isArray(f)||f.length!==2)continue;let _=f[0],y=f[1];typeof _=="number"&&typeof y=="number"&&a.push(new lt(_,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let f=0;f<a.length;f++){let _=a[f],y=a[(f+1)%a.length],b=a[(f+2)%a.length];c+=(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)}c>0&&a.reverse();let d=Em(a.flatMap(f=>[f.x,f.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function y5(t,e){let n=[],a=[],c=0,d=[];for(let f of t){c=n.length;let _=f.vertexArray.float32,y=f.indexArray.uint16;for(let b=0;b<f.vertexArray.length;b++)d[0]=_[3*b+0],d[1]=_[3*b+1],d[2]=_[3*b+2],r._.transformMat4(d,d,e),n.push(new lt(d[0],d[1]));for(let b=0;b<3*f.indexArray.length;b++)a.push(y[b]+c)}if(a.length%3!=0)return null;for(let f=0;f<a.length;f+=3){let _=n[a[f+0]],y=n[a[f+1]],b=n[a[f+2]];(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)>0&&([a[f+1],a[f+2]]=[a[f+2],a[f+1]])}return{vertices:n,indices:a}}function s2(t){let e=function(y,b){let T=[],S=WebGL2RenderingContext;if(y.json.textures)for(let D of y.json.textures){let R={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};D.sampler!==void 0&&Object.assign(R,y.json.samplers[D.sampler]),T.push({image:b[D.source],sampler:R,uploaded:!1})}return T}(t,t.images),n=function(y,b){let T=[];for(let S of y.json.meshes){let D=[];for(let R of S.primitives)D.push(m5(R,y,b));T.push(D)}return T}(t,e),{scenes:a,scene:c,nodes:d}=t.json,f=a?a[c||0].nodes:d,_=[];for(let y of f)_.push(o2(d[y],t,n));return function(y,b,T){let S={},D=new Set;for(let R=0;R<y.length;R++){let O=T[b[R]];if(!O.extras)continue;let F=O.extras["mapbox:footprint:version"],z=O.extras["mapbox:footprint:id"];(F||z)&&D.add(R),F==="1.0.0"&&z&&(S[z]=R)}for(let R=0;R<y.length;R++){if(D.has(R))continue;let O=y[R],F=T[b[R]];if(!F.extras)continue;let z=null;O.id in S&&(z=y5(y[S[O.id]].meshes,O.matrix)),z||(z=_5(F)),z&&(O.footprint=g5(z))}if(D.size>0){let R=Array.from(D.values()).sort((O,F)=>O-F);for(let O=R.length-1;O>=0;O--)y.splice(R[O],1)}}(_,f,t.json.nodes),_}function v5(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,c=Wu/(t.aabb.max[0]-n+2),d=Wu/(t.aabb.max[1]-a+2);for(let f=0;f<e.length;f+=3){let _=e[f+2],y=(e[f+0]-n)*c|0,b=(e[f+1]-a)*d|0;_>t.heightmap[b*Wu+y]&&(t.heightmap[b*Wu+y]=_)}}function x5(t,e){let n={};n.indexArray=new Ur,n.indexArray.reserve(4*t.length),n.vertexArray=new ec,n.vertexArray.reserve(10*t.length),n.colorArray=new Jl,n.vertexArray.reserve(10*t.length);let a=0;for(let f of t){let _=Math.min(10,Math.max(4,1.3*f.height))*e,y=[-f.normal[1],f.normal[0],0],b=Math.min(.29,.1*f.width/f.depth),T=f.width-2*f.depth*e*(b+.01),S=r._.scaleAndAdd([],f.pos,y,T/2),D=r._.scaleAndAdd([],f.pos,y,-T/2),R=[S[0],S[1],S[2]+f.height],O=[D[0],D[1],D[2]+f.height],F=r._.scaleAndAdd([],f.normal,y,b);r._.scale(F,F,_);let z=r._.scaleAndAdd([],f.normal,y,-b);r._.scale(z,z,_),r._.add(F,S,F),r._.add(z,D,z),S[2]+=.1,D[2]+=.1,n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]);let j=T/_/2;n.colorArray.emplaceBack(-j-b,-1,j,.8),n.colorArray.emplaceBack(j+b,-1,j,.8),n.colorArray.emplaceBack(-j,0,j,1.3),n.colorArray.emplaceBack(j,0,j,1.3),n.colorArray.emplaceBack(j+b,-.8,j,.7),n.colorArray.emplaceBack(j+b,-.8,j,.7),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(j+b,-1.2,j,.8),n.colorArray.emplaceBack(j+b,-1.2,j,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let c={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=bn.white,c.pbrMetallicRoughness=d,n.material=c,n.aabb=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let hw=new Float32Array(262144),Xu=new Uint8Array(262144);function a2(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,a2(n));return e}function l2(t,e,n){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&n.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)l2(a,e,n)}let c2=["","wall","door","roof","window","lamp","logo"];class u2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:a2(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=ur.applyTransform(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class T0{constructor(e,n,a,c,d,f){this.id=n,this.modelTraits|=Yd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Yd.HasMapboxMeshFeatures),c&&(this.modelTraits|=Yd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new u2(_)),l2(_,f.featureIndexArray.length,f.grid),f.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,f.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let a of this.getNodesInfo()){let c=a.node;c.footprint&&n.push({footprint:c.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let a of n){let c=a.node;this.uploaded?this.updatePbrBuffer(c):rw(c,e,!0)}for(let a of n)v0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){let c=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||Wm(a.paint.get("model-color").value,f)||Wm(a.paint.get("model-color-mix-intensity").value,f)||Wm(a.paint.get("model-roughness").value,f)||Wm(a.paint.get("model-emissive-strength").value,f)||Wm(a.paint.get("model-height-based-emissive-strength-multiplier").value,f))&&(this.projection=c,this.brightness=d,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),c=this.id.canonical;for(let d of a){let f=d.feature;d.evaluatedScale=n.paint.get("model-scale").evaluate(f,{},c)}}evaluate(e){let n=this.getNodesInfo();for(let a of n){if(!a.node.meshes)continue;let c=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,f=a.evaluatedColor[2],_=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let b=0;b<c2.length;b++){let T=c2[b];T.length&&(c.properties.part=T);let S=e.paint.get("model-color").evaluate(c,{},y).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(c,{},y);a.evaluatedColor[b]=[S.r,S.g,S.b,D],a.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(c,{},y),a.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y),a.evaluatedRMEA[b][3]=S.a,a.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},y),!a.hasTranslucentParts&&S.a<1&&(a.hasTranslucentParts=!0)}delete c.properties.part,w5(a,f!==a.evaluatedColor[2]||_!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,c){let d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;let f=Nd.create(e,a,d);if(!f)return;this.modelTraits&Yd.HasMapboxMeshFeatures&&this.updateDEM(e,f,a,c);for(let _ of this.getNodesInfo()){let y=_.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let b=y.footprint.vertices,T=f.getElevationAt(b[0].x,b[0].y,!0,!0);for(let S=1;S<b.length;S++)T=Math.min(T,f.getElevationAt(b[S].x,b[S].y,!0,!0));y.elevation=T}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,c){let d=n._dem._modifiedForSources[c];if(d===void 0&&(n._dem._modifiedForSources[c]=[],d=n._dem._modifiedForSources[c]),d.includes(a.canonical))return;let f=n._dem.dim;d.push(a.canonical);let _=!1;for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.grid)continue;let T=b.footprint.grid,S=n.tileCoordToPixel(T.min.x,T.min.y),D=n.tileCoordToPixel(T.max.x,T.max.y),R=Math.min(Math.min(f-D.y,S.x),Math.min(S.y,f-D.x));if(R<0)continue;let O=Qt(R,2,5),F=Math.max(0,S.x-O),z=Math.max(0,S.y-O),j=Math.min(D.x+O,f-1),X=Math.min(D.y+O,f-1);for(let se=z;se<=X;++se)for(let pe=F;pe<=j;++pe)Xu[se*f+pe]=255;let Y=0,K=0;for(let se=0;se<T.cellsY;++se)for(let pe=0;pe<T.cellsX;++pe){if(!T.cells[se*T.cellsX+pe])continue;let _e=n.tileCoordToPixel(T.min.x+pe/T.xScale,T.min.y+se/T.yScale),Ee=n.tileCoordToPixel(T.min.x+(pe+1)/T.xScale,T.min.y+(se+1)/T.yScale);for(let Oe=_e.y;Oe<=Math.min(Ee.y+1,f-1);++Oe)for(let De=_e.x;De<=Math.min(Ee.x+1,f-1);++De)Xu[Oe*f+De]===255&&(Xu[Oe*f+De]=0,Y+=n.getElevationAtPixel(De,Oe),K++)}let le=Y/K;F=Math.max(1,S.x-O),z=Math.max(1,S.y-O),j=Math.min(D.x+O,f-2),X=Math.min(D.y+O,f-2),_=!0;for(let se=z;se<=X;++se)for(let pe=F;pe<=j;++pe)Xu[se*f+pe]===0&&(hw[se*f+pe]=n._dem.set(pe,se,le));for(let se=1;se<O;++se){F=Math.max(1,S.x-se),z=Math.max(1,S.y-se),j=Math.min(D.x+se,f-2),X=Math.min(D.y+se,f-2);for(let pe=z;pe<=X;++pe)for(let _e=F;_e<=j;++_e){let Ee=pe*f+_e;if(Xu[Ee]===255){let Oe=0,De=0,Ne=-1,Xe=-1;for(let Le=-1;Le<=1;++Le)for(let qe=-1;qe<=1;++qe){let ke=(pe+Le)*f+_e+qe;if(Xu[ke]>=se)continue;let We=hw[ke],Je=Math.abs(We);Je>De&&(Oe=We,De=Je,Ne=qe,Xe=Le)}if(De>.1){let Le=1-(se+.5*Math.abs(Ne*Xe))/O,qe=n._dem.get(_e,pe)+Oe*Le,ke=n._dem.get(_e+Ne,pe+Xe),We=n._dem.get(_e-Ne,pe-Xe,!0);(qe-ke)*(qe-We)>0&&(qe=(ke+We)/2),hw[Ee]=n._dem.set(_e,pe,qe),Xu[Ee]=se}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Kr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)v0(n.node),iw(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){let f=c[d].node;c[d].hiddenByReplacement=!!f.footprint&&!a.find(_=>_.footprint===f.footprint)}}getHeightAtTileCoord(e,n){let a=this.getNodesInfo(),c=[],d=[0,0,0],f=r.ad.identity([]);for(let _=0;_<this.nodesInfo.length;_++){let y=a[_],b=y.node.meshes[0],T=b.transformedAabb;if(e<T.min[0]||n<T.min[1]||e>T.max[0]||n>T.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};r.ad.invert(f,y.node.matrix),d[0]=e,d[1]=n,r._.transformMat4(d,d,f);let S=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*Wu|0,D=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*Wu|0)*Wu+Math.min(63,S),R=b.heightmap[D];if(!(R<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:R,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new lt(e,n),new lt(e,n),c),c.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Wm(t,e){return!t.isLightConstant&&e}function b5(t,e,n,a,c,d,f,_){let y=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;n[3]>0&&(y=It(y,255*n[0],n[3]),b=It(b,255*n[1],n[3]),T=It(T,255*n[2],n[3]));let S=y<<8|b,D=T<<8|Math.floor(255*a[3]),R=function(se){let pe=Qt(se,0,2);return Math.min(Math.round(.5*pe*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],O=Qt(c[0],0,1),F=Qt(c[1],0,1),z=Qt(c[2],0,1),j=Qt(c[3],0,1),X,Y,K,le;if(O!==F&&f!==d&&F!==O){let se=f-d;Y=1/(se*(F-O)),K=-(d+se*O)/(se*(F-O));let pe=Qt(c[4],-1,1);le=Math.pow(10,pe),X=255*z<<8|255*j}else X=65535,Y=0,K=1,le=1;if(t.emplaceBack(S,D,R,X,Y,K,le),_){let se=_.length;_.clear();for(let pe=0;pe<se;pe++)_.emplaceBack(S,D,R,X,Y,K,le)}}function w5(t,e,n){let a=t.node,c=0,d=n&Yd.HasMeshoptCompression;for(let f of a.meshes){if(a.lights&&a.lightMeshIndex===c||!f.featureData)continue;f.featureArray=new Ty,f.featureArray.reserve(f.featureData.length);let _=e;for(let y of f.featureData){let b=d?65535&y:y>>16&65535,T=d?y>>16&65535:65535&y,S=(15&T)<8?15&T:0,D=t.evaluatedRMEA[S],R=t.evaluatedColor[S],O=t.emissionHeightBasedParams[S],F;if(_&&S===2&&a.lights&&(F=new Ty,F.resize(10*a.lights.length)),b5(f.featureArray,b,R,D,O,f.aabb.min[2],f.aabb.max[2],F),F&&_){_=!1;let z=a.meshes[a.lightMeshIndex];z.featureArray=F,z.featureArray._trim()}}f.featureArray._trim(),c++}}function h2(t,e,n,a){let c=1<<t.z;e.lat=Jr((a/it+t.y)/c),e.lng=Wi((n/it+t.x)/c)}J(T0,"Tiled3dModelBucket",{omit:["layers"]}),J(u2,"Tiled3dModelFeature");let E5={circle:class extends hi{constructor(t,e,n,a){super(t,c3,e,n,a)}createBucket(t){return new lb(t)}queryRadius(t){let e=t;return kd("circle-radius",this,e)+kd("circle-stroke-width",this,e)+Ay(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,c,d,f,_){let y=wI(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return NI(t,a,d,f,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let a=FI(this);return{config:new Bu(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends hi{createBucket(t){return new BI(t)}constructor(t,e,n,a){super(t,x3,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return kd("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,c,d,f,_){let y=this.paint.get("heatmap-radius").evaluate(e,n);return NI(t,a,d,f,_,!0,!0,new lt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new Bu(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends hi{constructor(t,e,n,a){super(t,w3,e,n,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends hi{constructor(t,e,n,a){super(t,F3,e,n,a)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new Bu(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new By(t)}queryRadius(){return Ay(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,c,d){return!t.queryGeometry.isAboveHorizon&&_I(bI(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends hi{constructor(t,e,n,a){super(t,dz,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new qy(t)}queryRadius(){return Ay(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,c,d,f,_,y){let b=wI(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),S=this.paint.get("fill-extrusion-base").evaluate(e,n),D=[0,0],R=_&&d.elevation,O=d.elevation?d.elevation.exaggeration():1,F=t.tile.getBucket(this);if(R&&F instanceof qy){let K=F.centroidVertexArray,le=y+1;le<K.length&&(D[0]=K.geta_centroid_pos0(le),D[1]=K.geta_centroid_pos1(le))}if(D[0]===0&&D[1]===1)return!1;d.projection.name==="globe"&&(a=SD([a],[new lt(0,0),new lt(it,it)],t.tileID.canonical).map(K=>K.polygon).flat());let z=R?_:null,[j,X]=function(K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le){return K.projection.name==="globe"?function(qe,ke,We,Je,Ze,ht,Ye,tt,Et,yt,gt){let et=[],Ct=[],qt=qe.projection.upVectorScale(gt,qe.center.lat,qe.worldSize).metersToTile,At=[0,0,0,1],Xt=[0,0,0,1],Wt=(Dt,Bn,Nn,Tn)=>{Dt[0]=Bn,Dt[1]=Nn,Dt[2]=Tn,Dt[3]=1},nn=CD();We>0&&(We+=nn),Je+=nn;for(let Dt of ke){let Bn=[],Nn=[];for(let Tn of Dt){let hn=Tn.x+Ze.x,Cn=Tn.y+Ze.y,Yn=qe.projection.projectTilePoint(hn,Cn,gt),Hn=qe.projection.upVector(gt,Tn.x,Tn.y),pr=We,hr=Je;if(Ye){let Ei=DD(hn,Cn,We,Je,Ye,tt,Et,yt);pr+=Ei.base,hr+=Ei.top}We!==0?Wt(At,Yn.x+Hn[0]*qt*pr,Yn.y+Hn[1]*qt*pr,Yn.z+Hn[2]*qt*pr):Wt(At,Yn.x,Yn.y,Yn.z),Wt(Xt,Yn.x+Hn[0]*qt*hr,Yn.y+Hn[1]*qt*hr,Yn.z+Hn[2]*qt*hr),r._.transformMat4(At,At,ht),r._.transformMat4(Xt,Xt,ht),Bn.push(new Gu(At[0],At[1],At[2])),Nn.push(new Gu(Xt[0],Xt[1],Xt[2]))}et.push(Bn),Ct.push(Nn)}return[et,Ct]}(K,le,se,pe,_e,Ee,Oe,De,Ne,Xe,Le):Oe?function(qe,ke,We,Je,Ze,ht,Ye,tt,Et){let yt=[],gt=[],et=[0,0,0,1];for(let Ct of qe){let qt=[],At=[];for(let Xt of Ct){let Wt=Xt.x+Je.x,nn=Xt.y+Je.y,Dt=DD(Wt,nn,ke,We,ht,Ye,tt,Et);et[0]=Wt,et[1]=nn,et[2]=Dt.base,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Bn=new Gu(et[0]/et[3],et[1]/et[3],et[2]/et[3]);et[0]=Wt,et[1]=nn,et[2]=Dt.top,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Nn=new Gu(et[0]/et[3],et[1]/et[3],et[2]/et[3]);qt.push(Bn),At.push(Nn)}yt.push(qt),gt.push(At)}return[yt,gt]}(le,se,pe,_e,Ee,Oe,De,Ne,Xe):function(qe,ke,We,Je,Ze){let ht=[],Ye=[],tt=Ze[8]*ke,Et=Ze[9]*ke,yt=Ze[10]*ke,gt=Ze[11]*ke,et=Ze[8]*We,Ct=Ze[9]*We,qt=Ze[10]*We,At=Ze[11]*We;for(let Xt of qe){let Wt=[],nn=[];for(let Dt of Xt){let Bn=Dt.x+Je.x,Nn=Dt.y+Je.y,Tn=Ze[0]*Bn+Ze[4]*Nn+Ze[12],hn=Ze[1]*Bn+Ze[5]*Nn+Ze[13],Cn=Ze[2]*Bn+Ze[6]*Nn+Ze[14],Yn=Ze[3]*Bn+Ze[7]*Nn+Ze[15],Hn=Tn+tt,pr=hn+Et,hr=Cn+yt,Ei=Math.max(Yn+gt,1e-5),vr=Tn+et,or=hn+Ct,Rr=Cn+qt,ei=Math.max(Yn+At,1e-5);Wt.push(new Gu(Hn/Ei,pr/Ei,hr/Ei)),nn.push(new Gu(vr/ei,or/ei,Rr/ei))}ht.push(Wt),Ye.push(nn)}return[ht,Ye]}(le,se,pe,_e,Ee)}(d,a,S,T,b,f,z,D,O,d.center.lat,t.tileID.canonical),Y=t.queryGeometry;return function(K,le,se){let pe=1/0;_I(se,le)&&(pe=ID(se,le[0]));for(let _e=0;_e<le.length;_e++){let Ee=le[_e],Oe=K[_e];for(let De=0;De<Ee.length-1;De++){let Ne=Ee[De],Xe=[Ne,Ee[De+1],Oe[De+1],Oe[De],Ne];cb(se,Xe)&&(pe=Math.min(pe,ID(se,Xe)))}}return pe!==1/0&&pe}(j,X,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends hi{constructor(t,e,n,a){super(t,Zy,e,n,a),Zy.layout&&(this.layout=new un(Zy.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=OM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Wy(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let a=FD(this);return{config:new Bu(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(t){let e=t,n=kM(kd("line-width",this,e),kd("line-gap-width",this,e)),a=kd("line-offset",this,e);return n/2+Math.abs(a)+Ay(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,c,d){if(t.queryGeometry.isAboveHorizon)return!1;let f=bI(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*kM(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(a=function(b,T){let S=[],D=new lt(0,0);for(let R=0;R<b.length;R++){let O=b[R],F=[];for(let z=0;z<O.length;z++){let j=O[z],X=O[z+1],Y=z===0?D:j.sub(O[z-1])._unit()._perp(),K=z===O.length-1?D:X.sub(j)._unit()._perp(),le=Y._add(K)._unit();le._mult(1/(le.x*K.x+le.y*K.y)),F.push(le._mult(T)._add(j))}S.push(F)}return S}(a,y*t.pixelToTileUnitsFactor)),function(b,T,S){for(let D=0;D<T.length;D++){let R=T[D];if(b.length>=3){for(let O=0;O<R.length;O++)if(sc(b,R[O]))return!0}if(o3(b,R,S))return!0}return!1}(f,a,_)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:f0,background:class extends hi{constructor(t,e,n,a){super(t,jB,e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:zM,"raster-particle":BM,sky:class extends hi{constructor(t,e,n,a){super(t,XB,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),c=!a,d=t.style.light,f=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&wr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?ew(f.azimuthal,90-f.polar,e):ew(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return ew(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends hi{constructor(t,e,n,a){super(t,YB,e,null)}},model:class extends hi{constructor(t,e,n,a){super(t,o5,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new nw(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof T0?it-1:0}queryIntersectsFeature(t,e,n,a,c,d){if(!this.modelManager)return!1;let f=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof nw))return!1;let y=_;for(let b in y.instancesPerModel){let T=y.instancesPerModel[b],S=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(S)){let D=T.features[T.idToFeaturesIndex[S]],R=f.getModel(b,this.scope);if(!R)return!1;let O=r.ad.create(),F=new yn(0,0),z=y.canonical,j=Number.MAX_VALUE;for(let X=0;X<D.instancedDataCount;++X){let Y=16*(D.instancedDataOffset+X),K=T.instancedDataArray.float32,le=[K[Y+4],K[Y+5],K[Y+6]];h2(z,F,K[Y],0|K[Y+1]),XM(O,R,d,F,D.rotation,D.scale,le,!1,!1,!1),d.projection.name==="globe"&&(O=tw(O,d));let se=r.ad.multiply([],d.projMatrix,O),pe=t.queryGeometry,_e=HM(pe.isPointQuery()?pe.screenBounds:pe.screenGeometry,d,se,R.aabb);_e!=null&&(j=Math.min(_e,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof G}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,a){let c=t.tile,d=c.getBucket(this),f=null,_=Number.MAX_VALUE;if(!(d&&d instanceof T0))return{queryFeature:f,intersectionZ:_};let y=d.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Bt(c.tileID.overscaledZ),y.feature,c.tileID.canonical))return{queryFeature:f,intersectionZ:_};let b=y.node,T=a.calculatePosMatrix(c.tileID.toUnwrapped(),a.worldSize),S=y.evaluatedScale,D=0;a.elevation&&b.elevation&&(D=b.elevation*a.elevation.exaggeration()),r.ad.translate(T,T,[(b.anchor?b.anchor[0]:0)*(S[0]-1),(b.anchor?b.anchor[1]:0)*(S[1]-1),D]),r.ad.scale(T,T,S),r.ad.multiply(T,T,b.matrix);let R=t.queryGeometry,O=R.isPointQuery()?R.screenBounds:R.screenGeometry,F=function(j){let X=r.ad.multiply([],T,j.matrix),Y=r.ad.multiply(X,a.expandedFarZProjMatrix,X);for(let K=0;K<j.meshes.length;++K){let le=j.meshes[K];if(K===j.lightMeshIndex)continue;let se=HM(O,a,Y,le.aabb);se!=null&&(_=Math.min(se,_))}if(j.children)for(let K of j.children)F(K)};if(F(b),_===Number.MAX_VALUE)return{queryFeature:f,intersectionZ:_};let z=new yn(0,0);return h2(c.tileID.canonical,z,y.node.anchor[0],y.node.anchor[1]),f={type:"Feature",geometry:{type:"Point",coordinates:[z.lng,z.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:f,intersectionZ:_}}},clip:class extends hi{constructor(t,e,n,a){super(t,z3,e,n,a)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new WI(t)}isTileClipped(){return!0}is3D(){return!0}}};J(AM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let d2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let d=d2[15&a];if(!d)throw new Error("Unrecognized array type.");let[f]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new dw(_,f,d,e)}constructor(e,n=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let d=d2.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return fw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:f,nodeSize:_}=this,y=[0,d.length-1,0],b=[];for(;y.length;){let T=y.pop()||0,S=y.pop()||0,D=y.pop()||0;if(S-D<=_){for(let z=D;z<=S;z++){let j=f[2*z],X=f[2*z+1];j>=e&&j<=a&&X>=n&&X<=c&&b.push(d[z])}continue}let R=D+S>>1,O=f[2*R],F=f[2*R+1];O>=e&&O<=a&&F>=n&&F<=c&&b.push(d[R]),(T===0?e<=O:n<=F)&&(y.push(D),y.push(R-1),y.push(1-T)),(T===0?a>=O:c>=F)&&(y.push(R+1),y.push(S),y.push(1-T))}return b}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:d,nodeSize:f}=this,_=[0,c.length-1,0],y=[],b=a*a;for(;_.length;){let T=_.pop()||0,S=_.pop()||0,D=_.pop()||0;if(S-D<=f){for(let z=D;z<=S;z++)p2(d[2*z],d[2*z+1],e,n)<=b&&y.push(c[z]);continue}let R=D+S>>1,O=d[2*R],F=d[2*R+1];p2(O,F,e,n)<=b&&y.push(c[R]),(T===0?e-a<=O:n-a<=F)&&(_.push(D),_.push(R-1),_.push(1-T)),(T===0?e+a>=O:n+a>=F)&&(_.push(R+1),_.push(S),_.push(1-T))}return y}}function fw(t,e,n,a,c,d){if(c-a<=n)return;let f=a+c>>1;f2(t,e,f,a,c,d),fw(t,e,n,a,f-1,1-d),fw(t,e,n,f+1,c,1-d)}function f2(t,e,n,a,c,d){for(;c>a;){if(c-a>600){let b=c-a+1,T=n-a+1,S=Math.log(b),D=.5*Math.exp(2*S/3),R=.5*Math.sqrt(S*D*(b-D)/b)*(T-b/2<0?-1:1);f2(t,e,n,Math.max(a,Math.floor(n-T*D/b+R)),Math.min(c,Math.floor(n+(b-T)*D/b+R)),d)}let f=e[2*n+d],_=a,y=c;for(Zm(t,e,a,n),e[2*c+d]>f&&Zm(t,e,a,c);_<y;){for(Zm(t,e,_,y),_++,y--;e[2*_+d]<f;)_++;for(;e[2*y+d]>f;)y--}e[2*a+d]===f?Zm(t,e,a,y):(y++,Zm(t,e,y,c)),y<=n&&(a=y+1),n<=y&&(c=y-1)}}function Zm(t,e,n,a){pw(t,n,a),pw(e,2*n,2*a),pw(e,2*n+1,2*a+1)}function pw(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}function p2(t,e,n,a){let c=t-n,d=e-a;return c*c+d*d}r.$=Ma,r.A=Du,r.B=Ws,r.C=bn,r.D=xi,r.E=La,r.G=Br,r.H=h,r.I=mB,r.J=O1,r.K=function(t){let e=t.value,n=[];if(!e)return n;let a=Na(e);return a!=="string"?(n=n.concat([new y0(t.key,e,`string expected, "${a}" found`)]),n):(qM(e,!0)||(n=n.concat([new y0(t.key,e,`invalid url "${e}"`)])),n)},r.L=Te,r.M=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new yn(e[0],e[1]):new yn(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let a=ur.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,a,c,d,f=!1){XM(this.matrix,this,t.transform,this.position,e,n,a,c,d,f)}upload(t){if(!this.uploaded){for(let e of this.nodes)rw(e,t);for(let e of this.nodes)v0(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)iw(t)}},r.N=Pn,r.O=Be,r.P=lt,r.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return os(t.expression.evaluate(e))}interpolate(t,e,n){return{x:It(t.x,e.x,n),y:It(t.y,e.y,n),z:It(t.z,e.z,n),azimuthal:It(t.azimuthal,e.azimuthal,n),polar:It(t.polar,e.polar,n)}}},r.R=td,r.S=W1,r.T=Zo,r.U=Rn,r.V=y0,r.W=li,r.X=Bt,r.Y=wi,r.Z=G,r.a=lo,r.a$=function(t){let{x:e,y:n}=t.point,{lng:a,lat:c}=t._center;return OI(e,n,t.worldSize,a,c)},r.a0=un,r.a1=Ka,r.a2=It,r.a3=it,r.a4=j_,r.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){let c=os([1,n,a]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:It(t.x,e.x,n),y:It(t.y,e.y,n),z:It(t.z,e.z,n)}}},r.a6=mm,r.a7=Sy,r.a8=Wa,r.a9=aI,r.aB=function(t,e){let{x:n,y:a}=t.point,c=OI(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.ad.multiply(c,c,yb(Qs(e)))},r.aD=jd,r.aE=So,r.aF=Ky,r.aG=function(t,e,n,a,c){let d=5*e+2;t.float32[d+0]=n,t.float32[d+1]=a,t.float32[d+2]=c},r.aH=l0,r.aI=yn,r.aJ=bM,r.aK=hI,r.aL=Fr,r.aM=mb,r.aN=jM,r.aO=ju,r.aP=AI,r.aQ=function(t,e,n,a,c,d,f,_,y){if(y.name==="globe")return AI(t,e,new ju(n,a,c),!1);let b=Hu({z:n,x:a,y:c},y);return new ur([(d+b.x/b.scale)*e,e*(b.y/b.scale),f],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},r.aR=function(t,e,n){let a=0;for(let c=0;c<2;++c)t[c]>0&&(a+=(t[c]-0)*(t[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},r.aS=Tr,r.aT=fb,r.aU=cI,r.aV=function(t){let e=r.ad.identity(new Float64Array(16));r.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,qo,0],a=[0,Wo,0];return r._.transformMat4(n,n,e),r._.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!xb(t,new yn(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!xb(t,new yn(t.center.lat,-90))]},r.aW=function(t,e){let{scale:n}=t.tileTransform,a=n*it/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.aX=g0,r.aY=VM,r.aZ=function(t){let e=VM(t,!0);return r.aC.invert([],[e[0],e[1],e[4],e[5]])},r.a_=pb,r.aa=zi,r.ab=ln,r.ac=function(t,e,n){let a=Math.sqrt(t*t+e*e+n*n),c=a>0?Math.acos(n/a)*tu:0,d=t!==0||e!==0?Math.atan2(-e,-t)*tu+90:0;return d<0&&(d+=360),[a,d,c]},r.ae=qd,r.af=_s,r.ag=$b,r.ah=function(t,e){let n={};for(let a=0;a<e.length;a++){let c=e[a];c in t&&(n[c]=t[c])}return n},r.ai=oc,r.aj=Ys,r.ak=Ks,r.al=Sd,r.am=function(t){Jh++,Jh>Cp&&(t.getActor().send("enforceCacheSizeLimit",Tp),Jh=0)},r.an=Op,r.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,a){let c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){let[d,f]=c.result;return this.scheduler?this.scheduler.add(()=>{a(d,f)},e):a(d,f),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=n((d,f)=>{c.result=[d,f];for(let _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,f)},e):_(d,f);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(d=>d!==a),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},r.ap=function(t,e,n){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{let d=Oa(t.request,(f,_,y,b)=>{f?c(f):_&&c(null,{vectorTile:n?void 0:new Ib(new Vd(_)),rawData:_,cacheControl:y,expires:b})});return()=>{d.cancel(),c()}},e)},r.aq=K1,r.ar=class extends qa{constructor(t){super(t),this.current=HN}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.as=Q1,r.at=Qt,r.au=Aa,r.aw=su,r.ax=Vi,r.ay=Jr,r.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.b=cr,r.b$=cc,r.b0=ai,r.b1=tb,r.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return D_[e]},r.b3=45,r.b4=ib,r.b5=Iy,r.b6=ur,r.b7=os,r.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.b9=gp,r.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bB=OD,r.bD=RI,r.bE=Yh,r.bF=Xh,r.bG=256,r.bH=function(t,e){let n=[0,0,0],a=bm(Qs(e.canonical));return r._.transformMat4(n,n,a),r._.transformMat4(n,n,t),n},r.bI=t=>({u_camera_to_center_distance:new zi(t),u_extrude_scale:new J1(t),u_device_pixel_ratio:new zi(t),u_matrix:new mm(t),u_inv_rot_matrix:new mm(t),u_merc_center:new Wa(t),u_tile_id:new K1(t),u_zoom_transition:new zi(t),u_up_dir:new K1(t),u_emissive_strength:new zi(t)}),r.bJ=t=>({u_matrix:new mm(t),u_pixels_to_tile_units:new J1(t),u_device_pixel_ratio:new zi(t),u_units_to_pixels:new Wa(t),u_dash_image:new Sy(t),u_gradient_image:new Sy(t),u_image_height:new zi(t),u_texsize:new Wa(t),u_tile_units_to_pixels:new zi(t),u_alpha_discard_threshold:new zi(t),u_trim_offset:new Wa(t),u_trim_fade_range:new Wa(t),u_trim_color:new Q1(t),u_emissive_strength:new zi(t)}),r.bK=t=>({u_matrix:new mm(t),u_texsize:new Wa(t),u_pixels_to_tile_units:new J1(t),u_device_pixel_ratio:new zi(t),u_image:new Sy(t),u_units_to_pixels:new Wa(t),u_tile_units_to_pixels:new zi(t),u_alpha_discard_threshold:new zi(t),u_trim_offset:new Wa(t)}),r.bL=V1,r.bM=Cz,r.bN=di,r.bO=$z,r.bP=dM,r.bQ=Fb,r.bR=FI,r.bS=(t,e,n,a,c,d)=>{let f=t.transform,_=f.projection.name==="globe",y;if(d.paint.get("circle-pitch-alignment")==="map")if(_){let T=RI(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=f.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(f.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Kr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:m3,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){b.u_inv_rot_matrix=a,b.u_merc_center=c,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=Ka(f.zoom);let T=c[0]*it,S=c[1]*it;b.u_up_dir=f.projection.upVector(new ju(0,0,0),T,S)}return b},r.bT=FD,r.bU=(t,e,n,a,c,d)=>{let f=t.transform;return{u_matrix:LD(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:kD(e,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},r.bV=(t,e,n,a,c,d,f)=>{let _=t.transform,y=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:LD(t,e,n,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:ND(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kD(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:f,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},r.bW=_p,r.bX=wm,r.bY=CD,r.bZ=JN,r.b_=qy,r.ba=function(t,e,n){let a=Ka(n.zoom),c=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!c&&!d},r.bb=function(t){let e=t.pixelsPerMeter,n=e/Vi(1,t.center.lat),a=r.ad.identity(new Float64Array(16));return r.ad.translate(a,a,[t.point.x,t.point.y,0]),r.ad.scale(a,a,[n,n,e]),Float32Array.from(a)},r.bc=Oy,r.bd=function(t){let e=Tr-5;t=Qt(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(ln(t))),3);return Math.round(n*(nb.length-1))},r.be=function(t,e,n,a){let c=e.getNorth(),d=e.getSouth(),f=e.getWest(),_=e.getEast(),y=1<<t.z,b=_-f,T=c-d,S=b/Ad,D=-T/nb[n],R=[0,S,0,D,0,0,c,f,0];if(t.z>0){let O=180/a;r.bC.multiply(R,R,[O/b+1,0,0,0,O/T+1,0,-.5*O/S,.5*O/D,1])}return R[2]=y,R[5]=t.x,R[8]=t.y,R},r.bf=bm,r.bg=Qs,r.bh=function(t,e,n){let a=r.ad.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return r.ad.rotateY(a,n.globeMatrix,c),Float32Array.from(a)},r.bi=Rl,r.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.bk=zM,r.bl=BM,r.bm=NM,r.bn=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){let c=document.createElement("source");O_(t[a])||(n.crossOrigin="Anonymous"),c.src=t[a],n.appendChild(c)}return{cancel:()=>{}}},r.bo=c0,r.bp=qh,r.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,c=Math.floor(t.x),d=Math.floor((t.x-c)*a),f=Math.floor(t.y*a),_=this.findDEMTileFor(new Fr(n,c,n,d,f));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let c=a.getSource().maxzoom,d=1<<c,f=Math.floor(t.x),_=t.x-f,y=new Fr(c,f,c,Math.floor(_*d),Math.floor(t.y*d)),b=this.findDEMTileFor(y);if(!b||!b.dem)return e;let T=b.dem,S=1<<b.tileID.canonical.z,D=(_*S-b.tileID.canonical.x)*T.dim,R=(t.y*S-b.tileID.canonical.y)*T.dim,O=Math.floor(D),F=Math.floor(R);return(n?this.exaggeration():1)*It(It(T.get(O,F),T.get(O,F+1),R-F),It(T.get(O+1,F),T.get(O+1,F+1),R-F),D-O)}getAtTileOffset(t,e,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new wi(t.wrap+(t.canonical.x+e/it)/a,(t.canonical.y+n/it)/a))}getAtTileOffsetFunc(t,e,n,a){return c=>{let d=this.getAtTileOffset(t,c.x,c.y),f=a.upVector(t.canonical,c.x,c.y),_=a.upVectorScale(t.canonical,e,n).metersToTile;return r._.scale(f,f,d*_),f}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;let c=Nd.create(this,t,a);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,c=1<<t.canonical.z-a.canonical.z,d=t.canonical.x/c-a.canonical.x,f=t.canonical.y/c-a.canonical.y,_=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!n.leaves[_];y++){d*=2,f*=2;let b=2*Math.floor(f)+Math.floor(d);_=n.childOffsets[_]+b,d%=1,f%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let c of t){let d=this.getMinMaxForTile(c.tileID);d&&(n=Math.min(n,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:n,max:a}:null}},r.br=vm,r.bs=Ry,r.bt=ds,r.bu=Ur,r.bv=qu,r.bw=ow,r.bx=x0,r.by=d0,r.bz=UI,r.c=s2,r.c$=lu,r.c0=450,r.c1=7,r.c2=GB,r.c3=PM,r.c4=256,r.c5=DI,r.c6=yb,r.c7=In,r.c8=ec,r.c9=zu,r.cA=function(t){let e=1/0,n=1/0,a=-1/0,c=-1/0;for(let d of t)e=Math.min(e,d.x),n=Math.min(n,d.y),a=Math.max(a,d.x),c=Math.max(c,d.y);return{min:new lt(e,n),max:new lt(a,c)}},r.cB=sc,r.cC=mI,r.cD=Bi,r.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.cF=oM,r.cG=cb,r.cH=iD,r.cI=oD,r.cJ=Vb,r.cK=dw,r.cL=function(t){return t({pluginStatus:He,pluginURL:st}),$t.on("pluginStateChange",t),t},r.cM=$d,r.cN=zb,r.cO=nd,r.cP=pt,r.cQ=$,r.cR=Ep,r.cS=Nl,r.cT=Vo,r.cU=function(t){let e=t.indexOf(Kl);return e>=0?t.slice(0,e):t},r.cV=function(t){return t.indexOf(Kl)>=0},r.cW=function(t){let e=t.indexOf(Kl);return e>=0?t.slice(e+1):""},r.cX=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cY=function(t,e,n,a){return t.type==="custom"?new WB(t,e):new E5[t.type](t,e,n,a)},r.cZ=Pa,r.c_=$t,r.ca=1,r.cb=zm,r.cc=0,r.cd=G1,r.ce=function(t,e,n,a,c){return Qt((t-e)/(n-e)*(c-a)+a,a,c)},r.cf=fy,r.cg=Uu,r.ch=class{constructor(t,e,n,a){this.context=t,this.format=a,this.size=n,this.texture=t.gl.createTexture();let[c,d,f]=this.size,{gl:_}=t;_.bindTexture(_.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,b=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,b=_.UNSIGNED_SHORT),this.format===_.R8&&(a=_.RED),this.format===_.R32F&&(b=_.FLOAT,a=_.RED),_.texImage3D(_.TEXTURE_3D,0,y,c,d,f,0,a,b,e.data)}bind(t,e){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},r.ci=tw,r.cj=[1,1,1],r.ck=Nd,r.cl=Yd,r.cm=nc,r.cn=Dd,r.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new lt(1/0,1/0),max:new lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=tD(new lt(0,0),new lt(it,it),t),a=[];if(e&&!Db(n,this._globalClipBounds))return a;for(let c of this._activeRegions){if(c.hiddenByOverlap||!Db(n,c))continue;let d=Q3(c.min,c.max,t);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask})}return a}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let a of e.cache.getVisibleCoordinates()){let c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),a=t.getClipMask();for(let c of e){if(!c.footprint)continue;let d=tD(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:n,clipMask:a})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||$y(e.min,n.min)||$y(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],a=this._prevRegions[e];t=n.priority!==a.priority||!eD(n,a)||n.order!==a.order||n.clipMask!==a.clipMask,++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let a=this._activeRegions;if(n>=a.length)return n;let c=a[n].priority;for(;n<a.length&&a[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let c=n,d=n;for(;c!==a;){let f=this._activeRegions[c];f.hiddenByOverlap=!1;for(let _=0;_<d;_++){let y=this._activeRegions[_];if(!y.hiddenByOverlap&&f.order===1/0&&Db(f,y)&&(f.hiddenByOverlap=rD(f.footprint,f.tileId,y.footprint,y.tileId),f.hiddenByOverlap))break}++c}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cp=Ql,r.cq=h0,r.cr=fm,r.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new ds,a=new Ur,c=[],d=t+1+2,f=e[0]+1,_=e[0]+1+(1+e.length),y=(b,T,S)=>{let D=b===d-1?b-2:b===0?b:b-1;return D+=S?24575:0,[D,T]};for(let b=0;b<d;++b)n.emplaceBack(...y(b,0,!0));for(let b=0;b<f;++b)for(let T=0;T<d;++T)n.emplaceBack(...y(T,b,(T===0||T===d-1)&&!0));for(let b=0;b<e.length;++b){let T=e[b];for(let S=0;S<d;++S)n.emplaceBack(...y(S,T,!0))}for(let b=0;b<e.length;++b){let T=a.length,S=e[b]+1+2,D=new Ur;for(let F=0;F<S-1;F++){let z=F===S-2,j=z?d*(_-e.length+b-F):d;for(let X=0;X<d-1;X++){let Y=F*d+X;F===0||z||X===0||X===d-2?(D.emplaceBack(Y+1,Y,Y+j),D.emplaceBack(Y+j,Y+j+1,Y+1)):(a.emplaceBack(Y+1,Y,Y+j),a.emplaceBack(Y+j,Y+j+1,Y+1))}}let R=cr.simpleSegment(0,T,n.length,a.length-T);for(let F=0;F<D.uint16.length;F+=3)a.emplaceBack(D.uint16[F],D.uint16[F+1],D.uint16[F+2]);let O=cr.simpleSegment(0,T,n.length,a.length-T);c.push({withoutSkirts:R,withSkirts:O})}return{vertices:n,indices:a,segments:c}}_createGrid(t){let e=this._fillGridMeshWithLods(Ad,nb);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,vm.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Ur;for(let f=0;f<=Ad;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new zu,a=new zu,c=new zu,d=new zu;this._poleSegments=[];for(let f=0,_=0;f<tb;f++){let y=360/(1<<f);n.emplaceBack(0,-Bi,0,.5,0),a.emplaceBack(0,-Bi,0,.5,1),c.emplaceBack(0,-Bi,0,.5,.5),d.emplaceBack(0,-Bi,0,.5,.5);for(let b=0;b<=Ad;b++){let T=b/Ad,S=0,D=It(0,y,T),[R,O,F]=Pd(f3,p3,D,Bi);n.emplaceBack(R,O,F,T,S),a.emplaceBack(R,O,F,T,1-S);let z=ln(D);T=.5+.5*Math.sin(z),S=.5+.5*Math.cos(z),c.emplaceBack(R,O,F,T,S),d.emplaceBack(R,O,F,T,1-S)}this._poleSegments.push(cr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Py,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,Py,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,Py,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,Py,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.ct=function(t){return fu.has(t)},r.cu=fD,r.cv=function(t,e,n=0,a=!0){let c=new lt(n,n),d=t.sub(c),f=e.add(c),_=[d,new lt(f.x,d.y),f,new lt(d.x,f.y)];return a&&_.push(d.clone()),_},r.cw=function(t,e){let n=[];for(let a=0;a<t.length;a++){let c=Aa(a-1,-1,t.length-1),d=Aa(a+1,-1,t.length-1),f=t[a],_=t[d],y=t[c].sub(f).unit(),b=_.sub(f).unit(),T=b.angleWithSep(y.x,y.y),S=y.add(b).unit().mult(-1*e/Math.sin(T/2));n.push(f.add(S))}return n},r.cx=gM,r.cy=xI,r.cz=function(t,e,n=0){return r._.fromValues(((e.x-n)*t.scale-t.x)*it,(e.y*t.scale-t.y)*it,dI(e.z,e.y))},r.d=sd,r.d$=$h,r.d0=nu,r.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d2=Dl,r.d3=pI,r.d4=Vu,r.d5=function([t,e,n]){let a=Math.hypot(t,e,n),c=Math.atan2(t,n),d=.5*Math.PI-Math.acos(-e/a);return new yn(ai(c),ai(d))},r.d6=Wi,r.d7=Rd,r.d8=A,r.d9=xb,r.dA=function(t){let e=P_();if(!e)return;let n=e.delete(A_);t&&n.catch(t).then(()=>t())},r.dB=$m,r.dC=KM,r.dD=function(t){aw=Kr.resolveURL(t),Qd||(Qd=new ow(x0(),new La)),Qd.broadcast("setDracoUrl",aw)},r.dE=QM,r.dF=function(t){Kd=Kr.resolveURL(t),Qd||(Qd=new ow(x0(),new La)),Qd.broadcast("setMeshoptUrl",Kd)},r.dG=ro,r.dH=J,r.dI=ac,r.dJ=gs,r.dK=Hu,r.dL=X1,r.dM=zD,r.dN=HD,r.dO=PD,r.dP=Al,r.dQ=aM,r.dR=Wd,r.dS=function(t,e,n,a,c,d,f,_,y,b,T){t.createArrays(),t.tilePixelRatio=it/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let S=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:X}=t.textSizeData;R.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Bt(j),_),D["text-size"].possiblyEvaluate(new Bt(X),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:X}=t.iconSizeData;R.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Bt(j),_),D["icon-size"].possiblyEvaluate(new Bt(X),_)]}R.layoutTextSize=D["text-size"].possiblyEvaluate(new Bt(y+1),_),R.layoutIconSize=D["icon-size"].possiblyEvaluate(new Bt(y+1),_),R.textMaxSize=D["text-size"].possiblyEvaluate(new Bt(18),_);let O=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",F=S.get("text-size"),z=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){z=!0;break}for(let j of t.features){let X=S.get("text-font").evaluate(j,{},_).join(","),Y=F.evaluate(j,{},_),K=R.layoutTextSize.evaluate(j,{},_),le=(R.layoutIconSize.evaluate(j,{},_),{horizontal:{},vertical:void 0}),se=j.text,pe,_e=[0,0];if(se){let De=se.toString(),Ne=S.get("text-letter-spacing").evaluate(j,{},_)*di,Xe=S.get("text-line-height").evaluate(j,{},_)*di,Le=Me(De)?Ne:0,qe=S.get("text-anchor").evaluate(j,{},_),ke=S.get("text-variable-anchor");if(!ke){let Ye=S.get("text-radial-offset").evaluate(j,{},_);_e=Ye?dM(qe,[Ye*di,Bb]):S.get("text-offset").evaluate(j,{},_).map(tt=>tt*di)}let We=O?"center":S.get("text-justify").evaluate(j,{},_),Je=S.get("symbol-placement")==="point",Ze=Je?S.get("text-max-width").evaluate(j,{},_)*di:1/0,ht=Ye=>{t.allowVerticalPlacement&&Se(De)&&(le.vertical=Lb(se,e,n,c,X,Ze,Xe,qe,Ye,Le,_e,So.vertical,!0,K,Y))};if(!O&&ke){let Ye=We==="auto"?ke.map(Et=>Vb(Et)):[We],tt=!1;for(let Et=0;Et<Ye.length;Et++){let yt=Ye[Et];if(!le.horizontal[yt])if(tt)le.horizontal[yt]=le.horizontal[0];else{let gt=Lb(se,e,n,c,X,Ze,Xe,"center",yt,Le,_e,So.horizontal,!1,K,Y);gt&&(le.horizontal[yt]=gt,tt=gt.positionedLines.length===1)}}ht("left")}else{if(We==="auto"&&(We=Vb(qe)),Je||S.get("text-writing-mode").indexOf("horizontal")>=0||!Se(De)){let Ye=Lb(se,e,n,c,X,Ze,Xe,qe,We,Le,_e,So.horizontal,!1,K,Y);Ye&&(le.horizontal[We]=Ye)}ht(Je?"left":We)}}let Ee=!1;if(j.icon&&j.icon.namePrimary){let De=a[j.icon.namePrimary];De&&(pe=Qz(c[j.icon.namePrimary],j.icon.nameSecondary?c[j.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(j,{},_),S.get("icon-anchor").evaluate(j,{},_)),Ee=De.sdf,t.sdfIcons===void 0?t.sdfIcons=De.sdf:t.sdfIcons!==De.sdf&&wr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==t.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Oe=pM(le.horizontal)||le.vertical;t.iconsInText||(t.iconsInText=!!Oe&&Oe.iconsInText),(Oe||pe)&&oB(t,j,le,pe,a,R,K,0,_e,Ee,f,_,b,T,z)}d&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dT=Wy,r.dU=By,r.dV=Ib,r.dW=Vd,r.dX=Gy,r.dY=Kb,r.dZ=jy,r.d_=Vy,r.da=kI,r.db=function(t){let e=[0,0,0],n=r.ad.identity(new Float64Array(16));return r.ad.multiply(n,t.pixelMatrix,t.globeMatrix),r._.transformMat4(e,e,n),new lt(e[0],e[1])},r.dc=Ie,r.dd=be,r.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(Zh==null){let a=n.navigator?n.navigator.userAgent:null;Zh=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Zh}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.df=Gh,r.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Pp,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!$(t))return t;let n=vo(t);return n.params.push(`sdk=js-${w}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!$(t))return t;let n=vo(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!$(t))return t;let n=vo(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!$(t))return t;let c=vo(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){let c=vo(t);return $(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${n}`,Ll(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!$(t))return t;let a=vo(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${ed.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${A.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${A.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${A.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${A.TILE_URL_VERSION}${a.path}`);let c=this._customAccessToken||function(d){for(let f of d){let _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(a.params)||A.ACCESS_TOKEN;return A.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(t,e){let n=vo(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${A.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${n.path.replace(`/${A.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${A.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(t,e){let n=!!e&&$(e),a=[];for(let c of t.tiles||[])L(c)?a.push(this.canonicalizeTileURL(c,n)):a.push(c);return a}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=vo(A.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!A.REQUIRE_ACCESS_TOKEN)return Ll(t);if(e=e||A.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ll(t)}},r.dh=function(t,e){e?fu.add(t):fu.delete(t)},r.di=ed,r.dj=g1,r.dk=od,r.dl=Rp,r.dm=F_,r.dn=m1,r.dp=function(t){fu.delete(t)},r.dq=Fl,r.dr=du,r.ds=Ml,r.dt=w,r.du=function(t,e){Tp=t,Cp=e},r.dv=function(t,e,n=!1){if(He===ot||He===ct||He===at)throw new Error("setRTLTextPlugin cannot be called multiple times.");st=Kr.resolveURL(t),He=ot,je=e,Ot(),n||on()},r.dw=cn,r.dx=function(){x0().acquire(sw)},r.dy=function(){let t=Hm;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(sw),Hm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dz=Gm,r.e=Kr,r.e0=BD,r.e1=ze,r.e2=Oa,r.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==e2){let n=new Uint32Array(t,0,7),[,,a,c,d,f]=n;e=n.byteLength+c+d+f+d,(a!==t.byteLength||e>=t.byteLength)&&wr("Invalid b3dm header information.")}return i2(t,e)},r.e4=function(t,e){let n=s2(t);for(let a of n){for(let c of a.meshes)v5(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(x5(a.lights,e)))}return n},r.e5=T0,r.e6=YM,r.e7=An,r.e8=function(t){au(),as&&as.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},r.f=Ci,r.g=function(t,e){return lu(li(t,{type:"json"}),e)},r.h=Vs,r.i=Co,r.j=sM,r.k=Nb,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>i2(e,0,t))},r.m=class extends y0{},r.n=Na,r.o=Np,r.p=vB,r.q=Cd,r.r=p,r.s=s,r.t=N,r.u=Mi,r.v=ui,r.w=wr,r.x=H,r.y=B,r.z=md}),u(["./shared"],function(r){function w(ye){let U=ye?ye.url.toString():void 0;return U?performance.getEntriesByName(U):[]}function I(ye){if(typeof ye=="number"||typeof ye=="boolean"||typeof ye=="string"||ye==null)return JSON.stringify(ye);if(Array.isArray(ye)){let Z="[";for(let oe of ye)Z+=`${I(oe)},`;return`${Z}]`}let U="{";for(let Z of Object.keys(ye).sort())U+=`${Z}:${I(ye[Z])},`;return`${U}}`}function A(ye){let U="";for(let Z of r.cE)U+=`/${I(ye[Z])}`;return U}class L{constructor(U){this.keyCache={},this._layers={},this._layerConfigs={},U&&this.replace(U)}replace(U,Z){this._layerConfigs={},this._layers={},this.update(U,[],Z)}update(U,Z,oe){this._options=oe;for(let fe of U)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=r.cY(fe,this.scope,null,this._options)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(let fe of Z)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};let de=function(fe,we){let Ae={};for(let Pe=0;Pe<fe.length;Pe++){let rt=we&&we[fe[Pe].id]||A(fe[Pe]);we&&(we[fe[Pe].id]=rt);let Ke=Ae[rt];Ke||(Ke=Ae[rt]=[]),Ke.push(fe[Pe])}let ve=[];for(let Pe in Ae)ve.push(Ae[Pe]);return ve}(r.dG(this._layerConfigs),this.keyCache);for(let fe of de){let we=fe.map(_t=>this._layers[_t.id]),Ae=we[0];if(Ae.visibility==="none")continue;let ve=Ae.source||"",Pe=this.familiesBySource[ve];Pe||(Pe=this.familiesBySource[ve]={});let rt=Ae.sourceLayer||"_geojsonTileLayer",Ke=Pe[rt];Ke||(Ke=Pe[rt]=[]),Ke.push(we)}}}let $=1*r.dJ;class Q{constructor(U){let Z={},oe=[];for(let Ae in U){let ve=U[Ae],Pe=Z[Ae]={};for(let rt in ve.glyphs){let Ke=ve.glyphs[+rt];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;let _t=Ke.metrics.localGlyph?$:1,Mt={x:0,y:0,w:Ke.bitmap.width+2*_t,h:Ke.bitmap.height+2*_t};oe.push(Mt),Pe[rt]=Mt}}let{w:de,h:fe}=r.j(oe),we=new r.dI({width:de||1,height:fe||1});for(let Ae in U){let ve=U[Ae];for(let Pe in ve.glyphs){let rt=ve.glyphs[+Pe];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;let Ke=Z[Ae][Pe],_t=rt.metrics.localGlyph?$:1;r.dI.copy(rt.bitmap,we,{x:0,y:0},{x:Ke.x+_t,y:Ke.y+_t},rt.bitmap)}}this.image=we,this.positions=Z}}r.dH(Q,"GlyphAtlas");class me{constructor(U){this.tileID=new r.aL(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.lut=U.lut,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.scope=U.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.promoteId=U.promoteId,this.isSymbolTile=U.isSymbolTile,this.tileTransform=r.dK(U.tileID.canonical,U.projection),this.projection=U.projection,this.brightness=U.brightness,this.extraShadowCaster=!!U.extraShadowCaster,this.tessellationStep=U.tessellationStep}parse(U,Z,oe,de,fe){this.status="parsing",this.data=U,this.collisionBoxArray=new r.dL;let we=new r.dM(Object.keys(U.layers).sort()),Ae=new r.dN(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];let ve={},Pe=new r.dO(256,256),rt={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Pe,availableImages:oe,brightness:this.brightness},Ke=Z.familiesBySource[this.source];for(let mt in Ke){let tr=U.layers[mt];if(!tr)continue;let Ln=!1,fn=!1,br=!1;for(let oi of Ke[mt])oi[0].type==="symbol"?Ln=!0:fn=!0,oi[0].is3D()&&oi[0].type!=="model"&&(br=!0);if(this.extraShadowCaster&&!br||this.isSymbolTile===!0&&!Ln||this.isSymbolTile===!1&&!fn)continue;tr.version===1&&r.w(`Vector tile source "${this.source}" layer "${mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let nr=we.encode(mt),Ar=[];for(let oi=0;oi<tr.length;oi++){let si=tr.feature(oi),Ia=Ae.getId(si,mt);Ar.push({feature:si,id:Ia,index:oi,sourceLayerIndex:nr})}for(let oi of Ke[mt]){let si=oi[0];(!this.extraShadowCaster||si.is3D()&&si.type!=="model")&&(this.isSymbolTile!==void 0&&si.type==="symbol"!==this.isSymbolTile||si.minzoom&&this.zoom<Math.floor(si.minzoom)||si.maxzoom&&this.zoom>=si.maxzoom||si.visibility!=="none"&&(he(oi,this.zoom,rt.brightness,oe),(ve[si.id]=si.createBucket({index:Ae.bucketLayerIDs.length,layers:oi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ar,rt,this.tileID.canonical,this.tileTransform),Ae.bucketLayerIDs.push(oi.map(Ia=>Ia.id))))}}let _t,Mt,Kt,en;Pe.trim();let jt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},an=()=>{if(_t)return this.status="done",fe(_t);if(this.extraShadowCaster)this.status="done",fe(null,{buckets:r.dG(ve).filter(mt=>!mt.isEmpty()),featureIndex:Ae,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mt&&Kt&&en){let mt=new Q(Mt),tr=new r.dQ(Kt,en,this.lut);for(let Ln in ve){let fn=ve[Ln];fn instanceof r.dR?(he(fn.layers,this.zoom,rt.brightness,oe),r.dS(fn,Mt,mt.positions,Kt,tr.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):fn.hasPattern&&(fn instanceof r.dT||fn instanceof r.dU||fn instanceof r.b_)&&(he(fn.layers,this.zoom,rt.brightness,oe),fn.addFeatures(rt,this.tileID.canonical,tr.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",fe(null,{buckets:r.dG(ve).filter(Ln=>!Ln.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mt.image,lineAtlas:Pe,imageAtlas:tr,brightness:rt.brightness})}};if(!this.extraShadowCaster){let mt=r.dP(rt.glyphDependencies,fn=>Object.keys(fn).map(Number));Object.keys(mt).length?de.send("getGlyphs",{uid:this.uid,stacks:mt,scope:this.scope},(fn,br)=>{_t||(_t=fn,Mt=br,an())},void 0,!1,jt):Mt={};let tr=Object.keys(rt.iconDependencies);tr.length?de.send("getImages",{icons:tr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(fn,br)=>{_t||(_t=fn,Kt=br,an())},void 0,!1,jt):Kt={};let Ln=Object.keys(rt.patternDependencies);Ln.length?de.send("getImages",{icons:Ln,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(fn,br)=>{_t||(_t=fn,en=br,an())},void 0,!1,jt):en={}}an()}}function he(ye,U,Z,oe){let de=new r.X(U,{brightness:Z});for(let fe of ye)fe.recalculate(de,oe)}class be extends r.E{constructor(U,Z,oe,de,fe,we){super(),this.actor=U,this.layerIndex=Z,this.availableImages=oe,this.loadVectorData=fe||r.ap,this.loading={},this.loaded={},this.deduped=new r.ao(U.scheduler),this.isSpriteLoaded=de,this.scheduler=U.scheduler,this.brightness=we}loadTile(U,Z){let oe=U.uid,de=U&&U.request,fe=de&&de.collectResourceTiming,we=this.loading[oe]=new me(U);we.abort=this.loadVectorData(U,(Ae,ve)=>{let Pe=!this.loading[oe];if(delete this.loading[oe],Pe||Ae||!ve)return we.status="done",Pe||(this.loaded[oe]=we),Z(Ae);let rt=ve.rawData,Ke={};ve.expires&&(Ke.expires=ve.expires),ve.cacheControl&&(Ke.cacheControl=ve.cacheControl),we.vectorTile=ve.vectorTile||new r.dV(new r.dW(rt));let _t=()=>{we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mt,Kt)=>{if(Mt||!Kt)return Z(Mt);let en={};if(fe){let jt=w(de);jt.length>0&&(en.resourceTiming=JSON.parse(JSON.stringify(jt)))}Z(null,r.W({rawTileData:rt.slice(0)},Kt,Ke,en))})};this.isSpriteLoaded?_t():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_t,{type:"parseTile",isSymbolTile:U.isSymbolTile,zoom:U.tileZoom}):_t()}),this.loaded=this.loaded||{},this.loaded[oe]=we})}reloadTile(U,Z){let oe=this.loaded,de=U.uid;if(oe&&oe[de]){let fe=oe[de];fe.showCollisionBoxes=U.showCollisionBoxes,fe.projection=U.projection,fe.brightness=U.brightness,fe.tileTransform=r.dK(U.tileID.canonical,U.projection),fe.extraShadowCaster=U.extraShadowCaster,fe.lut=U.lut;let we=(Ae,ve)=>{let Pe=fe.reloadCallback;Pe&&(delete fe.reloadCallback,fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Pe)),Z(Ae,ve)};fe.status==="parsing"?fe.reloadCallback=we:fe.status==="done"&&(fe.vectorTile?fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,we):we())}else Z(null,void 0)}abortTile(U,Z){let oe=U.uid,de=this.loading[oe];de&&(de.abort&&de.abort(),delete this.loading[oe]),Z()}removeTile(U,Z){let oe=this.loaded,de=U.uid;oe&&oe[de]&&delete oe[de],Z()}}class Ie{loadTile(U,Z){let{uid:oe,encoding:de,rawImageData:fe,padding:we}=U,Ae=ImageBitmap&&fe instanceof ImageBitmap?this.getImageData(fe,we):fe;Z(null,new r.dX(oe,Ae,de,we<1))}getImageData(U,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);let oe=this.offscreenCanvasContext.getImageData(-Z,-Z,U.width+2*Z,U.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}class Qe{decodeRasterArray({task:U,buffer:Z},oe){r.dY.performDecoding(Z,U).then(de=>{oe(null,de)},de=>{oe(de)})}}let ze=r.dZ.prototype.toGeoJSON,nt=class{constructor(ye){this._feature=ye,this.extent=r.a3,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){let ye=[];for(let U of this._feature.geometry)ye.push([new r.P(U[0],U[1])]);return ye}{let ye=[];for(let U of this._feature.geometry){let Z=[];for(let oe of U)Z.push(new r.P(oe[0],oe[1]));ye.push(Z)}return ye}}toGeoJSON(ye,U,Z){return ze.call(this,ye,U,Z)}},ft=class{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.a3,this.length=ye.length,this._features=ye}feature(ye){return new nt(this._features[ye])}},Ue=64/4096;class Nt{constructor(){this.features=new Map}clear(){this.features.clear()}load(U=[],Z){for(let oe of U){let de=oe.id;if(de==null)continue;let fe=this.features.get(de);fe&&this.updateCache(fe,Z),oe.geometry?(fe=Jt(oe),this.updateCache(fe,Z),this.features.set(de,fe)):this.features.delete(de),this.updateCache(fe,Z)}}updateCache(U,Z){for(let{canonical:oe,uid:de}of Object.values(Z)){let{z:fe,x:we,y:Ae}=oe;Yt(U,Math.pow(2,fe),we,Ae)&&delete Z[de]}}getTile(U,Z,oe){let de=Math.pow(2,U),fe=[];for(let we of this.features.values())Yt(we,de,Z,oe)&&fe.push(fr(we,de,Z,oe));return{features:fe}}getFeatures(){return[...this.features.values()]}}function Yt({minX:ye,minY:U,maxX:Z,maxY:oe},de,fe,we){return ye<(fe+1+Ue)/de&&U<(we+1+Ue)/de&&Z>(fe-Ue)/de&&oe>(we-Ue)/de}function Jt(ye){let{id:U,geometry:Z,properties:oe}=ye;if(!Z)return;if(Z.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:de,coordinates:fe}=Z,we={id:U,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ae=we.geometry;if(de==="Point")wt(fe,Ae,we);else if(de==="MultiPoint")for(let ve of fe)wt(ve,Ae,we);else if(de==="LineString")we.type=2,er(fe,Ae,we);else if(de==="MultiLineString")we.type=2,St(fe,Ae,we);else if(de==="Polygon")we.type=3,St(fe,Ae,we,!0);else{if(de!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");we.type=3;for(let ve of fe)St(ve,Ae,we,!0)}return we}function wt([ye,U],Z,oe){let de=r.aj(ye),fe=r.ak(U);fe=fe<0?0:fe>1?1:fe,Z.push(de,fe),oe.minX=Math.min(oe.minX,de),oe.minY=Math.min(oe.minY,fe),oe.maxX=Math.max(oe.maxX,de),oe.maxY=Math.max(oe.maxY,fe)}function er(ye,U,Z,oe=!1,de=!1){let fe=[];for(let we of ye)wt(we,fe,Z);U.push(fe),oe&&function(we,Ae){let ve=0;for(let Pe=0,rt=we.length,Ke=rt-2;Pe<rt;Ke=Pe,Pe+=2)ve+=(we[Pe]-we[Ke])*(we[Pe+1]+we[Ke+1]);if(ve>0===Ae)for(let Pe=0,rt=we.length;Pe<rt/2;Pe+=2){let Ke=we[Pe],_t=we[Pe+1];we[Pe]=we[rt-2-Pe],we[Pe+1]=we[rt-1-Pe],we[rt-2-Pe]=Ke,we[rt-1-Pe]=_t}}(fe,de)}function St(ye,U,Z,oe=!1){for(let de=0;de<ye.length;de++)er(ye[de],U,Z,oe,de===0)}function fr(ye,U,Z,oe){let{id:de,type:fe,geometry:we,tags:Ae}=ye,ve=[];if(fe===1)yr(we,U,Z,oe,ve);else for(let Pe of we)ve.push(yr(Pe,U,Z,oe));return{id:de,type:fe,geometry:ve,tags:Ae}}function yr(ye,U,Z,oe,de=[]){for(let fe=0;fe<ye.length;fe+=2)de.push(kr(ye[fe],ye[fe+1],U,Z,oe));return de}function kr(ye,U,Z,oe,de){return[Math.round(r.a3*(ye*Z-oe)),Math.round(r.a3*(U*Z-de))]}var xn={exports:{}},Fo=r.d$,bt=r.d_.VectorTileFeature,zt=Ht;function Ht(ye,U){this.options=U||{},this.features=ye,this.length=ye.length}function gn(ye,U){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=U||4096}Ht.prototype.feature=function(ye){return new gn(this.features[ye],this.options.extent)},gn.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var U=0;U<ye.length;U++){for(var Z=ye[U],oe=[],de=0;de<Z.length;de++)oe.push(new Fo(Z[de][0],Z[de][1]));this.geometry.push(oe)}return this.geometry},gn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,U=1/0,Z=-1/0,oe=1/0,de=-1/0,fe=0;fe<ye.length;fe++)for(var we=ye[fe],Ae=0;Ae<we.length;Ae++){var ve=we[Ae];U=Math.min(U,ve.x),Z=Math.max(Z,ve.x),oe=Math.min(oe,ve.y),de=Math.max(de,ve.y)}return[U,oe,Z,de]},gn.prototype.toGeoJSON=bt.prototype.toGeoJSON;var kt=r.e0,ri=zt;function Qn(ye){var U=new kt;return function(Z,oe){for(var de in Z.layers)oe.writeMessage(3,Gi,Z.layers[de])}(ye,U),U.finish()}function Gi(ye,U){var Z;U.writeVarintField(15,ye.version||1),U.writeStringField(1,ye.name||""),U.writeVarintField(5,ye.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ye.length;Z++)oe.feature=ye.feature(Z),U.writeMessage(2,lr,oe);var de=oe.keys;for(Z=0;Z<de.length;Z++)U.writeStringField(3,de[Z]);var fe=oe.values;for(Z=0;Z<fe.length;Z++)U.writeMessage(4,ii,fe[Z])}function lr(ye,U){var Z=ye.feature;Z.id!==void 0&&U.writeVarintField(1,Z.id),U.writeMessage(2,wa,ye),U.writeVarintField(3,Z.type),U.writeMessage(4,Fn,Z)}function wa(ye,U){var Z=ye.feature,oe=ye.keys,de=ye.values,fe=ye.keycache,we=ye.valuecache;for(var Ae in Z.properties){var ve=Z.properties[Ae],Pe=fe[Ae];if(ve!==null){Pe===void 0&&(oe.push(Ae),fe[Ae]=Pe=oe.length-1),U.writeVarint(Pe);var rt=typeof ve;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(ve=JSON.stringify(ve));var Ke=rt+":"+ve,_t=we[Ke];_t===void 0&&(de.push(ve),we[Ke]=_t=de.length-1),U.writeVarint(_t)}}}function Pt(ye,U){return(U<<3)+(7&ye)}function Sr(ye){return ye<<1^ye>>31}function Fn(ye,U){for(var Z=ye.loadGeometry(),oe=ye.type,de=0,fe=0,we=Z.length,Ae=0;Ae<we;Ae++){var ve=Z[Ae],Pe=1;oe===1&&(Pe=ve.length),U.writeVarint(Pt(1,Pe));for(var rt=oe===3?ve.length-1:ve.length,Ke=0;Ke<rt;Ke++){Ke===1&&oe!==1&&U.writeVarint(Pt(2,rt-1));var _t=ve[Ke].x-de,Mt=ve[Ke].y-fe;U.writeVarint(Sr(_t)),U.writeVarint(Sr(Mt)),de+=_t,fe+=Mt}oe===3&&U.writeVarint(Pt(7,1))}}function ii(ye,U){var Z=typeof ye;Z==="string"?U.writeStringField(1,ye):Z==="boolean"?U.writeBooleanField(7,ye):Z==="number"&&(ye%1!=0?U.writeDoubleField(3,ye):ye<0?U.writeSVarintField(6,ye):U.writeVarintField(5,ye))}xn.exports=Qn,xn.exports.fromVectorTileJs=Qn,xn.exports.fromGeojsonVt=function(ye,U){U=U||{};var Z={};for(var oe in ye)Z[oe]=new ri(ye[oe].features,U),Z[oe].name=oe,Z[oe].version=U.version,Z[oe].extent=U.extent;return Qn({layers:Z})},xn.exports.GeoJSONWrapper=ri;var is=r.e1(xn.exports);let ks={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},Hc=Math.fround||(fl=new Float32Array(1),ye=>(fl[0]=+ye,fl[0]));var fl;let _o=3,yo=5,qc=6;class Rt{constructor(U){this.options=Object.assign(Object.create(ks),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){let{log:Z,minZoom:oe,maxZoom:de}=this.options;Z&&console.time("total time");let fe=`prepare ${U.length} points`;Z&&console.time(fe),this.points=U;let we=[];for(let ve=0;ve<U.length;ve++){let Pe=U[ve];if(!Pe.geometry)continue;let[rt,Ke]=Pe.geometry.coordinates,_t=Hc(Li(rt)),Mt=Hc(Ea(Ke));we.push(_t,Mt,1/0,ve,-1,1),this.options.reduce&&we.push(0)}let Ae=this.trees[de+1]=this._createTree(we);Z&&console.timeEnd(fe);for(let ve=de;ve>=oe;ve--){let Pe=+Date.now();Ae=this.trees[ve]=this._createTree(this._cluster(Ae,ve)),Z&&console.log("z%d: %d clusters in %dms",ve,Ae.numItems,+Date.now()-Pe)}return Z&&console.timeEnd("total time"),this}getClusters(U,Z){let oe=((U[0]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,U[1])),fe=U[2]===180?180:((U[2]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)oe=-180,fe=180;else if(oe>fe){let Ke=this.getClusters([oe,de,180,we],Z),_t=this.getClusters([-180,de,fe,we],Z);return Ke.concat(_t)}let Ae=this.trees[this._limitZoom(Z)],ve=Ae.range(Li(oe),Ea(we),Li(fe),Ea(de)),Pe=Ae.data,rt=[];for(let Ke of ve){let _t=this.stride*Ke;rt.push(Pe[_t+yo]>1?Lt(Pe,_t,this.clusterProps):this.points[Pe[_t+_o]])}return rt}getChildren(U){let Z=this._getOriginId(U),oe=this._getOriginZoom(U),de="No cluster with the specified id.",fe=this.trees[oe];if(!fe)throw new Error(de);let we=fe.data;if(Z*this.stride>=we.length)throw new Error(de);let Ae=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ve=fe.within(we[Z*this.stride],we[Z*this.stride+1],Ae),Pe=[];for(let rt of ve){let Ke=rt*this.stride;we[Ke+4]===U&&Pe.push(we[Ke+yo]>1?Lt(we,Ke,this.clusterProps):this.points[we[Ke+_o]])}if(Pe.length===0)throw new Error(de);return Pe}getLeaves(U,Z,oe){let de=[];return this._appendLeaves(de,U,Z=Z||10,oe=oe||0,0),de}getTile(U,Z,oe){let de=this.trees[this._limitZoom(U)],fe=Math.pow(2,U),{extent:we,radius:Ae}=this.options,ve=Ae/we,Pe=(oe-ve)/fe,rt=(oe+1+ve)/fe,Ke={features:[]};return this._addTileFeatures(de.range((Z-ve)/fe,Pe,(Z+1+ve)/fe,rt),de.data,Z,oe,fe,Ke),Z===0&&this._addTileFeatures(de.range(1-ve/fe,Pe,1,rt),de.data,fe,oe,fe,Ke),Z===fe-1&&this._addTileFeatures(de.range(0,Pe,ve/fe,rt),de.data,-1,oe,fe,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(U){let Z=this._getOriginZoom(U)-1;for(;Z<=this.options.maxZoom;){let oe=this.getChildren(U);if(Z++,oe.length!==1)break;U=oe[0].properties.cluster_id}return Z}_appendLeaves(U,Z,oe,de,fe){let we=this.getChildren(Z);for(let Ae of we){let ve=Ae.properties;if(ve&&ve.cluster?fe+ve.point_count<=de?fe+=ve.point_count:fe=this._appendLeaves(U,ve.cluster_id,oe,de,fe):fe<de?fe++:U.push(Ae),U.length===oe)break}return fe}_createTree(U){let Z=new r.cK(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<U.length;oe+=this.stride)Z.add(U[oe],U[oe+1]);return Z.finish(),Z.data=U,Z}_addTileFeatures(U,Z,oe,de,fe,we){for(let Ae of U){let ve=Ae*this.stride,Pe=Z[ve+yo]>1,rt,Ke,_t;if(Pe)rt=pl(Z,ve,this.clusterProps),Ke=Z[ve],_t=Z[ve+1];else{let en=this.points[Z[ve+_o]];rt=en.properties;let[jt,an]=en.geometry.coordinates;Ke=Li(jt),_t=Ea(an)}let Mt={type:1,geometry:[[Math.round(this.options.extent*(Ke*fe-oe)),Math.round(this.options.extent*(_t*fe-de))]],tags:rt},Kt;Kt=Pe||this.options.generateId?Z[ve+_o]:this.points[Z[ve+_o]].id,Kt!==void 0&&(Mt.id=Kt),we.features.push(Mt)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,Z){let{radius:oe,extent:de,reduce:fe,minPoints:we}=this.options,Ae=oe/(de*Math.pow(2,Z)),ve=U.data,Pe=[],rt=this.stride;for(let Ke=0;Ke<ve.length;Ke+=rt){if(ve[Ke+2]<=Z)continue;ve[Ke+2]=Z;let _t=ve[Ke],Mt=ve[Ke+1],Kt=U.within(ve[Ke],ve[Ke+1],Ae),en=ve[Ke+yo],jt=en;for(let an of Kt){let mt=an*rt;ve[mt+2]>Z&&(jt+=ve[mt+yo])}if(jt>en&&jt>=we){let an,mt=_t*en,tr=Mt*en,Ln=-1,fn=(Ke/rt<<5)+(Z+1)+this.points.length;for(let br of Kt){let nr=br*rt;if(ve[nr+2]<=Z)continue;ve[nr+2]=Z;let Ar=ve[nr+yo];mt+=ve[nr]*Ar,tr+=ve[nr+1]*Ar,ve[nr+4]=fn,fe&&(an||(an=this._map(ve,Ke,!0),Ln=this.clusterProps.length,this.clusterProps.push(an)),fe(an,this._map(ve,nr)))}ve[Ke+4]=fn,Pe.push(mt/jt,tr/jt,1/0,fn,-1,jt),fe&&Pe.push(Ln)}else{for(let an=0;an<rt;an++)Pe.push(ve[Ke+an]);if(jt>1)for(let an of Kt){let mt=an*rt;if(!(ve[mt+2]<=Z)){ve[mt+2]=Z;for(let tr=0;tr<rt;tr++)Pe.push(ve[mt+tr])}}}}return Pe}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,Z,oe){if(U[Z+yo]>1){let we=this.clusterProps[U[Z+qc]];return oe?Object.assign({},we):we}let de=this.points[U[Z+_o]].properties,fe=this.options.map(de);return oe&&fe===de?Object.assign({},fe):fe}}function Lt(ye,U,Z){return{type:"Feature",id:ye[U+_o],properties:pl(ye,U,Z),geometry:{type:"Point",coordinates:[(oe=ye[U],360*(oe-.5)),ml(ye[U+1])]}};var oe}function pl(ye,U,Z){let oe=ye[U+yo],de=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,fe=ye[U+qc],we=fe===-1?{}:Object.assign({},Z[fe]);return Object.assign(we,{cluster:!0,cluster_id:ye[U+_o],point_count:oe,point_count_abbreviated:de})}function Li(ye){return ye/360+.5}function Ea(ye){let U=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Z<0?0:Z>1?1:Z}function ml(ye){let U=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function gl(ye,U,Z,oe){let de=oe,fe=U+(Z-U>>1),we,Ae=Z-U,ve=ye[U],Pe=ye[U+1],rt=ye[Z],Ke=ye[Z+1];for(let _t=U+3;_t<Z;_t+=3){let Mt=Wc(ye[_t],ye[_t+1],ve,Pe,rt,Ke);if(Mt>de)we=_t,de=Mt;else if(Mt===de){let Kt=Math.abs(_t-fe);Kt<Ae&&(we=_t,Ae=Kt)}}de>oe&&(we-U>3&&gl(ye,U,we,oe),ye[we+2]=de,Z-we>3&&gl(ye,we,Z,oe))}function Wc(ye,U,Z,oe,de,fe){let we=de-Z,Ae=fe-oe;if(we!==0||Ae!==0){let ve=((ye-Z)*we+(U-oe)*Ae)/(we*we+Ae*Ae);ve>1?(Z=de,oe=fe):ve>0&&(Z+=we*ve,oe+=Ae*ve)}return we=ye-Z,Ae=U-oe,we*we+Ae*Ae}function Ls(ye,U,Z,oe){let de={id:ye??null,type:U,geometry:Z,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(U==="Point"||U==="MultiPoint"||U==="LineString")Ta(de,Z);else if(U==="Polygon")Ta(de,Z[0]);else if(U==="MultiLineString")for(let fe of Z)Ta(de,fe);else if(U==="MultiPolygon")for(let fe of Z)Ta(de,fe[0]);return de}function Ta(ye,U){for(let Z=0;Z<U.length;Z+=3)ye.minX=Math.min(ye.minX,U[Z]),ye.minY=Math.min(ye.minY,U[Z+1]),ye.maxX=Math.max(ye.maxX,U[Z]),ye.maxY=Math.max(ye.maxY,U[Z+1])}function _l(ye,U,Z,oe){if(!U.geometry)return;let de=U.geometry.coordinates;if(de&&de.length===0)return;let fe=U.geometry.type,we=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ae=[],ve=U.id;if(Z.promoteId?ve=U.properties[Z.promoteId]:Z.generateId&&(ve=oe||0),fe==="Point")Zc(de,Ae);else if(fe==="MultiPoint")for(let Pe of de)Zc(Pe,Ae);else if(fe==="LineString")yl(de,Ae,we,!1);else if(fe==="MultiLineString"){if(Z.lineMetrics){for(let Pe of de)Ae=[],yl(Pe,Ae,we,!1),ye.push(Ls(ve,"LineString",Ae,U.properties));return}vl(de,Ae,we,!1)}else if(fe==="Polygon")vl(de,Ae,we,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(let Pe of U.geometry.geometries)_l(ye,{id:ve,geometry:Pe,properties:U.properties},Z,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Pe of de){let rt=[];vl(Pe,rt,we,!0),Ae.push(rt)}}ye.push(Ls(ve,fe,Ae,U.properties))}function Zc(ye,U){U.push(eo(ye[0]),zh(ye[1]),0)}function yl(ye,U,Z,oe){let de,fe,we=0;for(let ve=0;ve<ye.length;ve++){let Pe=eo(ye[ve][0]),rt=zh(ye[ve][1]);U.push(Pe,rt,0),ve>0&&(we+=oe?(de*rt-Pe*fe)/2:Math.sqrt(Math.pow(Pe-de,2)+Math.pow(rt-fe,2))),de=Pe,fe=rt}let Ae=U.length-3;U[2]=1,gl(U,0,Ae,Z),U[Ae+2]=1,U.size=Math.abs(we),U.start=0,U.end=U.size}function vl(ye,U,Z,oe){for(let de=0;de<ye.length;de++){let fe=[];yl(ye[de],fe,Z,oe),U.push(fe)}}function eo(ye){return ye/360+.5}function zh(ye){let U=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Z<0?0:Z>1?1:Z}function Ft(ye,U,Z,oe,de,fe,we,Ae){if(oe/=U,fe>=(Z/=U)&&we<oe)return ye;if(we<Z||fe>=oe)return null;let ve=[];for(let Pe of ye){let rt=Pe.geometry,Ke=Pe.type,_t=de===0?Pe.minX:Pe.minY,Mt=de===0?Pe.maxX:Pe.maxY;if(_t>=Z&&Mt<oe){ve.push(Pe);continue}if(Mt<Z||_t>=oe)continue;let Kt=[];if(Ke==="Point"||Ke==="MultiPoint")Xc(rt,Kt,Z,oe,de);else if(Ke==="LineString")mr(rt,Kt,Z,oe,de,!1,Ae.lineMetrics);else if(Ke==="MultiLineString")Ca(rt,Kt,Z,oe,de,!1);else if(Ke==="Polygon")Ca(rt,Kt,Z,oe,de,!0);else if(Ke==="MultiPolygon")for(let en of rt){let jt=[];Ca(en,jt,Z,oe,de,!0),jt.length&&Kt.push(jt)}if(Kt.length){if(Ae.lineMetrics&&Ke==="LineString"){for(let en of Kt)ve.push(Ls(Pe.id,Ke,en,Pe.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(Kt.length===1?(Ke="LineString",Kt=Kt[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=Kt.length===3?"Point":"MultiPoint"),ve.push(Ls(Pe.id,Ke,Kt,Pe.tags))}}return ve.length?ve:null}function Xc(ye,U,Z,oe,de){for(let fe=0;fe<ye.length;fe+=3){let we=ye[fe+de];we>=Z&&we<=oe&&No(U,ye[fe],ye[fe+1],ye[fe+2])}}function mr(ye,U,Z,oe,de,fe,we){let Ae=xl(ye),ve=de===0?zo:Yc,Pe,rt,Ke=ye.start;for(let jt=0;jt<ye.length-3;jt+=3){let an=ye[jt],mt=ye[jt+1],tr=ye[jt+2],Ln=ye[jt+3],fn=ye[jt+4],br=de===0?an:mt,nr=de===0?Ln:fn,Ar=!1;we&&(Pe=Math.sqrt(Math.pow(an-Ln,2)+Math.pow(mt-fn,2))),br<Z?nr>Z&&(rt=ve(Ae,an,mt,Ln,fn,Z),we&&(Ae.start=Ke+Pe*rt)):br>oe?nr<oe&&(rt=ve(Ae,an,mt,Ln,fn,oe),we&&(Ae.start=Ke+Pe*rt)):No(Ae,an,mt,tr),nr<Z&&br>=Z&&(rt=ve(Ae,an,mt,Ln,fn,Z),Ar=!0),nr>oe&&br<=oe&&(rt=ve(Ae,an,mt,Ln,fn,oe),Ar=!0),!fe&&Ar&&(we&&(Ae.end=Ke+Pe*rt),U.push(Ae),Ae=xl(ye)),we&&(Ke+=Pe)}let _t=ye.length-3,Mt=ye[_t],Kt=ye[_t+1],en=de===0?Mt:Kt;en>=Z&&en<=oe&&No(Ae,Mt,Kt,ye[_t+2]),_t=Ae.length-3,fe&&_t>=3&&(Ae[_t]!==Ae[0]||Ae[_t+1]!==Ae[1])&&No(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&U.push(Ae)}function xl(ye){let U=[];return U.size=ye.size,U.start=ye.start,U.end=ye.end,U}function Ca(ye,U,Z,oe,de,fe){for(let we of ye)mr(we,U,Z,oe,de,fe,!1)}function No(ye,U,Z,oe){ye.push(U,Z,oe)}function zo(ye,U,Z,oe,de,fe){let we=(fe-U)/(oe-U);return No(ye,fe,Z+(de-Z)*we,1),we}function Yc(ye,U,Z,oe,de,fe){let we=(fe-Z)/(de-Z);return No(ye,U+(oe-U)*we,fe,1),we}function Fs(ye,U){let Z=[];for(let oe=0;oe<ye.length;oe++){let de=ye[oe],fe=de.type,we;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")we=Ns(de.geometry,U);else if(fe==="MultiLineString"||fe==="Polygon"){we=[];for(let Ae of de.geometry)we.push(Ns(Ae,U))}else if(fe==="MultiPolygon"){we=[];for(let Ae of de.geometry){let ve=[];for(let Pe of Ae)ve.push(Ns(Pe,U));we.push(ve)}}Z.push(Ls(de.id,fe,we,de.tags))}return Z}function Ns(ye,U){let Z=[];Z.size=ye.size,ye.start!==void 0&&(Z.start=ye.start,Z.end=ye.end);for(let oe=0;oe<ye.length;oe+=3)Z.push(ye[oe]+U,ye[oe+1],ye[oe+2]);return Z}function bl(ye,U){if(ye.transformed)return ye;let Z=1<<ye.z,oe=ye.x,de=ye.y;for(let fe of ye.features){let we=fe.geometry,Ae=fe.type;if(fe.geometry=[],Ae===1)for(let ve=0;ve<we.length;ve+=2)fe.geometry.push(wl(we[ve],we[ve+1],U,Z,oe,de));else for(let ve=0;ve<we.length;ve++){let Pe=[];for(let rt=0;rt<we[ve].length;rt+=2)Pe.push(wl(we[ve][rt],we[ve][rt+1],U,Z,oe,de));fe.geometry.push(Pe)}}return ye.transformed=!0,ye}function wl(ye,U,Z,oe,de,fe){return[Math.round(Z*(ye*oe-de)),Math.round(Z*(U*oe-fe))]}function Bh(ye,U,Z,oe,de){let fe=U===de.maxZoom?0:de.tolerance/((1<<U)*de.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:Z,y:oe,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ae of ye)El(we,Ae,fe,de);return we}function El(ye,U,Z,oe){let de=U.geometry,fe=U.type,we=[];if(ye.minX=Math.min(ye.minX,U.minX),ye.minY=Math.min(ye.minY,U.minY),ye.maxX=Math.max(ye.maxX,U.maxX),ye.maxY=Math.max(ye.maxY,U.maxY),fe==="Point"||fe==="MultiPoint")for(let Ae=0;Ae<de.length;Ae+=3)we.push(de[Ae],de[Ae+1]),ye.numPoints++,ye.numSimplified++;else if(fe==="LineString")to(we,de,ye,Z,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Ae=0;Ae<de.length;Ae++)to(we,de[Ae],ye,Z,fe==="Polygon",Ae===0);else if(fe==="MultiPolygon")for(let Ae=0;Ae<de.length;Ae++){let ve=de[Ae];for(let Pe=0;Pe<ve.length;Pe++)to(we,ve[Pe],ye,Z,!0,Pe===0)}if(we.length){let Ae=U.tags||null;if(fe==="LineString"&&oe.lineMetrics){Ae={};for(let Pe in U.tags)Ae[Pe]=U.tags[Pe];Ae.mapbox_clip_start=de.start/de.size,Ae.mapbox_clip_end=de.end/de.size}let ve={geometry:we,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Ae};U.id!==null&&(ve.id=U.id),ye.features.push(ve)}}function to(ye,U,Z,oe,de,fe){let we=oe*oe;if(oe>0&&U.size<(de?we:oe))return void(Z.numPoints+=U.length/3);let Ae=[];for(let ve=0;ve<U.length;ve+=3)(oe===0||U[ve+2]>we)&&(Z.numSimplified++,Ae.push(U[ve],U[ve+1])),Z.numPoints++;de&&function(ve,Pe){let rt=0;for(let Ke=0,_t=ve.length,Mt=_t-2;Ke<_t;Mt=Ke,Ke+=2)rt+=(ve[Ke]-ve[Mt])*(ve[Ke+1]+ve[Mt+1]);if(rt>0===Pe)for(let Ke=0,_t=ve.length;Ke<_t/2;Ke+=2){let Mt=ve[Ke],Kt=ve[Ke+1];ve[Ke]=ve[_t-2-Ke],ve[Ke+1]=ve[_t-1-Ke],ve[_t-2-Ke]=Mt,ve[_t-1-Ke]=Kt}}(Ae,fe),ye.push(Ae)}let zs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class no{constructor(U,Z){let oe=(Z=this.options=function(fe,we){for(let Ae in we)fe[Ae]=we[Ae];return fe}(Object.create(zs),Z)).debug;if(oe&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(fe,we){let Ae=[];if(fe.type==="FeatureCollection")for(let ve=0;ve<fe.features.length;ve++)_l(Ae,fe.features[ve],we,ve);else _l(Ae,fe.type==="Feature"?fe:{geometry:fe},we);return Ae}(U,Z);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(fe,we){let Ae=we.buffer/we.extent,ve=fe,Pe=Ft(fe,1,-1-Ae,Ae,0,-1,2,we),rt=Ft(fe,1,1-Ae,2+Ae,0,-1,2,we);return(Pe||rt)&&(ve=Ft(fe,1,-Ae,1+Ae,0,-1,2,we)||[],Pe&&(ve=Fs(Pe,1).concat(ve)),rt&&(ve=ve.concat(Fs(rt,-1)))),ve}(de,Z),de.length&&this.splitTile(de,0,0,0),oe&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(U,Z,oe,de,fe,we,Ae){let ve=[U,Z,oe,de],Pe=this.options,rt=Pe.debug;for(;ve.length;){de=ve.pop(),oe=ve.pop(),Z=ve.pop(),U=ve.pop();let Ke=1<<Z,_t=Xr(Z,oe,de),Mt=this.tiles[_t];if(!Mt&&(rt>1&&console.time("creation"),Mt=this.tiles[_t]=Bh(U,Z,oe,de,Pe),this.tileCoords.push({z:Z,x:oe,y:de}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,oe,de,Mt.numFeatures,Mt.numPoints,Mt.numSimplified),console.timeEnd("creation"));let Ar=`z${Z}`;this.stats[Ar]=(this.stats[Ar]||0)+1,this.total++}if(Mt.source=U,fe==null){if(Z===Pe.indexMaxZoom||Mt.numPoints<=Pe.indexMaxPoints)continue}else{if(Z===Pe.maxZoom||Z===fe)continue;if(fe!=null){let Ar=fe-Z;if(oe!==we>>Ar||de!==Ae>>Ar)continue}}if(Mt.source=null,U.length===0)continue;rt>1&&console.time("clipping");let Kt=.5*Pe.buffer/Pe.extent,en=.5-Kt,jt=.5+Kt,an=1+Kt,mt=null,tr=null,Ln=null,fn=null,br=Ft(U,Ke,oe-Kt,oe+jt,0,Mt.minX,Mt.maxX,Pe),nr=Ft(U,Ke,oe+en,oe+an,0,Mt.minX,Mt.maxX,Pe);U=null,br&&(mt=Ft(br,Ke,de-Kt,de+jt,1,Mt.minY,Mt.maxY,Pe),tr=Ft(br,Ke,de+en,de+an,1,Mt.minY,Mt.maxY,Pe),br=null),nr&&(Ln=Ft(nr,Ke,de-Kt,de+jt,1,Mt.minY,Mt.maxY,Pe),fn=Ft(nr,Ke,de+en,de+an,1,Mt.minY,Mt.maxY,Pe),nr=null),rt>1&&console.timeEnd("clipping"),ve.push(mt||[],Z+1,2*oe,2*de),ve.push(tr||[],Z+1,2*oe,2*de+1),ve.push(Ln||[],Z+1,2*oe+1,2*de),ve.push(fn||[],Z+1,2*oe+1,2*de+1)}}getTile(U,Z,oe){U=+U,Z=+Z,oe=+oe;let de=this.options,{extent:fe,debug:we}=de;if(U<0||U>24)return null;let Ae=1<<U,ve=Xr(U,Z=Z+Ae&Ae-1,oe);if(this.tiles[ve])return bl(this.tiles[ve],fe);we>1&&console.log("drilling down to z%d-%d-%d",U,Z,oe);let Pe,rt=U,Ke=Z,_t=oe;for(;!Pe&&rt>0;)rt--,Ke>>=1,_t>>=1,Pe=this.tiles[Xr(rt,Ke,_t)];return Pe&&Pe.source?(we>1&&(console.log("found parent tile z%d-%d-%d",rt,Ke,_t),console.time("drilling down")),this.splitTile(Pe.source,rt,Ke,_t,U,Z,oe),we>1&&console.timeEnd("drilling down"),this.tiles[ve]?bl(this.tiles[ve],fe):null):null}}function Xr(ye,U,Z){return 32*((1<<ye)*Z+U)+ye}function Vh(ye,U){let Z=ye.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);let oe=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!oe)return U(null,null);let de=new ft(oe.features),fe=is(de);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),U(null,{vectorTile:de,rawData:fe.buffer})}class Sa extends be{constructor(U,Z,oe,de,fe,we){super(U,Z,oe,de,Vh,we),fe&&(this.loadGeoJSON=fe),this._dynamicIndex=new Nt}loadData(U,Z){let oe=U&&U.request,de=oe&&oe.collectResourceTiming;this.loadGeoJSON(U,(fe,we)=>{if(fe||!we)return Z(fe);if(typeof we!="object")return Z(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{try{if(U.filter){let ve=r.y(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));we.features=we.features.filter(Pe=>ve.value.evaluate({zoom:0},Pe))}U.dynamic?(we.type==="Feature"&&(we={type:"FeatureCollection",features:[we]}),U.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(we.features,this.loaded),U.cluster&&(we.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=U.cluster?new Rt(function({superclusterOptions:ve,clusterProperties:Pe}){if(!Pe||!ve)return ve;let rt={},Ke={},_t={accumulated:null,zoom:0},Mt={properties:null},Kt=Object.keys(Pe);for(let en of Kt){let[jt,an]=Pe[en],mt=r.y(an),tr=r.y(typeof jt=="string"?[jt,["accumulated"],["get",en]]:jt);rt[en]=mt.value,Ke[en]=tr.value}return ve.map=en=>{Mt.properties=en;let jt={};for(let an of Kt)jt[an]=rt[an].evaluate(_t,Mt);return jt},ve.reduce=(en,jt)=>{Mt.properties=jt;for(let an of Kt)_t.accumulated=en[an],en[an]=Ke[an].evaluate(_t,Mt)},ve}(U)).load(we.features):U.dynamic?this._dynamicIndex:function(ve,Pe){return new no(ve,Pe)}(we,U.geojsonVtOptions)}catch(ve){return Z(ve)}let Ae={};if(de){let ve=w(oe);ve&&(Ae.resourceTiming={},Ae.resourceTiming[U.source]=JSON.parse(JSON.stringify(ve)))}Z(null,Ae)}})}reloadTile(U,Z){let oe=this.loaded;return oe&&oe[U.uid]?U.partial?Z(null,void 0):super.reloadTile(U,Z):this.loadTile(U,Z)}loadGeoJSON(U,Z){if(U.request)r.g(U.request,Z);else{if(typeof U.data!="string")return Z(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(U.data))}catch{return Z(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(oe){Z(oe)}}getClusterChildren(U,Z){try{Z(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(oe){Z(oe)}}getClusterLeaves(U,Z){try{Z(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(oe){Z(oe)}}}class Tl{constructor(U,Z){this.tileID=new r.aL(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=U.projection,this.brightness=Z}parse(U,Z,oe,de){this.status="parsing";let fe=new r.aL(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),we={},Ae=Z.familiesBySource[oe.source],ve=new r.dN(fe,oe.promoteId);return ve.bucketLayerIDs=[],ve.is3DTile=!0,r.e3(U).then(Pe=>{if(!Pe)return de(new Error("Could not parse tile"));let rt=r.e4(Pe,1/r.b5(oe.tileID.canonical)),Ke=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Pe.json.asset.extras&&Pe.json.asset.extras.MAPBOX_mesh_features,_t=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("EXT_meshopt_compression"),Mt=new r.X(this.zoom,{brightness:this.brightness});for(let Kt in Ae)for(let en of Ae[Kt]){let jt=en[0];ve.bucketLayerIDs.push(en.map(mt=>mt.id)),jt.recalculate(Mt,[]);let an=new r.e5(rt,fe,Ke,_t,this.brightness,ve);Ke||(an.needsUpload=!0),we[jt.fqid]=an,an.evaluate(jt)}this.status="done",de(null,{buckets:we,featureIndex:ve})}).catch(Pe=>de(new Error(Pe.message)))}}class Kc{constructor(U,Z,oe,de,fe,we){this.actor=U,this.layerIndex=Z,this.brightness=we,this.loading={},this.loaded={}}loadTile(U,Z){let oe=U.uid,de=this.loading[oe]=new Tl(U,this.brightness);r.e2(U.request,(fe,we)=>{let Ae=!this.loading[oe];return delete this.loading[oe],Ae||fe?(de.status="done",Ae||(this.loaded[oe]=de),Z(fe)):we&&we.byteLength!==0?void de.parse(we,this.layerIndex,U,(ve,Pe)=>{de.status="done",this.loaded=this.loaded||{},this.loaded[oe]=de,ve||!Pe?Z(ve):Z(null,Pe)}):(de.status="done",this.loaded[oe]=de,Z())})}reloadTile(U,Z){let oe=this.loaded,de=U.uid;if(oe&&oe[de]){let fe=oe[de];fe.projection=U.projection,fe.brightness=U.brightness;let we=(Ae,ve)=>{fe.reloadCallback&&(delete fe.reloadCallback,this.loadTile(U,Z)),Z(Ae,ve)};fe.status==="parsing"?fe.reloadCallback=we:fe.status==="done"&&this.loadTile(U,Z)}}abortTile(U,Z){let oe=U.uid;this.loading[oe]&&delete this.loading[oe],Z()}removeTile(U,Z){let oe=this.loaded,de=U.uid;oe&&oe[de]&&delete oe[de],Z()}}class Cl{constructor(U){this.self=U,this.actor=new r.e6(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.aJ({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:Sa,"batched-model":Kc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,oe)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=oe},this.self.registerRTLTextPlugin=Z=>{if(r.e7.isParsed())throw new Error("RTL text plugin already registered.");r.e7.applyArabicShaping=Z.applyArabicShaping,r.e7.processBidirectionalText=Z.processBidirectionalText,r.e7.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(U,Z,oe){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],delete this.rasterArrayWorkerSource,oe()}checkIfReady(U,Z,oe){oe()}setReferrer(U,Z){this.referrer=Z}spriteLoaded(U,{scope:Z,isLoaded:oe}){if(this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.isSpriteLoaded[U][Z]=oe,this.workerSources[U]&&this.workerSources[U][Z])for(let de in this.workerSources[U][Z]){let fe=this.workerSources[U][Z][de];for(let we in fe){let Ae=fe[we];Ae instanceof be&&(Ae.isSpriteLoaded=oe,Ae.fire(new r.f("isSpriteLoaded")))}}}setImages(U,{scope:Z,images:oe},de){if(this.availableImages[U]||(this.availableImages[U]={}),this.availableImages[U][Z]=oe,this.workerSources[U]&&this.workerSources[U][Z]){for(let fe in this.workerSources[U][Z]){let we=this.workerSources[U][Z][fe];for(let Ae in we)we[Ae].availableImages=oe}de()}else de()}setProjection(U,Z){this.projections[U]=r.aJ(Z)}setBrightness(U,Z,oe){this.brightness=Z,oe()}setLayers(U,Z,oe){this.getLayerIndex(U,Z.scope).replace(Z.layers,Z.options),oe()}updateLayers(U,Z,oe){this.getLayerIndex(U,Z.scope).update(Z.layers,Z.removedIds,Z.options),oe()}loadTile(U,Z,oe){Z.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,Z.type,Z.source,Z.scope).loadTile(Z,oe)}loadDEMTile(U,Z,oe){this.getDEMWorkerSource(U,Z.source,Z.scope).loadTile(Z,oe)}decodeRasterArray(U,Z,oe){this.getRasterArrayWorkerSource().decodeRasterArray(Z,oe)}reloadTile(U,Z,oe){Z.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,Z.type,Z.source,Z.scope).reloadTile(Z,oe)}abortTile(U,Z,oe){this.getWorkerSource(U,Z.type,Z.source,Z.scope).abortTile(Z,oe)}removeTile(U,Z,oe){this.getWorkerSource(U,Z.type,Z.source,Z.scope).removeTile(Z,oe)}removeSource(U,Z,oe){if(!(this.workerSources[U]&&this.workerSources[U][Z.scope]&&this.workerSources[U][Z.scope][Z.type]&&this.workerSources[U][Z.scope][Z.type][Z.source]))return;let de=this.workerSources[U][Z.scope][Z.type][Z.source];delete this.workerSources[U][Z.scope][Z.type][Z.source],de.removeSource!==void 0?de.removeSource(Z,oe):oe()}loadWorkerSource(U,Z,oe){try{this.self.importScripts(Z.url),oe()}catch(de){oe(de.toString())}}syncRTLPluginState(U,Z,oe){try{r.e7.setState(Z);let de=r.e7.getPluginURL();if(r.e7.isLoaded()&&!r.e7.isParsed()&&de!=null){this.self.importScripts(de);let fe=r.e7.isParsed();oe(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),fe)}}catch(de){oe(de.toString())}}setDracoUrl(U,Z){this.dracoUrl=Z}getAvailableImages(U,Z){this.availableImages[U]||(this.availableImages[U]={});let oe=this.availableImages[U][Z];return oe||(oe=[]),oe}getLayerIndex(U,Z){this.layerIndexes[U]||(this.layerIndexes[U]={});let oe=this.layerIndexes[U][Z];return oe||(oe=this.layerIndexes[U][Z]=new L,oe.scope=Z),oe}getWorkerSource(U,Z,oe,de){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][de]||(this.workerSources[U][de]={}),this.workerSources[U][de][Z]||(this.workerSources[U][de][Z]={}),this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.workerSources[U][de][Z][oe]||(this.workerSources[U][de][Z][oe]=new this.workerSourceTypes[Z]({send:(fe,we,Ae,ve,Pe,rt)=>{this.actor.send(fe,we,Ae,U,Pe,rt)},scheduler:this.actor.scheduler},this.getLayerIndex(U,de),this.getAvailableImages(U,de),this.isSpriteLoaded[U][de],void 0,this.brightness)),this.workerSources[U][de][Z][oe]}getDEMWorkerSource(U,Z,oe){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][oe]||(this.demWorkerSources[U][oe]={}),this.demWorkerSources[U][oe][Z]||(this.demWorkerSources[U][oe][Z]=new Ie),this.demWorkerSources[U][oe][Z]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Qe),this.rasterArrayWorkerSource}enforceCacheSizeLimit(U,Z){r.e8(Z)}getWorkerPerformanceMetrics(U,Z,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Cl(self)),Cl}),u(["./shared"],function(r){function w(p,s){if(Array.isArray(p)){if(!Array.isArray(s)||p.length!==s.length)return!1;for(let h=0;h<p.length;h++)if(!w(p[h],s[h]))return!1;return!0}if(typeof p=="object"&&p!==null&&s!==null){if(typeof s!="object"||Object.keys(p).length!==Object.keys(s).length)return!1;for(let h in p)if(!w(p[h],s[h]))return!1;return!0}return p===s}var I=A;function A(p){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{v=new Worker(E),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(E),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(L[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(L[h]=function(g){var v,x=function(E){var C=document.createElement("canvas"),M=Object.create(A.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=E,C.getContext("webgl2",M)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),L[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(p)}var L={};function $(p,s,h){let g=document.createElement(p);return s!=null&&(g.className=s),h&&h.appendChild(g),g}function Q(p,s,h){let g=document.createElementNS("http://www.w3.org/2000/svg",p);for(let v of Object.keys(s))g.setAttributeNS(null,v,String(s[v]));return h&&h.appendChild(g),g}A.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let me=typeof document<"u"?document.documentElement&&document.documentElement.style:null,he=me&&me.userSelect!==void 0?"userSelect":"WebkitUserSelect",be;function Ie(){me&&he&&(be=me[he],me[he]="none")}function Qe(){me&&he&&(me[he]=be)}function ze(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",ze,!0)}function nt(){window.addEventListener("click",ze,!0),window.setTimeout(()=>{window.removeEventListener("click",ze,!0)},0)}function ft(p,s){let h=p.getBoundingClientRect();return Yt(p,h,s)}function Ue(p,s){let h=p.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(Yt(p,h,s[v]));return g}function Nt(p){return window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Yt(p,s,h){let g=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new r.P((h.clientX-s.left)*g,(h.clientY-s.top)*g)}class Jt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,h){this._updatedSourceCaches[s]=h,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){let h=s.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(s.id),this.setDirty()}removeLayer(s){let h=s.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][s.id]=s,this._updatedLayers[h].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){let s={};for(let h in this._updatedLayers)s[h]=s[h]||{},s[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)s[h]=s[h]||{},s[h].removedIds=Object.keys(this._removedLayers[h]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let wt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class er{constructor(s,h,g,v,x,E){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=E,this.context=s;let C=s.gl;this.buffer=C.createBuffer(),s.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){let v=h.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],E=h.attributes[x.name];E!==void 0&&s.vertexAttribPointer(E,x.components,s[wt[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=h.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class St{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fr extends St{getDefault(){return r.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class yr extends St{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class kr extends St{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class xn extends St{getDefault(){return[!0,!0,!0,!0]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Fo extends St{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class bt extends St{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class zt extends St{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){let h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Ht extends St{getDefault(){let s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class gn extends St{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class kt extends St{getDefault(){return[0,1]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class ri extends St{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Qn extends St{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Gi extends St{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class lr extends St{getDefault(){let s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class wa extends St{getDefault(){return r.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Pt extends St{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class Sr extends St{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Fn extends St{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class ii extends St{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let is=class extends St{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class ks extends St{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Hc extends St{getDefault(){let s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class fl extends St{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class _o extends St{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class yo extends St{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class qc extends St{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Rt extends St{getDefault(){return null}set(s){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Lt extends St{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class pl extends St{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Li extends St{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Ea extends St{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class ml extends St{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class gl extends ml{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Wc extends ml{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ls extends ml{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ta extends Wc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class _l{constructor(s,h,g,v,x){this.context=s,this.width=h,this.height=g;let E=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new gl(s,E)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Wc(s,E):new Ls(s,E))}destroy(){let s=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&s.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&s.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&s.deleteTexture(h)}s.deleteFramebuffer(this.framebuffer)}}class Zc{constructor(s,h){this.gl=s,this.clearColor=new fr(this),this.clearDepth=new yr(this),this.clearStencil=new kr(this),this.colorMask=new xn(this),this.depthMask=new Fo(this),this.stencilMask=new bt(this),this.stencilFunc=new zt(this),this.stencilOp=new Ht(this),this.stencilTest=new gn(this),this.depthRange=new kt(this),this.depthTest=new ri(this),this.depthFunc=new Qn(this),this.blend=new Gi(this),this.blendFunc=new lr(this),this.blendColor=new wa(this),this.blendEquation=new Pt(this),this.cullFace=new Sr(this),this.cullFaceSide=new Fn(this),this.frontFace=new ii(this),this.program=new is(this),this.activeTexture=new ks(this),this.viewport=new Hc(this),this.bindFramebuffer=new fl(this),this.bindRenderbuffer=new _o(this),this.bindTexture=new yo(this),this.bindVertexBuffer=new qc(this),this.bindElementBuffer=new Rt(this),this.bindVertexArrayOES=new Lt(this),this.pixelStoreUnpack=new pl(this),this.pixelStoreUnpackPremultiplyAlpha=new Li(this),this.pixelStoreUnpackFlipY=new Ea(this),this.options=h?xt({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h,g){return new r.I(this,s,h,g)}createVertexBuffer(s,h,g,v,x){return new er(this,s,h,g,v,x)}createRenderbuffer(s,h,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),x}createFramebuffer(s,h,g,v){return new _l(this,s,h,g,v)}clear({color:s,depth:h,stencil:g,colorMask:v}){let x=this.gl,E=0;s&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(E|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(E)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){w(s.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class yl{constructor(s){this._gl=s.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let s=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,s}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class vl{constructor(s){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,s.registerParameter(this,["Symbols"],"useOcclusionQueries"),s.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),s.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),s.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),s.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class eo{constructor(s,h,g,v){let x={width:g[0],height:g[1],data:null},E=s.gl;this.targetColorTexture=new r.T(s,x,E.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(s,x,E.RGBA,{useMipmap:!1}),this.context=s,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(s,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=h.width*h.height;this.particleTexture0=new r.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new r.S;x.reserve(v);for(let E=0;E<v;E++)x.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(x,r.p.members,!0),this.particleSegment=r.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=r.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class zh extends r.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,h){return r.l(this.requestManager.transformRequest(h,r.R.Model).url).then(g=>{if(!g)return;let v=r.c(g),x=new r.M(s,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new r.d(new Error(`Could not load model ${s} from ${h}: ${g.message}`)))})}load(s,h){this.models[h]||(this.models[h]={});let g=Object.keys(s);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,s[x]));Promise.allSettled(v).then(x=>{for(let E=0;E<x.length;E++){let{status:C,value:M}=x[E];C==="fulfilled"&&M&&(this.models[h][g[E]]={model:M,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new r.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new r.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,h){return!!this.getModel(s,h)}getModel(s,h){return this.models[h]||(this.models[h]={}),this.models[h][s]?this.models[h][s].model:void 0}addModel(s,h,g){this.models[g]||(this.models[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.load({[s]:this.requestManager.normalizeModelURL(h)},g)}addModels(s,h){this.models[h]||(this.models[h]={});let g={};for(let v in s)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(s[v]);this.load(g,h)}addModelsFromBucket(s,h){this.models[h]||(this.models[h]={});let g={};for(let v of s)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(s,h){if(this.models[h]&&this.models[h][s]&&(this.models[h][s].numReferences--,this.models[h][s].numReferences===0)){let g=this.models[h][s].model;delete this.models[h][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,h){this.models[h]||(this.models[h]={});for(let g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(s.context)}}function Ft(p){let{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class Xc extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new r.i({width:1,height:1})}isLoaded(){for(let s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,h){if(this.loaded[h]!==s&&(this.loaded[h]=s,s)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(s,h){return!!this.getImage(s,h)}getImage(s,h){return this.images[h][s]}addImage(s,h,g){this._validate(s,g)&&(this.images[h][s]=g)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(let v of s){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h,g){g.version=this.images[h][s].version+1,this.images[h][s]=g,this.updatedImages[h][s]=!0}removeImage(s,h){let g=this.images[h][s];delete this.images[h][s],delete this.patterns[h][s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,h,g){let v=!0,x=!!this.loaded[h];if(!x)for(let E of s)this.images[h][E]||(v=!1);x||v?this._notify(s,h,g):this.requestors.push({ids:s,scope:h,callback:g})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,h,g){let v={};for(let x of s){this.images[h][x]||this.fire(new r.f("styleimagemissing",{id:x}));let E=this.images[h][x];E?v[x]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:r.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(s){let{width:h,height:g}=this.atlasImage[s];return{width:h,height:g}}getPattern(s,h,g){let v=this.patterns[h][s],x=this.getImage(s,h);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let E={w:x.data.width+2,h:x.data.height+2,x:0,y:0},C=new r.k(E,x);this.patterns[h][s]={bin:E,position:C}}return this._updatePatternAtlas(h,g),this.patterns[h][s].position}bind(s,h){let g=s.gl,v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new r.T(s,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,h){let g=[];for(let C in this.patterns[s])g.push(this.patterns[s][C].bin);let{w:v,h:x}=r.j(g),E=this.atlasImage[s];E.resize({width:v||1,height:x||1});for(let C in this.patterns[s]){let{bin:M}=this.patterns[s][C],P=M.x+1,k=M.y+1,N=this.images[s][C].data,B=N.width,V=N.height;r.i.copy(N,E,{x:0,y:0},{x:P,y:k},{width:B,height:V},h),r.i.copy(N,E,{x:0,y:V-1},{x:P,y:k-1},{width:B,height:1},h),r.i.copy(N,E,{x:0,y:0},{x:P,y:k+V},{width:B,height:1},h),r.i.copy(N,E,{x:B-1,y:0},{x:P-1,y:k},{width:1,height:V},h),r.i.copy(N,E,{x:0,y:0},{x:P+B,y:k},{width:1,height:V},h)}this.dirty=!0}beginFrame(){for(let s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,h){for(let g of s){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;let v=this.images[h][g];Ft(v)&&this.updateImage(g,h,v)}}}function mr(p){let s=p.key,h=p.value,g=p.valueSpec||{},v=p.objectElementValidators||{},x=p.style,E=p.styleSpec,C=[],M=r.n(h);if(M!=="object")return[new r.V(s,h,`object expected, ${M} found`)];for(let P in h){let k=P.split(".")[0],N;v[k]?N=v[k]:g[k]?N=U:v["*"]?N=v["*"]:g["*"]&&(N=U),N?C=C.concat(N({key:(s&&`${s}.`)+P,value:h[P],valueSpec:g[k]||g["*"],style:x,styleSpec:E,object:h,objectKey:P},h)):C.push(new r.m(s,h[P],`unknown property "${P}"`))}for(let P in g)v[P]||g[P].required&&g[P].default===void 0&&h[P]===void 0&&C.push(new r.V(s,h,`missing required property "${P}"`));return C}function xl(p){let s=p.value,h=p.valueSpec,g=p.style,v=p.styleSpec,x=p.key,E=p.arrayElementValidator||U;if(r.n(s)!=="array")return[new r.V(x,s,`array expected, ${r.n(s)} found`)];if(h.length&&s.length!==h.length)return[new r.V(x,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new r.V(x,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let C={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(C.function=h.function),r.n(h.value)==="object"&&(C=h.value);let M=[];for(let P=0;P<s.length;P++)M=M.concat(E({array:s,arrayIndex:P,value:s[P],valueSpec:C,style:g,styleSpec:v,key:`${x}[${P}]`},!0));return M}function Ca(p){let s=p.key,h=p.value,g=p.valueSpec,v=r.n(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new r.V(s,h,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(r.n(g.minimum)==="array"&&(x=g.minimum[p.arrayIndex]),h<x)return[new r.V(s,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(r.n(g.maximum)==="array"&&(x=g.maximum[p.arrayIndex]),h>x)return[new r.V(s,h,`${h} is greater than the maximum value ${x}`)]}return[]}function No(p){let s=p.valueSpec,h=r.u(p.value.type),g,v,x,E={},C=h!=="categorical"&&p.value.property===void 0,M=!C,P=r.n(p.value.stops)==="array"&&r.n(p.value.stops[0])==="array"&&r.n(p.value.stops[0][0])==="object",k=mr({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(V){if(h==="identity")return[new r.V(V.key,V.value,'identity function may not have a "stops" property')];let G=[],H=V.value;return G=G.concat(xl({key:V.key,value:H,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),r.n(H)==="array"&&H.length===0&&G.push(new r.V(V.key,H,"array must have at least one stop")),G},default:function(V){return U({key:V.key,value:V.value,valueSpec:s,style:V.style,styleSpec:V.styleSpec})}}});return h==="identity"&&C&&k.push(new r.V(p.key,p.value,'missing required property "property"')),h==="identity"||p.value.stops||k.push(new r.V(p.key,p.value,'missing required property "stops"')),h==="exponential"&&p.valueSpec.expression&&!r.s(p.valueSpec)&&k.push(new r.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(M&&!r.q(p.valueSpec)?k.push(new r.V(p.key,p.value,"property functions not supported")):C&&!r.r(p.valueSpec)&&k.push(new r.V(p.key,p.value,"zoom functions not supported"))),h!=="categorical"&&!P||p.value.property!==void 0||k.push(new r.V(p.key,p.value,'"property" property is required')),k;function N(V){let G=[],H=V.value,q=V.key;if(r.n(H)!=="array")return[new r.V(q,H,`array expected, ${r.n(H)} found`)];if(H.length!==2)return[new r.V(q,H,`array length 2 expected, length ${H.length} found`)];if(P){if(r.n(H[0])!=="object")return[new r.V(q,H,`object expected, ${r.n(H[0])} found`)];if(H[0].zoom===void 0)return[new r.V(q,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new r.V(q,H,"object stop key must have value")];let W=r.u(H[0].zoom);if(typeof W!="number")return[new r.V(q,H[0].zoom,"stop zoom values must be numbers")];if(x&&x>W)return[new r.V(q,H[0].zoom,"stop zoom values must appear in ascending order")];W!==x&&(x=W,v=void 0,E={}),G=G.concat(mr({key:`${q}[0]`,value:H[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Ca,value:B}}))}else G=G.concat(B({key:`${q}[0]`,value:H[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},H));return r.t(r.v(H[1]))?G.concat([new r.V(`${q}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat(U({key:`${q}[1]`,value:H[1],valueSpec:s,style:V.style,styleSpec:V.styleSpec}))}function B(V,G){let H=r.n(V.value),q=r.u(V.value),W=V.value!==null?V.value:G;if(g){if(H!==g)return[new r.V(V.key,W,`${H} stop domain type must match previous stop domain type ${g}`)]}else g=H;if(H!=="number"&&H!=="string"&&H!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new r.V(V.key,W,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&h!=="categorical"){let ee=`number expected, ${H} found`;return r.q(s)&&h===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(V.key,W,ee)]}return h!=="categorical"||H!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?h!=="categorical"&&H==="number"&&typeof q=="number"&&typeof v=="number"&&v!==void 0&&q<v?[new r.V(V.key,W,"stop domain values must appear in ascending order")]:(v=q,h==="categorical"&&q in E?[new r.V(V.key,W,"stop domain values must be unique")]:(E[q]=!0,[])):[new r.V(V.key,W,`integer expected, found ${String(q)}`)]}}function zo(p){let s=(p.expressionContext==="property"?r.x:r.y)(r.v(p.value),p.valueSpec);if(s.result==="error")return s.value.map(g=>new r.V(`${p.key}${g.key}`,p.value,g.message));let h=s.value.expression||s.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!h.outputDefined())return[new r.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!r.z(h))return[new r.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Yc(h,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!r.A(h,["zoom","feature-state"]))return[new r.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!r.B(h))return[new r.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yc(p,s){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(let v of s.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];let g=[];return p instanceof r.D&&h.has(p.name)?[new r.V(s.key,s.value,`["${p.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(p.eachChild(v=>{g.push(...Yc(v,s))}),g)}function Fs(p){let s=p.key,h=p.value,g=p.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(r.u(h))===-1&&v.push(new r.V(s,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(r.u(h))===-1&&v.push(new r.V(s,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function Ns(p){return r.G(r.v(p.value))?zo(r.o({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):bl(p)}function bl(p){let s=p.value,h=p.key;if(r.n(s)!=="array")return[new r.V(h,s,`array expected, ${r.n(s)} found`)];let g=p.styleSpec,v,x=[];if(s.length<1)return[new r.V(h,s,"filter array must have at least 1 element")];switch(x=x.concat(Fs({key:`${h}[0]`,value:s[0],valueSpec:g.filter_operator,style:p.style,styleSpec:p.styleSpec})),r.u(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&r.u(s[1])==="$type"&&x.push(new r.V(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new r.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=r.n(s[1]),v!=="string"&&x.push(new r.V(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let E=2;E<s.length;E++)v=r.n(s[E]),r.u(s[1])==="$type"?x=x.concat(Fs({key:`${h}[${E}]`,value:s[E],valueSpec:g.geometry_type,style:p.style,styleSpec:p.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new r.V(`${h}[${E}]`,s[E],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let E=1;E<s.length;E++)x=x.concat(bl({key:`${h}[${E}]`,value:s[E],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":v=r.n(s[1]),s.length!==2?x.push(new r.V(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new r.V(`${h}[1]`,s[1],`string expected, ${v} found`))}return x}function wl(p,s){let h=p.key,g=p.style,v=p.layer,x=p.styleSpec,E=p.value,C=p.objectKey,M=x[`${s}_${p.layerType}`];if(!M)return[];let P=C.match(/^(.*)-transition$/);if(s==="paint"&&P&&M[P[1]]&&M[P[1]].transition)return U({key:h,value:E,valueSpec:x.transition,style:g,styleSpec:x});let k=p.valueSpec||M[C];if(!k)return[new r.m(h,E,`unknown property "${C}"`)];let N;if(r.n(E)==="string"&&r.q(k)&&!k.tokens&&(N=/^{([^}]+)}$/.exec(E))){let V=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new r.V(h,E,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}let B=[];if(p.layerType==="symbol")C!=="text-field"||!g||g.glyphs||g.imports||B.push(new r.V(h,E,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&r.H(r.v(E))&&r.u(E.type)==="identity"&&B.push(new r.V(h,E,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&s==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&r.q(k)&&(r.J(k)||r.r(k))){let V=r.x(r.v(E),k),G=V.value.expression||V.value._styleExpression.expression;G&&!r.A(G,["measure-light"])&&(C==="model-emissive-strength"&&r.B(G)&&r.z(G)||B.push(new r.V(h,E,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(U({key:p.key,value:E,valueSpec:k,style:g,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:C}))}function Bh(p){return wl(p,"paint")}function El(p){return wl(p,"layout")}function to(p){let s=[],h=p.value,g=p.key,v=p.style,x=p.styleSpec;h.type||h.ref||s.push(new r.V(g,h,'either "type" or "ref" is required'));let E=r.u(h.type),C=r.u(h.ref);if(h.id){let M=r.u(h.id);for(let P=0;P<p.arrayIndex;P++){let k=v.layers[P];r.u(k.id)===M&&s.push(new r.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${k.id.__line__}`))}}if("ref"in h){let M;["type","source","source-layer","filter","layout"].forEach(P=>{P in h&&s.push(new r.V(g,h[P],`"${P}" is prohibited for ref layers`))}),v.layers.forEach(P=>{r.u(P.id)===C&&(M=P)}),M?M.ref?s.push(new r.V(g,h.ref,"ref cannot reference another ref layer")):E=r.u(M.type):typeof C=="string"&&s.push(new r.V(g,h.ref,`ref layer "${C}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(h.source){let M=v.sources&&v.sources[h.source],P=M&&r.u(M.type);M?P==="vector"&&E==="raster"?s.push(new r.V(g,h.source,`layer "${h.id}" requires a raster source`)):P==="raster"&&E!=="raster"?s.push(new r.V(g,h.source,`layer "${h.id}" requires a vector source`)):P!=="vector"||h["source-layer"]?P==="raster-dem"&&E!=="hillshade"?s.push(new r.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(E)?E!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||P==="geojson"&&M.lineMetrics?E==="raster-particle"&&P!=="raster-array"&&s.push(new r.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):s.push(new r.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new r.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new r.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new r.V(g,h.source,`source "${h.source}" not found`))}else s.push(new r.V(g,h,'missing required property "source"'));return s=s.concat(mr({key:g,value:h,valueSpec:x.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>U({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:p.style,styleSpec:p.styleSpec,object:h,objectKey:"type"}),filter:M=>Ns(r.o({layerType:E},M)),layout:M=>mr({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>El(r.o({layerType:E},P))}}),paint:M=>mr({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>Bh(r.o({layerType:E,layer:h},P))}})}})),s}function zs(p){let s=p.value,h=p.key,g=r.n(s);return g!=="string"?[new r.V(h,s,`string expected, ${g} found`)]:[]}let no={promoteId:function({key:p,value:s}){if(r.n(s)==="string")return zs({key:p,value:s});{let h=[];for(let g in s)h.push(...zs({key:`${p}.${g}`,value:s[g]}));return h}}};function Xr(p){let s=p.value,h=p.key,g=p.styleSpec,v=p.style;if(!s.type)return[new r.V(h,s,'"type" is required')];let x=r.u(s.type),E=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||E.push(new r.m(h,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(mr({key:h,value:s,valueSpec:g[`source_${x.replace("-","_")}`],style:p.style,styleSpec:g,objectElementValidators:no})),E;case"geojson":if(E=mr({key:h,value:s,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:no}),s.cluster)for(let C in s.clusterProperties){let[M,P]=s.clusterProperties[C],k=typeof M=="string"?[M,["accumulated"],["get",C]]:M;E.push(...zo({key:`${h}.${C}.map`,value:P,expressionContext:"cluster-map"})),E.push(...zo({key:`${h}.${C}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return E;case"video":return mr({key:h,value:s,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return mr({key:h,value:s,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new r.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fs({key:`${h}.type`,value:s.type,valueSpec:{values:Vh(g)},style:v,styleSpec:g})}}function Vh(p){return p.source.reduce((s,h)=>{let g=p[h];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values))),s},[])}function Sa(p){let s=p.value,h=p.styleSpec,g=h.light,v=p.style,x=[],E=r.n(s);if(s===void 0)return x;if(E!=="object")return x=x.concat([new r.V("light",s,`object expected, ${E} found`)]),x;for(let C in s){let M=C.match(/^(.*)-transition$/);x=x.concat(M&&g[M[1]]&&g[M[1]].transition?U({key:C,value:s[C],valueSpec:h.transition,style:v,styleSpec:h}):g[C]?U({key:C,value:s[C],valueSpec:g[C],style:v,styleSpec:h}):[new r.V(C,s[C],`unknown property "${C}"`)])}return x}function Tl(p){let s=p.value,h=[];if(!s)return h;let g=r.n(s);if(g!=="object")return h=h.concat([new r.V("light-3d",s,`object expected, ${g} found`)]),h;let v=p.styleSpec,x=v["light-3d"],E=p.key,C=p.style,M=p.style.lights;for(let N of["type","id"])if(!(N in s))return h=h.concat([new r.V("light-3d",s,`missing property ${N} on light`)]),h;if(s.type&&M)for(let N=0;N<p.arrayIndex;N++){let B=r.u(s.type),V=M[N];r.u(V.type)===B&&h.push(new r.V(E,s.id,`duplicate light type "${s.type}", previously defined at line ${V.id.__line__}`))}let P=`properties_light_${s.type}`;if(!(P in v))return h=h.concat([new r.V("light-3d",s,`Invalid light type ${s.type}`)]),h;let k=v[P];for(let N in s)if(N==="properties"){let B=s[N],V=r.n(B);if(V!=="object")return h=h.concat([new r.V("properties",B,`object expected, ${V} found`)]),h;for(let G in B)h=h.concat(k[G]?U({key:G,value:B[G],valueSpec:k[G],style:C,styleSpec:v}):[new r.m(p.key,B[G],`unknown property "${G}"`)])}else{let B=N.match(/^(.*)-transition$/);h=h.concat(B&&x[B[1]]&&x[B[1]].transition?U({key:N,value:s[N],valueSpec:v.transition,style:C,styleSpec:v}):x[N]?U({key:N,value:s[N],valueSpec:x[N],style:C,styleSpec:v}):[new r.m(N,s[N],`unknown property "${N}"`)])}return h}function Kc(p){let s=p.value,h=p.key,g=p.style,v=p.styleSpec,x=v.terrain,E=[],C=r.n(s);if(s===void 0||C==="null")return E;if(C!=="object")return E=E.concat([new r.V("terrain",s,`object expected, ${C} found`)]),E;for(let M in s){let P=M.match(/^(.*)-transition$/);E=E.concat(P&&x[P[1]]&&x[P[1]].transition?U({key:M,value:s[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?U({key:M,value:s[M],valueSpec:x[M],style:g,styleSpec:v}):[new r.m(M,s[M],`unknown property "${M}"`)])}if(s.source){let M=g.sources&&g.sources[s.source],P=M&&r.u(M.type);M?P!=="raster-dem"&&E.push(new r.V(h,s.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):E.push(new r.V(h,s.source,`source "${s.source}" not found`))}else E.push(new r.V(h,s,'terrain is missing required property "source"'));return E}function Cl(p){let s=p.value,h=p.style,g=p.styleSpec,v=g.fog,x=[],E=r.n(s);if(s===void 0)return x;if(E!=="object")return x=x.concat([new r.V("fog",s,`object expected, ${E} found`)]),x;for(let C in s){let M=C.match(/^(.*)-transition$/);x=x.concat(M&&v[M[1]]&&v[M[1]].transition?U({key:C,value:s[C],valueSpec:g.transition,style:h,styleSpec:g}):v[C]?U({key:C,value:s[C],valueSpec:v[C],style:h,styleSpec:g}):[new r.m(C,s[C],`unknown property "${C}"`)])}return x}let ye={"*":()=>[],array:xl,boolean:function(p){let s=p.value,h=p.key,g=r.n(s);return g!=="boolean"?[new r.V(h,s,`boolean expected, ${g} found`)]:[]},number:Ca,color:function(p){let s=p.key,h=p.value,g=r.n(h);return g!=="string"?[new r.V(s,h,`color expected, ${g} found`)]:r.F(h)===null?[new r.V(s,h,`color expected, "${h}" found`)]:[]},enum:Fs,filter:Ns,function:No,layer:to,object:mr,source:Xr,model:r.K,light:Sa,"light-3d":Tl,terrain:Kc,fog:Cl,string:zs,formatted:function(p){return zs(p).length===0?[]:zo(p)},resolvedImage:function(p){return zs(p).length===0?[]:zo(p)},projection:function(p){let s=p.value,h=p.styleSpec,g=h.projection,v=p.style,x=[],E=r.n(s);if(E==="object")for(let C in s)x=x.concat(U({key:C,value:s[C],valueSpec:g[C],style:v,styleSpec:h}));else E!=="string"&&(x=x.concat([new r.V("projection",s,`object or string expected, ${E} found`)]));return x},import:function(p){let{value:s,styleSpec:h}=p,E=s,{data:g}=E,v=Ko(E,["data"]);Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let x=mr(r.o({},p,{value:v,valueSpec:h.import}));return r.u(v.id)===""&&x.push(new r.V(`${p.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(oe(g,h,{key:`${p.key}.data`}))),x}};function U(p,s=!1){let h=p.value,g=p.valueSpec,v=p.styleSpec;if(g.expression&&r.H(r.u(h)))return No(p);if(g.expression&&r.t(r.v(h)))return zo(p);if(g.type&&ye[g.type]){let x=ye[g.type](p);return s===!0&&x.length>0&&r.n(p.value)==="array"?zo(p):x}return mr(r.o({},p,{valueSpec:g.type?v[g.type]:g}))}function Z(p){let s=p.value,h=p.key,g=zs(p);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new r.V(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new r.V(h,s,'"glyphs" url must include a "{range}" token'))),g}function oe(p,s=r.L,h={}){return U({key:h.key||"",value:p,valueSpec:s.$root,styleSpec:s,style:p,objectElementValidators:{glyphs:Z,"*":()=>[]}})}function de(p,s=r.L){return en(oe(p,s))}let fe=p=>en(Xr(p)),we=p=>en(Sa(p)),Ae=p=>en(Tl(p)),ve=p=>en(Kc(p)),Pe=p=>en(Cl(p)),rt=p=>en(to(p)),Ke=p=>en(Ns(p)),_t=p=>en(Bh(p)),Mt=p=>en(El(p)),Kt=p=>en(r.K(p));function en(p){return p.slice().sort((s,h)=>s.line&&h.line?s.line-h.line:0)}function jt(p,s){let h=!1;if(s&&s.length)for(let g of s)g instanceof r.m?r.w(g.message):(p.fire(new r.d(new Error(g.message))),h=!0);return h}let an=new r.N({anchor:new r.O(r.L.light.anchor),position:new r.Q(r.L.light.position),color:new r.O(r.L.light.color),intensity:new r.O(r.L.light.intensity)});class mt extends r.E{constructor(s,h="flat"){super(),this._transitionable=new r.U(an),this.setLight(s,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h,g={}){this._validate(we,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=h)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&jt(this,s.call(de,r.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}let tr=new r.N({source:new r.O(r.L.terrain.source),exaggeration:new r.O(r.L.terrain.exaggeration)}),Ln=class extends r.E{constructor(p,s,h,g){super(),this.scope=h,this._transitionable=new r.U(tr,h,g),this._transitionable.setTransitionOrValue(p,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(p,s){this._transitionable.setTransitionOrValue(p,s)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.X(p)).get("exaggeration")}isZoomDependent(){let p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.Z}},fn=45,br=65,nr=.05;function Ar(p,s,h,g){let v=r.$(fn,br,h),[x,E]=oi(p,g),C=1-Math.min(1,Math.exp((s-x)/(E-x)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*v*p.alpha}function oi(p,s){let h=.5/Math.tan(.5*s);return[p.range[0]+h,p.range[1]+h]}function si(p,s,h,g,v){let x=r._.transformMat4([],[s,h,g],v.mercatorFogMatrix);return Ar(p,r._.length(x),v.pitch,v._fov)}function Ia(p,s,h,g,v,x,E){let C=[[h,g,0],[v,g,0],[v,x,0],[h,x,0]],M=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let k of C){let N=r._.transformMat4([],k,s),B=r._.length(N);M=Math.min(M,B),P=Math.max(P,B)}return[Ar(p,M,E.pitch,E._fov),Ar(p,P,E.pitch,E._fov)]}let rp=new r.N({range:new r.O(r.L.fog.range),color:new r.O(r.L.fog.color),"high-color":new r.O(r.L.fog["high-color"]),"space-color":new r.O(r.L.fog["space-color"]),"horizon-blend":new r.O(r.L.fog["horizon-blend"]),"star-intensity":new r.O(r.L.fog["star-intensity"]),"vertical-range":new r.O(r.L.fog["vertical-range"])});class w_ extends r.E{constructor(s,h,g,v){super(),this._transitionable=new r.U(rp,g,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new r.a0(rp),this.scope=g}get state(){let s=this._transform,h=s.projection.name==="globe",g=r.a1(s.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[r.a2(x[0],v[0],g),r.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h,g={}){if(this._validate(Pe,s,g))return;let v=r.W({},s);for(let x of Object.keys(r.L.fog))v[x]===void 0&&(v[x]=r.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.$(fn,br,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,v,x){let E=r.Y.fromLngLat(v),C=x.elevation?x.elevation.getAtPointOrZero(E):0;return si(g,E.x,E.y,C,x)}(this.state,s,h):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Ia(this.state,h,0,0,r.a3,r.a3,this._transform)}getOpacityForBounds(s,h,g,v,x){return this._transform.projection.supportsFog?Ia(this.state,s,h,g,v,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?oi(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let g of h){let v=s.points[g],x;if(v[2]>=0)x=v;else{let E=s.points[g-4];x=r.a4(E,v,E[2]/(E[2]-v[2]))}if(si(this.state,x[0],x[1],0,this._transform)>=nr)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&jt(this,s.call(de,r.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}class Qc extends r.E{constructor(s,h,g,v){super(),this.scope=g,this._options=s,this.properties=new r.a0(h),this._transitionable=new r.U(h,g,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,h){this._options=s,this._transitionable.setTransitionOrValue(s.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Zt=new r.N({color:new r.O(r.L.properties_light_ambient.color),intensity:new r.O(r.L.properties_light_ambient.intensity)}),ip=new r.N({direction:new r.a5(r.L.properties_light_directional.direction),color:new r.O(r.L.properties_light_directional.color),intensity:new r.O(r.L.properties_light_directional.intensity),"cast-shadows":new r.O(r.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.O(r.L.properties_light_directional["shadow-intensity"])});var Bs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,op=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,sp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ap="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",lp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,cp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,up=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,hp=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,dp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,fp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,E_=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Sl=[];Il(Bs,Sl),Il(sp,Sl),Il(op,Sl);let jh={"_prelude_fog.vertex.glsl":cp,"_prelude_terrain.vertex.glsl":lp,"_prelude_shadow.vertex.glsl":fp,"_prelude_fog.fragment.glsl":up,"_prelude_shadow.fragment.glsl":E_,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":hp,"_prelude_raster_particle.glsl":dp},Uh={};rn("",lp),rn(up,cp),rn(E_,fp),rn(hp,""),rn(dp,"");let T_=rn(op,sp),C_=Bs;var S_={background:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:rn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:rn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:rn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:rn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:rn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:rn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:rn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:rn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:rn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:rn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:rn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:rn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:rn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:rn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:rn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:rn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ap),skyboxGradient:rn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ap),skyboxCapture:rn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:rn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:rn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:rn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Il(p,s){let h=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)s.includes(x)||s.push(x)}}function rn(p,s){let h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(P=>{let k=P.split(" ");return k[k.length-1]}),v=[...new Set(v)]);let x={},E=[],C=[];if(p=p.replace(h,(P,k)=>(C.push(k),"")),(s=s.replace(h,(P,k)=>(E.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...Sl];Il(p,M),Il(s,M);for(let P of[...E,...C])jh[P]||console.error(`Undefined include: ${P}`),Uh[P]||(Uh[P]=[],Il(jh[P],Uh[P])),M=[...M,...Uh[P]];return{fragmentSource:p=p.replace(g,(P,k,N,B,V)=>(x[V]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = u_${V};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} ${V};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(g,(P,k,N,B,V)=>{let G=B==="float"?"vec2":B,H=V.match(/color/)?"color":G;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${N} ${B} a_${V};
#endif
`:x[V]?k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
out ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} a_${V};
    out ${N} ${B} ${V};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${N} ${B} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${N} ${B} ${V} = a_${V};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:v,usedDefines:M,vertexIncludes:E,fragmentIncludes:C}}class u1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,v,x,E,C,M){this.context=s;let P=this.boundPaintVertexBuffers.length!==v.length;for(let N=0;!P&&N<v.length;N++)this.boundPaintVertexBuffers[N]!==v[N]&&(P=!0);let k=this.boundDynamicVertexBuffers.length!==C.length;for(let N=0;!k&&N<C.length;N++)this.boundDynamicVertexBuffers[N]!==C[N]&&(k=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||P||k||this.boundIndexBuffer!==x||this.boundVertexOffset!==E)this.freshBind(h,g,v,x,E,C,M);else{s.bindVertexArrayOES.set(this.vao);for(let N of C)N&&(N.bind(),M&&N.instanceCount&&N.setVertexAttribDivisor(s.gl,h,M));x&&x.dynamicDraw&&x.bind()}}freshBind(s,h,g,v,x,E,C){let M=s.numAttributes,P=this.context,k=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=E,h.enableAttributes(k,s),h.bind(),h.setVertexAttribPointers(k,s,x);for(let N of g)N.enableAttributes(k,s),N.bind(),N.setVertexAttribPointers(k,s,x);for(let N of E)N&&(N.enableAttributes(k,s),N.bind(),N.setVertexAttribPointers(k,s,x),C&&N.instanceCount&&N.setVertexAttribDivisor(k,s,C));v&&v.bind(),P.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function h1(p,s){let h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new r.Y(0,g/h).toLngLat().lat,new r.Y(0,(g+1)/h).toLngLat().lat]}function d1(p,s,h,g,v,x,E){let C=p.context,M=C.gl,P=h.hillshadeFBO;if(!P)return;p.prepareDrawTile();let k=p.isTileAffectedByFog(s),N=p.getOrCreateProgram("hillshade",{overrideFog:k});C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get());let B=((q,W,ee,te)=>{let ne=ee.paint.get("hillshade-shadow-color"),ue=ee.paint.get("hillshade-highlight-color"),ce=ee.paint.get("hillshade-accent-color"),J=ee.paint.get("hillshade-emissive-strength"),re=r.ab(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")re-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let ge=q.style.directionalLight.properties.get("direction"),Ce=r.ac(ge.x,ge.y,ge.z);re=r.ab(Ce[1])}let ie=!q.options.moving;return{u_matrix:te||q.transform.calculateProjMatrix(W.tileID.toUnwrapped(),ie),u_image:0,u_latrange:h1(0,W.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),re],u_shadow:ne.toRenderColor(ee.lut),u_highlight:ue.toRenderColor(ee.lut),u_emissive_strength:J,u_accent:ce.toRenderColor(ee.lut)}})(p,h,g,p.terrain?s.projMatrix:null);p.uploadCommonUniforms(C,N,s.toUnwrapped());let{tileBoundsBuffer:V,tileBoundsIndexBuffer:G,tileBoundsSegments:H}=p.getTileBoundsBuffers(h);N.draw(p,M.TRIANGLES,v,x,E,r.af.disabled,B,g.id,V,G,H)}function pp(p,s,h){if(!s.needsDEMTextureUpload)return;let g=p.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(h.stride);let x=h.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new r.T(g,x,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Bo(p,s,h){let g=p.context,v=g.gl;if(!s.dem)return;let x=s.dem;if(g.activeTexture.set(v.TEXTURE1),pp(p,s,x),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let E=x.dim;g.activeTexture.set(v.TEXTURE0);let C=s.hillshadeFBO;if(!C){let B=new r.T(g,{width:E,height:E,data:null},v.RGBA);B.bind(v.LINEAR,v.CLAMP_TO_EDGE),C=s.hillshadeFBO=g.createFramebuffer(E,E,!0,"renderbuffer"),C.colorAttachment.set(B.texture)}g.bindFramebuffer.set(C.framebuffer),g.viewport.set([0,0,E,E]);let{tileBoundsBuffer:M,tileBoundsIndexBuffer:P,tileBoundsSegments:k}=p.getMercatorTileBoundsBuffers(),N=[];p.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(p,v.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,((B,V)=>{let G=V.stride,H=r.ad.create();return r.ad.ortho(H,0,r.a3,-r.a3,0,0,1),r.ad.translate(H,H,[0,-r.a3,0]),{u_matrix:H,u_image:1,u_dimension:[G,G],u_zoom:B.overscaledZ}})(s.tileID,x),h.id,M,P,k),s.needsHillshadePrepare=!1}function mp(p,s,h,g,v){let x=function(E,C){if(E)return v(E);if(C){if(p.url&&C.tiles&&p.tiles&&delete p.tiles,C.variants){if(!Array.isArray(C.variants))return v(new Error("variants must be an array"));for(let P of C.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return v(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){C=r.W(C,P);break}}}let M=r.ah(r.W(C,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(M.vectorLayers=C.vector_layers,M.vectorLayerIds=M.vectorLayers.map(P=>P.id)),C.raster_layers&&(M.rasterLayers=C.raster_layers,M.rasterLayerIds=M.rasterLayers.map(P=>P.id)),M.tiles=s.canonicalizeTileset(M,p.url),v(null,M)}};return p.url?r.g(s.transformRequest(s.normalizeSourceURL(p.url,null,h,g),r.R.Source),x):r.e.frame(()=>x(null,p))}class Jc{constructor(s,h,g){this.bounds=r.ai.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){let h=Math.pow(2,s.z),g=Math.floor(r.aj(this.bounds.getWest())*h),v=Math.floor(r.ak(this.bounds.getNorth())*h),x=Math.ceil(r.aj(this.bounds.getEast())*h),E=Math.ceil(r.ak(this.bounds.getSouth())*h);return s.x>=g&&s.x<x&&s.y>=v&&s.y<E}}class eu extends r.E{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.W({type:"raster"},h),r.W(this,r.ah(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._tileJSONRequest=mp(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new r.d(h)):g&&(r.W(this,g),g.bounds&&(this.tileBounds=new Jc(g.bounds,this.minzoom,this.maxzoom)),r.an(g.tiles),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){let g=r.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=r.h(this.map._requestManager.transformRequest(v,r.R.Tile),(x,E,C,M)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):x?(s.state="errored",h(x)):E?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:M}),s.setTexture(E,this.map.painter),s.state="loaded",r.am(this.dispatcher),void h(null)):h(null)))}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h&&h()}unloadTile(s,h){s.texture&&s.texture instanceof r.T?(s.destroy(!0),s.texture&&s.texture instanceof r.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $h extends r.E{constructor(s,h,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.W(this,r.ah(h,["url","scheme","tileSize","promoteId"])),this._options=r.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.ao}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=mp(this._options,this.map._requestManager,h,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new r.d(v))):x&&(r.W(this,x),x.bounds&&(this.tileBounds=new Jc(x.bounds,this.minzoom,this.maxzoom)),r.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,E={request:v,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(E.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",E,C.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",E,C.bind(this),void 0,!0);else{let M=r.ap.call({deduped:this._deduped},E,(P,k)=>{P||!k?C.call(this,P):(E.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},s.actor&&s.actor.send("loadTile",E,C.bind(this),void 0,!0))},!0);s.request={cancel:M}}function C(M,P){return delete s.request,s.aborted?h(null):M&&M.status!==404?h(M):(P&&P.resourceTiming&&(s.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&s.setExpiryData(P),s.loadVectorData(P,this.map.painter),r.am(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Da=p=>({u_matrix:new r.a6(p),u_image0:new r.a7(p),u_skirt_height:new r.aa(p),u_ground_shadow_factor:new r.aq(p)}),lt=(p,s,h)=>({u_matrix:p,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:h}),I_=(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:E,u_frustum_tr:C,u_frustum_br:M,u_frustum_bl:P,u_globe_pos:k,u_globe_radius:N,u_viewport:B,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:G});class tu{constructor(s=0,h=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=v}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=r.a2(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=r.a2(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=r.a2(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=r.a2(s.right,h.right,g)),this}getCenter(s,h){let g=r.at((this.left+s-this.right)/2,0,s),v=r.at((this.top+h-this.bottom)/2,0,h);return new r.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new tu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ln(p,s){let h=r.aw(p,3);r.ad.fromQuat(p,s),r.az(p,3,h)}function ai(p,s){let h=r.av.identity([]);return r.av.rotateZ(h,h,-s),r.av.rotateX(h,h,-p),h}function D_(p,s){let h=[p[0],p[1],0],g=[s[0],s[1],0];if(r._.length(h)>=1e-15){let E=r._.normalize([],h);r._.scale(g,E,r._.dot(g,E)),s[0]=g[0],s[1]=g[1]}let v=r._.cross([],s,p);if(r._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return ai(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),x)}class gp{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){let h=s instanceof r.Y?s:new r.Y(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=r.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.Y.fromLngLat(s)):0,x=r.Y.fromLngLat(s,v),E=[x.x-g.x,x.y-g.y,x.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=D_(E,h)}setPitchBearing(s,h){this.orientation=ai(r.ab(s),r.ab(-h))}}class nu{constructor(s,h){this._transform=r.ad.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){let s=this.position;return new r.Y(s[0],s[1],s[2])}get position(){let s=r.aw(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&r.az(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||r.av.identity([]),s&&ln(this._transform,this._orientation)}getPitchBearing(){let s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=ai(s,h),ln(this._transform,this._orientation)}forward(){let s=r.aw(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){let s=r.aw(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){let s=r.aw(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){let g=new Float64Array(16);return r.ad.invert(g,this.getWorldToCamera(s,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,h,g){let v=this.position;r._.scale(v,v,-s);let x=new Float64Array(16);return r.ad.fromScaling(x,[g,g,g]),r.ad.translate(x,x,v),x[10]*=h,x}getWorldToCamera(s,h){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return r.av.conjugate(v,this._orientation),r._.scale(x,x,-s),r.ad.fromQuat(g,v),r.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,v){let x=new Float64Array(16);return r.ad.perspective(x,s,h,g,v),x}getCameraToClipOrthographic(s,h,g,v,x,E){let C=new Float64Array(16);return r.ad.ortho(C,s,h,g,v,x,E),C}getDistanceToElevation(s,h=!1){let g=s===0?0:r.ax(s,h?r.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new nu([...this.position],[...this.orientation])}}let Dl={unknown:0,flipRequired:1,flipNotRequired:2},Qt=Math.tan(85*Math.PI/180);function Ma(p,s,h,g,v,x,E){let C=r.ad.create();if(h)if(x.name==="globe"){let M=r.aB(v,s);r.ad.multiply(C,C,M)}else{let M=r.aC.invert([],E);C[0]=M[0],C[1]=M[1],C[4]=M[2],C[5]=M[3],g||r.ad.rotateZ(C,C,v.angle)}else r.ad.multiply(C,v.labelPlaneMatrix,p);return C}function Aa(p,s,h,g,v,x,E){let C=Ma(p,s,h,g,v,x,E);return x.name==="globe"&&h||(C[2]=C[6]=C[10]=C[14]=0),C}function Ml(p,s,h,g,v,x,E){if(h){if(x.name==="globe"){let C=Ma(p,s,h,g,v,x,E);return r.ad.invert(C,C),r.ad.multiply(C,p,C),C}{let C=r.ad.clone(p),M=r.ad.identity([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],r.ad.multiply(C,C,M),g||r.ad.rotateZ(C,C,-v.angle),C}}return v.glCoordMatrix}function ro(p,s,h,g){let v=[p,s,h,1];h?r.aA.transformMat4(v,v,g):Vo(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function li(p,s){return Math.min(.5+p/s*.5,1.5)}function f1(p,s){let h=p[0]/p[3],g=p[1]/p[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function Gh(p,s,h,g,v,x,E,C,M,P){let k=h.transform,N=g?p.textSizeData:p.iconSizeData,B=r.aD(N,h.transform.zoom),V=k.projection.name==="globe",G=[256/h.width*2+1,256/h.height*2+1],H=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;H.clear();let q=null;V&&(q=g?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);let W=p.lineVertexArray,ee=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,te=h.transform.width/h.transform.height,ne,ue=!1;for(let ce=0;ce<ee.length;ce++){let J=ee.get(ce),{numGlyphs:re,writingMode:ie}=J;if(ie!==r.aE.vertical||ue||ne===r.aE.horizontal||(ue=!0),ne=ie,(J.hidden||ie===r.aE.vertical)&&!ue){Pa(re,H);continue}ue=!1;let ge=new r.P(J.tileAnchorX,J.tileAnchorY),{x:Ce,y:ae,z:Se}=k.projection.projectTilePoint(ge.x,ge.y,P.canonical);if(M){let[at,je,He]=M(ge);Ce+=at,ae+=je,Se+=He}let Me=[Ce,ae,Se,1];if(r.aA.transformMat4(Me,Me,s),!f1(Me,G)){Pa(re,H);continue}let $e=Me[3],Ge=li(h.transform.getCameraToCenterDistance(k.projection),$e),Ve=r.aF(N,B,J),xe=E?Ve/Ge:Ve*Ge,Re=ro(Ce,ae,Se,v);if(Re[3]<=0){Pa(re,H);continue}let Fe={},ot=E?null:M,ct=yp(J,xe,!1,C,s,v,x,p.glyphOffsetArray,W,H,q,Re,ge,Fe,te,ot,k.projection,P,E);ue=ct.useVertical,ot&&ct.needsFlipping&&(Fe={}),(ct.notEnoughRoom||ue||ct.needsFlipping&&yp(J,xe,!0,C,s,v,x,p.glyphOffsetArray,W,H,q,Re,ge,Fe,te,ot,k.projection,P,E).notEnoughRoom)&&Pa(re,H)}g?(p.text.dynamicLayoutVertexBuffer.updateData(H),q&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(q)):(p.icon.dynamicLayoutVertexBuffer.updateData(H),q&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(q))}function Hh(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H){let{lineStartIndex:q,glyphStartIndex:W,segment:ee}=C,te=W+C.numGlyphs,ne=q+C.lineLength,ue=s.getoffsetX(W),ce=s.getoffsetX(te-1),J=Al(p*ue,h,g,v,x,E,ee,q,ne,M,P,k,N,B,!0,V,G,H);if(!J)return null;let re=Al(p*ce,h,g,v,x,E,ee,q,ne,M,P,k,N,B,!0,V,G,H);return re?{first:J,last:re}:null}function _p(p,s,h,g){return p===r.aE.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:p===r.aE.vertical?g>0?{needsFlipping:!0}:null:s!==Dl.unknown&&function(v,x){return v===0||Math.abs(x/v)>Qt}(h,g)?s===Dl.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function yp(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q,W,ee){let te=s/24,ne=p.lineOffsetX*te,ue=p.lineOffsetY*te,{lineStartIndex:ce,glyphStartIndex:J,numGlyphs:re,segment:ie,writingMode:ge,flipState:Ce}=p,ae=ce+p.lineLength,Se=Me=>{if(k){let[xe,Re,Fe]=Me.up,ot=P.length;r.aG(k,ot+0,xe,Re,Fe),r.aG(k,ot+1,xe,Re,Fe),r.aG(k,ot+2,xe,Re,Fe),r.aG(k,ot+3,xe,Re,Fe)}let[$e,Ge,Ve]=Me.point;r.aH(P,$e,Ge,Ve,Me.angle)};if(re>1){let Me=Hh(te,C,ne,ue,h,N,B,p,M,x,V,H,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};if(g&&!h){let[$e,Ge,Ve]=Me.first.point,[xe,Re,Fe]=Me.last.point;[$e,Ge]=ro($e,Ge,Ve,E),[xe,Re]=ro(xe,Re,Fe,E);let ot=_p(ge,Ce,(xe-$e)*G,Re-Ge);if(p.flipState=ot&&ot.needsFlipping?Dl.flipRequired:Dl.flipNotRequired,ot)return ot}Se(Me.first);for(let $e=J+1;$e<J+re-1;$e++){let Ge=Al(te*C.getoffsetX($e),ne,ue,h,N,B,ie,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Ge)return P.length-=4*($e-J),{notEnoughRoom:!0};Se(Ge)}Se(Me.last)}else{if(g&&!h){let $e=ro(B.x,B.y,0,v),Ge=ce+ie+1,Ve=new r.P(M.getx(Ge),M.gety(Ge)),xe=ro(Ve.x,Ve.y,0,v),Re=xe[3]>0?xe:ru(B,Ve,$e,1,v,void 0,q,W.canonical),Fe=_p(ge,Ce,(Re[0]-$e[0])*G,Re[1]-$e[1]);if(p.flipState=Fe&&Fe.needsFlipping?Dl.flipRequired:Dl.flipNotRequired,Fe)return Fe}let Me=Al(te*C.getoffsetX(J),ne,ue,h,N,B,ie,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};Se(Me)}return{}}function qh(p,s,h,g,v){let{x,y:E,z:C}=g.projectTilePoint(p.x,p.y,s);if(!v)return ro(x,E,C,h);let[M,P,k]=v(p);return ro(x+M,E+P,C+k,h)}function ru(p,s,h,g,v,x,E,C){let M=qh(p.sub(s)._unit()._add(p),C,v,E,x);return r._.sub(M,h,M),r._.normalize(M,M),r._.scaleAndAdd(M,h,M,g)}function Al(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q,W){let ee=g?p-s:p+s,te=ee>0?1:-1,ne=0;g&&(te*=-1,ne=Math.PI),te<0&&(ne+=Math.PI);let ue=C+E+(te>0?0:1)|0,ce=v,J=v,re=0,ie=0,ge=Math.abs(ee),Ce=[],ae=[],Se=x,Me=Se,$e=()=>ru(Me,Se,J,ge-re+1,k,B,H,q.canonical);for(;re+ie<=ge;){if(ue+=te,ue<C||ue>=M)return null;if(J=ce,Me=Se,Ce.push(J),V&&ae.push(Me),Se=new r.P(P.getx(ue),P.gety(ue)),ce=N[ue],!ce){let je=qh(Se,q.canonical,k,H,B);ce=je[3]>0?N[ue]=je:$e()}re+=ie,ie=r._.distance(J,ce)}G&&B&&(N[ue]&&(ce=$e(),ie=r._.distance(J,ce)),N[ue]=ce);let Ge=(ge-re)/ie,Ve=Se.sub(Me)._mult(Ge)._add(Me),xe=r._.sub([],ce,J),Re=r._.scaleAndAdd([],J,xe,Ge),Fe=[0,0,1],ot=xe[0],ct=xe[1];if(W&&(Fe=H.upVector(q.canonical,Ve.x,Ve.y),Fe[0]!==0||Fe[1]!==0||Fe[2]!==1)){let je=[Fe[2],0,-Fe[0]],He=r._.cross([],Fe,je);r._.normalize(je,je),r._.normalize(He,He),ot=r._.dot(xe,je),ct=r._.dot(xe,He)}if(h){let je=r._.cross([],Fe,xe);r._.normalize(je,je),r._.scaleAndAdd(Re,Re,je,h*te)}let at=ne+Math.atan2(ct,ot);return Ce.push(Re),V&&ae.push(Ve),{point:Re,angle:at,path:Ce,tilePath:ae,up:Fe}}function Pa(p,s){let h=s.length,g=h+4*p;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function Vo(p,s,h){let g=s[0],v=s[1];return p[0]=h[0]*g+h[4]*v+h[12],p[1]=h[1]*g+h[5]*v+h[13],p[3]=h[3]*g+h[7]*v+h[15],p}let vp=(p,s,h)=>(1-h)*p+h*s,wr=p=>p*p*p*p*p;class jo{constructor(s,h,g,v,x,E,C){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new r.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new tu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new nu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let s=new jo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,h=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return r.ah(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=r.aJ(this.projectionOptions);let g=!w(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){let s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.aJ({name:"mercator"});let h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.au(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){let h=-s*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=r.aC.create(),r.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){let h=r.at(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=r.ab(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){let h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){let s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let E=0;E<h.length;E++){let C=new r.P(h[E][0]*this.width,g+h[E][1]*(this.height-g)),M=s.pointCoordinate(C);if(!M)continue;let P=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);v+=M[3]*P,x+=P}return x===0?NaN:v/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude())),g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];let v=r._.length(r._.sub([],this._camera.position,g));return r.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!r.av.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){let g=[s.position.x,s.position.y,s.position.z];r._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let s=this._camera.position,h=new gp;return h.position=new r.Y(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!r.av.length(s))return!1;r.av.normalize(s,s);let h=r._.transformQuat([],[0,0,-1],s),g=r._.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;let v=D_(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){let h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=r.at(s[2],v/g,v/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){let h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){let h=[new r.aK(0,s)];if(this.renderWorldCopies){let g=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),E=this.pointCoordinate(new r.P(0,this.height)),C=Math.floor(Math.min(g.x,v.x,x.x,E.x)),M=Math.floor(Math.max(g.x,v.x,x.x,E.x)),P=1;for(let k=C-P;k<=M+P;k++)k!==0&&h.push(new r.aK(k,s))}return h}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(s,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(let E of s){let C=E.canonical,M=E.overscaledZ,P=E.wrap,k=1<<C.z,N=C.x+1<k,B=C.x>0,V=C.y+1<k,G=C.y>0,H=E.wrap-(B?0:1),q=E.wrap+(N?0:1),W=B?C.x-1:k-1,ee=N?C.x+1:0;h[0]<0?(v.push(new r.aL(M,q,C.z,ee,C.y)),h[1]<0&&V&&(v.push(new r.aL(M,P,C.z,C.x,C.y+1)),v.push(new r.aL(M,q,C.z,ee,C.y+1))),h[1]>0&&G&&(v.push(new r.aL(M,P,C.z,C.x,C.y-1)),v.push(new r.aL(M,q,C.z,ee,C.y-1)))):h[0]>0?(v.push(new r.aL(M,H,C.z,W,C.y)),h[1]<0&&V&&(v.push(new r.aL(M,P,C.z,C.x,C.y+1)),v.push(new r.aL(M,H,C.z,W,C.y+1))),h[1]>0&&G&&(v.push(new r.aL(M,P,C.z,C.x,C.y-1)),v.push(new r.aL(M,H,C.z,W,C.y-1)))):h[1]<0&&V?v.push(new r.aL(M,P,C.z,C.x,C.y+1)):G&&v.push(new r.aL(M,P,C.z,C.x,C.y-1))}if(v.length>1){v.sort((M,P)=>M.overscaledZ-P.overscaledZ||M.wrap-P.wrap||M.canonical.z-P.canonical.z||M.canonical.x-P.canonical.x||M.canonical.y-P.canonical.y);let E=0,C=0;for(;C<v.length;)v[C].equals(v[E])?++C:v[++E]=v[C++];v.length=E+1}let x=[];for(let E of v)v.some(C=>E.isChildOf(C))||x.push(E);return v=x.filter(E=>!s.some(C=>!!(E.overscaledZ<g&&C.isChildOf(E))||E.equals(C)||E.isChildOf(C))),v}coveringTiles(s){let h=this.coveringZoomLevel(s),g=h,v=this.elevation&&this.elevation.exaggeration(),x=v&&!s.isTerrainDEM,E=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);let C=this.locationCoordinate(this.center),M=this.center.lat,P=1<<h,k=[P*C.x,P*C.y,0],N=this.projection.name==="globe",B=!N,V=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,B),G=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=P*r.ax(1,this.center.lat),q=this._camera.position[2]/r.ax(1,this.center.lat),W=[P*G.x,P*G.y,q*(B?1:H)],ee=N||v,te=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ne=this.isLODDisabled(!0)?h:0,ue;if(this._elevation&&s.isTerrainDEM)ue=1e4*this._elevation.exaggeration();else if(this._elevation){let xe=this._elevation.getMinMaxForVisibleTiles();ue=xe?xe.max:this._centerAltitude}else ue=this._centerAltitude;let ce=s.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,J=this.projection.isReprojectedInTileSpace?r.aN(this):1,re=xe=>{let Fe=new r.Y(xe.x+25e-6,xe.y,xe.z),ot=new r.Y(xe.x,xe.y+25e-6,xe.z),ct=xe.toLngLat(),at=Fe.toLngLat(),je=ot.toLngLat(),He=this.locationCoordinate(ct),st=this.locationCoordinate(at),pt=this.locationCoordinate(je),Ot=Math.hypot(st.x-He.x,st.y-He.y),$t=Math.hypot(pt.x-He.x,pt.y-He.y);return Math.sqrt(Ot*$t)*J/25e-6},ie=xe=>{let Re=ue,Fe=ce;return{aabb:r.aQ(this,P,0,0,0,xe,Fe,Re,this.projection),zoom:0,x:0,y:0,minZ:Fe,maxZ:Re,wrap:xe,fullyVisible:!1}},ge=[],Ce=[],ae=h,Se=s.reparseOverscaled?g:h,Me=xe=>xe*xe,$e=Me((q-this._centerAltitude)*H),Ge=xe=>{if(!this._elevation||!xe.tileID||!E)return;let Re=this._elevation.getMinMaxForTile(xe.tileID),Fe=xe.aabb;Re?(Fe.min[2]=Re.min,Fe.max[2]=Re.max,Fe.center[2]=(Fe.min[2]+Fe.max[2])/2):(xe.shouldSplit=Ve(xe),xe.shouldSplit||(Fe.min[2]=Fe.max[2]=Fe.center[2]=this._centerAltitude))},Ve=xe=>{if(xe.zoom<ne)return!0;if(xe.zoom===ae)return!1;if(xe.shouldSplit!=null)return xe.shouldSplit;let Re=xe.aabb.distanceX(W),Fe=xe.aabb.distanceY(W),ot=$e,ct=1;if(N){ot=Me(xe.aabb.distanceZ(W));let He=Math.pow(2,xe.zoom),st=r.ay((xe.y+1)/He),pt=r.ay(xe.y/He),Ot=Math.min(Math.max(M,st),pt),$t=r.b4(Ot)/r.b4(M);if(ct=Ot===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,$t/this._mercatorScaleRatio),this.zoom<=r.b1&&xe.zoom===ae-1&&$t>=.9)return!0}else if(x&&(ot=Me(xe.aabb.distanceZ(W)*H)),this.projection.isReprojectedInTileSpace&&g<=5){let He=Math.pow(2,xe.zoom),st=re(new r.Y((xe.x+.5)/He,(xe.y+.5)/He));ct=st>.85?1:st}let at=Re*Re+Fe*Fe+ot,je=Me((1<<ae-xe.zoom)*te*ct*((He,st)=>{if(st*Me(.707)<He)return 1;let pt=Math.sqrt(st/He);return pt/(1.4144271570014144+(Math.pow(1.1,pt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ot,$e),at));return at<je};if(this.renderWorldCopies)for(let xe=1;xe<=3;xe++)ge.push(ie(-xe)),ge.push(ie(xe));for(ge.push(ie(0));ge.length>0;){let xe=ge.pop(),Re=xe.x,Fe=xe.y,ot=xe.fullyVisible,ct=()=>this.projection.name==="globe"&&(xe.y===0||xe.y===(1<<xe.zoom)-1);if(!ot){let at=ee?xe.aabb.intersects(V):xe.aabb.intersectsFlat(V);if(at===0&&ct()){let je=new r.aO(xe.zoom,Re,Fe);at=r.aP(this,P,je,!0).intersects(V)}if(at===0)continue;ot=at===2}if(xe.zoom!==ae&&Ve(xe))for(let at=0;at<4;at++){let je=(Re<<1)+at%2,He=(Fe<<1)+(at>>1),st={aabb:E?xe.aabb.quadrant(at):r.aQ(this,P,xe.zoom+1,je,He,xe.wrap,xe.minZ,xe.maxZ,this.projection),zoom:xe.zoom+1,x:je,y:He,wrap:xe.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:xe.minZ,maxZ:xe.maxZ};x&&!N&&(st.tileID=new r.aL(xe.zoom+1===ae?Se:xe.zoom+1,xe.wrap,xe.zoom+1,je,He),Ge(st)),ge.push(st)}else{let at=xe.zoom===ae?Se:xe.zoom;if(s.minzoom&&s.minzoom>at)continue;if(!ot){let pt=ee?xe.aabb.intersectsPrecise(V):xe.aabb.intersectsPreciseFlat(V);if(pt===0&&ct()){let Ot=new r.aO(xe.zoom,Re,Fe);pt=r.aP(this,P,Ot,!0).intersectsPrecise(V)}if(pt===0)continue}let je=k[0]-(.5+Re+(xe.wrap<<xe.zoom))*(1<<h-xe.zoom),He=k[1]-.5-Fe,st=xe.tileID?xe.tileID:new r.aL(at,xe.wrap,xe.zoom,Re,Fe);Ce.push({tileID:st,distanceSq:je*je+He*He})}}if(this.fogCullDistSq){let xe=this.fogCullDistSq,Re=this.horizonLineFromTop();Ce=Ce.filter(Fe=>{let ot=[0,0,0,1],ct=[r.a3,r.a3,0,1],at=this.calculateFogTileMatrix(Fe.tileID.toUnwrapped());r.aA.transformMat4(ot,ot,at),r.aA.transformMat4(ct,ct,at);let je=r.aA.min([],ot,ct),He=r.aA.max([],ot,ct),st=r.aR(je,He);if(st===0)return!0;let pt=!1,Ot=this._elevation;if(Ot&&st>xe&&Re!==0){let $t=this.calculateProjMatrix(Fe.tileID.toUnwrapped()),cn;s.isTerrainDEM||(cn=Ot.getMinMaxForTile(Fe.tileID)),cn||(cn={min:ce,max:ue});let on=r.b2(this.rotation),An=[on[0]*r.a3,on[1]*r.a3,cn.max];r._.transformMat4(An,An,$t),pt=(1-An[1])*this.height*.5<Re}return st<xe||pt})}return Ce.sort((xe,Re)=>xe.distanceSq-Re.distanceSq).map(xe=>xe.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){let h=r.at(s.lat,-r.aS,r.aS),g=this.projection.project(s.lng,h);return new r.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let C=this.worldSize;g=(h.x-x.x)/C,v=(h.y-x.y)/C}else{let C=this.pointCoordinate(h),M=this.pointCoordinate(x);g=C.x-M.x,v=C.y-M.y}let E=this.locationCoordinate(s);this.setLocation(new r.Y(E.x-g,E.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){let g=h?r.ax(h,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new r.Y(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){let g=h??this._centerAltitude,v=[s.x,s.y,0,1],x=[s.x,s.y,1,1];r.aA.transformMat4(v,v,this.pixelMatrixInverse),r.aA.transformMat4(x,x,this.pixelMatrixInverse);let E=x[3];r.aA.scale(v,v,1/v[3]),r.aA.scale(x,x,1/E);let C=v[2],M=x[2];return{p0:v,p1:x,t:C===M?0:(g-C)/(M-C)}}screenPointToMercatorRay(s){let h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return r.aA.transformMat4(h,h,this.pixelMatrixInverse),r.aA.transformMat4(g,g,this.pixelMatrixInverse),r.aA.scale(h,h,1/h[3]),r.aA.scale(g,g,1/g[3]),h[2]=r.ax(h[2],this._center.lat)*this.worldSize,g[2]=r.ax(g[2],this._center.lat)*this.worldSize,r.aA.scale(h,h,1/this.worldSize),r.aA.scale(g,g,1/this.worldSize),new r.aT([h[0],h[1],h[2]],r._.normalize([],r._.sub([],g,h)))}rayIntersectionCoordinate(s){let{p0:h,p1:g,t:v}=s,x=r.ax(h[2],this._center.lat),E=r.ax(g[2],this._center.lat);return new r.Y(r.a2(h[0],g[0],v)/this.worldSize,r.a2(h[1],g[1],v)/this.worldSize,r.a2(x,E,v))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new r.Y(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);let x=.02*v,E=s.clone();for(let C=0;C<10&&v-g>x;C++){E.y=r.a2(g,v,.66);let M=this.projection.pointCoordinate3D(this,E.x,E.y);M?(v=E.y,h=M):g=E.y}return h?new r.Y(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=r.aU)return!this.isPointAboveHorizon(s);let h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){let g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return r.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(h,s)),E=this.pointLocation3D(new r.P(v,s)),C=this.pointLocation3D(new r.P(v,g)),M=this.pointLocation3D(new r.P(h,g)),P=Math.min(x.lng,E.lng,C.lng,M.lng),k=Math.max(x.lng,E.lng,C.lng,M.lng),N=Math.min(x.lat,E.lat,C.lat,M.lat),B=Math.max(x.lat,E.lat,C.lat,M.lat),V=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,H=(q,W,ee,te,ne)=>{let ue=(q+ee)/2,ce=(W+te)/2,J=new r.P(ue,ce),{lng:re,lat:ie}=this.pointLocation3D(J),ge=Math.max(0,P-re,N-ie,re-k,ie-B);P=Math.min(P,re),k=Math.max(k,re),N=Math.min(N,ie),B=Math.max(B,ie),(ne<G||ge>V)&&(H(q,W,ue,ce,ne+1),H(ue,ce,ee,te,ne+1))};if(H(h,s,v,s,1),H(v,s,v,g,1),H(v,g,h,g,1),H(h,g,h,s,1),this.projection.name==="globe"){let[q,W]=r.aV(this);q?(B=90,k=180,P=-180):W&&(N=-90,k=180,P=-180)}return new r.ai(new r.aI(P,N),new r.aI(k,B))}_getBoundsRectangular(s,h){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,C=new r.P(v,g),M=new r.P(E,g),P=new r.P(E,x),k=new r.P(v,x),N=this.pointCoordinate(C,s),B=this.pointCoordinate(M,s),V=this.pointCoordinate(P,h),G=this.pointCoordinate(k,h),H=(q,W)=>(W.y-q.y)/(W.x-q.x);return N.y>1&&B.y>=0?N=new r.Y((1-G.y)/H(G,N)+G.x,1):N.y<0&&B.y<=1&&(N=new r.Y(-G.y/H(G,N)+G.x,0)),B.y>1&&N.y>=0?B=new r.Y((1-V.y)/H(V,B)+V.x,1):B.y<0&&N.y<=1&&(B=new r.Y(-V.y/H(V,B)+V.x,0)),new r.ai().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){let s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-r.aS,this.maxLat=r.aS,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aj(this.minLng)*this.tileSize,this.worldMaxX=r.aj(this.maxLng)*this.tileSize,this.worldMinY=r.ak(this.maxLat)*this.tileSize,this.worldMaxY=r.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){let h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];let v=s.canonical,x=1/this.height,E=this.cameraWorldSize,C=E/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*s.wrap)*C,P=v.y*C,k=this.point;k.x*=E/this.worldSize,k.y*=E/this.worldSize;let N=this.angle,B=Math.sin(-N),V=-Math.cos(-N);return g[h]={bearing:[B,V],center:[(k.x-M)*x,(k.y-P)*x],scale:C/r.a3*x},g[h]}calculateFogTileMatrix(s){let h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return r.ad.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(s,h=!1,g=!1){let v=s.key,x;if(x=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let E=this.calculatePosMatrix(s,this.worldSize),C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,r.ad.multiply(E,C,E),x[v]=new Float32Array(E),x[v]}calculatePixelsToTileUnitsMatrix(s){let h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];let v=r.aW(s,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let s=1/this.worldSize,h=r.ad.fromScaling([],[s,s,s]);return r.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let s=this._elevation;this._updateCameraState();let h=r.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),x=r.ax(1,this._center.lat);g[2]/=x,v[2]/=x,r._.normalize(v,v);let E=s.raycast(g,v,s.exaggeration());if(E){let C=r._.scaleAndAdd([],g,v,E),M=new r.Y(C[0],C[1],r.ax(C[2],r.ay(C[1]))),P=(M.z+r._.length([M.x-g[0],M.y-g[1],M.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;let h=this._elevation,g=r.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=h.getAtPointOrZero(new r.Y(...v)),E=this.pixelsPerMeter/this.worldSize*x,C=this._minimumHeightOverTerrain(),M=v[2]-E;if(M<=C)if(M<0||s){let P=this.locationCoordinate(this._center,this._centerAltitude),k=[v[0],v[1],P.z-v[2]],N=r._.length(k);k[2]-=(C-M)/this._pixelsPerMercatorPixel;let B=r._.length(k);if(B===0)return;r._.scale(k,k,N/B*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],P.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){let B=this.center;return B.lat=r.at(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(B.lng=r.at(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}let h=this._unmodified,{x:g,y:v}=this.point,x=0,E=g,C=v,M=this.width/2,P=this.height/2,k=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(v-P<k&&(C=k+P),v+P>N&&(C=N-P),N-k<this.height&&(x=Math.max(x,this.height/(N-k)),C=(N+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,G=this.worldSize/2-(B+V)/2;E=(g+G+this.worldSize)%this.worldSize-G,E-M<B&&(E=B+M),E+M>V&&(E=V-M),V-B<this.width&&(x=Math.max(x,this.width/(V-B)),E=(V+B)/2)}E===g&&C===v||(this.center=this.unproject(new r.P(E,C))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let s=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ax(1,this.center.lat)/r.ax(1,r.b3));let v=r.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,x),C,M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-s.x/this.width,M[9]=2*s.y/this.height,this.isOrthographic){let ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=ie*this.aspect,Ce=-ge,ae=-ie;ge-=s.x,Ce-=s.x,ie+=s.y,ae+=s.y,C=this._camera.getCameraToClipOrthographic(Ce,ge,ae,ie,this._nearZ,this._farZ),((Se,Me,$e,Ge)=>{for(let Ve=0;Ve<16;Ve++)Se[Ve]=vp(Me[Ve],$e[Ve],Ge)})(C,C,M,wr(this.pitch>=15?1:this.pitch/15))}else C=M;let P=r.ad.mul([],M,E),k=r.ad.mul([],C,E);if(this.projection.isReprojectedInTileSpace){let ie=this.locationCoordinate(this.center),ge=r.ad.identity([]);r.ad.translate(ge,ge,[ie.x*this.worldSize,ie.y*this.worldSize,0]),r.ad.multiply(ge,ge,r.aY(this)),r.ad.translate(ge,ge,[-ie.x*this.worldSize,-ie.y*this.worldSize,0]),r.ad.multiply(k,k,ge),r.ad.multiply(P,P,ge),this.inverseAdjustmentMatrix=r.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ad.scale([],k,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=k,this.invProjMatrix=r.ad.invert(new Float64Array(16),this.projMatrix),h){let ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ie[8]=2*-s.x/this.width,ie[9]=2*s.y/this.height,this.expandedFarZProjMatrix=r.ad.mul([],ie,E)}else this.expandedFarZProjMatrix=this.projMatrix;let N=r.ad.invert([],C);this.frustumCorners=r.a_.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let B=new Float32Array(16);r.ad.identity(B),r.ad.scale(B,B,[1,-1,1]),r.ad.rotateX(B,B,this._pitch),r.ad.rotateZ(B,B,this.angle);let V=r.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ad.clone(V);let G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-s.x/this.width,V[9]=2*(s.y+G)/this.height,this.skyboxMatrix=r.ad.multiply(B,V,B);let H=this.point,q=H.x,W=H.y,ee=this.width%2/2,te=this.height%2/2,ne=Math.cos(this.angle),ue=Math.sin(this.angle),ce=q-Math.round(q)+ne*ee+ue*te,J=W-Math.round(W)+ne*te+ue*ee,re=new Float64Array(k);if(r.ad.translate(re,re,[ce>.5?ce-1:ce,J>.5?J-1:J,0]),this.alignedProjMatrix=re,k=r.ad.create(),r.ad.scale(k,k,[this.width/2,-this.height/2,1]),r.ad.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=r.ad.create(),r.ad.scale(k,k,[1,-1,1]),r.ad.translate(k,k,[-1,-1,0]),r.ad.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=r.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},k=r.ad.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.a$(this);let ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r._.transformMat4(ie,ie,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,h];r._.scale(x,x,v),r._.scale(g,g,-1),r._.multiply(g,g,x);let E=r.ad.create();r.ad.translate(E,E,g),r.ad.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,v)}_computeCameraPosition(s){let h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,s/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((h-g)/v,1)),this._camera.position=r._.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){let s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=r.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ab(this._maxPitch)),C=Math.max((s[2]-x)/Math.cos(g),E),M=this._zoomFromMercatorZ(C);r._.scaleAndAdd(s,s,h,C),this._pitch=r.at(g,r.ab(this.minPitch),r.ab(this.maxPitch)),this.angle=r.au(v,-Math.PI,Math.PI),this._setZoom(r.at(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.Y(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){let s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=r.aU,v=0,x=1/0;for(;g-h>1e-6&&g>h;){let E=h+.5*(g-h),C=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,C),P=this.scaleZoom(M/(s*this.tileSize)),k=Math.abs(E-P);k<x&&(x=k,v=E),E<P?h=E:g=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){let g=Math.min(s.x,h.x),v=Math.max(s.x,h.x),x=Math.min(s.y,h.y),E=Math.max(s.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let C=[new r.P(g,x),new r.P(v,E),new r.P(g,E),new r.P(v,x)],M=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(let k of C){let N=this.pointRayIntersection(k);if(N.t<0)return!0;let B=this.rayIntersectionCoordinate(N);if(B.x<M||B.y<0||B.x>P||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(s,h){let g=r._.length(r._.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let s=function([h,g,v],x){let E=[h,g,v,1];r.aA.transformMat4(E,E,x);let C=E[3]=Math.max(E[3],1e-6);return E[0]/=C,E[1]/=C,E[2]/=C,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(s[0],s[1])}{let s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){let v=r.aX(s,h,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,g,v),E=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(E=vp(1,E,wr(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){let s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ad.multiply(s,s,this.globeMatrix),s}getFrustum(s){return r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}let vi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},os=(p,s)=>{if(s>0&&p.terrain&&r.w("Cutoff is currently disabled on terrain"),s<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=p.transform,g=Math.max(Math.abs(h._zoom-(p.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?r.$(60,45,h.pitch):r.$(30,15,h.pitch),x=h._farZ-h._nearZ,E=s*h.height,C=((1-(M=v))*h.cameraToCenterDistance+M*(h._farZ+E))*g;var M;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(C-h._nearZ)/x,(C-E-h._nearZ)/x]}}},Yr={cascadeCount:2,shadowMapResolution:2048};class xp{constructor(s,h){this.aabb=s,this.lastCascade=h}}class bp{add(s,h){let g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[s.key]=new xp(h,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,h,g){let v=r.b6.fromPoints(s.points),x=0;for(let E in this.receivers){let C=this.receivers[E];if(!C||!v.intersectsAabb(C.aabb))continue;C.aabb.min=v.closestPoint(C.aabb.min),C.aabb.max=v.closestPoint(C.aabb.max);let M=C.aabb.getCorners();for(let P=0;P<g.length;P++){let k=!0;for(let N of M){let B=[N[0]*h,N[1]*h,N[2]];if(r._.transformMat4(B,B,g[P].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){k=!1;break}}if(C.lastCascade=P,x=Math.max(x,P),k)break}}return x+1}}class Wh{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bp,this._depthMode=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(Yr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(Yr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,h){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((G,H)=>{let q=g.style._mergedLayers[H];return G+(q.hasShadowPass()&&!q.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,E=Yr.shadowMapResolution,C=Yr.shadowMapResolution;if(this._cascades.length===0||Yr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<Yr.cascadeCount;++G){let H=g._shadowMapDebug,q=x.gl,W=x.createFramebuffer(E,C,H,"texture"),ee=new r.T(x,{width:E,height:C,data:null},q.DEPTH_COMPONENT);if(W.depthAttachment.set(ee.texture),H){let te=new r.T(x,{width:E,height:C,data:null},q.RGBA);W.colorAttachment.set(te.texture)}this._cascades.push({framebuffer:W,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.aM,scale:0})}}this.shadowDirection=iu(h);let M=0;if(s.elevation){let G=s.elevation,H=[1e4,-1e4];G.visibleDemTiles.filter(q=>q.dem).forEach(q=>{let W=q.dem.tree;H[0]=Math.min(H[0],W.minimums[0]),H[1]=Math.max(H[1],W.maximums[0])}),H[0]!==1e4&&(M=(H[1]-H[0])*G.exaggeration())}let P=1.5*s.cameraToCenterDistance,k=3*P,N=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){let H=this._cascades[G],q=s.height/50,W=1;Yr.cascadeCount===1?W=k:G===0?W=P:(q=P,W=k);let[ee,te]=ou(s,this.shadowDirection,q,W,Yr.shadowMapResolution,M);H.scale=s.scale,H.matrix=ee,H.boundingSphereRadius=te,r.ad.invert(N,H.matrix),H.frustum=r.aM.fromInvProjectionMatrix(N,1,0,!0),H.far=W}let B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Yr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Yr.shadowMapResolution,this._uniformValues.u_shadowmap_0=vi.ShadowMap0,this._uniformValues.u_shadowmap_1=vi.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let V=g.transform.elevation;for(let G of this._groundShadowTiles){let H={min:0,max:0};if(V){let q=V.getMinMaxForTile(G);q&&(H=q)}this.addShadowReceiver(G.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,h){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,Yr.shadowMapResolution,Yr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:r.C.white,depth:1});for(let E of s.order){let C=s._mergedLayers[E];if(!C.hasShadowPass()||C.isHidden(g.transform.zoom))continue;let M=s.getLayerSourceCache(C),P=M?h[M.id]:void 0;(C.type==="model"||P&&P.length)&&g.renderLayer(g,M,C,P)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let s=this.painter,h=s.style,g=s.context,v=h.directionalLight,x=h.ambientLight;if(!v||!x)return;let E=[],C=os(s,s.longestCutoffRange);C.shouldRenderCutoff&&E.push("RENDER_CUTOFF");let M=ss(h,v,x),P=new r.ae(g.gl.LEQUAL,r.ae.ReadOnly,s.depthRangeFor3D);for(let k of this._groundShadowTiles){let N=k.toUnwrapped(),B=s.isTileAffectedByFog(k),V=s.getOrCreateProgram("groundShadow",{defines:E,overrideFog:B});this.setupShadows(N,V),s.uploadCommonUniforms(g,V,N,null,C);let G={u_matrix:s.transform.calculateProjMatrix(N),u_ground_shadow_factor:M};V.draw(s,g.gl.TRIANGLES,P,r.ag.disabled,r.a.multiply,r.af.disabled,G,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){let h=this.painter.transform,g=h.calculatePosMatrix(s,h.worldSize);return r.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return r.ad.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,h,g,v=0){if(!this.enabled)return;let x=this.painter.transform,E=this.painter.context,C=E.gl,M=this._uniformValues,P=new Float64Array(16),k=x.calculatePosMatrix(s,x.worldSize);for(let N=0;N<this._cascades.length;N++)r.ad.multiply(P,this._cascades[N].matrix,k),M[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),E.activeTexture.set(C.TEXTURE0+vi.ShadowMap0+N),this._cascades[N].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let N=r.b5(s.canonical),B=2/x.tileSize*r.a3/Yr.shadowMapResolution,V=B*this._cascades[0].boundingSphereRadius,G=B*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(g==="vector-tile"?1:3)/Math.pow(2,v-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));M.u_shadow_normal_offset=[N,V*H,G*H],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(E,M)}setupShadowsFromMatrix(s,h,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,E=this._uniformValues,C=new Float64Array(16);for(let M=0;M<Yr.cascadeCount;M++)r.ad.multiply(C,this._cascades[M].matrix,s),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(x.TEXTURE0+vi.ShadowMap0+M),this._cascades[M].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(E.u_shadow_normal_offset=[1,5,5],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,h,g,v){if(v[2]>=0)return{};let x=function(M,P,k){let N=k/(1<<M.canonical.z);return new r.b6([M.canonical.x*N+M.wrap*k,M.canonical.y*N+M.wrap*k,0],[(M.canonical.x+1)*N+M.wrap*k,(M.canonical.y+1)*N+M.wrap*k,P])}(s,h,g).getCorners(),E=h/-v[2];v[0]<0?(r._.add(x[0],x[0],[v[0]*E,0,0]),r._.add(x[3],x[3],[v[0]*E,0,0])):v[0]>0&&(r._.add(x[1],x[1],[v[0]*E,0,0]),r._.add(x[2],x[2],[v[0]*E,0,0])),v[1]<0?(r._.add(x[0],x[0],[0,v[1]*E,0]),r._.add(x[1],x[1],[0,v[1]*E,0])):v[1]>0&&(r._.add(x[2],x[2],[0,v[1]*E,0]),r._.add(x[3],x[3],[0,v[1]*E,0]));let C={};return C.vertices=x,C.planes=[Pl(x[1],x[0],x[4]),Pl(x[2],x[1],x[5]),Pl(x[3],x[2],x[6]),Pl(x[0],x[3],x[7])],C}addShadowReceiver(s,h,g){this._receivers.add(s,r.b6.fromTileIdAndHeight(s,h,g))}getMaxCascadeForTile(s){let h=this._receivers.get(s);return h&&h.lastCascade?h.lastCascade:0}}function Pl(p,s,h){let g=r._.sub([],h,s),v=r._.sub([],p,s),x=r._.cross([],g,v),E=r._.length(x);return E===0?[0,0,1,0]:(r._.scale(x,x,1/E),[x[0],x[1],x[2],-r._.dot(x,s)])}function iu(p){let s=p.properties.get("direction"),h=r.ac(s.x,s.y,s.z);h[2]=r.at(h[2],0,75);let g=r.b7([h[0],h[1],h[2]]);return r._.fromValues(g.x,g.y,g.z)}function ss(p,s,h){let g=s.properties.get("color"),v=s.properties.get("intensity"),x=s.properties.get("direction"),E=[x.x,x.y,x.z],C=h.properties.get("color"),M=h.properties.get("intensity"),P=Math.max(r._.dot([0,0,1],E),0),k=[0,0,0];r._.scale(k,C.toRenderColor(p.getLut(s.scope)).toArray01Linear().slice(0,3),M);let N=[0,0,0];return r._.scale(N,g.toRenderColor(p.getLut(h.scope)).toArray01Linear().slice(0,3),P*v),r.b8([k[0]>0?k[0]/(k[0]+N[0]):0,k[1]>0?k[1]/(k[1]+N[1]):0,k[2]>0?k[2]/(k[2]+N[2]):0])}function ou(p,s,h,g,v,x){let E=p.zoom,C=p.scale,M=p.worldSize,P=1/M,k=p.aspect,N=Math.sqrt(1+k*k)*Math.tan(.5*p.fovX),B=N*N,V=g-h,G=g+h,H,q;B>V/G?(H=g,q=g*N):(H=.5*G*(1+B),q=.5*Math.sqrt(V*V+2*(g*g+h*h)*B+G*G*B*B));let W=p.projection.pixelsPerMeter(p.center.lat,M),ee=p._camera.getCameraToWorldMercator(),te=[0,0,-H*P];r._.transformMat4(te,te,ee);let ne=q*P,ue=p._edgeInsets;if(!(ue.left===0&&ue.top===0&&ue.right===0&&ue.bottom===0||ue.left===ue.right&&ue.top===ue.bottom)){let ot=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?W:1),ct=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,h,g);ct[8]=2*-p.centerOffset.x/p.width,ct[9]=2*p.centerOffset.y/p.height;let at=new Float64Array(16);r.ad.mul(at,ct,ot);let je=new Float64Array(16);r.ad.invert(je,at);let He=r.aM.fromInvProjectionMatrix(je,M,E,!0);for(let st of He.points){let pt=((ce=st)[0]/=C,ce[1]/=C,ce[2]=r.ax(ce[2],p._center.lat),ce);ne=Math.max(ne,r._.len(r._.subtract([],te,pt)))}}var ce;ne*=v/(v-1);let J=Math.acos(s[2]),re=Math.atan2(-s[0],-s[1]),ie=new nu;ie.position=te,ie.setPitchBearing(J,re);let ge=ie.getWorldToCamera(M,W),Ce=ne*M,ae=Math.min(p._mercatorZfromZoom(17)*M*-2,-2*Ce),Se=ie.getCameraToClipOrthographic(-Ce,Ce,-Ce,Ce,ae,(Ce+x*W)/s[2]),Me=new Float64Array(16);r.ad.multiply(Me,Se,ge);let $e=r._.fromValues(Math.floor(1e6*te[0])/1e6*M,Math.floor(1e6*te[1])/1e6*M,0),Ge=.5*v,Ve=[0,0,0];r._.transformMat4(Ve,$e,Me),r._.scale(Ve,Ve,Ge);let xe=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],Re=[0,0,0];r._.sub(Re,Ve,xe),r._.scale(Re,Re,-1/Ge);let Fe=new Float64Array(16);return r.ad.identity(Fe),r.ad.translate(Fe,Fe,Re),r.ad.multiply(Me,Fe,Me),[Me,Ce]}function Zh(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}let Ra=new class{constructor(){this.operations={}}newMorphing(p,s,h,g,v){if(p in this.operations){let x=this.operations[p];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[p]={startTime:g,phase:0,duration:v,from:s,to:h,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;let s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(let s in this.operations){let h=this.operations[s];for(h.phase=(p-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},su={0:null,1:"TERRAIN_VERTEX_MORPHING"};function wp(p,s,h){if(s===0)return 0;let g=s<1&&h===514?.25/s:1;return 6*Math.pow(1.5,22-p)*Math.max(s,1)*g}function M_(p,s){let h=1<<p.z;return!s&&(p.x===0||p.x===h-1)||p.y===0||p.y===h-1}let Xh=p=>({u_matrix:p});function Yh(p,s,h,g,v){if(v>0){let x=r.e.now(),E=(x-p.timeAdded)/v,C=s?(x-s.timeAdded)/v:-1,M=h.getSource(),P=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),k=!s||Math.abs(s.tileID.overscaledZ-P)>Math.abs(p.tileID.overscaledZ-P),N=k&&p.refreshedUponExpiration?1:r.at(k?E:1-C,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Rl extends eu{constructor(s,h,g,v){super(s,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=r.W({type:"raster-array"},h)}triggerRepaint(s){let h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,r.R.Tile);s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(x,E,C,M)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(x)return x.code===20?void 0:(s.state="errored",h(x));this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:M}),s.state="empty",h(null)})}unloadTile(s,h){let g=s.texture;g&&g instanceof r.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,h,g){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(h,g,(v,x)=>{if(v)return s.state="errored",this.fire(new r.d(v)),void this.triggerRepaint(s);x&&(s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:x})=>x===s),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(s,h,g){if(!s)return;let v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;h instanceof r.bk?x=h.paint.get("raster-array-band"):h instanceof r.bl&&(x=h.paint.get("raster-particle-array-band"));let E=x||this.getInitialBand(v);if(E!=null)if(s.textureDescriptor){if(!s.updateNeeded(v,E)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,E)}}let Kr={vector:$h,raster:eu,"raster-dem":class extends eu{constructor(p,s,h,g){super(p,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=r.W({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){let h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(p.state="errored",s(v)),x&&(p.dem=x,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=r.h(this.map._requestManager.transformRequest(h,r.R.Tile),(function(v,x,E,C){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(v)p.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:E,expires:C});let M=ImageBitmap&&x instanceof ImageBitmap&&r.bi(),P=1-(x.width-r.bj(x.width))/2;P<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));let k=M?x:r.e.getImageData(x,P),N={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:P};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",N,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){let s=p.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,v=s.x===0?p.wrap-1:p.wrap,x=(s.x+1+h)%h,E=s.x+1===h?p.wrap+1:p.wrap,C={};return C[new r.aL(p.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},C[new r.aL(p.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(C[new r.aL(p.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},C[new r.aL(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},C[new r.aL(p.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<h&&(C[new r.aL(p.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},C[new r.aL(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},C[new r.aL(p.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),C}},"raster-array":Rl,geojson:class extends r.E{constructor(p,s,h,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=r.W({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;let v=r.a3/this.tileSize;this.workerOptions=r.W({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:r.a3,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:r.a3,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){return this._options.dynamic?typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection")?this.fire(new r.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...p.features):this._data=p,this._updateWorkerData(!0),this):this.fire(new r.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterLeaves(p,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:s,offset:h},g),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.f("dataloading",{dataType:"source"})),this._loaded=!1;let s=r.W({append:p},this.workerOptions);s.scope=this.scope;let h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(r.e.resolveURL(h),r.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new r.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new r.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,s){let h=p.actor?"reloadTile":"loadTile";p.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};p.request=this.actor.send(h,x,(E,C)=>v&&!C?(p.state="loaded",s(null)):(delete p.request,p.destroy(),p.aborted?s(null):E?s(E):(p.loadVectorData(C,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,s){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.bm{constructor(p,s,h,g){super(p,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;let p=this.options;this.urls=[];for(let s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,r.R.Source).url);r.bn(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new r.d(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){let s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new r.d(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(p,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.bm,model:class extends r.E{constructor(p,s,h,g){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){let p=[];for(let s in this._options.models){let h=this._options.models[s],g=r.l(this.map._requestManager.transformRequest(h.uri,r.R.Model).url).then(v=>{if(!v)return;let x=r.c(v),E=new r.M(s,h.position,h.orientation,x);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(v=>{this.fire(new r.d(new Error(`Could not load model ${s} from ${h.uri}: ${v.message}`)))});p.push(g)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new r.d(new Error(`Could not load models: ${s.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,s){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(p,s,h,g){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=mp(this._options,this.map._requestManager,s,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new r.d(g))):v&&(r.W(this,v),v.bounds&&(this.tileBounds=new Jc(v.bounds,this.minzoom,this.maxzoom)),r.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),p&&p(g)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,s){let h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,r.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=s;else{if(p.buckets){let x=Object.values(p.buckets);for(let E of x)E.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",g,v.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,E){return p.aborted?s(null):x&&x.status!==404?s(x):(E&&(E.resourceTiming&&(p.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(E),p.buckets=xt(xt({},p.buckets),E.buckets),E.featureIndex&&(p.latestFeatureIndex=E.featureIndex)),p.state="loaded",void s(null))}}serialize(){return r.W({},this._options)}},canvas:class extends r.bm{constructor(p,s,h,g){super(p,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new r.d(new r.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.d(new r.V(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new r.d(new r.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new r.d(new r.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.d(new r.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let s=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.E{constructor(p,s,h,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jc(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),r.W(this,r.ah(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){let{x:s,y:h,z:g}=p.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){let{x:h,y:g,z:v}=p.tileID.canonical,x=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:x.signal})).then((function(E){return delete p.request,p.aborted?(p.state="unloaded",s(null)):E===void 0?(p.state="errored",s(null)):E===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(E)?(this.loadTileData(p,E),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(p.state="errored",s(E))}),p.request.cancel=()=>x.abort()}loadTileData(p,s){p.setTexture(s,this._map.painter)}unloadTile(p,s){if(p.texture&&p.texture instanceof r.T?(p.destroy(!0),p.texture&&p.texture instanceof r.T&&this._map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){let{x:h,y:g,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}s&&s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){let p=r.al(this.id,this.scope);this._map.style.clearSource(p)}_update(){this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}}},Kh=function(p,s,h,g){let v=new Kr[s.type](p,s,h,g);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return r.bp(["load","abort","unload","serialize","prepare"],v),v};class Ep extends r.bv{constructor(s){let h={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new r.bw(r.bx(),null),v=Kh("mock-dem",h,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class A_ extends r.bv{constructor(s){let h=Kh("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new r.bw(r.bx(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;let v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){let C=new r.by(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);C.state="loaded",this._tiles[E.key]=C}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){let h=this.proxyCachedFBO[s];if(h!==void 0){let g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Tp extends r.aL{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class Cp extends r.bq{constructor(s,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(M){let P=new r.bt,k=new r.bu,N=131;P.reserve(17161),k.reserve(33800);let B=r.a3/128,V=r.a3+B/2,G=V+B;for(let q=-B;q<G;q+=B)for(let W=-B;W<G;W+=B){let ee=W<0||W>V||q<0||q>V?24575:0,te=r.at(Math.round(W),0,r.a3),ne=r.at(Math.round(q),0,r.a3);P.emplaceBack(te+ee,ne)}let H=(q,W)=>{let ee=W*N+q;k.emplaceBack(ee+1,ee,ee+N),k.emplaceBack(ee+N,ee+N+1,ee+1)};for(let q=1;q<129;q++)for(let W=1;W<129;W++)H(W,q);return[0,129].forEach(q=>{for(let W=0;W<130;W++)H(W,q),H(q,W)}),[P,k,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(g,r.br.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=r.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=r.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new A_(h.map),this.orthoMatrix=r.ad.create(),r.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.a3,0,r.a3,0,1);let C=E.gl;this._overlapStencilMode=new r.ag({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ep(h.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);let v=s.terrain.properties,x=s.terrain.drapeRenderMode===0,E=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.e.now();let C=s.terrain&&s.terrain.scope,M=v.get("source"),P=x?this._mockSourceCache:s.getSourceCache(M,C);if(!P)return void r.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=P,this._exaggeration=E?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;let k=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let N=this.getScaledDemTileSize();this.sourceCache.update(h,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(s){let h=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;let v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=s.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(x);let C=x-this._previousZoom,M=this._previousUpdateTimestamp,P=x;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(x-P)>.5&&(C=.5*(x-P+C)),C*v<0&&(P+=C)),this._evaluationZoom=P;let k=E.getExaggeration(P),N=k===E.getExaggeration(Math.max(0,P-.1));if(N&&Math.abs(k-this._exaggeration)<.01)return k;let B=Math.min(.1,.00375*(this._updateTimestamp-M));return(N||k<.1||Math.abs(C)<1e-4)&&(B=Math.min(.2,4*B)),r.a2(this._exaggeration,k,B)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(r.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(M=>{let P=h.getTileByID(M).tileID;return P.projMatrix=g.calculateProjMatrix(P.toUnwrapped()),P});(function(M,P){let k=P.transform.pointCoordinate(P.transform.getCameraPoint()),N=new r.P(k.x,k.y);M.sort((B,V)=>{if(V.overscaledZ-B.overscaledZ)return V.overscaledZ-B.overscaledZ;let G=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),H=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),q=N.mult(1<<B.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(G)-q.distSqr(H)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};let E=this._style._mergedSourceCaches;for(let M in E){let P=E[M];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,s[M],x),P.usedForTerrain))continue;let k=s[M];P.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[h.id]=v.map(M=>new Tp(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let C={};this._visibleDemTiles=[];for(let M of this.proxyCoords){let P=this.terrainTileForTile[M.key];if(!P)continue;let k=P.tileID.key;k in C||(this._visibleDemTiles.push(P),C[k]=k)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;let g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){let s=this.painter.context,h=s.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),pp(this.painter,v,x))}}_prepareDemTileUniforms(s,h,g,v){if(!h||h.demTexture==null)return!1;let x=s.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-x.z),C=v||"";return g[`u_dem_tl${C}`]=[x.x*E%1,x.y*E%1],g[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){let g=new r.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(s,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0,h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&s++,g+x},0);return s?h/s:0}_updateEmptyDEMTexture(){let s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let C=new r.bz({width:1,height:1},new Float32Array([g]));return[h.R32F,C]})();this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(x,{premultiply:!1}):E=this._emptyDEMTexture=new r.T(s,x,v,{premultiply:!1}),E}setupElevationDraw(s,h,g){let v=this.painter.context,x=v.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};E.u_exaggeration=this.exaggeration();let C=null,M=null,P=1;if(g&&g.morphing&&this._useVertexMorphing){let V=g.morphing.srcDemTile,G=g.morphing.dstDemTile;P=g.morphing.phase,V&&G&&(this._prepareDemTileUniforms(s,V,E,"_prev")&&(M=V),this._prepareDemTileUniforms(s,G,E)&&(C=G))}let k=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,N=null;var B;if(this.enabled?M&&C?(N=C.demTexture,v.activeTexture.set(x.TEXTURE4),M.demTexture.bind(k(M),x.CLAMP_TO_EDGE),E.u_dem_lerp=P):(C=this.terrainTileForTile[s.tileID.key],N=this._prepareDemTileUniforms(s,C,E)?C.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),N&&(E.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(k(C),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&C){let V=(1<<C.tileID.canonical.z)*r.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=V}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,E),this.painter.transform.projection.name==="globe"){let V=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,V)}}globeUniformValues(s,h,g){let v=s.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,r.a3,0),u_tile_br_up:v.upVector(h,r.a3,r.a3),u_tile_bl_up:v.upVector(h,0,r.a3),u_tile_up_scale:g?r.bs(1):v.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){let h=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,E,C,M){if(v.transform.projection.name==="globe")(function(P,k,N,B,V){let G=P.context,H=G.gl,q,W,ee=P.transform,te=r.ba(P,G,ee),ne=(Se,Me)=>{if(W===Me)return;let $e=[su[Me],"PROJECTION_GLOBE_VIEW"];te&&$e.push("CUSTOM_ANTIALIASING");let Ge=P.isTileAffectedByFog(Se);q=P.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:Ge}),W=Me},ue=P.colorModeForRenderPass(),ce=new r.ae(H.LEQUAL,r.ae.ReadWrite,P.depthRangeFor3D);Ra.update(V);let J=r.bb(ee),re=[r.aj(ee.center.lng),r.ak(ee.center.lat)],ie=P.globeSharedBuffers,ge=[ee.width*r.e.devicePixelRatio,ee.height*r.e.devicePixelRatio],Ce=Float32Array.from(ee.globeMatrix),ae={useDenormalizedUpVectorScale:!0};{let Se=P.transform,Me=wp(Se.zoom,k.exaggeration(),k.sourceCache._source.tileSize);W=-1;let $e=H.TRIANGLES;for(let Ge of B){let Ve=N.getTile(Ge),xe=r.ag.disabled,Re=k.prevTerrainTileForTile[Ge.key],Fe=k.terrainTileForTile[Ge.key];Zh(Re,Fe)&&Ra.newMorphing(Ge.key,Re,Fe,V,250),G.activeTexture.set(H.TEXTURE0),Ve.texture&&Ve.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let ot=Ra.getMorphValuesForProxy(Ge.key),ct=ot?1:0;ot&&r.o(ae,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:r.b9(ot.phase)}});let at=r.bc(Ge.canonical),je=r.bd(at.getCenter().lat),He=r.be(Ge.canonical,at,je,Se.worldSize/Se._pixelsPerMercatorPixel),st=r.bf(r.bg(Ge.canonical)),pt=I_(Se.expandedFarZProjMatrix,Ce,J,st,r.a1(Se.zoom),re,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,ge,Me,Se._farZ,He);if(ne(Ge,ct),q&&(k.setupElevationDraw(Ve,q,ae),P.uploadCommonUniforms(G,q,Ge.toUnwrapped()),ie)){let[Ot,$t,cn]=ie.getGridBuffers(je,Me!==0);q.draw(P,$e,ce,xe,ue,r.af.backCCW,pt,"globe_raster",Ot,$t,cn)}}}if(ie&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){let Se=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&Se.push("CUSTOM_ANTIALIASING"),q=P.getOrCreateProgram("globeRaster",{defines:Se});for(let Me of B){let{x:$e,y:Ge,z:Ve}=Me.canonical,xe=Ge===0,Re=Ge===(1<<Ve)-1,[Fe,ot,ct,at]=ie.getPoleBuffers(Ve,!1);if(at&&(xe||Re)){let je=N.getTile(Me);G.activeTexture.set(H.TEXTURE0),je.texture&&je.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let He=r.bh(Ve,$e,ee),st=r.bf(r.bg(Me.canonical)),pt=(Ot,$t)=>Ot.draw(P,H.TRIANGLES,ce,r.ag.disabled,ue,r.af.disabled,I_(ee.expandedFarZProjMatrix,He,He,st,0,re,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,ge,0,ee._farZ),"globe_pole_raster",$t,ct,at);k.setupElevationDraw(je,q,ae),P.uploadCommonUniforms(G,q,Me.toUnwrapped()),xe&&P.renderDefaultNorthPole&&pt(q,Fe),Re&&P.renderDefaultSouthPole&&(He=r.ad.scale(r.ad.create(),He,[1,-1,1]),pt(q,ot))}}}})(v,x,E,C,M);else{let P=v.context,k=P.gl,N,B,V=v.shadowRenderer,G=os(v,v.longestCutoffRange),H=ue=>{if(B===ue)return;let ce=[];ce.push(su[ue]),G.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),N=v.getOrCreateProgram("terrainRaster",{defines:ce}),B=ue},q=v.colorModeForRenderPass(),W=new r.ae(k.LEQUAL,r.ae.ReadWrite,v.depthRangeFor3D);Ra.update(M);let ee=v.transform,te=wp(ee.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ne=[0,0,0];if(V){let ue=v.style.directionalLight,ce=v.style.ambientLight;ue&&ce&&(ne=ss(v.style,ue,ce))}{B=-1;let ue=k.TRIANGLES,[ce,J]=[x.gridIndexBuffer,x.gridSegments];for(let re of C){let ie=E.getTile(re),ge=r.ag.disabled,Ce=x.prevTerrainTileForTile[re.key],ae=x.terrainTileForTile[re.key];Zh(Ce,ae)&&Ra.newMorphing(re.key,Ce,ae,M,250),P.activeTexture.set(k.TEXTURE0),ie.texture&&ie.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);let Se=Ra.getMorphValuesForProxy(re.key),Me=Se?1:0,$e;Se&&($e={morphing:{srcDemTile:Se.from,dstDemTile:Se.to,phase:r.b9(Se.phase)}});let Ge=lt(re.projMatrix,M_(re.canonical,ee.renderWorldCopies)?te/10:te,ne);if(H(Me),!N)continue;x.setupElevationDraw(ie,N,$e);let Ve=re.toUnwrapped();V&&V.setupShadows(Ve,N),v.uploadCommonUniforms(P,N,Ve,null,G),N.draw(v,ue,W,ge,q,r.af.backCCW,Ge,"terrain_raster",x.gridBuffer,ce,J)}}}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;let h=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),C=h.style.order,M=[],P=0;for(let k of x){let N=v.getTileByID(k.proxyTileKey),B=v.proxyCachedFBO[k.key]?v.proxyCachedFBO[k.key][s]:void 0,V=B!==void 0?v.renderCache[B]:this.pool[P++],G=B!==void 0;if(N.texture=V.tex,G&&!V.dirty){M.push(N.tileID);continue}let H;g.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(g.clear({color:r.C.transparent,stencil:0}),V.dirty=!1);for(let q=E.start;q<=E.end;++q){let W=h.style._mergedLayers[C[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[k.key][ee.id]:[k];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}if(this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let W=h.style._mergedLayers[C[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[k.key][ee.id]:[k];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}this.renderedToTile?(V.dirty=!0,M.push(N.tileID)):G||--P,P===5&&(P=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}isLayerOrderingCorrect(s){let h=s.order.length,g=-1,v=h;for(let x=0;x<h;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let E=x.tileID,C=1<<E.overscaledZ,{x:M,y:P}=E.canonical,k=M/C,N=(M+1)/C,B=P/C,V=(P+1)/C;return{minx:k,miny:B,maxx:N,maxy:V,t:x.dem.tree.raycastRoot(k,B,N,V,s,h,g),tile:x}});v.sort((x,E)=>(x.t!==null?x.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,h,g);if(E!=null)return E}return null}_createFBO(){let s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);let v=new r.T(s,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=s.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new Ta(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{let h=this._style._mergedLayers[s],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(let g of this._style.getSources())if(g instanceof $h){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!h[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.Z){h[x.id]=!0;for(let E of this.proxyCoords){let C=this.proxyToSource[E.key][x.id];if(C)for(let M of C)this._clearRenderCacheForTile(x.id,M)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof eu){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||h[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let E=v.paint.get("raster-fade-duration");for(let C of this.proxyCoords){let M=this.proxyToSource[C.key][x.id];if(M)for(let P of M){let k=Yh(x.getTile(P),x.findLoadedParent(P,0),x,this.painter.transform,E);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(x.id,P)}}}}_setupDrapedRenderBatches(){let s=this._style.order,h=s.length;if(h===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,E=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<h;)E=this._style._mergedLayers[s[x]];for(;x<h;++x){let C=this._style._mergedLayers[s[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=x):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let C=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>C.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let C=0;C<E.length;++C){let M=Object.values(E[C]);h.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let E=g.length-1;E>=0;E--){let C=g[E];if(h.getTileByID(C.key),h.proxyCachedFBO[C.key]!==void 0){let M=s[C.key],P=this.proxyToSource[C.key],k=0;for(let N in P){let B=P[N],V=M[N];if(!V||V.length!==B.length||B.some((G,H)=>G!==V[H]||v[N]&&v[N].hasOwnProperty(G.key))){k=-1;break}++k}for(let N in h.proxyCachedFBO[C.key])h.renderCache[h.proxyCachedFBO[C.key][N]].dirty=k<0||k!==Object.values(M).length}}let x=[...this._drapedRenderBatches];x.sort((E,C)=>C.end-C.start-(E.end-E.start));for(let E of x)for(let C of g){if(h.proxyCachedFBO[C.key])continue;let M=h.renderCachePool.pop();M===void 0&&h.renderCache.length<50&&(M=h.renderCache.length,h.renderCache.push(this._createFBO())),M!==void 0&&(h.proxyCachedFBO[C.key]={},h.proxyCachedFBO[C.key][E.start]=M,h.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,E=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let C;if(g.isTileClipped())C=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):r.ag.disabled}_renderTileClippingMasks(s,h){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let E=g.getOrCreateProgram("clippingMask");for(let C of s){let M=g._tileClippingMaskIDs[C.key]=--h;E.draw(g,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,Xh(C.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){let h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;let g=[s.x,s.y,1,1];r.aA.transformMat4(g,g,h.pixelMatrixInverse),r.aA.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;let v=h._camera.position,x=r.ax(1,h.center.lat),E=[v[0],v[1],v[2]/x,0],C=r._.subtract([],g.slice(0,3),E);r._.normalize(C,C);let M=this.raycast(E,C,this._exaggeration);return M!==null&&M?(r._.scaleAndAdd(E,E,C,M),E[3]=E[2],E[2]*=x,E):null}drawDepth(){let s=this.painter,h=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let E=h.gl,C=h.createFramebuffer(v,x,!0,"renderbuffer");h.activeTexture.set(E.TEXTURE0);let M=new r.T(h,{width:v,height:x,data:null},E.RGBA);M.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(M.texture);let P=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);C.depthAttachment.set(P),this._depthFBO=C,this._depthTexture=M}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(E,C,M,P){if(E.transform.projection.name==="globe")return;let k=E.context,N=k.gl;k.clear({depth:1});let B=E.getOrCreateProgram("terrainDepth"),V=new r.ae(N.LESS,r.ae.ReadWrite,E.depthRangeFor3D);for(let G of P){let H=M.getTile(G),q=lt(G.projMatrix,0,[0,0,0]);C.setupElevationDraw(H,B),B.draw(E,N.TRIANGLES,V,r.ag.disabled,r.a.unblended,r.af.backCCW,q,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof r.bm)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let M=0;M<x.length;M++){let P=x[M],k=this._findTileCoveringTileID(P,s);if(k){let N=this._createProxiedId(P,k,g[P.key]&&g[P.key][s.id]);v.push(N),this.proxyToSource[P.key][s.id]=[N]}}let E=!1,C=new Set;for(let M=0;M<h.length;M++){let P=s.getTile(h[M]);if(!P||!P.hasData())continue;let k=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==P.tileID.canonical.z){let N=this.proxyToSource[k.tileID.key][s.id],B=this._createProxiedId(k.tileID,P,g[k.tileID.key]&&g[k.tileID.key][s.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[k.tileID.key][s.id]=[B];let V=this.proxyToSource[k.tileID.key][s.id];C.has(V)||C.add(V),v.push(B),E=!0}}if(this._sourceTilesOverlap[s.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(let M of C)M.sort((P,k)=>k.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords,E=s.getSource(),C=E.tileID;if(!C)return;let M=new r.P(C.x,C.y)._div(1<<C.z),P=E.coordinates.map(r.Y.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-M.x),N.min.y=Math.min(N.min.y,B.y-M.y),N.max.x=Math.max(N.max.x,B.x-M.x),N.max.y=Math.max(N.max.y,B.y-M.y),N),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(N,B)=>{let V=N.wrap+N.canonical.x/(1<<N.canonical.z),G=N.canonical.y/(1<<N.canonical.z),H=r.a3/(1<<N.canonical.z),q=B.wrap+B.canonical.x/(1<<B.canonical.z),W=B.canonical.y/(1<<B.canonical.z);return V+H<q+P.min.x||V>q+P.max.x||G+H<W+P.min.y||G>W+P.max.y};for(let N=0;N<x.length;N++){let B=x[N];for(let V=0;V<h.length;V++){let G=s.getTile(h[V]);if(!G||!G.hasData()||k(B,G.tileID))continue;let H=this._createProxiedId(B,G,g[B.key]&&g[B.key][s.id]),q=this.proxyToSource[B.key][s.id];q?q.push(H):this.proxyToSource[B.key][s.id]=[H],v.push(H)}}}_createProxiedId(s,h,g){let v=this.orthoMatrix;if(g){let x=g.find(E=>E.key===h.tileID.key);if(x)return x}if(h.tileID.key!==s.key){let x=s.canonical.z-h.tileID.canonical.z,E,C,M;v=r.ad.create();let P=h.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(E=r.a3>>x,C=E*((h.tileID.canonical.x<<x)-s.canonical.x+P),M=E*((h.tileID.canonical.y<<x)-s.canonical.y)):(E=r.a3<<-x,C=r.a3*(h.tileID.canonical.x-(s.canonical.x+P<<-x)),M=r.a3*(h.tileID.canonical.y-(s.canonical.y<<-x))),r.ad.ortho(v,0,E,0,E,0,1),r.ad.translate(v,v,[C,M,0])}return new Tp(h.tileID,s.key,v)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[h.id],x=v[s.key];if(g=x?h.getTileByID(x):null,g&&g.hasData()||x===null)return g;let E=g?g.tileID:s,C=E.overscaledZ,M=h.getSource().minzoom,P=[];if(!x){let N=h.getSource().maxzoom;if(s.canonical.z>=N){let B=s.canonical.z-N;h.getSource().reparseOverscaled?(C=Math.max(s.canonical.z+2,h.transform.tileZoom),E=new r.aL(C,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B)):B!==0&&(C=N,E=new r.aL(C,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B))}E.key!==s.key&&(P.push(E.key),g=h.getTile(E))}let k=N=>{P.forEach(B=>{v[B]=N}),P.length=0};for(C-=1;C>=M&&(!g||!g.hasData());C--){g&&k(g.tileID.key);let N=E.calculateScaledKey(C);if(g=h.getTileByID(N),g&&g.hasData())break;let B=v[N];if(B===null)break;B===void 0?P.push(N):g=h.getTileByID(B)}return k(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}}function as(p,s,h){let g=function(C,M,P){let k=r._.dot(M,C),N=r._.dot(P,[.2126,.7152,.0722]),B=(G,H,q)=>(1-q)*G+q*H,V=B(1-.3*Math.min(N,1),1,Math.min(k+1,1));return B(.92,1,Math.asin(r.at(M[2],-1,1))/Math.PI+.5)*V}(p,[0,0,1],s),v=[0,0,0];r._.scale(v,h.slice(0,3),g);let x=[0,0,0];r._.scale(x,s.slice(0,3),p[2]);let E=[0,0,0];return r._.add(E,v,x),r.b8(E)}let Qh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],P_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class au{static cacheKey(s,h,g,v){let x=`${h}${v?v.cacheKey:""}`;for(let E of g)s.usedDefines.includes(E)&&(x+=`/${E}`);return x}constructor(s,h,g,v,x,E){let C=s.gl;this.program=C.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...E];let M=v?v.getBinderAttributes():[],P=(g.staticAttributes||[]).concat(M),k=v?v.defines():[];k=k.concat(E.map(q=>`#define ${q}`));let N=`#version 300 es
`,B=N+k.concat("precision mediump float;",C_,T_.fragmentSource).join(`
`);for(let q of g.fragmentIncludes)B+=`
${jh[q]}`;B+=`
${g.fragmentSource}`;let V=N+k.concat("precision highp float;",C_,T_.vertexSource).join(`
`);for(let q of g.vertexIncludes)V+=`
${jh[q]}`;V+=`
${g.vertexSource}`;let G=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(G,B),C.compileShader(G),C.attachShader(this.program,G);let H=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(H,V),C.compileShader(H),C.attachShader(this.program,H),this.attributes={},this.numAttributes=P.length;for(let q=0;q<this.numAttributes;q++)if(P[q]){let W=P[q].startsWith("a_")?P[q]:`a_${P[q]}`;C.bindAttribLocation(this.program,q,W),this.attributes[W]=q}C.linkProgram(this.program),C.deleteShader(H),C.deleteShader(G),this.fixedUniforms=x(s),this.binderUniforms=v?v.getUniforms(s):[],E.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new r.a7(q),u_dem_prev:new r.a7(q),u_dem_tl:new r.a8(q),u_dem_scale:new r.aa(q),u_dem_tl_prev:new r.a8(q),u_dem_scale_prev:new r.aa(q),u_dem_size:new r.aa(q),u_dem_lerp:new r.aa(q),u_exaggeration:new r.aa(q),u_depth:new r.a7(q),u_depth_size_inv:new r.a8(q),u_meter_to_dem:new r.aa(q),u_label_plane_matrix_inv:new r.a6(q)}))(s)),E.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new r.aq(q),u_tile_tr_up:new r.aq(q),u_tile_br_up:new r.aq(q),u_tile_bl_up:new r.aq(q),u_tile_up_scale:new r.aa(q)}))(s)),E.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new r.a6(q),u_fog_range:new r.a8(q),u_fog_color:new r.as(q),u_fog_horizon_blend:new r.aa(q),u_fog_vertical_limit:new r.a8(q),u_fog_temporal_offset:new r.aa(q),u_frustum_tl:new r.aq(q),u_frustum_tr:new r.aq(q),u_frustum_br:new r.aq(q),u_frustum_bl:new r.aq(q),u_globe_pos:new r.aq(q),u_globe_radius:new r.aa(q),u_globe_transition:new r.aa(q),u_is_globe:new r.a7(q),u_viewport:new r.a8(q)}))(s)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new r.as(q)}))(s)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new r.aq(q),u_lighting_directional_dir:new r.aq(q),u_lighting_directional_color:new r.aq(q),u_ground_radiance:new r.aq(q)}))(s)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new r.a6(q),u_light_matrix_1:new r.a6(q),u_fade_range:new r.a8(q),u_shadow_normal_offset:new r.aq(q),u_shadow_intensity:new r.aa(q),u_shadow_texel_size:new r.aa(q),u_shadow_map_resolution:new r.aa(q),u_shadow_direction:new r.aq(q),u_shadow_bias:new r.aq(q),u_shadowmap_0:new r.a7(q),u_shadowmap_1:new r.a7(q)}))(s))}}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(s,h){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(s,h){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(s,h){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(s,h,g,v,x,E,C,M,P,k){let N=s.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;let B=s.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||s._terrain&&s._terrain.renderingToTexture||!Qh.includes(this.name))||!(!N.layers3D||!P_.includes(this.name))))return;let V=B.gl,G=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,B);if(!G)return;let H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");let q=s.getOrCreateProgram(this.name,{config:this.configuration,defines:H});B.program.set(q.program);let W=(ne,ue,ce)=>{if(ue[ne]&&ce[ne])for(let J in ue[ne])ce[ne][J]&&ce[ne][J].set(ce.program,J,ue[ne][J].current)};P&&P.setUniforms(q.program,B,q.binderUniforms,C,{zoom:M}),W("fixedUniforms",this,q),W("terrainUniforms",this,q),W("globeUniforms",this,q),W("fogUniforms",this,q),W("lightsUniforms",this,q),W("shadowUniforms",this,q),G.bind(),B.setColorMode(new r.a([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.C.transparent,[!0,!0,!0,!1])),B.setDepthMode(new r.ae(h.func===V.LESS?V.LEQUAL:h.func,r.ae.ReadOnly,h.range)),B.setStencilMode(r.ag.disabled);let ee=3*E.primitiveLength*2,te=3*E.primitiveOffset*2*2;k&&k>1?V.drawElementsInstanced(V.LINES,ee,V.UNSIGNED_SHORT,te,k):V.drawElements(V.LINES,ee,V.UNSIGNED_SHORT,te),x.bind(),B.program.set(this.program),B.setDepthMode(h),B.setStencilMode(g),B.setColorMode(v)}draw(s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q){let W=s.context,ee=W.gl;if(this.failedToCreate)return;W.program.set(this.program),W.setDepthMode(g),W.setStencilMode(v),W.setColorMode(x),W.setCullFace(E);for(let ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,C[ue]);G&&G.setUniforms(this.program,W,this.binderUniforms,B,{zoom:V});let te={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[h],ne=q&&q>0?1:void 0;for(let ue of N.get()){let ce=ue.vaos||(ue.vaos={});(ce[M]||(ce[M]=new u1)).bind(W,this,P,G?G.getPaintVertexBuffers():[],k,ue.vertexOffset,H||[],ne),q&&q>1?ee.drawElementsInstanced(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2,q):k?ee.drawElements(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2):ee.drawArrays(h,ue.vertexOffset,ue.vertexLength),h===ee.TRIANGLES&&k&&this._drawDebugWireframe(s,g,v,x,k,ue,B,V,G,q)}}}function Jh(p,s){let h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,p.transform.tileZoom)/h,v=g*(s.tileID.canonical.x+s.tileID.wrap*h),x=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.bB(s,1,p.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let ed=r.ad.create(),Ol=(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H)=>{let q=s.style.light,W=q.properties.get("position"),ee=[W.x,W.y,W.z],te=r.bC.create();q.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(te,-s.transform.angle),r._.transformMat3(ee,ee,te));let ne=q.properties.get("color"),ue=s.transform,ce={u_matrix:p,u_lightpos:ee,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ed,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:N,u_vertical_scale:B,u_flood_light_intensity:V,u_ground_shadow_factor:G,u_emissive_strength:H};return ue.projection.name==="globe"&&(ce.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ce.u_zoom_transition=M,ce.u_inv_rot_matrix=k,ce.u_merc_center=P,ce.u_up_dir=ue.projection.upVector(new r.aO(0,0,0),P[0]*r.a3,P[1]*r.a3),ce.u_height_lift=C),ce},kl=(p,s,h)=>({u_matrix:p,u_edge_radius:s,u_vertical_scale:h}),Sp=(p,s,h,g,v,x,E,C,M,P,k,N,B,V)=>{let G=Ol(p,s,h,g,v,x,E,M,P,k,N,B,V,1,[0,0,0],0),H={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return r.W(G,Jh(s,C),H)},Ip=(p,s)=>({u_matrix:p,u_emissive_strength:s}),Dp=(p,s,h,g)=>r.W(Ip(p,s),Jh(h,g)),R_=(p,s,h)=>({u_matrix:p,u_world:h,u_emissive_strength:s}),td=(p,s,h,g,v)=>r.W(Dp(p,s,h,g),{u_world:v}),Mp=(p,s,h,g)=>{let v=r.a3/h.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},nd=(p,s,h=1)=>({u_matrix:p,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),lu=r.ad.create(),Oa=(p,s,h,g,v,x,E)=>{let C=p.transform,M=C.projection.name==="globe",P=M?r.bD(C.zoom,s.canonical)*C._pixelsPerMercatorPixel:r.bB(h,1,x),k={u_matrix:s.projMatrix,u_extrude_scale:P,u_intensity:E,u_inv_rot_matrix:lu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){k.u_inv_rot_matrix=g,k.u_merc_center=v,k.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],k.u_zoom_transition=r.a1(C.zoom);let N=v[0]*r.a3,B=v[1]*r.a3;k.u_up_dir=C.projection.upVector(new r.aO(0,0,0),N,B)}return k};function O_(p,[s,h,g,v],[x,E]){if(x===E)return[0,0,0,0];let C=255*(p-1)/(p*(E-x));return[s*C,h*C,g*C,v*C]}function Ap(p,s,[h,g]){return h===g?0:.5/p+(s-h)*(p-1)/(p*(g-h))}let cu=(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q,W,ee,te,ne)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:k.mix,u_opacity:k.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:r.bE(N.paint.get("raster-saturation")),u_contrast_factor:r.bF(N.paint.get("raster-contrast")),u_spin_weights:uu(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:V,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:M,u_colorization_mix:O_(r.bG,H,W),u_colorization_offset:Ap(r.bG,q,W),u_color_ramp:G,u_texture_offset:[te/(ee+2*te),ee/(ee+2*te)],u_texture_res:[ee+2*te,ee+2*te],u_emissive_strength:ne});function uu(p){p*=Math.PI/180;let s=Math.sin(p),h=Math.cos(p);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}let Vs=.15,Pp=(p,s,h,g,v,x,E,C,M,P,k,N)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:M}),Rp=(p,s,h,g,v,x,E,C,M,P)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_tile_offset:h,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:E,u_uv_offset:C,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[Vs,Vs]}),p1=(p,s,h,g,v,x,E,C,M,P)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[Vs,Vs]}),vo=r.ad.create(),Ll=(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q,W)=>{let ee=v.transform,te={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ee.getCameraToCenterDistance(H),u_rotate_symbol:+h,u_aspect_ratio:ee.width/ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+g,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:vo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:vo,u_up_vector:[0,-1,0],u_color_adj_mat:q,u_icon_transition:W||0};return H.name==="globe"&&(te.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],te.u_zoom_transition=N,te.u_inv_rot_matrix=V,te.u_merc_center=B,te.u_camera_forward=ee._camera.forward(),te.u_ecef_origin=r.bH(ee.globeMatrix,k.toUnwrapped()),te.u_tile_matrix=Float32Array.from(ee.globeMatrix),te.u_up_vector=G),te},rd=(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q)=>r.W(Ll(p,s,h,g,v,x,E,C,M,P,N,B,V,G,H,q),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(q)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.e.devicePixelRatio,u_is_halo:+k,undefined:void 0}),k_=(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H)=>r.W(rd(p,s,h,g,v,x,E,C,!0,M,!0,k,N,B,V,G,H),{u_texsize_icon:P,u_texture_icon:1}),hu=(p,s,h,g)=>({u_matrix:p,u_emissive_strength:s,u_opacity:h,u_color:g}),L_=(p,s,h,g,v,x,E,C)=>r.W(function(M,P,k,N,B){let{width:V,height:G}=N.imageManager.getPixelSize(P),H=Math.pow(2,B.tileID.overscaledZ),q=B.tileSize*Math.pow(2,N.transform.tileZoom)/H,W=q*(B.tileID.canonical.x+B.tileID.wrap*H),ee=q*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[V,G],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/r.bB(B,1,N.transform.tileZoom),u_pixel_coord_upper:[W>>16,ee>>16],u_pixel_coord_lower:[65535&W,65535&ee]}}(0,x,E,g,C),{u_matrix:p,u_emissive_strength:s,u_opacity:h}),Op=new Float32Array(r.ad.identity([])),du=(p,s,h,g,v,x,E,C,M,P,k,N,B,V=[0,0,0],G)=>{let H=v.style.light,q=H.properties.get("position"),W=[-q.x,-q.y,q.z],ee=r.bC.create();H.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(ee,-v.transform.angle),r._.transformMat3(W,W,ee));let te=k.alphaMode==="MASK",ne=H.properties.get("color").toRenderColor(null),ue=B.paint.get("model-ambient-occlusion-intensity"),ce=B.paint.get("model-color").constantOr(r.C.white).toRenderColor(null),J=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:s,u_normal_matrix:h,u_node_matrix:g||Op,u_lightpos:W,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:V,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+te,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:M,u_roughnessFactor:P,u_baseColorTexture:vi.BaseColor,u_metallicRoughnessTexture:vi.MetallicRoughness,u_normalTexture:vi.Normal,u_occlusionTexture:vi.Occlusion,u_emissionTexture:vi.Emission,u_lutTexture:vi.LUT,u_color_mix:[ce.r,ce.g,ce.b,J],u_aoIntensity:ue,u_emissive_strength:N,u_occlusionTextureTransform:G||[0,0,0,0]}},F_=(p,s=Op,h=Op)=>({u_matrix:p,u_instance:s,u_node_matrix:h}),N_=(p,s,h,g,v)=>({u_matrix:Float32Array.from(p),u_anchorPos:s,u_screenSizePx:h,u_occluderSizePx:g,u_color:v}),m1={fillExtrusion:p=>({u_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_vertical_gradient:new r.aa(p),u_opacity:new r.aa(p),u_edge_radius:new r.aa(p),u_ao:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_up_dir:new r.aq(p),u_height_lift:new r.aa(p),u_flood_light_color:new r.aq(p),u_vertical_scale:new r.aa(p),u_flood_light_intensity:new r.aa(p),u_ground_shadow_factor:new r.aq(p),u_emissive_strength:new r.aa(p)}),fillExtrusionDepth:p=>({u_matrix:new r.a6(p),u_edge_radius:new r.aa(p),u_vertical_scale:new r.aa(p)}),fillExtrusionPattern:p=>({u_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_vertical_gradient:new r.aa(p),u_height_factor:new r.aa(p),u_edge_radius:new r.aa(p),u_ao:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_up_dir:new r.aq(p),u_height_lift:new r.aa(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p),u_opacity:new r.aa(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.a6(p),u_opacity:new r.aa(p),u_ao_pass:new r.aa(p),u_meter_to_tile:new r.aa(p),u_ao:new r.a8(p),u_flood_light_intensity:new r.aa(p),u_flood_light_color:new r.aq(p),u_attenuation:new r.aa(p),u_edge_radius:new r.aa(p),u_fb:new r.a7(p),u_fb_size:new r.aa(p)}),fill:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p)}),fillPattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),fillOutline:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_world:new r.a8(p)}),fillOutlinePattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_world:new r.a8(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),circle:r.bI,collisionBox:p=>({u_matrix:new r.a6(p),u_camera_to_center_distance:new r.aa(p),u_extrude_scale:new r.a8(p)}),collisionCircle:p=>({u_matrix:new r.a6(p),u_inv_matrix:new r.a6(p),u_camera_to_center_distance:new r.aa(p),u_viewport_size:new r.a8(p)}),debug:p=>({u_color:new r.a9(p),u_matrix:new r.a6(p),u_overlay:new r.a7(p),u_overlay_scale:new r.aa(p)}),clippingMask:p=>({u_matrix:new r.a6(p)}),heatmap:p=>({u_extrude_scale:new r.aa(p),u_intensity:new r.aa(p),u_matrix:new r.a6(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_up_dir:new r.aq(p)}),heatmapTexture:p=>({u_image:new r.a7(p),u_color_ramp:new r.a7(p),u_opacity:new r.aa(p)}),hillshade:p=>({u_matrix:new r.a6(p),u_image:new r.a7(p),u_latrange:new r.a8(p),u_light:new r.a8(p),u_shadow:new r.a9(p),u_highlight:new r.a9(p),u_emissive_strength:new r.aa(p),u_accent:new r.a9(p)}),hillshadePrepare:p=>({u_matrix:new r.a6(p),u_image:new r.a7(p),u_dimension:new r.a8(p),u_zoom:new r.aa(p)}),line:r.bJ,linePattern:r.bK,raster:p=>({u_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_grid_matrix:new r.ar(p),u_tl_parent:new r.a8(p),u_scale_parent:new r.aa(p),u_fade_t:new r.aa(p),u_opacity:new r.aa(p),u_image0:new r.a7(p),u_image1:new r.a7(p),u_brightness_low:new r.aa(p),u_brightness_high:new r.aa(p),u_saturation_factor:new r.aa(p),u_contrast_factor:new r.aa(p),u_spin_weights:new r.aq(p),u_perspective_transform:new r.a8(p),u_raster_elevation:new r.aa(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_cutoff_params:new r.as(p),u_colorization_mix:new r.as(p),u_colorization_offset:new r.aa(p),u_color_ramp:new r.a7(p),u_texture_offset:new r.a8(p),u_texture_res:new r.a8(p),u_emissive_strength:new r.aa(p)}),rasterParticle:p=>({u_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_grid_matrix:new r.ar(p),u_tl_parent:new r.a8(p),u_scale_parent:new r.aa(p),u_fade_t:new r.aa(p),u_opacity:new r.aa(p),u_image0:new r.a7(p),u_image1:new r.a7(p),u_raster_elevation:new r.aa(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_cutoff_params:new r.as(p)}),rasterParticleTexture:p=>({u_texture:new r.a7(p),u_opacity:new r.aa(p)}),rasterParticleDraw:p=>({u_particle_texture:new r.a7(p),u_particle_texture_side_len:new r.aa(p),u_tile_offset:new r.a8(p),u_velocity:new r.a7(p),u_color_ramp:new r.a7(p),u_velocity_res:new r.a8(p),u_max_speed:new r.aa(p),u_uv_offset:new r.a8(p),u_data_scale:new r.as(p),u_data_offset:new r.aa(p),u_particle_pos_scale:new r.aa(p),u_particle_pos_offset:new r.a8(p)}),rasterParticleUpdate:p=>({u_particle_texture:new r.a7(p),u_particle_texture_side_len:new r.aa(p),u_velocity:new r.a7(p),u_velocity_res:new r.a8(p),u_max_speed:new r.aa(p),u_speed_factor:new r.aa(p),u_reset_rate:new r.aa(p),u_rand_seed:new r.aa(p),u_uv_offset:new r.a8(p),u_data_scale:new r.as(p),u_data_offset:new r.aa(p),u_particle_pos_scale:new r.aa(p),u_particle_pos_offset:new r.a8(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_camera_forward:new r.aq(p),u_tile_matrix:new r.a6(p),u_up_vector:new r.aq(p),u_ecef_origin:new r.aq(p),u_texture:new r.a7(p),u_icon_transition:new r.aa(p),u_color_adj_mat:new r.a6(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_texture:new r.a7(p),u_gamma_scale:new r.aa(p),u_device_pixel_ratio:new r.aa(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_camera_forward:new r.aq(p),u_tile_matrix:new r.a6(p),u_up_vector:new r.aq(p),u_ecef_origin:new r.aq(p),u_is_halo:new r.a7(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_texsize_icon:new r.a8(p),u_texture:new r.a7(p),u_texture_icon:new r.a7(p),u_gamma_scale:new r.aa(p),u_device_pixel_ratio:new r.aa(p),u_is_halo:new r.a7(p)}),background:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_opacity:new r.aa(p),u_color:new r.a9(p)}),backgroundPattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_opacity:new r.aa(p),u_image:new r.a7(p),u_pattern_tl:new r.a8(p),u_pattern_br:new r.a8(p),u_texsize:new r.a8(p),u_pattern_size:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),terrainRaster:Da,terrainDepth:Da,skybox:p=>({u_matrix:new r.a6(p),u_sun_direction:new r.aq(p),u_cubemap:new r.a7(p),u_opacity:new r.aa(p),u_temporal_offset:new r.aa(p)}),skyboxGradient:p=>({u_matrix:new r.a6(p),u_color_ramp:new r.a7(p),u_center_direction:new r.aq(p),u_radius:new r.aa(p),u_opacity:new r.aa(p),u_temporal_offset:new r.aa(p)}),skyboxCapture:p=>({u_matrix_3f:new r.ar(p),u_sun_direction:new r.aq(p),u_sun_intensity:new r.aa(p),u_color_tint_r:new r.as(p),u_color_tint_m:new r.as(p),u_luminance:new r.aa(p)}),globeRaster:p=>({u_proj_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_image0:new r.a7(p),u_grid_matrix:new r.ar(p),u_skirt_height:new r.aa(p),u_far_z_cutoff:new r.aa(p),u_frustum_tl:new r.aq(p),u_frustum_tr:new r.aq(p),u_frustum_br:new r.aq(p),u_frustum_bl:new r.aq(p),u_globe_pos:new r.aq(p),u_globe_radius:new r.aa(p),u_viewport:new r.a8(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.aq(p),u_frustum_tr:new r.aq(p),u_frustum_br:new r.aq(p),u_frustum_bl:new r.aq(p),u_horizon:new r.aa(p),u_transition:new r.aa(p),u_fadeout_range:new r.aa(p),u_color:new r.as(p),u_high_color:new r.as(p),u_space_color:new r.as(p),u_temporal_offset:new r.aa(p),u_horizon_angle:new r.aa(p)}),model:p=>({u_matrix:new r.a6(p),u_lighting_matrix:new r.a6(p),u_normal_matrix:new r.a6(p),u_node_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_camera_pos:new r.aq(p),u_opacity:new r.aa(p),u_baseColorFactor:new r.as(p),u_emissiveFactor:new r.as(p),u_metallicFactor:new r.aa(p),u_roughnessFactor:new r.aa(p),u_baseTextureIsAlpha:new r.a7(p),u_alphaMask:new r.a7(p),u_alphaCutoff:new r.aa(p),u_baseColorTexture:new r.a7(p),u_metallicRoughnessTexture:new r.a7(p),u_normalTexture:new r.a7(p),u_occlusionTexture:new r.a7(p),u_emissionTexture:new r.a7(p),u_lutTexture:new r.a7(p),u_color_mix:new r.as(p),u_aoIntensity:new r.aa(p),u_emissive_strength:new r.aa(p),u_occlusionTextureTransform:new r.as(p)}),modelDepth:p=>({u_matrix:new r.a6(p),u_instance:new r.a6(p),u_node_matrix:new r.a6(p)}),groundShadow:p=>({u_matrix:new r.a6(p),u_ground_shadow_factor:new r.aq(p)}),stars:p=>({u_matrix:new r.a6(p),u_up:new r.aq(p),u_right:new r.aq(p),u_intensity_multiplier:new r.aa(p)}),occlusion:p=>({u_matrix:new r.a6(p),u_anchorPos:new r.aq(p),u_screenSizePx:new r.a8(p),u_occluderSizePx:new r.a8(p),u_color:new r.as(p)})};function id(p,s,h){let g=s.createTileMatrix(p,p.worldSize,h.toUnwrapped());return r.ad.multiply(new Float32Array(16),p.projMatrix,g)}function g1(p,s,h){if(s.projection.name===h.projection.name)return p.projMatrix;let g=h.clone();return g.setProjection(s.projection),id(g,s.getProjection(),p)}function Fl(p,s,h){return s.name===h.projection.name?p.projMatrix:id(h,s,p)}let od;function fu(p,s,h,g,v,x,E){let C=p.context,M=C.gl,P=p.transform,k=p.getOrCreateProgram("collisionBox"),N=[],B=0,V=0;for(let ne=0;ne<g.length;ne++){let ue=g[ne],ce=s.getTile(ue),J=ce.getBucket(h);if(!J)continue;let re=g1(ue,J,P),ie=re;v[0]===0&&v[1]===0||(ie=p.translatePosMatrix(re,ce,v,x));let ge=E?J.textCollisionBox:J.iconCollisionBox,Ce=J.collisionCircleArray;if(Ce.length>0){let ae=r.ad.create(),Se=ie;r.ad.mul(ae,J.placementInvProjMatrix,P.glCoordMatrix),r.ad.mul(ae,ae,J.placementViewportMatrix),N.push({circleArray:Ce,circleOffset:V,transform:Se,invTransform:ae,projection:J.getProjection()}),B+=Ce.length/4,V=B}ge&&(p.terrain&&p.terrain.setupElevationDraw(ce,k),k.draw(p,M.LINES,r.ae.disabled,r.ag.disabled,p.colorModeForRenderPass(),r.af.disabled,Mp(ie,P,ce,J.getProjection()),h.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,P.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!E||!N.length)return;let G=p.getOrCreateProgram("collisionCircle"),H=new r.bL;H.resize(4*B),H._trim();let q=0;for(let ne of N)for(let ue=0;ue<ne.circleArray.length/4;ue++){let ce=4*ue,J=ne.circleArray[ce+0],re=ne.circleArray[ce+1],ie=ne.circleArray[ce+2],ge=ne.circleArray[ce+3];H.emplace(q++,J,re,ie,ge,0),H.emplace(q++,J,re,ie,ge,1),H.emplace(q++,J,re,ie,ge,2),H.emplace(q++,J,re,ie,ge,3)}(!od||od.length<2*B)&&(od=function(ne){let ue=2*ne,ce=new r.bu;ce.resize(ue),ce._trim();for(let J=0;J<ue;J++){let re=6*J;ce.uint16[re+0]=4*J+0,ce.uint16[re+1]=4*J+1,ce.uint16[re+2]=4*J+2,ce.uint16[re+3]=4*J+2,ce.uint16[re+4]=4*J+3,ce.uint16[re+5]=4*J+0}return ce}(B));let W=C.createIndexBuffer(od,!0),ee=C.createVertexBuffer(H,r.bM.members,!0);for(let ne of N){let ue={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(te=P).getCameraToCenterDistance(ne.projection),u_viewport_size:[te.width,te.height]};G.draw(p,M.TRIANGLES,r.ae.disabled,r.ag.disabled,p.colorModeForRenderPass(),r.af.disabled,ue,h.id,ee,W,r.b.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,P.zoom)}var te;ee.destroy(),W.destroy()}let ka=r.ad.create();function z_(p){let s=p._camera.getWorldToCamera(p.worldSize,1),h=r.ad.multiply([],s,p.globeMatrix);r.ad.invert(h,h);let g=[0,0,0],v=[0,1,0,0];return r.aA.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],r._.normalize(g,g),g}function _1({width:p,height:s,anchor:h,textOffset:g,textScale:v},x){let{horizontalAlign:E,verticalAlign:C}=r.bQ(h),M=-(E-.5)*p,P=-(C-.5)*s,k=r.bP(h,g);return new r.P((M/v+k[0])*x,(P/v+k[1])*x)}function B_(p,s,h,g,v,x,E,C,M,P,k){let N=p.text.placedSymbolArray,B=p.text.dynamicLayoutVertexArray,V=p.icon.dynamicLayoutVertexArray,G={},H=p.getProjection(),q=Fl(C,H,x),W=x.elevation,ee=H.upVectorScale(C.canonical,x.center.lat,x.worldSize).metersToTile;B.clear();for(let te=0;te<N.length;te++){let ne=N.get(te),{tileAnchorX:ue,tileAnchorY:ce,numGlyphs:J}=ne,re=ne.hidden||!ne.crossTileID||p.allowVerticalPlacement&&!ne.placedOrientation?null:g[ne.crossTileID];if(re){let ie=0,ge=0,Ce=0;if(W){let Fe=W?W.getAtTileOffset(C,ue,ce):0,[ot,ct,at]=H.upVector(C.canonical,ue,ce);ie=Fe*ot*ee,ge=Fe*ct*ee,Ce=Fe*at*ee}let[ae,Se,Me,$e]=ro(ne.projectedAnchorX+ie,ne.projectedAnchorY+ge,ne.projectedAnchorZ+Ce,h?q:E),Ge=li(x.getCameraToCenterDistance(H),$e),Ve=v.evaluateSizeForFeature(p.textSizeData,P,ne)*Ge/r.bN;h&&(Ve*=p.tilePixelRatio/M);let xe=_1(re,Ve);h?({x:ae,y:Se,z:Me}=H.projectTilePoint(ue+xe.x,ce+xe.y,C.canonical),[ae,Se,Me]=ro(ae+ie,Se+ge,Me+Ce,E)):(s&&xe._rotate(-x.angle),ae+=xe.x,Se+=xe.y,Me=0);let Re=p.allowVerticalPlacement&&ne.placedOrientation===r.aE.vertical?Math.PI/2:0;for(let Fe=0;Fe<J;Fe++)r.aH(B,ae,Se,Me,Re);k&&ne.associatedIconIndex>=0&&(G[ne.associatedIconIndex]={x:ae,y:Se,z:Me,angle:Re})}else Pa(J,B)}if(k){V.clear();let te=p.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){let ue=te.get(ne),{numGlyphs:ce}=ue,J=G[ne];if(ue.hidden||!J)Pa(ce,V);else{let{x:re,y:ie,z:ge,angle:Ce}=J;for(let ae=0;ae<ce;ae++)r.aH(V,re,ie,ge,Ce)}}p.icon.dynamicLayoutVertexBuffer.updateData(V)}p.text.dynamicLayoutVertexBuffer.updateData(B)}function kp(p,s,h,g,v,x,E={}){let C=h.paint.get("icon-translate"),M=h.paint.get("text-translate"),P=h.paint.get("icon-translate-anchor"),k=h.paint.get("text-translate-anchor"),N=h.layout.get("icon-rotation-alignment"),B=h.layout.get("text-rotation-alignment"),V=h.layout.get("icon-pitch-alignment"),G=h.layout.get("text-pitch-alignment"),H=h.layout.get("icon-keep-upright"),q=h.layout.get("text-keep-upright"),W=h.paint.get("icon-color-saturation"),ee=h.paint.get("icon-color-contrast"),te=h.paint.get("icon-color-brightness-min"),ne=h.paint.get("icon-color-brightness-max"),ue=h.paint.get("icon-occlusion-opacity").constantOr(0),ce=h.paint.get("text-occlusion-opacity").constantOr(0),J=p.context,re=J.gl,ie=p.transform,ge=N==="map",Ce=B==="map",ae=V==="map",Se=G==="map",Me=ue!==1||ce!==1,$e=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ge=!1,Ve=p.depthModeForSublayer(0,r.ae.ReadOnly),xe=[r.aj(ie.center.lng),r.ak(ie.center.lat)],Re=h.layout.get("text-variable-anchor"),Fe=ie.projection.name==="globe",ot=[],ct=[0,-1,0];for(let at of g){let je=s.getTile(at),He=je.getBucket(h);if(!He||He.projection.name==="mercator"&&Fe||He.fullyClipped)continue;let st=He.projection.name==="globe",pt=st?r.a1(ie.zoom):0,Ot=Fl(at,He.getProjection(),ie),$t=ie.calculatePixelsToTileUnitsMatrix(je),cn=Re&&He.hasTextData(),on=He.hasIconTextFit()&&cn&&He.hasIconData(),An=He.getProjection().createInversionMatrix(ie,at.canonical),Bt=()=>{let un=ge&&h.layout.get("symbol-placement")!=="point",Be=[];Me&&p.symbolParams.useOcclusionQueries&&!st&&!Fe&&Be.push("OCCLUSION_QUERIES");let ut=un||on,Lr=h.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&ae&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),Lr>0&&Be.push("ICON_TRANSITION"),He.icon.zOffsetVertexBuffer&&Be.push("Z_OFFSET"),W===0&&ee===0&&te===0&&ne===1||Be.push("COLOR_ADJUSTMENT");let Pn=He.icon.programConfigurations.get(h.id),Te=p.getOrCreateProgram(He.sdfIcons?"symbolSDF":"symbolIcon",{config:Pn,defines:Be}),Mi,ui=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],Br=He.iconSizeData,bi=r.aD(Br,ie.zoom),Ni=ae||ie.pitch!==0,so=Ma(Ot,je.tileID.canonical,ae,ge,ie,He.getProjection(),$t),qi=Ml(Ot,je.tileID.canonical,ae,ge,ie,He.getProjection(),$t),Zs=p.translatePosMatrix(qi,je,C,P,!0),Xs=p.translatePosMatrix(Ot,je,C,P),us=ut?ka:so,Ho=ge&&!ae&&!un,hs=ct;!Fe&&!ie.mercatorFromTransition||ge||(hs=z_(ie));let Xl=st?hs:ct;if(He.sdfIcons&&!He.iconsInText)Mi=rd(Br.kind,bi,Ho,ae,p,Xs,us,Zs,!1,ui,!0,at,pt,xe,An,Xl,He.getProjection());else{let Ha=h.getColorAdjustmentMatrix(W,ee,te,ne);Mi=Ll(Br.kind,bi,Ho,ae,p,Xs,us,Zs,!1,ui,at,pt,xe,An,Xl,He.getProjection(),Ha,Lr)}let Fu=je.imageAtlasTexture?je.imageAtlasTexture:null,Yl=h.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear,Kl=He.sdfIcons||p.options.rotating||p.options.zooming||Yl||Ni?re.LINEAR:re.NEAREST,Sd=He.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,Id=p.terrain&&ae&&un?r.ad.invert(r.ad.create(),so):ka;if(un&&He.icon){let Ha=ie.elevation,hi=Ha?Ha.getAtTileOffsetFunc(at,ie.center.lat,ie.worldSize,He.getProjection()):null,dm=Aa(Ot,je.tileID.canonical,ae,ge,ie,He.getProjection(),$t);Gh(He,Ot,p,!1,dm,qi,ae,H,hi,at)}return{program:Te,buffers:He.icon,uniformValues:Mi,atlasTexture:Fu,atlasTextureIcon:null,atlasInterpolation:Kl,atlasInterpolationIcon:null,isSDF:He.sdfIcons,hasHalo:Sd,tile:je,labelPlaneMatrixInv:Id}},Sn=()=>{let un=Ce&&h.layout.get("symbol-placement")!=="point",Be=[],ut=un||Re||on;Me&&p.symbolParams.useOcclusionQueries&&!st&&!Fe&&Be.push("OCCLUSION_QUERIES"),p.terrainRenderModeElevated()&&Se&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),He.text.zOffsetVertexBuffer&&Be.push("Z_OFFSET");let Lr=He.text.programConfigurations.get(h.id),Pn=p.getOrCreateProgram(He.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Lr,defines:Be}),Te,Mi=[0,0],ui=null,Br=He.textSizeData;He.iconsInText&&(Mi=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],ui=je.imageAtlasTexture?je.imageAtlasTexture:null,Te=Se||ie.pitch!==0||p.options.rotating||p.options.zooming||Br.kind==="composite"||Br.kind==="camera"?re.LINEAR:re.NEAREST);let bi=je.glyphAtlasTexture?je.glyphAtlasTexture.size:[0,0],Ni=r.aD(Br,ie.zoom),so=Ma(Ot,je.tileID.canonical,Se,Ce,ie,He.getProjection(),$t),qi=Ml(Ot,je.tileID.canonical,Se,Ce,ie,He.getProjection(),$t),Zs=p.translatePosMatrix(qi,je,M,k,!0),Xs=p.translatePosMatrix(Ot,je,M,k),us=ut?ka:so,Ho=Ce&&!Se&&!un,hs=ct;!Fe&&!ie.mercatorFromTransition||Ce||(hs=z_(ie));let Xl=st?hs:ct,Fu;Fu=He.iconsInText?k_(Br.kind,Ni,Ho,Se,p,Xs,us,Zs,bi,Mi,at,pt,xe,An,Xl,He.getProjection()):rd(Br.kind,Ni,Ho,Se,p,Xs,us,Zs,!0,bi,!0,at,pt,xe,An,Xl,He.getProjection());let Yl=je.glyphAtlasTexture?je.glyphAtlasTexture:null,Kl=re.LINEAR,Sd=h.paint.get("text-halo-width").constantOr(1)!==0,Id=p.terrain&&Se&&un?r.ad.invert(r.ad.create(),so):ka;if(un&&He.text){let Ha=ie.elevation,hi=Ha?Ha.getAtTileOffsetFunc(at,ie.center.lat,ie.worldSize,He.getProjection()):null,dm=Aa(Ot,je.tileID.canonical,Se,Ce,ie,He.getProjection(),$t);Gh(He,Ot,p,!0,dm,qi,Se,q,hi,at)}return{program:Pn,buffers:He.text,uniformValues:Fu,atlasTexture:Yl,atlasTextureIcon:ui,atlasInterpolation:Kl,atlasInterpolationIcon:Te,isSDF:!0,hasHalo:Sd,tile:je,labelPlaneMatrixInv:Id}},Gn=He.icon.segments.get().length,Rn=He.text.segments.get().length,tn=Gn&&!E.onlyText?Bt():null,Vt=Rn&&!E.onlyIcons?Sn():null,Xn=h.paint.get("icon-opacity").constantOr(1),Jn=h.paint.get("text-opacity").constantOr(1);if($e&&He.canOverlap){Ge=!0;let un=Xn&&!E.onlyText?He.icon.segments.get():[],Be=Jn&&!E.onlyIcons?He.text.segments.get():[];for(let ut of un)ot.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:tn});for(let ut of Be)ot.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:Vt})}else E.onlyText||ot.push({segments:Xn?He.icon.segments:new r.b([]),sortKey:0,state:tn}),E.onlyIcons||ot.push({segments:Jn?He.text.segments:new r.b([]),sortKey:0,state:Vt})}Ge&&ot.sort((at,je)=>at.sortKey-je.sortKey);for(let at of ot){let je=at.state;if(je)if(p.terrain&&p.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!1,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),J.activeTexture.set(re.TEXTURE0),je.atlasTexture&&je.atlasTexture.bind(je.atlasInterpolation,re.CLAMP_TO_EDGE,!0),je.atlasTextureIcon&&(J.activeTexture.set(re.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,re.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,je.program),je.hasHalo){let He=je.uniformValues;He.u_is_halo=1,Nl(je.buffers,at.segments,h,p,je.program,Ve,v,x,He,2),He.u_is_halo=0}else{if(je.isSDF){let He=je.uniformValues;je.hasHalo&&(He.u_is_halo=1,Nl(je.buffers,at.segments,h,p,je.program,Ve,v,x,He,1)),He.u_is_halo=0}Nl(je.buffers,at.segments,h,p,je.program,Ve,v,x,je.uniformValues,1)}}}function Nl(p,s,h,g,v,x,E,C,M,P){let k=g.context.gl,N=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];p.occlusionQueryOpacityVertexBuffer.length>0&&N.push(p.occlusionQueryOpacityVertexBuffer),v.draw(g,k.TRIANGLES,x,E,C,r.af.disabled,M,h.id,p.layoutVertexBuffer,p.indexBuffer,s,h.paint,g.transform.zoom,p.programConfigurations.get(h.id),N,P)}function Lp(p,s,h,g,v,x,E){let C=p.context.gl,M=h.paint.get("fill-pattern"),P=M&&M.constantOr(1),k,N,B,V,G;E?(N=P&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=C.LINES):(N=P?"fillPattern":"fill",k=C.TRIANGLES);for(let H of g){let q=s.getTile(H);if(P&&!q.patternsLoaded())continue;let W=q.getBucket(h);if(!W)continue;p.prepareDrawTile();let ee=W.programConfigurations.get(h.id),te=p.isTileAffectedByFog(H),ne=p.getOrCreateProgram(N,{config:ee,overrideFog:te});P&&(p.context.activeTexture.set(C.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ee.updatePaintBuffers());let ue=M.constantOr(null);if(ue&&q.imageAtlas){let re=q.imageAtlas.patternPositions[ue.toString()];re&&ee.setConstantPatternPositions(re)}let ce=p.translatePosMatrix(H.projMatrix,q,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),J=h.paint.get("fill-emissive-strength");if(E){V=W.indexBuffer2,G=W.segments2;let re=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];B=N==="fillOutlinePattern"&&P?td(ce,J,p,q,re):R_(ce,J,re)}else V=W.indexBuffer,G=W.segments,B=P?Dp(ce,J,p,q):Ip(ce,J);p.uploadCommonUniforms(p.context,ne,H.toUnwrapped()),ne.draw(p,k,v,p.stencilModeForClipping(H),x,r.af.disabled,B,h.id,W.layoutVertexBuffer,V,G,h.paint,p.transform.zoom,ee,void 0)}}function zl(p,s,h,g,v,x,E,C){h.resetLayerRenderingStats(p);let M=p.context,P=M.gl,k=p.transform,N=h.paint.get("fill-extrusion-pattern"),B=N.constantOr(1),V=h.paint.get("fill-extrusion-opacity"),G=p.style.enable3dLights(),H=h.paint.get(G&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H],W=h.layout.get("fill-extrusion-edge-radius"),ee=W>0&&!h.paint.get("fill-extrusion-rounded-roof"),te=ee?0:W,ne=k.projection.name==="globe"?r.bY():0,ue=k.projection.name==="globe",ce=ue?r.a1(k.zoom):0,J=[r.aj(k.center.lng),r.ak(k.center.lat)],re=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ie=h.paint.get("fill-extrusion-flood-light-intensity"),ge=h.paint.get("fill-extrusion-vertical-scale"),Ce=os(p,h.paint.get("fill-extrusion-cutoff-fade-range")),ae=h.paint.get("fill-extrusion-emissive-strength"),Se=[],Me;ue&&Se.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Se.push("FAUX_AO"),ee&&Se.push("ZERO_ROOF_RADIUS"),C&&Se.push("HAS_CENTROID"),ie>0&&Se.push("FLOOD_LIGHT"),Ce.shouldRenderCutoff&&Se.push("RENDER_CUTOFF");let $e=p.renderPass==="shadow",Ge=p.shadowRenderer,Ve=$e&&!!Ge;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let xe=[0,0,0];if(Ge){let ot=p.style.directionalLight,ct=p.style.ambientLight;ot&&ct&&(xe=ss(p.style,ot,ct)),Me=Se.concat(["SHADOWS_SINGLE_CASCADE"])}let Re=Ve?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",Fe=h.getLayerRenderingStats();for(let ot of g){let ct=s.getTile(ot),at=ct.getBucket(h);if(!at||at.projection.name!==k.projection.name)continue;let je=!1;Ge&&(je=Ge.getMaxCascadeForTile(ot.toUnwrapped())===0);let He=p.isTileAffectedByFog(ot),st=at.programConfigurations.get(h.id),pt=p.getOrCreateProgram(Re,{config:st,defines:je?Me:Se,overrideFog:He});if(p.terrain&&p.terrain.setupElevationDraw(ct,pt,{useMeterToDem:!0}),!at.centroidVertexBuffer){let Bt=pt.attributes.a_centroid_pos;Bt!==void 0&&P.vertexAttrib2f(Bt,0,0)}!$e&&Ge&&Ge.setupShadows(ct.tileID.toUnwrapped(),pt,"vector-tile",ct.tileID.overscaledZ),B&&(p.context.activeTexture.set(P.TEXTURE0),ct.imageAtlasTexture&&ct.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),st.updatePaintBuffers());let Ot=N.constantOr(null);if(Ot&&ct.imageAtlas){let Bt=ct.imageAtlas.patternPositions[Ot.toString()];Bt&&st.setConstantPatternPositions(Bt)}let $t=h.paint.get("fill-extrusion-vertical-gradient"),cn;if($e&&Ge){if(Fp(ct.tileID,at,p))continue;let Bt=Ge.calculateShadowPassMatrixFromTile(ct.tileID.toUnwrapped());cn=kl(Bt,te,ge)}else{let Bt=p.translatePosMatrix(ot.expandedProjMatrix,ct,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Sn=k.projection.createInversionMatrix(k,ot.canonical);cn=B?Sp(Bt,p,$t,V,q,te,ot,ct,ne,ce,J,Sn,re,ge):Ol(Bt,p,$t,V,q,te,ot,ne,ce,J,Sn,re,ge,ie,xe,ae)}p.uploadCommonUniforms(M,pt,ot.toUnwrapped(),null,Ce);let on=at.segments;if(k.projection.name==="mercator"&&!$e&&(on=at.getVisibleSegments(ct.tileID,p.terrain,p.transform.getFrustum(0)),!on.get().length))continue;if(Fe)if($e)for(let Bt of on.get())Fe.numRenderedVerticesInShadowPass+=Bt.primitiveLength;else for(let Bt of on.get())Fe.numRenderedVerticesInTransparentPass+=Bt.primitiveLength;let An=[];(p.terrain||C)&&An.push(at.centroidVertexBuffer),ue&&An.push(at.layoutVertexExtBuffer),pt.draw(p,M.gl.TRIANGLES,v,x,E,r.af.backCCW,cn,h.id,at.layoutVertexBuffer,at.indexBuffer,on,h.paint,p.transform.zoom,st,An)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function Ci(p,s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q,W,ee){let te=p.context,ne=te.gl,ue=p.transform,ce=p.transform.zoom,J=[],re=os(p,h.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(J.push("CLEAR_SUBPASS"),ee&&(J.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(ne.TEXTURE0),ee.bind(ne.LINEAR,ne.CLAMP_TO_EDGE))):P==="sdf"&&J.push("SDF_SUBPASS"),q&&J.push("HAS_CENTROID"),re.shouldRenderCutoff&&J.push("RENDER_CUTOFF");let ie=h.layout.get("fill-extrusion-edge-radius"),ge=(Ce,ae,Se,Me,$e)=>{let Ge=ae.programConfigurations.get(h.id),Ve=p.isTileAffectedByFog(Ce),xe=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ge,defines:J,overrideFog:Ve}),Re=((ot,ct,at,je,He,st,pt,Ot,$t,cn,on)=>({u_matrix:ct,u_opacity:at,u_ao_pass:je?1:0,u_meter_to_tile:He,u_ao:st,u_flood_light_intensity:pt,u_flood_light_color:Ot,u_attenuation:$t,u_edge_radius:cn,u_fb:0,u_fb_size:on}))(0,Me,k,M,$e,[N,B*$e],V,G,H,ce>=17?0:ie*$e,ee?ee.size[0]:0),Fe=[];q&&Fe.push(ae.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(te,xe,Ce.toUnwrapped(),null,re),xe.draw(p,te.gl.TRIANGLES,v,x,E,C,Re,h.id,ae.vertexBuffer,ae.indexBuffer,Se,h.paint,ce,Ge,Fe)};for(let Ce of g){let ae=s.getTile(Ce),Se=ae.getBucket(h);if(!Se||Se.projection.name!==ue.projection.name||!Se.groundEffect||Se.groundEffect&&!Se.groundEffect.hasData())continue;let Me=Se.groundEffect,$e=1/Se.tileToMeter;{let Ge=p.translatePosMatrix(Ce.projMatrix,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ve=Me.getDefaultSegment();ge(Ce,Me,Ve,Ge,$e)}if(W)for(let Ge=0;Ge<4;Ge++){let Ve=r.bZ[Ge](Ce),xe=s.getTile(Ve);if(!xe)continue;let Re=xe.getBucket(h);if(!Re||Re.projection.name!==ue.projection.name||!Re.groundEffect||Re.groundEffect&&!Re.groundEffect.hasData())continue;let Fe=Re.groundEffect,ot,ct;Ge===0?(ot=[-r.a3,0,0],ct=1):Ge===1?(ot=[r.a3,0,0],ct=0):Ge===2?(ot=[0,-r.a3,0],ct=3):(ot=[0,r.a3,0],ct=2);let at=Fe.regionSegments[ct];if(!at)continue;let je=new Float32Array(16);r.ad.translate(je,Ce.projMatrix,ot),ge(Ce,Fe,at,p.translatePosMatrix(je,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$e)}}}function sd(p,s,h,g,v,x,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let C=x?x.findDEMTileFor(h):null;if(!(C&&C.dem||E))return;let M=W=>new r.P(Math.ceil((W+r.c0)*r.c1),0),P=W=>{let ee=s.getSource().minzoom,te=ue=>{let ce=s.getTileByID(ue);if(ce&&ce.hasData())return ce.getBucket(v)},ne=[0,-1,1];for(let ue of ne){if(W.overscaledZ+ue<ee)continue;let ce=te(W.calculateScaledKey(W.overscaledZ+ue));if(ce)return ce}},k=[0,0,0],N=(W,ee)=>(k[0]=Math.min(W.min.y,ee.min.y),k[1]=Math.max(W.max.y,ee.max.y),k[2]=r.a3-ee.min.x>W.max.x?ee.min.x-r.a3:W.max.x,k),B=(W,ee)=>(k[0]=Math.min(W.min.x,ee.min.x),k[1]=Math.max(W.max.x,ee.max.x),k[2]=r.a3-ee.min.y>W.max.y?ee.min.y-r.a3:W.max.y,k),V=[(W,ee)=>N(W,ee),(W,ee)=>N(ee,W),(W,ee)=>B(W,ee),(W,ee)=>B(ee,W)],G=(W,ee,te,ne,ue,ce,J)=>{if(!x)return 0;let re=[[ce?te:W,ce?W:te,0],[ce?te:ee,ce?ee:te,0]],ie=J<0?r.a3+J:J,ge=[ce?ie:(W+ee)/2,ce?(W+ee)/2:ie,0];return te===0&&J<0||te!==0&&J>0?x.getForTilePoints(ue,[ge],!0,ne):re.push(ge),x.getForTilePoints(h,re,!0,C),Math.max(re[0][2],re[1][2],ge[2])/x.exaggeration()};for(let W=0;W<4;W++){let ee=g.borderFeatureIndices[W];if(ee.length===0)continue;let te=r.bZ[W](h),ne=P(te);if(!(ne&&ne instanceof r.b_)||g.borderDoneWithNeighborZ[W]===ne.canonical.z)continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();let ue=x?x.findDEMTileFor(te):null;if(!(ue&&ue.dem||E))continue;let ce=(W<2?1:5)-W,J=ne.borderDoneWithNeighborZ[ce]!==g.canonical.z,re=ne.borderFeatureIndices[ce],ie=0;if(g.canonical.z!==ne.canonical.z){for(let ge of ee)g.showCentroid(g.featuresOnBorder[ge]);if(J)for(let ge of re)ne.showCentroid(ne.featuresOnBorder[ge]);g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}for(let ge of ee){let Ce=g.featuresOnBorder[ge],ae=g.centroidData[Ce.centroidDataIndex],Se=Ce.borders[W],Me;for(;ie<re.length;){Me=ne.featuresOnBorder[re[ie]];let $e=Me.borders[ce];if($e[1]>Se[0]+3||$e[0]>Se[0]-3)break;ne.showCentroid(Me),ie++}if(Me&&ie<re.length){let $e=ie,Ge=0;for(;!(Me.borders[ce][0]>Se[1]-3)&&(Ge++,++ie!==re.length);)Me=ne.featuresOnBorder[re[ie]];if(Me=ne.featuresOnBorder[re[$e]],Ge>1){let Re=Me.borders[ce];Math.abs(Se[0]-Re[0])<3&&Math.abs(Se[1]-Re[1])<3&&(Ge=1,ie=$e+1)}else if(Ge===0){g.showCentroid(Ce);continue}let Ve=ne.centroidData[Me.centroidDataIndex];E&&Ge===1&&(((H=ae).flags|(q=Ve).flags)&r.b$?(H.flags|=r.b$,q.flags|=r.b$):(H.flags&=~r.b$,q.flags&=~r.b$));let xe=Ce.intersectsCount()>1||Me.intersectsCount()>1;if(Ge>1)ie=$e,ae.centroidXY=Ve.centroidXY=new r.P(0,0);else if(ue&&ue.dem&&!xe){let Re=V[W](ae,Ve),Fe=W%2?r.a3-1:0,ot=G(Re[0],Math.min(r.a3-1,Re[1]),Fe,ue,te,W<2,Re[2]);ae.centroidXY=Ve.centroidXY=M(ot)}else xe?ae.centroidXY=Ve.centroidXY=new r.P(0,0):(ae.centroidXY=g.encodeBorderCentroid(Ce),Ve.centroidXY=ne.encodeBorderCentroid(Me));g.writeCentroidToBuffer(ae),ne.writeCentroidToBuffer(Ve)}else g.showCentroid(Ce)}g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}var H,q;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(p)}let La=[1,0,0],V_=[0,1,0],ad=[0,0,1];function Fp(p,s,h){let g=h.transform,v=h.shadowRenderer;if(!v)return!0;let x=p.toUnwrapped(),E=g.tileSize*v._cascades[h.currentShadowCascade].scale,C=s.maxHeight;if(g.elevation){let H=g.elevation.getMinMaxForTile(p);H&&(C+=H.max)}let M=[...v.shadowDirection];M[2]=-M[2];let P=v.computeSimplifiedTileShadowVolume(x,C,E,M);if(!P)return!1;let k=[La,V_,ad,M,[M[0],0,M[2]],[0,M[1],M[2]]],N=g.projection.name==="globe",B=g.scaleZoom(E),V=r.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,B,!N),G=v.getCurrentCascadeFrustum();return V.intersectsPrecise(P.vertices,P.planes,k)===0||G.intersectsPrecise(P.vertices,P.planes,k)===0}function pu(p){return[p[0]*r.c2,p[1]*r.c2,p[2]*r.c2,0]}function mu(p,s,h,g,v,x,E,C,M){let P=g.getSource(),k=h.globeSharedBuffers;if(!k)return;let N,B,V;if(s&&(N=g.getTile(s)),P instanceof r.bm?(B=P.texture,V=r.bh(0,0,h.transform)):N&&s&&(B=N.texture,V=r.bh(s.canonical.z,s.canonical.x,h.transform)),!B||!V)return;p||(V=r.ad.scale(r.ad.create(),V,[1,-1,1]));let G=h.context,H=G.gl,q=v.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR,W=h.colorModeForDrapableLayerRenderPass(x),ee=E.defines;ee.push("GLOBE_POLES");let te=new r.ae(H.LEQUAL,r.ae.ReadWrite,h.depthRangeFor3D),ne=Float32Array.from(h.transform.expandedFarZProjMatrix),ue=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),G.activeTexture.set(H.TEXTURE0),B.bind(q,H.CLAMP_TO_EDGE),G.activeTexture.set(H.TEXTURE1),B.bind(q,H.CLAMP_TO_EDGE),B.useMipmap&&G.extTextureFilterAnisotropic&&h.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);let[ce,J,re,ie]=s?k.getPoleBuffers(s.canonical.z,!1):k.getPoleBuffers(0,!0),ge=v.paint.get("raster-elevation"),Ce;p?(Ce=ce,h.renderDefaultNorthPole=ge!==0):(Ce=J,h.renderDefaultSouthPole=ge!==0);let ae=pu(E.mix),Se=(($e,Ge,Ve,xe,Re,Fe,ot,ct,at,je,He,st,pt)=>cu($e,Ge,Ve,new Float32Array(16),new Float32Array(9),[0,0],xe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Fe,[0,0],ct,2,je,He,st,1,0,pt))(ne,ue,V,r.a1(h.transform.zoom),0,v,0,ge,0,ae,E.offset,E.range,x),Me=h.getOrCreateProgram("raster",{defines:ee});h.uploadCommonUniforms(G,Me,null),Me.draw(h,H.TRIANGLES,te,M,W,C,Se,v.id,Ce,re,ie)}function bn(p){let s=p._nearZ,h=p.projection.farthestPixelDistance(p),g=h-s,v=.2*p.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}function y1(p,s,h,g){if(p)return s instanceof Rl&&p instanceof r.c3?s.getTextureDescriptor(p,h,!0):{texture:p.texture,mix:pu(g.mix),offset:g.offset,buffer:0,tileSize:1}}function It(p,s,h){if(!p)return null;let g=s.getTextureDescriptor(p,h,!0);if(!g)return null;let{texture:v,mix:x,offset:E,tileSize:C,buffer:M,format:P}=g;if(!v||!P)return null;let k=!1;return P==="uint32"&&(k=!0,x[3]=0,x=O_(r.c4,x,[0,h.paint.get("raster-particle-max-speed")]),E=Ap(r.c4,E,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[M/(C+2*M),C/(C+2*M)],tileSize:C,scalarData:k,scale:x,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function j_(p){let s=p._nearZ,h=p.projection.farthestPixelDistance(p),g=h-s,v=.2*p.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}let ld=new r.C(1,0,0,1),Np=new r.C(0,1,0,1),Uo=new r.C(0,0,1,1),zp=new r.C(1,0,1,1),Bl=new r.C(0,1,1,1);function dt(p,s,h,g,v,x,E){let C=p.context,M=p.transform,P=C.gl,k=M.projection.name==="globe",N=k?["PROJECTION_GLOBE_VIEW"]:[],B=r.ad.clone(h.projMatrix);if(k&&r.a1(M.zoom)>0){let ae=r.c5(h.canonical,M),Se=r.c6(ae);B=r.ad.multiply(new Float32Array(16),M.globeMatrix,Se),r.ad.multiply(B,M.projMatrix,B)}let V=r.ad.create();V[12]+=2*v/(r.e.devicePixelRatio*M.width),V[13]+=2*x/(r.e.devicePixelRatio*M.height),r.ad.multiply(B,V,B);let G=p.getOrCreateProgram("debug",{defines:N}),H=s.getTileByID(h.key);p.terrain&&p.terrain.setupElevationDraw(H,G);let q=r.ae.disabled,W=r.ag.disabled,ee=p.colorModeForRenderPass(),te="$debug";C.activeTexture.set(P.TEXTURE0),p.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),k?H._makeGlobeTileDebugBuffers(p.context,M):H._makeDebugTileBoundsBuffers(p.context,M.projection);let ne=H._tileDebugBuffer||p.debugBuffer,ue=H._tileDebugIndexBuffer||p.debugIndexBuffer,ce=H._tileDebugSegments||p.debugSegments;if(G.draw(p,P.LINE_STRIP,q,W,ee,r.af.disabled,nd(B,g),te,ne,ue,ce,null,null,null,[H._globeTileDebugBorderBuffer]),E){let ae=H.latestRawTileData,Se=Math.floor((ae&&ae.byteLength||0)/1024),Me=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Me+=` => ${h.overscaledZ}`),Me+=` ${H.state}`,Me+=` ${Se}kb`,function($e,Ge){$e.initDebugOverlayCanvas();let Ve=$e.debugOverlayCanvas,xe=$e.context.gl,Re=$e.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,Ve.width,Ve.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(Ge,5,5),Re.strokeText(Ge,5,5),$e.debugOverlayTexture.update(Ve),$e.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(p,Me)}let J=s.getTile(h).tileSize,re=512/Math.min(J,512)*(h.overscaledZ/M.zoom)*.5,ie=H._tileDebugTextBuffer||p.debugBuffer,ge=H._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ce=H._tileDebugTextSegments||p.debugSegments;G.draw(p,P.TRIANGLES,q,W,r.a.alphaBlended,r.af.disabled,nd(B,r.C.transparent,re),te,ie,ge,Ce,null,null,null,[H._globeTileDebugTextBuffer])}function wn(p,s,h,g){Si(p,0,s+h/2,p.transform.width,h,g)}function En(p,s,h,g){Si(p,s-h/2,0,h,p.transform.height,g)}function Si(p,s,h,g,v,x){let E=p.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*r.e.devicePixelRatio,h*r.e.devicePixelRatio,g*r.e.devicePixelRatio,v*r.e.devicePixelRatio),E.clear({color:x}),C.disable(C.SCISSOR_TEST)}let Vl=r.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_n}=Vl;function xo(p,s,h,g){p.emplaceBack(s,h,g)}class jl{constructor(s){this.vertexArray=new r.c8,this.indices=new r.bu,xo(this.vertexArray,-1,-1,1),xo(this.vertexArray,1,-1,1),xo(this.vertexArray,-1,1,1),xo(this.vertexArray,1,1,1),xo(this.vertexArray,-1,-1,-1),xo(this.vertexArray,1,-1,-1),xo(this.vertexArray,-1,1,-1),xo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,_n),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=r.b.simpleSegment(0,0,36,12)}}function $o(p,s,h,g,v,x){let E=p.context.gl,C=s.paint.get("sky-atmosphere-color"),M=s.paint.get("sky-atmosphere-halo-color"),P=s.paint.get("sky-atmosphere-sun-intensity"),k=((N,B,V,G,H)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:V,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(r.bC.fromMat4(r.bC.create(),g),v,P,C,M);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),h.draw(p,E.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.frontCW,k,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}let Fi=r.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Er{constructor(s){let h=new r.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let g=new r.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Fi.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=r.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let v1=r.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class gu{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Bp{constructor(s){this.colorModeAlphaBlendedWriteRGB=new r.a([r.ca,r.cb,r.ca,r.cb],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.ca,r.cc,r.ca,r.cc],r.C.transparent,[!1,!1,!1,!0]),this.params=new gu,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){let h=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Er(h);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(k){let N=r.cf(30),B=[];for(let V=0;V<k;++V){let G=2*Math.PI*N(),H=Math.acos(1-2*N())-.5*Math.PI;B.push(r._.fromValues(Math.cos(H)*Math.cos(G),Math.cos(H)*Math.sin(G),Math.sin(H)))}return B}(this.params.starsCount),E=r.cf(300),C=new r.cd,M=new r.bu,P=0;for(let k=0;k<x.length;++k){let N=r._.scale([],x[k],200),B=Math.max(0,1+.01*g*(1*E()-.5)),V=Math.max(0,1+.01*v*(1*E()-.5));C.emplaceBack(N[0],N[1],N[2],-1,-1,B,V),C.emplaceBack(N[0],N[1],N[2],1,-1,B,V),C.emplaceBack(N[0],N[1],N[2],1,1,B,V),C.emplaceBack(N[0],N[1],N[2],-1,1,B,V),M.emplaceBack(P+0,P+1,P+2),M.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=h.createVertexBuffer(C,v1.members),this.starsIdx=h.createIndexBuffer(M),this.starsSegments=r.b.simpleSegment(0,0,C.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,h){let g=s.context,v=g.gl,x=s.transform,E=new r.ae(v.LEQUAL,r.ae.ReadOnly,[0,1]),C=r.a1(x.zoom),M=s.style.getLut(h.scope),P=h.properties.get("color").toRenderColor(M).toArray01(),k=h.properties.get("high-color").toRenderColor(M).toArray01(),N=h.properties.get("space-color").toRenderColor(M).toArray01PremultipliedAlpha(),B=5e-4,V=r.ce(h.properties.get("horizon-blend"),0,1,B,.25),G=r.ba(s,g,x)&&V===B?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,H=s.frameCounter/1e3%1,q=r._.length(x.globeCenterInViewSpace),W=Math.sqrt(Math.pow(q,2)-Math.pow(G,2)),ee=Math.acos(W/q),te=ne=>{let ue=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&ue.push("ALPHA_PASS");let ce=s.getOrCreateProgram("globeAtmosphere",{defines:ue}),J=((ie,ge,Ce,ae,Se,Me,$e,Ge,Ve,xe,Re,Fe)=>({u_frustum_tl:ie,u_frustum_tr:ge,u_frustum_br:Ce,u_frustum_bl:ae,u_horizon:Se,u_transition:Me,u_fadeout_range:$e,u_color:Ge,u_high_color:Ve,u_space_color:xe,u_temporal_offset:Re,u_horizon_angle:Fe}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,C,V,P,k,N,H,ee);s.uploadCommonUniforms(g,ce);let re=this.atmosphereBuffer;re&&ce.draw(s,v.TRIANGLES,E,r.ag.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.af.backCW,J,ne?"atmosphere_glow_alpha":"atmosphere_glow",re.vertexBuffer,re.indexBuffer,re.segments)};te(!1),te(!0)}drawStars(s,h){let g=r.at(h.properties.get("star-intensity"),0,1);if(g===0)return;let v=s.context,x=v.gl,E=s.transform,C=s.getOrCreateProgram("stars"),M=r.av.identity([]);r.av.rotateX(M,M,-E._pitch),r.av.rotateZ(M,M,-E.angle),r.av.rotateX(M,M,r.ab(E._center.lat)),r.av.rotateY(M,M,-r.ab(E._center.lng));let P=r.ad.fromQuat(new Float32Array(16),M),k=r.ad.multiply([],E.starsProjMatrix,P),N=r.bC.fromMat4([],P),B=r.bC.invert([],N),V=[0,1,0];r._.transformMat3(V,V,B),r._.scale(V,V,this.params.sizeMultiplier);let G=[1,0,0];r._.transformMat3(G,G,B),r._.scale(G,G,this.params.sizeMultiplier);let H=(q=V,W=G,ee=g,{u_matrix:Float32Array.from(k),u_up:q,u_right:W,u_intensity_multiplier:ee});var q,W,ee;s.uploadCommonUniforms(v,C),this.starsVx&&this.starsIdx&&C.draw(s,x.TRIANGLES,r.ae.disabled,r.ag.disabled,this.colorModeAlphaBlendedWriteRGB,r.af.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ul(p,s){let h=[...p],g=s.cameraWorldSizeForFog/s.worldSize,v=r.ad.identity([]);return r.ad.scale(v,v,[g,g,1]),r.ad.multiply(h,v,h),r.ad.multiply(h,s.worldToFogMatrix,h),h}function _u(p,s,h,g,v){let x=h.material,E=g.context,{baseColorTexture:C,metallicRoughnessTexture:M}=x.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:k,emissionTexture:N}=x;function B(V,G,H){if(V&&(p.push(G),E.activeTexture.set(E.gl.TEXTURE0+H),V.gfxTexture)){let{minFilter:q,magFilter:W,wrapS:ee,wrapT:te}=V.sampler;V.gfxTexture.bindExtraParam(q,W,ee,te)}}B(C,"HAS_TEXTURE_u_baseColorTexture",vi.BaseColor),B(M,"HAS_TEXTURE_u_metallicRoughnessTexture",vi.MetallicRoughness),B(P,"HAS_TEXTURE_u_normalTexture",vi.Normal),B(k,"HAS_TEXTURE_u_occlusionTexture",vi.Occlusion),B(N,"HAS_TEXTURE_u_emissionTexture",vi.Emission),v&&(v.texture||(v.texture=new r.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],E.gl.RGBA)),E.activeTexture.set(E.gl.TEXTURE0+vi.LUT),v.texture&&v.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(h.texcoordBuffer)),h.colorBuffer&&(p.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(h.colorBuffer)),h.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(h.normalBuffer)),h.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(h.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function Fa(p,s,h,g,v,x){let E=h.paint.get("model-opacity"),C=s.context,M=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,s.depthRangeFor3D),P=s.transform,k=p.mesh,N=k.material,B=N.pbrMetallicRoughness,V=s.style.fog,G;G=s.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.ad.multiply([],g.zScaleMatrix,p.nodeModelMatrix),r.ad.multiply(G,g.negCameraPosMatrix,G);let H=r.ad.invert([],G);r.ad.transpose(H,H);let q=h.paint.get("model-emissive-strength").constantOr(0),W=du(new Float32Array(p.worldViewProjection),new Float32Array(G),new Float32Array(H),null,s,E,B.baseColorFactor.toRenderColor(null),N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,q,h),ee={defines:[]},te=[];_u(ee.defines,te,k,s,h.lut);let ne=s.shadowRenderer;ne&&(ne.useNormalOffset=!1);let ue=null;if(V){let re=Ul(p.nodeModelMatrix,s.transform);if(ue=new Float32Array(re),P.projection.name!=="globe"){let ie=k.aabb.min,ge=k.aabb.max,[Ce,ae]=V.getOpacityForBounds(re,ie[0],ie[1],ge[0],ge[1]);ee.overrideFog=Ce>=nr||ae>=nr}}let ce=os(s,h.paint.get("model-cutoff-fade-range"));ce.shouldRenderCutoff&&ee.defines.push("RENDER_CUTOFF");let J=s.getOrCreateProgram("model",ee);s.uploadCommonUniforms(C,J,null,ue,ce),s.renderPass!=="shadow"&&ne&&ne.setupShadowsFromMatrix(p.nodeModelMatrix,J),J.draw(s,C.gl.TRIANGLES,M,v,x,k.material.doubleSided?r.af.disabled:r.af.backCCW,W,h.id,k.vertexBuffer,k.indexBuffer,k.segments,h.paint,s.transform.zoom,void 0,te)}function ci(p,s,h,g,v,x,E){let C;C=p.projection.name==="globe"?r.ci(h,p):[...h],r.ad.multiply(C,C,s.matrix);let M=r.ad.multiply([],g,C);if(s.meshes)for(let P of s.meshes){if(P.material.alphaMode!=="BLEND"){E.push({mesh:P,depth:0,modelIndex:v,worldViewProjection:M,nodeModelMatrix:C});continue}let k=r._.transformMat4([],P.centroid,M);k[2]>0&&x.push({mesh:P,depth:k[2],modelIndex:v,worldViewProjection:M,nodeModelMatrix:C})}if(s.children)for(let P of s.children)ci(p,P,h,g,v,x,E)}function Ii(p,s,h,g){let v=h.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),E=v.getShadowPassColorMode(),C=v.calculateShadowPassMatrixFromMatrix(s),M=F_(C);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,x,r.ag.disabled,E,r.af.backCCW,M,g.id,p.vertexBuffer,p.indexBuffer,p.segments,g.paint,h.transform.zoom,void 0,void 0)}function U_(p,s,h){let g=s.updateZoomBasedPaintProperties(),v=function(x,E,C){let M,P,k,N=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&N>0){let B=x.terrain,V=B.findDEMTileFor(C);V&&V.dem?M=r.ck.create(B,C,V):N=0}if(N===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),N===E.validForExaggeration&&(N===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(let B in E.instancesPerModel){let V=E.instancesPerModel[B];for(let G=0;G<V.instancedDataArray.length;++G){let H=(M?N*M.getElevationAt(0|V.instancedDataArray.float32[16*G],0|V.instancedDataArray.float32[16*G+1],!0,!0):0)+V.instancesEvaluatedElevation[G];V.instancedDataArray.float32[16*G+6]=H,P=P?Math.min(E.terrainElevationMin,H):H,k=k?Math.max(E.terrainElevationMax,H):H}}return E.terrainElevationMin=P||0,E.terrainElevationMax=k||0,E.validForExaggeration=N,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,s,h);(g||v)&&(s.uploaded=!1,s.upload(p.context))}let Di={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.b6([0,0,0],[r.a3,r.a3,0])};function Pr(p,s){let h=1<<p.canonical.z,g=s.getFreeCameraOptions().position,v=s.elevation,x=p.canonical.x/h,E=(p.canonical.x+1)/h,C=p.canonical.y/h,M=(p.canonical.y+1)/h,P=s._centerAltitude;if(v){let V=v.getMinMaxForTile(p);V&&V.max>P&&(P=V.max)}let k=r.at(g.x,x,E)-g.x,N=r.at(g.y,C,M)-g.y,B=r.ax(P,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(k*k+N*N+B*B))}function io(p,s,h,g,v,x,E){let C=p.context,M=p.renderPass==="shadow",P=p.shadowRenderer,k=M&&P?P.getShadowPassDepthMode():new r.ae(C.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D),N=p.isTileAffectedByFog(x);if(h.meshes)for(let B of h.meshes){let V=["MODEL_POSITION_ON_GPU"],G=[],H,q,W;g.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");let ee=os(p,s.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),M&&P)H=p.getOrCreateProgram("modelDepth",{defines:V}),q=F_(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(h.matrix)),W=P.getShadowPassColorMode();else{_u(V,G,B,p,s.lut),H=p.getOrCreateProgram("model",{defines:V,overrideFog:N});let ne=B.material,ue=ne.pbrMetallicRoughness,ce=s.paint.get("model-opacity"),J=s.paint.get("model-emissive-strength").constantOr(0);q=du(x.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,p,ce,ue.baseColorFactor.toRenderColor(null),ne.emissiveFactor,ue.metallicFactor,ue.roughnessFactor,ne,J,s,v),P&&(E.shadowUniformsInitialized?H.setShadowUniformValues(C,P.getShadowUniformValues()):(P.setupShadows(x.toUnwrapped(),H,"model-tile",x.overscaledZ),E.shadowUniformsInitialized=!0)),W=ee.shouldRenderCutoff||ce<1||ne.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}p.uploadCommonUniforms(C,H,x.toUnwrapped(),null,ee);let te=B.material.doubleSided?r.af.disabled:r.af.backCCW;if(g.instancedDataArray.length>20)G.push(g.instancedDataBuffer),H.draw(p,C.gl.TRIANGLES,k,r.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,p.transform.zoom,void 0,G,g.instancedDataArray.length);else{let ne=M?"u_instance":"u_normal_matrix";for(let ue=0;ue<g.instancedDataArray.length;++ue)q[ne]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ue,16),H.draw(p,C.gl.TRIANGLES,k,r.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,p.transform.zoom,void 0,G)}}if(h.children)for(let B of h.children)io(p,s,B,g,v,x,E)}let ls=[1,-1,1];function zr(p,s,h,g){if(!h.modelManager)return!0;let v=h.modelManager;if(!h.shadowRenderer)return!0;let x=h.shadowRenderer,E=s.aabb,C=!0,M=p.maxHeight;if(M===0){let k=0;for(let N in p.instancesPerModel){let B=v.getModel(N,g);B?k=Math.max(k,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):C=!1}M=p.maxScale*k*1.41+p.maxVerticalOffset,C&&(p.maxHeight=M)}E.max[2]=M,E.min[2]+=p.terrainElevationMin,E.max[2]+=p.terrainElevationMax,r._.transformMat4(E.min,E.min,s.tileMatrix),r._.transformMat4(E.max,E.max,s.tileMatrix);let P=E.intersects(x.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=P===2),P===0}function Vp(p,s){let h=p.uniformValues.u_cutoff_params[0],g=p.uniformValues.u_cutoff_params[1],v=p.uniformValues.u_cutoff_params[2],x=p.uniformValues.u_cutoff_params[3];return g===h||x===v?1:r.at(((s-h)/(g-h)-v)/(x-v),0,1)}function bo(p,s,h,g){if(s.pitch<20)return 1;let v=s.getWorldToCameraMatrix(),x=r.ad.multiply([],v,p),E=[...h.min,1],C=r.aA.transformMat4([],E,x),M=C,P=C;E[1]=h.max[1],C=r.aA.transformMat4([],E,x),M=C[1]<M[1]?C:M,P=C[1]>P[1]?C:P,E[0]=h.max[0],C=r.aA.transformMat4([],E,x),M=C[1]<M[1]?C:M,P=C[1]>P[1]?C:P,E[1]=h.min[1],C=r.aA.transformMat4([],E,x),M=C[1]<M[1]?C:M,P=C[1]>P[1]?C:P;let k=r.at(g[0],0,1),N=100*s.pixelsPerMeter*r.at(g[1],0,1),B=r.at(g[2],0,1),V=r._.lerp([],M,P,k),G=Math.tan(.5*s.fovX),H=-V[2]*G;if(N===0)return V[1]<-Math.abs(H)?B:1;let q=(-Math.abs(H)-V[1])/N,W=(te,ne,ue)=>(1-ue)*te+ue*ne,ee=r.at(W(1,B,q),B,1);return W(1,ee,r.at((s.pitch-20)/20,0,1))}class yu{}class vu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,h,g){{let N=this._storage.get(h.id);if(N)return N.lastUsedFrameIdx=s,N.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),E=new ArrayBuffer(x),C=new Int16Array(E);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));let M=new r.cm;for(let N=0;N<x/2;N+=3){let B=C[N],V=C[N+1],G=C[N+2];M.emplaceBack(B,V),M.emplaceBack(V,G),M.emplaceBack(G,B)}let P=g.bindVertexArrayOES.current,k=new yu;return k.buf=new r.I(g,M),k.lastUsedFrameIdx=s,this._storage.set(h.id,k),g.bindVertexArrayOES.set(P),k.buf}update(s){for(let[h,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(let[s,h]of this._storage)h.buf.destroy(),this._storage.delete(s)}}let Na=r.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class x1{constructor(s){let h=new r.cn,g=new r.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=r.b.simpleSegment(0,0,h.length,g.length),this.vx=s.createVertexBuffer(h,Na.members),this.idx=s.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let wo={symbol:function(p,s,h,g,v){if(p.renderPass!=="translucent")return;let x=r.ag.disabled,E=p.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(P,k,N,B,V,G,H){let q=k.transform,W=V==="map",ee=G==="map";for(let te of P){let ne=B.getTile(te),ue=ne.getBucket(N);if(!ue||!ue.text||!ue.text.segments.get().length)continue;let ce=r.aD(ue.textSizeData,q.zoom),J=Fl(te,ue.getProjection(),q),re=q.calculatePixelsToTileUnitsMatrix(ne),ie=Ma(J,ne.tileID.canonical,ee,W,q,ue.getProjection(),re),ge=ue.hasIconTextFit()&&ue.hasIconData();if(ce){let Ce=Math.pow(2,q.zoom-ne.tileID.overscaledZ);B_(ue,W,ee,H,r.bO,q,ie,te,Ce,ce,ge)}}}(g,p,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);let C=h.paint.get("icon-opacity").constantOr(1)!==0,M=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||M)?kp(p,s,h,g,x,E):(C&&kp(p,s,h,g,x,E,{onlyIcons:!0}),M&&kp(p,s,h,g,x,E,{onlyText:!0}),function(P,k,N,B){if(!P.symbolParams.useOcclusionQueries)return;let V=P.context.gl,G=P.transform,H=N.paint,q=H.get("icon-occlusion-opacity").constantOr(0)!==1,W=H.get("text-occlusion-opacity").constantOr(0)!==1;if(!q&&!W)return;let ee=G.projection.name==="globe";for(let te of B){let ne=k.getTile(te),ue=ne.getBucket(N);if(!ue||ue.projection.name==="mercator"&&ee||ue.fullyClipped)continue;if(ue.projection.name==="globe"){r.w(`Occlusion not supported for globe mode. Layer: ${N.type}`);continue}let ce=Fl(te,ue.getProjection(),G),J=r.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,P.symbolParams.depthOffset,1),re=r.ad.multiply([],J,ce),ie=P.symbolParams.visualizeOcclusions!=="none"?1:P.symbolParams.occlusionQueryFrameWindow;for(let ge=0;ge<ue.symbolInstances.length;ge++){let Ce=ue.symbolInstances.get(ge),ae=P.style.placement.opacities[Ce.crossTileID];if(ae&&ae.isHidden()||(P.frameCounter+ge)%ie!=0)continue;let Se=Ce.tileAnchorX,Me=Ce.tileAnchorY,$e=Ce.zOffset,Ge;if(P.symbolParams.visualizeOcclusions==="none"){let ot=ue.queries.get(ge);if(ot){if(!ot.isFree()){if(!ot.isResultAvailable())continue;let ct=ot.consumeResult();Ce.occlusionState=ct===0?0:1;continue}Ge=ot}else Ge=new yl(P.context),ue.queries.set(ge,Ge)}let Ve=P.getOrCreateProgram("occlusion"),xe=P.symbolParams.occluderSize,Re=N_(re,[Se,Me,$e],[G.width,G.height],[xe,xe],P.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);P.terrain&&P.terrain.setupElevationDraw(ne,Ve,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.begin();let Fe=new r.ae(P.symbolParams.visualizeOcclusions==="zPass"?P.context.gl.ALWAYS:P.context.gl.LEQUAL,r.ae.ReadOnly,P.depthRangeFor3D);Ve.draw(P,V.TRIANGLES,Fe,r.ag.disabled,P.symbolParams.visualizeOcclusions!=="none"?r.a.alphaBlendedNonPremultiplied:r.a.disabled,r.af.disabled,Re,"occlusion",P.occlusionBuffers.vx,P.occlusionBuffers.idx,P.occlusionBuffers.segments),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.end()}}}(p,s,h,g)),s.map.showCollisionBoxes&&(fu(p,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),fu(p,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,h,g){if(p.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),C=h.layout.get("circle-sort-key").constantOr(1)!==void 0,M=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;let P=p.context,k=P.gl,N=p.transform,B=p.depthModeForSublayer(0,r.ae.ReadOnly),V=r.ag.disabled,G=p.colorModeForDrapableLayerRenderPass(M),H=N.projection.name==="globe",q=[r.aj(N.center.lng),r.ak(N.center.lat)],W=[];for(let te=0;te<g.length;te++){let ne=g[te],ue=s.getTile(ne),ce=ue.getBucket(h);if(!ce||ce.projection.name!==N.projection.name)continue;let J=ce.programConfigurations.get(h.id),re=r.bR(h),ie=p.isTileAffectedByFog(ne);H&&re.push("PROJECTION_GLOBE_VIEW");let ge=p.getOrCreateProgram("circle",{config:J,defines:re,overrideFog:ie}),Ce=ce.layoutVertexBuffer,ae=ce.globeExtVertexBuffer,Se=ce.indexBuffer,Me=N.projection.createInversionMatrix(N,ne.canonical),$e={programConfiguration:J,program:ge,layoutVertexBuffer:Ce,globeExtVertexBuffer:ae,indexBuffer:Se,uniformValues:r.bS(p,ne,ue,Me,q,h),tile:ue};if(C){let Ge=ce.segments.get();for(let Ve of Ge)W.push({segments:new r.b([Ve]),sortKey:Ve.sortKey,state:$e})}else W.push({segments:ce.segments,sortKey:0,state:$e})}C&&W.sort((te,ne)=>te.sortKey-ne.sortKey);let ee={useDepthForOcclusion:N.depthOcclusionForCircles};for(let te of W){let{programConfiguration:ne,program:ue,layoutVertexBuffer:ce,globeExtVertexBuffer:J,indexBuffer:re,uniformValues:ie,tile:ge}=te.state,Ce=te.segments;p.terrain&&p.terrain.setupElevationDraw(ge,ue,ee),p.uploadCommonUniforms(P,ue,ge.tileID.toUnwrapped()),ue.draw(p,k.TRIANGLES,B,V,G,r.af.disabled,ie,h.id,ce,re,Ce,h.paint,N.zoom,ne,[J])}},heatmap:function(p,s,h,g){if(h.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){let v=p.context,x=v.gl,E=r.ag.disabled,C=new r.a([x.ONE,x.ONE,x.ONE,x.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(V,G,H,q){let W=V.gl,ee=G.width*q,te=G.height*q;V.activeTexture.set(W.TEXTURE1),V.viewport.set([0,0,ee,te]);let ne=H.heatmapFbo;if(!ne||ne&&(ne.width!==ee||ne.height!==te)){ne&&ne.destroy();let ue=W.createTexture();W.bindTexture(W.TEXTURE_2D,ue),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ne=H.heatmapFbo=V.createFramebuffer(ee,te,!0,null),function(ce,J,re,ie,ge,Ce){let ae=ce.gl;ae.texImage2D(ae.TEXTURE_2D,0,ce.extRenderToTextureHalfFloat?ae.RGBA16F:ae.RGBA,ge,Ce,0,ae.RGBA,ce.extRenderToTextureHalfFloat?ae.HALF_FLOAT:ae.UNSIGNED_BYTE,null),ie.colorAttachment.set(re)}(V,0,ue,ne,ee,te)}else W.bindTexture(W.TEXTURE_2D,ne.colorAttachment.get()),V.bindFramebuffer.set(ne.framebuffer)})(v,p,h,p.transform.projection.name==="globe"?.5:.25),v.clear({color:r.C.transparent});let M=p.transform,P=M.projection.name==="globe",k=P?["PROJECTION_GLOBE_VIEW"]:[],N=P?r.af.frontCCW:r.af.disabled,B=[r.aj(M.center.lng),r.ak(M.center.lat)];for(let V=0;V<g.length;V++){let G=g[V];if(s.hasRenderableParent(G))continue;let H=s.getTile(G),q=H.getBucket(h);if(!q||q.projection.name!==M.projection.name)continue;let W=p.isTileAffectedByFog(G),ee=q.programConfigurations.get(h.id),te=p.getOrCreateProgram("heatmap",{config:ee,defines:k,overrideFog:W}),{zoom:ne}=p.transform;p.terrain&&p.terrain.setupElevationDraw(H,te),p.uploadCommonUniforms(v,te,G.toUnwrapped());let ue=M.projection.createInversionMatrix(M,G.canonical);te.draw(p,x.TRIANGLES,r.ae.disabled,E,C,N,Oa(p,G,H,ue,B,ne,h.paint.get("heatmap-intensity")),h.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,h.paint,p.transform.zoom,ee,P?[q.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,x){let E=v.context,C=E.gl,M=x.heatmapFbo;if(!M)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let P=x.colorRampTexture;P||(P=x.colorRampTexture=new r.T(E,x.colorRamp,C.RGBA)),P.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,C.TRIANGLES,r.ae.disabled,r.ag.disabled,v.colorModeForRenderPass(),r.af.disabled,((k,N,B,V)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(p,h))},line:function(p,s,h,g){if(p.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let E=h.paint.get("line-emissive-strength"),C=h.paint.get("line-occlusion-opacity"),M=p.context,P=M.gl,k=h.layout.get("line-z-offset"),N=!k.isConstant()||!!k.constantOr(0),B=N?new r.ae(p.depthOcclusion?P.GREATER:P.LEQUAL,r.ae.ReadOnly,p.depthRangeFor3D):p.depthModeForSublayer(0,r.ae.ReadOnly),V=p.colorModeForDrapableLayerRenderPass(E),G=p.terrain&&p.terrain.renderingToTexture,H=G?1:r.e.devicePixelRatio,q=h.paint.get("line-dasharray"),W=q.constantOr(1),ee=h.layout.get("line-cap"),te=q.constantOr(null),ne=ee.constantOr(null),ue=h.paint.get("line-pattern"),ce=ue.constantOr(1),J=ue.constantOr(null),re=h.paint.get("line-opacity").constantOr(1),ie=!ce&&re!==1||p.depthOcclusion&&C>0&&C<1,ge=h.paint.get("line-gradient"),Ce=ce?"linePattern":"line",ae=r.bT(h),Se;if(G&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ie=!1),C!==0&&p.depthOcclusion){let $e=h.paint._values["line-opacity"];$e&&$e.value&&$e.value.kind==="constant"?Se=$e.value:r.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(N&&(p.forceTerrainMode=!0),!N&&C!==0&&p.terrain&&!G)return void r.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Me=ie&&N?p.stencilModeFor3D():r.ag.disabled;for(let $e of g){let Ge=s.getTile($e);if(ce&&!Ge.patternsLoaded())continue;let Ve=Ge.getBucket(h);if(!Ve)continue;p.prepareDrawTile();let xe=Ve.programConfigurations.get(h.id),Re=p.isTileAffectedByFog($e),Fe=p.getOrCreateProgram(Ce,{config:xe,defines:N?[...ae,"ELEVATED"]:ae,overrideFog:Re});if(J&&Ge.imageAtlas){let st=Ge.imageAtlas.patternPositions[J.toString()];st&&xe.setConstantPatternPositions(st)}if(!ce&&te&&ne&&Ge.lineAtlas){let st=Ge.lineAtlas.getDash(te,ne);st&&xe.setConstantPatternPositions(st)}let[ot,ct]=h.paint.get("line-trim-offset");(ne==="round"||ne==="square")&&ot!==ct&&(ot===0&&(ot-=1),ct===1&&(ct+=1));let at=G?$e.projMatrix:null,je=ce?r.bU(p,Ge,h,at,H,[ot,ct]):r.bV(p,Ge,h,at,Ve.lineClipsArray.length,H,[ot,ct]);if(ge){let st=Ve.gradients[h.id],pt=st.texture;if(h.gradientVersion!==st.version){let Ot=256;if(h.stepInterpolant){let $t=s.getSource().maxzoom,cn=$e.canonical.z===$t?Math.ceil(1<<p.transform.maxZoom-$e.canonical.z):1;Ot=r.at(r.bW(Ve.maxLineLength/r.a3*1024*cn),256,M.maxTextureSize)}st.gradient=r.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:st.gradient||void 0,clips:Ve.lineClipsArray}),st.texture?st.texture.update(st.gradient):st.texture=new r.T(M,st.gradient,P.RGBA),st.version=h.gradientVersion,pt=st.texture}M.activeTexture.set(P.TEXTURE1),pt.bind(h.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}W&&(M.activeTexture.set(P.TEXTURE0),Ge.lineAtlasTexture&&Ge.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),xe.updatePaintBuffers()),ce&&(M.activeTexture.set(P.TEXTURE0),Ge.imageAtlasTexture&&Ge.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xe.updatePaintBuffers()),N&&p.terrain.setupElevationDraw(Ge,Fe),p.uploadCommonUniforms(M,Fe,$e.toUnwrapped());let He=st=>{Se!=null&&(Se.value=re*C),Fe.draw(p,P.TRIANGLES,B,st,V,r.af.disabled,je,h.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,h.paint,p.transform.zoom,xe,[Ve.layoutVertexBuffer2,Ve.patternVertexBuffer,Ve.zOffsetVertexBuffer]),Se!=null&&(Se.value=re)};if(ie&&!N){let st=p.stencilModeForClipping($e).ref;st===0&&G&&M.clear({stencil:0});let pt={func:P.EQUAL,mask:255};je.u_alpha_discard_threshold=.8,He(new r.ag(pt,st,255,P.KEEP,P.KEEP,P.INVERT)),je.u_alpha_discard_threshold=0,He(new r.ag(pt,st,255,P.KEEP,P.KEEP,P.KEEP))}else ie&&N&&(je.u_alpha_discard_threshold=.001),He(N?Me:p.stencilModeForClipping($e))}ie&&(p.resetStencilClippingMasks(),G&&M.clear({stencil:0})),C===0||p.depthOcclusion||G||p.layersWithOcclusionOpacity.push(p.currentLayer),N&&(p.forceTerrainMode=!1)},fill:function(p,s,h,g){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let E=h.paint.get("fill-emissive-strength"),C=p.colorModeForDrapableLayerRenderPass(E),M=h.paint.get("fill-pattern"),P=p.opaquePassEnabledForLayer()&&!M.constantOr(1)&&v.constantOr(r.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===P){let k=p.depthModeForSublayer(1,p.renderPass==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly);Lp(p,s,h,g,k,C,!1)}if(p.renderPass==="translucent"&&h.paint.get("fill-antialias")){let k=p.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,r.ae.ReadOnly);Lp(p,s,h,g,k,C,!0)}},"fill-extrusion":function(p,s,h,g){let v=h.paint.get("fill-extrusion-opacity"),x=p.context,E=x.gl,C=p.terrain,M=C&&C.renderingToTexture;if(v===0)return;let P=p.conflationActive&&p.style.isLayerClipped(h,s.getSource()),k=p.style.order.indexOf(h.fqid);if(P&&function(N,B,V,G,H){for(let q of G){let W=B.getTile(q).getBucket(V);W&&(W.updateReplacement(q,N.replacementSource,H),W.uploadCentroid(N.context))}}(p,s,h,g,k),C||P)for(let N of g){let B=s.getTile(N).getBucket(h);B&&sd(p.context,s,N,B,h,C,P)}if(p.renderPass==="shadow"&&p.shadowRenderer){let N=p.shadowRenderer;if(C&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let B=N.getShadowPassDepthMode(),V=N.getShadowPassColorMode();zl(p,s,h,g,B,r.ag.disabled,V,P)}else if(p.renderPass==="translucent"){let N=!h.paint.get("fill-extrusion-pattern").constantOr(1),B=h.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!M&&B.a!==0){let V=new r.ae(p.context.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D);v===1&&N?zl(p,s,h,g,V,r.ag.disabled,r.a.unblended,P):(zl(p,s,h,g,V,r.ag.disabled,r.a.disabled,P),zl(p,s,h,g,V,p.stencilModeFor3D(),p.colorModeForRenderPass(),P),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&N&&(!C&&p.transform.projection.name!=="globe"||M)){let V=h.paint.get("fill-extrusion-opacity"),G=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=h.paint.get("fill-extrusion-flood-light-intensity"),W=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ee=G>0&&H>0,te=q>0,ne=(ce,J,re)=>(1-re)*ce+re*J,ue=ce=>{let J=p.depthModeForSublayer(1,r.ae.ReadOnly,E.LEQUAL,!0),re=h.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ie=ne(.1,3,re),ge=p._showOverdrawInspector;if(!ge){let Ce=new r.ag({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ae=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);Ci(p,s,h,g,J,Ce,ae,r.af.disabled,ce,"sdf",V,G,H,q,W,ie,P,!1)}{let Ce=ge?r.ag.disabled:new r.ag({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),ae=ge?p.colorModeForRenderPass():new r.a([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],r.C.transparent,[!0,!0,!0,!0]);Ci(p,s,h,g,J,Ce,ae,r.af.disabled,ce,"color",V,G,H,q,W,ie,P,!1)}};if(M){let ce=(J,re,ie)=>{let ge=p.depthModeForSublayer(1,r.ae.ReadOnly,E.LEQUAL,!1),Ce=h.paint.get(J?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ae=ne(.1,3,Ce);{let Se=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0]);Ci(p,s,h,g,ge,r.ag.disabled,Se,r.af.disabled,J,"clear",V,G,H,q,W,ae,P,re)}{let Se=new r.ag({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Me=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);Ci(p,s,h,g,ge,Se,Me,r.af.disabled,J,"sdf",V,G,H,q,W,ae,P,re)}{let Se=J?E.ZERO:E.ONE_MINUS_DST_ALPHA,Me=new r.ag({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),$e=new r.a([Se,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],r.C.transparent,[!0,!0,!0,!0]);Ci(p,s,h,g,ge,Me,$e,r.af.disabled,J,"color",V,G,H,q,W,ae,P,re)}{let Se=new r.a([E.ONE,E.ONE,E.ONE,J?E.ZERO:E.ONE],r.C.transparent,[!1,!1,!1,!0],J?E.FUNC_ADD:E.MAX);Ci(p,s,h,g,ge,r.ag.disabled,Se,r.af.disabled,J,"clear",V,G,H,q,W,ae,P,re,ie)}};if(ee||te){let J;if(p.prepareDrawTile(),C){let re=C.drapeBufferSize[0],ie=C.drapeBufferSize[1];J=C.framebufferCopyTexture,J&&(!J||J.size[0]===re&&J.size[1]===ie)||(J&&J.destroy(),J=C.framebufferCopyTexture=new r.T(x,new r.i({width:re,height:ie}),E.RGBA)),J.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,re,ie,0)}ee&&ce(!0,!1,J),te&&ce(!1,!0,J)}}else ee&&ue(!0),te&&ue(!1)}}},hillshade:function(p,s,h,g){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;let v=p.context,x=p.terrain&&p.terrain.renderingToTexture,[E,C]=p.renderPass!=="translucent"||x?[{},g]:p.stencilConfigForOverlap(g);for(let M of C){let P=s.getTile(M);if(P.needsHillshadePrepare&&p.renderPass==="offscreen")Bo(p,P,h);else if(p.renderPass==="translucent"){let k=p.depthModeForSublayer(0,r.ae.ReadOnly),N=h.paint.get("hillshade-emissive-strength"),B=p.colorModeForDrapableLayerRenderPass(N),V=x&&p.terrain?p.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];d1(p,M,P,h,k,V,B)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,h,g,v,x){if(p.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let E=p.transform.projection.name==="globe",C=h.paint.get("raster-elevation")!==0,M=C&&E;if(p.renderElevatedRasterBackface&&!M)return;let P=p.context,k=P.gl,N=s.getSource(),B=function(ce,J,re,ie){let ge=J.paint.get("raster-color"),Ce=ce.type==="raster-array",ae=[],Se=J.paint.get("raster-resampling"),Me=J.paint.get("raster-color-mix"),$e=J.paint.get("raster-color-range"),Ge=[Me[0],Me[1],Me[2],0],Ve=Me[3],xe=Se==="nearest"?ie.NEAREST:ie.LINEAR;if(Ce&&(ae.push("RASTER_ARRAY"),ge||ae.push("RASTER_COLOR"),Se==="linear"&&ae.push("RASTER_ARRAY_LINEAR"),xe=ie.NEAREST,!$e&&ce.rasterLayers)){let Re=ce.rasterLayers.find(({id:Fe})=>Fe===J.sourceLayer);Re&&Re.fields&&Re.fields.range&&($e=Re.fields.range)}if($e=$e||[0,1],ge){ae.push("RASTER_COLOR"),re.activeTexture.set(ie.TEXTURE2),J.updateColorRamp($e);let Re=J.colorRampTexture;Re||(Re=J.colorRampTexture=new r.T(re,J.colorRamp,ie.RGBA)),Re.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)}return{mix:Ge,range:$e,offset:Ve,defines:ae,resampling:xe}}(N,h,P,k);if(N instanceof r.bm&&!g.length&&!E)return;let V=h.paint.get("raster-emissive-strength"),G=p.colorModeForDrapableLayerRenderPass(V),H=p.terrain&&p.terrain.renderingToTexture,q=!p.options.moving,W=h.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(N instanceof r.bm&&!g.length&&(N.onNorthPole||N.onSouthPole)){let ce=C?p.stencilModeFor3D():r.ag.disabled;return void mu(!!N.onNorthPole,null,p,s,h,V,B,r.af.disabled,ce)}if(!g.length)return;let[ee,te]=N instanceof r.bm||H?[{},g]:p.stencilConfigForOverlap(g),ne=te[te.length-1].overscaledZ;M&&B.defines.push("PROJECTION_GLOBE_VIEW"),C&&B.defines.push("RENDER_CUTOFF");let ue=(ce,J,re)=>{for(let ie of ce){let ge=ie.toUnwrapped(),Ce=s.getTile(ie);if(H&&(!Ce||!Ce.hasData()))continue;P.activeTexture.set(k.TEXTURE0);let ae=y1(Ce,N,h,B);if(!ae||!ae.texture)continue;let{texture:Se,mix:Me,offset:$e,tileSize:Ge,buffer:Ve}=ae,xe,Re;H?(xe=r.ae.disabled,Re=ie.projMatrix):C?(xe=new r.ae(k.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D),Re=E?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(ge,q)):(xe=p.depthModeForSublayer(ie.overscaledZ-ne,h.paint.get("raster-opacity")===1?r.ae.ReadWrite:r.ae.ReadOnly,k.LESS),Re=p.transform.calculateProjMatrix(ge,q));let Fe=p.terrain&&H?p.terrain.stencilModeForRTTOverlap(ie):ee[ie.overscaledZ],ot=x?0:h.paint.get("raster-fade-duration");Ce.registerFadeDuration(ot);let ct=s.findLoadedParent(ie,0),at=Yh(Ce,ct,s,p.transform,ot),je,He;p.terrain&&p.terrain.prepareDrawTile(),P.activeTexture.set(k.TEXTURE0),Se.bind(W,k.CLAMP_TO_EDGE),P.activeTexture.set(k.TEXTURE1),ct?(ct.texture&&ct.texture.bind(W,k.CLAMP_TO_EDGE),je=Math.pow(2,ct.tileID.overscaledZ-Ce.tileID.overscaledZ),He=[Ce.tileID.canonical.x*je%1,Ce.tileID.canonical.y*je%1]):Se.bind(W,k.CLAMP_TO_EDGE),Se.useMipmap&&P.extTextureFilterAnisotropic&&p.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);let st=p.transform,pt,Ot=C?bn(st):[0,0,0,0],$t,cn,on,An,Bt,Sn=0;if(M&&N instanceof r.bm&&N.coordinates.length>3)$t=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0)))),cn=Float32Array.from(st.globeMatrix),on=Float32Array.from(r.bb(st)),An=[r.aj(st.center.lng),r.ak(st.center.lat)],pt=N.elevatedGlobePerspectiveTransform,Bt=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){let Vt=r.bc(ie.canonical);Sn=r.bd(Vt.getCenter().lat),$t=Float32Array.from(r.bf(r.bg(ie.canonical))),cn=Float32Array.from(st.globeMatrix),on=Float32Array.from(r.bb(st)),An=[r.aj(st.center.lng),r.ak(st.center.lat)],pt=[0,0],Bt=Float32Array.from(r.be(ie.canonical,Vt,Sn,st.worldSize/st._pixelsPerMercatorPixel))}else pt=N instanceof r.bm?N.perspectiveTransform:[0,0],$t=new Float32Array(16),cn=new Float32Array(9),on=new Float32Array(16),An=[0,0],Bt=new Float32Array(9);let Gn=cu(Re,$t,cn,on,Bt,He||[0,0],r.a1(p.transform.zoom),An,Ot,je||1,at,h,pt,C?h.paint.get("raster-elevation"):0,2,Me,$e,B.range,Ge,Ve,V),Rn=p.isTileAffectedByFog(ie),tn=p.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Rn});if(p.uploadCommonUniforms(P,tn,ge),N instanceof r.bm){let Vt=N.elevatedGlobeVertexBuffer,Xn=N.elevatedGlobeIndexBuffer;if(H||!E)N.boundsBuffer&&N.boundsSegments&&tn.draw(p,k.TRIANGLES,xe,r.ag.disabled,G,r.af.disabled,Gn,h.id,N.boundsBuffer,p.quadTriangleIndexBuffer,N.boundsSegments);else if(Vt&&Xn){let Jn=st.zoom<=r.b1?N.elevatedGlobeSegments:N.getSegmentsForLongitude(st.center.lng);Jn&&tn.draw(p,k.TRIANGLES,xe,r.ag.disabled,G,J,Gn,h.id,Vt,Xn,Jn)}}else if(M){xe=new r.ae(k.LEQUAL,r.ae.ReadOnly,p.depthRangeFor3D);let Vt=p.globeSharedBuffers;if(Vt){let[Xn,Jn,un]=Vt.getGridBuffers(Sn,!1);tn.draw(p,k.TRIANGLES,xe,re||Fe,p.colorModeForRenderPass(),J,Gn,h.id,Xn,Jn,un)}}else{let{tileBoundsBuffer:Vt,tileBoundsIndexBuffer:Xn,tileBoundsSegments:Jn}=p.getTileBoundsBuffers(Ce);tn.draw(p,k.TRIANGLES,xe,Fe,G,r.af.disabled,Gn,h.id,Vt,Xn,Jn)}}if(!(N instanceof r.bm)&&M)for(let ie of ce){let ge=ie.canonical.y===(1<<ie.canonical.z)-1;ie.canonical.y===0&&mu(!0,ie,p,s,h,V,B,J,re||r.ag.disabled),ge&&mu(!1,ie,p,s,h,V,B,J===r.af.frontCW?r.af.backCW:r.af.frontCW,re||r.ag.disabled)}};M?ue(te,p.renderElevatedRasterBackface?r.af.backCW:r.af.frontCW,p.stencilModeFor3D()):ue(te,r.af.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,s,h,g,v,x){p.renderPass==="offscreen"&&function(E,C,M,P){if(!P.length)return;let k=E.context,N=k.gl,B=C.getSource();if(!(B instanceof Rl))return;let V=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count"))),G=M.particlePositionRGBAImage;if(!G||G.width!==V){let te=function(ne){let ue=ne*ne,ce=new Uint8Array(4*ue),J=function(ie){return ie|=0,ie=Math.imul(2747636419^ie,2654435769),ie=Math.imul(ie^ie>>>16,2654435769),((ie=Math.imul(ie^ie>>>16,2654435769))>>>0)/4294967296},re=1/1.3;for(let ie=0;ie<ue;ie++){let ge=re*(J(2*ie+0)+Vs),Ce=re*(J(2*ie+1)+Vs),ae=255*ge%1,Se=255*Ce%1,Me=ae,$e=Ce-Se/255,Ge=Se;ce[4*ie+0]=255*(ge-ae/255),ce[4*ie+1]=255*Me,ce[4*ie+2]=255*$e,ce[4*ie+3]=255*Ge}return ce}(V);G=M.particlePositionRGBAImage=new r.i({width:V,height:V},te)}let H=M.particleFramebuffer;H?H.width!==V&&(H.destroy(),H=M.particleFramebuffer=k.createFramebuffer(V,V,!0,null)):H=M.particleFramebuffer=k.createFramebuffer(V,V,!0,null);let q=[];for(let te of P){let ne=C.getTile(te);if(!(ne instanceof r.c3))continue;let ue=It(ne,B,M);if(!ue)continue;let ce=[ne.tileSize,ne.tileSize],J=M.tileFramebuffer;J||(J=M.tileFramebuffer=k.createFramebuffer(ce[0],ce[1],!0,null));let re=ne.rasterParticleState;re||(re=ne.rasterParticleState=new eo(k,te,ce,G));let ie=re.update(M.lastInvalidatedAt);re.particleTextureDimension!==V&&re.updateParticleTexture(te,G);let ge=re.targetColorTexture;re.targetColorTexture=re.backgroundColorTexture,re.backgroundColorTexture=ge;let Ce=re.particleTexture0;re.particleTexture0=re.particleTexture1,re.particleTexture1=Ce,q.push([te,ue,re,ie])}if(q.length===0)return;let W=r.e.now(),ee=M.previousDrawTimestamp?.001*(W-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=W,M.hasColorMap()){k.activeTexture.set(N.TEXTURE0+2);let te=M.colorRampTexture;te||(te=M.colorRampTexture=new r.T(k,M.colorRamp,N.RGBA)),te.bind(N.LINEAR,N.CLAMP_TO_EDGE)}k.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(te,ne,ue){let ce=te.context,J=ce.gl,re=ne.tileFramebuffer;ce.activeTexture.set(J.TEXTURE0);let ie={u_texture:0,u_opacity:1.05*(Ce=ne.paint.get("raster-particle-fade-opacity-factor"))/(Ce+.05)},ge=te.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ce;for(let ae of ue){let[,,Se,Me]=ae;re.colorAttachment.set(Se.targetColorTexture.texture),ce.viewport.set([0,0,re.width,re.height]),ce.clear({color:r.C.transparent}),Me&&(Se.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),ge.draw(te,J.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,ie,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments))}}(E,M,q),function(te,ne,ue,ce){let J=te.context,re=J.gl,ie=ue.tileFramebuffer,ge=te.transform.projection.name==="globe",Ce=ue.paint.get("raster-particle-max-speed");for(let ae of ce){let[Se,Me,$e]=ae;J.activeTexture.set(re.TEXTURE0+0),Me.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE),ie.colorAttachment.set($e.targetColorTexture.texture);let Ge=te.getOrCreateProgram("rasterParticleDraw",{defines:Me.defines,overrideFog:!1});J.activeTexture.set(re.TEXTURE0+1);let Ve=Me.scalarData?[]:[0,1,2,3].map(Fe=>r.bZ[Fe](Se));Ve.push(Se);let xe=Se.canonical.x,Re=Se.canonical.y;for(let Fe of Ve){let ot=ne.getTile(ge?Fe.wrapped():Fe);if(!ot)continue;let ct=ot.rasterParticleState;if(!ct)continue;let at=Fe.canonical.x+(1<<Fe.canonical.z)*(Fe.wrap-Se.wrap),je=Fe.canonical.y;ct.particleTexture0.bind(re.NEAREST,re.CLAMP_TO_EDGE);let He=Rp(1,ct.particleTexture0.size[0],[at-xe,je-Re],0,Me.texture.size,2,Ce,Me.textureOffset,Me.scale,Me.offset);Ge.draw(te,re.POINTS,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,He,ue.id,ct.particleIndexBuffer,void 0,ct.particleSegment)}}}(E,C,M,q),k.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(te,ne,ue,ce){let J=te.context,re=J.gl,ie=ne.paint.get("raster-particle-max-speed"),ge=ce*ne.paint.get("raster-particle-speed-factor")*.15,Ce=function(Se){return Math.pow(Se,6)}(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),ae=ne.particleFramebuffer;J.viewport.set([0,0,ae.width,ae.height]);for(let Se of ue){let[,Me,$e]=Se;J.activeTexture.set(re.TEXTURE0+0),Me.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE),J.activeTexture.set(re.TEXTURE0+1);let Ge=$e.particleTexture0;Ge.bind(re.NEAREST,re.CLAMP_TO_EDGE);let Ve=p1(1,Ge.size[0],0,Me.texture.size,ie,ge,Ce,Me.textureOffset,Me.scale,Me.offset);ae.colorAttachment.set($e.particleTexture1.texture),J.clear({color:r.C.transparent}),te.getOrCreateProgram("rasterParticleUpdate",{defines:Me.defines}).draw(te,re.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,Ve,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments)}}(E,M,q,ee)}(p,s,h,g),p.renderPass==="translucent"&&(function(E,C,M,P,k){let N=E.context,B=N.gl,V=!E.options.moving,G=E.transform.projection.name==="globe";if(!P.length)return;let[H,q]=E.stencilConfigForOverlap(P),W=[];G&&W.push("PROJECTION_GLOBE_VIEW");let ee=E.stencilModeFor3D();for(let te of q){let ne=te.toUnwrapped(),ue=C.getTile(te);if(!ue.rasterParticleState)continue;let ce=ue.rasterParticleState,J=100;ue.registerFadeDuration(J);let re=C.findLoadedParent(te,0),ie=Yh(ue,re,C,E.transform,J),ge,Ce;E.terrain&&E.terrain.prepareDrawTile(),N.activeTexture.set(B.TEXTURE0),ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),N.activeTexture.set(B.TEXTURE1),re&&re.rasterParticleState?(re.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ge=Math.pow(2,re.tileID.overscaledZ-ue.tileID.overscaledZ),Ce=[ue.tileID.canonical.x*ge%1,ue.tileID.canonical.y*ge%1]):ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let ae=G?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(ne,V),Se=E.transform,Me=j_(Se),$e=r.bc(te.canonical),Ge=r.bd($e.getCenter().lat),Ve,xe,Re,Fe,ot;G?(Ve=Float32Array.from(r.bf(r.bg(te.canonical))),xe=Float32Array.from(Se.globeMatrix),Re=Float32Array.from(r.bb(Se)),Fe=[r.aj(Se.center.lng),r.ak(Se.center.lat)],ot=Float32Array.from(r.be(te.canonical,$e,Ge,Se.worldSize/Se._pixelsPerMercatorPixel))):(Ve=new Float32Array(16),xe=new Float32Array(9),Re=new Float32Array(16),Fe=[0,0],ot=new Float32Array(9));let ct=Pp(ae,Ve,xe,Re,ot,Ce||[0,0],r.a1(E.transform.zoom),Fe,Me,ge||1,ie,250),at=E.isTileAffectedByFog(te),je=E.getOrCreateProgram("rasterParticle",{defines:W,overrideFog:at});if(E.uploadCommonUniforms(N,je,ne),G){let He=new r.ae(B.LEQUAL,r.ae.ReadWrite,E.depthRangeFor3D),st=0,pt=E.globeSharedBuffers;if(pt){let[Ot,$t,cn]=pt.getGridBuffers(Ge,st!==0);je.draw(E,B.TRIANGLES,He,ee,r.a.alphaBlended,r.af.backCCW,ct,M.id,Ot,$t,cn)}}else{let He=E.depthModeForSublayer(0,r.ae.ReadOnly),st=H[te.overscaledZ],{tileBoundsBuffer:pt,tileBoundsIndexBuffer:Ot,tileBoundsSegments:$t}=E.getTileBoundsBuffers(ue);je.draw(E,B.TRIANGLES,He,st,r.a.alphaBlended,r.af.disabled,ct,M.id,pt,Ot,$t)}}E.resetStencilClippingMasks()}(p,s,h,g),p.style.map.triggerRepaint())},background:function(p,s,h,g){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity"),E=h.paint.get("background-emissive-strength");if(x===0)return;let C=p.context,M=C.gl,P=p.transform,k=P.tileSize,N=h.paint.get("background-pattern"),B;if(N!==void 0&&(N===null||(B=p.imageManager.getPattern(N.toString(),h.scope,p.style.getLut(h.scope)),!B)))return;let V=!N&&v.a===1&&x===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==V)return;let G=r.ag.disabled,H=p.depthModeForSublayer(0,V==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly),q=p.colorModeForDrapableLayerRenderPass(E),W=N?"backgroundPattern":"background",ee,te=g;te||(ee=p.getBackgroundTiles(),te=Object.values(ee).map(ne=>ne.tileID)),N&&(C.activeTexture.set(M.TEXTURE0),p.imageManager.bind(p.context,h.scope));for(let ne of te){let ue=p.isTileAffectedByFog(ne),ce=p.getOrCreateProgram(W,{overrideFog:ue}),J=ne.toUnwrapped(),re=g?ne.projMatrix:p.transform.calculateProjMatrix(J);p.prepareDrawTile();let ie=s?s.getTile(ne):ee?ee[ne.key]:new r.by(ne,k,P.zoom,p),ge=N?L_(re,E,x,p,0,h.scope,B,{tileID:ne,tileSize:k}):hu(re,E,x,v.toRenderColor(h.lut));p.uploadCommonUniforms(C,ce,J);let{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:ae,tileBoundsSegments:Se}=p.getTileBoundsBuffers(ie);ce.draw(p,M.TRIANGLES,H,G,q,r.af.disabled,ge,h.id,Ce,ae,Se)}},sky:function(p,s,h){let g=p._atmosphere?r.a1(p.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;let x=p.context,E=h.paint.get("sky-type"),C=new r.ae(x.gl.LEQUAL,r.ae.ReadOnly,[0,1]),M=p.frameCounter/1e3%1;E==="atmosphere"?p.renderPass==="offscreen"?h.needsSkyboxCapture(p)&&(function(P,k,N,B){let V=P.context,G=V.gl,H=k.skyboxFbo;if(!H){H=k.skyboxFbo=V.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new jl(V),k.skyboxTexture=V.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,k.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let te=0;te<6;++te)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(H.framebuffer),V.viewport.set([0,0,32,32]);let q=k.getCenter(P,!0),W=P.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);r.ad.identity(ee),r.ad.rotateY(ee,ee,.5*-Math.PI),$o(P,k,W,ee,q,0),r.ad.identity(ee),r.ad.rotateY(ee,ee,.5*Math.PI),$o(P,k,W,ee,q,1),r.ad.identity(ee),r.ad.rotateX(ee,ee,.5*-Math.PI),$o(P,k,W,ee,q,2),r.ad.identity(ee),r.ad.rotateX(ee,ee,.5*Math.PI),$o(P,k,W,ee,q,3),r.ad.identity(ee),$o(P,k,W,ee,q,4),r.ad.identity(ee),r.ad.rotateY(ee,ee,Math.PI),$o(P,k,W,ee,q,5),V.viewport.set([0,0,P.width,P.height])}(p,h),h.markSkyboxValid(p)):p.renderPass==="sky"&&function(P,k,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skybox");G.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,k.skyboxTexture);let ee=((te,ne,ue,ce,J)=>({u_matrix:te,u_sun_direction:ne,u_cubemap:0,u_opacity:ce,u_temporal_offset:J}))(q.skyboxMatrix,k.getCenter(P,!1),0,B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,r.ag.disabled,P.colorModeForRenderPass(),r.af.backCW,ee,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(p,h,C,v,M):E==="gradient"&&p.renderPass==="sky"&&function(P,k,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new jl(G)),G.activeTexture.set(H.TEXTURE0);let ee=k.colorRampTexture;ee||(ee=k.colorRampTexture=new r.T(G,k.colorRamp,H.RGBA)),ee.bind(H.LINEAR,H.CLAMP_TO_EDGE);let te=((ne,ue,ce,J,re)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ue,u_radius:r.ab(ce),u_opacity:J,u_temporal_offset:re}))(q.skyboxMatrix,k.getCenter(P,!1),k.paint.get("sky-gradient-radius"),B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,r.ag.disabled,P.colorModeForRenderPass(),r.af.backCW,te,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(p,h,C,v,M)},debug:function(p,s,h,g,v,x){for(let E=0;E<h.length;E++)if(v){let P=new r.C(g.r*.8,g.g*.8,g.b*.8,1);dt(p,s,h[E],g,-1,-1,x),dt(p,s,h[E],g,-1,1,x),dt(p,s,h[E],g,1,1,x),dt(p,s,h[E],g,1,-1,x),dt(p,s,h[E],P,0,0,x)}else dt(p,s,h[E],g,0,0,x)},custom:function(p,s,h,g){let v=p.context,x=h.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&h.isDraped(s)){if(p.renderPass==="offscreen"){let E=x.prerender;if(E){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){let C=p.transform.pointMerc;E.call(x,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a1(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else E.call(x,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){let C=x.renderToTile;if(C){let M=g[0].canonical,P=new r.Y(M.x+g[0].wrap*(1<<M.z),M.y,M.z);v.setDepthMode(r.ae.disabled),v.setStencilMode(r.ag.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),C.call(x,v.gl,P),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(r.ag.disabled);let E=x.renderingMode==="3d"?new r.ae(p.context.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,r.ae.ReadOnly);if(v.setDepthMode(E),p.transform.projection.name==="globe"){let C=p.transform.pointMerc;x.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a1(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else x.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,s,h,g){if(p.renderPass==="opaque")return;let v=h.paint.get("model-opacity");if(v===0)return;let x=h.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!x||p.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let E=p.shadowRenderer,C=h.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,C||(E.enabled=!1));let M=()=>{E&&(E.useNormalOffset=!0,C||(E.enabled=!0))},P=s.getSource();if(p.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(W,ee,te,ne,ue){let ce=W.transform;if(ce.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${ce.projection.name} projection is not yet implemented`);let J=ce.getFreeCameraOptions().position;if(!W.modelManager)return;let re=W.modelManager;te.modelManager=re;let ie=W.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ge=te._unevaluatedLayout._values["model-id"],Ce=xt({},te.layout.get("model-id").parameters),ae=W.style.order.indexOf(te.fqid);for(let Se of ne){let Me=ee.getTile(Se).getBucket(te);if(!Me||Me.projection.name!==ce.projection.name)continue;let $e=Me.getModelUris();$e&&!Me.modelsRequested&&(re.addModelsFromBucket($e,ue),Me.modelsRequested=!0);let Ge=Pr(Se,ce);Ce.zoom=Ge;let Ve=ge.possiblyEvaluate(Ce);if(U_(W,Me,Se),Di.shadowUniformsInitialized=!1,Di.useSingleShadowCascade=!!ie&&ie.getMaxCascadeForTile(Se.toUnwrapped())===0,W.renderPass==="shadow"&&ie){if(W.currentShadowCascade===1&&Me.isInsideFirstShadowMapFrustum)continue;let Fe=ce.calculatePosMatrix(Se.toUnwrapped(),ce.worldSize);if(Di.tileMatrix.set(Fe),Di.shadowTileMatrix=Float32Array.from(ie.calculateShadowPassMatrixFromMatrix(Fe)),Di.aabb.min.fill(0),Di.aabb.max[0]=Di.aabb.max[1]=r.a3,Di.aabb.max[2]=0,zr(Me,Di,W,te.scope))continue}let xe=1<<Se.canonical.z,Re=[((J.x-Se.wrap)*xe-Se.canonical.x)*r.a3,(J.y*xe-Se.canonical.y)*r.a3,J.z*xe*r.a3];W.conflationActive&&Object.keys(Me.instancesPerModel).length>0&&W.style.isLayerClipped(te,ee.getSource())&&Me.updateReplacement(Se,W.replacementSource,ae)&&(Me.uploaded=!1,Me.upload(W.context));for(let Fe in Me.instancesPerModel){let ot=Me.instancesPerModel[Fe];ot.features.length>0&&(Fe=Ve.evaluate(ot.features[0].feature,{}));let ct=re.getModel(Fe,ue);if(ct&&ct.uploaded)for(let at of ct.nodes)io(W,te,at,ot,Re,Se,Di)}}}(p,s,h,g,P.type==="vector"?h.scope:""),void M();if(!P.loaded())return;if(P.type==="batched-model")return function(W,ee,te,ne){te.resetLayerRenderingStats(W);let ue=W.context,ce=W.transform,J=W.style.fog,re=W.shadowRenderer;if(ce.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ce.projection.name} projection is not yet implemented`);let ie=W.transform.getFreeCameraOptions().position,ge=r._.scale([],[ie.x,ie.y,ie.z],W.transform.worldSize);r._.negate(ge,ge);let Ce=r.ad.identity([]),ae=r.cg(ce.center.lat,ce.zoom),Se=r.ad.fromScaling([],[1,1,1/ae]);r.ad.translate(Ce,Ce,ge);let Me=te.paint.get("model-opacity"),$e=new r.ae(ue.gl.LEQUAL,r.ae.ReadWrite,W.depthRangeFor3D),Ge=new r.ae(ue.gl.LEQUAL,r.ae.ReadOnly,W.depthRangeFor3D),Ve=new r.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xe=W.renderPass==="shadow",Re=xe&&re?re.getCurrentCascadeFrustum():ce.getFrustum(ce.scaleZoom(ce.worldSize)),Fe=te.paint.get("model-front-cutoff"),ot=Fe[2]<1,ct=os(W,te.paint.get("model-cutoff-fade-range")),at=te.getLayerRenderingStats();(function(je,He,st,pt){let Ot=je.terrain?je.terrain.exaggeration():0,$t=je.transform.zoom;for(let cn of pt){let on=He.getTile(cn).getBucket(st);on&&(je.conflationActive&&on.updateReplacement(cn,je.replacementSource),on.evaluateScale(je,st),je.terrain&&Ot>0&&on.elevationUpdate(je.terrain,Ot,cn,st.source),on.needsReEvaluation(je,$t,st)&&on.evaluate(st))}})(W,ee,te,ne),function(){let je,He,st;ot?(je=ne.length-1,He=-1,st=-1):(je=0,He=ne.length,st=1);for(let pt=je;pt!==He;pt+=st){let Ot=ne[pt],$t=ee.getTile(Ot).getBucket(te);if(!$t||!$t.uploaded)continue;let cn=!1;re&&(cn=re.getMaxCascadeForTile(Ot.toUnwrapped())===0);let on=ce.calculatePosMatrix(Ot.toUnwrapped(),ce.worldSize),An=$t.modelTraits,Bt=[];for(let Sn of $t.getNodesInfo()){if(Sn.hiddenByReplacement||!Sn.node.meshes)continue;let Gn=Sn.node,Rn=0;W.terrain&&Gn.elevation&&(Rn=Gn.elevation*W.terrain.exaggeration());let tn=Sn.evaluatedScale;if(tn[0]<=1&&tn[1]<=1&&tn[2]<=1&&(()=>{let Te=Sn.aabb;return Ve.min=[...Te.min],Ve.max=[...Te.max],Ve.min[2]+=Rn,Ve.max[2]+=Rn,r._.transformMat4(Ve.min,Ve.min,on),r._.transformMat4(Ve.max,Ve.max,on),Ve})().intersects(Re)===0)continue;let Vt=[...on],Xn=Gn.anchor?Gn.anchor[0]:0,Jn=Gn.anchor?Gn.anchor[1]:0;r.ad.translate(Vt,Vt,[Xn*(tn[0]-1),Jn*(tn[1]-1),Rn]),r._.exactEquals(tn,r.cj)||r.ad.scale(Vt,Vt,tn);let un=r.ad.multiply([],Vt,Gn.matrix),Be=r.ad.multiply([],ce.expandedFarZProjMatrix,un),ut=r.ad.multiply([],ce.expandedFarZProjMatrix,Vt),Lr=r.aA.transformMat4([],[Xn,Jn,Rn,1],Be)[2];Gn.hidden=!1;let Pn=Me;xe||(ot&&(Pn*=bo(Vt,ce,Sn.aabb,Fe)),Pn*=Vp(ct,Lr)),Pn!==0?Bt.push({nodeInfo:Sn,depth:Lr,opacity:Pn,wvpForNode:Be,wvpForTile:ut,nodeModelMatrix:un,tileModelMatrix:Vt}):Gn.hidden=!0}xe||Bt.sort((Sn,Gn)=>!ot||Sn.opacity===1&&Gn.opacity===1?Sn.depth<Gn.depth?-1:1:Sn.opacity===1?-1:Gn.opacity===1?1:Sn.depth>Gn.depth?-1:1);for(let Sn of Bt){let Gn=Sn.nodeInfo,Rn=Gn.node,tn=r.ad.multiply([],Se,Sn.tileModelMatrix);r.ad.multiply(tn,Ce,tn);let Vt=r.ad.invert([],tn);r.ad.transpose(Vt,Vt),r.ad.scale(Vt,Vt,ls),tn=r.ad.multiply(tn,tn,Rn.matrix);let Xn=W.renderPass==="light-beam",Jn=An&r.cl.HasMapboxMeshFeatures,un=Jn?0:Gn.evaluatedRMEA[0][2];for(let Be=0;Be<Rn.meshes.length;++Be){let ut=Rn.meshes[Be],Lr=Be===Rn.lightMeshIndex,Pn=Sn.wvpForNode;if(Lr){if(!Xn&&!W.terrain&&W.shadowRenderer){W.currentLayer<W.firstLightBeamLayer&&(W.firstLightBeamLayer=W.currentLayer);continue}Pn=Sn.wvpForTile}else if(Xn)continue;let Te={defines:[]},Mi=[];if(_u(Te.defines,Mi,ut,W,te.lut),Jn||Te.defines.push("DIFFUSE_SHADED"),cn&&Te.defines.push("SHADOWS_SINGLE_CASCADE"),at&&(xe?at.numRenderedVerticesInShadowPass+=ut.vertexArray.length:at.numRenderedVerticesInTransparentPass+=ut.vertexArray.length),xe){Ii(ut,Sn.nodeModelMatrix,W,te);continue}let ui=null;if(J){let Zs=Ul(Sn.nodeModelMatrix,W.transform);if(ui=new Float32Array(Zs),ce.projection.name!=="globe"){let Xs=ut.aabb.min,us=ut.aabb.max,[Ho,hs]=J.getOpacityForBounds(Zs,Xs[0],Xs[1],us[0],us[1]);Te.overrideFog=Ho>=nr||hs>=nr}}let Br=ut.material,bi;Br.occlusionTexture&&Br.occlusionTexture.offsetScale&&(bi=Br.occlusionTexture.offsetScale,Te.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!xe&&re&&(re.useNormalOffset=!!ut.normalBuffer);let Ni=W.getOrCreateProgram("model",Te);!xe&&re&&re.setupShadowsFromMatrix(Sn.tileModelMatrix,Ni,re.useNormalOffset),W.uploadCommonUniforms(ue,Ni,null,ui);let so=Br.pbrMetallicRoughness;so.metallicFactor=.9,so.roughnessFactor=.5;let qi=du(new Float32Array(Pn),new Float32Array(tn),new Float32Array(Vt),new Float32Array(Rn.matrix),W,Sn.opacity,so.baseColorFactor.toRenderColor(null),Br.emissiveFactor,so.metallicFactor,so.roughnessFactor,Br,un,te,[0,0,0],bi);!Lr&&(Gn.hasTranslucentParts||Sn.opacity<1)&&Ni.draw(W,ue.gl.TRIANGLES,$e,r.ag.disabled,r.a.disabled,r.af.backCCW,qi,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Mi),Ni.draw(W,ue.gl.TRIANGLES,Lr?Ge:$e,r.ag.disabled,Lr||Sn.opacity<1||Gn.hasTranslucentParts?r.a.alphaBlended:r.a.unblended,r.af.backCCW,qi,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Mi)}}}}()}(p,s,h,g),void M();let k=P.getModels(),N=[],B=p.transform.getFreeCameraOptions().position,V=r._.scale([],[B.x,B.y,B.z],p.transform.worldSize);r._.negate(V,V);let G=[],H=[],q=0;for(let W of k){let ee=h.paint.get("model-rotation").constantOr(null),te=h.paint.get("model-scale").constantOr(null),ne=h.paint.get("model-translation").constantOr(null);W.computeModelMatrix(p,ee,te,ne,!0,!0,!1);let ue=r.ad.identity([]),ce=r.cg(W.position.lat,p.transform.zoom),J=r.ad.fromScaling([],[1,1,1/ce]);r.ad.translate(ue,ue,V),N.push({zScaleMatrix:J,negCameraPosMatrix:ue});for(let re of W.nodes)ci(p.transform,re,W.matrix,p.transform.expandedFarZProjMatrix,q,G,H);q++}if(G.sort((W,ee)=>ee.depth-W.depth),p.renderPass!=="shadow"){if(v===1)for(let W of H)Fa(W,p,h,N[W.modelIndex],r.ag.disabled,p.colorModeForRenderPass());else{for(let W of H)Fa(W,p,h,N[W.modelIndex],r.ag.disabled,r.a.disabled);for(let W of H)Fa(W,p,h,N[W.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(let W of G)Fa(W,p,h,N[W.modelIndex],r.ag.disabled,p.colorModeForRenderPass());M()}else{for(let W of H)Ii(W.mesh,W.nodeModelMatrix,p,h);for(let W of G)Ii(W.mesh,W.nodeModelMatrix,p,h);M()}}},$_={model:function(p,s,h){let g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?p.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(h.context)},raster:function(p,s,h){let g=s.getSource();if(!(g instanceof Rl&&g.loaded()))return;let v=p.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=p.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let E=s.getIds().map(C=>s.getTileByID(C));for(let C of E)C.updateNeeded(v,x)&&g.prepareTile(C,v,x)},"raster-particle":function(p,s,h){let g=s.getSource();if(!(g instanceof Rl&&g.loaded()))return;let v=p.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=p.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let E=s.getIds().map(C=>s.getTileByID(C));for(let C of E)C.updateNeeded(v,x)&&g.prepareTile(C,v,x)}};class G_{constructor(s,h,g,v){this.context=new Zc(s,h),this.occlusionBuffers=new x1(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=r.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let E of x)this._debugParams.enabledLayers[E]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let E of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],E);this.symbolParams=new vl(v),this.setup(),this.numSublayers=r.bv.maxUnderzooming+r.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Wh(this),this._wireframeDebugCache=new vu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(s,h){let g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Cp(this,s));let v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){let h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new Cp(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,h){if(this.width=s*r.e.devicePixelRatio,this.height=h*r.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let s=this.context,h=new r.bt;h.emplaceBack(0,0),h.emplaceBack(r.a3,0),h.emplaceBack(0,r.a3),h.emplaceBack(r.a3,r.a3),this.tileExtentBuffer=s.createVertexBuffer(h,r.br.members),this.tileExtentSegments=r.b.simpleSegment(0,0,4,2);let g=new r.bt;g.emplaceBack(0,0),g.emplaceBack(r.a3,0),g.emplaceBack(0,r.a3),g.emplaceBack(r.a3,r.a3),this.debugBuffer=s.createVertexBuffer(g,r.br.members),this.debugSegments=r.b.simpleSegment(0,0,4,5);let v=new r.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,r.br.members),this.viewportSegments=r.b.simpleSegment(0,0,4,2);let x=new r.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(r.a3,0,r.a3,0),x.emplaceBack(0,r.a3,0,r.a3),x.emplaceBack(r.a3,r.a3,r.a3,r.a3),this.mercatorBoundsBuffer=s.createVertexBuffer(x,r.cq.members),this.mercatorBoundsSegments=r.b.simpleSegment(0,0,4,2);let E=new r.bu;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);let C=new r.cr;for(let P of[0,1,3,2,0])C.emplaceBack(P);this.debugIndexBuffer=s.createIndexBuffer(C),this.emptyTexture=new r.T(s,new r.i({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=r.ad.create();let M=this.context.gl;this.stencilClearMode=new r.ag({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,r.ae.disabled,this.stencilClearMode,r.a.disabled,r.af.disabled,Xh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(let M of g)if(this._tileClippingMaskIDs[M.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let C of g){let M=h.getTile(C),P=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(M);E.draw(this,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,Xh(C.projMatrix),"$clipping",k,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let s=this.nextStencilID++,h=this.context.gl;return new r.ag({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);let h=this.context.gl;return new r.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){let h=this.context.gl,g=s.sort((E,C)=>C.overscaledZ-E.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let E={};for(let C=0;C<x;C++)E[C+v]=new r.ag({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,g]}return[{[v]:r.ag.disabled},g]}colorModeForRenderPass(){let s=this.context.gl;return this._showOverdrawInspector?new r.a([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(s){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new r.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,h,g,v=!1){if(this.depthOcclusion)return new r.ae(this.context.gl.GREATER,r.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return r.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new r.ae(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,h)=>s+h/this._fpsHistory.length,0))}render(s,h){let g=r.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=h;let v=this.style._mergedLayers,x=this.style.order.filter(re=>{let ie=v[re];return!(ie.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ie.type]}),E=x.map(re=>v[re]),C=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(r.e.now()),this.imageManager.beginFrame();let M=0,P=!1;for(let re in C){let ie=C[re];ie.used&&(ie.prepare(this.context),ie.getSource().usedInConflation&&++M)}let k=!1;for(let re of E)re.isHidden(this.transform.zoom)||(re.type==="clip"&&(k=!0),this.prepareLayer(re));let N={},B={},V={},G={},H={};for(let re in C){let ie=C[re];N[re]=ie.getVisibleCoordinates(),B[re]=N[re].slice().reverse(),V[re]=ie.getVisibleCoordinates(!0).reverse(),G[re]=ie.getShadowCasterCoordinates(),H[re]=ie.sortCoordinatesByDistance(N[re])}let q=re=>{let ie=this.style.getLayerSourceCache(re);return ie&&ie.used?ie.getSource():null};if(M||k){let re=[],ie=[],ge=0;for(let Ce of E)this.isSourceForClippingOrConflation(Ce,q(Ce))&&(re.push(Ce),ie.push(ge)),ge++;if(re&&(k||re.length>1)){let Ce=[];for(let ae=0;ae<re.length;ae++){let Se=re[ae],Me=ie[ae],$e=this.style.getLayerSourceCache(Se);if(!$e||!$e.used||!$e.getSource().usedInConflation&&Se.type!=="clip")continue;let Ge=1/0,Ve=r.cu.None;if(Se.type==="clip"){Ge=Me;for(let xe of Se.layout.get("clip-layer-types"))Ve|=xe==="model"?r.cu.Model:xe==="symbol"?r.cu.Symbol:r.cu.FillExtrusion}Ce.push({layer:Se.fqid,cache:$e,order:Ge,clipMask:Ve})}this.replacementSource.setSources(Ce),P=!0}}P||this.replacementSource.clear(),this.conflationActive=P,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let re=0;re<E.length;re++){let ie=E[re],ge=ie.cutoffRange();if(this.longestCutoffRange=Math.max(ge,this.longestCutoffRange),ge>0){let Ce=q(ie);Ce&&(this.minCutoffZoom=Math.max(Ce.minzoom,this.minCutoffZoom)),ie.minzoom&&(this.minCutoffZoom=Math.max(ie.minzoom,this.minCutoffZoom))}ie.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=re),this._lastOcclusionLayer=re)}let W=this.style&&this.style.fog;W?(this._fogVisible=W.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=W.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(V),this.opaquePassCutoff=0);let ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(let re in C)for(let ie of N[re]){let ge={min:0,max:0};this.terrain&&(ge=this.terrain.getMinMaxForTile(ie)||ge),ee.addShadowReceiver(ie.toUnwrapped(),ge.min,ge.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Bp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.ct(this.context.gl))return;this.renderPass="offscreen";for(let re of E){let ie=s.getLayerSourceCache(re);if(!re.hasOffscreenPass()||re.isHidden(this.transform.zoom))continue;let ge=ie?B[ie.id]:void 0;(re.type==="custom"||re.type==="raster"||re.type==="raster-particle"||re.isSky()||ge&&ge.length)&&this.renderLayer(this,ie,re,ge)}this.depthRangeFor3D=[0,1-(E.length+2)*this.numSublayers*this.depthEpsilon];let te=this.terrain;te&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&te.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,G)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ne=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ue=(()=>{if(h.showOverdrawInspector)return r.C.black;let re=this.style.fog;if(re&&this.transform.projection.supportsFog){let ie=this.style.getLut(re.scope);if(!ne){let ge=re.properties.get("color").toRenderColor(ie).toArray01();return new r.C(...ge)}if(ne){let ge=re.properties.get("space-color").toRenderColor(ie).toArray01();return new r.C(...ge)}}return r.C.transparent})();if(this.context.clear({color:ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let re=E[this.currentLayer],ie=s.getLayerSourceCache(re);if(re.isSky())continue;let ge=ie?(re.is3D()?H:B)[ie.id]:void 0;this._renderTileClippingMasks(re,ie,ge),this.renderLayer(this,ie,re,ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let re=E[this.currentLayer],ie=s.getLayerSourceCache(re);re.isSky()&&this.renderLayer(this,ie,re,ie?B[ie.id]:void 0)}function ce(re,ie){let ge;return ie&&(ge=(re.type==="symbol"?V:re.is3D()?H:B)[ie.id]),ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let re=E[this.currentLayer];if(re.type==="raster"){let ie=s.getLayerSourceCache(re);this.renderLayer(this,ie,re,ce(re,ie))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let J=0;for(ee&&(J=ee.getShadowCastingLayerCount());this.currentLayer<x.length;){let re=E[this.currentLayer],ie=s.getLayerSourceCache(re);if(re.isSky())++this.currentLayer;else if(te&&this.style.isLayerDraped(re)){if(re.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=te.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(re.is3D()||this.terrain||this._renderTileClippingMasks(re,ie,ie?N[ie.id]:void 0),this.renderLayer(this,ie,re,ce(re,ie)),!te&&ee&&J>0&&re.hasShadowPass()&&--J==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ge;this.currentLayer++){let Ce=E[this.currentLayer];if(!Ce.hasLightBeamPass())continue;let ae=s.getLayerSourceCache(Ce);this.renderLayer(this,ae,Ce,ae?B[ae.id]:void 0)}this.currentLayer=ge,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let ge=this.currentLayer;this.depthOcclusion=!0;for(let Ce of this.layersWithOcclusionOpacity){this.currentLayer=Ce;let ae=E[this.currentLayer],Se=s.getLayerSourceCache(ae),Me=Se?B[Se.id]:void 0;ae.is3D()||this.terrain||this._renderTileClippingMasks(ae,Se,Se?N[Se.id]:void 0),this.renderLayer(this,Se,ae,Me)}this.depthOcclusion=!1,this.currentLayer=ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let re=null;E.forEach(ie=>{let ge=s.getLayerSourceCache(ie);ge&&!ie.isHidden(this.transform.zoom)&&ge.getVisibleCoordinates().length&&(!re||re.getSource().maxzoom<ge.getSource().maxzoom)&&(re=ge)}),re&&this.options.showTileBoundaries&&wo.debug(this,re,re.getVisibleCoordinates(),r.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&wo.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(re){let ie=re.transform.padding;wn(re,re.transform.height-(ie.top||0),3,ld),wn(re,ie.bottom||0,3,Np),En(re,ie.left||0,3,Uo),En(re,re.transform.width-(ie.right||0),3,zp);let ge=re.transform.centerPoint;(function(Ce,ae,Se,Me){Si(Ce,ae-1,Se-10,2,20,Me),Si(Ce,ae-10,Se-1,20,2,Me)})(re,ge.x,re.transform.height-ge.y,Bl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),P||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);let{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(s.type);if($_[s.type]&&(g||this.terrain&&s.type==="custom")){let v=this.style.getLayerSourceCache(s);$_[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||wo[g.type](s,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let s=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){let s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){let h={};for(let g in s){let v=s[g],x=this.context.extTimerQuery,E=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),h[g]=E}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of s)v+=h.getQueryParameter(x,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(x);return v}translatePosMatrix(s,h,g,v,x){if(!g[0]&&!g[1])return s;let E=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(E){let P=Math.sin(E),k=Math.cos(E);g=[g[0]*k-g[1]*P,g[0]*P+g[1]*k]}let C=[x?g[0]:r.bB(h,g[0],this.transform.zoom),x?g[1]:r.bB(h,g[1],this.transform.zoom),0],M=new Float32Array(16);return r.ad.translate(M,s,C),M}saveTileTexture(s){let h=s.size[0],g=this._tileTextures[h];g?g.push(s):this._tileTextures[h]=[s]}getTileTexture(s){let h=this._tileTextures[s];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,h,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(s,h){this.cache=this.cache||{};let g=h&&h.defines||[],v=h&&h.config,x=this.currentGlobalDefines(s,h&&h.overrideFog,h&&h.overrideRtt).concat(g),E=au.cacheKey(S_[s],s,x,v);return this.cache[E]||(this.cache[E]=new au(this.context,s,S_[s],v,m1[s],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,h){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((E,C,M)=>{let P=E.properties.get("direction"),k=E.properties.get("color").toRenderColor(M.getLut(E.scope)).toArray01(),N=E.properties.get("intensity"),B=C.properties.get("color").toRenderColor(M.getLut(C.scope)).toArray01(),V=C.properties.get("intensity"),G=[P.x,P.y,P.z],H=r.bA(B,V),q=r.bA(k,N);return{u_lighting_ambient_color:H,u_lighting_directional_dir:G,u_lighting_directional_color:q,u_ground_radiance:as(G,q,H)}})(g,v,this.style);h.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,h,g,v,x){if(this.uploadCommonLightUniforms(s,h),this.terrain&&this.terrain.renderingToTexture)return;let E=this.style.fog;if(E){let C=E.getOpacity(this.transform.pitch),M=((P,k,N,B,V,G,H,q,W,ee,te,ne)=>{let ue=P.transform,ce=k.properties.get("color").toRenderColor(P.style.getLut(k.scope)).toArray01();ce[3]=B;let J=P.frameCounter/1e3%1,[re,ie]=k.properties.get("vertical-range");return{u_fog_matrix:N?ue.calculateFogTileMatrix(N):ne||P.identityMat,u_fog_range:k.getFovAdjustedRange(ue._fov),u_fog_color:ce,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(re,ie),ie],u_fog_temporal_offset:J,u_frustum_tl:V,u_frustum_tr:G,u_frustum_br:H,u_frustum_bl:q,u_globe_pos:W,u_globe_radius:ee,u_viewport:te,u_globe_transition:r.a1(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,E,g,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.e.devicePixelRatio,this.transform.height*r.e.devicePixelRatio],v);h.setFogUniformValues(s,M)}x&&h.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){let s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){let s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)h[v.key]=s[v.key]||new r.by(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,h){return!(!s.is3D()||s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||s.sourceLayer!=="building")&&s.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[s.key];return h||(this._cachedTileFogOpacities[s.key]=h=this.style.fog.getOpacityForTile(s)),h[0]>=nr||h[1]>=nr}}class xi{constructor(s,h,g,v){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let g,v;if(s instanceof r.P||typeof s[0]=="number"){let x=r.P.convert(s);g=[x],v=h.isPointAboveHorizon(x)}else{let x=r.P.convert(s[0]),E=r.P.convert(s[1]);g=[x,E],v=r.cv(x,E).every(C=>h.isPointAboveHorizon(C))}return new xi(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return r.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),r.cw(v,s)}bufferedCameraGeometryGlobe(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(h,g,s),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>g.y))+((x.x>h.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(s,h,g,v=0){let x=s.queryPadding/h._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),C=s.tileID.wrap+(E.unwrapped?v:0),M=E.polygon.map(q=>r.cx(s.tileTransform,q,C));if(!r.cy(M,0,0,r.a3,r.a3))return;C=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let P=this.screenGeometryMercator.polygon.map(q=>r.cz(s.tileTransform,q,C)),k=P.map(q=>new r.P(q[0],q[1])),N=h.getFreeCameraOptions().position||new r.Y(0,0,0),B=r.cz(s.tileTransform,N,C),V=P.map(q=>{let W=r._.sub(q,q,B);return r._.normalize(W,W),new r.aT(B,W)}),G=r.bB(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:V,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(H=r.cA(M),H.min.x=r.at(H.min.x,0,r.a3),H.min.y=r.at(H.min.y,0,r.a3),H.max.x=r.at(H.max.x,0,r.a3),H.max.y=r.at(H.max.y,0,r.a3),H),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:G};var H}_bufferedScreenMercator(s,h){let g=Up(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,h){let g=Up(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,h){let g=function(x,E){let C=r.ad.multiply([],E.pixelMatrix,E.globeMatrix),M=[0,-r.cD,0,1],P=[0,r.cD,0,1],k=[0,0,0,1];r.aA.transformMat4(M,M,C),r.aA.transformMat4(P,P,C),r.aA.transformMat4(k,k,C);let N=new r.P(M[0]/M[3],M[1]/M[3]),B=new r.P(P[0]/P[3],P[1]/P[3]),V=r.cB(x,N)&&M[3]<k[3],G=r.cB(x,B)&&P[3]<k[3];if(!V&&!G)return null;let H=function(J,re,ie){for(let ge=1;ge<J.length;ge++){let Ce=js(re.pointCoordinate3D(J[ge-1]).x),ae=js(re.pointCoordinate3D(J[ge]).x);if(ie<0){if(Ce<ae)return{idx:ge,t:-Ce/(ae-1-Ce)}}else if(ae<Ce)return{idx:ge,t:(1-Ce)/(ae+1-Ce)}}return null}(x,E,V?-1:1);if(!H)return null;let{idx:q,t:W}=H,ee=q>1?jp(x.slice(0,q),E):[],te=q<x.length?jp(x.slice(q),E):[];ee=ee.map(J=>new r.P(js(J.x),J.y)),te=te.map(J=>new r.P(js(J.x),J.y));let ne=[...ee];ne.length===0&&ne.push(te[te.length-1]);let ue=r.a2(ne[ne.length-1].y,(te.length===0?ee[0]:te[0]).y,W),ce;return ce=V?[new r.P(0,ue),new r.P(0,0),new r.P(1,0),new r.P(1,ue)]:[new r.P(1,ue),new r.P(1,1),new r.P(0,1),new r.P(0,ue)],ne.push(...ce),te.length===0?ne.push(ee[0]):ne.push(...te),{polygon:ne.map(J=>new r.Y(J.x,J.y)),unwrapped:!1}}(s,h);if(g)return g;let v=function(x,E){let C=!1,M=-1/0,P=0;for(let N=0;N<x.length-1;N++)x[N].x>M&&(M=x[N].x,P=N);for(let N=0;N<x.length-1;N++){let B=(P+N)%(x.length-1),V=x[B],G=x[B+1];Math.abs(V.x-G.x)>.5&&(V.x<G.x?(V.x+=1,B===0&&(x[x.length-1].x+=1)):(G.x+=1,B+1===x.length-1&&(x[0].x+=1)),C=!0)}let k=r.aj(E.center.lng);return C&&k<Math.abs(k-1)&&x.forEach(N=>{N.x-=1}),{polygon:x,unwrapped:C}}(jp(s,h).map(x=>new r.P(js(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new r.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function jp(p,s){return r.cC(p,h=>{let g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function js(p){return p<0?1+p%1:p%1}function Up(p){return 100*p|0}function b1(p,s){let h=r.ad.identity([]);return r.ad.scale(h,h,[.5*p.width,.5*-p.height,1]),r.ad.translate(h,h,[1,-1,0]),r.ad.multiply(h,h,p.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function w1(p,s,h,g,v,x,E,C=!1){let M=p.tilesIn(g,E,C);M.sort($l);let P=[];for(let N of M)P.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,h,p._state,N,v,x,b1(p.transform,N.tile.tileID),C)});let k=function(N){let B={},V={};for(let G of N){let H=G.queryResults,q=G.wrappedTileID,W=V[q]=V[q]||{};for(let ee in H){let te=H[ee],ne=W[ee]=W[ee]||{},ue=B[ee]=B[ee]||[];for(let ce of te)ne[ce.featureIndex]||(ne[ce.featureIndex]=!0,ue.push(ce))}}return B}(P);for(let N in k)k[N].forEach(B=>{let V=B.feature,G=V.layer;G&&G.type!=="background"&&G.type!=="sky"&&G.type!=="slot"&&(V.source=G.source,G["source-layer"]&&(V.sourceLayer=G["source-layer"]),V.state=V.id!==void 0?p.getFeatureState(G["source-layer"],V.id):{})});return k}function xu(p,s){let h=p.getRenderableIds().map(x=>p.getTileByID(x)),g=[],v={};for(let x=0;x<h.length;x++){let E=h[x],C=E.tileID.canonical.key;v[C]||(v[C]=!0,E.querySourceFeatures(g,s))}return g}function $l(p,s){let h=p.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class E1{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let s=!1,h=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:s,visibilityChanged:h});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:s,visibilityChanged:h})}}}onNewFrame(s){this.layersGotHidden=!1;for(let h of this.layers){let g=h.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(s)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(s,h){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,E=this.style.getLayerSourceCache(x),C=1;x.type==="fill-extrusion"&&(C=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let M=E?E.getTile(h):null;if(!M&&E&&h.canonical.z>E.getSource().minzoom){let P=h.scaledTo(Math.min(E.getSource().maxzoom,h.overscaledZ-1));for(;P.overscaledZ>=E.getSource().minzoom&&(M=E.getTile(P),!M&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(x):null,tileID:M?M.tileID:h,verticalScale:C})}s.hasAnyZOffset=!1;let g=!1;for(let v=0;v<s.symbolInstances.length;v++){let x=s.symbolInstances.get(v),E=x.zOffset,C=this._getHeightAtTileOffset(h,x.tileAnchorX,x.tileAnchorY);x.zOffset=C!==Number.NEGATIVE_INFINITY?C:E,g||E===x.zOffset||(g=!0),s.hasAnyZOffset||x.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,h,g,v){let x=h,E=g;if(s.canonical.z!==v.canonical.z){let C=v.canonical,M=1/(1<<s.canonical.z-C.z);x=(h+s.canonical.x*r.a3)*M-C.x*r.a3|0,E=(g+s.canonical.y*r.a3)*M-C.y*r.a3|0}return{tileX:x,tileY:E}}_getHeightAtTileOffset(s,h,g){let v,x;for(let E=0;E<this.layers.length;++E){if(this.layers[E].layer.type!=="fill-extrusion")continue;let{bucket:C,tileID:M,verticalScale:P}=this.currentBuildingBuckets[E];if(!C)continue;let{tileX:k,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,M),B=C.getHeightAtTileCoord(k,N);B&&B.height!==void 0&&(B.hidden?v=B.height:x=Math.max(B.height*P,x||0))}if(x!==void 0)return x;for(let E=0;E<this.layers.length;++E){let C=this.layers[E];if(C.layer.type!=="model"||!C.visible)continue;let{bucket:M,tileID:P}=this.currentBuildingBuckets[E];if(!M)continue;let{tileX:k,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,P),B=M.getHeightAtTileCoord(k,N);if(B&&!B.hidden)return B.height===void 0&&v!==void 0?Math.min(B.maxHeight,v)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Gl(p,s){let h={};for(let g in p)g!=="ref"&&(h[g]=p[g]);return r.cE.forEach(g=>{g in s&&(h[g]=s[g])}),h}function $p(p){p=p.slice();let s=Object.create(null);for(let h=0;h<p.length;h++)s[p[h].id]=p[h];for(let h=0;h<p.length;h++)"ref"in p[h]&&(p[h]=Gl(p[h],s[p[h].ref]));return p}let pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function cs(p,s,h){h.push({command:pn.addSource,args:[p,s[p]]})}function H_(p,s,h){s.push({command:pn.removeSource,args:[p]}),h[p]=!0}function T1(p,s,h,g){H_(p,h,g),cs(p,s,h)}function C1(p,s,h){let g;for(g in p[h])if(p[h].hasOwnProperty(g)&&g!=="data"&&!w(p[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&g!=="data"&&!w(p[h][g],s[h][g]))return!1;return!0}function bu(p,s,h,g,v,x){let E;for(E in s=s||{},p=p||{})p.hasOwnProperty(E)&&(w(p[E],s[E])||h.push({command:x,args:[g,E,s[E],v]}));for(E in s)s.hasOwnProperty(E)&&!p.hasOwnProperty(E)&&(w(p[E],s[E])||h.push({command:x,args:[g,E,s[E],v]}))}function cd(p){return p.id}function Hl(p,s){return p[s.id]=s,p}class q_{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=r.at(s,0,1);let h=1,g=this._distances[h],v=s*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];let x=h-1,E=this._distances[x],C=g-E,M=C>0?(v-E)/C:0;return this.points[x].mult(1-M).add(this.points[h].mult(M))}}class Gp{constructor(s,h,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,v,x){this._forEachCell(h,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(s,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,h,g,v,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,h,g,v,x,E){this.circleCells[x].push(E)}_query(s,h,g,v,x,E){if(g<0||s>this.width||v<0||h>this.height)return!x&&[];let C=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){let P=this.circles[3*M],k=this.circles[3*M+1],N=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:P-N,y1:k-N,x2:P+N,y2:k+N})}return E?C.filter(E):C}return this._forEachCell(s,h,g,v,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?C.length>0:C}_queryCircle(s,h,g,v,x){let E=s-g,C=s+g,M=h-g,P=h+g;if(C<0||E>this.width||P<0||M>this.height)return!v&&[];let k=[];return this._forEachCell(E,M,C,P,this._queryCellCircle,k,{hitTest:v,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},x),v?k.length>0:k}query(s,h,g,v,x){return this._query(s,h,g,v,!1,x)}hitTest(s,h,g,v,x){return this._query(s,h,g,v,!0,x)}hitTestCircle(s,h,g,v){return this._queryCircle(s,h,g,!0,v)}_queryCell(s,h,g,v,x,E,C,M){let P=C.seenUids,k=this.boxCells[x];if(k!==null){let B=this.bboxes;for(let V of k)if(!P.box[V]){P.box[V]=!0;let G=4*V;if(s<=B[G+2]&&h<=B[G+3]&&g>=B[G+0]&&v>=B[G+1]&&(!M||M(this.boxKeys[V]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[V],x1:B[G],y1:B[G+1],x2:B[G+2],y2:B[G+3]})}}}let N=this.circleCells[x];if(N!==null){let B=this.circles;for(let V of N)if(!P.circle[V]){P.circle[V]=!0;let G=3*V;if(this._circleAndRectCollide(B[G],B[G+1],B[G+2],s,h,g,v)&&(!M||M(this.circleKeys[V]))){if(C.hitTest)return E.push(!0),!0;{let H=B[G],q=B[G+1],W=B[G+2];E.push({key:this.circleKeys[V],x1:H-W,y1:q-W,x2:H+W,y2:q+W})}}}}}_queryCellCircle(s,h,g,v,x,E,C,M){let P=C.circle,k=C.seenUids,N=this.boxCells[x];if(N!==null){let V=this.bboxes;for(let G of N)if(!k.box[G]){k.box[G]=!0;let H=4*G;if(this._circleAndRectCollide(P.x,P.y,P.radius,V[H+0],V[H+1],V[H+2],V[H+3])&&(!M||M(this.boxKeys[G])))return E.push(!0),!0}}let B=this.circleCells[x];if(B!==null){let V=this.circles;for(let G of B)if(!k.circle[G]){k.circle[G]=!0;let H=3*G;if(this._circlesCollide(V[H],V[H+1],V[H+2],P.x,P.y,P.radius)&&(!M||M(this.circleKeys[G])))return E.push(!0),!0}}}_forEachCell(s,h,g,v,x,E,C,M){let P=this._convertToXCellCoord(s),k=this._convertToYCellCoord(h),N=this._convertToXCellCoord(g),B=this._convertToYCellCoord(v);for(let V=P;V<=N;V++)for(let G=k;G<=B;G++)if(x.call(this,s,h,g,v,this.xCellCount*G+V,E,C,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,v,x,E){let C=v-s,M=x-h,P=g+E;return P*P>C*C+M*M}_circleAndRectCollide(s,h,g,v,x,E,C){let M=(E-v)/2,P=Math.abs(s-(v+M));if(P>M+g)return!1;let k=(C-x)/2,N=Math.abs(h-(x+k));if(N>k+g)return!1;if(P<=M||N<=k)return!0;let B=P-M,V=N-k;return B*B+V*V<=g*g}}let Eo=100;class W_{constructor(s,h,g=new Gp(s.width+200,s.height+200,25),v=new Gp(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Eo,this.screenBottomBoundary=s.height+Eo,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,v,x,E,C,M){let P=g.projectedAnchorX,k=g.projectedAnchorY,N=g.projectedAnchorZ,B=g.elevation,V=g.tileID,G=s.getProjection();if(B&&V){let[ce,J,re]=G.upVector(V.canonical,g.tileAnchorX,g.tileAnchorY),ie=G.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ce*B*ie,k+=J*B*ie,N+=re*B*ie}let H=this.projectAndGetPerspectiveRatio(C,P,k,N,g.tileID,G.name==="globe"||!!B||this.transform.pitch>0,G),q=E*H.perspectiveRatio,W=(g.x1*h+v.x-g.padding)*q+H.point.x,ee=(g.y1*h+v.y-g.padding)*q+H.point.y,te=(g.x2*h+v.x+g.padding)*q+H.point.x,ne=(g.y2*h+v.y+g.padding)*q+H.point.y,ue=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(W,ee,te,ne)||!x&&this.grid.hitTest(W,ee,te,ne,M)||ue?{box:[],offscreen:!1,occluded:H.occluded}:{box:[W,ee,te,ne],offscreen:this.isOffscreen(W,ee,te,ne),occluded:!1}}placeCollisionCircles(s,h,g,v,x,E,C,M,P,k,N,B,V,G,H){let q=[],W=this.transform.elevation,ee=s.getProjection(),te=W?W.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,ee):null,ne=new r.P(g.tileAnchorX,g.tileAnchorY),{x:ue,y:ce,z:J}=ee.projectTilePoint(ne.x,ne.y,H.canonical);if(te){let[Ve,xe,Re]=te(ne);ue+=Ve,ce+=xe,J+=Re}let re=ee.name==="globe",ie=this.projectAndGetPerspectiveRatio(C,ue,ce,J,H,re||!!W||this.transform.pitch>0,ee),{perspectiveRatio:ge}=ie,Ce=(N?E/ge:E*ge)/r.bN,ae=ro(ue,ce,J,M),Se=ie.signedDistanceFromCamera>0?Hh(Ce,x,g.lineOffsetX*Ce,g.lineOffsetY*Ce,!1,ae,ne,g,v,M,{},W&&!N?te:null,N&&!!W,ee,H,N):null,Me=!1,$e=!1,Ge=!0;if(Se&&!ie.occluded){let Ve=.5*V*ge+G,xe=new r.P(-100,-100),Re=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Fe=new q_,{first:ot,last:ct}=Se,at=ot.path.length,je=[];for(let pt=at-1;pt>=1;pt--)je.push(ot.path[pt]);for(let pt=1;pt<ct.path.length;pt++)je.push(ct.path[pt]);let He=2.5*Ve;P&&(je=je.map(([pt,Ot,$t],cn)=>(te&&!re&&($t=te(cn<at-1?ot.tilePath[at-1-cn]:ct.tilePath[cn-at+2])[2]),ro(pt,Ot,$t,P))),je.some(pt=>pt[3]<=0)&&(je=[]));let st=[];if(je.length>0){let pt=1/0,Ot=-1/0,$t=1/0,cn=-1/0;for(let on of je)pt=Math.min(pt,on[0]),$t=Math.min($t,on[1]),Ot=Math.max(Ot,on[0]),cn=Math.max(cn,on[1]);Ot>=xe.x&&pt<=Re.x&&cn>=xe.y&&$t<=Re.y&&(st=[je.map(on=>new r.P(on[0],on[1]))],(pt<xe.x||Ot>Re.x||$t<xe.y||cn>Re.y)&&(st=r.cF(st,xe.x,xe.y,Re.x,Re.y)))}for(let pt of st){Fe.reset(pt,.25*Ve);let Ot=0;Ot=Fe.length<=.5*Ve?1:Math.ceil(Fe.paddedLength/He)+1;for(let $t=0;$t<Ot;$t++){let cn=$t/Math.max(Ot-1,1),on=Fe.lerp(cn),An=on.x+Eo,Bt=on.y+Eo;q.push(An,Bt,Ve,0);let Sn=An-Ve,Gn=Bt-Ve,Rn=An+Ve,tn=Bt+Ve;if(Ge=Ge&&this.isOffscreen(Sn,Gn,Rn,tn),$e=$e||this.isInsideGrid(Sn,Gn,Rn,tn),!h&&this.grid.hitTestCircle(An,Bt,Ve,B)&&(Me=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Me,occluded:!1}}}}return{circles:!k&&Me||!$e?[]:q,offscreen:Ge,collisionDetected:Me,occluded:ie.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],g=1/0,v=1/0,x=-1/0,E=-1/0;for(let k of s){let N=new r.P(k.x+Eo,k.y+Eo);g=Math.min(g,N.x),v=Math.min(v,N.y),x=Math.max(x,N.x),E=Math.max(E,N.y),h.push(N)}let C=this.grid.query(g,v,x,E).concat(this.ignoredGrid.query(g,v,x,E)),M={},P={};for(let k of C){let N=k.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;let B=[new r.P(k.x1,k.y1),new r.P(k.x2,k.y1),new r.P(k.x2,k.y2),new r.P(k.x1,k.y2)];r.cG(h,B)&&(M[N.bucketInstanceId][N.featureIndex]=!0,P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]=[]),P[N.bucketInstanceId].push(N.featureIndex))}return P}insertCollisionBox(s,h,g,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,v,x){let E=h?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let M=0;M<s.length;M+=4)E.insertCircle(C,s[M],s[M+1],s[M+2])}projectAndGetPerspectiveRatio(s,h,g,v,x,E,C){let M=[h,g,v,1],P=!1;v||this.transform.pitch>0?(r.aA.transformMat4(M,M,s),this.fogState&&x&&C.name!=="globe"&&(P=function(B,V,G,H,q,W){let ee=W.calculateFogTileMatrix(q),te=[V,G,H];return r._.transformMat4(te,te,ee),Ar(B,r._.length(te),W.pitch,W._fov)}(this.fogState,h,g,v,x.toUnwrapped(),this.transform)>.9)):Vo(M,M,s);let k=M[3];return{point:new r.P((M[0]/k+1)/2*this.transform.width+Eo,(-M[1]/k+1)/2*this.transform.height+Eo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/k*.5,1.5),signedDistanceFromCamera:k,occluded:E&&M[2]>k||P}}isOffscreen(s,h,g,v){return g<Eo||s>=this.screenRightBoundary||v<Eo||h>this.screenBottomBoundary}isInsideGrid(s,h,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let s=r.ad.identity([]);return r.ad.translate(s,s,[-100,-100,0]),s}}class Us{constructor(s,h,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class $s{constructor(s,h,g,v,x,E=!1){this.text=new Us(s?s.text:null,h,g,x),this.icon=new Us(s?s.icon:null,h,v,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ud{constructor(s,h,g,v=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=v}}class Z_{constructor(){this.invProjMatrix=r.ad.create(),this.viewportMatrix=r.ad.create(),this.circles=[]}}class wu{constructor(s,h,g,v,x){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class Eu{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){let h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function Hp(p,s,h,g,v){let{horizontalAlign:x,verticalAlign:E}=r.bQ(p),C=-(x-.5)*s,M=-(E-.5)*h,P=r.bP(p,g);return new r.P(C+P[0]*v,M+P[1]*v)}function Tu(p,s,h,g,v){let x=new r.P(p,s);return h&&x._rotate(g?v:-v),x}class oo{constructor(s,h,g,v,x,E){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new W_(this.transform,x),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Eu(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,g,v){let x=g.getBucket(h),E=g.latestFeatureIndex;if(!x||!E||h.fqid!==x.layerIds[0])return;let C=x.layers[0].layout,M=g.collisionBoxArray,P=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),k=g.tileSize/r.a3,N=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let B=(V=g.tileID,G=x.getProjection(),H=this.transform,G.name===this.projection?H.calculateProjMatrix(V.toUnwrapped()):id(H,G,V));var V,G,H;let q=C.get("text-pitch-alignment")==="map",W=C.get("text-rotation-alignment")==="map";h.compileFilter();let ee=h.dynamicFilter(),te=h.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(g),ue=Aa(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne),ce=null;if(q){let ie=Ml(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne);ce=r.ad.multiply([],this.transform.labelPlaneMatrix,ie)}let J=null;ee&&g.latestFeatureIndex&&(J={unwrappedTileID:N,dynamicFilter:ee,dynamicFilterNeedsFeature:te,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new wu(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,g.tileID);let re={bucket:x,layout:C,posMatrix:B,textLabelPlaneMatrix:ue,labelToScreenMatrix:ce,clippingData:J,scale:P,textPixelRatio:k,holdingForFade:g.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:r.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let ie of x.sortKeyRanges){let{sortKey:ge,symbolInstanceStart:Ce,symbolInstanceEnd:ae}=ie;s.push({sortKey:ge,symbolInstanceStart:Ce,symbolInstanceEnd:ae,parameters:re})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:re})}attemptAnchorPlacement(s,h,g,v,x,E,C,M,P,k,N,B,V,G,H,q,W,ee){let{textOffset0:te,textOffset1:ne,crossTileID:ue}=B,ce=[te,ne],J=Hp(s,g,v,ce,x),re=this.collisionIndex.placeCollisionBox(G,x,h,Tu(J.x,J.y,E,C,this.transform.angle),N,M,P,k.predicate);if(q){let ie=G.getSymbolInstanceIconSize(ee,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,ie,q,Tu(J.x,J.y,E,C,this.transform.angle),N,M,P,k.predicate).box.length===0)return}if(re.box.length>0){let ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(ie=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:ce,width:g,height:v,anchor:s,textScale:x,prevAnchor:ie},this.markUsedJustification(G,s,B,H),G.allowVerticalPlacement&&(this.markUsedOrientation(G,H,B),this.placedOrientations[ue]=H),{shift:J,placedGlyphBoxes:re}}}placeLayerBucketPart(s,h,g,v){let{bucket:x,layout:E,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:P,clippingData:k,textPixelRatio:N,holdingForFade:B,collisionBoxArray:V,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:H,collisionGroup:q}=s.parameters,W=E.get("text-optional"),ee=E.get("icon-optional"),te=E.get("text-allow-overlap"),ne=E.get("icon-allow-overlap"),ue=E.get("text-rotation-alignment")==="map",ce=E.get("text-pitch-alignment")==="map",J=E.get("symbol-z-order")==="viewport-y",re=E.get("symbol-z-elevate");this.transform.setProjection(x.projection);let ie=te&&(ne||!x.hasIconData()||ee),ge=ne&&(te||!x.hasTextData()||W);!x.collisionArrays&&V&&x.deserializeCollisionBoxes(V),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,V);let Ce=(ae,Se,Me)=>{let{crossTileID:$e,numVerticalGlyphVertices:Ge}=ae;if(k){let Rn={zoom:this.transform.zoom,pitch:this.transform.pitch},tn=null;if(k.dynamicFilterNeedsFeature){let Vt=this.retainedQueryData[x.bucketInstanceId];tn=k.featureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:Vt.bucketIndex,sourceLayerIndex:Vt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(Rn,tn,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(ae.tileAnchorX,ae.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[$e]=new ud(!1,!1,!1,!0),void h.add($e)}if(h.has($e))return;if(B)return void(this.placements[$e]=new ud(!1,!1,!1));let Ve=!1,xe=!1,Re=!0,Fe=!1,ot=!1,ct=null,at={box:null,offscreen:null,occluded:null},je={box:null,offscreen:null,occluded:null},He=null,st=null,pt=null,Ot=0,$t=0,cn=0;Me.textFeatureIndex?Ot=Me.textFeatureIndex:ae.useRuntimeCollisionCircles&&(Ot=ae.featureIndex),Me.verticalTextFeatureIndex&&($t=Me.verticalTextFeatureIndex);let on=Rn=>{Rn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let tn=this.transform.elevation;Rn.elevation=ae.zOffset+(tn?tn.getAtTileOffset(Rn.tileID,Rn.tileAnchorX,Rn.tileAnchorY):0)},An=Me.textBox;if(An){on(An);let Rn=Vt=>{let Xn=r.aE.horizontal;if(x.allowVerticalPlacement&&!Vt&&this.prevPlacement){let Jn=this.prevPlacement.placedOrientations[$e];Jn&&(this.placedOrientations[$e]=Jn,Xn=Jn,this.markUsedOrientation(x,Xn,ae))}return Xn},tn=(Vt,Xn)=>{if(x.allowVerticalPlacement&&Ge>0&&Me.verticalTextBox){for(let Jn of x.writingModes)if(Jn===r.aE.vertical?(at=Xn(),je=at):at=Vt(),at&&at.box&&at.box.length)break}else at=Vt()};if(E.get("text-variable-anchor")){let Vt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e]){let un=this.prevPlacement.variableOffsets[$e];Vt.indexOf(un.anchor)>0&&(Vt=Vt.filter(Be=>Be!==un.anchor),Vt.unshift(un.anchor))}let Xn=(un,Be,ut)=>{let Lr=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Se),Pn=(un.x2-un.x1)*Lr+2*un.padding,Te=(un.y2-un.y1)*Lr+2*un.padding,Mi=ae.hasIconTextFit&&!ne?Be:null;Mi&&on(Mi);let ui={box:[],offscreen:!1,occluded:!1},Br=te?2*Vt.length:Vt.length;for(let bi=0;bi<Br;++bi){let Ni=this.attemptAnchorPlacement(Vt[bi%Vt.length],un,Pn,Te,Lr,ue,ce,N,C,q,bi>=Vt.length,ae,Se,x,ut,Mi,G,H);if(Ni&&(ui=Ni.placedGlyphBoxes,ui&&ui.box&&ui.box.length)){Ve=!0,ct=Ni.shift;break}}return ui};tn(()=>Xn(An,Me.iconBox,r.aE.horizontal),()=>{let un=Me.verticalTextBox;return un&&on(un),x.allowVerticalPlacement&&!(at&&at.box&&at.box.length)&&Ge>0&&un?Xn(un,Me.verticalIconBox,r.aE.vertical):{box:null,offscreen:null,occluded:null}}),at&&(Ve=at.box,Re=at.offscreen,Fe=at.occluded);let Jn=Rn(!(!at||!at.box));if(!Ve&&this.prevPlacement){let un=this.prevPlacement.variableOffsets[$e];un&&(this.variableOffsets[$e]=un,this.markUsedJustification(x,un.anchor,ae,Jn))}}else{let Vt=(Xn,Jn)=>{let un=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Se),Be=this.collisionIndex.placeCollisionBox(x,un,Xn,new r.P(0,0),te,N,C,q.predicate);return Be&&Be.box&&Be.box.length&&(this.markUsedOrientation(x,Jn,ae),this.placedOrientations[$e]=Jn),Be};tn(()=>Vt(An,r.aE.horizontal),()=>{let Xn=Me.verticalTextBox;return x.allowVerticalPlacement&&Ge>0&&Xn?(on(Xn),Vt(Xn,r.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Rn(!!(at&&at.box&&at.box.length))}}if(He=at,Ve=He&&He.box&&He.box.length>0,Re=He&&He.offscreen,Fe=He&&He.occluded,ae.useRuntimeCollisionCircles){let Rn=x.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex>=0?ae.centerJustifiedTextSymbolIndex:ae.verticalPlacedTextSymbolIndex),tn=r.aF(x.textSizeData,G,Rn),Vt=E.get("text-padding");st=this.collisionIndex.placeCollisionCircles(x,te,Rn,x.lineVertexArray,x.glyphOffsetArray,tn,C,M,P,g,ce,q.predicate,ae.collisionCircleDiameter*tn/r.bN,Vt,this.retainedQueryData[x.bucketInstanceId].tileID),Ve=te||st.circles.length>0&&!st.collisionDetected,Re=Re&&st.offscreen,Fe=st.occluded}if(Me.iconFeatureIndex&&(cn=Me.iconFeatureIndex),Me.iconBox){let Rn=tn=>{on(tn);let Vt=ae.hasIconTextFit&&ct?Tu(ct.x,ct.y,ue,ce,this.transform.angle):new r.P(0,0),Xn=x.getSymbolInstanceIconSize(H,this.transform.zoom,ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Xn,tn,Vt,ne,N,C,q.predicate)};je&&je.box&&je.box.length&&Me.verticalIconBox?(pt=Rn(Me.verticalIconBox),xe=pt.box.length>0):(pt=Rn(Me.iconBox),xe=pt.box.length>0),Re=Re&&pt.offscreen,ot=pt.occluded}let Bt=W||ae.numHorizontalGlyphVertices===0&&Ge===0,Sn=ee||ae.numIconVertices===0;if(Bt||Sn?Sn?Bt||(xe=xe&&Ve):Ve=xe&&Ve:xe=Ve=xe&&Ve,Ve&&He&&He.box&&this.collisionIndex.insertCollisionBox(He.box,E.get("text-ignore-placement"),x.bucketInstanceId,je&&je.box&&$t?$t:Ot,q.ID),xe&&pt&&this.collisionIndex.insertCollisionBox(pt.box,E.get("icon-ignore-placement"),x.bucketInstanceId,cn,q.ID),st&&(Ve&&this.collisionIndex.insertCollisionCircles(st.circles,E.get("text-ignore-placement"),x.bucketInstanceId,Ot,q.ID),g)){let Rn=x.bucketInstanceId,tn=this.collisionCircleArrays[Rn];tn===void 0&&(tn=this.collisionCircleArrays[Rn]=new Z_);for(let Vt=0;Vt<st.circles.length;Vt+=4)tn.circles.push(st.circles[Vt+0]),tn.circles.push(st.circles[Vt+1]),tn.circles.push(st.circles[Vt+2]),tn.circles.push(st.collisionDetected?1:0)}let Gn=x.projection.name!=="globe";ie=ie&&(Gn||!Fe),ge=ge&&(Gn||!ot),this.placements[$e]=new ud(Ve||ie,xe||ge,Re||x.justReloaded),h.add($e)};if(re&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),J){let ae=x.getSortedSymbolIndexes(this.transform.angle);for(let Se=ae.length-1;Se>=0;--Se){let Me=ae[Se];Ce(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let ae=x.getSortedIndexesByZOffset();for(let Se=0;Se<ae.length;++Se){let Me=ae[Se];Ce(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}}else for(let ae=s.symbolInstanceStart;ae<s.symbolInstanceEnd;ae++)Ce(x.symbolInstances.get(ae),ae,x.collisionArrays[ae]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let ae=this.collisionCircleArrays[x.bucketInstanceId];r.ad.invert(ae.invProjMatrix,C),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,h,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:M,crossTileID:P}=g,k=r.cJ(h),N=v===r.aE.vertical?M:k==="left"?x:k==="center"?E:k==="right"?C:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=N>=0&&x!==N?0:P),E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=N>=0&&E!==N?0:P),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:P),M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:P)}markUsedOrientation(s,h,g){let v=h===r.aE.horizontal||h===r.aE.horizontalOnly?h:0,x=h===r.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P}=g,k=s.text.placedSymbolArray;E>=0&&(k.get(E).placedOrientation=v),C>=0&&(k.get(C).placedOrientation=v),M>=0&&(k.get(M).placedOrientation=v),P>=0&&(k.get(P).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(s):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(let M in this.placements){let P=this.placements[M],k=x[M];k?(this.opacities[M]=new $s(k,v,P.text,P.icon,null,P.clipped),g=g||P.text!==k.text.placed||P.icon!==k.icon.placed):(this.opacities[M]=new $s(null,v,P.text,P.icon,P.skipFade,P.clipped),g=g||P.text||P.icon)}for(let M in x){let P=x[M];if(!this.opacities[M]){let k=new $s(P,v,!1,!1);k.isHidden()||(this.opacities[M]=k,g=g||P.text.placed||P.icon.placed)}}for(let M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(let M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h,g,v){let x=new Set;for(let E of h){let C=E.getBucket(s);C&&E.latestFeatureIndex&&s.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,x,E.collisionBoxArray,g,v,E.tileID),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,E.tileID),C.updateZOffset()))}}updateBucketOpacities(s,h,g,v,x,E){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();let C=s.layers[0].layout,M=!!s.layers[0].dynamicFilter(),P=new $s(null,0,!1,!1,!0),k=C.get("text-allow-overlap"),N=C.get("icon-allow-overlap"),B=C.get("text-variable-anchor"),V=C.get("text-rotation-alignment")==="map",G=C.get("text-pitch-alignment")==="map",H=new $s(null,0,k&&(N||!s.hasIconData()||C.get("icon-optional")),N&&(k||!s.hasTextData()||C.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);let q=(ee,te,ne)=>{for(let ue=0;ue<te/4;ue++)ee.opacityVertexArray.emplaceBack(ne)},W=0;x&&s.updateReplacement(E,x);for(let ee=0;ee<s.symbolInstances.length;ee++){let te=s.symbolInstances.get(ee),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ue,crossTileID:ce,numIconVertices:J,tileAnchorX:re,tileAnchorY:ie}=te,ge=h.has(ce),Ce=this.opacities[ce];ge?Ce=P:Ce||(Ce=H,this.opacities[ce]=Ce),h.add(ce);let ae=ne>0||ue>0,Se=J>0,Me=this.placedOrientations[ce],$e=Me===r.aE.vertical,Ge=Me===r.aE.horizontal||Me===r.aE.horizontalOnly;!ae&&!Se||Ce.isHidden()||W++;let Ve=!1;if((ae||Se)&&x)for(let xe of s.activeReplacements){if(xe.order<v||xe.order===1/0||!(xe.clipMask&r.cu.Symbol)||xe.min.x>re||re>xe.max.x||xe.min.y>ie||ie>xe.max.y)continue;let Re=r.cH(re,ie,E.canonical,xe.footprintTileId.canonical);if(Ve=r.cI(Re,xe),Ve)break}if(ae){let xe=Ve?Gs:Go(Ce.text);q(s.text,ne,$e?Gs:xe),q(s.text,ue,Ge?Gs:xe);let Re=Ce.text.isHidden(),{leftJustifiedTextSymbolIndex:Fe,centerJustifiedTextSymbolIndex:ot,rightJustifiedTextSymbolIndex:ct,verticalPlacedTextSymbolIndex:at}=te,je=s.text.placedSymbolArray,He=Re||$e?1:0;Fe>=0&&(je.get(Fe).hidden=He),ot>=0&&(je.get(ot).hidden=He),ct>=0&&(je.get(ct).hidden=He),at>=0&&(je.get(at).hidden=Re||Ge?1:0);let st=this.variableOffsets[ce];st&&this.markUsedJustification(s,st.anchor,te,Me);let pt=this.placedOrientations[ce];pt&&(this.markUsedJustification(s,"left",te,pt),this.markUsedOrientation(s,pt,te))}if(Se){let xe=Ve?Gs:Go(Ce.icon),{placedIconSymbolIndex:Re,verticalPlacedIconSymbolIndex:Fe}=te,ot=s.icon.placedSymbolArray,ct=Ce.icon.isHidden()?1:0;Re>=0&&(q(s.icon,J,$e?Gs:xe),ot.get(Re).hidden=ct),Fe>=0&&(q(s.icon,te.numVerticalIconVertices,Ge?Gs:xe),ot.get(Fe).hidden=ct)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){let xe=s.collisionArrays[ee];if(xe){let Re=new r.P(0,0),Fe=!0;if(xe.textBox||xe.verticalTextBox){if(B){let ct=this.variableOffsets[ce];ct?(Re=Hp(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textScale),V&&Re._rotate(G?this.transform.angle:-this.transform.angle)):Fe=!1}M&&(Fe=!Ce.clipped),xe.textBox&&Cu(s.textCollisionBox.collisionVertexArray,Ce.text.placed,!Fe||$e,Re.x,Re.y),xe.verticalTextBox&&Cu(s.textCollisionBox.collisionVertexArray,Ce.text.placed,!Fe||Ge,Re.x,Re.y)}let ot=Fe&&!!(!Ge&&xe.verticalIconBox);xe.iconBox&&Cu(s.iconCollisionBox.collisionVertexArray,Ce.icon.placed,ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0),xe.verticalIconBox&&Cu(s.iconCollisionBox.collisionVertexArray,Ce.icon.placed,!ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0)}}}if(s.fullyClipped=W===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){let ee=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ee.invProjMatrix,s.placementViewportMatrix=ee.viewportMatrix,s.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){let g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Cu(p,s,h,g,v){p.emplaceBack(s?1:0,h?1:0,g||0,v||0),p.emplaceBack(s?1:0,h?1:0,g||0,v||0),p.emplaceBack(s?1:0,h?1:0,g||0,v||0),p.emplaceBack(s?1:0,h?1:0,g||0,v||0)}let qp=Math.pow(2,25),it=Math.pow(2,24),X_=Math.pow(2,17),Wp=Math.pow(2,16),Zp=Math.pow(2,9),Y_=Math.pow(2,8),hd=Math.pow(2,1);function Go(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;let s=p.placed?1:0,h=Math.floor(127*p.opacity);return h*qp+s*it+h*X_+s*Wp+h*Zp+s*Y_+h*hd+s}let Gs=0;class za{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,g,v,x){let E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<E.length;){let C=E[this._currentPartIndex];if(h.placeLayerBucketPart(C,this._seenCrossTileIDs,g,C.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class dd{constructor(s,h,g,v,x,E,C,M,P){this.placement=new oo(s,x,E,C,M,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g,v){let x=r.e.now(),E=()=>{let C=r.e.now()-x;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){let C=h[s[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){let P=C,k=P.layout.get("symbol-z-elevate"),N=this._inProgressLayer=this._inProgressLayer||new za(P),B=r.al(C.source,C.scope);if(N.continuePlacement(k?v[B]:g[B],this.placement,this._showCollisionBoxes,C,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}let Hs=512/r.a3/2;class S1{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this.index=new r.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=s.canonical.x*r.a3,x=s.canonical.y*r.a3;for(let E=0;E<h.length;E++){let{key:C,crossTileID:M,tileAnchorX:P,tileAnchorY:k}=h.get(E),N=Math.floor((v+P)*Hs),B=Math.floor((x+k)*Hs);this.index.add(N,B),this.keys.push(C),this.crossTileIDs.push(M)}this.index.finish()}findMatches(s,h,g){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=Hs/Math.pow(2,h.canonical.z-this.tileID.canonical.z),E=h.canonical.x*r.a3,C=h.canonical.y*r.a3;for(let M=0;M<s.length;M++){let P=s.get(M);if(P.crossTileID)continue;let{key:k,tileAnchorX:N,tileAnchorY:B}=P,V=Math.floor((E+N)*x),G=Math.floor((C+B)*x),H=this.index.range(V-v,G-v,V+v,G+v);for(let q of H){let W=this.crossTileIDs[q];if(this.keys[q]===k&&!g.has(W)){g.add(W),P.crossTileID=W;break}}}}}class I1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){let h=Math.round((s-this.lng)/360);if(h!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let E in v){let C=v[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),x[C.tileID.key]=C}this.indexes[g]=x}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);let v=this.usedCrossTileIDs[s.overscaledZ];for(let x in this.indexes){let E=this.indexes[x];if(Number(x)>s.overscaledZ)for(let C in E){let M=E[C];M.tileID.isChildOf(s)&&M.findMatches(h.symbolInstances,s,v)}else{let C=E[s.scaledTo(Number(x)).key];C&&C.findMatches(h.symbolInstances,s,v)}}for(let x=0;x<h.symbolInstances.length;x++){let E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=g.generate(),v.add(E.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new S1(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(let g of h.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let h=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)s[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],h=!0)}return h}}class D1{constructor(){this.layerIndexes={},this.crossTileIDs=new I1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,v){let x=this.layerIndexes[s.fqid];x===void 0&&(x=this.layerIndexes[s.fqid]=new Xp);let E=!1,C={};v.name!=="globe"&&x.handleWrapJump(g);for(let M of h){let P=M.getBucket(s);P&&s.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,P,this.crossTileIDs)&&(E=!0),C[P.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(s){let h={};s.forEach(g=>{h[g]=!0});for(let g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}let K_=new r.N({data:new r.O(r.L.colorTheme.data)}),qs=(p,s)=>jt(p,s&&s.filter(h=>h.identifier!=="source.canvas")),Yp=r.ah(pn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),M1=r.ah(pn,["setCenter","setZoom","setBearing","setPitch"]),Q_={version:8,layers:[],sources:{}},J_={duration:300,delay:0};class To extends r.E{constructor(s,h={}){super(),this.map=s,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=r.W({},J_),this._buildingIndex=new E1(this),this.crossTileSymbolIndex=new D1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Jt,this.dispatcher=h.dispatcher?h.dispatcher:new r.bw(r.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Xc,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new r.cM(s._requestManager,h.localFontFamily?r.cN.all:h.localIdeographFontFamily?r.cN.ideographs:r.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new zh(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",r.cO());let g=this;this._rtlTextPluginCallback=To.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,E)=>{if(r.cP(x),E&&E.every(C=>C))for(let C in g._sourceCaches){let M=g._sourceCaches[C],P=M.getSource().type;P!=="vector"&&P!=="geojson"||M.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let E in this._layers){let C=this._layers[E];C.source===x.id&&this._validateLayer(C)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(r.cQ(s))return s;let h=r.cR(s);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${r.cS(JSON.stringify(s))}`}_diffStyle(s,h,g){this.globalId=this._getGlobalId(s);let v=(x,E)=>{try{E(null,this.setState(x,g))}catch(C){E(C,!1)}};if(typeof s=="string"){let x=this.map._requestManager.normalizeStyleURL(s),E=this.map._requestManager.transformRequest(x,r.R.Style);r.g(E,(C,M)=>{C?this.fire(new r.d(C)):M&&v(M,h)})}else typeof s=="object"&&v(s,h)}loadURL(s,h={}){this.fire(new r.f("dataloading",{dataType:"style"}));let g=typeof h.validate=="boolean"?h.validate:!r.cQ(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,h.accessToken),this.resolvedImports.add(s);let v=this.importsCache.get(s);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(s,r.R.Style);this._request=r.g(x,(E,C)=>{if(this._request=null,E)this.fire(new r.d(E));else if(C)return this.importsCache.set(s,C),this._load(C,g)})}loadJSON(s,h={}){this.fire(new r.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=r.e.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new r.f("dataloading",{dataType:"style"})),this._load(Q_,!1)}_loadImports(s,h,g){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of s){let E=this._createFragmentStyle(x),C=new Promise(k=>{E.once("style.import.load",k),E.once("error",k)}).then(()=>this.mergeAll());if(v.push(C),this.resolvedImports.has(x.url)){E.loadEmpty();continue}let M=x.data||this.importsCache.get(x.url);M?(E.loadJSON(M,{validate:h}),this._isInternalStyle(M)&&(E.globalId=null)):x.url?E.loadURL(x.url,{validate:h}):E.loadEmpty();let P={style:E,id:x.id,config:x.config};if(g){let k=this.fragments.findIndex(({id:N})=>N===g);this.fragments=this.fragments.slice(0,k).concat(P).concat(this.fragments.slice(k))}else this.fragments.push(P)}return Promise.allSettled(v)}getImportGlobalIds(s=this,h=new Set){for(let g of s.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(s){let h=this.scope?r.al(s.id,this.scope):s.id,g,v=this._initialConfig&&this._initialConfig[h];(s.config||v)&&(g=r.W({},s.config,v));let x=new To(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,h){let g=s.schema;if(this._isInternalStyle(s)){let E=r.W({},Q_,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(E,h)}if(this.updateConfig(this._config,g),h&&qs(this,de(s)))return;this._loaded=!0,this.stylesheet=r.cT(s);let v=()=>{for(let P in s.sources)this.addSource(P,s.sources[P],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);let E=$p(this.stylesheet.layers);if(this._order=E.map(P=>P.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let P=this.stylesheet.lights[0];this.light=new mt(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new mt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let P of E){let k=r.cY(P,this.scope,this._styleColorTheme.lut,this.options);k.isConfigDependent&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize();let N=this.getOwnLayerSourceCache(k),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&k.canCastShadows()&&B&&(N.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.f("data",{dataType:"style"}));let M=this.isRootStyle();s.imports?this._loadImports(s.imports,h).then(()=>{this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let E=this._evaluateColorThemeData(x);this._loadColorTheme(E).then(()=>{v()}).catch(C=>{r.w(`Couldn't load color theme from the stylesheet: ${C}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,h,g,v,x,E,C,M,P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(k.light!=null&&(s=k.light),k.stylesheet.lights)for(let N of k.stylesheet.lights)N.type==="ambient"&&k.ambientLight!=null&&(h=k.ambientLight),N.type==="directional"&&k.directionalLight!=null&&(g=k.directionalLight);v=this._prioritizeTerrain(v,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&k.fog!=null&&(x=k.fog),k.stylesheet.camera!=null&&(M=k.stylesheet.camera),k.stylesheet.projection!=null&&(E=k.stylesheet.projection),k.stylesheet.transition!=null&&(C=k.stylesheet.transition),P[k.scope]=k._styleColorTheme}}),this.light=s,this.ambientLight=h,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=P,v===null?delete this.terrain:this.terrain=v,this.camera=M||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=r.W({},J_,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){let h=g=>{for(let v of g.fragments)h(v.style);s(g)};h(this)}_prioritizeTerrain(s,h,g){let v=s&&s.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?s:null:h!=null&&(!s||v||h&&h.drapeRenderMode===1)?h:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{s=this._prioritizeTerrain(s,h.terrain,h.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(s=h.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){let s={},h={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let E=r.al(x,v.scope);s[E]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let E=r.al(x,v.scope);h[E]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let E=r.al(x,v.scope);g[E]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){let s={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(let C of E._order){let M=E._layers[C];if(M.type==="slot"){let P=r.cU(C);if(s[P])continue;s[P]=[]}M.slot&&s[M.slot]?s[M.slot].push(M):h.push(M)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(E=[])=>{for(let C of E)if(C.type==="slot"){let M=r.cU(C.id);s[M]&&x(s[M]),this._mergedSlots.push(M)}else{let M=r.al(C.id,C.scope);this._mergedOrder.push(M),g[M]=C,C.is3D()&&(this._has3DLayers=!0),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=r.W({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(h,g,v){let x=r.W({},g);for(let C of Object.keys(r.L.colorTheme))x[C]===void 0&&(x[C]=r.L.colorTheme[C].default);let E=new r.U(K_,h,new Map(v));return E.setTransitionOrValue(x,v),E.untransitioned().possiblyEvaluate(new r.X(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){return this._styleColorTheme.lutLoading=!0,new Promise((h,g)=>{let v="data:image/png;base64,";if(s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();s.startsWith(v)||(s=v+s);let x="mapbox-reserved-lut",E=new Image;E.src=s,E.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},E.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:C,height:M,data:P}=r.e.getImageData(E);if(M>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(C!==M*M)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new r.i({width:C,height:M},P),pixelRatio:1,sdf:!1,version:0});let k=this.imageManager.getImage(x,this.scope);k?(this._styleColorTheme.lut={image:k.data,data:s},h()):g(new Error("Missing LUT image."))}})}getLut(s){let h=this._styleColorThemeForScope[s];return h?h.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(h,g,v){let x,E,C,M=r.e.devicePixelRatio>1?"@2x":"",P=r.g(g.transformRequest(g.normalizeSpriteURL(h,M,".json"),r.R.SpriteJSON),(B,V)=>{P=null,C||(C=B,x=V,N())}),k=r.h(g.transformRequest(g.normalizeSpriteURL(h,M,".png"),r.R.SpriteImage),(B,V)=>{k=null,C||(C=B,E=V,N())});function N(){if(C)v(C);else if(x&&E){let B=r.e.getImageData(E),V={};for(let G in x){let{width:H,height:q,x:W,y:ee,sdf:te,pixelRatio:ne,stretchX:ue,stretchY:ce,content:J}=x[G],re=new r.i({width:H,height:q});r.i.copy(B,re,{x:W,y:ee},{x:0,y:0},{width:H,height:q},null),V[G]={data:re,pixelRatio:ne,sdf:te,stretchX:ue,stretchY:ce,content:J}}v(null,V)}}return{cancel(){P&&(P.cancel(),P=null),k&&(k.cancel(),k=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new r.d(h));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.f("data",{dataType:"style"}))})}_validateLayer(s){let h=this.getOwnSource(s.source);if(!h)return;let g=s.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new r.d(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,h)=>{let g=this.fragments[h];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){let s={};for(let h in this._sourceCaches){let g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){let h=[];for(let g of s){let v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(let s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){let h=this.getOwnLayer(s);if(h)return h;this.fire(new r.d(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){let h=this.getOwnSource(s);if(h)return h;this.fire(new r.d(new Error(`The source '${s}' does not exist in the map's style.`)))}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);let h=this.calculateLightsBrightness();s.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let E=this._changes.getLayerUpdatesByScope();for(let C in E){let{updatedIds:M,removedIds:P}=E[C];(M||P)&&(this._updateWorkerLayers(C,M,P),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}let x={};for(let E in this._mergedSourceCaches){let C=this._mergedSourceCaches[E];x[E]=C.used,C.used=!1,C.tileCoverLift=0}for(let E of this._mergedOrder){let C=this._mergedLayers[E];if(C.recalculate(s,this._availableImages),!C.isHidden(s.zoom)){let M=this.getLayerSourceCache(C);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,C.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let M=C.minzoom||0;M<(C.maxzoom||25.5);M++){let P=this.map.painter;if(P){let k=C.getProgramIds();if(!k)continue;for(let N of k){let B=C.getDefaultProgramParams(N,s.zoom,this._styleColorTheme.lut);B&&(P.style=this,this.fog&&(P._fogVisible=!0,B.overrideFog=!0,P.getOrCreateProgram(N,B)),P._fogVisible=!1,B.overrideFog=!1,P.getOrCreateProgram(N,B),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(B.overrideRtt=!0,P.getOrCreateProgram(N,B)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let E in x){let C=this._mergedSourceCaches[E];x[E]!==C.used&&C.getSource().fire(new r.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new r.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let s=this._changes.getUpdatedImages();if(s.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,h,g){let v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:s,removedIds:g||[],options:v.options})}setState(s,h){if(this._checkLoaded(),qs(this,de(s)))return!1;(s=r.cT(s)).layers=$p(s.layers);let g=function(E,C){if(!E)return[{command:pn.setStyle,args:[C]}];let M=[];try{if(!w(E.version,C.version))return[{command:pn.setStyle,args:[C]}];if(w(E.center,C.center)||M.push({command:pn.setCenter,args:[C.center]}),w(E.zoom,C.zoom)||M.push({command:pn.setZoom,args:[C.zoom]}),w(E.bearing,C.bearing)||M.push({command:pn.setBearing,args:[C.bearing]}),w(E.pitch,C.pitch)||M.push({command:pn.setPitch,args:[C.pitch]}),w(E.sprite,C.sprite)||M.push({command:pn.setSprite,args:[C.sprite]}),w(E.glyphs,C.glyphs)||M.push({command:pn.setGlyphs,args:[C.glyphs]}),w(E.imports,C.imports)||function(V=[],G=[],H){G=G||[];let q=(V=V||[]).map(cd),W=G.map(cd),ee=V.reduce(Hl,{}),te=G.reduce(Hl,{}),ne=q.slice(),ue,ce,J,re;for(ue=0,ce=0;ue<q.length;ue++)J=q[ue],te.hasOwnProperty(J)?ce++:(H.push({command:pn.removeImport,args:[J]}),ne.splice(ne.indexOf(J,ce),1));for(ue=0,ce=0;ue<W.length;ue++)J=W[W.length-1-ue],ne[ne.length-1-ue]!==J&&(ee.hasOwnProperty(J)?(H.push({command:pn.removeImport,args:[J]}),ne.splice(ne.lastIndexOf(J,ne.length-ce),1)):ce++,re=ne[ne.length-ue],H.push({command:pn.addImport,args:[te[J],re]}),ne.splice(ne.length-ue,0,J));for(let ie of G){let ge=ee[ie.id];ge&&!w(ge,ie)&&H.push({command:pn.updateImport,args:[ie.id,ie]})}}(E.imports,C.imports,M),w(E.transition,C.transition)||M.push({command:pn.setTransition,args:[C.transition]}),w(E.light,C.light)||M.push({command:pn.setLight,args:[C.light]}),w(E.fog,C.fog)||M.push({command:pn.setFog,args:[C.fog]}),w(E.projection,C.projection)||M.push({command:pn.setProjection,args:[C.projection]}),w(E.lights,C.lights)||M.push({command:pn.setLights,args:[C.lights]}),w(E.camera,C.camera)||M.push({command:pn.setCamera,args:[C.camera]}),!w(E["color-theme"],C["color-theme"]))return[{command:pn.setStyle,args:[C]}];let P={},k=[];(function(V,G,H,q){let W;for(W in G=G||{},V=V||{})V.hasOwnProperty(W)&&(G.hasOwnProperty(W)||H_(W,H,q));for(W in G){if(!G.hasOwnProperty(W))continue;let ee=G[W];V.hasOwnProperty(W)?w(V[W],ee)||(V[W].type==="geojson"&&ee.type==="geojson"&&C1(V,G,W)?H.push({command:pn.setGeoJSONSourceData,args:[W,ee.data]}):T1(W,G,H,q)):cs(W,G,H)}})(E.sources,C.sources,k,P);let N=[];E.layers&&E.layers.forEach(V=>{V.source&&P[V.source]?M.push({command:pn.removeLayer,args:[V.id]}):N.push(V)});let B=E.terrain;B&&P[B.source]&&(M.push({command:pn.setTerrain,args:[void 0]}),B=void 0),M=M.concat(k),w(B,C.terrain)||M.push({command:pn.setTerrain,args:[C.terrain]}),function(V,G,H){G=G||[];let q=(V=V||[]).map(cd),W=G.map(cd),ee=V.reduce(Hl,{}),te=G.reduce(Hl,{}),ne=q.slice(),ue=Object.create(null),ce,J,re,ie,ge,Ce,ae;for(ce=0,J=0;ce<q.length;ce++)re=q[ce],te.hasOwnProperty(re)?J++:(H.push({command:pn.removeLayer,args:[re]}),ne.splice(ne.indexOf(re,J),1));for(ce=0,J=0;ce<W.length;ce++)re=W[W.length-1-ce],ne[ne.length-1-ce]!==re&&(ee.hasOwnProperty(re)?(H.push({command:pn.removeLayer,args:[re]}),ne.splice(ne.lastIndexOf(re,ne.length-J),1)):J++,Ce=ne[ne.length-ce],H.push({command:pn.addLayer,args:[te[re],Ce]}),ne.splice(ne.length-ce,0,re),ue[re]=!0);for(ce=0;ce<W.length;ce++)if(re=W[ce],ie=ee[re],ge=te[re],!ue[re]&&!w(ie,ge))if(w(ie.source,ge.source)&&w(ie["source-layer"],ge["source-layer"])&&w(ie.type,ge.type)){for(ae in bu(ie.layout,ge.layout,H,re,null,pn.setLayoutProperty),bu(ie.paint,ge.paint,H,re,null,pn.setPaintProperty),w(ie.slot,ge.slot)||H.push({command:pn.setSlot,args:[re,ge.slot]}),w(ie.filter,ge.filter)||H.push({command:pn.setFilter,args:[re,ge.filter]}),w(ie.minzoom,ge.minzoom)&&w(ie.maxzoom,ge.maxzoom)||H.push({command:pn.setLayerZoomRange,args:[re,ge.minzoom,ge.maxzoom]}),ie)ie.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?bu(ie[ae],ge[ae],H,re,ae.slice(6),pn.setPaintProperty):w(ie[ae],ge[ae])||H.push({command:pn.setLayerProperty,args:[re,ae,ge[ae]]}));for(ae in ge)ge.hasOwnProperty(ae)&&!ie.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?bu(ie[ae],ge[ae],H,re,ae.slice(6),pn.setPaintProperty):w(ie[ae],ge[ae])||H.push({command:pn.setLayerProperty,args:[re,ae,ge[ae]]}))}else H.push({command:pn.removeLayer,args:[re]}),Ce=ne[ne.lastIndexOf(re)+1],H.push({command:pn.addLayer,args:[ge,Ce]})}(N,C.layers,M)}catch(P){console.warn("Unable to compute style diff:",P),M=[{command:pn.setStyle,args:[C]}]}return M}(this.serialize(),s).filter(E=>!(E.command in M1));if(g.length===0)return!1;let v=g.filter(E=>!(E.command in Yp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);let x=[];return g.forEach(E=>{x.push(this[E.command].apply(this,E.args))}),h&&Promise.all(x).then(h),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,h){return this.getImage(s)?this.fire(new r.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,this.scope,h)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new r.d(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,h,g={}){return this._checkLoaded(),this._validate(Kt,`models.${s}`,h,null,g)||(this.modelManager.addModel(s,h,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new r.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,h,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(fe,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=Kh(s,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=E=>{let C=(E?"symbol:":"other:")+v.id,M=r.al(C,this.scope),P=this._sourceCaches[C]=new r.bv(M,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=P,P.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();let h=this.getOwnSource(s);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(s);for(let v of g){let x=r.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getOwnSource(s).setData(h),this._changes.setDirty()}getOwnSource(s){let h=this.getOwnSourceCache(s);return h&&h.getSource()}getOwnSources(){let s=[];for(let h in this._otherSourceCaches){let g=this.getOwnSourceCache(h);g&&s.push(g.getSource())}return s}areTilesLoaded(){let s=this._mergedSourceCaches;for(let h in s){let g=s[h]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let v of s){if(this._validate(Ae,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(h)}else this.ambientLight=new Qc(v,Zt,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(h)}else this.directionalLight=new Qc(v,ip,this.scope,this.options)}}let g=new r.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let s=this.directionalLight,h=this.ambientLight;if(!s||!h)return;let g=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),x=s.properties.get("intensity"),E=s.properties.get("direction"),C=1-r.ac(E.x,E.y,E.z)[2]/90,M=g(v)*x*C,P=h.properties.get("color").toRenderColor(null).toArray01(),k=h.properties.get("intensity");return(M+g(P)*k)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(r.cV(s)){let h=r.cW(s),g=this.fragments.find(({id:x})=>x===h);if(!g)throw new Error(`Style import not found: ${s}`);let v=r.cU(s);return g.style.getFragmentStyle(v)}{let h=this.fragments.find(({id:g})=>g===s);if(!h)throw new Error(`Style import not found: ${s}`);return h.style}}getConfigProperty(s,h){let g=this.getFragmentStyle(s);if(!g)return null;let v=r.al(h,g.scope),x=g.options.get(v),E=x?x.value||x.default:null;return E?E.serialize():null}setConfigProperty(s,h,g){let v=this.getFragmentStyle(s);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[h])return;let E=r.y(g);if(E.result!=="success")return void qs(this,E.value);let C=E.value.expression,M=r.al(h,v.scope),P=v.options.get(M);if(!P)return;let k,{minValue:N,maxValue:B,stepValue:V,type:G,values:H}=x[h],q=r.y(x[h].default);q.result==="success"&&(k=q.value.expression),k?(this.options.set(M,gr(xt({},P),{value:C,default:k,minValue:N,maxValue:B,stepValue:V,type:G,values:H})),this.updateConfigDependencies()):this.fire(new r.d(new Error(`No schema defined for the config option "${h}" in the "${s}" fragment.`)))}getConfig(s){let h=this.getFragmentStyle(s);if(!h)return null;let g=h.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let E=r.al(x,h.scope),C=h.options.get(E),M=C?C.value||C.default:null;v[x]=M?M.serialize():null}return v}setConfig(s,h){let g=this.getFragmentStyle(s);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){let h=this.getFragmentStyle(s);return h?h.stylesheet.schema:null}setSchema(s,h){let g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(s,h){if(this._config=s,s||h)if(h)for(let g in h){let v,x,E=r.y(h[g].default);if(E.result==="success"&&(v=E.value.expression),s&&s[g]!==void 0){let B=r.y(s[g]);B.result==="success"&&(x=B.value.expression)}let{minValue:C,maxValue:M,stepValue:P,type:k,values:N}=h[g];if(v){let B=r.al(g,this.scope);this.options.set(B,{default:v,value:x,minValue:C,maxValue:M,stepValue:P,type:k,values:N})}else this.fire(new r.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new r.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let s of this._configDependentLayers){let h=this.getLayer(s);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){let h=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut||s._styleColorTheme.lut&&h!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(s,h,g={}){this._checkLoaded();let v=s.id;if(this._layers[v])return void this.fire(new r.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(s.type==="custom"){if(qs(this,r.cX(s)))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=r.cT(s),s=r.W(s,{source:v})),this._validate(rt,`layers.${v}`,s,{arrayIndex:-1},g))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let E=this._order.length;if(h){let k=this._order.indexOf(h);if(k===-1)return void this.fire(new r.d(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?E=k:r.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let C=this.getOwnLayerSourceCache(x),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&x.canCastShadows()&&M&&(C.castsShadows=!0);let P=this._changes.getRemovedLayer(x);if(P&&x.source&&C&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let k=r.al(x.source,x.scope);P.type!==x.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,h){this._checkLoaded();let g=this._checkLayer(s);if(!g||s===h)return;let v=this._order.indexOf(s);this._order.splice(v,1);let x=this._order.length;if(h){let E=this._order.indexOf(h);if(E===-1)return void this.fire(new r.d(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?x=E:r.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();let h=this._checkLayer(s);if(!h)return;h.setEventedParent(null);let g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],delete this._serializedLayers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let x=!1;for(let E in this._layers)if(this._layers[E].source===h.source&&this._layers[E].canCastShadows()){x=!0;break}v.castsShadows=x}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(let h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();let v=this._checkLayer(s);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,h){this._checkLoaded();let g=this._checkLayer(s);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(s,h,g={}){this._checkLoaded();let v=this._checkLayer(s);if(v&&!w(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Ke,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=r.cT(h),this._updateLayer(v)))}getFilter(s){let h=this._checkLayer(s);if(h)return r.cT(h.filter)}setLayoutProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(x&&!w(x.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&qs(x,Mt.call(de,{key:`layers.${s}.layout.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:r.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(h,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,h){let g=this._checkLayer(s);if(g)return g.getLayoutProperty(h)}setPaintProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(!x||w(x.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&qs(x,_t.call(de,{key:`layers.${s}.paint.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:r.L})))return;let E=x.setPaintProperty(h,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),E&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,h){let g=this._checkLayer(s);if(g)return g.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();let g=s.source,v=s.sourceLayer,x=this._checkSource(g);if(!x)return;let E=x.type;if(E==="geojson"&&v)return void this.fire(new r.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!v)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided.")));let C=this.getOwnSourceCaches(g);for(let M of C)M.setFeatureState(v,s.id,h)}removeFeatureState(s,h){this._checkLoaded();let g=s.source,v=this._checkSource(g);if(!v)return;let x=v.type,E=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!E)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new r.d(new Error("A feature id is required to remove its specific state property.")));let C=this.getOwnSourceCaches(g);for(let M of C)M.removeFeatureState(E,s.id,h)}getFeatureState(s){this._checkLoaded();let h=s.source,g=s.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=r.W({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return r.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let s=this.getTerrain(),h=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return r.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(s){this._changes.updateLayer(s);let h=this.getLayerSourceCache(s),g=r.al(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){let h=C=>this._mergedLayers[C].type==="fill-extrusion"||this._mergedLayers[C].type==="model",g=this.order,v={},x=[];for(let C=g.length-1;C>=0;C--){let M=g[C];if(h(M)){v[M]=C;for(let P of s){let k=P[M];if(k)for(let N of k)x.push(N)}}}x.sort((C,M)=>M.intersectionZ-C.intersectionZ);let E=[];for(let C=g.length-1;C>=0;C--){let M=g[C];if(h(M))for(let P=x.length-1;P>=0;P--){let k=x[P].feature;if(k.layer&&v[k.layer.id]<C)break;E.push(k),x.pop()}else for(let P of s){let k=P[M];if(k)for(let N of k)E.push(N.feature)}}return E}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(Ke,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new r.d(new Error("parameters.layers must be an Array."))),[];for(let P of h.layers){let k=this._mergedLayers[P];if(!k)return this.fire(new r.d(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v[k.source]=!0}}let x=[],E=h.serializedLayers||{},C=h&&h.layers?h.layers.some(P=>{let k=this.getLayer(P);return k&&k.is3D()}):this.has3DLayers(),M=xi.createFromScreenPoints(s,g);for(let P in this._mergedSourceCaches){let k=this._mergedSourceCaches[P].getSource();if(!k||k.scope!==h.scope)continue;let N=this._mergedSourceCaches[P].getSource().id;h.layers&&!v[N]||x.push(w1(this._mergedSourceCaches[P],this._mergedLayers,E,M,h,g,C,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,k,N,B,V,G,H){let q={},W=G.queryRenderedSymbols(B),ee=[];for(let te of Object.keys(W).map(Number))ee.push(H[te]);ee.sort($l);for(let te of ee){let ne=te.featureIndex.lookupSymbolFeatures(W[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,V.filter,V.layers,V.availableImages,P);for(let ue in ne){let ce=q[ue]=q[ue]||[],J=ne[ue];J.sort((re,ie)=>{let ge=te.featureSortOrder;if(ge){let Ce=ge.indexOf(re.featureIndex);return ge.indexOf(ie.featureIndex)-Ce}return ie.featureIndex-re.featureIndex});for(let re of J)ce.push(re)}}for(let te in q)q[te].forEach(ne=>{let ue=ne.feature,ce=N(P[te]);if(!ce)return;let J=ce.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=J});return q}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,h){h&&h.filter&&this._validate(Ke,"querySourceFeatures.filter",h.filter,null,h);let g=this.getOwnSourceCaches(s),v=[];for(let x of g)v=v.concat(xu(x,h));return v}addSourceType(s,h,g){return To.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(To.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,h,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let C in s)if(!w(s[C],v[C])){x=!0;break}if(!x)return;let E=this._getTransitionParameters();this.light.setLight(s,h,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,h=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s,v=s.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let C="terrain-dem-src";this.addSource(C,g.source),g=r.cT(g),g=r.W(g,{source:C})}let x=r.W({},g),E={};if(this.terrain&&v){x.source=this.terrain.get().source;let C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(E.style=C.serialize())}if(this._validate(ve,"terrain",x,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new r.f("data",{dataType:"style"}))}else{let x=this.terrain,E=x.get();for(let C of Object.keys(r.L.terrain))!g.hasOwnProperty(C)&&r.L.terrain[C].default&&(g[C]=r.L.terrain[C].default);for(let C in s)if(!w(s[C],E[C])){x.set(s,this.options),this.stylesheet.terrain=s;let M=this._getTransitionParameters({duration:0});x.updateTransitions(M),this.fire(new r.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){let h=this.fog=new w_(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!w(h.get(),s)){h.set(s,this.options),this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}setColorTheme(s){this._checkLoaded();let h=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=s,!s)return this._styleColorTheme.lut=null,void h();let g=this._evaluateColorThemeData(s);this._loadColorTheme(g).then(()=>{h()}).catch(v=>{r.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(s){return{now:r.e.now(),transition:r.W(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;let s=[],h=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?s.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){let g=this.terrain=new Ln(s,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,g,v,x={}){if(x&&x.validate===!1)return!1;let E=r.W({},this.serialize());return qs(this,s.call(de,r.W({key:h,style:E,value:g,styleSpec:r.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){let h=this.getSourceCaches(s);for(let g of h)g.clearTiles()}clearSources(){for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){let h=this.getSourceCaches(s);for(let g of h)g.resume(),g.reload()}reloadSources(){for(let s of this.getSources())s.reload&&s.reload()}updateSources(s){let h;this.directionalLight&&(h=iu(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,h)}_generateCollisionBoxes(){for(let s in this._sourceCaches){let h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,g,v,x,E,C=!1){let M=!1,P=!1,k={},N={};for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=r.al(G.source,G.scope),q=k[H];if(!q){let ee=this.getLayerSourceCache(G);if(!ee)continue;let te=ee.getRenderableIds(!0).map(ne=>ee.getTileByID(ne));N[H]=te.slice(),q=k[H]=te.sort((ne,ue)=>ue.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ue.tileID)?-1:1))}let W=this.crossTileSymbolIndex.addLayer(G,q,h.center.lng,h.projection);M=M||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new r.f("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.e.now(),h.zoom))&&(this.pauseablePlacement=new dd(h,this._mergedOrder,C,g,v,x,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.e.now()),P=!0),M&&this.pauseablePlacement.placement.setStale()),P||M){this._buildingIndex.onNewFrame(h.zoom);for(let V=0;V<this._mergedOrder.length;V++){let G=this._mergedLayers[this._mergedOrder[V]];if(G.type!=="symbol")continue;let H=this.isLayerClipped(G)&&this._clipLayerIndices.some(q=>V<q);this.placement.updateLayerOpacities(G,k[r.al(G.source,G.scope)],V,H?E:null)}}let B=!1;for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=k[r.al(G.source,G.scope)];for(let q of H){let W=q.getBucket(G);W&&q.latestFeatureIndex&&G.fqid===W.layerIds[0]&&(B=W.updateOcclusionOpacities(s.context,s.symbolParams,s._dt)||B)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.e.now())||B,occlusionQueryBasedOpacityChanged:B}}_releaseSymbolFadeTiles(){for(let s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,h){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===s.id)!==-1)return void this.fire(new r.d(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!h)return g.push(s),this._loadImports([s],!0);let v=g.findIndex(({id:x})=>x===h);return v===-1&&this.fire(new r.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(s).concat(g.slice(v)),this._loadImports([s],!0,h)}updateImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);return v===-1?this:typeof h=="string"?(this.setImportUrl(s,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(s,h.url),w(h.config,g[v].config)||this.setImportConfig(s,h.config),w(h.data,g[v].data)||this.setImportData(s,h.data),this)}moveImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;let x=this.getImportIndex(h);if(x===-1)return this;let E=g[v],C=this.fragments[v];return g=g.filter(({id:M})=>M!==s),this.fragments=this.fragments.filter(({id:M})=>M!==s),this.stylesheet.imports=g.slice(0,x).concat(E).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(C).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;g[v].url=h;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(h),this}setImportData(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(s,v[g].url))}setImportConfig(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;let x=this.fragments[g],E=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=h,x.style.updateConfig(h,E),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){let h=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return h===-1&&this.fire(new r.d(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),h}getLayer(s){return this._mergedLayers[s]}getSources(){let s=[];for(let h in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[h];g&&s.push(g.getSource())}return s}getSource(s,h){let g=this.getSourceCache(s,h);return g&&g.getSource()}getLayerSource(s){let h=this.getLayerSourceCache(s);return h&&h.getSource()}getSourceCache(s,h){let g=r.al(s,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){let h=r.al(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[s]&&h.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&h.push(this._mergedSymbolSourceCaches[s]),h}updateSourceCaches(){let s=this._changes.getUpdatedSourceCaches();for(let h in s){let g=s[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(s){let h=this._changes.getUpdatedPaintProperties();for(let g of h){let v=this.getLayer(g);v&&v.updateTransitions(s)}}getImages(s,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(s,h,g){return r.c$(h,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){let h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){let h=this.getOwnSourceCaches(s);return h.length===0?(this.fire(new r.d(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,h){if(this._clipLayerIndices.length===0&&s.type!=="fill-extrusion")return!1;let g=s.type==="fill-extrusion"&&s.sourceLayer==="building",v=0;if(s.is3D()){if(g||h&&h.type==="batched-model")return!0;s.type==="model"&&(v=r.cu.Model)}else s.type==="symbol"&&(v=r.cu.Symbol);for(let x of this._clipLayerIndices){let E=this._mergedLayers[this._mergedOrder[x]];if(!E)continue;let C=[];for(let M of E.layout.get("clip-layer-types"))C.push(M==="model"?r.cu.Model:M==="symbol"?r.cu.Symbol:r.cu.FillExtrusion);for(let M of C)if(v&M)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Kp(p,s){let h=!1,g=null,v=()=>{g=null,h&&(p(),g=setTimeout(v,s),h=!1)};return()=>(h=!0,g||v(),g)}To.getSourceType=function(p){return Kr[p]},To.setSourceType=function(p,s){Kr[p]=s},To.registerForPluginStateChange=r.cL;class A1{constructor(s){this._hashName=s&&encodeURIComponent(s),r.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kp(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let s=this._map;if(!s)return"";let h=Su(s);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(E=>{let C=E.split("=")[0];return C===g?(v=!0,`${C}=${h}`):E}).filter(E=>E);return v||x.push(`${g}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let s=location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){let s=this._map;if(!s)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){let g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Su(p,s){let h=p.getCenter(),g=Math.round(100*p.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),E=Math.round(h.lng*x)/x,C=Math.round(h.lat*x)/x,M=p.getBearing(),P=p.getPitch(),k=s?`/${E}/${C}/${g}`:`${g}/${C}/${E}`;return(M||P)&&(k+="/"+Math.round(10*M)/10),P&&(k+=`/${Math.round(P)}`),k}let fd={linearity:.3,easing:r.d0(0,0,.3,1)},ey=r.W({deceleration:2500,maxSpeed:1400},fd),Qp=r.W({deceleration:20,maxSpeed:1400},fd),pd=r.W({deceleration:1e3,maxSpeed:360},fd),Jp=r.W({deceleration:1e3,maxSpeed:90},fd);class Ba{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.e.now(),settings:s})}_drainInertiaBuffer(){let s=this._inertiaBuffer,h=r.e.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=Iu(h.pan.mag(),g,r.W({},ey,s||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,ql(v,x)}if(h.zoom){let x=Iu(h.zoom,g,Qp);v.zoom=this._map.transform.zoom+x.amount,ql(v,x)}if(h.bearing){let x=Iu(h.bearing,g,pd);v.bearing=this._map.transform.bearing+r.at(x.amount,-179,179),ql(v,x)}if(h.pitch){let x=Iu(h.pitch,g,Jp);v.pitch=this._map.transform.pitch+x.amount,ql(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function ql(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function Iu(p,s,h){let{maxSpeed:g,linearity:v,deceleration:x}=h,E=r.at(p*v/(s/1e3),-g,g),C=Math.abs(E)/(x*v);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}class Qr extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,v={}){let x=ft(h.getCanvasContainer(),g),E=h.unproject(x);super(s,r.W({point:x,lngLat:E,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class Ws extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){let v=s==="touchend"?g.changedTouches:g.touches,x=Ue(h.getCanvasContainer(),v),E=x.map(M=>h.unproject(M)),C=x.reduce((M,P,k,N)=>M.add(P.div(N.length)),new r.P(0,0));super(s,{points:x,point:C,lngLats:E,lngLat:h.unproject(C),originalEvent:g}),this._defaultPrevented=!1}}class md extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class em{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new md(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Qr(s.type,this._map,s))}mouseup(s){this._map.fire(new Qr(s.type,this._map,s))}preclick(s){let h=r.W({},s);h.type="preclick",this._map.fire(new Qr(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Qr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Qr(s.type,this._map,s))}mouseover(s){this._map.fire(new Qr(s.type,this._map,s))}mouseout(s){this._map.fire(new Qr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ws(s.type,this._map,s))}touchmove(s){this._map.fire(new Ws(s.type,this._map,s))}touchend(s){this._map.fire(new Ws(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ws(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Du{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Qr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Qr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gd{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(Ie(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;let g=h,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=$("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));let E=Math.min(v.x,g.x),C=Math.max(v.x,g.x),M=Math.min(v.y,g.y),P=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=C-E+"px",this._box.style.height=P-M+"px")})}mouseupWindow(s,h){if(!this._active)return;let g=this._startPos,v=h;if(g&&s.button===0){if(this.reset(),nt(),g.x!==v.x||g.y!==v.y)return this._map.fire(new r.f("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Qe(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new r.f(s,{originalEvent:h}))}}function Mu(p,s){let h={};for(let g=0;g<p.length;g++)h[p[g].identifier]=s[g];return h}class ty{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new r.P(0,0);for(let E of v)x._add(E);return x.div(v.length)}(h),this.touches=Mu(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;let v=Mu(g,h);for(let x in this.touches){let E=v[x];(!E||E.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Au{constructor(s){this.singleTap=new ty(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){let v=this.singleTap.touchend(s,h,g);if(v){let x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class _d{constructor(){this._zoomIn=new Au({numTouches:1,numTaps:2}),this._zoomOut=new Au({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){let v=this._zoomIn.touchend(s,h,g),x=this._zoomOut.touchend(s,h,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Pu={0:1,2:2};class yd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;let g=Nt(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){let g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(v,x){let E=Pu[x];return v.buttons===void 0||(v.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(s){this._lastPoint&&Nt(s)===this._eventButton&&(this._moved&&nt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ny extends yd{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class tm extends yd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Va extends yd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class ry{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),r.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!r.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);let v=Mu(g,h),x=new r.P(0,0),E=new r.P(0,0),C=0;for(let P in v){let k=v[P],N=this._touches[P];N&&(x._add(k),E._add(k.sub(N)),C++,v[P]=k)}if(this._touches=v,C<this._minTouches||!E.mag())return;let M=E.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class nm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){let v=this._firstTwoTouches;if(!v)return;s.preventDefault();let[x,E]=v,C=vd(g,h,x),M=vd(g,h,E);if(!C||!M)return;let P=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],P,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,E=vd(g,h,v),C=vd(g,h,x);E&&C||(this._active&&nt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function vd(p,s,h){for(let g=0;g<p.length;g++)if(p[g].identifier===h)return s[g]}function iy(p,s){return Math.log(p/s)/Math.LN2}class rm extends nm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){let g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(iy(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:iy(this._distance,g),pinchAround:h}}}function xd(p,s){return 180*p.angleWith(s)/Math.PI}class im extends nm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){let g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xd(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());let h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=xd(s,g);return Math.abs(v)<h}}function Ru(p){return Math.abs(p.y)>Math.abs(p.x)}class oy extends nm{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Ru(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){let v=this._lastPoints;if(!v)return;let x=s[0].sub(v[0]),E=s[1].sub(v[1]);return this._map._cooperativeGestures&&!r.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+E.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;let v=s.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let E=s.y>0==h.y>0;return Ru(s)&&Ru(h)&&E}}let sy={panStep:100,bearingStep:15,pitchStep:10};class P1{constructor(){let s=sy;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,v=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:C=>{let M=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Ou,zoom:h?Math.round(M)+h*(s.shiftKey?2:1):M,bearing:C.getBearing()+g*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ou(p){return p*(2-p)}let Wl=4.000244140625,ay=1/450;class Hi{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ay,r.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||r.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,g=r.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Wl==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=ft(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){let P=this._type==="wheel"&&Math.abs(this._delta)>Wl?this._wheelZoomRate:this._defaultZoomRate,k=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&k!==0&&(k=1/k);let N=h(),B=Math.pow(2,N),V=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(V*k))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,E,C=!1;if(this._type==="wheel"&&v&&x){let P=Math.min((r.e.now()-this._lastWheelEventTime)/200,1),k=x(P);E=r.a2(v,g,k),P<1?this._frameId||(this._frameId=!0):C=!0}else E=g,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-h();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=r.d2;if(this._prevEase){let g=this._prevEase,v=(r.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),E=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-E*E);h=r.d0(E,C,.25,1)}return this._prevEase={start:r.e.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class om{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wd{constructor(){this._tap=new Au({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sm{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class am{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ed{constructor(s,h,g,v){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Zl=p=>p.zoom||p.drag||p.pitch||p.rotate;class lm extends r.f{}class Td{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){let g=r._.sub([],h,s);this.radius=r._.length(g[2]<0?r._.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){r._.div(s,s,this.constants),r._.normalize(s,s),r._.mul(s,s,this.constants);let h=r._.scale([],s,this.radius);if(h[2]>0){let g=r._.scale([],[0,0,1],r._.dot(h,[0,0,1])),v=r._.scale([],r._.normalize([],[h[0],h[1],0]),this.radius),x=r._.add([],h,r._.scale([],r._.sub([],r._.add([],v,g),h),2));h[0]=x[0],h[1]=x[1]}return h}}function ku(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ly{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ba(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Td,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),r.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,E]of this._listeners){let C=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,C,E)}}destroy(){for(let[s,h,g]of this._listeners){let v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(h,v,g)}}_addDefaultHandlers(s){let h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new em(h,s));let v=h.boxZoom=new gd(h,s);this._add("boxZoom",v);let x=new _d,E=new bd;h.doubleClickZoom=new om(E,x),this._add("tapZoom",x),this._add("clickZoom",E);let C=new wd;this._add("tapDragZoom",C);let M=h.touchPitch=new oy(h);this._add("touchPitch",M);let P=new tm(s),k=new Va(s);h.dragRotate=new am(s,P,k),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);let N=new ny(s),B=new ry(h,s);h.dragPan=new sm(g,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);let V=new im,G=new rm;h.touchZoomRotate=new Ed(g,G,V,C),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Du(h));let H=h.scrollZoom=new Hi(h,this);this._add("scrollZoom",H,["mousePan"]);let q=h.keyboard=new P1;this._add("keyboard",q);for(let W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[W]&&h[W].enable(s[W])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(let v in s)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){let h=[];for(let g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;let g=s.type==="renderFrame",v=g?void 0:s,x={needsRenderFrame:!1},E={},C={},M=s.touches?this._getMapTouches(s.touches):void 0,P=M?Ue(this._el,M):g?void 0:ft(this._el,s);for(let{handlerName:B,handler:V,allowed:G}of this._handlers){if(!V.isEnabled())continue;let H;this._blockedByActive(C,G,B)?V.reset():V[h||s.type]&&(H=V[h||s.type](s,P,M),this.mergeHandlerResult(x,E,H,B,v),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||V.isActive())&&(C[B]=V)}let k={};for(let B in this._previousActiveHandlers)C[B]||(k[B]=v);this._previousActiveHandlers=C,(Object.keys(k).length||ku(x))&&(this._changes.push([x,E,k]),this._triggerRenderFrame()),(Object.keys(C).length||ku(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:N}=x;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(s,h,g,v,x){if(!g)return;r.W(s,g);let E={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(h.zoom=E),g.panDelta!==void 0&&(h.drag=E),g.pitchDelta!==void 0&&(h.pitch=E),g.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){let s={},h={},g={};for(let[v,x,E]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),r.W(h,x),r.W(g,E);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){let v=this._map,x=v.transform,E=ee=>[ee.x,ee.y,ee.z];if((ee=>{let te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!ku(s)){let ee=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ee!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!ku(s))return void this._fireEvents(h,g,!0);let{panDelta:C,zoomDelta:M,bearingDelta:P,pitchDelta:k,around:N,aroundCoord:B,pinchAround:V}=s;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),V!==void 0&&(N=V),(M||(ee=>h[ee]&&!this._eventsInProgress[ee])("drag"))&&N&&(this._dragOrigin=E(x.pointCoordinate3D(N)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),N=N||v.transform.centerPoint,P&&(x.bearing+=P),k&&(x.pitch+=k),x._updateCameraState();let G=[0,0,0];if(C)if(x.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N).dir),te=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N.sub(C)).dir);G[0]=te[0]-ee[0],G[1]=te[1]-ee[1]}else{let ee=x.pointCoordinate(N);if(x.projection.name==="globe"){C=C.rotate(-x.angle);let te=x._pixelsPerMercatorPixel/x.worldSize;G[0]=-C.x*r.d3(r.ay(ee.y))*te,G[1]=-C.y*r.d3(x.center.lat)*te}else{let te=x.pointCoordinate(N.sub(C));ee&&te&&(G[0]=te.x-ee.x,G[1]=te.y-ee.y)}}let H=x.zoom,q=[0,0,0];if(M){let ee=E(B||x.pointCoordinate3D(N)),te={dir:r._.normalize([],r._.sub([],ee,x._camera.position))};if(te.dir[2]<0){let ne=x.zoomDeltaToMovement(ee,M);r._.scale(q,te.dir,ne)}}let W=r._.add(G,G,q);x._translateCameraConstrained(W),M&&Math.abs(x.zoom-H)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){let v=Zl(this._eventsInProgress),x=Zl(s),E={};for(let k in s){let{originalEvent:N}=s[k];this._eventsInProgress[k]||(E[`${k}start`]=N),this._eventsInProgress[k]=s[k]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let k in E)this._fireEvent(k,E[k]);x&&this._fireEvent("move",x.originalEvent);for(let k in s){let{originalEvent:N}=s[k];this._fireEvent(k,N)}let C={},M;for(let k in this._eventsInProgress){let{handlerName:N,originalEvent:B}=this._eventsInProgress[k];this._handlersById[N].isActive()||(delete this._eventsInProgress[k],M=h[N]||B,C[`${k}end`]=M)}for(let k in C)this._fireEvent(k,C[k]);let P=Zl(this._eventsInProgress);if(g&&(v||x)&&!P){this._updatingCamera=!0;let k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;k?(N(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:M})):(this._map.fire(new r.f("moveend",{originalEvent:M})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new r.f(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new lm("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let ja="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class R1 extends r.E{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,r.bp(["_renderFrameCallback"],this)}getCenter(){return new r.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=r.P.convert(s).mult(-1),this.panTo(this.transform.center,r.W({offset:s},h),g)}panTo(s,h,g){return this.easeTo(r.W({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(r.W({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(r.W({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,r.W({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(r.W({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=r.ai.convert(s);let g=h&&h.bearing||0,v=h&&h.pitch||0,x=s.getNorthWest(),E=s.getSouthEast();return this._cameraForBounds(this.transform,x,E,g,v,h)}_extendPadding(s){let h={top:0,right:0,bottom:0,left:0};return s==null?r.W({},h,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:r.W({},h,s)}_extendCameraOptions(s){return(s=r.W({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,h){let g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,v,x,E){let C=s.clone(),M=this._extendCameraOptions(E);C.bearing=v,C.pitch=x;let P=r.aI.convert(h),k=r.aI.convert(g),N=.5*(P.lat+k.lat),B=.5*(P.lng+k.lng),V=r.d4(N,B),G=r._.normalize([],V),H=r._.normalize([],r._.cross([],G,[0,1,0])),q=r._.cross([],H,G),W=[H[0],H[1],H[2],0,q[0],q[1],q[2],0,G[0],G[1],G[2],0,0,0,0,1],ee=[V,r.d4(P.lat,P.lng),r.d4(k.lat,P.lng),r.d4(k.lat,k.lng),r.d4(P.lat,k.lng),r.d4(N,P.lng),r.d4(N,k.lng),r.d4(P.lat,B),r.d4(k.lat,B)],te=r.b6.fromPoints(ee.map(Fe=>[r._.dot(H,Fe),r._.dot(q,Fe),r._.dot(G,Fe)])),ne=r._.transformMat4([],te.center,W);r._.squaredLength(ne)===0&&r._.set(ne,0,0,1),r._.normalize(ne,ne),r._.scale(ne,ne,r.cD),C.center=r.d5(ne);let ue=C.getWorldToCameraMatrix(),ce=r.ad.invert(new Float64Array(16),ue);te=r.b6.applyTransform(te,r.ad.multiply([],ue,W));let J=this._extendAABB(te,C,M,v);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=J,r._.transformMat4(ne,ne,ue);let re=.5*(te.max[2]-te.min[2]),ie=this._minimumAABBFrustumDistance(C,te),ge=r._.scale([],[0,0,1],re),Ce=r._.add(ge,ne,ge),ae=ie+(C.pitch===0?0:r._.distance(ne,Ce)),Se=C.globeCenterInViewSpace,Me=r._.sub([],ne,[Se[0],Se[1],Se[2]]);r._.normalize(Me,Me),r._.scale(Me,Me,ae);let $e=r._.add([],ne,Me);r._.transformMat4($e,$e,ce);let Ge=r.d7/r.cD,Ve=r._.length($e),xe=r.ax(Math.max(Ve*Ge-r.d7,Number.EPSILON),0),Re=Math.min(C.zoomFromMercatorZAdjusted(xe),M.maxZoom);return Re>.5*(r.b1+r.aU)?(C.setProjection({name:"mercator"}),C.zoom=Re,this._cameraForBounds(C,h,g,v,x,E)):{center:C.center,zoom:Re,bearing:v,pitch:x}}_extendAABB(s,h,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),C=E,M=x,P=x,k=E,N=h.width-(M+P),B=h.height-(C+k),V=r._.sub([],s.max,s.min),G=Math.min(N/V[0],B/V[1]),H=Math.min(h.scaleZoom(h.scale*G),g.maxZoom);if(isNaN(H))return null;let q=h.scale/h.zoomScale(H),W=new r.b6([s.min[0]-M*q,s.min[1]-k*q,s.min[2]],[s.max[0]+P*q,s.max[1]+C*q,s.max[2]]),ee=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new r.P(g.offset.x,g.offset.y):r.P.convert(g.offset)).rotate(-r.ab(v));return W.center[0]-=ee.x*q,W.center[1]+=ee.y*q,W}queryTerrainElevation(s,h){let g=this.transform.elevation;return g?(h=r.W({},{exaggerated:!0},h),g.getAtPoint(r.Y.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,v,x,E){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,g,v,x,E);let C=s.clone(),M=this._extendCameraOptions(E);C.bearing=v,C.pitch=x;let P=r.aI.convert(h),k=r.aI.convert(g),N=new r.aI(P.lng,k.lat),B=new r.aI(k.lng,P.lat),V=C.project(P),G=C.project(k),H=this.queryTerrainElevation(P),q=this.queryTerrainElevation(k),W=this.queryTerrainElevation(N),ee=this.queryTerrainElevation(B),te=[[V.x,V.y,Math.min(H||0,q||0,W||0,ee||0)],[G.x,G.y,Math.max(H||0,q||0,W||0,ee||0)]],ne=r.b6.fromPoints(te),ue=C.getWorldToCameraMatrix(),ce=r.ad.invert(new Float64Array(16),ue);ne=r.b6.applyTransform(ne,ue);let J=this._extendAABB(ne,C,M,v);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=J;let re=.5*r._.sub([],ne.max,ne.min)[2],ie=this._minimumAABBFrustumDistance(C,ne),ge=[0,0,1,0];r.aA.transformMat4(ge,ge,ue),r.aA.normalize(ge,ge);let Ce=r._.scale([],ge,ie+re),ae=r._.add([],ne.center,Ce);r._.transformMat4(ne.center,ne.center,ce),r._.transformMat4(ae,ae,ce);let Se=[ne.center[0],ne.center[1],ae[2]*C.pixelsPerMeter];r._.scale(Se,Se,1/C.worldSize);let Me=r.d6(Se[0]),$e=r.ay(Se[1]),Ge=Math.min(C._zoomFromMercatorZ(Se[2]),M.maxZoom),Ve=new r.aI(Me,$e);return C.mercatorFromTransition&&Ge<.5*(r.b1+r.aU)?(C.setProjection({name:"globe"}),C.zoom=Ge,this._cameraForBounds(C,h,g,v,x,E)):{center:Ve,zoom:Ge,bearing:v,pitch:x}}fitBounds(s,h,g){let v=this.cameraForBounds(s,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(s,h,g,v,x){let E=r.P.convert(s),C=r.P.convert(h),M=new r.P(Math.min(E.x,C.x),Math.min(E.y,C.y)),P=new r.P(Math.max(E.x,C.x),Math.max(E.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,C))return this;let k=this.transform.pointLocation3D(M),N=this.transform.pointLocation3D(P),B=this.transform.pointLocation3D(new r.P(M.x,P.y)),V=this.transform.pointLocation3D(new r.P(P.x,M.y)),G=[Math.min(k.lng,N.lng,B.lng,V.lng),Math.min(k.lat,N.lat,B.lat,V.lat)],H=[Math.max(k.lng,N.lng,B.lng,V.lng),Math.max(k.lat,N.lat,B.lat,V.lat)],q=v&&v.pitch?v.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,G,H,g,q,v);return this._fitInternal(W,v,x)}_fitInternal(s,h,g){return s?(h=r.W(s,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(s,h){this.stop();let g=s.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,E=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=r.aI.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(x=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(E=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new r.f("movestart",h)).fire(new r.f("move",h)),v&&this.fire(new r.f("zoomstart",h)).fire(new r.f("zoom",h)).fire(new r.f("zoomend",h)),x&&this.fire(new r.f("rotatestart",h)).fire(new r.f("rotate",h)).fire(new r.f("rotateend",h)),E&&this.fire(new r.f("pitchstart",h)).fire(new r.f("pitch",h)).fire(new r.f("pitchend",h)),this.fire(new r.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(ja),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){let g=this.transform;if(!g.projection.supportsFreeCamera)return r.w(ja),this;this.stop();let v=g.zoom,x=g.pitch,E=g.bearing;g.setFreeCameraOptions(s);let C=v!==g.zoom,M=x!==g.pitch,P=E!==g.bearing;return this.fire(new r.f("movestart",h)).fire(new r.f("move",h)),C&&this.fire(new r.f("zoomstart",h)).fire(new r.f("zoom",h)).fire(new r.f("zoomend",h)),P&&this.fire(new r.f("rotatestart",h)).fire(new r.f("rotate",h)).fire(new r.f("rotateend",h)),M&&this.fire(new r.f("pitchstart",h)).fire(new r.f("pitch",h)).fire(new r.f("pitchend",h)),this.fire(new r.f("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=r.W({offset:[0,0],duration:500,easing:r.d2},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in s?+s.zoom:v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,k="pitch"in s?+s.pitch:E,N=this._extendPadding(s.padding),B=r.P.convert(s.offset),V,G,H;if(g.projection.name==="globe"){let ie=r.Y.fromLngLat(g.center),ge=B.rotate(-g.angle);ie.x+=ge.x/g.worldSize,ie.y+=ge.y/g.worldSize;let Ce=ie.toLngLat(),ae=r.aI.convert(s.center||Ce);this._normalizeCenter(ae),V=g.centerPoint.add(ge),G=new r.P(ie.x,ie.y).mult(g.worldSize),H=new r.P(r.aj(ae.lng),r.ak(ae.lat)).mult(g.worldSize).sub(G)}else{V=g.centerPoint.add(B);let ie=g.pointLocation(V),ge=r.aI.convert(s.center||ie);this._normalizeCenter(ge),G=g.project(ie),H=g.project(ge).sub(G)}let q=g.zoomScale(M-v),W,ee;s.around&&(W=r.aI.convert(s.around),ee=g.locationPoint(W));let te=this._zooming||M!==v,ne=this._rotating||x!==P,ue=this._pitching||k!==E,ce=!g.isPaddingEqual(N),J=ie=>ge=>{if(te&&(ie.zoom=r.a2(v,M,ge)),ne&&(ie.bearing=r.a2(x,P,ge)),ue&&(ie.pitch=r.a2(E,k,ge)),ce&&(ie.interpolatePadding(C,N,ge),V=ie.centerPoint.add(B)),W)ie.setLocationAtPoint(W,ee);else{let Ce=ie.zoomScale(ie.zoom-v),ae=M>v?Math.min(2,q):Math.max(.5,q),Se=Math.pow(ae,1-ge),Me=ie.unproject(G.add(H.mult(ge*Se)).mult(Ce));ie.setLocationAtPoint(ie.renderWorldCopies?Me.wrap():Me,V)}return s.preloadOnly||this._fireMoveEvents(h),ie};if(s.preloadOnly){let ie=this._emulate(J,s.duration,g);return this._preloadTiles(ie),this}let re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=ne,this._pitching=ue,this._padding=ce,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,re),this._ease(J(g),ie=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,ie)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new r.f("movestart",s)),this._zooming&&!g.zooming&&this.fire(new r.f("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new r.f("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new r.f("pitchstart",s))}_fireMoveEvents(s){this.fire(new r.f("move",s)),this._zooming&&this.fire(new r.f("zoom",s)),this._rotating&&this.fire(new r.f("rotate",s)),this._pitching&&this.fire(new r.f("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new r.f("zoomend",s)),v&&this.fire(new r.f("rotateend",s)),x&&this.fire(new r.f("pitchend",s)),this.fire(new r.f("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){let Re=r.ah(s,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Re,h)}this.stop(),s=r.W({offset:[0,0],speed:1.2,curve:1.42,easing:r.d2},s);let g=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in s?r.at(+s.zoom,g.minZoom,g.maxZoom):v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,k="pitch"in s?+s.pitch:E,N=this._extendPadding(s.padding),B=g.zoomScale(M-v),V=r.P.convert(s.offset),G=g.centerPoint.add(V),H=g.pointLocation(G),q=r.aI.convert(s.center||H);this._normalizeCenter(q);let W=g.project(H),ee=g.project(q).sub(W),te=s.curve,ne=Math.max(g.width,g.height),ue=ne/B,ce=ee.mag();if("minZoom"in s){let Re=r.at(Math.min(s.minZoom,v,M),g.minZoom,g.maxZoom),Fe=ne/g.zoomScale(Re-v);te=Math.sqrt(Fe/ce*2)}let J=te*te;function re(Re){let Fe=(ue*ue-ne*ne+(Re?-1:1)*J*J*ce*ce)/(2*(Re?ue:ne)*J*ce);return Math.log(Math.sqrt(Fe*Fe+1)-Fe)}function ie(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ge(Re){return(Math.exp(Re)+Math.exp(-Re))/2}let Ce=re(0),ae=function(Re){return ge(Ce)/ge(Ce+te*Re)},Se=function(Re){return ne*((ge(Ce)*(ie(Fe=Ce+te*Re)/ge(Fe))-ie(Ce))/J)/ce;var Fe},Me=(re(1)-Ce)/te;if(Math.abs(ce)<1e-6||!isFinite(Me)){if(Math.abs(ne-ue)<1e-6)return this.easeTo(s,h);let Re=ue<ne?-1:1;Me=Math.abs(Math.log(ue/ne))/te,Se=function(){return 0},ae=function(Fe){return Math.exp(Re*te*Fe)}}s.duration="duration"in s?+s.duration:1e3*Me/("screenSpeed"in s?+s.screenSpeed/te:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);let $e=x!==P,Ge=k!==E,Ve=!g.isPaddingEqual(N),xe=Re=>Fe=>{let ot=Fe*Me,ct=1/ae(ot);Re.zoom=Fe===1?M:v+Re.scaleZoom(ct),$e&&(Re.bearing=r.a2(x,P,Fe)),Ge&&(Re.pitch=r.a2(E,k,Fe)),Ve&&(Re.interpolatePadding(C,N,Fe),G=Re.centerPoint.add(V));let at=Fe===1?q:Re.unproject(W.add(ee.mult(Se(ot))).mult(ct));return Re.setLocationAtPoint(Re.renderWorldCopies?at.wrap():at,G),Re._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),Re};if(s.preloadOnly){let Re=this._emulate(xe,s.duration,g);return this._preloadTiles(Re),this}return this._zooming=!0,this._rotating=$e,this._pitching=Ge,this._padding=Ve,this._prepareEase(h,!1),this._ease(xe(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){let g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=r.e.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let s=Math.min((r.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=r.au(s,-180,180);let g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&r.e.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,g){let v=Math.ceil(15*h/1e3),x=[],E=s(g.clone());for(let C=0;C<=v;C++){let M=E(C/v);x.push(M.clone())}return x}_preloadTiles(s,h){}}class cy{constructor(s={}){this.options=s,r.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){let h=this.options&&this.options.compact;return this._map=s,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=$("button","mapboxgl-ctrl-attrib-button",this._container),$("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){let g=this._map._getUIString(`AttributionControl.${h}`);s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d8.ACCESS_TOKEN}];if(s){let g=h.reduce((v,x,E)=>(x.value&&(v+=`${x.key}=${x.value}${E<h.length-1?"&":""}`),v),"?");s.href=`${r.d8.FEEDBACK_URL}/${g}#${Su(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._mergedSourceCaches;for(let v in h){let x=h[v];if(x.used){let E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((v,x)=>v.length-x.length),s=s.filter((v,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));let g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class uy{constructor(){r.bp(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=$("div","mapboxgl-ctrl");let h=$("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(let h in s){let g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let s=this._container.children;if(s.length){let h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class hy{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){let h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){let h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(let v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function dy(p,s,h){if(p=new r.aI(p.lng,p.lat),s){let g=new r.aI(p.lng-360,p.lat),v=new r.aI(p.lng+360,p.lat),x=360*Math.ceil(Math.abs(p.lng-h.center.lng)/360),E=h.locationPoint(p).distSqr(s),C=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(g).distSqr(s)<E&&(C||Math.abs(g.lng-h.center.lng)<x)?p=g:h.locationPoint(v).distSqr(s)<E&&(C||Math.abs(v.lng-h.center.lng)<x)&&(p=v)}for(;Math.abs(p.lng-h.center.lng)>180;){let g=h.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;p.lng>h.center.lng?p.lng-=360:p.lng+=360}return p}let cm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Lu extends r.E{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=r.W({element:s},h)),r.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=r.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=$("div");let x=41,E=27,C=Q("svg",{display:"block",height:x*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${x}`},this._element),M=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},C));Q("stop",{offset:"10%","stop-opacity":.4},M),Q("stop",{offset:"100%","stop-opacity":.05},M),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=r.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in cm)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=s&&s.className?s.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){let s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=r.aI.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){let h=s.code,g=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){let h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let s=this._map,h=this._pos;if(!s||!h)return!1;let g=s.unproject(h),v=s.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let s=this._map;if(!s)return;let h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();let g=s.unproject(h),v;s._showingGlobe()&&r.d9(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let s=this._pos;if(!s||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${cm[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||g!=="map")return"";if(!h._showingGlobe()){let M=h.getPitch();return M?`rotateX(${M}deg)`:""}let v=r.b0(r.da(h.transform,this._lngLat)),x=s.sub(r.db(h.transform)),E=Math.abs(x.x)+Math.abs(x.y);if(E===0)return"";let C=v/E;return`rotateX(${-x.y*C}deg) rotateY(${x.x*C}deg)`}_calculateZTransform(){let s=this._pos,h=this._map;if(!h||!s)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new r.aI(this._lngLat.lng,this._lngLat.lat+.001)),E=h.project(new r.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=r.b0(Math.atan2(E.y,E.x))-90}else g=-h.getBearing();else if(v==="horizon"){let x=r.$(4,6,h.getZoom()),E=r.db(h.transform);E.y+=x*h.transform.height;let C=s.sub(E),M=r.b0(Math.atan2(C.y,C.x));g=(M>90?M-270:M+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=dy(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=r.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){let h=this._map;if(!h)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<x)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.f("dragstart"))),this.fire(new r.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.f("dragend")),this._state="inactive"}_addDragHandler(s){let h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;let h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let um={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},fy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ua(p=new r.P(0,0),s="bottom"){if(typeof p=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new r.P(0,p);case"top-left":return new r.P(h,h);case"top-right":return new r.P(-h,h);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(h,-h);case"bottom-right":return new r.P(-h,-h);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[s]||[0,0])}class py{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;let h=r.b9((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}let my={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class gy{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let hm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},$a={showCompass:!0,showZoom:!0,visualizePitch:!1};class _y{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new tm({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Va({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),r.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),Ie()}move(s,h){let g=this.map,v=this.mouseRotate.mousemoveWindow(s,h),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let E=this.mousePitch.mousemoveWindow(s,h),C=E&&E.pitchDelta;C&&g.setPitch(g.getPitch()+C)}}off(){let s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Qe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(r.W({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),ft(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,ft(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ue(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ue(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Ga={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},yy={maxWidth:100,unit:"metric"},Cd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dt,supported:I,setRTLTextPlugin:r.dv,getRTLTextPluginStatus:r.dw,Map:class extends R1{constructor(p){r.dc.mark(r.dd.create);let s=p;if((p=r.W({},hm,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.de(window)&&(p.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new jo(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new hy,this._domRenderTaskQueue=new hy,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.df(),this._locale=r.W({},my,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new py(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new r.dg(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?xt({},p.contextCreateOptions):{},typeof p.container=="string"){let h=document.getElementById(p.container);if(!h)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=h}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),r.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new gy),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ly(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.d8.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new A1(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});let h=p.bounds;h&&(this.resize(),this.fitBounds(h,r.W({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new cy({customAttribution:p.customAttribution})),this._logoControl=new uy,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new r.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new r.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=p.onAdd(this);this._controls.push(p);let g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let s=!this._moving;return s&&this.fire(new r.f("movestart",p)).fire(new r.f("move",p)),this.fire(new r.f("resize",p)),s&&this.fire(new r.f("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.ai.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(s=>s==="auto"?navigator.language:s):p}setLanguage(p){let s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let p=this.transform,s=p.projection.name,h;s==="globe"&&p.zoom>=r.aU?(p.setMercatorFromTransition(),h=!0):s==="mercator"&&p.zoom<r.aU&&(p.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;return s=p.name==="globe"&&this.transform.zoom>=r.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(r.aI.convert(p))}unproject(p){return this.transform.pointLocation3D(r.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,h){if(p==="mouseenter"||p==="mouseover"){let g=!1,v=E=>{let C=s.filter(P=>this.getLayer(P)),M=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];M.length?g||(g=!0,h.call(this,new Qr(p,this,E.originalEvent,{features:M}))):g=!1},x=()=>{g=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}if(p==="mouseleave"||p==="mouseout"){let g=!1,v=E=>{let C=s.filter(M=>this.getLayer(M));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?g=!0:g&&(g=!1,h.call(this,new Qr(p,this,E.originalEvent)))},x=E=>{g&&(g=!1,h.call(this,new Qr(p,this,E.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=s.filter(C=>this.getLayer(C)),E=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];E.length&&(v.features=E,h.call(this,v),delete v.features)};return{layers:new Set(s),listener:h,delegates:{[p]:g}}}}on(p,s,h){if(typeof s=="function"||h===void 0)return super.on(p,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(p,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(p,s,h){if(typeof s=="function"||h===void 0)return super.once(p,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(p,s,h);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(p,s,h){if(typeof s=="function"||h===void 0)return super.off(p,s);let g=new Set(Array.isArray(s)?s:[s]);for(let E of g)if(!this._isValidId(E))return this;let v=(E,C)=>{if(E.size!==C.size)return!1;for(let M of E)if(!C.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(E=>{for(let C=0;C<E.length;C++){let M=E[C];if(M.listener===h&&v(M.layers,g)){for(let P in M.delegates)this.off(P,M.delegates[P]);return E.splice(C,1),this}}})(x),this}queryRenderedFeatures(p,s){if(!this.style)return[];if(s!==void 0||p===void 0||p instanceof r.P||Array.isArray(p)||(s=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(s=s||{}).layers&&Array.isArray(s.layers)){for(let h of s.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(p,s,this.transform)}querySourceFeatures(p,s){return this._isValidId(p)?this.style.querySourceFeatures(p,s):[]}isPointOnSurface(p){let{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&r.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}setStyle(p,s){return s=r.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&p&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(p,(h,g)=>{h?(r.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(p,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){let s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){let h=r.W({},s);s&&s.config&&(h.initialConfig=s.config,delete h.config),this.style=new To(this,h).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new To(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.d(new Error("IDs can't be empty."))),!1):!r.cV(p)||(this.fire(new r.d(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,s){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,h)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,s,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){let{width:C,height:M,data:P}=r.e.getImageData(s);this.style.addImage(p,{data:new r.i({width:C,height:M},P),pixelRatio:h,stretchX:v,stretchY:x,content:E,sdf:g,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new r.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:C,height:M}=s,P=s;this.style.addImage(p,{data:new r.i({width:C,height:M},new Uint8Array(P.data)),pixelRatio:h,stretchX:v,stretchY:x,content:E,sdf:g,version:0,userImage:P}),P.onAdd&&P.onAdd(this,p)}}updateImage(p,s){this._lazyInitEmptyStyle();let h=this.style.getImage(p);if(!h)return void this.fire(new r.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?r.e.getImageData(s):s,{width:v,height:x,data:E}=g;if(v===void 0||x===void 0)return void this.fire(new r.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||x!==h.data.height)return void this.fire(new r.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let C=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);h.data.replace(E,C),this.style.updateImage(p,h)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new r.d(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,s){r.h(this._requestManager.transformRequest(p,r.R.Image),(h,g)=>{s(h,g instanceof HTMLImageElement?r.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(p,s){this._lazyInitEmptyStyle(),this.style.addModel(p,s)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.d(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,s){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)):this}getSlot(p){let s=this.getLayer(p);return s&&s.slot||null}setSlot(p,s){return this.style.setSlot(p,s),this.style.mergeLayers(),this._update(!0)}addImport(p,s){return this.style.addImport(p,s),this}updateImport(p,s){return typeof s!="string"&&s.id!==p?(this.removeImport(p),this.addImport(s)):(this.style.updateImport(p,s),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,s){return this.style.moveImport(p,s),this._update(!0)}moveLayer(p,s){return this._isValidId(p)?(this.style.moveLayer(p,s),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){return this._isValidId(p)?this.style.getOwnLayer(p):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,s,h){return this._isValidId(p)?(this.style.setLayerZoomRange(p,s,h),this._update(!0)):this}setFilter(p,s,h={}){return this._isValidId(p)?(this.style.setFilter(p,s,h),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,s,h,g={}){return this._isValidId(p)?(this.style.setPaintProperty(p,s,h,g),this._update(!0)):this}getPaintProperty(p,s){return this._isValidId(p)?this.style.getPaintProperty(p,s):null}setLayoutProperty(p,s,h,g={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,s,h,g),this._update(!0)):this}getLayoutProperty(p,s){return this._isValidId(p)?this.style.getLayoutProperty(p,s):null}getSchema(p){return this.style.getSchema(p)}setSchema(p,s){return this.style.setSchema(p,s),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,s){return this.style.setConfig(p,s),this._update(!0)}getConfigProperty(p,s){return this.style.getConfigProperty(p,s)}setConfigProperty(p,s,h){return this.style.setConfigProperty(p,s,h),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){let s=p[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aI.convert(p),this.transform):0}setFeatureState(p,s){return this._isValidId(p.source)?(this.style.setFeatureState(p,s),this._update()):this}removeFeatureState(p,s){return this._isValidId(p.source)?(this.style.removeFeatureState(p,s),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;let p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300,h,g,v,x=this._container;for(;x&&(!g||!v);){let E=window.getComputedStyle(x).transform;E&&E!=="none"&&(h=E.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=$("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();let s=this._canvasContainer=$("div","mapboxgl-canvas-container",p);this._canvas=$("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=$("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=$("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){let h=r.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(p),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){let s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){let s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){let p=r.W({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",p);s?(r.dh(s,!0),this.painter=new G_(s,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.di.testSupport(s)):this.fire(new r.d(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.f("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new r.f("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;this.fire(new r.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,g=r.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let P=this.transform.zoom,k=this.transform.pitch,N=r.e.now(),B=new r.X(P,{now:N,fadeDuration:x,pitch:k,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g);let C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(C&&(this._placementDirty=C.needsRerender,this._occlusionOpacityChanged=C.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.dc.mark(r.dd.load),this.fire(new r.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){let P=r.e.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let k=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new r.f("gpu-timing-frame",{cpuTime:P,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){let P=this.painter.collectGpuTimers();setTimeout(()=>{let k=this.painter.queryGpuTimers(P);this.fire(new r.f("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){let P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let k=this.painter.queryGpuTimeDeferredRender(P);this.fire(new r.f("gpu-timing-deferred-render",{gpuTime:k}))},50)}let M=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||E;if((this._sourcesDirty||this._styleDirty||E||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),M||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let P=!this.isMoving()&&this.loaded();if(P&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new r.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let k=this._calculateSpeedIndex();this.fire(new r.f("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!M&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,r.dc.mark(r.dd.fullLoad),this._performanceMetricsCollection&&r.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(let s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(let s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){let h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;let E=Math.abs(v-x);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,p,300)}else if(E>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(p)&&h(this._averageElevation.getValue(p))}_authenticate(){r.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===r.dl||p.status===401)){let s=this.painter.context.gl;r.dh(s,!1),this._logoControl instanceof uy&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){let p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());let h=this.painter.context.gl,g=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(p),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(p,s,h){let g=h[1]-h[0],v=p.length/4;for(let x=0;x<s.length;x++){let E=s[x],C=0;for(let M=0;M<E.length;M+=4)E[M]===p[M]&&E[M+1]===p[M+1]&&E[M+2]===p[M+2]&&E[M+3]===p[M+3]&&(C+=1);g+=(h[x+2]-h[x+1])*(1-C/v)}return g}remove(){this._hash&&this._hash.remove();for(let s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dp(this.painter.context.gl),r.dq.remove(),r.dr.remove(),this._removed=!0,this.fire(new r.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.e.frame(s=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(p){let s=this.style?this.style.getSourceCaches():[];return r.ds(s,(h,g)=>h._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,s){r.du(p,s)}_occlusionCriteriaSatisfied(){let p=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&p&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return r.dt}},NavigationControl:class{constructor(p){this.options=r.W({},$a,p),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(r.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),$("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),$("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=$("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let p=this._map;if(!p)return;let s=p.getZoom(),h=s===p.getMaxZoom(),g=s===p.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let p=this._map;if(!p)return;let s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _y(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){let p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){let h=$("button",p,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(p,s){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",h),p.firstElementChild&&p.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends r.E{constructor(p){super();let s=navigator.geolocation;this.options=r.W({geolocation:s},Ga,p),r.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){let s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,p(h)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){let s=this._map.getMaxBounds(),h=p.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.f("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("geolocate",p)),this._finish()}}_updateCamera(p){let s=new r.aI(p.coords.longitude,p.coords.latitude),h=p.coords.accuracy,g=this._map.getBearing(),v=r.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),v,{geolocateSource:!0})}_updateMarker(p){if(p){let s=new r.aI(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let p=this._map.transform,s=r.ax(1,p._center.lat)*p.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=$("button","mapboxgl-ctrl-geolocate",this._container),$("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{let s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$("div","mapboxgl-user-location"),this._dotElement.appendChild($("div","mapboxgl-user-location-dot")),this._dotElement.appendChild($("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Lu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=$("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.f("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:cy,ScaleControl:class{constructor(p){this.options=r.W({},yy,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let p=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-p/2,v=s.unproject([g,h]),x=s.unproject([g+p,h]),E=v.distanceTo(x);if(this.options.unit==="imperial"){let C=3.2808*E;C>5280?this._setScale(p,C/5280,"mile"):this._setScale(p,C,"foot")}else this.options.unit==="nautical"?this._setScale(p,E/1852,"nautical-mile"):E>=1e3?this._setScale(p,E/1e3,"kilometer"):this._setScale(p,E,"meter")}_setScale(p,s,h){this._map._requestDomTask(()=>{let g=function(x){let E=Math.pow(10,`${Math.floor(x)}`.length-1),C=x/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){let P=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*P)/P}(C),E*C}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${Cd[h]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.w("Full screen control 'container' must be a DOM element.")),r.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let p=this._fullscreenButton=$("button","mapboxgl-ctrl-fullscreen",this._controlContainer);$("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(p){super(),this.options=r.W(Object.create(um),p),r.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.f("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.aI.convert(p),this._pos=null,this._trackPointer=!1,this._update();let s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){let s=document.createDocumentFragment(),h=document.createElement("body"),g;for(h.innerHTML=p;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=$("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){let h=this._closeButton=$("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;let s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,E=g.x<v/2,C=g.x>s.transform.width-v/2;if(g.y+p<x)return E?"top-left":C?"top-right":"top";if(g.y>s.transform.height-x){if(E)return"bottom-left";if(C)return"bottom-right"}return E?"left":C?"right":"bottom"}_updateClassList(){let p=this._container;if(!p)return;let s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){let s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=$("div","mapboxgl-popup",s.getContainer()),this._tip=$("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=dy(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){let v=this._pos=this._trackPointer&&p?p:s.project(this._lngLat),x=Ua(this.options.offset),E=this._anchor=this._getAnchor(x.y),C=Ua(this.options.offset,E),M=v.add(C).round();s._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${cm[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&s._showingGlobe()){let v=r.d9(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let p=this._container.querySelector(fy);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Lu,Style:To,LngLat:r.aI,LngLatBounds:r.ai,Point:r.P,MercatorCoordinate:r.Y,FreeCameraOptions:gp,Evented:r.E,config:r.d8,prewarm:r.dx,clearPrewarmedResources:r.dy,get accessToken(){return r.d8.ACCESS_TOKEN},set accessToken(p){r.d8.ACCESS_TOKEN=p},get baseApiUrl(){return r.d8.API_URL},set baseApiUrl(p){r.d8.API_URL=p},get workerCount(){return r.dz.workerCount},set workerCount(p){r.dz.workerCount=p},get maxParallelImageRequests(){return r.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.d8.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.dA(p)},get workerUrl(){return r.dB.workerUrl},set workerUrl(p){r.dB.workerUrl=p},get workerClass(){return r.dB.workerClass},set workerClass(p){r.dB.workerClass=p},get workerParams(){return r.dB.workerParams},set workerParams(p){r.dB.workerParams=p},get dracoUrl(){return r.dC()},set dracoUrl(p){r.dD(p)},get meshoptUrl(){return r.dE()},set meshoptUrl(p){r.dF(p)},setNow:r.e.setNow,restoreNow:r.e.restoreNow}});var m=l;return m})});var S2=null;var Tw=1,I2=Symbol("SIGNAL");function sr(o){let i=S2;return S2=o,i}var D2={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function O5(o){if(!(Iw(o)&&!o.dirty)&&!(!o.dirty&&o.lastCleanEpoch===Tw)){if(!o.producerMustRecompute(o)&&!Cw(o)){o.dirty=!1,o.lastCleanEpoch=Tw;return}o.producerRecomputeValue(o),o.dirty=!1,o.lastCleanEpoch=Tw}}function M2(o){return o&&(o.nextProducerIndex=0),sr(o)}function A2(o,i){if(sr(i),!(!o||o.producerNode===void 0||o.producerIndexOfThis===void 0||o.producerLastReadVersion===void 0)){if(Iw(o))for(let l=o.nextProducerIndex;l<o.producerNode.length;l++)Sw(o.producerNode[l],o.producerIndexOfThis[l]);for(;o.producerNode.length>o.nextProducerIndex;)o.producerNode.pop(),o.producerLastReadVersion.pop(),o.producerIndexOfThis.pop()}}function Cw(o){S0(o);for(let i=0;i<o.producerNode.length;i++){let l=o.producerNode[i],u=o.producerLastReadVersion[i];if(u!==l.version||(O5(l),u!==l.version))return!0}return!1}function P2(o){if(S0(o),Iw(o))for(let i=0;i<o.producerNode.length;i++)Sw(o.producerNode[i],o.producerIndexOfThis[i]);o.producerNode.length=o.producerLastReadVersion.length=o.producerIndexOfThis.length=0,o.liveConsumerNode&&(o.liveConsumerNode.length=o.liveConsumerIndexOfThis.length=0)}function Sw(o,i){if(k5(o),S0(o),o.liveConsumerNode.length===1)for(let u=0;u<o.producerNode.length;u++)Sw(o.producerNode[u],o.producerIndexOfThis[u]);let l=o.liveConsumerNode.length-1;if(o.liveConsumerNode[i]=o.liveConsumerNode[l],o.liveConsumerIndexOfThis[i]=o.liveConsumerIndexOfThis[l],o.liveConsumerNode.length--,o.liveConsumerIndexOfThis.length--,i<o.liveConsumerNode.length){let u=o.liveConsumerIndexOfThis[i],m=o.liveConsumerNode[i];S0(m),m.producerIndexOfThis[u]=i}}function Iw(o){return o.consumerIsAlwaysLive||(o?.liveConsumerNode?.length??0)>0}function S0(o){o.producerNode??=[],o.producerIndexOfThis??=[],o.producerLastReadVersion??=[]}function k5(o){o.liveConsumerNode??=[],o.liveConsumerIndexOfThis??=[]}function L5(){throw new Error}var F5=L5;function R2(o){F5=o}function Dn(o){return typeof o=="function"}function ef(o){let l=o(u=>{Error.call(u),u.stack=new Error().stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}var I0=ef(o=>function(l){o(this),this.message=l?`${l.length} errors occurred during unsubscription:
${l.map((u,m)=>`${m+1}) ${u.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=l});function Ym(o,i){if(o){let l=o.indexOf(i);0<=l&&o.splice(l,1)}}var fi=class o{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;let{_parentage:l}=this;if(l)if(this._parentage=null,Array.isArray(l))for(let r of l)r.remove(this);else l.remove(this);let{initialTeardown:u}=this;if(Dn(u))try{u()}catch(r){i=r instanceof I0?r.errors:[r]}let{_finalizers:m}=this;if(m){this._finalizers=null;for(let r of m)try{O2(r)}catch(w){i=i??[],w instanceof I0?i=[...i,...w.errors]:i.push(w)}}if(i)throw new I0(i)}}add(i){var l;if(i&&i!==this)if(this.closed)O2(i);else{if(i instanceof o){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=(l=this._finalizers)!==null&&l!==void 0?l:[]).push(i)}}_hasParent(i){let{_parentage:l}=this;return l===i||Array.isArray(l)&&l.includes(i)}_addParent(i){let{_parentage:l}=this;this._parentage=Array.isArray(l)?(l.push(i),l):l?[l,i]:i}_removeParent(i){let{_parentage:l}=this;l===i?this._parentage=null:Array.isArray(l)&&Ym(l,i)}remove(i){let{_finalizers:l}=this;l&&Ym(l,i),i instanceof o&&i._removeParent(this)}};fi.EMPTY=(()=>{let o=new fi;return o.closed=!0,o})();var Dw=fi.EMPTY;function D0(o){return o instanceof fi||o&&"closed"in o&&Dn(o.remove)&&Dn(o.add)&&Dn(o.unsubscribe)}function O2(o){Dn(o)?o():o.unsubscribe()}var Es={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var tf={setTimeout(o,i,...l){let{delegate:u}=tf;return u?.setTimeout?u.setTimeout(o,i,...l):setTimeout(o,i,...l)},clearTimeout(o){let{delegate:i}=tf;return(i?.clearTimeout||clearTimeout)(o)},delegate:void 0};function M0(o){tf.setTimeout(()=>{let{onUnhandledError:i}=Es;if(i)i(o);else throw o})}function Km(){}var k2=Mw("C",void 0,void 0);function L2(o){return Mw("E",void 0,o)}function F2(o){return Mw("N",o,void 0)}function Mw(o,i,l){return{kind:o,value:i,error:l}}var Ju=null;function nf(o){if(Es.useDeprecatedSynchronousErrorHandling){let i=!Ju;if(i&&(Ju={errorThrown:!1,error:null}),o(),i){let{errorThrown:l,error:u}=Ju;if(Ju=null,l)throw u}}else o()}function N2(o){Es.useDeprecatedSynchronousErrorHandling&&Ju&&(Ju.errorThrown=!0,Ju.error=o)}var eh=class extends fi{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,D0(i)&&i.add(this)):this.destination=B5}static create(i,l,u){return new tl(i,l,u)}next(i){this.isStopped?Pw(F2(i),this):this._next(i)}error(i){this.isStopped?Pw(L2(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?Pw(k2,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},N5=Function.prototype.bind;function Aw(o,i){return N5.call(o,i)}var Rw=class{constructor(i){this.partialObserver=i}next(i){let{partialObserver:l}=this;if(l.next)try{l.next(i)}catch(u){A0(u)}}error(i){let{partialObserver:l}=this;if(l.error)try{l.error(i)}catch(u){A0(u)}else A0(i)}complete(){let{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(l){A0(l)}}},tl=class extends eh{constructor(i,l,u){super();let m;if(Dn(i)||!i)m={next:i??void 0,error:l??void 0,complete:u??void 0};else{let r;this&&Es.useDeprecatedNextContext?(r=Object.create(i),r.unsubscribe=()=>this.unsubscribe(),m={next:i.next&&Aw(i.next,r),error:i.error&&Aw(i.error,r),complete:i.complete&&Aw(i.complete,r)}):m=i}this.destination=new Rw(m)}};function A0(o){Es.useDeprecatedSynchronousErrorHandling?N2(o):M0(o)}function z5(o){throw o}function Pw(o,i){let{onStoppedNotification:l}=Es;l&&tf.setTimeout(()=>l(o,i))}var B5={closed:!0,next:Km,error:z5,complete:Km};var rf=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Do(o){return o}function Ow(...o){return kw(o)}function kw(o){return o.length===0?Do:o.length===1?o[0]:function(l){return o.reduce((u,m)=>m(u),l)}}var ar=(()=>{class o{constructor(l){l&&(this._subscribe=l)}lift(l){let u=new o;return u.source=this,u.operator=l,u}subscribe(l,u,m){let r=j5(l)?l:new tl(l,u,m);return nf(()=>{let{operator:w,source:I}=this;r.add(w?w.call(r,I):I?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(l){try{return this._subscribe(l)}catch(u){l.error(u)}}forEach(l,u){return u=z2(u),new u((m,r)=>{let w=new tl({next:I=>{try{l(I)}catch(A){r(A),w.unsubscribe()}},error:r,complete:m});this.subscribe(w)})}_subscribe(l){var u;return(u=this.source)===null||u===void 0?void 0:u.subscribe(l)}[rf](){return this}pipe(...l){return kw(l)(this)}toPromise(l){return l=z2(l),new l((u,m)=>{let r;this.subscribe(w=>r=w,w=>m(w),()=>u(r))})}}return o.create=i=>new o(i),o})();function z2(o){var i;return(i=o??Es.Promise)!==null&&i!==void 0?i:Promise}function V5(o){return o&&Dn(o.next)&&Dn(o.error)&&Dn(o.complete)}function j5(o){return o&&o instanceof eh||V5(o)&&D0(o)}function Lw(o){return Dn(o?.lift)}function qn(o){return i=>{if(Lw(i))return i.lift(function(l){try{return o(l,this)}catch(u){this.error(u)}});throw new TypeError("Unable to lift unknown Observable type")}}function Kn(o,i,l,u,m){return new Fw(o,i,l,u,m)}var Fw=class extends eh{constructor(i,l,u,m,r,w){super(i),this.onFinalize=r,this.shouldUnsubscribe=w,this._next=l?function(I){try{l(I)}catch(A){i.error(A)}}:super._next,this._error=m?function(I){try{m(I)}catch(A){i.error(A)}finally{this.unsubscribe()}}:super._error,this._complete=u?function(){try{u()}catch(I){i.error(I)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:l}=this;super.unsubscribe(),!l&&((i=this.onFinalize)===null||i===void 0||i.call(this))}}};function of(){return qn((o,i)=>{let l=null;o._refCount++;let u=Kn(i,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount){l=null;return}let m=o._connection,r=l;l=null,m&&(!r||m===r)&&m.unsubscribe(),i.unsubscribe()});o.subscribe(u),u.closed||(l=o.connect())})}var sf=class extends ar{constructor(i,l){super(),this.source=i,this.subjectFactory=l,this._subject=null,this._refCount=0,this._connection=null,Lw(i)&&(this.lift=i.lift)}_subscribe(i){return this.getSubject().subscribe(i)}getSubject(){let i=this._subject;return(!i||i.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:i}=this;this._subject=this._connection=null,i?.unsubscribe()}connect(){let i=this._connection;if(!i){i=this._connection=new fi;let l=this.getSubject();i.add(this.source.subscribe(Kn(l,void 0,()=>{this._teardown(),l.complete()},u=>{this._teardown(),l.error(u)},()=>this._teardown()))),i.closed&&(this._connection=null,i=fi.EMPTY)}return i}refCount(){return of()(this)}};var B2=ef(o=>function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ai=(()=>{class o extends ar{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(l){let u=new P0(this,this);return u.operator=l,u}_throwIfClosed(){if(this.closed)throw new B2}next(l){nf(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let u of this.currentObservers)u.next(l)}})}error(l){nf(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=l;let{observers:u}=this;for(;u.length;)u.shift().error(l)}})}complete(){nf(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:l}=this;for(;l.length;)l.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var l;return((l=this.observers)===null||l===void 0?void 0:l.length)>0}_trySubscribe(l){return this._throwIfClosed(),super._trySubscribe(l)}_subscribe(l){return this._throwIfClosed(),this._checkFinalizedStatuses(l),this._innerSubscribe(l)}_innerSubscribe(l){let{hasError:u,isStopped:m,observers:r}=this;return u||m?Dw:(this.currentObservers=null,r.push(l),new fi(()=>{this.currentObservers=null,Ym(r,l)}))}_checkFinalizedStatuses(l){let{hasError:u,thrownError:m,isStopped:r}=this;u?l.error(m):r&&l.complete()}asObservable(){let l=new ar;return l.source=this,l}}return o.create=(i,l)=>new P0(i,l),o})(),P0=class extends Ai{constructor(i,l){super(),this.destination=i,this.source=l}next(i){var l,u;(u=(l=this.destination)===null||l===void 0?void 0:l.next)===null||u===void 0||u.call(l,i)}error(i){var l,u;(u=(l=this.destination)===null||l===void 0?void 0:l.error)===null||u===void 0||u.call(l,i)}complete(){var i,l;(l=(i=this.destination)===null||i===void 0?void 0:i.complete)===null||l===void 0||l.call(i)}_subscribe(i){var l,u;return(u=(l=this.source)===null||l===void 0?void 0:l.subscribe(i))!==null&&u!==void 0?u:Dw}};var pi=class extends Ai{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){let l=super._subscribe(i);return!l.closed&&i.next(this._value),l}getValue(){let{hasError:i,thrownError:l,_value:u}=this;if(i)throw l;return this._throwIfClosed(),u}next(i){super.next(this._value=i)}};var Mo=new ar(o=>o.complete());function V2(o){return o&&Dn(o.schedule)}function j2(o){return o[o.length-1]}function U2(o){return Dn(j2(o))?o.pop():void 0}function xc(o){return V2(j2(o))?o.pop():void 0}function G2(o,i,l,u){function m(r){return r instanceof l?r:new l(function(w){w(r)})}return new(l||(l=Promise))(function(r,w){function I($){try{L(u.next($))}catch(Q){w(Q)}}function A($){try{L(u.throw($))}catch(Q){w(Q)}}function L($){$.done?r($.value):m($.value).then(I,A)}L((u=u.apply(o,i||[])).next())})}function $2(o){var i=typeof Symbol=="function"&&Symbol.iterator,l=i&&o[i],u=0;if(l)return l.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&u>=o.length&&(o=void 0),{value:o&&o[u++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function th(o){return this instanceof th?(this.v=o,this):new th(o)}function H2(o,i,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u=l.apply(o,i||[]),m,r=[];return m={},I("next"),I("throw"),I("return",w),m[Symbol.asyncIterator]=function(){return this},m;function w(he){return function(be){return Promise.resolve(be).then(he,Q)}}function I(he,be){u[he]&&(m[he]=function(Ie){return new Promise(function(Qe,ze){r.push([he,Ie,Qe,ze])>1||A(he,Ie)})},be&&(m[he]=be(m[he])))}function A(he,be){try{L(u[he](be))}catch(Ie){me(r[0][3],Ie)}}function L(he){he.value instanceof th?Promise.resolve(he.value.v).then($,Q):me(r[0][2],he)}function $(he){A("next",he)}function Q(he){A("throw",he)}function me(he,be){he(be),r.shift(),r.length&&A(r[0][0],r[0][1])}}function q2(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],l;return i?i.call(o):(o=typeof $2=="function"?$2(o):o[Symbol.iterator](),l={},u("next"),u("throw"),u("return"),l[Symbol.asyncIterator]=function(){return this},l);function u(r){l[r]=o[r]&&function(w){return new Promise(function(I,A){w=o[r](w),m(I,A,w.done,w.value)})}}function m(r,w,I,A){Promise.resolve(A).then(function(L){r({value:L,done:I})},w)}}var R0=o=>o&&typeof o.length=="number"&&typeof o!="function";function O0(o){return Dn(o?.then)}function k0(o){return Dn(o[rf])}function L0(o){return Symbol.asyncIterator&&Dn(o?.[Symbol.asyncIterator])}function F0(o){return new TypeError(`You provided ${o!==null&&typeof o=="object"?"an invalid object":`'${o}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function U5(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var N0=U5();function z0(o){return Dn(o?.[N0])}function B0(o){return H2(this,arguments,function*(){let l=o.getReader();try{for(;;){let{value:u,done:m}=yield th(l.read());if(m)return yield th(void 0);yield yield th(u)}}finally{l.releaseLock()}})}function V0(o){return Dn(o?.getReader)}function $r(o){if(o instanceof ar)return o;if(o!=null){if(k0(o))return $5(o);if(R0(o))return G5(o);if(O0(o))return H5(o);if(L0(o))return W2(o);if(z0(o))return q5(o);if(V0(o))return W5(o)}throw F0(o)}function $5(o){return new ar(i=>{let l=o[rf]();if(Dn(l.subscribe))return l.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function G5(o){return new ar(i=>{for(let l=0;l<o.length&&!i.closed;l++)i.next(o[l]);i.complete()})}function H5(o){return new ar(i=>{o.then(l=>{i.closed||(i.next(l),i.complete())},l=>i.error(l)).then(null,M0)})}function q5(o){return new ar(i=>{for(let l of o)if(i.next(l),i.closed)return;i.complete()})}function W2(o){return new ar(i=>{Z5(o,i).catch(l=>i.error(l))})}function W5(o){return W2(B0(o))}function Z5(o,i){var l,u,m,r;return G2(this,void 0,void 0,function*(){try{for(l=q2(o);u=yield l.next(),!u.done;){let w=u.value;if(i.next(w),i.closed)return}}catch(w){m={error:w}}finally{try{u&&!u.done&&(r=l.return)&&(yield r.call(l))}finally{if(m)throw m.error}}i.complete()})}function ho(o,i,l,u=0,m=!1){let r=i.schedule(function(){l(),m?o.add(this.schedule(null,u)):this.unsubscribe()},u);if(o.add(r),!m)return r}function j0(o,i=0){return qn((l,u)=>{l.subscribe(Kn(u,m=>ho(u,o,()=>u.next(m),i),()=>ho(u,o,()=>u.complete(),i),m=>ho(u,o,()=>u.error(m),i)))})}function U0(o,i=0){return qn((l,u)=>{u.add(o.schedule(()=>l.subscribe(u),i))})}function Z2(o,i){return $r(o).pipe(U0(i),j0(i))}function X2(o,i){return $r(o).pipe(U0(i),j0(i))}function Y2(o,i){return new ar(l=>{let u=0;return i.schedule(function(){u===o.length?l.complete():(l.next(o[u++]),l.closed||this.schedule())})})}function K2(o,i){return new ar(l=>{let u;return ho(l,i,()=>{u=o[N0](),ho(l,i,()=>{let m,r;try{({value:m,done:r}=u.next())}catch(w){l.error(w);return}r?l.complete():l.next(m)},0,!0)}),()=>Dn(u?.return)&&u.return()})}function $0(o,i){if(!o)throw new Error("Iterable cannot be null");return new ar(l=>{ho(l,i,()=>{let u=o[Symbol.asyncIterator]();ho(l,i,()=>{u.next().then(m=>{m.done?l.complete():l.next(m.value)})},0,!0)})})}function Q2(o,i){return $0(B0(o),i)}function J2(o,i){if(o!=null){if(k0(o))return Z2(o,i);if(R0(o))return Y2(o,i);if(O0(o))return X2(o,i);if(L0(o))return $0(o,i);if(z0(o))return K2(o,i);if(V0(o))return Q2(o,i)}throw F0(o)}function Gr(o,i){return i?J2(o,i):$r(o)}function sn(...o){let i=xc(o);return Gr(o,i)}function nl(o,i){let l=Dn(o)?o:()=>o,u=m=>m.error(l());return new ar(i?m=>i.schedule(u,0,m):u)}function Nw(o){return!!o&&(o instanceof ar||Dn(o.lift)&&Dn(o.subscribe))}var rl=ef(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});function On(o,i){return qn((l,u)=>{let m=0;l.subscribe(Kn(u,r=>{u.next(o.call(i,r,m++))}))})}var{isArray:X5}=Array;function Y5(o,i){return X5(i)?o(...i):o(i)}function eA(o){return On(i=>Y5(o,i))}var{isArray:K5}=Array,{getPrototypeOf:Q5,prototype:J5,keys:e4}=Object;function tA(o){if(o.length===1){let i=o[0];if(K5(i))return{args:i,keys:null};if(t4(i)){let l=e4(i);return{args:l.map(u=>i[u]),keys:l}}}return{args:o,keys:null}}function t4(o){return o&&typeof o=="object"&&Q5(o)===J5}function nA(o,i){return o.reduce((l,u,m)=>(l[u]=i[m],l),{})}function Qm(...o){let i=xc(o),l=U2(o),{args:u,keys:m}=tA(o);if(u.length===0)return Gr([],i);let r=new ar(n4(u,i,m?w=>nA(m,w):Do));return l?r.pipe(eA(l)):r}function n4(o,i,l=Do){return u=>{rA(i,()=>{let{length:m}=o,r=new Array(m),w=m,I=m;for(let A=0;A<m;A++)rA(i,()=>{let L=Gr(o[A],i),$=!1;L.subscribe(Kn(u,Q=>{r[A]=Q,$||($=!0,I--),I||u.next(l(r.slice()))},()=>{--w||u.complete()}))},u)},u)}}function rA(o,i,l){o?ho(l,o,i):i()}function iA(o,i,l,u,m,r,w,I){let A=[],L=0,$=0,Q=!1,me=()=>{Q&&!A.length&&!L&&i.complete()},he=Ie=>L<u?be(Ie):A.push(Ie),be=Ie=>{r&&i.next(Ie),L++;let Qe=!1;$r(l(Ie,$++)).subscribe(Kn(i,ze=>{m?.(ze),r?he(ze):i.next(ze)},()=>{Qe=!0},void 0,()=>{if(Qe)try{for(L--;A.length&&L<u;){let ze=A.shift();w?ho(i,w,()=>be(ze)):be(ze)}me()}catch(ze){i.error(ze)}}))};return o.subscribe(Kn(i,he,()=>{Q=!0,me()})),()=>{I?.()}}function mi(o,i,l=1/0){return Dn(i)?mi((u,m)=>On((r,w)=>i(u,r,m,w))($r(o(u,m))),l):(typeof i=="number"&&(l=i),qn((u,m)=>iA(u,m,o,l)))}function zw(o=1/0){return mi(Do,o)}function oA(){return zw(1)}function af(...o){return oA()(Gr(o,xc(o)))}function G0(o){return new ar(i=>{$r(o()).subscribe(i)})}function Ao(o,i){return qn((l,u)=>{let m=0;l.subscribe(Kn(u,r=>o.call(i,r,m++)&&u.next(r)))})}function ra(o){return qn((i,l)=>{let u=null,m=!1,r;u=i.subscribe(Kn(l,void 0,void 0,w=>{r=$r(o(w,ra(o)(i))),u?(u.unsubscribe(),u=null,r.subscribe(l)):m=!0})),m&&(u.unsubscribe(),u=null,r.subscribe(l))})}function sA(o,i,l,u,m){return(r,w)=>{let I=l,A=i,L=0;r.subscribe(Kn(w,$=>{let Q=L++;A=I?o(A,$,Q):(I=!0,$),u&&w.next(A)},m&&(()=>{I&&w.next(A),w.complete()})))}}function bc(o,i){return Dn(i)?mi(o,i,1):mi(o,1)}function wc(o){return qn((i,l)=>{let u=!1;i.subscribe(Kn(l,m=>{u=!0,l.next(m)},()=>{u||l.next(o),l.complete()}))})}function il(o){return o<=0?()=>Mo:qn((i,l)=>{let u=0;i.subscribe(Kn(l,m=>{++u<=o&&(l.next(m),o<=u&&l.complete())}))})}function Bw(o){return On(()=>o)}function H0(o=r4){return qn((i,l)=>{let u=!1;i.subscribe(Kn(l,m=>{u=!0,l.next(m)},()=>u?l.complete():l.error(o())))})}function r4(){return new rl}function ia(o){return qn((i,l)=>{try{i.subscribe(l)}finally{l.add(o)}})}function oa(o,i){let l=arguments.length>=2;return u=>u.pipe(o?Ao((m,r)=>o(m,r,u)):Do,il(1),l?wc(i):H0(()=>new rl))}function lf(o){return o<=0?()=>Mo:qn((i,l)=>{let u=[];i.subscribe(Kn(l,m=>{u.push(m),o<u.length&&u.shift()},()=>{for(let m of u)l.next(m);l.complete()},void 0,()=>{u=null}))})}function Vw(o,i){let l=arguments.length>=2;return u=>u.pipe(o?Ao((m,r)=>o(m,r,u)):Do,lf(1),l?wc(i):H0(()=>new rl))}function jw(o,i){return qn(sA(o,i,arguments.length>=2,!0))}function $w(o={}){let{connector:i=()=>new Ai,resetOnError:l=!0,resetOnComplete:u=!0,resetOnRefCountZero:m=!0}=o;return r=>{let w,I,A,L=0,$=!1,Q=!1,me=()=>{I?.unsubscribe(),I=void 0},he=()=>{me(),w=A=void 0,$=Q=!1},be=()=>{let Ie=w;he(),Ie?.unsubscribe()};return qn((Ie,Qe)=>{L++,!Q&&!$&&me();let ze=A=A??i();Qe.add(()=>{L--,L===0&&!Q&&!$&&(I=Uw(be,m))}),ze.subscribe(Qe),!w&&L>0&&(w=new tl({next:nt=>ze.next(nt),error:nt=>{Q=!0,me(),I=Uw(he,l,nt),ze.error(nt)},complete:()=>{$=!0,me(),I=Uw(he,u),ze.complete()}}),$r(Ie).subscribe(w))})(r)}}function Uw(o,i,...l){if(i===!0){o();return}if(i===!1)return;let u=new tl({next:()=>{u.unsubscribe(),o()}});return $r(i(...l)).subscribe(u)}function Gw(...o){let i=xc(o);return qn((l,u)=>{(i?af(o,l,i):af(o,l)).subscribe(u)})}function fo(o,i){return qn((l,u)=>{let m=null,r=0,w=!1,I=()=>w&&!m&&u.complete();l.subscribe(Kn(u,A=>{m?.unsubscribe();let L=0,$=r++;$r(o(A,$)).subscribe(m=Kn(u,Q=>u.next(i?i(A,Q,$,L++):Q),()=>{m=null,I()}))},()=>{w=!0,I()}))})}function Hw(o){return qn((i,l)=>{$r(o).subscribe(Kn(l,()=>l.complete(),Km)),!l.closed&&i.subscribe(l)})}function ni(o,i,l){let u=Dn(o)||i||l?{next:o,error:i,complete:l}:o;return u?qn((m,r)=>{var w;(w=u.subscribe)===null||w===void 0||w.call(u);let I=!0;m.subscribe(Kn(r,A=>{var L;(L=u.next)===null||L===void 0||L.call(u,A),r.next(A)},()=>{var A;I=!1,(A=u.complete)===null||A===void 0||A.call(u),r.complete()},A=>{var L;I=!1,(L=u.error)===null||L===void 0||L.call(u,A),r.error(A)},()=>{var A,L;I&&((A=u.unsubscribe)===null||A===void 0||A.call(u)),(L=u.finalize)===null||L===void 0||L.call(u)}))}):Do}var i4="https://g.co/ng/security#xss",vt=class extends Error{constructor(i,l){super(yv(i,l)),this.code=i}};function yv(o,i){return`${`NG0${Math.abs(o)}`}${i?": "+i:""}`}function hg(o){return{toString:o}.toString()}var q0="__parameters__";function o4(o){return function(...l){if(o){let u=o(...l);for(let m in u)this[m]=u[m]}}}function HA(o,i,l){return hg(()=>{let u=o4(i);function m(...r){if(this instanceof m)return u.apply(this,r),this;let w=new m(...r);return I.annotation=w,I;function I(A,L,$){let Q=A.hasOwnProperty(q0)?A[q0]:Object.defineProperty(A,q0,{value:[]})[q0];for(;Q.length<=$;)Q.push(null);return(Q[$]=Q[$]||[]).push(w),A}}return l&&(m.prototype=Object.create(l.prototype)),m.prototype.ngMetadataName=o,m.annotationCls=m,m})}var Jm=globalThis;function xr(o){for(let i in o)if(o[i]===xr)return i;throw Error("Could not find renamed property on target object.")}function Xi(o){if(typeof o=="string")return o;if(Array.isArray(o))return"["+o.map(Xi).join(", ")+"]";if(o==null)return""+o;if(o.overriddenName)return`${o.overriddenName}`;if(o.name)return`${o.name}`;let i=o.toString();if(i==null)return""+i;let l=i.indexOf(`
`);return l===-1?i:i.substring(0,l)}function aA(o,i){return o==null||o===""?i===null?"":i:i==null||i===""?o:o+" "+i}var s4=xr({__forward_ref__:xr});function qA(o){return o.__forward_ref__=qA,o.toString=function(){return Xi(this())},o}function Zi(o){return WA(o)?o():o}function WA(o){return typeof o=="function"&&o.hasOwnProperty(s4)&&o.__forward_ref__===qA}function Gt(o){return{token:o.token,providedIn:o.providedIn||null,factory:o.factory,value:void 0}}function Dc(o){return{providers:o.providers||[],imports:o.imports||[]}}function vv(o){return lA(o,XA)||lA(o,YA)}function ZA(o){return vv(o)!==null}function lA(o,i){return o.hasOwnProperty(i)?o[i]:null}function a4(o){let i=o&&(o[XA]||o[YA]);return i||null}function cA(o){return o&&(o.hasOwnProperty(uA)||o.hasOwnProperty(l4))?o[uA]:null}var XA=xr({\u0275prov:xr}),uA=xr({\u0275inj:xr}),YA=xr({ngInjectableDef:xr}),l4=xr({ngInjectorDef:xr}),mn=class{constructor(i,l){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof l=="number"?this.__NG_ELEMENT_ID__=l:l!==void 0&&(this.\u0275prov=Gt({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function KA(o){return o&&!!o.\u0275providers}var c4=xr({\u0275cmp:xr}),u4=xr({\u0275dir:xr}),h4=xr({\u0275pipe:xr}),d4=xr({\u0275mod:xr}),J0=xr({\u0275fac:xr}),eg=xr({__NG_ELEMENT_ID__:xr}),hA=xr({__NG_ENV_ID__:xr});function tg(o){return typeof o=="string"?o:o==null?"":String(o)}function f4(o){return typeof o=="function"?o.name||o.toString():typeof o=="object"&&o!=null&&typeof o.type=="function"?o.type.name||o.type.toString():tg(o)}function p4(o,i){let l=i?`. Dependency path: ${i.join(" > ")} > ${o}`:"";throw new vt(-200,o)}function QE(o,i){throw new vt(-201,!1)}var Vn=function(o){return o[o.Default=0]="Default",o[o.Host=1]="Host",o[o.Self=2]="Self",o[o.SkipSelf=4]="SkipSelf",o[o.Optional=8]="Optional",o}(Vn||{}),aE;function QA(){return aE}function Qo(o){let i=aE;return aE=o,i}function JA(o,i,l){let u=vv(o);if(u&&u.providedIn=="root")return u.value===void 0?u.value=u.factory():u.value;if(l&Vn.Optional)return null;if(i!==void 0)return i;QE(o,"Injector")}var m4={},ng=m4,lE="__NG_DI_FLAG__",ev="ngTempTokenPath",g4="ngTokenPath",_4=/\n/gm,y4="\u0275",dA="__source",ff;function v4(){return ff}function Ec(o){let i=ff;return ff=o,i}function x4(o,i=Vn.Default){if(ff===void 0)throw new vt(-203,!1);return ff===null?JA(o,void 0,i):ff.get(o,i&Vn.Optional?null:void 0,i)}function dn(o,i=Vn.Default){return(QA()||x4)(Zi(o),i)}function Tt(o,i=Vn.Default){return dn(o,xv(i))}function xv(o){return typeof o>"u"||typeof o=="number"?o:0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)}function cE(o){let i=[];for(let l=0;l<o.length;l++){let u=Zi(o[l]);if(Array.isArray(u)){if(u.length===0)throw new vt(900,!1);let m,r=Vn.Default;for(let w=0;w<u.length;w++){let I=u[w],A=b4(I);typeof A=="number"?A===-1?m=I.token:r|=A:m=I}i.push(dn(m,r))}else i.push(dn(u))}return i}function eP(o,i){return o[lE]=i,o.prototype[lE]=i,o}function b4(o){return o[lE]}function w4(o,i,l,u){let m=o[ev];throw i[dA]&&m.unshift(i[dA]),o.message=E4(`
`+o.message,m,l,u),o[g4]=m,o[ev]=null,o}function E4(o,i,l,u=null){o=o&&o.charAt(0)===`
`&&o.charAt(1)==y4?o.slice(2):o;let m=Xi(i);if(Array.isArray(i))m=i.map(Xi).join(" -> ");else if(typeof i=="object"){let r=[];for(let w in i)if(i.hasOwnProperty(w)){let I=i[w];r.push(w+":"+(typeof I=="string"?JSON.stringify(I):Xi(I)))}m=`{${r.join(", ")}}`}return`${l}${u?"("+u+")":""}[${m}]: ${o.replace(_4,`
  `)}`}var Tf=eP(HA("Optional"),8);var dg=eP(HA("SkipSelf"),4);function mf(o,i){let l=o.hasOwnProperty(J0);return l?o[J0]:null}function JE(o,i){o.forEach(l=>Array.isArray(l)?JE(l,i):i(l))}function tP(o,i,l){i>=o.length?o.push(l):o.splice(i,0,l)}function tv(o,i){return i>=o.length-1?o.pop():o.splice(i,1)[0]}function T4(o,i,l,u){let m=o.length;if(m==i)o.push(l,u);else if(m===1)o.push(u,o[0]),o[0]=l;else{for(m--,o.push(o[m-1],o[m]);m>i;){let r=m-2;o[m]=o[r],m--}o[i]=l,o[i+1]=u}}function C4(o,i,l){let u=fg(o,i);return u>=0?o[u|1]=l:(u=~u,T4(o,u,i,l)),u}function qw(o,i){let l=fg(o,i);if(l>=0)return o[l|1]}function fg(o,i){return S4(o,i,1)}function S4(o,i,l){let u=0,m=o.length>>l;for(;m!==u;){let r=u+(m-u>>1),w=o[r<<l];if(i===w)return r<<l;w>i?m=r:u=r+1}return~(m<<l)}var rg={},Cs=[],gf=new mn(""),nP=new mn("",-1),rP=new mn(""),nv=class{get(i,l=ng){if(l===ng){let u=new Error(`NullInjectorError: No provider for ${Xi(i)}!`);throw u.name="NullInjectorError",u}return l}},iP=function(o){return o[o.OnPush=0]="OnPush",o[o.Default=1]="Default",o}(iP||{}),la=function(o){return o[o.Emulated=0]="Emulated",o[o.None=2]="None",o[o.ShadowDom=3]="ShadowDom",o}(la||{}),ca=function(o){return o[o.None=0]="None",o[o.SignalBased=1]="SignalBased",o[o.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",o}(ca||{});function I4(o,i,l){let u=o.length;for(;;){let m=o.indexOf(i,l);if(m===-1)return m;if(m===0||o.charCodeAt(m-1)<=32){let r=i.length;if(m+r===u||o.charCodeAt(m+r)<=32)return m}l=m+1}}function uE(o,i,l){let u=0;for(;u<l.length;){let m=l[u];if(typeof m=="number"){if(m!==0)break;u++;let r=l[u++],w=l[u++],I=l[u++];o.setAttribute(i,w,I,r)}else{let r=m,w=l[++u];M4(r)?o.setProperty(i,r,w):o.setAttribute(i,r,w),u++}}return u}function D4(o){return o===3||o===4||o===6}function M4(o){return o.charCodeAt(0)===64}function eT(o,i){if(!(i===null||i.length===0))if(o===null||o.length===0)o=i.slice();else{let l=-1;for(let u=0;u<i.length;u++){let m=i[u];typeof m=="number"?l=m:l===0||(l===-1||l===2?fA(o,l,m,null,i[++u]):fA(o,l,m,null,null))}}return o}function fA(o,i,l,u,m){let r=0,w=o.length;if(i===-1)w=-1;else for(;r<o.length;){let I=o[r++];if(typeof I=="number"){if(I===i){w=-1;break}else if(I>i){w=r-1;break}}}for(;r<o.length;){let I=o[r];if(typeof I=="number")break;if(I===l){if(u===null){m!==null&&(o[r+1]=m);return}else if(u===o[r+1]){o[r+2]=m;return}}r++,u!==null&&r++,m!==null&&r++}w!==-1&&(o.splice(w,0,i),r=w+1),o.splice(r++,0,l),u!==null&&o.splice(r++,0,u),m!==null&&o.splice(r++,0,m)}var oP="ng-template";function A4(o,i,l,u){let m=0;if(u){for(;m<i.length&&typeof i[m]=="string";m+=2)if(i[m]==="class"&&I4(i[m+1].toLowerCase(),l,0)!==-1)return!0}else if(tT(o))return!1;if(m=i.indexOf(1,m),m>-1){let r;for(;++m<i.length&&typeof(r=i[m])=="string";)if(r.toLowerCase()===l)return!0}return!1}function tT(o){return o.type===4&&o.value!==oP}function P4(o,i,l){let u=o.type===4&&!l?oP:o.value;return i===u}function R4(o,i,l){let u=4,m=o.attrs,r=m!==null?L4(m):0,w=!1;for(let I=0;I<i.length;I++){let A=i[I];if(typeof A=="number"){if(!w&&!Ts(u)&&!Ts(A))return!1;if(w&&Ts(A))continue;w=!1,u=A|u&1;continue}if(!w)if(u&4){if(u=2|u&1,A!==""&&!P4(o,A,l)||A===""&&i.length===1){if(Ts(u))return!1;w=!0}}else if(u&8){if(m===null||!A4(o,m,A,l)){if(Ts(u))return!1;w=!0}}else{let L=i[++I],$=O4(A,m,tT(o),l);if($===-1){if(Ts(u))return!1;w=!0;continue}if(L!==""){let Q;if($>r?Q="":Q=m[$+1].toLowerCase(),u&2&&L!==Q){if(Ts(u))return!1;w=!0}}}}return Ts(u)||w}function Ts(o){return(o&1)===0}function O4(o,i,l,u){if(i===null)return-1;let m=0;if(u||!l){let r=!1;for(;m<i.length;){let w=i[m];if(w===o)return m;if(w===3||w===6)r=!0;else if(w===1||w===2){let I=i[++m];for(;typeof I=="string";)I=i[++m];continue}else{if(w===4)break;if(w===0){m+=4;continue}}m+=r?1:2}return-1}else return F4(i,o)}function k4(o,i,l=!1){for(let u=0;u<i.length;u++)if(R4(o,i[u],l))return!0;return!1}function L4(o){for(let i=0;i<o.length;i++){let l=o[i];if(D4(l))return i}return o.length}function F4(o,i){let l=o.indexOf(4);if(l>-1)for(l++;l<o.length;){let u=o[l];if(typeof u=="number")return-1;if(u===i)return l;l++}return-1}function pA(o,i){return o?":not("+i.trim()+")":i}function N4(o){let i=o[0],l=1,u=2,m="",r=!1;for(;l<o.length;){let w=o[l];if(typeof w=="string")if(u&2){let I=o[++l];m+="["+w+(I.length>0?'="'+I+'"':"")+"]"}else u&8?m+="."+w:u&4&&(m+=" "+w);else m!==""&&!Ts(w)&&(i+=pA(r,m),m=""),u=w,r=r||!Ts(u);l++}return m!==""&&(i+=pA(r,m)),i}function z4(o){return o.map(N4).join(",")}function B4(o){let i=[],l=[],u=1,m=2;for(;u<o.length;){let r=o[u];if(typeof r=="string")m===2?r!==""&&i.push(r,o[++u]):m===8&&l.push(r);else{if(!Ts(m))break;m=r}u++}return{attrs:i,classes:l}}function gi(o){return hg(()=>{let i=uP(o),l=gr(xt({},i),{decls:o.decls,vars:o.vars,template:o.template,consts:o.consts||null,ngContentSelectors:o.ngContentSelectors,onPush:o.changeDetection===iP.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&o.dependencies||null,getStandaloneInjector:null,signals:o.signals??!1,data:o.data||{},encapsulation:o.encapsulation||la.Emulated,styles:o.styles||Cs,_:null,schemas:o.schemas||null,tView:null,id:""});hP(l);let u=o.dependencies;return l.directiveDefs=gA(u,!1),l.pipeDefs=gA(u,!0),l.id=U4(l),l})}function V4(o){return Cc(o)||sP(o)}function j4(o){return o!==null}function Mc(o){return hg(()=>({type:o.type,bootstrap:o.bootstrap||Cs,declarations:o.declarations||Cs,imports:o.imports||Cs,exports:o.exports||Cs,transitiveCompileScopes:null,schemas:o.schemas||null,id:o.id||null}))}function mA(o,i){if(o==null)return rg;let l={};for(let u in o)if(o.hasOwnProperty(u)){let m=o[u],r,w,I=ca.None;Array.isArray(m)?(I=m[0],r=m[1],w=m[2]??r):(r=m,w=m),i?(l[r]=I!==ca.None?[u,I]:u,i[r]=w):l[r]=u}return l}function fh(o){return hg(()=>{let i=uP(o);return hP(i),i})}function Cc(o){return o[c4]||null}function sP(o){return o[u4]||null}function aP(o){return o[h4]||null}function lP(o){let i=Cc(o)||sP(o)||aP(o);return i!==null?i.standalone:!1}function cP(o,i){let l=o[d4]||null;if(!l&&i===!0)throw new Error(`Type ${Xi(o)} does not have '\u0275mod' property.`);return l}function uP(o){let i={};return{type:o.type,providersResolver:null,factory:null,hostBindings:o.hostBindings||null,hostVars:o.hostVars||0,hostAttrs:o.hostAttrs||null,contentQueries:o.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:o.inputs||rg,exportAs:o.exportAs||null,standalone:o.standalone===!0,signals:o.signals===!0,selectors:o.selectors||Cs,viewQuery:o.viewQuery||null,features:o.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:mA(o.inputs,i),outputs:mA(o.outputs),debugInfo:null}}function hP(o){o.features?.forEach(i=>i(o))}function gA(o,i){if(!o)return null;let l=i?aP:V4;return()=>(typeof o=="function"?o():o).map(u=>l(u)).filter(j4)}function U4(o){let i=0,l=[o.selectors,o.ngContentSelectors,o.hostVars,o.hostAttrs,o.consts,o.vars,o.decls,o.encapsulation,o.standalone,o.signals,o.exportAs,JSON.stringify(o.inputs),JSON.stringify(o.outputs),Object.getOwnPropertyNames(o.type.prototype),!!o.contentQueries,!!o.viewQuery].join("|");for(let m of l)i=Math.imul(31,i)+m.charCodeAt(0)<<0;return i+=2147483648,"c"+i}function Ac(o){return{\u0275providers:o}}function $4(...o){return{\u0275providers:dP(!0,o),\u0275fromNgModule:!0}}function dP(o,...i){let l=[],u=new Set,m,r=w=>{l.push(w)};return JE(i,w=>{let I=w;hE(I,r,[],u)&&(m||=[],m.push(I))}),m!==void 0&&fP(m,r),l}function fP(o,i){for(let l=0;l<o.length;l++){let{ngModule:u,providers:m}=o[l];nT(m,r=>{i(r,u)})}}function hE(o,i,l,u){if(o=Zi(o),!o)return!1;let m=null,r=cA(o),w=!r&&Cc(o);if(!r&&!w){let A=o.ngModule;if(r=cA(A),r)m=A;else return!1}else{if(w&&!w.standalone)return!1;m=o}let I=u.has(m);if(w){if(I)return!1;if(u.add(m),w.dependencies){let A=typeof w.dependencies=="function"?w.dependencies():w.dependencies;for(let L of A)hE(L,i,l,u)}}else if(r){if(r.imports!=null&&!I){u.add(m);let L;try{JE(r.imports,$=>{hE($,i,l,u)&&(L||=[],L.push($))})}finally{}L!==void 0&&fP(L,i)}if(!I){let L=mf(m)||(()=>new m);i({provide:m,useFactory:L,deps:Cs},m),i({provide:rP,useValue:m,multi:!0},m),i({provide:gf,useValue:()=>dn(m),multi:!0},m)}let A=r.providers;if(A!=null&&!I){let L=o;nT(A,$=>{i($,L)})}}else return!1;return m!==o&&o.providers!==void 0}function nT(o,i){for(let l of o)KA(l)&&(l=l.\u0275providers),Array.isArray(l)?nT(l,i):i(l)}var G4=xr({provide:String,useValue:xr});function pP(o){return o!==null&&typeof o=="object"&&G4 in o}function H4(o){return!!(o&&o.useExisting)}function q4(o){return!!(o&&o.useFactory)}function _f(o){return typeof o=="function"}function W4(o){return!!o.useClass}var bv=new mn(""),Z0={},Z4={},Ww;function rT(){return Ww===void 0&&(Ww=new nv),Ww}var po=class{},ig=class extends po{get destroyed(){return this._destroyed}constructor(i,l,u,m){super(),this.parent=l,this.source=u,this.scopes=m,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,fE(i,w=>this.processProvider(w)),this.records.set(nP,cf(void 0,this)),m.has("environment")&&this.records.set(po,cf(void 0,this));let r=this.records.get(bv);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(rP,Cs,Vn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let i=sr(null);try{for(let u of this._ngOnDestroyHooks)u.ngOnDestroy();let l=this._onDestroyHooks;this._onDestroyHooks=[];for(let u of l)u()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),sr(i)}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();let l=Ec(this),u=Qo(void 0),m;try{return i()}finally{Ec(l),Qo(u)}}get(i,l=ng,u=Vn.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(hA))return i[hA](this);u=xv(u);let m,r=Ec(this),w=Qo(void 0);try{if(!(u&Vn.SkipSelf)){let A=this.records.get(i);if(A===void 0){let L=J4(i)&&vv(i);L&&this.injectableDefInScope(L)?A=cf(dE(i),Z0):A=null,this.records.set(i,A)}if(A!=null)return this.hydrate(i,A)}let I=u&Vn.Self?rT():this.parent;return l=u&Vn.Optional&&l===ng?null:l,I.get(i,l)}catch(I){if(I.name==="NullInjectorError"){if((I[ev]=I[ev]||[]).unshift(Xi(i)),r)throw I;return w4(I,i,"R3InjectorError",this.source)}else throw I}finally{Qo(w),Ec(r)}}resolveInjectorInitializers(){let i=sr(null),l=Ec(this),u=Qo(void 0),m;try{let r=this.get(gf,Cs,Vn.Self);for(let w of r)w()}finally{Ec(l),Qo(u),sr(i)}}toString(){let i=[],l=this.records;for(let u of l.keys())i.push(Xi(u));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new vt(205,!1)}processProvider(i){i=Zi(i);let l=_f(i)?i:Zi(i&&i.provide),u=Y4(i);if(!_f(i)&&i.multi===!0){let m=this.records.get(l);m||(m=cf(void 0,Z0,!0),m.factory=()=>cE(m.multi),this.records.set(l,m)),l=i,m.multi.push(i)}this.records.set(l,u)}hydrate(i,l){let u=sr(null);try{return l.value===Z0&&(l.value=Z4,l.value=l.factory()),typeof l.value=="object"&&l.value&&Q4(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}finally{sr(u)}}injectableDefInScope(i){if(!i.providedIn)return!1;let l=Zi(i.providedIn);return typeof l=="string"?l==="any"||this.scopes.has(l):this.injectorDefTypes.has(l)}removeOnDestroy(i){let l=this._onDestroyHooks.indexOf(i);l!==-1&&this._onDestroyHooks.splice(l,1)}};function dE(o){let i=vv(o),l=i!==null?i.factory:mf(o);if(l!==null)return l;if(o instanceof mn)throw new vt(204,!1);if(o instanceof Function)return X4(o);throw new vt(204,!1)}function X4(o){if(o.length>0)throw new vt(204,!1);let l=a4(o);return l!==null?()=>l.factory(o):()=>new o}function Y4(o){if(pP(o))return cf(void 0,o.useValue);{let i=mP(o);return cf(i,Z0)}}function mP(o,i,l){let u;if(_f(o)){let m=Zi(o);return mf(m)||dE(m)}else if(pP(o))u=()=>Zi(o.useValue);else if(q4(o))u=()=>o.useFactory(...cE(o.deps||[]));else if(H4(o))u=()=>dn(Zi(o.useExisting));else{let m=Zi(o&&(o.useClass||o.provide));if(K4(o))u=()=>new m(...cE(o.deps));else return mf(m)||dE(m)}return u}function cf(o,i,l=!1){return{factory:o,value:i,multi:l?[]:void 0}}function K4(o){return!!o.deps}function Q4(o){return o!==null&&typeof o=="object"&&typeof o.ngOnDestroy=="function"}function J4(o){return typeof o=="function"||typeof o=="object"&&o instanceof mn}function fE(o,i){for(let l of o)Array.isArray(l)?fE(l,i):l&&KA(l)?fE(l.\u0275providers,i):i(l)}function Ds(o,i){o instanceof ig&&o.assertNotDestroyed();let l,u=Ec(o),m=Qo(void 0);try{return i()}finally{Ec(u),Qo(m)}}function gP(){return QA()!==void 0||v4()!=null}function eV(o){if(!gP())throw new vt(-203,!1)}function tV(o){return typeof o=="function"}var ol=0,Zn=1,vn=2,Ui=3,Ss=4,Ms=5,rv=6,og=7,Is=8,yf=9,ua=10,Pi=11,sg=12,_A=13,Cf=14,ha=15,wv=16,uf=17,vf=18,Ev=19,_P=20,Tc=21,Zw=22,ih=23,Sc=25,yP=1;var oh=7,iv=8,ov=9,Jo=10,iT=function(o){return o[o.None=0]="None",o[o.HasTransplantedViews=2]="HasTransplantedViews",o}(iT||{});function nh(o){return Array.isArray(o)&&typeof o[yP]=="object"}function sl(o){return Array.isArray(o)&&o[yP]===!0}function vP(o){return(o.flags&4)!==0}function Tv(o){return o.componentOffset>-1}function oT(o){return(o.flags&1)===1}function Sf(o){return!!o.template}function nV(o){return(o[vn]&512)!==0}var pE=class{constructor(i,l,u){this.previousValue=i,this.currentValue=l,this.firstChange=u}isFirstChange(){return this.firstChange}};function xP(o,i,l,u){i!==null?i.applyValueToInputSignal(i,u):o[l]=u}function Cv(){return bP}function bP(o){return o.type.prototype.ngOnChanges&&(o.setInput=iV),rV}Cv.ngInherit=!0;function rV(){let o=EP(this),i=o?.current;if(i){let l=o.previous;if(l===rg)o.previous=i;else for(let u in i)l[u]=i[u];o.current=null,this.ngOnChanges(i)}}function iV(o,i,l,u,m){let r=this.declaredInputs[u],w=EP(o)||oV(o,{previous:rg,current:null}),I=w.current||(w.current={}),A=w.previous,L=A[r];I[r]=new pE(L&&L.currentValue,l,A===rg),xP(o,i,m,l)}var wP="__ngSimpleChanges__";function EP(o){return o[wP]||null}function oV(o,i){return o[wP]=i}var yA=null;var sa=function(o,i,l){yA?.(o,i,l)},TP="svg",sV="math",aV=!1;function lV(){return aV}function da(o){for(;Array.isArray(o);)o=o[ol];return o}function CP(o,i){return da(i[o])}function As(o,i){return da(i[o.index])}function SP(o,i){return o.data[i]}function Pc(o,i){let l=i[o];return nh(l)?l:l[ol]}function sT(o){return(o[vn]&128)===128}function cV(o){return sl(o[Ui])}function sv(o,i){return i==null?null:o[i]}function IP(o){o[uf]=0}function uV(o){o[vn]&1024||(o[vn]|=1024,sT(o)&&ag(o))}function hV(o,i){for(;o>0;)i=i[Cf],o--;return i}function aT(o){return!!(o[vn]&9216||o[ih]?.dirty)}function mE(o){o[ua].changeDetectionScheduler?.notify(1),aT(o)?ag(o):o[vn]&64&&(lV()?(o[vn]|=1024,ag(o)):o[ua].changeDetectionScheduler?.notify())}function ag(o){o[ua].changeDetectionScheduler?.notify();let i=lg(o);for(;i!==null&&!(i[vn]&8192||(i[vn]|=8192,!sT(i)));)i=lg(i)}function DP(o,i){if((o[vn]&256)===256)throw new vt(911,!1);o[Tc]===null&&(o[Tc]=[]),o[Tc].push(i)}function dV(o,i){if(o[Tc]===null)return;let l=o[Tc].indexOf(i);l!==-1&&o[Tc].splice(l,1)}function lg(o){let i=o[Ui];return sl(i)?i[Ui]:i}var zn={lFrame:BP(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function fV(){return zn.lFrame.elementDepthCount}function pV(){zn.lFrame.elementDepthCount++}function mV(){zn.lFrame.elementDepthCount--}function MP(){return zn.bindingsEnabled}function gV(){return zn.skipHydrationRootTNode!==null}function _V(o){return zn.skipHydrationRootTNode===o}function yV(){zn.skipHydrationRootTNode=null}function Or(){return zn.lFrame.lView}function Ps(){return zn.lFrame.tView}function AP(o){return zn.lFrame.contextLView=o,o[Is]}function PP(o){return zn.lFrame.contextLView=null,o}function es(){let o=RP();for(;o!==null&&o.type===64;)o=o.parent;return o}function RP(){return zn.lFrame.currentTNode}function vV(){let o=zn.lFrame,i=o.currentTNode;return o.isParent?i:i.parent}function pg(o,i){let l=zn.lFrame;l.currentTNode=o,l.isParent=i}function OP(){return zn.lFrame.isParent}function xV(){zn.lFrame.isParent=!1}function bV(){let o=zn.lFrame,i=o.bindingRootIndex;return i===-1&&(i=o.bindingRootIndex=o.tView.bindingStartIndex),i}function wV(){return zn.lFrame.bindingIndex}function EV(o){return zn.lFrame.bindingIndex=o}function kP(){return zn.lFrame.bindingIndex++}function LP(o){let i=zn.lFrame,l=i.bindingIndex;return i.bindingIndex=i.bindingIndex+o,l}function TV(){return zn.lFrame.inI18n}function CV(o,i){let l=zn.lFrame;l.bindingIndex=l.bindingRootIndex=o,gE(i)}function SV(){return zn.lFrame.currentDirectiveIndex}function gE(o){zn.lFrame.currentDirectiveIndex=o}function IV(o){let i=zn.lFrame.currentDirectiveIndex;return i===-1?null:o[i]}function FP(o){zn.lFrame.currentQueryIndex=o}function DV(o){let i=o[Zn];return i.type===2?i.declTNode:i.type===1?o[Ms]:null}function NP(o,i,l){if(l&Vn.SkipSelf){let m=i,r=o;for(;m=m.parent,m===null&&!(l&Vn.Host);)if(m=DV(r),m===null||(r=r[Cf],m.type&10))break;if(m===null)return!1;i=m,o=r}let u=zn.lFrame=zP();return u.currentTNode=i,u.lView=o,!0}function lT(o){let i=zP(),l=o[Zn];zn.lFrame=i,i.currentTNode=l.firstChild,i.lView=o,i.tView=l,i.contextLView=o,i.bindingIndex=l.bindingStartIndex,i.inI18n=!1}function zP(){let o=zn.lFrame,i=o===null?null:o.child;return i===null?BP(o):i}function BP(o){let i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:o,child:null,inI18n:!1};return o!==null&&(o.child=i),i}function VP(){let o=zn.lFrame;return zn.lFrame=o.parent,o.currentTNode=null,o.lView=null,o}var jP=VP;function cT(){let o=VP();o.isParent=!0,o.tView=null,o.selectedIndex=-1,o.contextLView=null,o.elementDepthCount=0,o.currentDirectiveIndex=-1,o.currentNamespace=null,o.bindingRootIndex=-1,o.bindingIndex=-1,o.currentQueryIndex=0}function MV(o){return(zn.lFrame.contextLView=hV(o,zn.lFrame.contextLView))[Is]}function ph(){return zn.lFrame.selectedIndex}function sh(o){zn.lFrame.selectedIndex=o}function UP(){let o=zn.lFrame;return SP(o.tView,o.selectedIndex)}function $P(){zn.lFrame.currentNamespace=TP}function AV(){return zn.lFrame.currentNamespace}var GP=!0;function uT(){return GP}function hT(o){GP=o}function PV(o,i,l){let{ngOnChanges:u,ngOnInit:m,ngDoCheck:r}=i.type.prototype;if(u){let w=bP(i);(l.preOrderHooks??=[]).push(o,w),(l.preOrderCheckHooks??=[]).push(o,w)}m&&(l.preOrderHooks??=[]).push(0-o,m),r&&((l.preOrderHooks??=[]).push(o,r),(l.preOrderCheckHooks??=[]).push(o,r))}function dT(o,i){for(let l=i.directiveStart,u=i.directiveEnd;l<u;l++){let r=o.data[l].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:I,ngAfterViewInit:A,ngAfterViewChecked:L,ngOnDestroy:$}=r;w&&(o.contentHooks??=[]).push(-l,w),I&&((o.contentHooks??=[]).push(l,I),(o.contentCheckHooks??=[]).push(l,I)),A&&(o.viewHooks??=[]).push(-l,A),L&&((o.viewHooks??=[]).push(l,L),(o.viewCheckHooks??=[]).push(l,L)),$!=null&&(o.destroyHooks??=[]).push(l,$)}}function X0(o,i,l){HP(o,i,3,l)}function Y0(o,i,l,u){(o[vn]&3)===l&&HP(o,i,l,u)}function Xw(o,i){let l=o[vn];(l&3)===i&&(l&=16383,l+=1,o[vn]=l)}function HP(o,i,l,u){let m=u!==void 0?o[uf]&65535:0,r=u??-1,w=i.length-1,I=0;for(let A=m;A<w;A++)if(typeof i[A+1]=="number"){if(I=i[A],u!=null&&I>=u)break}else i[A]<0&&(o[uf]+=65536),(I<r||r==-1)&&(RV(o,l,i,A),o[uf]=(o[uf]&4294901760)+A+2),A++}function vA(o,i){sa(4,o,i);let l=sr(null);try{i.call(o)}finally{sr(l),sa(5,o,i)}}function RV(o,i,l,u){let m=l[u]<0,r=l[u+1],w=m?-l[u]:l[u],I=o[w];m?o[vn]>>14<o[uf]>>16&&(o[vn]&3)===i&&(o[vn]+=16384,vA(I,r)):vA(I,r)}var pf=-1,ah=class{constructor(i,l,u){this.factory=i,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=u}};function OV(o){return o instanceof ah}function kV(o){return(o.flags&8)!==0}function LV(o){return(o.flags&16)!==0}function qP(o){return o!==pf}function av(o){return o&32767}function FV(o){return o>>16}function lv(o,i){let l=FV(o),u=i;for(;l>0;)u=u[Cf],l--;return u}var _E=!0;function xA(o){let i=_E;return _E=o,i}var NV=256,WP=NV-1,ZP=5,zV=0,aa={};function BV(o,i,l){let u;typeof l=="string"?u=l.charCodeAt(0)||0:l.hasOwnProperty(eg)&&(u=l[eg]),u==null&&(u=l[eg]=zV++);let m=u&WP,r=1<<m;i.data[o+(m>>ZP)]|=r}function cv(o,i){let l=XP(o,i);if(l!==-1)return l;let u=i[Zn];u.firstCreatePass&&(o.injectorIndex=i.length,Yw(u.data,o),Yw(i,null),Yw(u.blueprint,null));let m=fT(o,i),r=o.injectorIndex;if(qP(m)){let w=av(m),I=lv(m,i),A=I[Zn].data;for(let L=0;L<8;L++)i[r+L]=I[w+L]|A[w+L]}return i[r+8]=m,r}function Yw(o,i){o.push(0,0,0,0,0,0,0,0,i)}function XP(o,i){return o.injectorIndex===-1||o.parent&&o.parent.injectorIndex===o.injectorIndex||i[o.injectorIndex+8]===null?-1:o.injectorIndex}function fT(o,i){if(o.parent&&o.parent.injectorIndex!==-1)return o.parent.injectorIndex;let l=0,u=null,m=i;for(;m!==null;){if(u=eR(m),u===null)return pf;if(l++,m=m[Cf],u.injectorIndex!==-1)return u.injectorIndex|l<<16}return pf}function yE(o,i,l){BV(o,i,l)}function YP(o,i,l){if(l&Vn.Optional||o!==void 0)return o;QE(i,"NodeInjector")}function KP(o,i,l,u){if(l&Vn.Optional&&u===void 0&&(u=null),!(l&(Vn.Self|Vn.Host))){let m=o[yf],r=Qo(void 0);try{return m?m.get(i,u,l&Vn.Optional):JA(i,u,l&Vn.Optional)}finally{Qo(r)}}return YP(u,i,l)}function QP(o,i,l,u=Vn.Default,m){if(o!==null){if(i[vn]&2048&&!(u&Vn.Self)){let w=GV(o,i,l,u,aa);if(w!==aa)return w}let r=JP(o,i,l,u,aa);if(r!==aa)return r}return KP(i,l,u,m)}function JP(o,i,l,u,m){let r=UV(l);if(typeof r=="function"){if(!NP(i,o,u))return u&Vn.Host?YP(m,l,u):KP(i,l,u,m);try{let w;if(w=r(u),w==null&&!(u&Vn.Optional))QE(l);else return w}finally{jP()}}else if(typeof r=="number"){let w=null,I=XP(o,i),A=pf,L=u&Vn.Host?i[ha][Ms]:null;for((I===-1||u&Vn.SkipSelf)&&(A=I===-1?fT(o,i):i[I+8],A===pf||!wA(u,!1)?I=-1:(w=i[Zn],I=av(A),i=lv(A,i)));I!==-1;){let $=i[Zn];if(bA(r,I,$.data)){let Q=VV(I,i,l,w,u,L);if(Q!==aa)return Q}A=i[I+8],A!==pf&&wA(u,i[Zn].data[I+8]===L)&&bA(r,I,i)?(w=$,I=av(A),i=lv(A,i)):I=-1}}return m}function VV(o,i,l,u,m,r){let w=i[Zn],I=w.data[o+8],A=u==null?Tv(I)&&_E:u!=w&&(I.type&3)!==0,L=m&Vn.Host&&r===I,$=jV(I,w,l,A,L);return $!==null?xf(i,w,$,I):aa}function jV(o,i,l,u,m){let r=o.providerIndexes,w=i.data,I=r&1048575,A=o.directiveStart,L=o.directiveEnd,$=r>>20,Q=u?I:I+$,me=m?I+$:L;for(let he=Q;he<me;he++){let be=w[he];if(he<A&&l===be||he>=A&&be.type===l)return he}if(m){let he=w[A];if(he&&Sf(he)&&he.type===l)return A}return null}function xf(o,i,l,u){let m=o[l],r=i.data;if(OV(m)){let w=m;w.resolving&&p4(f4(r[l]));let I=xA(w.canSeeViewProviders);w.resolving=!0;let A,L=w.injectImpl?Qo(w.injectImpl):null,$=NP(o,u,Vn.Default);try{m=o[l]=w.factory(void 0,r,o,u),i.firstCreatePass&&l>=u.directiveStart&&PV(l,r[l],i)}finally{L!==null&&Qo(L),xA(I),w.resolving=!1,jP()}}return m}function UV(o){if(typeof o=="string")return o.charCodeAt(0)||0;let i=o.hasOwnProperty(eg)?o[eg]:void 0;return typeof i=="number"?i>=0?i&WP:$V:i}function bA(o,i,l){let u=1<<o;return!!(l[i+(o>>ZP)]&u)}function wA(o,i){return!(o&Vn.Self)&&!(o&Vn.Host&&i)}var rh=class{constructor(i,l){this._tNode=i,this._lView=l}get(i,l,u){return QP(this._tNode,this._lView,i,xv(u),l)}};function $V(){return new rh(es(),Or())}function pT(o){return hg(()=>{let i=o.prototype.constructor,l=i[J0]||vE(i),u=Object.prototype,m=Object.getPrototypeOf(o.prototype).constructor;for(;m&&m!==u;){let r=m[J0]||vE(m);if(r&&r!==l)return r;m=Object.getPrototypeOf(m)}return r=>new r})}function vE(o){return WA(o)?()=>{let i=vE(Zi(o));return i&&i()}:mf(o)}function GV(o,i,l,u,m){let r=o,w=i;for(;r!==null&&w!==null&&w[vn]&2048&&!(w[vn]&512);){let I=JP(r,w,l,u|Vn.Self,aa);if(I!==aa)return I;let A=r.parent;if(!A){let L=w[_P];if(L){let $=L.get(l,aa,u);if($!==aa)return $}A=eR(w),w=w[Cf]}r=A}return m}function eR(o){let i=o[Zn],l=i.type;return l===2?i.declTNode:l===1?o[Ms]:null}function EA(o,i=null,l=null,u){let m=tR(o,i,l,u);return m.resolveInjectorInitializers(),m}function tR(o,i=null,l=null,u,m=new Set){let r=[l||Cs,$4(o)];return u=u||(typeof o=="object"?void 0:Xi(o)),new ig(r,i||rT(),u||null,m)}var mh=(()=>{let i=class i{static create(u,m){if(Array.isArray(u))return EA({name:""},m,u,"");{let r=u.name??"";return EA({name:r},u.parent,u.providers,r)}}};i.THROW_IF_NOT_FOUND=ng,i.NULL=new nv,i.\u0275prov=Gt({token:i,providedIn:"any",factory:()=>dn(nP)}),i.__NG_ELEMENT_ID__=-1;let o=i;return o})();var HV="ngOriginalError";function Kw(o){return o[HV]}var fa=class{constructor(){this._console=console}handleError(i){let l=this._findOriginalError(i);this._console.error("ERROR",i),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(i){let l=i&&Kw(i);for(;l&&Kw(l);)l=Kw(l);return l||null}},nR=new mn("",{providedIn:"root",factory:()=>Tt(fa).handleError.bind(void 0)}),mT=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=qV,i.__NG_ENV_ID__=u=>u;let o=i;return o})(),xE=class extends mT{constructor(i){super(),this._lView=i}onDestroy(i){return DP(this._lView,i),()=>dV(this._lView,i)}};function qV(){return new xE(Or())}function WV(){return Sv(es(),Or())}function Sv(o,i){return new gh(As(o,i))}var gh=(()=>{let i=class i{constructor(u){this.nativeElement=u}};i.__NG_ELEMENT_ID__=WV;let o=i;return o})();var bE=class extends Ai{constructor(i=!1){super(),this.destroyRef=void 0,this.__isAsync=i,gP()&&(this.destroyRef=Tt(mT,{optional:!0})??void 0)}emit(i){let l=sr(null);try{super.next(i)}finally{sr(l)}}subscribe(i,l,u){let m=i,r=l||(()=>null),w=u;if(i&&typeof i=="object"){let A=i;m=A.next?.bind(A),r=A.error?.bind(A),w=A.complete?.bind(A)}this.__isAsync&&(r=Qw(r),m&&(m=Qw(m)),w&&(w=Qw(w)));let I=super.subscribe({next:m,error:r,complete:w});return i instanceof fi&&i.add(I),I}};function Qw(o){return i=>{setTimeout(o,void 0,i)}}var Po=bE;function rR(o){return(o.flags&128)===128}var iR=new Map,ZV=0;function XV(){return ZV++}function YV(o){iR.set(o[Ev],o)}function KV(o){iR.delete(o[Ev])}var TA="__ngContext__";function lh(o,i){nh(i)?(o[TA]=i[Ev],YV(i)):o[TA]=i}function oR(o){return aR(o[sg])}function sR(o){return aR(o[Ss])}function aR(o){for(;o!==null&&!sl(o);)o=o[Ss];return o}var wE;function lR(o){wE=o}function QV(){if(wE!==void 0)return wE;if(typeof document<"u")return document;throw new vt(210,!1)}var gT=new mn("",{providedIn:"root",factory:()=>JV}),JV="ng",_T=new mn(""),al=new mn("",{providedIn:"platform",factory:()=>"unknown"});var yT=new mn(""),vT=new mn("",{providedIn:"root",factory:()=>QV().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var ej="h",tj="b";var nj=()=>null;function xT(o,i,l=!1){return nj(o,i,l)}var cR=!1,rj=new mn("",{providedIn:"root",factory:()=>cR});var EE=class{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${i4})`}};function bT(o){return o instanceof EE?o.changingThisBreaksApplicationSecurity:o}function uR(o){return o instanceof Function?o():o}function ij(o){return(o??Tt(mh)).get(al)==="browser"}var pa=function(o){return o[o.Important=1]="Important",o[o.DashCase=2]="DashCase",o}(pa||{}),oj;function wT(o,i){return oj(o,i)}function hf(o,i,l,u,m){if(u!=null){let r,w=!1;sl(u)?r=u:nh(u)&&(w=!0,u=u[ol]);let I=da(u);o===0&&l!==null?m==null?mR(i,l,I):uv(i,l,I,m||null,!0):o===1&&l!==null?uv(i,l,I,m||null,!0):o===2?wj(i,I,w):o===3&&i.destroyNode(I),r!=null&&Tj(i,o,r,l,m)}}function sj(o,i){return o.createText(i)}function aj(o,i,l){o.setValue(i,l)}function hR(o,i,l){return o.createElement(i,l)}function lj(o,i){dR(o,i),i[ol]=null,i[Ms]=null}function cj(o,i,l,u,m,r){u[ol]=m,u[Ms]=i,Iv(o,u,l,1,m,r)}function dR(o,i){i[ua].changeDetectionScheduler?.notify(1),Iv(o,i,i[Pi],2,null,null)}function uj(o){let i=o[sg];if(!i)return Jw(o[Zn],o);for(;i;){let l=null;if(nh(i))l=i[sg];else{let u=i[Jo];u&&(l=u)}if(!l){for(;i&&!i[Ss]&&i!==o;)nh(i)&&Jw(i[Zn],i),i=i[Ui];i===null&&(i=o),nh(i)&&Jw(i[Zn],i),l=i&&i[Ss]}i=l}}function hj(o,i,l,u){let m=Jo+u,r=l.length;u>0&&(l[m-1][Ss]=i),u<r-Jo?(i[Ss]=l[m],tP(l,Jo+u,i)):(l.push(i),i[Ss]=null),i[Ui]=l;let w=i[wv];w!==null&&l!==w&&dj(w,i);let I=i[vf];I!==null&&I.insertView(o),mE(i),i[vn]|=128}function dj(o,i){let l=o[ov],m=i[Ui][Ui][ha];i[ha]!==m&&(o[vn]|=iT.HasTransplantedViews),l===null?o[ov]=[i]:l.push(i)}function fR(o,i){let l=o[ov],u=l.indexOf(i);l.splice(u,1)}function TE(o,i){if(o.length<=Jo)return;let l=Jo+i,u=o[l];if(u){let m=u[wv];m!==null&&m!==o&&fR(m,u),i>0&&(o[l-1][Ss]=u[Ss]);let r=tv(o,Jo+i);lj(u[Zn],u);let w=r[vf];w!==null&&w.detachView(r[Zn]),u[Ui]=null,u[Ss]=null,u[vn]&=-129}return u}function pR(o,i){if(!(i[vn]&256)){let l=i[Pi];l.destroyNode&&Iv(o,i,l,3,null,null),uj(i)}}function Jw(o,i){if(i[vn]&256)return;let l=sr(null);try{i[vn]&=-129,i[vn]|=256,i[ih]&&P2(i[ih]),pj(o,i),fj(o,i),i[Zn].type===1&&i[Pi].destroy();let u=i[wv];if(u!==null&&sl(i[Ui])){u!==i[Ui]&&fR(u,i);let m=i[vf];m!==null&&m.detachView(o)}KV(i)}finally{sr(l)}}function fj(o,i){let l=o.cleanup,u=i[og];if(l!==null)for(let r=0;r<l.length-1;r+=2)if(typeof l[r]=="string"){let w=l[r+3];w>=0?u[w]():u[-w].unsubscribe(),r+=2}else{let w=u[l[r+1]];l[r].call(w)}u!==null&&(i[og]=null);let m=i[Tc];if(m!==null){i[Tc]=null;for(let r=0;r<m.length;r++){let w=m[r];w()}}}function pj(o,i){let l;if(o!=null&&(l=o.destroyHooks)!=null)for(let u=0;u<l.length;u+=2){let m=i[l[u]];if(!(m instanceof ah)){let r=l[u+1];if(Array.isArray(r))for(let w=0;w<r.length;w+=2){let I=m[r[w]],A=r[w+1];sa(4,I,A);try{A.call(I)}finally{sa(5,I,A)}}else{sa(4,m,r);try{r.call(m)}finally{sa(5,m,r)}}}}}function mj(o,i,l){return gj(o,i.parent,l)}function gj(o,i,l){let u=i;for(;u!==null&&u.type&40;)i=u,u=i.parent;if(u===null)return l[ol];{let{componentOffset:m}=u;if(m>-1){let{encapsulation:r}=o.data[u.directiveStart+m];if(r===la.None||r===la.Emulated)return null}return As(u,l)}}function uv(o,i,l,u,m){o.insertBefore(i,l,u,m)}function mR(o,i,l){o.appendChild(i,l)}function CA(o,i,l,u,m){u!==null?uv(o,i,l,u,m):mR(o,i,l)}function _j(o,i,l,u){o.removeChild(i,l,u)}function ET(o,i){return o.parentNode(i)}function yj(o,i){return o.nextSibling(i)}function vj(o,i,l){return bj(o,i,l)}function xj(o,i,l){return o.type&40?As(o,l):null}var bj=xj,SA;function TT(o,i,l,u){let m=mj(o,u,i),r=i[Pi],w=u.parent||i[Ms],I=vj(w,u,i);if(m!=null)if(Array.isArray(l))for(let A=0;A<l.length;A++)CA(r,m,l[A],I,!1);else CA(r,m,l,I,!1);SA!==void 0&&SA(r,u,i,l,m)}function K0(o,i){if(i!==null){let l=i.type;if(l&3)return As(i,o);if(l&4)return CE(-1,o[i.index]);if(l&8){let u=i.child;if(u!==null)return K0(o,u);{let m=o[i.index];return sl(m)?CE(-1,m):da(m)}}else{if(l&32)return wT(i,o)()||da(o[i.index]);{let u=gR(o,i);if(u!==null){if(Array.isArray(u))return u[0];let m=lg(o[ha]);return K0(m,u)}else return K0(o,i.next)}}}return null}function gR(o,i){if(i!==null){let u=o[ha][Ms],m=i.projection;return u.projection[m]}return null}function CE(o,i){let l=Jo+o+1;if(l<i.length){let u=i[l],m=u[Zn].firstChild;if(m!==null)return K0(u,m)}return i[oh]}function wj(o,i,l){let u=ET(o,i);u&&_j(o,u,i,l)}function CT(o,i,l,u,m,r,w){for(;l!=null;){let I=u[l.index],A=l.type;if(w&&i===0&&(I&&lh(da(I),u),l.flags|=2),(l.flags&32)!==32)if(A&8)CT(o,i,l.child,u,m,r,!1),hf(i,o,m,I,r);else if(A&32){let L=wT(l,u),$;for(;$=L();)hf(i,o,m,$,r);hf(i,o,m,I,r)}else A&16?Ej(o,i,u,l,m,r):hf(i,o,m,I,r);l=w?l.projectionNext:l.next}}function Iv(o,i,l,u,m,r){CT(l,u,o.firstChild,i,m,r,!1)}function Ej(o,i,l,u,m,r){let w=l[ha],A=w[Ms].projection[u.projection];if(Array.isArray(A))for(let L=0;L<A.length;L++){let $=A[L];hf(i,o,m,$,r)}else{let L=A,$=w[Ui];rR(u)&&(L.flags|=128),CT(o,i,L,$,m,r,!0)}}function Tj(o,i,l,u,m){let r=l[oh],w=da(l);r!==w&&hf(i,o,u,r,m);for(let I=Jo;I<l.length;I++){let A=l[I];Iv(A[Zn],A,o,i,u,r)}}function Cj(o,i,l,u,m){if(i)m?o.addClass(l,u):o.removeClass(l,u);else{let r=u.indexOf("-")===-1?void 0:pa.DashCase;m==null?o.removeStyle(l,u,r):(typeof m=="string"&&m.endsWith("!important")&&(m=m.slice(0,-10),r|=pa.Important),o.setStyle(l,u,m,r))}}function Sj(o,i,l){o.setAttribute(i,"style",l)}function _R(o,i,l){l===""?o.removeAttribute(i,"class"):o.setAttribute(i,"class",l)}function yR(o,i,l){let{mergedAttrs:u,classes:m,styles:r}=l;u!==null&&uE(o,i,u),m!==null&&_R(o,i,m),r!==null&&Sj(o,i,r)}var ma={};function Hr(o=1){vR(Ps(),Or(),ph()+o,!1)}function vR(o,i,l,u){if(!u)if((i[vn]&3)===3){let r=o.preOrderCheckHooks;r!==null&&X0(i,r,l)}else{let r=o.preOrderHooks;r!==null&&Y0(i,r,0,l)}sh(l)}function _r(o,i=Vn.Default){let l=Or();if(l===null)return dn(o,i);let u=es();return QP(u,l,Zi(o),i)}function xR(o,i,l,u,m,r){let w=sr(null);try{let I=null;m&ca.SignalBased&&(I=i[u][I2]),I!==null&&I.transformFn!==void 0&&(r=I.transformFn(r)),m&ca.HasDecoratorInputTransform&&(r=o.inputTransforms[u].call(i,r)),o.setInput!==null?o.setInput(i,I,r,l,u):xP(i,I,u,r)}finally{sr(w)}}function Ij(o,i){let l=o.hostBindingOpCodes;if(l!==null)try{for(let u=0;u<l.length;u++){let m=l[u];if(m<0)sh(~m);else{let r=m,w=l[++u],I=l[++u];CV(w,r);let A=i[r];I(2,A)}}}finally{sh(-1)}}function Dv(o,i,l,u,m,r,w,I,A,L,$){let Q=i.blueprint.slice();return Q[ol]=m,Q[vn]=u|4|128|8|64,(L!==null||o&&o[vn]&2048)&&(Q[vn]|=2048),IP(Q),Q[Ui]=Q[Cf]=o,Q[Is]=l,Q[ua]=w||o&&o[ua],Q[Pi]=I||o&&o[Pi],Q[yf]=A||o&&o[yf]||null,Q[Ms]=r,Q[Ev]=XV(),Q[rv]=$,Q[_P]=L,Q[ha]=i.type==2?o[ha]:Q,Q}function Mv(o,i,l,u,m){let r=o.data[i];if(r===null)r=Dj(o,i,l,u,m),TV()&&(r.flags|=32);else if(r.type&64){r.type=l,r.value=u,r.attrs=m;let w=vV();r.injectorIndex=w===null?-1:w.injectorIndex}return pg(r,!0),r}function Dj(o,i,l,u,m){let r=RP(),w=OP(),I=w?r:r&&r.parent,A=o.data[i]=Oj(o,I,l,i,u,m);return o.firstChild===null&&(o.firstChild=A),r!==null&&(w?r.child==null&&A.parent!==null&&(r.child=A):r.next===null&&(r.next=A,A.prev=r)),A}function bR(o,i,l,u){if(l===0)return-1;let m=i.length;for(let r=0;r<l;r++)i.push(u),o.blueprint.push(u),o.data.push(null);return m}function wR(o,i,l,u,m){let r=ph(),w=u&2;try{sh(-1),w&&i.length>Sc&&vR(o,i,Sc,!1),sa(w?2:0,m),l(u,m)}finally{sh(r),sa(w?3:1,m)}}function ER(o,i,l){if(vP(i)){let u=sr(null);try{let m=i.directiveStart,r=i.directiveEnd;for(let w=m;w<r;w++){let I=o.data[w];if(I.contentQueries){let A=l[w];I.contentQueries(1,A,w)}}}finally{sr(u)}}}function TR(o,i,l){MP()&&(Bj(o,i,l,As(l,i)),(l.flags&64)===64&&AR(o,i,l))}function CR(o,i,l=As){let u=i.localNames;if(u!==null){let m=i.index+1;for(let r=0;r<u.length;r+=2){let w=u[r+1],I=w===-1?l(i,o):o[w];o[m++]=I}}}function SR(o){let i=o.tView;return i===null||i.incompleteFirstPass?o.tView=ST(1,null,o.template,o.decls,o.vars,o.directiveDefs,o.pipeDefs,o.viewQuery,o.schemas,o.consts,o.id):i}function ST(o,i,l,u,m,r,w,I,A,L,$){let Q=Sc+u,me=Q+m,he=Mj(Q,me),be=typeof L=="function"?L():L;return he[Zn]={type:o,blueprint:he,template:l,queries:null,viewQuery:I,declTNode:i,data:he.slice().fill(null,Q),bindingStartIndex:Q,expandoStartIndex:me,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof w=="function"?w():w,firstChild:null,schemas:A,consts:be,incompleteFirstPass:!1,ssrId:$}}function Mj(o,i){let l=[];for(let u=0;u<i;u++)l.push(u<o?null:ma);return l}function Aj(o,i,l,u){let r=u.get(rj,cR)||l===la.ShadowDom,w=o.selectRootElement(i,r);return Pj(w),w}function Pj(o){Rj(o)}var Rj=()=>null;function Oj(o,i,l,u,m,r){let w=i?i.injectorIndex:-1,I=0;return gV()&&(I|=128),{type:l,index:u,insertBeforeIndex:null,injectorIndex:w,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:I,providerIndexes:0,value:m,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function IA(o,i,l,u,m){for(let r in i){if(!i.hasOwnProperty(r))continue;let w=i[r];if(w===void 0)continue;u??={};let I,A=ca.None;Array.isArray(w)?(I=w[0],A=w[1]):I=w;let L=r;if(m!==null){if(!m.hasOwnProperty(r))continue;L=m[r]}o===0?DA(u,l,L,I,A):DA(u,l,L,I)}return u}function DA(o,i,l,u,m){let r;o.hasOwnProperty(l)?(r=o[l]).push(i,u):r=o[l]=[i,u],m!==void 0&&r.push(m)}function kj(o,i,l){let u=i.directiveStart,m=i.directiveEnd,r=o.data,w=i.attrs,I=[],A=null,L=null;for(let $=u;$<m;$++){let Q=r[$],me=l?l.get(Q):null,he=me?me.inputs:null,be=me?me.outputs:null;A=IA(0,Q.inputs,$,A,he),L=IA(1,Q.outputs,$,L,be);let Ie=A!==null&&w!==null&&!tT(i)?Zj(A,$,w):null;I.push(Ie)}A!==null&&(A.hasOwnProperty("class")&&(i.flags|=8),A.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=I,i.inputs=A,i.outputs=L}function Lj(o){return o==="class"?"className":o==="for"?"htmlFor":o==="formaction"?"formAction":o==="innerHtml"?"innerHTML":o==="readonly"?"readOnly":o==="tabindex"?"tabIndex":o}function IR(o,i,l,u,m,r,w,I){let A=As(i,l),L=i.inputs,$;!I&&L!=null&&($=L[u])?(IT(o,l,$,u,m),Tv(i)&&Fj(l,i.index)):i.type&3?(u=Lj(u),m=w!=null?w(m,i.value||"",u):m,r.setProperty(A,u,m)):i.type&12}function Fj(o,i){let l=Pc(i,o);l[vn]&16||(l[vn]|=64)}function DR(o,i,l,u){if(MP()){let m=u===null?null:{"":-1},r=jj(o,l),w,I;r===null?w=I=null:[w,I]=r,w!==null&&MR(o,i,l,w,m,I),m&&Uj(l,u,m)}l.mergedAttrs=eT(l.mergedAttrs,l.attrs)}function MR(o,i,l,u,m,r){for(let L=0;L<u.length;L++)yE(cv(l,i),o,u[L].type);Gj(l,o.data.length,u.length);for(let L=0;L<u.length;L++){let $=u[L];$.providersResolver&&$.providersResolver($)}let w=!1,I=!1,A=bR(o,i,u.length,null);for(let L=0;L<u.length;L++){let $=u[L];l.mergedAttrs=eT(l.mergedAttrs,$.hostAttrs),Hj(o,l,i,A,$),$j(A,$,m),$.contentQueries!==null&&(l.flags|=4),($.hostBindings!==null||$.hostAttrs!==null||$.hostVars!==0)&&(l.flags|=64);let Q=$.type.prototype;!w&&(Q.ngOnChanges||Q.ngOnInit||Q.ngDoCheck)&&((o.preOrderHooks??=[]).push(l.index),w=!0),!I&&(Q.ngOnChanges||Q.ngDoCheck)&&((o.preOrderCheckHooks??=[]).push(l.index),I=!0),A++}kj(o,l,r)}function Nj(o,i,l,u,m){let r=m.hostBindings;if(r){let w=o.hostBindingOpCodes;w===null&&(w=o.hostBindingOpCodes=[]);let I=~i.index;zj(w)!=I&&w.push(I),w.push(l,u,r)}}function zj(o){let i=o.length;for(;i>0;){let l=o[--i];if(typeof l=="number"&&l<0)return l}return 0}function Bj(o,i,l,u){let m=l.directiveStart,r=l.directiveEnd;Tv(l)&&qj(i,l,o.data[m+l.componentOffset]),o.firstCreatePass||cv(l,i),lh(u,i);let w=l.initialInputs;for(let I=m;I<r;I++){let A=o.data[I],L=xf(i,o,I,l);if(lh(L,i),w!==null&&Wj(i,I-m,L,A,l,w),Sf(A)){let $=Pc(l.index,i);$[Is]=xf(i,o,I,l)}}}function AR(o,i,l){let u=l.directiveStart,m=l.directiveEnd,r=l.index,w=SV();try{sh(r);for(let I=u;I<m;I++){let A=o.data[I],L=i[I];gE(I),(A.hostBindings!==null||A.hostVars!==0||A.hostAttrs!==null)&&Vj(A,L)}}finally{sh(-1),gE(w)}}function Vj(o,i){o.hostBindings!==null&&o.hostBindings(1,i)}function jj(o,i){let l=o.directiveRegistry,u=null,m=null;if(l)for(let r=0;r<l.length;r++){let w=l[r];if(k4(i,w.selectors,!1))if(u||(u=[]),Sf(w))if(w.findHostDirectiveDefs!==null){let I=[];m=m||new Map,w.findHostDirectiveDefs(w,I,m),u.unshift(...I,w);let A=I.length;SE(o,i,A)}else u.unshift(w),SE(o,i,0);else m=m||new Map,w.findHostDirectiveDefs?.(w,u,m),u.push(w)}return u===null?null:[u,m]}function SE(o,i,l){i.componentOffset=l,(o.components??=[]).push(i.index)}function Uj(o,i,l){if(i){let u=o.localNames=[];for(let m=0;m<i.length;m+=2){let r=l[i[m+1]];if(r==null)throw new vt(-301,!1);u.push(i[m],r)}}}function $j(o,i,l){if(l){if(i.exportAs)for(let u=0;u<i.exportAs.length;u++)l[i.exportAs[u]]=o;Sf(i)&&(l[""]=o)}}function Gj(o,i,l){o.flags|=1,o.directiveStart=i,o.directiveEnd=i+l,o.providerIndexes=i}function Hj(o,i,l,u,m){o.data[u]=m;let r=m.factory||(m.factory=mf(m.type,!0)),w=new ah(r,Sf(m),_r);o.blueprint[u]=w,l[u]=w,Nj(o,i,u,bR(o,l,m.hostVars,ma),m)}function qj(o,i,l){let u=As(i,o),m=SR(l),r=o[ua].rendererFactory,w=16;l.signals?w=4096:l.onPush&&(w=64);let I=Av(o,Dv(o,m,null,w,u,i,null,r.createRenderer(u,l),null,null,null));o[i.index]=I}function Wj(o,i,l,u,m,r){let w=r[i];if(w!==null)for(let I=0;I<w.length;){let A=w[I++],L=w[I++],$=w[I++],Q=w[I++];xR(u,l,A,L,$,Q)}}function Zj(o,i,l){let u=null,m=0;for(;m<l.length;){let r=l[m];if(r===0){m+=4;continue}else if(r===5){m+=2;continue}if(typeof r=="number")break;if(o.hasOwnProperty(r)){u===null&&(u=[]);let w=o[r];for(let I=0;I<w.length;I+=3)if(w[I]===i){u.push(r,w[I+1],w[I+2],l[m+1]);break}}m+=2}return u}function PR(o,i,l,u){return[o,!0,0,i,null,u,null,l,null,null]}function RR(o,i){let l=o.contentQueries;if(l!==null){let u=sr(null);try{for(let m=0;m<l.length;m+=2){let r=l[m],w=l[m+1];if(w!==-1){let I=o.data[w];FP(r),I.contentQueries(2,i[w],w)}}}finally{sr(u)}}}function Av(o,i){return o[sg]?o[_A][Ss]=i:o[sg]=i,o[_A]=i,i}function IE(o,i,l){FP(0);let u=sr(null);try{i(o,l)}finally{sr(u)}}function Xj(o){return o[og]||(o[og]=[])}function Yj(o){return o.cleanup||(o.cleanup=[])}function OR(o,i){let l=o[yf],u=l?l.get(fa,null):null;u&&u.handleError(i)}function IT(o,i,l,u,m){for(let r=0;r<l.length;){let w=l[r++],I=l[r++],A=l[r++],L=i[w],$=o.data[w];xR($,L,u,I,A,m)}}function kR(o,i,l){let u=CP(i,o);aj(o[Pi],u,l)}function Kj(o,i){let l=Pc(i,o),u=l[Zn];Qj(u,l);let m=l[ol];m!==null&&l[rv]===null&&(l[rv]=xT(m,l[yf])),DT(u,l,l[Is])}function Qj(o,i){for(let l=i.length;l<o.blueprint.length;l++)i.push(o.blueprint[l])}function DT(o,i,l){lT(i);try{let u=o.viewQuery;u!==null&&IE(1,u,l);let m=o.template;m!==null&&wR(o,i,m,1,l),o.firstCreatePass&&(o.firstCreatePass=!1),i[vf]?.finishViewCreation(o),o.staticContentQueries&&RR(o,i),o.staticViewQueries&&IE(2,o.viewQuery,l);let r=o.components;r!==null&&Jj(i,r)}catch(u){throw o.firstCreatePass&&(o.incompleteFirstPass=!0,o.firstCreatePass=!1),u}finally{i[vn]&=-5,cT()}}function Jj(o,i){for(let l=0;l<i.length;l++)Kj(o,i[l])}function eU(o,i,l,u){let m=sr(null);try{let r=i.tView,I=o[vn]&4096?4096:16,A=Dv(o,r,l,I,null,i,null,null,u?.injector??null,u?.embeddedViewInjector??null,u?.dehydratedView??null),L=o[i.index];A[wv]=L;let $=o[vf];return $!==null&&(A[vf]=$.createEmbeddedView(r)),DT(r,A,l),A}finally{sr(m)}}function MA(o,i){return!i||i.firstChild===null||rR(o)}function tU(o,i,l,u=!0){let m=i[Zn];if(hj(m,i,o,l),u){let w=CE(l,o),I=i[Pi],A=ET(I,o[oh]);A!==null&&cj(m,o[Ms],I,i,A,w)}let r=i[rv];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function hv(o,i,l,u,m=!1){for(;l!==null;){let r=i[l.index];r!==null&&u.push(da(r)),sl(r)&&nU(r,u);let w=l.type;if(w&8)hv(o,i,l.child,u);else if(w&32){let I=wT(l,i),A;for(;A=I();)u.push(A)}else if(w&16){let I=gR(i,l);if(Array.isArray(I))u.push(...I);else{let A=lg(i[ha]);hv(A[Zn],A,I,u,!0)}}l=m?l.projectionNext:l.next}return u}function nU(o,i){for(let l=Jo;l<o.length;l++){let u=o[l],m=u[Zn].firstChild;m!==null&&hv(u[Zn],u,m,i)}o[oh]!==o[ol]&&i.push(o[oh])}var LR=[];function rU(o){return o[ih]??iU(o)}function iU(o){let i=LR.pop()??Object.create(sU);return i.lView=o,i}function oU(o){o.lView[ih]!==o&&(o.lView=null,LR.push(o))}var sU=gr(xt({},D2),{consumerIsAlwaysLive:!0,consumerMarkedDirty:o=>{ag(o.lView)},consumerOnSignalRead(){this.lView[ih]=this}}),FR=100;function NR(o,i=!0,l=0){let u=o[ua],m=u.rendererFactory,r=!1;r||m.begin?.();try{aU(o,l)}catch(w){throw i&&OR(o,w),w}finally{r||(m.end?.(),u.inlineEffectRunner?.flush())}}function aU(o,i){DE(o,i);let l=0;for(;aT(o);){if(l===FR)throw new vt(103,!1);l++,DE(o,1)}}function lU(o,i,l,u){let m=i[vn];if((m&256)===256)return;let r=!1;!r&&i[ua].inlineEffectRunner?.flush(),lT(i);let w=null,I=null;!r&&cU(o)&&(I=rU(i),w=M2(I));try{IP(i),EV(o.bindingStartIndex),l!==null&&wR(o,i,l,2,u);let A=(m&3)===3;if(!r)if(A){let Q=o.preOrderCheckHooks;Q!==null&&X0(i,Q,null)}else{let Q=o.preOrderHooks;Q!==null&&Y0(i,Q,0,null),Xw(i,0)}if(uU(i),zR(i,0),o.contentQueries!==null&&RR(o,i),!r)if(A){let Q=o.contentCheckHooks;Q!==null&&X0(i,Q)}else{let Q=o.contentHooks;Q!==null&&Y0(i,Q,1),Xw(i,1)}Ij(o,i);let L=o.components;L!==null&&VR(i,L,0);let $=o.viewQuery;if($!==null&&IE(2,$,u),!r)if(A){let Q=o.viewCheckHooks;Q!==null&&X0(i,Q)}else{let Q=o.viewHooks;Q!==null&&Y0(i,Q,2),Xw(i,2)}if(o.firstUpdatePass===!0&&(o.firstUpdatePass=!1),i[Zw]){for(let Q of i[Zw])Q();i[Zw]=null}r||(i[vn]&=-73)}catch(A){throw ag(i),A}finally{I!==null&&(A2(I,w),oU(I)),cT()}}function cU(o){return o.type!==2}function zR(o,i){for(let l=oR(o);l!==null;l=sR(l))for(let u=Jo;u<l.length;u++){let m=l[u];BR(m,i)}}function uU(o){for(let i=oR(o);i!==null;i=sR(i)){if(!(i[vn]&iT.HasTransplantedViews))continue;let l=i[ov];for(let u=0;u<l.length;u++){let m=l[u],r=m[Ui];uV(m)}}}function hU(o,i,l){let u=Pc(i,o);BR(u,l)}function BR(o,i){sT(o)&&DE(o,i)}function DE(o,i){let u=o[Zn],m=o[vn],r=o[ih],w=!!(i===0&&m&16);if(w||=!!(m&64&&i===0),w||=!!(m&1024),w||=!!(r?.dirty&&Cw(r)),r&&(r.dirty=!1),o[vn]&=-9217,w)lU(u,o,u.template,o[Is]);else if(m&8192){zR(o,1);let I=u.components;I!==null&&VR(o,I,1)}}function VR(o,i,l){for(let u=0;u<i.length;u++)hU(o,i[u],l)}function MT(o){for(o[ua].changeDetectionScheduler?.notify();o;){o[vn]|=64;let i=lg(o);if(nV(o)&&!i)return o;o=i}return null}var ch=class{get rootNodes(){let i=this._lView,l=i[Zn];return hv(l,i,l.firstChild,[])}constructor(i,l,u=!0){this._lView=i,this._cdRefInjectingView=l,this.notifyErrorHandler=u,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Is]}set context(i){this._lView[Is]=i}get destroyed(){return(this._lView[vn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let i=this._lView[Ui];if(sl(i)){let l=i[iv],u=l?l.indexOf(this):-1;u>-1&&(TE(i,u),tv(l,u))}this._attachedToViewContainer=!1}pR(this._lView[Zn],this._lView)}onDestroy(i){DP(this._lView,i)}markForCheck(){MT(this._cdRefInjectingView||this._lView)}detach(){this._lView[vn]&=-129}reattach(){mE(this._lView),this._lView[vn]|=128}detectChanges(){this._lView[vn]|=1024,NR(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new vt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,dR(this._lView[Zn],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new vt(902,!1);this._appRef=i,mE(this._lView)}},Pv=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=pU;let o=i;return o})(),dU=Pv,fU=class extends dU{constructor(i,l,u){super(),this._declarationLView=i,this._declarationTContainer=l,this.elementRef=u}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,l){return this.createEmbeddedViewImpl(i,l)}createEmbeddedViewImpl(i,l,u){let m=eU(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:l,dehydratedView:u});return new ch(m)}};function pU(){return mU(es(),Or())}function mU(o,i){return o.type&4?new fU(i,o,Sv(o,i)):null}var VQ=new RegExp(`^(\\d+)*(${tj}|${ej})*(.*)`);var gU=()=>null;function AA(o,i){return gU(o,i)}var bf=class{},ME=class{},dv=class{};function _U(o){let i=Error(`No component factory found for ${Xi(o)}.`);return i[yU]=o,i}var yU="ngComponent";var AE=class{resolveComponentFactory(i){throw _U(i)}},Rv=(()=>{let i=class i{};i.NULL=new AE;let o=i;return o})(),uh=class{},If=(()=>{let i=class i{constructor(){this.destroyNode=null}};i.__NG_ELEMENT_ID__=()=>vU();let o=i;return o})();function vU(){let o=Or(),i=es(),l=Pc(i.index,o);return(nh(l)?l:o)[Pi]}var xU=(()=>{let i=class i{};i.\u0275prov=Gt({token:i,providedIn:"root",factory:()=>null});let o=i;return o})(),eE={};var PA=new Set;function Df(o){PA.has(o)||(PA.add(o),performance?.mark?.("mark_feature_usage",{detail:{feature:o}}))}function RA(...o){}function bU(){let o=typeof Jm.requestAnimationFrame=="function",i=Jm[o?"requestAnimationFrame":"setTimeout"],l=Jm[o?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&i&&l){let u=i[Zone.__symbol__("OriginalDelegate")];u&&(i=u);let m=l[Zone.__symbol__("OriginalDelegate")];m&&(l=m)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:l}}var Dr=class o{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:u=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Po(!1),this.onMicrotaskEmpty=new Po(!1),this.onStable=new Po(!1),this.onError=new Po(!1),typeof Zone>"u")throw new vt(908,!1);Zone.assertZonePatched();let m=this;m._nesting=0,m._outer=m._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(m._inner=m._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(m._inner=m._inner.fork(Zone.longStackTraceZoneSpec)),m.shouldCoalesceEventChangeDetection=!u&&l,m.shouldCoalesceRunChangeDetection=u,m.lastRequestAnimationFrameId=-1,m.nativeRequestAnimationFrame=bU().nativeRequestAnimationFrame,TU(m)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!o.isInAngularZone())throw new vt(909,!1)}static assertNotInAngularZone(){if(o.isInAngularZone())throw new vt(909,!1)}run(i,l,u){return this._inner.run(i,l,u)}runTask(i,l,u,m){let r=this._inner,w=r.scheduleEventTask("NgZoneEvent: "+m,i,wU,RA,RA);try{return r.runTask(w,l,u)}finally{r.cancelTask(w)}}runGuarded(i,l,u){return this._inner.runGuarded(i,l,u)}runOutsideAngular(i){return this._outer.run(i)}},wU={};function AT(o){if(o._nesting==0&&!o.hasPendingMicrotasks&&!o.isStable)try{o._nesting++,o.onMicrotaskEmpty.emit(null)}finally{if(o._nesting--,!o.hasPendingMicrotasks)try{o.runOutsideAngular(()=>o.onStable.emit(null))}finally{o.isStable=!0}}}function EU(o){o.isCheckStableRunning||o.lastRequestAnimationFrameId!==-1||(o.lastRequestAnimationFrameId=o.nativeRequestAnimationFrame.call(Jm,()=>{o.fakeTopEventTask||(o.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{o.lastRequestAnimationFrameId=-1,PE(o),o.isCheckStableRunning=!0,AT(o),o.isCheckStableRunning=!1},void 0,()=>{},()=>{})),o.fakeTopEventTask.invoke()}),PE(o))}function TU(o){let i=()=>{EU(o)};o._inner=o._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,u,m,r,w,I)=>{if(CU(I))return l.invokeTask(m,r,w,I);try{return OA(o),l.invokeTask(m,r,w,I)}finally{(o.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||o.shouldCoalesceRunChangeDetection)&&i(),kA(o)}},onInvoke:(l,u,m,r,w,I,A)=>{try{return OA(o),l.invoke(m,r,w,I,A)}finally{o.shouldCoalesceRunChangeDetection&&i(),kA(o)}},onHasTask:(l,u,m,r)=>{l.hasTask(m,r),u===m&&(r.change=="microTask"?(o._hasPendingMicrotasks=r.microTask,PE(o),AT(o)):r.change=="macroTask"&&(o.hasPendingMacrotasks=r.macroTask))},onHandleError:(l,u,m,r)=>(l.handleError(m,r),o.runOutsideAngular(()=>o.onError.emit(r)),!1)})}function PE(o){o._hasPendingMicrotasks||(o.shouldCoalesceEventChangeDetection||o.shouldCoalesceRunChangeDetection)&&o.lastRequestAnimationFrameId!==-1?o.hasPendingMicrotasks=!0:o.hasPendingMicrotasks=!1}function OA(o){o._nesting++,o.isStable&&(o.isStable=!1,o.onUnstable.emit(null))}function kA(o){o._nesting--,AT(o)}function CU(o){return!Array.isArray(o)||o.length!==1?!1:o[0].data?.__ignore_ng_zone__===!0}var df=function(o){return o[o.EarlyRead=0]="EarlyRead",o[o.Write=1]="Write",o[o.MixedReadWrite=2]="MixedReadWrite",o[o.Read=3]="Read",o}(df||{}),SU={destroy(){}};function PT(o,i){!i&&eV(PT);let l=i?.injector??Tt(mh);if(!ij(l))return SU;Df("NgAfterNextRender");let u=l.get(RT),m=u.handler??=new OE,r=i?.phase??df.MixedReadWrite,w=()=>{m.unregister(A),I()},I=l.get(mT).onDestroy(w),A=Ds(l,()=>new RE(r,()=>{w(),o()}));return m.register(A),{destroy:w}}var RE=class{constructor(i,l){this.phase=i,this.callbackFn=l,this.zone=Tt(Dr),this.errorHandler=Tt(fa,{optional:!0}),Tt(bf,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(i){this.errorHandler?.handleError(i)}}},OE=class{constructor(){this.executingCallbacks=!1,this.buckets={[df.EarlyRead]:new Set,[df.Write]:new Set,[df.MixedReadWrite]:new Set,[df.Read]:new Set},this.deferredCallbacks=new Set}register(i){(this.executingCallbacks?this.deferredCallbacks:this.buckets[i.phase]).add(i)}unregister(i){this.buckets[i.phase].delete(i),this.deferredCallbacks.delete(i)}execute(){this.executingCallbacks=!0;for(let i of Object.values(this.buckets))for(let l of i)l.invoke();this.executingCallbacks=!1;for(let i of this.deferredCallbacks)this.buckets[i.phase].add(i);this.deferredCallbacks.clear()}destroy(){for(let i of Object.values(this.buckets))i.clear();this.deferredCallbacks.clear()}},RT=(()=>{let i=class i{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let u=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let m of u)m()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};i.\u0275prov=Gt({token:i,providedIn:"root",factory:()=>new i});let o=i;return o})();function kE(o,i,l){let u=l?o.styles:null,m=l?o.classes:null,r=0;if(i!==null)for(let w=0;w<i.length;w++){let I=i[w];if(typeof I=="number")r=I;else if(r==1)m=aA(m,I);else if(r==2){let A=I,L=i[++w];u=aA(u,A+": "+L+";")}}l?o.styles=u:o.stylesWithoutHost=u,l?o.classes=m:o.classesWithoutHost=m}var fv=class extends Rv{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){let l=Cc(i);return new wf(l,this.ngModule)}};function LA(o){let i=[];for(let l in o){if(!o.hasOwnProperty(l))continue;let u=o[l];u!==void 0&&i.push({propName:Array.isArray(u)?u[0]:u,templateName:l})}return i}function IU(o){let i=o.toLowerCase();return i==="svg"?TP:i==="math"?sV:null}var LE=class{constructor(i,l){this.injector=i,this.parentInjector=l}get(i,l,u){u=xv(u);let m=this.injector.get(i,eE,u);return m!==eE||l===eE?m:this.parentInjector.get(i,l,u)}},wf=class extends dv{get inputs(){let i=this.componentDef,l=i.inputTransforms,u=LA(i.inputs);if(l!==null)for(let m of u)l.hasOwnProperty(m.propName)&&(m.transform=l[m.propName]);return u}get outputs(){return LA(this.componentDef.outputs)}constructor(i,l){super(),this.componentDef=i,this.ngModule=l,this.componentType=i.type,this.selector=z4(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!l}create(i,l,u,m){let r=sr(null);try{m=m||this.ngModule;let w=m instanceof po?m:m?.injector;w&&this.componentDef.getStandaloneInjector!==null&&(w=this.componentDef.getStandaloneInjector(w)||w);let I=w?new LE(i,w):i,A=I.get(uh,null);if(A===null)throw new vt(407,!1);let L=I.get(xU,null),$=I.get(RT,null),Q=I.get(bf,null),me={rendererFactory:A,sanitizer:L,inlineEffectRunner:null,afterRenderEventManager:$,changeDetectionScheduler:Q},he=A.createRenderer(null,this.componentDef),be=this.componentDef.selectors[0][0]||"div",Ie=u?Aj(he,u,this.componentDef.encapsulation,I):hR(he,be,IU(be)),Qe=512;this.componentDef.signals?Qe|=4096:this.componentDef.onPush||(Qe|=16);let ze=null;Ie!==null&&(ze=xT(Ie,I,!0));let nt=ST(0,null,null,1,0,null,null,null,null,null,null),ft=Dv(null,nt,null,Qe,null,null,me,he,I,null,ze);lT(ft);let Ue,Nt;try{let Yt=this.componentDef,Jt,wt=null;Yt.findHostDirectiveDefs?(Jt=[],wt=new Map,Yt.findHostDirectiveDefs(Yt,Jt,wt),Jt.push(Yt)):Jt=[Yt];let er=DU(ft,Ie),St=MU(er,Ie,Yt,Jt,ft,me,he);Nt=SP(nt,Sc),Ie&&RU(he,Yt,Ie,u),l!==void 0&&OU(Nt,this.ngContentSelectors,l),Ue=PU(St,Yt,Jt,wt,ft,[kU]),DT(nt,ft,null)}finally{cT()}return new FE(this.componentType,Ue,Sv(Nt,ft),ft,Nt)}finally{sr(r)}}},FE=class extends ME{constructor(i,l,u,m,r){super(),this.location=u,this._rootLView=m,this._tNode=r,this.previousInputValues=null,this.instance=l,this.hostView=this.changeDetectorRef=new ch(m,void 0,!1),this.componentType=i}setInput(i,l){let u=this._tNode.inputs,m;if(u!==null&&(m=u[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),l))return;let r=this._rootLView;IT(r[Zn],r,m,i,l),this.previousInputValues.set(i,l);let w=Pc(this._tNode.index,r);MT(w)}}get injector(){return new rh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}};function DU(o,i){let l=o[Zn],u=Sc;return o[u]=i,Mv(l,u,2,"#host",null)}function MU(o,i,l,u,m,r,w){let I=m[Zn];AU(u,o,i,w);let A=null;i!==null&&(A=xT(i,m[yf]));let L=r.rendererFactory.createRenderer(i,l),$=16;l.signals?$=4096:l.onPush&&($=64);let Q=Dv(m,SR(l),null,$,m[o.index],o,r,L,null,null,A);return I.firstCreatePass&&SE(I,o,u.length-1),Av(m,Q),m[o.index]=Q}function AU(o,i,l,u){for(let m of o)i.mergedAttrs=eT(i.mergedAttrs,m.hostAttrs);i.mergedAttrs!==null&&(kE(i,i.mergedAttrs,!0),l!==null&&yR(u,l,i))}function PU(o,i,l,u,m,r){let w=es(),I=m[Zn],A=As(w,m);MR(I,m,w,l,null,u);for(let $=0;$<l.length;$++){let Q=w.directiveStart+$,me=xf(m,I,Q,w);lh(me,m)}AR(I,m,w),A&&lh(A,m);let L=xf(m,I,w.directiveStart+w.componentOffset,w);if(o[Is]=m[Is]=L,r!==null)for(let $ of r)$(L,i);return ER(I,w,m),L}function RU(o,i,l,u){if(u)uE(o,l,["ng-version","17.3.11"]);else{let{attrs:m,classes:r}=B4(i.selectors[0]);m&&uE(o,l,m),r&&r.length>0&&_R(o,l,r.join(" "))}}function OU(o,i,l){let u=o.projection=[];for(let m=0;m<i.length;m++){let r=l[m];u.push(r!=null?Array.from(r):null)}}function kU(){let o=es();dT(Or()[Zn],o)}var Mf=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=LU;let o=i;return o})();function LU(){let o=es();return NU(o,Or())}var FU=Mf,jR=class extends FU{constructor(i,l,u){super(),this._lContainer=i,this._hostTNode=l,this._hostLView=u}get element(){return Sv(this._hostTNode,this._hostLView)}get injector(){return new rh(this._hostTNode,this._hostLView)}get parentInjector(){let i=fT(this._hostTNode,this._hostLView);if(qP(i)){let l=lv(i,this._hostLView),u=av(i),m=l[Zn].data[u+8];return new rh(m,l)}else return new rh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){let l=FA(this._lContainer);return l!==null&&l[i]||null}get length(){return this._lContainer.length-Jo}createEmbeddedView(i,l,u){let m,r;typeof u=="number"?m=u:u!=null&&(m=u.index,r=u.injector);let w=AA(this._lContainer,i.ssrId),I=i.createEmbeddedViewImpl(l||{},r,w);return this.insertImpl(I,m,MA(this._hostTNode,w)),I}createComponent(i,l,u,m,r){let w=i&&!tV(i),I;if(w)I=l;else{let be=l||{};I=be.index,u=be.injector,m=be.projectableNodes,r=be.environmentInjector||be.ngModuleRef}let A=w?i:new wf(Cc(i)),L=u||this.parentInjector;if(!r&&A.ngModule==null){let Ie=(w?L:this.parentInjector).get(po,null);Ie&&(r=Ie)}let $=Cc(A.componentType??{}),Q=AA(this._lContainer,$?.id??null),me=Q?.firstChild??null,he=A.create(L,m,me,r);return this.insertImpl(he.hostView,I,MA(this._hostTNode,Q)),he}insert(i,l){return this.insertImpl(i,l,!0)}insertImpl(i,l,u){let m=i._lView;if(cV(m)){let I=this.indexOf(i);if(I!==-1)this.detach(I);else{let A=m[Ui],L=new jR(A,A[Ms],A[Ui]);L.detach(L.indexOf(i))}}let r=this._adjustIndex(l),w=this._lContainer;return tU(w,m,r,u),i.attachToViewContainerRef(),tP(tE(w),r,i),i}move(i,l){return this.insert(i,l)}indexOf(i){let l=FA(this._lContainer);return l!==null?l.indexOf(i):-1}remove(i){let l=this._adjustIndex(i,-1),u=TE(this._lContainer,l);u&&(tv(tE(this._lContainer),l),pR(u[Zn],u))}detach(i){let l=this._adjustIndex(i,-1),u=TE(this._lContainer,l);return u&&tv(tE(this._lContainer),l)!=null?new ch(u):null}_adjustIndex(i,l=0){return i??this.length+l}};function FA(o){return o[iv]}function tE(o){return o[iv]||(o[iv]=[])}function NU(o,i){let l,u=i[o.index];return sl(u)?l=u:(l=PR(u,i,null,o),i[o.index]=l,Av(i,l)),BU(l,i,o,u),new jR(l,o,i)}function zU(o,i){let l=o[Pi],u=l.createComment(""),m=As(i,o),r=ET(l,m);return uv(l,r,u,yj(l,m),!1),u}var BU=UU,VU=()=>!1;function jU(o,i,l){return VU(o,i,l)}function UU(o,i,l,u){if(o[oh])return;let m;l.type&8?m=da(u):m=zU(i,l),o[oh]=m}var Ic=class{},cg=class{};var NE=class extends Ic{constructor(i,l,u){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new fv(this);let m=cP(i);this._bootstrapComponents=uR(m.bootstrap),this._r3Injector=tR(i,l,[{provide:Ic,useValue:this},{provide:Rv,useValue:this.componentFactoryResolver},...u],Xi(i),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(i)}get injector(){return this._r3Injector}destroy(){let i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}},zE=class extends cg{constructor(i){super(),this.moduleType=i}create(i){return new NE(this.moduleType,i,[])}};var pv=class extends Ic{constructor(i){super(),this.componentFactoryResolver=new fv(this),this.instance=null;let l=new ig([...i.providers,{provide:Ic,useValue:this},{provide:Rv,useValue:this.componentFactoryResolver}],i.parent||rT(),i.debugName,new Set(["environment"]));this.injector=l,i.runEnvironmentInitializers&&l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}};function OT(o,i,l=null){return new pv({providers:o,parent:i,debugName:l,runEnvironmentInitializers:!0}).injector}var _h=(()=>{let i=class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new pi(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let u=this.taskId++;return this.pendingTasks.add(u),u}remove(u){this.pendingTasks.delete(u),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function UR(o){return kT(o)?Array.isArray(o)||!(o instanceof Map)&&Symbol.iterator in o:!1}function $U(o,i){if(Array.isArray(o))for(let l=0;l<o.length;l++)i(o[l]);else{let l=o[Symbol.iterator](),u;for(;!(u=l.next()).done;)i(u.value)}}function kT(o){return o!==null&&(typeof o=="function"||typeof o=="object")}function GU(o,i,l){return o[i]=l}function hh(o,i,l){let u=o[i];return Object.is(u,l)?!1:(o[i]=l,!0)}function HU(o,i,l,u){let m=hh(o,i,l);return hh(o,i+1,u)||m}function qU(o,i,l,u,m){let r=HU(o,i,l,u);return hh(o,i+2,m)||r}function WU(o){return(o.flags&32)===32}function ZU(o,i,l,u,m,r,w,I,A){let L=i.consts,$=Mv(i,o,4,w||null,sv(L,I));DR(i,l,$,sv(L,A)),dT(i,$);let Q=$.tView=ST(2,$,u,m,r,i.directiveRegistry,i.pipeRegistry,null,i.schemas,L,null);return i.queries!==null&&(i.queries.template(i,$),Q.queries=i.queries.embeddedTView($)),$}function mg(o,i,l,u,m,r,w,I){let A=Or(),L=Ps(),$=o+Sc,Q=L.firstCreatePass?ZU($,L,A,i,l,u,m,r,w):L.data[$];pg(Q,!1);let me=XU(L,A,Q,o);uT()&&TT(L,A,me,Q),lh(me,A);let he=PR(me,A,me,Q);return A[$]=he,Av(A,he),jU(he,Q,A),oT(Q)&&TR(L,A,Q),w!=null&&CR(A,Q,I),mg}var XU=YU;function YU(o,i,l,u){return hT(!0),i[Pi].createComment("")}function $R(o,i,l,u){return hh(o,kP(),l)?i+tg(l)+u:ma}function KU(o,i,l,u,m,r,w,I){let A=wV(),L=qU(o,A,l,m,w);return LP(3),L?i+tg(l)+u+tg(m)+r+tg(w)+I:ma}function W0(o,i){return o<<17|i<<2}function dh(o){return o>>17&32767}function QU(o){return(o&2)==2}function JU(o,i){return o&131071|i<<17}function BE(o){return o|2}function Ef(o){return(o&131068)>>2}function nE(o,i){return o&-131069|i<<2}function e6(o){return(o&1)===1}function VE(o){return o|1}function t6(o,i,l,u,m,r){let w=r?i.classBindings:i.styleBindings,I=dh(w),A=Ef(w);o[u]=l;let L=!1,$;if(Array.isArray(l)){let Q=l;$=Q[1],($===null||fg(Q,$)>0)&&(L=!0)}else $=l;if(m)if(A!==0){let me=dh(o[I+1]);o[u+1]=W0(me,I),me!==0&&(o[me+1]=nE(o[me+1],u)),o[I+1]=JU(o[I+1],u)}else o[u+1]=W0(I,0),I!==0&&(o[I+1]=nE(o[I+1],u)),I=u;else o[u+1]=W0(A,0),I===0?I=u:o[A+1]=nE(o[A+1],u),A=u;L&&(o[u+1]=BE(o[u+1])),NA(o,$,u,!0),NA(o,$,u,!1),n6(i,$,o,u,r),w=W0(I,A),r?i.classBindings=w:i.styleBindings=w}function n6(o,i,l,u,m){let r=m?o.residualClasses:o.residualStyles;r!=null&&typeof i=="string"&&fg(r,i)>=0&&(l[u+1]=VE(l[u+1]))}function NA(o,i,l,u){let m=o[l+1],r=i===null,w=u?dh(m):Ef(m),I=!1;for(;w!==0&&(I===!1||r);){let A=o[w],L=o[w+1];r6(A,i)&&(I=!0,o[w+1]=u?VE(L):BE(L)),w=u?dh(L):Ef(L)}I&&(o[l+1]=u?BE(m):VE(m))}function r6(o,i){return o===null||i==null||(Array.isArray(o)?o[1]:o)===i?!0:Array.isArray(o)&&typeof i=="string"?fg(o,i)>=0:!1}function mo(o,i,l){let u=Or(),m=kP();if(hh(u,m,i)){let r=Ps(),w=UP();IR(r,w,u,o,i,u[Pi],l,!1)}return mo}function zA(o,i,l,u,m){let r=i.inputs,w=m?"class":"style";IT(o,l,r[w],w,u)}function Af(o,i,l){return i6(o,i,l,!1),Af}function i6(o,i,l,u){let m=Or(),r=Ps(),w=LP(2);if(r.firstUpdatePass&&s6(r,o,w,u),i!==ma&&hh(m,w,i)){let I=r.data[ph()];h6(r,I,m,m[Pi],o,m[w+1]=d6(i,l),u,w)}}function o6(o,i){return i>=o.expandoStartIndex}function s6(o,i,l,u){let m=o.data;if(m[l+1]===null){let r=m[ph()],w=o6(o,l);f6(r,u)&&i===null&&!w&&(i=!1),i=a6(m,r,i,u),t6(m,r,i,l,w,u)}}function a6(o,i,l,u){let m=IV(o),r=u?i.residualClasses:i.residualStyles;if(m===null)(u?i.classBindings:i.styleBindings)===0&&(l=rE(null,o,i,l,u),l=ug(l,i.attrs,u),r=null);else{let w=i.directiveStylingLast;if(w===-1||o[w]!==m)if(l=rE(m,o,i,l,u),r===null){let A=l6(o,i,u);A!==void 0&&Array.isArray(A)&&(A=rE(null,o,i,A[1],u),A=ug(A,i.attrs,u),c6(o,i,u,A))}else r=u6(o,i,u)}return r!==void 0&&(u?i.residualClasses=r:i.residualStyles=r),l}function l6(o,i,l){let u=l?i.classBindings:i.styleBindings;if(Ef(u)!==0)return o[dh(u)]}function c6(o,i,l,u){let m=l?i.classBindings:i.styleBindings;o[dh(m)]=u}function u6(o,i,l){let u,m=i.directiveEnd;for(let r=1+i.directiveStylingLast;r<m;r++){let w=o[r].hostAttrs;u=ug(u,w,l)}return ug(u,i.attrs,l)}function rE(o,i,l,u,m){let r=null,w=l.directiveEnd,I=l.directiveStylingLast;for(I===-1?I=l.directiveStart:I++;I<w&&(r=i[I],u=ug(u,r.hostAttrs,m),r!==o);)I++;return o!==null&&(l.directiveStylingLast=I),u}function ug(o,i,l){let u=l?1:2,m=-1;if(i!==null)for(let r=0;r<i.length;r++){let w=i[r];typeof w=="number"?m=w:m===u&&(Array.isArray(o)||(o=o===void 0?[]:["",o]),C4(o,w,l?!0:i[++r]))}return o===void 0?null:o}function h6(o,i,l,u,m,r,w,I){if(!(i.type&3))return;let A=o.data,L=A[I+1],$=e6(L)?BA(A,i,l,m,Ef(L),w):void 0;if(!mv($)){mv(r)||QU(L)&&(r=BA(A,null,l,m,I,w));let Q=CP(ph(),l);Cj(u,w,Q,m,r)}}function BA(o,i,l,u,m,r){let w=i===null,I;for(;m>0;){let A=o[m],L=Array.isArray(A),$=L?A[1]:A,Q=$===null,me=l[m+1];me===ma&&(me=Q?Cs:void 0);let he=Q?qw(me,u):$===u?me:void 0;if(L&&!mv(he)&&(he=qw(A,u)),mv(he)&&(I=he,w))return I;let be=o[m+1];m=w?dh(be):Ef(be)}if(i!==null){let A=r?i.residualClasses:i.residualStyles;A!=null&&(I=qw(A,u))}return I}function mv(o){return o!==void 0}function d6(o,i){return o==null||o===""||(typeof i=="string"?o=o+i:typeof o=="object"&&(o=Xi(bT(o)))),o}function f6(o,i){return(o.flags&(i?8:16))!==0}function p6(o,i,l,u,m,r){let w=i.consts,I=sv(w,m),A=Mv(i,o,2,u,I);return DR(i,l,A,sv(w,r)),A.attrs!==null&&kE(A,A.attrs,!1),A.mergedAttrs!==null&&kE(A,A.mergedAttrs,!0),i.queries!==null&&i.queries.elementStart(i,A),A}function jn(o,i,l,u){let m=Or(),r=Ps(),w=Sc+o,I=m[Pi],A=r.firstCreatePass?p6(w,r,m,i,l,u):r.data[w],L=m6(r,m,A,I,i,o);m[w]=L;let $=oT(A);return pg(A,!0),yR(I,L,A),!WU(A)&&uT()&&TT(r,m,L,A),fV()===0&&lh(L,m),pV(),$&&(TR(r,m,A),ER(r,A,m)),u!==null&&CR(m,A),jn}function Un(){let o=es();OP()?xV():(o=o.parent,pg(o,!1));let i=o;_V(i)&&yV(),mV();let l=Ps();return l.firstCreatePass&&(dT(l,o),vP(o)&&l.queries.elementEnd(o)),i.classesWithoutHost!=null&&kV(i)&&zA(l,i,Or(),i.classesWithoutHost,!0),i.stylesWithoutHost!=null&&LV(i)&&zA(l,i,Or(),i.stylesWithoutHost,!1),Un}function Cr(o,i,l,u){return jn(o,i,l,u),Un(),Cr}var m6=(o,i,l,u,m,r)=>(hT(!0),hR(u,m,AV()));function GR(){return Or()}var gv="en-US";var g6=gv;function _6(o){typeof o=="string"&&(g6=o.toLowerCase().replace(/_/g,"-"))}function qr(o,i,l,u){let m=Or(),r=Ps(),w=es();return v6(r,m,m[Pi],w,o,i,u),qr}function y6(o,i,l,u){let m=o.cleanup;if(m!=null)for(let r=0;r<m.length-1;r+=2){let w=m[r];if(w===l&&m[r+1]===u){let I=i[og],A=m[r+2];return I.length>A?I[A]:null}typeof w=="string"&&(r+=2)}return null}function v6(o,i,l,u,m,r,w){let I=oT(u),L=o.firstCreatePass&&Yj(o),$=i[Is],Q=Xj(i),me=!0;if(u.type&3||w){let Ie=As(u,i),Qe=w?w(Ie):Ie,ze=Q.length,nt=w?Ue=>w(da(Ue[u.index])):u.index,ft=null;if(!w&&I&&(ft=y6(o,i,m,u.index)),ft!==null){let Ue=ft.__ngLastListenerFn__||ft;Ue.__ngNextListenerFn__=r,ft.__ngLastListenerFn__=r,me=!1}else{r=jA(u,i,$,r,!1);let Ue=l.listen(Qe,m,r);Q.push(r,Ue),L&&L.push(m,nt,ze,ze+1)}}else r=jA(u,i,$,r,!1);let he=u.outputs,be;if(me&&he!==null&&(be=he[m])){let Ie=be.length;if(Ie)for(let Qe=0;Qe<Ie;Qe+=2){let ze=be[Qe],nt=be[Qe+1],Nt=i[ze][nt].subscribe(r),Yt=Q.length;Q.push(r,Nt),L&&L.push(m,u.index,Yt,-(Yt+1))}}}function VA(o,i,l,u){let m=sr(null);try{return sa(6,i,l),l(u)!==!1}catch(r){return OR(o,r),!1}finally{sa(7,i,l),sr(m)}}function jA(o,i,l,u,m){return function r(w){if(w===Function)return u;let I=o.componentOffset>-1?Pc(o.index,i):i;MT(I);let A=VA(i,l,u,w),L=r.__ngNextListenerFn__;for(;L;)A=VA(i,l,L,w)&&A,L=L.__ngNextListenerFn__;return m&&A===!1&&w.preventDefault(),A}}function HR(o=1){return MV(o)}function LT(o,i,l){return qR(o,"",i,"",l),LT}function qR(o,i,l,u,m){let r=Or(),w=$R(r,i,l,u);if(w!==ma){let I=Ps(),A=UP();IR(I,A,r,o,w,r[Pi],m,!1)}return qR}function Wr(o,i=""){let l=Or(),u=Ps(),m=o+Sc,r=u.firstCreatePass?Mv(u,m,1,i,null):u.data[m],w=x6(u,l,r,i,o);l[m]=w,uT()&&TT(u,l,w,r),pg(r,!1)}var x6=(o,i,l,u,m)=>(hT(!0),sj(i[Pi],u));function Rc(o,i,l){let u=Or(),m=$R(u,o,i,l);return m!==ma&&kR(u,ph(),m),Rc}function FT(o,i,l,u,m,r,w){let I=Or(),A=KU(I,o,i,l,u,m,r,w);return A!==ma&&kR(I,ph(),A),FT}function b6(o,i,l){let u=Ps();if(u.firstCreatePass){let m=Sf(o);jE(l,u.data,u.blueprint,m,!0),jE(i,u.data,u.blueprint,m,!1)}}function jE(o,i,l,u,m){if(o=Zi(o),Array.isArray(o))for(let r=0;r<o.length;r++)jE(o[r],i,l,u,m);else{let r=Ps(),w=Or(),I=es(),A=_f(o)?o:Zi(o.provide),L=mP(o),$=I.providerIndexes&1048575,Q=I.directiveStart,me=I.providerIndexes>>20;if(_f(o)||!o.multi){let he=new ah(L,m,_r),be=oE(A,i,m?$:$+me,Q);be===-1?(yE(cv(I,w),r,A),iE(r,o,i.length),i.push(A),I.directiveStart++,I.directiveEnd++,m&&(I.providerIndexes+=1048576),l.push(he),w.push(he)):(l[be]=he,w[be]=he)}else{let he=oE(A,i,$+me,Q),be=oE(A,i,$,$+me),Ie=he>=0&&l[he],Qe=be>=0&&l[be];if(m&&!Qe||!m&&!Ie){yE(cv(I,w),r,A);let ze=T6(m?E6:w6,l.length,m,u,L);!m&&Qe&&(l[be].providerFactory=ze),iE(r,o,i.length,0),i.push(A),I.directiveStart++,I.directiveEnd++,m&&(I.providerIndexes+=1048576),l.push(ze),w.push(ze)}else{let ze=WR(l[m?be:he],L,!m&&u);iE(r,o,he>-1?he:be,ze)}!m&&u&&Qe&&l[be].componentProviders++}}}function iE(o,i,l,u){let m=_f(i),r=W4(i);if(m||r){let A=(r?Zi(i.useClass):i).prototype.ngOnDestroy;if(A){let L=o.destroyHooks||(o.destroyHooks=[]);if(!m&&i.multi){let $=L.indexOf(l);$===-1?L.push(l,[u,A]):L[$+1].push(u,A)}else L.push(l,A)}}}function WR(o,i,l){return l&&o.componentProviders++,o.multi.push(i)-1}function oE(o,i,l,u){for(let m=l;m<u;m++)if(i[m]===o)return m;return-1}function w6(o,i,l,u){return UE(this.multi,[])}function E6(o,i,l,u){let m=this.multi,r;if(this.providerFactory){let w=this.providerFactory.componentProviders,I=xf(l,l[Zn],this.providerFactory.index,u);r=I.slice(0,w),UE(m,r);for(let A=w;A<I.length;A++)r.push(I[A])}else r=[],UE(m,r);return r}function UE(o,i){for(let l=0;l<o.length;l++){let u=o[l];i.push(u())}return i}function T6(o,i,l,u,m){let r=new ah(o,l,_r);return r.multi=[],r.index=i,r.componentProviders=0,WR(r,m,u&&!l),r}function ZR(o,i=[]){return l=>{l.providersResolver=(u,m)=>b6(u,m?m(o):o,i)}}var C6=(()=>{let i=class i{constructor(u){this._injector=u,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(u){if(!u.standalone)return null;if(!this.cachedInjectors.has(u)){let m=dP(!1,u.type),r=m.length>0?OT([m],this._injector,`Standalone[${u.type.name}]`):null;this.cachedInjectors.set(u,r)}return this.cachedInjectors.get(u)}ngOnDestroy(){try{for(let u of this.cachedInjectors.values())u!==null&&u.destroy()}finally{this.cachedInjectors.clear()}}};i.\u0275prov=Gt({token:i,providedIn:"environment",factory:()=>new i(dn(po))});let o=i;return o})();function _i(o){Df("NgStandalone"),o.getStandaloneInjector=i=>i.get(C6).getOrCreateStandaloneInjector(o)}function gg(o,i,l,u){return I6(Or(),bV(),o,i,l,u)}function S6(o,i){let l=o[i];return l===ma?void 0:l}function I6(o,i,l,u,m,r){let w=i+l;return hh(o,w,m)?GU(o,w+1,r?u.call(r,m):u(m)):S6(o,w+1)}var Ov=(()=>{let i=class i{log(u){console.log(u)}warn(u){console.warn(u)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"platform"});let o=i;return o})();var XR=new mn("");function _g(o){return!!o&&typeof o.then=="function"}function YR(o){return!!o&&typeof o.subscribe=="function"}var KR=new mn(""),QR=(()=>{let i=class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((u,m)=>{this.resolve=u,this.reject=m}),this.appInits=Tt(KR,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let u=[];for(let r of this.appInits){let w=r();if(_g(w))u.push(w);else if(YR(w)){let I=new Promise((A,L)=>{w.subscribe({complete:A,error:L})});u.push(I)}}let m=()=>{this.done=!0,this.resolve()};Promise.all(u).then(()=>{m()}).catch(r=>{this.reject(r)}),u.length===0&&m(),this.initialized=!0}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),kv=new mn("");function D6(){R2(()=>{throw new vt(600,!1)})}function M6(o){return o.isBoundToModule}function A6(o,i,l){try{let u=l();return _g(u)?u.catch(m=>{throw i.runOutsideAngular(()=>o.handleError(m)),m}):u}catch(u){throw i.runOutsideAngular(()=>o.handleError(u)),u}}var Pf=(()=>{let i=class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Tt(nR),this.afterRenderEffectManager=Tt(RT),this.externalTestViews=new Set,this.beforeRender=new Ai,this.afterTick=new Ai,this.componentTypes=[],this.components=[],this.isStable=Tt(_h).hasPendingTasks.pipe(On(u=>!u)),this._injector=Tt(po)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(u,m){let r=u instanceof dv;if(!this._injector.get(QR).done){let he=!r&&lP(u),be=!1;throw new vt(405,be)}let I;r?I=u:I=this._injector.get(Rv).resolveComponentFactory(u),this.componentTypes.push(I.componentType);let A=M6(I)?void 0:this._injector.get(Ic),L=m||I.selector,$=I.create(mh.NULL,[],L,A),Q=$.location.nativeElement,me=$.injector.get(XR,null);return me?.registerApplication(Q),$.onDestroy(()=>{this.detachView($.hostView),sE(this.components,$),me?.unregisterApplication(Q)}),this._loadComponent($),$}tick(){this._tick(!0)}_tick(u){if(this._runningTick)throw new vt(101,!1);let m=sr(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(u)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,sr(m)}}detectChangesInAttachedViews(u){let m=0,r=this.afterRenderEffectManager;for(;;){if(m===FR)throw new vt(103,!1);if(u){let w=m===0;this.beforeRender.next(w);for(let{_lView:I,notifyErrorHandler:A}of this._views)P6(I,w,A)}if(m++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>$E(w))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>$E(w))))break}}attachView(u){let m=u;this._views.push(m),m.attachToAppRef(this)}detachView(u){let m=u;sE(this._views,m),m.detachFromAppRef()}_loadComponent(u){this.attachView(u.hostView),this.tick(),this.components.push(u);let m=this._injector.get(kv,[]);[...this._bootstrapListeners,...m].forEach(r=>r(u))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(u=>u()),this._views.slice().forEach(u=>u.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(u){return this._destroyListeners.push(u),()=>sE(this._destroyListeners,u)}destroy(){if(this._destroyed)throw new vt(406,!1);let u=this._injector;u.destroy&&!u.destroyed&&u.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function sE(o,i){let l=o.indexOf(i);l>-1&&o.splice(l,1)}function P6(o,i,l){!i&&!$E(o)||R6(o,l,i)}function $E(o){return aT(o)}function R6(o,i,l){let u;l?(u=0,o[vn]|=1024):o[vn]&64?u=0:u=1,NR(o,i,u)}var GE=class{constructor(i,l){this.ngModuleFactory=i,this.componentFactories=l}},NT=(()=>{let i=class i{compileModuleSync(u){return new zE(u)}compileModuleAsync(u){return Promise.resolve(this.compileModuleSync(u))}compileModuleAndAllComponentsSync(u){let m=this.compileModuleSync(u),r=cP(u),w=uR(r.declarations).reduce((I,A)=>{let L=Cc(A);return L&&I.push(new wf(L)),I},[]);return new GE(m,w)}compileModuleAndAllComponentsAsync(u){return Promise.resolve(this.compileModuleAndAllComponentsSync(u))}clearCache(){}clearCacheFor(u){}getModuleId(u){}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var O6=(()=>{let i=class i{constructor(){this.zone=Tt(Dr),this.applicationRef=Tt(Pf)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function k6(o){return[{provide:Dr,useFactory:o},{provide:gf,multi:!0,useFactory:()=>{let i=Tt(O6,{optional:!0});return()=>i.initialize()}},{provide:gf,multi:!0,useFactory:()=>{let i=Tt(z6);return()=>{i.initialize()}}},{provide:nR,useFactory:L6}]}function L6(){let o=Tt(Dr),i=Tt(fa);return l=>o.runOutsideAngular(()=>i.handleError(l))}function F6(o){let i=k6(()=>new Dr(N6(o)));return Ac([[],i])}function N6(o){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:o?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:o?.runCoalescing??!1}}var z6=(()=>{let i=class i{constructor(){this.subscription=new fi,this.initialized=!1,this.zone=Tt(Dr),this.pendingTasks=Tt(_h)}initialize(){if(this.initialized)return;this.initialized=!0;let u=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(u=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Dr.assertNotInAngularZone(),queueMicrotask(()=>{u!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(u),u=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Dr.assertInAngularZone(),u??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function B6(){return typeof $localize<"u"&&$localize.locale||gv}var zT=new mn("",{providedIn:"root",factory:()=>Tt(zT,Vn.Optional|Vn.SkipSelf)||B6()});var JR=new mn("");var Q0=null;function V6(o=[],i){return mh.create({name:i,providers:[{provide:bv,useValue:"platform"},{provide:JR,useValue:new Set([()=>Q0=null])},...o]})}function j6(o=[]){if(Q0)return Q0;let i=V6(o);return Q0=i,D6(),U6(i),i}function U6(o){o.get(_T,null)?.forEach(l=>l())}var yg=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=$6;let o=i;return o})();function $6(o){return G6(es(),Or(),(o&16)===16)}function G6(o,i,l){if(Tv(o)&&!l){let u=Pc(o.index,i);return new ch(u,u)}else if(o.type&47){let u=i[ha];return new ch(u,i)}return null}var HE=class{constructor(){}supports(i){return UR(i)}create(i){return new qE(i)}},H6=(o,i)=>i,qE=class{constructor(i){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=i||H6}forEachItem(i){let l;for(l=this._itHead;l!==null;l=l._next)i(l)}forEachOperation(i){let l=this._itHead,u=this._removalsHead,m=0,r=null;for(;l||u;){let w=!u||l&&l.currentIndex<UA(u,m,r)?l:u,I=UA(w,m,r),A=w.currentIndex;if(w===u)m--,u=u._nextRemoved;else if(l=l._next,w.previousIndex==null)m++;else{r||(r=[]);let L=I-m,$=A-m;if(L!=$){for(let me=0;me<L;me++){let he=me<r.length?r[me]:r[me]=0,be=he+me;$<=be&&be<L&&(r[me]=he+1)}let Q=w.previousIndex;r[Q]=$-L}}I!==A&&i(w,I,A)}}forEachPreviousItem(i){let l;for(l=this._previousItHead;l!==null;l=l._nextPrevious)i(l)}forEachAddedItem(i){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)i(l)}forEachMovedItem(i){let l;for(l=this._movesHead;l!==null;l=l._nextMoved)i(l)}forEachRemovedItem(i){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)i(l)}forEachIdentityChange(i){let l;for(l=this._identityChangesHead;l!==null;l=l._nextIdentityChange)i(l)}diff(i){if(i==null&&(i=[]),!UR(i))throw new vt(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let l=this._itHead,u=!1,m,r,w;if(Array.isArray(i)){this.length=i.length;for(let I=0;I<this.length;I++)r=i[I],w=this._trackByFn(I,r),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,r,w,I),u=!0):(u&&(l=this._verifyReinsertion(l,r,w,I)),Object.is(l.item,r)||this._addIdentityChange(l,r)),l=l._next}else m=0,$U(i,I=>{w=this._trackByFn(m,I),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,I,w,m),u=!0):(u&&(l=this._verifyReinsertion(l,I,w,m)),Object.is(l.item,I)||this._addIdentityChange(l,I)),l=l._next,m++}),this.length=m;return this._truncate(l),this.collection=i,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let i;for(i=this._previousItHead=this._itHead;i!==null;i=i._next)i._nextPrevious=i._next;for(i=this._additionsHead;i!==null;i=i._nextAdded)i.previousIndex=i.currentIndex;for(this._additionsHead=this._additionsTail=null,i=this._movesHead;i!==null;i=i._nextMoved)i.previousIndex=i.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(i,l,u,m){let r;return i===null?r=this._itTail:(r=i._prev,this._remove(i)),i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(u,null),i!==null?(Object.is(i.item,l)||this._addIdentityChange(i,l),this._reinsertAfter(i,r,m)):(i=this._linkedRecords===null?null:this._linkedRecords.get(u,m),i!==null?(Object.is(i.item,l)||this._addIdentityChange(i,l),this._moveAfter(i,r,m)):i=this._addAfter(new WE(l,u),r,m)),i}_verifyReinsertion(i,l,u,m){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(u,null);return r!==null?i=this._reinsertAfter(r,i._prev,m):i.currentIndex!=m&&(i.currentIndex=m,this._addToMoves(i,m)),i}_truncate(i){for(;i!==null;){let l=i._next;this._addToRemovals(this._unlink(i)),i=l}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(i,l,u){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(i);let m=i._prevRemoved,r=i._nextRemoved;return m===null?this._removalsHead=r:m._nextRemoved=r,r===null?this._removalsTail=m:r._prevRemoved=m,this._insertAfter(i,l,u),this._addToMoves(i,u),i}_moveAfter(i,l,u){return this._unlink(i),this._insertAfter(i,l,u),this._addToMoves(i,u),i}_addAfter(i,l,u){return this._insertAfter(i,l,u),this._additionsTail===null?this._additionsTail=this._additionsHead=i:this._additionsTail=this._additionsTail._nextAdded=i,i}_insertAfter(i,l,u){let m=l===null?this._itHead:l._next;return i._next=m,i._prev=l,m===null?this._itTail=i:m._prev=i,l===null?this._itHead=i:l._next=i,this._linkedRecords===null&&(this._linkedRecords=new _v),this._linkedRecords.put(i),i.currentIndex=u,i}_remove(i){return this._addToRemovals(this._unlink(i))}_unlink(i){this._linkedRecords!==null&&this._linkedRecords.remove(i);let l=i._prev,u=i._next;return l===null?this._itHead=u:l._next=u,u===null?this._itTail=l:u._prev=l,i}_addToMoves(i,l){return i.previousIndex===l||(this._movesTail===null?this._movesTail=this._movesHead=i:this._movesTail=this._movesTail._nextMoved=i),i}_addToRemovals(i){return this._unlinkedRecords===null&&(this._unlinkedRecords=new _v),this._unlinkedRecords.put(i),i.currentIndex=null,i._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=i,i._prevRemoved=null):(i._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=i),i}_addIdentityChange(i,l){return i.item=l,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=i:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=i,i}},WE=class{constructor(i,l){this.item=i,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},ZE=class{constructor(){this._head=null,this._tail=null}add(i){this._head===null?(this._head=this._tail=i,i._nextDup=null,i._prevDup=null):(this._tail._nextDup=i,i._prevDup=this._tail,i._nextDup=null,this._tail=i)}get(i,l){let u;for(u=this._head;u!==null;u=u._nextDup)if((l===null||l<=u.currentIndex)&&Object.is(u.trackById,i))return u;return null}remove(i){let l=i._prevDup,u=i._nextDup;return l===null?this._head=u:l._nextDup=u,u===null?this._tail=l:u._prevDup=l,this._head===null}},_v=class{constructor(){this.map=new Map}put(i){let l=i.trackById,u=this.map.get(l);u||(u=new ZE,this.map.set(l,u)),u.add(i)}get(i,l){let u=i,m=this.map.get(u);return m?m.get(i,l):null}remove(i){let l=i.trackById;return this.map.get(l).remove(i)&&this.map.delete(l),i}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function UA(o,i,l){let u=o.previousIndex;if(u===null)return u;let m=0;return l&&u<l.length&&(m=l[u]),u+i+m}var XE=class{constructor(){}supports(i){return i instanceof Map||kT(i)}create(){return new YE}},YE=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(i){let l;for(l=this._mapHead;l!==null;l=l._next)i(l)}forEachPreviousItem(i){let l;for(l=this._previousMapHead;l!==null;l=l._nextPrevious)i(l)}forEachChangedItem(i){let l;for(l=this._changesHead;l!==null;l=l._nextChanged)i(l)}forEachAddedItem(i){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)i(l)}forEachRemovedItem(i){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)i(l)}diff(i){if(!i)i=new Map;else if(!(i instanceof Map||kT(i)))throw new vt(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(i,(u,m)=>{if(l&&l.key===m)this._maybeAddToChanges(l,u),this._appendAfter=l,l=l._next;else{let r=this._getOrCreateRecordForKey(m,u);l=this._insertBeforeOrAppend(l,r)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let u=l;u!==null;u=u._nextRemoved)u===this._mapHead&&(this._mapHead=null),this._records.delete(u.key),u._nextRemoved=u._next,u.previousValue=u.currentValue,u.currentValue=null,u._prev=null,u._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(i,l){if(i){let u=i._prev;return l._next=i,l._prev=u,i._prev=l,u&&(u._next=l),i===this._mapHead&&(this._mapHead=l),this._appendAfter=i,i}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(i,l){if(this._records.has(i)){let m=this._records.get(i);this._maybeAddToChanges(m,l);let r=m._prev,w=m._next;return r&&(r._next=w),w&&(w._prev=r),m._next=null,m._prev=null,m}let u=new KE(i);return this._records.set(i,u),u.currentValue=l,this._addToAdditions(u),u}_reset(){if(this.isDirty){let i;for(this._previousMapHead=this._mapHead,i=this._previousMapHead;i!==null;i=i._next)i._nextPrevious=i._next;for(i=this._changesHead;i!==null;i=i._nextChanged)i.previousValue=i.currentValue;for(i=this._additionsHead;i!=null;i=i._nextAdded)i.previousValue=i.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(i,l){Object.is(l,i.currentValue)||(i.previousValue=i.currentValue,i.currentValue=l,this._addToChanges(i))}_addToAdditions(i){this._additionsHead===null?this._additionsHead=this._additionsTail=i:(this._additionsTail._nextAdded=i,this._additionsTail=i)}_addToChanges(i){this._changesHead===null?this._changesHead=this._changesTail=i:(this._changesTail._nextChanged=i,this._changesTail=i)}_forEach(i,l){i instanceof Map?i.forEach(l):Object.keys(i).forEach(u=>l(i[u],u))}},KE=class{constructor(i){this.key=i,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function $A(){return new BT([new HE])}var BT=(()=>{let i=class i{constructor(u){this.factories=u}static create(u,m){if(m!=null){let r=m.factories.slice();u=u.concat(r)}return new i(u)}static extend(u){return{provide:i,useFactory:m=>i.create(u,m||$A()),deps:[[i,new dg,new Tf]]}}find(u){let m=this.factories.find(r=>r.supports(u));if(m!=null)return m;throw new vt(901,!1)}};i.\u0275prov=Gt({token:i,providedIn:"root",factory:$A});let o=i;return o})();function GA(){return new Lv([new XE])}var Lv=(()=>{let i=class i{constructor(u){this.factories=u}static create(u,m){if(m){let r=m.factories.slice();u=u.concat(r)}return new i(u)}static extend(u){return{provide:i,useFactory:m=>i.create(u,m||GA()),deps:[[i,new dg,new Tf]]}}find(u){let m=this.factories.find(r=>r.supports(u));if(m)return m;throw new vt(901,!1)}};i.\u0275prov=Gt({token:i,providedIn:"root",factory:GA});let o=i;return o})();function eO(o){try{let{rootComponent:i,appProviders:l,platformProviders:u}=o,m=j6(u),r=[F6(),...l||[]],I=new pv({providers:r,parent:m,debugName:"",runEnvironmentInitializers:!1}).injector,A=I.get(Dr);return A.run(()=>{I.resolveInjectorInitializers();let L=I.get(fa,null),$;A.runOutsideAngular(()=>{$=A.onError.subscribe({next:he=>{L.handleError(he)}})});let Q=()=>I.destroy(),me=m.get(JR);return me.add(Q),I.onDestroy(()=>{$.unsubscribe(),me.delete(Q)}),A6(L,A,()=>{let he=I.get(QR);return he.runInitializers(),he.donePromise.then(()=>{let be=I.get(zT,gv);_6(be||gv);let Ie=I.get(Pf);return i!==void 0&&Ie.bootstrap(i),Ie})})})}catch(i){return Promise.reject(i)}}function tO(o){let i=Cc(o);if(!i)return null;let l=new wf(i);return{get selector(){return l.selector},get type(){return l.componentType},get inputs(){return l.inputs},get outputs(){return l.outputs},get ngContentSelectors(){return l.ngContentSelectors},get isStandalone(){return i.standalone},get isSignal(){return i.signals}}}var lO=null;function Rf(){return lO}function cO(o){lO??=o}var Fv=class{};var Zr=new mn(""),uO=(()=>{let i=class i{historyGo(u){throw new Error("")}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>Tt(X6),providedIn:"platform"});let o=i;return o})();var X6=(()=>{let i=class i extends uO{constructor(){super(),this._doc=Tt(Zr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Rf().getBaseHref(this._doc)}onPopState(u){let m=Rf().getGlobalEventTarget(this._doc,"window");return m.addEventListener("popstate",u,!1),()=>m.removeEventListener("popstate",u)}onHashChange(u){let m=Rf().getGlobalEventTarget(this._doc,"window");return m.addEventListener("hashchange",u,!1),()=>m.removeEventListener("hashchange",u)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(u){this._location.pathname=u}pushState(u,m,r){this._history.pushState(u,m,r)}replaceState(u,m,r){this._history.replaceState(u,m,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(u=0){this._history.go(u)}getState(){return this._history.state}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>new i,providedIn:"platform"});let o=i;return o})();function hO(o,i){if(o.length==0)return i;if(i.length==0)return o;let l=0;return o.endsWith("/")&&l++,i.startsWith("/")&&l++,l==2?o+i.substring(1):l==1?o+i:o+"/"+i}function nO(o){let i=o.match(/#|\?|$/),l=i&&i.index||o.length,u=l-(o[l-1]==="/"?1:0);return o.slice(0,u)+o.slice(l)}function yh(o){return o&&o[0]!=="?"?"?"+o:o}var Nv=(()=>{let i=class i{historyGo(u){throw new Error("")}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>Tt(dO),providedIn:"root"});let o=i;return o})(),Y6=new mn(""),dO=(()=>{let i=class i extends Nv{constructor(u,m){super(),this._platformLocation=u,this._removeListenerFns=[],this._baseHref=m??this._platformLocation.getBaseHrefFromDOM()??Tt(Zr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}prepareExternalUrl(u){return hO(this._baseHref,u)}path(u=!1){let m=this._platformLocation.pathname+yh(this._platformLocation.search),r=this._platformLocation.hash;return r&&u?`${m}${r}`:m}pushState(u,m,r,w){let I=this.prepareExternalUrl(r+yh(w));this._platformLocation.pushState(u,m,I)}replaceState(u,m,r,w){let I=this.prepareExternalUrl(r+yh(w));this._platformLocation.replaceState(u,m,I)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(u=0){this._platformLocation.historyGo?.(u)}};i.\u0275fac=function(m){return new(m||i)(dn(uO),dn(Y6,8))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var vg=(()=>{let i=class i{constructor(u){this._subject=new Po,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=u;let m=this._locationStrategy.getBaseHref();this._basePath=J6(nO(rO(m))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(u=!1){return this.normalize(this._locationStrategy.path(u))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(u,m=""){return this.path()==this.normalize(u+yh(m))}normalize(u){return i.stripTrailingSlash(Q6(this._basePath,rO(u)))}prepareExternalUrl(u){return u&&u[0]!=="/"&&(u="/"+u),this._locationStrategy.prepareExternalUrl(u)}go(u,m="",r=null){this._locationStrategy.pushState(r,"",u,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+yh(m)),r)}replaceState(u,m="",r=null){this._locationStrategy.replaceState(r,"",u,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+yh(m)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(u=0){this._locationStrategy.historyGo?.(u)}onUrlChange(u){return this._urlChangeListeners.push(u),this._urlChangeSubscription??=this.subscribe(m=>{this._notifyUrlChangeListeners(m.url,m.state)}),()=>{let m=this._urlChangeListeners.indexOf(u);this._urlChangeListeners.splice(m,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(u="",m){this._urlChangeListeners.forEach(r=>r(u,m))}subscribe(u,m,r){return this._subject.subscribe({next:u,error:m,complete:r})}};i.normalizeQueryParams=yh,i.joinWithSlash=hO,i.stripTrailingSlash=nO,i.\u0275fac=function(m){return new(m||i)(dn(Nv))},i.\u0275prov=Gt({token:i,factory:()=>K6(),providedIn:"root"});let o=i;return o})();function K6(){return new vg(dn(Nv))}function Q6(o,i){if(!o||!i.startsWith(o))return i;let l=i.substring(o.length);return l===""||["/",";","?","#"].includes(l[0])?l:i}function rO(o){return o.replace(/\/index.html$/,"")}function J6(o){if(new RegExp("^(https?:)?//").test(o)){let[,l]=o.split(/\/\/[^\/]+/);return l}return o}function zv(o,i){i=encodeURIComponent(i);for(let l of o.split(";")){let u=l.indexOf("="),[m,r]=u==-1?[l,""]:[l.slice(0,u),l.slice(u+1)];if(m.trim()===i)return decodeURIComponent(r)}return null}var VT=/\s+/,iO=[],fO=(()=>{let i=class i{constructor(u,m){this._ngEl=u,this._renderer=m,this.initialClasses=iO,this.stateMap=new Map}set klass(u){this.initialClasses=u!=null?u.trim().split(VT):iO}set ngClass(u){this.rawClass=typeof u=="string"?u.trim().split(VT):u}ngDoCheck(){for(let m of this.initialClasses)this._updateState(m,!0);let u=this.rawClass;if(Array.isArray(u)||u instanceof Set)for(let m of u)this._updateState(m,!0);else if(u!=null)for(let m of Object.keys(u))this._updateState(m,!!u[m]);this._applyStateDiff()}_updateState(u,m){let r=this.stateMap.get(u);r!==void 0?(r.enabled!==m&&(r.changed=!0,r.enabled=m),r.touched=!0):this.stateMap.set(u,{enabled:m,changed:!0,touched:!0})}_applyStateDiff(){for(let u of this.stateMap){let m=u[0],r=u[1];r.changed?(this._toggleClass(m,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(m,!1),this.stateMap.delete(m)),r.touched=!1}}_toggleClass(u,m){u=u.trim(),u.length>0&&u.split(VT).forEach(r=>{m?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}};i.\u0275fac=function(m){return new(m||i)(_r(gh),_r(If))},i.\u0275dir=fh({type:i,selectors:[["","ngClass",""]],inputs:{klass:[ca.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let o=i;return o})();var jT=class{constructor(i,l,u,m){this.$implicit=i,this.ngForOf=l,this.index=u,this.count=m}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},pO=(()=>{let i=class i{set ngForOf(u){this._ngForOf=u,this._ngForOfDirty=!0}set ngForTrackBy(u){this._trackByFn=u}get ngForTrackBy(){return this._trackByFn}constructor(u,m,r){this._viewContainer=u,this._template=m,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(u){u&&(this._template=u)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let u=this._ngForOf;if(!this._differ&&u)if(0)try{}catch{}else this._differ=this._differs.find(u).create(this.ngForTrackBy)}if(this._differ){let u=this._differ.diff(this._ngForOf);u&&this._applyChanges(u)}}_applyChanges(u){let m=this._viewContainer;u.forEachOperation((r,w,I)=>{if(r.previousIndex==null)m.createEmbeddedView(this._template,new jT(r.item,this._ngForOf,-1,-1),I===null?void 0:I);else if(I==null)m.remove(w===null?void 0:w);else if(w!==null){let A=m.get(w);m.move(A,I),oO(A,r)}});for(let r=0,w=m.length;r<w;r++){let A=m.get(r).context;A.index=r,A.count=w,A.ngForOf=this._ngForOf}u.forEachIdentityChange(r=>{let w=m.get(r.currentIndex);oO(w,r)})}static ngTemplateContextGuard(u,m){return!0}};i.\u0275fac=function(m){return new(m||i)(_r(Mf),_r(Pv),_r(BT))},i.\u0275dir=fh({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let o=i;return o})();function oO(o,i){o.context.$implicit=i.item}var mO=(()=>{let i=class i{constructor(u,m){this._viewContainer=u,this._context=new UT,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=m}set ngIf(u){this._context.$implicit=this._context.ngIf=u,this._updateView()}set ngIfThen(u){sO("ngIfThen",u),this._thenTemplateRef=u,this._thenViewRef=null,this._updateView()}set ngIfElse(u){sO("ngIfElse",u),this._elseTemplateRef=u,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(u,m){return!0}};i.\u0275fac=function(m){return new(m||i)(_r(Mf),_r(Pv))},i.\u0275dir=fh({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let o=i;return o})(),UT=class{constructor(){this.$implicit=null,this.ngIf=null}};function sO(o,i){if(!!!(!i||i.createEmbeddedView))throw new Error(`${o} must be a TemplateRef, but received '${Xi(i)}'.`)}var Bv=(()=>{let i=class i{constructor(u,m,r){this._ngEl=u,this._differs=m,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(u){this._ngStyle=u,!this._differ&&u&&(this._differ=this._differs.find(u).create())}ngDoCheck(){if(this._differ){let u=this._differ.diff(this._ngStyle);u&&this._applyChanges(u)}}_setStyle(u,m){let[r,w]=u.split("."),I=r.indexOf("-")===-1?void 0:pa.DashCase;m!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,w?`${m}${w}`:m,I):this._renderer.removeStyle(this._ngEl.nativeElement,r,I)}_applyChanges(u){u.forEachRemovedItem(m=>this._setStyle(m.key,null)),u.forEachAddedItem(m=>this._setStyle(m.key,m.currentValue)),u.forEachChangedItem(m=>this._setStyle(m.key,m.currentValue))}};i.\u0275fac=function(m){return new(m||i)(_r(gh),_r(Lv),_r(If))},i.\u0275dir=fh({type:i,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let o=i;return o})();var Yi=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Mc({type:i}),i.\u0275inj=Dc({});let o=i;return o})(),gO="browser",e8="server";function Vv(o){return o===e8}var Of=class{};var wg=class{},Uv=class{},vh=class o{constructor(i){this.normalizedNames=new Map,this.lazyUpdate=null,i?typeof i=="string"?this.lazyInit=()=>{this.headers=new Map,i.split(`
`).forEach(l=>{let u=l.indexOf(":");if(u>0){let m=l.slice(0,u),r=m.toLowerCase(),w=l.slice(u+1).trim();this.maybeSetNormalizedName(m,r),this.headers.has(r)?this.headers.get(r).push(w):this.headers.set(r,[w])}})}:typeof Headers<"u"&&i instanceof Headers?(this.headers=new Map,i.forEach((l,u)=>{this.setHeaderEntries(u,l)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(i).forEach(([l,u])=>{this.setHeaderEntries(l,u)})}:this.headers=new Map}has(i){return this.init(),this.headers.has(i.toLowerCase())}get(i){this.init();let l=this.headers.get(i.toLowerCase());return l&&l.length>0?l[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(i){return this.init(),this.headers.get(i.toLowerCase())||null}append(i,l){return this.clone({name:i,value:l,op:"a"})}set(i,l){return this.clone({name:i,value:l,op:"s"})}delete(i,l){return this.clone({name:i,value:l,op:"d"})}maybeSetNormalizedName(i,l){this.normalizedNames.has(l)||this.normalizedNames.set(l,i)}init(){this.lazyInit&&(this.lazyInit instanceof o?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(i=>this.applyUpdate(i)),this.lazyUpdate=null))}copyFrom(i){i.init(),Array.from(i.headers.keys()).forEach(l=>{this.headers.set(l,i.headers.get(l)),this.normalizedNames.set(l,i.normalizedNames.get(l))})}clone(i){let l=new o;return l.lazyInit=this.lazyInit&&this.lazyInit instanceof o?this.lazyInit:this,l.lazyUpdate=(this.lazyUpdate||[]).concat([i]),l}applyUpdate(i){let l=i.name.toLowerCase();switch(i.op){case"a":case"s":let u=i.value;if(typeof u=="string"&&(u=[u]),u.length===0)return;this.maybeSetNormalizedName(i.name,l);let m=(i.op==="a"?this.headers.get(l):void 0)||[];m.push(...u),this.headers.set(l,m);break;case"d":let r=i.value;if(!r)this.headers.delete(l),this.normalizedNames.delete(l);else{let w=this.headers.get(l);if(!w)return;w=w.filter(I=>r.indexOf(I)===-1),w.length===0?(this.headers.delete(l),this.normalizedNames.delete(l)):this.headers.set(l,w)}break}}setHeaderEntries(i,l){let u=(Array.isArray(l)?l:[l]).map(r=>r.toString()),m=i.toLowerCase();this.headers.set(m,u),this.maybeSetNormalizedName(i,m)}forEach(i){this.init(),Array.from(this.normalizedNames.keys()).forEach(l=>i(this.normalizedNames.get(l),this.headers.get(l)))}};var GT=class{encodeKey(i){return _O(i)}encodeValue(i){return _O(i)}decodeKey(i){return decodeURIComponent(i)}decodeValue(i){return decodeURIComponent(i)}};function r8(o,i){let l=new Map;return o.length>0&&o.replace(/^\?/,"").split("&").forEach(m=>{let r=m.indexOf("="),[w,I]=r==-1?[i.decodeKey(m),""]:[i.decodeKey(m.slice(0,r)),i.decodeValue(m.slice(r+1))],A=l.get(w)||[];A.push(I),l.set(w,A)}),l}var i8=/%(\d[a-f0-9])/gi,o8={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function _O(o){return encodeURIComponent(o).replace(i8,(i,l)=>o8[l]??i)}function jv(o){return`${o}`}var Oc=class o{constructor(i={}){if(this.updates=null,this.cloneFrom=null,this.encoder=i.encoder||new GT,i.fromString){if(i.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=r8(i.fromString,this.encoder)}else i.fromObject?(this.map=new Map,Object.keys(i.fromObject).forEach(l=>{let u=i.fromObject[l],m=Array.isArray(u)?u.map(jv):[jv(u)];this.map.set(l,m)})):this.map=null}has(i){return this.init(),this.map.has(i)}get(i){this.init();let l=this.map.get(i);return l?l[0]:null}getAll(i){return this.init(),this.map.get(i)||null}keys(){return this.init(),Array.from(this.map.keys())}append(i,l){return this.clone({param:i,value:l,op:"a"})}appendAll(i){let l=[];return Object.keys(i).forEach(u=>{let m=i[u];Array.isArray(m)?m.forEach(r=>{l.push({param:u,value:r,op:"a"})}):l.push({param:u,value:m,op:"a"})}),this.clone(l)}set(i,l){return this.clone({param:i,value:l,op:"s"})}delete(i,l){return this.clone({param:i,value:l,op:"d"})}toString(){return this.init(),this.keys().map(i=>{let l=this.encoder.encodeKey(i);return this.map.get(i).map(u=>l+"="+this.encoder.encodeValue(u)).join("&")}).filter(i=>i!=="").join("&")}clone(i){let l=new o({encoder:this.encoder});return l.cloneFrom=this.cloneFrom||this,l.updates=(this.updates||[]).concat(i),l}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(i=>this.map.set(i,this.cloneFrom.map.get(i))),this.updates.forEach(i=>{switch(i.op){case"a":case"s":let l=(i.op==="a"?this.map.get(i.param):void 0)||[];l.push(jv(i.value)),this.map.set(i.param,l);break;case"d":if(i.value!==void 0){let u=this.map.get(i.param)||[],m=u.indexOf(jv(i.value));m!==-1&&u.splice(m,1),u.length>0?this.map.set(i.param,u):this.map.delete(i.param)}else{this.map.delete(i.param);break}}}),this.cloneFrom=this.updates=null)}};var HT=class{constructor(){this.map=new Map}set(i,l){return this.map.set(i,l),this}get(i){return this.map.has(i)||this.map.set(i,i.defaultValue()),this.map.get(i)}delete(i){return this.map.delete(i),this}has(i){return this.map.has(i)}keys(){return this.map.keys()}};function s8(o){switch(o){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function yO(o){return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer}function vO(o){return typeof Blob<"u"&&o instanceof Blob}function xO(o){return typeof FormData<"u"&&o instanceof FormData}function a8(o){return typeof URLSearchParams<"u"&&o instanceof URLSearchParams}var bg=class o{constructor(i,l,u,m){this.url=l,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=i.toUpperCase();let r;if(s8(this.method)||m?(this.body=u!==void 0?u:null,r=m):r=u,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new vh,this.context??=new HT,!this.params)this.params=new Oc,this.urlWithParams=l;else{let w=this.params.toString();if(w.length===0)this.urlWithParams=l;else{let I=l.indexOf("?"),A=I===-1?"?":I<l.length-1?"&":"";this.urlWithParams=l+A+w}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||yO(this.body)||vO(this.body)||xO(this.body)||a8(this.body)?this.body:this.body instanceof Oc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||xO(this.body)?null:vO(this.body)?this.body.type||null:yO(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Oc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(i={}){let l=i.method||this.method,u=i.url||this.url,m=i.responseType||this.responseType,r=i.transferCache??this.transferCache,w=i.body!==void 0?i.body:this.body,I=i.withCredentials??this.withCredentials,A=i.reportProgress??this.reportProgress,L=i.headers||this.headers,$=i.params||this.params,Q=i.context??this.context;return i.setHeaders!==void 0&&(L=Object.keys(i.setHeaders).reduce((me,he)=>me.set(he,i.setHeaders[he]),L)),i.setParams&&($=Object.keys(i.setParams).reduce((me,he)=>me.set(he,i.setParams[he]),$)),new o(l,u,w,{params:$,headers:L,context:Q,reportProgress:A,responseType:m,withCredentials:I,transferCache:r})}},kf=function(o){return o[o.Sent=0]="Sent",o[o.UploadProgress=1]="UploadProgress",o[o.ResponseHeader=2]="ResponseHeader",o[o.DownloadProgress=3]="DownloadProgress",o[o.Response=4]="Response",o[o.User=5]="User",o}(kf||{}),Eg=class{constructor(i,l=Hv.Ok,u="OK"){this.headers=i.headers||new vh,this.status=i.status!==void 0?i.status:l,this.statusText=i.statusText||u,this.url=i.url||null,this.ok=this.status>=200&&this.status<300}},qT=class o extends Eg{constructor(i={}){super(i),this.type=kf.ResponseHeader}clone(i={}){return new o({headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},$v=class o extends Eg{constructor(i={}){super(i),this.type=kf.Response,this.body=i.body!==void 0?i.body:null}clone(i={}){return new o({body:i.body!==void 0?i.body:this.body,headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},Gv=class extends Eg{constructor(i){super(i,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${i.url||"(unknown url)"}`:this.message=`Http failure response for ${i.url||"(unknown url)"}: ${i.status} ${i.statusText}`,this.error=i.error||null}},Hv=function(o){return o[o.Continue=100]="Continue",o[o.SwitchingProtocols=101]="SwitchingProtocols",o[o.Processing=102]="Processing",o[o.EarlyHints=103]="EarlyHints",o[o.Ok=200]="Ok",o[o.Created=201]="Created",o[o.Accepted=202]="Accepted",o[o.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",o[o.NoContent=204]="NoContent",o[o.ResetContent=205]="ResetContent",o[o.PartialContent=206]="PartialContent",o[o.MultiStatus=207]="MultiStatus",o[o.AlreadyReported=208]="AlreadyReported",o[o.ImUsed=226]="ImUsed",o[o.MultipleChoices=300]="MultipleChoices",o[o.MovedPermanently=301]="MovedPermanently",o[o.Found=302]="Found",o[o.SeeOther=303]="SeeOther",o[o.NotModified=304]="NotModified",o[o.UseProxy=305]="UseProxy",o[o.Unused=306]="Unused",o[o.TemporaryRedirect=307]="TemporaryRedirect",o[o.PermanentRedirect=308]="PermanentRedirect",o[o.BadRequest=400]="BadRequest",o[o.Unauthorized=401]="Unauthorized",o[o.PaymentRequired=402]="PaymentRequired",o[o.Forbidden=403]="Forbidden",o[o.NotFound=404]="NotFound",o[o.MethodNotAllowed=405]="MethodNotAllowed",o[o.NotAcceptable=406]="NotAcceptable",o[o.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",o[o.RequestTimeout=408]="RequestTimeout",o[o.Conflict=409]="Conflict",o[o.Gone=410]="Gone",o[o.LengthRequired=411]="LengthRequired",o[o.PreconditionFailed=412]="PreconditionFailed",o[o.PayloadTooLarge=413]="PayloadTooLarge",o[o.UriTooLong=414]="UriTooLong",o[o.UnsupportedMediaType=415]="UnsupportedMediaType",o[o.RangeNotSatisfiable=416]="RangeNotSatisfiable",o[o.ExpectationFailed=417]="ExpectationFailed",o[o.ImATeapot=418]="ImATeapot",o[o.MisdirectedRequest=421]="MisdirectedRequest",o[o.UnprocessableEntity=422]="UnprocessableEntity",o[o.Locked=423]="Locked",o[o.FailedDependency=424]="FailedDependency",o[o.TooEarly=425]="TooEarly",o[o.UpgradeRequired=426]="UpgradeRequired",o[o.PreconditionRequired=428]="PreconditionRequired",o[o.TooManyRequests=429]="TooManyRequests",o[o.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",o[o.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",o[o.InternalServerError=500]="InternalServerError",o[o.NotImplemented=501]="NotImplemented",o[o.BadGateway=502]="BadGateway",o[o.ServiceUnavailable=503]="ServiceUnavailable",o[o.GatewayTimeout=504]="GatewayTimeout",o[o.HttpVersionNotSupported=505]="HttpVersionNotSupported",o[o.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",o[o.InsufficientStorage=507]="InsufficientStorage",o[o.LoopDetected=508]="LoopDetected",o[o.NotExtended=510]="NotExtended",o[o.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",o}(Hv||{});function $T(o,i){return{body:i,headers:o.headers,context:o.context,observe:o.observe,params:o.params,reportProgress:o.reportProgress,responseType:o.responseType,withCredentials:o.withCredentials,transferCache:o.transferCache}}var WT=(()=>{let i=class i{constructor(u){this.handler=u}request(u,m,r={}){let w;if(u instanceof bg)w=u;else{let L;r.headers instanceof vh?L=r.headers:L=new vh(r.headers);let $;r.params&&(r.params instanceof Oc?$=r.params:$=new Oc({fromObject:r.params})),w=new bg(u,m,r.body!==void 0?r.body:null,{headers:L,context:r.context,params:$,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let I=sn(w).pipe(bc(L=>this.handler.handle(L)));if(u instanceof bg||r.observe==="events")return I;let A=I.pipe(Ao(L=>L instanceof $v));switch(r.observe||"body"){case"body":switch(w.responseType){case"arraybuffer":return A.pipe(On(L=>{if(L.body!==null&&!(L.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return L.body}));case"blob":return A.pipe(On(L=>{if(L.body!==null&&!(L.body instanceof Blob))throw new Error("Response is not a Blob.");return L.body}));case"text":return A.pipe(On(L=>{if(L.body!==null&&typeof L.body!="string")throw new Error("Response is not a string.");return L.body}));case"json":default:return A.pipe(On(L=>L.body))}case"response":return A;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(u,m={}){return this.request("DELETE",u,m)}get(u,m={}){return this.request("GET",u,m)}head(u,m={}){return this.request("HEAD",u,m)}jsonp(u,m){return this.request("JSONP",u,{params:new Oc().append(m,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(u,m={}){return this.request("OPTIONS",u,m)}patch(u,m,r={}){return this.request("PATCH",u,$T(r,m))}post(u,m,r={}){return this.request("POST",u,$T(r,m))}put(u,m,r={}){return this.request("PUT",u,$T(r,m))}};i.\u0275fac=function(m){return new(m||i)(dn(wg))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})();function TO(o,i){return i(o)}function l8(o,i){return(l,u)=>i.intercept(l,{handle:m=>o(m,u)})}function c8(o,i,l){return(u,m)=>Ds(l,()=>i(u,r=>o(r,m)))}var u8=new mn(""),ZT=new mn(""),h8=new mn(""),d8=new mn("");function f8(){let o=null;return(i,l)=>{o===null&&(o=(Tt(u8,{optional:!0})??[]).reduceRight(l8,TO));let u=Tt(_h),m=u.add();return o(i,l).pipe(ia(()=>u.remove(m)))}}var bO=(()=>{let i=class i extends wg{constructor(u,m){super(),this.backend=u,this.injector=m,this.chain=null,this.pendingTasks=Tt(_h);let r=Tt(d8,{optional:!0});this.backend=r??u}handle(u){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(ZT),...this.injector.get(h8,[])]));this.chain=r.reduceRight((w,I)=>c8(w,I,this.injector),TO)}let m=this.pendingTasks.add();return this.chain(u,r=>this.backend.handle(r)).pipe(ia(()=>this.pendingTasks.remove(m)))}};i.\u0275fac=function(m){return new(m||i)(dn(Uv),dn(po))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})();var p8=/^\)\]\}',?\n/;function m8(o){return"responseURL"in o&&o.responseURL?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):null}var wO=(()=>{let i=class i{constructor(u){this.xhrFactory=u}handle(u){if(u.method==="JSONP")throw new vt(-2800,!1);let m=this.xhrFactory;return(m.\u0275loadImpl?Gr(m.\u0275loadImpl()):sn(null)).pipe(fo(()=>new ar(w=>{let I=m.build();if(I.open(u.method,u.urlWithParams),u.withCredentials&&(I.withCredentials=!0),u.headers.forEach((Qe,ze)=>I.setRequestHeader(Qe,ze.join(","))),u.headers.has("Accept")||I.setRequestHeader("Accept","application/json, text/plain, */*"),!u.headers.has("Content-Type")){let Qe=u.detectContentTypeHeader();Qe!==null&&I.setRequestHeader("Content-Type",Qe)}if(u.responseType){let Qe=u.responseType.toLowerCase();I.responseType=Qe!=="json"?Qe:"text"}let A=u.serializeBody(),L=null,$=()=>{if(L!==null)return L;let Qe=I.statusText||"OK",ze=new vh(I.getAllResponseHeaders()),nt=m8(I)||u.url;return L=new qT({headers:ze,status:I.status,statusText:Qe,url:nt}),L},Q=()=>{let{headers:Qe,status:ze,statusText:nt,url:ft}=$(),Ue=null;ze!==Hv.NoContent&&(Ue=typeof I.response>"u"?I.responseText:I.response),ze===0&&(ze=Ue?Hv.Ok:0);let Nt=ze>=200&&ze<300;if(u.responseType==="json"&&typeof Ue=="string"){let Yt=Ue;Ue=Ue.replace(p8,"");try{Ue=Ue!==""?JSON.parse(Ue):null}catch(Jt){Ue=Yt,Nt&&(Nt=!1,Ue={error:Jt,text:Ue})}}Nt?(w.next(new $v({body:Ue,headers:Qe,status:ze,statusText:nt,url:ft||void 0})),w.complete()):w.error(new Gv({error:Ue,headers:Qe,status:ze,statusText:nt,url:ft||void 0}))},me=Qe=>{let{url:ze}=$(),nt=new Gv({error:Qe,status:I.status||0,statusText:I.statusText||"Unknown Error",url:ze||void 0});w.error(nt)},he=!1,be=Qe=>{he||(w.next($()),he=!0);let ze={type:kf.DownloadProgress,loaded:Qe.loaded};Qe.lengthComputable&&(ze.total=Qe.total),u.responseType==="text"&&I.responseText&&(ze.partialText=I.responseText),w.next(ze)},Ie=Qe=>{let ze={type:kf.UploadProgress,loaded:Qe.loaded};Qe.lengthComputable&&(ze.total=Qe.total),w.next(ze)};return I.addEventListener("load",Q),I.addEventListener("error",me),I.addEventListener("timeout",me),I.addEventListener("abort",me),u.reportProgress&&(I.addEventListener("progress",be),A!==null&&I.upload&&I.upload.addEventListener("progress",Ie)),I.send(A),w.next({type:kf.Sent}),()=>{I.removeEventListener("error",me),I.removeEventListener("abort",me),I.removeEventListener("load",Q),I.removeEventListener("timeout",me),u.reportProgress&&(I.removeEventListener("progress",be),A!==null&&I.upload&&I.upload.removeEventListener("progress",Ie)),I.readyState!==I.DONE&&I.abort()}})))}};i.\u0275fac=function(m){return new(m||i)(dn(Of))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),CO=new mn(""),g8="XSRF-TOKEN",_8=new mn("",{providedIn:"root",factory:()=>g8}),y8="X-XSRF-TOKEN",v8=new mn("",{providedIn:"root",factory:()=>y8}),qv=class{},x8=(()=>{let i=class i{constructor(u,m,r){this.doc=u,this.platform=m,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let u=this.doc.cookie||"";return u!==this.lastCookieString&&(this.parseCount++,this.lastToken=zv(u,this.cookieName),this.lastCookieString=u),this.lastToken}};i.\u0275fac=function(m){return new(m||i)(dn(Zr),dn(al),dn(_8))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})();function b8(o,i){let l=o.url.toLowerCase();if(!Tt(CO)||o.method==="GET"||o.method==="HEAD"||l.startsWith("http://")||l.startsWith("https://"))return i(o);let u=Tt(qv).getToken(),m=Tt(v8);return u!=null&&!o.headers.has(m)&&(o=o.clone({headers:o.headers.set(m,u)})),i(o)}var SO=function(o){return o[o.Interceptors=0]="Interceptors",o[o.LegacyInterceptors=1]="LegacyInterceptors",o[o.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",o[o.NoXsrfProtection=3]="NoXsrfProtection",o[o.JsonpSupport=4]="JsonpSupport",o[o.RequestsMadeViaParent=5]="RequestsMadeViaParent",o[o.Fetch=6]="Fetch",o}(SO||{});function w8(o,i){return{\u0275kind:o,\u0275providers:i}}function XT(...o){let i=[WT,wO,bO,{provide:wg,useExisting:bO},{provide:Uv,useExisting:wO},{provide:ZT,useValue:b8,multi:!0},{provide:CO,useValue:!0},{provide:qv,useClass:x8}];for(let l of o)i.push(...l.\u0275providers);return Ac(i)}var EO=new mn("");function E8(){return w8(SO.LegacyInterceptors,[{provide:EO,useFactory:f8},{provide:ZT,useExisting:EO,multi:!0}])}var IO=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Mc({type:i}),i.\u0275inj=Dc({providers:[XT(E8())]});let o=i;return o})();var QT=class extends Fv{constructor(){super(...arguments),this.supportsDOMEvents=!0}},JT=class o extends QT{static makeCurrent(){cO(new o)}onAndCancel(i,l,u){return i.addEventListener(l,u),()=>{i.removeEventListener(l,u)}}dispatchEvent(i,l){i.dispatchEvent(l)}remove(i){i.parentNode&&i.parentNode.removeChild(i)}createElement(i,l){return l=l||this.getDefaultDocument(),l.createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,l){return l==="window"?window:l==="document"?i:l==="body"?i.body:null}getBaseHref(i){let l=C8();return l==null?null:S8(l)}resetBaseElement(){Tg=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return zv(document.cookie,i)}},Tg=null;function C8(){return Tg=Tg||document.querySelector("base"),Tg?Tg.getAttribute("href"):null}function S8(o){return new URL(o,document.baseURI).pathname}var I8=(()=>{let i=class i{build(){return new XMLHttpRequest}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),eC=new mn(""),AO=(()=>{let i=class i{constructor(u,m){this._zone=m,this._eventNameToPlugin=new Map,u.forEach(r=>{r.manager=this}),this._plugins=u.slice().reverse()}addEventListener(u,m,r){return this._findPluginFor(m).addEventListener(u,m,r)}getZone(){return this._zone}_findPluginFor(u){let m=this._eventNameToPlugin.get(u);if(m)return m;if(m=this._plugins.find(w=>w.supports(u)),!m)throw new vt(5101,!1);return this._eventNameToPlugin.set(u,m),m}};i.\u0275fac=function(m){return new(m||i)(dn(eC),dn(Dr))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),Wv=class{constructor(i){this._doc=i}},YT="ng-app-id",PO=(()=>{let i=class i{constructor(u,m,r,w={}){this.doc=u,this.appId=m,this.nonce=r,this.platformId=w,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Vv(w),this.resetHostNodes()}addStyles(u){for(let m of u)this.changeUsageCount(m,1)===1&&this.onStyleAdded(m)}removeStyles(u){for(let m of u)this.changeUsageCount(m,-1)<=0&&this.onStyleRemoved(m)}ngOnDestroy(){let u=this.styleNodesInDOM;u&&(u.forEach(m=>m.remove()),u.clear());for(let m of this.getAllStyles())this.onStyleRemoved(m);this.resetHostNodes()}addHost(u){this.hostNodes.add(u);for(let m of this.getAllStyles())this.addStyleToHost(u,m)}removeHost(u){this.hostNodes.delete(u)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(u){for(let m of this.hostNodes)this.addStyleToHost(m,u)}onStyleRemoved(u){let m=this.styleRef;m.get(u)?.elements?.forEach(r=>r.remove()),m.delete(u)}collectServerRenderedStyles(){let u=this.doc.head?.querySelectorAll(`style[${YT}="${this.appId}"]`);if(u?.length){let m=new Map;return u.forEach(r=>{r.textContent!=null&&m.set(r.textContent,r)}),m}return null}changeUsageCount(u,m){let r=this.styleRef;if(r.has(u)){let w=r.get(u);return w.usage+=m,w.usage}return r.set(u,{usage:m,elements:[]}),m}getStyleElement(u,m){let r=this.styleNodesInDOM,w=r?.get(m);if(w?.parentNode===u)return r.delete(m),w.removeAttribute(YT),w;{let I=this.doc.createElement("style");return this.nonce&&I.setAttribute("nonce",this.nonce),I.textContent=m,this.platformIsServer&&I.setAttribute(YT,this.appId),u.appendChild(I),I}}addStyleToHost(u,m){let r=this.getStyleElement(u,m),w=this.styleRef,I=w.get(m)?.elements;I?I.push(r):w.set(m,{elements:[r],usage:1})}resetHostNodes(){let u=this.hostNodes;u.clear(),u.add(this.doc.head)}};i.\u0275fac=function(m){return new(m||i)(dn(Zr),dn(gT),dn(vT,8),dn(al))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),KT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},nC=/%COMP%/g,RO="%COMP%",D8=`_nghost-${RO}`,M8=`_ngcontent-${RO}`,A8=!0,P8=new mn("",{providedIn:"root",factory:()=>A8});function R8(o){return M8.replace(nC,o)}function O8(o){return D8.replace(nC,o)}function OO(o,i){return i.map(l=>l.replace(nC,o))}var Zv=(()=>{let i=class i{constructor(u,m,r,w,I,A,L,$=null){this.eventManager=u,this.sharedStylesHost=m,this.appId=r,this.removeStylesOnCompDestroy=w,this.doc=I,this.platformId=A,this.ngZone=L,this.nonce=$,this.rendererByCompId=new Map,this.platformIsServer=Vv(A),this.defaultRenderer=new Cg(u,I,L,this.platformIsServer)}createRenderer(u,m){if(!u||!m)return this.defaultRenderer;this.platformIsServer&&m.encapsulation===la.ShadowDom&&(m=gr(xt({},m),{encapsulation:la.Emulated}));let r=this.getOrCreateRenderer(u,m);return r instanceof Xv?r.applyToHost(u):r instanceof Sg&&r.applyStyles(),r}getOrCreateRenderer(u,m){let r=this.rendererByCompId,w=r.get(m.id);if(!w){let I=this.doc,A=this.ngZone,L=this.eventManager,$=this.sharedStylesHost,Q=this.removeStylesOnCompDestroy,me=this.platformIsServer;switch(m.encapsulation){case la.Emulated:w=new Xv(L,$,m,this.appId,Q,I,A,me);break;case la.ShadowDom:return new tC(L,$,u,m,I,A,this.nonce,me);default:w=new Sg(L,$,m,Q,I,A,me);break}r.set(m.id,w)}return w}ngOnDestroy(){this.rendererByCompId.clear()}};i.\u0275fac=function(m){return new(m||i)(dn(AO),dn(PO),dn(gT),dn(P8),dn(Zr),dn(al),dn(Dr),dn(vT))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),Cg=class{constructor(i,l,u,m){this.eventManager=i,this.doc=l,this.ngZone=u,this.platformIsServer=m,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(i,l){return l?this.doc.createElementNS(KT[l]||l,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,l){(DO(i)?i.content:i).appendChild(l)}insertBefore(i,l,u){i&&(DO(i)?i.content:i).insertBefore(l,u)}removeChild(i,l){i&&i.removeChild(l)}selectRootElement(i,l){let u=typeof i=="string"?this.doc.querySelector(i):i;if(!u)throw new vt(-5104,!1);return l||(u.textContent=""),u}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,l,u,m){if(m){l=m+":"+l;let r=KT[m];r?i.setAttributeNS(r,l,u):i.setAttribute(l,u)}else i.setAttribute(l,u)}removeAttribute(i,l,u){if(u){let m=KT[u];m?i.removeAttributeNS(m,l):i.removeAttribute(`${u}:${l}`)}else i.removeAttribute(l)}addClass(i,l){i.classList.add(l)}removeClass(i,l){i.classList.remove(l)}setStyle(i,l,u,m){m&(pa.DashCase|pa.Important)?i.style.setProperty(l,u,m&pa.Important?"important":""):i.style[l]=u}removeStyle(i,l,u){u&pa.DashCase?i.style.removeProperty(l):i.style[l]=""}setProperty(i,l,u){i!=null&&(i[l]=u)}setValue(i,l){i.nodeValue=l}listen(i,l,u){if(typeof i=="string"&&(i=Rf().getGlobalEventTarget(this.doc,i),!i))throw new Error(`Unsupported event target ${i} for event ${l}`);return this.eventManager.addEventListener(i,l,this.decoratePreventDefault(u))}decoratePreventDefault(i){return l=>{if(l==="__ngUnwrap__")return i;(this.platformIsServer?this.ngZone.runGuarded(()=>i(l)):i(l))===!1&&l.preventDefault()}}};function DO(o){return o.tagName==="TEMPLATE"&&o.content!==void 0}var tC=class extends Cg{constructor(i,l,u,m,r,w,I,A){super(i,r,w,A),this.sharedStylesHost=l,this.hostEl=u,this.shadowRoot=u.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let L=OO(m.id,m.styles);for(let $ of L){let Q=document.createElement("style");I&&Q.setAttribute("nonce",I),Q.textContent=$,this.shadowRoot.appendChild(Q)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,l){return super.appendChild(this.nodeOrShadowRoot(i),l)}insertBefore(i,l,u){return super.insertBefore(this.nodeOrShadowRoot(i),l,u)}removeChild(i,l){return super.removeChild(this.nodeOrShadowRoot(i),l)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Sg=class extends Cg{constructor(i,l,u,m,r,w,I,A){super(i,r,w,I),this.sharedStylesHost=l,this.removeStylesOnCompDestroy=m,this.styles=A?OO(A,u.styles):u.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Xv=class extends Sg{constructor(i,l,u,m,r,w,I,A){let L=m+"-"+u.id;super(i,l,u,r,w,I,A,L),this.contentAttr=R8(L),this.hostAttr=O8(L)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,l){let u=super.createElement(i,l);return super.setAttribute(u,this.contentAttr,""),u}},k8=(()=>{let i=class i extends Wv{constructor(u){super(u)}supports(u){return!0}addEventListener(u,m,r){return u.addEventListener(m,r,!1),()=>this.removeEventListener(u,m,r)}removeEventListener(u,m,r){return u.removeEventListener(m,r)}};i.\u0275fac=function(m){return new(m||i)(dn(Zr))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),MO=["alt","control","meta","shift"],L8={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},F8={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey},N8=(()=>{let i=class i extends Wv{constructor(u){super(u)}supports(u){return i.parseEventName(u)!=null}addEventListener(u,m,r){let w=i.parseEventName(m),I=i.eventCallback(w.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Rf().onAndCancel(u,w.domEventName,I))}static parseEventName(u){let m=u.toLowerCase().split("."),r=m.shift();if(m.length===0||!(r==="keydown"||r==="keyup"))return null;let w=i._normalizeKey(m.pop()),I="",A=m.indexOf("code");if(A>-1&&(m.splice(A,1),I="code."),MO.forEach($=>{let Q=m.indexOf($);Q>-1&&(m.splice(Q,1),I+=$+".")}),I+=w,m.length!=0||w.length===0)return null;let L={};return L.domEventName=r,L.fullKey=I,L}static matchEventFullKeyCode(u,m){let r=L8[u.key]||u.key,w="";return m.indexOf("code.")>-1&&(r=u.code,w="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),MO.forEach(I=>{if(I!==r){let A=F8[I];A(u)&&(w+=I+".")}}),w+=r,w===m)}static eventCallback(u,m,r){return w=>{i.matchEventFullKeyCode(w,u)&&r.runGuarded(()=>m(w))}}static _normalizeKey(u){return u==="esc"?"escape":u}};i.\u0275fac=function(m){return new(m||i)(dn(Zr))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})();function kO(o,i){return eO(xt({rootComponent:o},z8(i)))}function z8(o){return{appProviders:[...$8,...o?.providers??[]],platformProviders:U8}}function B8(){JT.makeCurrent()}function V8(){return new fa}function j8(){return lR(document),document}var U8=[{provide:al,useValue:gO},{provide:_T,useValue:B8,multi:!0},{provide:Zr,useFactory:j8,deps:[]}];var $8=[{provide:bv,useValue:"root"},{provide:fa,useFactory:V8,deps:[]},{provide:eC,useClass:k8,multi:!0,deps:[Zr,Dr,al]},{provide:eC,useClass:N8,multi:!0,deps:[Zr]},Zv,PO,AO,{provide:uh,useExisting:Zv},{provide:Of,useClass:I8,deps:[]},[]];var LO=(()=>{let i=class i{constructor(u){this._doc=u}getTitle(){return this._doc.title}setTitle(u){this._doc.title=u||""}};i.\u0275fac=function(m){return new(m||i)(dn(Zr))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var kn="primary",jg=Symbol("RouteTitle"),aC=class{constructor(i){this.params=i||{}}has(i){return Object.prototype.hasOwnProperty.call(this.params,i)}get(i){if(this.has(i)){let l=this.params[i];return Array.isArray(l)?l[0]:l}return null}getAll(i){if(this.has(i)){let l=this.params[i];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}};function Bf(o){return new aC(o)}function H8(o,i,l){let u=l.path.split("/");if(u.length>o.length||l.pathMatch==="full"&&(i.hasChildren()||u.length<o.length))return null;let m={};for(let r=0;r<u.length;r++){let w=u[r],I=o[r];if(w.startsWith(":"))m[w.substring(1)]=I;else if(w!==I.path)return null}return{consumed:o.slice(0,u.length),posParams:m}}function q8(o,i){if(o.length!==i.length)return!1;for(let l=0;l<o.length;++l)if(!ga(o[l],i[l]))return!1;return!0}function ga(o,i){let l=o?lC(o):void 0,u=i?lC(i):void 0;if(!l||!u||l.length!=u.length)return!1;let m;for(let r=0;r<l.length;r++)if(m=l[r],!UO(o[m],i[m]))return!1;return!0}function lC(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function UO(o,i){if(Array.isArray(o)&&Array.isArray(i)){if(o.length!==i.length)return!1;let l=[...o].sort(),u=[...i].sort();return l.every((m,r)=>u[r]===m)}else return o===i}function $O(o){return o.length>0?o[o.length-1]:null}function Fc(o){return Nw(o)?o:_g(o)?Gr(Promise.resolve(o)):sn(o)}var W8={exact:HO,subset:qO},GO={exact:Z8,subset:X8,ignored:()=>!0};function FO(o,i,l){return W8[l.paths](o.root,i.root,l.matrixParams)&&GO[l.queryParams](o.queryParams,i.queryParams)&&!(l.fragment==="exact"&&o.fragment!==i.fragment)}function Z8(o,i){return ga(o,i)}function HO(o,i,l){if(!bh(o.segments,i.segments)||!Qv(o.segments,i.segments,l)||o.numberOfChildren!==i.numberOfChildren)return!1;for(let u in i.children)if(!o.children[u]||!HO(o.children[u],i.children[u],l))return!1;return!0}function X8(o,i){return Object.keys(i).length<=Object.keys(o).length&&Object.keys(i).every(l=>UO(o[l],i[l]))}function qO(o,i,l){return WO(o,i,i.segments,l)}function WO(o,i,l,u){if(o.segments.length>l.length){let m=o.segments.slice(0,l.length);return!(!bh(m,l)||i.hasChildren()||!Qv(m,l,u))}else if(o.segments.length===l.length){if(!bh(o.segments,l)||!Qv(o.segments,l,u))return!1;for(let m in i.children)if(!o.children[m]||!qO(o.children[m],i.children[m],u))return!1;return!0}else{let m=l.slice(0,o.segments.length),r=l.slice(o.segments.length);return!bh(o.segments,m)||!Qv(o.segments,m,u)||!o.children[kn]?!1:WO(o.children[kn],i,r,u)}}function Qv(o,i,l){return i.every((u,m)=>GO[l](o[m].parameters,u.parameters))}var kc=class{constructor(i=new dr([],{}),l={},u=null){this.root=i,this.queryParams=l,this.fragment=u}get queryParamMap(){return this._queryParamMap??=Bf(this.queryParams),this._queryParamMap}toString(){return Q8.serialize(this)}},dr=class{constructor(i,l){this.segments=i,this.children=l,this.parent=null,Object.values(l).forEach(u=>u.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Jv(this)}},xh=class{constructor(i,l){this.path=i,this.parameters=l}get parameterMap(){return this._parameterMap??=Bf(this.parameters),this._parameterMap}toString(){return XO(this)}};function Y8(o,i){return bh(o,i)&&o.every((l,u)=>ga(l.parameters,i[u].parameters))}function bh(o,i){return o.length!==i.length?!1:o.every((l,u)=>l.path===i[u].path)}function K8(o,i){let l=[];return Object.entries(o.children).forEach(([u,m])=>{u===kn&&(l=l.concat(i(m,u)))}),Object.entries(o.children).forEach(([u,m])=>{u!==kn&&(l=l.concat(i(m,u)))}),l}var kC=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>new tx,providedIn:"root"});let o=i;return o})(),tx=class{parse(i){let l=new uC(i);return new kc(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(i){let l=`/${Ig(i.root,!0)}`,u=t$(i.queryParams),m=typeof i.fragment=="string"?`#${J8(i.fragment)}`:"";return`${l}${u}${m}`}},Q8=new tx;function Jv(o){return o.segments.map(i=>XO(i)).join("/")}function Ig(o,i){if(!o.hasChildren())return Jv(o);if(i){let l=o.children[kn]?Ig(o.children[kn],!1):"",u=[];return Object.entries(o.children).forEach(([m,r])=>{m!==kn&&u.push(`${m}:${Ig(r,!1)}`)}),u.length>0?`${l}(${u.join("//")})`:l}else{let l=K8(o,(u,m)=>m===kn?[Ig(o.children[kn],!1)]:[`${m}:${Ig(u,!1)}`]);return Object.keys(o.children).length===1&&o.children[kn]!=null?`${Jv(o)}/${l[0]}`:`${Jv(o)}/(${l.join("//")})`}}function ZO(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Yv(o){return ZO(o).replace(/%3B/gi,";")}function J8(o){return encodeURI(o)}function cC(o){return ZO(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ex(o){return decodeURIComponent(o)}function NO(o){return ex(o.replace(/\+/g,"%20"))}function XO(o){return`${cC(o.path)}${e$(o.parameters)}`}function e$(o){return Object.entries(o).map(([i,l])=>`;${cC(i)}=${cC(l)}`).join("")}function t$(o){let i=Object.entries(o).map(([l,u])=>Array.isArray(u)?u.map(m=>`${Yv(l)}=${Yv(m)}`).join("&"):`${Yv(l)}=${Yv(u)}`).filter(l=>l);return i.length?`?${i.join("&")}`:""}var n$=/^[^\/()?;#]+/;function rC(o){let i=o.match(n$);return i?i[0]:""}var r$=/^[^\/()?;=#]+/;function i$(o){let i=o.match(r$);return i?i[0]:""}var o$=/^[^=?&#]+/;function s$(o){let i=o.match(o$);return i?i[0]:""}var a$=/^[^&#]+/;function l$(o){let i=o.match(a$);return i?i[0]:""}var uC=class{constructor(i){this.url=i,this.remaining=i}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new dr([],{}):new dr([],this.parseChildren())}parseQueryParams(){let i={};if(this.consumeOptional("?"))do this.parseQueryParam(i);while(this.consumeOptional("&"));return i}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let i=[];for(this.peekStartsWith("(")||i.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),i.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let u={};return this.peekStartsWith("(")&&(u=this.parseParens(!1)),(i.length>0||Object.keys(l).length>0)&&(u[kn]=new dr(i,l)),u}parseSegment(){let i=rC(this.remaining);if(i===""&&this.peekStartsWith(";"))throw new vt(4009,!1);return this.capture(i),new xh(ex(i),this.parseMatrixParams())}parseMatrixParams(){let i={};for(;this.consumeOptional(";");)this.parseParam(i);return i}parseParam(i){let l=i$(this.remaining);if(!l)return;this.capture(l);let u="";if(this.consumeOptional("=")){let m=rC(this.remaining);m&&(u=m,this.capture(u))}i[ex(l)]=ex(u)}parseQueryParam(i){let l=s$(this.remaining);if(!l)return;this.capture(l);let u="";if(this.consumeOptional("=")){let w=l$(this.remaining);w&&(u=w,this.capture(u))}let m=NO(l),r=NO(u);if(i.hasOwnProperty(m)){let w=i[m];Array.isArray(w)||(w=[w],i[m]=w),w.push(r)}else i[m]=r}parseParens(i){let l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let u=rC(this.remaining),m=this.remaining[u.length];if(m!=="/"&&m!==")"&&m!==";")throw new vt(4010,!1);let r;u.indexOf(":")>-1?(r=u.slice(0,u.indexOf(":")),this.capture(r),this.capture(":")):i&&(r=kn);let w=this.parseChildren();l[r]=Object.keys(w).length===1?w[kn]:new dr([],w),this.consumeOptional("//")}return l}peekStartsWith(i){return this.remaining.startsWith(i)}consumeOptional(i){return this.peekStartsWith(i)?(this.remaining=this.remaining.substring(i.length),!0):!1}capture(i){if(!this.consumeOptional(i))throw new vt(4011,!1)}};function YO(o){return o.segments.length>0?new dr([],{[kn]:o}):o}function KO(o){let i={};for(let[u,m]of Object.entries(o.children)){let r=KO(m);if(u===kn&&r.segments.length===0&&r.hasChildren())for(let[w,I]of Object.entries(r.children))i[w]=I;else(r.segments.length>0||r.hasChildren())&&(i[u]=r)}let l=new dr(o.segments,i);return c$(l)}function c$(o){if(o.numberOfChildren===1&&o.children[kn]){let i=o.children[kn];return new dr(o.segments.concat(i.segments),i.children)}return o}function Vf(o){return o instanceof kc}function u$(o,i,l=null,u=null){let m=QO(o);return JO(m,i,l,u)}function QO(o){let i;function l(r){let w={};for(let A of r.children){let L=l(A);w[A.outlet]=L}let I=new dr(r.url,w);return r===o&&(i=I),I}let u=l(o.root),m=YO(u);return i??m}function JO(o,i,l,u){let m=o;for(;m.parent;)m=m.parent;if(i.length===0)return iC(m,m,m,l,u);let r=h$(i);if(r.toRoot())return iC(m,m,new dr([],{}),l,u);let w=d$(r,m,o),I=w.processChildren?Ag(w.segmentGroup,w.index,r.commands):tk(w.segmentGroup,w.index,r.commands);return iC(m,w.segmentGroup,I,l,u)}function nx(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function Og(o){return typeof o=="object"&&o!=null&&o.outlets}function iC(o,i,l,u,m){let r={};u&&Object.entries(u).forEach(([A,L])=>{r[A]=Array.isArray(L)?L.map($=>`${$}`):`${L}`});let w;o===i?w=l:w=ek(o,i,l);let I=YO(KO(w));return new kc(I,r,m)}function ek(o,i,l){let u={};return Object.entries(o.children).forEach(([m,r])=>{r===i?u[m]=l:u[m]=ek(r,i,l)}),new dr(o.segments,u)}var rx=class{constructor(i,l,u){if(this.isAbsolute=i,this.numberOfDoubleDots=l,this.commands=u,i&&u.length>0&&nx(u[0]))throw new vt(4003,!1);let m=u.find(Og);if(m&&m!==$O(u))throw new vt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function h$(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new rx(!0,0,o);let i=0,l=!1,u=o.reduce((m,r,w)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let I={};return Object.entries(r.outlets).forEach(([A,L])=>{I[A]=typeof L=="string"?L.split("/"):L}),[...m,{outlets:I}]}if(r.segmentPath)return[...m,r.segmentPath]}return typeof r!="string"?[...m,r]:w===0?(r.split("/").forEach((I,A)=>{A==0&&I==="."||(A==0&&I===""?l=!0:I===".."?i++:I!=""&&m.push(I))}),m):[...m,r]},[]);return new rx(l,i,u)}var Nf=class{constructor(i,l,u){this.segmentGroup=i,this.processChildren=l,this.index=u}};function d$(o,i,l){if(o.isAbsolute)return new Nf(i,!0,0);if(!l)return new Nf(i,!1,NaN);if(l.parent===null)return new Nf(l,!0,0);let u=nx(o.commands[0])?0:1,m=l.segments.length-1+u;return f$(l,m,o.numberOfDoubleDots)}function f$(o,i,l){let u=o,m=i,r=l;for(;r>m;){if(r-=m,u=u.parent,!u)throw new vt(4005,!1);m=u.segments.length}return new Nf(u,!1,m-r)}function p$(o){return Og(o[0])?o[0].outlets:{[kn]:o}}function tk(o,i,l){if(o??=new dr([],{}),o.segments.length===0&&o.hasChildren())return Ag(o,i,l);let u=m$(o,i,l),m=l.slice(u.commandIndex);if(u.match&&u.pathIndex<o.segments.length){let r=new dr(o.segments.slice(0,u.pathIndex),{});return r.children[kn]=new dr(o.segments.slice(u.pathIndex),o.children),Ag(r,0,m)}else return u.match&&m.length===0?new dr(o.segments,{}):u.match&&!o.hasChildren()?hC(o,i,l):u.match?Ag(o,0,m):hC(o,i,l)}function Ag(o,i,l){if(l.length===0)return new dr(o.segments,{});{let u=p$(l),m={};if(Object.keys(u).some(r=>r!==kn)&&o.children[kn]&&o.numberOfChildren===1&&o.children[kn].segments.length===0){let r=Ag(o.children[kn],i,l);return new dr(o.segments,r.children)}return Object.entries(u).forEach(([r,w])=>{typeof w=="string"&&(w=[w]),w!==null&&(m[r]=tk(o.children[r],i,w))}),Object.entries(o.children).forEach(([r,w])=>{u[r]===void 0&&(m[r]=w)}),new dr(o.segments,m)}}function m$(o,i,l){let u=0,m=i,r={match:!1,pathIndex:0,commandIndex:0};for(;m<o.segments.length;){if(u>=l.length)return r;let w=o.segments[m],I=l[u];if(Og(I))break;let A=`${I}`,L=u<l.length-1?l[u+1]:null;if(m>0&&A===void 0)break;if(A&&L&&typeof L=="object"&&L.outlets===void 0){if(!BO(A,L,w))return r;u+=2}else{if(!BO(A,{},w))return r;u++}m++}return{match:!0,pathIndex:m,commandIndex:u}}function hC(o,i,l){let u=o.segments.slice(0,i),m=0;for(;m<l.length;){let r=l[m];if(Og(r)){let A=g$(r.outlets);return new dr(u,A)}if(m===0&&nx(l[0])){let A=o.segments[i];u.push(new xh(A.path,zO(l[0]))),m++;continue}let w=Og(r)?r.outlets[kn]:`${r}`,I=m<l.length-1?l[m+1]:null;w&&I&&nx(I)?(u.push(new xh(w,zO(I))),m+=2):(u.push(new xh(w,{})),m++)}return new dr(u,{})}function g$(o){let i={};return Object.entries(o).forEach(([l,u])=>{typeof u=="string"&&(u=[u]),u!==null&&(i[l]=hC(new dr([],{}),0,u))}),i}function zO(o){let i={};return Object.entries(o).forEach(([l,u])=>i[l]=`${u}`),i}function BO(o,i,l){return o==l.path&&ga(i,l.parameters)}var Pg="imperative",Oi=function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o}(Oi||{}),ts=class{constructor(i,l){this.id=i,this.url=l}},kg=class extends ts{constructor(i,l,u="imperative",m=null){super(i,l),this.type=Oi.NavigationStart,this.navigationTrigger=u,this.restoredState=m}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},wh=class extends ts{constructor(i,l,u){super(i,l),this.urlAfterRedirects=u,this.type=Oi.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Oo=function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o}(Oo||{}),dC=function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o}(dC||{}),Lc=class extends ts{constructor(i,l,u,m){super(i,l),this.reason=u,this.code=m,this.type=Oi.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Eh=class extends ts{constructor(i,l,u,m){super(i,l),this.reason=u,this.code=m,this.type=Oi.NavigationSkipped}},Lg=class extends ts{constructor(i,l,u,m){super(i,l),this.error=u,this.target=m,this.type=Oi.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},ix=class extends ts{constructor(i,l,u,m){super(i,l),this.urlAfterRedirects=u,this.state=m,this.type=Oi.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fC=class extends ts{constructor(i,l,u,m){super(i,l),this.urlAfterRedirects=u,this.state=m,this.type=Oi.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},pC=class extends ts{constructor(i,l,u,m,r){super(i,l),this.urlAfterRedirects=u,this.state=m,this.shouldActivate=r,this.type=Oi.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},mC=class extends ts{constructor(i,l,u,m){super(i,l),this.urlAfterRedirects=u,this.state=m,this.type=Oi.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},gC=class extends ts{constructor(i,l,u,m){super(i,l),this.urlAfterRedirects=u,this.state=m,this.type=Oi.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_C=class{constructor(i){this.route=i,this.type=Oi.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},yC=class{constructor(i){this.route=i,this.type=Oi.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},vC=class{constructor(i){this.snapshot=i,this.type=Oi.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},xC=class{constructor(i){this.snapshot=i,this.type=Oi.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},bC=class{constructor(i){this.snapshot=i,this.type=Oi.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},wC=class{constructor(i){this.snapshot=i,this.type=Oi.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Fg=class{},Ng=class{constructor(i){this.url=i}};var EC=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new $f,this.attachRef=null}},$f=(()=>{let i=class i{constructor(){this.contexts=new Map}onChildOutletCreated(u,m){let r=this.getOrCreateContext(u);r.outlet=m,this.contexts.set(u,r)}onChildOutletDestroyed(u){let m=this.getContext(u);m&&(m.outlet=null,m.attachRef=null)}onOutletDeactivated(){let u=this.contexts;return this.contexts=new Map,u}onOutletReAttached(u){this.contexts=u}getOrCreateContext(u){let m=this.getContext(u);return m||(m=new EC,this.contexts.set(u,m)),m}getContext(u){return this.contexts.get(u)||null}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),ox=class{constructor(i){this._root=i}get root(){return this._root.value}parent(i){let l=this.pathFromRoot(i);return l.length>1?l[l.length-2]:null}children(i){let l=TC(i,this._root);return l?l.children.map(u=>u.value):[]}firstChild(i){let l=TC(i,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(i){let l=CC(i,this._root);return l.length<2?[]:l[l.length-2].children.map(m=>m.value).filter(m=>m!==i)}pathFromRoot(i){return CC(i,this._root).map(l=>l.value)}};function TC(o,i){if(o===i.value)return i;for(let l of i.children){let u=TC(o,l);if(u)return u}return null}function CC(o,i){if(o===i.value)return[i];for(let l of i.children){let u=CC(o,l);if(u.length)return u.unshift(i),u}return[]}var Ro=class{constructor(i,l){this.value=i,this.children=l}toString(){return`TreeNode(${this.value})`}};function Ff(o){let i={};return o&&o.children.forEach(l=>i[l.value.outlet]=l),i}var sx=class extends ox{constructor(i,l){super(i),this.snapshot=l,FC(this,i)}toString(){return this.snapshot.toString()}};function nk(o){let i=_$(o),l=new pi([new xh("",{})]),u=new pi({}),m=new pi({}),r=new pi({}),w=new pi(""),I=new jf(l,u,r,w,m,kn,o,i.root);return I.snapshot=i.root,new sx(new Ro(I,[]),i)}function _$(o){let i={},l={},u={},m="",r=new zg([],i,u,m,l,kn,o,null,{});return new ax("",new Ro(r,[]))}var jf=class{constructor(i,l,u,m,r,w,I,A){this.urlSubject=i,this.paramsSubject=l,this.queryParamsSubject=u,this.fragmentSubject=m,this.dataSubject=r,this.outlet=w,this.component=I,this._futureSnapshot=A,this.title=this.dataSubject?.pipe(On(L=>L[jg]))??sn(void 0),this.url=i,this.params=l,this.queryParams=u,this.fragment=m,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(On(i=>Bf(i))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(On(i=>Bf(i))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function LC(o,i,l="emptyOnly"){let u,{routeConfig:m}=o;return i!==null&&(l==="always"||m?.path===""||!i.component&&!i.routeConfig?.loadComponent)?u={params:xt(xt({},i.params),o.params),data:xt(xt({},i.data),o.data),resolve:xt(xt(xt(xt({},o.data),i.data),m?.data),o._resolvedData)}:u={params:xt({},o.params),data:xt({},o.data),resolve:xt(xt({},o.data),o._resolvedData??{})},m&&ik(m)&&(u.resolve[jg]=m.title),u}var zg=class{get title(){return this.data?.[jg]}constructor(i,l,u,m,r,w,I,A,L){this.url=i,this.params=l,this.queryParams=u,this.fragment=m,this.data=r,this.outlet=w,this.component=I,this.routeConfig=A,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Bf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Bf(this.queryParams),this._queryParamMap}toString(){let i=this.url.map(u=>u.toString()).join("/"),l=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${i}', path:'${l}')`}},ax=class extends ox{constructor(i,l){super(l),this.url=i,FC(this,l)}toString(){return rk(this._root)}};function FC(o,i){i.value._routerState=o,i.children.forEach(l=>FC(o,l))}function rk(o){let i=o.children.length>0?` { ${o.children.map(rk).join(", ")} } `:"";return`${o.value}${i}`}function oC(o){if(o.snapshot){let i=o.snapshot,l=o._futureSnapshot;o.snapshot=l,ga(i.queryParams,l.queryParams)||o.queryParamsSubject.next(l.queryParams),i.fragment!==l.fragment&&o.fragmentSubject.next(l.fragment),ga(i.params,l.params)||o.paramsSubject.next(l.params),q8(i.url,l.url)||o.urlSubject.next(l.url),ga(i.data,l.data)||o.dataSubject.next(l.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function SC(o,i){let l=ga(o.params,i.params)&&Y8(o.url,i.url),u=!o.parent!=!i.parent;return l&&!u&&(!o.parent||SC(o.parent,i.parent))}function ik(o){return typeof o.title=="string"||o.title===null}var NC=(()=>{let i=class i{constructor(){this.activated=null,this._activatedRoute=null,this.name=kn,this.activateEvents=new Po,this.deactivateEvents=new Po,this.attachEvents=new Po,this.detachEvents=new Po,this.parentContexts=Tt($f),this.location=Tt(Mf),this.changeDetector=Tt(yg),this.environmentInjector=Tt(po),this.inputBinder=Tt(ux,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(u){if(u.name){let{firstChange:m,previousValue:r}=u.name;if(m)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(u){return this.parentContexts.getContext(u)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let u=this.parentContexts.getContext(this.name);u?.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new vt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new vt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new vt(4012,!1);this.location.detach();let u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,m){this.activated=u,this._activatedRoute=m,this.location.insert(u.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){let u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,m){if(this.isActivated)throw new vt(4013,!1);this._activatedRoute=u;let r=this.location,I=u.snapshot.component,A=this.parentContexts.getOrCreateContext(this.name).children,L=new IC(u,A,r.injector);this.activated=r.createComponent(I,{index:r.length,injector:L,environmentInjector:m??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=fh({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Cv]});let o=i;return o})(),IC=class o{__ngOutletInjector(i){return new o(this.route,this.childContexts,i)}constructor(i,l,u){this.route=i,this.childContexts=l,this.parent=u}get(i,l){return i===jf?this.route:i===$f?this.childContexts:this.parent.get(i,l)}},ux=new mn(""),VO=(()=>{let i=class i{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(u){this.unsubscribeFromRouteData(u),this.subscribeToRouteData(u)}unsubscribeFromRouteData(u){this.outletDataSubscriptions.get(u)?.unsubscribe(),this.outletDataSubscriptions.delete(u)}subscribeToRouteData(u){let{activatedRoute:m}=u,r=Qm([m.queryParams,m.params,m.data]).pipe(fo(([w,I,A],L)=>(A=xt(xt(xt({},w),I),A),L===0?sn(A):Promise.resolve(A)))).subscribe(w=>{if(!u.isActivated||!u.activatedComponentRef||u.activatedRoute!==m||m.component===null){this.unsubscribeFromRouteData(u);return}let I=tO(m.component);if(!I){this.unsubscribeFromRouteData(u);return}for(let{templateName:A}of I.inputs)u.activatedComponentRef.setInput(A,w[A])});this.outletDataSubscriptions.set(u,r)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})();function y$(o,i,l){let u=Bg(o,i._root,l?l._root:void 0);return new sx(u,i)}function Bg(o,i,l){if(l&&o.shouldReuseRoute(i.value,l.value.snapshot)){let u=l.value;u._futureSnapshot=i.value;let m=v$(o,i,l);return new Ro(u,m)}else{if(o.shouldAttach(i.value)){let r=o.retrieve(i.value);if(r!==null){let w=r.route;return w.value._futureSnapshot=i.value,w.children=i.children.map(I=>Bg(o,I)),w}}let u=x$(i.value),m=i.children.map(r=>Bg(o,r));return new Ro(u,m)}}function v$(o,i,l){return i.children.map(u=>{for(let m of l.children)if(o.shouldReuseRoute(u.value,m.value.snapshot))return Bg(o,u,m);return Bg(o,u)})}function x$(o){return new jf(new pi(o.url),new pi(o.params),new pi(o.queryParams),new pi(o.fragment),new pi(o.data),o.outlet,o.component,o)}var ok="ngNavigationCancelingError";function sk(o,i){let{redirectTo:l,navigationBehaviorOptions:u}=Vf(i)?{redirectTo:i,navigationBehaviorOptions:void 0}:i,m=ak(!1,Oo.Redirect);return m.url=l,m.navigationBehaviorOptions=u,m}function ak(o,i){let l=new Error(`NavigationCancelingError: ${o||""}`);return l[ok]=!0,l.cancellationCode=i,l}function b$(o){return lk(o)&&Vf(o.url)}function lk(o){return!!o&&o[ok]}var w$=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=gi({type:i,selectors:[["ng-component"]],standalone:!0,features:[_i],decls:1,vars:0,template:function(m,r){m&1&&Cr(0,"router-outlet")},dependencies:[NC],encapsulation:2});let o=i;return o})();function E$(o,i){return o.providers&&!o._injector&&(o._injector=OT(o.providers,i,`Route: ${o.path}`)),o._injector??i}function zC(o){let i=o.children&&o.children.map(zC),l=i?gr(xt({},o),{children:i}):xt({},o);return!l.component&&!l.loadComponent&&(i||l.loadChildren)&&l.outlet&&l.outlet!==kn&&(l.component=w$),l}function _a(o){return o.outlet||kn}function T$(o,i){let l=o.filter(u=>_a(u)===i);return l.push(...o.filter(u=>_a(u)!==i)),l}function Ug(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let i=o.parent;i;i=i.parent){let l=i.routeConfig;if(l?._loadedInjector)return l._loadedInjector;if(l?._injector)return l._injector}return null}var C$=(o,i,l,u)=>On(m=>(new DC(i,m.targetRouterState,m.currentRouterState,l,u).activate(o),m)),DC=class{constructor(i,l,u,m,r){this.routeReuseStrategy=i,this.futureState=l,this.currState=u,this.forwardEvent=m,this.inputBindingEnabled=r}activate(i){let l=this.futureState._root,u=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,u,i),oC(this.futureState.root),this.activateChildRoutes(l,u,i)}deactivateChildRoutes(i,l,u){let m=Ff(l);i.children.forEach(r=>{let w=r.value.outlet;this.deactivateRoutes(r,m[w],u),delete m[w]}),Object.values(m).forEach(r=>{this.deactivateRouteAndItsChildren(r,u)})}deactivateRoutes(i,l,u){let m=i.value,r=l?l.value:null;if(m===r)if(m.component){let w=u.getContext(m.outlet);w&&this.deactivateChildRoutes(i,l,w.children)}else this.deactivateChildRoutes(i,l,u);else r&&this.deactivateRouteAndItsChildren(l,u)}deactivateRouteAndItsChildren(i,l){i.value.component&&this.routeReuseStrategy.shouldDetach(i.value.snapshot)?this.detachAndStoreRouteSubtree(i,l):this.deactivateRouteAndOutlet(i,l)}detachAndStoreRouteSubtree(i,l){let u=l.getContext(i.value.outlet),m=u&&i.value.component?u.children:l,r=Ff(i);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,m);if(u&&u.outlet){let w=u.outlet.detach(),I=u.children.onOutletDeactivated();this.routeReuseStrategy.store(i.value.snapshot,{componentRef:w,route:i,contexts:I})}}deactivateRouteAndOutlet(i,l){let u=l.getContext(i.value.outlet),m=u&&i.value.component?u.children:l,r=Ff(i);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,m);u&&(u.outlet&&(u.outlet.deactivate(),u.children.onOutletDeactivated()),u.attachRef=null,u.route=null)}activateChildRoutes(i,l,u){let m=Ff(l);i.children.forEach(r=>{this.activateRoutes(r,m[r.value.outlet],u),this.forwardEvent(new wC(r.value.snapshot))}),i.children.length&&this.forwardEvent(new xC(i.value.snapshot))}activateRoutes(i,l,u){let m=i.value,r=l?l.value:null;if(oC(m),m===r)if(m.component){let w=u.getOrCreateContext(m.outlet);this.activateChildRoutes(i,l,w.children)}else this.activateChildRoutes(i,l,u);else if(m.component){let w=u.getOrCreateContext(m.outlet);if(this.routeReuseStrategy.shouldAttach(m.snapshot)){let I=this.routeReuseStrategy.retrieve(m.snapshot);this.routeReuseStrategy.store(m.snapshot,null),w.children.onOutletReAttached(I.contexts),w.attachRef=I.componentRef,w.route=I.route.value,w.outlet&&w.outlet.attach(I.componentRef,I.route.value),oC(I.route.value),this.activateChildRoutes(i,null,w.children)}else{let I=Ug(m.snapshot);w.attachRef=null,w.route=m,w.injector=I,w.outlet&&w.outlet.activateWith(m,w.injector),this.activateChildRoutes(i,null,w.children)}}else this.activateChildRoutes(i,null,u)}},lx=class{constructor(i){this.path=i,this.route=this.path[this.path.length-1]}},zf=class{constructor(i,l){this.component=i,this.route=l}};function S$(o,i,l){let u=o._root,m=i?i._root:null;return Dg(u,m,l,[u.value])}function I$(o){let i=o.routeConfig?o.routeConfig.canActivateChild:null;return!i||i.length===0?null:{node:o,guards:i}}function Gf(o,i){let l=Symbol(),u=i.get(o,l);return u===l?typeof o=="function"&&!ZA(o)?o:i.get(o):u}function Dg(o,i,l,u,m={canDeactivateChecks:[],canActivateChecks:[]}){let r=Ff(i);return o.children.forEach(w=>{D$(w,r[w.value.outlet],l,u.concat([w.value]),m),delete r[w.value.outlet]}),Object.entries(r).forEach(([w,I])=>Rg(I,l.getContext(w),m)),m}function D$(o,i,l,u,m={canDeactivateChecks:[],canActivateChecks:[]}){let r=o.value,w=i?i.value:null,I=l?l.getContext(o.value.outlet):null;if(w&&r.routeConfig===w.routeConfig){let A=M$(w,r,r.routeConfig.runGuardsAndResolvers);A?m.canActivateChecks.push(new lx(u)):(r.data=w.data,r._resolvedData=w._resolvedData),r.component?Dg(o,i,I?I.children:null,u,m):Dg(o,i,l,u,m),A&&I&&I.outlet&&I.outlet.isActivated&&m.canDeactivateChecks.push(new zf(I.outlet.component,w))}else w&&Rg(i,I,m),m.canActivateChecks.push(new lx(u)),r.component?Dg(o,null,I?I.children:null,u,m):Dg(o,null,l,u,m);return m}function M$(o,i,l){if(typeof l=="function")return l(o,i);switch(l){case"pathParamsChange":return!bh(o.url,i.url);case"pathParamsOrQueryParamsChange":return!bh(o.url,i.url)||!ga(o.queryParams,i.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!SC(o,i)||!ga(o.queryParams,i.queryParams);case"paramsChange":default:return!SC(o,i)}}function Rg(o,i,l){let u=Ff(o),m=o.value;Object.entries(u).forEach(([r,w])=>{m.component?i?Rg(w,i.children.getContext(r),l):Rg(w,null,l):Rg(w,i,l)}),m.component?i&&i.outlet&&i.outlet.isActivated?l.canDeactivateChecks.push(new zf(i.outlet.component,m)):l.canDeactivateChecks.push(new zf(null,m)):l.canDeactivateChecks.push(new zf(null,m))}function $g(o){return typeof o=="function"}function A$(o){return typeof o=="boolean"}function P$(o){return o&&$g(o.canLoad)}function R$(o){return o&&$g(o.canActivate)}function O$(o){return o&&$g(o.canActivateChild)}function k$(o){return o&&$g(o.canDeactivate)}function L$(o){return o&&$g(o.canMatch)}function ck(o){return o instanceof rl||o?.name==="EmptyError"}var Kv=Symbol("INITIAL_VALUE");function Uf(){return fo(o=>Qm(o.map(i=>i.pipe(il(1),Gw(Kv)))).pipe(On(i=>{for(let l of i)if(l!==!0){if(l===Kv)return Kv;if(l===!1||l instanceof kc)return l}return!0}),Ao(i=>i!==Kv),il(1)))}function F$(o,i){return mi(l=>{let{targetSnapshot:u,currentSnapshot:m,guards:{canActivateChecks:r,canDeactivateChecks:w}}=l;return w.length===0&&r.length===0?sn(gr(xt({},l),{guardsResult:!0})):N$(w,u,m,o).pipe(mi(I=>I&&A$(I)?z$(u,r,o,i):sn(I)),On(I=>gr(xt({},l),{guardsResult:I})))})}function N$(o,i,l,u){return Gr(o).pipe(mi(m=>$$(m.component,m.route,l,i,u)),oa(m=>m!==!0,!0))}function z$(o,i,l,u){return Gr(i).pipe(bc(m=>af(V$(m.route.parent,u),B$(m.route,u),U$(o,m.path,l),j$(o,m.route,l))),oa(m=>m!==!0,!0))}function B$(o,i){return o!==null&&i&&i(new bC(o)),sn(!0)}function V$(o,i){return o!==null&&i&&i(new vC(o)),sn(!0)}function j$(o,i,l){let u=i.routeConfig?i.routeConfig.canActivate:null;if(!u||u.length===0)return sn(!0);let m=u.map(r=>G0(()=>{let w=Ug(i)??l,I=Gf(r,w),A=R$(I)?I.canActivate(i,o):Ds(w,()=>I(i,o));return Fc(A).pipe(oa())}));return sn(m).pipe(Uf())}function U$(o,i,l){let u=i[i.length-1],r=i.slice(0,i.length-1).reverse().map(w=>I$(w)).filter(w=>w!==null).map(w=>G0(()=>{let I=w.guards.map(A=>{let L=Ug(w.node)??l,$=Gf(A,L),Q=O$($)?$.canActivateChild(u,o):Ds(L,()=>$(u,o));return Fc(Q).pipe(oa())});return sn(I).pipe(Uf())}));return sn(r).pipe(Uf())}function $$(o,i,l,u,m){let r=i&&i.routeConfig?i.routeConfig.canDeactivate:null;if(!r||r.length===0)return sn(!0);let w=r.map(I=>{let A=Ug(i)??m,L=Gf(I,A),$=k$(L)?L.canDeactivate(o,i,l,u):Ds(A,()=>L(o,i,l,u));return Fc($).pipe(oa())});return sn(w).pipe(Uf())}function G$(o,i,l,u){let m=i.canLoad;if(m===void 0||m.length===0)return sn(!0);let r=m.map(w=>{let I=Gf(w,o),A=P$(I)?I.canLoad(i,l):Ds(o,()=>I(i,l));return Fc(A)});return sn(r).pipe(Uf(),uk(u))}function uk(o){return Ow(ni(i=>{if(Vf(i))throw sk(o,i)}),On(i=>i===!0))}function H$(o,i,l,u){let m=i.canMatch;if(!m||m.length===0)return sn(!0);let r=m.map(w=>{let I=Gf(w,o),A=L$(I)?I.canMatch(i,l):Ds(o,()=>I(i,l));return Fc(A)});return sn(r).pipe(Uf(),uk(u))}var Vg=class{constructor(i){this.segmentGroup=i||null}},cx=class extends Error{constructor(i){super(),this.urlTree=i}};function Lf(o){return nl(new Vg(o))}function q$(o){return nl(new vt(4e3,!1))}function W$(o){return nl(ak(!1,Oo.GuardRejected))}var MC=class{constructor(i,l){this.urlSerializer=i,this.urlTree=l}lineralizeSegments(i,l){let u=[],m=l.root;for(;;){if(u=u.concat(m.segments),m.numberOfChildren===0)return sn(u);if(m.numberOfChildren>1||!m.children[kn])return q$(i.redirectTo);m=m.children[kn]}}applyRedirectCommands(i,l,u){let m=this.applyRedirectCreateUrlTree(l,this.urlSerializer.parse(l),i,u);if(l.startsWith("/"))throw new cx(m);return m}applyRedirectCreateUrlTree(i,l,u,m){let r=this.createSegmentGroup(i,l.root,u,m);return new kc(r,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(i,l){let u={};return Object.entries(i).forEach(([m,r])=>{if(typeof r=="string"&&r.startsWith(":")){let I=r.substring(1);u[m]=l[I]}else u[m]=r}),u}createSegmentGroup(i,l,u,m){let r=this.createSegments(i,l.segments,u,m),w={};return Object.entries(l.children).forEach(([I,A])=>{w[I]=this.createSegmentGroup(i,A,u,m)}),new dr(r,w)}createSegments(i,l,u,m){return l.map(r=>r.path.startsWith(":")?this.findPosParam(i,r,m):this.findOrReturn(r,u))}findPosParam(i,l,u){let m=u[l.path.substring(1)];if(!m)throw new vt(4001,!1);return m}findOrReturn(i,l){let u=0;for(let m of l){if(m.path===i.path)return l.splice(u),m;u++}return i}},AC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Z$(o,i,l,u,m){let r=BC(o,i,l);return r.matched?(u=E$(i,u),H$(u,i,l,m).pipe(On(w=>w===!0?r:xt({},AC)))):sn(r)}function BC(o,i,l){if(i.path==="**")return X$(l);if(i.path==="")return i.pathMatch==="full"&&(o.hasChildren()||l.length>0)?xt({},AC):{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};let m=(i.matcher||H8)(l,o,i);if(!m)return xt({},AC);let r={};Object.entries(m.posParams??{}).forEach(([I,A])=>{r[I]=A.path});let w=m.consumed.length>0?xt(xt({},r),m.consumed[m.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:m.consumed,remainingSegments:l.slice(m.consumed.length),parameters:w,positionalParamSegments:m.posParams??{}}}function X$(o){return{matched:!0,parameters:o.length>0?$O(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function jO(o,i,l,u){return l.length>0&&Q$(o,l,u)?{segmentGroup:new dr(i,K$(u,new dr(l,o.children))),slicedSegments:[]}:l.length===0&&J$(o,l,u)?{segmentGroup:new dr(o.segments,Y$(o,l,u,o.children)),slicedSegments:l}:{segmentGroup:new dr(o.segments,o.children),slicedSegments:l}}function Y$(o,i,l,u){let m={};for(let r of l)if(hx(o,i,r)&&!u[_a(r)]){let w=new dr([],{});m[_a(r)]=w}return xt(xt({},u),m)}function K$(o,i){let l={};l[kn]=i;for(let u of o)if(u.path===""&&_a(u)!==kn){let m=new dr([],{});l[_a(u)]=m}return l}function Q$(o,i,l){return l.some(u=>hx(o,i,u)&&_a(u)!==kn)}function J$(o,i,l){return l.some(u=>hx(o,i,u))}function hx(o,i,l){return(o.hasChildren()||i.length>0)&&l.pathMatch==="full"?!1:l.path===""}function eG(o,i,l,u){return _a(o)!==u&&(u===kn||!hx(i,l,o))?!1:BC(i,o,l).matched}function tG(o,i,l){return i.length===0&&!o.children[l]}var PC=class{};function nG(o,i,l,u,m,r,w="emptyOnly"){return new RC(o,i,l,u,m,w,r).recognize()}var rG=31,RC=class{constructor(i,l,u,m,r,w,I){this.injector=i,this.configLoader=l,this.rootComponentType=u,this.config=m,this.urlTree=r,this.paramsInheritanceStrategy=w,this.urlSerializer=I,this.applyRedirects=new MC(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(i){return new vt(4002,`'${i.segmentGroup}'`)}recognize(){let i=jO(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(i).pipe(On(l=>{let u=new zg([],Object.freeze({}),Object.freeze(xt({},this.urlTree.queryParams)),this.urlTree.fragment,{},kn,this.rootComponentType,null,{}),m=new Ro(u,l),r=new ax("",m),w=u$(u,[],this.urlTree.queryParams,this.urlTree.fragment);return w.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(w),this.inheritParamsAndData(r._root,null),{state:r,tree:w}}))}match(i){return this.processSegmentGroup(this.injector,this.config,i,kn).pipe(ra(u=>{if(u instanceof cx)return this.urlTree=u.urlTree,this.match(u.urlTree.root);throw u instanceof Vg?this.noMatchError(u):u}))}inheritParamsAndData(i,l){let u=i.value,m=LC(u,l,this.paramsInheritanceStrategy);u.params=Object.freeze(m.params),u.data=Object.freeze(m.data),i.children.forEach(r=>this.inheritParamsAndData(r,u))}processSegmentGroup(i,l,u,m){return u.segments.length===0&&u.hasChildren()?this.processChildren(i,l,u):this.processSegment(i,l,u,u.segments,m,!0).pipe(On(r=>r instanceof Ro?[r]:[]))}processChildren(i,l,u){let m=[];for(let r of Object.keys(u.children))r==="primary"?m.unshift(r):m.push(r);return Gr(m).pipe(bc(r=>{let w=u.children[r],I=T$(l,r);return this.processSegmentGroup(i,I,w,r)}),jw((r,w)=>(r.push(...w),r)),wc(null),Vw(),mi(r=>{if(r===null)return Lf(u);let w=hk(r);return iG(w),sn(w)}))}processSegment(i,l,u,m,r,w){return Gr(l).pipe(bc(I=>this.processSegmentAgainstRoute(I._injector??i,l,I,u,m,r,w).pipe(ra(A=>{if(A instanceof Vg)return sn(null);throw A}))),oa(I=>!!I),ra(I=>{if(ck(I))return tG(u,m,r)?sn(new PC):Lf(u);throw I}))}processSegmentAgainstRoute(i,l,u,m,r,w,I){return eG(u,m,r,w)?u.redirectTo===void 0?this.matchSegmentAgainstRoute(i,m,u,r,w):this.allowRedirects&&I?this.expandSegmentAgainstRouteUsingRedirect(i,m,l,u,r,w):Lf(m):Lf(m)}expandSegmentAgainstRouteUsingRedirect(i,l,u,m,r,w){let{matched:I,consumedSegments:A,positionalParamSegments:L,remainingSegments:$}=BC(l,m,r);if(!I)return Lf(l);m.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>rG&&(this.allowRedirects=!1));let Q=this.applyRedirects.applyRedirectCommands(A,m.redirectTo,L);return this.applyRedirects.lineralizeSegments(m,Q).pipe(mi(me=>this.processSegment(i,u,l,me.concat($),w,!1)))}matchSegmentAgainstRoute(i,l,u,m,r){let w=Z$(l,u,m,i,this.urlSerializer);return u.path==="**"&&(l.children={}),w.pipe(fo(I=>I.matched?(i=u._injector??i,this.getChildConfig(i,u,m).pipe(fo(({routes:A})=>{let L=u._loadedInjector??i,{consumedSegments:$,remainingSegments:Q,parameters:me}=I,he=new zg($,me,Object.freeze(xt({},this.urlTree.queryParams)),this.urlTree.fragment,sG(u),_a(u),u.component??u._loadedComponent??null,u,aG(u)),{segmentGroup:be,slicedSegments:Ie}=jO(l,$,Q,A);if(Ie.length===0&&be.hasChildren())return this.processChildren(L,A,be).pipe(On(ze=>ze===null?null:new Ro(he,ze)));if(A.length===0&&Ie.length===0)return sn(new Ro(he,[]));let Qe=_a(u)===r;return this.processSegment(L,A,be,Ie,Qe?kn:r,!0).pipe(On(ze=>new Ro(he,ze instanceof Ro?[ze]:[])))}))):Lf(l)))}getChildConfig(i,l,u){return l.children?sn({routes:l.children,injector:i}):l.loadChildren?l._loadedRoutes!==void 0?sn({routes:l._loadedRoutes,injector:l._loadedInjector}):G$(i,l,u,this.urlSerializer).pipe(mi(m=>m?this.configLoader.loadChildren(i,l).pipe(ni(r=>{l._loadedRoutes=r.routes,l._loadedInjector=r.injector})):W$(l))):sn({routes:[],injector:i})}};function iG(o){o.sort((i,l)=>i.value.outlet===kn?-1:l.value.outlet===kn?1:i.value.outlet.localeCompare(l.value.outlet))}function oG(o){let i=o.value.routeConfig;return i&&i.path===""}function hk(o){let i=[],l=new Set;for(let u of o){if(!oG(u)){i.push(u);continue}let m=i.find(r=>u.value.routeConfig===r.value.routeConfig);m!==void 0?(m.children.push(...u.children),l.add(m)):i.push(u)}for(let u of l){let m=hk(u.children);i.push(new Ro(u.value,m))}return i.filter(u=>!l.has(u))}function sG(o){return o.data||{}}function aG(o){return o.resolve||{}}function lG(o,i,l,u,m,r){return mi(w=>nG(o,i,l,u,w.extractedUrl,m,r).pipe(On(({state:I,tree:A})=>gr(xt({},w),{targetSnapshot:I,urlAfterRedirects:A}))))}function cG(o,i){return mi(l=>{let{targetSnapshot:u,guards:{canActivateChecks:m}}=l;if(!m.length)return sn(l);let r=new Set(m.map(A=>A.route)),w=new Set;for(let A of r)if(!w.has(A))for(let L of dk(A))w.add(L);let I=0;return Gr(w).pipe(bc(A=>r.has(A)?uG(A,u,o,i):(A.data=LC(A,A.parent,o).resolve,sn(void 0))),ni(()=>I++),lf(1),mi(A=>I===w.size?sn(l):Mo))})}function dk(o){let i=o.children.map(l=>dk(l)).flat();return[o,...i]}function uG(o,i,l,u){let m=o.routeConfig,r=o._resolve;return m?.title!==void 0&&!ik(m)&&(r[jg]=m.title),hG(r,o,i,u).pipe(On(w=>(o._resolvedData=w,o.data=LC(o,o.parent,l).resolve,null)))}function hG(o,i,l,u){let m=lC(o);if(m.length===0)return sn({});let r={};return Gr(m).pipe(mi(w=>dG(o[w],i,l,u).pipe(oa(),ni(I=>{r[w]=I}))),lf(1),Bw(r),ra(w=>ck(w)?Mo:nl(w)))}function dG(o,i,l,u){let m=Ug(i)??u,r=Gf(o,m),w=r.resolve?r.resolve(i,l):Ds(m,()=>r(i,l));return Fc(w)}function sC(o){return fo(i=>{let l=o(i);return l?Gr(l).pipe(On(()=>i)):sn(i)})}var fk=(()=>{let i=class i{buildTitle(u){let m,r=u.root;for(;r!==void 0;)m=this.getResolvedTitleForRoute(r)??m,r=r.children.find(w=>w.outlet===kn);return m}getResolvedTitleForRoute(u){return u.data[jg]}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>Tt(fG),providedIn:"root"});let o=i;return o})(),fG=(()=>{let i=class i extends fk{constructor(u){super(),this.title=u}updateTitle(u){let m=this.buildTitle(u);m!==void 0&&this.title.setTitle(m)}};i.\u0275fac=function(m){return new(m||i)(dn(LO))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),VC=new mn("",{providedIn:"root",factory:()=>({})}),jC=new mn(""),pG=(()=>{let i=class i{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Tt(NT)}loadComponent(u){if(this.componentLoaders.get(u))return this.componentLoaders.get(u);if(u._loadedComponent)return sn(u._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(u);let m=Fc(u.loadComponent()).pipe(On(pk),ni(w=>{this.onLoadEndListener&&this.onLoadEndListener(u),u._loadedComponent=w}),ia(()=>{this.componentLoaders.delete(u)})),r=new sf(m,()=>new Ai).pipe(of());return this.componentLoaders.set(u,r),r}loadChildren(u,m){if(this.childrenLoaders.get(m))return this.childrenLoaders.get(m);if(m._loadedRoutes)return sn({routes:m._loadedRoutes,injector:m._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(m);let w=mG(m,this.compiler,u,this.onLoadEndListener).pipe(ia(()=>{this.childrenLoaders.delete(m)})),I=new sf(w,()=>new Ai).pipe(of());return this.childrenLoaders.set(m,I),I}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function mG(o,i,l,u){return Fc(o.loadChildren()).pipe(On(pk),mi(m=>m instanceof cg||Array.isArray(m)?sn(m):Gr(i.compileModuleAsync(m))),On(m=>{u&&u(o);let r,w,I=!1;return Array.isArray(m)?(w=m,I=!0):(r=m.create(l).injector,w=r.get(jC,[],{optional:!0,self:!0}).flat()),{routes:w.map(zC),injector:r}}))}function gG(o){return o&&typeof o=="object"&&"default"in o}function pk(o){return gG(o)?o.default:o}var UC=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>Tt(_G),providedIn:"root"});let o=i;return o})(),_G=(()=>{let i=class i{shouldProcessUrl(u){return!0}extract(u){return u}merge(u,m){return u}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),mk=new mn(""),gk=new mn("");function yG(o,i,l){let u=o.get(gk),m=o.get(Zr);return o.get(Dr).runOutsideAngular(()=>{if(!m.startViewTransition||u.skipNextTransition)return u.skipNextTransition=!1,new Promise(L=>setTimeout(L));let r,w=new Promise(L=>{r=L}),I=m.startViewTransition(()=>(r(),vG(o))),{onViewTransitionCreated:A}=u;return A&&Ds(o,()=>A({transition:I,from:i,to:l})),w})}function vG(o){return new Promise(i=>{PT(i,{injector:o})})}var xG=(()=>{let i=class i{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ai,this.transitionAbortSubject=new Ai,this.configLoader=Tt(pG),this.environmentInjector=Tt(po),this.urlSerializer=Tt(kC),this.rootContexts=Tt($f),this.location=Tt(vg),this.inputBindingEnabled=Tt(ux,{optional:!0})!==null,this.titleStrategy=Tt(fk),this.options=Tt(VC,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Tt(UC),this.createViewTransition=Tt(mk,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>sn(void 0),this.rootComponentType=null;let u=r=>this.events.next(new _C(r)),m=r=>this.events.next(new yC(r));this.configLoader.onLoadEndListener=m,this.configLoader.onLoadStartListener=u}complete(){this.transitions?.complete()}handleNavigationRequest(u){let m=++this.navigationId;this.transitions?.next(gr(xt(xt({},this.transitions.value),u),{id:m}))}setupNavigations(u,m,r){return this.transitions=new pi({id:0,currentUrlTree:m,currentRawUrl:m,extractedUrl:this.urlHandlingStrategy.extract(m),urlAfterRedirects:this.urlHandlingStrategy.extract(m),rawUrl:m,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Pg,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ao(w=>w.id!==0),On(w=>gr(xt({},w),{extractedUrl:this.urlHandlingStrategy.extract(w.rawUrl)})),fo(w=>{let I=!1,A=!1;return sn(w).pipe(fo(L=>{if(this.navigationId>w.id)return this.cancelNavigationTransition(w,"",Oo.SupersededByNewNavigation),Mo;this.currentTransition=w,this.currentNavigation={id:L.id,initialUrl:L.rawUrl,extractedUrl:L.extractedUrl,trigger:L.source,extras:L.extras,previousNavigation:this.lastSuccessfulNavigation?gr(xt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let $=!u.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Q=L.extras.onSameUrlNavigation??u.onSameUrlNavigation;if(!$&&Q!=="reload"){let me="";return this.events.next(new Eh(L.id,this.urlSerializer.serialize(L.rawUrl),me,dC.IgnoredSameUrlNavigation)),L.resolve(null),Mo}if(this.urlHandlingStrategy.shouldProcessUrl(L.rawUrl))return sn(L).pipe(fo(me=>{let he=this.transitions?.getValue();return this.events.next(new kg(me.id,this.urlSerializer.serialize(me.extractedUrl),me.source,me.restoredState)),he!==this.transitions?.getValue()?Mo:Promise.resolve(me)}),lG(this.environmentInjector,this.configLoader,this.rootComponentType,u.config,this.urlSerializer,this.paramsInheritanceStrategy),ni(me=>{w.targetSnapshot=me.targetSnapshot,w.urlAfterRedirects=me.urlAfterRedirects,this.currentNavigation=gr(xt({},this.currentNavigation),{finalUrl:me.urlAfterRedirects});let he=new ix(me.id,this.urlSerializer.serialize(me.extractedUrl),this.urlSerializer.serialize(me.urlAfterRedirects),me.targetSnapshot);this.events.next(he)}));if($&&this.urlHandlingStrategy.shouldProcessUrl(L.currentRawUrl)){let{id:me,extractedUrl:he,source:be,restoredState:Ie,extras:Qe}=L,ze=new kg(me,this.urlSerializer.serialize(he),be,Ie);this.events.next(ze);let nt=nk(this.rootComponentType).snapshot;return this.currentTransition=w=gr(xt({},L),{targetSnapshot:nt,urlAfterRedirects:he,extras:gr(xt({},Qe),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=he,sn(w)}else{let me="";return this.events.next(new Eh(L.id,this.urlSerializer.serialize(L.extractedUrl),me,dC.IgnoredByUrlHandlingStrategy)),L.resolve(null),Mo}}),ni(L=>{let $=new fC(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next($)}),On(L=>(this.currentTransition=w=gr(xt({},L),{guards:S$(L.targetSnapshot,L.currentSnapshot,this.rootContexts)}),w)),F$(this.environmentInjector,L=>this.events.next(L)),ni(L=>{if(w.guardsResult=L.guardsResult,Vf(L.guardsResult))throw sk(this.urlSerializer,L.guardsResult);let $=new pC(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot,!!L.guardsResult);this.events.next($)}),Ao(L=>L.guardsResult?!0:(this.cancelNavigationTransition(L,"",Oo.GuardRejected),!1)),sC(L=>{if(L.guards.canActivateChecks.length)return sn(L).pipe(ni($=>{let Q=new mC($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(Q)}),fo($=>{let Q=!1;return sn($).pipe(cG(this.paramsInheritanceStrategy,this.environmentInjector),ni({next:()=>Q=!0,complete:()=>{Q||this.cancelNavigationTransition($,"",Oo.NoDataFromResolver)}}))}),ni($=>{let Q=new gC($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(Q)}))}),sC(L=>{let $=Q=>{let me=[];Q.routeConfig?.loadComponent&&!Q.routeConfig._loadedComponent&&me.push(this.configLoader.loadComponent(Q.routeConfig).pipe(ni(he=>{Q.component=he}),On(()=>{})));for(let he of Q.children)me.push(...$(he));return me};return Qm($(L.targetSnapshot.root)).pipe(wc(null),il(1))}),sC(()=>this.afterPreactivation()),fo(()=>{let{currentSnapshot:L,targetSnapshot:$}=w,Q=this.createViewTransition?.(this.environmentInjector,L.root,$.root);return Q?Gr(Q).pipe(On(()=>w)):sn(w)}),On(L=>{let $=y$(u.routeReuseStrategy,L.targetSnapshot,L.currentRouterState);return this.currentTransition=w=gr(xt({},L),{targetRouterState:$}),this.currentNavigation.targetRouterState=$,w}),ni(()=>{this.events.next(new Fg)}),C$(this.rootContexts,u.routeReuseStrategy,L=>this.events.next(L),this.inputBindingEnabled),il(1),ni({next:L=>{I=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new wh(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects))),this.titleStrategy?.updateTitle(L.targetRouterState.snapshot),L.resolve(!0)},complete:()=>{I=!0}}),Hw(this.transitionAbortSubject.pipe(ni(L=>{throw L}))),ia(()=>{!I&&!A&&this.cancelNavigationTransition(w,"",Oo.SupersededByNewNavigation),this.currentTransition?.id===w.id&&(this.currentNavigation=null,this.currentTransition=null)}),ra(L=>{if(A=!0,lk(L))this.events.next(new Lc(w.id,this.urlSerializer.serialize(w.extractedUrl),L.message,L.cancellationCode)),b$(L)?this.events.next(new Ng(L.url)):w.resolve(!1);else{this.events.next(new Lg(w.id,this.urlSerializer.serialize(w.extractedUrl),L,w.targetSnapshot??void 0));try{w.resolve(u.errorHandler(L))}catch($){this.options.resolveNavigationPromiseOnError?w.resolve(!1):w.reject($)}}return Mo}))}))}cancelNavigationTransition(u,m,r){let w=new Lc(u.id,this.urlSerializer.serialize(u.extractedUrl),m,r);this.events.next(w),u.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function bG(o){return o!==Pg}var wG=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>Tt(EG),providedIn:"root"});let o=i;return o})(),OC=class{shouldDetach(i){return!1}store(i,l){}shouldAttach(i){return!1}retrieve(i){return null}shouldReuseRoute(i,l){return i.routeConfig===l.routeConfig}},EG=(()=>{let i=class i extends OC{};i.\u0275fac=(()=>{let u;return function(r){return(u||(u=pT(i)))(r||i)}})(),i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),_k=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:()=>Tt(TG),providedIn:"root"});let o=i;return o})(),TG=(()=>{let i=class i extends _k{constructor(){super(...arguments),this.location=Tt(vg),this.urlSerializer=Tt(kC),this.options=Tt(VC,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Tt(UC),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new kc,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=nk(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(u){return this.location.subscribe(m=>{m.type==="popstate"&&u(m.url,m.state)})}handleRouterEvent(u,m){if(u instanceof kg)this.stateMemento=this.createStateMemento();else if(u instanceof Eh)this.rawUrlTree=m.initialUrl;else if(u instanceof ix){if(this.urlUpdateStrategy==="eager"&&!m.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl);this.setBrowserUrl(r,m)}}else u instanceof Fg?(this.currentUrlTree=m.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl),this.routerState=m.targetRouterState,this.urlUpdateStrategy==="deferred"&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m))):u instanceof Lc&&(u.code===Oo.GuardRejected||u.code===Oo.NoDataFromResolver)?this.restoreHistory(m):u instanceof Lg?this.restoreHistory(m,!0):u instanceof wh&&(this.lastSuccessfulId=u.id,this.currentPageId=this.browserPageId)}setBrowserUrl(u,m){let r=this.urlSerializer.serialize(u);if(this.location.isCurrentPathEqualTo(r)||m.extras.replaceUrl){let w=this.browserPageId,I=xt(xt({},m.extras.state),this.generateNgRouterState(m.id,w));this.location.replaceState(r,"",I)}else{let w=xt(xt({},m.extras.state),this.generateNgRouterState(m.id,this.browserPageId+1));this.location.go(r,"",w)}}restoreHistory(u,m=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,w=this.currentPageId-r;w!==0?this.location.historyGo(w):this.currentUrlTree===u.finalUrl&&w===0&&(this.resetState(u),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(m&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(u,m){return this.canceledNavigationResolution==="computed"?{navigationId:u,\u0275routerPageId:m}:{navigationId:u}}};i.\u0275fac=(()=>{let u;return function(r){return(u||(u=pT(i)))(r||i)}})(),i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),Mg=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(Mg||{});function CG(o,i){o.events.pipe(Ao(l=>l instanceof wh||l instanceof Lc||l instanceof Lg||l instanceof Eh),On(l=>l instanceof wh||l instanceof Eh?Mg.COMPLETE:(l instanceof Lc?l.code===Oo.Redirect||l.code===Oo.SupersededByNewNavigation:!1)?Mg.REDIRECTING:Mg.FAILED),Ao(l=>l!==Mg.REDIRECTING),il(1)).subscribe(()=>{i()})}function SG(o){throw o}var IG={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},DG={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},dx=(()=>{let i=class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Tt(Ov),this.stateManager=Tt(_k),this.options=Tt(VC,{optional:!0})||{},this.pendingTasks=Tt(_h),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Tt(xG),this.urlSerializer=Tt(kC),this.location=Tt(vg),this.urlHandlingStrategy=Tt(UC),this._events=new Ai,this.errorHandler=this.options.errorHandler||SG,this.navigated=!1,this.routeReuseStrategy=Tt(wG),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Tt(jC,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Tt(ux,{optional:!0}),this.eventsSubscription=new fi,this.isNgZoneEnabled=Tt(Dr)instanceof Dr&&Dr.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:u=>{this.console.warn(u)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let u=this.navigationTransitions.events.subscribe(m=>{try{let r=this.navigationTransitions.currentTransition,w=this.navigationTransitions.currentNavigation;if(r!==null&&w!==null){if(this.stateManager.handleRouterEvent(m,w),m instanceof Lc&&m.code!==Oo.Redirect&&m.code!==Oo.SupersededByNewNavigation)this.navigated=!0;else if(m instanceof wh)this.navigated=!0;else if(m instanceof Ng){let I=this.urlHandlingStrategy.merge(m.url,r.currentRawUrl),A={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||bG(r.source)};this.scheduleNavigation(I,Pg,null,A,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}AG(m)&&this._events.next(m)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(u)}resetRootComponentType(u){this.routerState.root.component=u,this.navigationTransitions.rootComponentType=u}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Pg,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((u,m)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(u,"popstate",m)},0)})}navigateToSyncWithBrowser(u,m,r){let w={replaceUrl:!0},I=r?.navigationId?r:null;if(r){let L=xt({},r);delete L.navigationId,delete L.\u0275routerPageId,Object.keys(L).length!==0&&(w.state=L)}let A=this.parseUrl(u);this.scheduleNavigation(A,m,I,w)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(u){this.config=u.map(zC),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(u,m={}){let{relativeTo:r,queryParams:w,fragment:I,queryParamsHandling:A,preserveFragment:L}=m,$=L?this.currentUrlTree.fragment:I,Q=null;switch(A){case"merge":Q=xt(xt({},this.currentUrlTree.queryParams),w);break;case"preserve":Q=this.currentUrlTree.queryParams;break;default:Q=w||null}Q!==null&&(Q=this.removeEmptyProps(Q));let me;try{let he=r?r.snapshot:this.routerState.snapshot.root;me=QO(he)}catch{(typeof u[0]!="string"||!u[0].startsWith("/"))&&(u=[]),me=this.currentUrlTree.root}return JO(me,u,Q,$??null)}navigateByUrl(u,m={skipLocationChange:!1}){let r=Vf(u)?u:this.parseUrl(u),w=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(w,Pg,null,m)}navigate(u,m={skipLocationChange:!1}){return MG(u),this.navigateByUrl(this.createUrlTree(u,m),m)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){try{return this.urlSerializer.parse(u)}catch{return this.urlSerializer.parse("/")}}isActive(u,m){let r;if(m===!0?r=xt({},IG):m===!1?r=xt({},DG):r=m,Vf(u))return FO(this.currentUrlTree,u,r);let w=this.parseUrl(u);return FO(this.currentUrlTree,w,r)}removeEmptyProps(u){return Object.entries(u).reduce((m,[r,w])=>(w!=null&&(m[r]=w),m),{})}scheduleNavigation(u,m,r,w,I){if(this.disposed)return Promise.resolve(!1);let A,L,$;I?(A=I.resolve,L=I.reject,$=I.promise):$=new Promise((me,he)=>{A=me,L=he});let Q=this.pendingTasks.add();return CG(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Q))}),this.navigationTransitions.handleNavigationRequest({source:m,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:u,extras:w,resolve:A,reject:L,promise:$,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),$.catch(me=>Promise.reject(me))}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function MG(o){for(let i=0;i<o.length;i++)if(o[i]==null)throw new vt(4008,!1)}function AG(o){return!(o instanceof Fg)&&!(o instanceof Ng)}var PG=new mn("");function yk(o,...i){return Ac([{provide:jC,multi:!0,useValue:o},[],{provide:jf,useFactory:RG,deps:[dx]},{provide:kv,multi:!0,useFactory:OG},i.map(l=>l.\u0275providers)])}function RG(o){return o.routerState.root}function vk(o,i){return{\u0275kind:o,\u0275providers:i}}function OG(){let o=Tt(mh);return i=>{let l=o.get(Pf);if(i!==l.components[0])return;let u=o.get(dx),m=o.get(kG);o.get(LG)===1&&u.initialNavigation(),o.get(FG,null,Vn.Optional)?.setUpPreloading(),o.get(PG,null,Vn.Optional)?.init(),u.resetRootComponentType(l.componentTypes[0]),m.closed||(m.next(),m.complete(),m.unsubscribe())}}var kG=new mn("",{factory:()=>new Ai}),LG=new mn("",{providedIn:"root",factory:()=>1});var FG=new mn("");function xk(){return vk(8,[VO,{provide:ux,useExisting:VO}])}function bk(o){let i=[{provide:mk,useValue:yG},{provide:gk,useValue:xt({skipNextTransition:!!o?.skipInitialTransition},o)}];return vk(9,i)}function Gg(o,i,l,u=!1){return{width:100,height:100,data:new Uint8ClampedArray(100*100*4),context:null,map:i,canvas:l,onAdd:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.context=l.getContext("2d")},render:function(){let r=this.width/2*.3,w=this.context,I=1e3,A=performance.now()%I/I;if(w){if(u){let L=this.width/2*.7*A+r;w.clearRect(0,0,this.width,this.height),w.beginPath(),w.arc(this.width/2,this.height/2,L,0,Math.PI*2),w.fillStyle=`${NG(o,A)}`,w.fill()}w.beginPath(),w.arc(this.width/2,this.height/2,r,0,Math.PI*2),w.fillStyle=o,w.strokeStyle="white",u?w.lineWidth=2+4*(1-A):w.lineWidth=4,w.fill(),w.stroke(),this.data=w.getImageData(0,0,this.width,this.height).data}return this.map?.triggerRepaint(),!0}}}function NG(o,i){let l=i-.1,u=1-l>.1?1-l:.1,m=Math.round(Math.min(Math.max(u??1,0),1)*255);return o+m.toString(16).toUpperCase()}var zG=[{id:"1",latitude:50.05423456789012,longitude:19.93845678901234},{id:"2",latitude:50.051601681737964,longitude:19.94527204613522},{id:"3",latitude:50.05773375024379,longitude:19.943222265625},{id:"4",latitude:50.05490381469543,longitude:19.93778991699219},{id:"5",latitude:50.05760487599164,longitude:19.937191009521484},{id:"6",latitude:50.05824547073284,longitude:19.930737670577457},{id:"7",latitude:50.05684123456789,longitude:19.93645678012345},{id:"8",latitude:50.05567891234567,longitude:19.94123456789012},{id:"9",latitude:50.05345678901234,longitude:19.93987654321098},{id:"10",latitude:50.05234567890123,longitude:19.93876543210987},{id:"11",latitude:50.05123456789012,longitude:19.94098765432109},{id:"12",latitude:50.05987654321098,longitude:19.93567890123456},{id:"13",latitude:50.05876543210987,longitude:19.94456789012345},{id:"14",latitude:50.05432109876543,longitude:19.94234567890123},{id:"15",latitude:50.05543210987654,longitude:19.94345678901234},{id:"16",latitude:50.05754321098765,longitude:19.94198765432109},{id:"17",latitude:50.05643210987654,longitude:19.93912345678901},{id:"18",latitude:50.05321098765432,longitude:19.9380123456789},{id:"19",latitude:50.05210987654321,longitude:19.93765432109876},{id:"20",latitude:50.05198765432109,longitude:19.93654321098765},{id:"21",latitude:50.05123456789012,longitude:19.93712345678901},{id:"22",latitude:50.05234567890123,longitude:19.94123456789012},{id:"23",latitude:50.05345678901234,longitude:19.94234567890123},{id:"24",latitude:50.05456789012345,longitude:19.93845678901234},{id:"25",latitude:50.05567890123456,longitude:19.93956789012345},{id:"26",latitude:50.05678901234567,longitude:19.94067890123456},{id:"27",latitude:50.05789012345678,longitude:19.93578901234567},{id:"28",latitude:50.05890123456789,longitude:19.93689012345678},{id:"29",latitude:50.0590123456789,longitude:19.94112345678901},{id:"30",latitude:50.05112345678901,longitude:19.94323456789012},{id:"31",latitude:50.05223456789012,longitude:19.93734567890123},{id:"32",latitude:50.05334567890123,longitude:19.94245678901234},{id:"33",latitude:50.05445678901234,longitude:19.93856789012345},{id:"34",latitude:50.05556789012345,longitude:19.93967890123456},{id:"35",latitude:50.05667890123456,longitude:19.94078901234567},{id:"36",latitude:50.05778901234567,longitude:19.93589012345678},{id:"37",latitude:50.05889012345678,longitude:19.93690123456789},{id:"38",latitude:50.05990123456789,longitude:19.9410123456789},{id:"39",latitude:50.0510123456789,longitude:19.94312345678901},{id:"40",latitude:50.05212345678901,longitude:19.93723456789012},{id:"41",latitude:50.05323456789012,longitude:19.94234567890123},{id:"42",latitude:50.05434567890123,longitude:19.93845678901234},{id:"43",latitude:50.05545678901234,longitude:19.93956789012345},{id:"44",latitude:50.05656789012345,longitude:19.94067890123456},{id:"45",latitude:50.05767890123456,longitude:19.93578901234567},{id:"46",latitude:50.05878901234567,longitude:19.93689012345678},{id:"47",latitude:50.05989012345678,longitude:19.9410123456789},{id:"48",latitude:50.05190123456789,longitude:19.94312345678901},{id:"49",latitude:50.0520123456789,longitude:19.93723456789012},{id:"50",latitude:50.05312345678901,longitude:19.94234567890123}],Ek=zG;var VG=o=>({width:o}),Tk=(()=>{let i=class i{constructor(){this.batteryLevel=58,this.batteryCondition=Hf.Medium}ngOnInit(){this.batteryCondition=this.calculateBatteryCondition(this.batteryLevel)}calculateBatteryCondition(u){return u>75?Hf.Good:u>50?Hf.Medium:u>25?Hf.Low:Hf.Critical}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=gi({type:i,selectors:[["app-battery-level"]],inputs:{batteryLevel:"batteryLevel"},standalone:!0,features:[_i],decls:6,vars:5,consts:[[1,"battery-label"],[1,"battery-container"],[1,"battery-level",3,"ngStyle"]],template:function(m,r){m&1&&(jn(0,"div",0),Wr(1,"Battery Level"),Un(),jn(2,"div",1)(3,"div",2),Wr(4),Un(),Wr(5),Un()),m&2&&(Hr(3),mo("ngStyle",gg(3,VG,r.batteryLevel+"%")),Hr(),Rc(" ",r.batteryLevel,"%"),Hr(),Rc(" ",r.batteryCondition,`
`))},dependencies:[Yi,Bv],styles:[".battery-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#c2baba;border-radius:25px;display:flex;align-items:center;padding-right:10px;justify-content:space-between}.battery-container[_ngcontent-%COMP%]   .battery-level[_ngcontent-%COMP%]{height:inherit;display:flex;align-items:center;justify-content:center;border-radius:25px;background-color:#ecc6ef}.battery-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}"]});let o=i;return o})(),Hf=function(o){return o.Good="GOOD",o.Medium="MEDIUM",o.Low="LOW",o.Critical="CRITICAL",o}(Hf||{});function jG(o,i){if(o&1&&(jn(0,"div",11),Wr(1),Un()),o&2){let l=i.$implicit;LT("ngClass",l.alarmLevel),Hr(),Rc(" ",l.alarmCount," ")}}var $C=(()=>{let i=class i{constructor(){this.showSensorDetails=!1,this.sensorId="Sensor #471",this.responsible="Deratex Polska",this.alarmsData=[{alarmLevel:"critical",alarmCount:3},{alarmLevel:"high",alarmCount:1},{alarmLevel:"low",alarmCount:2}],this.batteryLevel=78,this.location={street:"ul. Malborska",building:"85",city:"Krak\xF3w",additionalInfo:"2 pi\u0119tro, zaraz za winklem"},this.hideDetails=new Po}emitHideDetails(){this.hideDetails.emit(!0)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=gi({type:i,selectors:[["app-sensor-details"]],inputs:{showSensorDetails:"showSensorDetails",sensorId:"sensorId",responsible:"responsible",alarmsData:"alarmsData",batteryLevel:"batteryLevel",location:"location"},outputs:{hideDetails:"hideDetails"},standalone:!0,features:[_i],decls:17,vars:7,consts:[[1,"close",3,"click"],[1,"overlay-container"],[1,"sensor-container"],[1,"responsible-label"],[1,"responsible-container"],[1,"alarms-label"],[1,"alarms-container"],["class","alarm",3,"ngClass",4,"ngFor","ngForOf"],[3,"batteryLevel"],[1,"localization-label"],[1,"localization-container"],[1,"alarm",3,"ngClass"]],template:function(m,r){m&1&&(jn(0,"a",0),qr("click",function(){return r.emitHideDetails()}),Un(),jn(1,"div",1)(2,"div",2),Wr(3),Un(),jn(4,"div",3),Wr(5,"Responsible"),Un(),jn(6,"div",4),Wr(7),Un(),jn(8,"div",5),Wr(9,"Alarms"),Un(),jn(10,"div",6),mg(11,jG,2,2,"div",7),Un(),Cr(12,"app-battery-level",8),jn(13,"div",9),Wr(14,"Localization"),Un(),jn(15,"div",10),Wr(16),Un()()),m&2&&(Hr(3),Rc(" ",r.sensorId," "),Hr(4),Rc(" ",r.responsible," "),Hr(4),mo("ngForOf",r.alarmsData),Hr(),mo("batteryLevel",r.batteryLevel),Hr(4),FT(" ",r.location.street," ",r.location.building,", ",r.location.city," "))},dependencies:[Yi,fO,pO,Tk],styles:['.overlay-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:60%;height:100%;z-index:100;background-color:#fff;opacity:.9;padding-left:20%;padding-right:20%;text-wrap:nowrap;display:flex;flex-direction:column;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif;transition:all .5s}.overlay-container[_ngcontent-%COMP%]   .sensor-container[_ngcontent-%COMP%]{width:100%;margin-top:10vh;font-size:150%}.overlay-container[_ngcontent-%COMP%]   .responsible-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:10vh}.overlay-container[_ngcontent-%COMP%]   .responsible-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.overlay-container[_ngcontent-%COMP%]   .alarms-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:30px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:20px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]   .alarm[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:40px;border-radius:50%}.overlay-container[_ngcontent-%COMP%]   .localization-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}.overlay-container[_ngcontent-%COMP%]   .localization-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.critical[_ngcontent-%COMP%]{background-color:#ecc6ef}.high[_ngcontent-%COMP%]{background-color:#ffeb82}.low[_ngcontent-%COMP%]{background-color:#eaebed}.close[_ngcontent-%COMP%]{position:absolute;z-index:105;right:32px;top:20px;width:20px;height:20px;scale:.7}.close[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}.close[_ngcontent-%COMP%]:before, .close[_ngcontent-%COMP%]:after{z-index:105;position:absolute;left:15px;content:" ";height:33px;width:2px;background-color:#333}.close[_ngcontent-%COMP%]:before{transform:rotate(45deg)}.close[_ngcontent-%COMP%]:after{transform:rotate(-45deg)}']});let o=i;return o})();var GC=(()=>{let i=class i{constructor(){this.url="http://localhost:3000/places"}getAllLocations(){return Xm(this,null,function*(){let m=yield(yield fetch(this.url)).text();return JSON.parse(m)??[]})}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Th=class extends Map{constructor(i,l=GG){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:l}}),i!=null)for(let[u,m]of i)this.set(u,m)}get(i){return super.get(Sk(this,i))}has(i){return super.has(Sk(this,i))}set(i,l){return super.set(UG(this,i),l)}delete(i){return super.delete($G(this,i))}};function Sk({_intern:o,_key:i},l){let u=i(l);return o.has(u)?o.get(u):l}function UG({_intern:o,_key:i},l){let u=i(l);return o.has(u)?o.get(u):(o.set(u,l),l)}function $G({_intern:o,_key:i},l){let u=i(l);return o.has(u)&&(l=o.get(u),o.delete(u)),l}function GG(o){return o!==null&&typeof o=="object"?o.valueOf():o}function fx(o){return o}function px(o,...i){return HG(o,fx,fx,i)}function HG(o,i,l,u){return function m(r,w){if(w>=u.length)return l(r);let I=new Th,A=u[w++],L=-1;for(let $ of r){let Q=A($,++L,r),me=I.get(Q);me?me.push($):I.set(Q,[$])}for(let[$,Q]of I)I.set($,m(Q,w));return i(I)}(o,0)}var qG={value:()=>{}};function Dk(){for(var o=0,i=arguments.length,l={},u;o<i;++o){if(!(u=arguments[o]+"")||u in l||/[\s.]/.test(u))throw new Error("illegal type: "+u);l[u]=[]}return new mx(l)}function mx(o){this._=o}function WG(o,i){return o.trim().split(/^|\s+/).map(function(l){var u="",m=l.indexOf(".");if(m>=0&&(u=l.slice(m+1),l=l.slice(0,m)),l&&!i.hasOwnProperty(l))throw new Error("unknown type: "+l);return{type:l,name:u}})}mx.prototype=Dk.prototype={constructor:mx,on:function(o,i){var l=this._,u=WG(o+"",l),m,r=-1,w=u.length;if(arguments.length<2){for(;++r<w;)if((m=(o=u[r]).type)&&(m=ZG(l[m],o.name)))return m;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++r<w;)if(m=(o=u[r]).type)l[m]=Ik(l[m],o.name,i);else if(i==null)for(m in l)l[m]=Ik(l[m],o.name,null);return this},copy:function(){var o={},i=this._;for(var l in i)o[l]=i[l].slice();return new mx(o)},call:function(o,i){if((m=arguments.length-2)>0)for(var l=new Array(m),u=0,m,r;u<m;++u)l[u]=arguments[u+2];if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(r=this._[o],u=0,m=r.length;u<m;++u)r[u].value.apply(i,l)},apply:function(o,i,l){if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(var u=this._[o],m=0,r=u.length;m<r;++m)u[m].value.apply(i,l)}};function ZG(o,i){for(var l=0,u=o.length,m;l<u;++l)if((m=o[l]).name===i)return m.value}function Ik(o,i,l){for(var u=0,m=o.length;u<m;++u)if(o[u].name===i){o[u]=qG,o=o.slice(0,u).concat(o.slice(u+1));break}return l!=null&&o.push({name:i,value:l}),o}var Ch=Dk;var gx="http://www.w3.org/1999/xhtml",HC={svg:"http://www.w3.org/2000/svg",xhtml:gx,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ll(o){var i=o+="",l=i.indexOf(":");return l>=0&&(i=o.slice(0,l))!=="xmlns"&&(o=o.slice(l+1)),HC.hasOwnProperty(i)?{space:HC[i],local:o}:o}function XG(o){return function(){var i=this.ownerDocument,l=this.namespaceURI;return l===gx&&i.documentElement.namespaceURI===gx?i.createElement(o):i.createElementNS(l,o)}}function YG(o){return function(){return this.ownerDocument.createElementNS(o.space,o.local)}}function _x(o){var i=ll(o);return(i.local?YG:XG)(i)}function KG(){}function Sh(o){return o==null?KG:function(){return this.querySelector(o)}}function Mk(o){typeof o!="function"&&(o=Sh(o));for(var i=this._groups,l=i.length,u=new Array(l),m=0;m<l;++m)for(var r=i[m],w=r.length,I=u[m]=new Array(w),A,L,$=0;$<w;++$)(A=r[$])&&(L=o.call(A,A.__data__,$,r))&&("__data__"in A&&(L.__data__=A.__data__),I[$]=L);return new Vr(u,this._parents)}function qC(o){return o==null?[]:Array.isArray(o)?o:Array.from(o)}function QG(){return[]}function Hg(o){return o==null?QG:function(){return this.querySelectorAll(o)}}function JG(o){return function(){return qC(o.apply(this,arguments))}}function Ak(o){typeof o=="function"?o=JG(o):o=Hg(o);for(var i=this._groups,l=i.length,u=[],m=[],r=0;r<l;++r)for(var w=i[r],I=w.length,A,L=0;L<I;++L)(A=w[L])&&(u.push(o.call(A,A.__data__,L,w)),m.push(A));return new Vr(u,m)}function qg(o){return function(){return this.matches(o)}}function yx(o){return function(i){return i.matches(o)}}var eH=Array.prototype.find;function tH(o){return function(){return eH.call(this.children,o)}}function nH(){return this.firstElementChild}function Pk(o){return this.select(o==null?nH:tH(typeof o=="function"?o:yx(o)))}var rH=Array.prototype.filter;function iH(){return Array.from(this.children)}function oH(o){return function(){return rH.call(this.children,o)}}function Rk(o){return this.selectAll(o==null?iH:oH(typeof o=="function"?o:yx(o)))}function Ok(o){typeof o!="function"&&(o=qg(o));for(var i=this._groups,l=i.length,u=new Array(l),m=0;m<l;++m)for(var r=i[m],w=r.length,I=u[m]=[],A,L=0;L<w;++L)(A=r[L])&&o.call(A,A.__data__,L,r)&&I.push(A);return new Vr(u,this._parents)}function vx(o){return new Array(o.length)}function kk(){return new Vr(this._enter||this._groups.map(vx),this._parents)}function Wg(o,i){this.ownerDocument=o.ownerDocument,this.namespaceURI=o.namespaceURI,this._next=null,this._parent=o,this.__data__=i}Wg.prototype={constructor:Wg,appendChild:function(o){return this._parent.insertBefore(o,this._next)},insertBefore:function(o,i){return this._parent.insertBefore(o,i)},querySelector:function(o){return this._parent.querySelector(o)},querySelectorAll:function(o){return this._parent.querySelectorAll(o)}};function Lk(o){return function(){return o}}function sH(o,i,l,u,m,r){for(var w=0,I,A=i.length,L=r.length;w<L;++w)(I=i[w])?(I.__data__=r[w],u[w]=I):l[w]=new Wg(o,r[w]);for(;w<A;++w)(I=i[w])&&(m[w]=I)}function aH(o,i,l,u,m,r,w){var I,A,L=new Map,$=i.length,Q=r.length,me=new Array($),he;for(I=0;I<$;++I)(A=i[I])&&(me[I]=he=w.call(A,A.__data__,I,i)+"",L.has(he)?m[I]=A:L.set(he,A));for(I=0;I<Q;++I)he=w.call(o,r[I],I,r)+"",(A=L.get(he))?(u[I]=A,A.__data__=r[I],L.delete(he)):l[I]=new Wg(o,r[I]);for(I=0;I<$;++I)(A=i[I])&&L.get(me[I])===A&&(m[I]=A)}function lH(o){return o.__data__}function Fk(o,i){if(!arguments.length)return Array.from(this,lH);var l=i?aH:sH,u=this._parents,m=this._groups;typeof o!="function"&&(o=Lk(o));for(var r=m.length,w=new Array(r),I=new Array(r),A=new Array(r),L=0;L<r;++L){var $=u[L],Q=m[L],me=Q.length,he=cH(o.call($,$&&$.__data__,L,u)),be=he.length,Ie=I[L]=new Array(be),Qe=w[L]=new Array(be),ze=A[L]=new Array(me);l($,Q,Ie,Qe,ze,he,i);for(var nt=0,ft=0,Ue,Nt;nt<be;++nt)if(Ue=Ie[nt]){for(nt>=ft&&(ft=nt+1);!(Nt=Qe[ft])&&++ft<be;);Ue._next=Nt||null}}return w=new Vr(w,u),w._enter=I,w._exit=A,w}function cH(o){return typeof o=="object"&&"length"in o?o:Array.from(o)}function Nk(){return new Vr(this._exit||this._groups.map(vx),this._parents)}function zk(o,i,l){var u=this.enter(),m=this,r=this.exit();return typeof o=="function"?(u=o(u),u&&(u=u.selection())):u=u.append(o+""),i!=null&&(m=i(m),m&&(m=m.selection())),l==null?r.remove():l(r),u&&m?u.merge(m).order():m}function Bk(o){for(var i=o.selection?o.selection():o,l=this._groups,u=i._groups,m=l.length,r=u.length,w=Math.min(m,r),I=new Array(m),A=0;A<w;++A)for(var L=l[A],$=u[A],Q=L.length,me=I[A]=new Array(Q),he,be=0;be<Q;++be)(he=L[be]||$[be])&&(me[be]=he);for(;A<m;++A)I[A]=l[A];return new Vr(I,this._parents)}function Vk(){for(var o=this._groups,i=-1,l=o.length;++i<l;)for(var u=o[i],m=u.length-1,r=u[m],w;--m>=0;)(w=u[m])&&(r&&w.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(w,r),r=w);return this}function jk(o){o||(o=uH);function i(Q,me){return Q&&me?o(Q.__data__,me.__data__):!Q-!me}for(var l=this._groups,u=l.length,m=new Array(u),r=0;r<u;++r){for(var w=l[r],I=w.length,A=m[r]=new Array(I),L,$=0;$<I;++$)(L=w[$])&&(A[$]=L);A.sort(i)}return new Vr(m,this._parents).order()}function uH(o,i){return o<i?-1:o>i?1:o>=i?0:NaN}function Uk(){var o=arguments[0];return arguments[0]=this,o.apply(null,arguments),this}function $k(){return Array.from(this)}function Gk(){for(var o=this._groups,i=0,l=o.length;i<l;++i)for(var u=o[i],m=0,r=u.length;m<r;++m){var w=u[m];if(w)return w}return null}function Hk(){let o=0;for(let i of this)++o;return o}function qk(){return!this.node()}function Wk(o){for(var i=this._groups,l=0,u=i.length;l<u;++l)for(var m=i[l],r=0,w=m.length,I;r<w;++r)(I=m[r])&&o.call(I,I.__data__,r,m);return this}function hH(o){return function(){this.removeAttribute(o)}}function dH(o){return function(){this.removeAttributeNS(o.space,o.local)}}function fH(o,i){return function(){this.setAttribute(o,i)}}function pH(o,i){return function(){this.setAttributeNS(o.space,o.local,i)}}function mH(o,i){return function(){var l=i.apply(this,arguments);l==null?this.removeAttribute(o):this.setAttribute(o,l)}}function gH(o,i){return function(){var l=i.apply(this,arguments);l==null?this.removeAttributeNS(o.space,o.local):this.setAttributeNS(o.space,o.local,l)}}function Zk(o,i){var l=ll(o);if(arguments.length<2){var u=this.node();return l.local?u.getAttributeNS(l.space,l.local):u.getAttribute(l)}return this.each((i==null?l.local?dH:hH:typeof i=="function"?l.local?gH:mH:l.local?pH:fH)(l,i))}function xx(o){return o.ownerDocument&&o.ownerDocument.defaultView||o.document&&o||o.defaultView}function _H(o){return function(){this.style.removeProperty(o)}}function yH(o,i,l){return function(){this.style.setProperty(o,i,l)}}function vH(o,i,l){return function(){var u=i.apply(this,arguments);u==null?this.style.removeProperty(o):this.style.setProperty(o,u,l)}}function Xk(o,i,l){return arguments.length>1?this.each((i==null?_H:typeof i=="function"?vH:yH)(o,i,l??"")):Nc(this.node(),o)}function Nc(o,i){return o.style.getPropertyValue(i)||xx(o).getComputedStyle(o,null).getPropertyValue(i)}function xH(o){return function(){delete this[o]}}function bH(o,i){return function(){this[o]=i}}function wH(o,i){return function(){var l=i.apply(this,arguments);l==null?delete this[o]:this[o]=l}}function Yk(o,i){return arguments.length>1?this.each((i==null?xH:typeof i=="function"?wH:bH)(o,i)):this.node()[o]}function Kk(o){return o.trim().split(/^|\s+/)}function WC(o){return o.classList||new Qk(o)}function Qk(o){this._node=o,this._names=Kk(o.getAttribute("class")||"")}Qk.prototype={add:function(o){var i=this._names.indexOf(o);i<0&&(this._names.push(o),this._node.setAttribute("class",this._names.join(" ")))},remove:function(o){var i=this._names.indexOf(o);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(o){return this._names.indexOf(o)>=0}};function Jk(o,i){for(var l=WC(o),u=-1,m=i.length;++u<m;)l.add(i[u])}function eL(o,i){for(var l=WC(o),u=-1,m=i.length;++u<m;)l.remove(i[u])}function EH(o){return function(){Jk(this,o)}}function TH(o){return function(){eL(this,o)}}function CH(o,i){return function(){(i.apply(this,arguments)?Jk:eL)(this,o)}}function tL(o,i){var l=Kk(o+"");if(arguments.length<2){for(var u=WC(this.node()),m=-1,r=l.length;++m<r;)if(!u.contains(l[m]))return!1;return!0}return this.each((typeof i=="function"?CH:i?EH:TH)(l,i))}function SH(){this.textContent=""}function IH(o){return function(){this.textContent=o}}function DH(o){return function(){var i=o.apply(this,arguments);this.textContent=i??""}}function nL(o){return arguments.length?this.each(o==null?SH:(typeof o=="function"?DH:IH)(o)):this.node().textContent}function MH(){this.innerHTML=""}function AH(o){return function(){this.innerHTML=o}}function PH(o){return function(){var i=o.apply(this,arguments);this.innerHTML=i??""}}function rL(o){return arguments.length?this.each(o==null?MH:(typeof o=="function"?PH:AH)(o)):this.node().innerHTML}function RH(){this.nextSibling&&this.parentNode.appendChild(this)}function iL(){return this.each(RH)}function OH(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function oL(){return this.each(OH)}function sL(o){var i=typeof o=="function"?o:_x(o);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function kH(){return null}function aL(o,i){var l=typeof o=="function"?o:_x(o),u=i==null?kH:typeof i=="function"?i:Sh(i);return this.select(function(){return this.insertBefore(l.apply(this,arguments),u.apply(this,arguments)||null)})}function LH(){var o=this.parentNode;o&&o.removeChild(this)}function lL(){return this.each(LH)}function FH(){var o=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(o,this.nextSibling):o}function NH(){var o=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(o,this.nextSibling):o}function cL(o){return this.select(o?NH:FH)}function uL(o){return arguments.length?this.property("__data__",o):this.node().__data__}function zH(o){return function(i){o.call(this,i,this.__data__)}}function BH(o){return o.trim().split(/^|\s+/).map(function(i){var l="",u=i.indexOf(".");return u>=0&&(l=i.slice(u+1),i=i.slice(0,u)),{type:i,name:l}})}function VH(o){return function(){var i=this.__on;if(i){for(var l=0,u=-1,m=i.length,r;l<m;++l)r=i[l],(!o.type||r.type===o.type)&&r.name===o.name?this.removeEventListener(r.type,r.listener,r.options):i[++u]=r;++u?i.length=u:delete this.__on}}}function jH(o,i,l){return function(){var u=this.__on,m,r=zH(i);if(u){for(var w=0,I=u.length;w<I;++w)if((m=u[w]).type===o.type&&m.name===o.name){this.removeEventListener(m.type,m.listener,m.options),this.addEventListener(m.type,m.listener=r,m.options=l),m.value=i;return}}this.addEventListener(o.type,r,l),m={type:o.type,name:o.name,value:i,listener:r,options:l},u?u.push(m):this.__on=[m]}}function hL(o,i,l){var u=BH(o+""),m,r=u.length,w;if(arguments.length<2){var I=this.node().__on;if(I){for(var A=0,L=I.length,$;A<L;++A)for(m=0,$=I[A];m<r;++m)if((w=u[m]).type===$.type&&w.name===$.name)return $.value}return}for(I=i?jH:VH,m=0;m<r;++m)this.each(I(u[m],i,l));return this}function dL(o,i,l){var u=xx(o),m=u.CustomEvent;typeof m=="function"?m=new m(i,l):(m=u.document.createEvent("Event"),l?(m.initEvent(i,l.bubbles,l.cancelable),m.detail=l.detail):m.initEvent(i,!1,!1)),o.dispatchEvent(m)}function UH(o,i){return function(){return dL(this,o,i)}}function $H(o,i){return function(){return dL(this,o,i.apply(this,arguments))}}function fL(o,i){return this.each((typeof i=="function"?$H:UH)(o,i))}function*pL(){for(var o=this._groups,i=0,l=o.length;i<l;++i)for(var u=o[i],m=0,r=u.length,w;m<r;++m)(w=u[m])&&(yield w)}var ZC=[null];function Vr(o,i){this._groups=o,this._parents=i}function mL(){return new Vr([[document.documentElement]],ZC)}function GH(){return this}Vr.prototype=mL.prototype={constructor:Vr,select:Mk,selectAll:Ak,selectChild:Pk,selectChildren:Rk,filter:Ok,data:Fk,enter:kk,exit:Nk,join:zk,merge:Bk,selection:GH,order:Vk,sort:jk,call:Uk,nodes:$k,node:Gk,size:Hk,empty:qk,each:Wk,attr:Zk,style:Xk,property:Yk,classed:tL,text:nL,html:rL,raise:iL,lower:oL,append:sL,insert:aL,remove:lL,clone:cL,datum:uL,on:hL,dispatch:fL,[Symbol.iterator]:pL};var cl=mL;function Ki(o){return typeof o=="string"?new Vr([[document.querySelector(o)]],[document.documentElement]):new Vr([[o]],ZC)}function gL(o){let i;for(;i=o.sourceEvent;)o=i;return o}function bx(o,i){if(o=gL(o),i===void 0&&(i=o.currentTarget),i){var l=i.ownerSVGElement||i;if(l.createSVGPoint){var u=l.createSVGPoint();return u.x=o.clientX,u.y=o.clientY,u=u.matrixTransform(i.getScreenCTM().inverse()),[u.x,u.y]}if(i.getBoundingClientRect){var m=i.getBoundingClientRect();return[o.clientX-m.left-i.clientLeft,o.clientY-m.top-i.clientTop]}}return[o.pageX,o.pageY]}var _L={passive:!1},Ih={capture:!0,passive:!1};function wx(o){o.stopImmediatePropagation()}function zc(o){o.preventDefault(),o.stopImmediatePropagation()}function yL(o){var i=o.document.documentElement,l=Ki(o).on("dragstart.drag",zc,Ih);"onselectstart"in i?l.on("selectstart.drag",zc,Ih):(i.__noselect=i.style.MozUserSelect,i.style.MozUserSelect="none")}function vL(o,i){var l=o.document.documentElement,u=Ki(o).on("dragstart.drag",null);i&&(u.on("click.drag",zc,Ih),setTimeout(function(){u.on("click.drag",null)},0)),"onselectstart"in l?u.on("selectstart.drag",null):(l.style.MozUserSelect=l.__noselect,delete l.__noselect)}var Zg=o=>()=>o;function Xg(o,{sourceEvent:i,subject:l,target:u,identifier:m,active:r,x:w,y:I,dx:A,dy:L,dispatch:$}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:i,enumerable:!0,configurable:!0},subject:{value:l,enumerable:!0,configurable:!0},target:{value:u,enumerable:!0,configurable:!0},identifier:{value:m,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:w,enumerable:!0,configurable:!0},y:{value:I,enumerable:!0,configurable:!0},dx:{value:A,enumerable:!0,configurable:!0},dy:{value:L,enumerable:!0,configurable:!0},_:{value:$}})}Xg.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function HH(o){return!o.ctrlKey&&!o.button}function qH(){return this.parentNode}function WH(o,i){return i??{x:o.x,y:o.y}}function ZH(){return navigator.maxTouchPoints||"ontouchstart"in this}function Yg(){var o=HH,i=qH,l=WH,u=ZH,m={},r=Ch("start","drag","end"),w=0,I,A,L,$,Q=0;function me(Ue){Ue.on("mousedown.drag",he).filter(u).on("touchstart.drag",Qe).on("touchmove.drag",ze,_L).on("touchend.drag touchcancel.drag",nt).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function he(Ue,Nt){if(!($||!o.call(this,Ue,Nt))){var Yt=ft(this,i.call(this,Ue,Nt),Ue,Nt,"mouse");Yt&&(Ki(Ue.view).on("mousemove.drag",be,Ih).on("mouseup.drag",Ie,Ih),yL(Ue.view),wx(Ue),L=!1,I=Ue.clientX,A=Ue.clientY,Yt("start",Ue))}}function be(Ue){if(zc(Ue),!L){var Nt=Ue.clientX-I,Yt=Ue.clientY-A;L=Nt*Nt+Yt*Yt>Q}m.mouse("drag",Ue)}function Ie(Ue){Ki(Ue.view).on("mousemove.drag mouseup.drag",null),vL(Ue.view,L),zc(Ue),m.mouse("end",Ue)}function Qe(Ue,Nt){if(o.call(this,Ue,Nt)){var Yt=Ue.changedTouches,Jt=i.call(this,Ue,Nt),wt=Yt.length,er,St;for(er=0;er<wt;++er)(St=ft(this,Jt,Ue,Nt,Yt[er].identifier,Yt[er]))&&(wx(Ue),St("start",Ue,Yt[er]))}}function ze(Ue){var Nt=Ue.changedTouches,Yt=Nt.length,Jt,wt;for(Jt=0;Jt<Yt;++Jt)(wt=m[Nt[Jt].identifier])&&(zc(Ue),wt("drag",Ue,Nt[Jt]))}function nt(Ue){var Nt=Ue.changedTouches,Yt=Nt.length,Jt,wt;for($&&clearTimeout($),$=setTimeout(function(){$=null},500),Jt=0;Jt<Yt;++Jt)(wt=m[Nt[Jt].identifier])&&(wx(Ue),wt("end",Ue,Nt[Jt]))}function ft(Ue,Nt,Yt,Jt,wt,er){var St=r.copy(),fr=bx(er||Yt,Nt),yr,kr,xn;if((xn=l.call(Ue,new Xg("beforestart",{sourceEvent:Yt,target:me,identifier:wt,active:w,x:fr[0],y:fr[1],dx:0,dy:0,dispatch:St}),Jt))!=null)return yr=xn.x-fr[0]||0,kr=xn.y-fr[1]||0,function Fo(bt,zt,Ht){var gn=fr,kt;switch(bt){case"start":m[wt]=Fo,kt=w++;break;case"end":delete m[wt],--w;case"drag":fr=bx(Ht||zt,Nt),kt=w;break}St.call(bt,Ue,new Xg(bt,{sourceEvent:zt,subject:xn,target:me,identifier:wt,active:kt,x:fr[0]+yr,y:fr[1]+kr,dx:fr[0]-gn[0],dy:fr[1]-gn[1],dispatch:St}),Jt)}}return me.filter=function(Ue){return arguments.length?(o=typeof Ue=="function"?Ue:Zg(!!Ue),me):o},me.container=function(Ue){return arguments.length?(i=typeof Ue=="function"?Ue:Zg(Ue),me):i},me.subject=function(Ue){return arguments.length?(l=typeof Ue=="function"?Ue:Zg(Ue),me):l},me.touchable=function(Ue){return arguments.length?(u=typeof Ue=="function"?Ue:Zg(!!Ue),me):u},me.on=function(){var Ue=r.on.apply(r,arguments);return Ue===r?me:Ue},me.clickDistance=function(Ue){return arguments.length?(Q=(Ue=+Ue)*Ue,me):Math.sqrt(Q)},me}function Ex(o,i,l){o.prototype=i.prototype=l,l.constructor=o}function XC(o,i){var l=Object.create(o.prototype);for(var u in i)l[u]=i[u];return l}function Jg(){}var Kg=.7,Sx=1/Kg,qf="\\s*([+-]?\\d+)\\s*",Qg="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ya="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",XH=/^#([0-9a-f]{3,8})$/,YH=new RegExp(`^rgb\\(${qf},${qf},${qf}\\)$`),KH=new RegExp(`^rgb\\(${ya},${ya},${ya}\\)$`),QH=new RegExp(`^rgba\\(${qf},${qf},${qf},${Qg}\\)$`),JH=new RegExp(`^rgba\\(${ya},${ya},${ya},${Qg}\\)$`),eq=new RegExp(`^hsl\\(${Qg},${ya},${ya}\\)$`),tq=new RegExp(`^hsla\\(${Qg},${ya},${ya},${Qg}\\)$`),xL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ex(Jg,Bc,{copy(o){return Object.assign(new this.constructor,this,o)},displayable(){return this.rgb().displayable()},hex:bL,formatHex:bL,formatHex8:nq,formatHsl:rq,formatRgb:wL,toString:wL});function bL(){return this.rgb().formatHex()}function nq(){return this.rgb().formatHex8()}function rq(){return DL(this).formatHsl()}function wL(){return this.rgb().formatRgb()}function Bc(o){var i,l;return o=(o+"").trim().toLowerCase(),(i=XH.exec(o))?(l=i[1].length,i=parseInt(i[1],16),l===6?EL(i):l===3?new go(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):l===8?Tx(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):l===4?Tx(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=YH.exec(o))?new go(i[1],i[2],i[3],1):(i=KH.exec(o))?new go(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=QH.exec(o))?Tx(i[1],i[2],i[3],i[4]):(i=JH.exec(o))?Tx(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=eq.exec(o))?SL(i[1],i[2]/100,i[3]/100,1):(i=tq.exec(o))?SL(i[1],i[2]/100,i[3]/100,i[4]):xL.hasOwnProperty(o)?EL(xL[o]):o==="transparent"?new go(NaN,NaN,NaN,0):null}function EL(o){return new go(o>>16&255,o>>8&255,o&255,1)}function Tx(o,i,l,u){return u<=0&&(o=i=l=NaN),new go(o,i,l,u)}function iq(o){return o instanceof Jg||(o=Bc(o)),o?(o=o.rgb(),new go(o.r,o.g,o.b,o.opacity)):new go}function Wf(o,i,l,u){return arguments.length===1?iq(o):new go(o,i,l,u??1)}function go(o,i,l,u){this.r=+o,this.g=+i,this.b=+l,this.opacity=+u}Ex(go,Wf,XC(Jg,{brighter(o){return o=o==null?Sx:Math.pow(Sx,o),new go(this.r*o,this.g*o,this.b*o,this.opacity)},darker(o){return o=o==null?Kg:Math.pow(Kg,o),new go(this.r*o,this.g*o,this.b*o,this.opacity)},rgb(){return this},clamp(){return new go(Mh(this.r),Mh(this.g),Mh(this.b),Ix(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:TL,formatHex:TL,formatHex8:oq,formatRgb:CL,toString:CL}));function TL(){return`#${Dh(this.r)}${Dh(this.g)}${Dh(this.b)}`}function oq(){return`#${Dh(this.r)}${Dh(this.g)}${Dh(this.b)}${Dh((isNaN(this.opacity)?1:this.opacity)*255)}`}function CL(){let o=Ix(this.opacity);return`${o===1?"rgb(":"rgba("}${Mh(this.r)}, ${Mh(this.g)}, ${Mh(this.b)}${o===1?")":`, ${o})`}`}function Ix(o){return isNaN(o)?1:Math.max(0,Math.min(1,o))}function Mh(o){return Math.max(0,Math.min(255,Math.round(o)||0))}function Dh(o){return o=Mh(o),(o<16?"0":"")+o.toString(16)}function SL(o,i,l,u){return u<=0?o=i=l=NaN:l<=0||l>=1?o=i=NaN:i<=0&&(o=NaN),new Rs(o,i,l,u)}function DL(o){if(o instanceof Rs)return new Rs(o.h,o.s,o.l,o.opacity);if(o instanceof Jg||(o=Bc(o)),!o)return new Rs;if(o instanceof Rs)return o;o=o.rgb();var i=o.r/255,l=o.g/255,u=o.b/255,m=Math.min(i,l,u),r=Math.max(i,l,u),w=NaN,I=r-m,A=(r+m)/2;return I?(i===r?w=(l-u)/I+(l<u)*6:l===r?w=(u-i)/I+2:w=(i-l)/I+4,I/=A<.5?r+m:2-r-m,w*=60):I=A>0&&A<1?0:w,new Rs(w,I,A,o.opacity)}function ML(o,i,l,u){return arguments.length===1?DL(o):new Rs(o,i,l,u??1)}function Rs(o,i,l,u){this.h=+o,this.s=+i,this.l=+l,this.opacity=+u}Ex(Rs,ML,XC(Jg,{brighter(o){return o=o==null?Sx:Math.pow(Sx,o),new Rs(this.h,this.s,this.l*o,this.opacity)},darker(o){return o=o==null?Kg:Math.pow(Kg,o),new Rs(this.h,this.s,this.l*o,this.opacity)},rgb(){var o=this.h%360+(this.h<0)*360,i=isNaN(o)||isNaN(this.s)?0:this.s,l=this.l,u=l+(l<.5?l:1-l)*i,m=2*l-u;return new go(YC(o>=240?o-240:o+120,m,u),YC(o,m,u),YC(o<120?o+240:o-120,m,u),this.opacity)},clamp(){return new Rs(IL(this.h),Cx(this.s),Cx(this.l),Ix(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let o=Ix(this.opacity);return`${o===1?"hsl(":"hsla("}${IL(this.h)}, ${Cx(this.s)*100}%, ${Cx(this.l)*100}%${o===1?")":`, ${o})`}`}}));function IL(o){return o=(o||0)%360,o<0?o+360:o}function Cx(o){return Math.max(0,Math.min(1,o||0))}function YC(o,i,l){return(o<60?i+(l-i)*o/60:o<180?l:o<240?i+(l-i)*(240-o)/60:i)*255}function KC(o,i,l,u,m){var r=o*o,w=r*o;return((1-3*o+3*r-w)*i+(4-6*r+3*w)*l+(1+3*o+3*r-3*w)*u+w*m)/6}function AL(o){var i=o.length-1;return function(l){var u=l<=0?l=0:l>=1?(l=1,i-1):Math.floor(l*i),m=o[u],r=o[u+1],w=u>0?o[u-1]:2*m-r,I=u<i-1?o[u+2]:2*r-m;return KC((l-u/i)*i,w,m,r,I)}}function PL(o){var i=o.length;return function(l){var u=Math.floor(((l%=1)<0?++l:l)*i),m=o[(u+i-1)%i],r=o[u%i],w=o[(u+1)%i],I=o[(u+2)%i];return KC((l-u/i)*i,m,r,w,I)}}var QC=o=>()=>o;function sq(o,i){return function(l){return o+l*i}}function aq(o,i,l){return o=Math.pow(o,l),i=Math.pow(i,l)-o,l=1/l,function(u){return Math.pow(o+u*i,l)}}function RL(o){return(o=+o)==1?Dx:function(i,l){return l-i?aq(i,l,o):QC(isNaN(i)?l:i)}}function Dx(o,i){var l=i-o;return l?sq(o,l):QC(isNaN(o)?i:o)}var Mx=function o(i){var l=RL(i);function u(m,r){var w=l((m=Wf(m)).r,(r=Wf(r)).r),I=l(m.g,r.g),A=l(m.b,r.b),L=Dx(m.opacity,r.opacity);return function($){return m.r=w($),m.g=I($),m.b=A($),m.opacity=L($),m+""}}return u.gamma=o,u}(1);function OL(o){return function(i){var l=i.length,u=new Array(l),m=new Array(l),r=new Array(l),w,I;for(w=0;w<l;++w)I=Wf(i[w]),u[w]=I.r||0,m[w]=I.g||0,r[w]=I.b||0;return u=o(u),m=o(m),r=o(r),I.opacity=1,function(A){return I.r=u(A),I.g=m(A),I.b=r(A),I+""}}}var lq=OL(AL),cq=OL(PL);function ns(o,i){return o=+o,i=+i,function(l){return o*(1-l)+i*l}}var eS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,JC=new RegExp(eS.source,"g");function uq(o){return function(){return o}}function hq(o){return function(i){return o(i)+""}}function tS(o,i){var l=eS.lastIndex=JC.lastIndex=0,u,m,r,w=-1,I=[],A=[];for(o=o+"",i=i+"";(u=eS.exec(o))&&(m=JC.exec(i));)(r=m.index)>l&&(r=i.slice(l,r),I[w]?I[w]+=r:I[++w]=r),(u=u[0])===(m=m[0])?I[w]?I[w]+=m:I[++w]=m:(I[++w]=null,A.push({i:w,x:ns(u,m)})),l=JC.lastIndex;return l<i.length&&(r=i.slice(l),I[w]?I[w]+=r:I[++w]=r),I.length<2?A[0]?hq(A[0].x):uq(i):(i=A.length,function(L){for(var $=0,Q;$<i;++$)I[(Q=A[$]).i]=Q.x(L);return I.join("")})}var kL=180/Math.PI,Ax={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function nS(o,i,l,u,m,r){var w,I,A;return(w=Math.sqrt(o*o+i*i))&&(o/=w,i/=w),(A=o*l+i*u)&&(l-=o*A,u-=i*A),(I=Math.sqrt(l*l+u*u))&&(l/=I,u/=I,A/=I),o*u<i*l&&(o=-o,i=-i,A=-A,w=-w),{translateX:m,translateY:r,rotate:Math.atan2(i,o)*kL,skewX:Math.atan(A)*kL,scaleX:w,scaleY:I}}var Px;function LL(o){let i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(o+"");return i.isIdentity?Ax:nS(i.a,i.b,i.c,i.d,i.e,i.f)}function FL(o){return o==null?Ax:(Px||(Px=document.createElementNS("http://www.w3.org/2000/svg","g")),Px.setAttribute("transform",o),(o=Px.transform.baseVal.consolidate())?(o=o.matrix,nS(o.a,o.b,o.c,o.d,o.e,o.f)):Ax)}function NL(o,i,l,u){function m(L){return L.length?L.pop()+" ":""}function r(L,$,Q,me,he,be){if(L!==Q||$!==me){var Ie=he.push("translate(",null,i,null,l);be.push({i:Ie-4,x:ns(L,Q)},{i:Ie-2,x:ns($,me)})}else(Q||me)&&he.push("translate("+Q+i+me+l)}function w(L,$,Q,me){L!==$?(L-$>180?$+=360:$-L>180&&(L+=360),me.push({i:Q.push(m(Q)+"rotate(",null,u)-2,x:ns(L,$)})):$&&Q.push(m(Q)+"rotate("+$+u)}function I(L,$,Q,me){L!==$?me.push({i:Q.push(m(Q)+"skewX(",null,u)-2,x:ns(L,$)}):$&&Q.push(m(Q)+"skewX("+$+u)}function A(L,$,Q,me,he,be){if(L!==Q||$!==me){var Ie=he.push(m(he)+"scale(",null,",",null,")");be.push({i:Ie-4,x:ns(L,Q)},{i:Ie-2,x:ns($,me)})}else(Q!==1||me!==1)&&he.push(m(he)+"scale("+Q+","+me+")")}return function(L,$){var Q=[],me=[];return L=o(L),$=o($),r(L.translateX,L.translateY,$.translateX,$.translateY,Q,me),w(L.rotate,$.rotate,Q,me),I(L.skewX,$.skewX,Q,me),A(L.scaleX,L.scaleY,$.scaleX,$.scaleY,Q,me),L=$=null,function(he){for(var be=-1,Ie=me.length,Qe;++be<Ie;)Q[(Qe=me[be]).i]=Qe.x(he);return Q.join("")}}}var rS=NL(LL,"px, ","px)","deg)"),iS=NL(FL,", ",")",")");var Zf=0,t_=0,e_=0,BL=1e3,Rx,n_,Ox=0,Ah=0,kx=0,r_=typeof performance=="object"&&performance.now?performance:Date,VL=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(o){setTimeout(o,17)};function o_(){return Ah||(VL(dq),Ah=r_.now()+kx)}function dq(){Ah=0}function i_(){this._call=this._time=this._next=null}i_.prototype=Xf.prototype={constructor:i_,restart:function(o,i,l){if(typeof o!="function")throw new TypeError("callback is not a function");l=(l==null?o_():+l)+(i==null?0:+i),!this._next&&n_!==this&&(n_?n_._next=this:Rx=this,n_=this),this._call=o,this._time=l,oS()},stop:function(){this._call&&(this._call=null,this._time=1/0,oS())}};function Xf(o,i,l){var u=new i_;return u.restart(o,i,l),u}function jL(){o_(),++Zf;for(var o=Rx,i;o;)(i=Ah-o._time)>=0&&o._call.call(void 0,i),o=o._next;--Zf}function zL(){Ah=(Ox=r_.now())+kx,Zf=t_=0;try{jL()}finally{Zf=0,pq(),Ah=0}}function fq(){var o=r_.now(),i=o-Ox;i>BL&&(kx-=i,Ox=o)}function pq(){for(var o,i=Rx,l,u=1/0;i;)i._call?(u>i._time&&(u=i._time),o=i,i=i._next):(l=i._next,i._next=null,i=o?o._next=l:Rx=l);n_=o,oS(u)}function oS(o){if(!Zf){t_&&(t_=clearTimeout(t_));var i=o-Ah;i>24?(o<1/0&&(t_=setTimeout(zL,o-r_.now()-kx)),e_&&(e_=clearInterval(e_))):(e_||(Ox=r_.now(),e_=setInterval(fq,BL)),Zf=1,VL(zL))}}function Lx(o,i,l){var u=new i_;return i=i==null?0:+i,u.restart(m=>{u.stop(),o(m+i)},i,l),u}var mq=Ch("start","end","cancel","interrupt"),gq=[],GL=0,UL=1,Nx=2,Fx=3,$L=4,zx=5,s_=6;function Vc(o,i,l,u,m,r){var w=o.__transition;if(!w)o.__transition={};else if(l in w)return;_q(o,l,{name:i,index:u,group:m,on:mq,tween:gq,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:GL})}function a_(o,i){var l=yi(o,i);if(l.state>GL)throw new Error("too late; already scheduled");return l}function ki(o,i){var l=yi(o,i);if(l.state>Fx)throw new Error("too late; already running");return l}function yi(o,i){var l=o.__transition;if(!l||!(l=l[i]))throw new Error("transition not found");return l}function _q(o,i,l){var u=o.__transition,m;u[i]=l,l.timer=Xf(r,0,l.time);function r(L){l.state=UL,l.timer.restart(w,l.delay,l.time),l.delay<=L&&w(L-l.delay)}function w(L){var $,Q,me,he;if(l.state!==UL)return A();for($ in u)if(he=u[$],he.name===l.name){if(he.state===Fx)return Lx(w);he.state===$L?(he.state=s_,he.timer.stop(),he.on.call("interrupt",o,o.__data__,he.index,he.group),delete u[$]):+$<i&&(he.state=s_,he.timer.stop(),he.on.call("cancel",o,o.__data__,he.index,he.group),delete u[$])}if(Lx(function(){l.state===Fx&&(l.state=$L,l.timer.restart(I,l.delay,l.time),I(L))}),l.state=Nx,l.on.call("start",o,o.__data__,l.index,l.group),l.state===Nx){for(l.state=Fx,m=new Array(me=l.tween.length),$=0,Q=-1;$<me;++$)(he=l.tween[$].value.call(o,o.__data__,l.index,l.group))&&(m[++Q]=he);m.length=Q+1}}function I(L){for(var $=L<l.duration?l.ease.call(null,L/l.duration):(l.timer.restart(A),l.state=zx,1),Q=-1,me=m.length;++Q<me;)m[Q].call(o,$);l.state===zx&&(l.on.call("end",o,o.__data__,l.index,l.group),A())}function A(){l.state=s_,l.timer.stop(),delete u[i];for(var L in u)return;delete o.__transition}}function Bx(o,i){var l=o.__transition,u,m,r=!0,w;if(l){i=i==null?null:i+"";for(w in l){if((u=l[w]).name!==i){r=!1;continue}m=u.state>Nx&&u.state<zx,u.state=s_,u.timer.stop(),u.on.call(m?"interrupt":"cancel",o,o.__data__,u.index,u.group),delete l[w]}r&&delete o.__transition}}function HL(o){return this.each(function(){Bx(this,o)})}function yq(o,i){var l,u;return function(){var m=ki(this,o),r=m.tween;if(r!==l){u=l=r;for(var w=0,I=u.length;w<I;++w)if(u[w].name===i){u=u.slice(),u.splice(w,1);break}}m.tween=u}}function vq(o,i,l){var u,m;if(typeof l!="function")throw new Error;return function(){var r=ki(this,o),w=r.tween;if(w!==u){m=(u=w).slice();for(var I={name:i,value:l},A=0,L=m.length;A<L;++A)if(m[A].name===i){m[A]=I;break}A===L&&m.push(I)}r.tween=m}}function qL(o,i){var l=this._id;if(o+="",arguments.length<2){for(var u=yi(this.node(),l).tween,m=0,r=u.length,w;m<r;++m)if((w=u[m]).name===o)return w.value;return null}return this.each((i==null?yq:vq)(l,o,i))}function Yf(o,i,l){var u=o._id;return o.each(function(){var m=ki(this,u);(m.value||(m.value={}))[i]=l.apply(this,arguments)}),function(m){return yi(m,u).value[i]}}function Vx(o,i){var l;return(typeof i=="number"?ns:i instanceof Bc?Mx:(l=Bc(i))?(i=l,Mx):tS)(o,i)}function xq(o){return function(){this.removeAttribute(o)}}function bq(o){return function(){this.removeAttributeNS(o.space,o.local)}}function wq(o,i,l){var u,m=l+"",r;return function(){var w=this.getAttribute(o);return w===m?null:w===u?r:r=i(u=w,l)}}function Eq(o,i,l){var u,m=l+"",r;return function(){var w=this.getAttributeNS(o.space,o.local);return w===m?null:w===u?r:r=i(u=w,l)}}function Tq(o,i,l){var u,m,r;return function(){var w,I=l(this),A;return I==null?void this.removeAttribute(o):(w=this.getAttribute(o),A=I+"",w===A?null:w===u&&A===m?r:(m=A,r=i(u=w,I)))}}function Cq(o,i,l){var u,m,r;return function(){var w,I=l(this),A;return I==null?void this.removeAttributeNS(o.space,o.local):(w=this.getAttributeNS(o.space,o.local),A=I+"",w===A?null:w===u&&A===m?r:(m=A,r=i(u=w,I)))}}function WL(o,i){var l=ll(o),u=l==="transform"?iS:Vx;return this.attrTween(o,typeof i=="function"?(l.local?Cq:Tq)(l,u,Yf(this,"attr."+o,i)):i==null?(l.local?bq:xq)(l):(l.local?Eq:wq)(l,u,i))}function Sq(o,i){return function(l){this.setAttribute(o,i.call(this,l))}}function Iq(o,i){return function(l){this.setAttributeNS(o.space,o.local,i.call(this,l))}}function Dq(o,i){var l,u;function m(){var r=i.apply(this,arguments);return r!==u&&(l=(u=r)&&Iq(o,r)),l}return m._value=i,m}function Mq(o,i){var l,u;function m(){var r=i.apply(this,arguments);return r!==u&&(l=(u=r)&&Sq(o,r)),l}return m._value=i,m}function ZL(o,i){var l="attr."+o;if(arguments.length<2)return(l=this.tween(l))&&l._value;if(i==null)return this.tween(l,null);if(typeof i!="function")throw new Error;var u=ll(o);return this.tween(l,(u.local?Dq:Mq)(u,i))}function Aq(o,i){return function(){a_(this,o).delay=+i.apply(this,arguments)}}function Pq(o,i){return i=+i,function(){a_(this,o).delay=i}}function XL(o){var i=this._id;return arguments.length?this.each((typeof o=="function"?Aq:Pq)(i,o)):yi(this.node(),i).delay}function Rq(o,i){return function(){ki(this,o).duration=+i.apply(this,arguments)}}function Oq(o,i){return i=+i,function(){ki(this,o).duration=i}}function YL(o){var i=this._id;return arguments.length?this.each((typeof o=="function"?Rq:Oq)(i,o)):yi(this.node(),i).duration}function kq(o,i){if(typeof i!="function")throw new Error;return function(){ki(this,o).ease=i}}function KL(o){var i=this._id;return arguments.length?this.each(kq(i,o)):yi(this.node(),i).ease}function Lq(o,i){return function(){var l=i.apply(this,arguments);if(typeof l!="function")throw new Error;ki(this,o).ease=l}}function QL(o){if(typeof o!="function")throw new Error;return this.each(Lq(this._id,o))}function JL(o){typeof o!="function"&&(o=qg(o));for(var i=this._groups,l=i.length,u=new Array(l),m=0;m<l;++m)for(var r=i[m],w=r.length,I=u[m]=[],A,L=0;L<w;++L)(A=r[L])&&o.call(A,A.__data__,L,r)&&I.push(A);return new Qi(u,this._parents,this._name,this._id)}function eF(o){if(o._id!==this._id)throw new Error;for(var i=this._groups,l=o._groups,u=i.length,m=l.length,r=Math.min(u,m),w=new Array(u),I=0;I<r;++I)for(var A=i[I],L=l[I],$=A.length,Q=w[I]=new Array($),me,he=0;he<$;++he)(me=A[he]||L[he])&&(Q[he]=me);for(;I<u;++I)w[I]=i[I];return new Qi(w,this._parents,this._name,this._id)}function Fq(o){return(o+"").trim().split(/^|\s+/).every(function(i){var l=i.indexOf(".");return l>=0&&(i=i.slice(0,l)),!i||i==="start"})}function Nq(o,i,l){var u,m,r=Fq(i)?a_:ki;return function(){var w=r(this,o),I=w.on;I!==u&&(m=(u=I).copy()).on(i,l),w.on=m}}function tF(o,i){var l=this._id;return arguments.length<2?yi(this.node(),l).on.on(o):this.each(Nq(l,o,i))}function zq(o){return function(){var i=this.parentNode;for(var l in this.__transition)if(+l!==o)return;i&&i.removeChild(this)}}function nF(){return this.on("end.remove",zq(this._id))}function rF(o){var i=this._name,l=this._id;typeof o!="function"&&(o=Sh(o));for(var u=this._groups,m=u.length,r=new Array(m),w=0;w<m;++w)for(var I=u[w],A=I.length,L=r[w]=new Array(A),$,Q,me=0;me<A;++me)($=I[me])&&(Q=o.call($,$.__data__,me,I))&&("__data__"in $&&(Q.__data__=$.__data__),L[me]=Q,Vc(L[me],i,l,me,L,yi($,l)));return new Qi(r,this._parents,i,l)}function iF(o){var i=this._name,l=this._id;typeof o!="function"&&(o=Hg(o));for(var u=this._groups,m=u.length,r=[],w=[],I=0;I<m;++I)for(var A=u[I],L=A.length,$,Q=0;Q<L;++Q)if($=A[Q]){for(var me=o.call($,$.__data__,Q,A),he,be=yi($,l),Ie=0,Qe=me.length;Ie<Qe;++Ie)(he=me[Ie])&&Vc(he,i,l,Ie,me,be);r.push(me),w.push($)}return new Qi(r,w,i,l)}var Bq=cl.prototype.constructor;function oF(){return new Bq(this._groups,this._parents)}function Vq(o,i){var l,u,m;return function(){var r=Nc(this,o),w=(this.style.removeProperty(o),Nc(this,o));return r===w?null:r===l&&w===u?m:m=i(l=r,u=w)}}function sF(o){return function(){this.style.removeProperty(o)}}function jq(o,i,l){var u,m=l+"",r;return function(){var w=Nc(this,o);return w===m?null:w===u?r:r=i(u=w,l)}}function Uq(o,i,l){var u,m,r;return function(){var w=Nc(this,o),I=l(this),A=I+"";return I==null&&(A=I=(this.style.removeProperty(o),Nc(this,o))),w===A?null:w===u&&A===m?r:(m=A,r=i(u=w,I))}}function $q(o,i){var l,u,m,r="style."+i,w="end."+r,I;return function(){var A=ki(this,o),L=A.on,$=A.value[r]==null?I||(I=sF(i)):void 0;(L!==l||m!==$)&&(u=(l=L).copy()).on(w,m=$),A.on=u}}function aF(o,i,l){var u=(o+="")=="transform"?rS:Vx;return i==null?this.styleTween(o,Vq(o,u)).on("end.style."+o,sF(o)):typeof i=="function"?this.styleTween(o,Uq(o,u,Yf(this,"style."+o,i))).each($q(this._id,o)):this.styleTween(o,jq(o,u,i),l).on("end.style."+o,null)}function Gq(o,i,l){return function(u){this.style.setProperty(o,i.call(this,u),l)}}function Hq(o,i,l){var u,m;function r(){var w=i.apply(this,arguments);return w!==m&&(u=(m=w)&&Gq(o,w,l)),u}return r._value=i,r}function lF(o,i,l){var u="style."+(o+="");if(arguments.length<2)return(u=this.tween(u))&&u._value;if(i==null)return this.tween(u,null);if(typeof i!="function")throw new Error;return this.tween(u,Hq(o,i,l??""))}function qq(o){return function(){this.textContent=o}}function Wq(o){return function(){var i=o(this);this.textContent=i??""}}function cF(o){return this.tween("text",typeof o=="function"?Wq(Yf(this,"text",o)):qq(o==null?"":o+""))}function Zq(o){return function(i){this.textContent=o.call(this,i)}}function Xq(o){var i,l;function u(){var m=o.apply(this,arguments);return m!==l&&(i=(l=m)&&Zq(m)),i}return u._value=o,u}function uF(o){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(o==null)return this.tween(i,null);if(typeof o!="function")throw new Error;return this.tween(i,Xq(o))}function hF(){for(var o=this._name,i=this._id,l=jx(),u=this._groups,m=u.length,r=0;r<m;++r)for(var w=u[r],I=w.length,A,L=0;L<I;++L)if(A=w[L]){var $=yi(A,i);Vc(A,o,l,L,w,{time:$.time+$.delay+$.duration,delay:0,duration:$.duration,ease:$.ease})}return new Qi(u,this._parents,o,l)}function dF(){var o,i,l=this,u=l._id,m=l.size();return new Promise(function(r,w){var I={value:w},A={value:function(){--m===0&&r()}};l.each(function(){var L=ki(this,u),$=L.on;$!==o&&(i=(o=$).copy(),i._.cancel.push(I),i._.interrupt.push(I),i._.end.push(A)),L.on=i}),m===0&&r()})}var Yq=0;function Qi(o,i,l,u){this._groups=o,this._parents=i,this._name=l,this._id=u}function fF(o){return cl().transition(o)}function jx(){return++Yq}var ul=cl.prototype;Qi.prototype=fF.prototype={constructor:Qi,select:rF,selectAll:iF,selectChild:ul.selectChild,selectChildren:ul.selectChildren,filter:JL,merge:eF,selection:oF,transition:hF,call:ul.call,nodes:ul.nodes,node:ul.node,size:ul.size,empty:ul.empty,each:ul.each,on:tF,attr:WL,attrTween:ZL,style:aF,styleTween:lF,text:cF,textTween:uF,remove:nF,tween:qL,delay:XL,duration:YL,ease:KL,easeVarying:QL,end:dF,[Symbol.iterator]:ul[Symbol.iterator]};function Ux(o){return((o*=2)<=1?o*o*o:(o-=2)*o*o+2)/2}var Kq={time:null,delay:0,duration:250,ease:Ux};function Qq(o,i){for(var l;!(l=o.__transition)||!(l=l[i]);)if(!(o=o.parentNode))throw new Error(`transition ${i} not found`);return l}function pF(o){var i,l;o instanceof Qi?(i=o._id,o=o._name):(i=jx(),(l=Kq).time=o_(),o=o==null?null:o+"");for(var u=this._groups,m=u.length,r=0;r<m;++r)for(var w=u[r],I=w.length,A,L=0;L<I;++L)(A=w[L])&&Vc(A,o,i,L,w,l||Qq(A,i));return new Qi(u,this._parents,o,i)}cl.prototype.interrupt=HL;cl.prototype.transition=pF;var{abs:ose,max:sse,min:ase}=Math;function mF(o){return[+o[0],+o[1]]}function Jq(o){return[mF(o[0]),mF(o[1])]}var lse={name:"x",handles:["w","e"].map(sS),input:function(o,i){return o==null?null:[[+o[0],i[0][1]],[+o[1],i[1][1]]]},output:function(o){return o&&[o[0][0],o[1][0]]}},cse={name:"y",handles:["n","s"].map(sS),input:function(o,i){return o==null?null:[[i[0][0],+o[0]],[i[1][0],+o[1]]]},output:function(o){return o&&[o[0][1],o[1][1]]}},use={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(sS),input:function(o){return o==null?null:Jq(o)},output:function(o){return o}};function sS(o){return{type:o}}function gF(o){let i=+this._x.call(null,o),l=+this._y.call(null,o);return _F(this.cover(i,l),i,l,o)}function _F(o,i,l,u){if(isNaN(i)||isNaN(l))return o;var m,r=o._root,w={data:u},I=o._x0,A=o._y0,L=o._x1,$=o._y1,Q,me,he,be,Ie,Qe,ze,nt;if(!r)return o._root=w,o;for(;r.length;)if((Ie=i>=(Q=(I+L)/2))?I=Q:L=Q,(Qe=l>=(me=(A+$)/2))?A=me:$=me,m=r,!(r=r[ze=Qe<<1|Ie]))return m[ze]=w,o;if(he=+o._x.call(null,r.data),be=+o._y.call(null,r.data),i===he&&l===be)return w.next=r,m?m[ze]=w:o._root=w,o;do m=m?m[ze]=new Array(4):o._root=new Array(4),(Ie=i>=(Q=(I+L)/2))?I=Q:L=Q,(Qe=l>=(me=(A+$)/2))?A=me:$=me;while((ze=Qe<<1|Ie)===(nt=(be>=me)<<1|he>=Q));return m[nt]=r,m[ze]=w,o}function yF(o){var i,l,u=o.length,m,r,w=new Array(u),I=new Array(u),A=1/0,L=1/0,$=-1/0,Q=-1/0;for(l=0;l<u;++l)isNaN(m=+this._x.call(null,i=o[l]))||isNaN(r=+this._y.call(null,i))||(w[l]=m,I[l]=r,m<A&&(A=m),m>$&&($=m),r<L&&(L=r),r>Q&&(Q=r));if(A>$||L>Q)return this;for(this.cover(A,L).cover($,Q),l=0;l<u;++l)_F(this,w[l],I[l],o[l]);return this}function vF(o,i){if(isNaN(o=+o)||isNaN(i=+i))return this;var l=this._x0,u=this._y0,m=this._x1,r=this._y1;if(isNaN(l))m=(l=Math.floor(o))+1,r=(u=Math.floor(i))+1;else{for(var w=m-l||1,I=this._root,A,L;l>o||o>=m||u>i||i>=r;)switch(L=(i<u)<<1|o<l,A=new Array(4),A[L]=I,I=A,w*=2,L){case 0:m=l+w,r=u+w;break;case 1:l=m-w,r=u+w;break;case 2:m=l+w,u=r-w;break;case 3:l=m-w,u=r-w;break}this._root&&this._root.length&&(this._root=I)}return this._x0=l,this._y0=u,this._x1=m,this._y1=r,this}function xF(){var o=[];return this.visit(function(i){if(!i.length)do o.push(i.data);while(i=i.next)}),o}function bF(o){return arguments.length?this.cover(+o[0][0],+o[0][1]).cover(+o[1][0],+o[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Ti(o,i,l,u,m){this.node=o,this.x0=i,this.y0=l,this.x1=u,this.y1=m}function wF(o,i,l){var u,m=this._x0,r=this._y0,w,I,A,L,$=this._x1,Q=this._y1,me=[],he=this._root,be,Ie;for(he&&me.push(new Ti(he,m,r,$,Q)),l==null?l=1/0:(m=o-l,r=i-l,$=o+l,Q=i+l,l*=l);be=me.pop();)if(!(!(he=be.node)||(w=be.x0)>$||(I=be.y0)>Q||(A=be.x1)<m||(L=be.y1)<r))if(he.length){var Qe=(w+A)/2,ze=(I+L)/2;me.push(new Ti(he[3],Qe,ze,A,L),new Ti(he[2],w,ze,Qe,L),new Ti(he[1],Qe,I,A,ze),new Ti(he[0],w,I,Qe,ze)),(Ie=(i>=ze)<<1|o>=Qe)&&(be=me[me.length-1],me[me.length-1]=me[me.length-1-Ie],me[me.length-1-Ie]=be)}else{var nt=o-+this._x.call(null,he.data),ft=i-+this._y.call(null,he.data),Ue=nt*nt+ft*ft;if(Ue<l){var Nt=Math.sqrt(l=Ue);m=o-Nt,r=i-Nt,$=o+Nt,Q=i+Nt,u=he.data}}return u}function EF(o){if(isNaN($=+this._x.call(null,o))||isNaN(Q=+this._y.call(null,o)))return this;var i,l=this._root,u,m,r,w=this._x0,I=this._y0,A=this._x1,L=this._y1,$,Q,me,he,be,Ie,Qe,ze;if(!l)return this;if(l.length)for(;;){if((be=$>=(me=(w+A)/2))?w=me:A=me,(Ie=Q>=(he=(I+L)/2))?I=he:L=he,i=l,!(l=l[Qe=Ie<<1|be]))return this;if(!l.length)break;(i[Qe+1&3]||i[Qe+2&3]||i[Qe+3&3])&&(u=i,ze=Qe)}for(;l.data!==o;)if(m=l,!(l=l.next))return this;return(r=l.next)&&delete l.next,m?(r?m.next=r:delete m.next,this):i?(r?i[Qe]=r:delete i[Qe],(l=i[0]||i[1]||i[2]||i[3])&&l===(i[3]||i[2]||i[1]||i[0])&&!l.length&&(u?u[ze]=l:this._root=l),this):(this._root=r,this)}function TF(o){for(var i=0,l=o.length;i<l;++i)this.remove(o[i]);return this}function CF(){return this._root}function SF(){var o=0;return this.visit(function(i){if(!i.length)do++o;while(i=i.next)}),o}function IF(o){var i=[],l,u=this._root,m,r,w,I,A;for(u&&i.push(new Ti(u,this._x0,this._y0,this._x1,this._y1));l=i.pop();)if(!o(u=l.node,r=l.x0,w=l.y0,I=l.x1,A=l.y1)&&u.length){var L=(r+I)/2,$=(w+A)/2;(m=u[3])&&i.push(new Ti(m,L,$,I,A)),(m=u[2])&&i.push(new Ti(m,r,$,L,A)),(m=u[1])&&i.push(new Ti(m,L,w,I,$)),(m=u[0])&&i.push(new Ti(m,r,w,L,$))}return this}function DF(o){var i=[],l=[],u;for(this._root&&i.push(new Ti(this._root,this._x0,this._y0,this._x1,this._y1));u=i.pop();){var m=u.node;if(m.length){var r,w=u.x0,I=u.y0,A=u.x1,L=u.y1,$=(w+A)/2,Q=(I+L)/2;(r=m[0])&&i.push(new Ti(r,w,I,$,Q)),(r=m[1])&&i.push(new Ti(r,$,I,A,Q)),(r=m[2])&&i.push(new Ti(r,w,Q,$,L)),(r=m[3])&&i.push(new Ti(r,$,Q,A,L))}l.push(u)}for(;u=l.pop();)o(u.node,u.x0,u.y0,u.x1,u.y1);return this}function MF(o){return o[0]}function AF(o){return arguments.length?(this._x=o,this):this._x}function PF(o){return o[1]}function RF(o){return arguments.length?(this._y=o,this):this._y}function Ph(o,i,l){var u=new aS(i??MF,l??PF,NaN,NaN,NaN,NaN);return o==null?u:u.addAll(o)}function aS(o,i,l,u,m,r){this._x=o,this._y=i,this._x0=l,this._y0=u,this._x1=m,this._y1=r,this._root=void 0}function OF(o){for(var i={data:o.data},l=i;o=o.next;)l=l.next={data:o.data};return i}var Ji=Ph.prototype=aS.prototype;Ji.copy=function(){var o=new aS(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root,l,u;if(!i)return o;if(!i.length)return o._root=OF(i),o;for(l=[{source:i,target:o._root=new Array(4)}];i=l.pop();)for(var m=0;m<4;++m)(u=i.source[m])&&(u.length?l.push({source:u,target:i.target[m]=new Array(4)}):i.target[m]=OF(u));return o};Ji.add=gF;Ji.addAll=yF;Ji.cover=vF;Ji.data=xF;Ji.extent=bF;Ji.find=wF;Ji.remove=EF;Ji.removeAll=TF;Ji.root=CF;Ji.size=SF;Ji.visit=IF;Ji.visitAfter=DF;Ji.x=AF;Ji.y=RF;function $i(o){return function(){return o}}function jc(o){return(o()-.5)*1e-6}function e9(o){return o.x+o.vx}function t9(o){return o.y+o.vy}function l_(o){var i,l,u,m=1,r=1;typeof o!="function"&&(o=$i(o==null?1:+o));function w(){for(var L,$=i.length,Q,me,he,be,Ie,Qe,ze=0;ze<r;++ze)for(Q=Ph(i,e9,t9).visitAfter(I),L=0;L<$;++L)me=i[L],Ie=l[me.index],Qe=Ie*Ie,he=me.x+me.vx,be=me.y+me.vy,Q.visit(nt);function nt(ft,Ue,Nt,Yt,Jt){var wt=ft.data,er=ft.r,St=Ie+er;if(wt){if(wt.index>me.index){var fr=he-wt.x-wt.vx,yr=be-wt.y-wt.vy,kr=fr*fr+yr*yr;kr<St*St&&(fr===0&&(fr=jc(u),kr+=fr*fr),yr===0&&(yr=jc(u),kr+=yr*yr),kr=(St-(kr=Math.sqrt(kr)))/kr*m,me.vx+=(fr*=kr)*(St=(er*=er)/(Qe+er)),me.vy+=(yr*=kr)*St,wt.vx-=fr*(St=1-St),wt.vy-=yr*St)}return}return Ue>he+St||Yt<he-St||Nt>be+St||Jt<be-St}}function I(L){if(L.data)return L.r=l[L.data.index];for(var $=L.r=0;$<4;++$)L[$]&&L[$].r>L.r&&(L.r=L[$].r)}function A(){if(i){var L,$=i.length,Q;for(l=new Array($),L=0;L<$;++L)Q=i[L],l[Q.index]=+o(Q,L,i)}}return w.initialize=function(L,$){i=L,u=$,A()},w.iterations=function(L){return arguments.length?(r=+L,w):r},w.strength=function(L){return arguments.length?(m=+L,w):m},w.radius=function(L){return arguments.length?(o=typeof L=="function"?L:$i(+L),A(),w):o},w}function kF(){let o=1;return()=>(o=(1664525*o+1013904223)%4294967296)/4294967296}function LF(o){return o.x}function FF(o){return o.y}var n9=10,r9=Math.PI*(3-Math.sqrt(5));function c_(o){var i,l=1,u=.001,m=1-Math.pow(u,1/300),r=0,w=.6,I=new Map,A=Xf(Q),L=Ch("tick","end"),$=kF();o==null&&(o=[]);function Q(){me(),L.call("tick",i),l<u&&(A.stop(),L.call("end",i))}function me(Ie){var Qe,ze=o.length,nt;Ie===void 0&&(Ie=1);for(var ft=0;ft<Ie;++ft)for(l+=(r-l)*m,I.forEach(function(Ue){Ue(l)}),Qe=0;Qe<ze;++Qe)nt=o[Qe],nt.fx==null?nt.x+=nt.vx*=w:(nt.x=nt.fx,nt.vx=0),nt.fy==null?nt.y+=nt.vy*=w:(nt.y=nt.fy,nt.vy=0);return i}function he(){for(var Ie=0,Qe=o.length,ze;Ie<Qe;++Ie){if(ze=o[Ie],ze.index=Ie,ze.fx!=null&&(ze.x=ze.fx),ze.fy!=null&&(ze.y=ze.fy),isNaN(ze.x)||isNaN(ze.y)){var nt=n9*Math.sqrt(.5+Ie),ft=Ie*r9;ze.x=nt*Math.cos(ft),ze.y=nt*Math.sin(ft)}(isNaN(ze.vx)||isNaN(ze.vy))&&(ze.vx=ze.vy=0)}}function be(Ie){return Ie.initialize&&Ie.initialize(o,$),Ie}return he(),i={tick:me,restart:function(){return A.restart(Q),i},stop:function(){return A.stop(),i},nodes:function(Ie){return arguments.length?(o=Ie,he(),I.forEach(be),i):o},alpha:function(Ie){return arguments.length?(l=+Ie,i):l},alphaMin:function(Ie){return arguments.length?(u=+Ie,i):u},alphaDecay:function(Ie){return arguments.length?(m=+Ie,i):+m},alphaTarget:function(Ie){return arguments.length?(r=+Ie,i):r},velocityDecay:function(Ie){return arguments.length?(w=1-Ie,i):1-w},randomSource:function(Ie){return arguments.length?($=Ie,I.forEach(be),i):$},force:function(Ie,Qe){return arguments.length>1?(Qe==null?I.delete(Ie):I.set(Ie,be(Qe)),i):I.get(Ie)},find:function(Ie,Qe,ze){var nt=0,ft=o.length,Ue,Nt,Yt,Jt,wt;for(ze==null?ze=1/0:ze*=ze,nt=0;nt<ft;++nt)Jt=o[nt],Ue=Ie-Jt.x,Nt=Qe-Jt.y,Yt=Ue*Ue+Nt*Nt,Yt<ze&&(wt=Jt,ze=Yt);return wt},on:function(Ie,Qe){return arguments.length>1?(L.on(Ie,Qe),i):L.on(Ie)}}}function u_(){var o,i,l,u,m=$i(-30),r,w=1,I=1/0,A=.81;function L(he){var be,Ie=o.length,Qe=Ph(o,LF,FF).visitAfter(Q);for(u=he,be=0;be<Ie;++be)i=o[be],Qe.visit(me)}function $(){if(o){var he,be=o.length,Ie;for(r=new Array(be),he=0;he<be;++he)Ie=o[he],r[Ie.index]=+m(Ie,he,o)}}function Q(he){var be=0,Ie,Qe,ze=0,nt,ft,Ue;if(he.length){for(nt=ft=Ue=0;Ue<4;++Ue)(Ie=he[Ue])&&(Qe=Math.abs(Ie.value))&&(be+=Ie.value,ze+=Qe,nt+=Qe*Ie.x,ft+=Qe*Ie.y);he.x=nt/ze,he.y=ft/ze}else{Ie=he,Ie.x=Ie.data.x,Ie.y=Ie.data.y;do be+=r[Ie.data.index];while(Ie=Ie.next)}he.value=be}function me(he,be,Ie,Qe){if(!he.value)return!0;var ze=he.x-i.x,nt=he.y-i.y,ft=Qe-be,Ue=ze*ze+nt*nt;if(ft*ft/A<Ue)return Ue<I&&(ze===0&&(ze=jc(l),Ue+=ze*ze),nt===0&&(nt=jc(l),Ue+=nt*nt),Ue<w&&(Ue=Math.sqrt(w*Ue)),i.vx+=ze*he.value*u/Ue,i.vy+=nt*he.value*u/Ue),!0;if(he.length||Ue>=I)return;(he.data!==i||he.next)&&(ze===0&&(ze=jc(l),Ue+=ze*ze),nt===0&&(nt=jc(l),Ue+=nt*nt),Ue<w&&(Ue=Math.sqrt(w*Ue)));do he.data!==i&&(ft=r[he.data.index]*u/Ue,i.vx+=ze*ft,i.vy+=nt*ft);while(he=he.next)}return L.initialize=function(he,be){o=he,l=be,$()},L.strength=function(he){return arguments.length?(m=typeof he=="function"?he:$i(+he),$(),L):m},L.distanceMin=function(he){return arguments.length?(w=he*he,L):Math.sqrt(w)},L.distanceMax=function(he){return arguments.length?(I=he*he,L):Math.sqrt(I)},L.theta=function(he){return arguments.length?(A=he*he,L):Math.sqrt(A)},L}function h_(o){var i=$i(.1),l,u,m;typeof o!="function"&&(o=$i(o==null?0:+o));function r(I){for(var A=0,L=l.length,$;A<L;++A)$=l[A],$.vx+=(m[A]-$.x)*u[A]*I}function w(){if(l){var I,A=l.length;for(u=new Array(A),m=new Array(A),I=0;I<A;++I)u[I]=isNaN(m[I]=+o(l[I],I,l))?0:+i(l[I],I,l)}}return r.initialize=function(I){l=I,w()},r.strength=function(I){return arguments.length?(i=typeof I=="function"?I:$i(+I),w(),r):i},r.x=function(I){return arguments.length?(o=typeof I=="function"?I:$i(+I),w(),r):o},r}function d_(o){var i=$i(.1),l,u,m;typeof o!="function"&&(o=$i(o==null?0:+o));function r(I){for(var A=0,L=l.length,$;A<L;++A)$=l[A],$.vy+=(m[A]-$.y)*u[A]*I}function w(){if(l){var I,A=l.length;for(u=new Array(A),m=new Array(A),I=0;I<A;++I)u[I]=isNaN(m[I]=+o(l[I],I,l))?0:+i(l[I],I,l)}}return r.initialize=function(I){l=I,w()},r.strength=function(I){return arguments.length?(i=typeof I=="function"?I:$i(+I),w(),r):i},r.y=function(I){return arguments.length?(o=typeof I=="function"?I:$i(+I),w(),r):o},r}function Uc(o,i,l){this.k=o,this.x=i,this.y=l}Uc.prototype={constructor:Uc,scale:function(o){return o===1?this:new Uc(this.k*o,this.x,this.y)},translate:function(o,i){return o===0&i===0?this:new Uc(this.k,this.x+this.k*o,this.y+this.k*i)},apply:function(o){return[o[0]*this.k+this.x,o[1]*this.k+this.y]},applyX:function(o){return o*this.k+this.x},applyY:function(o){return o*this.k+this.y},invert:function(o){return[(o[0]-this.x)/this.k,(o[1]-this.y)/this.k]},invertX:function(o){return(o-this.x)/this.k},invertY:function(o){return(o-this.y)/this.k},rescaleX:function(o){return o.copy().domain(o.range().map(this.invertX,this).map(o.invert,o))},rescaleY:function(o){return o.copy().domain(o.range().map(this.invertY,this).map(o.invert,o))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var lS=new Uc(1,0,0);cS.prototype=Uc.prototype;function cS(o){for(;!o.__zoom;)if(!(o=o.parentNode))return lS;return o.__zoom}var dS=Ew($x());var va=(()=>{let i=class i{constructor(){this.ACCESS_TOKEN="pk.eyJ1Ijoidml0YWxpaS1iaWxpbnNreWkiLCJhIjoiY2x5OGZqZDdsMDVjMjJucGh5Z2w3MmgzZSJ9.nKkXDgd7Q8u4sBZt_bsRrQ",this.mapStyle="mapbox://styles/vitalii-bilinskyi/cly8fp05900fz01pfaajw4fqa",this.map=null,this.source=null,this.layers=[],this.icons=[],this.showSensorData=new pi(!1),this.canvas=null,this.svg=null,this.height=window.innerWidth,this.width=window.innerHeight}setMap(u){this.map||(this.map=u)}setSource(u){this.source=u}setMapStyle(u){this.mapStyle=u}initializeMap(u){let A=u,{container:m,zoom:r,center:w}=A,I=Ko(A,["container","zoom","center"]);this.map=new dS.default.Map(xt({accessToken:this.ACCESS_TOKEN,container:m,style:this.mapStyle,zoom:r??12,center:w},I))}addSource(u,m){if(!this.map)throw new Error("Set map before adding source!");let $=m,{data:r,cluster:w,clusterMaxZoom:I,clusterRadius:A}=$,L=Ko($,["data","cluster","clusterMaxZoom","clusterRadius"]);this.map.addSource(u,xt({type:"geojson",data:r,cluster:w,clusterMaxZoom:I??13,clusterRadius:A??100},L)),this.source=u}generatePointLayer(u){if(this.showUnconfiguredMapServiceErrors("creating point layer!"),Array.isArray(u))for(let m of u)this.createPointLayer(m);else this.createPointLayer(u)}createPointLayer(u){let $=u,{id:m,iconId:r,filter:w,layout:I,onPointClickHandler:A}=$,L=Ko($,["id","iconId","filter","layout","onPointClickHandler"]);this.map.addLayer(xt({id:m,type:"symbol",source:this.source,filter:w,layout:xt({"icon-image":r,"icon-allow-overlap":!0},I)},L)),A&&this.map.on("click",m,Q=>{A(Q,this.map,m),this.showSensorData.next(!0)}),this.layers.push(u.id),this.icons.push(u.iconId)}generateClusterLayer(u){if(this.showUnconfiguredMapServiceErrors("creating cluster layer!"),Array.isArray(u))for(let m of u)this.createClusterLayer(m);else this.createClusterLayer(u)}createClusterLayer(u){let L=u,{id:m,filter:r,paint:w,onClusterClickHandler:I}=L,A=Ko(L,["id","filter","paint","onClusterClickHandler"]);this.map.addLayer(xt({id:m,type:"circle",source:this.source,filter:r,paint:xt({"circle-color":"#cd5dfc","circle-radius":20},w)},A)),this.layers.push(u.id),I&&this.map.on("click",m,$=>I($,this.map,m))}drawD3JSCircles(){if(this.canvas=this.map.getCanvasContainer(),this.svg=Ki(".mapboxgl-canvas-container").append("div").style("view-transition-name","cube").style("position","absolute").style("width","100%").style("height",`${this.height}px`).style("top","0px").style("left","0px").append("svg").attr("width","100%").attr("height",this.height).style("position","absolute").style("left",0),!this.map?.getSource("workspaces")){console.error("GeoJSON source not found");return}let m=this.map?.querySourceFeatures("workspaces",{filter:["==","alarmLevel","high"]}),r=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-high"]}),w=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-moderate"]}),I=zF(r,"id"),A=zF(w,"id");console.log("uniqueFeatures1",I),console.log("uniqueFeatures2",A);let L=[...I,...A],$=I?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),Q=A?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),me=[...$,...Q];if(console.log("dataToSave",me),localStorage.setItem("pointsCoords",JSON.stringify(me)),L&&this.svg){let he=this.svg.selectAll("circle.point").data(L).enter().append("circle").attr("class","point").attr("cx",be=>this.project(be.geometry.coordinates).x).attr("cy",be=>this.project(be.geometry.coordinates).y).attr("r",5).attr("fill","red")}}project(u){return this.map?.project(new dS.default.LngLat(+u[0],+u[1]))}updateZoom(u){let m=this.map.getCenter(),r=this.map.getZoom();this.map.easeTo({center:m,zoom:r+u,duration:1e3,linear:!0})}updatePitch(u){let m=this.map.getCenter(),r=this.map.getZoom();this.map.easeTo({center:m,zoom:r,pitch:u,duration:1e3,linear:!0})}showUnconfiguredMapServiceErrors(u){if(!this.map)throw new Error(`Set map before ${u}`);if(!this.source)throw new Error(`Set source before ${u}`)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function zF(o,i){let l=new Set,u=[];for(let m of o){let r=m.properties[i];console.log("eature.properties[comparatorProperty];",m.properties),l.has(r)||(l.add(r),u.push(m))}return u}function i9(o,i){if(o&1){let l=GR();jn(0,"app-sensor-details",3),qr("hideDetails",function(m){AP(l);let r=HR();return PP(r.hideDetails(m))}),Un()}o&2&&mo("@enter",void 0)("@fadeOutOnLeave",void 0)}var VF=(()=>{let i=class i{constructor(u,m){this.mockDataService=u,this.mapService=m,this.lat=50.049683,this.lng=19.944544,this.zoomLevel=12,this.dotSize=100,this.context=null,this.pulsingDot_low=null,this.pulsingDot_moderate=null,this.pulsingDot_high=null,this.pulsingDot_sevire=null,this.canvas_low=document.createElement("canvas"),this.canvas_moderate=document.createElement("canvas"),this.canvas_high=document.createElement("canvas"),this.canvas_sevire=document.createElement("canvas"),this.showSensorDetails=!1,this.mapService.showSensorData?.subscribe(r=>{this.showSensorDetails=r})}hideDetails(u){this.showSensorDetails=!u}ngOnInit(){this.mockDataService.getAllLocations().then(u=>{this.mockData=BF([...u]),this.renderMap()}).catch(u=>{console.error("Failed to fetch mock data",u),this.mockData=BF([...Ek]),this.renderMap()})}renderMap(){this.getSavedMapData(),this.mapService.initializeMap({container:"map",zoom:this.zoomLevel,center:[this.lng,this.lat],pitch:60,minZoom:4}),this.createPusingDots(),this.onMapLoadHandler()}getSavedMapData(){try{let u=localStorage.getItem("center");if(console.log(u),u){let r=JSON.parse(u);this.lng=r.lng,this.lat=r.lat}let m=localStorage.getItem("zoomLevel");if(console.log(m),m){let r=JSON.parse(m);this.zoomLevel=r}}catch(u){console.log("getCenterOfMap Exception: ",u)}}createPusingDots(){this.checkMapInitialization(),this.canvas_low.className="canvas_low",this.pulsingDot_low=Gg("#B3ECCD",this.mapService.map,this.canvas_low),this.canvas_moderate.className="canvas_moderate",this.pulsingDot_moderate=Gg("#FFEB82",this.mapService.map,this.canvas_moderate),this.canvas_high.className="canvas_high",this.pulsingDot_high=Gg("#ffb682",this.mapService.map,this.canvas_high),this.canvas_sevire.className="canvas_sevire",this.pulsingDot_sevire=Gg("#ECC6EF",this.mapService.map,this.canvas_sevire,!0)}onMapLoadHandler(){this.checkMapInitialization(),this.mapService.map.on("load",()=>{this.pulsingDot_low&&this.mapService.map.addImage("pulsingDot_low",this.pulsingDot_low,{pixelRatio:2}),this.pulsingDot_moderate&&this.mapService.map.addImage("pulsingDot_moderate",this.pulsingDot_moderate,{pixelRatio:2}),this.pulsingDot_high&&this.mapService.map.addImage("pulsingDot_high",this.pulsingDot_high,{pixelRatio:2}),this.pulsingDot_sevire&&this.mapService.map.addImage("pulsingDot_sevire",this.pulsingDot_sevire,{pixelRatio:2}),this.mapService.addSource("workspaces",{data:this.mockData,cluster:!0}),this.drawData()})}drawData(){this.mapService.generateClusterLayer({id:"clusters",filter:["has","point_count"],paint:{"circle-radius":20},onClusterClickHandler:this.onClusterClickHandler}),this.mapService.map.addLayer({id:"cluster-count",type:"symbol",source:"workspaces",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"white"}});let u=[{id:"unclustered-point-animated-sevire",filter:["==","alarmLevel","sevire"],iconId:"pulsingDot_sevire",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-high",filter:["==","alarmLevel","high"],iconId:"pulsingDot_high",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-moderate",filter:["==","alarmLevel","moderate"],iconId:"pulsingDot_moderate",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-low",filter:["==","alarmLevel","low"],iconId:"pulsingDot_low",onPointClickHandler:this.onUnlcusteredPointClickHandler}];this.mapService.generatePointLayer(u)}onClusterClickHandler(u,m,r){let w=m.queryRenderedFeatures(u.point,{layers:[r]});if(w&&w[0]&&w[0]?.properties){let I=w[0]?.properties.cluster_id;if(I){let A=m.getSource("workspaces"),L=m.getZoom();A?.getClusterExpansionZoom(I,($,Q)=>{$||!Q||w[0].geometry.type==="Point"&&m.easeTo({center:w[0].geometry.coordinates,zoom:Q,duration:L<=8?2e3:L<=10?1500:1e3,linear:!0})})}}}onUnlcusteredPointClickHandler(u,m,r){let w=m.queryRenderedFeatures(u.point,{layers:[r]});if(w&&w[0]){let I=w[0];if(console.log(I),I.geometry.type==="Point"){let A={center:[I.geometry.coordinates[0],I.geometry.coordinates[1]],zoom:18};m.flyTo(gr(xt({},A),{duration:2500,essential:!0}))}}}checkMapInitialization(){if(!this.mapService.map)throw new Error("Map is not initialized")}};i.\u0275fac=function(m){return new(m||i)(_r(GC),_r(va))},i.\u0275cmp=gi({type:i,selectors:[["map-view"]],standalone:!0,features:[ZR([]),_i],decls:3,vars:3,consts:[["id","map",1,"match-parent"],[2,"position","absolute","top","100px","left","100px","z-index","999"],[3,"hideDetails",4,"ngIf"],[3,"hideDetails"]],template:function(m,r){m&1&&(Cr(0,"div",0)(1,"div",1),mg(2,i9,1,2,"app-sensor-details",2)),m&2&&(Hr(),Af("view-transition-name","cube"),Hr(),mo("ngIf",r.showSensorDetails))},dependencies:[IO,Yi,mO,$C],styles:['.match-parent[_ngcontent-%COMP%]{width:100%;height:100%}#map[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;display:block;z-index:10;pointer-events:none;-webkit-box-shadow:inset 0 0 70px 60px white;-moz-box-shadow:inset 0 0 70px 60px white;box-shadow:inset 0 0 70px 60px #fff}[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}']});let o=i;return o})(),BF=o=>{let i=[],l=["high","moderate","low"];return o.forEach(u=>{i.push({type:"Feature",id:u.id,properties:{numberOfDevices:u.devices?.length,alarmLevel:u.id==="6"?"sevire":l[Math.floor(Math.random()*l.length)],id:u.id},geometry:{type:"Point",coordinates:[u.longitude,u.latitude]}})}),{type:"FeatureCollection",features:[...i]}};var Mr=function(o){return o[o.GROUP=0]="GROUP",o[o.DEVICE=1]="DEVICE",o}(Mr||{}),jr=function(o){return o[o.LATCH=0]="LATCH",o[o.BATTERY=1]="BATTERY",o[o.SIGNAL=2]="SIGNAL",o[o.HUMIDITY=3]="HUMIDITY",o[o.TEMPERATURE=4]="TEMPERATURE",o}(jr||{}),$n=function(o){return o[o.LOW=0]="LOW",o[o.MODERATE=1]="MODERATE",o[o.HIGH=2]="HIGH",o[o.SEVIRE=3]="SEVIRE",o}($n||{}),o9=[{id:"id1.1",type:Mr.GROUP,deviceType:jr.LATCH,name:"Latch",r:75},{id:"id1.2",type:Mr.GROUP,deviceType:jr.TEMPERATURE,name:"Temperature",r:75},{id:"id1.3",type:Mr.GROUP,deviceType:jr.BATTERY,name:"Battery",r:75},{id:"id1.4",type:Mr.GROUP,deviceType:jr.HUMIDITY,name:"Humidity",r:75},{id:"id1.5",type:Mr.GROUP,deviceType:jr.SIGNAL,name:"Signal",r:75},{id:"id1.1.1",type:Mr.DEVICE,deviceType:jr.LATCH,name:"DEVICE_0",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:$n.HIGH},{id:"2",message:"Something wrong with case",priority:$n.LOW},{id:"3",message:"Something wrong with signal",priority:$n.MODERATE}]},{id:"id1.1.2",type:Mr.DEVICE,deviceType:jr.LATCH,name:"DEVICE_1",r:30,alarms:[{id:"1",message:"Something wrong with latch",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.MODERATE},{id:"3",message:"Something wrong with signal",priority:$n.HIGH}]},{id:"id1.2.1",type:Mr.DEVICE,deviceType:jr.TEMPERATURE,name:"DEVICE_2",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:$n.SEVIRE},{id:"2",message:"Something wrong with case",priority:$n.HIGH},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.2.2",type:Mr.DEVICE,deviceType:jr.TEMPERATURE,name:"DEVICE_3",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:$n.LOW},{id:"2",message:"Something wrong with case",priority:$n.LOW},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.2.3",type:Mr.DEVICE,deviceType:jr.TEMPERATURE,name:"DEVICE_4",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:$n.HIGH},{id:"2",message:"Something wrong with case",priority:$n.SEVIRE},{id:"3",message:"Something wrong with signal",priority:$n.SEVIRE}]},{id:"id1.3.1",type:Mr.DEVICE,deviceType:jr.BATTERY,name:"DEVICE_5",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.MODERATE},{id:"3",message:"Something wrong with signal",priority:$n.MODERATE}]},{id:"id1.4.1",type:Mr.DEVICE,deviceType:jr.HUMIDITY,name:"DEVICE_6",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:$n.LOW},{id:"2",message:"Something wrong with case",priority:$n.MODERATE},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.4.2",type:Mr.DEVICE,deviceType:jr.HUMIDITY,name:"DEVICE_7",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:$n.SEVIRE},{id:"2",message:"Something wrong with case",priority:$n.SEVIRE},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]},{id:"id1.5.1",type:Mr.DEVICE,deviceType:jr.SIGNAL,name:"DEVICE_8",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.SEVIRE},{id:"3",message:"Something wrong with signal",priority:$n.HIGH}]},{id:"id1.5.2",type:Mr.DEVICE,deviceType:jr.SIGNAL,name:"DEVICE_9",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:$n.MODERATE},{id:"2",message:"Something wrong with case",priority:$n.HIGH},{id:"3",message:"Something wrong with signal",priority:$n.HIGH}]},{id:"id1.5.3",type:Mr.DEVICE,deviceType:jr.SIGNAL,name:"DEVICE_10",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:$n.HIGH},{id:"2",message:"Something wrong with case",priority:$n.LOW},{id:"3",message:"Something wrong with signal",priority:$n.LOW}]}];function jF(o,i){return Math.floor(Math.random()*(i-o+1)+o)}var fS=(()=>{let i=class i{constructor(u){this.mapService=u,this.simulation=new Map,this.svg=null,this.nodeGroup=null,this.nodes=[],this.textGroup=null,this.texts=[],this.iconGroup=null,this.icons=[],this.center={x:window.innerWidth/2,y:window.innerHeight/2},this.xAxis=[],this.groups=this.calculateGroups("deviceType")}ngOnInit(){this.createSVGGroups(),this.loadSimulations(),this.restartSimulations()}createSVGGroups(){let u=Ki(".bubbles");this.svg=u.append("svg").attr("class","gravity-container").attr("viewBox",[-this.center.y,-this.center.x,window.innerHeight,window.innerWidth]).style("height",window.innerHeight).style("width",window.innerWidth),this.nodeGroup=this.svg.append("g").attr("class","bubbles-layer"),this.textGroup=this.svg.append("g").attr("class","text-layer"),this.iconGroup=this.svg.append("g").attr("class","icon-layer"),this.groups.forEach((m,r)=>{let w=(be,Ie)=>{be.active||this.simulation.get(r)?.alphaTarget(.3).restart(),Ie.fx=Ie.x,Ie.fy=Ie.y},I=(be,Ie)=>{Ie.fx=be.x,Ie.fy=be.y},A=(be,Ie)=>{be.active||this.simulation.get(r)?.alphaTarget(0),Ie.fx=null,Ie.fy=null},L=this.nodeGroup?.selectAll("circle").data(m,be=>be.id).enter().append("circle").attr("r",be=>this.getRadius(be.type)).attr("fill",be=>this.getColor(be.type,be.priority)).attr("cx",be=>be.x).attr("cy",be=>be.y).call(Yg().on("start",w).on("drag",I).on("end",A));L&&this.nodes.push(L);let $=m.filter(be=>be.type!==Mr.GROUP),Q=this.textGroup?.style("font","16px sans-serif").selectAll("text").data($,be=>be.id).enter().append("text").attr("id",be=>be.id).attr("line-height","16px").attr("pointer-events","none").attr("text-anchor","middle").text(be=>be.count);Q&&this.texts.push(Q);let me=m.filter(be=>be.type===Mr.GROUP),he=this.iconGroup?.selectAll("image").data(me,be=>be.id).enter().append("image").attr("r",8).attr("fill","#5484d1").attr("href",be=>this.getIcon(be.deviceType)).attr("height",be=>this.getRadius(be.type)).attr("width",be=>this.getRadius(be.type)).attr("style","position: absolute;");he&&this.icons.push(he)}),this.setFixedXAxisToGroupParent()}getColor(u,m){if(u===Mr.GROUP)return"#F8F8F8";switch(m){case $n.LOW:return"#B3ECCD";case $n.MODERATE:return"#FFEB82";case $n.HIGH:return"#ffb682";case $n.SEVIRE:return"#ECC6EF";default:return"#D9D9D9"}}getRadius(u){return u===Mr.GROUP?75:30}getIcon(u){switch(u){case jr.BATTERY:return"../assets/icon_wf_battery.svg";case jr.HUMIDITY:return"../assets/icon_wf_humidity.svg";case jr.LATCH:return"../assets/icon_wf_latch.svg";case jr.SIGNAL:return"../assets/icon_wf_signal.svg";case jr.TEMPERATURE:return"../assets/icon_wf_temperature.svg"}}calculateGroups(u){let m=px(o9,$=>$[u]),r=new Map([...m.entries()].sort()),w=[],I=new Th,A=localStorage.getItem("pointsCoords");if(console.log(A),A){let $=JSON.parse(A);console.log("parsedCoords",$),console.log("slicedCoordsArray",$);for(let Q of $)console.log("slicedCoord",Q),w.push(Q)}let L=0;return r.forEach(($,Q)=>{let me=[],he=[];$.forEach(ze=>{if(ze.type===Mr.DEVICE){let nt=ze,{alarms:ft}=nt,Ue=Ko(nt,["alarms"]);ze.alarms.forEach(Nt=>{me.push(gr(xt(xt({},Nt),Ue),{x:jF(-750,750),y:jF(350,-350)})),console.log("index",L),L+=1})}else he.push(ze)});let be=me.reduce((ze,nt)=>(ze[nt.priority]||(ze[nt.priority]=gr(xt({},nt),{count:0})),ze[nt.priority].count+=1,ze),{}),Ie=Object.values(be),Qe=[...he,...Ie];I.set(Q,Qe)}),I}calculateXAxis(){return s9(-(window.innerWidth-100),window.innerWidth-100,this.groups.size)}setFixedXAxisToGroupParent(){this.xAxis=this.calculateXAxis(),this.groups.forEach(u=>{u.forEach((m,r)=>{m.type===Mr.GROUP&&(m.fx=this.xAxis[r],m.fy=0)})})}loadSimulations(){let u=new Map;this.groups.forEach((m,r)=>{let w=()=>{this.groups.get(r)?.forEach(A=>{A.type===Mr.GROUP&&(A.fx=this.xAxis[r],A.fy=0)}),this.nodes[r]?.attr("cx",A=>A.x).attr("cy",A=>A.y),this.texts[r]?.attr("x",A=>A.x).attr("y",A=>A.y),this.icons[r]?.attr("x",A=>A.x-this.getRadius(A.type)/2).attr("y",A=>A.y-this.getRadius(A.type)/2)},I=c_(this.groups.get(r)).alphaDecay(.01).velocityDecay(.2).force("charge",u_().strength(5)).force("x",h_(this.xAxis[r]).strength(.02)).force("y",d_().strength(.02)).force("collide",l_().radius(A=>A.type===Mr.GROUP?A.r-15:A.r).iterations(3)).on("tick",w);u.set(r,I),console.log("this.groups.get(key)",this.groups.get(r))}),this.simulation=u}restartSimulations(){for(let u of this.simulation)u[1].restart()}};i.\u0275fac=function(m){return new(m||i)(_r(va))},i.\u0275cmp=gi({type:i,selectors:[["app-gravity-bubbles-view"]],standalone:!0,features:[_i],decls:3,vars:2,consts:[[1,"bubbles"],[2,"position","absolute","top","300px","left","1000px","z-index","999"],[2,"height","30px","width","30px"]],template:function(m,r){m&1&&(Cr(0,"div",0),jn(1,"div",1),$P(),Cr(2,"svg",2),Un()),m&2&&(Hr(),Af("view-transition-name","cube"))},dependencies:[Yi],styles:["svg[_ngcontent-%COMP%]{view-transition-name:circle-image}img[_ngcontent-%COMP%]{view-transition-name:card-image}[_ngcontent-%COMP%]::vview-transition-group(cube){animation-duration:4s}"]});let o=i;return o})();function s9(o,i,l){let u=(i-o)/l,m=[];for(let r=0;r<l;r++){let w=o+r*u,I=w+u;m.push((w+I)/2)}return m}var UF=(()=>{let i=class i{handleMenuClick(u,m){u.cancelBubble=!0}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=gi({type:i,selectors:[["app-sensor-overview"]],standalone:!0,features:[_i],decls:21,vars:0,consts:[[1,"normal","menu-element",2,"text-align","left","padding-left","10px",3,"click"],["src","../../../assets/top-right-arrow.svg",2,"position","fixed","right","15px","margin-top","4px"],[1,"critical","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"high","menu-element",2,"height","fit-content","text-align","left","padding-left","10px",3,"click"],[1,"dotted"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%"],["src","../../../assets/alert-add.svg",1,"add-icon"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%","text-decoration-line","line-through","text-decoration-color","rgba(0, 0, 0, 0.5)","color","rgba(0, 0, 0, 0.5)"],["src","../../../assets/alert-close.svg",1,"add-icon"],[1,"regular","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"low","menu-element",2,"text-align","left","padding-left","10px",3,"click"]],template:function(m,r){m&1&&(jn(0,"div",0),qr("click",function(I){return r.handleMenuClick(I,"normal")}),Wr(1," 7 tasks to delegate "),Cr(2,"img",1),Un(),jn(3,"div",2),qr("click",function(I){return r.handleMenuClick(I,"critical")}),Wr(4," 3 critical alerts "),Un(),jn(5,"div",3),qr("click",function(I){return r.handleMenuClick(I,"high")}),Wr(6," 8 high priority alerts "),Cr(7,"hr",4),jn(8,"div",5),Wr(9,"4 mice to be released "),Cr(10,"img",6),Un(),jn(11,"div",5),Wr(12,"2 batteries to be replaced "),Cr(13,"img",6),Un(),jn(14,"div",7),Wr(15," 2 roofs to be cleared of snow "),Cr(16,"img",8),Un()(),jn(17,"div",9),qr("click",function(I){return r.handleMenuClick(I,"regular")}),Wr(18," 29 regular statuses "),Un(),jn(19,"div",10),qr("click",function(I){return r.handleMenuClick(I,"low")}),Wr(20," 3 low priority statuses "),Un())},dependencies:[Yi]});let o=i;return o})();var $F=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:VF},{path:"bubbles",component:fS},{path:"sensors",component:UF,data:{animation:"sensorsPage"}}];var f_=class{},a9=(()=>{let i=class i extends f_{constructor(u){super(),this.http=u}getSvg(u){return this.http.get(u,{responseType:"text"})}};i.\u0275fac=function(m){return new(m||i)(dn(WT))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),l9=new mn("SERVER_URL"),pS=(()=>{let i=class i{constructor(){this.loader=Tt(f_),this.serverUrl=Tt(l9,{optional:!0}),this.document=Tt(Zr),this.iconsByUrl=new Map,this.iconsLoadingByUrl=new Map}addSvg(u,m){if(!this.iconsByUrl.has(u)){let r=this.document.createElement("DIV");r.innerHTML=m;let w=r.querySelector("svg");this.iconsByUrl.set(u,w)}}loadSvg(u,m=u){if(this.serverUrl&&u.match(/^(http(s)?):/)===null&&(u=this.serverUrl+u,m=u),this.iconsByUrl.has(m))return sn(this.iconsByUrl.get(m));if(this.iconsLoadingByUrl.has(m))return this.iconsLoadingByUrl.get(m);let r=this.loader.getSvg(u).pipe(On(w=>{let I=this.document.createElement("DIV");return I.innerHTML=w,I.querySelector("svg")}),ni(w=>this.iconsByUrl.set(m,w)),ra(w=>(console.error(w),nl(w))),ia(()=>this.iconsLoadingByUrl.delete(m)),$w());return this.iconsLoadingByUrl.set(m,r),r}getSvgByName(u){return this.iconsByUrl.has(u)?sn(this.iconsByUrl.get(u)):this.iconsLoadingByUrl.has(u)?this.iconsLoadingByUrl.get(u):nl(`No svg with name '${u}' has been loaded`)}unloadSvg(u){this.iconsByUrl.has(u)&&this.iconsByUrl.delete(u)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})();function c9(o){return o||new pS}var u9={provide:pS,deps:[[new Tf,new dg,pS]],useFactory:c9};function GF(o={}){return Ac([u9,o.loader||{provide:f_,useClass:a9}])}var Mn=function(o){return o[o.State=0]="State",o[o.Transition=1]="Transition",o[o.Sequence=2]="Sequence",o[o.Group=3]="Group",o[o.Animate=4]="Animate",o[o.Keyframes=5]="Keyframes",o[o.Style=6]="Style",o[o.Trigger=7]="Trigger",o[o.Reference=8]="Reference",o[o.AnimateChild=9]="AnimateChild",o[o.AnimateRef=10]="AnimateRef",o[o.Query=11]="Query",o[o.Stagger=12]="Stagger",o}(Mn||{}),xa="*";function HF(o,i){return{type:Mn.Trigger,name:o,definitions:i,options:{}}}function mS(o,i=null){return{type:Mn.Animate,styles:i,timings:o}}function qF(o,i=null){return{type:Mn.Group,steps:o,options:i}}function WF(o,i=null){return{type:Mn.Sequence,steps:o,options:i}}function hl(o){return{type:Mn.Style,styles:o,offset:null}}function ZF(o,i,l=null){return{type:Mn.Transition,expr:o,animation:i,options:l}}function Gx(o,i,l=null){return{type:Mn.Query,selector:o,animation:i,options:l}}var $c=class{constructor(i=0,l=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=i+l}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(i=>i()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(i){this._position=this.totalTime?i*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(i){let l=i=="start"?this._onStartFns:this._onDoneFns;l.forEach(u=>u()),l.length=0}},p_=class{constructor(i){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=i;let l=0,u=0,m=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(w=>{w.onDone(()=>{++l==r&&this._onFinish()}),w.onDestroy(()=>{++u==r&&this._onDestroy()}),w.onStart(()=>{++m==r&&this._onStart()})}),this.totalTime=this.players.reduce((w,I)=>Math.max(w,I.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this.players.forEach(i=>i.init())}onStart(i){this._onStartFns.push(i)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(i=>i()),this._onStartFns=[])}onDone(i){this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(i=>i.play())}pause(){this.players.forEach(i=>i.pause())}restart(){this.players.forEach(i=>i.restart())}finish(){this._onFinish(),this.players.forEach(i=>i.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(i=>i.destroy()),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this.players.forEach(i=>i.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(i){let l=i*this.totalTime;this.players.forEach(u=>{let m=u.totalTime?Math.min(1,l/u.totalTime):1;u.setPosition(m)})}getPosition(){let i=this.players.reduce((l,u)=>l===null||u.totalTime>l.totalTime?u:l,null);return i!=null?i.getPosition():0}beforeDestroy(){this.players.forEach(i=>{i.beforeDestroy&&i.beforeDestroy()})}triggerCallback(i){let l=i=="start"?this._onStartFns:this._onDoneFns;l.forEach(u=>u()),l.length=0}},Hx="!";function XF(o){return new vt(3e3,!1)}function h9(){return new vt(3100,!1)}function d9(){return new vt(3101,!1)}function f9(o){return new vt(3001,!1)}function p9(o){return new vt(3003,!1)}function m9(o){return new vt(3004,!1)}function g9(o,i){return new vt(3005,!1)}function _9(){return new vt(3006,!1)}function y9(){return new vt(3007,!1)}function v9(o,i){return new vt(3008,!1)}function x9(o){return new vt(3002,!1)}function b9(o,i,l,u,m){return new vt(3010,!1)}function w9(){return new vt(3011,!1)}function E9(){return new vt(3012,!1)}function T9(){return new vt(3200,!1)}function C9(){return new vt(3202,!1)}function S9(){return new vt(3013,!1)}function I9(o){return new vt(3014,!1)}function D9(o){return new vt(3015,!1)}function M9(o){return new vt(3016,!1)}function A9(o,i){return new vt(3404,!1)}function P9(o){return new vt(3502,!1)}function R9(o){return new vt(3503,!1)}function O9(){return new vt(3300,!1)}function k9(o){return new vt(3504,!1)}function L9(o){return new vt(3301,!1)}function F9(o,i){return new vt(3302,!1)}function N9(o){return new vt(3303,!1)}function z9(o,i){return new vt(3400,!1)}function B9(o){return new vt(3401,!1)}function V9(o){return new vt(3402,!1)}function j9(o,i){return new vt(3505,!1)}function Gc(o){switch(o.length){case 0:return new $c;case 1:return o[0];default:return new p_(o)}}function cN(o,i,l=new Map,u=new Map){let m=[],r=[],w=-1,I=null;if(i.forEach(A=>{let L=A.get("offset"),$=L==w,Q=$&&I||new Map;A.forEach((me,he)=>{let be=he,Ie=me;if(he!=="offset")switch(be=o.normalizePropertyName(be,m),Ie){case Hx:Ie=l.get(he);break;case xa:Ie=u.get(he);break;default:Ie=o.normalizeStyleValue(he,be,Ie,m);break}Q.set(be,Ie)}),$||r.push(Q),I=Q,w=L}),m.length)throw P9(m);return r}function zS(o,i,l,u){switch(i){case"start":o.onStart(()=>u(l&&gS(l,"start",o)));break;case"done":o.onDone(()=>u(l&&gS(l,"done",o)));break;case"destroy":o.onDestroy(()=>u(l&&gS(l,"destroy",o)));break}}function gS(o,i,l){let u=l.totalTime,m=!!l.disabled,r=BS(o.element,o.triggerName,o.fromState,o.toState,i||o.phaseName,u??o.totalTime,m),w=o._data;return w!=null&&(r._data=w),r}function BS(o,i,l,u,m="",r=0,w){return{element:o,triggerName:i,fromState:l,toState:u,phaseName:m,totalTime:r,disabled:!!w}}function Lo(o,i,l){let u=o.get(i);return u||o.set(i,u=l),u}function YF(o){let i=o.indexOf(":"),l=o.substring(1,i),u=o.slice(i+1);return[l,u]}var U9=typeof document>"u"?null:document.documentElement;function VS(o){let i=o.parentNode||o.host||null;return i===U9?null:i}function $9(o){return o.substring(1,6)=="ebkit"}var Rh=null,KF=!1;function G9(o){Rh||(Rh=H9()||{},KF=Rh.style?"WebkitAppearance"in Rh.style:!1);let i=!0;return Rh.style&&!$9(o)&&(i=o in Rh.style,!i&&KF&&(i="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in Rh.style)),i}function H9(){return typeof document<"u"?document.body:null}function uN(o,i){for(;i;){if(i===o)return!0;i=VS(i)}return!1}function hN(o,i,l){if(l)return Array.from(o.querySelectorAll(i));let u=o.querySelector(i);return u?[u]:[]}var jS=(()=>{let i=class i{validateStyleProperty(u){return G9(u)}containsElement(u,m){return uN(u,m)}getParentElement(u){return VS(u)}query(u,m,r){return hN(u,m,r)}computeStyle(u,m,r){return r||""}animate(u,m,r,w,I,A=[],L){return new $c(r,w)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})(),HS=class HS{};HS.NOOP=new jS;var Lh=HS,Fh=class{};var q9=1e3,dN="{{",W9="}}",fN="ng-enter",wS="ng-leave",qx="ng-trigger",Kx=".ng-trigger",QF="ng-animating",ES=".ng-animating";function dl(o){if(typeof o=="number")return o;let i=o.match(/^(-?[\.\d]+)(m?s)/);return!i||i.length<2?0:TS(parseFloat(i[1]),i[2])}function TS(o,i){switch(i){case"s":return o*q9;default:return o}}function Qx(o,i,l){return o.hasOwnProperty("duration")?o:Z9(o,i,l)}function Z9(o,i,l){let u=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,m,r=0,w="";if(typeof o=="string"){let I=o.match(u);if(I===null)return i.push(XF(o)),{duration:0,delay:0,easing:""};m=TS(parseFloat(I[1]),I[2]);let A=I[3];A!=null&&(r=TS(parseFloat(A),I[4]));let L=I[5];L&&(w=L)}else m=o;if(!l){let I=!1,A=i.length;m<0&&(i.push(h9()),I=!0),r<0&&(i.push(d9()),I=!0),I&&i.splice(A,0,XF(o))}return{duration:m,delay:r,easing:w}}function X9(o){return o.length?o[0]instanceof Map?o:o.map(i=>new Map(Object.entries(i))):[]}function ba(o,i,l){i.forEach((u,m)=>{let r=US(m);l&&!l.has(m)&&l.set(m,o.style[r]),o.style[r]=u})}function kh(o,i){i.forEach((l,u)=>{let m=US(u);o.style[m]=""})}function m_(o){return Array.isArray(o)?o.length==1?o[0]:WF(o):o}function Y9(o,i,l){let u=i.params||{},m=pN(o);m.length&&m.forEach(r=>{u.hasOwnProperty(r)||l.push(f9(r))})}var CS=new RegExp(`${dN}\\s*(.+?)\\s*${W9}`,"g");function pN(o){let i=[];if(typeof o=="string"){let l;for(;l=CS.exec(o);)i.push(l[1]);CS.lastIndex=0}return i}function __(o,i,l){let u=`${o}`,m=u.replace(CS,(r,w)=>{let I=i[w];return I==null&&(l.push(p9(w)),I=""),I.toString()});return m==u?o:m}var K9=/-+([a-z0-9])/g;function US(o){return o.replace(K9,(...i)=>i[1].toUpperCase())}function Q9(o,i){return o===0||i===0}function J9(o,i,l){if(l.size&&i.length){let u=i[0],m=[];if(l.forEach((r,w)=>{u.has(w)||m.push(w),u.set(w,r)}),m.length)for(let r=1;r<i.length;r++){let w=i[r];m.forEach(I=>w.set(I,$S(o,I)))}}return i}function ko(o,i,l){switch(i.type){case Mn.Trigger:return o.visitTrigger(i,l);case Mn.State:return o.visitState(i,l);case Mn.Transition:return o.visitTransition(i,l);case Mn.Sequence:return o.visitSequence(i,l);case Mn.Group:return o.visitGroup(i,l);case Mn.Animate:return o.visitAnimate(i,l);case Mn.Keyframes:return o.visitKeyframes(i,l);case Mn.Style:return o.visitStyle(i,l);case Mn.Reference:return o.visitReference(i,l);case Mn.AnimateChild:return o.visitAnimateChild(i,l);case Mn.AnimateRef:return o.visitAnimateRef(i,l);case Mn.Query:return o.visitQuery(i,l);case Mn.Stagger:return o.visitStagger(i,l);default:throw m9(i.type)}}function $S(o,i){return window.getComputedStyle(o)[i]}var e7=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Jx=class extends Fh{normalizePropertyName(i,l){return US(i)}normalizeStyleValue(i,l,u,m){let r="",w=u.toString().trim();if(e7.has(l)&&u!==0&&u!=="0")if(typeof u=="number")r="px";else{let I=u.match(/^[+-]?[\d\.]+([a-z]*)$/);I&&I[1].length==0&&m.push(g9(i,u))}return w+r}};var e1="*";function t7(o,i){let l=[];return typeof o=="string"?o.split(/\s*,\s*/).forEach(u=>n7(u,l,i)):l.push(o),l}function n7(o,i,l){if(o[0]==":"){let A=r7(o,l);if(typeof A=="function"){i.push(A);return}o=A}let u=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(u==null||u.length<4)return l.push(D9(o)),i;let m=u[1],r=u[2],w=u[3];i.push(JF(m,w));let I=m==e1&&w==e1;r[0]=="<"&&!I&&i.push(JF(w,m))}function r7(o,i){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(l,u)=>parseFloat(u)>parseFloat(l);case":decrement":return(l,u)=>parseFloat(u)<parseFloat(l);default:return i.push(M9(o)),"* => *"}}var Wx=new Set(["true","1"]),Zx=new Set(["false","0"]);function JF(o,i){let l=Wx.has(o)||Zx.has(o),u=Wx.has(i)||Zx.has(i);return(m,r)=>{let w=o==e1||o==m,I=i==e1||i==r;return!w&&l&&typeof m=="boolean"&&(w=m?Wx.has(o):Zx.has(o)),!I&&u&&typeof r=="boolean"&&(I=r?Wx.has(i):Zx.has(i)),w&&I}}var mN=":self",i7=new RegExp(`s*${mN}s*,?`,"g");function gN(o,i,l,u){return new SS(o).build(i,l,u)}var eN="",SS=class{constructor(i){this._driver=i}build(i,l,u){let m=new IS(l);return this._resetContextStyleTimingState(m),ko(this,m_(i),m)}_resetContextStyleTimingState(i){i.currentQuerySelector=eN,i.collectedStyles=new Map,i.collectedStyles.set(eN,new Map),i.currentTime=0}visitTrigger(i,l){let u=l.queryCount=0,m=l.depCount=0,r=[],w=[];return i.name.charAt(0)=="@"&&l.errors.push(_9()),i.definitions.forEach(I=>{if(this._resetContextStyleTimingState(l),I.type==Mn.State){let A=I,L=A.name;L.toString().split(/\s*,\s*/).forEach($=>{A.name=$,r.push(this.visitState(A,l))}),A.name=L}else if(I.type==Mn.Transition){let A=this.visitTransition(I,l);u+=A.queryCount,m+=A.depCount,w.push(A)}else l.errors.push(y9())}),{type:Mn.Trigger,name:i.name,states:r,transitions:w,queryCount:u,depCount:m,options:null}}visitState(i,l){let u=this.visitStyle(i.styles,l),m=i.options&&i.options.params||null;if(u.containsDynamicStyles){let r=new Set,w=m||{};u.styles.forEach(I=>{I instanceof Map&&I.forEach(A=>{pN(A).forEach(L=>{w.hasOwnProperty(L)||r.add(L)})})}),r.size&&l.errors.push(v9(i.name,[...r.values()]))}return{type:Mn.State,name:i.name,style:u,options:m?{params:m}:null}}visitTransition(i,l){l.queryCount=0,l.depCount=0;let u=ko(this,m_(i.animation),l),m=t7(i.expr,l.errors);return{type:Mn.Transition,matchers:m,animation:u,queryCount:l.queryCount,depCount:l.depCount,options:Oh(i.options)}}visitSequence(i,l){return{type:Mn.Sequence,steps:i.steps.map(u=>ko(this,u,l)),options:Oh(i.options)}}visitGroup(i,l){let u=l.currentTime,m=0,r=i.steps.map(w=>{l.currentTime=u;let I=ko(this,w,l);return m=Math.max(m,l.currentTime),I});return l.currentTime=m,{type:Mn.Group,steps:r,options:Oh(i.options)}}visitAnimate(i,l){let u=l7(i.timings,l.errors);l.currentAnimateTimings=u;let m,r=i.styles?i.styles:hl({});if(r.type==Mn.Keyframes)m=this.visitKeyframes(r,l);else{let w=i.styles,I=!1;if(!w){I=!0;let L={};u.easing&&(L.easing=u.easing),w=hl(L)}l.currentTime+=u.duration+u.delay;let A=this.visitStyle(w,l);A.isEmptyStep=I,m=A}return l.currentAnimateTimings=null,{type:Mn.Animate,timings:u,style:m,options:null}}visitStyle(i,l){let u=this._makeStyleAst(i,l);return this._validateStyleAst(u,l),u}_makeStyleAst(i,l){let u=[],m=Array.isArray(i.styles)?i.styles:[i.styles];for(let I of m)typeof I=="string"?I===xa?u.push(I):l.errors.push(x9(I)):u.push(new Map(Object.entries(I)));let r=!1,w=null;return u.forEach(I=>{if(I instanceof Map&&(I.has("easing")&&(w=I.get("easing"),I.delete("easing")),!r)){for(let A of I.values())if(A.toString().indexOf(dN)>=0){r=!0;break}}}),{type:Mn.Style,styles:u,easing:w,offset:i.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(i,l){let u=l.currentAnimateTimings,m=l.currentTime,r=l.currentTime;u&&r>0&&(r-=u.duration+u.delay),i.styles.forEach(w=>{typeof w!="string"&&w.forEach((I,A)=>{let L=l.collectedStyles.get(l.currentQuerySelector),$=L.get(A),Q=!0;$&&(r!=m&&r>=$.startTime&&m<=$.endTime&&(l.errors.push(b9(A,$.startTime,$.endTime,r,m)),Q=!1),r=$.startTime),Q&&L.set(A,{startTime:r,endTime:m}),l.options&&Y9(I,l.options,l.errors)})})}visitKeyframes(i,l){let u={type:Mn.Keyframes,styles:[],options:null};if(!l.currentAnimateTimings)return l.errors.push(w9()),u;let m=1,r=0,w=[],I=!1,A=!1,L=0,$=i.steps.map(ze=>{let nt=this._makeStyleAst(ze,l),ft=nt.offset!=null?nt.offset:a7(nt.styles),Ue=0;return ft!=null&&(r++,Ue=nt.offset=ft),A=A||Ue<0||Ue>1,I=I||Ue<L,L=Ue,w.push(Ue),nt});A&&l.errors.push(E9()),I&&l.errors.push(T9());let Q=i.steps.length,me=0;r>0&&r<Q?l.errors.push(C9()):r==0&&(me=m/(Q-1));let he=Q-1,be=l.currentTime,Ie=l.currentAnimateTimings,Qe=Ie.duration;return $.forEach((ze,nt)=>{let ft=me>0?nt==he?1:me*nt:w[nt],Ue=ft*Qe;l.currentTime=be+Ie.delay+Ue,Ie.duration=Ue,this._validateStyleAst(ze,l),ze.offset=ft,u.styles.push(ze)}),u}visitReference(i,l){return{type:Mn.Reference,animation:ko(this,m_(i.animation),l),options:Oh(i.options)}}visitAnimateChild(i,l){return l.depCount++,{type:Mn.AnimateChild,options:Oh(i.options)}}visitAnimateRef(i,l){return{type:Mn.AnimateRef,animation:this.visitReference(i.animation,l),options:Oh(i.options)}}visitQuery(i,l){let u=l.currentQuerySelector,m=i.options||{};l.queryCount++,l.currentQuery=i;let[r,w]=o7(i.selector);l.currentQuerySelector=u.length?u+" "+r:r,Lo(l.collectedStyles,l.currentQuerySelector,new Map);let I=ko(this,m_(i.animation),l);return l.currentQuery=null,l.currentQuerySelector=u,{type:Mn.Query,selector:r,limit:m.limit||0,optional:!!m.optional,includeSelf:w,animation:I,originalSelector:i.selector,options:Oh(i.options)}}visitStagger(i,l){l.currentQuery||l.errors.push(S9());let u=i.timings==="full"?{duration:0,delay:0,easing:"full"}:Qx(i.timings,l.errors,!0);return{type:Mn.Stagger,animation:ko(this,m_(i.animation),l),timings:u,options:null}}};function o7(o){let i=!!o.split(/\s*,\s*/).find(l=>l==mN);return i&&(o=o.replace(i7,"")),o=o.replace(/@\*/g,Kx).replace(/@\w+/g,l=>Kx+"-"+l.slice(1)).replace(/:animating/g,ES),[o,i]}function s7(o){return o?xt({},o):null}var IS=class{constructor(i){this.errors=i,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function a7(o){if(typeof o=="string")return null;let i=null;if(Array.isArray(o))o.forEach(l=>{if(l instanceof Map&&l.has("offset")){let u=l;i=parseFloat(u.get("offset")),u.delete("offset")}});else if(o instanceof Map&&o.has("offset")){let l=o;i=parseFloat(l.get("offset")),l.delete("offset")}return i}function l7(o,i){if(o.hasOwnProperty("duration"))return o;if(typeof o=="number"){let r=Qx(o,i).duration;return _S(r,0,"")}let l=o;if(l.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=_S(0,0,"");return r.dynamic=!0,r.strValue=l,r}let m=Qx(l,i);return _S(m.duration,m.delay,m.easing)}function Oh(o){return o?(o=xt({},o),o.params&&(o.params=s7(o.params))):o={},o}function _S(o,i,l){return{duration:o,delay:i,easing:l}}function GS(o,i,l,u,m,r,w=null,I=!1){return{type:1,element:o,keyframes:i,preStyleProps:l,postStyleProps:u,duration:m,delay:r,totalTime:m+r,easing:w,subTimeline:I}}var y_=class{constructor(){this._map=new Map}get(i){return this._map.get(i)||[]}append(i,l){let u=this._map.get(i);u||this._map.set(i,u=[]),u.push(...l)}has(i){return this._map.has(i)}clear(){this._map.clear()}},c7=1,u7=":enter",h7=new RegExp(u7,"g"),d7=":leave",f7=new RegExp(d7,"g");function _N(o,i,l,u,m,r=new Map,w=new Map,I,A,L=[]){return new DS().buildKeyframes(o,i,l,u,m,r,w,I,A,L)}var DS=class{buildKeyframes(i,l,u,m,r,w,I,A,L,$=[]){L=L||new y_;let Q=new MS(i,l,L,m,r,$,[]);Q.options=A;let me=A.delay?dl(A.delay):0;Q.currentTimeline.delayNextStep(me),Q.currentTimeline.setStyles([w],null,Q.errors,A),ko(this,u,Q);let he=Q.timelines.filter(be=>be.containsAnimation());if(he.length&&I.size){let be;for(let Ie=he.length-1;Ie>=0;Ie--){let Qe=he[Ie];if(Qe.element===l){be=Qe;break}}be&&!be.allowOnlyTimelineStyles()&&be.setStyles([I],null,Q.errors,A)}return he.length?he.map(be=>be.buildKeyframes()):[GS(l,[],[],[],0,me,"",!1)]}visitTrigger(i,l){}visitState(i,l){}visitTransition(i,l){}visitAnimateChild(i,l){let u=l.subInstructions.get(l.element);if(u){let m=l.createSubContext(i.options),r=l.currentTimeline.currentTime,w=this._visitSubInstructions(u,m,m.options);r!=w&&l.transformIntoNewTimeline(w)}l.previousNode=i}visitAnimateRef(i,l){let u=l.createSubContext(i.options);u.transformIntoNewTimeline(),this._applyAnimationRefDelays([i.options,i.animation.options],l,u),this.visitReference(i.animation,u),l.transformIntoNewTimeline(u.currentTimeline.currentTime),l.previousNode=i}_applyAnimationRefDelays(i,l,u){for(let m of i){let r=m?.delay;if(r){let w=typeof r=="number"?r:dl(__(r,m?.params??{},l.errors));u.delayNextStep(w)}}}_visitSubInstructions(i,l,u){let r=l.currentTimeline.currentTime,w=u.duration!=null?dl(u.duration):null,I=u.delay!=null?dl(u.delay):null;return w!==0&&i.forEach(A=>{let L=l.appendInstructionToTimeline(A,w,I);r=Math.max(r,L.duration+L.delay)}),r}visitReference(i,l){l.updateOptions(i.options,!0),ko(this,i.animation,l),l.previousNode=i}visitSequence(i,l){let u=l.subContextCount,m=l,r=i.options;if(r&&(r.params||r.delay)&&(m=l.createSubContext(r),m.transformIntoNewTimeline(),r.delay!=null)){m.previousNode.type==Mn.Style&&(m.currentTimeline.snapshotCurrentStyles(),m.previousNode=t1);let w=dl(r.delay);m.delayNextStep(w)}i.steps.length&&(i.steps.forEach(w=>ko(this,w,m)),m.currentTimeline.applyStylesToKeyframe(),m.subContextCount>u&&m.transformIntoNewTimeline()),l.previousNode=i}visitGroup(i,l){let u=[],m=l.currentTimeline.currentTime,r=i.options&&i.options.delay?dl(i.options.delay):0;i.steps.forEach(w=>{let I=l.createSubContext(i.options);r&&I.delayNextStep(r),ko(this,w,I),m=Math.max(m,I.currentTimeline.currentTime),u.push(I.currentTimeline)}),u.forEach(w=>l.currentTimeline.mergeTimelineCollectedStyles(w)),l.transformIntoNewTimeline(m),l.previousNode=i}_visitTiming(i,l){if(i.dynamic){let u=i.strValue,m=l.params?__(u,l.params,l.errors):u;return Qx(m,l.errors)}else return{duration:i.duration,delay:i.delay,easing:i.easing}}visitAnimate(i,l){let u=l.currentAnimateTimings=this._visitTiming(i.timings,l),m=l.currentTimeline;u.delay&&(l.incrementTime(u.delay),m.snapshotCurrentStyles());let r=i.style;r.type==Mn.Keyframes?this.visitKeyframes(r,l):(l.incrementTime(u.duration),this.visitStyle(r,l),m.applyStylesToKeyframe()),l.currentAnimateTimings=null,l.previousNode=i}visitStyle(i,l){let u=l.currentTimeline,m=l.currentAnimateTimings;!m&&u.hasCurrentStyleProperties()&&u.forwardFrame();let r=m&&m.easing||i.easing;i.isEmptyStep?u.applyEmptyStep(r):u.setStyles(i.styles,r,l.errors,l.options),l.previousNode=i}visitKeyframes(i,l){let u=l.currentAnimateTimings,m=l.currentTimeline.duration,r=u.duration,I=l.createSubContext().currentTimeline;I.easing=u.easing,i.styles.forEach(A=>{let L=A.offset||0;I.forwardTime(L*r),I.setStyles(A.styles,A.easing,l.errors,l.options),I.applyStylesToKeyframe()}),l.currentTimeline.mergeTimelineCollectedStyles(I),l.transformIntoNewTimeline(m+r),l.previousNode=i}visitQuery(i,l){let u=l.currentTimeline.currentTime,m=i.options||{},r=m.delay?dl(m.delay):0;r&&(l.previousNode.type===Mn.Style||u==0&&l.currentTimeline.hasCurrentStyleProperties())&&(l.currentTimeline.snapshotCurrentStyles(),l.previousNode=t1);let w=u,I=l.invokeQuery(i.selector,i.originalSelector,i.limit,i.includeSelf,!!m.optional,l.errors);l.currentQueryTotal=I.length;let A=null;I.forEach((L,$)=>{l.currentQueryIndex=$;let Q=l.createSubContext(i.options,L);r&&Q.delayNextStep(r),L===l.element&&(A=Q.currentTimeline),ko(this,i.animation,Q),Q.currentTimeline.applyStylesToKeyframe();let me=Q.currentTimeline.currentTime;w=Math.max(w,me)}),l.currentQueryIndex=0,l.currentQueryTotal=0,l.transformIntoNewTimeline(w),A&&(l.currentTimeline.mergeTimelineCollectedStyles(A),l.currentTimeline.snapshotCurrentStyles()),l.previousNode=i}visitStagger(i,l){let u=l.parentContext,m=l.currentTimeline,r=i.timings,w=Math.abs(r.duration),I=w*(l.currentQueryTotal-1),A=w*l.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":A=I-A;break;case"full":A=u.currentStaggerTime;break}let $=l.currentTimeline;A&&$.delayNextStep(A);let Q=$.currentTime;ko(this,i.animation,l),l.previousNode=i,u.currentStaggerTime=m.currentTime-Q+(m.startTime-u.currentTimeline.startTime)}},t1={},MS=class o{constructor(i,l,u,m,r,w,I,A){this._driver=i,this.element=l,this.subInstructions=u,this._enterClassName=m,this._leaveClassName=r,this.errors=w,this.timelines=I,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=t1,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=A||new n1(this._driver,l,0),I.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(i,l){if(!i)return;let u=i,m=this.options;u.duration!=null&&(m.duration=dl(u.duration)),u.delay!=null&&(m.delay=dl(u.delay));let r=u.params;if(r){let w=m.params;w||(w=this.options.params={}),Object.keys(r).forEach(I=>{(!l||!w.hasOwnProperty(I))&&(w[I]=__(r[I],w,this.errors))})}}_copyOptions(){let i={};if(this.options){let l=this.options.params;if(l){let u=i.params={};Object.keys(l).forEach(m=>{u[m]=l[m]})}}return i}createSubContext(i=null,l,u){let m=l||this.element,r=new o(this._driver,m,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(m,u||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(i),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(i){return this.previousNode=t1,this.currentTimeline=this.currentTimeline.fork(this.element,i),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(i,l,u){let m={duration:l??i.duration,delay:this.currentTimeline.currentTime+(u??0)+i.delay,easing:""},r=new AS(this._driver,i.element,i.keyframes,i.preStyleProps,i.postStyleProps,m,i.stretchStartingKeyframe);return this.timelines.push(r),m}incrementTime(i){this.currentTimeline.forwardTime(this.currentTimeline.duration+i)}delayNextStep(i){i>0&&this.currentTimeline.delayNextStep(i)}invokeQuery(i,l,u,m,r,w){let I=[];if(m&&I.push(this.element),i.length>0){i=i.replace(h7,"."+this._enterClassName),i=i.replace(f7,"."+this._leaveClassName);let A=u!=1,L=this._driver.query(this.element,i,A);u!==0&&(L=u<0?L.slice(L.length+u,L.length):L.slice(0,u)),I.push(...L)}return!r&&I.length==0&&w.push(I9(l)),I}},n1=class o{constructor(i,l,u,m){this._driver=i,this.element=l,this.startTime=u,this._elementTimelineStylesLookup=m,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(l),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(l,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(i){let l=this._keyframes.size===1&&this._pendingStyles.size;this.duration||l?(this.forwardTime(this.currentTime+i),l&&this.snapshotCurrentStyles()):this.startTime+=i}fork(i,l){return this.applyStylesToKeyframe(),new o(this._driver,i,l||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=c7,this._loadKeyframe()}forwardTime(i){this.applyStylesToKeyframe(),this.duration=i,this._loadKeyframe()}_updateStyle(i,l){this._localTimelineStyles.set(i,l),this._globalTimelineStyles.set(i,l),this._styleSummary.set(i,{time:this.currentTime,value:l})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(i){i&&this._previousKeyframe.set("easing",i);for(let[l,u]of this._globalTimelineStyles)this._backFill.set(l,u||xa),this._currentKeyframe.set(l,xa);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(i,l,u,m){l&&this._previousKeyframe.set("easing",l);let r=m&&m.params||{},w=p7(i,this._globalTimelineStyles);for(let[I,A]of w){let L=__(A,r,u);this._pendingStyles.set(I,L),this._localTimelineStyles.has(I)||this._backFill.set(I,this._globalTimelineStyles.get(I)??xa),this._updateStyle(I,L)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((i,l)=>{this._currentKeyframe.set(l,i)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((i,l)=>{this._currentKeyframe.has(l)||this._currentKeyframe.set(l,i)}))}snapshotCurrentStyles(){for(let[i,l]of this._localTimelineStyles)this._pendingStyles.set(i,l),this._updateStyle(i,l)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let i=[];for(let l in this._currentKeyframe)i.push(l);return i}mergeTimelineCollectedStyles(i){i._styleSummary.forEach((l,u)=>{let m=this._styleSummary.get(u);(!m||l.time>m.time)&&this._updateStyle(u,l.value)})}buildKeyframes(){this.applyStylesToKeyframe();let i=new Set,l=new Set,u=this._keyframes.size===1&&this.duration===0,m=[];this._keyframes.forEach((I,A)=>{let L=new Map([...this._backFill,...I]);L.forEach(($,Q)=>{$===Hx?i.add(Q):$===xa&&l.add(Q)}),u||L.set("offset",A/this.duration),m.push(L)});let r=[...i.values()],w=[...l.values()];if(u){let I=m[0],A=new Map(I);I.set("offset",0),A.set("offset",1),m=[I,A]}return GS(this.element,m,r,w,this.duration,this.startTime,this.easing,!1)}},AS=class extends n1{constructor(i,l,u,m,r,w,I=!1){super(i,l,w.delay),this.keyframes=u,this.preStyleProps=m,this.postStyleProps=r,this._stretchStartingKeyframe=I,this.timings={duration:w.duration,delay:w.delay,easing:w.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let i=this.keyframes,{delay:l,duration:u,easing:m}=this.timings;if(this._stretchStartingKeyframe&&l){let r=[],w=u+l,I=l/w,A=new Map(i[0]);A.set("offset",0),r.push(A);let L=new Map(i[0]);L.set("offset",tN(I)),r.push(L);let $=i.length-1;for(let Q=1;Q<=$;Q++){let me=new Map(i[Q]),he=me.get("offset"),be=l+he*u;me.set("offset",tN(be/w)),r.push(me)}u=w,l=0,m="",i=r}return GS(this.element,i,this.preStyleProps,this.postStyleProps,u,l,m,!0)}};function tN(o,i=3){let l=Math.pow(10,i-1);return Math.round(o*l)/l}function p7(o,i){let l=new Map,u;return o.forEach(m=>{if(m==="*"){u??=i.keys();for(let r of u)l.set(r,xa)}else for(let[r,w]of m)l.set(r,w)}),l}function nN(o,i,l,u,m,r,w,I,A,L,$,Q,me){return{type:0,element:o,triggerName:i,isRemovalTransition:m,fromState:l,fromStyles:r,toState:u,toStyles:w,timelines:I,queriedElements:A,preStyleProps:L,postStyleProps:$,totalTime:Q,errors:me}}var yS={},r1=class{constructor(i,l,u){this._triggerName=i,this.ast=l,this._stateStyles=u}match(i,l,u,m){return m7(this.ast.matchers,i,l,u,m)}buildStyles(i,l,u){let m=this._stateStyles.get("*");return i!==void 0&&(m=this._stateStyles.get(i?.toString())||m),m?m.buildStyles(l,u):new Map}build(i,l,u,m,r,w,I,A,L,$){let Q=[],me=this.ast.options&&this.ast.options.params||yS,he=I&&I.params||yS,be=this.buildStyles(u,he,Q),Ie=A&&A.params||yS,Qe=this.buildStyles(m,Ie,Q),ze=new Set,nt=new Map,ft=new Map,Ue=m==="void",Nt={params:yN(Ie,me),delay:this.ast.options?.delay},Yt=$?[]:_N(i,l,this.ast.animation,r,w,be,Qe,Nt,L,Q),Jt=0;return Yt.forEach(wt=>{Jt=Math.max(wt.duration+wt.delay,Jt)}),Q.length?nN(l,this._triggerName,u,m,Ue,be,Qe,[],[],nt,ft,Jt,Q):(Yt.forEach(wt=>{let er=wt.element,St=Lo(nt,er,new Set);wt.preStyleProps.forEach(yr=>St.add(yr));let fr=Lo(ft,er,new Set);wt.postStyleProps.forEach(yr=>fr.add(yr)),er!==l&&ze.add(er)}),nN(l,this._triggerName,u,m,Ue,be,Qe,Yt,[...ze.values()],nt,ft,Jt))}};function m7(o,i,l,u,m){return o.some(r=>r(i,l,u,m))}function yN(o,i){let l=xt({},i);return Object.entries(o).forEach(([u,m])=>{m!=null&&(l[u]=m)}),l}var PS=class{constructor(i,l,u){this.styles=i,this.defaultParams=l,this.normalizer=u}buildStyles(i,l){let u=new Map,m=yN(i,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((w,I)=>{w&&(w=__(w,m,l));let A=this.normalizer.normalizePropertyName(I,l);w=this.normalizer.normalizeStyleValue(I,A,w,l),u.set(I,w)})}),u}};function g7(o,i,l){return new RS(o,i,l)}var RS=class{constructor(i,l,u){this.name=i,this.ast=l,this._normalizer=u,this.transitionFactories=[],this.states=new Map,l.states.forEach(m=>{let r=m.options&&m.options.params||{};this.states.set(m.name,new PS(m.style,r,u))}),rN(this.states,"true","1"),rN(this.states,"false","0"),l.transitions.forEach(m=>{this.transitionFactories.push(new r1(i,m,this.states))}),this.fallbackTransition=_7(i,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(i,l,u,m){return this.transitionFactories.find(w=>w.match(i,l,u,m))||null}matchStyles(i,l,u){return this.fallbackTransition.buildStyles(i,l,u)}};function _7(o,i,l){let u=[(w,I)=>!0],m={type:Mn.Sequence,steps:[],options:null},r={type:Mn.Transition,animation:m,matchers:u,options:null,queryCount:0,depCount:0};return new r1(o,r,i)}function rN(o,i,l){o.has(i)?o.has(l)||o.set(l,o.get(i)):o.has(l)&&o.set(i,o.get(l))}var y7=new y_,OS=class{constructor(i,l,u){this.bodyNode=i,this._driver=l,this._normalizer=u,this._animations=new Map,this._playersById=new Map,this.players=[]}register(i,l){let u=[],m=[],r=gN(this._driver,l,u,m);if(u.length)throw R9(u);m.length&&void 0,this._animations.set(i,r)}_buildPlayer(i,l,u){let m=i.element,r=cN(this._normalizer,i.keyframes,l,u);return this._driver.animate(m,r,i.duration,i.delay,i.easing,[],!0)}create(i,l,u={}){let m=[],r=this._animations.get(i),w,I=new Map;if(r?(w=_N(this._driver,l,r,fN,wS,new Map,new Map,u,y7,m),w.forEach($=>{let Q=Lo(I,$.element,new Map);$.postStyleProps.forEach(me=>Q.set(me,null))})):(m.push(O9()),w=[]),m.length)throw k9(m);I.forEach(($,Q)=>{$.forEach((me,he)=>{$.set(he,this._driver.computeStyle(Q,he,xa))})});let A=w.map($=>{let Q=I.get($.element);return this._buildPlayer($,new Map,Q)}),L=Gc(A);return this._playersById.set(i,L),L.onDestroy(()=>this.destroy(i)),this.players.push(L),L}destroy(i){let l=this._getPlayer(i);l.destroy(),this._playersById.delete(i);let u=this.players.indexOf(l);u>=0&&this.players.splice(u,1)}_getPlayer(i){let l=this._playersById.get(i);if(!l)throw L9(i);return l}listen(i,l,u,m){let r=BS(l,"","","");return zS(this._getPlayer(i),u,r,m),()=>{}}command(i,l,u,m){if(u=="register"){this.register(i,m[0]);return}if(u=="create"){let w=m[0]||{};this.create(i,l,w);return}let r=this._getPlayer(i);switch(u){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(m[0]));break;case"destroy":this.destroy(i);break}}},iN="ng-animate-queued",v7=".ng-animate-queued",vS="ng-animate-disabled",x7=".ng-animate-disabled",b7="ng-star-inserted",w7=".ng-star-inserted",E7=[],vN={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},T7={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Os="__ng_removed",v_=class{get params(){return this.options.params}constructor(i,l=""){this.namespaceId=l;let u=i&&i.hasOwnProperty("value"),m=u?i.value:i;if(this.value=S7(m),u){let r=i,{value:w}=r,I=Ko(r,["value"]);this.options=I}else this.options={};this.options.params||(this.options.params={})}absorbOptions(i){let l=i.params;if(l){let u=this.options.params;Object.keys(l).forEach(m=>{u[m]==null&&(u[m]=l[m])})}}},g_="void",xS=new v_(g_),kS=class{constructor(i,l,u){this.id=i,this.hostElement=l,this._engine=u,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+i,rs(l,this._hostClassName)}listen(i,l,u,m){if(!this._triggers.has(l))throw F9(u,l);if(u==null||u.length==0)throw N9(l);if(!I7(u))throw z9(u,l);let r=Lo(this._elementListeners,i,[]),w={name:l,phase:u,callback:m};r.push(w);let I=Lo(this._engine.statesByElement,i,new Map);return I.has(l)||(rs(i,qx),rs(i,qx+"-"+l),I.set(l,xS)),()=>{this._engine.afterFlush(()=>{let A=r.indexOf(w);A>=0&&r.splice(A,1),this._triggers.has(l)||I.delete(l)})}}register(i,l){return this._triggers.has(i)?!1:(this._triggers.set(i,l),!0)}_getTrigger(i){let l=this._triggers.get(i);if(!l)throw B9(i);return l}trigger(i,l,u,m=!0){let r=this._getTrigger(l),w=new x_(this.id,l,i),I=this._engine.statesByElement.get(i);I||(rs(i,qx),rs(i,qx+"-"+l),this._engine.statesByElement.set(i,I=new Map));let A=I.get(l),L=new v_(u,this.id);if(!(u&&u.hasOwnProperty("value"))&&A&&L.absorbOptions(A.options),I.set(l,L),A||(A=xS),!(L.value===g_)&&A.value===L.value){if(!A7(A.params,L.params)){let Ie=[],Qe=r.matchStyles(A.value,A.params,Ie),ze=r.matchStyles(L.value,L.params,Ie);Ie.length?this._engine.reportError(Ie):this._engine.afterFlush(()=>{kh(i,Qe),ba(i,ze)})}return}let me=Lo(this._engine.playersByElement,i,[]);me.forEach(Ie=>{Ie.namespaceId==this.id&&Ie.triggerName==l&&Ie.queued&&Ie.destroy()});let he=r.matchTransition(A.value,L.value,i,L.params),be=!1;if(!he){if(!m)return;he=r.fallbackTransition,be=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:l,transition:he,fromState:A,toState:L,player:w,isFallbackTransition:be}),be||(rs(i,iN),w.onStart(()=>{Jf(i,iN)})),w.onDone(()=>{let Ie=this.players.indexOf(w);Ie>=0&&this.players.splice(Ie,1);let Qe=this._engine.playersByElement.get(i);if(Qe){let ze=Qe.indexOf(w);ze>=0&&Qe.splice(ze,1)}}),this.players.push(w),me.push(w),w}deregister(i){this._triggers.delete(i),this._engine.statesByElement.forEach(l=>l.delete(i)),this._elementListeners.forEach((l,u)=>{this._elementListeners.set(u,l.filter(m=>m.name!=i))})}clearElementCache(i){this._engine.statesByElement.delete(i),this._elementListeners.delete(i);let l=this._engine.playersByElement.get(i);l&&(l.forEach(u=>u.destroy()),this._engine.playersByElement.delete(i))}_signalRemovalForInnerTriggers(i,l){let u=this._engine.driver.query(i,Kx,!0);u.forEach(m=>{if(m[Os])return;let r=this._engine.fetchNamespacesByElement(m);r.size?r.forEach(w=>w.triggerLeaveAnimation(m,l,!1,!0)):this.clearElementCache(m)}),this._engine.afterFlushAnimationsDone(()=>u.forEach(m=>this.clearElementCache(m)))}triggerLeaveAnimation(i,l,u,m){let r=this._engine.statesByElement.get(i),w=new Map;if(r){let I=[];if(r.forEach((A,L)=>{if(w.set(L,A.value),this._triggers.has(L)){let $=this.trigger(i,L,g_,m);$&&I.push($)}}),I.length)return this._engine.markElementAsRemoved(this.id,i,!0,l,w),u&&Gc(I).onDone(()=>this._engine.processLeaveNode(i)),!0}return!1}prepareLeaveAnimationListeners(i){let l=this._elementListeners.get(i),u=this._engine.statesByElement.get(i);if(l&&u){let m=new Set;l.forEach(r=>{let w=r.name;if(m.has(w))return;m.add(w);let A=this._triggers.get(w).fallbackTransition,L=u.get(w)||xS,$=new v_(g_),Q=new x_(this.id,w,i);this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:w,transition:A,fromState:L,toState:$,player:Q,isFallbackTransition:!0})})}}removeNode(i,l){let u=this._engine;if(i.childElementCount&&this._signalRemovalForInnerTriggers(i,l),this.triggerLeaveAnimation(i,l,!0))return;let m=!1;if(u.totalAnimations){let r=u.players.length?u.playersByQueriedElement.get(i):[];if(r&&r.length)m=!0;else{let w=i;for(;w=w.parentNode;)if(u.statesByElement.get(w)){m=!0;break}}}if(this.prepareLeaveAnimationListeners(i),m)u.markElementAsRemoved(this.id,i,!1,l);else{let r=i[Os];(!r||r===vN)&&(u.afterFlush(()=>this.clearElementCache(i)),u.destroyInnerAnimations(i),u._onRemovalComplete(i,l))}}insertNode(i,l){rs(i,this._hostClassName)}drainQueuedTransitions(i){let l=[];return this._queue.forEach(u=>{let m=u.player;if(m.destroyed)return;let r=u.element,w=this._elementListeners.get(r);w&&w.forEach(I=>{if(I.name==u.triggerName){let A=BS(r,u.triggerName,u.fromState.value,u.toState.value);A._data=i,zS(u.player,I.phase,A,I.callback)}}),m.markedForDestroy?this._engine.afterFlush(()=>{m.destroy()}):l.push(u)}),this._queue=[],l.sort((u,m)=>{let r=u.transition.ast.depCount,w=m.transition.ast.depCount;return r==0||w==0?r-w:this._engine.driver.containsElement(u.element,m.element)?1:-1})}destroy(i){this.players.forEach(l=>l.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,i)}},LS=class{_onRemovalComplete(i,l){this.onRemovalComplete(i,l)}constructor(i,l,u){this.bodyNode=i,this.driver=l,this._normalizer=u,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(m,r)=>{}}get queuedPlayers(){let i=[];return this._namespaceList.forEach(l=>{l.players.forEach(u=>{u.queued&&i.push(u)})}),i}createNamespace(i,l){let u=new kS(i,l,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,l)?this._balanceNamespaceList(u,l):(this.newHostElements.set(l,u),this.collectEnterElement(l)),this._namespaceLookup[i]=u}_balanceNamespaceList(i,l){let u=this._namespaceList,m=this.namespacesByHostElement;if(u.length-1>=0){let w=!1,I=this.driver.getParentElement(l);for(;I;){let A=m.get(I);if(A){let L=u.indexOf(A);u.splice(L+1,0,i),w=!0;break}I=this.driver.getParentElement(I)}w||u.unshift(i)}else u.push(i);return m.set(l,i),i}register(i,l){let u=this._namespaceLookup[i];return u||(u=this.createNamespace(i,l)),u}registerTrigger(i,l,u){let m=this._namespaceLookup[i];m&&m.register(l,u)&&this.totalAnimations++}destroy(i,l){i&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let u=this._fetchNamespace(i);this.namespacesByHostElement.delete(u.hostElement);let m=this._namespaceList.indexOf(u);m>=0&&this._namespaceList.splice(m,1),u.destroy(l),delete this._namespaceLookup[i]}))}_fetchNamespace(i){return this._namespaceLookup[i]}fetchNamespacesByElement(i){let l=new Set,u=this.statesByElement.get(i);if(u){for(let m of u.values())if(m.namespaceId){let r=this._fetchNamespace(m.namespaceId);r&&l.add(r)}}return l}trigger(i,l,u,m){if(Xx(l)){let r=this._fetchNamespace(i);if(r)return r.trigger(l,u,m),!0}return!1}insertNode(i,l,u,m){if(!Xx(l))return;let r=l[Os];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let w=this.collectedLeaveElements.indexOf(l);w>=0&&this.collectedLeaveElements.splice(w,1)}if(i){let w=this._fetchNamespace(i);w&&w.insertNode(l,u)}m&&this.collectEnterElement(l)}collectEnterElement(i){this.collectedEnterElements.push(i)}markElementAsDisabled(i,l){l?this.disabledNodes.has(i)||(this.disabledNodes.add(i),rs(i,vS)):this.disabledNodes.has(i)&&(this.disabledNodes.delete(i),Jf(i,vS))}removeNode(i,l,u){if(Xx(l)){let m=i?this._fetchNamespace(i):null;m?m.removeNode(l,u):this.markElementAsRemoved(i,l,!1,u);let r=this.namespacesByHostElement.get(l);r&&r.id!==i&&r.removeNode(l,u)}else this._onRemovalComplete(l,u)}markElementAsRemoved(i,l,u,m,r){this.collectedLeaveElements.push(l),l[Os]={namespaceId:i,setForRemoval:m,hasAnimation:u,removedBeforeQueried:!1,previousTriggersValues:r}}listen(i,l,u,m,r){return Xx(l)?this._fetchNamespace(i).listen(l,u,m,r):()=>{}}_buildInstruction(i,l,u,m,r){return i.transition.build(this.driver,i.element,i.fromState.value,i.toState.value,u,m,i.fromState.options,i.toState.options,l,r)}destroyInnerAnimations(i){let l=this.driver.query(i,Kx,!0);l.forEach(u=>this.destroyActiveAnimationsForElement(u)),this.playersByQueriedElement.size!=0&&(l=this.driver.query(i,ES,!0),l.forEach(u=>this.finishActiveQueriedAnimationOnElement(u)))}destroyActiveAnimationsForElement(i){let l=this.playersByElement.get(i);l&&l.forEach(u=>{u.queued?u.markedForDestroy=!0:u.destroy()})}finishActiveQueriedAnimationOnElement(i){let l=this.playersByQueriedElement.get(i);l&&l.forEach(u=>u.finish())}whenRenderingDone(){return new Promise(i=>{if(this.players.length)return Gc(this.players).onDone(()=>i());i()})}processLeaveNode(i){let l=i[Os];if(l&&l.setForRemoval){if(i[Os]=vN,l.namespaceId){this.destroyInnerAnimations(i);let u=this._fetchNamespace(l.namespaceId);u&&u.clearElementCache(i)}this._onRemovalComplete(i,l.setForRemoval)}i.classList?.contains(vS)&&this.markElementAsDisabled(i,!1),this.driver.query(i,x7,!0).forEach(u=>{this.markElementAsDisabled(u,!1)})}flush(i=-1){let l=[];if(this.newHostElements.size&&(this.newHostElements.forEach((u,m)=>this._balanceNamespaceList(u,m)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let u=0;u<this.collectedEnterElements.length;u++){let m=this.collectedEnterElements[u];rs(m,b7)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let u=[];try{l=this._flushAnimations(u,i)}finally{for(let m=0;m<u.length;m++)u[m]()}}else for(let u=0;u<this.collectedLeaveElements.length;u++){let m=this.collectedLeaveElements[u];this.processLeaveNode(m)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(u=>u()),this._flushFns=[],this._whenQuietFns.length){let u=this._whenQuietFns;this._whenQuietFns=[],l.length?Gc(l).onDone(()=>{u.forEach(m=>m())}):u.forEach(m=>m())}}reportError(i){throw V9(i)}_flushAnimations(i,l){let u=new y_,m=[],r=new Map,w=[],I=new Map,A=new Map,L=new Map,$=new Set;this.disabledNodes.forEach(bt=>{$.add(bt);let zt=this.driver.query(bt,v7,!0);for(let Ht=0;Ht<zt.length;Ht++)$.add(zt[Ht])});let Q=this.bodyNode,me=Array.from(this.statesByElement.keys()),he=aN(me,this.collectedEnterElements),be=new Map,Ie=0;he.forEach((bt,zt)=>{let Ht=fN+Ie++;be.set(zt,Ht),bt.forEach(gn=>rs(gn,Ht))});let Qe=[],ze=new Set,nt=new Set;for(let bt=0;bt<this.collectedLeaveElements.length;bt++){let zt=this.collectedLeaveElements[bt],Ht=zt[Os];Ht&&Ht.setForRemoval&&(Qe.push(zt),ze.add(zt),Ht.hasAnimation?this.driver.query(zt,w7,!0).forEach(gn=>ze.add(gn)):nt.add(zt))}let ft=new Map,Ue=aN(me,Array.from(ze));Ue.forEach((bt,zt)=>{let Ht=wS+Ie++;ft.set(zt,Ht),bt.forEach(gn=>rs(gn,Ht))}),i.push(()=>{he.forEach((bt,zt)=>{let Ht=be.get(zt);bt.forEach(gn=>Jf(gn,Ht))}),Ue.forEach((bt,zt)=>{let Ht=ft.get(zt);bt.forEach(gn=>Jf(gn,Ht))}),Qe.forEach(bt=>{this.processLeaveNode(bt)})});let Nt=[],Yt=[];for(let bt=this._namespaceList.length-1;bt>=0;bt--)this._namespaceList[bt].drainQueuedTransitions(l).forEach(Ht=>{let gn=Ht.player,kt=Ht.element;if(Nt.push(gn),this.collectedEnterElements.length){let Sr=kt[Os];if(Sr&&Sr.setForMove){if(Sr.previousTriggersValues&&Sr.previousTriggersValues.has(Ht.triggerName)){let Fn=Sr.previousTriggersValues.get(Ht.triggerName),ii=this.statesByElement.get(Ht.element);if(ii&&ii.has(Ht.triggerName)){let is=ii.get(Ht.triggerName);is.value=Fn,ii.set(Ht.triggerName,is)}}gn.destroy();return}}let ri=!Q||!this.driver.containsElement(Q,kt),Qn=ft.get(kt),Gi=be.get(kt),lr=this._buildInstruction(Ht,u,Gi,Qn,ri);if(lr.errors&&lr.errors.length){Yt.push(lr);return}if(ri){gn.onStart(()=>kh(kt,lr.fromStyles)),gn.onDestroy(()=>ba(kt,lr.toStyles)),m.push(gn);return}if(Ht.isFallbackTransition){gn.onStart(()=>kh(kt,lr.fromStyles)),gn.onDestroy(()=>ba(kt,lr.toStyles)),m.push(gn);return}let wa=[];lr.timelines.forEach(Sr=>{Sr.stretchStartingKeyframe=!0,this.disabledNodes.has(Sr.element)||wa.push(Sr)}),lr.timelines=wa,u.append(kt,lr.timelines);let Pt={instruction:lr,player:gn,element:kt};w.push(Pt),lr.queriedElements.forEach(Sr=>Lo(I,Sr,[]).push(gn)),lr.preStyleProps.forEach((Sr,Fn)=>{if(Sr.size){let ii=A.get(Fn);ii||A.set(Fn,ii=new Set),Sr.forEach((is,ks)=>ii.add(ks))}}),lr.postStyleProps.forEach((Sr,Fn)=>{let ii=L.get(Fn);ii||L.set(Fn,ii=new Set),Sr.forEach((is,ks)=>ii.add(ks))})});if(Yt.length){let bt=[];Yt.forEach(zt=>{bt.push(j9(zt.triggerName,zt.errors))}),Nt.forEach(zt=>zt.destroy()),this.reportError(bt)}let Jt=new Map,wt=new Map;w.forEach(bt=>{let zt=bt.element;u.has(zt)&&(wt.set(zt,zt),this._beforeAnimationBuild(bt.player.namespaceId,bt.instruction,Jt))}),m.forEach(bt=>{let zt=bt.element;this._getPreviousPlayers(zt,!1,bt.namespaceId,bt.triggerName,null).forEach(gn=>{Lo(Jt,zt,[]).push(gn),gn.destroy()})});let er=Qe.filter(bt=>lN(bt,A,L)),St=new Map;sN(St,this.driver,nt,L,xa).forEach(bt=>{lN(bt,A,L)&&er.push(bt)});let yr=new Map;he.forEach((bt,zt)=>{sN(yr,this.driver,new Set(bt),A,Hx)}),er.forEach(bt=>{let zt=St.get(bt),Ht=yr.get(bt);St.set(bt,new Map([...zt?.entries()??[],...Ht?.entries()??[]]))});let kr=[],xn=[],Fo={};w.forEach(bt=>{let{element:zt,player:Ht,instruction:gn}=bt;if(u.has(zt)){if($.has(zt)){Ht.onDestroy(()=>ba(zt,gn.toStyles)),Ht.disabled=!0,Ht.overrideTotalTime(gn.totalTime),m.push(Ht);return}let kt=Fo;if(wt.size>1){let Qn=zt,Gi=[];for(;Qn=Qn.parentNode;){let lr=wt.get(Qn);if(lr){kt=lr;break}Gi.push(Qn)}Gi.forEach(lr=>wt.set(lr,kt))}let ri=this._buildAnimation(Ht.namespaceId,gn,Jt,r,yr,St);if(Ht.setRealPlayer(ri),kt===Fo)kr.push(Ht);else{let Qn=this.playersByElement.get(kt);Qn&&Qn.length&&(Ht.parentPlayer=Gc(Qn)),m.push(Ht)}}else kh(zt,gn.fromStyles),Ht.onDestroy(()=>ba(zt,gn.toStyles)),xn.push(Ht),$.has(zt)&&m.push(Ht)}),xn.forEach(bt=>{let zt=r.get(bt.element);if(zt&&zt.length){let Ht=Gc(zt);bt.setRealPlayer(Ht)}}),m.forEach(bt=>{bt.parentPlayer?bt.syncPlayerEvents(bt.parentPlayer):bt.destroy()});for(let bt=0;bt<Qe.length;bt++){let zt=Qe[bt],Ht=zt[Os];if(Jf(zt,wS),Ht&&Ht.hasAnimation)continue;let gn=[];if(I.size){let ri=I.get(zt);ri&&ri.length&&gn.push(...ri);let Qn=this.driver.query(zt,ES,!0);for(let Gi=0;Gi<Qn.length;Gi++){let lr=I.get(Qn[Gi]);lr&&lr.length&&gn.push(...lr)}}let kt=gn.filter(ri=>!ri.destroyed);kt.length?D7(this,zt,kt):this.processLeaveNode(zt)}return Qe.length=0,kr.forEach(bt=>{this.players.push(bt),bt.onDone(()=>{bt.destroy();let zt=this.players.indexOf(bt);this.players.splice(zt,1)}),bt.play()}),kr}afterFlush(i){this._flushFns.push(i)}afterFlushAnimationsDone(i){this._whenQuietFns.push(i)}_getPreviousPlayers(i,l,u,m,r){let w=[];if(l){let I=this.playersByQueriedElement.get(i);I&&(w=I)}else{let I=this.playersByElement.get(i);if(I){let A=!r||r==g_;I.forEach(L=>{L.queued||!A&&L.triggerName!=m||w.push(L)})}}return(u||m)&&(w=w.filter(I=>!(u&&u!=I.namespaceId||m&&m!=I.triggerName))),w}_beforeAnimationBuild(i,l,u){let m=l.triggerName,r=l.element,w=l.isRemovalTransition?void 0:i,I=l.isRemovalTransition?void 0:m;for(let A of l.timelines){let L=A.element,$=L!==r,Q=Lo(u,L,[]);this._getPreviousPlayers(L,$,w,I,l.toState).forEach(he=>{let be=he.getRealPlayer();be.beforeDestroy&&be.beforeDestroy(),he.destroy(),Q.push(he)})}kh(r,l.fromStyles)}_buildAnimation(i,l,u,m,r,w){let I=l.triggerName,A=l.element,L=[],$=new Set,Q=new Set,me=l.timelines.map(be=>{let Ie=be.element;$.add(Ie);let Qe=Ie[Os];if(Qe&&Qe.removedBeforeQueried)return new $c(be.duration,be.delay);let ze=Ie!==A,nt=M7((u.get(Ie)||E7).map(Jt=>Jt.getRealPlayer())).filter(Jt=>{let wt=Jt;return wt.element?wt.element===Ie:!1}),ft=r.get(Ie),Ue=w.get(Ie),Nt=cN(this._normalizer,be.keyframes,ft,Ue),Yt=this._buildPlayer(be,Nt,nt);if(be.subTimeline&&m&&Q.add(Ie),ze){let Jt=new x_(i,I,Ie);Jt.setRealPlayer(Yt),L.push(Jt)}return Yt});L.forEach(be=>{Lo(this.playersByQueriedElement,be.element,[]).push(be),be.onDone(()=>C7(this.playersByQueriedElement,be.element,be))}),$.forEach(be=>rs(be,QF));let he=Gc(me);return he.onDestroy(()=>{$.forEach(be=>Jf(be,QF)),ba(A,l.toStyles)}),Q.forEach(be=>{Lo(m,be,[]).push(he)}),he}_buildPlayer(i,l,u){return l.length>0?this.driver.animate(i.element,l,i.duration,i.delay,i.easing,u):new $c(i.duration,i.delay)}},x_=class{constructor(i,l,u){this.namespaceId=i,this.triggerName=l,this.element=u,this._player=new $c,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(i){this._containsRealPlayer||(this._player=i,this._queuedCallbacks.forEach((l,u)=>{l.forEach(m=>zS(i,u,void 0,m))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(i.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(i){this.totalTime=i}syncPlayerEvents(i){let l=this._player;l.triggerCallback&&i.onStart(()=>l.triggerCallback("start")),i.onDone(()=>this.finish()),i.onDestroy(()=>this.destroy())}_queueEvent(i,l){Lo(this._queuedCallbacks,i,[]).push(l)}onDone(i){this.queued&&this._queueEvent("done",i),this._player.onDone(i)}onStart(i){this.queued&&this._queueEvent("start",i),this._player.onStart(i)}onDestroy(i){this.queued&&this._queueEvent("destroy",i),this._player.onDestroy(i)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(i){this.queued||this._player.setPosition(i)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(i){let l=this._player;l.triggerCallback&&l.triggerCallback(i)}};function C7(o,i,l){let u=o.get(i);if(u){if(u.length){let m=u.indexOf(l);u.splice(m,1)}u.length==0&&o.delete(i)}return u}function S7(o){return o??null}function Xx(o){return o&&o.nodeType===1}function I7(o){return o=="start"||o=="done"}function oN(o,i){let l=o.style.display;return o.style.display=i??"none",l}function sN(o,i,l,u,m){let r=[];l.forEach(A=>r.push(oN(A)));let w=[];u.forEach((A,L)=>{let $=new Map;A.forEach(Q=>{let me=i.computeStyle(L,Q,m);$.set(Q,me),(!me||me.length==0)&&(L[Os]=T7,w.push(L))}),o.set(L,$)});let I=0;return l.forEach(A=>oN(A,r[I++])),w}function aN(o,i){let l=new Map;if(o.forEach(I=>l.set(I,[])),i.length==0)return l;let u=1,m=new Set(i),r=new Map;function w(I){if(!I)return u;let A=r.get(I);if(A)return A;let L=I.parentNode;return l.has(L)?A=L:m.has(L)?A=u:A=w(L),r.set(I,A),A}return i.forEach(I=>{let A=w(I);A!==u&&l.get(A).push(I)}),l}function rs(o,i){o.classList?.add(i)}function Jf(o,i){o.classList?.remove(i)}function D7(o,i,l){Gc(l).onDone(()=>o.processLeaveNode(i))}function M7(o){let i=[];return xN(o,i),i}function xN(o,i){for(let l=0;l<o.length;l++){let u=o[l];u instanceof p_?xN(u.players,i):i.push(u)}}function A7(o,i){let l=Object.keys(o),u=Object.keys(i);if(l.length!=u.length)return!1;for(let m=0;m<l.length;m++){let r=l[m];if(!i.hasOwnProperty(r)||o[r]!==i[r])return!1}return!0}function lN(o,i,l){let u=l.get(o);if(!u)return!1;let m=i.get(o);return m?u.forEach(r=>m.add(r)):i.set(o,u),l.delete(o),!0}var tp=class{constructor(i,l,u){this._driver=l,this._normalizer=u,this._triggerCache={},this.onRemovalComplete=(m,r)=>{},this._transitionEngine=new LS(i.body,l,u),this._timelineEngine=new OS(i.body,l,u),this._transitionEngine.onRemovalComplete=(m,r)=>this.onRemovalComplete(m,r)}registerTrigger(i,l,u,m,r){let w=i+"-"+m,I=this._triggerCache[w];if(!I){let A=[],L=[],$=gN(this._driver,r,A,L);if(A.length)throw A9(m,A);L.length&&void 0,I=g7(m,$,this._normalizer),this._triggerCache[w]=I}this._transitionEngine.registerTrigger(l,m,I)}register(i,l){this._transitionEngine.register(i,l)}destroy(i,l){this._transitionEngine.destroy(i,l)}onInsert(i,l,u,m){this._transitionEngine.insertNode(i,l,u,m)}onRemove(i,l,u){this._transitionEngine.removeNode(i,l,u)}disableAnimations(i,l){this._transitionEngine.markElementAsDisabled(i,l)}process(i,l,u,m){if(u.charAt(0)=="@"){let[r,w]=YF(u),I=m;this._timelineEngine.command(r,l,w,I)}else this._transitionEngine.trigger(i,l,u,m)}listen(i,l,u,m,r){if(u.charAt(0)=="@"){let[w,I]=YF(u);return this._timelineEngine.listen(w,l,I,r)}return this._transitionEngine.listen(i,l,u,m,r)}flush(i=-1){this._transitionEngine.flush(i)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(i){this._transitionEngine.afterFlushAnimationsDone(i)}};function P7(o,i){let l=null,u=null;return Array.isArray(i)&&i.length?(l=bS(i[0]),i.length>1&&(u=bS(i[i.length-1]))):i instanceof Map&&(l=bS(i)),l||u?new FS(o,l,u):null}var ep=class ep{constructor(i,l,u){this._element=i,this._startStyles=l,this._endStyles=u,this._state=0;let m=ep.initialStylesByElement.get(i);m||ep.initialStylesByElement.set(i,m=new Map),this._initialStyles=m}start(){this._state<1&&(this._startStyles&&ba(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ba(this._element,this._initialStyles),this._endStyles&&(ba(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(ep.initialStylesByElement.delete(this._element),this._startStyles&&(kh(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(kh(this._element,this._endStyles),this._endStyles=null),ba(this._element,this._initialStyles),this._state=3)}};ep.initialStylesByElement=new WeakMap;var FS=ep;function bS(o){let i=null;return o.forEach((l,u)=>{R7(u)&&(i=i||new Map,i.set(u,l))}),i}function R7(o){return o==="display"||o==="position"}var i1=class{constructor(i,l,u,m){this.element=i,this.keyframes=l,this.options=u,this._specialStyles=m,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=u.duration,this._delay=u.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let i=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,i,this.options),this._finalKeyframe=i.length?i[i.length-1]:new Map;let l=()=>this._onFinish();this.domPlayer.addEventListener("finish",l),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",l)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(i){let l=[];return i.forEach(u=>{l.push(Object.fromEntries(u))}),l}_triggerWebAnimation(i,l,u){return i.animate(this._convertKeyframesToObject(l),u)}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(i=>i()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}setPosition(i){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=i*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let i=new Map;this.hasStarted()&&this._finalKeyframe.forEach((u,m)=>{m!=="offset"&&i.set(m,this._finished?u:$S(this.element,m))}),this.currentSnapshot=i}triggerCallback(i){let l=i==="start"?this._onStartFns:this._onDoneFns;l.forEach(u=>u()),l.length=0}},o1=class{validateStyleProperty(i){return!0}validateAnimatableStyleProperty(i){return!0}containsElement(i,l){return uN(i,l)}getParentElement(i){return VS(i)}query(i,l,u){return hN(i,l,u)}computeStyle(i,l,u){return $S(i,l)}animate(i,l,u,m,r,w=[]){let I=m==0?"both":"forwards",A={duration:u,delay:m,fill:I};r&&(A.easing=r);let L=new Map,$=w.filter(he=>he instanceof i1);Q9(u,m)&&$.forEach(he=>{he.currentSnapshot.forEach((be,Ie)=>L.set(Ie,be))});let Q=X9(l).map(he=>new Map(he));Q=J9(i,Q,L);let me=P7(i,Q);return new i1(i,Q,A,me)}};var Yx="@",bN="@.disabled",s1=class{constructor(i,l,u,m){this.namespaceId=i,this.delegate=l,this.engine=u,this._onDestroy=m,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(i){this.delegate.destroyNode?.(i)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(i,l){return this.delegate.createElement(i,l)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}appendChild(i,l){this.delegate.appendChild(i,l),this.engine.onInsert(this.namespaceId,l,i,!1)}insertBefore(i,l,u,m=!0){this.delegate.insertBefore(i,l,u),this.engine.onInsert(this.namespaceId,l,i,m)}removeChild(i,l,u){this.engine.onRemove(this.namespaceId,l,this.delegate)}selectRootElement(i,l){return this.delegate.selectRootElement(i,l)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,l,u,m){this.delegate.setAttribute(i,l,u,m)}removeAttribute(i,l,u){this.delegate.removeAttribute(i,l,u)}addClass(i,l){this.delegate.addClass(i,l)}removeClass(i,l){this.delegate.removeClass(i,l)}setStyle(i,l,u,m){this.delegate.setStyle(i,l,u,m)}removeStyle(i,l,u){this.delegate.removeStyle(i,l,u)}setProperty(i,l,u){l.charAt(0)==Yx&&l==bN?this.disableAnimations(i,!!u):this.delegate.setProperty(i,l,u)}setValue(i,l){this.delegate.setValue(i,l)}listen(i,l,u){return this.delegate.listen(i,l,u)}disableAnimations(i,l){this.engine.disableAnimations(i,l)}},NS=class extends s1{constructor(i,l,u,m,r){super(l,u,m,r),this.factory=i,this.namespaceId=l}setProperty(i,l,u){l.charAt(0)==Yx?l.charAt(1)=="."&&l==bN?(u=u===void 0?!0:!!u,this.disableAnimations(i,u)):this.engine.process(this.namespaceId,i,l.slice(1),u):this.delegate.setProperty(i,l,u)}listen(i,l,u){if(l.charAt(0)==Yx){let m=O7(i),r=l.slice(1),w="";return r.charAt(0)!=Yx&&([r,w]=k7(r)),this.engine.listen(this.namespaceId,m,r,w,I=>{let A=I._data||-1;this.factory.scheduleListenerCallback(A,u,I)})}return this.delegate.listen(i,l,u)}};function O7(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}function k7(o){let i=o.indexOf("."),l=o.substring(0,i),u=o.slice(i+1);return[l,u]}var a1=class{constructor(i,l,u){this.delegate=i,this.engine=l,this._zone=u,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,l.onRemovalComplete=(m,r)=>{let w=r?.parentNode(m);w&&r.removeChild(w,m)}}createRenderer(i,l){let u="",m=this.delegate.createRenderer(i,l);if(!i||!l?.data?.animation){let L=this._rendererCache,$=L.get(m);if(!$){let Q=()=>L.delete(m);$=new s1(u,m,this.engine,Q),L.set(m,$)}return $}let r=l.id,w=l.id+"-"+this._currentId;this._currentId++,this.engine.register(w,i);let I=L=>{Array.isArray(L)?L.forEach(I):this.engine.registerTrigger(r,w,i,L.name,L)};return l.data.animation.forEach(I),new NS(this,w,m,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,l,u){if(i>=0&&i<this._microtaskId){this._zone.run(()=>l(u));return}let m=this._animationCallbacksBuffer;m.length==0&&queueMicrotask(()=>{this._zone.run(()=>{m.forEach(r=>{let[w,I]=r;w(I)}),this._animationCallbacksBuffer=[]})}),m.push([l,u])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var F7=(()=>{let i=class i extends tp{constructor(u,m,r){super(u,m,r,Tt(bf,{optional:!0}))}ngOnDestroy(){this.flush()}};i.\u0275fac=function(m){return new(m||i)(dn(Zr),dn(Lh),dn(Fh))},i.\u0275prov=Gt({token:i,factory:i.\u0275fac});let o=i;return o})();function N7(){return new Jx}function z7(o,i,l){return new a1(o,i,l)}var wN=[{provide:Fh,useFactory:N7},{provide:tp,useClass:F7},{provide:uh,useFactory:z7,deps:[Zv,tp,Dr]}],B7=[{provide:Lh,useFactory:()=>new o1},{provide:yT,useValue:"BrowserAnimations"},...wN],tue=[{provide:Lh,useClass:jS},{provide:yT,useValue:"NoopAnimations"},...wN];function EN(){return Df("NgEagerAnimations"),[...B7]}var TN={providers:[yk($F,xk(),bk()),GF(),EN(),XT()]};function CN(o){return typeof o=="string"}function SN(o){return typeof o=="number"&&Number(o)==o}function c1(o,i=0,l="0"){return typeof o!="string"&&(o=o.toString()),i>o.length?Array(i-o.length+1).join(l)+o:o}function qS(o){let i,l,u,m=o.h,r=o.s,w=o.l;if(r==0)i=l=u=w;else{let I=function(Q,me,he){return he<0&&(he+=1),he>1&&(he-=1),he<.16666666666666666?Q+(me-Q)*6*he:he<.5?me:he<.6666666666666666?Q+(me-Q)*(.6666666666666666-he)*6:Q},A=w<.5?w*(1+r):w+r-w*r,L=2*w-A;i=I(L,A,m+1/3),l=I(L,A,m),u=I(L,A,m-1/3)}return{r:Math.round(i*255),g:Math.round(l*255),b:Math.round(u*255)}}function WS(o){let i=o.r/255,l=o.g/255,u=o.b/255,m=Math.max(i,l,u),r=Math.min(i,l,u),w=0,I=0,A=(m+r)/2;if(m===r)w=I=0;else{let L=m-r;switch(I=A>.5?L/(2-m-r):L/(m+r),m){case i:w=(l-u)/L+(l<u?6:0);break;case l:w=(u-i)/L+2;break;case u:w=(i-l)/L+4;break}w/=6}return{h:w,s:I,l:A}}function DN(o,i){return o&&{r:Math.max(0,Math.min(255,o.r+l1(o.r,i))),g:Math.max(0,Math.min(255,o.g+l1(o.g,i))),b:Math.max(0,Math.min(255,o.b+l1(o.b,i))),a:o.a}}function l1(o,i){let l=i>0?255-o:o;return Math.round(l*i)}function MN(o,i){if(o){let l=Math.min(Math.max(o.r,o.g,o.b),230),u=l1(l,i);return{r:Math.max(0,Math.min(255,Math.round(o.r+u))),g:Math.max(0,Math.min(255,Math.round(o.g+u))),b:Math.max(0,Math.min(255,Math.round(o.b+u))),a:o.a}}else return o}function IN(o){return(o.r*299+o.g*587+o.b*114)/1e3>=128}function AN(o,i){if(o===void 0||i==1)return o;let l=WS(o);return l.s=i,qS(l)}function PN(o,i={r:255,g:255,b:255},l={r:255,g:255,b:255}){let u=i,m=l;return IN(l)&&(u=l,m=i),IN(o)?m:u}function RN(o){return o[0]==="#"&&(o=o.substr(1)),o.length==3&&(o=o[0].repeat(2)+o[1].repeat(2)+o[2].repeat(2)),parseInt(o,16)}function $7(o){o=o.replace(/[ ]/g,"");let i=o.match(/^rgb\(([0-9]*),([0-9]*),([0-9]*)\)/i);if(i)i.push("1");else if(i=o.match(/^rgba\(([0-9]*),([0-9]*),([0-9]*),([.0-9]*)\)/i),!i)return 0;let l="";for(let u=1;u<=3;u++){let m=parseInt(i[u]).toString(16);m.length==1&&(m="0"+m),l+=m}return RN(l)}function np(o){return b_.fromAny(o)}var b_=class o{constructor(i){Object.defineProperty(this,"_hex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hex=i|0}get hex(){return this._hex}get r(){return this._hex>>>16}get g(){return this._hex>>8&255}get b(){return this._hex&255}toCSS(i=1){return"rgba("+this.r+", "+this.g+", "+this.b+", "+i+")"}toCSSHex(){return"#"+c1(this.r.toString(16),2)+c1(this.g.toString(16),2)+c1(this.b.toString(16),2)}toHSL(i=1){return WS({r:this.r,g:this.g,b:this.b,a:i})}static fromHSL(i,l,u){let m=qS({h:i,s:l,l:u});return this.fromRGB(m.r,m.g,m.b)}toString(){return this.toCSSHex()}static fromHex(i){return new o(i)}static fromRGB(i,l,u){return new o((u|0)+(l<<8)+(i<<16))}static fromString(i){return new o(RN(i))}static fromCSS(i){return new o($7(i))}static fromAny(i){if(CN(i)){if(i[0]=="#")return o.fromString(i);if(i.substr(0,3)=="rgb")return o.fromCSS(i)}else{if(SN(i))return o.fromHex(i);if(i instanceof o)return o.fromHex(i.hex)}throw new Error("Unknown color syntax: "+i)}static alternative(i,l,u){let m=PN({r:i.r,g:i.g,b:i.b},l?{r:l.r,g:l.g,b:l.b}:void 0,u?{r:u.r,g:u.g,b:u.b}:void 0);return this.fromRGB(m.r,m.g,m.b)}static interpolate(i,l,u,m="rgb"){if(m=="hsl"){let r=l.toHSL(),w=u.toHSL();return o.fromHSL(Nh(i,r.h,w.h),Nh(i,r.s,w.s),Nh(i,r.l,w.l))}else return o.fromRGB(Nh(i,l.r,u.r),Nh(i,l.g,u.g),Nh(i,l.b,u.b))}static lighten(i,l){let u=DN({r:i.r,g:i.g,b:i.b},l);return o.fromRGB(u.r,u.g,u.b)}static brighten(i,l){let u=MN({r:i.r,g:i.g,b:i.b},l);return o.fromRGB(u.r,u.g,u.b)}static saturate(i,l){let u=AN({r:i.r,g:i.g,b:i.b},l);return o.fromRGB(u.r,u.g,u.b)}};function Nh(o,i,l){return i+o*(l-i)}var Sue=[{name:"Root",children:[{name:"Sed et nulla a enim tincidunt gravida",shortName:"Gravida",color:np(8824281),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:80},{name:"Third",value:100},{name:"New",value:50,action:"add",color:np(13688048),radius:35}]},{name:"Fusce ut nisi eu nibh laoreet scelerisque",shortName:"Fusce ut nisi",color:np(8285892),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:25},{name:"Third",value:100},{name:"New",value:50,action:"add",color:np(14210285),radius:35}]}]}];var ON=Ew($x());var kN=Ew($x());var LN=HF("slideInAnimation",[ZF("* <=> *",[Gx(":enter, :leave",hl({position:"fixed",width:"100%",zIndex:2}),{optional:!0}),qF([Gx(":enter",[hl({transform:"translateX(100%)"}),mS("0.5s ease-out",hl({transform:"translateX(0%)"}))],{optional:!0}),Gx(":leave",[hl({transform:"translateX(0%)"}),mS("0.5s ease-out",hl({transform:"translateX(-100%)"}))],{optional:!0})])])]);var FN=o=>({"background-color":o}),NN=(()=>{let i=class i{constructor(u){this.router=u,this.setBackgroundColorForPath()}navigate(u){this.router.navigateByUrl(u).then(()=>this.setBackgroundColorForPath())}setBackgroundColorForPath(){this.isMapView=window.location.pathname.includes("map"),this.isBubbleView=window.location.pathname.includes("bubbles")}};i.\u0275fac=function(m){return new(m||i)(_r(dx))},i.\u0275cmp=gi({type:i,selectors:[["app-view-control-bar"]],standalone:!0,features:[_i],decls:5,vars:6,consts:[[1,"content-container"],[1,"item-container",3,"click","ngStyle"],["src","../../../assets/menu-map.svg",1,"menu-item"],["src","../../../assets/bubble-menu-item.svg",1,"menu-item"]],template:function(m,r){m&1&&(jn(0,"div",0)(1,"div",1),qr("click",function(){return r.navigate("/map")}),Cr(2,"img",2),Un(),jn(3,"div",1),qr("click",function(){return r.navigate("/bubbles")}),Cr(4,"img",3),Un()()),m&2&&(Hr(),mo("ngStyle",gg(2,FN,r.isMapView?"lightgray":"white")),Hr(2),mo("ngStyle",gg(4,FN,r.isBubbleView?"lightgray":"white")))},dependencies:[Yi,Bv],styles:[".content-container[_ngcontent-%COMP%]{position:absolute;z-index:200;bottom:5%;left:32px;display:flex;justify-content:space-evenly;align-items:center;flex-direction:column;width:48px;height:96px;background-color:#fff;border-radius:8px;border:1px lightgray solid}.content-container[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:32px;width:32px;border-radius:8px;transition:background-color .5s linear;cursor:pointer}.content-container[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]{width:24px;height:24px}"]});let o=i;return o})();var zN=(()=>{let i=class i{constructor(u){this.mapService=u}handleZoomChange(u){this.mapService.updateZoom(u)}handlePitchChange(u){this.mapService.updatePitch(u)}};i.\u0275fac=function(m){return new(m||i)(_r(va))},i.\u0275cmp=gi({type:i,selectors:[["app-map-control-bar"]],standalone:!0,features:[_i],decls:7,vars:0,consts:[[1,"content-container"],[1,"item-container",3,"click"],["src","../../../assets/map-devices-control.svg",1,"menu-item"],["src","../../../assets/map-location-control.svg",1,"menu-item"],["src","../../../assets/map-2d-control.svg",1,"menu-item"]],template:function(m,r){m&1&&(jn(0,"div",0)(1,"div",1),qr("click",function(){return r.handleZoomChange(1)}),Cr(2,"img",2),Un(),jn(3,"div",1),qr("click",function(){return r.handleZoomChange(-1)}),Cr(4,"img",3),Un(),jn(5,"div",1),qr("click",function(){return r.handlePitchChange(0)}),Cr(6,"img",4),Un()())},styles:[".content-container[_ngcontent-%COMP%]{position:absolute;z-index:200;bottom:20%;left:32px;display:flex;justify-content:space-evenly;align-items:center;flex-direction:column;width:48px;height:144px;background-color:#fff;border-radius:8px;border:1px lightgray solid}.content-container[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;justify-content:center;height:32px;width:32px}"]});let o=i;return o})();var BN=(()=>{let i=class i{constructor(u,m,r){this.contexts=u,this.document=m,this.mapService=r,this.openedSidebar=!1,this.title="GraphVizualization"}toggleSideBar(u){u?this.openedSidebar=!u:this.openedSidebar=!this.openedSidebar;let m=this.document.getElementById("arrow"),r=this.document.getElementById("main");this.openedSidebar?this.openSideBar(r,m):this.closeSideBar(r,m)}openSideBar(u,m){let r=this.mapService.map.getCenter(),w=this.mapService.map.getZoom();this.setOpenStyles(window.innerWidth,u,m),m.style.transform="rotate(0deg)",this.mapService.map.easeTo({center:r,zoom:w+.3,duration:1e3,linear:!0})}closeSideBar(u,m){let r=this.mapService.map.getCenter(),w=this.mapService.map.getZoom();u.style.marginLeft="0px",u.style.width="100%",m.style.right="30px",m.style.transform="rotate(180deg)",this.mapService.map.easeTo({center:r,zoom:w-.3,duration:1e3,linear:!0})}setOpenStyles(u,m,r){u>480?(m.style.marginLeft="-20%",m.style.width="80%",r.style.right="40%"):r.style.right="70%"}};i.\u0275fac=function(m){return new(m||i)(_r($f),_r(Zr),_r(va))},i.\u0275cmp=gi({type:i,selectors:[["app-root"]],standalone:!0,features:[_i],decls:5,vars:1,consts:[["src","../assets/arrow-close.svg","id","arrow",3,"click"],["id","main",2,"height","100%","width","100%","overflow","hidden","position","absolute","top","0","left","0"]],template:function(m,r){m&1&&(jn(0,"img",0),qr("click",function(){return r.toggleSideBar()}),Un(),Cr(1,"app-map-control-bar")(2,"app-view-control-bar"),jn(3,"div",1),Cr(4,"router-outlet"),Un()),m&2&&(Hr(3),mo("@slideInAnimation",void 0))},dependencies:[Yi,NC,NN,zN],styles:["[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}#main[_ngcontent-%COMP%]{transition:all 1s}#arrow[_ngcontent-%COMP%]{position:fixed;right:30px;top:45%;transform:rotate(180deg);transition:all 1s;z-index:150}.opened[_ngcontent-%COMP%]{position:fixed;top:0;right:0;z-index:200;height:100vh;width:40%;transition:all 1s;resize:horizontal}.closed[_ngcontent-%COMP%]{position:fixed;top:0;right:0vw;z-index:-1;height:100vh;width:0%;transition:all 1s}@media (max-width: 480px){.opened[_ngcontent-%COMP%]{position:fixed;top:0;right:0;z-index:200;height:100vh;width:70%;overflow-y:auto;transition:all 1s}}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:#5484d1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#2651a0;cursor:grab}"],data:{animation:[LN]}});let o=i;return o})();kO(BN,TN).catch(o=>console.error(o));
