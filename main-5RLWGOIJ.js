var o4=Object.create;var vE=Object.defineProperty,s4=Object.defineProperties,a4=Object.getOwnPropertyDescriptor,l4=Object.getOwnPropertyDescriptors,c4=Object.getOwnPropertyNames,rv=Object.getOwnPropertySymbols,u4=Object.getPrototypeOf,xE=Object.prototype.hasOwnProperty,V2=Object.prototype.propertyIsEnumerable;var B2=(o,n,l)=>n in o?vE(o,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[n]=l,gt=(o,n)=>{for(var l in n||={})xE.call(n,l)&&B2(o,l,n[l]);if(rv)for(var l of rv(n))V2.call(n,l)&&B2(o,l,n[l]);return o},hi=(o,n)=>s4(o,l4(n));var as=(o,n)=>{var l={};for(var c in o)xE.call(o,c)&&n.indexOf(c)<0&&(l[c]=o[c]);if(o!=null&&rv)for(var c of rv(o))n.indexOf(c)<0&&V2.call(o,c)&&(l[c]=o[c]);return l};var h4=(o,n)=>()=>(n||o((n={exports:{}}).exports,n),n.exports);var d4=(o,n,l,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let f of c4(n))!xE.call(o,f)&&f!==l&&vE(o,f,{get:()=>n[f],enumerable:!(c=a4(n,f))||c.enumerable});return o};var bE=(o,n,l)=>(l=o!=null?o4(u4(o)):{},d4(n||!o||!o.__esModule?vE(l,"default",{value:o,enumerable:!0}):l,o));var Tg=(o,n,l)=>new Promise((c,f)=>{var r=A=>{try{I(l.next(A))}catch(L){f(L)}},w=A=>{try{I(l.throw(A))}catch(L){f(L)}},I=A=>A.done?c(A.value):Promise.resolve(A.value).then(r,w);I((l=l.apply(o,n)).next())});var Vb=h4((gD,_D)=>{"use strict";(function(o,n){typeof gD=="object"&&typeof _D<"u"?_D.exports=n():typeof define=="function"&&define.amd?define(n):(o=typeof globalThis<"u"?globalThis:o||self,o.mapboxgl=n())})(gD,function(){"use strict";var o,n,l;function c(r,w){if(!o)o=w;else if(!n)n=w;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",A={};o(A),l=w(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}c(["exports"],function(r){var w="3.5.0";let I,A={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(I==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{I=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{I=t}}return I},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!A.API_URL)return null;try{let t=new URL(A.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function L(t){return A.API_URL_REGEX.test(t)}function U(t){return t.indexOf("mapbox:")===0}function Q(t){return A.API_CDN_URL_REGEX.test(t)}function fe(t){return A.API_SPRITE_REGEX.test(t)}function he(t){return A.API_STYLE_REGEX.test(t)&&!fe(t)}let be={create:"create",load:"load",fullLoad:"fullLoad"},De={mark(t){performance.mark(t)},measure(t,e,i){performance.measure(t,e,i)}};function Ke(t){let e=t.name.split("?")[0];return Q(e)&&e.includes("mapbox-gl.js")?"javascript":Q(e)&&e.includes("mapbox-gl.css")?"css":function(i){return A.API_FONTS_REGEX.test(i)}(e)?"fontRange":fe(e)?"sprite":he(e)?"style":function(i){return A.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function Fe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var tt={},ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.setMatrixArrayType=function(t){ft.ARRAY_TYPE=Vt=t},ft.toRadian=function(t){return t*nn},ft.equals=function(t,e){return Math.abs(t-e)<=Ue*Math.max(1,Math.abs(t),Math.abs(e))},ft.RANDOM=ft.ARRAY_TYPE=ft.EPSILON=void 0;var Ue=1e-6;ft.EPSILON=Ue;var Vt=typeof Float32Array<"u"?Float32Array:Array;ft.ARRAY_TYPE=Vt;var Jt=Math.random;ft.RANDOM=Jt;var nn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Et={};function oi(t){return oi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oi(t)}Object.defineProperty(Et,"__esModule",{value:!0}),Et.create=function(){var t=new It.ARRAY_TYPE(4);return It.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Et.clone=function(t){var e=new It.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Et.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Et.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Et.fromValues=function(t,e,i,a){var u=new It.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=i,u[3]=a,u},Et.set=function(t,e,i,a,u){return t[0]=e,t[1]=i,t[2]=a,t[3]=u,t},Et.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Et.invert=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=i*d-u*a;return p?(t[0]=d*(p=1/p),t[1]=-a*p,t[2]=-u*p,t[3]=i*p,t):null},Et.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Et.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Et.multiply=Di,Et.rotate=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=a*y+d*_,t[1]=u*y+p*_,t[2]=a*-_+d*y,t[3]=u*-_+p*y,t},Et.scale=function(t,e,i){var a=e[1],u=e[2],d=e[3],p=i[0],_=i[1];return t[0]=e[0]*p,t[1]=a*p,t[2]=u*_,t[3]=d*_,t},Et.fromRotation=function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=i,t[2]=-i,t[3]=a,t},Et.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Et.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Et.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Et.LDU=function(t,e,i,a){return t[2]=a[2]/a[0],i[0]=a[0],i[1]=a[1],i[3]=a[3]-t[2]*i[1],[t,e,i]},Et.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Et.subtract=Ui,Et.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Et.equals=function(t,e){var i=t[0],a=t[1],u=t[2],d=t[3],p=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(i-p)<=It.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-_)<=It.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-y)<=It.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-b)<=It.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Et.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Et.multiplyScalarAndAdd=function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t[2]=e[2]+i[2]*a,t[3]=e[3]+i[3]*a,t},Et.sub=Et.mul=void 0;var It=function(t,e){if(t&&t.__esModule)return t;if(t===null||oi(t)!=="object"&&typeof t!="function")return{default:t};var i=Ei(void 0);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}(ft);function Ei(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Ei=function(a){return a?i:e})(t)}function Di(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=i[0],y=i[1],b=i[2],T=i[3];return t[0]=a*_+d*y,t[1]=u*_+p*y,t[2]=a*b+d*T,t[3]=u*b+p*T,t}function Ui(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Et.mul=Di,Et.sub=Ui;var wn={};function qo(t){return qo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qo(t)}Object.defineProperty(wn,"__esModule",{value:!0}),wn.create=function(){var t=new wt.ARRAY_TYPE(6);return wt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},wn.clone=function(t){var e=new wt.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},wn.fromValues=function(t,e,i,a,u,d){var p=new wt.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=i,p[3]=a,p[4]=u,p[5]=d,p},wn.set=function(t,e,i,a,u,d,p){return t[0]=e,t[1]=i,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t},wn.invert=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=i*d-a*u;return y?(t[0]=d*(y=1/y),t[1]=-a*y,t[2]=-u*y,t[3]=i*y,t[4]=(u*_-d*p)*y,t[5]=(a*p-i*_)*y,t):null},wn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},wn.multiply=Zt,wn.rotate=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=Math.sin(i),T=Math.cos(i);return t[0]=a*T+d*b,t[1]=u*T+p*b,t[2]=a*-b+d*T,t[3]=u*-b+p*T,t[4]=_,t[5]=y,t},wn.scale=function(t,e,i){var a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=i[0],b=i[1];return t[0]=e[0]*y,t[1]=a*y,t[2]=u*b,t[3]=d*b,t[4]=p,t[5]=_,t},wn.translate=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=i[0],T=i[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=a*b+d*T+_,t[5]=u*b+p*T+y,t},wn.fromRotation=function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=i,t[2]=-i,t[3]=a,t[4]=0,t[5]=0,t},wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},wn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},wn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},wn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},wn.subtract=vn,wn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},wn.multiplyScalarAndAdd=function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t[2]=e[2]+i[2]*a,t[3]=e[3]+i[3]*a,t[4]=e[4]+i[4]*a,t[5]=e[5]+i[5]*a,t},wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},wn.equals=function(t,e){var i=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=e[0],b=e[1],T=e[2],D=e[3],S=e[4],R=e[5];return Math.abs(i-y)<=wt.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(a-b)<=wt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(u-T)<=wt.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(d-D)<=wt.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(p-S)<=wt.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(_-R)<=wt.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},wn.sub=wn.mul=void 0;var wt=function(t,e){if(t&&t.__esModule)return t;if(t===null||qo(t)!=="object"&&typeof t!="function")return{default:t};var i=jt(void 0);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}(ft);function jt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(jt=function(a){return a?i:e})(t)}function Zt(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=i[0],T=i[1],D=i[2],S=i[3],R=i[4],k=i[5];return t[0]=a*b+d*T,t[1]=u*b+p*T,t[2]=a*D+d*S,t[3]=u*D+p*S,t[4]=a*R+d*k+_,t[5]=u*R+p*k+y,t}function vn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}wn.mul=Zt,wn.sub=vn;var Nt={};function hr(t){return hr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hr(t)}Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.create=function(){var t=new ni.ARRAY_TYPE(9);return ni.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Nt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Nt.clone=function(t){var e=new ni.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Nt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Nt.fromValues=function(t,e,i,a,u,d,p,_,y){var b=new ni.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=i,b[3]=a,b[4]=u,b[5]=d,b[6]=p,b[7]=_,b[8]=y,b},Nt.set=function(t,e,i,a,u,d,p,_,y,b){return t[0]=e,t[1]=i,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=b,t},Nt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Nt.transpose=function(t,e){if(t===e){var i=e[1],a=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=a,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Nt.invert=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=T*p-_*b,S=-T*d+_*y,R=b*d-p*y,k=i*D+a*S+u*R;return k?(t[0]=D*(k=1/k),t[1]=(-T*a+u*b)*k,t[2]=(_*a-u*p)*k,t[3]=S*k,t[4]=(T*i-u*y)*k,t[5]=(-_*i+u*d)*k,t[6]=R*k,t[7]=(-b*i+a*y)*k,t[8]=(p*i-a*d)*k,t):null},Nt.adjoint=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8];return t[0]=p*T-_*b,t[1]=u*b-a*T,t[2]=a*_-u*p,t[3]=_*y-d*T,t[4]=i*T-u*y,t[5]=u*d-i*_,t[6]=d*b-p*y,t[7]=a*y-i*b,t[8]=i*p-a*d,t},Nt.determinant=function(t){var e=t[3],i=t[4],a=t[5],u=t[6],d=t[7],p=t[8];return t[0]*(p*i-a*d)+t[1]*(-p*e+a*u)+t[2]*(d*e-i*u)},Nt.multiply=gi,Nt.translate=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=i[0],R=i[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=S*a+R*p+b,t[7]=S*u+R*_+T,t[8]=S*d+R*y+D,t},Nt.rotate=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=Math.sin(i),R=Math.cos(i);return t[0]=R*a+S*p,t[1]=R*u+S*_,t[2]=R*d+S*y,t[3]=R*p-S*a,t[4]=R*_-S*u,t[5]=R*y-S*d,t[6]=b,t[7]=T,t[8]=D,t},Nt.scale=function(t,e,i){var a=i[0],u=i[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Nt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Nt.fromRotation=function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=i,t[2]=0,t[3]=-i,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Nt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Nt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Nt.fromQuat=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=i+i,_=a+a,y=u+u,b=i*p,T=a*p,D=a*_,S=u*p,R=u*_,k=u*y,F=d*p,z=d*_,j=d*y;return t[0]=1-D-k,t[3]=T-j,t[6]=S+z,t[1]=T+j,t[4]=1-b-k,t[7]=R-F,t[2]=S-z,t[5]=R+F,t[8]=1-b-D,t},Nt.normalFromMat4=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=e[9],S=e[10],R=e[11],k=e[12],F=e[13],z=e[14],j=e[15],Y=i*_-a*p,X=i*y-u*p,K=i*b-d*p,le=a*y-u*_,se=a*b-d*_,me=u*b-d*y,_e=T*F-D*k,Ee=T*z-S*k,ke=T*j-R*k,Se=D*z-S*F,ze=D*j-R*F,Ye=S*j-R*z,Le=Y*Ye-X*ze+K*Se+le*ke-se*Ee+me*_e;return Le?(t[0]=(_*Ye-y*ze+b*Se)*(Le=1/Le),t[1]=(y*ke-p*Ye-b*Ee)*Le,t[2]=(p*ze-_*ke+b*_e)*Le,t[3]=(u*ze-a*Ye-d*Se)*Le,t[4]=(i*Ye-u*ke+d*Ee)*Le,t[5]=(a*ke-i*ze-d*_e)*Le,t[6]=(F*me-z*se+j*le)*Le,t[7]=(z*K-k*me-j*X)*Le,t[8]=(k*se-F*K+j*Y)*Le,t):null},Nt.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Nt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Nt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Nt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},Nt.subtract=Oa,Nt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},Nt.multiplyScalarAndAdd=function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t[2]=e[2]+i[2]*a,t[3]=e[3]+i[3]*a,t[4]=e[4]+i[4]*a,t[5]=e[5]+i[5]*a,t[6]=e[6]+i[6]*a,t[7]=e[7]+i[7]*a,t[8]=e[8]+i[8]*a,t},Nt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Nt.equals=function(t,e){var i=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],T=t[8],D=e[0],S=e[1],R=e[2],k=e[3],F=e[4],z=e[5],j=e[6],Y=e[7],X=e[8];return Math.abs(i-D)<=ni.EPSILON*Math.max(1,Math.abs(i),Math.abs(D))&&Math.abs(a-S)<=ni.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(u-R)<=ni.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-k)<=ni.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(p-F)<=ni.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(_-z)<=ni.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(y-j)<=ni.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-Y)<=ni.EPSILON*Math.max(1,Math.abs(b),Math.abs(Y))&&Math.abs(T-X)<=ni.EPSILON*Math.max(1,Math.abs(T),Math.abs(X))},Nt.sub=Nt.mul=void 0;var ni=function(t,e){if(t&&t.__esModule)return t;if(t===null||hr(t)!=="object"&&typeof t!="function")return{default:t};var i=Jr(void 0);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}(ft);function Jr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Jr=function(a){return a?i:e})(t)}function gi(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=i[0],R=i[1],k=i[2],F=i[3],z=i[4],j=i[5],Y=i[6],X=i[7],K=i[8];return t[0]=S*a+R*p+k*b,t[1]=S*u+R*_+k*T,t[2]=S*d+R*y+k*D,t[3]=F*a+z*p+j*b,t[4]=F*u+z*_+j*T,t[5]=F*d+z*y+j*D,t[6]=Y*a+X*p+K*b,t[7]=Y*u+X*_+K*T,t[8]=Y*d+X*y+K*D,t}function Oa(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}Nt.mul=gi,Nt.sub=Oa;var Rt={};function Fi(t){return Fi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fi(t)}Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=function(){var t=new jn.ARRAY_TYPE(16);return jn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Rt.clone=function(t){var e=new jn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Rt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Rt.fromValues=function(t,e,i,a,u,d,p,_,y,b,T,D,S,R,k,F){var z=new jn.ARRAY_TYPE(16);return z[0]=t,z[1]=e,z[2]=i,z[3]=a,z[4]=u,z[5]=d,z[6]=p,z[7]=_,z[8]=y,z[9]=b,z[10]=T,z[11]=D,z[12]=S,z[13]=R,z[14]=k,z[15]=F,z},Rt.set=function(t,e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z){return t[0]=e,t[1]=i,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=b,t[9]=T,t[10]=D,t[11]=S,t[12]=R,t[13]=k,t[14]=F,t[15]=z,t},Rt.identity=ms,Rt.transpose=function(t,e){if(t===e){var i=e[1],a=e[2],u=e[3],d=e[6],p=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=d,t[11]=e[14],t[12]=u,t[13]=p,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Rt.invert=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=e[9],S=e[10],R=e[11],k=e[12],F=e[13],z=e[14],j=e[15],Y=i*_-a*p,X=i*y-u*p,K=i*b-d*p,le=a*y-u*_,se=a*b-d*_,me=u*b-d*y,_e=T*F-D*k,Ee=T*z-S*k,ke=T*j-R*k,Se=D*z-S*F,ze=D*j-R*F,Ye=S*j-R*z,Le=Y*Ye-X*ze+K*Se+le*ke-se*Ee+me*_e;return Le?(t[0]=(_*Ye-y*ze+b*Se)*(Le=1/Le),t[1]=(u*ze-a*Ye-d*Se)*Le,t[2]=(F*me-z*se+j*le)*Le,t[3]=(S*se-D*me-R*le)*Le,t[4]=(y*ke-p*Ye-b*Ee)*Le,t[5]=(i*Ye-u*ke+d*Ee)*Le,t[6]=(z*K-k*me-j*X)*Le,t[7]=(T*me-S*K+R*X)*Le,t[8]=(p*ze-_*ke+b*_e)*Le,t[9]=(a*ke-i*ze-d*_e)*Le,t[10]=(k*se-F*K+j*Y)*Le,t[11]=(D*K-T*se-R*Y)*Le,t[12]=(_*Ee-p*Se-y*_e)*Le,t[13]=(i*Se-a*Ee+u*_e)*Le,t[14]=(F*X-k*le-z*Y)*Le,t[15]=(T*le-D*X+S*Y)*Le,t):null},Rt.adjoint=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=e[9],S=e[10],R=e[11],k=e[12],F=e[13],z=e[14],j=e[15];return t[0]=_*(S*j-R*z)-D*(y*j-b*z)+F*(y*R-b*S),t[1]=-(a*(S*j-R*z)-D*(u*j-d*z)+F*(u*R-d*S)),t[2]=a*(y*j-b*z)-_*(u*j-d*z)+F*(u*b-d*y),t[3]=-(a*(y*R-b*S)-_*(u*R-d*S)+D*(u*b-d*y)),t[4]=-(p*(S*j-R*z)-T*(y*j-b*z)+k*(y*R-b*S)),t[5]=i*(S*j-R*z)-T*(u*j-d*z)+k*(u*R-d*S),t[6]=-(i*(y*j-b*z)-p*(u*j-d*z)+k*(u*b-d*y)),t[7]=i*(y*R-b*S)-p*(u*R-d*S)+T*(u*b-d*y),t[8]=p*(D*j-R*F)-T*(_*j-b*F)+k*(_*R-b*D),t[9]=-(i*(D*j-R*F)-T*(a*j-d*F)+k*(a*R-d*D)),t[10]=i*(_*j-b*F)-p*(a*j-d*F)+k*(a*b-d*_),t[11]=-(i*(_*R-b*D)-p*(a*R-d*D)+T*(a*b-d*_)),t[12]=-(p*(D*z-S*F)-T*(_*z-y*F)+k*(_*S-y*D)),t[13]=i*(D*z-S*F)-T*(a*z-u*F)+k*(a*S-u*D),t[14]=-(i*(_*z-y*F)-p*(a*z-u*F)+k*(a*y-u*_)),t[15]=i*(_*S-y*D)-p*(a*S-u*D)+T*(a*y-u*_),t},Rt.determinant=function(t){var e=t[0],i=t[1],a=t[2],u=t[3],d=t[4],p=t[5],_=t[6],y=t[7],b=t[8],T=t[9],D=t[10],S=t[11],R=t[12],k=t[13],F=t[14],z=t[15];return(e*p-i*d)*(D*z-S*F)-(e*_-a*d)*(T*z-S*k)+(e*y-u*d)*(T*F-D*k)+(i*_-a*p)*(b*z-S*R)-(i*y-u*p)*(b*F-D*R)+(a*y-u*_)*(b*k-T*R)},Rt.multiply=Zs,Rt.translate=function(t,e,i){var a,u,d,p,_,y,b,T,D,S,R,k,F=i[0],z=i[1],j=i[2];return e===t?(t[12]=e[0]*F+e[4]*z+e[8]*j+e[12],t[13]=e[1]*F+e[5]*z+e[9]*j+e[13],t[14]=e[2]*F+e[6]*z+e[10]*j+e[14],t[15]=e[3]*F+e[7]*z+e[11]*j+e[15]):(u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=e[9],R=e[10],k=e[11],t[0]=a=e[0],t[1]=u,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=b,t[7]=T,t[8]=D,t[9]=S,t[10]=R,t[11]=k,t[12]=a*F+_*z+D*j+e[12],t[13]=u*F+y*z+S*j+e[13],t[14]=d*F+b*z+R*j+e[14],t[15]=p*F+T*z+k*j+e[15]),t},Rt.scale=function(t,e,i){var a=i[0],u=i[1],d=i[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Rt.rotate=function(t,e,i,a){var u,d,p,_,y,b,T,D,S,R,k,F,z,j,Y,X,K,le,se,me,_e,Ee,ke,Se,ze=a[0],Ye=a[1],Le=a[2],qe=Math.hypot(ze,Ye,Le);return qe<jn.EPSILON?null:(ze*=qe=1/qe,Ye*=qe,Le*=qe,u=Math.sin(i),d=Math.cos(i),y=e[1],b=e[2],T=e[3],S=e[5],R=e[6],k=e[7],z=e[9],j=e[10],Y=e[11],X=ze*ze*(p=1-d)+d,se=ze*Ye*p-Le*u,me=Ye*Ye*p+d,_e=Le*Ye*p+ze*u,Ee=ze*Le*p+Ye*u,ke=Ye*Le*p-ze*u,Se=Le*Le*p+d,t[0]=(_=e[0])*X+(D=e[4])*(K=Ye*ze*p+Le*u)+(F=e[8])*(le=Le*ze*p-Ye*u),t[1]=y*X+S*K+z*le,t[2]=b*X+R*K+j*le,t[3]=T*X+k*K+Y*le,t[4]=_*se+D*me+F*_e,t[5]=y*se+S*me+z*_e,t[6]=b*se+R*me+j*_e,t[7]=T*se+k*me+Y*_e,t[8]=_*Ee+D*ke+F*Se,t[9]=y*Ee+S*ke+z*Se,t[10]=b*Ee+R*ke+j*Se,t[11]=T*Ee+k*ke+Y*Se,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Rt.rotateX=function(t,e,i){var a=Math.sin(i),u=Math.cos(i),d=e[4],p=e[5],_=e[6],y=e[7],b=e[8],T=e[9],D=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*u+b*a,t[5]=p*u+T*a,t[6]=_*u+D*a,t[7]=y*u+S*a,t[8]=b*u-d*a,t[9]=T*u-p*a,t[10]=D*u-_*a,t[11]=S*u-y*a,t},Rt.rotateY=function(t,e,i){var a=Math.sin(i),u=Math.cos(i),d=e[0],p=e[1],_=e[2],y=e[3],b=e[8],T=e[9],D=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u-b*a,t[1]=p*u-T*a,t[2]=_*u-D*a,t[3]=y*u-S*a,t[8]=d*a+b*u,t[9]=p*a+T*u,t[10]=_*a+D*u,t[11]=y*a+S*u,t},Rt.rotateZ=function(t,e,i){var a=Math.sin(i),u=Math.cos(i),d=e[0],p=e[1],_=e[2],y=e[3],b=e[4],T=e[5],D=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u+b*a,t[1]=p*u+T*a,t[2]=_*u+D*a,t[3]=y*u+S*a,t[4]=b*u-d*a,t[5]=T*u-p*a,t[6]=D*u-_*a,t[7]=S*u-y*a,t},Rt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Rt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromRotation=function(t,e,i){var a,u,d,p=i[0],_=i[1],y=i[2],b=Math.hypot(p,_,y);return b<jn.EPSILON?null:(p*=b=1/b,_*=b,y*=b,a=Math.sin(e),u=Math.cos(e),t[0]=p*p*(d=1-u)+u,t[1]=_*p*d+y*a,t[2]=y*p*d-_*a,t[3]=0,t[4]=p*_*d-y*a,t[5]=_*_*d+u,t[6]=y*_*d+p*a,t[7]=0,t[8]=p*y*d+_*a,t[9]=_*y*d-p*a,t[10]=y*y*d+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Rt.fromXRotation=function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromYRotation=function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromZRotation=function(t,e){var i=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromRotationTranslation=ou,Rt.fromQuat2=function(t,e){var i=new jn.ARRAY_TYPE(3),a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=a*a+u*u+d*d+p*p;return D>0?(i[0]=2*(_*p+T*a+y*d-b*u)/D,i[1]=2*(y*p+T*u+b*a-_*d)/D,i[2]=2*(b*p+T*d+_*u-y*a)/D):(i[0]=2*(_*p+T*a+y*d-b*u),i[1]=2*(y*p+T*u+b*a-_*d),i[2]=2*(b*p+T*d+_*u-y*a)),ou(t,e,i),t},Rt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Rt.getScaling=Il,Rt.getRotation=function(t,e){var i=new jn.ARRAY_TYPE(3);Il(i,e);var a=1/i[0],u=1/i[1],d=1/i[2],p=e[0]*a,_=e[1]*u,y=e[2]*d,b=e[4]*a,T=e[5]*u,D=e[6]*d,S=e[8]*a,R=e[9]*u,k=e[10]*d,F=p+T+k,z=0;return F>0?(z=2*Math.sqrt(F+1),t[3]=.25*z,t[0]=(D-R)/z,t[1]=(S-y)/z,t[2]=(_-b)/z):p>T&&p>k?(z=2*Math.sqrt(1+p-T-k),t[3]=(D-R)/z,t[0]=.25*z,t[1]=(_+b)/z,t[2]=(S+y)/z):T>k?(z=2*Math.sqrt(1+T-p-k),t[3]=(S-y)/z,t[0]=(_+b)/z,t[1]=.25*z,t[2]=(D+R)/z):(z=2*Math.sqrt(1+k-p-T),t[3]=(_-b)/z,t[0]=(S+y)/z,t[1]=(D+R)/z,t[2]=.25*z),t},Rt.fromRotationTranslationScale=function(t,e,i,a){var u=e[0],d=e[1],p=e[2],_=e[3],y=u+u,b=d+d,T=p+p,D=u*y,S=u*b,R=u*T,k=d*b,F=d*T,z=p*T,j=_*y,Y=_*b,X=_*T,K=a[0],le=a[1],se=a[2];return t[0]=(1-(k+z))*K,t[1]=(S+X)*K,t[2]=(R-Y)*K,t[3]=0,t[4]=(S-X)*le,t[5]=(1-(D+z))*le,t[6]=(F+j)*le,t[7]=0,t[8]=(R+Y)*se,t[9]=(F-j)*se,t[10]=(1-(D+k))*se,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Rt.fromRotationTranslationScaleOrigin=function(t,e,i,a,u){var d=e[0],p=e[1],_=e[2],y=e[3],b=d+d,T=p+p,D=_+_,S=d*b,R=d*T,k=d*D,F=p*T,z=p*D,j=_*D,Y=y*b,X=y*T,K=y*D,le=a[0],se=a[1],me=a[2],_e=u[0],Ee=u[1],ke=u[2],Se=(1-(F+j))*le,ze=(R+K)*le,Ye=(k-X)*le,Le=(R-K)*se,qe=(1-(S+j))*se,Oe=(z+Y)*se,We=(k+X)*me,Je=(z-Y)*me,Ze=(1-(S+F))*me;return t[0]=Se,t[1]=ze,t[2]=Ye,t[3]=0,t[4]=Le,t[5]=qe,t[6]=Oe,t[7]=0,t[8]=We,t[9]=Je,t[10]=Ze,t[11]=0,t[12]=i[0]+_e-(Se*_e+Le*Ee+We*ke),t[13]=i[1]+Ee-(ze*_e+qe*Ee+Je*ke),t[14]=i[2]+ke-(Ye*_e+Oe*Ee+Ze*ke),t[15]=1,t},Rt.fromQuat=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=i+i,_=a+a,y=u+u,b=i*p,T=a*p,D=a*_,S=u*p,R=u*_,k=u*y,F=d*p,z=d*_,j=d*y;return t[0]=1-D-k,t[1]=T+j,t[2]=S-z,t[3]=0,t[4]=T-j,t[5]=1-b-k,t[6]=R+F,t[7]=0,t[8]=S+z,t[9]=R-F,t[10]=1-b-D,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.frustum=function(t,e,i,a,u,d,p){var _=1/(i-e),y=1/(u-a),b=1/(d-p);return t[0]=2*d*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*y,t[6]=0,t[7]=0,t[8]=(i+e)*_,t[9]=(u+a)*y,t[10]=(p+d)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*d*2*b,t[15]=0,t},Rt.perspectiveNO=Do,Rt.perspectiveZO=function(t,e,i,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(d=1/(a-u)),t[14]=u*a*d):(t[10]=-1,t[14]=-a),t},Rt.perspectiveFromFieldOfView=function(t,e,i,a){var u=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+_),b=2/(u+d);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(p-_)*y*.5,t[9]=(u-d)*b*.5,t[10]=a/(i-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i/(i-a),t[15]=0,t},Rt.orthoNO=So,Rt.orthoZO=function(t,e,i,a,u,d,p){var _=1/(e-i),y=1/(a-u),b=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+i)*_,t[13]=(u+a)*y,t[14]=d*b,t[15]=1,t},Rt.lookAt=function(t,e,i,a){var u,d,p,_,y,b,T,D,S,R,k=e[0],F=e[1],z=e[2],j=a[0],Y=a[1],X=a[2],K=i[0],le=i[1],se=i[2];return Math.abs(k-K)<jn.EPSILON&&Math.abs(F-le)<jn.EPSILON&&Math.abs(z-se)<jn.EPSILON?ms(t):(T=k-K,D=F-le,S=z-se,u=Y*(S*=R=1/Math.hypot(T,D,S))-X*(D*=R),d=X*(T*=R)-j*S,p=j*D-Y*T,(R=Math.hypot(u,d,p))?(u*=R=1/R,d*=R,p*=R):(u=0,d=0,p=0),_=D*p-S*d,y=S*u-T*p,b=T*d-D*u,(R=Math.hypot(_,y,b))?(_*=R=1/R,y*=R,b*=R):(_=0,y=0,b=0),t[0]=u,t[1]=_,t[2]=T,t[3]=0,t[4]=d,t[5]=y,t[6]=D,t[7]=0,t[8]=p,t[9]=b,t[10]=S,t[11]=0,t[12]=-(u*k+d*F+p*z),t[13]=-(_*k+y*F+b*z),t[14]=-(T*k+D*F+S*z),t[15]=1,t)},Rt.targetTo=function(t,e,i,a){var u=e[0],d=e[1],p=e[2],_=a[0],y=a[1],b=a[2],T=u-i[0],D=d-i[1],S=p-i[2],R=T*T+D*D+S*S;R>0&&(T*=R=1/Math.sqrt(R),D*=R,S*=R);var k=y*S-b*D,F=b*T-_*S,z=_*D-y*T;return(R=k*k+F*F+z*z)>0&&(k*=R=1/Math.sqrt(R),F*=R,z*=R),t[0]=k,t[1]=F,t[2]=z,t[3]=0,t[4]=D*z-S*F,t[5]=S*k-T*z,t[6]=T*F-D*k,t[7]=0,t[8]=T,t[9]=D,t[10]=S,t[11]=0,t[12]=u,t[13]=d,t[14]=p,t[15]=1,t},Rt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Rt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Rt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Rt.subtract=su,Rt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Rt.multiplyScalarAndAdd=function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t[2]=e[2]+i[2]*a,t[3]=e[3]+i[3]*a,t[4]=e[4]+i[4]*a,t[5]=e[5]+i[5]*a,t[6]=e[6]+i[6]*a,t[7]=e[7]+i[7]*a,t[8]=e[8]+i[8]*a,t[9]=e[9]+i[9]*a,t[10]=e[10]+i[10]*a,t[11]=e[11]+i[11]*a,t[12]=e[12]+i[12]*a,t[13]=e[13]+i[13]*a,t[14]=e[14]+i[14]*a,t[15]=e[15]+i[15]*a,t},Rt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Rt.equals=function(t,e){var i=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],T=t[8],D=t[9],S=t[10],R=t[11],k=t[12],F=t[13],z=t[14],j=t[15],Y=e[0],X=e[1],K=e[2],le=e[3],se=e[4],me=e[5],_e=e[6],Ee=e[7],ke=e[8],Se=e[9],ze=e[10],Ye=e[11],Le=e[12],qe=e[13],Oe=e[14],We=e[15];return Math.abs(i-Y)<=jn.EPSILON*Math.max(1,Math.abs(i),Math.abs(Y))&&Math.abs(a-X)<=jn.EPSILON*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(u-K)<=jn.EPSILON*Math.max(1,Math.abs(u),Math.abs(K))&&Math.abs(d-le)<=jn.EPSILON*Math.max(1,Math.abs(d),Math.abs(le))&&Math.abs(p-se)<=jn.EPSILON*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(_-me)<=jn.EPSILON*Math.max(1,Math.abs(_),Math.abs(me))&&Math.abs(y-_e)<=jn.EPSILON*Math.max(1,Math.abs(y),Math.abs(_e))&&Math.abs(b-Ee)<=jn.EPSILON*Math.max(1,Math.abs(b),Math.abs(Ee))&&Math.abs(T-ke)<=jn.EPSILON*Math.max(1,Math.abs(T),Math.abs(ke))&&Math.abs(D-Se)<=jn.EPSILON*Math.max(1,Math.abs(D),Math.abs(Se))&&Math.abs(S-ze)<=jn.EPSILON*Math.max(1,Math.abs(S),Math.abs(ze))&&Math.abs(R-Ye)<=jn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ye))&&Math.abs(k-Le)<=jn.EPSILON*Math.max(1,Math.abs(k),Math.abs(Le))&&Math.abs(F-qe)<=jn.EPSILON*Math.max(1,Math.abs(F),Math.abs(qe))&&Math.abs(z-Oe)<=jn.EPSILON*Math.max(1,Math.abs(z),Math.abs(Oe))&&Math.abs(j-We)<=jn.EPSILON*Math.max(1,Math.abs(j),Math.abs(We))},Rt.sub=Rt.mul=Rt.ortho=Rt.perspective=void 0;var jn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Fi(t)!=="object"&&typeof t!="function")return{default:t};var i=dr(void 0);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}(ft);function dr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(dr=function(a){return a?i:e})(t)}function ms(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zs(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=e[9],R=e[10],k=e[11],F=e[12],z=e[13],j=e[14],Y=e[15],X=i[0],K=i[1],le=i[2],se=i[3];return t[0]=X*a+K*_+le*D+se*F,t[1]=X*u+K*y+le*S+se*z,t[2]=X*d+K*b+le*R+se*j,t[3]=X*p+K*T+le*k+se*Y,t[4]=(X=i[4])*a+(K=i[5])*_+(le=i[6])*D+(se=i[7])*F,t[5]=X*u+K*y+le*S+se*z,t[6]=X*d+K*b+le*R+se*j,t[7]=X*p+K*T+le*k+se*Y,t[8]=(X=i[8])*a+(K=i[9])*_+(le=i[10])*D+(se=i[11])*F,t[9]=X*u+K*y+le*S+se*z,t[10]=X*d+K*b+le*R+se*j,t[11]=X*p+K*T+le*k+se*Y,t[12]=(X=i[12])*a+(K=i[13])*_+(le=i[14])*D+(se=i[15])*F,t[13]=X*u+K*y+le*S+se*z,t[14]=X*d+K*b+le*R+se*j,t[15]=X*p+K*T+le*k+se*Y,t}function ou(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=a+a,y=u+u,b=d+d,T=a*_,D=a*y,S=a*b,R=u*y,k=u*b,F=d*b,z=p*_,j=p*y,Y=p*b;return t[0]=1-(R+F),t[1]=D+Y,t[2]=S-j,t[3]=0,t[4]=D-Y,t[5]=1-(T+F),t[6]=k+z,t[7]=0,t[8]=S+j,t[9]=k-z,t[10]=1-(T+R),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Il(t,e){var i=e[4],a=e[5],u=e[6],d=e[8],p=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,a,u),t[2]=Math.hypot(d,p,_),t}function Do(t,e,i,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+a)*(d=1/(a-u)),t[14]=2*u*a*d):(t[10]=-1,t[14]=-2*a),t}function So(t,e,i,a,u,d,p){var _=1/(e-i),y=1/(a-u),b=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+i)*_,t[13]=(u+a)*y,t[14]=(p+d)*b,t[15]=1,t}function su(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Rt.perspective=Do,Rt.ortho=So,Rt.mul=Zs,Rt.sub=su;var Ot={},zt={};function Dl(t){return Dl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dl(t)}Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=Sl,zt.clone=function(t){var e=new Gr.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},zt.length=Ml,zt.fromValues=function(t,e,i){var a=new Gr.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=i,a},zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},zt.set=function(t,e,i,a){return t[0]=e,t[1]=i,t[2]=a,t},zt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},zt.subtract=au,zt.multiply=Ys,zt.divide=Fa,zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},zt.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},zt.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},zt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},zt.scaleAndAdd=function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t[2]=e[2]+i[2]*a,t},zt.distance=Al,zt.squaredDistance=lu,zt.squaredLength=Pl,zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},zt.normalize=function(t,e){var i=e[0],a=e[1],u=e[2],d=i*i+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},zt.dot=Rl,zt.cross=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=i[0],_=i[1],y=i[2];return t[0]=u*y-d*_,t[1]=d*p-a*y,t[2]=a*_-u*p,t},zt.lerp=function(t,e,i,a){var u=e[0],d=e[1],p=e[2];return t[0]=u+a*(i[0]-u),t[1]=d+a*(i[1]-d),t[2]=p+a*(i[2]-p),t},zt.hermite=function(t,e,i,a,u,d){var p=d*d,_=p*(2*d-3)+1,y=p*(d-2)+d,b=p*(d-1),T=p*(3-2*d);return t[0]=e[0]*_+i[0]*y+a[0]*b+u[0]*T,t[1]=e[1]*_+i[1]*y+a[1]*b+u[1]*T,t[2]=e[2]*_+i[2]*y+a[2]*b+u[2]*T,t},zt.bezier=function(t,e,i,a,u,d){var p=1-d,_=p*p,y=d*d,b=_*p,T=3*d*_,D=3*y*p,S=y*d;return t[0]=e[0]*b+i[0]*T+a[0]*D+u[0]*S,t[1]=e[1]*b+i[1]*T+a[1]*D+u[1]*S,t[2]=e[2]*b+i[2]*T+a[2]*D+u[2]*S,t},zt.random=function(t,e){e=e||1;var i=2*Gr.RANDOM()*Math.PI,a=2*Gr.RANDOM()-1,u=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(i)*u,t[1]=Math.sin(i)*u,t[2]=a*e,t},zt.transformMat4=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=i[3]*a+i[7]*u+i[11]*d+i[15];return t[0]=(i[0]*a+i[4]*u+i[8]*d+i[12])/(p=p||1),t[1]=(i[1]*a+i[5]*u+i[9]*d+i[13])/p,t[2]=(i[2]*a+i[6]*u+i[10]*d+i[14])/p,t},zt.transformMat3=function(t,e,i){var a=e[0],u=e[1],d=e[2];return t[0]=a*i[0]+u*i[3]+d*i[6],t[1]=a*i[1]+u*i[4]+d*i[7],t[2]=a*i[2]+u*i[5]+d*i[8],t},zt.transformQuat=function(t,e,i){var a=i[0],u=i[1],d=i[2],p=e[0],_=e[1],y=e[2],b=u*y-d*_,T=d*p-a*y,D=a*_-u*p,S=u*D-d*T,R=d*b-a*D,k=a*T-u*b,F=2*i[3];return T*=F,D*=F,R*=2,k*=2,t[0]=p+(b*=F)+(S*=2),t[1]=_+T+R,t[2]=y+D+k,t},zt.rotateX=function(t,e,i,a){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[0],d[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),d[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),t[0]=d[0]+i[0],t[1]=d[1]+i[1],t[2]=d[2]+i[2],t},zt.rotateY=function(t,e,i,a){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),d[1]=u[1],d[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),t[0]=d[0]+i[0],t[1]=d[1]+i[1],t[2]=d[2]+i[2],t},zt.rotateZ=function(t,e,i,a){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),d[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),d[2]=u[2],t[0]=d[0]+i[0],t[1]=d[1]+i[1],t[2]=d[2]+i[2],t},zt.angle=function(t,e){var i=t[0],a=t[1],u=t[2],d=e[0],p=e[1],_=e[2],y=Math.sqrt(i*i+a*a+u*u)*Math.sqrt(d*d+p*p+_*_),b=y&&Rl(t,e)/y;return Math.acos(Math.min(Math.max(b,-1),1))},zt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},zt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},zt.equals=function(t,e){var i=t[0],a=t[1],u=t[2],d=e[0],p=e[1],_=e[2];return Math.abs(i-d)<=Gr.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-p)<=Gr.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(u-_)<=Gr.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))},zt.forEach=zt.sqrLen=zt.len=zt.sqrDist=zt.dist=zt.div=zt.mul=zt.sub=void 0;var Gr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Dl(t)!=="object"&&typeof t!="function")return{default:t};var i=La(void 0);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}(ft);function La(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(La=function(a){return a?i:e})(t)}function Sl(){var t=new Gr.ARRAY_TYPE(3);return Gr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ml(t){return Math.hypot(t[0],t[1],t[2])}function au(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ys(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Fa(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Al(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function lu(t,e){var i=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2];return i*i+a*a+u*u}function Pl(t){var e=t[0],i=t[1],a=t[2];return e*e+i*i+a*a}function Rl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}zt.sub=au,zt.mul=Ys,zt.div=Fa,zt.dist=Al,zt.sqrDist=lu,zt.len=Ml,zt.sqrLen=Pl;var co,ud=(co=Sl(),function(t,e,i,a,u,d){var p,_;for(e||(e=3),i||(i=0),_=a?Math.min(a*e+i,t.length):t.length,p=i;p<_;p+=e)co[0]=t[p],co[1]=t[p+1],co[2]=t[p+2],u(co,co,d),t[p]=co[0],t[p+1]=co[1],t[p+2]=co[2];return t});zt.forEach=ud;var Bt={};function cu(t){return cu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cu(t)}Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=Na,Bt.clone=function(t){var e=new Ii.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Bt.fromValues=function(t,e,i,a){var u=new Ii.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=i,u[3]=a,u},Bt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Bt.set=function(t,e,i,a,u){return t[0]=e,t[1]=i,t[2]=a,t[3]=u,t},Bt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Bt.subtract=Wo,Bt.multiply=Zo,Bt.divide=uu,Bt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Bt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Bt.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Bt.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Bt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Bt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Bt.scaleAndAdd=function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t[2]=e[2]+i[2]*a,t[3]=e[3]+i[3]*a,t},Bt.distance=Xs,Bt.squaredDistance=Ks,Bt.length=Ol,Bt.squaredLength=Ll,Bt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Bt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Bt.normalize=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=i*i+a*a+u*u+d*d;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=a*p,t[2]=u*p,t[3]=d*p,t},Bt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Bt.cross=function(t,e,i,a){var u=i[0]*a[1]-i[1]*a[0],d=i[0]*a[2]-i[2]*a[0],p=i[0]*a[3]-i[3]*a[0],_=i[1]*a[2]-i[2]*a[1],y=i[1]*a[3]-i[3]*a[1],b=i[2]*a[3]-i[3]*a[2],T=e[0],D=e[1],S=e[2],R=e[3];return t[0]=D*b-S*y+R*_,t[1]=-T*b+S*p-R*d,t[2]=T*y-D*p+R*u,t[3]=-T*_+D*d-S*u,t},Bt.lerp=function(t,e,i,a){var u=e[0],d=e[1],p=e[2],_=e[3];return t[0]=u+a*(i[0]-u),t[1]=d+a*(i[1]-d),t[2]=p+a*(i[2]-p),t[3]=_+a*(i[3]-_),t},Bt.random=function(t,e){var i,a,u,d,p,_;e=e||1;do p=(i=2*Ii.RANDOM()-1)*i+(a=2*Ii.RANDOM()-1)*a;while(p>=1);do _=(u=2*Ii.RANDOM()-1)*u+(d=2*Ii.RANDOM()-1)*d;while(_>=1);var y=Math.sqrt((1-p)/_);return t[0]=e*i,t[1]=e*a,t[2]=e*u*y,t[3]=e*d*y,t},Bt.transformMat4=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3];return t[0]=i[0]*a+i[4]*u+i[8]*d+i[12]*p,t[1]=i[1]*a+i[5]*u+i[9]*d+i[13]*p,t[2]=i[2]*a+i[6]*u+i[10]*d+i[14]*p,t[3]=i[3]*a+i[7]*u+i[11]*d+i[15]*p,t},Bt.transformQuat=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=i[0],_=i[1],y=i[2],b=i[3],T=b*a+_*d-y*u,D=b*u+y*a-p*d,S=b*d+p*u-_*a,R=-p*a-_*u-y*d;return t[0]=T*b+R*-p+D*-y-S*-_,t[1]=D*b+R*-_+S*-p-T*-y,t[2]=S*b+R*-y+T*-_-D*-p,t[3]=e[3],t},Bt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Bt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Bt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Bt.equals=function(t,e){var i=t[0],a=t[1],u=t[2],d=t[3],p=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(i-p)<=Ii.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-_)<=Ii.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-y)<=Ii.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-b)<=Ii.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Bt.forEach=Bt.sqrLen=Bt.len=Bt.sqrDist=Bt.dist=Bt.div=Bt.mul=Bt.sub=void 0;var Ii=function(t,e){if(t&&t.__esModule)return t;if(t===null||cu(t)!=="object"&&typeof t!="function")return{default:t};var i=kl(void 0);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}(ft);function kl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(kl=function(a){return a?i:e})(t)}function Na(){var t=new Ii.ARRAY_TYPE(4);return Ii.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Wo(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Zo(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function uu(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Xs(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ks(t,e){var i=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2],d=e[3]-t[3];return i*i+a*a+u*u+d*d}function Ol(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Ll(t){var e=t[0],i=t[1],a=t[2],u=t[3];return e*e+i*i+a*a+u*u}Bt.sub=Wo,Bt.mul=Zo,Bt.div=uu,Bt.dist=Xs,Bt.sqrDist=Ks,Bt.len=Ol,Bt.sqrLen=Ll;var hd=function(){var t=Na();return function(e,i,a,u,d,p){var _,y;for(i||(i=4),a||(a=0),y=u?Math.min(u*i+a,e.length):e.length,_=a;_<y;_+=i)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],d(t,t,p),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function Fl(t){return Fl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fl(t)}Bt.forEach=hd,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.create=Nl,Ot.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Ot.setAxisAngle=hu,Ot.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),a=Math.sin(i/2);return a>uo.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),i},Ot.getAngle=function(t,e){var i=pe(t,e);return Math.acos(2*i*i-1)},Ot.multiply=zl,Ot.rotateX=function(t,e,i){i*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=a*y+p*_,t[1]=u*y+d*_,t[2]=d*y-u*_,t[3]=p*y-a*_,t},Ot.rotateY=function(t,e,i){i*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=a*y-d*_,t[1]=u*y+p*_,t[2]=d*y+a*_,t[3]=p*y-u*_,t},Ot.rotateZ=function(t,e,i){i*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=a*y+u*_,t[1]=u*y-a*_,t[2]=d*y+p*_,t[3]=p*y-d*_,t},Ot.calculateW=function(t,e){var i=e[0],a=e[1],u=e[2];return t[0]=i,t[1]=a,t[2]=u,t[3]=Math.sqrt(Math.abs(1-i*i-a*a-u*u)),t},Ot.exp=ye,Ot.ln=$,Ot.pow=function(t,e,i){return $(t,e),de(t,t,i),ye(t,t),t},Ot.slerp=Z,Ot.random=function(t){var e=uo.RANDOM(),i=uo.RANDOM(),a=uo.RANDOM(),u=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*i),t[1]=u*Math.cos(2*Math.PI*i),t[2]=d*Math.sin(2*Math.PI*a),t[3]=d*Math.cos(2*Math.PI*a),t},Ot.invert=function(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=i*i+a*a+u*u+d*d,_=p?1/p:0;return t[0]=-i*_,t[1]=-a*_,t[2]=-u*_,t[3]=d*_,t},Ot.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Ot.fromMat3=oe,Ot.fromEuler=function(t,e,i,a){var u=.5*Math.PI/180;e*=u,i*=u,a*=u;var d=Math.sin(e),p=Math.cos(e),_=Math.sin(i),y=Math.cos(i),b=Math.sin(a),T=Math.cos(a);return t[0]=d*y*T-p*_*b,t[1]=p*_*T+d*y*b,t[2]=p*y*b-d*_*T,t[3]=p*y*T+d*_*b,t},Ot.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ot.setAxes=Ot.sqlerp=Ot.rotationTo=Ot.equals=Ot.exactEquals=Ot.normalize=Ot.sqrLen=Ot.squaredLength=Ot.len=Ot.length=Ot.lerp=Ot.dot=Ot.scale=Ot.mul=Ot.add=Ot.set=Ot.copy=Ot.fromValues=Ot.clone=void 0;var uo=za(ft),Qs=za(Nt),ho=za(zt),tr=za(Bt);function dd(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(dd=function(a){return a?i:e})(t)}function za(t,e){if(t&&t.__esModule)return t;if(t===null||Fl(t)!=="object"&&typeof t!="function")return{default:t};var i=dd(e);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}function Nl(){var t=new uo.ARRAY_TYPE(4);return uo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function hu(t,e,i){i*=.5;var a=Math.sin(i);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(i),t}function zl(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=i[0],y=i[1],b=i[2],T=i[3];return t[0]=a*T+p*_+u*b-d*y,t[1]=u*T+p*y+d*_-a*b,t[2]=d*T+p*b+a*y-u*_,t[3]=p*T-a*_-u*y-d*b,t}function ye(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(i*i+a*a+u*u),_=Math.exp(d),y=p>0?_*Math.sin(p)/p:0;return t[0]=i*y,t[1]=a*y,t[2]=u*y,t[3]=_*Math.cos(p),t}function $(t,e){var i=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(i*i+a*a+u*u),_=p>0?Math.atan2(p,d)/p:0;return t[0]=i*_,t[1]=a*_,t[2]=u*_,t[3]=.5*Math.log(i*i+a*a+u*u+d*d),t}function Z(t,e,i,a){var u,d,p,_,y,b=e[0],T=e[1],D=e[2],S=e[3],R=i[0],k=i[1],F=i[2],z=i[3];return(d=b*R+T*k+D*F+S*z)<0&&(d=-d,R=-R,k=-k,F=-F,z=-z),1-d>uo.EPSILON?(u=Math.acos(d),p=Math.sin(u),_=Math.sin((1-a)*u)/p,y=Math.sin(a*u)/p):(_=1-a,y=a),t[0]=_*b+y*R,t[1]=_*T+y*k,t[2]=_*D+y*F,t[3]=_*S+y*z,t}function oe(t,e){var i,a=e[0]+e[4]+e[8];if(a>0)i=Math.sqrt(a+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var d=(u+1)%3,p=(u+2)%3;i=Math.sqrt(e[3*u+u]-e[3*d+d]-e[3*p+p]+1),t[u]=.5*i,t[3]=(e[3*d+p]-e[3*p+d])*(i=.5/i),t[d]=(e[3*d+u]+e[3*u+d])*i,t[p]=(e[3*p+u]+e[3*u+p])*i}return t}Ot.clone=tr.clone,Ot.fromValues=tr.fromValues,Ot.copy=tr.copy,Ot.set=tr.set,Ot.add=tr.add,Ot.mul=zl;var de=tr.scale;Ot.scale=de;var pe=tr.dot;Ot.dot=pe,Ot.lerp=tr.lerp;var we=tr.length;Ot.length=we,Ot.len=we;var Ae=tr.squaredLength;Ot.squaredLength=Ae,Ot.sqrLen=Ae;var ve=tr.normalize;Ot.normalize=ve,Ot.exactEquals=tr.exactEquals,Ot.equals=tr.equals;var Pe,it,Qe,yt=(Pe=ho.create(),it=ho.fromValues(1,0,0),Qe=ho.fromValues(0,1,0),function(t,e,i){var a=ho.dot(e,i);return a<-.999999?(ho.cross(Pe,it,e),ho.len(Pe)<1e-6&&ho.cross(Pe,Qe,e),ho.normalize(Pe,Pe),hu(t,Pe,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ho.cross(Pe,e,i),t[0]=Pe[0],t[1]=Pe[1],t[2]=Pe[2],t[3]=1+a,ve(t,t))});Ot.rotationTo=yt;var Mt,en,rn=(Mt=Nl(),en=Nl(),function(t,e,i,a,u,d){return Z(Mt,e,u,d),Z(en,i,a,d),Z(t,Mt,en,2*d*(1-d)),t});Ot.sqlerp=rn;var Ht,hn=(Ht=Qs.create(),function(t,e,i,a){return Ht[0]=i[0],Ht[3]=i[1],Ht[6]=i[2],Ht[1]=a[0],Ht[4]=a[1],Ht[7]=a[2],Ht[2]=-e[0],Ht[5]=-e[1],Ht[8]=-e[2],ve(t,oe(t,Ht))});Ot.setAxes=hn;var mt={};function si(t){return si=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},si(t)}Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var t=new zn.ARRAY_TYPE(8);return zn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},mt.clone=function(t){var e=new zn.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},mt.fromValues=function(t,e,i,a,u,d,p,_){var y=new zn.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=i,y[3]=a,y[4]=u,y[5]=d,y[6]=p,y[7]=_,y},mt.fromRotationTranslationValues=function(t,e,i,a,u,d,p){var _=new zn.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=i,_[3]=a;var y=.5*u,b=.5*d,T=.5*p;return _[4]=y*a+b*i-T*e,_[5]=b*a+T*t-y*i,_[6]=T*a+y*e-b*t,_[7]=-y*t-b*e-T*i,_},mt.fromRotationTranslation=fr,mt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},mt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.fromMat4=function(t,e){var i=gn.create();Ri.getRotation(i,e);var a=new zn.ARRAY_TYPE(3);return Ri.getTranslation(a,e),fr(t,i,a),t},mt.copy=pr,mt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.set=function(t,e,i,a,u,d,p,_,y){return t[0]=e,t[1]=i,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t},mt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},mt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},mt.getTranslation=function(t,e){var i=e[4],a=e[5],u=e[6],d=e[7],p=-e[0],_=-e[1],y=-e[2],b=e[3];return t[0]=2*(i*b+d*p+a*y-u*_),t[1]=2*(a*b+d*_+u*p-i*y),t[2]=2*(u*b+d*y+i*_-a*p),t},mt.translate=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=.5*i[0],y=.5*i[1],b=.5*i[2],T=e[4],D=e[5],S=e[6],R=e[7];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=p*_+u*b-d*y+T,t[5]=p*y+d*_-a*b+D,t[6]=p*b+a*y-u*_+S,t[7]=-a*_-u*y-d*b+R,t},mt.rotateX=function(t,e,i){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=_*p+T*a+y*d-b*u,S=y*p+T*u+b*a-_*d,R=b*p+T*d+_*u-y*a,k=T*p-_*a-y*u-b*d;return gn.rotateX(t,e,i),t[4]=D*(p=t[3])+k*(a=t[0])+S*(d=t[2])-R*(u=t[1]),t[5]=S*p+k*u+R*a-D*d,t[6]=R*p+k*d+D*u-S*a,t[7]=k*p-D*a-S*u-R*d,t},mt.rotateY=function(t,e,i){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=_*p+T*a+y*d-b*u,S=y*p+T*u+b*a-_*d,R=b*p+T*d+_*u-y*a,k=T*p-_*a-y*u-b*d;return gn.rotateY(t,e,i),t[4]=D*(p=t[3])+k*(a=t[0])+S*(d=t[2])-R*(u=t[1]),t[5]=S*p+k*u+R*a-D*d,t[6]=R*p+k*d+D*u-S*a,t[7]=k*p-D*a-S*u-R*d,t},mt.rotateZ=function(t,e,i){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=_*p+T*a+y*d-b*u,S=y*p+T*u+b*a-_*d,R=b*p+T*d+_*u-y*a,k=T*p-_*a-y*u-b*d;return gn.rotateZ(t,e,i),t[4]=D*(p=t[3])+k*(a=t[0])+S*(d=t[2])-R*(u=t[1]),t[5]=S*p+k*u+R*a-D*d,t[6]=R*p+k*d+D*u-S*a,t[7]=k*p-D*a-S*u-R*d,t},mt.rotateByQuatAppend=function(t,e,i){var a=i[0],u=i[1],d=i[2],p=i[3],_=e[0],y=e[1],b=e[2],T=e[3];return t[0]=_*p+T*a+y*d-b*u,t[1]=y*p+T*u+b*a-_*d,t[2]=b*p+T*d+_*u-y*a,t[3]=T*p-_*a-y*u-b*d,t[4]=(_=e[4])*p+(T=e[7])*a+(y=e[5])*d-(b=e[6])*u,t[5]=y*p+T*u+b*a-_*d,t[6]=b*p+T*d+_*u-y*a,t[7]=T*p-_*a-y*u-b*d,t},mt.rotateByQuatPrepend=function(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=i[0],y=i[1],b=i[2],T=i[3];return t[0]=a*T+p*_+u*b-d*y,t[1]=u*T+p*y+d*_-a*b,t[2]=d*T+p*b+a*y-u*_,t[3]=p*T-a*_-u*y-d*b,t[4]=a*(T=i[7])+p*(_=i[4])+u*(b=i[6])-d*(y=i[5]),t[5]=u*T+p*y+d*_-a*b,t[6]=d*T+p*b+a*y-u*_,t[7]=p*T-a*_-u*y-d*b,t},mt.rotateAroundAxis=function(t,e,i,a){if(Math.abs(a)<zn.EPSILON)return pr(t,e);var u=Math.hypot(i[0],i[1],i[2]);a*=.5;var d=Math.sin(a),p=d*i[0]/u,_=d*i[1]/u,y=d*i[2]/u,b=Math.cos(a),T=e[0],D=e[1],S=e[2],R=e[3];t[0]=T*b+R*p+D*y-S*_,t[1]=D*b+R*_+S*p-T*y,t[2]=S*b+R*y+T*_-D*p,t[3]=R*b-T*p-D*_-S*y;var k=e[4],F=e[5],z=e[6],j=e[7];return t[4]=k*b+j*p+F*y-z*_,t[5]=F*b+j*_+z*p-k*y,t[6]=z*b+j*y+k*_-F*p,t[7]=j*b-k*p-F*_-z*y,t},mt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},mt.multiply=Ba,mt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},mt.lerp=function(t,e,i,a){var u=1-a;return Rp(e,i)<0&&(a=-a),t[0]=e[0]*u+i[0]*a,t[1]=e[1]*u+i[1]*a,t[2]=e[2]*u+i[2]*a,t[3]=e[3]*u+i[3]*a,t[4]=e[4]*u+i[4]*a,t[5]=e[5]*u+i[5]*a,t[6]=e[6]*u+i[6]*a,t[7]=e[7]*u+i[7]*a,t},mt.invert=function(t,e){var i=du(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},mt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},mt.normalize=function(t,e){var i=du(e);if(i>0){i=Math.sqrt(i);var a=e[0]/i,u=e[1]/i,d=e[2]/i,p=e[3]/i,_=e[4],y=e[5],b=e[6],T=e[7],D=a*_+u*y+d*b+p*T;t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=(_-a*D)/i,t[5]=(y-u*D)/i,t[6]=(b-d*D)/i,t[7]=(T-p*D)/i}return t},mt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},mt.equals=function(t,e){var i=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],T=e[0],D=e[1],S=e[2],R=e[3],k=e[4],F=e[5],z=e[6],j=e[7];return Math.abs(i-T)<=zn.EPSILON*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(a-D)<=zn.EPSILON*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(u-S)<=zn.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(d-R)<=zn.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-k)<=zn.EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(_-F)<=zn.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(y-z)<=zn.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(b-j)<=zn.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))},mt.sqrLen=mt.squaredLength=mt.len=mt.length=mt.dot=mt.mul=mt.setReal=mt.getReal=void 0;var zn=Bi(ft),gn=Bi(Ot),Ri=Bi(Rt);function ai(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(ai=function(a){return a?i:e})(t)}function Bi(t,e){if(t&&t.__esModule)return t;if(t===null||si(t)!=="object"&&typeof t!="function")return{default:t};var i=ai(e);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}function fr(t,e,i){var a=.5*i[0],u=.5*i[1],d=.5*i[2],p=e[0],_=e[1],y=e[2],b=e[3];return t[0]=p,t[1]=_,t[2]=y,t[3]=b,t[4]=a*b+u*y-d*_,t[5]=u*b+d*p-a*y,t[6]=d*b+a*_-u*p,t[7]=-a*p-u*_-d*y,t}function pr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Ba(t,e,i){var a=e[0],u=e[1],d=e[2],p=e[3],_=i[4],y=i[5],b=i[6],T=i[7],D=e[4],S=e[5],R=e[6],k=e[7],F=i[0],z=i[1],j=i[2],Y=i[3];return t[0]=a*Y+p*F+u*j-d*z,t[1]=u*Y+p*z+d*F-a*j,t[2]=d*Y+p*j+a*z-u*F,t[3]=p*Y-a*F-u*z-d*j,t[4]=a*T+p*_+u*b-d*y+D*Y+k*F+S*j-R*z,t[5]=u*T+p*y+d*_-a*b+S*Y+k*z+R*F-D*j,t[6]=d*T+p*b+a*y-u*_+R*Y+k*j+D*z-S*F,t[7]=p*T-a*_-u*y-d*b+k*Y-D*F-S*z-R*j,t}mt.getReal=gn.copy,mt.setReal=gn.copy,mt.mul=Ba;var Rp=gn.dot;mt.dot=Rp;var ty=gn.length;mt.length=ty,mt.len=ty;var du=gn.squaredLength;mt.squaredLength=du,mt.sqrLen=du;var Kt={};function kp(t){return kp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kp(t)}Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.create=Lp,Kt.clone=function(t){var e=new Js.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Kt.fromValues=function(t,e){var i=new Js.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Kt.set=function(t,e,i){return t[0]=e,t[1]=i,t},Kt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Kt.subtract=Fp,Kt.multiply=Np,Kt.divide=zp,Kt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Kt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Kt.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Kt.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Kt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Kt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Kt.scaleAndAdd=function(t,e,i,a){return t[0]=e[0]+i[0]*a,t[1]=e[1]+i[1]*a,t},Kt.distance=Bp,Kt.squaredDistance=Vp,Kt.length=jp,Kt.squaredLength=Up,Kt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Kt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Kt.normalize=function(t,e){var i=e[0],a=e[1],u=i*i+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},Kt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Kt.cross=function(t,e,i){var a=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=a,t},Kt.lerp=function(t,e,i,a){var u=e[0],d=e[1];return t[0]=u+a*(i[0]-u),t[1]=d+a*(i[1]-d),t},Kt.random=function(t,e){e=e||1;var i=2*Js.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Kt.transformMat2=function(t,e,i){var a=e[0],u=e[1];return t[0]=i[0]*a+i[2]*u,t[1]=i[1]*a+i[3]*u,t},Kt.transformMat2d=function(t,e,i){var a=e[0],u=e[1];return t[0]=i[0]*a+i[2]*u+i[4],t[1]=i[1]*a+i[3]*u+i[5],t},Kt.transformMat3=function(t,e,i){var a=e[0],u=e[1];return t[0]=i[0]*a+i[3]*u+i[6],t[1]=i[1]*a+i[4]*u+i[7],t},Kt.transformMat4=function(t,e,i){var a=e[0],u=e[1];return t[0]=i[0]*a+i[4]*u+i[12],t[1]=i[1]*a+i[5]*u+i[13],t},Kt.rotate=function(t,e,i,a){var u=e[0]-i[0],d=e[1]-i[1],p=Math.sin(a),_=Math.cos(a);return t[0]=u*_-d*p+i[0],t[1]=u*p+d*_+i[1],t},Kt.angle=function(t,e){var i=t[0],a=t[1],u=e[0],d=e[1],p=Math.sqrt(i*i+a*a)*Math.sqrt(u*u+d*d);return Math.acos(Math.min(Math.max(p&&(i*u+a*d)/p,-1),1))},Kt.zero=function(t){return t[0]=0,t[1]=0,t},Kt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Kt.equals=function(t,e){var i=t[0],a=t[1],u=e[0],d=e[1];return Math.abs(i-u)<=Js.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-d)<=Js.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},Kt.forEach=Kt.sqrLen=Kt.sqrDist=Kt.dist=Kt.div=Kt.mul=Kt.sub=Kt.len=void 0;var Js=function(t,e){if(t&&t.__esModule)return t;if(t===null||kp(t)!=="object"&&typeof t!="function")return{default:t};var i=Op(void 0);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}(ft);function Op(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Op=function(a){return a?i:e})(t)}function Lp(){var t=new Js.ARRAY_TYPE(2);return Js.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Fp(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Np(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function zp(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function Bp(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Vp(t,e){var i=e[0]-t[0],a=e[1]-t[1];return i*i+a*a}function jp(t){return Math.hypot(t[0],t[1])}function Up(t){var e=t[0],i=t[1];return e*e+i*i}Kt.len=jp,Kt.sub=Fp,Kt.mul=Np,Kt.div=zp,Kt.dist=Bp,Kt.sqrDist=Vp,Kt.sqrLen=Up;var ny=function(){var t=Lp();return function(e,i,a,u,d,p){var _,y;for(i||(i=2),a||(a=0),y=u?Math.min(u*i+a,e.length):e.length,_=a;_<y;_+=i)t[0]=e[_],t[1]=e[_+1],d(t,t,p),e[_]=t[0],e[_+1]=t[1];return e}}();function Bl(t){return Bl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bl(t)}Kt.forEach=ny,Object.defineProperty(tt,"__esModule",{value:!0}),r.aA=tt.vec4=r._=tt.vec3=tt.vec2=tt.quat2=r.av=tt.quat=r.ad=tt.mat4=r.bC=tt.mat3=tt.mat2d=r.aC=tt.mat2=tt.glMatrix=void 0;var fd=Yo(ft);tt.glMatrix=fd;var pd=Yo(Et);r.aC=tt.mat2=pd;var iy=Yo(wn);tt.mat2d=iy;var ry=Yo(Nt);r.bC=tt.mat3=ry;var oy=Yo(Rt);r.ad=tt.mat4=oy;var Vl=Yo(Ot);r.av=tt.quat=Vl;var ln=Yo(mt);tt.quat2=ln;var l1=Yo(Kt);tt.vec2=l1;var c1=Yo(zt);r._=tt.vec3=c1;var u1=Yo(Bt);function $p(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return($p=function(a){return a?i:e})(t)}function Yo(t,e){if(t&&t.__esModule)return t;if(t===null||Bl(t)!=="object"&&typeof t!="function")return{default:t};var i=$p(e);if(i&&i.has(t))return i.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,i&&i.set(t,a),a}r.aA=tt.vec4=u1;var Gp=fu;function fu(t,e,i,a){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=a}fu.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,a=0;a<8;a++){var u=this.sampleCurveX(i)-t;if(Math.abs(u)<e)return i;var d=this.sampleCurveDerivativeX(i);if(Math.abs(d)<1e-6)break;i-=u/d}var p=0,_=1;for(i=t,a=0;a<20&&(u=this.sampleCurveX(i),!(Math.abs(u-t)<e));a++)t>u?p=i:_=i,i=.5*(_-p)+p;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var pu=Fe(Gp),md=Va;function Va(t,e){this.x=t,this.y=e}Va.prototype={clone:function(){return new Va(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(t,e){var i=Math.cos(t),a=Math.sin(t),u=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Va.convert=function(t){return t instanceof Va?t:Array.isArray(t)?new Va(t[0],t[1]):t};var lt=Fe(md);let sy=Math.PI/180,mu=180/Math.PI;function dn(t){return t*sy}function mr(t){return t*mu}let ay=[[0,0],[1,0],[1,1],[0,1]];function Hp(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function gu(t,e,i,a){let u=new pu(t,e,i,a);return function(d){return u.solve(d)}}let jl=gu(.25,.1,.25,1);function tn(t,e,i){return Math.min(i,Math.max(e,t))}function ja(t,e,i){return(i=tn((i-t)/(e-t),0,1))*i*(3-2*i)}function Ua(t,e,i){let a=i-e,u=((t-e)%a+a)%a+e;return u===e?i:u}function Ul(t,e,i){if(!t.length)return i(null,[]);let a=t.length,u=new Array(t.length),d=null;t.forEach((p,_)=>{e(p,(y,b)=>{y&&(d=y),u[_]=b,--a==0&&i(d,u)})})}function fo(t){let e=[];for(let i in t)e.push(t[i]);return e}function gr(t,...e){for(let i of e)for(let a in i)t[a]=i[a];return t}let h1=1;function gd(){return h1++}function _d(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function qp(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Wp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function yd(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function _u(t,e){return t.indexOf(e,t.length-e.length)!==-1}function $l(t,e,i){let a={};for(let u in t)a[u]=e.call(this,t[u],u,t);return a}function $a(t,e,i){let a={};for(let u in t)e.call(this,t[u],u,t)&&(a[u]=t[u]);return a}function Xo(t){return Array.isArray(t)?t.map(Xo):typeof t=="object"&&t?$l(t,Xo):t}let Zp={};function ki(t){Zp[t]||(typeof console<"u"&&console.warn(t),Zp[t]=!0)}function Ko(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Ir(t){let e=0;for(let i,a,u=0,d=t.length,p=d-1;u<d;p=u++)i=t[u],a=t[p],e+=(a.x-i.x)*(i.y+a.y);return e}function gs([t,e,i]){let a=dn(e+90),u=dn(i);return{x:t*Math.cos(a)*Math.sin(u),y:t*Math.sin(a)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:i}}function nr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yp(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,u,d)=>{let p=u||d;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){let i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Xp,vd,Gl,yu,_s,vu,xd=null;function Ga(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function xu(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Kp(t,e,i,a){for(;e<i;){let u=e+i>>1;t[u]<a?e=u+1:i=u}return e}function ly(t,e,i,a){for(;e<i;){let u=e+i>>1;t[u]<=a?e=u+1:i=u}return e}function bd(t){return t>0?1/(1.001-t):1+t}function wd(t){return t>0?1-1/(1.001-t):-t}function Hl(){return Xp==null&&(Xp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Xp}let ir={now:()=>yu!==void 0?yu:performance.now(),setNow(t){yu=t},restoreNow(){yu=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:i,height:a}=t;_s||(_s=document.createElement("canvas"));let u=_s.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>_s.width||a>_s.height)&&(_s.width=i,_s.height=a),u.clearRect(-e,-e,i+2*e,a+2*e),u.drawImage(t,0,0,i,a),u.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:t=>(vd||(vd=document.createElement("a")),vd.href=t,vd.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Gl==null&&(Gl=window.matchMedia("(prefers-reduced-motion: reduce)")),Gl.matches)},hasCanvasFingerprintNoise(){if(vu!==void 0)return vu;if(!Hl())return vu=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),i=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);let a=e.getImageData(0,0,t.width,t.height);i=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&i++!==a.data[u])return vu=!0,!0;return vu=!1,!1}};function Ed(t,e){let i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(i));for(let u in e)a.set(u,e[u]);return`${t.slice(0,i)}?${a.toString()}`}function Qp(t,e={persistentParams:[]}){let i=t.indexOf("?");if(i<0)return t;let a=new URLSearchParams,u=new URLSearchParams(t.slice(i));for(let p of e.persistentParams){let _=u.get(p);_&&a.set(p,_)}let d=a.toString();return`${t.slice(0,i)}${d.length>0?`?${d}`:""}`}let cy="mapbox-tiles",Jp=500,em=50,ys,Td;function uy(){try{return caches}catch{}}function bu(){let t=uy();t&&!ys&&(ys=t.open(cy))}let Cd=1/0,Id={supported:!1,testSupport:function(t){!tm&&Wl&&(nm?hy(t):ql=t)}},ql,Wl,tm=!1,nm=!1,im=typeof self<"u"?self:{};function hy(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Wl),t.isContextLost())return;Id.supported=!0}catch{}t.deleteTexture(e),tm=!0}im.document&&(Wl=im.document.createElement("img"),Wl.onload=function(){ql&&hy(ql),ql=null,nm=!0},Wl.onerror=function(){tm=!0,ql=null},Wl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Dd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Dd);class rm extends Error{constructor(e,i,a){i===401&&L(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Sd=nr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,wu=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Sd())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){let d=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Sd(),referrerPolicy:a.referrerPolicy,signal:d.signal}),_=!1,y=!1,b=(T=p.url).indexOf("sku=")>0&&L(T);var T;a.type==="json"&&p.headers.set("Accept","application/json");let D=(R,k,F)=>{if(y)return;if(R&&R.message!=="SecurityError"&&ki(R.toString()),k&&F)return S(k);let z=Date.now();fetch(p).then(j=>{if(j.ok){let Y=b?j.clone():null;return S(j,Y,z)}return u(new rm(j.statusText,j.status,a.url))}).catch(j=>{j.name!=="AbortError"&&u(new Error(`${j.message} ${a.url}`))})},S=(R,k,F)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then(z=>{y||(k&&F&&function(j,Y,X){if(bu(),!ys)return;let K=Yp(Y.headers.get("Cache-Control")||"");if(K["no-store"])return;let le={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((_e,Ee)=>le.headers.set(Ee,_e)),K["max-age"]&&le.headers.set("Expires",new Date(X+1e3*K["max-age"]).toUTCString());let se=le.headers.get("Expires");if(!se||new Date(se).getTime()-X<42e4)return;let me=Qp(j.url,{persistentParams:["language","worldview"]});if(Y.status===206){let _e=j.headers.get("Range");if(!_e)return;le.status=200,me=Ed(me,{range:_e})}(function(_e,Ee){if(Td===void 0)try{new Response(new ReadableStream),Td=!0}catch{Td=!1}Td?Ee(_e.body):_e.blob().then(Ee)})(Y,_e=>{let Ee=new Response((ke=Y.status)!==200&&ke!==404&&[101,103,204,205,304].includes(ke)?null:_e,le);var ke;bu(),ys&&ys.then(Se=>Se.put(me,Ee)).catch(Se=>ki(Se.message))})}(p,k,F),_=!0,u(null,z,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(z=>{y||u(new Error(z.message))})};return b?function(R,k){if(bu(),!ys)return k(null);ys.then(F=>{let z=Qp(R.url,{persistentParams:["language","worldview"]}),j=R.headers.get("Range");j&&(z=Ed(z,{range:j})),F.match(z).then(Y=>{let X=function(K){if(!K)return!1;let le=new Date(K.headers.get("Expires")||0),se=Yp(K.headers.get("Cache-Control")||"");return le>Date.now()&&!se["no-cache"]}(Y);F.delete(z),X&&F.put(z,Y.clone()),k(null,Y,X)}).catch(k)}).catch(k)}(p,D):D(null,null),{cancel:()=>{y=!0,_||d.abort()}}}(t,e);if(nr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(a,u){let d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let p in a.headers)d.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(a.type==="json")try{p=JSON.parse(d.response)}catch(_){return u(_)}u(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new rm(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(t,e)},Ha=function(t,e){return wu(gr(t,{type:"arrayBuffer"}),e)};function dy(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let om="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Eu,Tu;Eu=[],Tu=0;let ea=function(t,e){if(Id.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Tu>=A.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Eu.push(d),d}Tu++;let i=!1,a=()=>{if(!i)for(i=!0,Tu--;Eu.length&&Tu<A.MAX_PARALLEL_IMAGE_REQUESTS;){let d=Eu.shift(),{requestParameters:p,callback:_,cancelled:y}=d;y||(d.cancel=ea(p,_).cancel)}},u=Ha(t,(d,p,_,y)=>{a(),d?e(d):p&&(self.createImageBitmap?function(b,T){let D=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(D).then(S=>{T(null,S)}).catch(S=>{T(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(b,T)=>e(b,T,_,y)):function(b,T){let D=new Image;D.onload=()=>{T(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=om})},D.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(b)],{type:"image/png"});D.src=b.byteLength?URL.createObjectURL(S):om}(p,(b,T)=>e(b,T,_,y)))});return{cancel:()=>{u.cancel(),a()}}},sm="01",am="NO_ACCESS_TOKEN",d1=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mo(t){let e=t.match(d1);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Zl(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Md="mapbox.eventData";function fy(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Cu{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let i=fy(A.ACCESS_TOKEN),a="";return a=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(+("0x"+d)))):A.ACCESS_TOKEN||"",e?`${Md}.${e}:${a}`:`${Md}:${a}`}fetchEventData(){let e=Ga("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let u=localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));let d=localStorage.getItem(a);d&&(this.anonId=d)}catch{ki("Unable to read from LocalStorage")}}saveEventData(){let e=Ga("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(a,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{ki("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,a,u){if(!A.EVENTS_URL)return;let d=Mo(A.EVENTS_URL);d.params.push(`access_token=${u||A.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},_=i?gr(p,i):p,y={url:Zl(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,T){return wu(gr(b,{method:"POST"}),T)}(y,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}let py=new class extends Cu{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){A.EVENTS_URL&&A.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>U(i)||L(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=fy(A.ACCESS_TOKEN),i=e?e.u:A.ACCESS_TOKEN,a=i!==this.eventData.tokenU;Wp(this.anonId)||(this.anonId=_d(),a=!0);let u=this.queue.shift();if(this.eventData.lastSuccess){let d=new Date(this.eventData.lastSuccess),p=new Date(u),_=(u-this.eventData.lastSuccess)/864e5;a=a||_>=1||_<-1||d.getDate()!==p.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:sm,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},t):this.processRequests()}},lm=py.postTurnstileEvent.bind(py),Iu=new class extends Cu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,a){this.skuToken=e,this.errorCb=a,A.EVENTS_URL&&(i||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(am)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Wp(this.anonId)||(this.anonId=_d()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:sm,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},my=Iu.postMapLoadEvent.bind(Iu),gy=new class extends Cu{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=_d(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:i,style:a,importedStyles:u}=e;if(!A.EVENTS_URL||!t&&!A.ACCESS_TOKEN)return;let d=this.getMapInstanceId(i),p={mapInstanceId:d,eventId:this.getEventId(d),style:a};u.length&&(p.importedStyles=u),this.queueRequest({timestamp:Date.now(),payload:p},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:i}=this.queue.shift();this.postEvent(e,i,()=>{},t)}},f1=gy.postStyleLoadEvent.bind(gy),Ad=new class extends Cu{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){A.EVENTS_URL&&(t||A.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:i}=this.queue.shift(),a=function(u){let d=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),_=function(R){let k={};if(R){for(let F in R)if(F!=="other")for(let z of R[F]){let j=`${F}ResolveRangeMin`,Y=`${F}ResolveRangeMax`,X=`${F}RequestCount`,K=`${F}RequestCachedCount`;k[j]=Math.min(k[j]||1/0,z.startTime),k[Y]=Math.max(k[Y]||-1/0,z.responseEnd);let le=se=>{k[se]===void 0&&(k[se]=0),++k[se]};z.transferSize!==void 0&&z.transferSize===0&&le(K),le(X)}}return k}(function(R,k){let F={};if(R)for(let z of R){let j=k(z);F[j]===void 0&&(F[j]=[]),F[j].push(z)}return F}(d,Ke)),y=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=b?b.effectiveType:void 0,D={counters:[],metadata:[],attributes:[]},S=(R,k,F)=>{F!=null&&R.push({name:k,value:F.toString()})};for(let R in _)S(D.counters,R,_[R]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(S(D.counters,"interactionRangeMin",u.interactionRange[0]),S(D.counters,"interactionRangeMax",u.interactionRange[1])),p)for(let R of Object.keys(be)){let k=be[R],F=p.find(z=>z.name===k);F&&S(D.counters,k,F.startTime)}return S(D.counters,"visibilityHidden",u.visibilityHidden),S(D.attributes,"style",function(R){if(R)for(let k of R){let F=k.name.split("?")[0];if(he(F)){let z=F.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(d)),S(D.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),S(D.attributes,"fogEnabled",u.fogEnabled?"true":"false"),S(D.attributes,"projection",u.projection),S(D.attributes,"zoom",u.zoom),S(D.metadata,"devicePixelRatio",y),S(D.metadata,"connectionEffectiveType",T),S(D.metadata,"navigatorUserAgent",navigator.userAgent),S(D.metadata,"screenWidth",window.screen.width),S(D.metadata,"screenHeight",window.screen.height),S(D.metadata,"windowWidth",window.innerWidth),S(D.metadata,"windowHeight",window.innerHeight),S(D.metadata,"mapWidth",u.width/y),S(D.metadata,"mapHeight",u.height/y),S(D.metadata,"webglRenderer",u.renderer),S(D.metadata,"webglVendor",u.vendor),S(D.metadata,"sdkVersion",w),S(D.metadata,"sdkIdentifier","mapbox-gl-js"),D}(i);for(let u of a.metadata);for(let u of a.counters);for(let u of a.attributes);this.postEvent(e,a,()=>{},t)}},p1=Ad.postPerformanceEvent.bind(Ad),Yl=new class extends Cu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,a){if(!A.API_URL||!A.SESSION_PATH)return;let u=Mo(A.API_URL+A.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||A.ACCESS_TOKEN||""}`);let d={url:Zl(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,_){return wu(gr(p,{method:"GET"}),_)}(d,p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,i,a){this.skuToken=e,this.errorCb=a,A.SESSION_PATH&&A.API_URL&&(i||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(am)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Pd=Yl.getSessionAPI.bind(Yl),Du=new Set;var qa={exports:{}},_y={exports:function(t,e){var i,a,u,d,p,_,y,b;for(a=t.length-(i=3&t.length),u=e,p=3432918353,_=461845907,b=0;b<a;)y=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,u=27492+(65535&(d=5*(65535&(u=(u^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,i){case 3:y^=(255&t.charCodeAt(b+2))<<16;case 2:y^=(255&t.charCodeAt(b+1))<<8;case 1:u^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(b)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}},m1={exports:function(t,e){for(var i,a=t.length,u=e^a,d=0;a>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:u^=(255&t.charCodeAt(d+2))<<16;case 2:u^=(255&t.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}},yy=_y.exports,cm=m1.exports;qa.exports=yy,qa.exports.murmur3=yy,qa.exports.murmur2=cm;var Xl=Fe(qa.exports);function um(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function Kl(t,e,i){if(i&&i[t]){let a=i[t].indexOf(e);a!==-1&&i[t].splice(a,1)}}class kr{constructor(e,i={}){gr(this,i),this.type=e}}class Rd extends kr{constructor(e,i={}){super("error",gr({error:e},i))}}class Wa{on(e,i){return this._listeners=this._listeners||{},um(e,i,this._listeners),this}off(e,i){return Kl(e,i,this._listeners),Kl(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},um(e,i,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,i){typeof e=="string"&&(e=new kr(e,i||{}));let a=e.type;if(this.listens(a)){e.target=this;let u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let _ of u)_.call(this,e);let d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let _ of d)Kl(a,_,this._oneTimeListeners),_.call(this,e);let p=this._eventedParent;p&&(gr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Rd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}r.F=void 0;var vy={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function kd(t){return(t=Math.round(t))<0?0:t>255?255:t}function hm(t){return kd(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Su(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Mu(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{r.F={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in vy)return vy[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=i.indexOf("("),u=i.indexOf(")");if(a!==-1&&u+1===i.length){var d=i.substr(0,a),p=i.substr(a+1,u-(a+1)).split(","),_=1;switch(d){case"rgba":if(p.length!==4)return null;_=Su(p.pop());case"rgb":return p.length!==3?null:[hm(p[0]),hm(p[1]),hm(p[2]),_];case"hsla":if(p.length!==4)return null;_=Su(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,b=Su(p[1]),T=Su(p[2]),D=T<=.5?T*(b+1):T+b-T*b,S=2*T-D;return[kd(255*Mu(S,D,y+1/3)),kd(255*Mu(S,D,y)),kd(255*Mu(S,D,y-1/3)),_];default:return null}}return null}}catch{}class En{constructor(e,i,a,u=1){this.r=e,this.g=i,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof En)return e;if(typeof e!="string")return;let i=r.F(e);return i?new En(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[e,i,a,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${u})`}toRenderColor(e){let{r:i,g:a,b:u,a:d}=this;return new g1(e,i,a,u,d)}}class g1{constructor(e,i,a,u,d){if(e){let p=e.image.height,_=p*p;i=d===0?0:i/d*(p-1),a=d===0?0:a/d*(p-1),u=d===0?0:u/d*(p-1);let y=Math.floor(i),b=Math.floor(a),T=Math.floor(u),D=Math.ceil(i),S=Math.ceil(a),R=Math.ceil(u),k=i-y,F=a-b,z=u-T,j=e.image.data,Y=4*(y+b*_+T*p),X=4*(y+b*_+R*p),K=4*(y+S*_+T*p),le=4*(y+S*_+R*p),se=4*(D+b*_+T*p),me=4*(D+b*_+R*p),_e=4*(D+S*_+T*p),Ee=4*(D+S*_+R*p);if(Y<0||Ee>=j.length)throw new Error("out of range");this.r=Dt(Dt(Dt(j[Y],j[X],z),Dt(j[K],j[le],z),F),Dt(Dt(j[se],j[me],z),Dt(j[_e],j[Ee],z),F),k)/255*d,this.g=Dt(Dt(Dt(j[Y+1],j[X+1],z),Dt(j[K+1],j[le+1],z),F),Dt(Dt(j[se+1],j[me+1],z),Dt(j[_e+1],j[Ee+1],z),F),k)/255*d,this.b=Dt(Dt(Dt(j[Y+2],j[X+2],z),Dt(j[K+2],j[le+2],z),F),Dt(Dt(j[se+2],j[me+2],z),Dt(j[_e+2],j[Ee+2],z),F),k)/255*d,this.a=d}else this.r=i,this.g=a,this.b=u,this.a=d}toArray(){let{r:e,g:i,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*i/u,255*a/u,u]}toArray01(){let{r:e,g:i,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,i/u,a/u,u]}toArray01Scaled(e){let{r:i,g:a,b:u,a:d}=this;return d===0?[0,0,0]:[i/d*e,a/d*e,u/d*e]}toArray01PremultipliedAlpha(){let{r:e,g:i,b:a,a:u}=this;return[e,i,a,u]}toArray01Linear(){let{r:e,g:i,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(i/u,2.2),Math.pow(a/u,2.2),u]}}function Dt(t,e,i){return t*(1-i)+e*i}function xy(t,e,i){return t.map((a,u)=>Dt(a,e[u],i))}En.black=new En(0,0,0,1),En.white=new En(1,1,1,1),En.transparent=new En(0,0,0,0),En.red=new En(1,0,0,1),En.blue=new En(0,0,1,1);var Od=Object.freeze({__proto__:null,array:xy,color:function(t,e,i){return new En(Dt(t.r,e.r,i),Dt(t.g,e.g,i),Dt(t.b,e.b,i),Dt(t.a,e.a,i))},number:Dt});function dm(t,...e){for(let i of e)for(let a in i)t[a]=i[a];return t}class Qo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class fm{constructor(e,i=[]){this.parent=e,this.bindings={};for(let[a,u]of i)this.bindings[a]=u}concat(e){return new fm(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Ql={kind:"null"},dt={kind:"number"},Tn={kind:"string"},Cn={kind:"boolean"},Or={kind:"color"},Jl={kind:"object"},xn={kind:"value"},Ao={kind:"collator"},ec={kind:"formatted"},Jo={kind:"resolvedImage"};function Hr(t,e){return{kind:"array",itemType:t,N:e}}function Oi(t){if(t.kind==="array"){let e=Oi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let _1=[Ql,dt,Tn,Cn,Or,ec,Jl,Hr(xn),Jo];function Au(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Au(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let i of _1)if(!Au(i,e))return null}}return`Expected ${Oi(t)} but found ${Oi(e)} instead.`}function pm(t,e){return e.some(i=>i.kind===t.kind)}function tc(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class Pu{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Za{constructor(e,i,a,u,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=u,this.textColor=d}}class _r{constructor(e){this.sections=e}static fromString(e){return new _r([new Za(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof _r?e:_r.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);let a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class Lr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Lr({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function by(t,e,i,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,i,a]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fr(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof En||t instanceof Pu||t instanceof _r||t instanceof Lr)return!0;if(Array.isArray(t)){for(let e of t)if(!Fr(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Fr(t[e]))return!1;return!0}return!1}function Vi(t){if(t===null)return Ql;if(typeof t=="string")return Tn;if(typeof t=="boolean")return Cn;if(typeof t=="number")return dt;if(t instanceof En)return Or;if(t instanceof Pu)return Ao;if(t instanceof _r)return ec;if(t instanceof Lr)return Jo;if(Array.isArray(t)){let e=t.length,i;for(let a of t){let u=Vi(a);if(i){if(i===u)continue;i=xn;break}i=u}return Hr(i||xn,e)}return Jl}function po(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof En||t instanceof _r||t instanceof Lr?t.toString():JSON.stringify(t)}class vs{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Fr(e[1]))return i.error("invalid value");let a=e[1],u=Vi(a),d=i.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new vs(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof En?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof _r?this.value.serialize():this.value}}class Wi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let mm={string:Tn,number:dt,boolean:Cn,object:Jl};class Po{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,u=1,d=e[0];if(d==="array"){let _,y;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in mm)||b==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=mm[b],u++}else _=xn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);y=e[2],u++}a=Hr(_,y)}else a=mm[d];let p=[];for(;u<e.length;u++){let _=i.parse(e[u],u,xn);if(!_)return null;p.push(_)}return new Po(a,p)}evaluate(e){for(let i=0;i<this.args.length;i++){let a=this.args[i].evaluate(e);if(!Au(this.type,Vi(a)))return a;if(i===this.args.length-1)throw new Wi(`Expected value to be of type ${Oi(this.type)}, but found ${Oi(Vi(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,i=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);let u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(a=>a.serialize()))}}class Ru{constructor(e){this.type=ec,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");let u=[],d=!1;for(let p=1;p<=e.length-1;++p){let _=e[p];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let y=null;if(_["font-scale"]&&(y=i.parse(_["font-scale"],1,dt),!y))return null;let b=null;if(_["text-font"]&&(b=i.parse(_["text-font"],1,Hr(Tn)),!b))return null;let T=null;if(_["text-color"]&&(T=i.parse(_["text-color"],1,Or),!T))return null;let D=u[u.length-1];D.scale=y,D.font=b,D.textColor=T}else{let y=i.parse(e[p],1,xn);if(!y)return null;let b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:y,scale:null,font:null,textColor:null})}}return new Ru(u)}evaluate(e){return new _r(this.sections.map(i=>{let a=i.content.evaluate(e);return Vi(a)===Jo?new Za("",a,null,null,null):new Za(po(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class ku{constructor(e,i){this.type=Jo,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=i.parse(e[1],1,Tn);if(!a)return i.error("No image name provided.");if(e.length===2)return new ku(a);let u=i.parse(e[2],1,Tn);return u?new ku(a,u):i.error("Secondary image variant is not a string.")}evaluate(e){let i=Lr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ya(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let y1={"to-boolean":Cn,"to-color":Or,"to-number":dt,"to-string":Tn};class Ro{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a=e[0],u=[],d=Ql;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=Hr(i.expectedType.itemType,p)}else{if(!(p>0&&Fr(e[1][0])))return null;d=Hr(Vi(e[1][0]),p)}for(let _=0;_<p;_++){let y=e[1][_],b;if(Ya(y)==="array")b=i.parse(y,void 0,d.itemType);else{let T=Ya(y);if(T!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${T}.`);b=i.registry.literal.parse(["literal",y===void 0?null:y],i)}if(!b)return null;u.push(b)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=y1[a];for(let p=1;p<e.length;p++){let _=i.parse(e[p],p,xn);if(!_)return null;u.push(_)}}return new Ro(d,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(let u of this.args){if(i=u.evaluate(e),a=null,i instanceof En)return i;if(typeof i=="string"){let d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:by(i[0],i[1],i[2],i[3]),!a))return new En(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Wi(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let a of this.args){if(i=a.evaluate(e),i===null)return 0;let u=Number(i);if(!isNaN(u))return u}throw new Wi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?_r.fromString(po(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Lr.fromString(po(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):po(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ru([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ku(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}let wy=["Unknown","Point","LineString","Polygon"];class Ey{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=En.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Dr{constructor(e,i,a,u,d){this.name=e,this.type=i,this._evaluate=a,this.args=u,this._overloadIndex=d}evaluate(e){if(!this._evaluate){let i=Dr.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){let a=e[0],u=Dr.definitions[a];if(!u)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=[],y=null,b=-1;for(let[T,D]of p){if(Array.isArray(T)&&T.length!==e.length-1)continue;_.push(T),b++,y=new Oy(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);let S=[],R=!1;for(let k=1;k<e.length;k++){let F=e[k],z=Array.isArray(T)?T[k-1]:T.type,j=y.parse(F,1+S.length,z);if(!j){R=!0;break}S.push(j)}if(!R)if(Array.isArray(T)&&T.length!==S.length)y.error(`Expected ${T.length} arguments, but found ${S.length} instead.`);else{for(let k=0;k<S.length;k++){let F=Array.isArray(T)?T[k]:T.type,z=S[k];y.concat(k+1).checkSubtype(F,z.type)}if(y.errors.length===0)return new Dr(a,d,D,S,b)}}if(_.length===1)i.errors.push(...y.errors);else{let T=(_.length?_:p.map(([S])=>S)).map(gm).join(" | "),D=[];for(let S=1;S<e.length;S++){let R=i.parse(e[S],1+D.length);if(!R)return null;D.push(Oi(R.type))}i.error(`Expected arguments of type ${T}, but found (${D.join(", ")}) instead.`)}return null}static register(e,i){Dr.definitions=i;for(let a in i)e[a]=Dr}}function gm(t){return Array.isArray(t)?`(${t.map(Oi).join(", ")})`:`(${Oi(t.type)}...)`}class ta{constructor(e,i,a){this.type=Ao,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");let u=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Cn);if(!u)return null;let d=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Cn);if(!d)return null;let p=null;return a.locale&&(p=i.parse(a.locale,1,Tn),!p)?null:new ta(u,d,p)}evaluate(e){return new Pu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var _m={exports:{}};_m.exports=function(){function t(a,u,d,p,_){for(;p>d;){if(p-d>600){var y=p-d+1,b=u-d+1,T=Math.log(y),D=.5*Math.exp(2*T/3),S=.5*Math.sqrt(T*D*(y-D)/y)*(b-y/2<0?-1:1);t(a,u,Math.max(d,Math.floor(u-b*D/y+S)),Math.min(p,Math.floor(u+(y-b)*D/y+S)),_)}var R=a[u],k=d,F=p;for(e(a,d,u),_(a[p],R)>0&&e(a,d,p);k<F;){for(e(a,k,F),k++,F--;_(a[k],R)<0;)k++;for(;_(a[F],R)>0;)F--}_(a[d],R)===0?e(a,d,F):e(a,++F,p),F<=u&&(d=F+1),u<=F&&(p=F-1)}}function e(a,u,d){var p=a[u];a[u]=a[d],a[d]=p}function i(a,u){return a<u?-1:a>u?1:0}return function(a,u,d,p,_){t(a,u,d||0,p||a.length-1,_||i)}}();var v1=Fe(_m.exports);function x1(t){let e=0;for(let i,a,u=0,d=t.length,p=d-1;u<d;p=u++)i=t[u],a=t[p],e+=(a.x-i.x)*(i.y+a.y);return e}function Ou(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function nc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function b1(t,e,i){let a=t[0]-e[0],u=t[1]-e[1],d=t[0]-i[0],p=t[1]-i[1];return a*p-d*u==0&&a*d<=0&&u*p<=0}function ic(t,e,i=!1){let a=!1;for(let _=0,y=e.length;_<y;_++){let b=e[_];for(let T=0,D=b.length,S=D-1;T<D;S=T++){let R=b[S],k=b[T];if(b1(t,R,k))return i;(d=R)[1]>(u=t)[1]!=(p=k)[1]>u[1]&&u[0]<(p[0]-d[0])*(u[1]-d[1])/(p[1]-d[1])+d[0]&&(a=!a)}}var u,d,p;return a}function ym(t,e,i,a){let u=a[0]-i[0],d=a[1]-i[1],p=(t[0]-i[0])*d-u*(t[1]-i[1]),_=(e[0]-i[0])*d-u*(e[1]-i[1]);return p>0&&_<0||p<0&&_>0}function _n(t,e,i,a){return(u=[a[0]-i[0],a[1]-i[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*d[0]!=0&&!(!ym(t,e,i,a)||!ym(i,a,t,e));var u,d}let xs=8192;function Ty(t,e){let i=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*xs),Math.round(a*u*xs)]}function w1(t,e){for(let i=0;i<e.length;i++)if(ic(t,e[i]))return!0;return!1}function E1(t,e,i){for(let a of i)for(let u=0,d=a.length,p=d-1;u<d;p=u++)if(_n(t,e,a[p],a[u]))return!0;return!1}function Lu(t,e){for(let i=0;i<t.length;++i)if(!ic(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(E1(t[i],t[i+1],e))return!1;return!0}function Ld(t,e){for(let i=0;i<e.length;i++)if(Lu(t,e[i]))return!0;return!1}function rc(t,e,i){let a=[];for(let u=0;u<t.length;u++){let d=[];for(let p=0;p<t[u].length;p++){let _=Ty(t[u][p],i);Ou(e,_),d.push(_)}a.push(d)}return a}function Cy(t,e,i){let a=[];for(let u=0;u<t.length;u++){let d=rc(t[u],e,i);a.push(d)}return a}function vm(t,e,i,a){if(t[0]<i[0]||t[0]>i[2]){let u=.5*a,d=t[0]-i[0]>u?-a:i[0]-t[0]>u?a:0;d===0&&(d=t[0]-i[2]>u?-a:i[2]-t[0]>u?a:0),t[0]+=d}Ou(e,t)}function ko(t,e,i,a){let u=Math.pow(2,a.z)*xs,d=[a.x*xs,a.y*xs],p=[];if(!t)return p;for(let _ of t)for(let y of _){let b=[y.x+d[0],y.y+d[1]];vm(b,e,i,u),p.push(b)}return p}function Iy(t,e,i,a){let u=Math.pow(2,a.z)*xs,d=[a.x*xs,a.y*xs],p=[];if(!t)return p;for(let y of t){let b=[];for(let T of y){let D=[T.x+d[0],T.y+d[1]];Ou(e,D),b.push(D)}p.push(b)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let y of p)for(let b of y)vm(b,e,i,u)}var _;return p}class na{constructor(e,i){this.type=Cn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Fr(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){let d=a.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new na(a,a.features[u].geometry)}else if(a.type==="Feature"){let u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new na(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new na(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){let u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let _=rc(a.coordinates,d,p),y=ko(i.geometry(),u,d,p);if(!nc(u,d))return!1;for(let b of y)if(!ic(b,_))return!1}if(a.type==="MultiPolygon"){let _=Cy(a.coordinates,d,p),y=ko(i.geometry(),u,d,p);if(!nc(u,d))return!1;for(let b of y)if(!w1(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){let u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let _=rc(a.coordinates,d,p),y=Iy(i.geometry(),u,d,p);if(!nc(u,d))return!1;for(let b of y)if(!Lu(b,_))return!1}if(a.type==="MultiPolygon"){let _=Cy(a.coordinates,d,p),y=Iy(i.geometry(),u,d,p);if(!nc(u,d))return!1;for(let b of y)if(!Ld(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let ia={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Fd=1/298.257223563,Dy=Fd*(2-Fd),Fu=Math.PI/180;class Nu{static fromTile(e,i,a){let u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Fu;return new Nu(d,a)}static get units(){return ia}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!ia[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(ia).join(", ")}`);let a=6378.137*Fu*(i?ia[i]:1),u=Math.cos(e*Fu),d=1/(1-Dy*(1-u*u)),p=Math.sqrt(d);this.kx=a*p*u,this.ky=a*p*d*(1-Dy)}distance(e,i){let a=mo(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+u*u)}bearing(e,i){let a=mo(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/Fu}destination(e,i,a){let u=a*Fu;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){let u=e[a];for(let d=0,p=u.length,_=p-1;d<p;_=d++)i+=mo(u[d][0]-u[_][0])*(u[d][1]+u[_][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){let d=e[u],p=e[u+1],_=this.distance(d,p);if(a+=_,a>i)return zu(d,p,(i-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[u,d]=i,p=mo(a[0]-u)*this.kx,_=(a[1]-d)*this.ky;if(p!==0||_!==0){let y=(mo(e[0]-u)*this.kx*p+(e[1]-d)*this.ky*_)/(p*p+_*_);y>1?(u=a[0],d=a[1]):y>0&&(u+=p/this.kx*y,d+=_/this.ky*y)}return p=mo(e[0]-u)*this.kx,_=(e[1]-d)*this.ky,Math.sqrt(p*p+_*_)}pointOnLine(e,i){let a=1/0,u=e[0][0],d=e[0][1],p=0,_=0;for(let y=0;y<e.length-1;y++){let b=e[y][0],T=e[y][1],D=mo(e[y+1][0]-b)*this.kx,S=(e[y+1][1]-T)*this.ky,R=0;D===0&&S===0||(R=(mo(i[0]-b)*this.kx*D+(i[1]-T)*this.ky*S)/(D*D+S*S),R>1?(b=e[y+1][0],T=e[y+1][1]):R>0&&(b+=D/this.kx*R,T+=S/this.ky*R)),D=mo(i[0]-b)*this.kx,S=(i[1]-T)*this.ky;let k=D*D+S*S;k<a&&(a=k,u=b,d=T,p=y,_=R)}return{point:[u,d],index:p,t:Math.max(0,Math.min(1,_))}}lineSlice(e,i,a){let u=this.pointOnLine(a,e),d=this.pointOnLine(a,i);if(u.index>d.index||u.index===d.index&&u.t>d.t){let b=u;u=d,d=b}let p=[u.point],_=u.index+1,y=d.index;!xm(a[_],p[0])&&_<=y&&p.push(a[_]);for(let b=_+1;b<=y;b++)p.push(a[b]);return xm(a[y],d.point)||p.push(d.point),p}lineSliceAlong(e,i,a){let u=0,d=[];for(let p=0;p<a.length-1;p++){let _=a[p],y=a[p+1],b=this.distance(_,y);if(u+=b,u>e&&d.length===0&&d.push(zu(_,y,(e-(u-b))/b)),u>=i)return d.push(zu(_,y,(i-(u-b))/b)),d;u>e&&d.push(y)}return d}bufferPoint(e,i){let a=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-a,e[0]+u,e[1]+a]}bufferBBox(e,i){let a=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-a,e[2]+u,e[3]+a]}insideBBox(e,i){return mo(e[0]-i[0])>=0&&mo(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function xm(t,e){return t[0]===e[0]&&t[1]===e[1]}function zu(t,e,i){let a=mo(e[0]-t[0]);return[t[0]+a*i,t[1]+(e[1]-t[1])*i]}function mo(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var Bu={exports:{}};(function(t,e){t.exports=function(){var i=function(u,d){if(u===void 0&&(u=[]),d===void 0&&(d=a),this.data=u,this.length=this.data.length,this.compare=d,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function a(u,d){return u<d?-1:u>d?1:0}return i.prototype.push=function(u){this.data.push(u),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var u=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),u}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(u){for(var d=this.data,p=this.compare,_=d[u];u>0;){var y=u-1>>1,b=d[y];if(p(_,b)>=0)break;d[u]=b,u=y}d[u]=_},i.prototype._down=function(u){for(var d=this.data,p=this.compare,_=this.length>>1,y=d[u];u<_;){var b=1+(u<<1),T=d[b],D=b+1;if(D<this.length&&p(d[D],T)<0&&(b=D,T=d[D]),p(T,y)>=0)break;d[u]=T,u=b}d[u]=y},i}()})(Bu);var bm=Fe(Bu.exports),rt=8192;function Sy(t,e){return e.dist-t.dist}let wm=100,Em=50;function My(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function Nd(t){return t[1]-t[0]+1}function es(t,e){let i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function ra(t,e){if(t[0]>t[1])return[null,null];let i=Nd(t);if(e){if(i===2)return[t,null];let a=Math.floor(i/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(i===1)return[t,null];let a=Math.floor(i/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function Xa(t,e){let i=[1/0,1/0,-1/0,-1/0];if(!es(e,t.length))return i;for(let a=e[0];a<=e[1];++a)Ou(i,t[a]);return i}function zd(t){let e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let a=0;a<t[i].length;++a)Ou(e,t[i][a]);return e}function oa(t,e,i){if(My(t)||My(e))return NaN;let a=0,u=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),i.distance([0,0],[a,u])}function T1(t){return 360*t-180}function C1(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Tm(t,e){let i=Math.pow(2,e.z),a=(t.y/rt+e.y)/i;return[T1((t.x/rt+e.x)/i),C1(a)]}function I1(t,e){let i=[];for(let a=0;a<t.length;++a)i.push(Tm(t[a],e));return i}function Ay(t,e,i){let a=i.pointOnLine(e,t).point;return i.distance(t,a)}function sa(t,e,i,a,u){let d=i.slice(a[0],a[1]+1),p=1/0;for(let _=e[0];_<=e[1];++_)if((p=Math.min(p,Ay(t[_],d,u)))===0)return 0;return p}function Cm(t,e,i,a,u){let d=Math.min(u.pointToSegmentDistance(t,i,a),u.pointToSegmentDistance(e,i,a)),p=Math.min(u.pointToSegmentDistance(i,t,e),u.pointToSegmentDistance(a,t,e));return Math.min(d,p)}function D1(t,e,i,a,u){if(!es(e,t.length)||!es(a,i.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let _=a[0];_<a[1];++_){if(_n(t[p],t[p+1],i[_],i[_+1]))return 0;d=Math.min(d,Cm(t[p],t[p+1],i[_],i[_+1],u))}return d}function Py(t,e,i,a,u){if(!es(e,t.length)||!es(a,i.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let _=a[0];_<=a[1];++_)if((d=Math.min(d,u.distance(t[p],i[_])))===0)return d;return d}function Ry(t,e,i){if(ic(t,e,!0))return 0;let a=1/0;for(let u of e){let d=u.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[d-1]&&(a=Math.min(a,i.pointToSegmentDistance(t,u[d-1],u[0])))===0||(a=Math.min(a,Ay(t,u,i)))===0)return a}return a}function Oo(t,e,i,a){if(!es(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(ic(t[d],i,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d)for(let p of i)for(let _=0,y=p.length,b=y-1;_<y;b=_++){if(_n(t[d],t[d+1],p[b],p[_]))return 0;u=Math.min(u,Cm(t[d],t[d+1],p[b],p[_],a))}return u}function Im(t,e){for(let i of t)for(let a=0;a<=i.length-1;++a)if(ic(i[a],e,!0))return!0;return!1}function S1(t,e,i,a=1/0){let u=zd(t),d=zd(e);if(a!==1/0&&oa(u,d,i)>=a)return a;if(nc(u,d)){if(Im(t,e))return 0}else if(Im(e,t))return 0;let p=a;for(let _ of t)for(let y=0,b=_.length,T=b-1;y<b;T=y++)for(let D of e)for(let S=0,R=D.length,k=R-1;S<R;k=S++){if(_n(_[T],_[y],D[k],D[S]))return 0;p=Math.min(p,Cm(_[T],_[y],D[k],D[S],i))}return p}function Vu(t,e,i,a,u,d,p){if(d===null||p===null)return;let _=oa(Xa(a,d),Xa(u,p),i);_<e&&t.push({dist:_,range1:d,range2:p})}function Bd(t,e,i,a,u=1/0){let d=Math.min(a.distance(t[0],i[0][0]),u);if(d===0)return d;let p=new bm([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Sy),_=e?Em:wm,y=zd(i);for(;p.length;){let b=p.pop();if(b.dist>=d)continue;let T=b.range1;if(Nd(T)<=_){if(!es(T,t.length))return NaN;if(e){let D=Oo(t,T,i,a);if((d=Math.min(d,D))===0)return d}else for(let D=T[0];D<=T[1];++D){let S=Ry(t[D],i,a);if((d=Math.min(d,S))===0)return d}}else{let D=ra(T,e);if(D[0]!==null){let S=oa(Xa(t,D[0]),y,a);S<d&&p.push({dist:S,range1:D[0],range2:[0,0]})}if(D[1]!==null){let S=oa(Xa(t,D[1]),y,a);S<d&&p.push({dist:S,range1:D[1],range2:[0,0]})}}}return d}function ky(t,e,i,a,u,d=1/0){let p=Math.min(d,u.distance(t[0],i[0]));if(p===0)return p;let _=new bm([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Sy),y=e?Em:wm,b=a?Em:wm;for(;_.length;){let T=_.pop();if(T.dist>=p)continue;let D=T.range1,S=T.range2;if(Nd(D)<=y&&Nd(S)<=b){if(!es(D,t.length)||!es(S,i.length))return NaN;if(e&&a?p=Math.min(p,D1(t,D,i,S,u)):e||a?e&&!a?p=Math.min(p,sa(i,S,t,D,u)):!e&&a&&(p=Math.min(p,sa(t,D,i,S,u))):p=Math.min(p,Py(t,D,i,S,u)),p===0)return p}else{let R=ra(D,e),k=ra(S,a);Vu(_,p,u,t,i,R[0],k[0]),Vu(_,p,u,t,i,R[0],k[1]),Vu(_,p,u,t,i,R[1],k[0]),Vu(_,p,u,t,i,R[1],k[1])}}return p}function Dm(t,e,i,a,u=1/0){let d=u,p=Xa(t,[0,t.length-1]);for(let _ of i)if(!(d!==1/0&&oa(p,Xa(_,[0,_.length-1]),a)>=d)&&(d=Math.min(d,ky(t,e,_,!0,a,d)),d===0))return d;return d}function Vd(t,e,i,a,u=1/0){let d=u,p=Xa(t,[0,t.length-1]);for(let _ of i){if(d!==1/0&&oa(p,zd(_),a)>=d)continue;let y=Bd(t,e,_,a,d);if(isNaN(y))return y;if((d=Math.min(d,y))===0)return d}return d}function Sm(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ka{constructor(e,i){this.type=dt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Fr(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(Sm(a.features[u].geometry.type))return new Ka(a,a.features[u].geometry)}else if(a.type==="Feature"){if(Sm(a.geometry.type))return new Ka(a,a.geometry)}else if(Sm(a.type))return new Ka(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(u,d,p){let _=[];for(let b of u)for(let T of b)_.push(Tm(T,d));let y=new Nu(_[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?ky(_,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?Dm(_,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?Vd(_,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(u,d,p){let _=[];for(let b of u){let T=[];for(let D of b)T.push(Tm(D,d));_.push(T)}let y=new Nu(_[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Dm(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let b=1/0;for(let T=0;T<p.coordinates.length;T++){let D=Dm(p.coordinates[T],!0,_,y,b);if(isNaN(D))return D;if((b=Math.min(b,D))===0)return b}return b}if(p.type==="Polygon"||p.type==="MultiPolygon"){let b=1/0;for(let T=0;T<_.length;T++){let D=Vd(_[T],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,b);if(isNaN(D))return D;if((b=Math.min(b,D))===0)return b}return b}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,d,p){let _=[];for(let b of function(T,D){let S=T.length;if(S<=1)return[T];let R=[],k,F;for(let z=0;z<S;z++){let j=x1(T[z]);j!==0&&(T[z].area=Math.abs(j),F===void 0&&(F=j<0),F===j<0?(k&&R.push(k),k=[T[z]]):k.push(T[z]))}return k&&R.push(k),R}(u)){let T=[];for(let D=0;D<b.length;++D)T.push(I1(b[D],d));_.push(T)}let y=new Nu(_[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Vd(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let b=1/0;for(let T=0;T<p.coordinates.length;T++){let D=Vd(p.coordinates[T],!0,_,y,b);if(isNaN(D))return D;if((b=Math.min(b,D))===0)return b}return b}return p.type==="Polygon"||p.type==="MultiPolygon"?function(b,T,D){let S=1/0;for(let R of b)for(let k of T){let F=S1(R,k,D,S);if(isNaN(F))return F;if((S=Math.min(S,F))===0)return S}return S}(p.type==="Polygon"?[p.coordinates]:p.coordinates,_,y):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function oc(t,e){switch(t){case"string":return po(e);case"number":return+e;case"boolean":return!!e;case"color":return En.parse(e);case"formatted":return _r.fromString(po(e));case"resolvedImage":return Lr.fromString(po(e))}return e}function ju(t,e,i,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class rr{constructor(e,i,a){this.type=e,this.key=i,this.scope=a}static parse(e,i){let a=i.expectedType;if(a==null&&(a=xn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");let u=i.parse(e[1],1);if(!(u instanceof vs))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let d=i.parse(e[2],2);return d instanceof vs?new rr(a,po(u.value),po(d.value)):i.error("Scope of 'config' expression must be a string literal.")}return new rr(a,po(u.value))}evaluate(e){let i=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(i);if(!a)return null;let{type:u,value:d,values:p,minValue:_,maxValue:y,stepValue:b}=a,T=a.default.evaluate(e),D=T;if(d){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),D=d.evaluate(e),e.scope=S}return u&&(D=oc(u,D)),D===void 0||_===void 0&&y===void 0&&b===void 0||(typeof D=="number"?D=ju(D,_,y,b):Array.isArray(D)&&(D=D.map(S=>typeof S=="number"?ju(S,_,y,b):S))),d!==void 0&&D!==void 0&&p&&!p.includes(D)&&(D=T,u&&(D=oc(u,D))),(u&&u!==this.type||D!==void 0&&Vi(D)!==this.type)&&(D=oc(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function aa(t){if(t instanceof Dr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof na||t instanceof Ka)return!1;let e=!0;return t.eachChild(i=>{e&&!aa(i)&&(e=!1)}),e}function jd(t){if(t instanceof Dr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!jd(i)&&(e=!1)}),e}function Mm(t){if(t instanceof rr)return!1;let e=!0;return t.eachChild(i=>{e&&!Mm(i)&&(e=!1)}),e}function Uu(t,e){if(t instanceof Dr&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(a=>{i&&!Uu(a,e)&&(i=!1)}),i}class Ud{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let a=e[1];return i.scope.has(a)?new Ud(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class $u{constructor(e,i=[],a,u=new fm,d=[],p,_){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=u,this.errors=d,this.expectedType=a,this._scope=p,this.options=_}parse(e,i,a,u,d={}){return i||a?this.concat(i,a,u)._parse(e,d):this._parse(e,d)}_parse(e,i){function a(u,d,p){return p==="assert"?new Po(d,[u]):p==="coerce"?new Ro(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){let p=this.expectedType,_=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||_.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(p,_))return null}else d=a(d,p,i.typeAnnotation||"coerce");else d=a(d,p,i.typeAnnotation||"assert")}if(!(d instanceof vs)&&d.type.kind!=="resolvedImage"&&Gu(d)){let p=new Ey(this._scope,this.options);try{d=new vs(d.type,d.evaluate(p))}catch(_){return this.error(_.message),null}}return d}return Ro.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){let u=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new $u(this.registry,u,i||null,d,this.errors,this._scope,this.options)}error(e,...i){let a=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Qo(a,e))}checkSubtype(e,i){let a=Au(e,i);return a&&this.error(a),a}}var Oy=$u;function Gu(t){if(t instanceof Ud)return Gu(t.boundExpression);if(t instanceof Dr&&t.name==="error"||t instanceof ta||t instanceof na||t instanceof Ka||t instanceof rr)return!1;let e=t instanceof Ro||t instanceof Po,i=!0;return t.eachChild(a=>{i=e?i&&Gu(a):i&&a instanceof vs}),!!i&&aa(t)&&Uu(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function $d(t,e){let i=t.length-1,a,u,d=0,p=i,_=0;for(;d<=p;)if(_=Math.floor((d+p)/2),a=t[_],u=t[_+1],a<=e){if(_===i||e<u)return _;d=_+1}else{if(!(a>e))throw new Wi("Input is not a number.");p=_-1}return 0}class Hu{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(let[u,d]of a)this.labels.push(u),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let a=i.parse(e[1],1,dt);if(!a)return null;let u=[],d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let p=1;p<e.length;p+=2){let _=p===1?-1/0:e[p],y=e[p+1],b=p,T=p+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(u.length&&u[u.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let D=i.parse(y,T,d);if(!D)return null;d=d||D.type,u.push([_,D])}return new Hu(d,a,u)}evaluate(e){let i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);let u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);let d=i.length;return u>=i[d-1]?a[d-1].evaluate(e):a[$d(i,u)].evaluate(e)}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}let Gd=.95047,Ly=1.08883,Am=4/29,Qa=6/29,Fy=3*Qa*Qa,Pm=Qa*Qa*Qa,Hd=Math.PI/180,Ny=180/Math.PI;function Rm(t){return t>Pm?Math.pow(t,1/3):t/Fy+Am}function qd(t){return t>Qa?t*t*t:Fy*(t-Am)}function km(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function qu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function zy(t){let e=qu(t.r),i=qu(t.g),a=qu(t.b),u=Rm((.4124564*e+.3575761*i+.1804375*a)/Gd),d=Rm((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-Rm((.0193339*e+.119192*i+.9503041*a)/Ly)),alpha:t.a}}function By(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*qd(e),i=Gd*qd(i),a=Ly*qd(a),new En(km(3.2404542*i-1.5371385*e-.4985314*a),km(-.969266*i+1.8760108*e+.041556*a),km(.0556434*i-.2040259*e+1.0572252*a),t.alpha)}function M1(t,e,i){let a=e-t;return t+i*(a>180||a<-180?a-360*Math.round(a/360):a)}let Wu={forward:zy,reverse:By,interpolate:function(t,e,i){return{l:Dt(t.l,e.l,i),a:Dt(t.a,e.a,i),b:Dt(t.b,e.b,i),alpha:Dt(t.alpha,e.alpha,i)}}},sc={forward:function(t){let{l:e,a:i,b:a}=zy(t),u=Math.atan2(a,i)*Ny;return{h:u<0?u+360:u,c:Math.sqrt(i*i+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Hd,i=t.c;return By({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:M1(t.h,e.h,i),c:Dt(t.c,e.c,i),l:Dt(t.l,e.l,i),alpha:Dt(t.alpha,e.alpha,i)}}};var Vy=Object.freeze({__proto__:null,hcl:sc,lab:Wu});class eo{constructor(e,i,a,u,d){this.type=e,this.operator=i,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(let[p,_]of d)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,i,a,u){let d=0;if(e.name==="exponential")d=Om(i,e.base,a,u);else if(e.name==="linear")d=Om(i,1,a,u);else if(e.name==="cubic-bezier"){let p=e.controlPoints;d=new pu(p[0],p[1],p[2],p[3]).solve(Om(i,1,a,u))}return d}static parse(e,i){let[a,u,d,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){let b=u[1];if(typeof b!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:b}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{let b=u.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,dt),!d)return null;let _=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=Or:i.expectedType&&i.expectedType.kind!=="value"&&(y=i.expectedType);for(let b=0;b<p.length;b+=2){let T=p[b],D=p[b+1],S=b+3,R=b+4;if(typeof T!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(_.length&&_[_.length-1][0]>=T)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let k=i.parse(D,R,y);if(!k)return null;y=y||k.type,_.push([T,k])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new eo(y,a,u,d,_):i.error(`Type ${Oi(y)} is not interpolatable.`)}evaluate(e){let i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);let u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);let d=i.length;if(u>=i[d-1])return a[d-1].evaluate(e);let p=$d(i,u),_=eo.interpolationFactor(this.interpolation,u,i[p],i[p+1]),y=a[p].evaluate(e),b=a[p+1].evaluate(e);return this.operator==="interpolate"?Od[this.type.kind.toLowerCase()](y,b,_):this.operator==="interpolate-hcl"?sc.reverse(sc.interpolate(sc.forward(y),sc.forward(b),_)):Wu.reverse(Wu.interpolate(Wu.forward(y),Wu.forward(b),_))}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Om(t,e,i,a){let u=a-i,d=t-i;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}class Wd{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null,u=i.expectedType;u&&u.kind!=="value"&&(a=u);let d=[];for(let _ of e.slice(1)){let y=i.parse(_,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,d.push(y)}let p=u&&d.some(_=>Au(u,_.type));return new Wd(p?xn:a,d)}evaluate(e){let i,a=null,u=0;for(let d of this.args){if(u++,a=d.evaluate(e),a&&a instanceof Lr&&!a.available&&(i||(i=a),a=null,u===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Zd{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let d=1;d<e.length-1;d+=2){let p=e[d];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);let _=i.parse(e[d+1],d+1);if(!_)return null;a.push([p,_])}let u=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return u?new Zd(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Lm{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=i.parse(e[1],1,dt),u=i.parse(e[2],2,Hr(i.expectedType||xn));return a&&u?new Lm(u.type.itemType,a,u):null}evaluate(e){let i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Wi(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Wi(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Wi(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fm{constructor(e,i){this.type=Cn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=i.parse(e[1],1,xn),u=i.parse(e[2],2,xn);return a&&u?pm(a.type,[Cn,Tn,dt,Ql,xn])?new Fm(a,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(a.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!tc(i,["boolean","string","number","null"]))throw new Wi(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(Vi(i))} instead.`);if(!tc(a,["string","array"]))throw new Wi(`Expected second argument to be of type array or string, but found ${Oi(Vi(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Yd{constructor(e,i,a){this.type=dt,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=i.parse(e[1],1,xn),u=i.parse(e[2],2,xn);if(!a||!u)return null;if(!pm(a.type,[Cn,Tn,dt,Ql,xn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(a.type)} instead`);if(e.length===4){let d=i.parse(e[3],3,dt);return d?new Yd(a,u,d):null}return new Yd(a,u)}evaluate(e){let i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!tc(i,["boolean","string","number","null"]))throw new Wi(`Expected first argument to be of type boolean, string, number or null, but found ${Oi(Vi(i))} instead.`);if(!tc(a,["string","array"]))throw new Wi(`Expected second argument to be of type array or string, but found ${Oi(Vi(a))} instead.`);if(this.fromIndex){let u=this.fromIndex.evaluate(e);return a.indexOf(i,u)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ac{constructor(e,i,a,u,d,p){this.inputType=e,this.type=i,this.input=a,this.cases=u,this.outputs=d,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);let d={},p=[];for(let b=2;b<e.length-1;b+=2){let T=e[b],D=e[b+1];Array.isArray(T)||(T=[T]);let S=i.concat(b);if(T.length===0)return S.error("Expected at least one branch label.");for(let k of T){if(typeof k!="number"&&typeof k!="string")return S.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return S.error("Numeric branch labels must be integer values.");if(a){if(S.checkSubtype(a,Vi(k)))return null}else a=Vi(k);if(d[String(k)]!==void 0)return S.error("Branch labels must be unique.");d[String(k)]=p.length}let R=i.parse(D,b,u);if(!R)return null;u=u||R.type,p.push(R)}let _=i.parse(e[1],1,xn);if(!_)return null;let y=i.parse(e[e.length-1],e.length-1,u);return y?_.type.kind!=="value"&&i.concat(1).checkSubtype(a,_.type)?null:new ac(a,u,_,d,p,y):null}evaluate(e){let i=this.input.evaluate(e);return(Vi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],u={};for(let p of i){let _=u[this.cases[p]];_===void 0?(u[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[_][1].push(p)}let d=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,_]of a)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Nm{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);let u=[];for(let p=1;p<e.length-1;p+=2){let _=i.parse(e[p],p,Cn);if(!_)return null;let y=i.parse(e[p+1],p+1,a);if(!y)return null;u.push([_,y]),a=a||y.type}let d=i.parse(e[e.length-1],e.length-1,a);return d?new Nm(a,u,d):null}evaluate(e){for(let[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Xd{constructor(e,i,a,u){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=i.parse(e[1],1,xn),u=i.parse(e[2],2,dt);if(!a||!u)return null;if(!pm(a.type,[Hr(xn),Tn,xn]))return i.error(`Expected first argument to be of type array or string, but found ${Oi(a.type)} instead`);if(e.length===4){let d=i.parse(e[3],3,dt);return d?new Xd(a.type,a,u,d):null}return new Xd(a.type,a,u)}evaluate(e){let i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!tc(i,["string","array"]))throw new Wi(`Expected first argument to be of type array or string, but found ${Oi(Vi(i))} instead.`);if(this.endIndex){let u=this.endIndex.evaluate(e);return i.slice(a,u)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Zu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jy(t,e,i,a){return a.compare(e,i)===0}function Ja(t,e,i){let a=t!=="=="&&t!=="!=";return class WN{constructor(d,p,_){this.type=Cn,this.lhs=d,this.rhs=p,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");let _=d[0],y=p.parse(d[1],1,xn);if(!y)return null;if(!Zu(_,y.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${Oi(y.type)}'.`);let b=p.parse(d[2],2,xn);if(!b)return null;if(!Zu(_,b.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${Oi(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${Oi(y.type)}' and '${Oi(b.type)}'.`);a&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new Po(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new Po(y.type,[b])));let T=null;if(d.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(d[3],3,Ao),!T)return null}return new WN(y,b,T)}evaluate(d){let p=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){let y=Vi(p),b=Vi(_);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new Wi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=Vi(p),b=Vi(_);if(y.kind!=="string"||b.kind!=="string")return e(d,p,_)}return this.collator?i(d,p,_,this.collator.evaluate(d)):e(d,p,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[t];return this.eachChild(p=>{d.push(p.serialize())}),d}}}let A1=Ja("==",function(t,e,i){return e===i},jy),Uy=Ja("!=",function(t,e,i){return e!==i},function(t,e,i,a){return!jy(0,e,i,a)}),$y=Ja("<",function(t,e,i){return e<i},function(t,e,i,a){return a.compare(e,i)<0}),Gy=Ja(">",function(t,e,i){return e>i},function(t,e,i,a){return a.compare(e,i)>0}),Hy=Ja("<=",function(t,e,i){return e<=i},function(t,e,i,a){return a.compare(e,i)<=0}),zm=Ja(">=",function(t,e,i){return e>=i},function(t,e,i,a){return a.compare(e,i)>=0});class Yu{constructor(e,i,a,u,d,p){this.type=Tn,this.number=e,this.locale=i,this.currency=a,this.unit=u,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");let a=i.parse(e[1],1,dt);if(!a)return null;let u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=i.parse(u.locale,1,Tn),!d))return null;let p=null;if(u.currency&&(p=i.parse(u.currency,1,Tn),!p))return null;let _=null;if(u.unit&&(_=i.parse(u.unit,1,Tn),!_))return null;let y=null;if(u["min-fraction-digits"]&&(y=i.parse(u["min-fraction-digits"],1,dt),!y))return null;let b=null;return u["max-fraction-digits"]&&(b=i.parse(u["max-fraction-digits"],1,dt),!b)?null:new Yu(a,d,p,_,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Bm{constructor(e){this.type=dt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Oi(a.type)} instead.`):new Bm(a):null}evaluate(e){let i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Wi(`Expected value to be of type string or array, but found ${Oi(Vi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function qy(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let el={"==":A1,"!=":Uy,">":Gy,"<":$y,">=":zm,"<=":Hy,array:Po,at:Lm,boolean:Po,case:Nm,coalesce:Wd,collator:ta,format:Ru,image:ku,in:Fm,"index-of":Yd,interpolate:eo,"interpolate-hcl":eo,"interpolate-lab":eo,length:Bm,let:Zd,literal:vs,match:ac,number:Po,"number-format":Yu,object:Po,slice:Xd,step:Hu,string:Po,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:Ud,within:na,distance:Ka,config:rr};function Wy(t,[e,i,a,u]){e=e.evaluate(t),i=i.evaluate(t),a=a.evaluate(t);let d=u?u.evaluate(t):1,p=by(e,i,a,d);if(p)throw new Wi(p);return new En(e/255*d,i/255*d,a/255*d,d)}function Zy(t,[e,i,a,u]){e=e.evaluate(t),i=i.evaluate(t),a=a.evaluate(t);let d=u?u.evaluate(t):1,p=function(b,T,D,S){return typeof b=="number"&&b>=0&&b<=360?typeof T=="number"&&T>=0&&T<=100&&typeof D=="number"&&D>=0&&D<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[b,T,D,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[b,T,D,S]:[b,T,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[b,T,D,S]:[b,T,D]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,d);if(p)throw new Wi(p);let _=`hsla(${e}, ${i}%, ${a}%, ${d})`,y=En.parse(_);if(!y)throw new Wi(`Failed to parse HSLA color: ${_}`);return y}function Yy(t,e){return t in e}function Vm(t,e){let i=e[t];return i===void 0?null:i}function tl(t){return{type:t}}function Xy(t){return{result:"success",value:t}}function nl(t){return{result:"error",value:t}}function Ky(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Kd(t){return t["property-type"]==="data-driven"}function P1(t){return Ky(t.expression,"measure-light")}function m(t){return Ky(t.expression,"zoom")}function s(t){return!!t.expression&&t.expression.interpolated}function h(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function v(t,e){let i=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",u=a||!(a||t.property!==void 0),d=t.type||(s(e)?"exponential":"interval");if(i&&((t=dm({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],En.parse(b[1])])),t.default=En.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Vy[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,_,y;if(d==="exponential")p=M;else if(d==="interval")p=C;else if(d==="categorical"){p=E,_=Object.create(null);for(let b of t.stops)_[b[0]]=b[1];y=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=P}if(a){let b={},T=[];for(let R=0;R<t.stops.length;R++){let k=t.stops[R],F=k[0].zoom;b[F]===void 0&&(b[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},T.push(F)),b[F].stops.push([k[0].value,k[1]])}let D=[];for(let R of T)D.push([b[R].zoom,v(b[R],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:eo.interpolationFactor.bind(void 0,S),zoomStops:D.map(R=>R[0]),evaluate:({zoom:R},k)=>M({stops:D,base:t.base},e,R).evaluate(R,k)}}if(u){let b=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:eo.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(t,e,T,_,y)}}return{kind:"source",evaluate(b,T){let D=T&&T.properties?T.properties[t.property]:void 0;return D===void 0?x(t.default,e.default):p(t,e,D,_,y)}}}function x(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function E(t,e,i,a,u){return x(typeof i===u?a[i]:void 0,t.default,e.default)}function C(t,e,i){if(Ya(i)!=="number")return x(t.default,e.default);let a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];let u=$d(t.stops.map(d=>d[0]),i);return t.stops[u][1]}function M(t,e,i){let a=t.base!==void 0?t.base:1;if(Ya(i)!=="number")return x(t.default,e.default);let u=t.stops.length;if(u===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[u-1][0])return t.stops[u-1][1];let d=$d(t.stops.map(T=>T[0]),i),p=function(T,D,S,R){let k=R-S,F=T-S;return k===0?0:D===1?F/k:(Math.pow(D,F)-1)/(Math.pow(D,k)-1)}(i,a,t.stops[d][0],t.stops[d+1][0]),_=t.stops[d][1],y=t.stops[d+1][1],b=Od[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=Vy[t.colorSpace];b=(D,S)=>T.reverse(T.interpolate(T.forward(D),T.forward(S),p))}return typeof _.evaluate=="function"?{evaluate(...T){let D=_.evaluate.apply(void 0,T),S=y.evaluate.apply(void 0,T);if(D!==void 0&&S!==void 0)return b(D,S,p)}}:b(_,y,p)}function P(t,e,i){return e.type==="color"?i=En.parse(i):e.type==="formatted"?i=_r.fromString(i.toString()):e.type==="resolvedImage"?i=Lr.fromString(i.toString()):Ya(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),x(i,t.default,e.default)}Dr.register(el,{error:[{kind:"error"},[Tn],(t,[e])=>{throw new Wi(e.evaluate(t))}],typeof:[Tn,[xn],(t,[e])=>Oi(Vi(e.evaluate(t)))],"to-rgba":[Hr(dt,4),[Or],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[Or,[dt,dt,dt],Wy],rgba:[Or,[dt,dt,dt,dt],Wy],hsl:[Or,[dt,dt,dt],Zy],hsla:[Or,[dt,dt,dt,dt],Zy],has:{type:Cn,overloads:[[[Tn],(t,[e])=>Yy(e.evaluate(t),t.properties())],[[Tn,Jl],(t,[e,i])=>Yy(e.evaluate(t),i.evaluate(t))]]},get:{type:xn,overloads:[[[Tn],(t,[e])=>Vm(e.evaluate(t),t.properties())],[[Tn,Jl],(t,[e,i])=>Vm(e.evaluate(t),i.evaluate(t))]]},"feature-state":[xn,[Tn],(t,[e])=>Vm(e.evaluate(t),t.featureState||{})],properties:[Jl,[],t=>t.properties()],"geometry-type":[Tn,[],t=>t.geometryType()],id:[xn,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],pitch:[dt,[],t=>t.globals.pitch||0],"distance-from-center":[dt,[],t=>t.distanceFromCenter()],"measure-light":[dt,[Tn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],"raster-value":[dt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[dt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[dt,[],t=>t.globals.skyRadialProgress||0],accumulated:[xn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[dt,tl(dt),(t,e)=>{let i=0;for(let a of e)i+=a.evaluate(t);return i}],"*":[dt,tl(dt),(t,e)=>{let i=1;for(let a of e)i*=a.evaluate(t);return i}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[dt,[dt,dt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,tl(dt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[dt,tl(dt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{let i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Cn,[Tn,xn],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Cn,[xn],(t,[e])=>t.id()===e.value],"filter-type-==":[Cn,[Tn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Cn,[Tn,xn],(t,[e,i])=>{let a=t.properties()[e.value],u=i.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Cn,[xn],(t,[e])=>{let i=t.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Cn,[Tn,xn],(t,[e,i])=>{let a=t.properties()[e.value],u=i.value;return typeof a==typeof u&&a>u}],"filter-id->":[Cn,[xn],(t,[e])=>{let i=t.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Cn,[Tn,xn],(t,[e,i])=>{let a=t.properties()[e.value],u=i.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Cn,[xn],(t,[e])=>{let i=t.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Cn,[Tn,xn],(t,[e,i])=>{let a=t.properties()[e.value],u=i.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Cn,[xn],(t,[e])=>{let i=t.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Cn,[xn],(t,[e])=>e.value in t.properties()],"filter-has-id":[Cn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Cn,[Hr(Tn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Cn,[Hr(xn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Cn,[Tn,Hr(xn)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Cn,[Tn,Hr(xn)],(t,[e,i])=>function(a,u,d,p){for(;d<=p;){let _=d+p>>1;if(u[_]===a)return!0;u[_]>a?p=_-1:d=_+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Cn,overloads:[[[Cn,Cn],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[tl(Cn),(t,e)=>{for(let i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[tl(Cn),(t,e)=>{for(let i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Cn,[Cn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Cn,[Tn],(t,[e])=>{let i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Tn,[Tn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Tn,[Tn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Tn,tl(xn),(t,e)=>e.map(i=>po(i.evaluate(t))).join("")],"resolved-locale":[Tn,[Ao],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[dt,[dt,dt,xn],(t,e)=>{let[i,a,u]=e.map(p=>p.evaluate(t));if(i>a||i===a)return i;let d;if(typeof u=="string")d=function(p){let _=0;if(p.length===0)return _;for(let y=0;y<p.length;y++)_=(_<<5)-_+p.charCodeAt(y),_|=0;return _}(u);else{if(typeof u!="number")throw new Wi(`Invalid seed input: ${u}`);d=u}return i+qy(d)()*(a-i)}]});class O{constructor(e,i,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Ey(a,u),this._defaultValue=i?function(d){return d.type==="color"&&(h(d.default)||Array.isArray(d.default))?new En(0,0,0,0):d.type==="color"?En.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,a,u,d,p,_,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,u,d,p,_,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Wi(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function N(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in el}function B(t,e,i,a){let u=new Oy(el,[],e?function(p){let _={color:Or,string:Tn,number:dt,enum:Tn,boolean:Cn,formatted:ec,resolvedImage:Jo};return p.type==="array"?Hr(_[p.value]||xn,p.length):_[p.type]}(e):void 0,void 0,void 0,i,a),d=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Xy(new O(d,e,i,a)):nl(u.errors)}class V{constructor(e,i,a){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!jd(i.expression),this.isConfigDependent=!Mm(i.expression)}evaluateWithoutErrorHandling(e,i,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,d,p)}evaluate(e,i,a,u,d,p){return this._styleExpression.evaluate(e,i,a,u,d,p)}}class G{constructor(e,i,a,u,d){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!jd(i.expression),this.isLightConstant=d,this.isConfigDependent=!Mm(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,d,p)}evaluate(e,i,a,u,d,p){return this._styleExpression.evaluate(e,i,a,u,d,p)}interpolationFactor(e,i,a){return this.interpolationType?eo.interpolationFactor(this.interpolationType,e,i,a):0}}function H(t,e,i,a){if((t=B(t,e,i,a)).result==="error")return t;let u=t.value.expression,d=aa(u);if(!d&&!Kd(e))return nl([new Qo("","data expressions not supported")]);let p=Uu(u,["zoom","pitch","distance-from-center"]);if(!p&&!m(e))return nl([new Qo("","zoom expressions not supported")]);let _=Uu(u,["measure-light"]);if(!_&&!P1(e))return nl([new Qo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,b=W(u);return b||p||y?b instanceof Qo?nl([b]):b instanceof eo&&!s(e)?nl([new Qo("",'"interpolate" expressions cannot be used with this property')]):Xy(b?new G(d?"camera":"composite",t.value,b.labels,b instanceof eo?b.interpolation:void 0,_):new V(d?"constant":"source",t.value,_)):nl([new Qo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class q{constructor(e,i){this._parameters=e,this._specification=i,dm(this,v(this._parameters,this._specification))}static deserialize(e){return new q(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function W(t){let e=null;if(t instanceof Zd)e=W(t.result);else if(t instanceof Wd){for(let i of t.args)if(e=W(i),e)break}else(t instanceof Hu||t instanceof eo)&&t.input instanceof Dr&&t.input.name==="zoom"&&(e=t);return e instanceof Qo||t.eachChild(i=>{let a=W(i);a instanceof Qo?e=a:e&&a&&e!==a&&(e=new Qo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ee=ne,te=3;function ne(t,e,i){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var d=0;d<this.d*this.d;d++){var p=u[te+d],_=u[te+d+1];a.push(p===_?null:u.subarray(p,_))}var y=u[te+a.length+1];this.keys=u.subarray(u[te+a.length],y),this.bboxes=u.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var T=i/e*t;this.min=-T,this.max=t+T}ne.prototype.insert=function(t,e,i,a,u){this._forEachCell(e,i,a,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u)},ne.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ne.prototype._insertCell=function(t,e,i,a,u,d){this.cells[u].push(d)},ne.prototype.query=function(t,e,i,a,u){var d=this.min,p=this.max;if(t<=d&&e<=d&&p<=i&&p<=a&&!u)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,i,a,this._queryCell,_,{},u),_},ne.prototype._queryCell=function(t,e,i,a,u,d,p,_){var y=this.cells[u];if(y!==null)for(var b=this.keys,T=this.bboxes,D=0;D<y.length;D++){var S=y[D];if(p[S]===void 0){var R=4*S;(_?_(T[R+0],T[R+1],T[R+2],T[R+3]):t<=T[R+2]&&e<=T[R+3]&&i>=T[R+0]&&a>=T[R+1])?(p[S]=!0,d.push(b[S])):p[S]=!1}}},ne.prototype._forEachCell=function(t,e,i,a,u,d,p,_){for(var y=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(i),D=this._convertToCellCoord(a),S=y;S<=T;S++)for(var R=b;R<=D;R++){var k=this.d*R+S;if((!_||_(this._convertFromCellCoord(S),this._convertFromCellCoord(R),this._convertFromCellCoord(S+1),this._convertFromCellCoord(R+1)))&&u.call(this,t,e,i,a,k,d,p,_))return}},ne.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ne.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ne.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=te+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,p=0;p<t.length;p++){var _=t[p];u[te+p]=d,u.set(_,d),d+=_.length}return u[te+t.length]=d,u.set(this.keys,d),u[te+t.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};var ue=Fe(ee);let ce={};function J(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),ce[e]={klass:t,omit:i.omit||[]}}J(Object,"Object"),ue.serialize=function(t,e){let i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},ue.deserialize=function(t){return new ue(t.buffer)},Object.defineProperty(ue,"name",{value:"Grid"}),J(ue,"Grid"),J(En,"Color"),J(Error,"Error"),J(_r,"Formatted"),J(Za,"FormattedSection"),J(rm,"AJAXError"),J(Lr,"ResolvedImage"),J(q,"StylePropertyFunction"),J(O,"StyleExpression",{omit:["_evaluator"]}),J(G,"ZoomDependentExpression"),J(V,"ZoomConstantExpression"),J(Dr,"CompoundExpression",{omit:["_evaluate"]});for(let t in el)ce[el[t]._classRegistryKey]||J(el[t],`Expression${t}`);function ie(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function re(t){return self.ImageBitmap&&t instanceof ImageBitmap}function ge(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ie(t)||re(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let i=[];for(let a of t)i.push(ge(a,e));return i}if(t instanceof Map){let i={$name:"Map"};for(let[a,u]of t.entries())i[a]=ge(u);return i}if(typeof t=="object"){let i=t.constructor,a=i._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let u=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(let d in t)t.hasOwnProperty(d)&&(ce[a].omit.indexOf(d)>=0||(u[d]=ge(t[d],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof t)}function Ce(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ie(t)||re(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ce);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let u=new Map;for(let d of Object.keys(t))d!=="$name"&&u.set(d,Ce(t[d]));return u}let{klass:i}=ce[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);let a=Object.create(i.prototype);for(let u of Object.keys(t))u!=="$name"&&(a[u]=Ce(t[u]));return a}throw new Error("can't deserialize object of type "+typeof t)}let ae={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ie(t){for(let e of t)if(Ge(e.charCodeAt(0)))return!0;return!1}function Me(t){for(let e of t)if(!$e(e.charCodeAt(0)))return!1;return!0}function $e(t){return!(ae.Arabic(t)||ae["Arabic Supplement"](t)||ae["Arabic Extended-A"](t)||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t))}function Ge(t){return!(t!==746&&t!==747&&(t<4352||!(ae["Bopomofo Extended"](t)||ae.Bopomofo(t)||ae["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ae["CJK Compatibility Ideographs"](t)||ae["CJK Compatibility"](t)||ae["CJK Radicals Supplement"](t)||ae["CJK Strokes"](t)||!(!ae["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ae["CJK Unified Ideographs Extension A"](t)||ae["CJK Unified Ideographs"](t)||ae["Enclosed CJK Letters and Months"](t)||ae["Hangul Compatibility Jamo"](t)||ae["Hangul Jamo Extended-A"](t)||ae["Hangul Jamo Extended-B"](t)||ae["Hangul Jamo"](t)||ae["Hangul Syllables"](t)||ae.Hiragana(t)||ae["Ideographic Description Characters"](t)||ae.Kanbun(t)||ae["Kangxi Radicals"](t)||ae["Katakana Phonetic Extensions"](t)||ae.Katakana(t)&&t!==12540||!(!ae["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ae["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ae["Unified Canadian Aboriginal Syllabics"](t)||ae["Unified Canadian Aboriginal Syllabics Extended"](t)||ae["Vertical Forms"](t)||ae["Yijing Hexagram Symbols"](t)||ae["Yi Syllables"](t)||ae["Yi Radicals"](t))))}function Ve(t){return!(Ge(t)||function(e){return!!(ae["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ae["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ae["Letterlike Symbols"](e)||ae["Number Forms"](e)||ae["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ae["Control Pictures"](e)&&e!==9251||ae["Optical Character Recognition"](e)||ae["Enclosed Alphanumerics"](e)||ae["Geometric Shapes"](e)||ae["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ae["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ae["CJK Symbols and Punctuation"](e)||ae.Katakana(e)||ae["Private Use Area"](e)||ae["CJK Compatibility Forms"](e)||ae["Small Form Variants"](e)||ae["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function xe(t){return t>=1424&&t<=2303||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t)}function Re(t,e){return!(!e&&xe(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ae.Khmer(t))}function Ne(t){for(let e of t)if(xe(e.charCodeAt(0)))return!0;return!1}let ot="deferred",ct="loading",at="loaded",je=null,He="unavailable",st=null,pt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(He="error"),je&&je(t)};function Lt(){Wt.fire(new kr("pluginStateChange",{pluginStatus:He,pluginURL:st}))}let Wt=new Wa,fn=function(){return He},cn=function(){if(He!==ot||!st)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");He=ct,Lt(),st&&Ha({url:st},t=>{t?pt(t):(He=at,Lt())})},kn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>He===at||kn.applyArabicShaping!=null,isLoading:()=>He===ct,setState(t){He=t.pluginStatus,st=t.pluginURL},isParsed:()=>kn.applyArabicShaping!=null&&kn.processBidirectionalText!=null&&kn.processStyledBidirectionalText!=null,getPluginURL:()=>st};class $t{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(let u of i)if(!Re(u.charCodeAt(0),a))return!1;return!0}(e,kn.isLoaded())}}class Mn{constructor(e,i,a,u){this.property=e,this.value=i,this.expression=function(d,p,_,y){if(h(d))return new q(d,p);if(N(d)||Array.isArray(d)&&d.length>0){let b=H(d,p,_,y);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=d;return typeof d=="string"&&p.type==="color"&&(b=En.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(i===void 0?e.specification.default:i,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class Yn{constructor(e,i,a){this.property=e,this.value=new Mn(e,void 0,i,a)}transitioned(e,i){return new on(this.property,this.value,i,gr({},e.transition,this.transition),e.now)}untransitioned(){return new on(this.property,this.value,null,{},0)}}class Ln{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this.isConfigDependent=!1}getValue(e){return Xo(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Yn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Mn(this._values[e].property,i===null?void 0:Xo(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);let a=this._properties.properties;if(e)for(let u in e){let d=e[u];if(_u(u,"-transition")){let p=u.slice(0,-11);a[p]&&this.setTransition(p,d)}else a.hasOwnProperty(u)&&this.setValue(u,d)}}getTransition(e){return Xo(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Yn(this._values[e].property)),this._values[e].transition=Xo(i)||void 0}serialize(){let e={};for(let i of Object.keys(this._values)){let a=this.getValue(i);a!==void 0&&(e[i]=a);let u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){let a=new Gt(this._properties);for(let u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,i._values[u]);return a}untransitioned(){let e=new Gt(this._properties);for(let i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class on{constructor(e,i,a,u,d){let p=u.delay||0,_=u.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+p,this.end=this.begin+_,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){let u=e.now||0,d=this.value.possiblyEvaluate(e,i,a),p=this.prior;if(p){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return p.possiblyEvaluate(e,i,a);{let _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,a),d,Hp(_))}}return d}}class Gt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){let u=new pn(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,i,a);return u}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ei{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this.isConfigDependent=!1}getValue(e){return Xo(this._values[e].value)}setValue(e,i){this._values[e]=new Mn(this._values[e].property,i===null?void 0:Xo(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let i of Object.keys(this._values)){let a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){let u=new pn(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,i,a);return u}}class ii{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,u){return this.property.evaluate(this.value,this.parameters,e,i,a,u)}}class pn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Be{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){let u=Od[this.specification.type];return u?u(e,i,a):e}}class ut{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,u){return new ii(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,u)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new ii(this,{kind:"constant",value:void 0},e.parameters);let u=Od[this.specification.type];return u?new ii(this,{kind:"constant",value:u(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,u,d,p){return e.kind==="constant"?e.value:e.evaluate(i,a,u,d,p)}}class $i{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,u){return!!e.expression.evaluate(i,null,{},a,u)}interpolate(){return!1}}class On{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new $t(0,{});for(let a in e){let u=e[a];u.specification.overridable&&this.overridableProperties.push(a);let d=this.defaultPropertyValues[a]=new Mn(u,void 0),p=this.defaultTransitionablePropertyValues[a]=new Yn(u);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(i)}}}J(ut,"DataDrivenProperty"),J(Be,"DataConstantProperty"),J($i,"ColorRampProperty");var Te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Nr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function yr(t){if(Array.isArray(t))return t.map(yr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let i in t)e[i]=yr(t[i]);return e}return Nr(t)}function Zi(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Zi(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sr(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Zi(t)||(t=ts(t));let i=t,a=!0;try{a=function(b){if(!to(b))return b;let T=yr(b);return go(T),T=qr(T),T}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}let u=Te[`filter_${e}`],d=B(a,u),p=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));p=(b,T,D)=>d.value.evaluate(b,T,{},D);let _=null,y=null;if(a!==i){let b=B(i,u);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,D,S,R,k)=>b.value.evaluate(T,D,{},S,void 0,void 0,R,k),y=!aa(b.value.expression)}return{filter:p,dynamicFilter:_||void 0,needGeometry:bs(a),needFeature:!!y}}function qr(t){if(!Array.isArray(t))return t;let e=function(i){if(la.has(i[0])){for(let a=1;a<i.length;a++)if(to(i[a]))return!0}return i}(t);return e===!0?e:e.map(i=>qr(i))}function go(t){let e=!1,i=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||to(t[a]),i.push(t[a+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||to(t[1]);for(let a=2;a<t.length-1;a+=2)i.push(t[a+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||to(t[1]);for(let a=1;a<t.length-1;a+=2)i.push(t[a+1])}e&&(t.length=0,t.push("any",...i));for(let a=1;a<t.length;a++)go(t[a])}function to(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(to(t[i]))return!0;return!1}let la=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ca(t,e){return t<e?-1:t>e?1:0}function bs(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(bs(t[e]))return!0;return!1}function ts(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?ws(t[1],t[2],"=="):e==="!="?cc(ws(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ws(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(ts))):e==="all"?["all"].concat(t.slice(1).map(ts)):e==="none"?["all"].concat(t.slice(1).map(ts).map(cc)):e==="in"?lc(t[1],t.slice(2)):e==="!in"?cc(lc(t[1],t.slice(2))):e==="has"?Xu(t[1]):e!=="!has"||cc(Xu(t[1]));var i}function ws(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function lc(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(ca)]]:["filter-in-small",t,["literal",e]]}}function Xu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function cc(t){return["!",t]}let uc="";function Qd(t,e){return e?`${t}${uc}${e}`:t}let Jd="-transition",il=new Set(["fill","line","background","hillshade","raster"]);class vr extends Wa{constructor(e,i,a,u,d){if(super(),this.id=e.id,this.fqid=Qd(this.id,a),this.type=e.type,this.scope=a,this.lut=u,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new ei(i.layout,this.scope,d),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Ln(i.paint,this.scope,d);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pn(i.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return il.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return _u(e,Jd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){let a=this._transitionablePaint,u=a._properties.properties;if(_u(e,Jd)){let D=e.slice(0,-11);return u[D]&&a.setTransition(D,i||void 0),!1}if(!u[e])return!1;let d=a._values[e],p=d.value.isDataDriven(),_=d.value;a.setValue(e,i),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,b=y.isDataDriven(),T=_u(e,"pattern")||e==="line-dasharray";return b||p||T||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return $a({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let i=this.paint.get(e);if(i instanceof ii&&Kd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,a,u,d,p,_,y,b){}queryIntersectsMatchingFeature(e,i,a,u){}}let jm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qy{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function An(t,e=1){let i=0,a=0;return{members:t.map(u=>{let d=jm[u.type].BYTES_PER_ELEMENT,p=i=cS(i,Math.max(e,d)),_=u.components||1;return a=Math.max(a,d),i+=d*_,{name:u.name,type:u.type,components:_,offset:p}}),size:cS(i,Math.max(a,e)),alignment:e}}function cS(t,e){return Math.ceil(t/e)*e}class Es extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){let a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){let u=2*e;return this.int16[u+0]=i,this.int16[u+1]=a,e}}Es.prototype.bytesPerElement=4,J(Es,"StructArrayLayout2i4");class Jy extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){let d=3*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=u,e}}Jy.prototype.bytesPerElement=6,J(Jy,"StructArrayLayout3i6");class hc extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,u)}emplace(e,i,a,u,d){let p=4*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=u,this.int16[p+3]=d,e}}hc.prototype.bytesPerElement=8,J(hc,"StructArrayLayout4i8");class R1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u,d)}emplace(e,i,a,u,d,p){let _=5*e;return this.int16[_+0]=i,this.int16[_+1]=a,this.int16[_+2]=u,this.int16[_+3]=d,this.int16[_+4]=p,e}}R1.prototype.bytesPerElement=10,J(R1,"StructArrayLayout5i10");class k1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,u,d,p,_)}emplace(e,i,a,u,d,p,_,y){let b=6*e,T=12*e,D=3*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.uint8[T+4]=u,this.uint8[T+5]=d,this.uint8[T+6]=p,this.uint8[T+7]=_,this.float32[D+2]=y,e}}k1.prototype.bytesPerElement=12,J(k1,"StructArrayLayout2i4ub1f12");class dc extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,u)}emplace(e,i,a,u,d){let p=4*e;return this.float32[p+0]=i,this.float32[p+1]=a,this.float32[p+2]=u,this.float32[p+3]=d,e}}dc.prototype.bytesPerElement=16,J(dc,"StructArrayLayout4f16");class fc extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){let d=3*e;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=u,e}}fc.prototype.bytesPerElement=12,J(fc,"StructArrayLayout3f12");class pc extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u,d)}emplace(e,i,a,u,d,p){let _=6*e,y=3*e;return this.uint16[_+0]=i,this.uint16[_+1]=a,this.uint16[_+2]=u,this.uint16[_+3]=d,this.float32[y+2]=p,e}}pc.prototype.bytesPerElement=12,J(pc,"StructArrayLayout4ui1f12");class e0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,u)}emplace(e,i,a,u,d){let p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=a,this.uint16[p+2]=u,this.uint16[p+3]=d,e}}e0.prototype.bytesPerElement=8,J(e0,"StructArrayLayout4ui8");class t0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,u,d,p)}emplace(e,i,a,u,d,p,_){let y=6*e;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=d,this.int16[y+4]=p,this.int16[y+5]=_,e}}t0.prototype.bytesPerElement=12,J(t0,"StructArrayLayout6i12");class O1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_,y,b,T,D,S){let R=this.length;return this.resize(R+1),this.emplace(R,e,i,a,u,d,p,_,y,b,T,D,S)}emplace(e,i,a,u,d,p,_,y,b,T,D,S,R){let k=12*e;return this.int16[k+0]=i,this.int16[k+1]=a,this.int16[k+2]=u,this.int16[k+3]=d,this.uint16[k+4]=p,this.uint16[k+5]=_,this.uint16[k+6]=y,this.uint16[k+7]=b,this.int16[k+8]=T,this.int16[k+9]=D,this.int16[k+10]=S,this.int16[k+11]=R,e}}O1.prototype.bytesPerElement=24,J(O1,"StructArrayLayout4i4ui4i24");class L1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,u,d,p)}emplace(e,i,a,u,d,p,_){let y=10*e,b=5*e;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=u,this.float32[b+2]=d,this.float32[b+3]=p,this.float32[b+4]=_,e}}L1.prototype.bytesPerElement=20,J(L1,"StructArrayLayout3i3f20");class F1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}F1.prototype.bytesPerElement=4,J(F1,"StructArrayLayout1ul4");class Ku extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ku.prototype.bytesPerElement=4,J(Ku,"StructArrayLayout1f4");class mc extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){let a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){let u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=a,e}}mc.prototype.bytesPerElement=4,J(mc,"StructArrayLayout2ui4");class N1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_,y,b,T,D,S,R){let k=this.length;return this.resize(k+1),this.emplace(k,e,i,a,u,d,p,_,y,b,T,D,S,R)}emplace(e,i,a,u,d,p,_,y,b,T,D,S,R,k){let F=20*e,z=10*e;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=u,this.int16[F+3]=d,this.int16[F+4]=p,this.float32[z+3]=_,this.float32[z+4]=y,this.float32[z+5]=b,this.float32[z+6]=T,this.int16[F+14]=D,this.uint32[z+8]=S,this.uint16[F+18]=R,this.uint16[F+19]=k,e}}N1.prototype.bytesPerElement=40,J(N1,"StructArrayLayout5i4f1i1ul2ui40");class n0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,u,d,p,_)}emplace(e,i,a,u,d,p,_,y){let b=8*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+4]=d,this.int16[b+5]=p,this.int16[b+6]=_,this.int16[b+7]=y,e}}n0.prototype.bytesPerElement=16,J(n0,"StructArrayLayout3i2i2i16");class z1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u,d)}emplace(e,i,a,u,d,p){let _=4*e,y=8*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=u,this.int16[y+6]=d,this.int16[y+7]=p,e}}z1.prototype.bytesPerElement=16,J(z1,"StructArrayLayout2f1f2i16");class B1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,u)}emplace(e,i,a,u,d){let p=12*e,_=3*e;return this.uint8[p+0]=i,this.uint8[p+1]=a,this.float32[_+1]=u,this.float32[_+2]=d,e}}B1.prototype.bytesPerElement=12,J(B1,"StructArrayLayout2ub2f12");class Ki extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){let d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=u,e}}Ki.prototype.bytesPerElement=6,J(Ki,"StructArrayLayout3ui6");class V1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j,Y,X,K,le){let se=this.length;return this.resize(se+1),this.emplace(se,e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j,Y,X,K,le)}emplace(e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j,Y,X,K,le,se){let me=30*e,_e=15*e,Ee=60*e;return this.int16[me+0]=i,this.int16[me+1]=a,this.int16[me+2]=u,this.float32[_e+2]=d,this.float32[_e+3]=p,this.uint16[me+8]=_,this.uint16[me+9]=y,this.uint32[_e+5]=b,this.uint32[_e+6]=T,this.uint32[_e+7]=D,this.uint16[me+16]=S,this.uint16[me+17]=R,this.uint16[me+18]=k,this.float32[_e+10]=F,this.float32[_e+11]=z,this.uint8[Ee+48]=j,this.uint8[Ee+49]=Y,this.uint8[Ee+50]=X,this.uint32[_e+13]=K,this.int16[me+28]=le,this.uint8[Ee+58]=se,e}}V1.prototype.bytesPerElement=60,J(V1,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class j1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j,Y,X,K,le,se,me,_e,Ee,ke,Se,ze,Ye,Le,qe,Oe,We,Je){let Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j,Y,X,K,le,se,me,_e,Ee,ke,Se,ze,Ye,Le,qe,Oe,We,Je)}emplace(e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j,Y,X,K,le,se,me,_e,Ee,ke,Se,ze,Ye,Le,qe,Oe,We,Je,Ze){let ht=22*e,Xe=44*e,nt=88*e;return this.float32[ht+0]=i,this.float32[ht+1]=a,this.int16[Xe+4]=u,this.int16[Xe+5]=d,this.int16[Xe+6]=p,this.int16[Xe+7]=_,this.int16[Xe+8]=y,this.int16[Xe+9]=b,this.int16[Xe+10]=T,this.int16[Xe+11]=D,this.int16[Xe+12]=S,this.uint16[Xe+13]=R,this.uint16[Xe+14]=k,this.uint16[Xe+15]=F,this.uint16[Xe+16]=z,this.uint16[Xe+17]=j,this.uint16[Xe+18]=Y,this.uint16[Xe+19]=X,this.uint16[Xe+20]=K,this.uint16[Xe+21]=le,this.uint16[Xe+22]=se,this.uint16[Xe+23]=me,this.uint16[Xe+24]=_e,this.uint16[Xe+25]=Ee,this.uint16[Xe+26]=ke,this.uint16[Xe+27]=Se,this.uint32[ht+14]=ze,this.float32[ht+15]=Ye,this.float32[ht+16]=Le,this.float32[ht+17]=qe,this.float32[ht+18]=Oe,this.float32[ht+19]=We,this.float32[ht+20]=Je,this.uint8[nt+84]=Ze,e}}j1.prototype.bytesPerElement=88,J(j1,"StructArrayLayout2f9i15ui1ul6f1ub88");class Qu extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,u,d)}emplace(e,i,a,u,d,p){let _=5*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=u,this.float32[_+3]=d,this.float32[_+4]=p,e}}Qu.prototype.bytesPerElement=20,J(Qu,"StructArrayLayout5f20");class U1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,u,d,p,_)}emplace(e,i,a,u,d,p,_,y){let b=7*e;return this.float32[b+0]=i,this.float32[b+1]=a,this.float32[b+2]=u,this.float32[b+3]=d,this.float32[b+4]=p,this.float32[b+5]=_,this.float32[b+6]=y,e}}U1.prototype.bytesPerElement=28,J(U1,"StructArrayLayout7f28");class ef extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){let a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){let u=2*e;return this.float32[u+0]=i,this.float32[u+1]=a,e}}ef.prototype.bytesPerElement=8,J(ef,"StructArrayLayout2f8");class $1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,u)}emplace(e,i,a,u,d){let p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=a,this.uint16[p+3]=u,this.uint16[p+4]=d,e}}$1.prototype.bytesPerElement=12,J($1,"StructArrayLayout1ul3ui12");class Um extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Um.prototype.bytesPerElement=2,J(Um,"StructArrayLayout1ui2");class G1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z){let j=this.length;return this.resize(j+1),this.emplace(j,e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z)}emplace(e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j){let Y=16*e;return this.float32[Y+0]=i,this.float32[Y+1]=a,this.float32[Y+2]=u,this.float32[Y+3]=d,this.float32[Y+4]=p,this.float32[Y+5]=_,this.float32[Y+6]=y,this.float32[Y+7]=b,this.float32[Y+8]=T,this.float32[Y+9]=D,this.float32[Y+10]=S,this.float32[Y+11]=R,this.float32[Y+12]=k,this.float32[Y+13]=F,this.float32[Y+14]=z,this.float32[Y+15]=j,e}}G1.prototype.bytesPerElement=64,J(G1,"StructArrayLayout16f64");class i0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,u,d,p,_)}emplace(e,i,a,u,d,p,_,y){let b=10*e,T=5*e;return this.uint16[b+0]=i,this.uint16[b+1]=a,this.uint16[b+2]=u,this.uint16[b+3]=d,this.float32[T+2]=p,this.float32[T+3]=_,this.float32[T+4]=y,e}}i0.prototype.bytesPerElement=20,J(i0,"StructArrayLayout4ui3f20");class H1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}H1.prototype.bytesPerElement=2,J(H1,"StructArrayLayout1i2");class q1 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}q1.prototype.bytesPerElement=1,J(q1,"StructArrayLayout1ub1");class uS extends Qy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}uS.prototype.size=40;class W1 extends N1{get(e){return new uS(this,e)}}J(W1,"CollisionBoxArray");class hS extends Qy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}hS.prototype.size=60;class dS extends V1{get(e){return new hS(this,e)}}J(dS,"PlacedSymbolArray");class fS extends Qy{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}fS.prototype.size=88;class pS extends j1{get(e){return new fS(this,e)}}J(pS,"SymbolInstanceArray");class mS extends Ku{getoffsetX(e){return this.float32[1*e+0]}}J(mS,"GlyphOffsetArray");class gS extends Es{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}J(gS,"SymbolLineVertexArray");class _S extends Qy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}_S.prototype.size=12;class yS extends $1{get(e){return new _S(this,e)}}J(yS,"FeatureIndexArray");class vS extends mc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}J(vS,"FillExtrusionCentroidArray");let xz=An([{name:"a_pos",components:2,type:"Int16"}],4),bz=An([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class _i{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,u){let d=this.segments[this.segments.length-1];return e>_i.MAX_VERTEX_ARRAY_LENGTH&&ki(`Max vertices per segment is ${_i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>_i.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}prepareSegment(e,i,a,u){return this._prepareSegment(e,i.length,a.length,u)}get(){return this.segments}destroy(){for(let e of this.segments)for(let i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,u){return new _i([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function xS(t,e){return 256*(t=tn(Math.floor(t),0,255))+tn(Math.floor(e),0,255)}_i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,J(_i,"SegmentVector");let wz=An([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ez=An([{name:"a_dash",components:4,type:"Uint16"}]);class $m{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,u){this.ids.push(bS(e)),this.positions.push(i,a,u)}eachPosition(e,i){let a=bS(e),u=0,d=this.ids.length-1;for(;u<d;){let p=u+d>>1;this.ids[p]>=a?d=p:u=p+1}for(;this.ids[u]===a;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){let a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Z1(a,u,0,a.length-1),i&&(i.add(a.buffer),i.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){let i=new $m,a;i.ids=e.ids,i.positions=e.positions;for(let u of i.ids)u!==a&&i.uniqueIds.push(u),a=u;return i.indexed=!0,i}}function bS(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Xl(String(t))}function Z1(t,e,i,a){for(;i<a;){let u=t[i+a>>1],d=i-1,p=a+1;for(;;){do d++;while(t[d]<u);do p--;while(t[p]>u);if(d>=p)break;r0(t,d,p),r0(e,3*d,3*p),r0(e,3*d+1,3*p+1),r0(e,3*d+2,3*p+2)}p-i<a-p?(Z1(t,e,i,p),i=p+1):(Z1(t,e,p+1,a),a=p)}}function r0(t,e,i){let a=t[e];t[e]=t[i],t[i]=a}J($m,"FeaturePositionMap");class rl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class o0 extends rl{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Wr extends rl{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ol extends rl{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Y1 extends rl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class X1 extends rl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class wS extends rl{constructor(e){super(e),this.current=En.transparent.toRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let Tz=new Float32Array(16);class Gm extends rl{constructor(e){super(e),this.current=Tz}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let Cz=new Float32Array(9),Iz=new Float32Array(4);class K1 extends rl{constructor(e){super(e),this.current=Iz}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Q1(t){return[xS(255*t.r,255*t.g),xS(255*t.b,255*t.a)]}class Hm{constructor(e,i,a,u){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=a,this.context=u}setUniform(e,i,a,u,d){let p=u.constantOr(this.value);i.set(e,d,p instanceof En?p.toRenderColor(this.context.lut):p)}getBinding(e,i){return this.type==="color"?new wS(e):new Wr(e)}}class tf{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,a,u,d){let p=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;p&&i.set(e,d,p)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new X1(e):new Wr(e)}}class sl{constructor(e,i,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,a,u,d,p,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new $t(0,{brightness:p}),i,{},d,u,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b,this.context)}updatePaintArray(e,i,a,u,d,p,_){let y=this.expression.evaluate({zoom:0,brightness:_},a,u,void 0,d);this._setPaintValue(e,i,y,this.context)}_setPaintValue(e,i,a,u){if(this.type==="color"){let d=Q1(a.toRenderColor(u.lut));for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ts{constructor(e,i,a,u,d,p){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=u,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,a,u,d,p,_){let y=this.expression.evaluate(new $t(this.context.zoom,{brightness:p}),i,{},d,u,_),b=this.expression.evaluate(new $t(this.context.zoom+1,{brightness:p}),i,{},d,u,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,b,this.context)}updatePaintArray(e,i,a,u,d,p,_){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:_},a,u,void 0,d),b=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},a,u,void 0,d);this._setPaintValue(e,i,y,b,this.context)}_setPaintValue(e,i,a,u,d){if(this.type==="color"){let p=Q1(a.toRenderColor(d.lut)),_=Q1(a.toRenderColor(d.lut));for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,p[0],p[1],_[0],_[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,u,d){let p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=tn(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,_)}getBinding(e,i){return new Wr(e)}}class gc{constructor(e,i,a,u,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?Ez:wz).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new u}populatePaintArray(e,i,a,u){let d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,u,d,p,_){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,i,a,u){if(!u||!a)return;let d=u[a];if(!d)return;let{tl:p,br:_,pixelRatio:y}=d;for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,p[0],p[1],_[0],_[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ju{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;let u=[];for(let d in e.paint._values){let p=e.paint.get(d);if(!a(d)||!(p instanceof ii&&Kd(p.property.specification)))continue;let _=Sz(d,e.type),y=p.value,b=p.property.specification.type,T=!!p.property.useIntegerZoom,D=d==="line-dasharray"||d.endsWith("pattern"),S=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||S)if(y.kind==="source"||S||D){let R=ES(d,b,"source");this.binders[d]=D?new gc(y,_,b,R,e.id):new sl(y,_,b,R),u.push(`/a_${d}`)}else{let R=ES(d,b,"composite");this.binders[d]=new Ts(y,_,b,T,i,R),u.push(`/z_${d}`)}else this.binders[d]=D?new tf(y.value,_):new Hm(y.value,_,b,i),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){let i=this.binders[e];return i instanceof sl||i instanceof Ts?i.maxValue:0}populatePaintArrays(e,i,a,u,d,p,_){for(let y in this.binders){let b=this.binders[y];b.context=this.context,(b instanceof sl||b instanceof Ts||b instanceof gc)&&b.populatePaintArray(e,i,a,u,d,p,_)}}setConstantPatternPositions(e){for(let i in this.binders){let a=this.binders[i];a instanceof tf&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,i,a,u,d,p,_,y){let b=!1,T=Object.keys(e),D=T.length!==0,S=D?T:i.uniqueIds;this.context.lut=d.lut;for(let R in this.binders){let k=this.binders[R];if(k.context=this.context,(k instanceof sl||k instanceof Ts||k instanceof gc)&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){let F=d.paint.get(R);k.expression=F.value;for(let z of S){let j=e[z.toString()];i.eachPosition(z,(Y,X,K)=>{let le=u.feature(Y);k.updatePaintArray(X,K,le,j,p,_,y)})}if(!D)for(let z of a.uniqueIds){let j=e[z.toString()];a.eachPosition(z,(Y,X,K)=>{let le=u.feature(Y);k.updatePaintArray(X,K,le,j,p,_,y)})}b=!0}}return b}defines(){let e=[];for(let i in this.binders){let a=this.binders[i];(a instanceof Hm||a instanceof tf)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){let e=[];for(let i in this.binders){let a=this.binders[i];if(a instanceof sl||a instanceof Ts||a instanceof gc)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){let e=[];for(let i in this.binders){let a=this.binders[i];if(a instanceof Hm||a instanceof tf||a instanceof Ts)for(let u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let i=[];for(let a in this.binders){let u=this.binders[a];if(u instanceof Hm||u instanceof tf||u instanceof Ts)for(let d of u.uniformNames)i.push({name:d,property:a,binding:u.getBinding(e,d)})}return i}setUniforms(e,i,a,u,d){for(let{name:p,property:_,binding:y}of a)this.binders[_].setUniform(e,y,d,u.get(_),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let i=this.binders[e];(i instanceof sl||i instanceof Ts||i instanceof gc)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(let i in this.binders){let a=this.binders[i];(a instanceof sl||a instanceof Ts||a instanceof gc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let i=this.binders[e];(i instanceof sl||i instanceof Ts||i instanceof gc)&&i.destroy()}}}class _c{constructor(e,i,a=()=>!0){this.programConfigurations={};for(let u of e)this.programConfigurations[u.id]=new Ju(u,i,a);this.needsUpload=!1,this._featureMap=new $m,this._featureMapWithoutIds=new $m,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,u,d,p,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,u,d,p,_,y);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,u,d,p){for(let _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,_,u,d,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let Dz={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sz(t,e){return Dz[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let Mz={"line-pattern":{source:pc,composite:pc},"fill-pattern":{source:pc,composite:pc},"fill-extrusion-pattern":{source:pc,composite:pc},"line-dasharray":{source:e0,composite:e0}},Az={color:{source:ef,composite:dc},number:{source:Ku,composite:ef}};function ES(t,e,i){let a=Mz[t];return a&&a[i]||Az[e][i]}J(Hm,"ConstantBinder"),J(tf,"PatternConstantBinder"),J(sl,"SourceExpressionBinder"),J(gc,"PatternCompositeBinder"),J(Ts,"CompositeExpressionBinder"),J(Ju,"ProgramConfiguration",{omit:["_buffers"]}),J(_c,"ProgramConfigurationSet");let Zr=rt/Math.PI/2,J1=5,TS=6,Pz=16383,nf=64,ew=[nf,32,16],ns=-Zr,is=Zr;function rf(t,e,i,a=Zr){return i=dn(i),[t*Math.sin(i)*a,-e*a,t*Math.cos(i)*a]}function eh(t,e,i){return rf(Math.cos(dn(t)),Math.sin(dn(t)),e,i)}let of=63710088e-1,tw=2*Math.PI*of;class bn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bn(Ua(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let i=Math.PI/180,a=this.lat*i,u=e.lat*i,d=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return of*Math.acos(Math.min(d,1))}toBounds(e=0){let i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new yc({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return eh(this.lat,this.lng,Zr+e*Zr/of)}static convert(e){if(e instanceof bn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new bn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new bn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class yc{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof bn?new bn(e.lng,e.lat):bn.convert(e),this}setSouthWest(e){return this._sw=e instanceof bn?new bn(e.lng,e.lat):bn.convert(e),this}extend(e){let i=this._sw,a=this._ne,u,d;if(e instanceof bn)u=e,d=e;else{if(!(e instanceof yc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(yc.convert(e)):this.extend(bn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(bn.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return i||a?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new bn(u.lng,u.lat),this._ne=new bn(d.lng,d.lat)),this}getCenter(){return new bn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new bn(this.getWest(),this.getNorth())}getSouthEast(){return new bn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:i,lat:a}=bn.convert(e),u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof yc?e:new yc(e)}}var CS={};(function(t,e){(function(i){function a(d,p,_){var y=u(256*d,256*(p=Math.pow(2,_)-p-1),_),b=u(256*(d+1),256*(p+1),_);return y[0]+","+y[1]+","+b[0]+","+b[1]}function u(d,p,_){var y=2*Math.PI*6378137/256/Math.pow(2,_);return[d*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}i.getURL=function(d,p,_,y,b,T){return T=T||{},d+"?"+["bbox="+a(_,y,b),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+p].join("&")},i.getTileBBox=a,i.getMercCoords=u,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,CS);var Rz=CS;class th{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=qm(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){let a=Rz.getTileBBox(this.x,this.y,this.z),u=function(d,p,_){let y,b="";for(let T=d;T>0;T--)y=1<<T-1,b+=(p&y?1:0)+(_&y?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class IS{constructor(e,i){this.wrap=e,this.canonical=i,this.key=qm(e,i.z,i.z,i.x,i.y)}}class Gi{constructor(e,i,a,u,d){this.overscaledZ=e,this.wrap=i,this.canonical=new th(a,+u,+d),this.key=i===0&&e===a?this.canonical.key:qm(i,e,a,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let i=this.canonical.z-e;return e>this.canonical.z?new Gi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return qm(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return qm(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Gi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Gi(i,this.wrap,i,a,u),new Gi(i,this.wrap,i,a+1,u),new Gi(i,this.wrap,i,a,u+1),new Gi(i,this.wrap,i,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new IS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function qm(t,e,i,a,u){let d=1<<Math.min(i,22),p=d*(u%d)+a%d;return t&&i<22&&(p+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}let kz=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new Gi(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new Gi(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new Gi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Gi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];J(th,"CanonicalTileID"),J(Gi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Oz=0,Lz=25.5;function nw(t){return tw*Math.cos(t*Math.PI/180)}function ua(t){return(180+t)/360}function ha(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Yr(t,e){return t/nw(e)}function no(t){return 360*t-180}function or(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function DS(t,e){return t*nw(or(e))}let Li=85.051129;function SS(t){return Math.cos(dn(tn(t,-Li,Li)))}function nh(t,e){let i=tn(e,Oz,Lz),a=Math.pow(2,i);return SS(t)*tw/(512*a)}function MS(t){return 1/Math.cos(t*Math.PI/180)}function s0(t,e=0){let i=Math.exp(Math.PI*(1-(t.y+e/rt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/rt/(1<<t.z)}class Mr{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){let a=bn.convert(e);return new Mr(ua(a.lng),ha(a.lat),Yr(i,a.lat))}toLngLat(){return new bn(no(this.x),or(this.y))}toAltitude(){return DS(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/tw*MS(or(this.y))}}function iw(t,e,i,a,u,d,p,_,y){let b=(e+a)/2,T=(i+u)/2,D=new lt(b,T);_(D),function(S,R,k,F,z,j){let Y=k-z,X=F-j;return Math.abs((F-R)*Y-(k-S)*X)/Math.hypot(Y,X)}(D.x,D.y,d.x,d.y,p.x,p.y)>=y?(iw(t,e,i,b,T,d,D,_,y),iw(t,b,T,a,u,D,p,_,y)):t.push(p)}function AS(t,e,i){let a=t[0],u=a.x,d=a.y;e(a);let p=[a];for(let _=1;_<t.length;_++){let y=t[_],{x:b,y:T}=y;e(y),iw(p,u,d,b,T,a,y,e,i),u=b,d=T,a=y}return p}function rw(t,e,i,a){if(a(e,i)){let u=e.add(i)._mult(.5);rw(t,e,u,a),rw(t,u,i,a)}else t.push(i)}function Fz(t,e){let i=t[0],a=[i];for(let u=1;u<t.length;u++){let d=t[u];rw(a,i,d,e),i=d}return a}let ow=Math.pow(2,14)-1,PS=-ow-1;function Nz(t,e){let i=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=tn(i,PS,ow),t.y=tn(a,PS,ow),(i<t.x||i>t.x+1||a<t.y||a>t.y+1)&&ki("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Cs(t,e,i){let a=t.loadGeometry(),u=t.extent,d=rt/u;if(e&&i&&i.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:_,x:y,y:b,projection:T}=i,D=S=>{let R=no((e.x+S.x/u)/p),k=or((e.y+S.y/u)/p),F=T.project(R,k);S.x=(F.x*_-y)*u,S.y=(F.y*_-b)*u};for(let S=0;S<a.length;S++)if(t.type!==1)a[S]=AS(a[S],D,1);else{let R=[];for(let k of a[S])k.x<0||k.x>=u||k.y<0||k.y>=u||(D(k),R.push(k));a[S]=R}}for(let p of a)for(let _ of p)Nz(_,d);return a}function al(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Cs(t):[]}}function a0(t,e,i,a,u){t.emplaceBack(2*e+(a+1)/2,2*i+(u+1)/2)}function l0(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class sw{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Es,this.indexArray=new Ki,this.segments=new _i,this.programConfigurations=new _c(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,a,u){let d=this.layers[0],p=[],_=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(let{feature:b,id:T,index:D,sourceLayerIndex:S}of e){let R=this.layers[0]._featureFilter.needGeometry,k=al(b,R);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),k,a))continue;let F=_?_.evaluate(k,{},a):void 0,z={id:T,properties:b.properties,type:b.type,sourceLayerIndex:S,index:D,geometry:R?k.geometry:Cs(b,a,u),patterns:{},sortKey:F};p.push(z)}_&&p.sort((b,T)=>b.sortKey-T.sortKey);let y=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new t0,y=u.projection);for(let b of p){let{geometry:T,index:D,sourceLayerIndex:S}=b,R=e[D].feature;this.addFeature(b,T,D,i.availableImages,a,y,i.brightness),i.featureIndex.insert(R,T,D,S,this.index)}}update(e,i,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,bz.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,a,u,d,p,_){for(let y of i)for(let b of y){let T=b.x,D=b.y;if(T<0||T>=rt||D<0||D>=rt)continue;if(p){let k=p.projectTilePoint(T,D,d),F=p.upVector(d,T,D),z=this.globeExtVertexArray;l0(z,k,F),l0(z,k,F),l0(z,k,F),l0(z,k,F)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=S.vertexLength;a0(this.layoutVertexArray,T,D,-1,-1),a0(this.layoutVertexArray,T,D,1,-1),a0(this.layoutVertexArray,T,D,1,1),a0(this.layoutVertexArray,T,D,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,d,_)}}function aw(t,e){for(let i=0;i<t.length;i++)if(vc(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(vc(t,e[i]))return!0;return!!lw(t,e)}function zz(t,e,i){return!!vc(t,e)||!!cw(e,t,i)}function RS(t,e){if(t.length===1)return OS(e,t[0]);for(let i=0;i<e.length;i++){let a=e[i];for(let u=0;u<a.length;u++)if(vc(t,a[u]))return!0}for(let i=0;i<t.length;i++)if(OS(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(lw(t,e[i]))return!0;return!1}function Bz(t,e,i){if(t.length>1){if(lw(t,e))return!0;for(let a=0;a<e.length;a++)if(cw(e[a],t,i))return!0}for(let a=0;a<t.length;a++)if(cw(t[a],e,i))return!0;return!1}function lw(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){let a=t[i],u=t[i+1];for(let d=0;d<e.length-1;d++)if(Vz(a,u,e[d],e[d+1]))return!0}return!1}function Vz(t,e,i,a){return Ko(t,i,a)!==Ko(e,i,a)&&Ko(t,e,i)!==Ko(t,e,a)}function cw(t,e,i){let a=i*i;if(e.length===1)return t.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(kS(t,e[u-1],e[u])<a)return!0;return!1}function kS(t,e,i){let a=e.distSqr(i);if(a===0)return t.distSqr(e);let u=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/a;return t.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function OS(t,e){let i,a,u,d=!1;for(let p=0;p<t.length;p++){i=t[p];for(let _=0,y=i.length-1;_<i.length;y=_++)a=i[_],u=i[y],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(d=!d)}return d}function vc(t,e){let i=!1;for(let a=0,u=t.length-1;a<t.length;u=a++){let d=t[a],p=t[u];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(i=!i)}return i}function LS(t,e,i,a,u){for(let p of t)if(e<=p.x&&i<=p.y&&a>=p.x&&u>=p.y)return!0;let d=[new lt(e,i),new lt(e,u),new lt(a,u),new lt(a,i)];if(t.length>2){for(let p of d)if(vc(t,p))return!0}for(let p=0;p<t.length-1;p++)if(jz(t[p],t[p+1],d))return!0;return!1}function jz(t,e,i){let a=i[0],u=i[2];if(t.x<a.x&&e.x<a.x||t.x>u.x&&e.x>u.x||t.y<a.y&&e.y<a.y||t.y>u.y&&e.y>u.y)return!1;let d=Ko(t,e,i[0]);return d!==Ko(t,e,i[1])||d!==Ko(t,e,i[2])||d!==Ko(t,e,i[3])}function sf(t,e,i,a,u,d){let p=e.y-t.y,_=t.x-e.x;if(d=d||0){let y=p*p+_*_;if(y===0)return!0;let b=Math.sqrt(y);p/=b,_/=b}return!((i.x-t.x)*p+(i.y-t.y)*_-d<0||(a.x-t.x)*p+(a.y-t.y)*_-d<0||(u.x-t.x)*p+(u.y-t.y)*_-d<0)}function uw(t,e,i,a,u,d,p){return!(sf(t,e,a,u,d,p)||sf(e,i,a,u,d,p)||sf(i,t,a,u,d,p)||sf(a,u,t,e,i,p)||sf(u,d,t,e,i,p)||sf(d,a,t,e,i,p))}function af(t,e,i){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(t)}function c0(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function FS(t,e,i,a,u){if(!e[0]&&!e[1])return t;let d=lt.convert(e)._mult(u);i==="viewport"&&d._rotate(-a);let p=[];for(let _=0;_<t.length;_++)p.push(t[_].sub(d));return p}function NS(t,e,i,a){let u=lt.convert(t)._mult(a);return e==="viewport"&&u._rotate(-i),u}J(sw,"CircleBucket",{omit:["layers"]});let Uz=new On({"circle-sort-key":new ut(Te.layout_circle["circle-sort-key"]),visibility:new Be(Te.layout_circle.visibility)});var $z={paint:new On({"circle-radius":new ut(Te.paint_circle["circle-radius"]),"circle-color":new ut(Te.paint_circle["circle-color"]),"circle-blur":new ut(Te.paint_circle["circle-blur"]),"circle-opacity":new ut(Te.paint_circle["circle-opacity"]),"circle-translate":new Be(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Be(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Be(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Be(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(Te.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Be(Te.paint_circle["circle-emissive-strength"])}),layout:Uz};class hw{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){let u=r._.dot(i,this.dir);if(Math.abs(u)<1e-6)return!1;let d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,a){if(r._.equals(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;let[u,d,p]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],b=this.pos[2]-e[2],T=u*u+d*d+p*p,D=2*(_*u+y*d+b*p),S=D*D-4*T*(_*_+y*y+b*b-i*i);if(S<0){let R=Math.max(-D/2,0),k=_+u*R,F=y+d*R,z=b+p*R,j=Math.hypot(k,F,z);return a[0]=k*i/j,a[1]=F*i/j,a[2]=z*i/j,!1}{let R=(-D-Math.sqrt(S))/(2*T);if(R<0){let k=Math.hypot(_,y,b);return a[0]=_*i/k,a[1]=y*i/k,a[2]=b*i/k,!1}return a[0]=_+u*R,a[1]=y+d*R,a[2]=b+p*R,!0}}}class dw{constructor(e,i,a,u,d){this.TL=e,this.TR=i,this.BR=a,this.BL=u,this.horizon=d}static fromInvProjectionMatrix(e,i,a){let u=[-1,1,1],d=[1,1,1],p=[1,-1,1],_=[-1,-1,1],y=r._.transformMat4(u,u,e),b=r._.transformMat4(d,d,e),T=r._.transformMat4(p,p,e),D=r._.transformMat4(_,_,e);return new dw(y,b,T,D,i/a)}}function Wm(t,e,i){let a=1/0,u=-1/0,d=[];for(let p of t){r._.sub(d,p,e);let _=r._.dot(d,i);a=Math.min(a,_),u=Math.max(u,_)}return[a,u]}function zS(t,e){let i=!0;for(let a=0;a<t.planes.length;a++){let u=t.planes[a],d=0;for(let p=0;p<e.length;p++)d+=r._.dot(u,e[p])+u[3]>=0;if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function BS(t,e){for(let i of t.projections){let a=Wm(e,t.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function VS(t,e){let i=0,a=[0,0,0,0];for(let u=0;u<t.length;u++)a[0]=t[u][0],a[1]=t[u][1],a[2]=t[u][2],a[3]=1,r.aA.dot(a,e)>=0&&i++;return i}class fw{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=yi.fromPoints(this.points),this.projections=[],this.frustumEdges=[r._.sub([],this.points[2],this.points[3]),r._.sub([],this.points[0],this.points[3]),r._.sub([],this.points[4],this.points[0]),r._.sub([],this.points[5],this.points[1]),r._.sub([],this.points[6],this.points[2]),r._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let u=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:u,projection:Wm(this.points,this.points[0],u)}),this.projections.push({axis:d,projection:Wm(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,a,u){let d=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let T=r.aA.transformMat4([],b,e),D=1/T[3]/i*d;return r.aA.mul(T,T,[D,D,u?1/T[3]:D,D])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let T=r._.sub([],p[b[0]],p[b[1]]),D=r._.sub([],p[b[2]],p[b[1]]),S=r._.normalize([],r._.cross([],T,D)),R=-r._.dot(S,p[b[1]]);return S.concat(R)}),y=[];for(let b=0;b<p.length;b++)y.push([p[b][0],p[b][1],p[b][2]]);return new fw(y,_)}intersectsPrecise(e,i,a){for(let u=0;u<i.length;u++)if(!VS(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!VS(e,this.planes[u]))return 0;for(let u of a)for(let d of this.frustumEdges){let p=r._.cross([],u,d),_=r._.length(p);if(_===0)continue;r._.scale(p,p,1/_);let y=Wm(this.points,this.points[0],p),b=Wm(e,this.points[0],p);if(y[0]>b[1]||b[0]>y[1])return 0}return 1}}class yi{static fromPoints(e){let i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let u of e)r._.min(i,i,u),r._.max(a,a,u);return new yi(i,a)}static fromTileIdAndHeight(e,i,a){let u=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new yi([d/u,p/u,i],[(d+1)/u,(p+1)/u,a])}static applyTransform(e,i){let a=e.getCorners();for(let u=0;u<a.length;++u)r._.transformMat4(a[u],a[u],i);return yi.fromPoints(a)}static projectAabbCorners(e,i){let a=e.getCorners();for(let u=0;u<a.length;++u)r._.transformMat4(a[u],a[u],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=r._.scale([],r._.add([],this.min,this.max),.5)}quadrant(e){let i=[e%2==0,e<2],a=r._.clone(this.min),u=r._.clone(this.max);for(let d=0;d<i.length;d++)a[d]=i[d]?this.min[d]:this.center[d],u[d]=i[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new yi(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zS(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zS(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?BS(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?BS(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}J(yi,"Aabb");let Gz=An([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:u0}=Gz,jS=An([{name:"a_pos_3",components:3,type:"Int16"}]);var Zm=An([{name:"a_pos",type:"Int16",components:2}]);function h0(t){return t*Zr/of}let Hz=[new yi([ns,ns,ns],[is,is,is]),new yi([ns,ns,ns],[0,0,is]),new yi([0,ns,ns],[is,0,is]),new yi([ns,0,ns],[0,is,is]),new yi([0,0,ns],[is,is,is])];function US(t,e,i,a=!0){let u=r._.scale([],t._camera.position,t.worldSize),d=[e,i,1,1];r.aA.transformMat4(d,d,t.pixelMatrixInverse),r.aA.scale(d,d,1/d[3]);let p=r._.sub([],d,u),_=r._.normalize([],p),y=t.globeMatrix,b=[y[12],y[13],y[14]],T=r._.sub([],b,u),D=r._.length(T),S=r._.normalize([],T),R=t.worldSize/(2*Math.PI),k=r._.dot(S,_),F=Math.asin(R/D);if(F<Math.acos(k)){if(!a)return null;let Se=[],ze=[];r._.scale(Se,_,D/k),r._.normalize(ze,r._.sub(ze,Se,T)),r._.normalize(_,r._.add(_,T,r._.scale(_,ze,Math.tan(F)*D)))}let z=[];new hw(u,_).closestPointOnSphere(b,R,z);let j=r._.normalize([],xu(y,0)),Y=r._.normalize([],xu(y,1)),X=r._.normalize([],xu(y,2)),K=r._.dot(j,z),le=r._.dot(Y,z),se=r._.dot(X,z),me=mr(Math.asin(-le/R)),_e=mr(Math.atan2(K,se));_e=t.center.lng+function(Se,ze){let Ye=(ze-Se+180)%360-180;return Ye<-180?Ye+360:Ye}(t.center.lng,_e);let Ee=ua(_e),ke=tn(ha(me),0,1);return new Mr(Ee,ke)}class qz{constructor(e,i,a){this.a=r._.sub([],e,a),this.b=r._.sub([],i,a),this.center=a;let u=r._.normalize([],this.a),d=r._.normalize([],this.b);this.angle=Math.acos(r._.dot(u,d))}}function pw(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(a,u,d,p){let _=Math.sin(d);return a*(Math.sin((1-p)*d)/_)+u*(Math.sin(p*d)/_)}(t.a[e],t.b[e],t.angle,tn(i,0,1))+t.center[e]}function da(t){if(t.z<=1)return Hz[t.z+2*t.y+t.x];let e=mw(d0(t));return yi.fromPoints(e)}function ll(t,e,i){return r._.scale(t,t,1-i),r._.scaleAndAdd(t,t,e,i)}function $S(t,e){let i=cl(e.zoom);if(i===0)return da(t);let a=d0(t),u=mw(a),d=ua(a.getWest())*e.worldSize,p=ua(a.getEast())*e.worldSize,_=ha(a.getNorth())*e.worldSize,y=ha(a.getSouth())*e.worldSize,b=[d,_,0],T=[p,_,0],D=[d,y,0],S=[p,y,0],R=r.ad.invert([],e.globeMatrix);return r._.transformMat4(b,b,R),r._.transformMat4(T,T,R),r._.transformMat4(D,D,R),r._.transformMat4(S,S,R),u[0]=ll(u[0],D,i),u[1]=ll(u[1],S,i),u[2]=ll(u[2],T,i),u[3]=ll(u[3],b,i),yi.fromPoints(u)}function GS(t,e,i){for(let a of t)r._.transformMat4(a,a,e),r._.scale(a,a,i)}function HS(t,e,i,a){let u=e/t.worldSize,d=t.globeMatrix;if(i.z<=1){let Ee=da(i).getCorners();return GS(Ee,d,u),yi.fromPoints(Ee)}let p=d0(i,a),_=mw(p,Zr+h0(t._tileCoverLift));GS(_,d,u);let y=Number.MAX_VALUE,b=[-y,-y,-y],T=[y,y,y];if(p.contains(t.center)){for(let Se of _)r._.min(T,T,Se),r._.max(b,b,Se);b[2]=0;let Ee=t.point,ke=[Ee.x*u,Ee.y*u,0];return r._.min(T,T,ke),r._.max(b,b,ke),new yi(T,b)}if(t._tileCoverLift>0){for(let Ee of _)r._.min(T,T,Ee),r._.max(b,b,Ee);return new yi(T,b)}let D=[d[12]*u,d[13]*u,d[14]*u],S=p.getCenter(),R=tn(t.center.lat,-Li,Li),k=tn(S.lat,-Li,Li),F=ua(t.center.lng),z=ha(R),j=F-ua(S.lng),Y=z-ha(k);j>.5?j-=1:j<-.5&&(j+=1);let X=0;if(Math.abs(j)>Math.abs(Y))X=j>=0?1:3;else{X=Y>=0?0:2;let Ee=[d[4]*u,d[5]*u,d[6]*u],ke=-Math.sin(dn(Y>=0?p.getSouth():p.getNorth()))*Zr;r._.scaleAndAdd(D,D,Ee,ke)}let K=_[X],le=_[(X+1)%4],se=new qz(K,le,D),me=[pw(se,0)||K[0],pw(se,1)||K[1],pw(se,2)||K[2]],_e=cl(t.zoom);if(_e>0){let Ee=function({x:Se,y:ze,z:Ye},Le,qe,Oe,We){let Je=1/(1<<Ye),Ze=Se*Je,ht=Ze+Je,Xe=ze*Je,nt=Xe+Je,Tt=0,vt=(Ze+ht)/2-Oe;return vt>.5?Tt=-1:vt<-.5&&(Tt=1),Ze=((Ze+Tt)*Le-(Oe*=Le))*qe+Oe,ht=((ht+Tt)*Le-Oe)*qe+Oe,Xe=(Xe*Le-(We*=Le))*qe+We,nt=(nt*Le-We)*qe+We,[[Ze,nt,0],[ht,nt,0],[ht,Xe,0],[Ze,Xe,0]]}(i,e,t._pixelsPerMercatorPixel,F,z);for(let Se=0;Se<_.length;Se++)ll(_[Se],Ee[Se],_e);let ke=r._.add([],Ee[X],Ee[(X+1)%4]);r._.scale(ke,ke,.5),ll(me,ke,_e)}for(let Ee of _)r._.min(T,T,Ee),r._.max(b,b,Ee);return T[2]=Math.min(K[2],le[2]),r._.min(T,T,me),r._.max(b,b,me),new yi(T,b)}function d0({x:t,y:e,z:i},a=!1){let u=1/(1<<i),d=new bn(no(t*u),e===(1<<i)-1&&a?-90:or((e+1)*u)),p=new bn(no((t+1)*u),e===0&&a?90:or(e*u));return new yc(d,p)}function mw(t,e=Zr){let i=dn(t.getNorth()),a=dn(t.getSouth()),u=Math.cos(i),d=Math.cos(a),p=Math.sin(i),_=Math.sin(a),y=t.getWest(),b=t.getEast();return[rf(d,_,y,e),rf(d,_,b,e),rf(u,p,b,e),rf(u,p,y,e)]}function Ym(t,e,i,a){let u=1<<i.z,d=(t/rt+i.x)/u;return eh(or((e/rt+i.y)/u),no(d),a)}function f0({min:t,max:e}){return Pz/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let qS=new Float64Array(16);function Xm(t){let e=f0(t),i=r.ad.fromScaling(qS,[e,e,e]);return r.ad.translate(i,i,r._.negate([],t.min))}function gw(t){let e=r.ad.fromTranslation(qS,t.min),i=1/f0(t);return r.ad.scale(e,e,[i,i,i])}function _w(t){let e=rt/(2*Math.PI);return t/(2*Math.PI)/e}function WS(t,e){return rt/(512*Math.pow(2,t))*f0(da(e))}function ZS(t,e,i,a,u){let d=_w(i),p=[t,e,-i/(2*Math.PI)],_=r.ad.identity(new Float64Array(16));return r.ad.translate(_,_,p),r.ad.scale(_,_,[d,d,d]),r.ad.rotateX(_,_,dn(-u)),r.ad.rotateY(_,_,dn(-a)),_}function cl(t){return ja(J1,TS,t)}function YS(t,e){let i=eh(e.lat,e.lng),a=function(d){let p=eh(d._center.lat,d._center.lng),_=r._.fromValues(0,1,0),y=r._.cross([],_,p),b=r.ad.fromRotation([],-d.angle,p);y=r._.transformMat4(y,y,b),r.ad.fromRotation(b,-d._pitch,y);let T=r._.normalize([],p);return r._.scale(T,T,h0(d.cameraToCenterDistance/d.pixelsPerMeter)),r._.transformMat4(T,T,b),r._.add([],p,T)}(t),u=r._.subtract([],a,i);return r._.angle(u,i)}function yw(t,e){return YS(t,e)>Math.PI/2*1.01}let XS=dn(85),Wz=Math.cos(XS),Zz=Math.sin(XS),Yz=r.ad.create(),KS=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function QS(t,e,i,a,u,d,p,_,y){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(y*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,T=i.projection.upVectorScale(b,i.center.lat,i.worldSize).metersToTile;for(let D of e)for(let S of D){let R=S.add(_),k=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(R.x,R.y,!0):0,F=i.projection.projectTilePoint(R.x,R.y,b);if(k>0){let X=i.projection.upVector(b,R.x,R.y);F.x+=X[0]*T*k,F.y+=X[1]*T*k,F.z+=X[2]*T*k}let z=d?R:Xz(F.x,F.y,F.z,a),j=d?t.tilespaceRays.map(X=>Qz(X,k)):t.queryGeometry.screenGeometry,Y=r.aA.transformMat4([],[F.x,F.y,F.z,1],a);if(!p&&d?y*=Y[3]/i.cameraToCenterDistance:p&&!d&&(y*=i.cameraToCenterDistance/Y[3]),d){let X=or((S.y/rt+b.y)/(1<<b.z));y/=i.projection.pixelsPerMeter(X,1)/Yr(1,X)}if(zz(j,z,y))return!0}return!1}function Xz(t,e,i,a){let u=r.aA.transformMat4([],[t,e,i,1],a);return new lt(u[0]/u[3],u[1]/u[3])}let JS=r._.fromValues(0,0,0),Kz=r._.fromValues(0,0,1);function Qz(t,e){let i=r._.create();return JS[2]=e,t.intersectsPlane(JS,Kz,i),new lt(i[0],i[1])}class eM extends sw{}function tM(t,{width:e,height:i},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*a);return t.width=e,t.height=i,t.data=u,t}function nM(t,e,i){let{width:a,height:u}=e;a===t.width&&u===t.height||(vw(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,u)},i,null),t.width=a,t.height=u,t.data=e.data)}function vw(t,e,i,a,u,d,p,_){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||i.x>t.width-u.width||i.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,b=e.data,T=d===4&&_;for(let D=0;D<u.height;D++){let S=((i.y+D)*t.width+i.x)*d,R=((a.y+D)*e.width+a.x)*d;if(T)for(let k=0;k<u.width;k++){let F=S+k*d+3,z=R+k*d;b[z+0]=255,b[z+1]=255,b[z+2]=255,b[z+3]=y[F]}else if(p)for(let k=0;k<u.width;k++){let F=S+k*d,z=R+k*d,j=y[F+3],Y=new En(y[F+0]/255*j,y[F+1]/255*j,y[F+2]/255*j,j).toRenderColor(p).toArray();b[z+0]=Y[0],b[z+1]=Y[1],b[z+2]=Y[2],b[z+3]=Y[3]}else for(let k=0;k<u.width*d;k++)b[R+k]=y[S+k]}return e}J(eM,"HeatmapBucket",{omit:["layers"]});class xc{constructor(e,i){tM(this,e,1,i)}resize(e){nM(this,new xc(e),1)}clone(){return new xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,d){vw(e,i,a,u,d,1,null)}}class Lo{constructor(e,i){tM(this,e,4,i)}resize(e){nM(this,new Lo(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,d,p,_){vw(e,i,a,u,d,4,p,_)}}class iM{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}J(xc,"AlphaImage"),J(Lo,"RGBAImage");let Jz=new On({visibility:new Be(Te.layout_heatmap.visibility)});var eB={paint:new On({"heatmap-radius":new ut(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Be(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $i(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Be(Te.paint_heatmap["heatmap-opacity"])}),layout:Jz};function Km(t){let e={},i=t.resolution||256,a=t.clips?t.clips.length:1,u=t.image||new Lo({width:i,height:a}),d=(p,_,y)=>{e[t.evaluationKey]=y;let b=t.expression.evaluate(e);b&&(u.data[p+_+0]=Math.floor(255*b.r/b.a),u.data[p+_+1]=Math.floor(255*b.g/b.a),u.data[p+_+2]=Math.floor(255*b.b/b.a),u.data[p+_+3]=Math.floor(255*b.a))};if(t.clips)for(let p=0,_=0;p<a;++p,_+=4*i)for(let y=0,b=0;y<i;y++,b+=4){let T=y/(i-1),{start:D,end:S}=t.clips[p];d(_,b,D*(1-T)+S*T)}else for(let p=0,_=0;p<i;p++,_+=4)d(0,_,p/(i-1));return u}let tB=new On({visibility:new Be(Te.layout_hillshade.visibility)});var nB={paint:new On({"hillshade-illumination-direction":new Be(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Be(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Be(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Be(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Be(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Be(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Be(Te.paint_hillshade["hillshade-emissive-strength"])}),layout:tB};let iB=An([{name:"a_pos",components:2,type:"Int16"}],4),{members:rB}=iB;function Qm(t,e,i=2){let a=e&&e.length,u=a?e[0]*i:t.length,d=rM(t,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;let _,y,b;if(a&&(d=function(T,D,S,R){let k=[];for(let F=0,z=D.length;F<z;F++){let j=rM(T,D[F]*R,F<z-1?D[F+1]*R:T.length,R,!1);j===j.next&&(j.steiner=!0),k.push(dB(j))}k.sort(cB);for(let F=0;F<k.length;F++)S=uB(k[F],S);return S}(t,e,d,i)),t.length>80*i){_=1/0,y=1/0;let T=-1/0,D=-1/0;for(let S=i;S<u;S+=i){let R=t[S],k=t[S+1];R<_&&(_=R),k<y&&(y=k),R>T&&(T=R),k>D&&(D=k)}b=Math.max(T-_,D-y),b=b!==0?32767/b:0}return Jm(d,p,i,_,y,b,0),p}function rM(t,e,i,a,u){let d;if(u===function(p,_,y,b){let T=0;for(let D=_,S=y-b;D<y;D+=b)T+=(p[S]-p[D])*(p[D+1]+p[S+1]),S=D;return T}(t,e,i,a)>0)for(let p=e;p<i;p+=a)d=aM(p/a|0,t[p],t[p+1],d);else for(let p=i-a;p>=e;p-=a)d=aM(p/a|0,t[p],t[p+1],d);return d&&p0(d,d.next)&&(tg(d),d=d.next),d}function ih(t,e){if(!t)return t;e||(e=t);let i,a=t;do if(i=!1,a.steiner||!p0(a,a.next)&&Hi(a.prev,a,a.next)!==0)a=a.next;else{if(tg(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function Jm(t,e,i,a,u,d,p){if(!t)return;!p&&d&&function(y,b,T,D){let S=y;do S.z===0&&(S.z=xw(S.x,S.y,b,T,D)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==y);S.prevZ.nextZ=null,S.prevZ=null,function(R){let k,F=1;do{let z,j=R;R=null;let Y=null;for(k=0;j;){k++;let X=j,K=0;for(let se=0;se<F&&(K++,X=X.nextZ,X);se++);let le=F;for(;K>0||le>0&&X;)K!==0&&(le===0||!X||j.z<=X.z)?(z=j,j=j.nextZ,K--):(z=X,X=X.nextZ,le--),Y?Y.nextZ=z:R=z,z.prevZ=Y,Y=z;j=X}Y.nextZ=null,F*=2}while(k>1)}(S)}(t,a,u,d);let _=t;for(;t.prev!==t.next;){let y=t.prev,b=t.next;if(d?sB(t,a,u,d):oB(t))e.push(y.i,t.i,b.i),tg(t),t=b.next,_=b.next;else if((t=b)===_){p?p===1?Jm(t=aB(ih(t),e),e,i,a,u,d,2):p===2&&lB(t,e,i,a,u,d):Jm(ih(t),e,i,a,u,d,1);break}}}function oB(t){let e=t.prev,i=t,a=t.next;if(Hi(e,i,a)>=0)return!1;let u=e.x,d=i.x,p=a.x,_=e.y,y=i.y,b=a.y,T=u<d?u<p?u:p:d<p?d:p,D=_<y?_<b?_:b:y<b?y:b,S=u>d?u>p?u:p:d>p?d:p,R=_>y?_>b?_:b:y>b?y:b,k=a.next;for(;k!==e;){if(k.x>=T&&k.x<=S&&k.y>=D&&k.y<=R&&lf(u,_,d,y,p,b,k.x,k.y)&&Hi(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function sB(t,e,i,a){let u=t.prev,d=t,p=t.next;if(Hi(u,d,p)>=0)return!1;let _=u.x,y=d.x,b=p.x,T=u.y,D=d.y,S=p.y,R=_<y?_<b?_:b:y<b?y:b,k=T<D?T<S?T:S:D<S?D:S,F=_>y?_>b?_:b:y>b?y:b,z=T>D?T>S?T:S:D>S?D:S,j=xw(R,k,e,i,a),Y=xw(F,z,e,i,a),X=t.prevZ,K=t.nextZ;for(;X&&X.z>=j&&K&&K.z<=Y;){if(X.x>=R&&X.x<=F&&X.y>=k&&X.y<=z&&X!==u&&X!==p&&lf(_,T,y,D,b,S,X.x,X.y)&&Hi(X.prev,X,X.next)>=0||(X=X.prevZ,K.x>=R&&K.x<=F&&K.y>=k&&K.y<=z&&K!==u&&K!==p&&lf(_,T,y,D,b,S,K.x,K.y)&&Hi(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;X&&X.z>=j;){if(X.x>=R&&X.x<=F&&X.y>=k&&X.y<=z&&X!==u&&X!==p&&lf(_,T,y,D,b,S,X.x,X.y)&&Hi(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;K&&K.z<=Y;){if(K.x>=R&&K.x<=F&&K.y>=k&&K.y<=z&&K!==u&&K!==p&&lf(_,T,y,D,b,S,K.x,K.y)&&Hi(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function aB(t,e){let i=t;do{let a=i.prev,u=i.next.next;!p0(a,u)&&oM(a,i,i.next,u)&&eg(a,u)&&eg(u,a)&&(e.push(a.i,i.i,u.i),tg(i),tg(i.next),i=t=u),i=i.next}while(i!==t);return ih(i)}function lB(t,e,i,a,u,d){let p=t;do{let _=p.next.next;for(;_!==p.prev;){if(p.i!==_.i&&fB(p,_)){let y=sM(p,_);return p=ih(p,p.next),y=ih(y,y.next),Jm(p,e,i,a,u,d,0),void Jm(y,e,i,a,u,d,0)}_=_.next}p=p.next}while(p!==t)}function cB(t,e){return t.x-e.x}function uB(t,e){let i=function(u,d){let p=d,_=u.x,y=u.y,b,T=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){let F=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=_&&F>T&&(T=F,b=p.x<p.next.x?p:p.next,F===_))return b}p=p.next}while(p!==d);if(!b)return null;let D=b,S=b.x,R=b.y,k=1/0;p=b;do{if(_>=p.x&&p.x>=S&&_!==p.x&&lf(y<R?_:T,y,S,R,y<R?T:_,y,p.x,p.y)){let F=Math.abs(y-p.y)/(_-p.x);eg(p,u)&&(F<k||F===k&&(p.x>b.x||p.x===b.x&&hB(b,p)))&&(b=p,k=F)}p=p.next}while(p!==D);return b}(t,e);if(!i)return e;let a=sM(i,t);return ih(a,a.next),ih(i,i.next)}function hB(t,e){return Hi(t.prev,t,e.prev)<0&&Hi(e.next,t,t.next)<0}function xw(t,e,i,a,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dB(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function lf(t,e,i,a,u,d,p,_){return(u-p)*(e-_)>=(t-p)*(d-_)&&(t-p)*(a-_)>=(i-p)*(e-_)&&(i-p)*(d-_)>=(u-p)*(a-_)}function fB(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,a){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==a.i&&u.next.i!==a.i&&oM(u,u.next,i,a))return!0;u=u.next}while(u!==i);return!1}(t,e)&&(eg(t,e)&&eg(e,t)&&function(i,a){let u=i,d=!1,p=(i.x+a.x)/2,_=(i.y+a.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&p<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==i);return d}(t,e)&&(Hi(t.prev,t,e.prev)||Hi(t,e.prev,e))||p0(t,e)&&Hi(t.prev,t,t.next)>0&&Hi(e.prev,e,e.next)>0)}function Hi(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function p0(t,e){return t.x===e.x&&t.y===e.y}function oM(t,e,i,a){let u=g0(Hi(t,e,i)),d=g0(Hi(t,e,a)),p=g0(Hi(i,a,t)),_=g0(Hi(i,a,e));return u!==d&&p!==_||!(u!==0||!m0(t,i,e))||!(d!==0||!m0(t,a,e))||!(p!==0||!m0(i,t,a))||!(_!==0||!m0(i,e,a))}function m0(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function g0(t){return t>0?1:t<0?-1:0}function eg(t,e){return Hi(t.prev,t,t.next)<0?Hi(t,e,t.next)>=0&&Hi(t,t.prev,e)>=0:Hi(t,e,t.prev)<0||Hi(t,t.next,e)<0}function sM(t,e){let i=bw(t.i,t.x,t.y),a=bw(e.i,e.x,e.y),u=t.next,d=e.prev;return t.next=e,e.prev=t,i.next=u,u.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function aM(t,e,i,a){let u=bw(t,e,i);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function tg(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bw(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function _0(t,e){let i=t.length;if(i<=1)return[t];let a=[],u,d;for(let p=0;p<i;p++){let _=Ir(t[p]);_!==0&&(t[p].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(u&&a.push(u),u=[t[p]]):u.push(t[p]))}if(u&&a.push(u),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(v1(a[p],e,1,a[p].length-1,pB),a[p]=a[p].slice(0,e));return a}function pB(t,e){return e.area-t.area}function ww(t,e,i){let a=i.patternDependencies,u=!1;for(let d of e){let p=d.paint.get(`${t}-pattern`);p.isConstant()||(u=!0);let _=p.constantOr(null);_&&(u=!0,a[_]=!0)}return u}function Ew(t,e,i,a,u){let d=u.patternDependencies;for(let p of e){let _=p.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:a},i,{},u.availableImages);y=y&&y.name?y.name:y,d[y]=!0,i.patterns[p.id]=y}}return i}class y0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Es,this.indexArray=new Ki,this.indexArray2=new mc,this.programConfigurations=new _c(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new _i,this.segments2=new _i,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,a,u){this.hasPattern=ww("fill",this.layers,i);let d=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:_,id:y,index:b,sourceLayerIndex:T}of e){let D=this.layers[0]._featureFilter.needGeometry,S=al(_,D);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),S,a))continue;let R=d?d.evaluate(S,{},a,i.availableImages):void 0,k={id:y,properties:_.properties,type:_.type,sourceLayerIndex:T,index:b,geometry:D?S.geometry:Cs(_,a,u),patterns:{},sortKey:R};p.push(k)}d&&p.sort((_,y)=>_.sortKey-y.sortKey);for(let _ of p){let{geometry:y,index:b,sourceLayerIndex:T}=_;if(this.hasPattern){let D=Ew("fill",this.layers,_,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(_,y,b,a,{},i.availableImages,i.brightness);i.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,i,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,i,a,u,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rB),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,u,d,p=[],_){for(let y of _0(i,500)){let b=0;for(let F of y)b+=F.length;let T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),D=T.vertexLength,S=[],R=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&R.push(S.length/2);let z=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),j=z.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(j+F.length-1,j),S.push(F[0].x),S.push(F[0].y);for(let Y=1;Y<F.length;Y++)this.layoutVertexArray.emplaceBack(F[Y].x,F[Y].y),this.indexArray2.emplaceBack(j+Y-1,j+Y),S.push(F[Y].x),S.push(F[Y].y);z.vertexLength+=F.length,z.primitiveLength+=F.length}let k=Qm(S,R);for(let F=0;F<k.length;F+=3)this.indexArray.emplaceBack(D+k[F],D+k[F+1],D+k[F+2]);T.vertexLength+=b,T.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,_)}}J(y0,"FillBucket",{omit:["layers","patternFeatures"]});let mB=new On({"fill-sort-key":new ut(Te.layout_fill["fill-sort-key"]),visibility:new Be(Te.layout_fill.visibility)});var gB={paint:new On({"fill-antialias":new Be(Te.paint_fill["fill-antialias"]),"fill-opacity":new ut(Te.paint_fill["fill-opacity"]),"fill-color":new ut(Te.paint_fill["fill-color"]),"fill-outline-color":new ut(Te.paint_fill["fill-outline-color"]),"fill-translate":new Be(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Be(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new ut(Te.paint_fill["fill-pattern"]),"fill-emissive-strength":new Be(Te.paint_fill["fill-emissive-strength"])}),layout:mB};class Tw{constructor(e,i,a,u){if(this.triangleCount=i.length/3,this.min=new lt(0,0),this.max=new lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[d,p]=[e[0].clone(),e[0].clone()];for(let D=1;D<e.length;++D){let S=e[D];d.x=Math.min(d.x,S.x),d.y=Math.min(d.y,S.y),p.x=Math.max(p.x,S.x),p.y=Math.max(p.y,S.y)}if(u){let D=Math.ceil(Math.max(p.x-d.x,p.y-d.y)/u);a=Math.max(a,D)}if(a===0)return;this.min=d,this.max=p;let _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);let y=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/y)),this.cellsY=Math.max(1,Math.ceil(_.y/y)),this.xScale=1/y,this.yScale=1/y;let b=[];for(let D=0;D<this.triangleCount;D++){let S=e[i[3*D+0]].sub(this.min),R=e[i[3*D+1]].sub(this.min),k=e[i[3*D+2]].sub(this.min),F=fa(Math.floor(Math.min(S.x,R.x,k.x)),this.xScale,this.cellsX),z=fa(Math.floor(Math.max(S.x,R.x,k.x)),this.xScale,this.cellsX),j=fa(Math.floor(Math.min(S.y,R.y,k.y)),this.yScale,this.cellsY),Y=fa(Math.floor(Math.max(S.y,R.y,k.y)),this.yScale,this.cellsY),X=new lt(0,0),K=new lt(0,0),le=new lt(0,0),se=new lt(0,0);for(let me=j;me<=Y;++me){X.y=K.y=me*y,le.y=se.y=(me+1)*y;for(let _e=F;_e<=z;++_e)X.x=le.x=_e*y,K.x=se.x=(_e+1)*y,(uw(S,R,k,X,K,se)||uw(S,R,k,X,se,le))&&b.push({cellIdx:me*this.cellsX+_e,triIdx:D})}}if(b.length===0)return;b.sort((D,S)=>D.cellIdx-S.cellIdx||D.triIdx-S.triIdx);let T=0;for(;T<b.length;){let D=b[T].cellIdx,S={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===D;)++S.len,this.payload.push(b[T++].triIdx);this.cells[D]=S}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=fa(e.x-this.min.x,this.xScale,this.cellsX),u=fa(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[u*this.cellsX+a];if(d){this._lazyInitLookup();for(let p=0;p<d.len;p++){let _=this.payload[d.start+p],y=Math.floor(_/8),b=1<<_%8;if(!(this.lookup[y]&b)&&(this.lookup[y]|=b,i.push(_),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();let u=fa(e.x-this.min.x,this.xScale,this.cellsX),d=fa(i.x-this.min.x,this.xScale,this.cellsX),p=fa(e.y-this.min.y,this.yScale,this.cellsY),_=fa(i.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=_;y++)for(let b=u;b<=d;b++){let T=this.cells[y*this.cellsX+b];if(T)for(let D=0;D<T.len;D++){let S=this.payload[T.start+D],R=Math.floor(S/8),k=1<<S%8;if(!(this.lookup[R]&k)&&(this.lookup[R]|=k,a.push(S),a.length===this.triangleCount))return}}}}function fa(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}J(Tw,"TriangleGridIndex");class lM{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(let a of this.footprints)i.push({footprint:a,id:e})}populate(e,i,a,u){let d=[];for(let{feature:p,id:_,index:y,sourceLayerIndex:b}of e){let T=this.layers[0]._featureFilter.needGeometry,D=al(p,T);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),D,a))continue;let S={id:_,properties:p.properties,type:p.type,sourceLayerIndex:b,index:y,geometry:T?D.geometry:Cs(p,a,u),patterns:{}};d.push(S)}for(let p of d){let{geometry:_,index:y,sourceLayerIndex:b}=p;this.addFeature(p,_,y,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[y].feature,_,y,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,u,d){}destroy(){}addFeature(e,i,a,u,d,p=[],_){for(let y of _0(i,2)){let b=[],T=[],D=[],S=new lt(1/0,1/0),R=new lt(-1/0,-1/0);for(let z of y)if(z.length!==0){z!==y[0]&&D.push(T.length/2);for(let j=0;j<z.length;j++)T.push(z[j].x),T.push(z[j].y),b.push(z[j]),S.x=Math.min(S.x,z[j].x),S.y=Math.min(S.y,z[j].y),R.x=Math.max(R.x,z[j].x),R.y=Math.max(R.y,z[j].y)}let k=Qm(T,D),F=new Tw(b,k,8,256);this.footprints.push({vertices:b,indices:k,grid:F,min:S,max:R})}}}J(lM,"ClipBucket",{omit:["layers"]});let _B=new On({"clip-layer-types":new Be(Te.layout_clip["clip-layer-types"])});var yB={paint:new On({}),layout:_B};let vB=An([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xB=An([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),bB=An([{name:"a_centroid_pos",components:2,type:"Uint16"}]),wB=An([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),EB=An([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:TB}=vB;var v0={},CB=md,cM=cf;function cf(t,e,i,a,u){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=u,t.readFields(IB,this,e)}function IB(t,e,i){t==1?e.id=i.readVarint():t==2?function(a,u){for(var d=a.readVarint()+a.pos;a.pos<d;){var p=u._keys[a.readVarint()],_=u._values[a.readVarint()];u.properties[p]=_}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function DB(t){for(var e,i,a=0,u=0,d=t.length,p=d-1;u<d;p=u++)a+=((i=t[p]).x-(e=t[u]).x)*(e.y+i.y);return a}cf.types=["Unknown","Point","LineString","Polygon"],cf.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,a=1,u=0,d=0,p=0,_=[];t.pos<i;){if(u<=0){var y=t.readVarint();a=7&y,u=y>>3}if(u--,a===1||a===2)d+=t.readSVarint(),p+=t.readSVarint(),a===1&&(e&&_.push(e),e=[]),e.push(new CB(d,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},cf.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,a=0,u=0,d=0,p=1/0,_=-1/0,y=1/0,b=-1/0;t.pos<e;){if(a<=0){var T=t.readVarint();i=7&T,a=T>>3}if(a--,i===1||i===2)(u+=t.readSVarint())<p&&(p=u),u>_&&(_=u),(d+=t.readSVarint())<y&&(y=d),d>b&&(b=d);else if(i!==7)throw new Error("unknown command "+i)}return[p,y,_,b]},cf.prototype.toGeoJSON=function(t,e,i){var a,u,d=this.extent*Math.pow(2,i),p=this.extent*t,_=this.extent*e,y=this.loadGeometry(),b=cf.types[this.type];function T(R){for(var k=0;k<R.length;k++){var F=R[k];R[k]=[360*(F.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(a=0;a<y.length;a++)D[a]=y[a][0];T(y=D);break;case 2:for(a=0;a<y.length;a++)T(y[a]);break;case 3:for(y=function(R){var k=R.length;if(k<=1)return[R];for(var F,z,j=[],Y=0;Y<k;Y++){var X=DB(R[Y]);X!==0&&(z===void 0&&(z=X<0),z===X<0?(F&&j.push(F),F=[R[Y]]):F.push(R[Y]))}return F&&j.push(F),j}(y),a=0;a<y.length;a++)for(u=0;u<y[a].length;u++)T(y[a][u])}y.length===1?y=y[0]:b="Multi"+b;var S={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(S.id=this.id),S};var SB=cM,uM=hM;function hM(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(MB,this,e),this.length=this._features.length}function MB(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(a){for(var u=null,d=a.readVarint()+a.pos;a.pos<d;){var p=a.readVarint()>>3;u=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return u}(i))}hM.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new SB(this._pbf,e,this.extent,this._keys,this._values)};var AB=uM;function PB(t,e,i){if(t===3){var a=new AB(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}var Cw=v0.VectorTile=function(t,e){this.layers=t.readFields(PB,{},e)},x0=v0.VectorTileFeature=cM;v0.VectorTileLayer=uM;class rh extends lt{constructor(e,i,a){super(e,i),this.z=a}}class dM extends rh{constructor(e,i,a,u){super(e,i,a),this.w=u}}function b0(t,e,i,a){let u=[],d=a===0?(p,_,y,b,T,D)=>{p.push(new lt(D,y+(D-_)/(b-_)*(T-y)))}:(p,_,y,b,T,D)=>{p.push(new lt(_+(D-y)/(T-y)*(b-_),D))};for(let p of t){let _=[];for(let y of p){if(y.length<=2)continue;let b=[];for(let S=0;S<y.length-1;S++){let R=y[S].x,k=y[S].y,F=y[S+1].x,z=y[S+1].y,j=a===0?R:k,Y=a===0?F:z;j<e?Y>e&&d(b,R,k,F,z,e):j>i?Y<i&&d(b,R,k,F,z,i):b.push(y[S]),Y<e&&j>=e&&d(b,R,k,F,z,e),Y>i&&j<=i&&d(b,R,k,F,z,i)}let T=y[y.length-1],D=a===0?T.x:T.y;D>=e&&D<=i&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),_.push(b))}_.length&&u.push(_)}return u}function fM(t,e,i,a){let u=i==="x"?"y":"x",d=(a-t[i])/(e[i]-t[i]);t[u]=t[u]+(e[u]-t[u])*d,t[i]=a,t.hasOwnProperty("z")&&(t.z=Dt(t.z,e.z,d)),t.hasOwnProperty("w")&&(t.w=Dt(t.w,e.w,d))}function pM(t,e,i,a){let u=i,d=a;for(let p of["x","y"]){let _=t,y=e;_[p]>=y[p]&&(_=e,y=t),_[p]<u&&y[p]>u&&fM(_,y,p,u),_[p]<d&&y[p]>d&&fM(y,_,p,d)}}function w0(t,e){return t.x-e.x||t.y-e.y}function mM(t,e){return w0(t.min,e.min)===0&&w0(t.max,e.max)===0}function Iw(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Dw(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].sourceId!==e[i].sourceId||!mM(t[i],e[i])||t[i].order!==e[i].order||t[i].clipMask!==e[i].clipMask)return!1;return!0}function gM(t,e,i){let a=1/rt,u=1/(1<<i.canonical.z),d=(e.x*a+i.canonical.x)*u+i.wrap,p=(e.y*a+i.canonical.y)*u;return{min:new lt((t.x*a+i.canonical.x)*u+i.wrap,(t.y*a+i.canonical.y)*u),max:new lt(d,p)}}function RB(t,e,i){let a=1<<i.canonical.z,u=((e.x-i.wrap)*a-i.canonical.x)*rt,d=(e.y*a-i.canonical.y)*rt;return{min:new lt(((t.x-i.wrap)*a-i.canonical.x)*rt,(t.y*a-i.canonical.y)*rt),max:new lt(u,d)}}function _M(t,e,i,a,u,d,p){let _=t.indices,y=t.vertices,b=[];for(let T=a;T<a+u;T+=3){let D=e[i[T+0]+d],S=e[i[T+1]+d],R=e[i[T+2]+d],k=Math.min(D.x,S.x,R.x),F=Math.max(D.x,S.x,R.x),z=Math.min(D.y,S.y,R.y),j=Math.max(D.y,S.y,R.y);b.length=0,t.grid.query(new lt(k,z),new lt(F,j),b);for(let Y=0;Y<b.length;Y++){let X=b[Y];if(uw(y[_[3*X+0]],y[_[3*X+1]],y[_[3*X+2]],D,S,R,p))return!0}}return!1}function yM(t,e,i,a){if(!t||!i)return!1;let u=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<t.vertices.length)return yM(i,a,t,e);let d=e.canonical,p=a.canonical,_=Math.pow(2,p.z-d.z);u=t.vertices.map(y=>new lt((y.x+d.x*rt)*_-p.x*rt,(y.y+d.y*rt)*_-p.y*rt))}return _M(i,u,t.indices,0,t.indices.length,0,0)}function vM(t,e,i,a){let u=Math.pow(2,a.z-i.z);return new lt((t+i.x*rt)*u-a.x*rt,(e+i.y*rt)*u-a.y*rt)}function xM(t,e){let i=[];e.footprint.grid.queryPoint(t,i);let a=e.footprint.indices,u=e.footprint.vertices;for(let d=0;d<i.length;d++){let p=i[d];if(vc([u[a[3*p+0]],u[a[3*p+1]],u[a[3*p+2]]],t))return!0}return!1}class bM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){let a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function wM(t,e,i,a){let u=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(i[p]<t[p]||i[p]>e[p])return null}else{let _=1/a[p],y=(t[p]-i[p])*_,b=(e[p]-i[p])*_;if(y>b){let T=y;y=b,b=T}if(y>u&&(u=y),b<d&&(d=b),u>d)return null}return u}function EM(t,e,i,a,u,d,p,_,y,b,T){let D=a-t,S=u-e,R=d-i,k=p-t,F=_-e,z=y-i,j=T[1]*z-T[2]*F,Y=T[2]*k-T[0]*z,X=T[0]*F-T[1]*k,K=D*j+S*Y+R*X;if(Math.abs(K)<1e-15)return null;let le=1/K,se=b[0]-t,me=b[1]-e,_e=b[2]-i,Ee=(se*j+me*Y+_e*X)*le;if(Ee<0||Ee>1)return null;let ke=me*R-_e*S,Se=_e*D-se*R,ze=se*S-me*D,Ye=(T[0]*ke+T[1]*Se+T[2]*ze)*le;return Ye<0||Ee+Ye>1?null:(k*ke+F*Se+z*ze)*le}function TM(t,e,i){return(t-e)/(i-e)}function CM(t,e,i,a,u,d,p,_,y){let b=1<<i,T=d-a,D=p-u,S=(t+1)/b*T+a,R=(e+0)/b*D+u,k=(e+1)/b*D+u;_[0]=(t+0)/b*T+a,_[1]=R,y[0]=S,y[1]=k}class IM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(d){let p=Math.ceil(Math.log2(d.dim/8)),_=[],y=Math.ceil(Math.pow(2,p)),b=1/y,T=(R,k,F,z,j)=>{let Y=z?1:0,X=(R+1)*F-Y,K=k*F,le=(k+1)*F-Y;j[0]=R*F,j[1]=K,j[2]=X,j[3]=le},D=new bM(y),S=[];for(let R=0;R<y*y;R++){T(R%y,Math.floor(R/y),b,!1,S);let k=bc(S[0],S[1],d),F=bc(S[2],S[1],d),z=bc(S[2],S[3],d),j=bc(S[0],S[3],d);D.minimums.push(Math.min(k,F,z,j)),D.maximums.push(Math.max(k,F,z,j)),D.leaves.push(1)}for(_.push(D),y/=2;y>=1;y/=2){let R=_[_.length-1];D=new bM(y);for(let k=0;k<y*y;k++){T(k%y,Math.floor(k/y),2,!0,S);let F=R.getElevation(S[0],S[1]),z=R.getElevation(S[2],S[1]),j=R.getElevation(S[2],S[3]),Y=R.getElevation(S[0],S[3]),X=R.isLeaf(S[0],S[1]),K=R.isLeaf(S[2],S[1]),le=R.isLeaf(S[2],S[3]),se=R.isLeaf(S[0],S[3]),me=Math.min(F.min,z.min,j.min,Y.min),_e=Math.max(F.max,z.max,j.max,Y.max),Ee=X&&K&&le&&se;D.maximums.push(_e),D.minimums.push(me),D.leaves.push(_e-me<=5&&Ee?1:0)}_.push(D)}return _}(this.dem),a=i.length-1,u=i[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,u,d,p,_=1){return wM([e,i,-100],[a,u,this.maximums[0]*_],d,p)}raycast(e,i,a,u,d,p,_=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,i,a,u,d,p,_);if(y==null)return null;let b=[],T=[],D=[],S=[],R=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;R.length>0;){let{idx:k,t:F,nodex:z,nodey:j,depth:Y}=R.pop();if(this.leaves[k]){CM(z,j,Y,e,i,a,u,D,S);let K=1<<Y,le=(z+0)/K,se=(z+1)/K,me=(j+0)/K,_e=(j+1)/K,Ee=bc(le,me,this.dem)*_,ke=bc(se,me,this.dem)*_,Se=bc(se,_e,this.dem)*_,ze=bc(le,_e,this.dem)*_,Ye=EM(D[0],D[1],Ee,S[0],D[1],ke,S[0],S[1],Se,d,p),Le=EM(S[0],S[1],Se,D[0],S[1],ze,D[0],D[1],Ee,d,p),qe=Math.min(Ye!==null?Ye:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{let Oe=r._.scaleAndAdd([],d,p,F);if(DM(Ee,ke,ze,Se,TM(Oe[0],D[0],S[0]),TM(Oe[1],D[1],S[1]))>=Oe[2])return F}continue}let X=0;for(let K=0;K<this._siblingOffset.length;K++){CM((z<<1)+this._siblingOffset[K][0],(j<<1)+this._siblingOffset[K][1],Y+1,e,i,a,u,D,S),D[2]=-100,S[2]=this.maximums[this.childOffsets[k]+K]*_;let le=wM(D,S,d,p);if(le!=null){let se=le;b[K]=se;let me=!1;for(let _e=0;_e<X&&!me;_e++)se>=b[T[_e]]&&(T.splice(_e,0,K),me=!0);me||(T[X]=K),X++}}for(let K=0;K<X;K++){let le=T[K];R.push({idx:this.childOffsets[k]+le,t:b[le],nodex:(z<<1)+this._siblingOffset[le][0],nodey:(j<<1)+this._siblingOffset[le][1],depth:Y+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,u,d){if(e[u].isLeaf(i,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let p=u-1,_=e[p],y=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){let D=2*i+this._siblingOffset[T][0],S=2*a+this._siblingOffset[T][1],R=_.getElevation(D,S),k=_.isLeaf(D,S),F=this._addNode(R.min,R.max,k);k&&(y|=1<<T),b||(b=F)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*i+this._siblingOffset[T][0],2*a+this._siblingOffset[T][1],p,b+T)}}function DM(t,e,i,a,u,d){return Dt(Dt(t,i,d),Dt(e,a,d),u)}function bc(t,e,i){let a=i.dim,u=tn(t*a-.5,0,a-1),d=tn(e*a-.5,0,a-1),p=Math.floor(u),_=Math.floor(d),y=Math.min(p+1,a-1),b=Math.min(_+1,a-1);return DM(i.get(p,_),i.get(y,_),i.get(p,b),i.get(y,b),u-p,d-_)}let kB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function OB(t,e,i){return(256*t*256+256*e+i)/10-1e4}function LB(t,e,i){return 256*t+e+i/256-32768}class E0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return ki(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let d=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let y=0;y<d;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(d,y)]=p[this._idx(d-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,d)]=p[this._idx(y,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}let _=a==="terrarium"?LB:OB;for(let y=0;y<p.length;++y){let b=4*y;this.floatView[y]=_(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=ir.now()}_buildQuadTree(){this._tree=new IM(this)}get(e,i,a=!1){a&&(e=tn(e,-1,this.dim),i=tn(i,-1,this.dim));let u=this._idx(e,i);return this.floatView[u]}set(e,i,a){let u=this._idx(e,i),d=this.floatView[u];return this.floatView[u]=a,a-d}static getUnpackVector(e){return kB[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){let a=[0,0,0,0],u=E0.getUnpackVector(i),d=Math.floor((e+u[3])/u[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new iM({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,d=i*this.dim+this.dim,p=a*this.dim,_=a*this.dim+this.dim;switch(i){case-1:u=d-1;break;case 1:d=u+1}switch(a){case-1:p=_-1;break;case 1:_=p+1}let y=-i*this.dim,b=-a*this.dim;for(let T=p;T<_;T++)for(let D=u;D<d;D++){let S=4*this._idx(D,T),R=4*this._idx(D+y,T+b);this.pixels[S+0]=e.pixels[R+0],this.pixels[S+1]=e.pixels[R+1],this.pixels[S+2]=e.pixels[R+2],this.pixels[S+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}J(E0,"DEMData"),J(IM,"DemMinMaxQuadTree",{omit:["dem"]});class uf{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){let u=a||e.findDEMTileFor(i);if(!u||!u.dem)return;let d=u.dem,p=u.tileID,_=1<<i.canonical.z-p.canonical.z;return new uf(u,d.dim/rt/_,[(i.canonical.x/_-p.canonical.x)*d.dim,(i.canonical.y/_-p.canonical.y)*d.dim])}tileCoordToPixel(e,i){let a=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new lt(u,d)}getElevationAt(e,i,a,u){let d=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],_=Math.floor(d),y=Math.floor(p),b=this._dem;return u=!!u,a?Dt(Dt(b.get(_,y,u),b.get(_,y+1,u),p-y),Dt(b.get(_+1,y,u),b.get(_+1,y+1,u),p-y),d-_):b.get(_,y,u)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Yr(1,e)*this._dem.stride}}let SM={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},FB=x0.types,NB=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],zB=["fill-extrusion-flood-light-ground-radius"],BB=Math.pow(2,13),VB=Math.pow(2,15)-1,MM=new lt(0,1),wc=2147483648;function ng(t,e,i,a,u,d,p,_){t.emplaceBack((e<<1)+p,(i<<1)+d,(Math.floor(a*BB)<<1)+u,Math.round(_))}function T0(t,e,i,a,u,d){t.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+u,d)}function ig(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class AM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class PM{constructor(){this.centroidXY=new lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class RM{constructor(){this.acc=new lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===rt)&&i.x===a.x)!=((i.y===0||i.y===rt)&&i.y===a.y)&&this.processBorderOverlap(i,a),u&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Dt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>rt!=e.x>rt&&this.addBorderIntersection(1,Dt(i.y,e.y,(rt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Dt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>rt!=e.y>rt&&this.addBorderIntersection(3,Dt(i.x,e.x,(rt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new lt(0,0):new lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function kM(t,e){let i=t.add(e)._unit(),a=tn(t.x*i.x+t.y*i.y,-1,1);var u,d,p;return u=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(u)))/4*VB*((d=t).x*(p=e).y-d.y*p.x<0?-1:1)}let jB=[t=>t.x<0,t=>t.x>rt,t=>t.y<0,t=>t.y>rt];function UB(t,e,i,a){let u=[4];if(a===0)return u;i._mult(a);let d=t.sub(i),p=e.sub(i),_=[t,e,d,p];for(let y=0;y<4;y++)for(let b of _)if(jB[y](b)){u.push(y);break}return u}class OM{constructor(e){this.vertexArray=new R1,this.indexArray=new Ki,this.programConfigurations=new _c(e.layers,{zoom:e.zoom,lut:e.lut},i=>zB.includes(i)),this._segments=new _i,this.hiddenByLandmarkVertexArray=new q1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new _i}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,u=!1){let d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let b=e[0],T=e[1];y=kM(b.sub(e[d-1])._perp()._unit(),T.sub(b)._perp()._unit())}for(let b=0;b<d;b++){let T=b===d-1?0:b+1,D=e[b],S=e[T],R=e[T===d-1?0:T+1],k=S.sub(D)._perp()._unit(),F=kM(k,R.sub(S)._perp()._unit()),z=y,j=F;if(Sw(D,S,i)||u&&NM(D,i)&&NM(S,i)){y=F;continue}let Y=_.vertexLength;T0(this.vertexArray,D,S,1,1,z),T0(this.vertexArray,D,S,1,0,z),T0(this.vertexArray,D,S,0,1,j),T0(this.vertexArray,D,S,0,0,j),_.vertexLength+=4;let X=UB(D,S,k,a);for(let K of X)this._segmentToGroundQuads[p].push({id:Y,region:K}),this._segmentToRegionTriCounts[p][K]+=2,_.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((u,d)=>u.region-d.region);for(let a=0;a<i;a++){let u=this._segmentToGroundQuads[a],d=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((y,b)=>y+b,0);let _=0;for(let y=0;y<=4;y++){let b=p[y];if(b!==0){let T=this.regionSegments[y];T||(T=this.regionSegments[y]=new _i);let D={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:b};T.get().push(D)}_+=b}for(let y=0;y<u.length;y++){let b=u[y].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,u,d,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,u,d,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,xB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,u,d,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,u,d,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&wc?1:0;for(let u=e.groundVertexArrayOffset;u<i;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,wB.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let i=this.regionSegments[e];i&&i.destroy()}}}}class C0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ki,this.footprintVertices=new Es,this.footprintSegments=[],this.layoutVertexArray=new hc,this.centroidVertexArray=new vS,this.indexArray=new Ki,this.programConfigurations=new _c(e.layers,{zoom:e.zoom,lut:e.lut},i=>NB.includes(i)),this.segments=new _i,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new OM(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,a,u){this.features=[],this.hasPattern=ww("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=s0(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:d,id:p,index:_,sourceLayerIndex:y}of e){let b=this.layers[0]._featureFilter.needGeometry,T=al(d,b);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),T,a))continue;let D={id:p,sourceLayerIndex:y,index:_,geometry:b?T.geometry:Cs(d,a,u),properties:d.properties,type:d.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ew("fill-extrusion",this.layers,D,this.zoom,i)):this.addFeature(D,D.geometry,_,a,{},i.availableImages,u,i.brightness),i.featureIndex.insert(d,D.geometry,_,y,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,u,d,p){for(let _ of this.features){let{geometry:y}=_;this.addFeature(_,y,_.index,i,a,u,d,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,u,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,_,a,u,d),this.groundEffect.update(e,i,_,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,TB),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,EB.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,bB.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,u,d,p,_,y){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new lt(0,0),new lt(rt,rt)],D=_.projection,S=D.name==="globe",R=FB[e.type]==="Polygon",k=new RM;k.centroidDataIndex=this.centroidData.length;let F=new PM,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);F.height=j,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new t0);let Y=_0(i,500);for(let _e=Y.length-1;_e>=0;_e--){let Ee=Y[_e];(Ee.length===0||(X=Ee[0]).every(ke=>ke.x<=0)||X.every(ke=>ke.x>=rt)||X.every(ke=>ke.y<=0)||X.every(ke=>ke.y>=rt))&&Y.splice(_e,1)}var X;let K;if(S)K=jM(Y,T,u);else{K=[];for(let _e of Y)K.push({polygon:_e,bounds:T})}let le=R?this.edgeRadius:0,se=le>0&&this.zoom<17,me=(_e,Ee)=>{if(_e.length===0)return!1;let ke=_e[_e.length-1];return Ee.x===ke.x&&Ee.y===ke.y};for(let{polygon:_e,bounds:Ee}of K){let ke=0,Se=0;for(let qe of _e)R&&!qe[0].equals(qe[qe.length-1])&&qe.push(qe[0]),Se+=R?qe.length-1:qe.length;let ze=this.segments.prepareSegment((R?5:4)*Se,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let Ye={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Le=new AM;if(Le.vertexOffset=this.footprintVertices.length,Le.indexOffset=3*this.footprintIndices.length,Le.ringIndices=[],R){let qe=[],Oe=[];ke=ze.vertexLength;for(let Je=0;Je<_e.length;Je++){let Ze=_e[Je];Ze.length&&Je!==0&&Oe.push(qe.length/2);let ht=[],Xe,nt;Xe=Ze[1].sub(Ze[0])._perp()._unit(),Le.ringIndices.push(Ze.length-1);for(let Tt=1;Tt<Ze.length;Tt++){let vt=Ze[Tt],_t=Ze[Tt===Ze.length-1?1:Tt+1],et=vt.clone();if(le){nt=_t.sub(vt)._perp()._unit();let Ct=Xe.add(nt)._unit(),Yt=le*Math.min(4,1/(Xe.x*Ct.x+Xe.y*Ct.y));et.x+=Yt*Ct.x,et.y+=Yt*Ct.y,et.x=Math.round(et.x),et.y=Math.round(et.y),Xe=nt}!z||le!==0&&!se||me(ht,et)||ht.push(et),ng(this.layoutVertexArray,et.x,et.y,0,0,1,1,0),ze.vertexLength++,this.footprintVertices.emplaceBack(vt.x,vt.y),qe.push(vt.x,vt.y),S&&ig(this.layoutVertexExtArray,D.projectTilePoint(et.x,et.y,u),D.upVector(u,et.x,et.y))}z&&(le===0||se)&&(ht.length!==0&&me(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,Ee,b))}let We=Qm(qe,Oe);for(let Je=0;Je<We.length;Je+=3)this.footprintIndices.emplaceBack(Le.vertexOffset+We[Je+0],Le.vertexOffset+We[Je+1],Le.vertexOffset+We[Je+2]),this.indexArray.emplaceBack(ke+We[Je],ke+We[Je+2],ke+We[Je+1]),ze.primitiveLength++;Le.indexCount+=We.length,Le.vertexCount+=this.footprintVertices.length-Le.vertexOffset}for(let qe=0;qe<_e.length;qe++){let Oe=_e[qe];k.startRing(F,Oe[0]);let We=Oe.length>4&&zM(Oe[Oe.length-2],Oe[0],Oe[1]),Je=le?$B(Oe[Oe.length-2],Oe[0],Oe[1],le):0,Ze=[],ht,Xe,nt;Xe=Oe[1].sub(Oe[0])._perp()._unit();let Tt=!0;for(let vt=1,_t=0;vt<Oe.length;vt++){let et=Oe[vt-1],Ct=Oe[vt],Yt=Oe[vt===Oe.length-1?1:vt+1];if(k.appendEdge(F,Ct,et),Sw(Ct,et,Ee)){le&&(Xe=Yt.sub(Ct)._perp()._unit(),Tt=!Tt);continue}let Pt=Ct.sub(et)._perp(),Qt=Pt.x/(Math.abs(Pt.x)+Math.abs(Pt.y)),Xt=Pt.y>0?1:0,sn=et.dist(Ct);if(_t+sn>32768&&(_t=0),le){nt=Yt.sub(Ct)._perp()._unit();let In=FM(et,Ct,Yt,LM(Xe,nt),le);isNaN(In)&&(In=0);let mn=Ct.sub(et)._unit();et=et.add(mn.mult(Je))._round(),Ct=Ct.add(mn.mult(-In))._round(),Je=In,Xe=nt,z&&this.zoom>=17&&(me(Ze,et)||Ze.push(et),me(Ze,Ct)||Ze.push(Ct))}let St=ze.vertexLength,Gn=Oe.length>4&&zM(et,Ct,Yt),Un=BM(_t,We,Tt);if(ng(this.layoutVertexArray,et.x,et.y,Qt,Xt,0,0,Un),ng(this.layoutVertexArray,et.x,et.y,Qt,Xt,0,1,Un),_t+=sn,Un=BM(_t,Gn,!Tt),We=Gn,ng(this.layoutVertexArray,Ct.x,Ct.y,Qt,Xt,0,0,Un),ng(this.layoutVertexArray,Ct.x,Ct.y,Qt,Xt,0,1,Un),ze.vertexLength+=4,this.indexArray.emplaceBack(St+0,St+1,St+2),this.indexArray.emplaceBack(St+1,St+3,St+2),ze.primitiveLength+=2,le){let In=ke+(vt===1?Oe.length-2:vt-2),mn=vt===1?ke:In+1;if(this.indexArray.emplaceBack(St+1,In,St+3),this.indexArray.emplaceBack(In,mn,St+3),ze.primitiveLength+=2,ht===void 0&&(ht=St),!Sw(Yt,Oe[vt],Ee)){let Dn=vt===Oe.length-1?ht:ze.vertexLength;this.indexArray.emplaceBack(St+2,St+3,Dn),this.indexArray.emplaceBack(St+3,Dn+1,Dn),this.indexArray.emplaceBack(St+3,mn,Dn+1),ze.primitiveLength+=3}Tt=!Tt}if(S){let In=this.layoutVertexExtArray,mn=D.projectTilePoint(et.x,et.y,u),Dn=D.projectTilePoint(Ct.x,Ct.y,u),ti=D.upVector(u,et.x,et.y),Xn=D.upVector(u,Ct.x,Ct.y);ig(In,mn,ti),ig(In,mn,ti),ig(In,Dn,Xn),ig(In,Dn,Xn)}}R&&(ke+=Oe.length-1),z&&le&&this.zoom>=17&&(Ze.length!==0&&me(Ze,Ze[0])&&Ze.pop(),this.groundEffect.addData(Ze,Ee,b,le>0))}this.footprintSegments.push(Le),Ye.triangleCount=this.indexArray.length-Ye.triangleArrayOffset,this.polygonSegments.push(Ye),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=k.borders?MM:this.encodeCentroid(k,F),this.centroidData.push(F),k.borders){this.featuresOnBorder.push(k);let _e=this.featuresOnBorder.length-1;for(let Ee=0;Ee<k.borders.length;Ee++)k.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(_e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,y),this.groundEffect.addPaintPropertiesData(e,a,d,p,u,y),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let y=this.centroidData[_],b=+(y.min.y+y.max.y>rt),T=2*b+(+(y.min.x+y.max.x>rt)^b);for(let D=0;D<y.polygonSegLen;D++){let S=y.polygonSegIdx+D;e.push({centroidIdx:_,subtile:T,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let i=new Ki;e.sort((_,y)=>_.triangleSegmentIdx===y.triangleSegmentIdx?_.subtile-y.subtile:_.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,u=0,d=0;for(let _ of e){if(_.triangleSegmentIdx!==a)break;d++}let p=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let _=0,y=u,b=u;for(let T=y;T<d&&e[T].subtile===_;T++)b++;for(;y!==d;){let T=e[y];_=T.subtile;let D=this.centroidData[T.centroidIdx].min.clone(),S=this.centroidData[T.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=y;k<b;k++){let F=e[k],z=this.polygonSegments[F.polygonSegmentIdx],j=this.centroidData[F.centroidIdx].min,Y=this.centroidData[F.centroidIdx].max,X=this.indexArray.uint16;for(let K=z.triangleArrayOffset;K<z.triangleArrayOffset+z.triangleCount;K++)i.emplaceBack(X[3*K],X[3*K+1],X[3*K+2]);R.primitiveLength+=z.triangleCount,D.x=Math.min(D.x,j.x),D.y=Math.min(D.y,j.y),S.x=Math.max(S.x,Y.x),S.y=Math.max(S.y,Y.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:D,max:S}),y=b;for(let k=y;k<d&&e[k].subtile===e[y].subtile;k++)b++}u=d;for(let T=u;T<p&&e[T].triangleSegmentIdx===e[u].triangleSegmentIdx;T++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){let u=0,d=0,p=1<<e.canonical.z;if(i){let F=i.getMinMaxForTile(e);F&&(u=F.min,d=F.max)}d+=this.maxHeight;let _=e.toUnwrapped(),y,b=[_.canonical.x/p+_.wrap,_.canonical.y/p],T=[(_.canonical.x+1)/p+_.wrap,(_.canonical.y+1)/p],D=new _i,S=(F,z,j)=>[F[0]*(1-j[0])+z[0]*j[0],F[1]*(1-j[1])+z[1]*j[1]],R=[],k=[];for(let F of this.triangleSubSegments){R[0]=F.min.x/rt,R[1]=F.min.y/rt,k[0]=F.max.x/rt,k[1]=F.max.y/rt;let z=S(b,T,R),j=S(b,T,k);if(new yi([z[0],z[1],u],[j[0],j[1],d]).intersectsPrecise(a)===0){y&&(D.segments.push(y),y=void 0);continue}let Y=F.segment;y&&y.vertexOffset!==Y.vertexOffset&&(D.segments.push(y),y=void 0),y?(y.vertexLength+=Y.vertexLength,y.primitiveLength+=Y.primitiveLength):y={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&D.segments.push(y),D}encodeCentroid(e,i){let a=e.centroid(),u=i.span(),d=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new lt(tn(a.x,1,rt-1)<<3|d,tn(a.y,1,rt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new lt(0,0);let i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){let u=i[0][0]!==a?0:1;return new lt(6|(i[0][0]!==a?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{let u=i[2][0]!==a?2:3;return new lt((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){let i=this.centroidData[e.centroidDataIndex];i.flags&=wc,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&wc?MM:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||d!==u.x){for(let p=i;p<a;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let u=i.getReplacementRegionsForTile(e.toUnwrapped());if(Dw(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let d=[];for(let p of this.activeReplacements){if(p.order<a)continue;let _=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&wc||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let b=0;b<y.footprintSegLen;b++){let T=this.footprintSegments[y.footprintSegIdx+b];if(d.length=0,GB(this.footprintVertices,T.vertexOffset,T.vertexCount,p.footprintTileId.canonical,e.canonical,d),_M(p.footprint,d,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-_)){y.flags|=wc;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let u=!1;for(let d=0;d<a.footprintSegLen;d++){let p=this.footprintSegments[a.footprintSegIdx+d],_=0;for(let y of p.ringIndices){for(let b=_,T=y+_-1;b<y+_;T=b++){let D=this.footprintVertices.int16[2*(b+p.vertexOffset)+0],S=this.footprintVertices.int16[2*(b+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(T+p.vertexOffset)+1];S>i!=R>i&&e<(this.footprintVertices.int16[2*(T+p.vertexOffset)+0]-D)*(i-S)/(R-S)+D&&(u=!u)}_=y}}return u}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,u=!0,d=4*(e+rt)*rt+(i+rt);if(this.partLookup.hasOwnProperty(d)){let p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&wc)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||this.footprintContainsPoint(e,i,p)&&p&&p.height>a&&(a=p.height,this.partLookup[d]=p,u=!!(p.flags&wc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[d]=void 0}}function LM(t,e){let i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function $B(t,e,i,a){let u=e.sub(t)._perp()._unit(),d=i.sub(e)._perp()._unit();return FM(t,e,i,LM(u,d),a)}function FM(t,e,i,a,u){let d=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(i)/3,u*d/a)}function Sw(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function NM(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function zM(t,e,i){if(t.x<0||t.x>=rt||e.x<0||e.x>=rt||i.x<0||i.x>=rt)return!1;let a=i.sub(e),u=a.perp(),d=t.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&u.x*d.x+u.y*d.y<0}function BM(t,e,i){let a=e?2|t:-3&t;return i?1|a:-2&a}function VM(){let t=Math.PI/32,e=Math.tan(t),i=of;return i*Math.sqrt(1+2*e*e)-i}function jM(t,e,i){let a=1<<i.z,u=no(i.x/a),d=no((i.x+1)/a),p=or(i.y/a),_=or((i.y+1)/a);return function(y,b,T,D,S=0,R){let k=[];if(!y.length||!T||!D)return k;let F=(se,me)=>{for(let _e of se)k.push({polygon:_e,bounds:me})},z=Math.ceil(Math.log2(T)),j=Math.ceil(Math.log2(D)),Y=z-j,X=[];for(let se=0;se<Math.abs(Y);se++)X.push(Y>0?0:1);for(let se=0;se<Math.min(z,j);se++)X.push(0),X.push(1);let K=y;if(K=b0(K,b[0].y-S,b[1].y+S,1),K=b0(K,b[0].x-S,b[1].x+S,0),!K.length)return k;let le=[];for(X.length?le.push({polygons:K,bounds:b,depth:0}):F(K,b);le.length;){let se=le.pop(),me=se.depth,_e=X[me],Ee=se.bounds[0],ke=se.bounds[1],Se=_e===0?Ee.x:Ee.y,ze=_e===0?ke.x:ke.y,Ye=R?R(_e,Se,ze):.5*(Se+ze),Le=b0(se.polygons,Se-S,Ye+S,_e),qe=b0(se.polygons,Ye-S,ze+S,_e);if(Le.length){let Oe=[Ee,new lt(_e===0?Ye:ke.x,_e===1?Ye:ke.y)];X.length>me+1?le.push({polygons:Le,bounds:Oe,depth:me+1}):F(Le,Oe)}if(qe.length){let Oe=[new lt(_e===0?Ye:Ee.x,_e===1?Ye:Ee.y),ke];X.length>me+1?le.push({polygons:qe,bounds:Oe,depth:me+1}):F(qe,Oe)}}return k}(t,e,Math.ceil((d-u)/11.25),Math.ceil((p-_)/11.25),1,(y,b,T)=>{if(y===0)return .5*(b+T);{let D=or((i.y+b/rt)/a);return(ha(.5*(or((i.y+T/rt)/a)+D))*a-i.y)*rt}})}function GB(t,e,i,a,u,d){let p=Math.pow(2,a.z-u.z);for(let _=0;_<i;_++){let y=t.int16[2*(_+e)+0],b=t.int16[2*(_+e)+1];y=(y+u.x*rt)*p-a.x*rt,b=(b+u.y*rt)*p-a.y*rt,d.push(new lt(y,b))}}J(C0,"FillExtrusionBucket",{omit:["layers","features"]}),J(PM,"PartData"),J(AM,"FootprintSegment"),J(RM,"BorderCentroidData"),J(OM,"GroundEffect");let HB=new On({visibility:new Be(Te["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Be(Te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var qB={paint:new On({"fill-extrusion-opacity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Be(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Be(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ut(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Be(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Be(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Be(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Be(Te["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Be(Te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Be(Te["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Be(Te["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:HB};function rg(t,e){return t.x*e.x+t.y*e.y}function UM(t,e){if(t.length===1){let i=0,a=e[i++],u;for(;!u||a.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){let d=e[i],p=t[0],_=u.sub(a),y=d.sub(a),b=p.sub(a),T=rg(_,_),D=rg(_,y),S=rg(y,y),R=rg(b,_),k=rg(b,y),F=T*S-D*D,z=(S*R-D*k)/F,j=(T*k-D*R)/F,Y=a.z*(1-z-j)+u.z*z+d.z*j;if(isFinite(Y))return Y}return 1/0}{let i=1/0;for(let a of e)i=Math.min(i,a.z);return i}}function $M(t,e,i,a,u,d,p,_){let y=p*u.getElevationAt(t,e,!0,!0),b=d[0]!==0,T=b?d[1]===0?p*(d[0]/7-450):p*function(D,S,R){let k=Math.floor(S[0]/8),F=Math.floor(S[1]/8),z=10*(S[0]-8*k),j=10*(S[1]-8*F),Y=D.getElevationAt(k,F,!0,!0),X=D.getMeterToDEM(R),K=Math.floor(.5*(z*X-1)),le=Math.floor(.5*(j*X-1)),se=D.tileCoordToPixel(k,F),me=2*K+1,_e=2*le+1,Ee=function(qe,Oe,We,Je,Ze){return[qe.getElevationAtPixel(Oe,We,!0),qe.getElevationAtPixel(Oe+Ze,We,!0),qe.getElevationAtPixel(Oe,We+Ze,!0),qe.getElevationAtPixel(Oe+Je,We+Ze,!0)]}(D,se.x-K,se.y-le,me,_e),ke=Math.abs(Ee[0]-Ee[1]),Se=Math.abs(Ee[2]-Ee[3]),ze=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),Ye=Math.min(.25,.5*X*(ke+Se)/me),Le=Math.min(.25,.5*X*ze/_e);return Y+Math.max(Ye*z,Le*j)}(u,d,_):y;return{base:y+(i===0)?-1:i,top:b?Math.max(T+a,y+i+2):y+a}}let WB=An([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ZB}=WB,YB=An([{name:"a_packed",components:4,type:"Float32"}]),{members:XB}=YB,KB=An([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:QB}=KB,JB=An([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),eV=An([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),tV=An([{name:"a_projected_pos",components:4,type:"Float32"}],4);An([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Mw=An([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),GM=An([{name:"a_z_offset",components:1,type:"Float32"}],4),nV=An([{name:"a_texb",components:2,type:"Uint16"}]),iV=An([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),rV=An([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);An([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let HM=An([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oV=An([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);An([{name:"triangle",components:3,type:"Uint16"}]),An([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),An([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),An([{type:"Float32",name:"offsetX"}]),An([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class qM{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new xc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){let a=this.getKey(e,i);return this.positions[a]}trim(){let e=this.width,i=this.height=qp(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){let u=[],d=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,_=!0;u.push({left:d,right:p,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){_=!_;let T=e[b];d=y*a,y+=T,p=y*a,u.push({left:d,right:p,isDash:_,zeroLength:T===0})}return u}addRoundDash(e,i,a){let u=i/2;for(let d=-a;d<=a;d++){let p=this.width*(this.nextRow+a+d),_=0,y=e[_];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++_]);let T=Math.abs(b-y.left),D=Math.abs(b-y.right),S=Math.min(T,D),R,k=d/a*(u+1);if(y.isDash){let F=u-Math.abs(k);R=Math.sqrt(S*S+F*F)}else R=u-Math.sqrt(S*S+k*k);this.image.data[p+b]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let y=e.length-1;y>=0;--y){let b=e[y],T=e[y+1];b.zeroLength?e.splice(y,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(y,1))}let a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);let d=this.width*this.nextRow,p=0,_=e[p];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++p]);let b=Math.abs(y-_.left),T=Math.abs(y-_.right),D=Math.min(b,T);this.image.data[d+y]=Math.max(0,Math.min(255,(_.isDash?D:-D)+i+128))}}addDash(e,i){let a=this.getKey(e,i);if(this.positions[a])return this.positions[a];let u=i==="round",d=u?7:0,p=2*d+1;if(this.nextRow+p>this.height)return ki("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let T=0;T<e.length;T++)e[T]<0&&(ki("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),_+=e[T];if(_!==0){let T=this.width/_,D=this.getDashRanges(e,this.width,T);u?this.addRoundDash(D,T,d):this.addRegularDash(D,i==="square"?.5*T:0)}let y=this.nextRow+d;this.nextRow+=p;let b={tl:[y,d],br:[_,0]};return this.positions[a]=b,b}}J(qM,"LineAtlas");let sV=x0.types,aV=Math.cos(Math.PI/180*37.5),lV=Math.cos(Math.PI/180*5);class I0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new k1,this.layoutVertexArray2=new dc,this.patternVertexArray=new fc,this.indexArray=new Ki,this.programConfigurations=new _c(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new _i,this.maxLineLength=0,this.zOffsetVertexArray=new Ku,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:rt/64}updateFootprints(e,i){}populate(e,i,a,u){this.hasPattern=ww("line",this.layers,i);let d=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let _=[];for(let{feature:D,id:S,index:R,sourceLayerIndex:k}of e){let F=this.layers[0]._featureFilter.needGeometry,z=al(D,F);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),z,a))continue;let j=d?d.evaluate(z,{},a):void 0,Y={id:S,properties:D.properties,type:D.type,sourceLayerIndex:k,index:R,geometry:F?z.geometry:Cs(D,a,u),patterns:{},sortKey:j};_.push(Y)}d&&_.sort((D,S)=>D.sortKey-S.sortKey);let{lineAtlas:y,featureIndex:b}=i,T=this.addConstantDashes(y);for(let D of _){let{geometry:S,index:R,sourceLayerIndex:k}=D;if(T&&this.addFeatureDashes(D,y),this.hasPattern){let F=Ew("line",this.layers,D,this.zoom,i);this.patternFeatures.push(F)}else this.addFeature(D,S,R,a,y.positions,i.availableImages,i.brightness);b.insert(e[R].feature,S,R,k,this.index)}}addConstantDashes(e){let i=!1;for(let a of this.layers){let u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")i=!0;else{let p=d.value,_=u.value;if(!_)continue;e.addDash(_,p)}}return i}addFeatureDashes(e,i){let a=this.zoom;for(let u of this.layers){let d=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let _,y;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:a},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),i.addDash(_,y),e.patterns[u.id]=i.getKey(_,y)}}update(e,i,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,i,a,u,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,XB)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,QB)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,GM.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ZB),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,u,d,p,_){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),D=y.get("line-miter-limit"),S=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let R of i)this.addLine(R,e,u,b,T,D,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,_)}addLine(e,i,a,u,d,p,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},b=this.layers[0].layout,T=u==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<e.length-1;se++)this.totalDistance+=e[se].dist(e[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let D=sV[i.type]==="Polygon",S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let R=0;for(;R<S-1&&e[R].equals(e[R+1]);)R++;if(S<(D?3:2))return;u==="bevel"&&(p=1.05);let k=this.overscaling<=16?15*rt/(512*this.overscaling):0,F=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray),z,j,Y,X,K,le;this.e1=this.e2=-1,D&&(z=e[S-2],K=e[R].sub(z)._unit()._perp());for(let se=R;se<S;se++){if(Y=se===S-1?D?e[R+1]:void 0:e[se+1],Y&&e[se].equals(Y))continue;if(K&&(X=K),z&&(j=z),z=e[se],this.hasZOffset){let Oe=b.get("line-z-offset").value;if(Oe.kind==="constant")le=Oe.value;else{if(this.lineClips){let We=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(We*this.lineClips.start+this.distance+(j?j.dist(z):0))/We}else ki(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;le=Oe.evaluate(y,i)}le=le||0}K=Y?Y.sub(z)._unit()._perp():X,X=X||K;let me=j&&Y,_e=me?u:D||T?"butt":d,Ee=X.x*K.x+X.y*K.y;if(T){let Oe=function(We){if(We.patternJoinNone){let Je=We.segmentPoints.length/2,Ze=We.lineSoFar-We.segmentStart;for(let ht=0;ht<Je;++ht){let Xe=We.segmentPoints[2*ht+1],nt=Math.round(We.segmentPoints[2*ht])+.5+.25*Xe;We.patternVertexArray.emplaceBack(nt,Ze,We.segmentStart),We.patternVertexArray.emplaceBack(nt,Ze,We.segmentStart)}We.segmentPoints.length=0}We.e1=We.e2=-1};if(me&&Ee<lV){this.updateDistance(j,z),this.addCurrentVertex(z,X,1,1,F,le),Oe(this),this.addCurrentVertex(z,K,-1,-1,F,le);continue}if(j){if(!Y){this.updateDistance(j,z),this.addCurrentVertex(z,X,1,1,F,le),Oe(this);continue}_e="miter"}}let ke=X.add(K);ke.x===0&&ke.y===0||ke._unit();let Se=ke.x*K.x+ke.y*K.y,ze=Se!==0?1/Se:1/0,Ye=2*Math.sqrt(2-2*Se),Le=Se<aV&&j&&Y,qe=X.x*K.y-X.y*K.x>0;if(Le&&se>R){let Oe=z.dist(j);if(Oe>2*k){let We=z.sub(z.sub(j)._mult(k/Oe)._round());this.updateDistance(j,We),this.addCurrentVertex(We,X,0,0,F,le),j=We}}if(me&&_e==="round"&&(ze<_?_e="miter":ze<=2&&(_e="fakeround")),_e==="miter"&&ze>p&&(_e="bevel"),_e==="bevel"&&(ze>2&&(_e="flipbevel"),ze<p&&(_e="miter")),j&&this.updateDistance(j,z),_e==="miter")ke._mult(ze),this.addCurrentVertex(z,ke,0,0,F,le);else if(_e==="flipbevel"){if(ze>100)ke=K.mult(-1);else{let Oe=ze*X.add(K).mag()/X.sub(K).mag();ke._perp()._mult(Oe*(qe?-1:1))}this.addCurrentVertex(z,ke,0,0,F,le),this.addCurrentVertex(z,ke.mult(-1),0,0,F,le)}else if(_e==="bevel"||_e==="fakeround"){let Oe=-Math.sqrt(ze*ze-1),We=qe?Oe:0,Je=qe?0:Oe;if(j&&this.addCurrentVertex(z,X,We,Je,F,le),_e==="fakeround"){let Ze=Math.round(180*Ye/Math.PI/20);for(let ht=1;ht<Ze;ht++){let Xe=ht/Ze;if(Xe!==.5){let Tt=Xe-.5;Xe+=Xe*Tt*(Xe-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Tt*Tt+(.848013+Ee*(.215638*Ee-1.06021)))}let nt=K.sub(X)._mult(Xe)._add(X)._unit()._mult(qe?-1:1);this.addHalfVertex(z,nt.x,nt.y,!1,qe,0,F,le)}}Y&&this.addCurrentVertex(z,K,-We,-Je,F,le)}else _e==="butt"?this.addCurrentVertex(z,ke,0,0,F,le):_e==="square"?(j||this.addCurrentVertex(z,ke,-1,-1,F,le),this.addCurrentVertex(z,ke,0,0,F,le),j&&this.addCurrentVertex(z,ke,1,1,F,le)):_e==="round"&&(j&&(this.addCurrentVertex(z,X,0,0,F,le),this.addCurrentVertex(z,X,1,1,F,le,!0)),Y&&(this.addCurrentVertex(z,K,-1,-1,F,le,!0),this.addCurrentVertex(z,K,0,0,F,le)));if(Le&&se<S-1){let Oe=z.dist(Y);if(Oe>2*k){let We=z.add(Y.sub(z)._mult(k/Oe)._round());this.updateDistance(z,We),this.addCurrentVertex(We,K,0,0,F,le),z=We}}}}addVerticesTo(e,i,a,u,d,p,_,y,b,T){let D=(i.w-e.w)/this.tessellationStep|0;if(D>1){this.lineSoFar=e.w;let S=(i.x-e.x)/D,R=(i.y-e.y)/D,k=(i.z-e.z)/D,F=(i.w-e.w)/D;for(let z=1;z<D;++z)e.x+=S,e.y+=R,e.z+=k,this.lineSoFar+=F,this.addHalfVertex(e,a,u,T,!1,_,b,e.z),this.addHalfVertex(e,d,p,T,!0,-y,b,e.z)}this.lineSoFar=i.w,this.addHalfVertex(i,a,u,T,!1,_,b,i.z),this.addHalfVertex(i,d,p,T,!0,-y,b,i.z)}addCurrentVertex(e,i,a,u,d,p,_=!1){let y=i.x+i.y*a,b=i.y-i.x*a,T=i.y*u-i.x,D=-i.y-i.x*u;if(p!=null){let R=rt+10,k=p,F=new dM(e.x,e.y,k,this.lineSoFar),z=WM(e,-10,R),j=this.lineSoFar;if(this.currentVertex)if(z){let Y=this.currentVertexIsOutside,X=this.currentVertex,K=new dM(e.x,e.y,k,this.lineSoFar);pM(X,K,-10,R),WM(K,-10,R)||(Y&&(this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,y,b,_,!1,a,d,X.z),this.addHalfVertex(X,T,D,_,!0,-u,d,X.z)),this.addVerticesTo(X,K,y,b,T,D,a,u,d,_))}else{let Y=this.currentVertex;this.currentVertexIsOutside&&(pM(Y,F,-10,R),this.e1=this.e2=-1,this.lineSoFar=Y.w,this.addHalfVertex(Y,y,b,_,!1,a,d,Y.z),this.addHalfVertex(Y,T,D,_,!0,-u,d,Y.z)),this.addVerticesTo(Y,F,y,b,T,D,a,u,d,_)}else z||(this.addHalfVertex(e,y,b,_,!1,a,d,p),this.addHalfVertex(e,T,D,_,!0,-u,d,p));this.currentVertex=F,this.currentVertexIsOutside=z,this.lineSoFar=j}else this.addHalfVertex(e,y,b,_,!1,a,d,p),this.addHalfVertex(e,T,D,_,!0,-u,d,p)}addHalfVertex({x:e,y:i},a,u,d,p,_,y,b){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let T=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),y.primitiveLength++),p?this.e2=T:this.e1=T,b!=null&&this.zOffsetVertexArray.emplaceBack(b)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}function WM(t,e,i){return t.x<e||t.x>i||t.y<e||t.y>i}J(I0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let cV=new On({"line-cap":new ut(Te.layout_line["line-cap"]),"line-join":new ut(Te.layout_line["line-join"]),"line-miter-limit":new Be(Te.layout_line["line-miter-limit"]),"line-round-limit":new Be(Te.layout_line["line-round-limit"]),"line-sort-key":new ut(Te.layout_line["line-sort-key"]),"line-z-offset":new ut(Te.layout_line["line-z-offset"]),visibility:new Be(Te.layout_line.visibility)});var D0={paint:new On({"line-opacity":new ut(Te.paint_line["line-opacity"]),"line-color":new ut(Te.paint_line["line-color"]),"line-translate":new Be(Te.paint_line["line-translate"]),"line-translate-anchor":new Be(Te.paint_line["line-translate-anchor"]),"line-width":new ut(Te.paint_line["line-width"]),"line-gap-width":new ut(Te.paint_line["line-gap-width"]),"line-offset":new ut(Te.paint_line["line-offset"]),"line-blur":new ut(Te.paint_line["line-blur"]),"line-dasharray":new ut(Te.paint_line["line-dasharray"]),"line-pattern":new ut(Te.paint_line["line-pattern"]),"line-gradient":new $i(Te.paint_line["line-gradient"]),"line-trim-offset":new Be(Te.paint_line["line-trim-offset"]),"line-trim-fade-range":new Be(Te.paint_line["line-trim-fade-range"]),"line-trim-color":new Be(Te.paint_line["line-trim-color"]),"line-emissive-strength":new Be(Te.paint_line["line-emissive-strength"]),"line-border-width":new ut(Te.paint_line["line-border-width"]),"line-border-color":new ut(Te.paint_line["line-border-color"]),"line-occlusion-opacity":new Be(Te.paint_line["line-occlusion-opacity"])}),layout:cV};function ZM(t,e,i){return e*(rt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function YM(t,e){return 1/ZM(t,1,e.tileZoom)}function XM(t,e,i,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let KM=t=>{let e=[];QM(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let i=t.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",u=!!t.paint.get("line-pattern").constantOr(1);return a&&u&&e.push("LINE_JOIN_NONE"),e};function QM(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class JM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){let a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var uV={read:function(t,e,i,a,u){var d,p,_=8*u-a-1,y=(1<<_)-1,b=y>>1,T=-7,D=i?u-1:0,S=i?-1:1,R=t[e+D];for(D+=S,d=R&(1<<-T)-1,R>>=-T,T+=_;T>0;d=256*d+t[e+D],D+=S,T-=8);for(p=d&(1<<-T)-1,d>>=-T,T+=a;T>0;p=256*p+t[e+D],D+=S,T-=8);if(d===0)d=1-b;else{if(d===y)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,a),d-=b}return(R?-1:1)*p*Math.pow(2,d-a)},write:function(t,e,i,a,u,d){var p,_,y,b=8*d-u-1,T=(1<<b)-1,D=T>>1,S=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:d-1,k=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+D>=1?S/y:S*Math.pow(2,1-D))*y>=2&&(p++,y/=2),p+D>=T?(_=0,p=T):p+D>=1?(_=(e*y-1)*Math.pow(2,u),p+=D):(_=e*Math.pow(2,D-1)*Math.pow(2,u),p=0));u>=8;t[i+R]=255&_,R+=k,_/=256,u-=8);for(p=p<<u|_,b+=u;b>0;t[i+R]=255&p,R+=k,p/=256,b-=8);t[i+R-k]|=128*F}},eA=ci,S0=uV;function ci(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ci.Varint=0,ci.Fixed64=1,ci.Bytes=2,ci.Fixed32=5;var Aw=4294967296,tA=1/Aw,nA=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ul(t){return t.type===ci.Bytes?t.readVarint()+t.pos:t.pos+1}function hf(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function iA(t,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var u=i.pos-1;u>=t;u--)i.buf[u+a]=i.buf[u]}function hV(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function dV(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function fV(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function pV(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function mV(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function gV(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function _V(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function yV(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function vV(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function M0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function df(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function rA(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ci.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),u=a>>3,d=this.pos;this.type=7&a,t(u,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=M0(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=rA(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=M0(this.buf,this.pos)+M0(this.buf,this.pos+4)*Aw;return this.pos+=8,t},readSFixed64:function(){var t=M0(this.buf,this.pos)+rA(this.buf,this.pos+4)*Aw;return this.pos+=8,t},readFloat:function(){var t=S0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=S0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(u,d,p){var _,y,b=p.buf;if(_=(112&(y=b[p.pos++]))>>4,y<128||(_|=(127&(y=b[p.pos++]))<<3,y<128)||(_|=(127&(y=b[p.pos++]))<<10,y<128)||(_|=(127&(y=b[p.pos++]))<<17,y<128)||(_|=(127&(y=b[p.pos++]))<<24,y<128)||(_|=(1&(y=b[p.pos++]))<<31,y<128))return hf(u,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&nA?function(i,a,u){return nA.decode(i.subarray(a,u))}(this.buf,e,t):function(i,a,u){for(var d="",p=a;p<u;){var _,y,b,T=i[p],D=null,S=T>239?4:T>223?3:T>191?2:1;if(p+S>u)break;S===1?T<128&&(D=T):S===2?(192&(_=i[p+1]))==128&&(D=(31&T)<<6|63&_)<=127&&(D=null):S===3?(y=i[p+2],(192&(_=i[p+1]))==128&&(192&y)==128&&((D=(15&T)<<12|(63&_)<<6|63&y)<=2047||D>=55296&&D<=57343)&&(D=null)):S===4&&(y=i[p+2],b=i[p+3],(192&(_=i[p+1]))==128&&(192&y)==128&&(192&b)==128&&((D=(15&T)<<18|(63&_)<<12|(63&y)<<6|63&b)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,S=1):D>65535&&(D-=65536,d+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),d+=String.fromCharCode(D),p+=S}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ci.Bytes)return t.push(this.readVarint(e));var i=ul(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ci.Bytes)return t.push(this.readSVarint());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ci.Bytes)return t.push(this.readBoolean());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ci.Bytes)return t.push(this.readFloat());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ci.Bytes)return t.push(this.readDouble());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ci.Bytes)return t.push(this.readFixed32());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ci.Bytes)return t.push(this.readSFixed32());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ci.Bytes)return t.push(this.readFixed64());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ci.Bytes)return t.push(this.readSFixed64());var e=ul(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ci.Varint)for(;this.buf[this.pos++]>127;);else if(e===ci.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ci.Fixed32)this.pos+=4;else{if(e!==ci.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),df(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),df(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),df(this.buf,-1&t,this.pos),df(this.buf,Math.floor(t*tA),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),df(this.buf,-1&t,this.pos),df(this.buf,Math.floor(t*tA),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,p,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(a,0,i),function(d,p){var _=(7&d)<<4;p.buf[p.pos++]|=_|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(u,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,u,d){for(var p,_,y=0;y<u.length;y++){if((p=u.charCodeAt(y))>55295&&p<57344){if(!_){p>56319||y+1===u.length?(a[d++]=239,a[d++]=191,a[d++]=189):_=p;continue}if(p<56320){a[d++]=239,a[d++]=191,a[d++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(a[d++]=239,a[d++]=191,a[d++]=189,_=null);p<128?a[d++]=p:(p<2048?a[d++]=p>>6|192:(p<65536?a[d++]=p>>12|224:(a[d++]=p>>18|240,a[d++]=p>>12&63|128),a[d++]=p>>6&63|128),a[d++]=63&p|128)}return d}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&iA(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),S0.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),S0.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var a=this.pos-i;a>=128&&iA(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,i){this.writeTag(t,ci.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,hV,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,dV,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,mV,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,fV,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,pV,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,gV,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,_V,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,yV,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,vV,e)},writeBytesField:function(t,e){this.writeTag(t,ci.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ci.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ci.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ci.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ci.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ci.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ci.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ci.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ci.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ci.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var ff=Fe(eA);let xV=["id","tile","layer","source","sourceLayer","state"];class oA{constructor(e,i,a,u,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let i of xV)this[i]!==void 0&&(e[i]=this[i]);return e}}class bV{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){let u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},gr(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(let d in this.state[e][u])a[d]||(this.deletedStates[e][u][d]=null)}else for(let d in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;let u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){let a=String(i),u=gr({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let d=this.deletedStates[e][i];if(d===null)return{};for(let p in d)delete u[p]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){let a={};for(let u in this.stateChanges){this.state[u]=this.state[u]||{};let d={};for(let p in this.stateChanges[u])this.state[u][p]||(this.state[u][p]={}),gr(this.state[u][p],this.stateChanges[u][p]),d[p]=this.state[u][p];a[u]=d}for(let u in this.deletedStates){this.state[u]=this.state[u]||{};let d={};if(this.deletedStates[u]===null)for(let p in this.state[u])d[p]={},this.state[u][p]={};else for(let p in this.deletedStates[u]){if(this.deletedStates[u][p]===null)this.state[u][p]={};else if(this.state[u][p])for(let _ of Object.keys(this.deletedStates[u][p]))delete this.state[u][p][_];d[p]=this.state[u][p]}a[u]=a[u]||{},gr(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let u in e)e[u].setFeatureState(a,i)}}class sA{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ue(rt,16,0),this.featureIndexArray=new yS,this.promoteId=i,this.is3DTile=!1}insert(e,i,a,u,d,p=0,_=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,d,p);let b=this.grid;for(let T=0;T<i.length;T++){let D=i[T],S=[1/0,1/0,-1/0,-1/0];for(let R=0;R<D.length;R++){let k=D[R];S[0]=Math.min(S[0],k.x),S[1]=Math.min(S[1],k.y),S[2]=Math.max(S[2],k.x),S[3]=Math.max(S[3],k.y)}_!==0&&(S[0]-=_,S[1]-=_,S[2]+=_,S[3]+=_),S[0]<rt&&S[1]<rt&&S[2]>=0&&S[3]>=0&&b.insert(y,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Cw(new ff(this.rawTileData)).layers,this.sourceLayerCoder=new JM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,a,u){this.loadVTLayers();let d=e.params||{},p=Sr(d.filter),_=e.tileResult,y=e.transform,b=_.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(k,F,z,j)=>LS(_.bufferedTilespaceGeometry,k,F,z,j));T.sort(wV);let D=null;y.elevation&&T.length>0&&(D=uf.create(y.elevation,this.tileID));let S={},R;for(let k=0;k<T.length;k++){let F=T[k];if(F===R)continue;R=F;let z=this.featureIndexArray.get(F),j=null;if(this.is3DTile){let Y=this.bucketLayerIDs[0][0],X=i[Y];if(X.type!=="model")continue;let{queryFeature:K,intersectionZ:le}=X.queryIntersectsMatchingFeature(_,z.featureIndex,p,y);K&&this.appendToResult(S,Y,z.featureIndex,K,le)}else this.loadMatchingFeature(S,z,p,d.layers,d.availableImages,i,a,u,(Y,X,K,le=0)=>(j||(j=Cs(Y,this.tileID.canonical,e.tileTransform)),X.queryIntersectsFeature(_,Y,K,j,this.z,e.transform,e.pixelPosMatrix,D,le)))}return S}loadMatchingFeature(e,i,a,u,d,p,_,y,b){let{featureIndex:T,bucketIndex:D,sourceLayerIndex:S,layoutVertexArrayOffset:R}=i,k=this.bucketLayerIDs[D];if(u&&!function(Y,X){for(let K=0;K<Y.length;K++)if(X.indexOf(Y[K])>=0)return!0;return!1}(u,k))return;let F=this.sourceLayerCoder.decode(S),z=this.vtLayers[F].feature(T);if(a.needGeometry){let Y=al(z,!0);if(!a.filter(new $t(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!a.filter(new $t(this.tileID.overscaledZ),z))return;let j=this.getId(z,F);for(let Y=0;Y<k.length;Y++){let X=k[Y];if(u&&u.indexOf(X)<0)continue;let K=p[X];if(!K)continue;let le={};j!==void 0&&y&&(le=y.getState(K.sourceLayer||"_geojsonTileLayer",j));let se=!b||b(z,K,le,R);if(!se)continue;let me=new oA(z,this.z,this.x,this.y,j),_e=gr({},_[X]);_e.paint=aA(_e.paint,K.paint,z,le,d),_e.layout=aA(_e.layout,K.layout,z,le,d),me.layer=_e,this.appendToResult(e,X,T,me,se)}}appendToResult(e,i,a,u,d){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:a,feature:u,intersectionZ:d})}lookupSymbolFeatures(e,i,a,u,d,p,_,y){let b={};this.loadVTLayers();let T=Sr(d);for(let D of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:u,featureIndex:D,layoutVertexArrayOffset:0},T,p,_,y,i);return b}loadFeature(e){let{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();let u=this.sourceLayerCoder.decode(a),d=this.vtFeatures[u];if(d[i])return d[i];let p=this.vtLayers[u].feature(i);return d[i]=p,p}hasLayer(e){for(let i of this.bucketLayerIDs)for(let a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){let u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function aA(t,e,i,a,u){return $l(t,(d,p)=>{let _=e instanceof pn?e.get(p):null;return _&&_.evaluate?_.evaluate(i,a,u):_})}function wV(t,e){return e-t}J(sA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var xr=24;let Is=128;function Pw(t,e){let{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new $t(t+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:u}=i,d=0;for(;d<a.length&&a[d]<=t;)d++;d=Math.max(0,d-1);let p=d;for(;p<a.length&&a[p]<t+1;)p++;p=Math.min(a.length-1,p);let _=a[d],y=a[p];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:y,minSize:i.evaluate(new $t(_)),maxSize:i.evaluate(new $t(y)),interpolationType:u}}}function A0(t,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:u}){return t.kind==="source"?a/Is:t.kind==="composite"?Dt(a/Is,u/Is,i):e}function pf(t,e){let i=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:u,minZoom:d,maxZoom:p}=t,_=u?tn(eo.interpolationFactor(u,e,d,p),0,1):0;t.kind==="camera"?a=Dt(t.minSize,t.maxSize,_):i=_}return{uSizeT:i,uSize:a}}var EV=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Is,evaluateSizeForFeature:A0,evaluateSizeForZoom:pf,getSizeData:Pw});function TV(t,e,i){return t.sections.forEach(a=>{a.text=function(u,d,p){let _=d.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),kn.applyArabicShaping&&(u=kn.applyArabicShaping(u)),u}(a.text,e,i)}),t}let og={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function CV(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function IV(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let Rw=3;function DV(t,e,i){e.glyphs=[],t===1&&i.readMessage(SV,e)}function SV(t,e,i){if(t===3){let{id:a,bitmap:u,width:d,height:p,left:_,top:y,advance:b}=i.readMessage(MV,{});e.glyphs.push({id:a,bitmap:new xc({width:d+2*Rw,height:p+2*Rw},u),metrics:{width:d,height:p,left:_,top:y,advance:b}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function MV(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}let lA=Rw,Fo={horizontal:1,vertical:2,horizontalOnly:3};class sg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){let a=new sg;return a.scale=e||1,a.fontStack=i,a}static forImage(e){let i=new sg;return i.imageName=e,i}}class mf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){let a=new mf;for(let u=0;u<e.sections.length;u++){let d=e.sections[u];d.image?a.addImageSection(d):a.addTextSection(d,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let u="";for(let d=0;d<i.length;d++){let p=i.charCodeAt(d+1)||null,_=i.charCodeAt(d-1)||null;u+=!a&&(p&&Ve(p)&&!og[i[d+1]]||_&&Ve(_)&&!og[i[d-1]])||!og[i[d]]?i[d]:og[i[d]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&P0[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&P0[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){let a=new mf;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(sg.forText(e.scale,e.fontStack||i));let a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){let i=e.image?e.image.namePrimary:"";if(i.length===0)return void ki("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(sg.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kw(t,e,i,a,u,d,p,_,y,b,T,D,S,R,k){let F=mf.fromFeature(t,u);D===Fo.vertical&&F.verticalizePunctuation(S);let z=[],j=function(se,me,_e,Ee,ke,Se){if(!se)return[];let ze=[],Ye=function(We,Je,Ze,ht,Xe,nt){let Tt=0;for(let vt=0;vt<We.length();vt++){let _t=We.getSection(vt);Tt+=cA(We.getCodePoint(vt),_t,ht,Xe,Je,nt)}return Tt/Math.max(1,Math.ceil(Tt/Ze))}(se,me,_e,Ee,ke,Se),Le=se.text.indexOf("\u200B")>=0,qe=0;for(let We=0;We<se.length();We++){let Je=se.getSection(We),Ze=se.getCodePoint(We);if(P0[Ze]||(qe+=cA(Ze,Je,Ee,ke,me,Se)),We<se.length()-1){let ht=!((Oe=Ze)<11904||!(ae["Bopomofo Extended"](Oe)||ae.Bopomofo(Oe)||ae["CJK Compatibility Forms"](Oe)||ae["CJK Compatibility Ideographs"](Oe)||ae["CJK Compatibility"](Oe)||ae["CJK Radicals Supplement"](Oe)||ae["CJK Strokes"](Oe)||ae["CJK Symbols and Punctuation"](Oe)||ae["CJK Unified Ideographs Extension A"](Oe)||ae["CJK Unified Ideographs"](Oe)||ae["Enclosed CJK Letters and Months"](Oe)||ae["Halfwidth and Fullwidth Forms"](Oe)||ae.Hiragana(Oe)||ae["Ideographic Description Characters"](Oe)||ae["Kangxi Radicals"](Oe)||ae["Katakana Phonetic Extensions"](Oe)||ae.Katakana(Oe)||ae["Vertical Forms"](Oe)||ae["Yi Radicals"](Oe)||ae["Yi Syllables"](Oe)));(AV[Ze]||ht||Je.imageName)&&ze.push(hA(We+1,qe,Ye,ze,PV(Ze,se.getCodePoint(We+1),ht&&Le),!1))}}var Oe;return dA(hA(se.length(),qe,Ye,ze,0,!0))}(F,b,d,e,a,R),{processBidirectionalText:Y,processStyledBidirectionalText:X}=kn;if(Y&&F.sections.length===1){let se=Y(F.toString(),j);for(let me of se){let _e=new mf;_e.text=me,_e.sections=F.sections;for(let Ee=0;Ee<me.length;Ee++)_e.sectionIndex.push(0);z.push(_e)}}else if(X){let se=X(F.text,F.sectionIndex,j);for(let me of se){let _e=new mf;_e.text=me[0],_e.sectionIndex=me[1],_e.sections=F.sections,z.push(_e)}}else z=function(se,me){let _e=[],Ee=se.text,ke=0;for(let Se of me)_e.push(se.substring(ke,Se)),ke=Se;return ke<Ee.length&&_e.push(se.substring(ke,Ee.length)),_e}(F,j);let K=[],le={positionedLines:K,text:F.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,me,_e,Ee,ke,Se,ze,Ye,Le,qe,Oe,We){let Je=0,Ze=0,ht=0,Xe=Ye==="right"?1:Ye==="left"?0:.5,nt=!1;for(let Yt of ke){let Pt=Yt.getSections();for(let Qt of Pt){if(Qt.imageName)continue;let Xt=me[Qt.fontStack];if(Xt&&(nt=Xt.ascender!==void 0&&Xt.descender!==void 0,!nt))break}if(!nt)break}let Tt=0;for(let Yt of ke){Yt.trim();let Pt=Yt.getMaxScale(),Qt=(Pt-1)*xr,Xt={positionedGlyphs:[],lineOffset:0};se.positionedLines[Tt]=Xt;let sn=Xt.positionedGlyphs,St=0;if(!Yt.length()){Ze+=Se,++Tt;continue}let Gn=0,Un=0;for(let mn=0;mn<Yt.length();mn++){let Dn=Yt.getSection(mn),ti=Yt.getSectionIndex(mn),Xn=Yt.getCodePoint(mn),Ti=Dn.scale,vi=null,Ar=null,Si=null,ui=xr,ji=0,sr=!(Le===Fo.horizontal||!Oe&&!Ge(Xn)||Oe&&(P0[Xn]||(vt=Xn,ae.Arabic(vt)||ae["Arabic Supplement"](vt)||ae["Arabic Extended-A"](vt)||ae["Arabic Presentation Forms-A"](vt)||ae["Arabic Presentation Forms-B"](vt))));if(Dn.imageName){let ar=Ee[Dn.imageName];if(!ar)continue;Si=Dn.imageName,se.iconsInText=se.iconsInText||!0,Ar=ar.paddedRect;let Jn=ar.displaySize;Ti=Ti*xr/We,vi={width:Jn[0],height:Jn[1],left:0,top:-lA,advance:sr?Jn[1]:Jn[0],localGlyph:!1},ji=nt?-vi.height*Ti:Pt*xr-17-Jn[1]*Ti,ui=vi.advance;let Xr=(sr?Jn[0]:Jn[1])*Ti-xr*Pt;Xr>0&&Xr>St&&(St=Xr)}else{let ar=_e[Dn.fontStack];if(!ar)continue;ar[Xn]&&(Ar=ar[Xn]);let Jn=me[Dn.fontStack];if(!Jn)continue;let Xr=Jn.glyphs[Xn];if(!Xr)continue;if(vi=Xr.metrics,ui=Xn!==8203?xr:0,nt){let dl=Jn.ascender!==void 0?Math.abs(Jn.ascender):0,ss=Jn.descender!==void 0?Math.abs(Jn.descender):0,ks=(dl+ss)*Ti;Gn<ks&&(Gn=ks,Un=(dl-ss)/2*Ti),ji=-dl*Ti}else ji=(Pt-Ti)*xr-17}sr?(se.verticalizable=!0,sn.push({glyph:Xn,imageName:Si,x:Je,y:Ze+ji,vertical:sr,scale:Ti,localGlyph:vi.localGlyph,fontStack:Dn.fontStack,sectionIndex:ti,metrics:vi,rect:Ar}),Je+=ui*Ti+qe):(sn.push({glyph:Xn,imageName:Si,x:Je,y:Ze+ji,vertical:sr,scale:Ti,localGlyph:vi.localGlyph,fontStack:Dn.fontStack,sectionIndex:ti,metrics:vi,rect:Ar}),Je+=vi.advance*Ti+qe)}sn.length!==0&&(ht=Math.max(Je-qe,ht),nt?fA(sn,Xe,St,Un,Se*Pt/2):fA(sn,Xe,St,0,Se/2)),Je=0;let In=Se*Pt+St;Xt.lineOffset=Math.max(St,Qt),Ze+=In,++Tt}var vt;let _t=Ze,{horizontalAlign:et,verticalAlign:Ct}=Ow(ze);(function(Yt,Pt,Qt,Xt,sn,St){let Gn=(Pt-Qt)*sn,Un=-St*Xt;for(let In of Yt)for(let mn of In.positionedGlyphs)mn.x+=Gn,mn.y+=Un})(se.positionedLines,Xe,et,Ct,ht,_t),se.top+=-Ct*_t,se.bottom=se.top+_t,se.left+=-et*ht,se.right=se.left+ht,se.hasBaseline=nt}(le,e,i,a,z,p,_,y,D,b,S,k),!function(se){for(let me of se)if(me.positionedGlyphs.length!==0)return!1;return!0}(K)&&le}let P0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},AV={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cA(t,e,i,a,u,d){if(e.imageName){let p=a[e.imageName];return p?p.displaySize[0]*e.scale*xr/d+u:0}{let p=i[e.fontStack],_=p&&p.glyphs[t];return _?_.metrics.advance*e.scale+u:0}}function uA(t,e,i,a){let u=Math.pow(t-e,2);return a?t<e?u/2:2*u:u+Math.abs(i)*i}function PV(t,e,i){let a=0;return t===10&&(a-=1e4),i&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function hA(t,e,i,a,u,d){let p=null,_=uA(e,i,u,d);for(let y of a){let b=uA(e-y.x,i,u,d)+y.badness;b<=_&&(p=y,_=b)}return{index:t,x:e,priorBreak:p,badness:_}}function dA(t){return t?dA(t.priorBreak).concat(t.index):[]}function Ow(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function fA(t,e,i,a,u){if(!(e||i||a||u))return;let d=t.length-1,p=t[d],_=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=d;y++)t[y].x-=_,t[y].y+=i+a+u}function RV(t,e,i,a){let{horizontalAlign:u,verticalAlign:d}=Ow(a),p=i[0]-t.displaySize[0]*u,_=i[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function pA(t,e,i,a,u,d){let p=t.imagePrimary,_;if(p.content){let z=p.content,j=p.pixelRatio||1;_=[z[0]/j,z[1]/j,p.displaySize[0]-z[2]/j,p.displaySize[1]-z[3]/j]}let y=e.left*d,b=e.right*d,T,D,S,R;i==="width"||i==="both"?(R=u[0]+y-a[3],D=u[0]+b+a[1]):(R=u[0]+(y+b-p.displaySize[0])/2,D=R+p.displaySize[0]);let k=e.top*d,F=e.bottom*d;return i==="height"||i==="both"?(T=u[1]+k-a[0],S=u[1]+F+a[2]):(T=u[1]+(k+F-p.displaySize[1])/2,S=T+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:T,right:D,bottom:S,left:R,collisionPadding:_}}class hl extends lt{constructor(e,i,a,u,d){super(e,i),this.angle=u,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new hl(this.x,this.y,this.z,this.angle,this.segment)}}function mA(t,e,i,a,u){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,_=0;for(;_>-i/2;){if(p--,p<0)return!1;_-=t[p].dist(d),d=t[p]}_+=t[p].dist(t[p+1]),p++;let y=[],b=0;for(;_<i/2;){let T=t[p],D=t[p+1];if(!D)return!1;let S=t[p-1].angleTo(T)-T.angleTo(D);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:S}),b+=S;_-y[0].distance>a;)b-=y.shift().angleDelta;if(b>u)return!1;p++,_+=T.dist(D)}return!0}function gA(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function _A(t,e,i){return t?.6*e*i:0}function yA(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function kV(t,e,i,a,u,d){let p=_A(i,u,d),_=yA(i,a)*d,y=0,b=gA(t)/2;for(let T=0;T<t.length-1;T++){let D=t[T],S=t[T+1],R=D.dist(S);if(y+R>b){let k=(b-y)/R,F=Dt(D.x,S.x,k),z=Dt(D.y,S.y,k),j=new hl(F,z,0,S.angleTo(D),T);return!p||mA(t,j,_,p,e)?j:void 0}y+=R}}function OV(t,e,i,a,u,d,p,_,y){let b=_A(a,d,p),T=yA(a,u),D=T*p,S=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-D<e/4&&(e=D+e/4),vA(t,S?e/2*_%e:(T/2+2*d)*p*_%e,e,b,i,D,S,!1,y)}function vA(t,e,i,a,u,d,p,_,y){let b=d/2,T=gA(t),D=0,S=e-i,R=[];for(let k=0;k<t.length-1;k++){let F=t[k],z=t[k+1],j=F.dist(z),Y=z.angleTo(F);for(;S+i<D+j;){S+=i;let X=(S-D)/j,K=Dt(F.x,z.x,X),le=Dt(F.y,z.y,X);if(K>=0&&K<y&&le>=0&&le<y&&S-b>=0&&S+b<=T){let se=new hl(K,le,0,Y,k);a&&!mA(t,se,d,a,u)||R.push(se)}}D+=j}return _||R.length||p||(R=vA(t,D/2,i,a,u,d,p,!0,y)),R}function xA(t,e,i,a,u){let d=[];for(let p=0;p<t.length;p++){let _=t[p],y;for(let b=0;b<_.length-1;b++){let T=_[b],D=_[b+1];T.x<e&&D.x<e||(T.x<e?T=new lt(e,T.y+(e-T.x)/(D.x-T.x)*(D.y-T.y))._round():D.x<e&&(D=new lt(e,T.y+(e-T.x)/(D.x-T.x)*(D.y-T.y))._round()),T.y<i&&D.y<i||(T.y<i?T=new lt(T.x+(i-T.y)/(D.y-T.y)*(D.x-T.x),i)._round():D.y<i&&(D=new lt(T.x+(i-T.y)/(D.y-T.y)*(D.x-T.x),i)._round()),T.x>=a&&D.x>=a||(T.x>=a?T=new lt(a,T.y+(a-T.x)/(D.x-T.x)*(D.y-T.y))._round():D.x>=a&&(D=new lt(a,T.y+(a-T.x)/(D.x-T.x)*(D.y-T.y))._round()),T.y>=u&&D.y>=u||(T.y>=u?T=new lt(T.x+(u-T.y)/(D.y-T.y)*(D.x-T.x),u)._round():D.y>=u&&(D=new lt(T.x+(u-T.y)/(D.y-T.y)*(D.x-T.x),u)._round()),y&&T.equals(y[y.length-1])||(y=[T],d.push(y)),y.push(D)))))}}return d}function bA(t){let e=0,i=0;for(let p of t)e+=p.w*p.h,i=Math.max(i,p.w);t.sort((p,_)=>_.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],u=0,d=0;for(let p of t)for(let _=a.length-1;_>=0;_--){let y=a[_];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,d=Math.max(d,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===y.w&&p.h===y.h){let b=a.pop();_<a.length&&(a[_]=b)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(a.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}J(hl,"Anchor");let _o=1;class Lw{constructor(e,{pixelRatio:i,version:a,stretchX:u,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=d,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+_o,this.paddedRect.y+_o]}get br(){return[this.paddedRect.x+this.paddedRect.w-_o,this.paddedRect.y+this.paddedRect.h-_o]}get displaySize(){return[(this.paddedRect.w-2*_o)/this.pixelRatio,(this.paddedRect.h-2*_o)/this.pixelRatio]}}class wA{constructor(e,i,a){let u={},d={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,u,p),this.addImages(i,d,p);let{w:_,h:y}=bA(p),b=new Lo({width:_||1,height:y||1});for(let T in e){let D=e[T],S=u[T].paddedRect;Lo.copy(D.data,b,{x:0,y:0},{x:S.x+_o,y:S.y+_o},D.data,a,D.sdf)}for(let T in i){let D=i[T],S=d[T].paddedRect,R=S.x+_o,k=S.y+_o,F=D.data.width,z=D.data.height;Lo.copy(D.data,b,{x:0,y:0},{x:R,y:k},D.data,a),Lo.copy(D.data,b,{x:0,y:z-1},{x:R,y:k-1},{width:F,height:1},a),Lo.copy(D.data,b,{x:0,y:0},{x:R,y:k+z},{width:F,height:1},a),Lo.copy(D.data,b,{x:F-1,y:0},{x:R-1,y:k},{width:1,height:z},a),Lo.copy(D.data,b,{x:0,y:0},{x:R+F,y:k},{width:1,height:z},a)}this.image=b,this.iconPositions=u,this.patternPositions=d}addImages(e,i,a){for(let u in e){let d=e[u],p={x:0,y:0,w:d.data.width+2*_o,h:d.data.height+2*_o};a.push(p),i[u]=new Lw(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let u in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,a),i),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;let[u,d]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(i.data,{useMipmap:p},{x:u,y:d})}}J(Lw,"ImagePosition"),J(wA,"ImageAtlas");let ag=1e20;function EA(t,e,i,a,u,d,p,_,y){for(let b=e;b<e+a;b++)TA(t,i*d+b,d,u,p,_,y);for(let b=i;b<i+u;b++)TA(t,b*d+e,1,a,p,_,y)}function TA(t,e,i,a,u,d,p){d[0]=0,p[0]=-ag,p[1]=ag,u[0]=t[e];for(let _=1,y=0,b=0;_<a;_++){u[_]=t[e+_*i];let T=_*_;do{let D=d[y];b=(u[_]-u[D]+T-D*D)/(_-D)/2}while(b<=p[y]&&--y>-1);y++,d[y]=_,p[y]=b,p[y+1]=ag}for(let _=0,y=0;_<a;_++){for(;p[y+1]<_;)y++;let b=d[y],T=_-b;t[e+_*i]=u[b]+T*T}}let Ds=2,Fw={none:0,ideographs:1,all:2};class gf{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,a){let u=[],d=this.urls[i]||A.GLYPHS_URL;for(let p in e)for(let _ of e[p])u.push({stack:p,id:_});Ul(u,({stack:p,id:_},y)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[_];if(T!==void 0)return void y(null,{stack:p,id:_,glyph:T});if(T=this._tinySDF(b,p,_),T)return b.glyphs[_]=T,void y(null,{stack:p,id:_,glyph:T});let D=Math.floor(_/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[D])return void y(null,{stack:p,id:_,glyph:T});let S=b.requests[D];S||(S=b.requests[D]=[],gf.loadGlyphRange(p,D,d,this.requestManager,(R,k)=>{if(k){b.ascender=k.ascender,b.descender=k.descender;for(let F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(b.glyphs[+F]=k.glyphs[+F]);b.ranges[D]=!0}for(let F of S)F(R,k);delete b.requests[D]})),S.push((R,k)=>{R?y(R):k&&y(null,{stack:p,id:_,glyph:k.glyphs[_]||null})})},(p,_)=>{if(p)a(p);else if(_){let y={};for(let{stack:b,id:T,glyph:D}of _)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Fw.none&&(this.localGlyphMode===Fw.all?!!this.localFontFamily:!!this.localFontFamily&&(ae["CJK Unified Ideographs"](e)||ae["Hangul Syllables"](e)||ae.Hiragana(e)||ae.Katakana(e)||ae["CJK Symbols and Punctuation"](e)||ae["CJK Unified Ideographs Extension A"](e)||ae["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,a){let u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),d=e.tinySDF=new gf.TinySDF({fontFamily:u,fontWeight:F,fontSize:24*Ds,buffer:3*Ds,radius:8*Ds}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];let p=String.fromCodePoint(a),{data:_,width:y,height:b,glyphWidth:T,glyphHeight:D,glyphLeft:S,glyphTop:R,glyphAdvance:k}=d.draw(p);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new xc({width:y,height:b},_),metrics:{width:T/Ds,height:D/Ds,left:S/Ds,top:R/Ds-27,advance:k/Ds,localGlyph:!0}}}}gf.loadGlyphRange=function(t,e,i,a,u){let d=256*e,p=d+255,_=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${d}-${p}`),Dd.Glyphs);Ha(_,(y,b)=>{if(y)u(y);else if(b){let T={},D=function(S){return new ff(S).readFields(DV,{})}(b);for(let S of D.glyphs)T[S.id]=S;u(null,{glyphs:T,ascender:D.ascender,descender:D.descender})}})},gf.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;let _=this.size=t+4*e,y=this._createCanvas(_),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${p} ${d} ${t}px ${u}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(t),p=Math.ceil(i),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),y=Math.min(this.size-this.buffer,p+Math.ceil(a)),b=_+2*this.buffer,T=y+2*this.buffer,D=Math.max(b*T,0),S=new Uint8ClampedArray(D),R={data:S,width:b,height:T,glyphWidth:_,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return R;let{ctx:k,buffer:F,gridInner:z,gridOuter:j}=this;k.clearRect(F,F,_,y),k.fillText(t,F,F+p);let Y=k.getImageData(F,F,_,y);j.fill(ag,0,D),z.fill(0,0,D);for(let X=0;X<y;X++)for(let K=0;K<_;K++){let le=Y.data[4*(X*_+K)+3]/255;if(le===0)continue;let se=(X+F)*b+K+F;if(le===1)j[se]=0,z[se]=ag;else{let me=.5-le;j[se]=me>0?me*me:0,z[se]=me<0?me*me:0}}EA(j,0,0,b,T,b,this.f,this.v,this.z),EA(z,F,F,_,y,b,this.f,this.v,this.z);for(let X=0;X<D;X++){let K=Math.sqrt(j[X])-Math.sqrt(z[X]);S[X]=Math.round(255-255*(K/this.radius+this.cutoff))}return R}};let Ec=_o;function CA(t,e,i,a){let u=[],d=t.imagePrimary,p=d.pixelRatio,_=d.paddedRect.w-2*Ec,y=d.paddedRect.h-2*Ec,b=t.right-t.left,T=t.bottom-t.top,D=d.stretchX||[[0,_]],S=d.stretchY||[[0,y]],R=(Se,ze)=>Se+ze[1]-ze[0],k=D.reduce(R,0),F=S.reduce(R,0),z=_-k,j=y-F,Y=0,X=k,K=0,le=F,se=0,me=z,_e=0,Ee=j;if(d.content&&a){let Se=d.content;Y=R0(D,0,Se[0]),K=R0(S,0,Se[1]),X=R0(D,Se[0],Se[2]),le=R0(S,Se[1],Se[3]),se=Se[0]-Y,_e=Se[1]-K,me=Se[2]-Se[0]-X,Ee=Se[3]-Se[1]-le}let ke=(Se,ze,Ye,Le)=>{let qe=k0(Se.stretch-Y,X,b,t.left),Oe=O0(Se.fixed-se,me,Se.stretch,k),We=k0(ze.stretch-K,le,T,t.top),Je=O0(ze.fixed-_e,Ee,ze.stretch,F),Ze=k0(Ye.stretch-Y,X,b,t.left),ht=O0(Ye.fixed-se,me,Ye.stretch,k),Xe=k0(Le.stretch-K,le,T,t.top),nt=O0(Le.fixed-_e,Ee,Le.stretch,F),Tt=new lt(qe,We),vt=new lt(Ze,We),_t=new lt(Ze,Xe),et=new lt(qe,Xe),Ct=new lt(Oe/p,Je/p),Yt=new lt(ht/p,nt/p),Pt=e*Math.PI/180;if(Pt){let Un=Math.sin(Pt),In=Math.cos(Pt),mn=[In,-Un,Un,In];Tt._matMult(mn),vt._matMult(mn),et._matMult(mn),_t._matMult(mn)}let Qt=Se.stretch+Se.fixed,Xt=Ye.stretch+Ye.fixed,sn=ze.stretch+ze.fixed,St=Le.stretch+Le.fixed,Gn=t.imageSecondary;return{tl:Tt,tr:vt,bl:et,br:_t,texPrimary:{x:d.paddedRect.x+Ec+Qt,y:d.paddedRect.y+Ec+sn,w:Xt-Qt,h:St-sn},texSecondary:Gn?{x:Gn.paddedRect.x+Ec+Qt,y:Gn.paddedRect.y+Ec+sn,w:Xt-Qt,h:St-sn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ct,pixelOffsetBR:Yt,minFontScaleX:me/p/b,minFontScaleY:Ee/p/T,isSDF:i}};if(a&&(d.stretchX||d.stretchY)){let Se=IA(D,z,k),ze=IA(S,j,F);for(let Ye=0;Ye<Se.length-1;Ye++){let Le=Se[Ye],qe=Se[Ye+1];for(let Oe=0;Oe<ze.length-1;Oe++)u.push(ke(Le,ze[Oe],qe,ze[Oe+1]))}}else u.push(ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return u}function R0(t,e,i){let a=0;for(let u of t)a+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return a}function IA(t,e,i){let a=[{fixed:-Ec,stretch:0}];for(let[u,d]of t){let p=a[a.length-1];a.push({fixed:u-p.stretch,stretch:p.stretch}),a.push({fixed:u-p.stretch,stretch:p.stretch+(d-u)})}return a.push({fixed:e+Ec,stretch:i}),a}function k0(t,e,i,a){return t/e*i+a}function O0(t,e,i,a){return t-e*i/a}function LV(t,e,i,a){let u=e+t.positionedLines[a].lineOffset;return a===0?i+u/2:i+(u+(e+t.positionedLines[a-1].lineOffset))/2}function FV(t,e=1,i=!1){let a=1/0,u=1/0,d=-1/0,p=-1/0,_=t[0];for(let R=0;R<_.length;R++){let k=_[R];(!R||k.x<a)&&(a=k.x),(!R||k.y<u)&&(u=k.y),(!R||k.x>d)&&(d=k.x),(!R||k.y>p)&&(p=k.y)}let y=Math.min(d-a,p-u),b=y/2,T=new bm([],NV);if(y===0)return new lt(a,u);for(let R=a;R<d;R+=y)for(let k=u;k<p;k+=y)T.push(new _f(R+b,k+b,b,t));let D=function(R){let k=0,F=0,z=0,j=R[0];for(let Y=0,X=j.length,K=X-1;Y<X;K=Y++){let le=j[Y],se=j[K],me=le.x*se.y-se.x*le.y;F+=(le.x+se.x)*me,z+=(le.y+se.y)*me,k+=3*me}return new _f(F/k,z/k,0,R)}(t),S=T.length;for(;T.length;){let R=T.pop();(R.d>D.d||!D.d)&&(D=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,S)),R.max-D.d<=e||(b=R.h/2,T.push(new _f(R.p.x-b,R.p.y-b,b,t)),T.push(new _f(R.p.x+b,R.p.y-b,b,t)),T.push(new _f(R.p.x-b,R.p.y+b,b,t)),T.push(new _f(R.p.x+b,R.p.y+b,b,t)),S+=4)}return i&&(console.log(`num probes: ${S}`),console.log(`best distance: ${D.d}`)),D.p}function NV(t,e){return e.max-t.max}class _f{constructor(e,i,a,u){this.p=new lt(e,i),this.h=a,this.d=function(d,p){let _=!1,y=1/0;for(let b=0;b<p.length;b++){let T=p[b];for(let D=0,S=T.length,R=S-1;D<S;R=D++){let k=T[D],F=T[R];k.y>d.y!=F.y>d.y&&d.x<(F.x-k.x)*(d.y-k.y)/(F.y-k.y)+k.x&&(_=!_),y=Math.min(y,kS(d,k,F))}}return(_?1:-1)*Math.sqrt(y)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}let Nw=Number.POSITIVE_INFINITY,zV=Math.sqrt(2);function DA(t,[e,i]){let a=0,u=0;if(i===Nw){e<0&&(e=0);let d=e/zV;switch(t){case"top-right":case"top-left":u=d-7;break;case"bottom-right":case"bottom-left":u=7-d;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function zw(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BV(t,e,i,a,u,d,p,_,y,b,T,D,S,R,k){let F=d.textMaxSize.evaluate(e,{},D);F===void 0&&(F=p);let z=t.layers[0].layout,j=z.get("icon-offset").evaluate(e,{},D),Y=MA(i.horizontal)||i.vertical,X=S.name==="globe",K=xr,le=p/K,se=t.tilePixelRatio*F/K,me=(qe=t.overscaling,t.zoom>18&&qe>2&&(qe>>=1),Math.max(rt/(512*qe),1)*z.get("symbol-spacing")),_e=z.get("text-padding")*t.tilePixelRatio,Ee=z.get("icon-padding")*t.tilePixelRatio,ke=dn(z.get("text-max-angle")),Se=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",ze=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ye=z.get("symbol-placement"),Le=me/2;var qe;let Oe=z.get("icon-text-fit").evaluate(e,{},D),We=z.get("icon-text-fit-padding").evaluate(e,{},D),Je=Oe!=="none",Ze;t.hasAnyIconTextFit===!1&&Je&&(t.hasAnyIconTextFit=!0),a&&Je&&(t.allowVerticalPlacement&&i.vertical&&(Ze=pA(a,i.vertical,Oe,We,j,le)),Y&&(a=pA(a,Y,Oe,We,j,le)));let ht=(Xe,nt,Tt)=>{if(nt.x<0||nt.x>=rt||nt.y<0||nt.y>=rt)return;let vt=null;if(X){let{x:_t,y:et,z:Ct}=S.projectTilePoint(nt.x,nt.y,Tt);vt={anchor:new hl(_t,et,Ct,0,void 0),up:S.upVector(Tt,nt.x,nt.y)}}(function(_t,et,Ct,Yt,Pt,Qt,Xt,sn,St,Gn,Un,In,mn,Dn,ti,Xn,Ti,vi,Ar,Si,ui,ji,sr,ar,Jn,Xr,dl){let ss=_t.addToLineVertexArray(et,Yt),ks,Ac,Pc,uh,A2,P2,R2,k2=0,O2=0,L2=0,F2=0,fE=-1,pE=-1,ga={},N2=Xl(""),hh=Ct?Ct.anchor:et,mE=St.layout.get("icon-text-fit").evaluate(ui,{},Jn)!=="none",gE=0,_E=0;if(St._unevaluatedLayout.getValue("text-radial-offset")===void 0?[gE,_E]=St.layout.get("text-offset").evaluate(ui,{},Jn).map(vo=>vo*xr):(gE=St.layout.get("text-radial-offset").evaluate(ui,{},Jn)*xr,_E=Nw),_t.allowVerticalPlacement&&Pt.vertical){let vo=Pt.vertical;if(ti)P2=Bw(vo),sn&&(R2=Bw(sn));else{let xo=St.layout.get("text-rotate").evaluate(ui,{},Jn)+90;Pc=L0(Gn,hh,et,Un,In,mn,vo,Dn,xo,Xn),sn&&(uh=L0(Gn,hh,et,Un,In,mn,sn,vi,xo))}}if(Qt){let vo=St.layout.get("icon-rotate").evaluate(ui,{},Jn),xo=CA(Qt,vo,sr,mE),If=sn?CA(sn,vo,sr,mE):void 0;Ac=L0(Gn,hh,et,Un,In,mn,Qt,vi,vo),k2=4*xo.length;let z2=_t.iconSizeData,dh=null;z2.kind==="source"?(dh=[Is*St.layout.get("icon-size").evaluate(ui,{},Jn)],dh[0]>Tc&&ki(`${_t.layerIds[0]}: Value for "icon-size" is >= ${lg}. Reduce your "icon-size".`)):z2.kind==="composite"&&(dh=[Is*ji.compositeIconSizes[0].evaluate(ui,{},Jn),Is*ji.compositeIconSizes[1].evaluate(ui,{},Jn)],(dh[0]>Tc||dh[1]>Tc)&&ki(`${_t.layerIds[0]}: Value for "icon-size" is >= ${lg}. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,xo,dh,Si,Ar,ui,!1,Ct,et,ss.lineStartIndex,ss.lineLength,-1,ar,Jn,Xr,dl),fE=_t.icon.placedSymbolArray.length-1,If&&(O2=4*If.length,_t.addSymbols(_t.icon,If,dh,Si,Ar,ui,Fo.vertical,Ct,et,ss.lineStartIndex,ss.lineLength,-1,ar,Jn,Xr,dl),pE=_t.icon.placedSymbolArray.length-1)}for(let vo in Pt.horizontal){let xo=Pt.horizontal[vo];ks||(N2=Xl(xo.text),ti?A2=Bw(xo):ks=L0(Gn,hh,et,Un,In,mn,xo,Dn,St.layout.get("text-rotate").evaluate(ui,{},Jn),Xn));let If=xo.positionedLines.length===1;if(L2+=SA(_t,Ct,et,xo,Xt,St,ti,ui,Xn,ss,Pt.vertical?Fo.horizontal:Fo.horizontalOnly,If?Object.keys(Pt.horizontal):[vo],ga,fE,ji,ar,Jn,Xr),If)break}Pt.vertical&&(F2+=SA(_t,Ct,et,Pt.vertical,Xt,St,ti,ui,Xn,ss,Fo.vertical,["vertical"],ga,pE,ji,ar,Jn,Xr));let Rc=-1,yE=(vo,xo)=>vo?Math.max(vo,xo):xo;Rc=yE(A2,Rc),Rc=yE(P2,Rc),Rc=yE(R2,Rc);let r4=Rc>-1?1:0;_t.glyphOffsetArray.length>=65535&&ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ui.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,ui.sortKey),_t.symbolInstances.emplaceBack(et.x,et.y,hh.x,hh.y,hh.z,ga.right>=0?ga.right:-1,ga.center>=0?ga.center:-1,ga.left>=0?ga.left:-1,ga.vertical>=0?ga.vertical:-1,fE,pE,N2,ks!==void 0?ks:_t.collisionBoxArray.length,ks!==void 0?ks+1:_t.collisionBoxArray.length,Pc!==void 0?Pc:_t.collisionBoxArray.length,Pc!==void 0?Pc+1:_t.collisionBoxArray.length,Ac!==void 0?Ac:_t.collisionBoxArray.length,Ac!==void 0?Ac+1:_t.collisionBoxArray.length,uh||_t.collisionBoxArray.length,uh?uh+1:_t.collisionBoxArray.length,Un,L2,F2,k2,O2,r4,0,gE,_E,Rc,0,1,1,mE?1:0)})(t,nt,vt,Xe,i,a,u,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,Se,y,0,Ee,ze,j,e,d,b,T,D,R,k)};if(Ye==="line")for(let Xe of xA(e.geometry,0,0,rt,rt)){let nt=OV(Xe,me,ke,i.vertical||Y,a,K,se,t.overscaling,rt);for(let Tt of nt)Y&&VV(t,Y.text,Le,Tt)||ht(Xe,Tt,D)}else if(Ye==="line-center"){for(let Xe of e.geometry)if(Xe.length>1){let nt=kV(Xe,ke,i.vertical||Y,a,K,se);nt&&ht(Xe,nt,D)}}else if(e.type==="Polygon")for(let Xe of _0(e.geometry,0)){let nt=FV(Xe,16);ht(Xe[0],new hl(nt.x,nt.y,0,0,void 0),D)}else if(e.type==="LineString")for(let Xe of e.geometry)ht(Xe,new hl(Xe[0].x,Xe[0].y,0,0,void 0),D);else if(e.type==="Point")for(let Xe of e.geometry)for(let nt of Xe)ht([nt],new hl(nt.x,nt.y,0,0,void 0),D)}let lg=255,Tc=lg*Is;function SA(t,e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z,j){let Y=function(le,se,me,_e,Ee,ke,Se,ze){let Ye=[];if(se.positionedLines.length===0)return Ye;let Le=_e.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,qe=function(ht){let Xe=ht[0],nt=ht[1],Tt=Xe*nt;return Tt>0?[Xe,-nt]:Tt<0?[-Xe,nt]:Xe===0?[nt,Xe]:[nt,-Xe]}(me),Oe=Math.abs(se.top-se.bottom);for(let ht of se.positionedLines)Oe-=ht.lineOffset;let We=se.positionedLines.length,Je=Oe/We,Ze=se.top-me[1];for(let ht=0;ht<We;++ht){let Xe=se.positionedLines[ht];Ze=LV(se,Je,Ze,ht);for(let nt of Xe.positionedGlyphs){if(!nt.rect)continue;let Tt=nt.rect||{},vt=lA+1,_t=!0,et=1,Ct=0;if(nt.imageName){let Si=Se[nt.imageName];if(!Si)continue;if(Si.sdf){ki("SDF images are not supported in formatted text and will be ignored.");continue}_t=!1,et=Si.pixelRatio,vt=_o/et}let Yt=(Ee||ze)&&nt.vertical,Pt=nt.metrics.advance*nt.scale/2,Qt=nt.metrics,Xt=nt.rect;if(Xt===null)continue;ze&&se.verticalizable&&(Ct=nt.imageName?Pt-nt.metrics.width*nt.scale/2:0);let sn=Ee?[nt.x+Pt,nt.y]:[0,0],St=[0,0],Gn=[0,0],Un=!1;Ee||(Yt?(Gn=[nt.x+Pt+qe[0],nt.y+qe[1]-Ct],Un=!0):St=[nt.x+Pt+me[0],nt.y+me[1]-Ct]);let In=Xt.w*nt.scale/(et*(nt.localGlyph?Ds:1)),mn=Xt.h*nt.scale/(et*(nt.localGlyph?Ds:1)),Dn,ti,Xn,Ti;if(Yt){let Si=nt.y-Ze,ui=new lt(-Pt,Pt-Si),ji=-Math.PI/2,sr=new lt(...Gn);Dn=new lt(-Pt+St[0],St[1]),Dn._rotateAround(ji,ui)._add(sr),Dn.x+=-Si+Pt,Dn.y-=(Qt.left-vt)*nt.scale;let ar=nt.imageName?Qt.advance*nt.scale:xr*nt.scale,Jn=String.fromCodePoint(nt.glyph);CV(Jn)?Dn.x+=(1-vt)*nt.scale:IV(Jn)?Dn.x+=ar-Qt.height*nt.scale+(-vt-1)*nt.scale:Dn.x+=nt.imageName||Qt.width+2*vt===Xt.w&&Qt.height+2*vt===Xt.h?(ar-mn)/2:(ar-(Qt.height+2*vt)*nt.scale)/2,ti=new lt(Dn.x,Dn.y-In),Xn=new lt(Dn.x+mn,Dn.y),Ti=new lt(Dn.x+mn,Dn.y-In)}else{let Si=(Qt.left-vt)*nt.scale-Pt+St[0],ui=(-Qt.top-vt)*nt.scale+St[1],ji=Si+In,sr=ui+mn;Dn=new lt(Si,ui),ti=new lt(ji,ui),Xn=new lt(Si,sr),Ti=new lt(ji,sr)}if(Le){let Si;Si=Ee?new lt(0,0):Un?new lt(qe[0],qe[1]):new lt(me[0],me[1]),Dn._rotateAround(Le,Si),ti._rotateAround(Le,Si),Xn._rotateAround(Le,Si),Ti._rotateAround(Le,Si)}let vi=new lt(0,0),Ar=new lt(0,0);Ye.push({tl:Dn,tr:ti,bl:Xn,br:Ti,texPrimary:Tt,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:sn,sectionIndex:nt.sectionIndex,isSDF:_t,pixelOffsetTL:vi,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}}return Ye}(0,a,y,d,p,_,u,t.allowVerticalPlacement),X=t.textSizeData,K=null;X.kind==="source"?(K=[Is*d.layout.get("text-size").evaluate(_,{},z)],K[0]>Tc&&ki(`${t.layerIds[0]}: Value for "text-size" is >= ${lg}. Reduce your "text-size".`)):X.kind==="composite"&&(K=[Is*k.compositeTextSizes[0].evaluate(_,{},z),Is*k.compositeTextSizes[1].evaluate(_,{},z)],(K[0]>Tc||K[1]>Tc)&&ki(`${t.layerIds[0]}: Value for "text-size" is >= ${lg}. Reduce your "text-size".`)),t.addSymbols(t.text,Y,K,y,p,_,T,e,i,b.lineStartIndex,b.lineLength,R,F,z,j,!1);for(let le of D)S[le]=t.text.placedSymbolArray.length-1;return 4*Y.length}function MA(t){for(let e in t)return t[e];return null}function L0(t,e,i,a,u,d,p,_,y,b){let T=p.top,D=p.bottom,S=p.left,R=p.right,k=p.collisionPadding;if(k&&(S-=k[0],T-=k[1],R+=k[2],D+=k[3]),y){let F=new lt(S,T),z=new lt(R,T),j=new lt(S,D),Y=new lt(R,D),X=dn(y),K=new lt(0,0);b&&(K=new lt(b[0],b[1])),F._rotateAround(X,K),z._rotateAround(X,K),j._rotateAround(X,K),Y._rotateAround(X,K),S=Math.min(F.x,z.x,j.x,Y.x),R=Math.max(F.x,z.x,j.x,Y.x),T=Math.min(F.y,z.y,j.y,Y.y),D=Math.max(F.y,z.y,j.y,Y.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,S,T,R,D,_,a,u,d),t.length-1}function Bw(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function VV(t,e,i,a){let u=t.compareText;if(e in u){let d=u[e];for(let p=d.length-1;p>=0;p--)if(a.dist(d[p])<i)return!0}else u[e]=[];return u[e].push(a),!1}function AA(t,e){let i=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),d=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),p=Math.sin(t._pitch)*d+u;return Math.min(1.01*p,u*(1/t._horizonShift))}function oh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let i=Math.pow(2,-t.z),a=t.x*i,u=(t.x+1)*i,d=t.y*i,p=(t.y+1)*i,_=no(a),y=no(u),b=or(d),T=or(p),D=e.project(_,b),S=e.project(y,b),R=e.project(y,T),k=e.project(_,T),F=Math.min(D.x,S.x,R.x,k.x),z=Math.min(D.y,S.y,R.y,k.y),j=Math.max(D.x,S.x,R.x,k.x),Y=Math.max(D.y,S.y,R.y,k.y),X=i/16;function K(se,me,_e,Ee,ke,Se){let ze=(_e+ke)/2,Ye=(Ee+Se)/2,Le=e.project(no(ze),or(Ye)),qe=Math.max(0,F-Le.x,z-Le.y,Le.x-j,Le.y-Y);F=Math.min(F,Le.x),j=Math.max(j,Le.x),z=Math.min(z,Le.y),Y=Math.max(Y,Le.y),qe>X&&(K(se,Le,_e,Ee,ze,Ye),K(Le,me,ze,Ye,ke,Se))}K(D,S,a,d,u,d),K(S,R,u,d,u,p),K(R,k,u,p,a,p),K(k,D,a,p,a,d),F-=X,z-=X,j+=X,Y+=X;let le=1/Math.max(j-F,Y-z);return{scale:le,x:F*le,y:z*le,x2:j*le,y2:Y*le,projection:e}}function PA(t,{x:e,y:i},a=0){return new lt(((e-a)*t.scale-t.x)*rt,(i*t.scale-t.y)*rt)}let jV=r.ad.identity(new Float32Array(16));class Cc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new bn(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a=!0){return e._coordinatePoint(e.locationCoordinate(i),a)}pixelsPerMeter(e,i){return Yr(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return AA(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,u){let d=e.horizonLineFromTop(!1),p=new lt(i,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,i,a){let u=new lt(i,a);if(e.elevation)return e.elevation.pointCoordinate(u);{let d=this.pointCoordinate(e,u.x,u.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);let a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return jV}createTileMatrix(e,i,a){let u,d,p,_=a.canonical,y=r.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=oh(_,this);u=1,d=b.x+a.wrap*b.scale,p=b.y,r.ad.scale(y,y,[u/b.scale,u/b.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*a.wrap)*u,p=_.y*u;return r.ad.translate(y,y,[d,p,0]),r.ad.scale(y,y,[u/rt,u/rt,1]),y}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class UV extends Cc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[i,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(dn(i));this.n=(u+Math.sin(dn(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){let{n:a,c:u,r0:d}=this,p=dn(e-this.center[0]),_=dn(i),y=Math.sqrt(u-2*a*Math.sin(_))/a;return{x:y*Math.sin(p*a),y:y*Math.cos(p*a)-d,z:0}}unproject(e,i){let{n:a,c:u,r0:d}=this,p=d+i,_=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));let y=dn(this.center[0])*a;_=Ua(_,-Math.PI-y,Math.PI-y);let b=tn(mr(_/a)+this.center[0],-180,180),T=Math.asin(tn((u-(e*e+p*p)*a*a)/(2*a),-1,1)),D=tn(mr(T),-Li,Li);return new bn(b,D)}}let cg=1.340264,ug=-.081106,hg=893e-6,dg=.003796,F0=Math.sqrt(3)/2;class $V extends Cc{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(F0*Math.sin(i)),u=a*a,d=u*u*u;return{x:.5*(e*Math.cos(a)/(F0*(cg+3*ug*u+d*(7*hg+9*dg*u)))/Math.PI+.5),y:1-.5*(a*(cg+ug*u+d*(hg+dg*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=a*a,d=u*u*u;for(let T,D,S,R=0;R<12&&(D=a*(cg+ug*u+d*(hg+dg*u))-i,S=cg+3*ug*u+d*(7*hg+9*dg*u),T=D/S,a=tn(a-T,-Math.PI/3,Math.PI/3),u=a*a,d=u*u*u,!(Math.abs(T)<1e-12));++R);let p=F0*e*(cg+3*ug*u+d*(7*hg+9*dg*u))/Math.cos(a),_=Math.asin(Math.sin(a)/F0),y=tn(180*p/Math.PI,-180,180),b=tn(180*_/Math.PI,-Li,Li);return new bn(y,b)}}class GV extends Cc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){let a=360*(e-.5),u=tn(360*(.5-i),-Li,Li);return new bn(a,u)}}let yf=Math.PI/2;function N0(t){return Math.tan((yf+t)/2)}class HV extends Cc{constructor(e){super(e),this.center=e.center||[0,30];let[i,a]=this.parallels=e.parallels||[30,30],u=dn(i),d=dn(a);this.southernCenter=u+d<0,this.southernCenter&&(u=-u,d=-d);let p=Math.cos(u),_=N0(u);this.n=u===d?Math.sin(u):Math.log(p/Math.cos(d))/Math.log(N0(d)/_),this.f=p*Math.pow(N0(u),this.n)/this.n}project(e,i){i=dn(i),this.southernCenter&&(i=-i),e=dn(e-this.center[0]);let a=1e-6,{n:u,f:d}=this;d>0?i<-yf+a&&(i=-yf+a):i>yf-a&&(i=yf-a);let p=d/Math.pow(N0(i),u),_=p*Math.sin(u*e),y=d-p*Math.cos(u*e);return _=.5*(_/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:_,y:this.southernCenter?y:1-y,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:a,f:u}=this,d=u-i,p=Math.sign(d),_=Math.sign(a)*Math.sqrt(e*e+d*d),y=Math.atan2(e,Math.abs(d))*p;d*a<0&&(y-=Math.PI*Math.sign(e)*p);let b=tn(mr(y/a)+this.center[0],-180,180),T=tn(mr(2*Math.atan(Math.pow(u/_,1/a))-yf),-Li,Li);return new bn(b,this.southernCenter?-T:T)}}class RA extends Cc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ua(e),y:ha(i),z:0}}unproject(e,i){let a=no(e),u=or(i);return new bn(a,u)}}let kA=dn(Li);class qV extends Cc{project(e,i){let a=(i=dn(i))*i,u=a*a;return{x:.5*((e=dn(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=25,d=0,p=a*a;do{p=a*a;let b=p*p;d=(a*(1.007226+p*(.015085+b*(.028874*p-.044475-.005916*b)))-i)/(1.007226+p*(.045255+b*(.259866*p-.311325-.005916*11*b))),a=tn(a-d,-kA,kA)}while(Math.abs(d)>1e-6&&--u>0);p=a*a;let _=tn(mr(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=mr(a);return new bn(_,y)}}let OA=dn(Li);class WV extends Cc{project(e,i){i=dn(i),e=dn(e);let a=Math.cos(i),u=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),p=Math.sin(d)/d,_=.5*(e*u+2*a*Math.sin(e/2)/p)||0,y=.5*(i+Math.sin(i)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,d=25,p=1e-6,_=0,y=0;do{let b=Math.cos(u),T=Math.sin(u),D=2*T*b,S=T*T,R=b*b,k=Math.cos(a/2),F=Math.sin(a/2),z=2*k*F,j=F*F,Y=1-R*k*k,X=Y?1/Y:0,K=Y?Math.acos(b*k)*Math.sqrt(1/Y):0,le=.5*(2*K*b*F+2*a/Math.PI)-e,se=.5*(K*T+u)-i,me=.5*X*(R*j+K*b*k*S)+1/Math.PI,_e=X*(z*D/4-K*T*F),Ee=.125*X*(D*F-K*T*R*z),ke=.5*X*(S*k+K*j*b)+.5,Se=_e*Ee-ke*me;_=(se*_e-le*ke)/Se,y=(le*Ee-se*me)/Se,a=tn(a-_,-Math.PI,Math.PI),u=tn(u-y,-OA,OA)}while((Math.abs(_)>p||Math.abs(y)>p)&&--d>0);return new bn(mr(a),mr(u))}}class LA extends Cc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(dn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){let{scale:a,cosPhi:u}=this;return{x:dn(e)*u*a+.5,y:-Math.sin(dn(i))/u*a+.5,z:0}}unproject(e,i){let{scale:a,cosPhi:u}=this,d=-(i-.5)/a,p=tn(mr((e-.5)/a)/u,-180,180),_=Math.asin(tn(d*u,-1,1)),y=tn(mr(_),-Li,Li);return new bn(p,y)}}class ZV extends RA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){let u=Ym(e,i,a),d=Xm(da(a));return r._.transformMat4(u,u,d),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){let a=eh(i.lat,i.lng),u=r._.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,p=Yr(1,0)*rt*d;r._.scaleAndAdd(a,a,u,p);let _=r.ad.identity(new Float64Array(16));return r.ad.multiply(_,e.pixelMatrix,e.globeMatrix),r._.transformMat4(a,a,_),new lt(a[0],a[1])}pixelsPerMeter(e,i){return Yr(1,0)*i}pixelSpaceConversion(e,i,a){let u=Yr(1,e)*i,d=Dt(Yr(1,45)*i,u,a);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,a){let u=gw(da(a.canonical));return r.ad.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){let{center:a}=e,u=Xm(da(i));return r.ad.rotateY(u,u,dn(a.lng)),r.ad.rotateX(u,u,dn(a.lat)),r.ad.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,a,u){return US(e,i,a,!0)||new Mr(0,0)}pointCoordinate3D(e,i,a){let u=this.pointCoordinate(e,i,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!US(e,i.x,i.y,!1)}farthestPixelDistance(e){let i=function(u,d){let p=u.cameraToCenterDistance,_=u._centerAltitude*d,y=u._camera,b=u._camera.forward(),T=r._.add([],r._.scale([],b,-p),[0,0,_]),D=u.worldSize/(2*Math.PI),S=[0,0,-D],R=u.width/u.height,k=Math.tan(u.fovAboveCenter),F=r._.scale([],y.up(),k),z=r._.scale([],y.right(),k*R),j=r._.normalize([],r._.add([],r._.add([],b,F),z)),Y=[],X;if(new hw(T,j).closestPointOnSphere(S,D,Y)){let K=r._.add([],Y,S),le=r._.sub([],K,T);X=Math.cos(u.fovAboveCenter)*r._.length(le)}else{let K=r._.sub([],T,S),le=r._.sub([],S,T);r._.normalize(le,le);let se=r._.length(K)-D;X=Math.sqrt(se*(se+2*D));let me=Math.acos(X/(D+se))-Math.acos(r._.dot(b,le));X*=Math.cos(me)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=cl(e.zoom);if(a>0){let u=AA(e,Yr(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Dt(i,u+d*(1-Math.cos(p)),Math.pow(a,10))}return i}upVector(e,i,a){return Ym(i,a,e,1)}upVectorScale(e){return{metersToTile:h0(f0(da(e)))}}}function FA(t){let e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new RA(t);case"equirectangular":return new GV(t);case"naturalEarth":return new qV(t);case"equalEarth":return new $V(t);case"winkelTripel":return new WV(t);case"albers":return i?new LA(t):new UV(t);case"lambertConformalConic":return i?new LA(t):new HV(t);case"globe":return new ZV(t)}throw new Error(`Invalid projection name: ${t.name}`)}let YV=(()=>{class t{constructor(i,a,u,d){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=i;let p=i.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||d||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class vf{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}vf.ReadOnly=!1,vf.ReadWrite=!0,vf.disabled=new vf(519,vf.ReadOnly,[0,1]);let Vw=7680;class jw{constructor(e,i,a,u,d,p){this.test=e,this.ref=i,this.mask=a,this.fail=u,this.depthFail=d,this.pass=p}}jw.disabled=new jw({func:519,mask:0},0,0,Vw,Vw,Vw);let fg=771;class yo{constructor(e,i,a,u){this.blendFunction=e,this.blendColor=i,this.mask=a,this.blendEquation=u}}yo.Replace=[1,0,1,0],yo.disabled=new yo(yo.Replace,En.transparent,[!1,!1,!1,!1]),yo.unblended=new yo(yo.Replace,En.transparent,[!0,!0,!0,!0]),yo.alphaBlended=new yo([1,fg,1,fg],En.transparent,[!0,!0,!0,!0]),yo.alphaBlendedNonPremultiplied=new yo([770,fg,770,fg],En.transparent,[!0,!0,!0,!0]),yo.multiply=new yo([774,0,774,0],En.transparent,[!0,!0,!0,!0]);let Uw=1029,$w=2305;class Ss{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}Ss.disabled=new Ss(!1,Uw,$w),Ss.backCCW=new Ss(!0,Uw,$w),Ss.backCW=new Ss(!0,Uw,2304),Ss.frontCW=new Ss(!0,1028,2304),Ss.frontCCW=new Ss(!0,1028,$w);let XV=x0.types,KV=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function z0(t,e,i,a,u,d,p,_,y,b,T,D,S){let R=_?Math.min(Tc,Math.round(_[0])):0,k=_?Math.min(Tc,Math.round(_[1])):0;t.emplaceBack(e,i,Math.round(32*a),Math.round(32*u),d,p,(R<<1)+(y?1:0),k,16*b,16*T,256*D,256*S)}function B0(t,e,i){t.emplaceBack(e,i)}function V0(t,e,i,a,u,d,p){t.emplaceBack(e,i,a,u,d,p)}function j0(t,e,i,a,u){t.emplaceBack(e,i,a,u),t.emplaceBack(e,i,a,u),t.emplaceBack(e,i,a,u),t.emplaceBack(e,i,a,u)}function QV(t){for(let e of t.sections)if(Ne(e.text))return!0;return!1}class Gw{constructor(e){this.layoutVertexArray=new O1,this.indexArray=new Ki,this.programConfigurations=e,this.segments=new _i,this.dynamicLayoutVertexArray=new dc,this.opacityVertexArray=new F1,this.occlusionQueryOpacityVertexArray=new Ku,this.placedSymbolArray=new dS,this.iconTransitioningVertexArray=new mc,this.globeExtVertexArray=new L1,this.zOffsetVertexArray=new Ku}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,u,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,JB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,tV.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,KV,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,Mw.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,nV.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,eV.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,GM.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}J(Gw,"SymbolBuffers");class Hw{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new _i,this.collisionVertexArray=new B1,this.collisionVertexArrayExt=new dc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,iV.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,rV.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}J(Hw,"CollisionBuffers");class xf{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.ad.identity([]),this.placementViewportMatrix=r.ad.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Pw(this.zoom,i["text-size"]),this.iconSizeData=Pw(this.zoom,i["icon-size"]);let a=this.layers[0].layout,u=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>Fo[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Gw(new _c(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new Gw(new _c(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new mS,this.lineVertexArray=new gS,this.symbolInstances=new pS}calculateGlyphDependencies(e,i,a,u,d){for(let p=0;p<e.length;p++){let _=e.codePointAt(p);if(_===void 0)break;if(i[_]=!0,u&&d&&_<=65535){let y=og[e.charAt(p)];y&&(i[y.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Dw(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,i,a,u){let d=this.layers[0],p=d.layout,_=this.projection.name==="globe",y=p.get("text-font"),b=p.get("text-field"),T=p.get("icon-image"),D=(b.value.kind!=="constant"||b.value.value instanceof _r&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),S=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!D&&!S)return;let k=i.iconDependencies,F=i.glyphDependencies,z=i.availableImages,j=new $t(this.zoom);for(let{feature:Y,id:X,index:K,sourceLayerIndex:le}of e){let se=d._featureFilter.needGeometry,me=al(Y,se);if(!d._featureFilter.filter(j,me,a))continue;if(se||(me.geometry=Cs(Y,a,u)),_&&Y.type!==1&&a.z<=5){let Se=me.geometry,ze=.98078528056,Ye=(Le,qe)=>{let Oe=Ym(Le.x,Le.y,a,1),We=Ym(qe.x,qe.y,a,1);return r._.dot(Oe,We)<ze};for(let Le=0;Le<Se.length;Le++)Se[Le]=Fz(Se[Le],Ye)}let _e,Ee;if(D){let Se=d.getValueAndResolveTokens("text-field",me,a,z),ze=_r.factory(Se);QV(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||fn()==="unavailable"||this.hasRTLText&&kn.isParsed())&&(_e=TV(ze,d,me))}if(S){let Se=d.getValueAndResolveTokens("icon-image",me,a,z);Ee=Se instanceof Lr?Se:Lr.fromString(Se)}if(!_e&&!Ee)continue;let ke=this.sortFeaturesByKey?R.evaluate(me,{},a):void 0;if(this.features.push({id:X,text:_e,icon:Ee,index:K,sourceLayerIndex:le,geometry:me.geometry,properties:Y.properties,type:XV[Y.type],sortKey:ke}),Ee&&(k[Ee.namePrimary]=!0,Ee.nameSecondary&&(k[Ee.nameSecondary]=!0)),_e){let Se=y.evaluate(me,{},a).join(","),ze=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fo.vertical)>=0;for(let Ye of _e.sections)if(Ye.image)k[Ye.image.namePrimary]=!0;else{let Le=Ie(_e.toString()),qe=Ye.fontStack||Se,Oe=F[qe]=F[qe]||{};this.calculateGlyphDependencies(Ye.text,Oe,ze,this.allowVerticalPlacement,Le)}}}p.get("symbol-placement")==="line"&&(this.features=function(Y){let X={},K={},le=[],se=0;function me(Se){le.push(Y[Se]),se++}function _e(Se,ze,Ye){let Le=K[Se];return delete K[Se],K[ze]=Le,le[Le].geometry[0].pop(),le[Le].geometry[0]=le[Le].geometry[0].concat(Ye[0]),Le}function Ee(Se,ze,Ye){let Le=X[ze];return delete X[ze],X[Se]=Le,le[Le].geometry[0].shift(),le[Le].geometry[0]=Ye[0].concat(le[Le].geometry[0]),Le}function ke(Se,ze,Ye){let Le=Ye?ze[0][ze[0].length-1]:ze[0][0];return`${Se}:${Le.x}:${Le.y}`}for(let Se=0;Se<Y.length;Se++){let ze=Y[Se],Ye=ze.geometry,Le=ze.text?ze.text.toString():null;if(!Le){me(Se);continue}let qe=ke(Le,Ye),Oe=ke(Le,Ye,!0);if(qe in K&&Oe in X&&K[qe]!==X[Oe]){let We=Ee(qe,Oe,Ye),Je=_e(qe,Oe,le[We].geometry);delete X[qe],delete K[Oe],K[ke(Le,le[Je].geometry,!0)]=Je,le[We].geometry=null}else qe in K?_e(qe,Oe,Ye):Oe in X?Ee(qe,Oe,Ye):(me(Se),X[qe]=se-1,K[Oe]=se-1)}return le.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,X)=>Y.sortKey-X.sortKey)}update(e,i,a,u,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,_,a,u,d),this.icon.programConfigurations.updatePaintArrays(e,i,_,a,u,d)}updateOcclusionOpacities(e,i,a){if(!i.useOcclusionQueries)return!1;let u=this;if(u.projection.name==="globe")return!1;let d=!1;u.hasTextData()&&(d=d||u.text.occlusionQueryOpacityVertexArray.length!==0),u.hasIconData()&&(d=d||u.icon.occlusionQueryOpacityVertexArray.length!==0);let p=u.layers[0].paint,_=p.get("icon-occlusion-opacity").constantOr(0)!==1,y=p.get("text-occlusion-opacity").constantOr(0)!==1;if(!_&&!y)return!1;let b=!d;for(let R=0;R<u.symbolInstances.length;R++){let k=u.symbolInstances.get(R),F=k.occlusionOpacity;k.occlusionOpacity+=(k.occlusionState>.5?1:-1)*i.fadeSpeed*a*.001,k.occlusionOpacity=tn(k.occlusionOpacity,0,1),b=b||k.occlusionOpacity!==F}if(!b)return!1;let T=0,D=0,S=(R,k,F,z)=>{let j=0,Y=0;F?(j=D,D+=z,Y=D):(j=T,T+=z,Y=T),Y>k.occlusionQueryOpacityVertexArray.length&&k.occlusionQueryOpacityVertexArray.resize(Y);let X=R.occlusionOpacity;for(let K=0;K<z;K++)k.occlusionQueryOpacityVertexArray.emplace(K+j,X)};for(let R=0;R<u.symbolInstances.length;R++){let k=u.symbolInstances.get(R),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:z,numIconVertices:j}=k,Y=j>0;if((F>0||z>0)&&(S(k,u.text,!1,F),S(k,u.text,!1,z)),Y){let{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:K}=k;X>=0&&S(k,u.icon,!0,j),K>=0&&S(k,u.icon,!0,k.numVerticalIconVertices)}}return u.hasTextData()&&u.text.occlusionQueryOpacityVertexBuffer&&(u.text.occlusionQueryOpacityVertexBuffer.length<u.text.occlusionQueryOpacityVertexArray.length?u.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.text.occlusionQueryOpacityVertexArray,Mw.members,!0):u.text.occlusionQueryOpacityVertexBuffer.updateData(u.text.occlusionQueryOpacityVertexArray)),u.hasIconData()&&u.icon.occlusionQueryOpacityVertexBuffer&&(u.icon.occlusionQueryOpacityVertexBuffer.length<u.icon.occlusionQueryOpacityVertexArray.length?u.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.icon.occlusionQueryOpacityVertexArray,Mw.members,!0):u.icon.occlusionQueryOpacityVertexBuffer.updateData(u.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(d,p,_)=>{a+=p,a>d.length&&d.resize(a);for(let y=-p;y<0;y++)d.emplace(y+a,_)},i=(d,p,_)=>{u+=p,u>d.length&&d.resize(u);for(let y=-p;y<0;y++)d.emplace(y+u,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:y,numIconVertices:b}=p,T=p.zOffset,D=b>0;if((_>0||y>0)&&(e(this.text.zOffsetVertexArray,_,T),e(this.text.zOffsetVertexArray,y,T)),D){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:R}=p;S>=0&&i(this.icon.zOffsetVertexArray,b,T),R>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=FA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,i){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:u,y:d}of i)this.lineVertexArray.emplaceBack(u,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,u,d,p,_,y,b,T,D,S,R,k,F,z){let j=e.indexArray,Y=e.layoutVertexArray,X=e.globeExtVertexArray,K=e.segments.prepareSegment(4*i.length,Y,j,this.canOverlap?p.sortKey:void 0),le=this.glyphOffsetArray.length,se=K.vertexLength,me=this.allowVerticalPlacement&&_===Fo.vertical?Math.PI/2:0,_e=p.text&&p.text.sections;for(let ke=0;ke<i.length;ke++){let{tl:Se,tr:ze,bl:Ye,br:Le,texPrimary:qe,texSecondary:Oe,pixelOffsetTL:We,pixelOffsetBR:Je,minFontScaleX:Ze,minFontScaleY:ht,glyphOffset:Xe,isSDF:nt,sectionIndex:Tt}=i[ke],vt=K.vertexLength,_t=Xe[1];if(z0(Y,b.x,b.y,Se.x,_t+Se.y,qe.x,qe.y,a,nt,We.x,We.y,Ze,ht),z0(Y,b.x,b.y,ze.x,_t+ze.y,qe.x+qe.w,qe.y,a,nt,Je.x,We.y,Ze,ht),z0(Y,b.x,b.y,Ye.x,_t+Ye.y,qe.x,qe.y+qe.h,a,nt,We.x,Je.y,Ze,ht),z0(Y,b.x,b.y,Le.x,_t+Le.y,qe.x+qe.w,qe.y+qe.h,a,nt,Je.x,Je.y,Ze,ht),y){let{x:et,y:Ct,z:Yt}=y.anchor,[Pt,Qt,Xt]=y.up;V0(X,et,Ct,Yt,Pt,Qt,Xt),V0(X,et,Ct,Yt,Pt,Qt,Xt),V0(X,et,Ct,Yt,Pt,Qt,Xt),V0(X,et,Ct,Yt,Pt,Qt,Xt),j0(e.dynamicLayoutVertexArray,et,Ct,Yt,me)}else j0(e.dynamicLayoutVertexArray,b.x,b.y,b.z,me);if(z){let et=Oe||qe;B0(e.iconTransitioningVertexArray,et.x,et.y),B0(e.iconTransitioningVertexArray,et.x+et.w,et.y),B0(e.iconTransitioningVertexArray,et.x,et.y+et.h),B0(e.iconTransitioningVertexArray,et.x+et.w,et.y+et.h)}j.emplaceBack(vt,vt+1,vt+2),j.emplaceBack(vt+1,vt+2,vt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),ke!==i.length-1&&Tt===i[ke+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,p,p.index,{},R,k,F,_e&&_e[Tt])}let Ee=y?y.anchor:b;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,b.x,b.y,le,this.glyphOffsetArray.length-le,se,T,D,b.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],_,0,!1,0,S,0)}_commitLayoutVertex(e,i,a,u,d,p,_){e.emplaceBack(i,a,u,d,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,a,u,d,p,_){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=y.vertexLength,T=_.tileAnchorX,D=_.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,D,new lt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,D,new lt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,D,new lt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,T,D,new lt(e.x1,e.y2)),y.vertexLength+=4;let S=a.indexArray;S.emplaceBack(b,b+1),S.emplaceBack(b+1,b+2),S.emplaceBack(b+2,b+3),S.emplaceBack(b+3,b),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,p,i,_);this._addCollisionDebugVertices(y,b,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,b,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hw(n0,HM.members,mc),this.iconCollisionBox=new Hw(n0,HM.members,mc);let a=pf(this.iconSizeData,e),u=pf(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,a,u){let d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),p=A0(this.textSizeData,e,d)/xr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,a){let u=this.icon.placedSymbolArray.get(a),d=A0(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,a,u){e.emplaceBack(i,-a,-a,u),e.emplaceBack(i,a,-a,u),e.emplaceBack(i,a,a,u),e.emplaceBack(i,-a,a,u)}_updateTextDebugCollisionBoxes(e,i,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,p,i,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=pf(this.iconSizeData,e),u=pf(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(u,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,u,d,p,_,y,b){let T={};if(i<a){let{x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(i);T.textBox={x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.textFeatureIndex=le}if(u<d){let{x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(u);T.verticalTextBox={x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.verticalTextFeatureIndex=le}if(p<_){let{x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(p);T.iconBox={x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.iconFeatureIndex=le}if(y<b){let{x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(y);T.verticalIconBox={x1:D,y1:S,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.verticalIconFeatureIndex=le}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){let a=e.placedSymbolArray.get(i),u=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(e),a=Math.cos(e),u=[],d=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);let y=this.symbolInstances.get(_);u.push(0|Math.round(i*y.tileAnchorX+a*y.tileAnchorY)),d.push(y.featureIndex)}return p.sort((_,y)=>u[_]-u[y]||d[y]-d[_]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:b}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&d!==u&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}J(xf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),xf.addDynamicAttributes=j0;class rs{constructor(e,i,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,a){let{width:u,height:d}=e,{context:p}=this,{gl:_}=p;if(_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!i||i.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===d){let{x:y,y:b}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,y,b,_.RGBA,_.UNSIGNED_BYTE,e);else{let T=this.format,D=_.UNSIGNED_BYTE;this.format===_.R32F&&(T=_.RED,D=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,y,b,u,d,T,D,e.data)}}else if(this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===_.R8&&(y=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,y,_.UNSIGNED_BYTE,e)}else{let y=this.format,b=this.format,T=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,T=_.UNSIGNED_SHORT),this.format===_.R8&&(b=_.RED),this.format===_.R32F&&(T=_.FLOAT,b=_.RED),_.texImage2D(_.TEXTURE_2D,0,y,u,d,0,b,T,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,a=!1){let{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,u){let{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class U0{constructor(e,i){this.context=e,this.texture=i}bind(e,i){let{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}let os=32,pa=33,Ic=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,a=0,u=0,d=0,p=0,_=0;for(1&e?u=d=p=os:i=a=_=os;(e>>=1)>1;){let b=i+u>>1,T=a+d>>1;1&e?(u=i,d=a,i=p,a=_):(i=u,a=d,u=p,d=_),p=b,_=T}let y=4*t;Ic[y+0]=i,Ic[y+1]=a,Ic[y+2]=u,Ic[y+3]=d}let ma=new Uint16Array(2178),Dc=new Uint8Array(1089),$0=new Uint16Array(1089);function NA(t){return t===0?-.03125:t===32?.03125:0}var G0=An([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),JV=An([{name:"a_index",type:"Int16",components:1}]);let zA={type:2,extent:rt,loadGeometry:()=>[[new lt(0,0),new lt(rt+1,0),new lt(rt+1,rt+1),new lt(0,rt+1),new lt(0,0)]]};class H0{constructor(e,i,a,u,d){this.tileID=e,this.uid=gd(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){let i=e+this.timeAdded;i<ir.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=oh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){let p={};if(!d)return p;for(let _ of u){let y=_.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(let b of y)p[b.fqid]=_}}return p}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(let u in this.buckets){let d=this.buckets[u];if(d instanceof xf){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let u in this.buckets){let d=this.buckets[u];if(d instanceof xf&&d.hasRTLText){this.hasRTLText=!0,kn.isLoading()||kn.isLoaded()||fn()!=="deferred"||cn();break}}this.queryPadding=0;for(let u in this.buckets){let d=this.buckets[u],p=i.style.getOwnLayer(u);if(!p)continue;let _=p.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new W1}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let u in this.buckets){let d=this.buckets[u];d.uploadPending()&&d.upload(e)}let i=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let u=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new rs(e,a.image,i.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new rs(e,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new rs(e,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(e,i,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let u=i.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,i)))}queryRenderedFeatures(e,i,a,u,d,p,_,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:_,transform:p,params:d,tileTransform:this.tileTransform},e,i,a):{}}querySourceFeatures(e,i){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let u=a.loadVTLayers(),d=i?i.sourceLayer:"",p=u._geojsonTileLayer||u[d];if(!p)return;let _=Sr(i&&i.filter),{z:y,x:b,y:T}=this.tileID.canonical,D={z:y,x:b,y:T};for(let S=0;S<p.length;S++){let R=p.feature(S);if(_.needGeometry){let z=al(R,!0);if(!_.filter(new $t(this.tileID.overscaledZ),z,this.tileID.canonical))continue}else if(!_.filter(new $t(this.tileID.overscaledZ),R))continue;let k=a.getId(R,d),F=new oA(R,y,b,T,k);F.tile=D,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let i=this.expirationTime;if(e.cacheControl){let a=Yp(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),u=!1;if(this.expirationTime>a)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{let d=this.expirationTime-i;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&i&&this.updateBuckets(e,i)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages(),d=i.style.getBrightness();for(let p in this.buckets){if(!i.style.hasLayer(p))continue;let _=this.buckets[p],y=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],T={};if(e&&(T=e[y],!b||!T||Object.keys(T).length===0))continue;if(_.update(T,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),_ instanceof I0||_ instanceof y0){let S=i.style.getOwnSourceCache(_.layers[0].source);i._terrain&&i._terrain.enabled&&S&&_.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(S.id,this.tileID)}let D=i&&i.style&&i.style.getOwnLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ir.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ir.now()+e}setTexture(e,i){let a=i.context,u=a.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof rs?this.texture.update(e,{useMipmap:!0}):(this.texture=new rs(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,i){let a={};for(let u of i)a[u]=!0;this.dependencies[e]=a}hasDependency(e,i){for(let a of e){let u=this.dependencies[a];if(u){for(let d of i)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;let a=Cs(zA,this.tileID.canonical,this.tileTransform)[0],u=new Es,d=new Um;for(let p=0;p<a.length;p++){let{x:_,y}=a[p];u.emplaceBack(_,y),d.emplaceBack(p)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,Zm.members),this._tileDebugSegments=_i.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;let a=Cs(zA,this.tileID.canonical,this.tileTransform)[0],u,d;if(this.isRaster){let p=function(_,y){let b=oh(_,y),T=Math.pow(2,_.z);for(let z=0;z<pa;z++)for(let j=0;j<pa;j++){let Y=no((_.x+(j+NA(j))/os)/T),X=or((_.y+(z+NA(z))/os)/T),K=y.project(Y,X),le=z*pa+j;ma[2*le+0]=Math.round((K.x*b.scale-b.x)*rt),ma[2*le+1]=Math.round((K.y*b.scale-b.y)*rt)}Dc.fill(0),$0.fill(0);for(let z=2045;z>=0;z--){let j=4*z,Y=Ic[j+0],X=Ic[j+1],K=Ic[j+2],le=Ic[j+3],se=Y+K>>1,me=X+le>>1,_e=se+me-X,Ee=me+Y-se,ke=X*pa+Y,Se=le*pa+K,ze=me*pa+se,Ye=Math.hypot((ma[2*ke+0]+ma[2*Se+0])/2-ma[2*ze+0],(ma[2*ke+1]+ma[2*Se+1])/2-ma[2*ze+1])>=16;Dc[ze]=Dc[ze]||(Ye?1:0),z<1022&&(Dc[ze]=Dc[ze]||Dc[(X+Ee>>1)*pa+(Y+_e>>1)]||Dc[(le+Ee>>1)*pa+(K+_e>>1)])}let D=new hc,S=new Ki,R=0;function k(z,j){let Y=j*pa+z;return $0[Y]===0&&(D.emplaceBack(ma[2*Y+0],ma[2*Y+1],z*rt/os,j*rt/os),$0[Y]=++R),$0[Y]-1}function F(z,j,Y,X,K,le){let se=z+Y>>1,me=j+X>>1;if(Math.abs(z-K)+Math.abs(j-le)>1&&Dc[me*pa+se])F(K,le,z,j,se,me),F(Y,X,K,le,se,me);else{let _e=k(z,j),Ee=k(Y,X),ke=k(K,le);S.emplaceBack(_e,Ee,ke)}}return F(0,0,os,os,os,0),F(os,os,0,0,0,os),{vertices:D,indices:S}}(this.tileID.canonical,i);u=p.vertices,d=p.indices}else{u=new hc,d=new Ki;for(let{x:_,y}of a)u.emplaceBack(_,y,0,0);let p=Qm(u.int16,void 0,4);for(let _=0;_<p.length;_+=3)d.emplaceBack(p[_],p[_+1],p[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,G0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=_i.simpleSegment(0,0,u.length,d.length)}_makeGlobeTileDebugBuffers(e,i){let a=i.projection;if(!a||a.name!=="globe"||i.freezeTileCoverage)return;let u=this.tileID.canonical,d=Xm($S(u,i)),p=cl(i.zoom),_;p>0&&(_=r.ad.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,i,d,_,p),this._makeGlobeTileDebugTextBuffer(e,u,i,d,_,p)}_globePoint(e,i,a,u,d,p,_){let y=Ym(e,i,a);if(p){let b=1<<a.z,T=ua(u.center.lng),D=ha(u.center.lat),S=(a.x+.5)/b-T,R=0;S>.5?R=-1:S<-.5&&(R=1);let k=(e/rt+a.x)/b+R,F=(i/rt+a.y)/b;k=(k-T)*u._pixelsPerMercatorPixel+T,F=(F-D)*u._pixelsPerMercatorPixel+D;let z=[k*u.worldSize,F*u.worldSize,0];r._.transformMat4(z,z,p),y=ll(y,z,_)}return r._.transformMat4(y,y,d)}_makeGlobeTileDebugBorderBuffer(e,i,a,u,d,p){let _=new Es,y=new Um,b=new Jy,T=(S,R,k,F,z)=>{let j=(k-S)/(z-1),Y=(F-R)/(z-1),X=_.length;for(let K=0;K<z;K++){let le=S+K*j,se=R+K*Y;_.emplaceBack(le,se);let me=this._globePoint(le,se,i,a,u,d,p);b.emplaceBack(me[0],me[1],me[2]),y.emplaceBack(X+K)}},D=rt;T(0,0,D,0,16),T(D,0,D,D,16),T(D,D,0,D,16),T(0,D,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(_,Zm.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,jS.members),this._tileDebugSegments=_i.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugTextBuffer(e,i,a,u,d,p){let _=rt/4,y=new Es,b=new Ki,T=new Jy,D=25;b.reserve(32),y.reserve(D),T.reserve(D);let S=(R,k)=>D*R+k;for(let R=0;R<D;R++){let k=R*_;for(let F=0;F<D;F++){let z=F*_;y.emplaceBack(z,k);let j=this._globePoint(z,k,i,a,u,d,p);T.emplaceBack(j[0],j[1],j[2])}}for(let R=0;R<4;R++)for(let k=0;k<4;k++){let F=S(R,k),z=S(R,k+1),j=S(R+1,k),Y=S(R+1,k+1);b.emplaceBack(F,z,j),b.emplaceBack(j,z,Y)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(y,Zm.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,jS.members),this._tileDebugTextSegments=_i.simpleSegment(0,0,D,32)}destroy(e=!1){for(let i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof rs&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let qt={read:function(t,e){return t.readFields(qt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(qt.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};qt.Filter.read=function(t,e){return t.readFields(qt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},qt.Filter._readField=function(t,e,i){t===1?(e.delta_filter=qt.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=qt.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=qt.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=qt.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},qt.Filter.Delta={},qt.Filter.Delta.read=function(t,e){return t.readFields(qt.Filter.Delta._readField,{block_size:0},e)},qt.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},qt.Filter.Zigzag={},qt.Filter.Zigzag.read=function(t,e){return t.readFields(qt.Filter.Zigzag._readField,{},e)},qt.Filter.Zigzag._readField=function(t,e,i){},qt.Filter.BitShuffle={},qt.Filter.BitShuffle.read=function(t,e){return t.readFields(qt.Filter.BitShuffle._readField,{},e)},qt.Filter.BitShuffle._readField=function(t,e,i){},qt.Filter.ByteShuffle={},qt.Filter.ByteShuffle.read=function(t,e){return t.readFields(qt.Filter.ByteShuffle._readField,{},e)},qt.Filter.ByteShuffle._readField=function(t,e,i){},qt.Codec={},qt.Codec.read=function(t,e){return t.readFields(qt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},qt.Codec._readField=function(t,e,i){t===1?(e.gzip_data=qt.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=qt.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=qt.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=qt.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},qt.Codec.GzipData={},qt.Codec.GzipData.read=function(t,e){return t.readFields(qt.Codec.GzipData._readField,{},e)},qt.Codec.GzipData._readField=function(t,e,i){},qt.Codec.JpegImage={},qt.Codec.JpegImage.read=function(t,e){return t.readFields(qt.Codec.JpegImage._readField,{},e)},qt.Codec.JpegImage._readField=function(t,e,i){},qt.Codec.WebpImage={},qt.Codec.WebpImage.read=function(t,e){return t.readFields(qt.Codec.WebpImage._readField,{},e)},qt.Codec.WebpImage._readField=function(t,e,i){},qt.Codec.PngImage={},qt.Codec.PngImage.read=function(t,e){return t.readFields(qt.Codec.PngImage._readField,{},e)},qt.Codec.PngImage._readField=function(t,e,i){},qt.DataIndexEntry={},qt.DataIndexEntry.read=function(t,e){return t.readFields(qt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},qt.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(qt.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=qt.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},qt.Layer={},qt.Layer.read=function(t,e){return t.readFields(qt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},qt.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(qt.DataIndexEntry.read(i,i.readVarint()+i.pos))};let Ms={read:function(t,e){return t.readFields(Ms._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=Ms.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Ms.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};Ms.Uint32Values.read=function(t,e){return t.readFields(Ms.Uint32Values._readField,{values:[]},e)},Ms.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let u=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(a),d=a.pos;return a.pos=u,function(p){a.pos=d;let _=0;for(;a.pos<u;){let y=a.readVarint();p[_++]=y}return p}}(i))},Ms.Fixed32Values={},Ms.Fixed32Values.read=function(t,e){return t.readFields(Ms.Fixed32Values._readField,{values:[]},e)},Ms.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};class e5{constructor(e=0,i=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){let i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(i=a.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){let e=[],i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,a=!1,u=this.resetTtl){let d;if(a||this.has(e)){if(d=this.items[e],d.value=i,a===!1&&u&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){let p=this.last,_=d.next,y=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,p.next=d,y!==null&&(y.next=_),_!==null&&(_.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=d:this.last.next=d;return this.last=d,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function t5(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){let u=a===1?1:0,d=a===2?1:0;for(let p=0;p<e[0];p++){let _=e[1]*p;for(let y=u;y<e[1];y++){let b=e[2]*(y+_);for(let T=d;T<e[2];T++){let D=e[3]*(T+b);for(let S=0;S<e[3];S++){let R=D+S;t[R]+=t[R-i]}}}}i*=e[a]}return t}function n5(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function i5(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){let a=t[i],u=t[i+1];t[i]=(240&a)>>4|(61440&a)>>8|(240&u)<<4|61440&u,t[i+1]=15&a|(3840&a)>>4|(15&u)<<8|(3840&u)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){let a=t[i],u=t[i+1],d=t[i+2],p=t[i+3];t[i+0]=(192&a)>>6|(192&u)>>4|(192&d)>>2|192&p,t[i+1]=(48&a)>>4|(48&u)>>2|48&d|(48&p)<<2,t[i+2]=(12&a)>>2|12&u|(12&d)<<2|(12&p)<<4,t[i+3]=3&a|(3&u)<<2|(3&d)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Sc extends Error{constructor(e){super(e),this.name="MRTError"}}var No=Uint8Array,bf=Uint16Array,r5=Int32Array,BA=new No([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),VA=new No([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o5=new No([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jA=function(t,e){for(var i=new bf(31),a=0;a<31;++a)i[a]=e+=1<<t[a-1];var u=new r5(i[30]);for(a=1;a<30;++a)for(var d=i[a];d<i[a+1];++d)u[d]=d-i[a]<<5|a;return{b:i,r:u}},UA=jA(BA,2),$A=UA.b,s5=UA.r;$A[28]=258,s5[258]=28;for(var a5=jA(VA,0).b,qw=new bf(32768),Ni=0;Ni<32768;++Ni){var wf=(43690&Ni)>>1|(21845&Ni)<<1;qw[Ni]=((65280&(wf=(61680&(wf=(52428&wf)>>2|(13107&wf)<<2))>>4|(3855&wf)<<4))>>8|(255&wf)<<8)>>1}var pg=function(t,e,i){for(var a=t.length,u=0,d=new bf(e);u<a;++u)t[u]&&++d[t[u]-1];var p,_=new bf(e);for(u=1;u<e;++u)_[u]=_[u-1]+d[u-1]<<1;if(i){p=new bf(1<<e);var y=15-e;for(u=0;u<a;++u)if(t[u])for(var b=u<<4|t[u],T=e-t[u],D=_[t[u]-1]++<<T,S=D|(1<<T)-1;D<=S;++D)p[qw[D]>>y]=b}else for(p=new bf(a),u=0;u<a;++u)t[u]&&(p[u]=qw[_[t[u]-1]++]>>15-t[u]);return p},mg=new No(288);for(Ni=0;Ni<144;++Ni)mg[Ni]=8;for(Ni=144;Ni<256;++Ni)mg[Ni]=9;for(Ni=256;Ni<280;++Ni)mg[Ni]=7;for(Ni=280;Ni<288;++Ni)mg[Ni]=8;var GA=new No(32);for(Ni=0;Ni<32;++Ni)GA[Ni]=5;var l5=pg(mg,9,1),c5=pg(GA,5,1),Ww=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},As=function(t,e,i){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&i},Zw=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},u5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ps=function(t,e,i){var a=new Error(e||u5[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,Ps),!i)throw a;return a},h5=new No(0),d5=typeof TextDecoder<"u"&&new TextDecoder;try{d5.decode(h5,{stream:!0})}catch{}let f5={gzip_data:"gzip"},p5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},m5={uint32:1,uint16:2,uint8:4},g5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class Yw{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new Sc("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new Sc(`Expected header with length >= ${a} but got buffer of length ${i.length}`);let u=new ff(i.subarray(0,a)),d=qt.read(u);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Sc(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let p of d.layers)this.layers[p.name]=new _5(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let i=[],a=this.getLayer(e.layerName);for(let u=0;u<a.dataIndex.length;u++){let d=a.dataIndex[u],p=d.first_byte-e.firstByte,_=d.last_byte+1-e.firstByte;if(u<e.firstBlock||u>e.lastBlock||a._blocksInProgress.has(u))continue;let y={layerName:a.name,firstByte:p,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:u,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(b=>b.filter)};a._blocksInProgress.add(u),i.push(y)}return new HA(i,()=>{i.forEach(u=>a._blocksInProgress.delete(u.blockIndex))},(u,d)=>{if(i.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),u)throw u;d.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class _5{constructor({version:e,name:i,units:a,tilesize:u,pixel_format:d,buffer:p,data_index:_},y){if(this.version=e,this.version!==1)throw new Sc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=u,this.buffer=p,this.pixelFormat=p5[d],this.dataIndex=_,this.bandShape=[u+2*p,u+2*p,m5[this.pixelFormat]],this._decodedBlocks=function(b=1e3,T=0,D=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof D!="boolean")throw new TypeError("Invalid resetTtl value");return new e5(b,T,D)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(let[a,u]of this.dataIndex.entries()){for(let[d,p]of u.bands.entries())if(p===e)return{bandIndex:i+d,blockIndex:a,blockBandIndex:d};i+=u.bands.length}break;case"number":for(let[a,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new Sc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Sc(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,a=-1/0,u=1/0,d=-1/0;for(let p of e){let{blockIndex:_}=this.getBlockForBand(p);if(_<0)throw new Sc(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[_];u=Math.min(u,_),d=Math.max(d,_),i=Math.min(i,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:i,lastByte:a,firstBlock:u,lastBlock:d}}hasBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){let{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e),u=this._decodedBlocks.get(i.toString());if(!u)throw new Sc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let d=this.dataIndex[i],p=this.bandShape.reduce((b,T)=>b*T,1),_=a*p,y=u.subarray(_,_+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class HA{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Yw.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{let{layerName:a,firstByte:u,lastByte:d,pixelFormat:p,blockShape:_,blockIndex:y,filters:b,codec:T}=i,D=new Uint8Array(t).subarray(u,d+1),S=new Uint32Array(_[0]*_[1]*_[2]),R;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return R=function(k,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((X=function(se){se[0]==31&&se[1]==139&&se[2]==8||Ps(6,"invalid gzip data");var me=se[3],_e=10;4&me&&(_e+=2+(se[10]|se[11]<<8));for(var Ee=(me>>3&1)+(me>>4&1);Ee>0;Ee-=!se[_e++]);return _e+(2&me)}(Y=k))+8>Y.length&&Ps(6,"invalid gzip data"),function(se,me,_e,Ee){var ke=se.length;if(!ke||me.f&&!me.l)return _e||new No(0);var Se=!_e,ze=Se||me.i!=2,Ye=me.i;Se&&(_e=new No(3*ke));var Le,qe,Oe=function(Ac){var Pc=_e.length;if(Ac>Pc){var uh=new No(Math.max(2*Pc,Ac));uh.set(_e),_e=uh}},We=me.f||0,Je=me.p||0,Ze=me.b||0,ht=me.l,Xe=me.d,nt=me.m,Tt=me.n,vt=8*ke;do{if(!ht){We=As(se,Je,1);var _t=As(se,Je+1,3);if(Je+=3,!_t){var et=se[(mn=4+((Je+7)/8|0))-4]|se[mn-3]<<8,Ct=mn+et;if(Ct>ke){Ye&&Ps(0);break}ze&&Oe(Ze+et),_e.set(se.subarray(mn,Ct),Ze),me.b=Ze+=et,me.p=Je=8*Ct,me.f=We;continue}if(_t==1)ht=l5,Xe=c5,nt=9,Tt=5;else if(_t==2){var Yt=As(se,Je,31)+257,Pt=As(se,Je+10,15)+4,Qt=Yt+As(se,Je+5,31)+1;Je+=14;for(var Xt=new No(Qt),sn=new No(19),St=0;St<Pt;++St)sn[o5[St]]=As(se,Je+3*St,7);Je+=3*Pt;var Gn=Ww(sn),Un=(1<<Gn)-1,In=pg(sn,Gn,1);for(St=0;St<Qt;){var mn,Dn=In[As(se,Je,Un)];if(Je+=15&Dn,(mn=Dn>>4)<16)Xt[St++]=mn;else{var ti=0,Xn=0;for(mn==16?(Xn=3+As(se,Je,3),Je+=2,ti=Xt[St-1]):mn==17?(Xn=3+As(se,Je,7),Je+=3):mn==18&&(Xn=11+As(se,Je,127),Je+=7);Xn--;)Xt[St++]=ti}}var Ti=Xt.subarray(0,Yt),vi=Xt.subarray(Yt);nt=Ww(Ti),Tt=Ww(vi),ht=pg(Ti,nt,1),Xe=pg(vi,Tt,1)}else Ps(1);if(Je>vt){Ye&&Ps(0);break}}ze&&Oe(Ze+131072);for(var Ar=(1<<nt)-1,Si=(1<<Tt)-1,ui=Je;;ui=Je){var ji=(ti=ht[Zw(se,Je)&Ar])>>4;if((Je+=15&ti)>vt){Ye&&Ps(0);break}if(ti||Ps(2),ji<256)_e[Ze++]=ji;else{if(ji==256){ui=Je,ht=null;break}var sr=ji-254;ji>264&&(sr=As(se,Je,(1<<(Xr=BA[St=ji-257]))-1)+$A[St],Je+=Xr);var ar=Xe[Zw(se,Je)&Si],Jn=ar>>4;if(ar||Ps(3),Je+=15&ar,vi=a5[Jn],Jn>3){var Xr=VA[Jn];vi+=Zw(se,Je)&(1<<Xr)-1,Je+=Xr}if(Je>vt){Ye&&Ps(0);break}ze&&Oe(Ze+131072);var dl=Ze+sr;if(Ze<vi){var ss=0-vi,ks=Math.min(vi,dl);for(ss+Ze<0&&Ps(3);Ze<ks;++Ze)_e[Ze]=(void 0)[ss+Ze]}for(;Ze<dl;++Ze)_e[Ze]=_e[Ze-vi]}}me.l=ht,me.p=ui,me.b=Ze,me.f=We,ht&&(We=1,me.m=nt,me.d=Xe,me.n=Tt)}while(!We);return Ze!=_e.length&&Se?(Le=_e,((qe=Ze)==null||qe>Le.length)&&(qe=Le.length),new No(Le.subarray(0,qe))):_e.subarray(0,Ze)}(Y.subarray(X,-8),{i:2},new No(((z=Y)[(j=z.length)-4]|z[j-3]<<8|z[j-2]<<16|z[j-1]<<24)>>>0))));var z,j,Y,X;let K=f5[F];if(!K)throw new Error(`Unhandled codec: ${F}`);let le=new globalThis.DecompressionStream(K);return new Response(new Blob([k]).stream().pipeThrough(le)).arrayBuffer().then(se=>new Uint8Array(se))}(D,T).then(k=>{let F=Ms.read(new ff(k));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(S),new g5[p](S.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),R.then(k=>{for(let F=b.length-1;F>=0;F--)switch(b[F]){case"delta_filter":t5(k,_);break;case"zigzag_filter":n5(k);break;case"bitshuffle_filter":i5(k,p);break;default:throw new Error(`Unhandled filter "${b[F]}"`)}return{layerName:a,blockIndex:y,data:k}}).catch(k=>{throw k})}))};class qA extends H0{constructor(e,i,a,u,d){super(e,i,a,u,d),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,i){let a=i.context,u=a.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof rs?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new rs(a,e,u.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,i){let a=this._mrt=new Yw(30),u=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Ha(u,(d,p,_,y)=>{if(d)i(d);else try{let b=a.getHeaderLength(p);if(b>e)return void(this.request=this.fetchHeader(b,i));a.parseHeader(p),this._isHeaderLoaded=!0;let T=0;for(let D of Object.values(a.layers))T=Math.max(T,D.dataIndex[D.dataIndex.length-1].last_byte);p.byteLength>=T&&(this.entireBuffer=p),i(null,this.entireBuffer||p,_,y)}catch(b){i(b)}}),this.request}fetchBand(e,i,a){let u=this._mrt;if(!this._isHeaderLoaded||!u)return void a(new Error("Tile header is not ready"));let d=this.actor;if(!d)return void a(new Error("Can't fetch tile band without an actor"));let p,_=(D,S)=>{p.complete(D,S),D?a(D):(this.updateTextureDescriptor(e,i),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(D,S)=>{if(D)return a(D);let R=d.send("decodeRasterArray",{buffer:S,task:p},_,void 0,!0);this._workQueue.push(()=>{R&&R.cancel(),p.cancel()})},b=u.getLayer(e);if(!b)return void a(new Error(`Unknown sourceLayer "${e}"`));if(b.hasDataForBand(i))return this.updateTextureDescriptor(e,i),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let T=b.getDataRange([i]);if(p=u.createDecodingTask(T),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(T.firstByte,T.lastByte+1));else{let D=Object.assign({},this.requestParams,{headers:{Range:`bytes=${T.firstByte}-${T.lastByte}`}}),S=Ha(D,y);this._fetchQueue.push(()=>{S.cancel(),p.cancel()})}else a(null)}updateNeeded(e,i){return(!this.textureDescriptor||this.textureDescriptor.band!==i||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,i){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(i)||!a.hasDataForBand(i))return;let{bytes:u,tileSize:d,buffer:p,offset:_,scale:y}=a.getBandView(i),b=d+2*p,T={data:u,width:b,height:b},D=this.texture;D&&D instanceof rs&&D.update(T,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:i,img:T,buffer:p,offset:_,tileSize:d,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class y5{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(let e in this.data)for(let i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){let u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);let d={value:i,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){let i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;let a=e.wrapped().key,u=i===void 0?0:this.data[a].indexOf(i),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){let i=[];for(let a in this.data)for(let u of this.data[a])e(u.value)||i.push(u);for(let a of i)this.remove(a.value.tileID,a)}}class sh extends Wa{constructor(e,i,a){super(),this.id=e,this._onlySymbols=a,i.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new y5(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new bV,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let i=this._tiles[e];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let i in this._tiles){let a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return fo(this._tiles).map(e=>e.tileID).sort(WA).map(e=>e.key)}getRenderableIds(e,i){let a=[];for(let u in this._tiles)this._isIdRenderable(+u,e,i)&&a.push(this._tiles[u]);return e?a.sort((u,d)=>{let p=u.tileID,_=d.tileID,y=new lt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new lt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||b.y-y.y||b.x-y.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(WA).map(u=>u.key)}hasRenderableParent(e){let i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,e,i)))}_tileLoaded(e,i,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Rd(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new kr("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=ir.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new kr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let i=this.getRenderableIds();for(let u=0;u<i.length;u++){let d=i[u];if(e.neighboringTiles&&e.neighboringTiles[d]){let p=this.getTileByID(d);a(e,p),a(p,e)}}function a(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let p=d.tileID.canonical.x-u.tileID.canonical.x,_=d.tileID.canonical.y-u.tileID.canonical.y,y=Math.pow(2,u.tileID.canonical.z),b=d.tileID.key;p===0&&_===0||Math.abs(_)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,p,_),u.neighboringTiles&&u.neighboringTiles[b]&&(u.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,u){for(let d in this._tiles){let p=this._tiles[d];if(u[d]||!p.hasData()||p.tileID.overscaledZ<=i||p.tileID.overscaledZ>a)continue;let _=p.tileID;for(;p&&p.tileID.overscaledZ>i+1;){let b=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[b.key],p&&p.hasData()&&(_=b)}let y=_;for(;y.overscaledZ>i;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){u[_.key]=_;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){let u=e.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){let i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;let a=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,d=Math.floor(a*u*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(_)}handleWrapJump(e){let i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){let a={};for(let u in this._tiles){let d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),a[d.tileID.key]=d}this._tiles=a;for(let u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(let u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,a,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Gi(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,d=y.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(d.push(new Gi(1,0,1,0,0)),d.push(new Gi(1,0,1,1,0)),d.push(new Gi(1,0,1,0,1)),d.push(new Gi(1,0,1,1,1)))}else if(d=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);d=d.filter(b=>y(b))}}else d=[];if(d.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Xw(this._source.type)){let y=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),b=Math.min(y,this._source.maxzoom),T=e.extendTileCoverForShadows(d,u,b);for(let D of T)this._shadowCasterTiles[D.key]=!0,d.push(D)}let p=this._updateRetainedTiles(d);if(Xw(this._source.type)&&d.length!==0){let y={},b={},T=Object.keys(p);for(let S of T){let R=p[S],k=this._tiles[S];if(!k||k.fadeEndTime&&k.fadeEndTime<=ir.now())continue;let F=this.findLoadedParent(R,Math.max(R.overscaledZ-sh.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),b[S]=R}let D=d[d.length-1].overscaledZ;for(let S in this._tiles){let R=this._tiles[S];if(p[S]||!R.hasData())continue;let k=R.tileID;for(;k.overscaledZ>D;){k=k.scaledTo(k.overscaledZ-1);let F=this._tiles[k.key];if(F&&F.hasData()&&b[k.key]){p[S]=R.tileID;break}}}for(let S in y)p[S]||(this._coveredTiles[S]=!0,p[S]=y[S])}for(let y in p)this._tiles[y].clearFadeHold();let _=function(y,b){let T=[];for(let D in y)D in b||T.push(D);return T}(this._tiles,p);for(let y of _){let b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let i={};if(e.length===0)return i;let a={},u=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),d=e[0].overscaledZ,p=Math.max(d-sh.maxOverzooming,this._source.minzoom),_=Math.max(d+sh.maxUnderzooming,this._source.minzoom),y={};for(let b of e){let T=this._addTile(b);i[b.key]=b,T.hasData()||u<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,u,_,i);for(let b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){let S=b.children(this._source.maxzoom)[0],R=this.getTile(S);if(R&&R.hasData()){i[S.key]=S;continue}}else{let S=b.children(this._source.maxzoom);if(i[S[0].key]&&i[S[1].key]&&i[S[2].key]&&i[S[3].key])continue}let D=T.wasRequested();for(let S=b.overscaledZ-1;S>=p;--S){let R=b.scaledTo(S);if(a[R.key]||(a[R.key]=!0,T=this.getTile(R),!T&&D&&(T=this._addTile(R)),T&&(i[R.key]=R,D=T.wasRequested(),T.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let i=[],a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}i.push(u.key);let d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(let d of i)this._loadedParentTiles[d]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));let a=!!i;if(!a){let u=this.map?this.map.painter:null,d=this._source.tileSize*e.overscaleFactor();i=this._source.type==="raster-array"?new qA(e,d,this.transform.tileZoom,u,this._isRaster):new H0(e,d,this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,a||this._source.fire(new kr("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"||i.state==="empty"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,a){let u=[],d=this.transform;if(!d)return u;let p=d.projection.name==="globe",_=ua(d.center.lng);for(let y in this._tiles){let b=this._tiles[y];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(p){let D=b.tileID.canonical;if(D.z===0){let S=[Math.abs(tn(_,...gg(D,-1))-_),Math.abs(tn(_,...gg(D,1))-_)];T=[0,2*S.indexOf(Math.min(...S))-1]}else{let S=[Math.abs(tn(_,...gg(D,-1))-_),Math.abs(tn(_,...gg(D,0))-_),Math.abs(tn(_,...gg(D,1))-_)];T=[S.indexOf(Math.min(...S))-1]}}else T=[0];for(let D of T){let S=e.containsTile(b,d,i,D);S&&u.push(S)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,i){let a=this.getRenderableIds(e,i).map(d=>this._tiles[d].tileID),u=this.transform.projection.name==="globe";for(let d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=u?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){let i=e.slice(),a=this.transform._camera.position,u=this.transform._camera.forward(),d={};for(let p of i){let _=1/(1<<p.canonical.z);d[p.key]=((p.canonical.x+.5)*_+p.wrap-a[0])*u[0]+((p.canonical.y+.5)*_-a[1])*u[1]-a[2]*u[2]}return i.sort((p,_)=>d[p.key]-d[_.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(Xw(this._source.type))for(let e in this._tiles){let i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ir.now())return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){let u=this._tiles[e];u&&u.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(let a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){let _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,i))};return void this._source.on("data",_)}let a=new Map,u=Array.isArray(e)?e:[e],d=this.map.painter.terrain,p=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(let _ of u){let y=_.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let b of y)a.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}Ul(Array.from(a.values()),(_,y)=>{let b=new H0(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),y(T,b)})},i)}}function WA(t,e){let i=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Xw(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function gg(t,e){let i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}sh.maxOverzooming=10,sh.maxUnderzooming=3;let ZA=new class extends ut{possiblyEvaluate(t,e){return e=new $t(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,a){return e=gr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,a)}}(D0.paint.properties["line-width"].specification);function YA(t,e){return e>0?e+2*t:t}ZA.useIntegerZoom=!0;let v5=new On({"symbol-placement":new Be(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Be(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Be(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Be(Te.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Be(Te.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Be(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Be(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Be(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Be(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(Te.layout_symbol["icon-size"]),"icon-text-fit":new ut(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(Te.layout_symbol["icon-image"]),"icon-rotate":new ut(Te.layout_symbol["icon-rotate"]),"icon-padding":new Be(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Be(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(Te.layout_symbol["icon-offset"]),"icon-anchor":new ut(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Be(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Be(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Be(Te.layout_symbol["text-rotation-alignment"]),"text-field":new ut(Te.layout_symbol["text-field"]),"text-font":new ut(Te.layout_symbol["text-font"]),"text-size":new ut(Te.layout_symbol["text-size"]),"text-max-width":new ut(Te.layout_symbol["text-max-width"]),"text-line-height":new ut(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(Te.layout_symbol["text-letter-spacing"]),"text-justify":new ut(Te.layout_symbol["text-justify"]),"text-radial-offset":new ut(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Be(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new ut(Te.layout_symbol["text-anchor"]),"text-max-angle":new Be(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Be(Te.layout_symbol["text-writing-mode"]),"text-rotate":new ut(Te.layout_symbol["text-rotate"]),"text-padding":new Be(Te.layout_symbol["text-padding"]),"text-keep-upright":new Be(Te.layout_symbol["text-keep-upright"]),"text-transform":new ut(Te.layout_symbol["text-transform"]),"text-offset":new ut(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Be(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Be(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Be(Te.layout_symbol["text-optional"]),visibility:new Be(Te.layout_symbol.visibility)});var Kw={paint:new On({"icon-opacity":new ut(Te.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ut(Te.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ut(Te.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ut(Te.paint_symbol["text-emissive-strength"]),"icon-color":new ut(Te.paint_symbol["icon-color"]),"icon-halo-color":new ut(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Be(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Be(Te.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Te.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ut(Te.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ut(Te.paint_symbol["text-occlusion-opacity"]),"text-color":new ut(Te.paint_symbol["text-color"],{runtimeType:Or,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ut(Te.paint_symbol["text-halo-color"]),"text-halo-width":new ut(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(Te.paint_symbol["text-halo-blur"]),"text-translate":new Be(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Be(Te.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Be(Te.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Be(Te.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Be(Te.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Be(Te.paint_symbol["icon-color-brightness-max"])}),layout:v5};class XA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ql,this.defaultValue=e}evaluate(e){if(e.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}J(XA,"FormatSectionOverride",{omit:["defaultValue"]});class q0 extends vr{constructor(e,i,a,u){super(e,Kw,i,a,u),this._colorAdjustmentMatrix=r.ad.identity([])}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let u=[];for(let d of a)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(d,p,_,y){d=wd(d),p=bd(p);let b=r.ad.create(),T=d/3,D=1-2*T,S=[D,T,T,0,T,D,T,0,T,T,D,0,0,0,0,1],R=.5-.5*p,k=y-_;return r.ad.multiply(b,[k,0,0,0,0,k,0,0,0,0,k,0,_,_,_,1],[p,0,0,0,0,p,0,0,0,0,p,0,R,R,R,1]),r.ad.multiply(b,b,S),b}(e,i,a,u),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,u){let d=this.layout.get(e).evaluate(i,{},a,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||N(p.value)||!d?d:function(_,y){return y.replace(/{([^{}]+)}/g,(b,T)=>T in _?String(_[T]):"")}(i.properties,d)}createBucket(e){return new xf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Kw.paint.overridableProperties){if(!q0.hasPaintOverride(this.layout,e))continue;let i=this.paint.get(e),a=new XA(i),u=new O(a,i.property.specification,this.scope,this.options),d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new V("source",u):new G("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new ii(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&q0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){let a=e.get("text-field"),u=Kw.paint.properties[i],d=!1,p=_=>{for(let y of _)if(u.overrides&&u.overrides.hasOverride(y))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof _r)p(a.value.value.sections);else if(a.value.kind==="source"){let _=b=>{d||(b instanceof vs&&Vi(b.value)===ec?p(b.value.sections):b instanceof Ru?p(b.sections):b.eachChild(_))},y=a.value;y._styleExpression&&_(y._styleExpression.expression)}return d}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),i&&a.push("symbolSDF"),a}getDefaultProgramParams(e,i,a){return{config:new Ju(this,{zoom:i,lut:a}),overrideFog:!1}}}let x5=new On({visibility:new Be(Te.layout_background.visibility)});var b5={paint:new On({"background-color":new Be(Te.paint_background["background-color"]),"background-pattern":new Be(Te.paint_background["background-pattern"]),"background-opacity":new Be(Te.paint_background["background-opacity"]),"background-emissive-strength":new Be(Te.paint_background["background-emissive-strength"])}),layout:x5};let w5=new On({visibility:new Be(Te.layout_raster.visibility)});var E5={paint:new On({"raster-opacity":new Be(Te.paint_raster["raster-opacity"]),"raster-color":new $i(Te.paint_raster["raster-color"]),"raster-color-mix":new Be(Te.paint_raster["raster-color-mix"]),"raster-color-range":new Be(Te.paint_raster["raster-color-range"]),"raster-hue-rotate":new Be(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Be(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Be(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Be(Te.paint_raster["raster-saturation"]),"raster-contrast":new Be(Te.paint_raster["raster-contrast"]),"raster-resampling":new Be(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Be(Te.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Be(Te.paint_raster["raster-emissive-strength"]),"raster-array-band":new Be(Te.paint_raster["raster-array-band"]),"raster-elevation":new Be(Te.paint_raster["raster-elevation"])}),layout:w5};function W0(t,e,i,a,u,d,p,_){let y=[t,e,1,i,a,1,u,d,1],b=[p,_,1],T=r.bC.adjoint([],y),[D,S,R]=r._.transformMat3(b,b,T);return r.bC.multiply(y,y,[D,0,0,0,S,0,0,0,R])}function KA(t,e,i,a,u,d,p,_){let y=function(b,T,D,S,R,k,F,z){let j=W0(0,0,1,0,1,1,0,1),Y=W0(b,T,D,S,R,k,F,z),X=r.bC.adjoint([],j);return r.bC.multiply(Y,Y,X)}(t,e,i,a,u,d,p,_);return[y[2]/y[8]/rt,y[5]/y[8]/rt]}function Z0(t){return[t[0],Math.min(Math.max(t[1],-Li),Li)]}class QA extends Wa{constructor(e,i,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new kr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ea(this.map._requestManager.transformRequest(this.url,Dd.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Rd(a)):u&&(this.image=u instanceof HTMLImageElement?ir.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new U0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new kr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof U0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(let d of e)d[1]>a&&(a=d[1]),d[1]<i&&(i=d[1]);let u=(a+i)/2;if(u>Li?this.onNorthPole=!0:u<-Li&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let d=e.map(Mr.fromLngLat);this.tileID=function(p){let _=1/0,y=1/0,b=-1/0,T=-1/0;for(let F of p)_=Math.min(_,F.x),y=Math.min(y,F.y),b=Math.max(b,F.x),T=Math.max(T,F.y);let D=Math.max(b-_,T-y),S=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),R=Math.pow(2,S),k=Math.floor((_+b)/2*R);return k>1&&(k-=1),new th(S,k,Math.floor((y+T)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new kr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let z in this.tiles){let j=this.tiles[z];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let i=oh(new th(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(z){let j=z[1].x-z[0].x,Y=z[1].y-z[0].y,X=z[2].x-z[1].x,K=z[2].y-z[1].y,le=z[3].x-z[2].x,se=z[3].y-z[2].y,me=z[0].x-z[3].x,_e=z[0].y-z[3].y,Ee=j*K-X*Y,ke=X*se-le*K,Se=le*_e-me*se,ze=me*Y-j*_e;return Ee>0&&ke>0&&Se>0&&ze>0||Ee<0&&ke<0&&Se<0&&ze<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let u=oh(this.tileID,this.map.transform.projection),[d,p,_,y]=this.coordinates.map(z=>{let j=u.projection.project(z[0],z[1]);return PA(u,j)._round()});this.perspectiveTransform=KA(d.x,d.y,p.x,p.y,_.x,_.y,y.x,y.y);let b=this._boundsArray=new hc;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(p.x,p.y,rt,0),b.emplaceBack(y.x,y.y,0,rt),b.emplaceBack(_.x,_.y,rt,rt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,G0.members),this.boundsSegments=_i.simpleSegment(0,0,4,2);let T=[],D=function(z){return[Z0(z[0]),Z0(z[1]),Z0(z[2]),Z0(z[3])]}(this.coordinates),[S,R,k,F]=function(z){let j=z[0][0],Y=j,X=z[0][1],K=X;for(let le=1;le<z.length;le++)z[le][0]<j?j=z[le][0]:z[le][0]>Y&&(Y=z[le][0]),z[le][1]<X?X=z[le][1]:z[le][1]>K&&(K=z[le][1]);return[j,X,Y-j,K-X]}(D);{let z=new hc,[j,Y,X,K]=function(Oe){let We=Oe[0].x,Je=We,Ze=Oe[0].y,ht=Ze;for(let Xe=1;Xe<Oe.length;Xe++)Oe[Xe].x<We?We=Oe[Xe].x:Oe[Xe].x>Je&&(Je=Oe[Xe].x),Oe[Xe].y<Ze?Ze=Oe[Xe].y:Oe[Xe].y>ht&&(ht=Oe[Xe].y);return[We,Ze,Je-We,ht-Ze]}(a),le=Oe=>[(Oe.x-j)/X,(Oe.y-Y)/K],[se,me,_e,Ee]=a.map(le),ke=function(Oe,We,Je,Ze,ht,Xe,nt,Tt){let vt=W0(0,0,1,0,1,1,0,1),_t=W0(Oe,We,Je,Ze,ht,Xe,nt,Tt),et=r.bC.adjoint([],_t);return r.bC.multiply(vt,vt,et)}(se[0],se[1],me[0],me[1],_e[0],_e[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=KA(se[0],se[1],me[0],me[1],_e[0],_e[1],Ee[0],Ee[1]);let Se=(Oe,We)=>{T.push(Oe.lng);let Je=Math.round((Oe.lng-S)/k*rt),Ze=Math.round((Oe.lat-R)/F*rt),ht=le(We),Xe=r._.transformMat3([],[ht[0],ht[1],1],ke),nt=Math.round(Xe[0]/Xe[2]*rt),Tt=Math.round(Xe[1]/Xe[2]*rt);z.emplaceBack(Je,Ze,nt,Tt)},ze=a[3].x-a[0].x,Ye=a[3].y-a[0].y,Le=a[2].x-a[1].x,qe=a[2].y-a[1].y;for(let Oe=0;Oe<65;Oe++){let We=Oe/64,Je=[a[0].x+We*ze,a[0].y+We*Ye],Ze=[a[1].x+We*Le,a[1].y+We*qe],ht=Ze[0]-Je[0],Xe=Ze[1]-Je[1];for(let nt=0;nt<65;nt++){let Tt=nt/64,vt={x:Je[0]+ht*Tt,y:Je[1]+Xe*Tt,z:0};Se(i.projection.unproject(vt.x,vt.y),vt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(z,G0.members)}{this.maxLongitudeTriangleSize=0;let z=[],j=new Ki,Y=(X,K,le)=>{j.emplaceBack(X,K,le);let se=T[X],me=T[K],_e=T[le],Ee=Math.min(Math.min(se,me),_e),ke=Math.max(Math.max(se,me),_e)-Ee;ke>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ke),z.push(Ee+ke/2)};for(let X=0;X<64;X++)for(let K=0;K<64;K++){let le=65*X+K,se=le+1,me=le+65,_e=me+1;Y(le,me,se),Y(se,me,_e)}[z,j]=function(X,K){let le=Array.from({length:X.length},(_e,Ee)=>Ee);le.sort((_e,Ee)=>X[_e]-X[Ee]);let se=[],me=new Ki;for(let _e=0;_e<le.length;_e++){let Ee=le[_e];se.push(X[Ee]);let ke=3*Ee,Se=ke+1;me.emplaceBack(K.uint16[ke],K.uint16[Se],K.uint16[Se+1])}return[se,me]}(z,j),this.elevatedGlobeTrianglesCenterLongitudes=z,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(j)}this.elevatedGlobeSegments=_i.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/rt,0,F/rt,0,0,R,S,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof U0||(this.texture?this.texture.update(this.image):(this.texture=new rs(i,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,u=(d=e+180)+360*Math.round((a[0]-d)/360);var d;let p=new _i,_=(D,S)=>{p.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:i.segments[0].vertexLength,primitiveLength:S,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=y){let D=ly(a,0,a.length,u+y);return D===a.length||_(D,Kp(a,D+1,a.length,u+360-y)-D),p}u<a[0]&&(u+=360);let b=Kp(a,0,a.length,u-y);if(b===a.length)return _(0,a.length),p;_(0,b-0);let T=ly(a,b+1,a.length,u+y);return T!==a.length&&_(T,a.length-T),p}}let T5=(Math.pow(256,2)-1)/16907520;class JA extends vr{constructor(e,i,a,u){super(e,E5,i,a,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof QA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[a,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(u)||a===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Km({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,u])}}let C5=new On({visibility:new Be(Te["layout_raster-particle"].visibility)});var I5={paint:new On({"raster-particle-array-band":new Be(Te["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Be(Te["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new $i(Te["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Be(Te["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Be(Te["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Be(Te["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Be(Te["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:C5};class e2 extends vr{constructor(e,i,a,u){super(e,I5,i,a,u),this._updateColorRamp(),this.lastInvalidatedAt=ir.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Km({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ir.now()}}class D5 extends vr{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let S5=new On({visibility:new Be(Te.layout_sky.visibility)});var M5={paint:new On({"sky-type":new Be(Te.paint_sky["sky-type"]),"sky-atmosphere-sun":new Be(Te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Be(Te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Be(Te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Be(Te.paint_sky["sky-gradient-radius"]),"sky-gradient":new $i(Te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Be(Te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Be(Te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Be(Te.paint_sky["sky-opacity"])}),layout:S5};function Qw(t,e,i){let a=[0,0,1],u=r.av.identity([]);return r.av.rotateY(u,u,i?-dn(t)+Math.PI:dn(t)),r.av.rotateX(u,u,-dn(e)),r._.transformQuat(a,a,u),r._.normalize(a,a)}var A5={paint:new On({})};function t2(t,e){let i=Y0(t.projection,t.zoom,t.width,t.height),a=function(d,p,_,y,b){let T=new bn(_.lng-180*Mc,_.lat),D=new bn(_.lng+180*Mc,_.lat),S=d.project(T.lng,T.lat),R=d.project(D.lng,D.lat),k=-Math.atan2(R.y-S.y,R.x-S.x),F=Mr.fromLngLat(_);F.y=tn(F.y,-1+Mc,1-Mc);let z=F.toLngLat(),j=d.project(z.lng,z.lat),Y=Mr.fromLngLat(z);Y.x+=Mc;let X=Y.toLngLat(),K=d.project(X.lng,X.lat),le=r2(K.x-j.x,K.y-j.y,k),se=Mr.fromLngLat(z);se.y+=Mc;let me=se.toLngLat(),_e=d.project(me.lng,me.lat),Ee=r2(_e.x-j.x,_e.y-j.y,k),ke=Math.abs(le.x)/Math.abs(Ee.y),Se=r.ad.identity([]);r.ad.rotateZ(Se,Se,-k*(1-(b?0:y)));let ze=r.ad.identity([]);return r.ad.scale(ze,ze,[1,1-(1-ke)*y,1]),ze[4]=-Ee.x/Ee.y*y,r.ad.rotateZ(ze,ze,k),r.ad.multiply(ze,Se,ze),ze}(t.projection,0,t.center,i,e),u=n2(t);return r.ad.scale(a,a,[u,u,1]),a}function n2(t){let e=t.projection,i=Y0(t.projection,t.zoom,t.width,t.height),a=i2(e,t.center),u=i2(e,bn.convert(e.center));return Math.pow(2,a*i+(1-i)*u)}function Y0(t,e,i,a,u=1/0){let d=t.range;if(!d)return 0;let p=Math.min(u,Math.max(i,a)),_=Math.log(p/1024)/Math.LN2;return ja(d[0]+_,d[1]+_,e)}let Mc=1/4e4;function i2(t,e){let i=tn(e.lat,-Li,Li),a=new bn(e.lng-180*Mc,i),u=new bn(e.lng+180*Mc,i),d=t.project(a.lng,i),p=t.project(u.lng,i),_=Mr.fromLngLat(a),y=Mr.fromLngLat(u),b=p.x-d.x,T=p.y-d.y,D=y.x-_.x,S=y.y-_.y,R=Math.sqrt((D*D+S*S)/(b*b+T*T));return Math.log(R)/Math.LN2}function r2(t,e,i){let a=Math.cos(i),u=Math.sin(i);return{x:t*a-e*u,y:t*u+e*a}}function o2(t,e,i){r.ad.identity(t),r.ad.rotateZ(t,t,dn(e[2])),r.ad.rotateX(t,t,dn(e[0])),r.ad.rotateY(t,t,dn(e[1])),r.ad.scale(t,t,i),r.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function X0(t,e,i,a,u,d,p,_){let y=[i[0]-e[0],i[1]-e[1],0],b=[a[0]-e[0],a[1]-e[1],0];if(r._.length(y)<1e-12||r._.length(b)<1e-12)return r.av.identity(t);let T=r._.cross([],y,b);r._.normalize(T,T),r._.subtract(b,a,e),y[2]=(d-u)*_,b[2]=(p-u)*_;let D=y;return r._.cross(D,y,b),r._.normalize(D,D),r.av.rotationTo(t,T,D)}function Jw(t,e,i=!1){let a=cl(e.zoom),u=function(d,p,_){let y=p.worldSize,b=[d[12],d[13],d[14]],T=or(b[1]/y),D=no(b[0]/y),S=r.ad.identity([]),R=Yr(1,T)*y,k=Yr(1,0)*y*nh(T,p.zoom),F=1/_w(y),z=k*F;if(_){let K=Y0(p.projection,p.zoom,p.width,p.height,1024);z=F*p.projection.pixelSpaceConversion(p.center.lat,y,K)}let j=eh(T,D);r._.add(j,j,r._.scale([],r._.normalize([],j),R*z*b[2]));let Y=function(K){let le=[K[0],K[1],K[2]],se=[0,1,0],me=r._.cross([],se,le);return r._.cross(se,le,me),r._.squaredLength(se)===0&&(se=[0,1,0],r._.cross(me,le,se)),r._.normalize(me,me),r._.normalize(se,se),r._.normalize(le,le),[me[0],me[1],me[2],0,se[0],se[1],se[2],0,le[0],le[1],le[2],0,K[0],K[1],K[2],1]}(j);r.ad.scale(S,S,[z,z,z*R]),r.ad.translate(S,S,[-b[0],-b[1],-b[2]]);let X=r.ad.multiply([],p.globeMatrix,Y);return r.ad.multiply(X,X,S),r.ad.multiply(X,X,d),X}(t,e,i);if(a>0){let d=function(p,_){let y=_.worldSize,b=Yr(1,0)*y*nh(_.center.lat,_.zoom)/_w(y),T=Yr(1,_.center.lat)*y,D=r.ad.identity([]);return r.ad.rotateY(D,D,dn(_.center.lng)),r.ad.rotateX(D,D,dn(_.center.lat)),r.ad.translate(D,D,[0,0,Zr]),r.ad.scale(D,D,[b,b,b*T]),r.ad.translate(D,D,[_.point.x-.5*y,_.point.y-.5*y,0]),r.ad.multiply(D,D,p),r.ad.multiply(D,_.globeMatrix,D)}(t,e);return function(p,_,y){let b=(k,F,z)=>{let j=r._.length(k),Y=r._.length(F),X=ll(k,F,z);return r._.scale(X,X,1/r._.length(X)*Dt(j,Y,z))},T=b([p[0],p[1],p[2]],[_[0],_[1],_[2]],y),D=b([p[4],p[5],p[6]],[_[4],_[5],_[6]],y),S=b([p[8],p[9],p[10]],[_[8],_[9],_[10]],y),R=ll([p[12],p[13],p[14]],[_[12],_[13],_[14]],y);return[T[0],T[1],T[2],0,D[0],D[1],D[2],0,S[0],S[1],S[2],0,R[0],R[1],R[2],1]}(u,d,a)}return u}function s2(t,e,i,a){let u=yi.projectAabbCorners(a,i),d=Number.MAX_VALUE,p=-1;for(let b=0;b<u.length;++b){let T=u[b];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<d&&(p=b,d=T[2])}let _=b=>new lt(u[b][0],u[b][1]),y;switch(p){case 0:case 6:y=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:y=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:y=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:y=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(aw(t,y))return d}let P5=An([{name:"a_pos_3f",components:3,type:"Float32"}]),R5=An([{name:"a_color_3f",components:3,type:"Float32"}]),k5=An([{name:"a_color_4f",components:4,type:"Float32"}]),O5=An([{name:"a_uv_2f",components:2,type:"Float32"}]),L5=An([{name:"a_normal_3f",components:3,type:"Float32"}]),F5=An([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),N5=An([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class K0{constructor(e,i,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function a2(t,e){let i=t.indexOf("://")===-1;try{return new URL(t,i&&e?"http://example.com":void 0),!0}catch{return!1}}class l2{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class c2{constructor(){this.instancedDataArray=new G1,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class eE{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,a,u){this.tileToMeter=s0(a);let d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:_,index:y,sourceLayerIndex:b}of e){let T=_??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),D=al(p,d);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),D,a))continue;let S={id:T,sourceLayerIndex:b,index:y,geometry:d?D.geometry:Cs(p,a,u),properties:p.properties,type:p.type,patterns:{}},R=this.addFeature(S,S.geometry,D);R&&i.featureIndex.insert(p,S.geometry,y,b,this.index,this.instancesPerModel[R].instancedDataArray.length,rt/32)}this.lookup=null}update(e,i,a,u){for(let d in this.instancesPerModel){let p=this.instancesPerModel[d];for(let _ in e)p.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(p.features[p.idToFeaturesIndex[_]],e[_],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let i in this.instancesPerModel){let a=this.instancesPerModel[i];for(let u of a.features){let d=this.layers[0],p=u.feature,_=this.canonical,y=d.paint.get("model-rotation").evaluate(p,{},_),b=d.paint.get("model-scale").evaluate(p,{},_),T=d.paint.get("model-translation").evaluate(p,{},_);r._.exactEquals(u.rotation,y)&&r._.exactEquals(u.scale,b)&&r._.exactEquals(u.translation,T)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let u=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Dw(this.activeReplacements,u))return!1;this.activeReplacements=u;let d=!1;for(let p in this.instancesPerModel){let _=this.instancesPerModel[p],y=_.instancedDataArray;for(let b of _.features){let T=b.instancedDataOffset,D=b.instancedDataCount;for(let S=0;S<D;S++){let R=16*(S+T),k=y.float32[R+0];k=k>rt?k-rt:k;let F=Math.floor(k),z=y.float32[R+1],j=!1;for(let Y of this.activeReplacements)if(!(Y.order<a||Y.order===1/0)&&Y.clipMask&SM.Model&&!(Y.min.x>F||F>Y.max.x||Y.min.y>z||z>Y.max.y)&&(j=xM(vM(F,z,e.canonical,Y.footprintTileId.canonical),Y),j))break;y.float32[R]=j?k+rt:k,d=d||j}}}return d}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let i in this.instancesPerModel){let a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,F5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let i in this.instancesPerModel){let a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,a){let u=this.layers[0],d=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return ki(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),d;a2(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new c2);let p=this.instancesPerModel[d],_=p.instancedDataArray,y=new l2(a,_.length);for(let b of i)for(let T of b){if(T.x<0||T.x>=rt||T.y<0||T.y>=rt)continue;let D=(this.lookupDim-1)/rt,S=this.lookupDim*(T.y*D|0)+T.x*D|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let R=_.length;_.resize(R+1),p.instancesEvaluatedElevation.push(0),_.float32[16*R]=T.x,_.float32[16*R+1]=T.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,a,u){let d=this.layers[0],p=e.feature,_=this.canonical,y=e.rotation=d.paint.get("model-rotation").evaluate(p,i,_),b=e.scale=d.paint.get("model-scale").evaluate(p,i,_),T=e.translation=d.paint.get("model-translation").evaluate(p,i,_),D=d.paint.get("model-color").evaluate(p,i,_);D.a=d.paint.get("model-color-mix-intensity").evaluate(p,i,_);let S=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),o2(S,y,b);let R=Math.round(100*D.a)+D.b/1.05;for(let k=0;k<e.instancedDataCount;++k){let F=e.instancedDataOffset+k,z=16*F,j=a.instancedDataArray.float32,Y=0;u&&(Y=j[z+6]-a.instancesEvaluatedElevation[F]);let X=0|j[z+1];j[z]=(0|j[z])+D.r/1.05,j[z+1]=X+D.g/1.05,j[z+2]=R,j[z+3]=1/(_.z>10?this.tileToMeter:s0(_,X)),j[z+4]=T[0],j[z+5]=T[1],j[z+6]=T[2]+Y,j[z+7]=S[0],j[z+8]=S[1],j[z+9]=S[2],j[z+10]=S[4],j[z+11]=S[5],j[z+12]=S[6],j[z+13]=S[8],j[z+14]=S[9],j[z+15]=S[10],a.instancesEvaluatedElevation[F]=T[2]}}}J(eE,"ModelBucket",{omit:["layers"]}),J(c2,"PerModelAttributes"),J(l2,"ModelFeature");let z5=new On({visibility:new Be(Te.layout_model.visibility),"model-id":new ut(Te.layout_model["model-id"])});var B5={paint:new On({"model-opacity":new Be(Te.paint_model["model-opacity"]),"model-rotation":new ut(Te.paint_model["model-rotation"]),"model-scale":new ut(Te.paint_model["model-scale"]),"model-translation":new ut(Te.paint_model["model-translation"]),"model-color":new ut(Te.paint_model["model-color"]),"model-color-mix-intensity":new ut(Te.paint_model["model-color-mix-intensity"]),"model-type":new Be(Te.paint_model["model-type"]),"model-cast-shadows":new Be(Te.paint_model["model-cast-shadows"]),"model-receive-shadows":new Be(Te.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Be(Te.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ut(Te.paint_model["model-emissive-strength"]),"model-roughness":new ut(Te.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ut(Te.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Be(Te.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Be(Te.paint_model["model-front-cutoff"])}),layout:z5};let ah=64,Ef={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function u2(t,e,i,a,u,d,p,_,y,b=!1){let T=i.zoom,D=i.project(a),S=nh(a.lat,T),R=1/S;r.ad.identity(t),r.ad.translate(t,t,[D.x+p[0]*R,D.y+p[1]*R,p[2]]);let k=1,F=1,z=i.worldSize;if(b){if(i.projection.name==="mercator"){let K=0;i.elevation&&(K=i.elevation.getAtPointOrZero(new Mr(D.x/z,D.y/z),0));let le=r.aA.transformMat4([],[D.x,D.y,K,1],i.projMatrix)[3]/i.cameraToCenterDistance;k=le,F=le*nh(i.center.lat,T)}else if(i.projection.name==="globe"){let K=Jw(t,i),le=r.ad.multiply([],i.projMatrix,K),se=[0,0,0,1];r.aA.transformMat4(se,se,le);let me=se[3]/i.cameraToCenterDistance,_e=cl(T),Ee=i.projection.pixelsPerMeter(a.lat,z)*nh(a.lat,T),ke=i.projection.pixelsPerMeter(i.center.lat,z)*nh(i.center.lat,T);k=me/Dt(Ee,SS(i.center.lat),_e),F=me*S/Ee,k*=ke,F*=ke}}else k=R;r.ad.scale(t,t,[k,k,F]);let j=[...t],Y=e.orientation,X=[];if(o2(X,[Y[0]+u[0],Y[1]+u[1],Y[2]+u[2]],d),r.ad.multiply(t,j,X),_&&i.elevation){let K=0,le=[];if(y&&i.elevation){K=function(_e,Ee,ke,Se,ze){let Ye=Ee.elevation;if(!Ye)return 0;let Le=yi.projectAabbCorners(ke,Se),qe=Yr(1,ze.lat)*Ee.worldSize,Oe=function(Ct,Yt){let Pt=[0,0,1],Qt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Xt of Qt){let sn=Ct[Xt.corners[0]],St=Ct[Xt.corners[1]],Gn=Ct[Xt.corners[2]],Un=[St[0]-sn[0],St[1]-sn[1],Yt*(St[2]-sn[2])],In=r._.cross(Un,Un,[Gn[0]-sn[0],Gn[1]-sn[1],Yt*(Gn[2]-sn[2])]);r._.normalize(In,In),Xt.dotProductWithUp=r._.dot(In,Pt)}return Qt.sort((Xt,sn)=>Xt.dotProductWithUp-sn.dotProductWithUp),Qt[0].corners}(Le,qe),We=Le[Oe[0]],Je=Le[Oe[1]],Ze=Le[Oe[2]],ht=Le[Oe[3]],Xe=Ye.getAtPointOrZero(new Mr(We[0]/Ee.worldSize,We[1]/Ee.worldSize),0),nt=Ye.getAtPointOrZero(new Mr(Je[0]/Ee.worldSize,Je[1]/Ee.worldSize),0),Tt=Ye.getAtPointOrZero(new Mr(Ze[0]/Ee.worldSize,Ze[1]/Ee.worldSize),0),vt=Ye.getAtPointOrZero(new Mr(ht[0]/Ee.worldSize,ht[1]/Ee.worldSize),0),_t=(Xe+vt)/2,et=(nt+Tt)/2;return _t>et?nt<Tt?X0(_e,Je,ht,We,nt,vt,Xe,qe):X0(_e,Ze,We,ht,Tt,Xe,vt,qe):Xe<vt?X0(_e,We,Je,Ze,Xe,nt,Tt,qe):X0(_e,ht,Ze,Je,vt,Tt,nt,qe),Math.max(_t,et)}(le,i,e.aabb,t,a);let se=r.ad.fromQuat([],le),me=r.ad.multiply([],se,X);r.ad.multiply(t,j,me)}else K=i.elevation.getAtPointOrZero(new Mr(D.x/z,D.y/z),0);K!==0&&(t[14]+=K)}}function _g(t,e,i=!1){t.uploaded||(t.gfxTexture=new rs(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function V5(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,P5.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,L5.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,O5.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?R5:k5).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,N5.members,!0)),t.segments=_i.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&_g(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&_g(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&_g(a.normalTexture,e),a.occlusionTexture&&_g(a.occlusionTexture,e,i),a.emissionTexture&&_g(a.emissionTexture,e)}function tE(t,e,i){if(t.meshes)for(let a of t.meshes)V5(a,e,i);if(t.children)for(let a of t.children)tE(a,e,i)}function Q0(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)Q0(e)}function nE(t){if(t.meshes)for(let i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let i of t.children)nE(i)}class j5{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class U5{constructor(){this.tasks={},this.taskQueue=[],yd(["process"],this),this.invoker=new j5(this.process),this.nextId=0}add(e,i){let a=this.nextId++,u=function({type:d,isSymbolTile:p,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-_:d==="maybePrepare"&&p?400-_:500:200-_:100-_}(i);if(u===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){let d=this.tasks[this.taskQueue[u]];d.priority<i&&(i=d.priority,e=u)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class h2{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},yd(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new U5}send(e,i,a,u,d=!1,p){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[_]=a);let y=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:ge(i,y)},y),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){let i=e.data,a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(i.mustQueue||nr()){let u=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,i),u&&u.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(Ce(i.error)):a(null,Ce(i.data)))}else{let a=new Set,u=i.hasCallback?(p,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?ge(p):null,data:ge(_,a)},a)}:p=>{},d=Ce(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,u);else if(this.parent.getWorkerSource){let p=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,p[0],d.source,d.scope)[p[1]](d,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let iE=(()=>{class t{constructor(i,a){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=gd();let u=this.workerPool.acquire(this.id);for(let d=0;d<u.length;d++){let p=new t.Actor(u[d],a,this.id);p.name=`Worker ${d}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,u){Ul(this.actors,(d,p)=>{d.send(i,a,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=h2,t})();var yg={workerUrl:"",workerClass:null,workerParams:void 0};function $5(){return yg.workerClass!=null?new yg.workerClass:new self.Worker(yg.workerUrl,yg.workerParams)}let rE="mapboxgl_preloaded_worker_pool";class vg{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<vg.workerCount;)this.workers.push(new $5);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[rE]}numActive(){return Object.keys(this.active).length}}let xg;function J0(){return xg||(xg=new vg),xg}vg.workerCount=2;let ev,oE,Rs,Tf,sE,Cf=null;function d2(){return nr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:oE||A.DRACO_URL}function f2(){if(nr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Tf)return Tf;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Tf=WebAssembly.validate(t)?A.MESHOPT_SIMD_URL:A.MESHOPT_URL,Tf}let tv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},G5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},bg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function p2(t,e,i){let a=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:u,byteLength:t.byteLength},i.buffers[u]=t}let aE="KHR_draco_mesh_compression";function H5(t,e){let i=t.extensions&&t.extensions[aE];if(!i)return;let a=new Rs.Decoder,u=y2(e,i.bufferView),d=new Rs.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,d))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[t.indices],_=tv[p.componentType],y=p.count*_.BYTES_PER_ELEMENT,b=Rs._malloc(y);_===Uint16Array?a.GetTrianglesUInt16Array(d,y,b):a.GetTrianglesUInt32Array(d,y,b),p2(Rs.memory.buffer.slice(b,b+y),p,e),Rs._free(b);for(let T of Object.keys(i.attributes)){let D=a.GetAttributeByUniqueId(d,i.attributes[T]),S=e.json.accessors[t.attributes[T]],R=G5[S.componentType],k=S.count*bg[S.type]*tv[S.componentType].BYTES_PER_ELEMENT,F=Rs._malloc(k);a.GetAttributeDataArrayForAllPoints(d,D,Rs[R],k,F),p2(Rs.memory.buffer.slice(F,F+k),S,e),Rs._free(F)}a.destroy(),d.destroy(),delete t.extensions[aE]}let nv="EXT_meshopt_compression";function q5(t,e){if(!t.extensions||!t.extensions[nv])return;let i=t.extensions[nv],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);sE.decodeGltfBuffer(u,i.count,i.byteStride,a,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=u.buffer,delete t.extensions[nv]}let m2=1179937895,g2=new TextDecoder("utf8");function _2(t,e){return new URL(t,e).href}function W5(t,e,i,a){return fetch(_2(t.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[i]=u})}function y2(t,e){let i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function Z5(t,e,i,a){if(t.uri){let u=_2(t.uri,a);return fetch(u).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(t.bufferView!==void 0){let u=y2(e,t.bufferView),d=new Blob([u],{type:t.mimeType});return createImageBitmap(d).then(p=>{e.images[i]=p})}}function v2(t,e=0,i){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===m2){let T=new Uint32Array(t,e),D=2,S=(T[D++]>>2)-3,R=T[D++]>>2;if(D++,a.json=JSON.parse(g2.decode(T.subarray(D,D+R))),D+=R,D<S){let k=T[D++];D++;let F=e+(D<<2);a.buffers[0]=t.slice(F,F+k)}}else a.json=JSON.parse(g2.decode(new Uint8Array(t,e)));let{buffers:u,images:d,meshes:p,extensionsUsed:_,bufferViews:y}=a.json,b=Promise.resolve();if(u){let T=[];for(let D=0;D<u.length;D++){let S=u[D];S.uri?T.push(W5(S,a,D,i)):a.buffers[D]||(a.buffers[D]=null)}b=Promise.all(T)}return b.then(()=>{let T=[],D=_&&_.includes(aE),S=_&&_.includes(nv);if(D&&T.push(function(){if(!Rs)return ev||(ev=function(R){let k,F=null;function z(){k=new Uint8Array(F.buffer)}function j(){throw new Error("Unexpected Draco error.")}let Y={a:{a:j,d:function(X,K,le){return k.copyWithin(X,K,K+le)},c:function(X){let K=k.length,le=Math.max(X>>>0,Math.ceil(1.2*K)),se=Math.ceil((le-K)/65536);try{return F.grow(se),z(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,Y):R.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,Y))).then(X=>{let{Rb:K,Qb:le,P:se,T:me,X:_e,Ja:Ee,La:ke,Qa:Se,Va:ze,Wa:Ye,eb:Le,jb:qe,f:Oe,e:We,yb:Je,zb:Ze,Ab:ht,Bb:Xe,Db:nt,Gb:Tt}=X.instance.exports;F=We;let vt=(()=>{let _t=0,et=0,Ct=0,Yt=0;return Pt=>{Ct&&(K(Yt),K(_t),et+=Ct,Ct=_t=0),_t||(et+=128,_t=le(et));let Qt=Pt.length+7&-8,Xt=_t;Qt>=et&&(Ct=Qt,Xt=Yt=le(Qt));for(let sn=0;sn<Pt.length;sn++)k[Xt+sn]=Pt[sn];return Xt}})();return z(),Oe(),{memory:We,_free:K,_malloc:le,Mesh:class{constructor(){this.ptr=se()}destroy(){me(this.ptr)}},Decoder:class{constructor(){this.ptr=Ee()}destroy(){qe(this.ptr)}DecodeArrayToMesh(_t,et,Ct){let Yt=vt(_t),Pt=ke(this.ptr,Yt,et,Ct.ptr);return!!_e(Pt)}GetAttributeByUniqueId(_t,et){return{ptr:Se(this.ptr,_t.ptr,et)}}GetTrianglesUInt16Array(_t,et,Ct){ze(this.ptr,_t.ptr,et,Ct)}GetTrianglesUInt32Array(_t,et,Ct){Ye(this.ptr,_t.ptr,et,Ct)}GetAttributeDataArrayForAllPoints(_t,et,Ct,Yt,Pt){Le(this.ptr,_t.ptr,et.ptr,Ct,Yt,Pt)}},DT_INT8:Je(),DT_UINT8:Ze(),DT_INT16:ht(),DT_UINT16:Xe(),DT_UINT32:nt(),DT_FLOAT32:Tt()}})}(fetch(d2())),ev.then(R=>{Rs=R,ev=void 0}))}()),S&&T.push(function(){if(sE)return;let R=function(k){let F,z=WebAssembly.instantiateStreaming(k,{}).then(X=>{F=X.instance,F.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(X,K,le,se,me,_e){(function(Ee,ke,Se,ze,Ye,Le,qe){let Oe=Ee.exports.sbrk,We=ze+3&-4,Je=Oe(We*Ye),Ze=Oe(Le.length),ht=new Uint8Array(Ee.exports.memory.buffer);ht.set(Le,Ze);let Xe=ke(Je,ze,Ye,Ze,Le.length);if(Xe===0&&qe&&qe(Je,We,Ye),Se.set(ht.subarray(Je,Je+ze*Ye)),Oe(Je-Oe(0)),Xe!==0)throw new Error(`Malformed buffer data: ${Xe}`)})(F,F.exports[Y[me]],X,K,le,se,F.exports[j[_e]])}}}(fetch(f2()));return R.ready.then(()=>{sE=R})}()),d)for(let R=0;R<d.length;R++)T.push(Z5(d[R],a,R,i));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(D&&p)for(let{primitives:R}of p)for(let k of R)H5(k,a);if(S&&p&&y)for(let R of y)q5(R,a);return a})})}function lh(t,e){let i=t.json.bufferViews[e.bufferView],a=tv[e.componentType];return new a(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==bg[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:bg[e.type]))}function lE(t,e,i,a){let u=tv[e.componentType],d=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),p=t.json.bufferViews[e.bufferView],_=p.byteStride?p.byteStride/u.BYTES_PER_ELEMENT:bg[e.type],y=i.float32,b=y.length/i.capacity;for(let T=0,D=0;T<e.count*_;T+=_,D+=b)for(let S=0;S<b;S++)y[D+S]=a[T+S]*d;i._trim()}function Y5(t,e,i){let a=t.indices,u=t.attributes,d={};d.indexArray=new Ki;let p=e.json.accessors[a],_=p.count/3;d.indexArray.reserve(_);let y=lh(e,p);for(let S=0;S<_;S++)d.indexArray.emplaceBack(y[3*S],y[3*S+1],y[3*S+2]);d.indexArray._trim(),d.vertexArray=new fc;let b=e.json.accessors[u.POSITION];d.vertexArray.reserve(b.count);let T=lh(e,b);for(let S=0;S<b.count;S++)d.vertexArray.emplaceBack(T[3*S],T[3*S+1],T[3*S+2]);if(d.vertexArray._trim(),d.aabb=new yi(b.min,b.max),d.centroid=function(S,R){let k=[0,0,0],F=S.length;if(F>0){for(let z=0;z<F;z++){let j=3*S[z];k[0]+=R[j],k[1]+=R[j+1],k[2]+=R[j+2]}k[0]/=F,k[1]/=F,k[2]/=F}return k}(y,T),u.COLOR_0!==void 0){let S=e.json.accessors[u.COLOR_0],R=bg[S.type],k=lh(e,S);d.colorArray=R===3?new fc:new dc,d.colorArray.resize(S.count),lE(e,S,d.colorArray,k)}if(u.NORMAL!==void 0){d.normalArray=new fc;let S=e.json.accessors[u.NORMAL];d.normalArray.resize(S.count);let R=lh(e,S);lE(e,S,d.normalArray,R)}if(u.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new ef;let S=e.json.accessors[u.TEXCOORD_0];d.texcoordArray.resize(S.count);let R=lh(e,S);lE(e,S,d.texcoordArray,R)}if(u._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=lh(e,S))}u._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(lh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));let D=t.material;return d.material=function(S,R){let{emissiveFactor:k=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:z=.5,normalTexture:j,occlusionTexture:Y,emissiveTexture:X,doubleSided:K}=S,{baseColorFactor:le=[1,1,1,1],metallicFactor:se=1,roughnessFactor:me=1,baseColorTexture:_e,metallicRoughnessTexture:Ee}=S.pbrMetallicRoughness||{},ke=Y?R[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&ke){let Se=Y.extensions.KHR_texture_transform;ke.offsetScale=[Se.offset[0],Se.offset[1],Se.scale[0],Se.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new En(...le),metallicFactor:se,roughnessFactor:me,baseColorTexture:_e?R[_e.index]:void 0,metallicRoughnessTexture:Ee?R[Ee.index]:void 0},doubleSided:K,emissiveFactor:k,alphaMode:F,alphaCutoff:z,normalTexture:j?R[j.index]:void 0,occlusionTexture:ke,emissionTexture:X?R[X.index]:void 0,defined:S.defined===void 0}}(D!==void 0?e.json.materials[D]:{defined:!1},i),d}function x2(t,e,i){let{matrix:a,rotation:u,translation:d,scale:p,mesh:_,extras:y,children:b}=t,T={};if(T.matrix=a||r.ad.fromRotationTranslationScale([],u||[0,0,0,1],d||[0,0,0],p||[1,1,1]),_!==void 0){T.meshes=i[_];let D=T.anchor=[0,0];for(let S of T.meshes){let{min:R,max:k}=S.aabb;D[0]+=R[0]+k[0],D[1]+=R[1]+k[1]}D[0]=Math.floor(D[0]/T.meshes.length/2),D[1]=Math.floor(D[1]/T.meshes.length/2)}if(y&&(y.id&&(T.id=y.id),y.lights&&(T.lights=function(D){if(!D.length)return[];let S=function(j){let Y=atob(j),X=new Uint8Array(Y.length);for(let K=0;K<Y.length;K++)X[K]=Y.codePointAt(K);return X}(D),R=[],k=S.length/24,F=new Uint16Array(S.buffer),z=new Float32Array(S.buffer);for(let j=0;j<k;j++){let Y=F[2*j*6]/30,X=F[2*j*6+1]/30,K=F[2*j*6+10]/100,le=z[6*j+1],se=z[6*j+2],me=z[6*j+3],_e=z[6*j+4],Ee=me-le,ke=_e-se,Se=Math.hypot(Ee,ke);R.push({pos:[le+.5*Ee,se+.5*ke,X],normal:[ke/Se,-Ee/Se,0],width:Se,height:Y,depth:K,points:[le,se,me,_e]})}return R}(y.lights))),b){let D=[];for(let S of b)D.push(x2(e.json.nodes[S],e,i));T.children=D}return T}function X5(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new Tw(t.vertices,t.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:i,max:a}}function K5(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;let a=[];for(let p of i){if(!Array.isArray(p)||p.length!==2)continue;let _=p[0],y=p[1];typeof _=="number"&&typeof y=="number"&&a.push(new lt(_,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let p=0;p<a.length;p++){let _=a[p],y=a[(p+1)%a.length],b=a[(p+2)%a.length];u+=(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)}u>0&&a.reverse();let d=Qm(a.flatMap(p=>[p.x,p.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function Q5(t,e){let i=[],a=[],u=0,d=[];for(let p of t){u=i.length;let _=p.vertexArray.float32,y=p.indexArray.uint16;for(let b=0;b<p.vertexArray.length;b++)d[0]=_[3*b+0],d[1]=_[3*b+1],d[2]=_[3*b+2],r._.transformMat4(d,d,e),i.push(new lt(d[0],d[1]));for(let b=0;b<3*p.indexArray.length;b++)a.push(y[b]+u)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){let _=i[a[p+0]],y=i[a[p+1]],b=i[a[p+2]];(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:i,indices:a}}function b2(t){let e=function(y,b){let T=[],D=WebGL2RenderingContext;if(y.json.textures)for(let S of y.json.textures){let R={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};S.sampler!==void 0&&Object.assign(R,y.json.samplers[S.sampler]),T.push({image:b[S.source],sampler:R,uploaded:!1})}return T}(t,t.images),i=function(y,b){let T=[];for(let D of y.json.meshes){let S=[];for(let R of D.primitives)S.push(Y5(R,y,b));T.push(S)}return T}(t,e),{scenes:a,scene:u,nodes:d}=t.json,p=a?a[u||0].nodes:d,_=[];for(let y of p)_.push(x2(d[y],t,i));return function(y,b,T){let D={},S=new Set;for(let R=0;R<y.length;R++){let k=T[b[R]];if(!k.extras)continue;let F=k.extras["mapbox:footprint:version"],z=k.extras["mapbox:footprint:id"];(F||z)&&S.add(R),F==="1.0.0"&&z&&(D[z]=R)}for(let R=0;R<y.length;R++){if(S.has(R))continue;let k=y[R],F=T[b[R]];if(!F.extras)continue;let z=null;k.id in D&&(z=Q5(y[D[k.id]].meshes,k.matrix)),z||(z=K5(F)),z&&(k.footprint=X5(z))}if(S.size>0){let R=Array.from(S.values()).sort((k,F)=>k-F);for(let k=R.length-1;k>=0;k--)y.splice(R[k],1)}}(_,p,t.json.nodes),_}function J5(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,i=t.aabb.min[0]-1,a=t.aabb.min[1]-1,u=ah/(t.aabb.max[0]-i+2),d=ah/(t.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){let _=e[p+2],y=(e[p+0]-i)*u|0,b=(e[p+1]-a)*d|0;_>t.heightmap[b*ah+y]&&(t.heightmap[b*ah+y]=_)}}function e4(t,e){let i={};i.indexArray=new Ki,i.indexArray.reserve(4*t.length),i.vertexArray=new fc,i.vertexArray.reserve(10*t.length),i.colorArray=new dc,i.vertexArray.reserve(10*t.length);let a=0;for(let p of t){let _=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],b=Math.min(.29,.1*p.width/p.depth),T=p.width-2*p.depth*e*(b+.01),D=r._.scaleAndAdd([],p.pos,y,T/2),S=r._.scaleAndAdd([],p.pos,y,-T/2),R=[D[0],D[1],D[2]+p.height],k=[S[0],S[1],S[2]+p.height],F=r._.scaleAndAdd([],p.normal,y,b);r._.scale(F,F,_);let z=r._.scaleAndAdd([],p.normal,y,-b);r._.scale(z,z,_),r._.add(F,D,F),r._.add(z,S,z),D[2]+=.1,S[2]+=.1,i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]);let j=T/_/2;i.colorArray.emplaceBack(-j-b,-1,j,.8),i.colorArray.emplaceBack(j+b,-1,j,.8),i.colorArray.emplaceBack(-j,0,j,1.3),i.colorArray.emplaceBack(j,0,j,1.3),i.colorArray.emplaceBack(j+b,-.8,j,.7),i.colorArray.emplaceBack(j+b,-.8,j,.7),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(j+b,-1.2,j,.8),i.colorArray.emplaceBack(j+b,-1.2,j,.8),i.indexArray.emplaceBack(6+a,4+a,8+a),i.indexArray.emplaceBack(7+a,9+a,5+a),i.indexArray.emplaceBack(0+a,1+a,2+a),i.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let u={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=En.white,u.pbrMetallicRoughness=d,i.material=u,i.aabb=new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}let cE=new Float32Array(262144),ch=new Uint8Array(262144);function w2(t){let e=0;if(t.meshes)for(let i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(let i of t.children)e=Math.max(e,w2(i));return e}function E2(t,e,i){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&i.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)E2(a,e,i)}let T2=["","wall","door","roof","window","lamp","logo"];class C2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:w2(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,i=new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=yi.applyTransform(a.aabb,this.node.matrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class iv{constructor(e,i,a,u,d,p){this.id=i,this.modelTraits|=Ef.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Ef.HasMapboxMeshFeatures),u&&(this.modelTraits|=Ef.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new C2(_)),E2(_,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,i){for(let a of this.getNodesInfo()){let u=a.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let a of i){let u=a.node;this.uploaded?this.updatePbrBuffer(u):tE(u,e,!0)}for(let a of i)Q0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){let u=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||wg(a.paint.get("model-color").value,p)||wg(a.paint.get("model-color-mix-intensity").value,p)||wg(a.paint.get("model-roughness").value,p)||wg(a.paint.get("model-emissive-strength").value,p)||wg(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=u,this.brightness=d,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),u=this.id.canonical;for(let d of a){let p=d.feature;d.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e){let i=this.getNodesInfo();for(let a of i){if(!a.node.meshes)continue;let u=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],_=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let b=0;b<T2.length;b++){let T=T2[b];T.length&&(u.properties.part=T);let D=e.paint.get("model-color").evaluate(u,{},y).toRenderColor(null),S=e.paint.get("model-color-mix-intensity").evaluate(u,{},y);a.evaluatedColor[b]=[D.r,D.g,D.b,S],a.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(u,{},y),a.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(u,{},y),a.evaluatedRMEA[b][3]=D.a,a.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},y),!a.hasTranslucentParts&&D.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,n4(a,p!==a.evaluatedColor[2]||_!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,u){let d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;let p=uf.create(e,a,d);if(!p)return;this.modelTraits&Ef.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,u);for(let _ of this.getNodesInfo()){let y=_.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let b=y.footprint.vertices,T=p.getElevationAt(b[0].x,b[0].y,!0,!0);for(let D=1;D<b.length;D++)T=Math.min(T,p.getElevationAt(b[D].x,b[D].y,!0,!0));y.elevation=T}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,u){let d=i._dem._modifiedForSources[u];if(d===void 0&&(i._dem._modifiedForSources[u]=[],d=i._dem._modifiedForSources[u]),d.includes(a.canonical))return;let p=i._dem.dim;d.push(a.canonical);let _=!1;for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.grid)continue;let T=b.footprint.grid,D=i.tileCoordToPixel(T.min.x,T.min.y),S=i.tileCoordToPixel(T.max.x,T.max.y),R=Math.min(Math.min(p-S.y,D.x),Math.min(D.y,p-S.x));if(R<0)continue;let k=tn(R,2,5),F=Math.max(0,D.x-k),z=Math.max(0,D.y-k),j=Math.min(S.x+k,p-1),Y=Math.min(S.y+k,p-1);for(let se=z;se<=Y;++se)for(let me=F;me<=j;++me)ch[se*p+me]=255;let X=0,K=0;for(let se=0;se<T.cellsY;++se)for(let me=0;me<T.cellsX;++me){if(!T.cells[se*T.cellsX+me])continue;let _e=i.tileCoordToPixel(T.min.x+me/T.xScale,T.min.y+se/T.yScale),Ee=i.tileCoordToPixel(T.min.x+(me+1)/T.xScale,T.min.y+(se+1)/T.yScale);for(let ke=_e.y;ke<=Math.min(Ee.y+1,p-1);++ke)for(let Se=_e.x;Se<=Math.min(Ee.x+1,p-1);++Se)ch[ke*p+Se]===255&&(ch[ke*p+Se]=0,X+=i.getElevationAtPixel(Se,ke),K++)}let le=X/K;F=Math.max(1,D.x-k),z=Math.max(1,D.y-k),j=Math.min(S.x+k,p-2),Y=Math.min(S.y+k,p-2),_=!0;for(let se=z;se<=Y;++se)for(let me=F;me<=j;++me)ch[se*p+me]===0&&(cE[se*p+me]=i._dem.set(me,se,le));for(let se=1;se<k;++se){F=Math.max(1,D.x-se),z=Math.max(1,D.y-se),j=Math.min(S.x+se,p-2),Y=Math.min(S.y+se,p-2);for(let me=z;me<=Y;++me)for(let _e=F;_e<=j;++_e){let Ee=me*p+_e;if(ch[Ee]===255){let ke=0,Se=0,ze=-1,Ye=-1;for(let Le=-1;Le<=1;++Le)for(let qe=-1;qe<=1;++qe){let Oe=(me+Le)*p+_e+qe;if(ch[Oe]>=se)continue;let We=cE[Oe],Je=Math.abs(We);Je>Se&&(ke=We,Se=Je,ze=qe,Ye=Le)}if(Se>.1){let Le=1-(se+.5*Math.abs(ze*Ye))/k,qe=i._dem.get(_e,me)+ke*Le,Oe=i._dem.get(_e+ze,me+Ye),We=i._dem.get(_e-ze,me-Ye,!0);(qe-Oe)*(qe-We)>0&&(qe=(Oe+We)/2),cE[Ee]=i._dem.set(_e,me,qe),ch[Ee]=se}}}}}_&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ir.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let i of e)Q0(i.node),nE(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let a=i.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){let p=u[d].node;u[d].hiddenByReplacement=!!p.footprint&&!a.find(_=>_.footprint===p.footprint)}}getHeightAtTileCoord(e,i){let a=this.getNodesInfo(),u=[],d=[0,0,0],p=r.ad.identity([]);for(let _=0;_<this.nodesInfo.length;_++){let y=a[_],b=y.node.meshes[0],T=b.transformedAabb;if(e<T.min[0]||i<T.min[1]||e>T.max[0]||i>T.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};r.ad.invert(p,y.node.matrix),d[0]=e,d[1]=i,r._.transformMat4(d,d,p);let D=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*ah|0,S=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*ah|0)*ah+Math.min(63,D),R=b.heightmap[S];if(!(R<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:R,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new lt(e,i),new lt(e,i),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function wg(t,e){return!t.isLightConstant&&e}function t4(t,e,i,a,u,d,p,_){let y=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;i[3]>0&&(y=Dt(y,255*i[0],i[3]),b=Dt(b,255*i[1],i[3]),T=Dt(T,255*i[2],i[3]));let D=y<<8|b,S=T<<8|Math.floor(255*a[3]),R=function(se){let me=tn(se,0,2);return Math.min(Math.round(.5*me*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],k=tn(u[0],0,1),F=tn(u[1],0,1),z=tn(u[2],0,1),j=tn(u[3],0,1),Y,X,K,le;if(k!==F&&p!==d&&F!==k){let se=p-d;X=1/(se*(F-k)),K=-(d+se*k)/(se*(F-k));let me=tn(u[4],-1,1);le=Math.pow(10,me),Y=255*z<<8|255*j}else Y=65535,X=0,K=1,le=1;if(t.emplaceBack(D,S,R,Y,X,K,le),_){let se=_.length;_.clear();for(let me=0;me<se;me++)_.emplaceBack(D,S,R,Y,X,K,le)}}function n4(t,e,i){let a=t.node,u=0,d=i&Ef.HasMeshoptCompression;for(let p of a.meshes){if(a.lights&&a.lightMeshIndex===u||!p.featureData)continue;p.featureArray=new i0,p.featureArray.reserve(p.featureData.length);let _=e;for(let y of p.featureData){let b=d?65535&y:y>>16&65535,T=d?y>>16&65535:65535&y,D=(15&T)<8?15&T:0,S=t.evaluatedRMEA[D],R=t.evaluatedColor[D],k=t.emissionHeightBasedParams[D],F;if(_&&D===2&&a.lights&&(F=new i0,F.resize(10*a.lights.length)),t4(p.featureArray,b,R,S,k,p.aabb.min[2],p.aabb.max[2],F),F&&_){_=!1;let z=a.meshes[a.lightMeshIndex];z.featureArray=F,z.featureArray._trim()}}p.featureArray._trim(),u++}}function I2(t,e,i,a){let u=1<<t.z;e.lat=or((a/rt+t.y)/u),e.lng=no((i/rt+t.x)/u)}J(iv,"Tiled3dModelBucket",{omit:["layers"]}),J(C2,"Tiled3dModelFeature");let i4={circle:class extends vr{constructor(t,e,i,a){super(t,$z,e,i,a)}createBucket(t){return new sw(t)}queryRadius(t){let e=t;return af("circle-radius",this,e)+af("circle-stroke-width",this,e)+c0(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,a,u,d,p,_){let y=NS(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return QS(t,a,d,p,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,i){let a=KS(this);return{config:new Ju(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}},heatmap:class extends vr{createBucket(t){return new eM(t)}constructor(t,e,i,a){super(t,eB,e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return af("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,a,u,d,p,_){let y=this.paint.get("heatmap-radius").evaluate(e,i);return QS(t,a,d,p,_,!0,!0,new lt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,i){return t==="heatmap"?{config:new Ju(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends vr{constructor(t,e,i,a){super(t,nB,e,i,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}},fill:class extends vr{constructor(t,e,i,a){super(t,gB,e,i,a)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e,i){return{config:new Ju(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new y0(t)}queryRadius(){return c0(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,a,u,d){return!t.queryGeometry.isAboveHorizon&&RS(FS(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends vr{constructor(t,e,i,a){super(t,qB,e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new C0(t)}queryRadius(){return c0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,a,u,d,p,_,y){let b=NS(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,i),D=this.paint.get("fill-extrusion-base").evaluate(e,i),S=[0,0],R=_&&d.elevation,k=d.elevation?d.elevation.exaggeration():1,F=t.tile.getBucket(this);if(R&&F instanceof C0){let K=F.centroidVertexArray,le=y+1;le<K.length&&(S[0]=K.geta_centroid_pos0(le),S[1]=K.geta_centroid_pos1(le))}if(S[0]===0&&S[1]===1)return!1;d.projection.name==="globe"&&(a=jM([a],[new lt(0,0),new lt(rt,rt)],t.tileID.canonical).map(K=>K.polygon).flat());let z=R?_:null,[j,Y]=function(K,le,se,me,_e,Ee,ke,Se,ze,Ye,Le){return K.projection.name==="globe"?function(qe,Oe,We,Je,Ze,ht,Xe,nt,Tt,vt,_t){let et=[],Ct=[],Yt=qe.projection.upVectorScale(_t,qe.center.lat,qe.worldSize).metersToTile,Pt=[0,0,0,1],Qt=[0,0,0,1],Xt=(St,Gn,Un,In)=>{St[0]=Gn,St[1]=Un,St[2]=In,St[3]=1},sn=VM();We>0&&(We+=sn),Je+=sn;for(let St of Oe){let Gn=[],Un=[];for(let In of St){let mn=In.x+Ze.x,Dn=In.y+Ze.y,ti=qe.projection.projectTilePoint(mn,Dn,_t),Xn=qe.projection.upVector(_t,In.x,In.y),Ti=We,vi=Je;if(Xe){let Ar=$M(mn,Dn,We,Je,Xe,nt,Tt,vt);Ti+=Ar.base,vi+=Ar.top}We!==0?Xt(Pt,ti.x+Xn[0]*Yt*Ti,ti.y+Xn[1]*Yt*Ti,ti.z+Xn[2]*Yt*Ti):Xt(Pt,ti.x,ti.y,ti.z),Xt(Qt,ti.x+Xn[0]*Yt*vi,ti.y+Xn[1]*Yt*vi,ti.z+Xn[2]*Yt*vi),r._.transformMat4(Pt,Pt,ht),r._.transformMat4(Qt,Qt,ht),Gn.push(new rh(Pt[0],Pt[1],Pt[2])),Un.push(new rh(Qt[0],Qt[1],Qt[2]))}et.push(Gn),Ct.push(Un)}return[et,Ct]}(K,le,se,me,_e,Ee,ke,Se,ze,Ye,Le):ke?function(qe,Oe,We,Je,Ze,ht,Xe,nt,Tt){let vt=[],_t=[],et=[0,0,0,1];for(let Ct of qe){let Yt=[],Pt=[];for(let Qt of Ct){let Xt=Qt.x+Je.x,sn=Qt.y+Je.y,St=$M(Xt,sn,Oe,We,ht,Xe,nt,Tt);et[0]=Xt,et[1]=sn,et[2]=St.base,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Gn=new rh(et[0]/et[3],et[1]/et[3],et[2]/et[3]);et[0]=Xt,et[1]=sn,et[2]=St.top,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Un=new rh(et[0]/et[3],et[1]/et[3],et[2]/et[3]);Yt.push(Gn),Pt.push(Un)}vt.push(Yt),_t.push(Pt)}return[vt,_t]}(le,se,me,_e,Ee,ke,Se,ze,Ye):function(qe,Oe,We,Je,Ze){let ht=[],Xe=[],nt=Ze[8]*Oe,Tt=Ze[9]*Oe,vt=Ze[10]*Oe,_t=Ze[11]*Oe,et=Ze[8]*We,Ct=Ze[9]*We,Yt=Ze[10]*We,Pt=Ze[11]*We;for(let Qt of qe){let Xt=[],sn=[];for(let St of Qt){let Gn=St.x+Je.x,Un=St.y+Je.y,In=Ze[0]*Gn+Ze[4]*Un+Ze[12],mn=Ze[1]*Gn+Ze[5]*Un+Ze[13],Dn=Ze[2]*Gn+Ze[6]*Un+Ze[14],ti=Ze[3]*Gn+Ze[7]*Un+Ze[15],Xn=In+nt,Ti=mn+Tt,vi=Dn+vt,Ar=Math.max(ti+_t,1e-5),Si=In+et,ui=mn+Ct,ji=Dn+Yt,sr=Math.max(ti+Pt,1e-5);Xt.push(new rh(Xn/Ar,Ti/Ar,vi/Ar)),sn.push(new rh(Si/sr,ui/sr,ji/sr))}ht.push(Xt),Xe.push(sn)}return[ht,Xe]}(le,se,me,_e,Ee)}(d,a,D,T,b,p,z,S,k,d.center.lat,t.tileID.canonical),X=t.queryGeometry;return function(K,le,se){let me=1/0;RS(se,le)&&(me=UM(se,le[0]));for(let _e=0;_e<le.length;_e++){let Ee=le[_e],ke=K[_e];for(let Se=0;Se<Ee.length-1;Se++){let ze=Ee[Se],Ye=[ze,Ee[Se+1],ke[Se+1],ke[Se],ze];aw(se,Ye)&&(me=Math.min(me,UM(se,Ye)))}}return me!==1/0&&me}(j,Y,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends vr{constructor(t,e,i,a){super(t,D0,e,i,a),D0.layout&&(this.layout=new pn(D0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Hu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=ZA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new I0(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,i){let a=KM(this);return{config:new Ju(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(t){let e=t,i=YA(af("line-width",this,e),af("line-gap-width",this,e)),a=af("line-offset",this,e);return i/2+Math.abs(a)+c0(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,a,u,d){if(t.queryGeometry.isAboveHorizon)return!1;let p=FS(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*YA(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),y=this.paint.get("line-offset").evaluate(e,i);return y&&(a=function(b,T){let D=[],S=new lt(0,0);for(let R=0;R<b.length;R++){let k=b[R],F=[];for(let z=0;z<k.length;z++){let j=k[z],Y=k[z+1],X=z===0?S:j.sub(k[z-1])._unit()._perp(),K=z===k.length-1?S:Y.sub(j)._unit()._perp(),le=X._add(K)._unit();le._mult(1/(le.x*K.x+le.y*K.y)),F.push(le._mult(T)._add(j))}D.push(F)}return D}(a,y*t.pixelToTileUnitsFactor)),function(b,T,D){for(let S=0;S<T.length;S++){let R=T[S];if(b.length>=3){for(let k=0;k<R.length;k++)if(vc(b,R[k]))return!0}if(Bz(b,R,D))return!0}return!1}(p,a,_)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:q0,background:class extends vr{constructor(t,e,i,a){super(t,b5,e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}},raster:JA,"raster-particle":e2,sky:class extends vr{constructor(t,e,i,a){super(t,M5,e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),u=!a,d=t.style.light,p=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&ki("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Qw(p.azimuthal,90-p.polar,e):Qw(a[0],90-a[1],e)}let i=this.paint.get("sky-gradient-center");return Qw(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends vr{constructor(t,e,i,a){super(t,A5,e,null)}},model:class extends vr{constructor(t,e,i,a){super(t,B5,e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new eE(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof iv?rt-1:0}queryIntersectsFeature(t,e,i,a,u,d){if(!this.modelManager)return!1;let p=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof eE))return!1;let y=_;for(let b in y.instancesPerModel){let T=y.instancesPerModel[b],D=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(D)){let S=T.features[T.idToFeaturesIndex[D]],R=p.getModel(b,this.scope);if(!R)return!1;let k=r.ad.create(),F=new bn(0,0),z=y.canonical,j=Number.MAX_VALUE;for(let Y=0;Y<S.instancedDataCount;++Y){let X=16*(S.instancedDataOffset+Y),K=T.instancedDataArray.float32,le=[K[X+4],K[X+5],K[X+6]];I2(z,F,K[X],0|K[X+1]),u2(k,R,d,F,S.rotation,S.scale,le,!1,!1,!1),d.projection.name==="globe"&&(k=Jw(k,d));let se=r.ad.multiply([],d.projMatrix,k),me=t.queryGeometry,_e=s2(me.isPointQuery()?me.screenBounds:me.screenGeometry,d,se,R.aabb);_e!=null&&(j=Math.min(_e,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof G}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,a){let u=t.tile,d=u.getBucket(this),p=null,_=Number.MAX_VALUE;if(!(d&&d instanceof iv))return{queryFeature:p,intersectionZ:_};let y=d.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!i.filter(new $t(u.tileID.overscaledZ),y.feature,u.tileID.canonical))return{queryFeature:p,intersectionZ:_};let b=y.node,T=a.calculatePosMatrix(u.tileID.toUnwrapped(),a.worldSize),D=y.evaluatedScale,S=0;a.elevation&&b.elevation&&(S=b.elevation*a.elevation.exaggeration()),r.ad.translate(T,T,[(b.anchor?b.anchor[0]:0)*(D[0]-1),(b.anchor?b.anchor[1]:0)*(D[1]-1),S]),r.ad.scale(T,T,D),r.ad.multiply(T,T,b.matrix);let R=t.queryGeometry,k=R.isPointQuery()?R.screenBounds:R.screenGeometry,F=function(j){let Y=r.ad.multiply([],T,j.matrix),X=r.ad.multiply(Y,a.expandedFarZProjMatrix,Y);for(let K=0;K<j.meshes.length;++K){let le=j.meshes[K];if(K===j.lightMeshIndex)continue;let se=s2(k,a,X,le.aabb);se!=null&&(_=Math.min(se,_))}if(j.children)for(let K of j.children)F(K)};if(F(b),_===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:_};let z=new bn(0,0);return I2(u.tileID.canonical,z,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[z.lng,z.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:_}}},clip:class extends vr{constructor(t,e,i,a){super(t,yB,e,i,a)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new lM(t)}isTileClipped(){return!0}is3D(){return!0}}};J(HA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let D2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uE{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);let d=D2[15&a];if(!d)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new uE(_,p,d,e)}constructor(e,i=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let d=D2.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return hE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:p,nodeSize:_}=this,y=[0,d.length-1,0],b=[];for(;y.length;){let T=y.pop()||0,D=y.pop()||0,S=y.pop()||0;if(D-S<=_){for(let z=S;z<=D;z++){let j=p[2*z],Y=p[2*z+1];j>=e&&j<=a&&Y>=i&&Y<=u&&b.push(d[z])}continue}let R=S+D>>1,k=p[2*R],F=p[2*R+1];k>=e&&k<=a&&F>=i&&F<=u&&b.push(d[R]),(T===0?e<=k:i<=F)&&(y.push(S),y.push(R-1),y.push(1-T)),(T===0?a>=k:u>=F)&&(y.push(R+1),y.push(D),y.push(1-T))}return b}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:d,nodeSize:p}=this,_=[0,u.length-1,0],y=[],b=a*a;for(;_.length;){let T=_.pop()||0,D=_.pop()||0,S=_.pop()||0;if(D-S<=p){for(let z=S;z<=D;z++)M2(d[2*z],d[2*z+1],e,i)<=b&&y.push(u[z]);continue}let R=S+D>>1,k=d[2*R],F=d[2*R+1];M2(k,F,e,i)<=b&&y.push(u[R]),(T===0?e-a<=k:i-a<=F)&&(_.push(S),_.push(R-1),_.push(1-T)),(T===0?e+a>=k:i+a>=F)&&(_.push(R+1),_.push(D),_.push(1-T))}return y}}function hE(t,e,i,a,u,d){if(u-a<=i)return;let p=a+u>>1;S2(t,e,p,a,u,d),hE(t,e,i,a,p-1,1-d),hE(t,e,i,p+1,u,1-d)}function S2(t,e,i,a,u,d){for(;u>a;){if(u-a>600){let b=u-a+1,T=i-a+1,D=Math.log(b),S=.5*Math.exp(2*D/3),R=.5*Math.sqrt(D*S*(b-S)/b)*(T-b/2<0?-1:1);S2(t,e,i,Math.max(a,Math.floor(i-T*S/b+R)),Math.min(u,Math.floor(i+(b-T)*S/b+R)),d)}let p=e[2*i+d],_=a,y=u;for(Eg(t,e,a,i),e[2*u+d]>p&&Eg(t,e,a,u);_<y;){for(Eg(t,e,_,y),_++,y--;e[2*_+d]<p;)_++;for(;e[2*y+d]>p;)y--}e[2*a+d]===p?Eg(t,e,a,y):(y++,Eg(t,e,y,u)),y<=i&&(a=y+1),i<=y&&(u=y-1)}}function Eg(t,e,i,a){dE(t,i,a),dE(e,2*i,2*a),dE(e,2*i+1,2*a+1)}function dE(t,e,i){let a=t[e];t[e]=t[i],t[i]=a}function M2(t,e,i,a){let u=t-i,d=e-a;return u*u+d*d}r.$=ja,r.A=Uu,r.B=aa,r.C=En,r.D=Dr,r.E=Wa,r.G=Zi,r.H=h,r.I=YV,r.J=P1,r.K=function(t){let e=t.value,i=[];if(!e)return i;let a=Ya(e);return a!=="string"?(i=i.concat([new K0(t.key,e,`string expected, "${a}" found`)]),i):(a2(e,!0)||(i=i.concat([new K0(t.key,e,`invalid url "${e}"`)])),i)},r.L=Te,r.M=class{constructor(t,e,i,a){this.id=t,this.position=e!=null?new bn(e[0],e[1]):new bn(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let i of t.meshes){let a=yi.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){let t=r.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,a,u,d,p=!1){u2(this.matrix,this,t.transform,this.position,e,i,a,u,d,p)}upload(t){if(!this.uploaded){for(let e of this.nodes)tE(e,t);for(let e of this.nodes)Q0(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)nE(t)}},r.N=On,r.O=Be,r.P=lt,r.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return gs(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Dt(t.x,e.x,i),y:Dt(t.y,e.y,i),z:Dt(t.z,e.z,i),azimuthal:Dt(t.azimuthal,e.azimuthal,i),polar:Dt(t.polar,e.polar,i)}}},r.R=Dd,r.S=H1,r.T=rs,r.U=Ln,r.V=K0,r.W=gr,r.X=$t,r.Y=Mr,r.Z=G,r.a=yo,r.a$=function(t){let{x:e,y:i}=t.point,{lng:a,lat:u}=t._center;return ZS(e,i,t.worldSize,a,u)},r.a0=pn,r.a1=cl,r.a2=Dt,r.a3=rt,r.a4=xy,r.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,a]){let u=gs([1,i,a]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Dt(t.x,e.x,i),y:Dt(t.y,e.y,i),z:Dt(t.z,e.z,i)}}},r.a6=Gm,r.a7=o0,r.a8=ol,r.a9=wS,r.aB=function(t,e){let{x:i,y:a}=t.point,u=ZS(i,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.ad.multiply(u,u,gw(da(e)))},r.aD=pf,r.aE=Fo,r.aF=A0,r.aG=function(t,e,i,a,u){let d=5*e+2;t.float32[d+0]=i,t.float32[d+1]=a,t.float32[d+2]=u},r.aH=j0,r.aI=bn,r.aJ=FA,r.aK=IS,r.aL=Gi,r.aM=fw,r.aN=n2,r.aO=th,r.aP=HS,r.aQ=function(t,e,i,a,u,d,p,_,y){if(y.name==="globe")return HS(t,e,new th(i,a,u),!1);let b=oh({z:i,x:a,y:u},y);return new yi([(d+b.x/b.scale)*e,e*(b.y/b.scale),p],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},r.aR=function(t,e,i){let a=0;for(let u=0;u<2;++u)t[u]>0&&(a+=(t[u]-0)*(t[u]-0)),e[u]<0&&(a+=(0-e[u])*(0-e[u]));return a},r.aS=Li,r.aT=hw,r.aU=TS,r.aV=function(t){let e=r.ad.identity(new Float64Array(16));r.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let i=[0,ns,0],a=[0,is,0];return r._.transformMat4(i,i,e),r._.transformMat4(a,a,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!yw(t,new bn(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!yw(t,new bn(t.center.lat,-90))]},r.aW=function(t,e){let{scale:i}=t.tileTransform,a=i*rt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.aX=Y0,r.aY=t2,r.aZ=function(t){let e=t2(t,!0);return r.aC.invert([],[e[0],e[1],e[4],e[5]])},r.a_=dw,r.aa=Wr,r.ab=dn,r.ac=function(t,e,i){let a=Math.sqrt(t*t+e*e+i*i),u=a>0?Math.acos(i/a)*mu:0,d=t!==0||e!==0?Math.atan2(-e,-t)*mu+90:0;return d<0&&(d+=360),[a,d,u]},r.ae=vf,r.af=Ss,r.ag=jw,r.ah=function(t,e){let i={};for(let a=0;a<e.length;a++){let u=e[a];u in t&&(i[u]=t[u])}return i},r.ai=yc,r.aj=ua,r.ak=ha,r.al=Qd,r.am=function(t){Cd++,Cd>em&&(t.getActor().send("enforceCacheSizeLimit",Jp),Cd=0)},r.an=lm,r.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,a){let u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){let[d,p]=u.result;return this.scheduler?this.scheduler.add(()=>{a(d,p)},e):a(d,p),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=i((d,p)=>{u.result=[d,p];for(let _ of u.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,p)},e):_(d,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(d=>d!==a),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}},r.ap=function(t,e,i){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{let d=Ha(t.request,(p,_,y,b)=>{p?u(p):_&&u(null,{vectorTile:i?void 0:new Cw(new ff(_)),rawData:_,cacheControl:y,expires:b})});return()=>{d.cancel(),u()}},e)},r.aq=Y1,r.ar=class extends rl{constructor(t){super(t),this.current=Cz}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.as=X1,r.at=tn,r.au=Ua,r.aw=xu,r.ax=Yr,r.ay=or,r.az=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.b=_i,r.b$=wc,r.b0=mr,r.b1=J1,r.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return ay[e]},r.b3=45,r.b4=nw,r.b5=s0,r.b6=yi,r.b7=gs,r.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.b9=Hp,r.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bB=ZM,r.bD=WS,r.bE=wd,r.bF=bd,r.bG=256,r.bH=function(t,e){let i=[0,0,0],a=Xm(da(e.canonical));return r._.transformMat4(i,i,a),r._.transformMat4(i,i,t),i},r.bI=t=>({u_camera_to_center_distance:new Wr(t),u_extrude_scale:new K1(t),u_device_pixel_ratio:new Wr(t),u_matrix:new Gm(t),u_inv_rot_matrix:new Gm(t),u_merc_center:new ol(t),u_tile_id:new Y1(t),u_zoom_transition:new Wr(t),u_up_dir:new Y1(t),u_emissive_strength:new Wr(t)}),r.bJ=t=>({u_matrix:new Gm(t),u_pixels_to_tile_units:new K1(t),u_device_pixel_ratio:new Wr(t),u_units_to_pixels:new ol(t),u_dash_image:new o0(t),u_gradient_image:new o0(t),u_image_height:new Wr(t),u_texsize:new ol(t),u_tile_units_to_pixels:new Wr(t),u_alpha_discard_threshold:new Wr(t),u_trim_offset:new ol(t),u_trim_fade_range:new ol(t),u_trim_color:new X1(t),u_emissive_strength:new Wr(t)}),r.bK=t=>({u_matrix:new Gm(t),u_texsize:new ol(t),u_pixels_to_tile_units:new K1(t),u_device_pixel_ratio:new Wr(t),u_image:new o0(t),u_units_to_pixels:new ol(t),u_tile_units_to_pixels:new Wr(t),u_alpha_discard_threshold:new Wr(t),u_trim_offset:new ol(t)}),r.bL=z1,r.bM=oV,r.bN=xr,r.bO=EV,r.bP=DA,r.bQ=Ow,r.bR=KS,r.bS=(t,e,i,a,u,d)=>{let p=t.transform,_=p.projection.name==="globe",y;if(d.paint.get("circle-pitch-alignment")==="map")if(_){let T=WS(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=p.calculatePixelsToTileUnitsMatrix(i);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ir.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:Yz,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){b.u_inv_rot_matrix=a,b.u_merc_center=u,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=cl(p.zoom);let T=u[0]*rt,D=u[1]*rt;b.u_up_dir=p.projection.upVector(new th(0,0,0),T,D)}return b},r.bT=KM,r.bU=(t,e,i,a,u,d)=>{let p=t.transform;return{u_matrix:XM(t,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:YM(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},r.bV=(t,e,i,a,u,d,p)=>{let _=t.transform,y=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:XM(t,e,i,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:QM(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:YM(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength")}},r.bW=qp,r.bX=Km,r.bY=VM,r.bZ=kz,r.b_=C0,r.ba=function(t,e,i){let a=cl(i.zoom),u=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!u&&!d},r.bb=function(t){let e=t.pixelsPerMeter,i=e/Yr(1,t.center.lat),a=r.ad.identity(new Float64Array(16));return r.ad.translate(a,a,[t.point.x,t.point.y,0]),r.ad.scale(a,a,[i,i,e]),Float32Array.from(a)},r.bc=d0,r.bd=function(t){let e=Li-5;t=tn(t,-e,e)/e*90;let i=Math.pow(Math.abs(Math.sin(dn(t))),3);return Math.round(i*(ew.length-1))},r.be=function(t,e,i,a){let u=e.getNorth(),d=e.getSouth(),p=e.getWest(),_=e.getEast(),y=1<<t.z,b=_-p,T=u-d,D=b/nf,S=-T/ew[i],R=[0,D,0,S,0,0,u,p,0];if(t.z>0){let k=180/a;r.bC.multiply(R,R,[k/b+1,0,0,0,k/T+1,0,-.5*k/D,.5*k/S,1])}return R[2]=y,R[5]=t.x,R[8]=t.y,R},r.bf=Xm,r.bg=da,r.bh=function(t,e,i){let a=r.ad.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return r.ad.rotateY(a,i.globeMatrix,u),Float32Array.from(a)},r.bi=Hl,r.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.bk=JA,r.bl=e2,r.bm=QA,r.bn=function(t,e){let i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<t.length;a++){let u=document.createElement("source");dy(t[a])||(i.crossOrigin="Anonymous"),u.src=t[a],i.appendChild(u)}return{cancel:()=>{}}},r.bo=U0,r.bp=yd,r.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let i=e.getSource().maxzoom,a=1<<i,u=Math.floor(t.x),d=Math.floor((t.x-u)*a),p=Math.floor(t.y*a),_=this.findDEMTileFor(new Gi(i,u,i,d,p));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let u=a.getSource().maxzoom,d=1<<u,p=Math.floor(t.x),_=t.x-p,y=new Gi(u,p,u,Math.floor(_*d),Math.floor(t.y*d)),b=this.findDEMTileFor(y);if(!b||!b.dem)return e;let T=b.dem,D=1<<b.tileID.canonical.z,S=(_*D-b.tileID.canonical.x)*T.dim,R=(t.y*D-b.tileID.canonical.y)*T.dim,k=Math.floor(S),F=Math.floor(R);return(i?this.exaggeration():1)*Dt(Dt(T.get(k,F),T.get(k,F+1),R-F),Dt(T.get(k+1,F),T.get(k+1,F+1),R-F),S-k)}getAtTileOffset(t,e,i){let a=1<<t.canonical.z;return this.getAtPointOrZero(new Mr(t.wrap+(t.canonical.x+e/rt)/a,(t.canonical.y+i/rt)/a))}getAtTileOffsetFunc(t,e,i,a){return u=>{let d=this.getAtTileOffset(t,u.x,u.y),p=a.upVector(t.canonical,u.x,u.y),_=a.upVectorScale(t.canonical,e,i).metersToTile;return r._.scale(p,p,d*_),p}}getForTilePoints(t,e,i,a){if(this.isUsingMockSource())return!1;let u=uf.create(this,t,a);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let i=e.dem.tree,a=e.tileID,u=1<<t.canonical.z-a.canonical.z,d=t.canonical.x/u-a.canonical.x,p=t.canonical.y/u-a.canonical.y,_=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!i.leaves[_];y++){d*=2,p*=2;let b=2*Math.floor(p)+Math.floor(d);_=i.childOffsets[_]+b,d%=1,p%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let u of t){let d=this.getMinMaxForTile(u.tileID);d&&(i=Math.min(i,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:i,max:a}:null}},r.br=Zm,r.bs=h0,r.bt=Es,r.bu=Ki,r.bv=sh,r.bw=iE,r.bx=J0,r.by=H0,r.bz=iM,r.c=b2,r.c$=wu,r.c0=450,r.c1=7,r.c2=T5,r.c3=qA,r.c4=256,r.c5=$S,r.c6=gw,r.c7=An,r.c8=fc,r.c9=Qu,r.cA=function(t){let e=1/0,i=1/0,a=-1/0,u=-1/0;for(let d of t)e=Math.min(e,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),u=Math.max(u,d.y);return{min:new lt(e,i),max:new lt(a,u)}},r.cB=vc,r.cC=AS,r.cD=Zr,r.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.cF=xA,r.cG=aw,r.cH=vM,r.cI=xM,r.cJ=zw,r.cK=uE,r.cL=function(t){return t({pluginStatus:He,pluginURL:st}),Wt.on("pluginStateChange",t),t},r.cM=gf,r.cN=Fw,r.cO=Sd,r.cP=pt,r.cQ=U,r.cR=Qp,r.cS=Xl,r.cT=Xo,r.cU=function(t){let e=t.indexOf(uc);return e>=0?t.slice(0,e):t},r.cV=function(t){return t.indexOf(uc)>=0},r.cW=function(t){let e=t.indexOf(uc);return e>=0?t.slice(e+1):""},r.cX=function(t){let e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cY=function(t,e,i,a){return t.type==="custom"?new D5(t,e):new i4[t.type](t,e,i,a)},r.cZ=$a,r.c_=Wt,r.ca=1,r.cb=fg,r.cc=0,r.cd=U1,r.ce=function(t,e,i,a,u){return tn((t-e)/(i-e)*(u-a)+a,a,u)},r.cf=qy,r.cg=nh,r.ch=class{constructor(t,e,i,a){this.context=t,this.format=a,this.size=i,this.texture=t.gl.createTexture();let[u,d,p]=this.size,{gl:_}=t;_.bindTexture(_.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,b=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,b=_.UNSIGNED_SHORT),this.format===_.R8&&(a=_.RED),this.format===_.R32F&&(b=_.FLOAT,a=_.RED),_.texImage3D(_.TEXTURE_3D,0,y,u,d,p,0,a,b,e.data)}bind(t,e){let{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},r.ci=Jw,r.cj=[1,1,1],r.ck=uf,r.cl=Ef,r.cm=mc,r.cn=ef,r.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new lt(1/0,1/0),max:new lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let i=gM(new lt(0,0),new lt(rt,rt),t),a=[];if(e&&!Iw(i,this._globalClipBounds))return a;for(let u of this._activeRegions){if(u.hiddenByOverlap||!Iw(i,u))continue;let d=RB(u.min,u.max,t);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask})}return a}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let i=[];for(let a of e.cache.getVisibleCoordinates()){let u=e.cache.getTile(a).buckets[e.layer];u&&u.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let i=t.getOrder(),a=t.getClipMask();for(let u of e){if(!u.footprint)continue;let d=gM(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:i,clipMask:a})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||w0(e.min,i.min)||w0(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let i=this._activeRegions[e],a=this._prevRegions[e];t=i.priority!==a.priority||!mM(i,a)||i.order!==a.order||i.clipMask!==a.clipMask,++e}}if(t){++this._updateTime;for(let i of this._activeRegions)i.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));let e=i=>{let a=this._activeRegions;if(i>=a.length)return i;let u=a[i].priority;for(;i<a.length&&a[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let u=i,d=i;for(;u!==a;){let p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let _=0;_<d;_++){let y=this._activeRegions[_];if(!y.hiddenByOverlap&&p.order===1/0&&Iw(p,y)&&(p.hiddenByOverlap=yM(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++u}i=a,a=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cp=hc,r.cq=G0,r.cr=Um,r.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let i=new Es,a=new Ki,u=[],d=t+1+2,p=e[0]+1,_=e[0]+1+(1+e.length),y=(b,T,D)=>{let S=b===d-1?b-2:b===0?b:b-1;return S+=D?24575:0,[S,T]};for(let b=0;b<d;++b)i.emplaceBack(...y(b,0,!0));for(let b=0;b<p;++b)for(let T=0;T<d;++T)i.emplaceBack(...y(T,b,(T===0||T===d-1)&&!0));for(let b=0;b<e.length;++b){let T=e[b];for(let D=0;D<d;++D)i.emplaceBack(...y(D,T,!0))}for(let b=0;b<e.length;++b){let T=a.length,D=e[b]+1+2,S=new Ki;for(let F=0;F<D-1;F++){let z=F===D-2,j=z?d*(_-e.length+b-F):d;for(let Y=0;Y<d-1;Y++){let X=F*d+Y;F===0||z||Y===0||Y===d-2?(S.emplaceBack(X+1,X,X+j),S.emplaceBack(X+j,X+j+1,X+1)):(a.emplaceBack(X+1,X,X+j),a.emplaceBack(X+j,X+j+1,X+1))}}let R=_i.simpleSegment(0,T,i.length,a.length-T);for(let F=0;F<S.uint16.length;F+=3)a.emplaceBack(S.uint16[F],S.uint16[F+1],S.uint16[F+2]);let k=_i.simpleSegment(0,T,i.length,a.length-T);u.push({withoutSkirts:R,withSkirts:k})}return{vertices:i,indices:a,segments:u}}_createGrid(t){let e=this._fillGridMeshWithLods(nf,ew);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Zm.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Ki;for(let p=0;p<=nf;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let i=new Qu,a=new Qu,u=new Qu,d=new Qu;this._poleSegments=[];for(let p=0,_=0;p<J1;p++){let y=360/(1<<p);i.emplaceBack(0,-Zr,0,.5,0),a.emplaceBack(0,-Zr,0,.5,1),u.emplaceBack(0,-Zr,0,.5,.5),d.emplaceBack(0,-Zr,0,.5,.5);for(let b=0;b<=nf;b++){let T=b/nf,D=0,S=Dt(0,y,T),[R,k,F]=rf(Wz,Zz,S,Zr);i.emplaceBack(R,k,F,T,D),a.emplaceBack(R,k,F,T,1-D);let z=dn(S);T=.5+.5*Math.sin(z),D=.5+.5*Math.cos(z),u.emplaceBack(R,k,F,T,D),d.emplaceBack(R,k,F,T,1-D)}this._poleSegments.push(_i.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,u0,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,u0,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,u0,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,u0,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.ct=function(t){return Du.has(t)},r.cu=SM,r.cv=function(t,e,i=0,a=!0){let u=new lt(i,i),d=t.sub(u),p=e.add(u),_=[d,new lt(p.x,d.y),p,new lt(d.x,p.y)];return a&&_.push(d.clone()),_},r.cw=function(t,e){let i=[];for(let a=0;a<t.length;a++){let u=Ua(a-1,-1,t.length-1),d=Ua(a+1,-1,t.length-1),p=t[a],_=t[d],y=t[u].sub(p).unit(),b=_.sub(p).unit(),T=b.angleWithSep(y.x,y.y),D=y.add(b).unit().mult(-1*e/Math.sin(T/2));i.push(p.add(D))}return i},r.cx=PA,r.cy=LS,r.cz=function(t,e,i=0){return r._.fromValues(((e.x-i)*t.scale-t.x)*rt,(e.y*t.scale-t.y)*rt,DS(e.z,e.y))},r.d=Rd,r.d$=md,r.d0=gu,r.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d2=jl,r.d3=MS,r.d4=eh,r.d5=function([t,e,i]){let a=Math.hypot(t,e,i),u=Math.atan2(t,i),d=.5*Math.PI-Math.acos(-e/a);return new bn(mr(u),mr(d))},r.d6=no,r.d7=of,r.d8=A,r.d9=yw,r.dA=function(t){let e=uy();if(!e)return;let i=e.delete(cy);t&&i.catch(t).then(()=>t())},r.dB=yg,r.dC=d2,r.dD=function(t){oE=ir.resolveURL(t),Cf||(Cf=new iE(J0(),new Wa)),Cf.broadcast("setDracoUrl",oE)},r.dE=f2,r.dF=function(t){Tf=ir.resolveURL(t),Cf||(Cf=new iE(J0(),new Wa)),Cf.broadcast("setMeshoptUrl",Tf)},r.dG=fo,r.dH=J,r.dI=xc,r.dJ=Ds,r.dK=oh,r.dL=W1,r.dM=JM,r.dN=sA,r.dO=qM,r.dP=$l,r.dQ=wA,r.dR=xf,r.dS=function(t,e,i,a,u,d,p,_,y,b,T){t.createArrays(),t.tilePixelRatio=rt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let D=t.layers[0].layout,S=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:Y}=t.textSizeData;R.compositeTextSizes=[S["text-size"].possiblyEvaluate(new $t(j),_),S["text-size"].possiblyEvaluate(new $t(Y),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:Y}=t.iconSizeData;R.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new $t(j),_),S["icon-size"].possiblyEvaluate(new $t(Y),_)]}R.layoutTextSize=S["text-size"].possiblyEvaluate(new $t(y+1),_),R.layoutIconSize=S["icon-size"].possiblyEvaluate(new $t(y+1),_),R.textMaxSize=S["text-size"].possiblyEvaluate(new $t(18),_);let k=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",F=D.get("text-size"),z=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){z=!0;break}for(let j of t.features){let Y=D.get("text-font").evaluate(j,{},_).join(","),X=F.evaluate(j,{},_),K=R.layoutTextSize.evaluate(j,{},_),le=(R.layoutIconSize.evaluate(j,{},_),{horizontal:{},vertical:void 0}),se=j.text,me,_e=[0,0];if(se){let Se=se.toString(),ze=D.get("text-letter-spacing").evaluate(j,{},_)*xr,Ye=D.get("text-line-height").evaluate(j,{},_)*xr,Le=Me(Se)?ze:0,qe=D.get("text-anchor").evaluate(j,{},_),Oe=D.get("text-variable-anchor");if(!Oe){let Xe=D.get("text-radial-offset").evaluate(j,{},_);_e=Xe?DA(qe,[Xe*xr,Nw]):D.get("text-offset").evaluate(j,{},_).map(nt=>nt*xr)}let We=k?"center":D.get("text-justify").evaluate(j,{},_),Je=D.get("symbol-placement")==="point",Ze=Je?D.get("text-max-width").evaluate(j,{},_)*xr:1/0,ht=Xe=>{t.allowVerticalPlacement&&Ie(Se)&&(le.vertical=kw(se,e,i,u,Y,Ze,Ye,qe,Xe,Le,_e,Fo.vertical,!0,K,X))};if(!k&&Oe){let Xe=We==="auto"?Oe.map(Tt=>zw(Tt)):[We],nt=!1;for(let Tt=0;Tt<Xe.length;Tt++){let vt=Xe[Tt];if(!le.horizontal[vt])if(nt)le.horizontal[vt]=le.horizontal[0];else{let _t=kw(se,e,i,u,Y,Ze,Ye,"center",vt,Le,_e,Fo.horizontal,!1,K,X);_t&&(le.horizontal[vt]=_t,nt=_t.positionedLines.length===1)}}ht("left")}else{if(We==="auto"&&(We=zw(qe)),Je||D.get("text-writing-mode").indexOf("horizontal")>=0||!Ie(Se)){let Xe=kw(se,e,i,u,Y,Ze,Ye,qe,We,Le,_e,Fo.horizontal,!1,K,X);Xe&&(le.horizontal[We]=Xe)}ht(Je?"left":We)}}let Ee=!1;if(j.icon&&j.icon.namePrimary){let Se=a[j.icon.namePrimary];Se&&(me=RV(u[j.icon.namePrimary],j.icon.nameSecondary?u[j.icon.nameSecondary]:void 0,D.get("icon-offset").evaluate(j,{},_),D.get("icon-anchor").evaluate(j,{},_)),Ee=Se.sdf,t.sdfIcons===void 0?t.sdfIcons=Se.sdf:t.sdfIcons!==Se.sdf&&ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==t.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let ke=MA(le.horizontal)||le.vertical;t.iconsInText||(t.iconsInText=!!ke&&ke.iconsInText),(ke||me)&&BV(t,j,le,me,a,R,K,0,_e,Ee,p,_,b,T,z)}d&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dT=I0,r.dU=y0,r.dV=Cw,r.dW=ff,r.dX=E0,r.dY=Yw,r.dZ=x0,r.d_=v0,r.da=YS,r.db=function(t){let e=[0,0,0],i=r.ad.identity(new Float64Array(16));return r.ad.multiply(i,t.pixelMatrix,t.globeMatrix),r._.transformMat4(e,e,i),new lt(e[0],e[1])},r.dc=De,r.dd=be,r.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(xd==null){let a=i.navigator?i.navigator.userAgent:null;xd=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return xd}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.df=gd,r.dg=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",sm,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!U(t))return t;let i=Mo(t);return i.params.push(`sdk=js-${w}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!U(t))return t;let i=Mo(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!U(t))return t;let i=Mo(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,a){if(!U(t))return t;let u=Mo(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,a){let u=Mo(t);return U(t)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${i}`,Zl(u))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!U(t))return t;let a=Mo(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&a.authority!=="raster"&&i===512?"@2x":""}${Id.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${A.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${A.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${A.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${A.TILE_URL_VERSION}${a.path}`);let u=this._customAccessToken||function(d){for(let p of d){let _=p.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(a.params)||A.ACCESS_TOKEN;return A.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(t,e){let i=Mo(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${A.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${i.path.replace(`/${A.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${A.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(t,e){let i=!!e&&U(e),a=[];for(let u of t.tiles||[])L(u)?a.push(this.canonicalizeTileURL(u,i)):a.push(u);return a}_makeAPIURL(t,e){let i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Mo(A.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!A.REQUIRE_ACCESS_TOKEN)return Zl(t);if(e=e||A.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Zl(t)}},r.dh=function(t,e){e?Du.add(t):Du.delete(t)},r.di=Id,r.dj=p1,r.dk=Pd,r.dl=am,r.dm=my,r.dn=f1,r.dp=function(t){Du.delete(t)},r.dq=Yl,r.dr=Iu,r.ds=Ul,r.dt=w,r.du=function(t,e){Jp=t,em=e},r.dv=function(t,e,i=!1){if(He===ot||He===ct||He===at)throw new Error("setRTLTextPlugin cannot be called multiple times.");st=ir.resolveURL(t),He=ot,je=e,Lt(),i||cn()},r.dw=fn,r.dx=function(){J0().acquire(rE)},r.dy=function(){let t=xg;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(rE),xg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dz=vg,r.e=ir,r.e0=eA,r.e1=Fe,r.e2=Ha,r.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==m2){let i=new Uint32Array(t,0,7),[,,a,u,d,p]=i;e=i.byteLength+u+d+p+d,(a!==t.byteLength||e>=t.byteLength)&&ki("Invalid b3dm header information.")}return v2(t,e)},r.e4=function(t,e){let i=b2(t);for(let a of i){for(let u of a.meshes)J5(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(e4(a.lights,e)))}return i},r.e5=iv,r.e6=h2,r.e7=kn,r.e8=function(t){bu(),ys&&ys.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-t;a++)e.delete(i[a])})})},r.f=kr,r.g=function(t,e){return wu(gr(t,{type:"json"}),e)},r.h=ea,r.i=Lo,r.j=bA,r.k=Lw,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>v2(e,0,t))},r.m=class extends K0{},r.n=Ya,r.o=dm,r.p=JV,r.q=Kd,r.r=m,r.s=s,r.t=N,r.u=Nr,r.v=yr,r.w=ki,r.x=H,r.y=B,r.z=jd}),c(["./shared"],function(r){function w(ye){let $=ye?ye.url.toString():void 0;return $?performance.getEntriesByName($):[]}function I(ye){if(typeof ye=="number"||typeof ye=="boolean"||typeof ye=="string"||ye==null)return JSON.stringify(ye);if(Array.isArray(ye)){let Z="[";for(let oe of ye)Z+=`${I(oe)},`;return`${Z}]`}let $="{";for(let Z of Object.keys(ye).sort())$+=`${Z}:${I(ye[Z])},`;return`${$}}`}function A(ye){let $="";for(let Z of r.cE)$+=`/${I(ye[Z])}`;return $}class L{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,Z){this._layerConfigs={},this._layers={},this.update($,[],Z)}update($,Z,oe){this._options=oe;for(let pe of $)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=r.cY(pe,this.scope,null,this._options)).compileFilter(),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(let pe of Z)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};let de=function(pe,we){let Ae={};for(let Pe=0;Pe<pe.length;Pe++){let it=we&&we[pe[Pe].id]||A(pe[Pe]);we&&(we[pe[Pe].id]=it);let Qe=Ae[it];Qe||(Qe=Ae[it]=[]),Qe.push(pe[Pe])}let ve=[];for(let Pe in Ae)ve.push(Ae[Pe]);return ve}(r.dG(this._layerConfigs),this.keyCache);for(let pe of de){let we=pe.map(yt=>this._layers[yt.id]),Ae=we[0];if(Ae.visibility==="none")continue;let ve=Ae.source||"",Pe=this.familiesBySource[ve];Pe||(Pe=this.familiesBySource[ve]={});let it=Ae.sourceLayer||"_geojsonTileLayer",Qe=Pe[it];Qe||(Qe=Pe[it]=[]),Qe.push(we)}}}let U=1*r.dJ;class Q{constructor($){let Z={},oe=[];for(let Ae in $){let ve=$[Ae],Pe=Z[Ae]={};for(let it in ve.glyphs){let Qe=ve.glyphs[+it];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;let yt=Qe.metrics.localGlyph?U:1,Mt={x:0,y:0,w:Qe.bitmap.width+2*yt,h:Qe.bitmap.height+2*yt};oe.push(Mt),Pe[it]=Mt}}let{w:de,h:pe}=r.j(oe),we=new r.dI({width:de||1,height:pe||1});for(let Ae in $){let ve=$[Ae];for(let Pe in ve.glyphs){let it=ve.glyphs[+Pe];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;let Qe=Z[Ae][Pe],yt=it.metrics.localGlyph?U:1;r.dI.copy(it.bitmap,we,{x:0,y:0},{x:Qe.x+yt,y:Qe.y+yt},it.bitmap)}}this.image=we,this.positions=Z}}r.dH(Q,"GlyphAtlas");class fe{constructor($){this.tileID=new r.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.lut=$.lut,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.scope=$.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.promoteId=$.promoteId,this.isSymbolTile=$.isSymbolTile,this.tileTransform=r.dK($.tileID.canonical,$.projection),this.projection=$.projection,this.brightness=$.brightness,this.extraShadowCaster=!!$.extraShadowCaster,this.tessellationStep=$.tessellationStep}parse($,Z,oe,de,pe){this.status="parsing",this.data=$,this.collisionBoxArray=new r.dL;let we=new r.dM(Object.keys($.layers).sort()),Ae=new r.dN(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];let ve={},Pe=new r.dO(256,256),it={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Pe,availableImages:oe,brightness:this.brightness},Qe=Z.familiesBySource[this.source];for(let mt in Qe){let si=$.layers[mt];if(!si)continue;let zn=!1,gn=!1,Ri=!1;for(let fr of Qe[mt])fr[0].type==="symbol"?zn=!0:gn=!0,fr[0].is3D()&&fr[0].type!=="model"&&(Ri=!0);if(this.extraShadowCaster&&!Ri||this.isSymbolTile===!0&&!zn||this.isSymbolTile===!1&&!gn)continue;si.version===1&&r.w(`Vector tile source "${this.source}" layer "${mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ai=we.encode(mt),Bi=[];for(let fr=0;fr<si.length;fr++){let pr=si.feature(fr),Ba=Ae.getId(pr,mt);Bi.push({feature:pr,id:Ba,index:fr,sourceLayerIndex:ai})}for(let fr of Qe[mt]){let pr=fr[0];(!this.extraShadowCaster||pr.is3D()&&pr.type!=="model")&&(this.isSymbolTile!==void 0&&pr.type==="symbol"!==this.isSymbolTile||pr.minzoom&&this.zoom<Math.floor(pr.minzoom)||pr.maxzoom&&this.zoom>=pr.maxzoom||pr.visibility!=="none"&&(he(fr,this.zoom,it.brightness,oe),(ve[pr.id]=pr.createBucket({index:Ae.bucketLayerIDs.length,layers:fr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ai,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Bi,it,this.tileID.canonical,this.tileTransform),Ae.bucketLayerIDs.push(fr.map(Ba=>Ba.id))))}}let yt,Mt,en,rn;Pe.trim();let Ht={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},hn=()=>{if(yt)return this.status="done",pe(yt);if(this.extraShadowCaster)this.status="done",pe(null,{buckets:r.dG(ve).filter(mt=>!mt.isEmpty()),featureIndex:Ae,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:it.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mt&&en&&rn){let mt=new Q(Mt),si=new r.dQ(en,rn,this.lut);for(let zn in ve){let gn=ve[zn];gn instanceof r.dR?(he(gn.layers,this.zoom,it.brightness,oe),r.dS(gn,Mt,mt.positions,en,si.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):gn.hasPattern&&(gn instanceof r.dT||gn instanceof r.dU||gn instanceof r.b_)&&(he(gn.layers,this.zoom,it.brightness,oe),gn.addFeatures(it,this.tileID.canonical,si.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",pe(null,{buckets:r.dG(ve).filter(zn=>!zn.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mt.image,lineAtlas:Pe,imageAtlas:si,brightness:it.brightness})}};if(!this.extraShadowCaster){let mt=r.dP(it.glyphDependencies,gn=>Object.keys(gn).map(Number));Object.keys(mt).length?de.send("getGlyphs",{uid:this.uid,stacks:mt,scope:this.scope},(gn,Ri)=>{yt||(yt=gn,Mt=Ri,hn())},void 0,!1,Ht):Mt={};let si=Object.keys(it.iconDependencies);si.length?de.send("getImages",{icons:si,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(gn,Ri)=>{yt||(yt=gn,en=Ri,hn())},void 0,!1,Ht):en={};let zn=Object.keys(it.patternDependencies);zn.length?de.send("getImages",{icons:zn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(gn,Ri)=>{yt||(yt=gn,rn=Ri,hn())},void 0,!1,Ht):rn={}}hn()}}function he(ye,$,Z,oe){let de=new r.X($,{brightness:Z});for(let pe of ye)pe.recalculate(de,oe)}class be extends r.E{constructor($,Z,oe,de,pe,we){super(),this.actor=$,this.layerIndex=Z,this.availableImages=oe,this.loadVectorData=pe||r.ap,this.loading={},this.loaded={},this.deduped=new r.ao($.scheduler),this.isSpriteLoaded=de,this.scheduler=$.scheduler,this.brightness=we}loadTile($,Z){let oe=$.uid,de=$&&$.request,pe=de&&de.collectResourceTiming,we=this.loading[oe]=new fe($);we.abort=this.loadVectorData($,(Ae,ve)=>{let Pe=!this.loading[oe];if(delete this.loading[oe],Pe||Ae||!ve)return we.status="done",Pe||(this.loaded[oe]=we),Z(Ae);let it=ve.rawData,Qe={};ve.expires&&(Qe.expires=ve.expires),ve.cacheControl&&(Qe.cacheControl=ve.cacheControl),we.vectorTile=ve.vectorTile||new r.dV(new r.dW(it));let yt=()=>{we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mt,en)=>{if(Mt||!en)return Z(Mt);let rn={};if(pe){let Ht=w(de);Ht.length>0&&(rn.resourceTiming=JSON.parse(JSON.stringify(Ht)))}Z(null,r.W({rawTileData:it.slice(0)},en,Qe,rn))})};this.isSpriteLoaded?yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yt,{type:"parseTile",isSymbolTile:$.isSymbolTile,zoom:$.tileZoom}):yt()}),this.loaded=this.loaded||{},this.loaded[oe]=we})}reloadTile($,Z){let oe=this.loaded,de=$.uid;if(oe&&oe[de]){let pe=oe[de];pe.showCollisionBoxes=$.showCollisionBoxes,pe.projection=$.projection,pe.brightness=$.brightness,pe.tileTransform=r.dK($.tileID.canonical,$.projection),pe.extraShadowCaster=$.extraShadowCaster,pe.lut=$.lut;let we=(Ae,ve)=>{let Pe=pe.reloadCallback;Pe&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,Pe)),Z(Ae,ve)};pe.status==="parsing"?pe.reloadCallback=we:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,we):we())}else Z(null,void 0)}abortTile($,Z){let oe=$.uid,de=this.loading[oe];de&&(de.abort&&de.abort(),delete this.loading[oe]),Z()}removeTile($,Z){let oe=this.loaded,de=$.uid;oe&&oe[de]&&delete oe[de],Z()}}class De{loadTile($,Z){let{uid:oe,encoding:de,rawImageData:pe,padding:we}=$,Ae=ImageBitmap&&pe instanceof ImageBitmap?this.getImageData(pe,we):pe;Z(null,new r.dX(oe,Ae,de,we<1))}getImageData($,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);let oe=this.offscreenCanvasContext.getImageData(-Z,-Z,$.width+2*Z,$.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}class Ke{decodeRasterArray({task:$,buffer:Z},oe){r.dY.performDecoding(Z,$).then(de=>{oe(null,de)},de=>{oe(de)})}}let Fe=r.dZ.prototype.toGeoJSON,tt=class{constructor(ye){this._feature=ye,this.extent=r.a3,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){let ye=[];for(let $ of this._feature.geometry)ye.push([new r.P($[0],$[1])]);return ye}{let ye=[];for(let $ of this._feature.geometry){let Z=[];for(let oe of $)Z.push(new r.P(oe[0],oe[1]));ye.push(Z)}return ye}}toGeoJSON(ye,$,Z){return Fe.call(this,ye,$,Z)}},ft=class{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.a3,this.length=ye.length,this._features=ye}feature(ye){return new tt(this._features[ye])}},Ue=64/4096;class Vt{constructor(){this.features=new Map}clear(){this.features.clear()}load($=[],Z){for(let oe of $){let de=oe.id;if(de==null)continue;let pe=this.features.get(de);pe&&this.updateCache(pe,Z),oe.geometry?(pe=nn(oe),this.updateCache(pe,Z),this.features.set(de,pe)):this.features.delete(de),this.updateCache(pe,Z)}}updateCache($,Z){for(let{canonical:oe,uid:de}of Object.values(Z)){let{z:pe,x:we,y:Ae}=oe;Jt($,Math.pow(2,pe),we,Ae)&&delete Z[de]}}getTile($,Z,oe){let de=Math.pow(2,$),pe=[];for(let we of this.features.values())Jt(we,de,Z,oe)&&pe.push(Ei(we,de,Z,oe));return{features:pe}}getFeatures(){return[...this.features.values()]}}function Jt({minX:ye,minY:$,maxX:Z,maxY:oe},de,pe,we){return ye<(pe+1+Ue)/de&&$<(we+1+Ue)/de&&Z>(pe-Ue)/de&&oe>(we-Ue)/de}function nn(ye){let{id:$,geometry:Z,properties:oe}=ye;if(!Z)return;if(Z.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:de,coordinates:pe}=Z,we={id:$,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ae=we.geometry;if(de==="Point")Et(pe,Ae,we);else if(de==="MultiPoint")for(let ve of pe)Et(ve,Ae,we);else if(de==="LineString")we.type=2,oi(pe,Ae,we);else if(de==="MultiLineString")we.type=2,It(pe,Ae,we);else if(de==="Polygon")we.type=3,It(pe,Ae,we,!0);else{if(de!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");we.type=3;for(let ve of pe)It(ve,Ae,we,!0)}return we}function Et([ye,$],Z,oe){let de=r.aj(ye),pe=r.ak($);pe=pe<0?0:pe>1?1:pe,Z.push(de,pe),oe.minX=Math.min(oe.minX,de),oe.minY=Math.min(oe.minY,pe),oe.maxX=Math.max(oe.maxX,de),oe.maxY=Math.max(oe.maxY,pe)}function oi(ye,$,Z,oe=!1,de=!1){let pe=[];for(let we of ye)Et(we,pe,Z);$.push(pe),oe&&function(we,Ae){let ve=0;for(let Pe=0,it=we.length,Qe=it-2;Pe<it;Qe=Pe,Pe+=2)ve+=(we[Pe]-we[Qe])*(we[Pe+1]+we[Qe+1]);if(ve>0===Ae)for(let Pe=0,it=we.length;Pe<it/2;Pe+=2){let Qe=we[Pe],yt=we[Pe+1];we[Pe]=we[it-2-Pe],we[Pe+1]=we[it-1-Pe],we[it-2-Pe]=Qe,we[it-1-Pe]=yt}}(pe,de)}function It(ye,$,Z,oe=!1){for(let de=0;de<ye.length;de++)oi(ye[de],$,Z,oe,de===0)}function Ei(ye,$,Z,oe){let{id:de,type:pe,geometry:we,tags:Ae}=ye,ve=[];if(pe===1)Di(we,$,Z,oe,ve);else for(let Pe of we)ve.push(Di(Pe,$,Z,oe));return{id:de,type:pe,geometry:ve,tags:Ae}}function Di(ye,$,Z,oe,de=[]){for(let pe=0;pe<ye.length;pe+=2)de.push(Ui(ye[pe],ye[pe+1],$,Z,oe));return de}function Ui(ye,$,Z,oe,de){return[Math.round(r.a3*(ye*Z-oe)),Math.round(r.a3*($*Z-de))]}var wn={exports:{}},qo=r.d$,wt=r.d_.VectorTileFeature,jt=Zt;function Zt(ye,$){this.options=$||{},this.features=ye,this.length=ye.length}function vn(ye,$){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=$||4096}Zt.prototype.feature=function(ye){return new vn(this.features[ye],this.options.extent)},vn.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var $=0;$<ye.length;$++){for(var Z=ye[$],oe=[],de=0;de<Z.length;de++)oe.push(new qo(Z[de][0],Z[de][1]));this.geometry.push(oe)}return this.geometry},vn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,$=1/0,Z=-1/0,oe=1/0,de=-1/0,pe=0;pe<ye.length;pe++)for(var we=ye[pe],Ae=0;Ae<we.length;Ae++){var ve=we[Ae];$=Math.min($,ve.x),Z=Math.max(Z,ve.x),oe=Math.min(oe,ve.y),de=Math.max(de,ve.y)}return[$,oe,Z,de]},vn.prototype.toGeoJSON=wt.prototype.toGeoJSON;var Nt=r.e0,hr=jt;function ni(ye){var $=new Nt;return function(Z,oe){for(var de in Z.layers)oe.writeMessage(3,Jr,Z.layers[de])}(ye,$),$.finish()}function Jr(ye,$){var Z;$.writeVarintField(15,ye.version||1),$.writeStringField(1,ye.name||""),$.writeVarintField(5,ye.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ye.length;Z++)oe.feature=ye.feature(Z),$.writeMessage(2,gi,oe);var de=oe.keys;for(Z=0;Z<de.length;Z++)$.writeStringField(3,de[Z]);var pe=oe.values;for(Z=0;Z<pe.length;Z++)$.writeMessage(4,dr,pe[Z])}function gi(ye,$){var Z=ye.feature;Z.id!==void 0&&$.writeVarintField(1,Z.id),$.writeMessage(2,Oa,ye),$.writeVarintField(3,Z.type),$.writeMessage(4,jn,Z)}function Oa(ye,$){var Z=ye.feature,oe=ye.keys,de=ye.values,pe=ye.keycache,we=ye.valuecache;for(var Ae in Z.properties){var ve=Z.properties[Ae],Pe=pe[Ae];if(ve!==null){Pe===void 0&&(oe.push(Ae),pe[Ae]=Pe=oe.length-1),$.writeVarint(Pe);var it=typeof ve;it!=="string"&&it!=="boolean"&&it!=="number"&&(ve=JSON.stringify(ve));var Qe=it+":"+ve,yt=we[Qe];yt===void 0&&(de.push(ve),we[Qe]=yt=de.length-1),$.writeVarint(yt)}}}function Rt(ye,$){return($<<3)+(7&ye)}function Fi(ye){return ye<<1^ye>>31}function jn(ye,$){for(var Z=ye.loadGeometry(),oe=ye.type,de=0,pe=0,we=Z.length,Ae=0;Ae<we;Ae++){var ve=Z[Ae],Pe=1;oe===1&&(Pe=ve.length),$.writeVarint(Rt(1,Pe));for(var it=oe===3?ve.length-1:ve.length,Qe=0;Qe<it;Qe++){Qe===1&&oe!==1&&$.writeVarint(Rt(2,it-1));var yt=ve[Qe].x-de,Mt=ve[Qe].y-pe;$.writeVarint(Fi(yt)),$.writeVarint(Fi(Mt)),de+=yt,pe+=Mt}oe===3&&$.writeVarint(Rt(7,1))}}function dr(ye,$){var Z=typeof ye;Z==="string"?$.writeStringField(1,ye):Z==="boolean"?$.writeBooleanField(7,ye):Z==="number"&&(ye%1!=0?$.writeDoubleField(3,ye):ye<0?$.writeSVarintField(6,ye):$.writeVarintField(5,ye))}wn.exports=ni,wn.exports.fromVectorTileJs=ni,wn.exports.fromGeojsonVt=function(ye,$){$=$||{};var Z={};for(var oe in ye)Z[oe]=new hr(ye[oe].features,$),Z[oe].name=oe,Z[oe].version=$.version,Z[oe].extent=$.extent;return ni({layers:Z})},wn.exports.GeoJSONWrapper=hr;var ms=r.e1(wn.exports);let Zs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},ou=Math.fround||(Il=new Float32Array(1),ye=>(Il[0]=+ye,Il[0]));var Il;let Do=3,So=5,su=6;class Ot{constructor($){this.options=Object.assign(Object.create(Zs),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){let{log:Z,minZoom:oe,maxZoom:de}=this.options;Z&&console.time("total time");let pe=`prepare ${$.length} points`;Z&&console.time(pe),this.points=$;let we=[];for(let ve=0;ve<$.length;ve++){let Pe=$[ve];if(!Pe.geometry)continue;let[it,Qe]=Pe.geometry.coordinates,yt=ou(Gr(it)),Mt=ou(La(Qe));we.push(yt,Mt,1/0,ve,-1,1),this.options.reduce&&we.push(0)}let Ae=this.trees[de+1]=this._createTree(we);Z&&console.timeEnd(pe);for(let ve=de;ve>=oe;ve--){let Pe=+Date.now();Ae=this.trees[ve]=this._createTree(this._cluster(Ae,ve)),Z&&console.log("z%d: %d clusters in %dms",ve,Ae.numItems,+Date.now()-Pe)}return Z&&console.timeEnd("total time"),this}getClusters($,Z){let oe=(($[0]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,$[1])),pe=$[2]===180?180:(($[2]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)oe=-180,pe=180;else if(oe>pe){let Qe=this.getClusters([oe,de,180,we],Z),yt=this.getClusters([-180,de,pe,we],Z);return Qe.concat(yt)}let Ae=this.trees[this._limitZoom(Z)],ve=Ae.range(Gr(oe),La(we),Gr(pe),La(de)),Pe=Ae.data,it=[];for(let Qe of ve){let yt=this.stride*Qe;it.push(Pe[yt+So]>1?zt(Pe,yt,this.clusterProps):this.points[Pe[yt+Do]])}return it}getChildren($){let Z=this._getOriginId($),oe=this._getOriginZoom($),de="No cluster with the specified id.",pe=this.trees[oe];if(!pe)throw new Error(de);let we=pe.data;if(Z*this.stride>=we.length)throw new Error(de);let Ae=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ve=pe.within(we[Z*this.stride],we[Z*this.stride+1],Ae),Pe=[];for(let it of ve){let Qe=it*this.stride;we[Qe+4]===$&&Pe.push(we[Qe+So]>1?zt(we,Qe,this.clusterProps):this.points[we[Qe+Do]])}if(Pe.length===0)throw new Error(de);return Pe}getLeaves($,Z,oe){let de=[];return this._appendLeaves(de,$,Z=Z||10,oe=oe||0,0),de}getTile($,Z,oe){let de=this.trees[this._limitZoom($)],pe=Math.pow(2,$),{extent:we,radius:Ae}=this.options,ve=Ae/we,Pe=(oe-ve)/pe,it=(oe+1+ve)/pe,Qe={features:[]};return this._addTileFeatures(de.range((Z-ve)/pe,Pe,(Z+1+ve)/pe,it),de.data,Z,oe,pe,Qe),Z===0&&this._addTileFeatures(de.range(1-ve/pe,Pe,1,it),de.data,pe,oe,pe,Qe),Z===pe-1&&this._addTileFeatures(de.range(0,Pe,ve/pe,it),de.data,-1,oe,pe,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom($){let Z=this._getOriginZoom($)-1;for(;Z<=this.options.maxZoom;){let oe=this.getChildren($);if(Z++,oe.length!==1)break;$=oe[0].properties.cluster_id}return Z}_appendLeaves($,Z,oe,de,pe){let we=this.getChildren(Z);for(let Ae of we){let ve=Ae.properties;if(ve&&ve.cluster?pe+ve.point_count<=de?pe+=ve.point_count:pe=this._appendLeaves($,ve.cluster_id,oe,de,pe):pe<de?pe++:$.push(Ae),$.length===oe)break}return pe}_createTree($){let Z=new r.cK($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<$.length;oe+=this.stride)Z.add($[oe],$[oe+1]);return Z.finish(),Z.data=$,Z}_addTileFeatures($,Z,oe,de,pe,we){for(let Ae of $){let ve=Ae*this.stride,Pe=Z[ve+So]>1,it,Qe,yt;if(Pe)it=Dl(Z,ve,this.clusterProps),Qe=Z[ve],yt=Z[ve+1];else{let rn=this.points[Z[ve+Do]];it=rn.properties;let[Ht,hn]=rn.geometry.coordinates;Qe=Gr(Ht),yt=La(hn)}let Mt={type:1,geometry:[[Math.round(this.options.extent*(Qe*pe-oe)),Math.round(this.options.extent*(yt*pe-de))]],tags:it},en;en=Pe||this.options.generateId?Z[ve+Do]:this.points[Z[ve+Do]].id,en!==void 0&&(Mt.id=en),we.features.push(Mt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,Z){let{radius:oe,extent:de,reduce:pe,minPoints:we}=this.options,Ae=oe/(de*Math.pow(2,Z)),ve=$.data,Pe=[],it=this.stride;for(let Qe=0;Qe<ve.length;Qe+=it){if(ve[Qe+2]<=Z)continue;ve[Qe+2]=Z;let yt=ve[Qe],Mt=ve[Qe+1],en=$.within(ve[Qe],ve[Qe+1],Ae),rn=ve[Qe+So],Ht=rn;for(let hn of en){let mt=hn*it;ve[mt+2]>Z&&(Ht+=ve[mt+So])}if(Ht>rn&&Ht>=we){let hn,mt=yt*rn,si=Mt*rn,zn=-1,gn=(Qe/it<<5)+(Z+1)+this.points.length;for(let Ri of en){let ai=Ri*it;if(ve[ai+2]<=Z)continue;ve[ai+2]=Z;let Bi=ve[ai+So];mt+=ve[ai]*Bi,si+=ve[ai+1]*Bi,ve[ai+4]=gn,pe&&(hn||(hn=this._map(ve,Qe,!0),zn=this.clusterProps.length,this.clusterProps.push(hn)),pe(hn,this._map(ve,ai)))}ve[Qe+4]=gn,Pe.push(mt/Ht,si/Ht,1/0,gn,-1,Ht),pe&&Pe.push(zn)}else{for(let hn=0;hn<it;hn++)Pe.push(ve[Qe+hn]);if(Ht>1)for(let hn of en){let mt=hn*it;if(!(ve[mt+2]<=Z)){ve[mt+2]=Z;for(let si=0;si<it;si++)Pe.push(ve[mt+si])}}}}return Pe}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,Z,oe){if($[Z+So]>1){let we=this.clusterProps[$[Z+su]];return oe?Object.assign({},we):we}let de=this.points[$[Z+Do]].properties,pe=this.options.map(de);return oe&&pe===de?Object.assign({},pe):pe}}function zt(ye,$,Z){return{type:"Feature",id:ye[$+Do],properties:Dl(ye,$,Z),geometry:{type:"Point",coordinates:[(oe=ye[$],360*(oe-.5)),Sl(ye[$+1])]}};var oe}function Dl(ye,$,Z){let oe=ye[$+So],de=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,pe=ye[$+su],we=pe===-1?{}:Object.assign({},Z[pe]);return Object.assign(we,{cluster:!0,cluster_id:ye[$+Do],point_count:oe,point_count_abbreviated:de})}function Gr(ye){return ye/360+.5}function La(ye){let $=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function Sl(ye){let $=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function Ml(ye,$,Z,oe){let de=oe,pe=$+(Z-$>>1),we,Ae=Z-$,ve=ye[$],Pe=ye[$+1],it=ye[Z],Qe=ye[Z+1];for(let yt=$+3;yt<Z;yt+=3){let Mt=au(ye[yt],ye[yt+1],ve,Pe,it,Qe);if(Mt>de)we=yt,de=Mt;else if(Mt===de){let en=Math.abs(yt-pe);en<Ae&&(we=yt,Ae=en)}}de>oe&&(we-$>3&&Ml(ye,$,we,oe),ye[we+2]=de,Z-we>3&&Ml(ye,we,Z,oe))}function au(ye,$,Z,oe,de,pe){let we=de-Z,Ae=pe-oe;if(we!==0||Ae!==0){let ve=((ye-Z)*we+($-oe)*Ae)/(we*we+Ae*Ae);ve>1?(Z=de,oe=pe):ve>0&&(Z+=we*ve,oe+=Ae*ve)}return we=ye-Z,Ae=$-oe,we*we+Ae*Ae}function Ys(ye,$,Z,oe){let de={id:ye??null,type:$,geometry:Z,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")Fa(de,Z);else if($==="Polygon")Fa(de,Z[0]);else if($==="MultiLineString")for(let pe of Z)Fa(de,pe);else if($==="MultiPolygon")for(let pe of Z)Fa(de,pe[0]);return de}function Fa(ye,$){for(let Z=0;Z<$.length;Z+=3)ye.minX=Math.min(ye.minX,$[Z]),ye.minY=Math.min(ye.minY,$[Z+1]),ye.maxX=Math.max(ye.maxX,$[Z]),ye.maxY=Math.max(ye.maxY,$[Z+1])}function Al(ye,$,Z,oe){if(!$.geometry)return;let de=$.geometry.coordinates;if(de&&de.length===0)return;let pe=$.geometry.type,we=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ae=[],ve=$.id;if(Z.promoteId?ve=$.properties[Z.promoteId]:Z.generateId&&(ve=oe||0),pe==="Point")lu(de,Ae);else if(pe==="MultiPoint")for(let Pe of de)lu(Pe,Ae);else if(pe==="LineString")Pl(de,Ae,we,!1);else if(pe==="MultiLineString"){if(Z.lineMetrics){for(let Pe of de)Ae=[],Pl(Pe,Ae,we,!1),ye.push(Ys(ve,"LineString",Ae,$.properties));return}Rl(de,Ae,we,!1)}else if(pe==="Polygon")Rl(de,Ae,we,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(let Pe of $.geometry.geometries)Al(ye,{id:ve,geometry:Pe,properties:$.properties},Z,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Pe of de){let it=[];Rl(Pe,it,we,!0),Ae.push(it)}}ye.push(Ys(ve,pe,Ae,$.properties))}function lu(ye,$){$.push(co(ye[0]),ud(ye[1]),0)}function Pl(ye,$,Z,oe){let de,pe,we=0;for(let ve=0;ve<ye.length;ve++){let Pe=co(ye[ve][0]),it=ud(ye[ve][1]);$.push(Pe,it,0),ve>0&&(we+=oe?(de*it-Pe*pe)/2:Math.sqrt(Math.pow(Pe-de,2)+Math.pow(it-pe,2))),de=Pe,pe=it}let Ae=$.length-3;$[2]=1,Ml($,0,Ae,Z),$[Ae+2]=1,$.size=Math.abs(we),$.start=0,$.end=$.size}function Rl(ye,$,Z,oe){for(let de=0;de<ye.length;de++){let pe=[];Pl(ye[de],pe,Z,oe),$.push(pe)}}function co(ye){return ye/360+.5}function ud(ye){let $=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function Bt(ye,$,Z,oe,de,pe,we,Ae){if(oe/=$,pe>=(Z/=$)&&we<oe)return ye;if(we<Z||pe>=oe)return null;let ve=[];for(let Pe of ye){let it=Pe.geometry,Qe=Pe.type,yt=de===0?Pe.minX:Pe.minY,Mt=de===0?Pe.maxX:Pe.maxY;if(yt>=Z&&Mt<oe){ve.push(Pe);continue}if(Mt<Z||yt>=oe)continue;let en=[];if(Qe==="Point"||Qe==="MultiPoint")cu(it,en,Z,oe,de);else if(Qe==="LineString")Ii(it,en,Z,oe,de,!1,Ae.lineMetrics);else if(Qe==="MultiLineString")Na(it,en,Z,oe,de,!1);else if(Qe==="Polygon")Na(it,en,Z,oe,de,!0);else if(Qe==="MultiPolygon")for(let rn of it){let Ht=[];Na(rn,Ht,Z,oe,de,!0),Ht.length&&en.push(Ht)}if(en.length){if(Ae.lineMetrics&&Qe==="LineString"){for(let rn of en)ve.push(Ys(Pe.id,Qe,rn,Pe.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(en.length===1?(Qe="LineString",en=en[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=en.length===3?"Point":"MultiPoint"),ve.push(Ys(Pe.id,Qe,en,Pe.tags))}}return ve.length?ve:null}function cu(ye,$,Z,oe,de){for(let pe=0;pe<ye.length;pe+=3){let we=ye[pe+de];we>=Z&&we<=oe&&Wo($,ye[pe],ye[pe+1],ye[pe+2])}}function Ii(ye,$,Z,oe,de,pe,we){let Ae=kl(ye),ve=de===0?Zo:uu,Pe,it,Qe=ye.start;for(let Ht=0;Ht<ye.length-3;Ht+=3){let hn=ye[Ht],mt=ye[Ht+1],si=ye[Ht+2],zn=ye[Ht+3],gn=ye[Ht+4],Ri=de===0?hn:mt,ai=de===0?zn:gn,Bi=!1;we&&(Pe=Math.sqrt(Math.pow(hn-zn,2)+Math.pow(mt-gn,2))),Ri<Z?ai>Z&&(it=ve(Ae,hn,mt,zn,gn,Z),we&&(Ae.start=Qe+Pe*it)):Ri>oe?ai<oe&&(it=ve(Ae,hn,mt,zn,gn,oe),we&&(Ae.start=Qe+Pe*it)):Wo(Ae,hn,mt,si),ai<Z&&Ri>=Z&&(it=ve(Ae,hn,mt,zn,gn,Z),Bi=!0),ai>oe&&Ri<=oe&&(it=ve(Ae,hn,mt,zn,gn,oe),Bi=!0),!pe&&Bi&&(we&&(Ae.end=Qe+Pe*it),$.push(Ae),Ae=kl(ye)),we&&(Qe+=Pe)}let yt=ye.length-3,Mt=ye[yt],en=ye[yt+1],rn=de===0?Mt:en;rn>=Z&&rn<=oe&&Wo(Ae,Mt,en,ye[yt+2]),yt=Ae.length-3,pe&&yt>=3&&(Ae[yt]!==Ae[0]||Ae[yt+1]!==Ae[1])&&Wo(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&$.push(Ae)}function kl(ye){let $=[];return $.size=ye.size,$.start=ye.start,$.end=ye.end,$}function Na(ye,$,Z,oe,de,pe){for(let we of ye)Ii(we,$,Z,oe,de,pe,!1)}function Wo(ye,$,Z,oe){ye.push($,Z,oe)}function Zo(ye,$,Z,oe,de,pe){let we=(pe-$)/(oe-$);return Wo(ye,pe,Z+(de-Z)*we,1),we}function uu(ye,$,Z,oe,de,pe){let we=(pe-Z)/(de-Z);return Wo(ye,$+(oe-$)*we,pe,1),we}function Xs(ye,$){let Z=[];for(let oe=0;oe<ye.length;oe++){let de=ye[oe],pe=de.type,we;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")we=Ks(de.geometry,$);else if(pe==="MultiLineString"||pe==="Polygon"){we=[];for(let Ae of de.geometry)we.push(Ks(Ae,$))}else if(pe==="MultiPolygon"){we=[];for(let Ae of de.geometry){let ve=[];for(let Pe of Ae)ve.push(Ks(Pe,$));we.push(ve)}}Z.push(Ys(de.id,pe,we,de.tags))}return Z}function Ks(ye,$){let Z=[];Z.size=ye.size,ye.start!==void 0&&(Z.start=ye.start,Z.end=ye.end);for(let oe=0;oe<ye.length;oe+=3)Z.push(ye[oe]+$,ye[oe+1],ye[oe+2]);return Z}function Ol(ye,$){if(ye.transformed)return ye;let Z=1<<ye.z,oe=ye.x,de=ye.y;for(let pe of ye.features){let we=pe.geometry,Ae=pe.type;if(pe.geometry=[],Ae===1)for(let ve=0;ve<we.length;ve+=2)pe.geometry.push(Ll(we[ve],we[ve+1],$,Z,oe,de));else for(let ve=0;ve<we.length;ve++){let Pe=[];for(let it=0;it<we[ve].length;it+=2)Pe.push(Ll(we[ve][it],we[ve][it+1],$,Z,oe,de));pe.geometry.push(Pe)}}return ye.transformed=!0,ye}function Ll(ye,$,Z,oe,de,pe){return[Math.round(Z*(ye*oe-de)),Math.round(Z*($*oe-pe))]}function hd(ye,$,Z,oe,de){let pe=$===de.maxZoom?0:de.tolerance/((1<<$)*de.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:Z,y:oe,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ae of ye)Fl(we,Ae,pe,de);return we}function Fl(ye,$,Z,oe){let de=$.geometry,pe=$.type,we=[];if(ye.minX=Math.min(ye.minX,$.minX),ye.minY=Math.min(ye.minY,$.minY),ye.maxX=Math.max(ye.maxX,$.maxX),ye.maxY=Math.max(ye.maxY,$.maxY),pe==="Point"||pe==="MultiPoint")for(let Ae=0;Ae<de.length;Ae+=3)we.push(de[Ae],de[Ae+1]),ye.numPoints++,ye.numSimplified++;else if(pe==="LineString")uo(we,de,ye,Z,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Ae=0;Ae<de.length;Ae++)uo(we,de[Ae],ye,Z,pe==="Polygon",Ae===0);else if(pe==="MultiPolygon")for(let Ae=0;Ae<de.length;Ae++){let ve=de[Ae];for(let Pe=0;Pe<ve.length;Pe++)uo(we,ve[Pe],ye,Z,!0,Pe===0)}if(we.length){let Ae=$.tags||null;if(pe==="LineString"&&oe.lineMetrics){Ae={};for(let Pe in $.tags)Ae[Pe]=$.tags[Pe];Ae.mapbox_clip_start=de.start/de.size,Ae.mapbox_clip_end=de.end/de.size}let ve={geometry:we,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Ae};$.id!==null&&(ve.id=$.id),ye.features.push(ve)}}function uo(ye,$,Z,oe,de,pe){let we=oe*oe;if(oe>0&&$.size<(de?we:oe))return void(Z.numPoints+=$.length/3);let Ae=[];for(let ve=0;ve<$.length;ve+=3)(oe===0||$[ve+2]>we)&&(Z.numSimplified++,Ae.push($[ve],$[ve+1])),Z.numPoints++;de&&function(ve,Pe){let it=0;for(let Qe=0,yt=ve.length,Mt=yt-2;Qe<yt;Mt=Qe,Qe+=2)it+=(ve[Qe]-ve[Mt])*(ve[Qe+1]+ve[Mt+1]);if(it>0===Pe)for(let Qe=0,yt=ve.length;Qe<yt/2;Qe+=2){let Mt=ve[Qe],en=ve[Qe+1];ve[Qe]=ve[yt-2-Qe],ve[Qe+1]=ve[yt-1-Qe],ve[yt-2-Qe]=Mt,ve[yt-1-Qe]=en}}(Ae,pe),ye.push(Ae)}let Qs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ho{constructor($,Z){let oe=(Z=this.options=function(pe,we){for(let Ae in we)pe[Ae]=we[Ae];return pe}(Object.create(Qs),Z)).debug;if(oe&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(pe,we){let Ae=[];if(pe.type==="FeatureCollection")for(let ve=0;ve<pe.features.length;ve++)Al(Ae,pe.features[ve],we,ve);else Al(Ae,pe.type==="Feature"?pe:{geometry:pe},we);return Ae}($,Z);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(pe,we){let Ae=we.buffer/we.extent,ve=pe,Pe=Bt(pe,1,-1-Ae,Ae,0,-1,2,we),it=Bt(pe,1,1-Ae,2+Ae,0,-1,2,we);return(Pe||it)&&(ve=Bt(pe,1,-Ae,1+Ae,0,-1,2,we)||[],Pe&&(ve=Xs(Pe,1).concat(ve)),it&&(ve=ve.concat(Xs(it,-1)))),ve}(de,Z),de.length&&this.splitTile(de,0,0,0),oe&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,Z,oe,de,pe,we,Ae){let ve=[$,Z,oe,de],Pe=this.options,it=Pe.debug;for(;ve.length;){de=ve.pop(),oe=ve.pop(),Z=ve.pop(),$=ve.pop();let Qe=1<<Z,yt=tr(Z,oe,de),Mt=this.tiles[yt];if(!Mt&&(it>1&&console.time("creation"),Mt=this.tiles[yt]=hd($,Z,oe,de,Pe),this.tileCoords.push({z:Z,x:oe,y:de}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,oe,de,Mt.numFeatures,Mt.numPoints,Mt.numSimplified),console.timeEnd("creation"));let Bi=`z${Z}`;this.stats[Bi]=(this.stats[Bi]||0)+1,this.total++}if(Mt.source=$,pe==null){if(Z===Pe.indexMaxZoom||Mt.numPoints<=Pe.indexMaxPoints)continue}else{if(Z===Pe.maxZoom||Z===pe)continue;if(pe!=null){let Bi=pe-Z;if(oe!==we>>Bi||de!==Ae>>Bi)continue}}if(Mt.source=null,$.length===0)continue;it>1&&console.time("clipping");let en=.5*Pe.buffer/Pe.extent,rn=.5-en,Ht=.5+en,hn=1+en,mt=null,si=null,zn=null,gn=null,Ri=Bt($,Qe,oe-en,oe+Ht,0,Mt.minX,Mt.maxX,Pe),ai=Bt($,Qe,oe+rn,oe+hn,0,Mt.minX,Mt.maxX,Pe);$=null,Ri&&(mt=Bt(Ri,Qe,de-en,de+Ht,1,Mt.minY,Mt.maxY,Pe),si=Bt(Ri,Qe,de+rn,de+hn,1,Mt.minY,Mt.maxY,Pe),Ri=null),ai&&(zn=Bt(ai,Qe,de-en,de+Ht,1,Mt.minY,Mt.maxY,Pe),gn=Bt(ai,Qe,de+rn,de+hn,1,Mt.minY,Mt.maxY,Pe),ai=null),it>1&&console.timeEnd("clipping"),ve.push(mt||[],Z+1,2*oe,2*de),ve.push(si||[],Z+1,2*oe,2*de+1),ve.push(zn||[],Z+1,2*oe+1,2*de),ve.push(gn||[],Z+1,2*oe+1,2*de+1)}}getTile($,Z,oe){$=+$,Z=+Z,oe=+oe;let de=this.options,{extent:pe,debug:we}=de;if($<0||$>24)return null;let Ae=1<<$,ve=tr($,Z=Z+Ae&Ae-1,oe);if(this.tiles[ve])return Ol(this.tiles[ve],pe);we>1&&console.log("drilling down to z%d-%d-%d",$,Z,oe);let Pe,it=$,Qe=Z,yt=oe;for(;!Pe&&it>0;)it--,Qe>>=1,yt>>=1,Pe=this.tiles[tr(it,Qe,yt)];return Pe&&Pe.source?(we>1&&(console.log("found parent tile z%d-%d-%d",it,Qe,yt),console.time("drilling down")),this.splitTile(Pe.source,it,Qe,yt,$,Z,oe),we>1&&console.timeEnd("drilling down"),this.tiles[ve]?Ol(this.tiles[ve],pe):null):null}}function tr(ye,$,Z){return 32*((1<<ye)*Z+$)+ye}function dd(ye,$){let Z=ye.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);let oe=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!oe)return $(null,null);let de=new ft(oe.features),pe=ms(de);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),$(null,{vectorTile:de,rawData:pe.buffer})}class za extends be{constructor($,Z,oe,de,pe,we){super($,Z,oe,de,dd,we),pe&&(this.loadGeoJSON=pe),this._dynamicIndex=new Vt}loadData($,Z){let oe=$&&$.request,de=oe&&oe.collectResourceTiming;this.loadGeoJSON($,(pe,we)=>{if(pe||!we)return Z(pe);if(typeof we!="object")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{try{if($.filter){let ve=r.y($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));we.features=we.features.filter(Pe=>ve.value.evaluate({zoom:0},Pe))}$.dynamic?(we.type==="Feature"&&(we={type:"FeatureCollection",features:[we]}),$.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(we.features,this.loaded),$.cluster&&(we.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=$.cluster?new Ot(function({superclusterOptions:ve,clusterProperties:Pe}){if(!Pe||!ve)return ve;let it={},Qe={},yt={accumulated:null,zoom:0},Mt={properties:null},en=Object.keys(Pe);for(let rn of en){let[Ht,hn]=Pe[rn],mt=r.y(hn),si=r.y(typeof Ht=="string"?[Ht,["accumulated"],["get",rn]]:Ht);it[rn]=mt.value,Qe[rn]=si.value}return ve.map=rn=>{Mt.properties=rn;let Ht={};for(let hn of en)Ht[hn]=it[hn].evaluate(yt,Mt);return Ht},ve.reduce=(rn,Ht)=>{Mt.properties=Ht;for(let hn of en)yt.accumulated=rn[hn],rn[hn]=Qe[hn].evaluate(yt,Mt)},ve}($)).load(we.features):$.dynamic?this._dynamicIndex:function(ve,Pe){return new ho(ve,Pe)}(we,$.geojsonVtOptions)}catch(ve){return Z(ve)}let Ae={};if(de){let ve=w(oe);ve&&(Ae.resourceTiming={},Ae.resourceTiming[$.source]=JSON.parse(JSON.stringify(ve)))}Z(null,Ae)}})}reloadTile($,Z){let oe=this.loaded;return oe&&oe[$.uid]?$.partial?Z(null,void 0):super.reloadTile($,Z):this.loadTile($,Z)}loadGeoJSON($,Z){if($.request)r.g($.request,Z);else{if(typeof $.data!="string")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse($.data))}catch{return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(oe){Z(oe)}}getClusterChildren($,Z){try{Z(null,this._geoJSONIndex.getChildren($.clusterId))}catch(oe){Z(oe)}}getClusterLeaves($,Z){try{Z(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(oe){Z(oe)}}}class Nl{constructor($,Z){this.tileID=new r.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=Z}parse($,Z,oe,de){this.status="parsing";let pe=new r.aL(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),we={},Ae=Z.familiesBySource[oe.source],ve=new r.dN(pe,oe.promoteId);return ve.bucketLayerIDs=[],ve.is3DTile=!0,r.e3($).then(Pe=>{if(!Pe)return de(new Error("Could not parse tile"));let it=r.e4(Pe,1/r.b5(oe.tileID.canonical)),Qe=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Pe.json.asset.extras&&Pe.json.asset.extras.MAPBOX_mesh_features,yt=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("EXT_meshopt_compression"),Mt=new r.X(this.zoom,{brightness:this.brightness});for(let en in Ae)for(let rn of Ae[en]){let Ht=rn[0];ve.bucketLayerIDs.push(rn.map(mt=>mt.id)),Ht.recalculate(Mt,[]);let hn=new r.e5(it,pe,Qe,yt,this.brightness,ve);Qe||(hn.needsUpload=!0),we[Ht.fqid]=hn,hn.evaluate(Ht)}this.status="done",de(null,{buckets:we,featureIndex:ve})}).catch(Pe=>de(new Error(Pe.message)))}}class hu{constructor($,Z,oe,de,pe,we){this.actor=$,this.layerIndex=Z,this.brightness=we,this.loading={},this.loaded={}}loadTile($,Z){let oe=$.uid,de=this.loading[oe]=new Nl($,this.brightness);r.e2($.request,(pe,we)=>{let Ae=!this.loading[oe];return delete this.loading[oe],Ae||pe?(de.status="done",Ae||(this.loaded[oe]=de),Z(pe)):we&&we.byteLength!==0?void de.parse(we,this.layerIndex,$,(ve,Pe)=>{de.status="done",this.loaded=this.loaded||{},this.loaded[oe]=de,ve||!Pe?Z(ve):Z(null,Pe)}):(de.status="done",this.loaded[oe]=de,Z())})}reloadTile($,Z){let oe=this.loaded,de=$.uid;if(oe&&oe[de]){let pe=oe[de];pe.projection=$.projection,pe.brightness=$.brightness;let we=(Ae,ve)=>{pe.reloadCallback&&(delete pe.reloadCallback,this.loadTile($,Z)),Z(Ae,ve)};pe.status==="parsing"?pe.reloadCallback=we:pe.status==="done"&&this.loadTile($,Z)}}abortTile($,Z){let oe=$.uid;this.loading[oe]&&delete this.loading[oe],Z()}removeTile($,Z){let oe=this.loaded,de=$.uid;oe&&oe[de]&&delete oe[de],Z()}}class zl{constructor($){this.self=$,this.actor=new r.e6($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.aJ({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:za,"batched-model":hu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,oe)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=oe},this.self.registerRTLTextPlugin=Z=>{if(r.e7.isParsed())throw new Error("RTL text plugin already registered.");r.e7.applyArabicShaping=Z.applyArabicShaping,r.e7.processBidirectionalText=Z.processBidirectionalText,r.e7.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches($,Z,oe){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],delete this.rasterArrayWorkerSource,oe()}checkIfReady($,Z,oe){oe()}setReferrer($,Z){this.referrer=Z}spriteLoaded($,{scope:Z,isLoaded:oe}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][Z]=oe,this.workerSources[$]&&this.workerSources[$][Z])for(let de in this.workerSources[$][Z]){let pe=this.workerSources[$][Z][de];for(let we in pe){let Ae=pe[we];Ae instanceof be&&(Ae.isSpriteLoaded=oe,Ae.fire(new r.f("isSpriteLoaded")))}}}setImages($,{scope:Z,images:oe},de){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][Z]=oe,this.workerSources[$]&&this.workerSources[$][Z]){for(let pe in this.workerSources[$][Z]){let we=this.workerSources[$][Z][pe];for(let Ae in we)we[Ae].availableImages=oe}de()}else de()}setProjection($,Z){this.projections[$]=r.aJ(Z)}setBrightness($,Z,oe){this.brightness=Z,oe()}setLayers($,Z,oe){this.getLayerIndex($,Z.scope).replace(Z.layers,Z.options),oe()}updateLayers($,Z,oe){this.getLayerIndex($,Z.scope).update(Z.layers,Z.removedIds,Z.options),oe()}loadTile($,Z,oe){Z.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source,Z.scope).loadTile(Z,oe)}loadDEMTile($,Z,oe){this.getDEMWorkerSource($,Z.source,Z.scope).loadTile(Z,oe)}decodeRasterArray($,Z,oe){this.getRasterArrayWorkerSource().decodeRasterArray(Z,oe)}reloadTile($,Z,oe){Z.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source,Z.scope).reloadTile(Z,oe)}abortTile($,Z,oe){this.getWorkerSource($,Z.type,Z.source,Z.scope).abortTile(Z,oe)}removeTile($,Z,oe){this.getWorkerSource($,Z.type,Z.source,Z.scope).removeTile(Z,oe)}removeSource($,Z,oe){if(!(this.workerSources[$]&&this.workerSources[$][Z.scope]&&this.workerSources[$][Z.scope][Z.type]&&this.workerSources[$][Z.scope][Z.type][Z.source]))return;let de=this.workerSources[$][Z.scope][Z.type][Z.source];delete this.workerSources[$][Z.scope][Z.type][Z.source],de.removeSource!==void 0?de.removeSource(Z,oe):oe()}loadWorkerSource($,Z,oe){try{this.self.importScripts(Z.url),oe()}catch(de){oe(de.toString())}}syncRTLPluginState($,Z,oe){try{r.e7.setState(Z);let de=r.e7.getPluginURL();if(r.e7.isLoaded()&&!r.e7.isParsed()&&de!=null){this.self.importScripts(de);let pe=r.e7.isParsed();oe(pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),pe)}}catch(de){oe(de.toString())}}setDracoUrl($,Z){this.dracoUrl=Z}getAvailableImages($,Z){this.availableImages[$]||(this.availableImages[$]={});let oe=this.availableImages[$][Z];return oe||(oe=[]),oe}getLayerIndex($,Z){this.layerIndexes[$]||(this.layerIndexes[$]={});let oe=this.layerIndexes[$][Z];return oe||(oe=this.layerIndexes[$][Z]=new L,oe.scope=Z),oe}getWorkerSource($,Z,oe,de){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][de]||(this.workerSources[$][de]={}),this.workerSources[$][de][Z]||(this.workerSources[$][de][Z]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][de][Z][oe]||(this.workerSources[$][de][Z][oe]=new this.workerSourceTypes[Z]({send:(pe,we,Ae,ve,Pe,it)=>{this.actor.send(pe,we,Ae,$,Pe,it)},scheduler:this.actor.scheduler},this.getLayerIndex($,de),this.getAvailableImages($,de),this.isSpriteLoaded[$][de],void 0,this.brightness)),this.workerSources[$][de][Z][oe]}getDEMWorkerSource($,Z,oe){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][oe]||(this.demWorkerSources[$][oe]={}),this.demWorkerSources[$][oe][Z]||(this.demWorkerSources[$][oe][Z]=new De),this.demWorkerSources[$][oe][Z]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ke),this.rasterArrayWorkerSource}enforceCacheSizeLimit($,Z){r.e8(Z)}getWorkerPerformanceMetrics($,Z,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new zl(self)),zl}),c(["./shared"],function(r){function w(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let h=0;h<m.length;h++)if(!w(m[h],s[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&s!==null){if(typeof s!="object"||Object.keys(m).length!==Object.keys(s).length)return!1;for(let h in m)if(!w(m[h],s[h]))return!1;return!0}return m===s}var I=A;function A(m){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{v=new Worker(E),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(E),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(L[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(L[h]=function(g){var v,x=function(E){var C=document.createElement("canvas"),M=Object.create(A.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=E,C.getContext("webgl2",M)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),L[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(m)}var L={};function U(m,s,h){let g=document.createElement(m);return s!=null&&(g.className=s),h&&h.appendChild(g),g}function Q(m,s,h){let g=document.createElementNS("http://www.w3.org/2000/svg",m);for(let v of Object.keys(s))g.setAttributeNS(null,v,String(s[v]));return h&&h.appendChild(g),g}A.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let fe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,he=fe&&fe.userSelect!==void 0?"userSelect":"WebkitUserSelect",be;function De(){fe&&he&&(be=fe[he],fe[he]="none")}function Ke(){fe&&he&&(fe[he]=be)}function Fe(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Fe,!0)}function tt(){window.addEventListener("click",Fe,!0),window.setTimeout(()=>{window.removeEventListener("click",Fe,!0)},0)}function ft(m,s){let h=m.getBoundingClientRect();return Jt(m,h,s)}function Ue(m,s){let h=m.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(Jt(m,h,s[v]));return g}function Vt(m){return window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function Jt(m,s,h){let g=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new r.P((h.clientX-s.left)*g,(h.clientY-s.top)*g)}class nn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,h){this._updatedSourceCaches[s]=h,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){let h=s.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(s.id),this.setDirty()}removeLayer(s){let h=s.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][s.id]=s,this._updatedLayers[h].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){let s={};for(let h in this._updatedLayers)s[h]=s[h]||{},s[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)s[h]=s[h]||{},s[h].removedIds=Object.keys(this._removedLayers[h]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Et={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class oi{constructor(s,h,g,v,x,E){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=E,this.context=s;let C=s.gl;this.buffer=C.createBuffer(),s.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){let v=h.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],E=h.attributes[x.name];E!==void 0&&s.vertexAttribPointer(E,x.components,s[Et[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=h.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class It{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ei extends It{getDefault(){return r.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Di extends It{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ui extends It{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class wn extends It{getDefault(){return[!0,!0,!0,!0]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class qo extends It{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class wt extends It{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class jt extends It{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){let h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Zt extends It{getDefault(){let s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class vn extends It{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Nt extends It{getDefault(){return[0,1]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class hr extends It{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class ni extends It{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Jr extends It{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class gi extends It{getDefault(){let s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Oa extends It{getDefault(){return r.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Rt extends It{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class Fi extends It{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class jn extends It{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class dr extends It{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let ms=class extends It{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Zs extends It{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ou extends It{getDefault(){let s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Il extends It{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Do extends It{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class So extends It{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class su extends It{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ot extends It{getDefault(){return null}set(s){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class zt extends It{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class Dl extends It{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Gr extends It{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class La extends It{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Sl extends It{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Ml extends Sl{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class au extends Sl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ys extends Sl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Fa extends au{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Al{constructor(s,h,g,v,x){this.context=s,this.width=h,this.height=g;let E=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new Ml(s,E)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new au(s,E):new Ys(s,E))}destroy(){let s=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&s.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&s.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&s.deleteTexture(h)}s.deleteFramebuffer(this.framebuffer)}}class lu{constructor(s,h){this.gl=s,this.clearColor=new Ei(this),this.clearDepth=new Di(this),this.clearStencil=new Ui(this),this.colorMask=new wn(this),this.depthMask=new qo(this),this.stencilMask=new wt(this),this.stencilFunc=new jt(this),this.stencilOp=new Zt(this),this.stencilTest=new vn(this),this.depthRange=new Nt(this),this.depthTest=new hr(this),this.depthFunc=new ni(this),this.blend=new Jr(this),this.blendFunc=new gi(this),this.blendColor=new Oa(this),this.blendEquation=new Rt(this),this.cullFace=new Fi(this),this.cullFaceSide=new jn(this),this.frontFace=new dr(this),this.program=new ms(this),this.activeTexture=new Zs(this),this.viewport=new ou(this),this.bindFramebuffer=new Il(this),this.bindRenderbuffer=new Do(this),this.bindTexture=new So(this),this.bindVertexBuffer=new su(this),this.bindElementBuffer=new Ot(this),this.bindVertexArrayOES=new zt(this),this.pixelStoreUnpack=new Dl(this),this.pixelStoreUnpackPremultiplyAlpha=new Gr(this),this.pixelStoreUnpackFlipY=new La(this),this.options=h?gt({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h,g){return new r.I(this,s,h,g)}createVertexBuffer(s,h,g,v,x){return new oi(this,s,h,g,v,x)}createRenderbuffer(s,h,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),x}createFramebuffer(s,h,g,v){return new Al(this,s,h,g,v)}clear({color:s,depth:h,stencil:g,colorMask:v}){let x=this.gl,E=0;s&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(E|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(E)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){w(s.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Pl{constructor(s){this._gl=s.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let s=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,s}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class Rl{constructor(s){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,s.registerParameter(this,["Symbols"],"useOcclusionQueries"),s.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),s.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),s.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),s.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class co{constructor(s,h,g,v){let x={width:g[0],height:g[1],data:null},E=s.gl;this.targetColorTexture=new r.T(s,x,E.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(s,x,E.RGBA,{useMipmap:!1}),this.context=s,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(s,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=h.width*h.height;this.particleTexture0=new r.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new r.S;x.reserve(v);for(let E=0;E<v;E++)x.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(x,r.p.members,!0),this.particleSegment=r.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=r.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class ud extends r.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,h){return r.l(this.requestManager.transformRequest(h,r.R.Model).url).then(g=>{if(!g)return;let v=r.c(g),x=new r.M(s,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new r.d(new Error(`Could not load model ${s} from ${h}: ${g.message}`)))})}load(s,h){this.models[h]||(this.models[h]={});let g=Object.keys(s);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,s[x]));Promise.allSettled(v).then(x=>{for(let E=0;E<x.length;E++){let{status:C,value:M}=x[E];C==="fulfilled"&&M&&(this.models[h][g[E]]={model:M,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new r.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new r.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,h){return!!this.getModel(s,h)}getModel(s,h){return this.models[h]||(this.models[h]={}),this.models[h][s]?this.models[h][s].model:void 0}addModel(s,h,g){this.models[g]||(this.models[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.load({[s]:this.requestManager.normalizeModelURL(h)},g)}addModels(s,h){this.models[h]||(this.models[h]={});let g={};for(let v in s)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(s[v]);this.load(g,h)}addModelsFromBucket(s,h){this.models[h]||(this.models[h]={});let g={};for(let v of s)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(s,h){if(this.models[h]&&this.models[h][s]&&(this.models[h][s].numReferences--,this.models[h][s].numReferences===0)){let g=this.models[h][s].model;delete this.models[h][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,h){this.models[h]||(this.models[h]={});for(let g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(s.context)}}function Bt(m){let{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class cu extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new r.i({width:1,height:1})}isLoaded(){for(let s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,h){if(this.loaded[h]!==s&&(this.loaded[h]=s,s)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(s,h){return!!this.getImage(s,h)}getImage(s,h){return this.images[h][s]}addImage(s,h,g){this._validate(s,g)&&(this.images[h][s]=g)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(let v of s){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h,g){g.version=this.images[h][s].version+1,this.images[h][s]=g,this.updatedImages[h][s]=!0}removeImage(s,h){let g=this.images[h][s];delete this.images[h][s],delete this.patterns[h][s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,h,g){let v=!0,x=!!this.loaded[h];if(!x)for(let E of s)this.images[h][E]||(v=!1);x||v?this._notify(s,h,g):this.requestors.push({ids:s,scope:h,callback:g})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,h,g){let v={};for(let x of s){this.images[h][x]||this.fire(new r.f("styleimagemissing",{id:x}));let E=this.images[h][x];E?v[x]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:r.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(s){let{width:h,height:g}=this.atlasImage[s];return{width:h,height:g}}getPattern(s,h,g){let v=this.patterns[h][s],x=this.getImage(s,h);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let E={w:x.data.width+2,h:x.data.height+2,x:0,y:0},C=new r.k(E,x);this.patterns[h][s]={bin:E,position:C}}return this._updatePatternAtlas(h,g),this.patterns[h][s].position}bind(s,h){let g=s.gl,v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new r.T(s,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,h){let g=[];for(let C in this.patterns[s])g.push(this.patterns[s][C].bin);let{w:v,h:x}=r.j(g),E=this.atlasImage[s];E.resize({width:v||1,height:x||1});for(let C in this.patterns[s]){let{bin:M}=this.patterns[s][C],P=M.x+1,O=M.y+1,N=this.images[s][C].data,B=N.width,V=N.height;r.i.copy(N,E,{x:0,y:0},{x:P,y:O},{width:B,height:V},h),r.i.copy(N,E,{x:0,y:V-1},{x:P,y:O-1},{width:B,height:1},h),r.i.copy(N,E,{x:0,y:0},{x:P,y:O+V},{width:B,height:1},h),r.i.copy(N,E,{x:B-1,y:0},{x:P-1,y:O},{width:1,height:V},h),r.i.copy(N,E,{x:0,y:0},{x:P+B,y:O},{width:1,height:V},h)}this.dirty=!0}beginFrame(){for(let s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,h){for(let g of s){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;let v=this.images[h][g];Bt(v)&&this.updateImage(g,h,v)}}}function Ii(m){let s=m.key,h=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},x=m.style,E=m.styleSpec,C=[],M=r.n(h);if(M!=="object")return[new r.V(s,h,`object expected, ${M} found`)];for(let P in h){let O=P.split(".")[0],N;v[O]?N=v[O]:g[O]?N=$:v["*"]?N=v["*"]:g["*"]&&(N=$),N?C=C.concat(N({key:(s&&`${s}.`)+P,value:h[P],valueSpec:g[O]||g["*"],style:x,styleSpec:E,object:h,objectKey:P},h)):C.push(new r.m(s,h[P],`unknown property "${P}"`))}for(let P in g)v[P]||g[P].required&&g[P].default===void 0&&h[P]===void 0&&C.push(new r.V(s,h,`missing required property "${P}"`));return C}function kl(m){let s=m.value,h=m.valueSpec,g=m.style,v=m.styleSpec,x=m.key,E=m.arrayElementValidator||$;if(r.n(s)!=="array")return[new r.V(x,s,`array expected, ${r.n(s)} found`)];if(h.length&&s.length!==h.length)return[new r.V(x,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new r.V(x,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let C={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(C.function=h.function),r.n(h.value)==="object"&&(C=h.value);let M=[];for(let P=0;P<s.length;P++)M=M.concat(E({array:s,arrayIndex:P,value:s[P],valueSpec:C,style:g,styleSpec:v,key:`${x}[${P}]`},!0));return M}function Na(m){let s=m.key,h=m.value,g=m.valueSpec,v=r.n(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new r.V(s,h,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(r.n(g.minimum)==="array"&&(x=g.minimum[m.arrayIndex]),h<x)return[new r.V(s,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(r.n(g.maximum)==="array"&&(x=g.maximum[m.arrayIndex]),h>x)return[new r.V(s,h,`${h} is greater than the maximum value ${x}`)]}return[]}function Wo(m){let s=m.valueSpec,h=r.u(m.value.type),g,v,x,E={},C=h!=="categorical"&&m.value.property===void 0,M=!C,P=r.n(m.value.stops)==="array"&&r.n(m.value.stops[0])==="array"&&r.n(m.value.stops[0][0])==="object",O=Ii({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(V){if(h==="identity")return[new r.V(V.key,V.value,'identity function may not have a "stops" property')];let G=[],H=V.value;return G=G.concat(kl({key:V.key,value:H,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),r.n(H)==="array"&&H.length===0&&G.push(new r.V(V.key,H,"array must have at least one stop")),G},default:function(V){return $({key:V.key,value:V.value,valueSpec:s,style:V.style,styleSpec:V.styleSpec})}}});return h==="identity"&&C&&O.push(new r.V(m.key,m.value,'missing required property "property"')),h==="identity"||m.value.stops||O.push(new r.V(m.key,m.value,'missing required property "stops"')),h==="exponential"&&m.valueSpec.expression&&!r.s(m.valueSpec)&&O.push(new r.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(M&&!r.q(m.valueSpec)?O.push(new r.V(m.key,m.value,"property functions not supported")):C&&!r.r(m.valueSpec)&&O.push(new r.V(m.key,m.value,"zoom functions not supported"))),h!=="categorical"&&!P||m.value.property!==void 0||O.push(new r.V(m.key,m.value,'"property" property is required')),O;function N(V){let G=[],H=V.value,q=V.key;if(r.n(H)!=="array")return[new r.V(q,H,`array expected, ${r.n(H)} found`)];if(H.length!==2)return[new r.V(q,H,`array length 2 expected, length ${H.length} found`)];if(P){if(r.n(H[0])!=="object")return[new r.V(q,H,`object expected, ${r.n(H[0])} found`)];if(H[0].zoom===void 0)return[new r.V(q,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new r.V(q,H,"object stop key must have value")];let W=r.u(H[0].zoom);if(typeof W!="number")return[new r.V(q,H[0].zoom,"stop zoom values must be numbers")];if(x&&x>W)return[new r.V(q,H[0].zoom,"stop zoom values must appear in ascending order")];W!==x&&(x=W,v=void 0,E={}),G=G.concat(Ii({key:`${q}[0]`,value:H[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Na,value:B}}))}else G=G.concat(B({key:`${q}[0]`,value:H[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},H));return r.t(r.v(H[1]))?G.concat([new r.V(`${q}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat($({key:`${q}[1]`,value:H[1],valueSpec:s,style:V.style,styleSpec:V.styleSpec}))}function B(V,G){let H=r.n(V.value),q=r.u(V.value),W=V.value!==null?V.value:G;if(g){if(H!==g)return[new r.V(V.key,W,`${H} stop domain type must match previous stop domain type ${g}`)]}else g=H;if(H!=="number"&&H!=="string"&&H!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new r.V(V.key,W,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&h!=="categorical"){let ee=`number expected, ${H} found`;return r.q(s)&&h===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(V.key,W,ee)]}return h!=="categorical"||H!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?h!=="categorical"&&H==="number"&&typeof q=="number"&&typeof v=="number"&&v!==void 0&&q<v?[new r.V(V.key,W,"stop domain values must appear in ascending order")]:(v=q,h==="categorical"&&q in E?[new r.V(V.key,W,"stop domain values must be unique")]:(E[q]=!0,[])):[new r.V(V.key,W,`integer expected, found ${String(q)}`)]}}function Zo(m){let s=(m.expressionContext==="property"?r.x:r.y)(r.v(m.value),m.valueSpec);if(s.result==="error")return s.value.map(g=>new r.V(`${m.key}${g.key}`,m.value,g.message));let h=s.value.expression||s.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!h.outputDefined())return[new r.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!r.z(h))return[new r.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return uu(h,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!r.A(h,["zoom","feature-state"]))return[new r.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!r.B(h))return[new r.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uu(m,s){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(let v of s.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];let g=[];return m instanceof r.D&&h.has(m.name)?[new r.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(v=>{g.push(...uu(v,s))}),g)}function Xs(m){let s=m.key,h=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(r.u(h))===-1&&v.push(new r.V(s,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(r.u(h))===-1&&v.push(new r.V(s,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function Ks(m){return r.G(r.v(m.value))?Zo(r.o({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Ol(m)}function Ol(m){let s=m.value,h=m.key;if(r.n(s)!=="array")return[new r.V(h,s,`array expected, ${r.n(s)} found`)];let g=m.styleSpec,v,x=[];if(s.length<1)return[new r.V(h,s,"filter array must have at least 1 element")];switch(x=x.concat(Xs({key:`${h}[0]`,value:s[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),r.u(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&r.u(s[1])==="$type"&&x.push(new r.V(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new r.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=r.n(s[1]),v!=="string"&&x.push(new r.V(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let E=2;E<s.length;E++)v=r.n(s[E]),r.u(s[1])==="$type"?x=x.concat(Xs({key:`${h}[${E}]`,value:s[E],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new r.V(`${h}[${E}]`,s[E],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let E=1;E<s.length;E++)x=x.concat(Ol({key:`${h}[${E}]`,value:s[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=r.n(s[1]),s.length!==2?x.push(new r.V(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new r.V(`${h}[1]`,s[1],`string expected, ${v} found`))}return x}function Ll(m,s){let h=m.key,g=m.style,v=m.layer,x=m.styleSpec,E=m.value,C=m.objectKey,M=x[`${s}_${m.layerType}`];if(!M)return[];let P=C.match(/^(.*)-transition$/);if(s==="paint"&&P&&M[P[1]]&&M[P[1]].transition)return $({key:h,value:E,valueSpec:x.transition,style:g,styleSpec:x});let O=m.valueSpec||M[C];if(!O)return[new r.m(h,E,`unknown property "${C}"`)];let N;if(r.n(E)==="string"&&r.q(O)&&!O.tokens&&(N=/^{([^}]+)}$/.exec(E))){let V=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new r.V(h,E,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}let B=[];if(m.layerType==="symbol")C!=="text-field"||!g||g.glyphs||g.imports||B.push(new r.V(h,E,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&r.H(r.v(E))&&r.u(E.type)==="identity"&&B.push(new r.V(h,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&s==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&r.q(O)&&(r.J(O)||r.r(O))){let V=r.x(r.v(E),O),G=V.value.expression||V.value._styleExpression.expression;G&&!r.A(G,["measure-light"])&&(C==="model-emissive-strength"&&r.B(G)&&r.z(G)||B.push(new r.V(h,E,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat($({key:m.key,value:E,valueSpec:O,style:g,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:C}))}function hd(m){return Ll(m,"paint")}function Fl(m){return Ll(m,"layout")}function uo(m){let s=[],h=m.value,g=m.key,v=m.style,x=m.styleSpec;h.type||h.ref||s.push(new r.V(g,h,'either "type" or "ref" is required'));let E=r.u(h.type),C=r.u(h.ref);if(h.id){let M=r.u(h.id);for(let P=0;P<m.arrayIndex;P++){let O=v.layers[P];r.u(O.id)===M&&s.push(new r.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${O.id.__line__}`))}}if("ref"in h){let M;["type","source","source-layer","filter","layout"].forEach(P=>{P in h&&s.push(new r.V(g,h[P],`"${P}" is prohibited for ref layers`))}),v.layers.forEach(P=>{r.u(P.id)===C&&(M=P)}),M?M.ref?s.push(new r.V(g,h.ref,"ref cannot reference another ref layer")):E=r.u(M.type):typeof C=="string"&&s.push(new r.V(g,h.ref,`ref layer "${C}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(h.source){let M=v.sources&&v.sources[h.source],P=M&&r.u(M.type);M?P==="vector"&&E==="raster"?s.push(new r.V(g,h.source,`layer "${h.id}" requires a raster source`)):P==="raster"&&E!=="raster"?s.push(new r.V(g,h.source,`layer "${h.id}" requires a vector source`)):P!=="vector"||h["source-layer"]?P==="raster-dem"&&E!=="hillshade"?s.push(new r.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(E)?E!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||P==="geojson"&&M.lineMetrics?E==="raster-particle"&&P!=="raster-array"&&s.push(new r.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):s.push(new r.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new r.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new r.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new r.V(g,h.source,`source "${h.source}" not found`))}else s.push(new r.V(g,h,'missing required property "source"'));return s=s.concat(Ii({key:g,value:h,valueSpec:x.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:m.style,styleSpec:m.styleSpec,object:h,objectKey:"type"}),filter:M=>Ks(r.o({layerType:E},M)),layout:M=>Ii({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>Fl(r.o({layerType:E},P))}}),paint:M=>Ii({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>hd(r.o({layerType:E,layer:h},P))}})}})),s}function Qs(m){let s=m.value,h=m.key,g=r.n(s);return g!=="string"?[new r.V(h,s,`string expected, ${g} found`)]:[]}let ho={promoteId:function({key:m,value:s}){if(r.n(s)==="string")return Qs({key:m,value:s});{let h=[];for(let g in s)h.push(...Qs({key:`${m}.${g}`,value:s[g]}));return h}}};function tr(m){let s=m.value,h=m.key,g=m.styleSpec,v=m.style;if(!s.type)return[new r.V(h,s,'"type" is required')];let x=r.u(s.type),E=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||E.push(new r.m(h,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Ii({key:h,value:s,valueSpec:g[`source_${x.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:ho})),E;case"geojson":if(E=Ii({key:h,value:s,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:ho}),s.cluster)for(let C in s.clusterProperties){let[M,P]=s.clusterProperties[C],O=typeof M=="string"?[M,["accumulated"],["get",C]]:M;E.push(...Zo({key:`${h}.${C}.map`,value:P,expressionContext:"cluster-map"})),E.push(...Zo({key:`${h}.${C}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return E;case"video":return Ii({key:h,value:s,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return Ii({key:h,value:s,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new r.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xs({key:`${h}.type`,value:s.type,valueSpec:{values:dd(g)},style:v,styleSpec:g})}}function dd(m){return m.source.reduce((s,h)=>{let g=m[h];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values))),s},[])}function za(m){let s=m.value,h=m.styleSpec,g=h.light,v=m.style,x=[],E=r.n(s);if(s===void 0)return x;if(E!=="object")return x=x.concat([new r.V("light",s,`object expected, ${E} found`)]),x;for(let C in s){let M=C.match(/^(.*)-transition$/);x=x.concat(M&&g[M[1]]&&g[M[1]].transition?$({key:C,value:s[C],valueSpec:h.transition,style:v,styleSpec:h}):g[C]?$({key:C,value:s[C],valueSpec:g[C],style:v,styleSpec:h}):[new r.V(C,s[C],`unknown property "${C}"`)])}return x}function Nl(m){let s=m.value,h=[];if(!s)return h;let g=r.n(s);if(g!=="object")return h=h.concat([new r.V("light-3d",s,`object expected, ${g} found`)]),h;let v=m.styleSpec,x=v["light-3d"],E=m.key,C=m.style,M=m.style.lights;for(let N of["type","id"])if(!(N in s))return h=h.concat([new r.V("light-3d",s,`missing property ${N} on light`)]),h;if(s.type&&M)for(let N=0;N<m.arrayIndex;N++){let B=r.u(s.type),V=M[N];r.u(V.type)===B&&h.push(new r.V(E,s.id,`duplicate light type "${s.type}", previously defined at line ${V.id.__line__}`))}let P=`properties_light_${s.type}`;if(!(P in v))return h=h.concat([new r.V("light-3d",s,`Invalid light type ${s.type}`)]),h;let O=v[P];for(let N in s)if(N==="properties"){let B=s[N],V=r.n(B);if(V!=="object")return h=h.concat([new r.V("properties",B,`object expected, ${V} found`)]),h;for(let G in B)h=h.concat(O[G]?$({key:G,value:B[G],valueSpec:O[G],style:C,styleSpec:v}):[new r.m(m.key,B[G],`unknown property "${G}"`)])}else{let B=N.match(/^(.*)-transition$/);h=h.concat(B&&x[B[1]]&&x[B[1]].transition?$({key:N,value:s[N],valueSpec:v.transition,style:C,styleSpec:v}):x[N]?$({key:N,value:s[N],valueSpec:x[N],style:C,styleSpec:v}):[new r.m(N,s[N],`unknown property "${N}"`)])}return h}function hu(m){let s=m.value,h=m.key,g=m.style,v=m.styleSpec,x=v.terrain,E=[],C=r.n(s);if(s===void 0||C==="null")return E;if(C!=="object")return E=E.concat([new r.V("terrain",s,`object expected, ${C} found`)]),E;for(let M in s){let P=M.match(/^(.*)-transition$/);E=E.concat(P&&x[P[1]]&&x[P[1]].transition?$({key:M,value:s[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?$({key:M,value:s[M],valueSpec:x[M],style:g,styleSpec:v}):[new r.m(M,s[M],`unknown property "${M}"`)])}if(s.source){let M=g.sources&&g.sources[s.source],P=M&&r.u(M.type);M?P!=="raster-dem"&&E.push(new r.V(h,s.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):E.push(new r.V(h,s.source,`source "${s.source}" not found`))}else E.push(new r.V(h,s,'terrain is missing required property "source"'));return E}function zl(m){let s=m.value,h=m.style,g=m.styleSpec,v=g.fog,x=[],E=r.n(s);if(s===void 0)return x;if(E!=="object")return x=x.concat([new r.V("fog",s,`object expected, ${E} found`)]),x;for(let C in s){let M=C.match(/^(.*)-transition$/);x=x.concat(M&&v[M[1]]&&v[M[1]].transition?$({key:C,value:s[C],valueSpec:g.transition,style:h,styleSpec:g}):v[C]?$({key:C,value:s[C],valueSpec:v[C],style:h,styleSpec:g}):[new r.m(C,s[C],`unknown property "${C}"`)])}return x}let ye={"*":()=>[],array:kl,boolean:function(m){let s=m.value,h=m.key,g=r.n(s);return g!=="boolean"?[new r.V(h,s,`boolean expected, ${g} found`)]:[]},number:Na,color:function(m){let s=m.key,h=m.value,g=r.n(h);return g!=="string"?[new r.V(s,h,`color expected, ${g} found`)]:r.F(h)===null?[new r.V(s,h,`color expected, "${h}" found`)]:[]},enum:Xs,filter:Ks,function:Wo,layer:uo,object:Ii,source:tr,model:r.K,light:za,"light-3d":Nl,terrain:hu,fog:zl,string:Qs,formatted:function(m){return Qs(m).length===0?[]:Zo(m)},resolvedImage:function(m){return Qs(m).length===0?[]:Zo(m)},projection:function(m){let s=m.value,h=m.styleSpec,g=h.projection,v=m.style,x=[],E=r.n(s);if(E==="object")for(let C in s)x=x.concat($({key:C,value:s[C],valueSpec:g[C],style:v,styleSpec:h}));else E!=="string"&&(x=x.concat([new r.V("projection",s,`object or string expected, ${E} found`)]));return x},import:function(m){let{value:s,styleSpec:h}=m,E=s,{data:g}=E,v=as(E,["data"]);Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let x=Ii(r.o({},m,{value:v,valueSpec:h.import}));return r.u(v.id)===""&&x.push(new r.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(oe(g,h,{key:`${m.key}.data`}))),x}};function $(m,s=!1){let h=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&r.H(r.u(h)))return Wo(m);if(g.expression&&r.t(r.v(h)))return Zo(m);if(g.type&&ye[g.type]){let x=ye[g.type](m);return s===!0&&x.length>0&&r.n(m.value)==="array"?Zo(m):x}return Ii(r.o({},m,{valueSpec:g.type?v[g.type]:g}))}function Z(m){let s=m.value,h=m.key,g=Qs(m);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new r.V(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new r.V(h,s,'"glyphs" url must include a "{range}" token'))),g}function oe(m,s=r.L,h={}){return $({key:h.key||"",value:m,valueSpec:s.$root,styleSpec:s,style:m,objectElementValidators:{glyphs:Z,"*":()=>[]}})}function de(m,s=r.L){return rn(oe(m,s))}let pe=m=>rn(tr(m)),we=m=>rn(za(m)),Ae=m=>rn(Nl(m)),ve=m=>rn(hu(m)),Pe=m=>rn(zl(m)),it=m=>rn(uo(m)),Qe=m=>rn(Ks(m)),yt=m=>rn(hd(m)),Mt=m=>rn(Fl(m)),en=m=>rn(r.K(m));function rn(m){return m.slice().sort((s,h)=>s.line&&h.line?s.line-h.line:0)}function Ht(m,s){let h=!1;if(s&&s.length)for(let g of s)g instanceof r.m?r.w(g.message):(m.fire(new r.d(new Error(g.message))),h=!0);return h}let hn=new r.N({anchor:new r.O(r.L.light.anchor),position:new r.Q(r.L.light.position),color:new r.O(r.L.light.color),intensity:new r.O(r.L.light.intensity)});class mt extends r.E{constructor(s,h="flat"){super(),this._transitionable=new r.U(hn),this.setLight(s,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h,g={}){this._validate(we,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=h)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&Ht(this,s.call(de,r.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}let si=new r.N({source:new r.O(r.L.terrain.source),exaggeration:new r.O(r.L.terrain.exaggeration)}),zn=class extends r.E{constructor(m,s,h,g){super(),this.scope=h,this._transitionable=new r.U(si,h,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new r.X(m)).get("exaggeration")}isZoomDependent(){let m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof r.Z}},gn=45,Ri=65,ai=.05;function Bi(m,s,h,g){let v=r.$(gn,Ri,h),[x,E]=fr(m,g),C=1-Math.min(1,Math.exp((s-x)/(E-x)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*v*m.alpha}function fr(m,s){let h=.5/Math.tan(.5*s);return[m.range[0]+h,m.range[1]+h]}function pr(m,s,h,g,v){let x=r._.transformMat4([],[s,h,g],v.mercatorFogMatrix);return Bi(m,r._.length(x),v.pitch,v._fov)}function Ba(m,s,h,g,v,x,E){let C=[[h,g,0],[v,g,0],[v,x,0],[h,x,0]],M=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let O of C){let N=r._.transformMat4([],O,s),B=r._.length(N);M=Math.min(M,B),P=Math.max(P,B)}return[Bi(m,M,E.pitch,E._fov),Bi(m,P,E.pitch,E._fov)]}let Rp=new r.N({range:new r.O(r.L.fog.range),color:new r.O(r.L.fog.color),"high-color":new r.O(r.L.fog["high-color"]),"space-color":new r.O(r.L.fog["space-color"]),"horizon-blend":new r.O(r.L.fog["horizon-blend"]),"star-intensity":new r.O(r.L.fog["star-intensity"]),"vertical-range":new r.O(r.L.fog["vertical-range"])});class ty extends r.E{constructor(s,h,g,v){super(),this._transitionable=new r.U(Rp,g,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new r.a0(Rp),this.scope=g}get state(){let s=this._transform,h=s.projection.name==="globe",g=r.a1(s.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[r.a2(x[0],v[0],g),r.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h,g={}){if(this._validate(Pe,s,g))return;let v=r.W({},s);for(let x of Object.keys(r.L.fog))v[x]===void 0&&(v[x]=r.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.$(gn,Ri,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,v,x){let E=r.Y.fromLngLat(v),C=x.elevation?x.elevation.getAtPointOrZero(E):0;return pr(g,E.x,E.y,C,x)}(this.state,s,h):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Ba(this.state,h,0,0,r.a3,r.a3,this._transform)}getOpacityForBounds(s,h,g,v,x){return this._transform.projection.supportsFog?Ba(this.state,s,h,g,v,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?fr(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let g of h){let v=s.points[g],x;if(v[2]>=0)x=v;else{let E=s.points[g-4];x=r.a4(E,v,E[2]/(E[2]-v[2]))}if(pr(this.state,x[0],x[1],0,this._transform)>=ai)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&Ht(this,s.call(de,r.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}class du extends r.E{constructor(s,h,g,v){super(),this.scope=g,this._options=s,this.properties=new r.a0(h),this._transitionable=new r.U(h,g,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,h){this._options=s,this._transitionable.setTransitionOrValue(s.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Kt=new r.N({color:new r.O(r.L.properties_light_ambient.color),intensity:new r.O(r.L.properties_light_ambient.intensity)}),kp=new r.N({direction:new r.a5(r.L.properties_light_directional.direction),color:new r.O(r.L.properties_light_directional.color),intensity:new r.O(r.L.properties_light_directional.intensity),"cast-shadows":new r.O(r.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.O(r.L.properties_light_directional["shadow-intensity"])});var Js=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Op=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Lp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Fp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Np=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,zp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Bp=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Vp=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Up=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ny=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Bl=[];Vl(Js,Bl),Vl(Lp,Bl),Vl(Op,Bl);let fd={"_prelude_fog.vertex.glsl":zp,"_prelude_terrain.vertex.glsl":Np,"_prelude_shadow.vertex.glsl":Up,"_prelude_fog.fragment.glsl":Bp,"_prelude_shadow.fragment.glsl":ny,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Vp,"_prelude_raster_particle.glsl":jp},pd={};ln("",Np),ln(Bp,zp),ln(ny,Up),ln(Vp,""),ln(jp,"");let iy=ln(Op,Lp),ry=Js;var oy={background:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ln("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ln(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ln("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ln("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ln(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ln(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ln(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ln("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ln("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ln(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:ln(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ln("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ln(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fp),skyboxGradient:ln(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fp),skyboxCapture:ln(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ln(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ln(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:ln("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Vl(m,s){let h=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)s.includes(x)||s.push(x)}}function ln(m,s){let h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(P=>{let O=P.split(" ");return O[O.length-1]}),v=[...new Set(v)]);let x={},E=[],C=[];if(m=m.replace(h,(P,O)=>(C.push(O),"")),(s=s.replace(h,(P,O)=>(E.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...Bl];Vl(m,M),Vl(s,M);for(let P of[...E,...C])fd[P]||console.error(`Undefined include: ${P}`),pd[P]||(pd[P]=[],Vl(fd[P],pd[P])),M=[...M,...pd[P]];return{fragmentSource:m=m.replace(g,(P,O,N,B,V)=>(x[V]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} ${V};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(g,(P,O,N,B,V)=>{let G=B==="float"?"vec2":B,H=V.match(/color/)?"color":G;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${N} ${B} a_${V};
#endif
`:x[V]?O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
out ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} a_${V};
    out ${N} ${B} ${V};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${N} ${B} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${N} ${B} ${V} = a_${V};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:v,usedDefines:M,vertexIncludes:E,fragmentIncludes:C}}class l1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,v,x,E,C,M){this.context=s;let P=this.boundPaintVertexBuffers.length!==v.length;for(let N=0;!P&&N<v.length;N++)this.boundPaintVertexBuffers[N]!==v[N]&&(P=!0);let O=this.boundDynamicVertexBuffers.length!==C.length;for(let N=0;!O&&N<C.length;N++)this.boundDynamicVertexBuffers[N]!==C[N]&&(O=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||P||O||this.boundIndexBuffer!==x||this.boundVertexOffset!==E)this.freshBind(h,g,v,x,E,C,M);else{s.bindVertexArrayOES.set(this.vao);for(let N of C)N&&(N.bind(),M&&N.instanceCount&&N.setVertexAttribDivisor(s.gl,h,M));x&&x.dynamicDraw&&x.bind()}}freshBind(s,h,g,v,x,E,C){let M=s.numAttributes,P=this.context,O=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=E,h.enableAttributes(O,s),h.bind(),h.setVertexAttribPointers(O,s,x);for(let N of g)N.enableAttributes(O,s),N.bind(),N.setVertexAttribPointers(O,s,x);for(let N of E)N&&(N.enableAttributes(O,s),N.bind(),N.setVertexAttribPointers(O,s,x),C&&N.instanceCount&&N.setVertexAttribDivisor(O,s,C));v&&v.bind(),P.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function c1(m,s){let h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new r.Y(0,g/h).toLngLat().lat,new r.Y(0,(g+1)/h).toLngLat().lat]}function u1(m,s,h,g,v,x,E){let C=m.context,M=C.gl,P=h.hillshadeFBO;if(!P)return;m.prepareDrawTile();let O=m.isTileAffectedByFog(s),N=m.getOrCreateProgram("hillshade",{overrideFog:O});C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get());let B=((q,W,ee,te)=>{let ne=ee.paint.get("hillshade-shadow-color"),ue=ee.paint.get("hillshade-highlight-color"),ce=ee.paint.get("hillshade-accent-color"),J=ee.paint.get("hillshade-emissive-strength"),ie=r.ab(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")ie-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let ge=q.style.directionalLight.properties.get("direction"),Ce=r.ac(ge.x,ge.y,ge.z);ie=r.ab(Ce[1])}let re=!q.options.moving;return{u_matrix:te||q.transform.calculateProjMatrix(W.tileID.toUnwrapped(),re),u_image:0,u_latrange:c1(0,W.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),ie],u_shadow:ne.toRenderColor(ee.lut),u_highlight:ue.toRenderColor(ee.lut),u_emissive_strength:J,u_accent:ce.toRenderColor(ee.lut)}})(m,h,g,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(C,N,s.toUnwrapped());let{tileBoundsBuffer:V,tileBoundsIndexBuffer:G,tileBoundsSegments:H}=m.getTileBoundsBuffers(h);N.draw(m,M.TRIANGLES,v,x,E,r.af.disabled,B,g.id,V,G,H)}function $p(m,s,h){if(!s.needsDEMTextureUpload)return;let g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(h.stride);let x=h.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new r.T(g,x,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Yo(m,s,h){let g=m.context,v=g.gl;if(!s.dem)return;let x=s.dem;if(g.activeTexture.set(v.TEXTURE1),$p(m,s,x),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let E=x.dim;g.activeTexture.set(v.TEXTURE0);let C=s.hillshadeFBO;if(!C){let B=new r.T(g,{width:E,height:E,data:null},v.RGBA);B.bind(v.LINEAR,v.CLAMP_TO_EDGE),C=s.hillshadeFBO=g.createFramebuffer(E,E,!0,"renderbuffer"),C.colorAttachment.set(B.texture)}g.bindFramebuffer.set(C.framebuffer),g.viewport.set([0,0,E,E]);let{tileBoundsBuffer:M,tileBoundsIndexBuffer:P,tileBoundsSegments:O}=m.getMercatorTileBoundsBuffers(),N=[];m.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(m,v.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,((B,V)=>{let G=V.stride,H=r.ad.create();return r.ad.ortho(H,0,r.a3,-r.a3,0,0,1),r.ad.translate(H,H,[0,-r.a3,0]),{u_matrix:H,u_image:1,u_dimension:[G,G],u_zoom:B.overscaledZ}})(s.tileID,x),h.id,M,P,O),s.needsHillshadePrepare=!1}function Gp(m,s,h,g,v){let x=function(E,C){if(E)return v(E);if(C){if(m.url&&C.tiles&&m.tiles&&delete m.tiles,C.variants){if(!Array.isArray(C.variants))return v(new Error("variants must be an array"));for(let P of C.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return v(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){C=r.W(C,P);break}}}let M=r.ah(r.W(C,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(M.vectorLayers=C.vector_layers,M.vectorLayerIds=M.vectorLayers.map(P=>P.id)),C.raster_layers&&(M.rasterLayers=C.raster_layers,M.rasterLayerIds=M.rasterLayers.map(P=>P.id)),M.tiles=s.canonicalizeTileset(M,m.url),v(null,M)}};return m.url?r.g(s.transformRequest(s.normalizeSourceURL(m.url,null,h,g),r.R.Source),x):r.e.frame(()=>x(null,m))}class fu{constructor(s,h,g){this.bounds=r.ai.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){let h=Math.pow(2,s.z),g=Math.floor(r.aj(this.bounds.getWest())*h),v=Math.floor(r.ak(this.bounds.getNorth())*h),x=Math.ceil(r.aj(this.bounds.getEast())*h),E=Math.ceil(r.ak(this.bounds.getSouth())*h);return s.x>=g&&s.x<x&&s.y>=v&&s.y<E}}class pu extends r.E{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.W({type:"raster"},h),r.W(this,r.ah(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Gp(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new r.d(h)):g&&(r.W(this,g),g.bounds&&(this.tileBounds=new fu(g.bounds,this.minzoom,this.maxzoom)),r.an(g.tiles),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){let g=r.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=r.h(this.map._requestManager.transformRequest(v,r.R.Tile),(x,E,C,M)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):x?(s.state="errored",h(x)):E?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:M}),s.setTexture(E,this.map.painter),s.state="loaded",r.am(this.dispatcher),void h(null)):h(null)))}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h&&h()}unloadTile(s,h){s.texture&&s.texture instanceof r.T?(s.destroy(!0),s.texture&&s.texture instanceof r.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class md extends r.E{constructor(s,h,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.W(this,r.ah(h,["url","scheme","tileSize","promoteId"])),this._options=r.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.ao}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Gp(this._options,this.map._requestManager,h,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new r.d(v))):x&&(r.W(this,x),x.bounds&&(this.tileBounds=new fu(x.bounds,this.minzoom,this.maxzoom)),r.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,E={request:v,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(E.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",E,C.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",E,C.bind(this),void 0,!0);else{let M=r.ap.call({deduped:this._deduped},E,(P,O)=>{P||!O?C.call(this,P):(E.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},s.actor&&s.actor.send("loadTile",E,C.bind(this),void 0,!0))},!0);s.request={cancel:M}}function C(M,P){return delete s.request,s.aborted?h(null):M&&M.status!==404?h(M):(P&&P.resourceTiming&&(s.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&s.setExpiryData(P),s.loadVectorData(P,this.map.painter),r.am(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Va=m=>({u_matrix:new r.a6(m),u_image0:new r.a7(m),u_skirt_height:new r.aa(m),u_ground_shadow_factor:new r.aq(m)}),lt=(m,s,h)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:h}),sy=(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:E,u_frustum_tr:C,u_frustum_br:M,u_frustum_bl:P,u_globe_pos:O,u_globe_radius:N,u_viewport:B,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:G});class mu{constructor(s=0,h=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=v}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=r.a2(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=r.a2(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=r.a2(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=r.a2(s.right,h.right,g)),this}getCenter(s,h){let g=r.at((this.left+s-this.right)/2,0,s),v=r.at((this.top+h-this.bottom)/2,0,h);return new r.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new mu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function dn(m,s){let h=r.aw(m,3);r.ad.fromQuat(m,s),r.az(m,3,h)}function mr(m,s){let h=r.av.identity([]);return r.av.rotateZ(h,h,-s),r.av.rotateX(h,h,-m),h}function ay(m,s){let h=[m[0],m[1],0],g=[s[0],s[1],0];if(r._.length(h)>=1e-15){let E=r._.normalize([],h);r._.scale(g,E,r._.dot(g,E)),s[0]=g[0],s[1]=g[1]}let v=r._.cross([],s,m);if(r._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return mr(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),x)}class Hp{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){let h=s instanceof r.Y?s:new r.Y(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=r.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.Y.fromLngLat(s)):0,x=r.Y.fromLngLat(s,v),E=[x.x-g.x,x.y-g.y,x.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=ay(E,h)}setPitchBearing(s,h){this.orientation=mr(r.ab(s),r.ab(-h))}}class gu{constructor(s,h){this._transform=r.ad.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){let s=this.position;return new r.Y(s[0],s[1],s[2])}get position(){let s=r.aw(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&r.az(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||r.av.identity([]),s&&dn(this._transform,this._orientation)}getPitchBearing(){let s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=mr(s,h),dn(this._transform,this._orientation)}forward(){let s=r.aw(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){let s=r.aw(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){let s=r.aw(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){let g=new Float64Array(16);return r.ad.invert(g,this.getWorldToCamera(s,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,h,g){let v=this.position;r._.scale(v,v,-s);let x=new Float64Array(16);return r.ad.fromScaling(x,[g,g,g]),r.ad.translate(x,x,v),x[10]*=h,x}getWorldToCamera(s,h){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return r.av.conjugate(v,this._orientation),r._.scale(x,x,-s),r.ad.fromQuat(g,v),r.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,v){let x=new Float64Array(16);return r.ad.perspective(x,s,h,g,v),x}getCameraToClipOrthographic(s,h,g,v,x,E){let C=new Float64Array(16);return r.ad.ortho(C,s,h,g,v,x,E),C}getDistanceToElevation(s,h=!1){let g=s===0?0:r.ax(s,h?r.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new gu([...this.position],[...this.orientation])}}let jl={unknown:0,flipRequired:1,flipNotRequired:2},tn=Math.tan(85*Math.PI/180);function ja(m,s,h,g,v,x,E){let C=r.ad.create();if(h)if(x.name==="globe"){let M=r.aB(v,s);r.ad.multiply(C,C,M)}else{let M=r.aC.invert([],E);C[0]=M[0],C[1]=M[1],C[4]=M[2],C[5]=M[3],g||r.ad.rotateZ(C,C,v.angle)}else r.ad.multiply(C,v.labelPlaneMatrix,m);return C}function Ua(m,s,h,g,v,x,E){let C=ja(m,s,h,g,v,x,E);return x.name==="globe"&&h||(C[2]=C[6]=C[10]=C[14]=0),C}function Ul(m,s,h,g,v,x,E){if(h){if(x.name==="globe"){let C=ja(m,s,h,g,v,x,E);return r.ad.invert(C,C),r.ad.multiply(C,m,C),C}{let C=r.ad.clone(m),M=r.ad.identity([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],r.ad.multiply(C,C,M),g||r.ad.rotateZ(C,C,-v.angle),C}}return v.glCoordMatrix}function fo(m,s,h,g){let v=[m,s,h,1];h?r.aA.transformMat4(v,v,g):Xo(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function gr(m,s){return Math.min(.5+m/s*.5,1.5)}function h1(m,s){let h=m[0]/m[3],g=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function gd(m,s,h,g,v,x,E,C,M,P){let O=h.transform,N=g?m.textSizeData:m.iconSizeData,B=r.aD(N,h.transform.zoom),V=O.projection.name==="globe",G=[256/h.width*2+1,256/h.height*2+1],H=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();let q=null;V&&(q=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);let W=m.lineVertexArray,ee=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,te=h.transform.width/h.transform.height,ne,ue=!1;for(let ce=0;ce<ee.length;ce++){let J=ee.get(ce),{numGlyphs:ie,writingMode:re}=J;if(re!==r.aE.vertical||ue||ne===r.aE.horizontal||(ue=!0),ne=re,(J.hidden||re===r.aE.vertical)&&!ue){$a(ie,H);continue}ue=!1;let ge=new r.P(J.tileAnchorX,J.tileAnchorY),{x:Ce,y:ae,z:Ie}=O.projection.projectTilePoint(ge.x,ge.y,P.canonical);if(M){let[at,je,He]=M(ge);Ce+=at,ae+=je,Ie+=He}let Me=[Ce,ae,Ie,1];if(r.aA.transformMat4(Me,Me,s),!h1(Me,G)){$a(ie,H);continue}let $e=Me[3],Ge=gr(h.transform.getCameraToCenterDistance(O.projection),$e),Ve=r.aF(N,B,J),xe=E?Ve/Ge:Ve*Ge,Re=fo(Ce,ae,Ie,v);if(Re[3]<=0){$a(ie,H);continue}let Ne={},ot=E?null:M,ct=Wp(J,xe,!1,C,s,v,x,m.glyphOffsetArray,W,H,q,Re,ge,Ne,te,ot,O.projection,P,E);ue=ct.useVertical,ot&&ct.needsFlipping&&(Ne={}),(ct.notEnoughRoom||ue||ct.needsFlipping&&Wp(J,xe,!0,C,s,v,x,m.glyphOffsetArray,W,H,q,Re,ge,Ne,te,ot,O.projection,P,E).notEnoughRoom)&&$a(ie,H)}g?(m.text.dynamicLayoutVertexBuffer.updateData(H),q&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(q)):(m.icon.dynamicLayoutVertexBuffer.updateData(H),q&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(q))}function _d(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H){let{lineStartIndex:q,glyphStartIndex:W,segment:ee}=C,te=W+C.numGlyphs,ne=q+C.lineLength,ue=s.getoffsetX(W),ce=s.getoffsetX(te-1),J=$l(m*ue,h,g,v,x,E,ee,q,ne,M,P,O,N,B,!0,V,G,H);if(!J)return null;let ie=$l(m*ce,h,g,v,x,E,ee,q,ne,M,P,O,N,B,!0,V,G,H);return ie?{first:J,last:ie}:null}function qp(m,s,h,g){return m===r.aE.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:m===r.aE.vertical?g>0?{needsFlipping:!0}:null:s!==jl.unknown&&function(v,x){return v===0||Math.abs(x/v)>tn}(h,g)?s===jl.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Wp(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q,W,ee){let te=s/24,ne=m.lineOffsetX*te,ue=m.lineOffsetY*te,{lineStartIndex:ce,glyphStartIndex:J,numGlyphs:ie,segment:re,writingMode:ge,flipState:Ce}=m,ae=ce+m.lineLength,Ie=Me=>{if(O){let[xe,Re,Ne]=Me.up,ot=P.length;r.aG(O,ot+0,xe,Re,Ne),r.aG(O,ot+1,xe,Re,Ne),r.aG(O,ot+2,xe,Re,Ne),r.aG(O,ot+3,xe,Re,Ne)}let[$e,Ge,Ve]=Me.point;r.aH(P,$e,Ge,Ve,Me.angle)};if(ie>1){let Me=_d(te,C,ne,ue,h,N,B,m,M,x,V,H,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};if(g&&!h){let[$e,Ge,Ve]=Me.first.point,[xe,Re,Ne]=Me.last.point;[$e,Ge]=fo($e,Ge,Ve,E),[xe,Re]=fo(xe,Re,Ne,E);let ot=qp(ge,Ce,(xe-$e)*G,Re-Ge);if(m.flipState=ot&&ot.needsFlipping?jl.flipRequired:jl.flipNotRequired,ot)return ot}Ie(Me.first);for(let $e=J+1;$e<J+ie-1;$e++){let Ge=$l(te*C.getoffsetX($e),ne,ue,h,N,B,re,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Ge)return P.length-=4*($e-J),{notEnoughRoom:!0};Ie(Ge)}Ie(Me.last)}else{if(g&&!h){let $e=fo(B.x,B.y,0,v),Ge=ce+re+1,Ve=new r.P(M.getx(Ge),M.gety(Ge)),xe=fo(Ve.x,Ve.y,0,v),Re=xe[3]>0?xe:_u(B,Ve,$e,1,v,void 0,q,W.canonical),Ne=qp(ge,Ce,(Re[0]-$e[0])*G,Re[1]-$e[1]);if(m.flipState=Ne&&Ne.needsFlipping?jl.flipRequired:jl.flipNotRequired,Ne)return Ne}let Me=$l(te*C.getoffsetX(J),ne,ue,h,N,B,re,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};Ie(Me)}return{}}function yd(m,s,h,g,v){let{x,y:E,z:C}=g.projectTilePoint(m.x,m.y,s);if(!v)return fo(x,E,C,h);let[M,P,O]=v(m);return fo(x+M,E+P,C+O,h)}function _u(m,s,h,g,v,x,E,C){let M=yd(m.sub(s)._unit()._add(m),C,v,E,x);return r._.sub(M,h,M),r._.normalize(M,M),r._.scaleAndAdd(M,h,M,g)}function $l(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q,W){let ee=g?m-s:m+s,te=ee>0?1:-1,ne=0;g&&(te*=-1,ne=Math.PI),te<0&&(ne+=Math.PI);let ue=C+E+(te>0?0:1)|0,ce=v,J=v,ie=0,re=0,ge=Math.abs(ee),Ce=[],ae=[],Ie=x,Me=Ie,$e=()=>_u(Me,Ie,J,ge-ie+1,O,B,H,q.canonical);for(;ie+re<=ge;){if(ue+=te,ue<C||ue>=M)return null;if(J=ce,Me=Ie,Ce.push(J),V&&ae.push(Me),Ie=new r.P(P.getx(ue),P.gety(ue)),ce=N[ue],!ce){let je=yd(Ie,q.canonical,O,H,B);ce=je[3]>0?N[ue]=je:$e()}ie+=re,re=r._.distance(J,ce)}G&&B&&(N[ue]&&(ce=$e(),re=r._.distance(J,ce)),N[ue]=ce);let Ge=(ge-ie)/re,Ve=Ie.sub(Me)._mult(Ge)._add(Me),xe=r._.sub([],ce,J),Re=r._.scaleAndAdd([],J,xe,Ge),Ne=[0,0,1],ot=xe[0],ct=xe[1];if(W&&(Ne=H.upVector(q.canonical,Ve.x,Ve.y),Ne[0]!==0||Ne[1]!==0||Ne[2]!==1)){let je=[Ne[2],0,-Ne[0]],He=r._.cross([],Ne,je);r._.normalize(je,je),r._.normalize(He,He),ot=r._.dot(xe,je),ct=r._.dot(xe,He)}if(h){let je=r._.cross([],Ne,xe);r._.normalize(je,je),r._.scaleAndAdd(Re,Re,je,h*te)}let at=ne+Math.atan2(ct,ot);return Ce.push(Re),V&&ae.push(Ve),{point:Re,angle:at,path:Ce,tilePath:ae,up:Ne}}function $a(m,s){let h=s.length,g=h+4*m;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function Xo(m,s,h){let g=s[0],v=s[1];return m[0]=h[0]*g+h[4]*v+h[12],m[1]=h[1]*g+h[5]*v+h[13],m[3]=h[3]*g+h[7]*v+h[15],m}let Zp=(m,s,h)=>(1-h)*m+h*s,ki=m=>m*m*m*m*m;class Ko{constructor(s,h,g,v,x,E,C){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new r.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new mu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new gu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let s=new Ko(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,h=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return r.ah(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=r.aJ(this.projectionOptions);let g=!w(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){let s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.aJ({name:"mercator"});let h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.au(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){let h=-s*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=r.aC.create(),r.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){let h=r.at(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=r.ab(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){let h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){let s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let E=0;E<h.length;E++){let C=new r.P(h[E][0]*this.width,g+h[E][1]*(this.height-g)),M=s.pointCoordinate(C);if(!M)continue;let P=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);v+=M[3]*P,x+=P}return x===0?NaN:v/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude())),g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];let v=r._.length(r._.sub([],this._camera.position,g));return r.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!r.av.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){let g=[s.position.x,s.position.y,s.position.z];r._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let s=this._camera.position,h=new Hp;return h.position=new r.Y(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!r.av.length(s))return!1;r.av.normalize(s,s);let h=r._.transformQuat([],[0,0,-1],s),g=r._.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;let v=ay(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){let h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=r.at(s[2],v/g,v/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){let h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){let h=[new r.aK(0,s)];if(this.renderWorldCopies){let g=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),E=this.pointCoordinate(new r.P(0,this.height)),C=Math.floor(Math.min(g.x,v.x,x.x,E.x)),M=Math.floor(Math.max(g.x,v.x,x.x,E.x)),P=1;for(let O=C-P;O<=M+P;O++)O!==0&&h.push(new r.aK(O,s))}return h}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(s,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(let E of s){let C=E.canonical,M=E.overscaledZ,P=E.wrap,O=1<<C.z,N=C.x+1<O,B=C.x>0,V=C.y+1<O,G=C.y>0,H=E.wrap-(B?0:1),q=E.wrap+(N?0:1),W=B?C.x-1:O-1,ee=N?C.x+1:0;h[0]<0?(v.push(new r.aL(M,q,C.z,ee,C.y)),h[1]<0&&V&&(v.push(new r.aL(M,P,C.z,C.x,C.y+1)),v.push(new r.aL(M,q,C.z,ee,C.y+1))),h[1]>0&&G&&(v.push(new r.aL(M,P,C.z,C.x,C.y-1)),v.push(new r.aL(M,q,C.z,ee,C.y-1)))):h[0]>0?(v.push(new r.aL(M,H,C.z,W,C.y)),h[1]<0&&V&&(v.push(new r.aL(M,P,C.z,C.x,C.y+1)),v.push(new r.aL(M,H,C.z,W,C.y+1))),h[1]>0&&G&&(v.push(new r.aL(M,P,C.z,C.x,C.y-1)),v.push(new r.aL(M,H,C.z,W,C.y-1)))):h[1]<0&&V?v.push(new r.aL(M,P,C.z,C.x,C.y+1)):G&&v.push(new r.aL(M,P,C.z,C.x,C.y-1))}if(v.length>1){v.sort((M,P)=>M.overscaledZ-P.overscaledZ||M.wrap-P.wrap||M.canonical.z-P.canonical.z||M.canonical.x-P.canonical.x||M.canonical.y-P.canonical.y);let E=0,C=0;for(;C<v.length;)v[C].equals(v[E])?++C:v[++E]=v[C++];v.length=E+1}let x=[];for(let E of v)v.some(C=>E.isChildOf(C))||x.push(E);return v=x.filter(E=>!s.some(C=>!!(E.overscaledZ<g&&C.isChildOf(E))||E.equals(C)||E.isChildOf(C))),v}coveringTiles(s){let h=this.coveringZoomLevel(s),g=h,v=this.elevation&&this.elevation.exaggeration(),x=v&&!s.isTerrainDEM,E=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);let C=this.locationCoordinate(this.center),M=this.center.lat,P=1<<h,O=[P*C.x,P*C.y,0],N=this.projection.name==="globe",B=!N,V=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,B),G=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=P*r.ax(1,this.center.lat),q=this._camera.position[2]/r.ax(1,this.center.lat),W=[P*G.x,P*G.y,q*(B?1:H)],ee=N||v,te=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ne=this.isLODDisabled(!0)?h:0,ue;if(this._elevation&&s.isTerrainDEM)ue=1e4*this._elevation.exaggeration();else if(this._elevation){let xe=this._elevation.getMinMaxForVisibleTiles();ue=xe?xe.max:this._centerAltitude}else ue=this._centerAltitude;let ce=s.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,J=this.projection.isReprojectedInTileSpace?r.aN(this):1,ie=xe=>{let Ne=new r.Y(xe.x+25e-6,xe.y,xe.z),ot=new r.Y(xe.x,xe.y+25e-6,xe.z),ct=xe.toLngLat(),at=Ne.toLngLat(),je=ot.toLngLat(),He=this.locationCoordinate(ct),st=this.locationCoordinate(at),pt=this.locationCoordinate(je),Lt=Math.hypot(st.x-He.x,st.y-He.y),Wt=Math.hypot(pt.x-He.x,pt.y-He.y);return Math.sqrt(Lt*Wt)*J/25e-6},re=xe=>{let Re=ue,Ne=ce;return{aabb:r.aQ(this,P,0,0,0,xe,Ne,Re,this.projection),zoom:0,x:0,y:0,minZ:Ne,maxZ:Re,wrap:xe,fullyVisible:!1}},ge=[],Ce=[],ae=h,Ie=s.reparseOverscaled?g:h,Me=xe=>xe*xe,$e=Me((q-this._centerAltitude)*H),Ge=xe=>{if(!this._elevation||!xe.tileID||!E)return;let Re=this._elevation.getMinMaxForTile(xe.tileID),Ne=xe.aabb;Re?(Ne.min[2]=Re.min,Ne.max[2]=Re.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(xe.shouldSplit=Ve(xe),xe.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},Ve=xe=>{if(xe.zoom<ne)return!0;if(xe.zoom===ae)return!1;if(xe.shouldSplit!=null)return xe.shouldSplit;let Re=xe.aabb.distanceX(W),Ne=xe.aabb.distanceY(W),ot=$e,ct=1;if(N){ot=Me(xe.aabb.distanceZ(W));let He=Math.pow(2,xe.zoom),st=r.ay((xe.y+1)/He),pt=r.ay(xe.y/He),Lt=Math.min(Math.max(M,st),pt),Wt=r.b4(Lt)/r.b4(M);if(ct=Lt===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Wt/this._mercatorScaleRatio),this.zoom<=r.b1&&xe.zoom===ae-1&&Wt>=.9)return!0}else if(x&&(ot=Me(xe.aabb.distanceZ(W)*H)),this.projection.isReprojectedInTileSpace&&g<=5){let He=Math.pow(2,xe.zoom),st=ie(new r.Y((xe.x+.5)/He,(xe.y+.5)/He));ct=st>.85?1:st}let at=Re*Re+Ne*Ne+ot,je=Me((1<<ae-xe.zoom)*te*ct*((He,st)=>{if(st*Me(.707)<He)return 1;let pt=Math.sqrt(st/He);return pt/(1.4144271570014144+(Math.pow(1.1,pt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ot,$e),at));return at<je};if(this.renderWorldCopies)for(let xe=1;xe<=3;xe++)ge.push(re(-xe)),ge.push(re(xe));for(ge.push(re(0));ge.length>0;){let xe=ge.pop(),Re=xe.x,Ne=xe.y,ot=xe.fullyVisible,ct=()=>this.projection.name==="globe"&&(xe.y===0||xe.y===(1<<xe.zoom)-1);if(!ot){let at=ee?xe.aabb.intersects(V):xe.aabb.intersectsFlat(V);if(at===0&&ct()){let je=new r.aO(xe.zoom,Re,Ne);at=r.aP(this,P,je,!0).intersects(V)}if(at===0)continue;ot=at===2}if(xe.zoom!==ae&&Ve(xe))for(let at=0;at<4;at++){let je=(Re<<1)+at%2,He=(Ne<<1)+(at>>1),st={aabb:E?xe.aabb.quadrant(at):r.aQ(this,P,xe.zoom+1,je,He,xe.wrap,xe.minZ,xe.maxZ,this.projection),zoom:xe.zoom+1,x:je,y:He,wrap:xe.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:xe.minZ,maxZ:xe.maxZ};x&&!N&&(st.tileID=new r.aL(xe.zoom+1===ae?Ie:xe.zoom+1,xe.wrap,xe.zoom+1,je,He),Ge(st)),ge.push(st)}else{let at=xe.zoom===ae?Ie:xe.zoom;if(s.minzoom&&s.minzoom>at)continue;if(!ot){let pt=ee?xe.aabb.intersectsPrecise(V):xe.aabb.intersectsPreciseFlat(V);if(pt===0&&ct()){let Lt=new r.aO(xe.zoom,Re,Ne);pt=r.aP(this,P,Lt,!0).intersectsPrecise(V)}if(pt===0)continue}let je=O[0]-(.5+Re+(xe.wrap<<xe.zoom))*(1<<h-xe.zoom),He=O[1]-.5-Ne,st=xe.tileID?xe.tileID:new r.aL(at,xe.wrap,xe.zoom,Re,Ne);Ce.push({tileID:st,distanceSq:je*je+He*He})}}if(this.fogCullDistSq){let xe=this.fogCullDistSq,Re=this.horizonLineFromTop();Ce=Ce.filter(Ne=>{let ot=[0,0,0,1],ct=[r.a3,r.a3,0,1],at=this.calculateFogTileMatrix(Ne.tileID.toUnwrapped());r.aA.transformMat4(ot,ot,at),r.aA.transformMat4(ct,ct,at);let je=r.aA.min([],ot,ct),He=r.aA.max([],ot,ct),st=r.aR(je,He);if(st===0)return!0;let pt=!1,Lt=this._elevation;if(Lt&&st>xe&&Re!==0){let Wt=this.calculateProjMatrix(Ne.tileID.toUnwrapped()),fn;s.isTerrainDEM||(fn=Lt.getMinMaxForTile(Ne.tileID)),fn||(fn={min:ce,max:ue});let cn=r.b2(this.rotation),kn=[cn[0]*r.a3,cn[1]*r.a3,fn.max];r._.transformMat4(kn,kn,Wt),pt=(1-kn[1])*this.height*.5<Re}return st<xe||pt})}return Ce.sort((xe,Re)=>xe.distanceSq-Re.distanceSq).map(xe=>xe.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){let h=r.at(s.lat,-r.aS,r.aS),g=this.projection.project(s.lng,h);return new r.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let C=this.worldSize;g=(h.x-x.x)/C,v=(h.y-x.y)/C}else{let C=this.pointCoordinate(h),M=this.pointCoordinate(x);g=C.x-M.x,v=C.y-M.y}let E=this.locationCoordinate(s);this.setLocation(new r.Y(E.x-g,E.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){let g=h?r.ax(h,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new r.Y(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){let g=h??this._centerAltitude,v=[s.x,s.y,0,1],x=[s.x,s.y,1,1];r.aA.transformMat4(v,v,this.pixelMatrixInverse),r.aA.transformMat4(x,x,this.pixelMatrixInverse);let E=x[3];r.aA.scale(v,v,1/v[3]),r.aA.scale(x,x,1/E);let C=v[2],M=x[2];return{p0:v,p1:x,t:C===M?0:(g-C)/(M-C)}}screenPointToMercatorRay(s){let h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return r.aA.transformMat4(h,h,this.pixelMatrixInverse),r.aA.transformMat4(g,g,this.pixelMatrixInverse),r.aA.scale(h,h,1/h[3]),r.aA.scale(g,g,1/g[3]),h[2]=r.ax(h[2],this._center.lat)*this.worldSize,g[2]=r.ax(g[2],this._center.lat)*this.worldSize,r.aA.scale(h,h,1/this.worldSize),r.aA.scale(g,g,1/this.worldSize),new r.aT([h[0],h[1],h[2]],r._.normalize([],r._.sub([],g,h)))}rayIntersectionCoordinate(s){let{p0:h,p1:g,t:v}=s,x=r.ax(h[2],this._center.lat),E=r.ax(g[2],this._center.lat);return new r.Y(r.a2(h[0],g[0],v)/this.worldSize,r.a2(h[1],g[1],v)/this.worldSize,r.a2(x,E,v))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new r.Y(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);let x=.02*v,E=s.clone();for(let C=0;C<10&&v-g>x;C++){E.y=r.a2(g,v,.66);let M=this.projection.pointCoordinate3D(this,E.x,E.y);M?(v=E.y,h=M):g=E.y}return h?new r.Y(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=r.aU)return!this.isPointAboveHorizon(s);let h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){let g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return r.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(h,s)),E=this.pointLocation3D(new r.P(v,s)),C=this.pointLocation3D(new r.P(v,g)),M=this.pointLocation3D(new r.P(h,g)),P=Math.min(x.lng,E.lng,C.lng,M.lng),O=Math.max(x.lng,E.lng,C.lng,M.lng),N=Math.min(x.lat,E.lat,C.lat,M.lat),B=Math.max(x.lat,E.lat,C.lat,M.lat),V=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,H=(q,W,ee,te,ne)=>{let ue=(q+ee)/2,ce=(W+te)/2,J=new r.P(ue,ce),{lng:ie,lat:re}=this.pointLocation3D(J),ge=Math.max(0,P-ie,N-re,ie-O,re-B);P=Math.min(P,ie),O=Math.max(O,ie),N=Math.min(N,re),B=Math.max(B,re),(ne<G||ge>V)&&(H(q,W,ue,ce,ne+1),H(ue,ce,ee,te,ne+1))};if(H(h,s,v,s,1),H(v,s,v,g,1),H(v,g,h,g,1),H(h,g,h,s,1),this.projection.name==="globe"){let[q,W]=r.aV(this);q?(B=90,O=180,P=-180):W&&(N=-90,O=180,P=-180)}return new r.ai(new r.aI(P,N),new r.aI(O,B))}_getBoundsRectangular(s,h){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,C=new r.P(v,g),M=new r.P(E,g),P=new r.P(E,x),O=new r.P(v,x),N=this.pointCoordinate(C,s),B=this.pointCoordinate(M,s),V=this.pointCoordinate(P,h),G=this.pointCoordinate(O,h),H=(q,W)=>(W.y-q.y)/(W.x-q.x);return N.y>1&&B.y>=0?N=new r.Y((1-G.y)/H(G,N)+G.x,1):N.y<0&&B.y<=1&&(N=new r.Y(-G.y/H(G,N)+G.x,0)),B.y>1&&N.y>=0?B=new r.Y((1-V.y)/H(V,B)+V.x,1):B.y<0&&N.y<=1&&(B=new r.Y(-V.y/H(V,B)+V.x,0)),new r.ai().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){let s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-r.aS,this.maxLat=r.aS,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aj(this.minLng)*this.tileSize,this.worldMaxX=r.aj(this.maxLng)*this.tileSize,this.worldMinY=r.ak(this.maxLat)*this.tileSize,this.worldMaxY=r.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){let h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];let v=s.canonical,x=1/this.height,E=this.cameraWorldSize,C=E/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*s.wrap)*C,P=v.y*C,O=this.point;O.x*=E/this.worldSize,O.y*=E/this.worldSize;let N=this.angle,B=Math.sin(-N),V=-Math.cos(-N);return g[h]={bearing:[B,V],center:[(O.x-M)*x,(O.y-P)*x],scale:C/r.a3*x},g[h]}calculateFogTileMatrix(s){let h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return r.ad.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(s,h=!1,g=!1){let v=s.key,x;if(x=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let E=this.calculatePosMatrix(s,this.worldSize),C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,r.ad.multiply(E,C,E),x[v]=new Float32Array(E),x[v]}calculatePixelsToTileUnitsMatrix(s){let h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];let v=r.aW(s,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let s=1/this.worldSize,h=r.ad.fromScaling([],[s,s,s]);return r.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let s=this._elevation;this._updateCameraState();let h=r.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),x=r.ax(1,this._center.lat);g[2]/=x,v[2]/=x,r._.normalize(v,v);let E=s.raycast(g,v,s.exaggeration());if(E){let C=r._.scaleAndAdd([],g,v,E),M=new r.Y(C[0],C[1],r.ax(C[2],r.ay(C[1]))),P=(M.z+r._.length([M.x-g[0],M.y-g[1],M.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;let h=this._elevation,g=r.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=h.getAtPointOrZero(new r.Y(...v)),E=this.pixelsPerMeter/this.worldSize*x,C=this._minimumHeightOverTerrain(),M=v[2]-E;if(M<=C)if(M<0||s){let P=this.locationCoordinate(this._center,this._centerAltitude),O=[v[0],v[1],P.z-v[2]],N=r._.length(O);O[2]-=(C-M)/this._pixelsPerMercatorPixel;let B=r._.length(O);if(B===0)return;r._.scale(O,O,N/B*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],P.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){let B=this.center;return B.lat=r.at(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(B.lng=r.at(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}let h=this._unmodified,{x:g,y:v}=this.point,x=0,E=g,C=v,M=this.width/2,P=this.height/2,O=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(v-P<O&&(C=O+P),v+P>N&&(C=N-P),N-O<this.height&&(x=Math.max(x,this.height/(N-O)),C=(N+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,G=this.worldSize/2-(B+V)/2;E=(g+G+this.worldSize)%this.worldSize-G,E-M<B&&(E=B+M),E+M>V&&(E=V-M),V-B<this.width&&(x=Math.max(x,this.width/(V-B)),E=(V+B)/2)}E===g&&C===v||(this.center=this.unproject(new r.P(E,C))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let s=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ax(1,this.center.lat)/r.ax(1,r.b3));let v=r.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,x),C,M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-s.x/this.width,M[9]=2*s.y/this.height,this.isOrthographic){let re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=re*this.aspect,Ce=-ge,ae=-re;ge-=s.x,Ce-=s.x,re+=s.y,ae+=s.y,C=this._camera.getCameraToClipOrthographic(Ce,ge,ae,re,this._nearZ,this._farZ),((Ie,Me,$e,Ge)=>{for(let Ve=0;Ve<16;Ve++)Ie[Ve]=Zp(Me[Ve],$e[Ve],Ge)})(C,C,M,ki(this.pitch>=15?1:this.pitch/15))}else C=M;let P=r.ad.mul([],M,E),O=r.ad.mul([],C,E);if(this.projection.isReprojectedInTileSpace){let re=this.locationCoordinate(this.center),ge=r.ad.identity([]);r.ad.translate(ge,ge,[re.x*this.worldSize,re.y*this.worldSize,0]),r.ad.multiply(ge,ge,r.aY(this)),r.ad.translate(ge,ge,[-re.x*this.worldSize,-re.y*this.worldSize,0]),r.ad.multiply(O,O,ge),r.ad.multiply(P,P,ge),this.inverseAdjustmentMatrix=r.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ad.scale([],O,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=O,this.invProjMatrix=r.ad.invert(new Float64Array(16),this.projMatrix),h){let re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);re[8]=2*-s.x/this.width,re[9]=2*s.y/this.height,this.expandedFarZProjMatrix=r.ad.mul([],re,E)}else this.expandedFarZProjMatrix=this.projMatrix;let N=r.ad.invert([],C);this.frustumCorners=r.a_.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let B=new Float32Array(16);r.ad.identity(B),r.ad.scale(B,B,[1,-1,1]),r.ad.rotateX(B,B,this._pitch),r.ad.rotateZ(B,B,this.angle);let V=r.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ad.clone(V);let G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-s.x/this.width,V[9]=2*(s.y+G)/this.height,this.skyboxMatrix=r.ad.multiply(B,V,B);let H=this.point,q=H.x,W=H.y,ee=this.width%2/2,te=this.height%2/2,ne=Math.cos(this.angle),ue=Math.sin(this.angle),ce=q-Math.round(q)+ne*ee+ue*te,J=W-Math.round(W)+ne*te+ue*ee,ie=new Float64Array(O);if(r.ad.translate(ie,ie,[ce>.5?ce-1:ce,J>.5?J-1:J,0]),this.alignedProjMatrix=ie,O=r.ad.create(),r.ad.scale(O,O,[this.width/2,-this.height/2,1]),r.ad.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=r.ad.create(),r.ad.scale(O,O,[1,-1,1]),r.ad.translate(O,O,[-1,-1,0]),r.ad.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=r.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},O=r.ad.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.a$(this);let re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r._.transformMat4(re,re,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,h];r._.scale(x,x,v),r._.scale(g,g,-1),r._.multiply(g,g,x);let E=r.ad.create();r.ad.translate(E,E,g),r.ad.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,v)}_computeCameraPosition(s){let h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,s/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((h-g)/v,1)),this._camera.position=r._.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){let s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=r.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ab(this._maxPitch)),C=Math.max((s[2]-x)/Math.cos(g),E),M=this._zoomFromMercatorZ(C);r._.scaleAndAdd(s,s,h,C),this._pitch=r.at(g,r.ab(this.minPitch),r.ab(this.maxPitch)),this.angle=r.au(v,-Math.PI,Math.PI),this._setZoom(r.at(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.Y(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){let s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=r.aU,v=0,x=1/0;for(;g-h>1e-6&&g>h;){let E=h+.5*(g-h),C=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,C),P=this.scaleZoom(M/(s*this.tileSize)),O=Math.abs(E-P);O<x&&(x=O,v=E),E<P?h=E:g=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){let g=Math.min(s.x,h.x),v=Math.max(s.x,h.x),x=Math.min(s.y,h.y),E=Math.max(s.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let C=[new r.P(g,x),new r.P(v,E),new r.P(g,E),new r.P(v,x)],M=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(let O of C){let N=this.pointRayIntersection(O);if(N.t<0)return!0;let B=this.rayIntersectionCoordinate(N);if(B.x<M||B.y<0||B.x>P||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(s,h){let g=r._.length(r._.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let s=function([h,g,v],x){let E=[h,g,v,1];r.aA.transformMat4(E,E,x);let C=E[3]=Math.max(E[3],1e-6);return E[0]/=C,E[1]/=C,E[2]/=C,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(s[0],s[1])}{let s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){let v=r.aX(s,h,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,g,v),E=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(E=Zp(1,E,ki(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){let s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ad.multiply(s,s,this.globeMatrix),s}getFrustum(s){return r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}let Ir={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},gs=(m,s)=>{if(s>0&&m.terrain&&r.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=m.transform,g=Math.max(Math.abs(h._zoom-(m.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?r.$(60,45,h.pitch):r.$(30,15,h.pitch),x=h._farZ-h._nearZ,E=s*h.height,C=((1-(M=v))*h.cameraToCenterDistance+M*(h._farZ+E))*g;var M;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(C-h._nearZ)/x,(C-E-h._nearZ)/x]}}},nr={cascadeCount:2,shadowMapResolution:2048};class Yp{constructor(s,h){this.aabb=s,this.lastCascade=h}}class Xp{add(s,h){let g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[s.key]=new Yp(h,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,h,g){let v=r.b6.fromPoints(s.points),x=0;for(let E in this.receivers){let C=this.receivers[E];if(!C||!v.intersectsAabb(C.aabb))continue;C.aabb.min=v.closestPoint(C.aabb.min),C.aabb.max=v.closestPoint(C.aabb.max);let M=C.aabb.getCorners();for(let P=0;P<g.length;P++){let O=!0;for(let N of M){let B=[N[0]*h,N[1]*h,N[2]];if(r._.transformMat4(B,B,g[P].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){O=!1;break}}if(C.lastCascade=P,x=Math.max(x,P),O)break}}return x+1}}class vd{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Xp,this._depthMode=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(nr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(nr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,h){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((G,H)=>{let q=g.style._mergedLayers[H];return G+(q.hasShadowPass()&&!q.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,E=nr.shadowMapResolution,C=nr.shadowMapResolution;if(this._cascades.length===0||nr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<nr.cascadeCount;++G){let H=g._shadowMapDebug,q=x.gl,W=x.createFramebuffer(E,C,H,"texture"),ee=new r.T(x,{width:E,height:C,data:null},q.DEPTH_COMPONENT);if(W.depthAttachment.set(ee.texture),H){let te=new r.T(x,{width:E,height:C,data:null},q.RGBA);W.colorAttachment.set(te.texture)}this._cascades.push({framebuffer:W,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.aM,scale:0})}}this.shadowDirection=yu(h);let M=0;if(s.elevation){let G=s.elevation,H=[1e4,-1e4];G.visibleDemTiles.filter(q=>q.dem).forEach(q=>{let W=q.dem.tree;H[0]=Math.min(H[0],W.minimums[0]),H[1]=Math.max(H[1],W.maximums[0])}),H[0]!==1e4&&(M=(H[1]-H[0])*G.exaggeration())}let P=1.5*s.cameraToCenterDistance,O=3*P,N=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){let H=this._cascades[G],q=s.height/50,W=1;nr.cascadeCount===1?W=O:G===0?W=P:(q=P,W=O);let[ee,te]=vu(s,this.shadowDirection,q,W,nr.shadowMapResolution,M);H.scale=s.scale,H.matrix=ee,H.boundingSphereRadius=te,r.ad.invert(N,H.matrix),H.frustum=r.aM.fromInvProjectionMatrix(N,1,0,!0),H.far=W}let B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/nr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=nr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ir.ShadowMap0,this._uniformValues.u_shadowmap_1=Ir.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let V=g.transform.elevation;for(let G of this._groundShadowTiles){let H={min:0,max:0};if(V){let q=V.getMinMaxForTile(G);q&&(H=q)}this.addShadowReceiver(G.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,h){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,nr.shadowMapResolution,nr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:r.C.white,depth:1});for(let E of s.order){let C=s._mergedLayers[E];if(!C.hasShadowPass()||C.isHidden(g.transform.zoom))continue;let M=s.getLayerSourceCache(C),P=M?h[M.id]:void 0;(C.type==="model"||P&&P.length)&&g.renderLayer(g,M,C,P)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let s=this.painter,h=s.style,g=s.context,v=h.directionalLight,x=h.ambientLight;if(!v||!x)return;let E=[],C=gs(s,s.longestCutoffRange);C.shouldRenderCutoff&&E.push("RENDER_CUTOFF");let M=_s(h,v,x),P=new r.ae(g.gl.LEQUAL,r.ae.ReadOnly,s.depthRangeFor3D);for(let O of this._groundShadowTiles){let N=O.toUnwrapped(),B=s.isTileAffectedByFog(O),V=s.getOrCreateProgram("groundShadow",{defines:E,overrideFog:B});this.setupShadows(N,V),s.uploadCommonUniforms(g,V,N,null,C);let G={u_matrix:s.transform.calculateProjMatrix(N),u_ground_shadow_factor:M};V.draw(s,g.gl.TRIANGLES,P,r.ag.disabled,r.a.multiply,r.af.disabled,G,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){let h=this.painter.transform,g=h.calculatePosMatrix(s,h.worldSize);return r.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return r.ad.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,h,g,v=0){if(!this.enabled)return;let x=this.painter.transform,E=this.painter.context,C=E.gl,M=this._uniformValues,P=new Float64Array(16),O=x.calculatePosMatrix(s,x.worldSize);for(let N=0;N<this._cascades.length;N++)r.ad.multiply(P,this._cascades[N].matrix,O),M[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),E.activeTexture.set(C.TEXTURE0+Ir.ShadowMap0+N),this._cascades[N].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let N=r.b5(s.canonical),B=2/x.tileSize*r.a3/nr.shadowMapResolution,V=B*this._cascades[0].boundingSphereRadius,G=B*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(g==="vector-tile"?1:3)/Math.pow(2,v-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));M.u_shadow_normal_offset=[N,V*H,G*H],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(E,M)}setupShadowsFromMatrix(s,h,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,E=this._uniformValues,C=new Float64Array(16);for(let M=0;M<nr.cascadeCount;M++)r.ad.multiply(C,this._cascades[M].matrix,s),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(x.TEXTURE0+Ir.ShadowMap0+M),this._cascades[M].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(E.u_shadow_normal_offset=[1,5,5],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,h,g,v){if(v[2]>=0)return{};let x=function(M,P,O){let N=O/(1<<M.canonical.z);return new r.b6([M.canonical.x*N+M.wrap*O,M.canonical.y*N+M.wrap*O,0],[(M.canonical.x+1)*N+M.wrap*O,(M.canonical.y+1)*N+M.wrap*O,P])}(s,h,g).getCorners(),E=h/-v[2];v[0]<0?(r._.add(x[0],x[0],[v[0]*E,0,0]),r._.add(x[3],x[3],[v[0]*E,0,0])):v[0]>0&&(r._.add(x[1],x[1],[v[0]*E,0,0]),r._.add(x[2],x[2],[v[0]*E,0,0])),v[1]<0?(r._.add(x[0],x[0],[0,v[1]*E,0]),r._.add(x[1],x[1],[0,v[1]*E,0])):v[1]>0&&(r._.add(x[2],x[2],[0,v[1]*E,0]),r._.add(x[3],x[3],[0,v[1]*E,0]));let C={};return C.vertices=x,C.planes=[Gl(x[1],x[0],x[4]),Gl(x[2],x[1],x[5]),Gl(x[3],x[2],x[6]),Gl(x[0],x[3],x[7])],C}addShadowReceiver(s,h,g){this._receivers.add(s,r.b6.fromTileIdAndHeight(s,h,g))}getMaxCascadeForTile(s){let h=this._receivers.get(s);return h&&h.lastCascade?h.lastCascade:0}}function Gl(m,s,h){let g=r._.sub([],h,s),v=r._.sub([],m,s),x=r._.cross([],g,v),E=r._.length(x);return E===0?[0,0,1,0]:(r._.scale(x,x,1/E),[x[0],x[1],x[2],-r._.dot(x,s)])}function yu(m){let s=m.properties.get("direction"),h=r.ac(s.x,s.y,s.z);h[2]=r.at(h[2],0,75);let g=r.b7([h[0],h[1],h[2]]);return r._.fromValues(g.x,g.y,g.z)}function _s(m,s,h){let g=s.properties.get("color"),v=s.properties.get("intensity"),x=s.properties.get("direction"),E=[x.x,x.y,x.z],C=h.properties.get("color"),M=h.properties.get("intensity"),P=Math.max(r._.dot([0,0,1],E),0),O=[0,0,0];r._.scale(O,C.toRenderColor(m.getLut(s.scope)).toArray01Linear().slice(0,3),M);let N=[0,0,0];return r._.scale(N,g.toRenderColor(m.getLut(h.scope)).toArray01Linear().slice(0,3),P*v),r.b8([O[0]>0?O[0]/(O[0]+N[0]):0,O[1]>0?O[1]/(O[1]+N[1]):0,O[2]>0?O[2]/(O[2]+N[2]):0])}function vu(m,s,h,g,v,x){let E=m.zoom,C=m.scale,M=m.worldSize,P=1/M,O=m.aspect,N=Math.sqrt(1+O*O)*Math.tan(.5*m.fovX),B=N*N,V=g-h,G=g+h,H,q;B>V/G?(H=g,q=g*N):(H=.5*G*(1+B),q=.5*Math.sqrt(V*V+2*(g*g+h*h)*B+G*G*B*B));let W=m.projection.pixelsPerMeter(m.center.lat,M),ee=m._camera.getCameraToWorldMercator(),te=[0,0,-H*P];r._.transformMat4(te,te,ee);let ne=q*P,ue=m._edgeInsets;if(!(ue.left===0&&ue.top===0&&ue.right===0&&ue.bottom===0||ue.left===ue.right&&ue.top===ue.bottom)){let ot=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?W:1),ct=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,h,g);ct[8]=2*-m.centerOffset.x/m.width,ct[9]=2*m.centerOffset.y/m.height;let at=new Float64Array(16);r.ad.mul(at,ct,ot);let je=new Float64Array(16);r.ad.invert(je,at);let He=r.aM.fromInvProjectionMatrix(je,M,E,!0);for(let st of He.points){let pt=((ce=st)[0]/=C,ce[1]/=C,ce[2]=r.ax(ce[2],m._center.lat),ce);ne=Math.max(ne,r._.len(r._.subtract([],te,pt)))}}var ce;ne*=v/(v-1);let J=Math.acos(s[2]),ie=Math.atan2(-s[0],-s[1]),re=new gu;re.position=te,re.setPitchBearing(J,ie);let ge=re.getWorldToCamera(M,W),Ce=ne*M,ae=Math.min(m._mercatorZfromZoom(17)*M*-2,-2*Ce),Ie=re.getCameraToClipOrthographic(-Ce,Ce,-Ce,Ce,ae,(Ce+x*W)/s[2]),Me=new Float64Array(16);r.ad.multiply(Me,Ie,ge);let $e=r._.fromValues(Math.floor(1e6*te[0])/1e6*M,Math.floor(1e6*te[1])/1e6*M,0),Ge=.5*v,Ve=[0,0,0];r._.transformMat4(Ve,$e,Me),r._.scale(Ve,Ve,Ge);let xe=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],Re=[0,0,0];r._.sub(Re,Ve,xe),r._.scale(Re,Re,-1/Ge);let Ne=new Float64Array(16);return r.ad.identity(Ne),r.ad.translate(Ne,Ne,Re),r.ad.multiply(Me,Ne,Me),[Me,Ce]}function xd(m,s){return m!=null&&s!=null&&!(!m.hasData()||!s.hasData())&&m.demTexture!=null&&s.demTexture!=null&&m.tileID.key!==s.tileID.key}let Ga=new class{constructor(){this.operations={}}newMorphing(m,s,h,g,v){if(m in this.operations){let x=this.operations[m];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[m]={startTime:g,phase:0,duration:v,from:s,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;let s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(let s in this.operations){let h=this.operations[s];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},xu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Kp(m,s,h){if(s===0)return 0;let g=s<1&&h===514?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*g}function ly(m,s){let h=1<<m.z;return!s&&(m.x===0||m.x===h-1)||m.y===0||m.y===h-1}let bd=m=>({u_matrix:m});function wd(m,s,h,g,v){if(v>0){let x=r.e.now(),E=(x-m.timeAdded)/v,C=s?(x-s.timeAdded)/v:-1,M=h.getSource(),P=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),O=!s||Math.abs(s.tileID.overscaledZ-P)>Math.abs(m.tileID.overscaledZ-P),N=O&&m.refreshedUponExpiration?1:r.at(O?E:1-C,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Hl extends pu{constructor(s,h,g,v){super(s,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=r.W({type:"raster-array"},h)}triggerRepaint(s){let h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,r.R.Tile);s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(x,E,C,M)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(x)return x.code===20?void 0:(s.state="errored",h(x));this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:M}),s.state="empty",h(null)})}unloadTile(s,h){let g=s.texture;g&&g instanceof r.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,h,g){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(h,g,(v,x)=>{if(v)return s.state="errored",this.fire(new r.d(v)),void this.triggerRepaint(s);x&&(s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:x})=>x===s),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(s,h,g){if(!s)return;let v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;h instanceof r.bk?x=h.paint.get("raster-array-band"):h instanceof r.bl&&(x=h.paint.get("raster-particle-array-band"));let E=x||this.getInitialBand(v);if(E!=null)if(s.textureDescriptor){if(!s.updateNeeded(v,E)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,E)}}let ir={vector:md,raster:pu,"raster-dem":class extends pu{constructor(m,s,h,g){super(m,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=r.W({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){let h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(m.state="errored",s(v)),x&&(m.dem=x,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=r.h(this.map._requestManager.transformRequest(h,r.R.Tile),(function(v,x,E,C){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(v)m.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:C});let M=ImageBitmap&&x instanceof ImageBitmap&&r.bi(),P=1-(x.width-r.bj(x.width))/2;P<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));let O=M?x:r.e.getImageData(x,P),N={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:P};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",N,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){let s=m.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,v=s.x===0?m.wrap-1:m.wrap,x=(s.x+1+h)%h,E=s.x+1===h?m.wrap+1:m.wrap,C={};return C[new r.aL(m.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},C[new r.aL(m.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(C[new r.aL(m.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},C[new r.aL(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},C[new r.aL(m.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<h&&(C[new r.aL(m.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},C[new r.aL(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},C[new r.aL(m.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),C}},"raster-array":Hl,geojson:class extends r.E{constructor(m,s,h,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=r.W({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;let v=r.a3/this.tileSize;this.workerOptions=r.W({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:r.a3,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:r.a3,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){return this._options.dynamic?typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection")?this.fire(new r.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...m.features):this._data=m,this._updateWorkerData(!0),this):this.fire(new r.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:h},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.f("dataloading",{dataType:"source"})),this._loaded=!1;let s=r.W({append:m},this.workerOptions);s.scope=this.scope;let h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(r.e.resolveURL(h),r.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new r.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new r.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,s){let h=m.actor?"reloadTile":"loadTile";m.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};m.request=this.actor.send(h,x,(E,C)=>v&&!C?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):E?s(E):(m.loadVectorData(C,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.bm{constructor(m,s,h,g){super(m,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;let m=this.options;this.urls=[];for(let s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,r.R.Source).url);r.bn(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new r.d(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){let s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new r.d(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(m,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.bm,model:class extends r.E{constructor(m,s,h,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){let m=[];for(let s in this._options.models){let h=this._options.models[s],g=r.l(this.map._requestManager.transformRequest(h.uri,r.R.Model).url).then(v=>{if(!v)return;let x=r.c(v),E=new r.M(s,h.position,h.orientation,x);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(v=>{this.fire(new r.d(new Error(`Could not load model ${s} from ${h.uri}: ${v.message}`)))});m.push(g)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new r.d(new Error(`Could not load models: ${s.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(m,s,h,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Gp(this._options,this.map._requestManager,s,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new r.d(g))):v&&(r.W(this,v),v.bounds&&(this.tileBounds=new fu(v.bounds,this.minzoom,this.maxzoom)),r.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){let h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,r.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=s;else{if(m.buckets){let x=Object.values(m.buckets);for(let E of x)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,E){return m.aborted?s(null):x&&x.status!==404?s(x):(E&&(E.resourceTiming&&(m.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&m.setExpiryData(E),m.buckets=gt(gt({},m.buckets),E.buckets),E.featureIndex&&(m.latestFeatureIndex=E.featureIndex)),m.state="loaded",void s(null))}}serialize(){return r.W({},this._options)}},canvas:class extends r.bm{constructor(m,s,h,g){super(m,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new r.d(new r.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.d(new r.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new r.d(new r.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new r.d(new r.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.d(new r.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof r.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends r.E{constructor(m,s,h,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fu(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),r.W(this,r.ah(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){let{x:s,y:h,z:g}=m.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){let{x:h,y:g,z:v}=m.tileID.canonical,x=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:x.signal})).then((function(E){return delete m.request,m.aborted?(m.state="unloaded",s(null)):E===void 0?(m.state="errored",s(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(E)?(this.loadTileData(m,E),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(m.state="errored",s(E))}),m.request.cancel=()=>x.abort()}loadTileData(m,s){m.setTexture(s,this._map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof r.T?(m.destroy(!0),m.texture&&m.texture instanceof r.T&&this._map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){let{x:h,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){let m=r.al(this.id,this.scope);this._map.style.clearSource(m)}_update(){this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}}},Ed=function(m,s,h,g){let v=new ir[s.type](m,s,h,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return r.bp(["load","abort","unload","serialize","prepare"],v),v};class Qp extends r.bv{constructor(s){let h={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new r.bw(r.bx(),null),v=Ed("mock-dem",h,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class cy extends r.bv{constructor(s){let h=Ed("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new r.bw(r.bx(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;let v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){let C=new r.by(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);C.state="loaded",this._tiles[E.key]=C}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){let h=this.proxyCachedFBO[s];if(h!==void 0){let g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Jp extends r.aL{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class em extends r.bq{constructor(s,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(M){let P=new r.bt,O=new r.bu,N=131;P.reserve(17161),O.reserve(33800);let B=r.a3/128,V=r.a3+B/2,G=V+B;for(let q=-B;q<G;q+=B)for(let W=-B;W<G;W+=B){let ee=W<0||W>V||q<0||q>V?24575:0,te=r.at(Math.round(W),0,r.a3),ne=r.at(Math.round(q),0,r.a3);P.emplaceBack(te+ee,ne)}let H=(q,W)=>{let ee=W*N+q;O.emplaceBack(ee+1,ee,ee+N),O.emplaceBack(ee+N,ee+N+1,ee+1)};for(let q=1;q<129;q++)for(let W=1;W<129;W++)H(W,q);return[0,129].forEach(q=>{for(let W=0;W<130;W++)H(W,q),H(q,W)}),[P,O,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(g,r.br.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=r.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=r.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cy(h.map),this.orthoMatrix=r.ad.create(),r.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.a3,0,r.a3,0,1);let C=E.gl;this._overlapStencilMode=new r.ag({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qp(h.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);let v=s.terrain.properties,x=s.terrain.drapeRenderMode===0,E=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.e.now();let C=s.terrain&&s.terrain.scope,M=v.get("source"),P=x?this._mockSourceCache:s.getSourceCache(M,C);if(!P)return void r.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=P,this._exaggeration=E?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;let O=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let N=this.getScaledDemTileSize();this.sourceCache.update(h,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(s){let h=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;let v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=s.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(x);let C=x-this._previousZoom,M=this._previousUpdateTimestamp,P=x;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(x-P)>.5&&(C=.5*(x-P+C)),C*v<0&&(P+=C)),this._evaluationZoom=P;let O=E.getExaggeration(P),N=O===E.getExaggeration(Math.max(0,P-.1));if(N&&Math.abs(O-this._exaggeration)<.01)return O;let B=Math.min(.1,.00375*(this._updateTimestamp-M));return(N||O<.1||Math.abs(C)<1e-4)&&(B=Math.min(.2,4*B)),r.a2(this._exaggeration,O,B)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(r.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(M=>{let P=h.getTileByID(M).tileID;return P.projMatrix=g.calculateProjMatrix(P.toUnwrapped()),P});(function(M,P){let O=P.transform.pointCoordinate(P.transform.getCameraPoint()),N=new r.P(O.x,O.y);M.sort((B,V)=>{if(V.overscaledZ-B.overscaledZ)return V.overscaledZ-B.overscaledZ;let G=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),H=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),q=N.mult(1<<B.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(G)-q.distSqr(H)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};let E=this._style._mergedSourceCaches;for(let M in E){let P=E[M];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,s[M],x),P.usedForTerrain))continue;let O=s[M];P.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[h.id]=v.map(M=>new Jp(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let C={};this._visibleDemTiles=[];for(let M of this.proxyCoords){let P=this.terrainTileForTile[M.key];if(!P)continue;let O=P.tileID.key;O in C||(this._visibleDemTiles.push(P),C[O]=O)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;let g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){let s=this.painter.context,h=s.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),$p(this.painter,v,x))}}_prepareDemTileUniforms(s,h,g,v){if(!h||h.demTexture==null)return!1;let x=s.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-x.z),C=v||"";return g[`u_dem_tl${C}`]=[x.x*E%1,x.y*E%1],g[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){let g=new r.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(s,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0,h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&s++,g+x},0);return s?h/s:0}_updateEmptyDEMTexture(){let s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let C=new r.bz({width:1,height:1},new Float32Array([g]));return[h.R32F,C]})();this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(x,{premultiply:!1}):E=this._emptyDEMTexture=new r.T(s,x,v,{premultiply:!1}),E}setupElevationDraw(s,h,g){let v=this.painter.context,x=v.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};E.u_exaggeration=this.exaggeration();let C=null,M=null,P=1;if(g&&g.morphing&&this._useVertexMorphing){let V=g.morphing.srcDemTile,G=g.morphing.dstDemTile;P=g.morphing.phase,V&&G&&(this._prepareDemTileUniforms(s,V,E,"_prev")&&(M=V),this._prepareDemTileUniforms(s,G,E)&&(C=G))}let O=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,N=null;var B;if(this.enabled?M&&C?(N=C.demTexture,v.activeTexture.set(x.TEXTURE4),M.demTexture.bind(O(M),x.CLAMP_TO_EDGE),E.u_dem_lerp=P):(C=this.terrainTileForTile[s.tileID.key],N=this._prepareDemTileUniforms(s,C,E)?C.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),N&&(E.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(O(C),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&C){let V=(1<<C.tileID.canonical.z)*r.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=V}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,E),this.painter.transform.projection.name==="globe"){let V=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,V)}}globeUniformValues(s,h,g){let v=s.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,r.a3,0),u_tile_br_up:v.upVector(h,r.a3,r.a3),u_tile_bl_up:v.upVector(h,0,r.a3),u_tile_up_scale:g?r.bs(1):v.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){let h=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,E,C,M){if(v.transform.projection.name==="globe")(function(P,O,N,B,V){let G=P.context,H=G.gl,q,W,ee=P.transform,te=r.ba(P,G,ee),ne=(Ie,Me)=>{if(W===Me)return;let $e=[xu[Me],"PROJECTION_GLOBE_VIEW"];te&&$e.push("CUSTOM_ANTIALIASING");let Ge=P.isTileAffectedByFog(Ie);q=P.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:Ge}),W=Me},ue=P.colorModeForRenderPass(),ce=new r.ae(H.LEQUAL,r.ae.ReadWrite,P.depthRangeFor3D);Ga.update(V);let J=r.bb(ee),ie=[r.aj(ee.center.lng),r.ak(ee.center.lat)],re=P.globeSharedBuffers,ge=[ee.width*r.e.devicePixelRatio,ee.height*r.e.devicePixelRatio],Ce=Float32Array.from(ee.globeMatrix),ae={useDenormalizedUpVectorScale:!0};{let Ie=P.transform,Me=Kp(Ie.zoom,O.exaggeration(),O.sourceCache._source.tileSize);W=-1;let $e=H.TRIANGLES;for(let Ge of B){let Ve=N.getTile(Ge),xe=r.ag.disabled,Re=O.prevTerrainTileForTile[Ge.key],Ne=O.terrainTileForTile[Ge.key];xd(Re,Ne)&&Ga.newMorphing(Ge.key,Re,Ne,V,250),G.activeTexture.set(H.TEXTURE0),Ve.texture&&Ve.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let ot=Ga.getMorphValuesForProxy(Ge.key),ct=ot?1:0;ot&&r.o(ae,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:r.b9(ot.phase)}});let at=r.bc(Ge.canonical),je=r.bd(at.getCenter().lat),He=r.be(Ge.canonical,at,je,Ie.worldSize/Ie._pixelsPerMercatorPixel),st=r.bf(r.bg(Ge.canonical)),pt=sy(Ie.expandedFarZProjMatrix,Ce,J,st,r.a1(Ie.zoom),ie,Ie.frustumCorners.TL,Ie.frustumCorners.TR,Ie.frustumCorners.BR,Ie.frustumCorners.BL,Ie.globeCenterInViewSpace,Ie.globeRadius,ge,Me,Ie._farZ,He);if(ne(Ge,ct),q&&(O.setupElevationDraw(Ve,q,ae),P.uploadCommonUniforms(G,q,Ge.toUnwrapped()),re)){let[Lt,Wt,fn]=re.getGridBuffers(je,Me!==0);q.draw(P,$e,ce,xe,ue,r.af.backCCW,pt,"globe_raster",Lt,Wt,fn)}}}if(re&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){let Ie=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&Ie.push("CUSTOM_ANTIALIASING"),q=P.getOrCreateProgram("globeRaster",{defines:Ie});for(let Me of B){let{x:$e,y:Ge,z:Ve}=Me.canonical,xe=Ge===0,Re=Ge===(1<<Ve)-1,[Ne,ot,ct,at]=re.getPoleBuffers(Ve,!1);if(at&&(xe||Re)){let je=N.getTile(Me);G.activeTexture.set(H.TEXTURE0),je.texture&&je.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let He=r.bh(Ve,$e,ee),st=r.bf(r.bg(Me.canonical)),pt=(Lt,Wt)=>Lt.draw(P,H.TRIANGLES,ce,r.ag.disabled,ue,r.af.disabled,sy(ee.expandedFarZProjMatrix,He,He,st,0,ie,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,ge,0,ee._farZ),"globe_pole_raster",Wt,ct,at);O.setupElevationDraw(je,q,ae),P.uploadCommonUniforms(G,q,Me.toUnwrapped()),xe&&P.renderDefaultNorthPole&&pt(q,Ne),Re&&P.renderDefaultSouthPole&&(He=r.ad.scale(r.ad.create(),He,[1,-1,1]),pt(q,ot))}}}})(v,x,E,C,M);else{let P=v.context,O=P.gl,N,B,V=v.shadowRenderer,G=gs(v,v.longestCutoffRange),H=ue=>{if(B===ue)return;let ce=[];ce.push(xu[ue]),G.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),N=v.getOrCreateProgram("terrainRaster",{defines:ce}),B=ue},q=v.colorModeForRenderPass(),W=new r.ae(O.LEQUAL,r.ae.ReadWrite,v.depthRangeFor3D);Ga.update(M);let ee=v.transform,te=Kp(ee.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ne=[0,0,0];if(V){let ue=v.style.directionalLight,ce=v.style.ambientLight;ue&&ce&&(ne=_s(v.style,ue,ce))}{B=-1;let ue=O.TRIANGLES,[ce,J]=[x.gridIndexBuffer,x.gridSegments];for(let ie of C){let re=E.getTile(ie),ge=r.ag.disabled,Ce=x.prevTerrainTileForTile[ie.key],ae=x.terrainTileForTile[ie.key];xd(Ce,ae)&&Ga.newMorphing(ie.key,Ce,ae,M,250),P.activeTexture.set(O.TEXTURE0),re.texture&&re.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let Ie=Ga.getMorphValuesForProxy(ie.key),Me=Ie?1:0,$e;Ie&&($e={morphing:{srcDemTile:Ie.from,dstDemTile:Ie.to,phase:r.b9(Ie.phase)}});let Ge=lt(ie.projMatrix,ly(ie.canonical,ee.renderWorldCopies)?te/10:te,ne);if(H(Me),!N)continue;x.setupElevationDraw(re,N,$e);let Ve=ie.toUnwrapped();V&&V.setupShadows(Ve,N),v.uploadCommonUniforms(P,N,Ve,null,G),N.draw(v,ue,W,ge,q,r.af.backCCW,Ge,"terrain_raster",x.gridBuffer,ce,J)}}}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;let h=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),C=h.style.order,M=[],P=0;for(let O of x){let N=v.getTileByID(O.proxyTileKey),B=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][s]:void 0,V=B!==void 0?v.renderCache[B]:this.pool[P++],G=B!==void 0;if(N.texture=V.tex,G&&!V.dirty){M.push(N.tileID);continue}let H;g.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(g.clear({color:r.C.transparent,stencil:0}),V.dirty=!1);for(let q=E.start;q<=E.end;++q){let W=h.style._mergedLayers[C[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[O.key][ee.id]:[O];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}if(this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let W=h.style._mergedLayers[C[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[O.key][ee.id]:[O];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}this.renderedToTile?(V.dirty=!0,M.push(N.tileID)):G||--P,P===5&&(P=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}isLayerOrderingCorrect(s){let h=s.order.length,g=-1,v=h;for(let x=0;x<h;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let E=x.tileID,C=1<<E.overscaledZ,{x:M,y:P}=E.canonical,O=M/C,N=(M+1)/C,B=P/C,V=(P+1)/C;return{minx:O,miny:B,maxx:N,maxy:V,t:x.dem.tree.raycastRoot(O,B,N,V,s,h,g),tile:x}});v.sort((x,E)=>(x.t!==null?x.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,h,g);if(E!=null)return E}return null}_createFBO(){let s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);let v=new r.T(s,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=s.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new Fa(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{let h=this._style._mergedLayers[s],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(let g of this._style.getSources())if(g instanceof md){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!h[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.Z){h[x.id]=!0;for(let E of this.proxyCoords){let C=this.proxyToSource[E.key][x.id];if(C)for(let M of C)this._clearRenderCacheForTile(x.id,M)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof pu){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||h[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let E=v.paint.get("raster-fade-duration");for(let C of this.proxyCoords){let M=this.proxyToSource[C.key][x.id];if(M)for(let P of M){let O=wd(x.getTile(P),x.findLoadedParent(P,0),x,this.painter.transform,E);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(x.id,P)}}}}_setupDrapedRenderBatches(){let s=this._style.order,h=s.length;if(h===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,E=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<h;)E=this._style._mergedLayers[s[x]];for(;x<h;++x){let C=this._style._mergedLayers[s[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=x):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let C=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>C.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let C=0;C<E.length;++C){let M=Object.values(E[C]);h.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let E=g.length-1;E>=0;E--){let C=g[E];if(h.getTileByID(C.key),h.proxyCachedFBO[C.key]!==void 0){let M=s[C.key],P=this.proxyToSource[C.key],O=0;for(let N in P){let B=P[N],V=M[N];if(!V||V.length!==B.length||B.some((G,H)=>G!==V[H]||v[N]&&v[N].hasOwnProperty(G.key))){O=-1;break}++O}for(let N in h.proxyCachedFBO[C.key])h.renderCache[h.proxyCachedFBO[C.key][N]].dirty=O<0||O!==Object.values(M).length}}let x=[...this._drapedRenderBatches];x.sort((E,C)=>C.end-C.start-(E.end-E.start));for(let E of x)for(let C of g){if(h.proxyCachedFBO[C.key])continue;let M=h.renderCachePool.pop();M===void 0&&h.renderCache.length<50&&(M=h.renderCache.length,h.renderCache.push(this._createFBO())),M!==void 0&&(h.proxyCachedFBO[C.key]={},h.proxyCachedFBO[C.key][E.start]=M,h.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,E=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let C;if(g.isTileClipped())C=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):r.ag.disabled}_renderTileClippingMasks(s,h){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let E=g.getOrCreateProgram("clippingMask");for(let C of s){let M=g._tileClippingMaskIDs[C.key]=--h;E.draw(g,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,bd(C.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){let h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;let g=[s.x,s.y,1,1];r.aA.transformMat4(g,g,h.pixelMatrixInverse),r.aA.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;let v=h._camera.position,x=r.ax(1,h.center.lat),E=[v[0],v[1],v[2]/x,0],C=r._.subtract([],g.slice(0,3),E);r._.normalize(C,C);let M=this.raycast(E,C,this._exaggeration);return M!==null&&M?(r._.scaleAndAdd(E,E,C,M),E[3]=E[2],E[2]*=x,E):null}drawDepth(){let s=this.painter,h=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let E=h.gl,C=h.createFramebuffer(v,x,!0,"renderbuffer");h.activeTexture.set(E.TEXTURE0);let M=new r.T(h,{width:v,height:x,data:null},E.RGBA);M.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(M.texture);let P=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);C.depthAttachment.set(P),this._depthFBO=C,this._depthTexture=M}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(E,C,M,P){if(E.transform.projection.name==="globe")return;let O=E.context,N=O.gl;O.clear({depth:1});let B=E.getOrCreateProgram("terrainDepth"),V=new r.ae(N.LESS,r.ae.ReadWrite,E.depthRangeFor3D);for(let G of P){let H=M.getTile(G),q=lt(G.projMatrix,0,[0,0,0]);C.setupElevationDraw(H,B),B.draw(E,N.TRIANGLES,V,r.ag.disabled,r.a.unblended,r.af.backCCW,q,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof r.bm)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let M=0;M<x.length;M++){let P=x[M],O=this._findTileCoveringTileID(P,s);if(O){let N=this._createProxiedId(P,O,g[P.key]&&g[P.key][s.id]);v.push(N),this.proxyToSource[P.key][s.id]=[N]}}let E=!1,C=new Set;for(let M=0;M<h.length;M++){let P=s.getTile(h[M]);if(!P||!P.hasData())continue;let O=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==P.tileID.canonical.z){let N=this.proxyToSource[O.tileID.key][s.id],B=this._createProxiedId(O.tileID,P,g[O.tileID.key]&&g[O.tileID.key][s.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[O.tileID.key][s.id]=[B];let V=this.proxyToSource[O.tileID.key][s.id];C.has(V)||C.add(V),v.push(B),E=!0}}if(this._sourceTilesOverlap[s.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(let M of C)M.sort((P,O)=>O.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords,E=s.getSource(),C=E.tileID;if(!C)return;let M=new r.P(C.x,C.y)._div(1<<C.z),P=E.coordinates.map(r.Y.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-M.x),N.min.y=Math.min(N.min.y,B.y-M.y),N.max.x=Math.max(N.max.x,B.x-M.x),N.max.y=Math.max(N.max.y,B.y-M.y),N),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(N,B)=>{let V=N.wrap+N.canonical.x/(1<<N.canonical.z),G=N.canonical.y/(1<<N.canonical.z),H=r.a3/(1<<N.canonical.z),q=B.wrap+B.canonical.x/(1<<B.canonical.z),W=B.canonical.y/(1<<B.canonical.z);return V+H<q+P.min.x||V>q+P.max.x||G+H<W+P.min.y||G>W+P.max.y};for(let N=0;N<x.length;N++){let B=x[N];for(let V=0;V<h.length;V++){let G=s.getTile(h[V]);if(!G||!G.hasData()||O(B,G.tileID))continue;let H=this._createProxiedId(B,G,g[B.key]&&g[B.key][s.id]),q=this.proxyToSource[B.key][s.id];q?q.push(H):this.proxyToSource[B.key][s.id]=[H],v.push(H)}}}_createProxiedId(s,h,g){let v=this.orthoMatrix;if(g){let x=g.find(E=>E.key===h.tileID.key);if(x)return x}if(h.tileID.key!==s.key){let x=s.canonical.z-h.tileID.canonical.z,E,C,M;v=r.ad.create();let P=h.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(E=r.a3>>x,C=E*((h.tileID.canonical.x<<x)-s.canonical.x+P),M=E*((h.tileID.canonical.y<<x)-s.canonical.y)):(E=r.a3<<-x,C=r.a3*(h.tileID.canonical.x-(s.canonical.x+P<<-x)),M=r.a3*(h.tileID.canonical.y-(s.canonical.y<<-x))),r.ad.ortho(v,0,E,0,E,0,1),r.ad.translate(v,v,[C,M,0])}return new Jp(h.tileID,s.key,v)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[h.id],x=v[s.key];if(g=x?h.getTileByID(x):null,g&&g.hasData()||x===null)return g;let E=g?g.tileID:s,C=E.overscaledZ,M=h.getSource().minzoom,P=[];if(!x){let N=h.getSource().maxzoom;if(s.canonical.z>=N){let B=s.canonical.z-N;h.getSource().reparseOverscaled?(C=Math.max(s.canonical.z+2,h.transform.tileZoom),E=new r.aL(C,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B)):B!==0&&(C=N,E=new r.aL(C,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B))}E.key!==s.key&&(P.push(E.key),g=h.getTile(E))}let O=N=>{P.forEach(B=>{v[B]=N}),P.length=0};for(C-=1;C>=M&&(!g||!g.hasData());C--){g&&O(g.tileID.key);let N=E.calculateScaledKey(C);if(g=h.getTileByID(N),g&&g.hasData())break;let B=v[N];if(B===null)break;B===void 0?P.push(N):g=h.getTileByID(B)}return O(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}}function ys(m,s,h){let g=function(C,M,P){let O=r._.dot(M,C),N=r._.dot(P,[.2126,.7152,.0722]),B=(G,H,q)=>(1-q)*G+q*H,V=B(1-.3*Math.min(N,1),1,Math.min(O+1,1));return B(.92,1,Math.asin(r.at(M[2],-1,1))/Math.PI+.5)*V}(m,[0,0,1],s),v=[0,0,0];r._.scale(v,h.slice(0,3),g);let x=[0,0,0];r._.scale(x,s.slice(0,3),m[2]);let E=[0,0,0];return r._.add(E,v,x),r.b8(E)}let Td=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],uy=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class bu{static cacheKey(s,h,g,v){let x=`${h}${v?v.cacheKey:""}`;for(let E of g)s.usedDefines.includes(E)&&(x+=`/${E}`);return x}constructor(s,h,g,v,x,E){let C=s.gl;this.program=C.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...E];let M=v?v.getBinderAttributes():[],P=(g.staticAttributes||[]).concat(M),O=v?v.defines():[];O=O.concat(E.map(q=>`#define ${q}`));let N=`#version 300 es
`,B=N+O.concat("precision mediump float;",ry,iy.fragmentSource).join(`
`);for(let q of g.fragmentIncludes)B+=`
${fd[q]}`;B+=`
${g.fragmentSource}`;let V=N+O.concat("precision highp float;",ry,iy.vertexSource).join(`
`);for(let q of g.vertexIncludes)V+=`
${fd[q]}`;V+=`
${g.vertexSource}`;let G=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(G,B),C.compileShader(G),C.attachShader(this.program,G);let H=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(H,V),C.compileShader(H),C.attachShader(this.program,H),this.attributes={},this.numAttributes=P.length;for(let q=0;q<this.numAttributes;q++)if(P[q]){let W=P[q].startsWith("a_")?P[q]:`a_${P[q]}`;C.bindAttribLocation(this.program,q,W),this.attributes[W]=q}C.linkProgram(this.program),C.deleteShader(H),C.deleteShader(G),this.fixedUniforms=x(s),this.binderUniforms=v?v.getUniforms(s):[],E.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new r.a7(q),u_dem_prev:new r.a7(q),u_dem_tl:new r.a8(q),u_dem_scale:new r.aa(q),u_dem_tl_prev:new r.a8(q),u_dem_scale_prev:new r.aa(q),u_dem_size:new r.aa(q),u_dem_lerp:new r.aa(q),u_exaggeration:new r.aa(q),u_depth:new r.a7(q),u_depth_size_inv:new r.a8(q),u_meter_to_dem:new r.aa(q),u_label_plane_matrix_inv:new r.a6(q)}))(s)),E.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new r.aq(q),u_tile_tr_up:new r.aq(q),u_tile_br_up:new r.aq(q),u_tile_bl_up:new r.aq(q),u_tile_up_scale:new r.aa(q)}))(s)),E.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new r.a6(q),u_fog_range:new r.a8(q),u_fog_color:new r.as(q),u_fog_horizon_blend:new r.aa(q),u_fog_vertical_limit:new r.a8(q),u_fog_temporal_offset:new r.aa(q),u_frustum_tl:new r.aq(q),u_frustum_tr:new r.aq(q),u_frustum_br:new r.aq(q),u_frustum_bl:new r.aq(q),u_globe_pos:new r.aq(q),u_globe_radius:new r.aa(q),u_globe_transition:new r.aa(q),u_is_globe:new r.a7(q),u_viewport:new r.a8(q)}))(s)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new r.as(q)}))(s)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new r.aq(q),u_lighting_directional_dir:new r.aq(q),u_lighting_directional_color:new r.aq(q),u_ground_radiance:new r.aq(q)}))(s)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new r.a6(q),u_light_matrix_1:new r.a6(q),u_fade_range:new r.a8(q),u_shadow_normal_offset:new r.aq(q),u_shadow_intensity:new r.aa(q),u_shadow_texel_size:new r.aa(q),u_shadow_map_resolution:new r.aa(q),u_shadow_direction:new r.aq(q),u_shadow_bias:new r.aq(q),u_shadowmap_0:new r.a7(q),u_shadowmap_1:new r.a7(q)}))(s))}}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(s,h){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(s,h){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(s,h){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(s,h,g,v,x,E,C,M,P,O){let N=s.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;let B=s.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||s._terrain&&s._terrain.renderingToTexture||!Td.includes(this.name))||!(!N.layers3D||!uy.includes(this.name))))return;let V=B.gl,G=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,B);if(!G)return;let H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");let q=s.getOrCreateProgram(this.name,{config:this.configuration,defines:H});B.program.set(q.program);let W=(ne,ue,ce)=>{if(ue[ne]&&ce[ne])for(let J in ue[ne])ce[ne][J]&&ce[ne][J].set(ce.program,J,ue[ne][J].current)};P&&P.setUniforms(q.program,B,q.binderUniforms,C,{zoom:M}),W("fixedUniforms",this,q),W("terrainUniforms",this,q),W("globeUniforms",this,q),W("fogUniforms",this,q),W("lightsUniforms",this,q),W("shadowUniforms",this,q),G.bind(),B.setColorMode(new r.a([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.C.transparent,[!0,!0,!0,!1])),B.setDepthMode(new r.ae(h.func===V.LESS?V.LEQUAL:h.func,r.ae.ReadOnly,h.range)),B.setStencilMode(r.ag.disabled);let ee=3*E.primitiveLength*2,te=3*E.primitiveOffset*2*2;O&&O>1?V.drawElementsInstanced(V.LINES,ee,V.UNSIGNED_SHORT,te,O):V.drawElements(V.LINES,ee,V.UNSIGNED_SHORT,te),x.bind(),B.program.set(this.program),B.setDepthMode(h),B.setStencilMode(g),B.setColorMode(v)}draw(s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q){let W=s.context,ee=W.gl;if(this.failedToCreate)return;W.program.set(this.program),W.setDepthMode(g),W.setStencilMode(v),W.setColorMode(x),W.setCullFace(E);for(let ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,C[ue]);G&&G.setUniforms(this.program,W,this.binderUniforms,B,{zoom:V});let te={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[h],ne=q&&q>0?1:void 0;for(let ue of N.get()){let ce=ue.vaos||(ue.vaos={});(ce[M]||(ce[M]=new l1)).bind(W,this,P,G?G.getPaintVertexBuffers():[],O,ue.vertexOffset,H||[],ne),q&&q>1?ee.drawElementsInstanced(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2,q):O?ee.drawElements(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2):ee.drawArrays(h,ue.vertexOffset,ue.vertexLength),h===ee.TRIANGLES&&O&&this._drawDebugWireframe(s,g,v,x,O,ue,B,V,G,q)}}}function Cd(m,s){let h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,m.transform.tileZoom)/h,v=g*(s.tileID.canonical.x+s.tileID.wrap*h),x=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.bB(s,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let Id=r.ad.create(),ql=(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H)=>{let q=s.style.light,W=q.properties.get("position"),ee=[W.x,W.y,W.z],te=r.bC.create();q.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(te,-s.transform.angle),r._.transformMat3(ee,ee,te));let ne=q.properties.get("color"),ue=s.transform,ce={u_matrix:m,u_lightpos:ee,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Id,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:N,u_vertical_scale:B,u_flood_light_intensity:V,u_ground_shadow_factor:G,u_emissive_strength:H};return ue.projection.name==="globe"&&(ce.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ce.u_zoom_transition=M,ce.u_inv_rot_matrix=O,ce.u_merc_center=P,ce.u_up_dir=ue.projection.upVector(new r.aO(0,0,0),P[0]*r.a3,P[1]*r.a3),ce.u_height_lift=C),ce},Wl=(m,s,h)=>({u_matrix:m,u_edge_radius:s,u_vertical_scale:h}),tm=(m,s,h,g,v,x,E,C,M,P,O,N,B,V)=>{let G=ql(m,s,h,g,v,x,E,M,P,O,N,B,V,1,[0,0,0],0),H={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return r.W(G,Cd(s,C),H)},nm=(m,s)=>({u_matrix:m,u_emissive_strength:s}),im=(m,s,h,g)=>r.W(nm(m,s),Cd(h,g)),hy=(m,s,h)=>({u_matrix:m,u_world:h,u_emissive_strength:s}),Dd=(m,s,h,g,v)=>r.W(im(m,s,h,g),{u_world:v}),rm=(m,s,h,g)=>{let v=r.a3/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},Sd=(m,s,h=1)=>({u_matrix:m,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),wu=r.ad.create(),Ha=(m,s,h,g,v,x,E)=>{let C=m.transform,M=C.projection.name==="globe",P=M?r.bD(C.zoom,s.canonical)*C._pixelsPerMercatorPixel:r.bB(h,1,x),O={u_matrix:s.projMatrix,u_extrude_scale:P,u_intensity:E,u_inv_rot_matrix:wu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){O.u_inv_rot_matrix=g,O.u_merc_center=v,O.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],O.u_zoom_transition=r.a1(C.zoom);let N=v[0]*r.a3,B=v[1]*r.a3;O.u_up_dir=C.projection.upVector(new r.aO(0,0,0),N,B)}return O};function dy(m,[s,h,g,v],[x,E]){if(x===E)return[0,0,0,0];let C=255*(m-1)/(m*(E-x));return[s*C,h*C,g*C,v*C]}function om(m,s,[h,g]){return h===g?0:.5/m+(s-h)*(m-1)/(m*(g-h))}let Eu=(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q,W,ee,te,ne)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:O.mix,u_opacity:O.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:r.bE(N.paint.get("raster-saturation")),u_contrast_factor:r.bF(N.paint.get("raster-contrast")),u_spin_weights:Tu(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:V,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:M,u_colorization_mix:dy(r.bG,H,W),u_colorization_offset:om(r.bG,q,W),u_color_ramp:G,u_texture_offset:[te/(ee+2*te),ee/(ee+2*te)],u_texture_res:[ee+2*te,ee+2*te],u_emissive_strength:ne});function Tu(m){m*=Math.PI/180;let s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}let ea=.15,sm=(m,s,h,g,v,x,E,C,M,P,O,N)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:M}),am=(m,s,h,g,v,x,E,C,M,P)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:h,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:E,u_uv_offset:C,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[ea,ea]}),d1=(m,s,h,g,v,x,E,C,M,P)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[ea,ea]}),Mo=r.ad.create(),Zl=(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q,W)=>{let ee=v.transform,te={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ee.getCameraToCenterDistance(H),u_rotate_symbol:+h,u_aspect_ratio:ee.width/ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+g,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Mo,u_up_vector:[0,-1,0],u_color_adj_mat:q,u_icon_transition:W||0};return H.name==="globe"&&(te.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],te.u_zoom_transition=N,te.u_inv_rot_matrix=V,te.u_merc_center=B,te.u_camera_forward=ee._camera.forward(),te.u_ecef_origin=r.bH(ee.globeMatrix,O.toUnwrapped()),te.u_tile_matrix=Float32Array.from(ee.globeMatrix),te.u_up_vector=G),te},Md=(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q)=>r.W(Zl(m,s,h,g,v,x,E,C,M,P,N,B,V,G,H,q),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(q)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.e.devicePixelRatio,u_is_halo:+O,undefined:void 0}),fy=(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H)=>r.W(Md(m,s,h,g,v,x,E,C,!0,M,!0,O,N,B,V,G,H),{u_texsize_icon:P,u_texture_icon:1}),Cu=(m,s,h,g)=>({u_matrix:m,u_emissive_strength:s,u_opacity:h,u_color:g}),py=(m,s,h,g,v,x,E,C)=>r.W(function(M,P,O,N,B){let{width:V,height:G}=N.imageManager.getPixelSize(P),H=Math.pow(2,B.tileID.overscaledZ),q=B.tileSize*Math.pow(2,N.transform.tileZoom)/H,W=q*(B.tileID.canonical.x+B.tileID.wrap*H),ee=q*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[V,G],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/r.bB(B,1,N.transform.tileZoom),u_pixel_coord_upper:[W>>16,ee>>16],u_pixel_coord_lower:[65535&W,65535&ee]}}(0,x,E,g,C),{u_matrix:m,u_emissive_strength:s,u_opacity:h}),lm=new Float32Array(r.ad.identity([])),Iu=(m,s,h,g,v,x,E,C,M,P,O,N,B,V=[0,0,0],G)=>{let H=v.style.light,q=H.properties.get("position"),W=[-q.x,-q.y,q.z],ee=r.bC.create();H.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(ee,-v.transform.angle),r._.transformMat3(W,W,ee));let te=O.alphaMode==="MASK",ne=H.properties.get("color").toRenderColor(null),ue=B.paint.get("model-ambient-occlusion-intensity"),ce=B.paint.get("model-color").constantOr(r.C.white).toRenderColor(null),J=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:h,u_node_matrix:g||lm,u_lightpos:W,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:V,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+te,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:M,u_roughnessFactor:P,u_baseColorTexture:Ir.BaseColor,u_metallicRoughnessTexture:Ir.MetallicRoughness,u_normalTexture:Ir.Normal,u_occlusionTexture:Ir.Occlusion,u_emissionTexture:Ir.Emission,u_lutTexture:Ir.LUT,u_color_mix:[ce.r,ce.g,ce.b,J],u_aoIntensity:ue,u_emissive_strength:N,u_occlusionTextureTransform:G||[0,0,0,0]}},my=(m,s=lm,h=lm)=>({u_matrix:m,u_instance:s,u_node_matrix:h}),gy=(m,s,h,g,v)=>({u_matrix:Float32Array.from(m),u_anchorPos:s,u_screenSizePx:h,u_occluderSizePx:g,u_color:v}),f1={fillExtrusion:m=>({u_matrix:new r.a6(m),u_lightpos:new r.aq(m),u_lightintensity:new r.aa(m),u_lightcolor:new r.aq(m),u_vertical_gradient:new r.aa(m),u_opacity:new r.aa(m),u_edge_radius:new r.aa(m),u_ao:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_up_dir:new r.aq(m),u_height_lift:new r.aa(m),u_flood_light_color:new r.aq(m),u_vertical_scale:new r.aa(m),u_flood_light_intensity:new r.aa(m),u_ground_shadow_factor:new r.aq(m),u_emissive_strength:new r.aa(m)}),fillExtrusionDepth:m=>({u_matrix:new r.a6(m),u_edge_radius:new r.aa(m),u_vertical_scale:new r.aa(m)}),fillExtrusionPattern:m=>({u_matrix:new r.a6(m),u_lightpos:new r.aq(m),u_lightintensity:new r.aa(m),u_lightcolor:new r.aq(m),u_vertical_gradient:new r.aa(m),u_height_factor:new r.aa(m),u_edge_radius:new r.aa(m),u_ao:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_up_dir:new r.aq(m),u_height_lift:new r.aa(m),u_image:new r.a7(m),u_texsize:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m),u_opacity:new r.aa(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new r.a6(m),u_opacity:new r.aa(m),u_ao_pass:new r.aa(m),u_meter_to_tile:new r.aa(m),u_ao:new r.a8(m),u_flood_light_intensity:new r.aa(m),u_flood_light_color:new r.aq(m),u_attenuation:new r.aa(m),u_edge_radius:new r.aa(m),u_fb:new r.a7(m),u_fb_size:new r.aa(m)}),fill:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m)}),fillPattern:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_image:new r.a7(m),u_texsize:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m)}),fillOutline:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_world:new r.a8(m)}),fillOutlinePattern:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_world:new r.a8(m),u_image:new r.a7(m),u_texsize:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m)}),circle:r.bI,collisionBox:m=>({u_matrix:new r.a6(m),u_camera_to_center_distance:new r.aa(m),u_extrude_scale:new r.a8(m)}),collisionCircle:m=>({u_matrix:new r.a6(m),u_inv_matrix:new r.a6(m),u_camera_to_center_distance:new r.aa(m),u_viewport_size:new r.a8(m)}),debug:m=>({u_color:new r.a9(m),u_matrix:new r.a6(m),u_overlay:new r.a7(m),u_overlay_scale:new r.aa(m)}),clippingMask:m=>({u_matrix:new r.a6(m)}),heatmap:m=>({u_extrude_scale:new r.aa(m),u_intensity:new r.aa(m),u_matrix:new r.a6(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_up_dir:new r.aq(m)}),heatmapTexture:m=>({u_image:new r.a7(m),u_color_ramp:new r.a7(m),u_opacity:new r.aa(m)}),hillshade:m=>({u_matrix:new r.a6(m),u_image:new r.a7(m),u_latrange:new r.a8(m),u_light:new r.a8(m),u_shadow:new r.a9(m),u_highlight:new r.a9(m),u_emissive_strength:new r.aa(m),u_accent:new r.a9(m)}),hillshadePrepare:m=>({u_matrix:new r.a6(m),u_image:new r.a7(m),u_dimension:new r.a8(m),u_zoom:new r.aa(m)}),line:r.bJ,linePattern:r.bK,raster:m=>({u_matrix:new r.a6(m),u_normalize_matrix:new r.a6(m),u_globe_matrix:new r.a6(m),u_merc_matrix:new r.a6(m),u_grid_matrix:new r.ar(m),u_tl_parent:new r.a8(m),u_scale_parent:new r.aa(m),u_fade_t:new r.aa(m),u_opacity:new r.aa(m),u_image0:new r.a7(m),u_image1:new r.a7(m),u_brightness_low:new r.aa(m),u_brightness_high:new r.aa(m),u_saturation_factor:new r.aa(m),u_contrast_factor:new r.aa(m),u_spin_weights:new r.aq(m),u_perspective_transform:new r.a8(m),u_raster_elevation:new r.aa(m),u_zoom_transition:new r.aa(m),u_merc_center:new r.a8(m),u_cutoff_params:new r.as(m),u_colorization_mix:new r.as(m),u_colorization_offset:new r.aa(m),u_color_ramp:new r.a7(m),u_texture_offset:new r.a8(m),u_texture_res:new r.a8(m),u_emissive_strength:new r.aa(m)}),rasterParticle:m=>({u_matrix:new r.a6(m),u_normalize_matrix:new r.a6(m),u_globe_matrix:new r.a6(m),u_merc_matrix:new r.a6(m),u_grid_matrix:new r.ar(m),u_tl_parent:new r.a8(m),u_scale_parent:new r.aa(m),u_fade_t:new r.aa(m),u_opacity:new r.aa(m),u_image0:new r.a7(m),u_image1:new r.a7(m),u_raster_elevation:new r.aa(m),u_zoom_transition:new r.aa(m),u_merc_center:new r.a8(m),u_cutoff_params:new r.as(m)}),rasterParticleTexture:m=>({u_texture:new r.a7(m),u_opacity:new r.aa(m)}),rasterParticleDraw:m=>({u_particle_texture:new r.a7(m),u_particle_texture_side_len:new r.aa(m),u_tile_offset:new r.a8(m),u_velocity:new r.a7(m),u_color_ramp:new r.a7(m),u_velocity_res:new r.a8(m),u_max_speed:new r.aa(m),u_uv_offset:new r.a8(m),u_data_scale:new r.as(m),u_data_offset:new r.aa(m),u_particle_pos_scale:new r.aa(m),u_particle_pos_offset:new r.a8(m)}),rasterParticleUpdate:m=>({u_particle_texture:new r.a7(m),u_particle_texture_side_len:new r.aa(m),u_velocity:new r.a7(m),u_velocity_res:new r.a8(m),u_max_speed:new r.aa(m),u_speed_factor:new r.aa(m),u_reset_rate:new r.aa(m),u_rand_seed:new r.aa(m),u_uv_offset:new r.a8(m),u_data_scale:new r.as(m),u_data_offset:new r.aa(m),u_particle_pos_scale:new r.aa(m),u_particle_pos_offset:new r.a8(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new r.a7(m),u_is_size_feature_constant:new r.a7(m),u_size_t:new r.aa(m),u_size:new r.aa(m),u_camera_to_center_distance:new r.aa(m),u_rotate_symbol:new r.a7(m),u_aspect_ratio:new r.aa(m),u_fade_change:new r.aa(m),u_matrix:new r.a6(m),u_label_plane_matrix:new r.a6(m),u_coord_matrix:new r.a6(m),u_is_text:new r.a7(m),u_pitch_with_map:new r.a7(m),u_texsize:new r.a8(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_camera_forward:new r.aq(m),u_tile_matrix:new r.a6(m),u_up_vector:new r.aq(m),u_ecef_origin:new r.aq(m),u_texture:new r.a7(m),u_icon_transition:new r.aa(m),u_color_adj_mat:new r.a6(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new r.a7(m),u_is_size_feature_constant:new r.a7(m),u_size_t:new r.aa(m),u_size:new r.aa(m),u_camera_to_center_distance:new r.aa(m),u_rotate_symbol:new r.a7(m),u_aspect_ratio:new r.aa(m),u_fade_change:new r.aa(m),u_matrix:new r.a6(m),u_label_plane_matrix:new r.a6(m),u_coord_matrix:new r.a6(m),u_is_text:new r.a7(m),u_pitch_with_map:new r.a7(m),u_texsize:new r.a8(m),u_texture:new r.a7(m),u_gamma_scale:new r.aa(m),u_device_pixel_ratio:new r.aa(m),u_tile_id:new r.aq(m),u_zoom_transition:new r.aa(m),u_inv_rot_matrix:new r.a6(m),u_merc_center:new r.a8(m),u_camera_forward:new r.aq(m),u_tile_matrix:new r.a6(m),u_up_vector:new r.aq(m),u_ecef_origin:new r.aq(m),u_is_halo:new r.a7(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new r.a7(m),u_is_size_feature_constant:new r.a7(m),u_size_t:new r.aa(m),u_size:new r.aa(m),u_camera_to_center_distance:new r.aa(m),u_rotate_symbol:new r.a7(m),u_aspect_ratio:new r.aa(m),u_fade_change:new r.aa(m),u_matrix:new r.a6(m),u_label_plane_matrix:new r.a6(m),u_coord_matrix:new r.a6(m),u_is_text:new r.a7(m),u_pitch_with_map:new r.a7(m),u_texsize:new r.a8(m),u_texsize_icon:new r.a8(m),u_texture:new r.a7(m),u_texture_icon:new r.a7(m),u_gamma_scale:new r.aa(m),u_device_pixel_ratio:new r.aa(m),u_is_halo:new r.a7(m)}),background:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_opacity:new r.aa(m),u_color:new r.a9(m)}),backgroundPattern:m=>({u_matrix:new r.a6(m),u_emissive_strength:new r.aa(m),u_opacity:new r.aa(m),u_image:new r.a7(m),u_pattern_tl:new r.a8(m),u_pattern_br:new r.a8(m),u_texsize:new r.a8(m),u_pattern_size:new r.a8(m),u_pixel_coord_upper:new r.a8(m),u_pixel_coord_lower:new r.a8(m),u_tile_units_to_pixels:new r.aa(m)}),terrainRaster:Va,terrainDepth:Va,skybox:m=>({u_matrix:new r.a6(m),u_sun_direction:new r.aq(m),u_cubemap:new r.a7(m),u_opacity:new r.aa(m),u_temporal_offset:new r.aa(m)}),skyboxGradient:m=>({u_matrix:new r.a6(m),u_color_ramp:new r.a7(m),u_center_direction:new r.aq(m),u_radius:new r.aa(m),u_opacity:new r.aa(m),u_temporal_offset:new r.aa(m)}),skyboxCapture:m=>({u_matrix_3f:new r.ar(m),u_sun_direction:new r.aq(m),u_sun_intensity:new r.aa(m),u_color_tint_r:new r.as(m),u_color_tint_m:new r.as(m),u_luminance:new r.aa(m)}),globeRaster:m=>({u_proj_matrix:new r.a6(m),u_globe_matrix:new r.a6(m),u_normalize_matrix:new r.a6(m),u_merc_matrix:new r.a6(m),u_zoom_transition:new r.aa(m),u_merc_center:new r.a8(m),u_image0:new r.a7(m),u_grid_matrix:new r.ar(m),u_skirt_height:new r.aa(m),u_far_z_cutoff:new r.aa(m),u_frustum_tl:new r.aq(m),u_frustum_tr:new r.aq(m),u_frustum_br:new r.aq(m),u_frustum_bl:new r.aq(m),u_globe_pos:new r.aq(m),u_globe_radius:new r.aa(m),u_viewport:new r.a8(m)}),globeAtmosphere:m=>({u_frustum_tl:new r.aq(m),u_frustum_tr:new r.aq(m),u_frustum_br:new r.aq(m),u_frustum_bl:new r.aq(m),u_horizon:new r.aa(m),u_transition:new r.aa(m),u_fadeout_range:new r.aa(m),u_color:new r.as(m),u_high_color:new r.as(m),u_space_color:new r.as(m),u_temporal_offset:new r.aa(m),u_horizon_angle:new r.aa(m)}),model:m=>({u_matrix:new r.a6(m),u_lighting_matrix:new r.a6(m),u_normal_matrix:new r.a6(m),u_node_matrix:new r.a6(m),u_lightpos:new r.aq(m),u_lightintensity:new r.aa(m),u_lightcolor:new r.aq(m),u_camera_pos:new r.aq(m),u_opacity:new r.aa(m),u_baseColorFactor:new r.as(m),u_emissiveFactor:new r.as(m),u_metallicFactor:new r.aa(m),u_roughnessFactor:new r.aa(m),u_baseTextureIsAlpha:new r.a7(m),u_alphaMask:new r.a7(m),u_alphaCutoff:new r.aa(m),u_baseColorTexture:new r.a7(m),u_metallicRoughnessTexture:new r.a7(m),u_normalTexture:new r.a7(m),u_occlusionTexture:new r.a7(m),u_emissionTexture:new r.a7(m),u_lutTexture:new r.a7(m),u_color_mix:new r.as(m),u_aoIntensity:new r.aa(m),u_emissive_strength:new r.aa(m),u_occlusionTextureTransform:new r.as(m)}),modelDepth:m=>({u_matrix:new r.a6(m),u_instance:new r.a6(m),u_node_matrix:new r.a6(m)}),groundShadow:m=>({u_matrix:new r.a6(m),u_ground_shadow_factor:new r.aq(m)}),stars:m=>({u_matrix:new r.a6(m),u_up:new r.aq(m),u_right:new r.aq(m),u_intensity_multiplier:new r.aa(m)}),occlusion:m=>({u_matrix:new r.a6(m),u_anchorPos:new r.aq(m),u_screenSizePx:new r.a8(m),u_occluderSizePx:new r.a8(m),u_color:new r.as(m)})};function Ad(m,s,h){let g=s.createTileMatrix(m,m.worldSize,h.toUnwrapped());return r.ad.multiply(new Float32Array(16),m.projMatrix,g)}function p1(m,s,h){if(s.projection.name===h.projection.name)return m.projMatrix;let g=h.clone();return g.setProjection(s.projection),Ad(g,s.getProjection(),m)}function Yl(m,s,h){return s.name===h.projection.name?m.projMatrix:Ad(h,s,m)}let Pd;function Du(m,s,h,g,v,x,E){let C=m.context,M=C.gl,P=m.transform,O=m.getOrCreateProgram("collisionBox"),N=[],B=0,V=0;for(let ne=0;ne<g.length;ne++){let ue=g[ne],ce=s.getTile(ue),J=ce.getBucket(h);if(!J)continue;let ie=p1(ue,J,P),re=ie;v[0]===0&&v[1]===0||(re=m.translatePosMatrix(ie,ce,v,x));let ge=E?J.textCollisionBox:J.iconCollisionBox,Ce=J.collisionCircleArray;if(Ce.length>0){let ae=r.ad.create(),Ie=re;r.ad.mul(ae,J.placementInvProjMatrix,P.glCoordMatrix),r.ad.mul(ae,ae,J.placementViewportMatrix),N.push({circleArray:Ce,circleOffset:V,transform:Ie,invTransform:ae,projection:J.getProjection()}),B+=Ce.length/4,V=B}ge&&(m.terrain&&m.terrain.setupElevationDraw(ce,O),O.draw(m,M.LINES,r.ae.disabled,r.ag.disabled,m.colorModeForRenderPass(),r.af.disabled,rm(re,P,ce,J.getProjection()),h.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,P.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!E||!N.length)return;let G=m.getOrCreateProgram("collisionCircle"),H=new r.bL;H.resize(4*B),H._trim();let q=0;for(let ne of N)for(let ue=0;ue<ne.circleArray.length/4;ue++){let ce=4*ue,J=ne.circleArray[ce+0],ie=ne.circleArray[ce+1],re=ne.circleArray[ce+2],ge=ne.circleArray[ce+3];H.emplace(q++,J,ie,re,ge,0),H.emplace(q++,J,ie,re,ge,1),H.emplace(q++,J,ie,re,ge,2),H.emplace(q++,J,ie,re,ge,3)}(!Pd||Pd.length<2*B)&&(Pd=function(ne){let ue=2*ne,ce=new r.bu;ce.resize(ue),ce._trim();for(let J=0;J<ue;J++){let ie=6*J;ce.uint16[ie+0]=4*J+0,ce.uint16[ie+1]=4*J+1,ce.uint16[ie+2]=4*J+2,ce.uint16[ie+3]=4*J+2,ce.uint16[ie+4]=4*J+3,ce.uint16[ie+5]=4*J+0}return ce}(B));let W=C.createIndexBuffer(Pd,!0),ee=C.createVertexBuffer(H,r.bM.members,!0);for(let ne of N){let ue={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(te=P).getCameraToCenterDistance(ne.projection),u_viewport_size:[te.width,te.height]};G.draw(m,M.TRIANGLES,r.ae.disabled,r.ag.disabled,m.colorModeForRenderPass(),r.af.disabled,ue,h.id,ee,W,r.b.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,P.zoom)}var te;ee.destroy(),W.destroy()}let qa=r.ad.create();function _y(m){let s=m._camera.getWorldToCamera(m.worldSize,1),h=r.ad.multiply([],s,m.globeMatrix);r.ad.invert(h,h);let g=[0,0,0],v=[0,1,0,0];return r.aA.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],r._.normalize(g,g),g}function m1({width:m,height:s,anchor:h,textOffset:g,textScale:v},x){let{horizontalAlign:E,verticalAlign:C}=r.bQ(h),M=-(E-.5)*m,P=-(C-.5)*s,O=r.bP(h,g);return new r.P((M/v+O[0])*x,(P/v+O[1])*x)}function yy(m,s,h,g,v,x,E,C,M,P,O){let N=m.text.placedSymbolArray,B=m.text.dynamicLayoutVertexArray,V=m.icon.dynamicLayoutVertexArray,G={},H=m.getProjection(),q=Yl(C,H,x),W=x.elevation,ee=H.upVectorScale(C.canonical,x.center.lat,x.worldSize).metersToTile;B.clear();for(let te=0;te<N.length;te++){let ne=N.get(te),{tileAnchorX:ue,tileAnchorY:ce,numGlyphs:J}=ne,ie=ne.hidden||!ne.crossTileID||m.allowVerticalPlacement&&!ne.placedOrientation?null:g[ne.crossTileID];if(ie){let re=0,ge=0,Ce=0;if(W){let Ne=W?W.getAtTileOffset(C,ue,ce):0,[ot,ct,at]=H.upVector(C.canonical,ue,ce);re=Ne*ot*ee,ge=Ne*ct*ee,Ce=Ne*at*ee}let[ae,Ie,Me,$e]=fo(ne.projectedAnchorX+re,ne.projectedAnchorY+ge,ne.projectedAnchorZ+Ce,h?q:E),Ge=gr(x.getCameraToCenterDistance(H),$e),Ve=v.evaluateSizeForFeature(m.textSizeData,P,ne)*Ge/r.bN;h&&(Ve*=m.tilePixelRatio/M);let xe=m1(ie,Ve);h?({x:ae,y:Ie,z:Me}=H.projectTilePoint(ue+xe.x,ce+xe.y,C.canonical),[ae,Ie,Me]=fo(ae+re,Ie+ge,Me+Ce,E)):(s&&xe._rotate(-x.angle),ae+=xe.x,Ie+=xe.y,Me=0);let Re=m.allowVerticalPlacement&&ne.placedOrientation===r.aE.vertical?Math.PI/2:0;for(let Ne=0;Ne<J;Ne++)r.aH(B,ae,Ie,Me,Re);O&&ne.associatedIconIndex>=0&&(G[ne.associatedIconIndex]={x:ae,y:Ie,z:Me,angle:Re})}else $a(J,B)}if(O){V.clear();let te=m.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){let ue=te.get(ne),{numGlyphs:ce}=ue,J=G[ne];if(ue.hidden||!J)$a(ce,V);else{let{x:ie,y:re,z:ge,angle:Ce}=J;for(let ae=0;ae<ce;ae++)r.aH(V,ie,re,ge,Ce)}}m.icon.dynamicLayoutVertexBuffer.updateData(V)}m.text.dynamicLayoutVertexBuffer.updateData(B)}function cm(m,s,h,g,v,x,E={}){let C=h.paint.get("icon-translate"),M=h.paint.get("text-translate"),P=h.paint.get("icon-translate-anchor"),O=h.paint.get("text-translate-anchor"),N=h.layout.get("icon-rotation-alignment"),B=h.layout.get("text-rotation-alignment"),V=h.layout.get("icon-pitch-alignment"),G=h.layout.get("text-pitch-alignment"),H=h.layout.get("icon-keep-upright"),q=h.layout.get("text-keep-upright"),W=h.paint.get("icon-color-saturation"),ee=h.paint.get("icon-color-contrast"),te=h.paint.get("icon-color-brightness-min"),ne=h.paint.get("icon-color-brightness-max"),ue=h.paint.get("icon-occlusion-opacity").constantOr(0),ce=h.paint.get("text-occlusion-opacity").constantOr(0),J=m.context,ie=J.gl,re=m.transform,ge=N==="map",Ce=B==="map",ae=V==="map",Ie=G==="map",Me=ue!==1||ce!==1,$e=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ge=!1,Ve=m.depthModeForSublayer(0,r.ae.ReadOnly),xe=[r.aj(re.center.lng),r.ak(re.center.lat)],Re=h.layout.get("text-variable-anchor"),Ne=re.projection.name==="globe",ot=[],ct=[0,-1,0];for(let at of g){let je=s.getTile(at),He=je.getBucket(h);if(!He||He.projection.name==="mercator"&&Ne||He.fullyClipped)continue;let st=He.projection.name==="globe",pt=st?r.a1(re.zoom):0,Lt=Yl(at,He.getProjection(),re),Wt=re.calculatePixelsToTileUnitsMatrix(je),fn=Re&&He.hasTextData(),cn=He.hasIconTextFit()&&fn&&He.hasIconData(),kn=He.getProjection().createInversionMatrix(re,at.canonical),$t=()=>{let pn=ge&&h.layout.get("symbol-placement")!=="point",Be=[];Me&&m.symbolParams.useOcclusionQueries&&!st&&!Ne&&Be.push("OCCLUSION_QUERIES");let ut=pn||cn,$i=h.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&ae&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),$i>0&&Be.push("ICON_TRANSITION"),He.icon.zOffsetVertexBuffer&&Be.push("Z_OFFSET"),W===0&&ee===0&&te===0&&ne===1||Be.push("COLOR_ADJUSTMENT");let On=He.icon.programConfigurations.get(h.id),Te=m.getOrCreateProgram(He.sdfIcons?"symbolSDF":"symbolIcon",{config:On,defines:Be}),Nr,yr=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],Zi=He.iconSizeData,Sr=r.aD(Zi,re.zoom),qr=ae||re.pitch!==0,go=ja(Lt,je.tileID.canonical,ae,ge,re,He.getProjection(),Wt),to=Ul(Lt,je.tileID.canonical,ae,ge,re,He.getProjection(),Wt),la=m.translatePosMatrix(to,je,C,P,!0),ca=m.translatePosMatrix(Lt,je,C,P),bs=ut?qa:go,ts=ge&&!ae&&!pn,ws=ct;!Ne&&!re.mercatorFromTransition||ge||(ws=_y(re));let lc=st?ws:ct;if(He.sdfIcons&&!He.iconsInText)Nr=Md(Zi.kind,Sr,ts,ae,m,ca,bs,la,!1,yr,!0,at,pt,xe,kn,lc,He.getProjection());else{let il=h.getColorAdjustmentMatrix(W,ee,te,ne);Nr=Zl(Zi.kind,Sr,ts,ae,m,ca,bs,la,!1,yr,at,pt,xe,kn,lc,He.getProjection(),il,$i)}let Xu=je.imageAtlasTexture?je.imageAtlasTexture:null,cc=h.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear,uc=He.sdfIcons||m.options.rotating||m.options.zooming||cc||qr?ie.LINEAR:ie.NEAREST,Qd=He.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,Jd=m.terrain&&ae&&pn?r.ad.invert(r.ad.create(),go):qa;if(pn&&He.icon){let il=re.elevation,vr=il?il.getAtTileOffsetFunc(at,re.center.lat,re.worldSize,He.getProjection()):null,jm=Ua(Lt,je.tileID.canonical,ae,ge,re,He.getProjection(),Wt);gd(He,Lt,m,!1,jm,to,ae,H,vr,at)}return{program:Te,buffers:He.icon,uniformValues:Nr,atlasTexture:Xu,atlasTextureIcon:null,atlasInterpolation:uc,atlasInterpolationIcon:null,isSDF:He.sdfIcons,hasHalo:Qd,tile:je,labelPlaneMatrixInv:Jd}},Mn=()=>{let pn=Ce&&h.layout.get("symbol-placement")!=="point",Be=[],ut=pn||Re||cn;Me&&m.symbolParams.useOcclusionQueries&&!st&&!Ne&&Be.push("OCCLUSION_QUERIES"),m.terrainRenderModeElevated()&&Ie&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),He.text.zOffsetVertexBuffer&&Be.push("Z_OFFSET");let $i=He.text.programConfigurations.get(h.id),On=m.getOrCreateProgram(He.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:$i,defines:Be}),Te,Nr=[0,0],yr=null,Zi=He.textSizeData;He.iconsInText&&(Nr=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],yr=je.imageAtlasTexture?je.imageAtlasTexture:null,Te=Ie||re.pitch!==0||m.options.rotating||m.options.zooming||Zi.kind==="composite"||Zi.kind==="camera"?ie.LINEAR:ie.NEAREST);let Sr=je.glyphAtlasTexture?je.glyphAtlasTexture.size:[0,0],qr=r.aD(Zi,re.zoom),go=ja(Lt,je.tileID.canonical,Ie,Ce,re,He.getProjection(),Wt),to=Ul(Lt,je.tileID.canonical,Ie,Ce,re,He.getProjection(),Wt),la=m.translatePosMatrix(to,je,M,O,!0),ca=m.translatePosMatrix(Lt,je,M,O),bs=ut?qa:go,ts=Ce&&!Ie&&!pn,ws=ct;!Ne&&!re.mercatorFromTransition||Ce||(ws=_y(re));let lc=st?ws:ct,Xu;Xu=He.iconsInText?fy(Zi.kind,qr,ts,Ie,m,ca,bs,la,Sr,Nr,at,pt,xe,kn,lc,He.getProjection()):Md(Zi.kind,qr,ts,Ie,m,ca,bs,la,!0,Sr,!0,at,pt,xe,kn,lc,He.getProjection());let cc=je.glyphAtlasTexture?je.glyphAtlasTexture:null,uc=ie.LINEAR,Qd=h.paint.get("text-halo-width").constantOr(1)!==0,Jd=m.terrain&&Ie&&pn?r.ad.invert(r.ad.create(),go):qa;if(pn&&He.text){let il=re.elevation,vr=il?il.getAtTileOffsetFunc(at,re.center.lat,re.worldSize,He.getProjection()):null,jm=Ua(Lt,je.tileID.canonical,Ie,Ce,re,He.getProjection(),Wt);gd(He,Lt,m,!0,jm,to,Ie,q,vr,at)}return{program:On,buffers:He.text,uniformValues:Xu,atlasTexture:cc,atlasTextureIcon:yr,atlasInterpolation:uc,atlasInterpolationIcon:Te,isSDF:!0,hasHalo:Qd,tile:je,labelPlaneMatrixInv:Jd}},Yn=He.icon.segments.get().length,Ln=He.text.segments.get().length,on=Yn&&!E.onlyText?$t():null,Gt=Ln&&!E.onlyIcons?Mn():null,ei=h.paint.get("icon-opacity").constantOr(1),ii=h.paint.get("text-opacity").constantOr(1);if($e&&He.canOverlap){Ge=!0;let pn=ei&&!E.onlyText?He.icon.segments.get():[],Be=ii&&!E.onlyIcons?He.text.segments.get():[];for(let ut of pn)ot.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:on});for(let ut of Be)ot.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:Gt})}else E.onlyText||ot.push({segments:ei?He.icon.segments:new r.b([]),sortKey:0,state:on}),E.onlyIcons||ot.push({segments:ii?He.text.segments:new r.b([]),sortKey:0,state:Gt})}Ge&&ot.sort((at,je)=>at.sortKey-je.sortKey);for(let at of ot){let je=at.state;if(je)if(m.terrain&&m.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!1,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),J.activeTexture.set(ie.TEXTURE0),je.atlasTexture&&je.atlasTexture.bind(je.atlasInterpolation,ie.CLAMP_TO_EDGE,!0),je.atlasTextureIcon&&(J.activeTexture.set(ie.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,ie.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,je.program),je.hasHalo){let He=je.uniformValues;He.u_is_halo=1,Xl(je.buffers,at.segments,h,m,je.program,Ve,v,x,He,2),He.u_is_halo=0}else{if(je.isSDF){let He=je.uniformValues;je.hasHalo&&(He.u_is_halo=1,Xl(je.buffers,at.segments,h,m,je.program,Ve,v,x,He,1)),He.u_is_halo=0}Xl(je.buffers,at.segments,h,m,je.program,Ve,v,x,je.uniformValues,1)}}}function Xl(m,s,h,g,v,x,E,C,M,P){let O=g.context.gl,N=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];m.occlusionQueryOpacityVertexBuffer.length>0&&N.push(m.occlusionQueryOpacityVertexBuffer),v.draw(g,O.TRIANGLES,x,E,C,r.af.disabled,M,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,g.transform.zoom,m.programConfigurations.get(h.id),N,P)}function um(m,s,h,g,v,x,E){let C=m.context.gl,M=h.paint.get("fill-pattern"),P=M&&M.constantOr(1),O,N,B,V,G;E?(N=P&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=C.LINES):(N=P?"fillPattern":"fill",O=C.TRIANGLES);for(let H of g){let q=s.getTile(H);if(P&&!q.patternsLoaded())continue;let W=q.getBucket(h);if(!W)continue;m.prepareDrawTile();let ee=W.programConfigurations.get(h.id),te=m.isTileAffectedByFog(H),ne=m.getOrCreateProgram(N,{config:ee,overrideFog:te});P&&(m.context.activeTexture.set(C.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ee.updatePaintBuffers());let ue=M.constantOr(null);if(ue&&q.imageAtlas){let ie=q.imageAtlas.patternPositions[ue.toString()];ie&&ee.setConstantPatternPositions(ie)}let ce=m.translatePosMatrix(H.projMatrix,q,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),J=h.paint.get("fill-emissive-strength");if(E){V=W.indexBuffer2,G=W.segments2;let ie=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];B=N==="fillOutlinePattern"&&P?Dd(ce,J,m,q,ie):hy(ce,J,ie)}else V=W.indexBuffer,G=W.segments,B=P?im(ce,J,m,q):nm(ce,J);m.uploadCommonUniforms(m.context,ne,H.toUnwrapped()),ne.draw(m,O,v,m.stencilModeForClipping(H),x,r.af.disabled,B,h.id,W.layoutVertexBuffer,V,G,h.paint,m.transform.zoom,ee,void 0)}}function Kl(m,s,h,g,v,x,E,C){h.resetLayerRenderingStats(m);let M=m.context,P=M.gl,O=m.transform,N=h.paint.get("fill-extrusion-pattern"),B=N.constantOr(1),V=h.paint.get("fill-extrusion-opacity"),G=m.style.enable3dLights(),H=h.paint.get(G&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H],W=h.layout.get("fill-extrusion-edge-radius"),ee=W>0&&!h.paint.get("fill-extrusion-rounded-roof"),te=ee?0:W,ne=O.projection.name==="globe"?r.bY():0,ue=O.projection.name==="globe",ce=ue?r.a1(O.zoom):0,J=[r.aj(O.center.lng),r.ak(O.center.lat)],ie=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),re=h.paint.get("fill-extrusion-flood-light-intensity"),ge=h.paint.get("fill-extrusion-vertical-scale"),Ce=gs(m,h.paint.get("fill-extrusion-cutoff-fade-range")),ae=h.paint.get("fill-extrusion-emissive-strength"),Ie=[],Me;ue&&Ie.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Ie.push("FAUX_AO"),ee&&Ie.push("ZERO_ROOF_RADIUS"),C&&Ie.push("HAS_CENTROID"),re>0&&Ie.push("FLOOD_LIGHT"),Ce.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");let $e=m.renderPass==="shadow",Ge=m.shadowRenderer,Ve=$e&&!!Ge;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let xe=[0,0,0];if(Ge){let ot=m.style.directionalLight,ct=m.style.ambientLight;ot&&ct&&(xe=_s(m.style,ot,ct)),Me=Ie.concat(["SHADOWS_SINGLE_CASCADE"])}let Re=Ve?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",Ne=h.getLayerRenderingStats();for(let ot of g){let ct=s.getTile(ot),at=ct.getBucket(h);if(!at||at.projection.name!==O.projection.name)continue;let je=!1;Ge&&(je=Ge.getMaxCascadeForTile(ot.toUnwrapped())===0);let He=m.isTileAffectedByFog(ot),st=at.programConfigurations.get(h.id),pt=m.getOrCreateProgram(Re,{config:st,defines:je?Me:Ie,overrideFog:He});if(m.terrain&&m.terrain.setupElevationDraw(ct,pt,{useMeterToDem:!0}),!at.centroidVertexBuffer){let $t=pt.attributes.a_centroid_pos;$t!==void 0&&P.vertexAttrib2f($t,0,0)}!$e&&Ge&&Ge.setupShadows(ct.tileID.toUnwrapped(),pt,"vector-tile",ct.tileID.overscaledZ),B&&(m.context.activeTexture.set(P.TEXTURE0),ct.imageAtlasTexture&&ct.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),st.updatePaintBuffers());let Lt=N.constantOr(null);if(Lt&&ct.imageAtlas){let $t=ct.imageAtlas.patternPositions[Lt.toString()];$t&&st.setConstantPatternPositions($t)}let Wt=h.paint.get("fill-extrusion-vertical-gradient"),fn;if($e&&Ge){if(hm(ct.tileID,at,m))continue;let $t=Ge.calculateShadowPassMatrixFromTile(ct.tileID.toUnwrapped());fn=Wl($t,te,ge)}else{let $t=m.translatePosMatrix(ot.expandedProjMatrix,ct,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Mn=O.projection.createInversionMatrix(O,ot.canonical);fn=B?tm($t,m,Wt,V,q,te,ot,ct,ne,ce,J,Mn,ie,ge):ql($t,m,Wt,V,q,te,ot,ne,ce,J,Mn,ie,ge,re,xe,ae)}m.uploadCommonUniforms(M,pt,ot.toUnwrapped(),null,Ce);let cn=at.segments;if(O.projection.name==="mercator"&&!$e&&(cn=at.getVisibleSegments(ct.tileID,m.terrain,m.transform.getFrustum(0)),!cn.get().length))continue;if(Ne)if($e)for(let $t of cn.get())Ne.numRenderedVerticesInShadowPass+=$t.primitiveLength;else for(let $t of cn.get())Ne.numRenderedVerticesInTransparentPass+=$t.primitiveLength;let kn=[];(m.terrain||C)&&kn.push(at.centroidVertexBuffer),ue&&kn.push(at.layoutVertexExtBuffer),pt.draw(m,M.gl.TRIANGLES,v,x,E,r.af.backCCW,fn,h.id,at.layoutVertexBuffer,at.indexBuffer,cn,h.paint,m.transform.zoom,st,kn)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function kr(m,s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q,W,ee){let te=m.context,ne=te.gl,ue=m.transform,ce=m.transform.zoom,J=[],ie=gs(m,h.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(J.push("CLEAR_SUBPASS"),ee&&(J.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(ne.TEXTURE0),ee.bind(ne.LINEAR,ne.CLAMP_TO_EDGE))):P==="sdf"&&J.push("SDF_SUBPASS"),q&&J.push("HAS_CENTROID"),ie.shouldRenderCutoff&&J.push("RENDER_CUTOFF");let re=h.layout.get("fill-extrusion-edge-radius"),ge=(Ce,ae,Ie,Me,$e)=>{let Ge=ae.programConfigurations.get(h.id),Ve=m.isTileAffectedByFog(Ce),xe=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ge,defines:J,overrideFog:Ve}),Re=((ot,ct,at,je,He,st,pt,Lt,Wt,fn,cn)=>({u_matrix:ct,u_opacity:at,u_ao_pass:je?1:0,u_meter_to_tile:He,u_ao:st,u_flood_light_intensity:pt,u_flood_light_color:Lt,u_attenuation:Wt,u_edge_radius:fn,u_fb:0,u_fb_size:cn}))(0,Me,O,M,$e,[N,B*$e],V,G,H,ce>=17?0:re*$e,ee?ee.size[0]:0),Ne=[];q&&Ne.push(ae.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(te,xe,Ce.toUnwrapped(),null,ie),xe.draw(m,te.gl.TRIANGLES,v,x,E,C,Re,h.id,ae.vertexBuffer,ae.indexBuffer,Ie,h.paint,ce,Ge,Ne)};for(let Ce of g){let ae=s.getTile(Ce),Ie=ae.getBucket(h);if(!Ie||Ie.projection.name!==ue.projection.name||!Ie.groundEffect||Ie.groundEffect&&!Ie.groundEffect.hasData())continue;let Me=Ie.groundEffect,$e=1/Ie.tileToMeter;{let Ge=m.translatePosMatrix(Ce.projMatrix,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ve=Me.getDefaultSegment();ge(Ce,Me,Ve,Ge,$e)}if(W)for(let Ge=0;Ge<4;Ge++){let Ve=r.bZ[Ge](Ce),xe=s.getTile(Ve);if(!xe)continue;let Re=xe.getBucket(h);if(!Re||Re.projection.name!==ue.projection.name||!Re.groundEffect||Re.groundEffect&&!Re.groundEffect.hasData())continue;let Ne=Re.groundEffect,ot,ct;Ge===0?(ot=[-r.a3,0,0],ct=1):Ge===1?(ot=[r.a3,0,0],ct=0):Ge===2?(ot=[0,-r.a3,0],ct=3):(ot=[0,r.a3,0],ct=2);let at=Ne.regionSegments[ct];if(!at)continue;let je=new Float32Array(16);r.ad.translate(je,Ce.projMatrix,ot),ge(Ce,Ne,at,m.translatePosMatrix(je,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$e)}}}function Rd(m,s,h,g,v,x,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let C=x?x.findDEMTileFor(h):null;if(!(C&&C.dem||E))return;let M=W=>new r.P(Math.ceil((W+r.c0)*r.c1),0),P=W=>{let ee=s.getSource().minzoom,te=ue=>{let ce=s.getTileByID(ue);if(ce&&ce.hasData())return ce.getBucket(v)},ne=[0,-1,1];for(let ue of ne){if(W.overscaledZ+ue<ee)continue;let ce=te(W.calculateScaledKey(W.overscaledZ+ue));if(ce)return ce}},O=[0,0,0],N=(W,ee)=>(O[0]=Math.min(W.min.y,ee.min.y),O[1]=Math.max(W.max.y,ee.max.y),O[2]=r.a3-ee.min.x>W.max.x?ee.min.x-r.a3:W.max.x,O),B=(W,ee)=>(O[0]=Math.min(W.min.x,ee.min.x),O[1]=Math.max(W.max.x,ee.max.x),O[2]=r.a3-ee.min.y>W.max.y?ee.min.y-r.a3:W.max.y,O),V=[(W,ee)=>N(W,ee),(W,ee)=>N(ee,W),(W,ee)=>B(W,ee),(W,ee)=>B(ee,W)],G=(W,ee,te,ne,ue,ce,J)=>{if(!x)return 0;let ie=[[ce?te:W,ce?W:te,0],[ce?te:ee,ce?ee:te,0]],re=J<0?r.a3+J:J,ge=[ce?re:(W+ee)/2,ce?(W+ee)/2:re,0];return te===0&&J<0||te!==0&&J>0?x.getForTilePoints(ue,[ge],!0,ne):ie.push(ge),x.getForTilePoints(h,ie,!0,C),Math.max(ie[0][2],ie[1][2],ge[2])/x.exaggeration()};for(let W=0;W<4;W++){let ee=g.borderFeatureIndices[W];if(ee.length===0)continue;let te=r.bZ[W](h),ne=P(te);if(!(ne&&ne instanceof r.b_)||g.borderDoneWithNeighborZ[W]===ne.canonical.z)continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();let ue=x?x.findDEMTileFor(te):null;if(!(ue&&ue.dem||E))continue;let ce=(W<2?1:5)-W,J=ne.borderDoneWithNeighborZ[ce]!==g.canonical.z,ie=ne.borderFeatureIndices[ce],re=0;if(g.canonical.z!==ne.canonical.z){for(let ge of ee)g.showCentroid(g.featuresOnBorder[ge]);if(J)for(let ge of ie)ne.showCentroid(ne.featuresOnBorder[ge]);g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}for(let ge of ee){let Ce=g.featuresOnBorder[ge],ae=g.centroidData[Ce.centroidDataIndex],Ie=Ce.borders[W],Me;for(;re<ie.length;){Me=ne.featuresOnBorder[ie[re]];let $e=Me.borders[ce];if($e[1]>Ie[0]+3||$e[0]>Ie[0]-3)break;ne.showCentroid(Me),re++}if(Me&&re<ie.length){let $e=re,Ge=0;for(;!(Me.borders[ce][0]>Ie[1]-3)&&(Ge++,++re!==ie.length);)Me=ne.featuresOnBorder[ie[re]];if(Me=ne.featuresOnBorder[ie[$e]],Ge>1){let Re=Me.borders[ce];Math.abs(Ie[0]-Re[0])<3&&Math.abs(Ie[1]-Re[1])<3&&(Ge=1,re=$e+1)}else if(Ge===0){g.showCentroid(Ce);continue}let Ve=ne.centroidData[Me.centroidDataIndex];E&&Ge===1&&(((H=ae).flags|(q=Ve).flags)&r.b$?(H.flags|=r.b$,q.flags|=r.b$):(H.flags&=~r.b$,q.flags&=~r.b$));let xe=Ce.intersectsCount()>1||Me.intersectsCount()>1;if(Ge>1)re=$e,ae.centroidXY=Ve.centroidXY=new r.P(0,0);else if(ue&&ue.dem&&!xe){let Re=V[W](ae,Ve),Ne=W%2?r.a3-1:0,ot=G(Re[0],Math.min(r.a3-1,Re[1]),Ne,ue,te,W<2,Re[2]);ae.centroidXY=Ve.centroidXY=M(ot)}else xe?ae.centroidXY=Ve.centroidXY=new r.P(0,0):(ae.centroidXY=g.encodeBorderCentroid(Ce),Ve.centroidXY=ne.encodeBorderCentroid(Me));g.writeCentroidToBuffer(ae),ne.writeCentroidToBuffer(Ve)}else g.showCentroid(Ce)}g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}var H,q;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}let Wa=[1,0,0],vy=[0,1,0],kd=[0,0,1];function hm(m,s,h){let g=h.transform,v=h.shadowRenderer;if(!v)return!0;let x=m.toUnwrapped(),E=g.tileSize*v._cascades[h.currentShadowCascade].scale,C=s.maxHeight;if(g.elevation){let H=g.elevation.getMinMaxForTile(m);H&&(C+=H.max)}let M=[...v.shadowDirection];M[2]=-M[2];let P=v.computeSimplifiedTileShadowVolume(x,C,E,M);if(!P)return!1;let O=[Wa,vy,kd,M,[M[0],0,M[2]],[0,M[1],M[2]]],N=g.projection.name==="globe",B=g.scaleZoom(E),V=r.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,B,!N),G=v.getCurrentCascadeFrustum();return V.intersectsPrecise(P.vertices,P.planes,O)===0||G.intersectsPrecise(P.vertices,P.planes,O)===0}function Su(m){return[m[0]*r.c2,m[1]*r.c2,m[2]*r.c2,0]}function Mu(m,s,h,g,v,x,E,C,M){let P=g.getSource(),O=h.globeSharedBuffers;if(!O)return;let N,B,V;if(s&&(N=g.getTile(s)),P instanceof r.bm?(B=P.texture,V=r.bh(0,0,h.transform)):N&&s&&(B=N.texture,V=r.bh(s.canonical.z,s.canonical.x,h.transform)),!B||!V)return;m||(V=r.ad.scale(r.ad.create(),V,[1,-1,1]));let G=h.context,H=G.gl,q=v.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR,W=h.colorModeForDrapableLayerRenderPass(x),ee=E.defines;ee.push("GLOBE_POLES");let te=new r.ae(H.LEQUAL,r.ae.ReadWrite,h.depthRangeFor3D),ne=Float32Array.from(h.transform.expandedFarZProjMatrix),ue=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),G.activeTexture.set(H.TEXTURE0),B.bind(q,H.CLAMP_TO_EDGE),G.activeTexture.set(H.TEXTURE1),B.bind(q,H.CLAMP_TO_EDGE),B.useMipmap&&G.extTextureFilterAnisotropic&&h.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);let[ce,J,ie,re]=s?O.getPoleBuffers(s.canonical.z,!1):O.getPoleBuffers(0,!0),ge=v.paint.get("raster-elevation"),Ce;m?(Ce=ce,h.renderDefaultNorthPole=ge!==0):(Ce=J,h.renderDefaultSouthPole=ge!==0);let ae=Su(E.mix),Ie=(($e,Ge,Ve,xe,Re,Ne,ot,ct,at,je,He,st,pt)=>Eu($e,Ge,Ve,new Float32Array(16),new Float32Array(9),[0,0],xe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ne,[0,0],ct,2,je,He,st,1,0,pt))(ne,ue,V,r.a1(h.transform.zoom),0,v,0,ge,0,ae,E.offset,E.range,x),Me=h.getOrCreateProgram("raster",{defines:ee});h.uploadCommonUniforms(G,Me,null),Me.draw(h,H.TRIANGLES,te,M,W,C,Ie,v.id,Ce,ie,re)}function En(m){let s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,v=.2*m.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}function g1(m,s,h,g){if(m)return s instanceof Hl&&m instanceof r.c3?s.getTextureDescriptor(m,h,!0):{texture:m.texture,mix:Su(g.mix),offset:g.offset,buffer:0,tileSize:1}}function Dt(m,s,h){if(!m)return null;let g=s.getTextureDescriptor(m,h,!0);if(!g)return null;let{texture:v,mix:x,offset:E,tileSize:C,buffer:M,format:P}=g;if(!v||!P)return null;let O=!1;return P==="uint32"&&(O=!0,x[3]=0,x=dy(r.c4,x,[0,h.paint.get("raster-particle-max-speed")]),E=om(r.c4,E,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[M/(C+2*M),C/(C+2*M)],tileSize:C,scalarData:O,scale:x,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function xy(m){let s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,v=.2*m.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}let Od=new r.C(1,0,0,1),dm=new r.C(0,1,0,1),Qo=new r.C(0,0,1,1),fm=new r.C(1,0,1,1),Ql=new r.C(0,1,1,1);function dt(m,s,h,g,v,x,E){let C=m.context,M=m.transform,P=C.gl,O=M.projection.name==="globe",N=O?["PROJECTION_GLOBE_VIEW"]:[],B=r.ad.clone(h.projMatrix);if(O&&r.a1(M.zoom)>0){let ae=r.c5(h.canonical,M),Ie=r.c6(ae);B=r.ad.multiply(new Float32Array(16),M.globeMatrix,Ie),r.ad.multiply(B,M.projMatrix,B)}let V=r.ad.create();V[12]+=2*v/(r.e.devicePixelRatio*M.width),V[13]+=2*x/(r.e.devicePixelRatio*M.height),r.ad.multiply(B,V,B);let G=m.getOrCreateProgram("debug",{defines:N}),H=s.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(H,G);let q=r.ae.disabled,W=r.ag.disabled,ee=m.colorModeForRenderPass(),te="$debug";C.activeTexture.set(P.TEXTURE0),m.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),O?H._makeGlobeTileDebugBuffers(m.context,M):H._makeDebugTileBoundsBuffers(m.context,M.projection);let ne=H._tileDebugBuffer||m.debugBuffer,ue=H._tileDebugIndexBuffer||m.debugIndexBuffer,ce=H._tileDebugSegments||m.debugSegments;if(G.draw(m,P.LINE_STRIP,q,W,ee,r.af.disabled,Sd(B,g),te,ne,ue,ce,null,null,null,[H._globeTileDebugBorderBuffer]),E){let ae=H.latestRawTileData,Ie=Math.floor((ae&&ae.byteLength||0)/1024),Me=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Me+=` => ${h.overscaledZ}`),Me+=` ${H.state}`,Me+=` ${Ie}kb`,function($e,Ge){$e.initDebugOverlayCanvas();let Ve=$e.debugOverlayCanvas,xe=$e.context.gl,Re=$e.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,Ve.width,Ve.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(Ge,5,5),Re.strokeText(Ge,5,5),$e.debugOverlayTexture.update(Ve),$e.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(m,Me)}let J=s.getTile(h).tileSize,ie=512/Math.min(J,512)*(h.overscaledZ/M.zoom)*.5,re=H._tileDebugTextBuffer||m.debugBuffer,ge=H._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ce=H._tileDebugTextSegments||m.debugSegments;G.draw(m,P.TRIANGLES,q,W,r.a.alphaBlended,r.af.disabled,Sd(B,r.C.transparent,ie),te,re,ge,Ce,null,null,null,[H._globeTileDebugTextBuffer])}function Tn(m,s,h,g){Or(m,0,s+h/2,m.transform.width,h,g)}function Cn(m,s,h,g){Or(m,s-h/2,0,h,m.transform.height,g)}function Or(m,s,h,g,v,x){let E=m.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*r.e.devicePixelRatio,h*r.e.devicePixelRatio,g*r.e.devicePixelRatio,v*r.e.devicePixelRatio),E.clear({color:x}),C.disable(C.SCISSOR_TEST)}let Jl=r.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xn}=Jl;function Ao(m,s,h,g){m.emplaceBack(s,h,g)}class ec{constructor(s){this.vertexArray=new r.c8,this.indices=new r.bu,Ao(this.vertexArray,-1,-1,1),Ao(this.vertexArray,1,-1,1),Ao(this.vertexArray,-1,1,1),Ao(this.vertexArray,1,1,1),Ao(this.vertexArray,-1,-1,-1),Ao(this.vertexArray,1,-1,-1),Ao(this.vertexArray,-1,1,-1),Ao(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,xn),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=r.b.simpleSegment(0,0,36,12)}}function Jo(m,s,h,g,v,x){let E=m.context.gl,C=s.paint.get("sky-atmosphere-color"),M=s.paint.get("sky-atmosphere-halo-color"),P=s.paint.get("sky-atmosphere-sun-intensity"),O=((N,B,V,G,H)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:V,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(r.bC.fromMat4(r.bC.create(),g),v,P,C,M);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),h.draw(m,E.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.frontCW,O,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}let Hr=r.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Oi{constructor(s){let h=new r.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let g=new r.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Hr.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=r.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let _1=r.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Au{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class pm{constructor(s){this.colorModeAlphaBlendedWriteRGB=new r.a([r.ca,r.cb,r.ca,r.cb],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.ca,r.cc,r.ca,r.cc],r.C.transparent,[!1,!1,!1,!0]),this.params=new Au,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){let h=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Oi(h);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(O){let N=r.cf(30),B=[];for(let V=0;V<O;++V){let G=2*Math.PI*N(),H=Math.acos(1-2*N())-.5*Math.PI;B.push(r._.fromValues(Math.cos(H)*Math.cos(G),Math.cos(H)*Math.sin(G),Math.sin(H)))}return B}(this.params.starsCount),E=r.cf(300),C=new r.cd,M=new r.bu,P=0;for(let O=0;O<x.length;++O){let N=r._.scale([],x[O],200),B=Math.max(0,1+.01*g*(1*E()-.5)),V=Math.max(0,1+.01*v*(1*E()-.5));C.emplaceBack(N[0],N[1],N[2],-1,-1,B,V),C.emplaceBack(N[0],N[1],N[2],1,-1,B,V),C.emplaceBack(N[0],N[1],N[2],1,1,B,V),C.emplaceBack(N[0],N[1],N[2],-1,1,B,V),M.emplaceBack(P+0,P+1,P+2),M.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=h.createVertexBuffer(C,_1.members),this.starsIdx=h.createIndexBuffer(M),this.starsSegments=r.b.simpleSegment(0,0,C.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,h){let g=s.context,v=g.gl,x=s.transform,E=new r.ae(v.LEQUAL,r.ae.ReadOnly,[0,1]),C=r.a1(x.zoom),M=s.style.getLut(h.scope),P=h.properties.get("color").toRenderColor(M).toArray01(),O=h.properties.get("high-color").toRenderColor(M).toArray01(),N=h.properties.get("space-color").toRenderColor(M).toArray01PremultipliedAlpha(),B=5e-4,V=r.ce(h.properties.get("horizon-blend"),0,1,B,.25),G=r.ba(s,g,x)&&V===B?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,H=s.frameCounter/1e3%1,q=r._.length(x.globeCenterInViewSpace),W=Math.sqrt(Math.pow(q,2)-Math.pow(G,2)),ee=Math.acos(W/q),te=ne=>{let ue=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&ue.push("ALPHA_PASS");let ce=s.getOrCreateProgram("globeAtmosphere",{defines:ue}),J=((re,ge,Ce,ae,Ie,Me,$e,Ge,Ve,xe,Re,Ne)=>({u_frustum_tl:re,u_frustum_tr:ge,u_frustum_br:Ce,u_frustum_bl:ae,u_horizon:Ie,u_transition:Me,u_fadeout_range:$e,u_color:Ge,u_high_color:Ve,u_space_color:xe,u_temporal_offset:Re,u_horizon_angle:Ne}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,C,V,P,O,N,H,ee);s.uploadCommonUniforms(g,ce);let ie=this.atmosphereBuffer;ie&&ce.draw(s,v.TRIANGLES,E,r.ag.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.af.backCW,J,ne?"atmosphere_glow_alpha":"atmosphere_glow",ie.vertexBuffer,ie.indexBuffer,ie.segments)};te(!1),te(!0)}drawStars(s,h){let g=r.at(h.properties.get("star-intensity"),0,1);if(g===0)return;let v=s.context,x=v.gl,E=s.transform,C=s.getOrCreateProgram("stars"),M=r.av.identity([]);r.av.rotateX(M,M,-E._pitch),r.av.rotateZ(M,M,-E.angle),r.av.rotateX(M,M,r.ab(E._center.lat)),r.av.rotateY(M,M,-r.ab(E._center.lng));let P=r.ad.fromQuat(new Float32Array(16),M),O=r.ad.multiply([],E.starsProjMatrix,P),N=r.bC.fromMat4([],P),B=r.bC.invert([],N),V=[0,1,0];r._.transformMat3(V,V,B),r._.scale(V,V,this.params.sizeMultiplier);let G=[1,0,0];r._.transformMat3(G,G,B),r._.scale(G,G,this.params.sizeMultiplier);let H=(q=V,W=G,ee=g,{u_matrix:Float32Array.from(O),u_up:q,u_right:W,u_intensity_multiplier:ee});var q,W,ee;s.uploadCommonUniforms(v,C),this.starsVx&&this.starsIdx&&C.draw(s,x.TRIANGLES,r.ae.disabled,r.ag.disabled,this.colorModeAlphaBlendedWriteRGB,r.af.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function tc(m,s){let h=[...m],g=s.cameraWorldSizeForFog/s.worldSize,v=r.ad.identity([]);return r.ad.scale(v,v,[g,g,1]),r.ad.multiply(h,v,h),r.ad.multiply(h,s.worldToFogMatrix,h),h}function Pu(m,s,h,g,v){let x=h.material,E=g.context,{baseColorTexture:C,metallicRoughnessTexture:M}=x.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:O,emissionTexture:N}=x;function B(V,G,H){if(V&&(m.push(G),E.activeTexture.set(E.gl.TEXTURE0+H),V.gfxTexture)){let{minFilter:q,magFilter:W,wrapS:ee,wrapT:te}=V.sampler;V.gfxTexture.bindExtraParam(q,W,ee,te)}}B(C,"HAS_TEXTURE_u_baseColorTexture",Ir.BaseColor),B(M,"HAS_TEXTURE_u_metallicRoughnessTexture",Ir.MetallicRoughness),B(P,"HAS_TEXTURE_u_normalTexture",Ir.Normal),B(O,"HAS_TEXTURE_u_occlusionTexture",Ir.Occlusion),B(N,"HAS_TEXTURE_u_emissionTexture",Ir.Emission),v&&(v.texture||(v.texture=new r.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],E.gl.RGBA)),E.activeTexture.set(E.gl.TEXTURE0+Ir.LUT),v.texture&&v.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(h.texcoordBuffer)),h.colorBuffer&&(m.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(h.colorBuffer)),h.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(h.normalBuffer)),h.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(h.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES")}function Za(m,s,h,g,v,x){let E=h.paint.get("model-opacity"),C=s.context,M=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,s.depthRangeFor3D),P=s.transform,O=m.mesh,N=O.material,B=N.pbrMetallicRoughness,V=s.style.fog,G;G=s.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:r.ad.multiply([],g.zScaleMatrix,m.nodeModelMatrix),r.ad.multiply(G,g.negCameraPosMatrix,G);let H=r.ad.invert([],G);r.ad.transpose(H,H);let q=h.paint.get("model-emissive-strength").constantOr(0),W=Iu(new Float32Array(m.worldViewProjection),new Float32Array(G),new Float32Array(H),null,s,E,B.baseColorFactor.toRenderColor(null),N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,q,h),ee={defines:[]},te=[];Pu(ee.defines,te,O,s,h.lut);let ne=s.shadowRenderer;ne&&(ne.useNormalOffset=!1);let ue=null;if(V){let ie=tc(m.nodeModelMatrix,s.transform);if(ue=new Float32Array(ie),P.projection.name!=="globe"){let re=O.aabb.min,ge=O.aabb.max,[Ce,ae]=V.getOpacityForBounds(ie,re[0],re[1],ge[0],ge[1]);ee.overrideFog=Ce>=ai||ae>=ai}}let ce=gs(s,h.paint.get("model-cutoff-fade-range"));ce.shouldRenderCutoff&&ee.defines.push("RENDER_CUTOFF");let J=s.getOrCreateProgram("model",ee);s.uploadCommonUniforms(C,J,null,ue,ce),s.renderPass!=="shadow"&&ne&&ne.setupShadowsFromMatrix(m.nodeModelMatrix,J),J.draw(s,C.gl.TRIANGLES,M,v,x,O.material.doubleSided?r.af.disabled:r.af.backCCW,W,h.id,O.vertexBuffer,O.indexBuffer,O.segments,h.paint,s.transform.zoom,void 0,te)}function _r(m,s,h,g,v,x,E){let C;C=m.projection.name==="globe"?r.ci(h,m):[...h],r.ad.multiply(C,C,s.matrix);let M=r.ad.multiply([],g,C);if(s.meshes)for(let P of s.meshes){if(P.material.alphaMode!=="BLEND"){E.push({mesh:P,depth:0,modelIndex:v,worldViewProjection:M,nodeModelMatrix:C});continue}let O=r._.transformMat4([],P.centroid,M);O[2]>0&&x.push({mesh:P,depth:O[2],modelIndex:v,worldViewProjection:M,nodeModelMatrix:C})}if(s.children)for(let P of s.children)_r(m,P,h,g,v,x,E)}function Lr(m,s,h,g){let v=h.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),E=v.getShadowPassColorMode(),C=v.calculateShadowPassMatrixFromMatrix(s),M=my(C);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,x,r.ag.disabled,E,r.af.backCCW,M,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,h.transform.zoom,void 0,void 0)}function by(m,s,h){let g=s.updateZoomBasedPaintProperties(),v=function(x,E,C){let M,P,O,N=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&N>0){let B=x.terrain,V=B.findDEMTileFor(C);V&&V.dem?M=r.ck.create(B,C,V):N=0}if(N===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),N===E.validForExaggeration&&(N===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(let B in E.instancesPerModel){let V=E.instancesPerModel[B];for(let G=0;G<V.instancedDataArray.length;++G){let H=(M?N*M.getElevationAt(0|V.instancedDataArray.float32[16*G],0|V.instancedDataArray.float32[16*G+1],!0,!0):0)+V.instancesEvaluatedElevation[G];V.instancedDataArray.float32[16*G+6]=H,P=P?Math.min(E.terrainElevationMin,H):H,O=O?Math.max(E.terrainElevationMax,H):H}}return E.terrainElevationMin=P||0,E.terrainElevationMax=O||0,E.validForExaggeration=N,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,h);(g||v)&&(s.uploaded=!1,s.upload(m.context))}let Fr={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.b6([0,0,0],[r.a3,r.a3,0])};function Vi(m,s){let h=1<<m.canonical.z,g=s.getFreeCameraOptions().position,v=s.elevation,x=m.canonical.x/h,E=(m.canonical.x+1)/h,C=m.canonical.y/h,M=(m.canonical.y+1)/h,P=s._centerAltitude;if(v){let V=v.getMinMaxForTile(m);V&&V.max>P&&(P=V.max)}let O=r.at(g.x,x,E)-g.x,N=r.at(g.y,C,M)-g.y,B=r.ax(P,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(O*O+N*N+B*B))}function po(m,s,h,g,v,x,E){let C=m.context,M=m.renderPass==="shadow",P=m.shadowRenderer,O=M&&P?P.getShadowPassDepthMode():new r.ae(C.gl.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D),N=m.isTileAffectedByFog(x);if(h.meshes)for(let B of h.meshes){let V=["MODEL_POSITION_ON_GPU"],G=[],H,q,W;g.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");let ee=gs(m,s.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),M&&P)H=m.getOrCreateProgram("modelDepth",{defines:V}),q=my(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(h.matrix)),W=P.getShadowPassColorMode();else{Pu(V,G,B,m,s.lut),H=m.getOrCreateProgram("model",{defines:V,overrideFog:N});let ne=B.material,ue=ne.pbrMetallicRoughness,ce=s.paint.get("model-opacity"),J=s.paint.get("model-emissive-strength").constantOr(0);q=Iu(x.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,m,ce,ue.baseColorFactor.toRenderColor(null),ne.emissiveFactor,ue.metallicFactor,ue.roughnessFactor,ne,J,s,v),P&&(E.shadowUniformsInitialized?H.setShadowUniformValues(C,P.getShadowUniformValues()):(P.setupShadows(x.toUnwrapped(),H,"model-tile",x.overscaledZ),E.shadowUniformsInitialized=!0)),W=ee.shouldRenderCutoff||ce<1||ne.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}m.uploadCommonUniforms(C,H,x.toUnwrapped(),null,ee);let te=B.material.doubleSided?r.af.disabled:r.af.backCCW;if(g.instancedDataArray.length>20)G.push(g.instancedDataBuffer),H.draw(m,C.gl.TRIANGLES,O,r.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,m.transform.zoom,void 0,G,g.instancedDataArray.length);else{let ne=M?"u_instance":"u_normal_matrix";for(let ue=0;ue<g.instancedDataArray.length;++ue)q[ne]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ue,16),H.draw(m,C.gl.TRIANGLES,O,r.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,m.transform.zoom,void 0,G)}}if(h.children)for(let B of h.children)po(m,s,B,g,v,x,E)}let vs=[1,-1,1];function Wi(m,s,h,g){if(!h.modelManager)return!0;let v=h.modelManager;if(!h.shadowRenderer)return!0;let x=h.shadowRenderer,E=s.aabb,C=!0,M=m.maxHeight;if(M===0){let O=0;for(let N in m.instancesPerModel){let B=v.getModel(N,g);B?O=Math.max(O,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):C=!1}M=m.maxScale*O*1.41+m.maxVerticalOffset,C&&(m.maxHeight=M)}E.max[2]=M,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,r._.transformMat4(E.min,E.min,s.tileMatrix),r._.transformMat4(E.max,E.max,s.tileMatrix);let P=E.intersects(x.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=P===2),P===0}function mm(m,s){let h=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],x=m.uniformValues.u_cutoff_params[3];return g===h||x===v?1:r.at(((s-h)/(g-h)-v)/(x-v),0,1)}function Po(m,s,h,g){if(s.pitch<20)return 1;let v=s.getWorldToCameraMatrix(),x=r.ad.multiply([],v,m),E=[...h.min,1],C=r.aA.transformMat4([],E,x),M=C,P=C;E[1]=h.max[1],C=r.aA.transformMat4([],E,x),M=C[1]<M[1]?C:M,P=C[1]>P[1]?C:P,E[0]=h.max[0],C=r.aA.transformMat4([],E,x),M=C[1]<M[1]?C:M,P=C[1]>P[1]?C:P,E[1]=h.min[1],C=r.aA.transformMat4([],E,x),M=C[1]<M[1]?C:M,P=C[1]>P[1]?C:P;let O=r.at(g[0],0,1),N=100*s.pixelsPerMeter*r.at(g[1],0,1),B=r.at(g[2],0,1),V=r._.lerp([],M,P,O),G=Math.tan(.5*s.fovX),H=-V[2]*G;if(N===0)return V[1]<-Math.abs(H)?B:1;let q=(-Math.abs(H)-V[1])/N,W=(te,ne,ue)=>(1-ue)*te+ue*ne,ee=r.at(W(1,B,q),B,1);return W(1,ee,r.at((s.pitch-20)/20,0,1))}class Ru{}class ku{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,h,g){{let N=this._storage.get(h.id);if(N)return N.lastUsedFrameIdx=s,N.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),E=new ArrayBuffer(x),C=new Int16Array(E);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));let M=new r.cm;for(let N=0;N<x/2;N+=3){let B=C[N],V=C[N+1],G=C[N+2];M.emplaceBack(B,V),M.emplaceBack(V,G),M.emplaceBack(G,B)}let P=g.bindVertexArrayOES.current,O=new Ru;return O.buf=new r.I(g,M),O.lastUsedFrameIdx=s,this._storage.set(h.id,O),g.bindVertexArrayOES.set(P),O.buf}update(s){for(let[h,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(let[s,h]of this._storage)h.buf.destroy(),this._storage.delete(s)}}let Ya=r.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class y1{constructor(s){let h=new r.cn,g=new r.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=r.b.simpleSegment(0,0,h.length,g.length),this.vx=s.createVertexBuffer(h,Ya.members),this.idx=s.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let Ro={symbol:function(m,s,h,g,v){if(m.renderPass!=="translucent")return;let x=r.ag.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(P,O,N,B,V,G,H){let q=O.transform,W=V==="map",ee=G==="map";for(let te of P){let ne=B.getTile(te),ue=ne.getBucket(N);if(!ue||!ue.text||!ue.text.segments.get().length)continue;let ce=r.aD(ue.textSizeData,q.zoom),J=Yl(te,ue.getProjection(),q),ie=q.calculatePixelsToTileUnitsMatrix(ne),re=ja(J,ne.tileID.canonical,ee,W,q,ue.getProjection(),ie),ge=ue.hasIconTextFit()&&ue.hasIconData();if(ce){let Ce=Math.pow(2,q.zoom-ne.tileID.overscaledZ);yy(ue,W,ee,H,r.bO,q,re,te,Ce,ce,ge)}}}(g,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);let C=h.paint.get("icon-opacity").constantOr(1)!==0,M=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||M)?cm(m,s,h,g,x,E):(C&&cm(m,s,h,g,x,E,{onlyIcons:!0}),M&&cm(m,s,h,g,x,E,{onlyText:!0}),function(P,O,N,B){if(!P.symbolParams.useOcclusionQueries)return;let V=P.context.gl,G=P.transform,H=N.paint,q=H.get("icon-occlusion-opacity").constantOr(0)!==1,W=H.get("text-occlusion-opacity").constantOr(0)!==1;if(!q&&!W)return;let ee=G.projection.name==="globe";for(let te of B){let ne=O.getTile(te),ue=ne.getBucket(N);if(!ue||ue.projection.name==="mercator"&&ee||ue.fullyClipped)continue;if(ue.projection.name==="globe"){r.w(`Occlusion not supported for globe mode. Layer: ${N.type}`);continue}let ce=Yl(te,ue.getProjection(),G),J=r.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,P.symbolParams.depthOffset,1),ie=r.ad.multiply([],J,ce),re=P.symbolParams.visualizeOcclusions!=="none"?1:P.symbolParams.occlusionQueryFrameWindow;for(let ge=0;ge<ue.symbolInstances.length;ge++){let Ce=ue.symbolInstances.get(ge),ae=P.style.placement.opacities[Ce.crossTileID];if(ae&&ae.isHidden()||(P.frameCounter+ge)%re!=0)continue;let Ie=Ce.tileAnchorX,Me=Ce.tileAnchorY,$e=Ce.zOffset,Ge;if(P.symbolParams.visualizeOcclusions==="none"){let ot=ue.queries.get(ge);if(ot){if(!ot.isFree()){if(!ot.isResultAvailable())continue;let ct=ot.consumeResult();Ce.occlusionState=ct===0?0:1;continue}Ge=ot}else Ge=new Pl(P.context),ue.queries.set(ge,Ge)}let Ve=P.getOrCreateProgram("occlusion"),xe=P.symbolParams.occluderSize,Re=gy(ie,[Ie,Me,$e],[G.width,G.height],[xe,xe],P.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);P.terrain&&P.terrain.setupElevationDraw(ne,Ve,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.begin();let Ne=new r.ae(P.symbolParams.visualizeOcclusions==="zPass"?P.context.gl.ALWAYS:P.context.gl.LEQUAL,r.ae.ReadOnly,P.depthRangeFor3D);Ve.draw(P,V.TRIANGLES,Ne,r.ag.disabled,P.symbolParams.visualizeOcclusions!=="none"?r.a.alphaBlendedNonPremultiplied:r.a.disabled,r.af.disabled,Re,"occlusion",P.occlusionBuffers.vx,P.occlusionBuffers.idx,P.occlusionBuffers.segments),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.end()}}}(m,s,h,g)),s.map.showCollisionBoxes&&(Du(m,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Du(m,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,g){if(m.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),C=h.layout.get("circle-sort-key").constantOr(1)!==void 0,M=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;let P=m.context,O=P.gl,N=m.transform,B=m.depthModeForSublayer(0,r.ae.ReadOnly),V=r.ag.disabled,G=m.colorModeForDrapableLayerRenderPass(M),H=N.projection.name==="globe",q=[r.aj(N.center.lng),r.ak(N.center.lat)],W=[];for(let te=0;te<g.length;te++){let ne=g[te],ue=s.getTile(ne),ce=ue.getBucket(h);if(!ce||ce.projection.name!==N.projection.name)continue;let J=ce.programConfigurations.get(h.id),ie=r.bR(h),re=m.isTileAffectedByFog(ne);H&&ie.push("PROJECTION_GLOBE_VIEW");let ge=m.getOrCreateProgram("circle",{config:J,defines:ie,overrideFog:re}),Ce=ce.layoutVertexBuffer,ae=ce.globeExtVertexBuffer,Ie=ce.indexBuffer,Me=N.projection.createInversionMatrix(N,ne.canonical),$e={programConfiguration:J,program:ge,layoutVertexBuffer:Ce,globeExtVertexBuffer:ae,indexBuffer:Ie,uniformValues:r.bS(m,ne,ue,Me,q,h),tile:ue};if(C){let Ge=ce.segments.get();for(let Ve of Ge)W.push({segments:new r.b([Ve]),sortKey:Ve.sortKey,state:$e})}else W.push({segments:ce.segments,sortKey:0,state:$e})}C&&W.sort((te,ne)=>te.sortKey-ne.sortKey);let ee={useDepthForOcclusion:N.depthOcclusionForCircles};for(let te of W){let{programConfiguration:ne,program:ue,layoutVertexBuffer:ce,globeExtVertexBuffer:J,indexBuffer:ie,uniformValues:re,tile:ge}=te.state,Ce=te.segments;m.terrain&&m.terrain.setupElevationDraw(ge,ue,ee),m.uploadCommonUniforms(P,ue,ge.tileID.toUnwrapped()),ue.draw(m,O.TRIANGLES,B,V,G,r.af.disabled,re,h.id,ce,ie,Ce,h.paint,N.zoom,ne,[J])}},heatmap:function(m,s,h,g){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){let v=m.context,x=v.gl,E=r.ag.disabled,C=new r.a([x.ONE,x.ONE,x.ONE,x.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(V,G,H,q){let W=V.gl,ee=G.width*q,te=G.height*q;V.activeTexture.set(W.TEXTURE1),V.viewport.set([0,0,ee,te]);let ne=H.heatmapFbo;if(!ne||ne&&(ne.width!==ee||ne.height!==te)){ne&&ne.destroy();let ue=W.createTexture();W.bindTexture(W.TEXTURE_2D,ue),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ne=H.heatmapFbo=V.createFramebuffer(ee,te,!0,null),function(ce,J,ie,re,ge,Ce){let ae=ce.gl;ae.texImage2D(ae.TEXTURE_2D,0,ce.extRenderToTextureHalfFloat?ae.RGBA16F:ae.RGBA,ge,Ce,0,ae.RGBA,ce.extRenderToTextureHalfFloat?ae.HALF_FLOAT:ae.UNSIGNED_BYTE,null),re.colorAttachment.set(ie)}(V,0,ue,ne,ee,te)}else W.bindTexture(W.TEXTURE_2D,ne.colorAttachment.get()),V.bindFramebuffer.set(ne.framebuffer)})(v,m,h,m.transform.projection.name==="globe"?.5:.25),v.clear({color:r.C.transparent});let M=m.transform,P=M.projection.name==="globe",O=P?["PROJECTION_GLOBE_VIEW"]:[],N=P?r.af.frontCCW:r.af.disabled,B=[r.aj(M.center.lng),r.ak(M.center.lat)];for(let V=0;V<g.length;V++){let G=g[V];if(s.hasRenderableParent(G))continue;let H=s.getTile(G),q=H.getBucket(h);if(!q||q.projection.name!==M.projection.name)continue;let W=m.isTileAffectedByFog(G),ee=q.programConfigurations.get(h.id),te=m.getOrCreateProgram("heatmap",{config:ee,defines:O,overrideFog:W}),{zoom:ne}=m.transform;m.terrain&&m.terrain.setupElevationDraw(H,te),m.uploadCommonUniforms(v,te,G.toUnwrapped());let ue=M.projection.createInversionMatrix(M,G.canonical);te.draw(m,x.TRIANGLES,r.ae.disabled,E,C,N,Ha(m,G,H,ue,B,ne,h.paint.get("heatmap-intensity")),h.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,h.paint,m.transform.zoom,ee,P?[q.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,x){let E=v.context,C=E.gl,M=x.heatmapFbo;if(!M)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let P=x.colorRampTexture;P||(P=x.colorRampTexture=new r.T(E,x.colorRamp,C.RGBA)),P.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,C.TRIANGLES,r.ae.disabled,r.ag.disabled,v.colorModeForRenderPass(),r.af.disabled,((O,N,B,V)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(m,h))},line:function(m,s,h,g){if(m.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let E=h.paint.get("line-emissive-strength"),C=h.paint.get("line-occlusion-opacity"),M=m.context,P=M.gl,O=h.layout.get("line-z-offset"),N=!O.isConstant()||!!O.constantOr(0),B=N?new r.ae(m.depthOcclusion?P.GREATER:P.LEQUAL,r.ae.ReadOnly,m.depthRangeFor3D):m.depthModeForSublayer(0,r.ae.ReadOnly),V=m.colorModeForDrapableLayerRenderPass(E),G=m.terrain&&m.terrain.renderingToTexture,H=G?1:r.e.devicePixelRatio,q=h.paint.get("line-dasharray"),W=q.constantOr(1),ee=h.layout.get("line-cap"),te=q.constantOr(null),ne=ee.constantOr(null),ue=h.paint.get("line-pattern"),ce=ue.constantOr(1),J=ue.constantOr(null),ie=h.paint.get("line-opacity").constantOr(1),re=!ce&&ie!==1||m.depthOcclusion&&C>0&&C<1,ge=h.paint.get("line-gradient"),Ce=ce?"linePattern":"line",ae=r.bT(h),Ie;if(G&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(re=!1),C!==0&&m.depthOcclusion){let $e=h.paint._values["line-opacity"];$e&&$e.value&&$e.value.kind==="constant"?Ie=$e.value:r.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(N&&(m.forceTerrainMode=!0),!N&&C!==0&&m.terrain&&!G)return void r.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Me=re&&N?m.stencilModeFor3D():r.ag.disabled;for(let $e of g){let Ge=s.getTile($e);if(ce&&!Ge.patternsLoaded())continue;let Ve=Ge.getBucket(h);if(!Ve)continue;m.prepareDrawTile();let xe=Ve.programConfigurations.get(h.id),Re=m.isTileAffectedByFog($e),Ne=m.getOrCreateProgram(Ce,{config:xe,defines:N?[...ae,"ELEVATED"]:ae,overrideFog:Re});if(J&&Ge.imageAtlas){let st=Ge.imageAtlas.patternPositions[J.toString()];st&&xe.setConstantPatternPositions(st)}if(!ce&&te&&ne&&Ge.lineAtlas){let st=Ge.lineAtlas.getDash(te,ne);st&&xe.setConstantPatternPositions(st)}let[ot,ct]=h.paint.get("line-trim-offset");(ne==="round"||ne==="square")&&ot!==ct&&(ot===0&&(ot-=1),ct===1&&(ct+=1));let at=G?$e.projMatrix:null,je=ce?r.bU(m,Ge,h,at,H,[ot,ct]):r.bV(m,Ge,h,at,Ve.lineClipsArray.length,H,[ot,ct]);if(ge){let st=Ve.gradients[h.id],pt=st.texture;if(h.gradientVersion!==st.version){let Lt=256;if(h.stepInterpolant){let Wt=s.getSource().maxzoom,fn=$e.canonical.z===Wt?Math.ceil(1<<m.transform.maxZoom-$e.canonical.z):1;Lt=r.at(r.bW(Ve.maxLineLength/r.a3*1024*fn),256,M.maxTextureSize)}st.gradient=r.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Lt,image:st.gradient||void 0,clips:Ve.lineClipsArray}),st.texture?st.texture.update(st.gradient):st.texture=new r.T(M,st.gradient,P.RGBA),st.version=h.gradientVersion,pt=st.texture}M.activeTexture.set(P.TEXTURE1),pt.bind(h.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}W&&(M.activeTexture.set(P.TEXTURE0),Ge.lineAtlasTexture&&Ge.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),xe.updatePaintBuffers()),ce&&(M.activeTexture.set(P.TEXTURE0),Ge.imageAtlasTexture&&Ge.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xe.updatePaintBuffers()),N&&m.terrain.setupElevationDraw(Ge,Ne),m.uploadCommonUniforms(M,Ne,$e.toUnwrapped());let He=st=>{Ie!=null&&(Ie.value=ie*C),Ne.draw(m,P.TRIANGLES,B,st,V,r.af.disabled,je,h.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,h.paint,m.transform.zoom,xe,[Ve.layoutVertexBuffer2,Ve.patternVertexBuffer,Ve.zOffsetVertexBuffer]),Ie!=null&&(Ie.value=ie)};if(re&&!N){let st=m.stencilModeForClipping($e).ref;st===0&&G&&M.clear({stencil:0});let pt={func:P.EQUAL,mask:255};je.u_alpha_discard_threshold=.8,He(new r.ag(pt,st,255,P.KEEP,P.KEEP,P.INVERT)),je.u_alpha_discard_threshold=0,He(new r.ag(pt,st,255,P.KEEP,P.KEEP,P.KEEP))}else re&&N&&(je.u_alpha_discard_threshold=.001),He(N?Me:m.stencilModeForClipping($e))}re&&(m.resetStencilClippingMasks(),G&&M.clear({stencil:0})),C===0||m.depthOcclusion||G||m.layersWithOcclusionOpacity.push(m.currentLayer),N&&(m.forceTerrainMode=!1)},fill:function(m,s,h,g){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let E=h.paint.get("fill-emissive-strength"),C=m.colorModeForDrapableLayerRenderPass(E),M=h.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&v.constantOr(r.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===P){let O=m.depthModeForSublayer(1,m.renderPass==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly);um(m,s,h,g,O,C,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){let O=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,r.ae.ReadOnly);um(m,s,h,g,O,C,!0)}},"fill-extrusion":function(m,s,h,g){let v=h.paint.get("fill-extrusion-opacity"),x=m.context,E=x.gl,C=m.terrain,M=C&&C.renderingToTexture;if(v===0)return;let P=m.conflationActive&&m.style.isLayerClipped(h,s.getSource()),O=m.style.order.indexOf(h.fqid);if(P&&function(N,B,V,G,H){for(let q of G){let W=B.getTile(q).getBucket(V);W&&(W.updateReplacement(q,N.replacementSource,H),W.uploadCentroid(N.context))}}(m,s,h,g,O),C||P)for(let N of g){let B=s.getTile(N).getBucket(h);B&&Rd(m.context,s,N,B,h,C,P)}if(m.renderPass==="shadow"&&m.shadowRenderer){let N=m.shadowRenderer;if(C&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let B=N.getShadowPassDepthMode(),V=N.getShadowPassColorMode();Kl(m,s,h,g,B,r.ag.disabled,V,P)}else if(m.renderPass==="translucent"){let N=!h.paint.get("fill-extrusion-pattern").constantOr(1),B=h.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!M&&B.a!==0){let V=new r.ae(m.context.gl.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D);v===1&&N?Kl(m,s,h,g,V,r.ag.disabled,r.a.unblended,P):(Kl(m,s,h,g,V,r.ag.disabled,r.a.disabled,P),Kl(m,s,h,g,V,m.stencilModeFor3D(),m.colorModeForRenderPass(),P),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&N&&(!C&&m.transform.projection.name!=="globe"||M)){let V=h.paint.get("fill-extrusion-opacity"),G=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=h.paint.get("fill-extrusion-flood-light-intensity"),W=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ee=G>0&&H>0,te=q>0,ne=(ce,J,ie)=>(1-ie)*ce+ie*J,ue=ce=>{let J=m.depthModeForSublayer(1,r.ae.ReadOnly,E.LEQUAL,!0),ie=h.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),re=ne(.1,3,ie),ge=m._showOverdrawInspector;if(!ge){let Ce=new r.ag({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ae=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);kr(m,s,h,g,J,Ce,ae,r.af.disabled,ce,"sdf",V,G,H,q,W,re,P,!1)}{let Ce=ge?r.ag.disabled:new r.ag({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),ae=ge?m.colorModeForRenderPass():new r.a([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],r.C.transparent,[!0,!0,!0,!0]);kr(m,s,h,g,J,Ce,ae,r.af.disabled,ce,"color",V,G,H,q,W,re,P,!1)}};if(M){let ce=(J,ie,re)=>{let ge=m.depthModeForSublayer(1,r.ae.ReadOnly,E.LEQUAL,!1),Ce=h.paint.get(J?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ae=ne(.1,3,Ce);{let Ie=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0]);kr(m,s,h,g,ge,r.ag.disabled,Ie,r.af.disabled,J,"clear",V,G,H,q,W,ae,P,ie)}{let Ie=new r.ag({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Me=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);kr(m,s,h,g,ge,Ie,Me,r.af.disabled,J,"sdf",V,G,H,q,W,ae,P,ie)}{let Ie=J?E.ZERO:E.ONE_MINUS_DST_ALPHA,Me=new r.ag({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),$e=new r.a([Ie,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],r.C.transparent,[!0,!0,!0,!0]);kr(m,s,h,g,ge,Me,$e,r.af.disabled,J,"color",V,G,H,q,W,ae,P,ie)}{let Ie=new r.a([E.ONE,E.ONE,E.ONE,J?E.ZERO:E.ONE],r.C.transparent,[!1,!1,!1,!0],J?E.FUNC_ADD:E.MAX);kr(m,s,h,g,ge,r.ag.disabled,Ie,r.af.disabled,J,"clear",V,G,H,q,W,ae,P,ie,re)}};if(ee||te){let J;if(m.prepareDrawTile(),C){let ie=C.drapeBufferSize[0],re=C.drapeBufferSize[1];J=C.framebufferCopyTexture,J&&(!J||J.size[0]===ie&&J.size[1]===re)||(J&&J.destroy(),J=C.framebufferCopyTexture=new r.T(x,new r.i({width:ie,height:re}),E.RGBA)),J.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,ie,re,0)}ee&&ce(!0,!1,J),te&&ce(!1,!0,J)}}else ee&&ue(!0),te&&ue(!1)}}},hillshade:function(m,s,h,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;let v=m.context,x=m.terrain&&m.terrain.renderingToTexture,[E,C]=m.renderPass!=="translucent"||x?[{},g]:m.stencilConfigForOverlap(g);for(let M of C){let P=s.getTile(M);if(P.needsHillshadePrepare&&m.renderPass==="offscreen")Yo(m,P,h);else if(m.renderPass==="translucent"){let O=m.depthModeForSublayer(0,r.ae.ReadOnly),N=h.paint.get("hillshade-emissive-strength"),B=m.colorModeForDrapableLayerRenderPass(N),V=x&&m.terrain?m.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];u1(m,M,P,h,O,V,B)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,h,g,v,x){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let E=m.transform.projection.name==="globe",C=h.paint.get("raster-elevation")!==0,M=C&&E;if(m.renderElevatedRasterBackface&&!M)return;let P=m.context,O=P.gl,N=s.getSource(),B=function(ce,J,ie,re){let ge=J.paint.get("raster-color"),Ce=ce.type==="raster-array",ae=[],Ie=J.paint.get("raster-resampling"),Me=J.paint.get("raster-color-mix"),$e=J.paint.get("raster-color-range"),Ge=[Me[0],Me[1],Me[2],0],Ve=Me[3],xe=Ie==="nearest"?re.NEAREST:re.LINEAR;if(Ce&&(ae.push("RASTER_ARRAY"),ge||ae.push("RASTER_COLOR"),Ie==="linear"&&ae.push("RASTER_ARRAY_LINEAR"),xe=re.NEAREST,!$e&&ce.rasterLayers)){let Re=ce.rasterLayers.find(({id:Ne})=>Ne===J.sourceLayer);Re&&Re.fields&&Re.fields.range&&($e=Re.fields.range)}if($e=$e||[0,1],ge){ae.push("RASTER_COLOR"),ie.activeTexture.set(re.TEXTURE2),J.updateColorRamp($e);let Re=J.colorRampTexture;Re||(Re=J.colorRampTexture=new r.T(ie,J.colorRamp,re.RGBA)),Re.bind(re.LINEAR,re.CLAMP_TO_EDGE)}return{mix:Ge,range:$e,offset:Ve,defines:ae,resampling:xe}}(N,h,P,O);if(N instanceof r.bm&&!g.length&&!E)return;let V=h.paint.get("raster-emissive-strength"),G=m.colorModeForDrapableLayerRenderPass(V),H=m.terrain&&m.terrain.renderingToTexture,q=!m.options.moving,W=h.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(N instanceof r.bm&&!g.length&&(N.onNorthPole||N.onSouthPole)){let ce=C?m.stencilModeFor3D():r.ag.disabled;return void Mu(!!N.onNorthPole,null,m,s,h,V,B,r.af.disabled,ce)}if(!g.length)return;let[ee,te]=N instanceof r.bm||H?[{},g]:m.stencilConfigForOverlap(g),ne=te[te.length-1].overscaledZ;M&&B.defines.push("PROJECTION_GLOBE_VIEW"),C&&B.defines.push("RENDER_CUTOFF");let ue=(ce,J,ie)=>{for(let re of ce){let ge=re.toUnwrapped(),Ce=s.getTile(re);if(H&&(!Ce||!Ce.hasData()))continue;P.activeTexture.set(O.TEXTURE0);let ae=g1(Ce,N,h,B);if(!ae||!ae.texture)continue;let{texture:Ie,mix:Me,offset:$e,tileSize:Ge,buffer:Ve}=ae,xe,Re;H?(xe=r.ae.disabled,Re=re.projMatrix):C?(xe=new r.ae(O.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D),Re=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(ge,q)):(xe=m.depthModeForSublayer(re.overscaledZ-ne,h.paint.get("raster-opacity")===1?r.ae.ReadWrite:r.ae.ReadOnly,O.LESS),Re=m.transform.calculateProjMatrix(ge,q));let Ne=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(re):ee[re.overscaledZ],ot=x?0:h.paint.get("raster-fade-duration");Ce.registerFadeDuration(ot);let ct=s.findLoadedParent(re,0),at=wd(Ce,ct,s,m.transform,ot),je,He;m.terrain&&m.terrain.prepareDrawTile(),P.activeTexture.set(O.TEXTURE0),Ie.bind(W,O.CLAMP_TO_EDGE),P.activeTexture.set(O.TEXTURE1),ct?(ct.texture&&ct.texture.bind(W,O.CLAMP_TO_EDGE),je=Math.pow(2,ct.tileID.overscaledZ-Ce.tileID.overscaledZ),He=[Ce.tileID.canonical.x*je%1,Ce.tileID.canonical.y*je%1]):Ie.bind(W,O.CLAMP_TO_EDGE),Ie.useMipmap&&P.extTextureFilterAnisotropic&&m.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);let st=m.transform,pt,Lt=C?En(st):[0,0,0,0],Wt,fn,cn,kn,$t,Mn=0;if(M&&N instanceof r.bm&&N.coordinates.length>3)Wt=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0)))),fn=Float32Array.from(st.globeMatrix),cn=Float32Array.from(r.bb(st)),kn=[r.aj(st.center.lng),r.ak(st.center.lat)],pt=N.elevatedGlobePerspectiveTransform,$t=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){let Gt=r.bc(re.canonical);Mn=r.bd(Gt.getCenter().lat),Wt=Float32Array.from(r.bf(r.bg(re.canonical))),fn=Float32Array.from(st.globeMatrix),cn=Float32Array.from(r.bb(st)),kn=[r.aj(st.center.lng),r.ak(st.center.lat)],pt=[0,0],$t=Float32Array.from(r.be(re.canonical,Gt,Mn,st.worldSize/st._pixelsPerMercatorPixel))}else pt=N instanceof r.bm?N.perspectiveTransform:[0,0],Wt=new Float32Array(16),fn=new Float32Array(9),cn=new Float32Array(16),kn=[0,0],$t=new Float32Array(9);let Yn=Eu(Re,Wt,fn,cn,$t,He||[0,0],r.a1(m.transform.zoom),kn,Lt,je||1,at,h,pt,C?h.paint.get("raster-elevation"):0,2,Me,$e,B.range,Ge,Ve,V),Ln=m.isTileAffectedByFog(re),on=m.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Ln});if(m.uploadCommonUniforms(P,on,ge),N instanceof r.bm){let Gt=N.elevatedGlobeVertexBuffer,ei=N.elevatedGlobeIndexBuffer;if(H||!E)N.boundsBuffer&&N.boundsSegments&&on.draw(m,O.TRIANGLES,xe,r.ag.disabled,G,r.af.disabled,Yn,h.id,N.boundsBuffer,m.quadTriangleIndexBuffer,N.boundsSegments);else if(Gt&&ei){let ii=st.zoom<=r.b1?N.elevatedGlobeSegments:N.getSegmentsForLongitude(st.center.lng);ii&&on.draw(m,O.TRIANGLES,xe,r.ag.disabled,G,J,Yn,h.id,Gt,ei,ii)}}else if(M){xe=new r.ae(O.LEQUAL,r.ae.ReadOnly,m.depthRangeFor3D);let Gt=m.globeSharedBuffers;if(Gt){let[ei,ii,pn]=Gt.getGridBuffers(Mn,!1);on.draw(m,O.TRIANGLES,xe,ie||Ne,m.colorModeForRenderPass(),J,Yn,h.id,ei,ii,pn)}}else{let{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:ei,tileBoundsSegments:ii}=m.getTileBoundsBuffers(Ce);on.draw(m,O.TRIANGLES,xe,Ne,G,r.af.disabled,Yn,h.id,Gt,ei,ii)}}if(!(N instanceof r.bm)&&M)for(let re of ce){let ge=re.canonical.y===(1<<re.canonical.z)-1;re.canonical.y===0&&Mu(!0,re,m,s,h,V,B,J,ie||r.ag.disabled),ge&&Mu(!1,re,m,s,h,V,B,J===r.af.frontCW?r.af.backCW:r.af.frontCW,ie||r.ag.disabled)}};M?ue(te,m.renderElevatedRasterBackface?r.af.backCW:r.af.frontCW,m.stencilModeFor3D()):ue(te,r.af.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,h,g,v,x){m.renderPass==="offscreen"&&function(E,C,M,P){if(!P.length)return;let O=E.context,N=O.gl,B=C.getSource();if(!(B instanceof Hl))return;let V=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count"))),G=M.particlePositionRGBAImage;if(!G||G.width!==V){let te=function(ne){let ue=ne*ne,ce=new Uint8Array(4*ue),J=function(re){return re|=0,re=Math.imul(2747636419^re,2654435769),re=Math.imul(re^re>>>16,2654435769),((re=Math.imul(re^re>>>16,2654435769))>>>0)/4294967296},ie=1/1.3;for(let re=0;re<ue;re++){let ge=ie*(J(2*re+0)+ea),Ce=ie*(J(2*re+1)+ea),ae=255*ge%1,Ie=255*Ce%1,Me=ae,$e=Ce-Ie/255,Ge=Ie;ce[4*re+0]=255*(ge-ae/255),ce[4*re+1]=255*Me,ce[4*re+2]=255*$e,ce[4*re+3]=255*Ge}return ce}(V);G=M.particlePositionRGBAImage=new r.i({width:V,height:V},te)}let H=M.particleFramebuffer;H?H.width!==V&&(H.destroy(),H=M.particleFramebuffer=O.createFramebuffer(V,V,!0,null)):H=M.particleFramebuffer=O.createFramebuffer(V,V,!0,null);let q=[];for(let te of P){let ne=C.getTile(te);if(!(ne instanceof r.c3))continue;let ue=Dt(ne,B,M);if(!ue)continue;let ce=[ne.tileSize,ne.tileSize],J=M.tileFramebuffer;J||(J=M.tileFramebuffer=O.createFramebuffer(ce[0],ce[1],!0,null));let ie=ne.rasterParticleState;ie||(ie=ne.rasterParticleState=new co(O,te,ce,G));let re=ie.update(M.lastInvalidatedAt);ie.particleTextureDimension!==V&&ie.updateParticleTexture(te,G);let ge=ie.targetColorTexture;ie.targetColorTexture=ie.backgroundColorTexture,ie.backgroundColorTexture=ge;let Ce=ie.particleTexture0;ie.particleTexture0=ie.particleTexture1,ie.particleTexture1=Ce,q.push([te,ue,ie,re])}if(q.length===0)return;let W=r.e.now(),ee=M.previousDrawTimestamp?.001*(W-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=W,M.hasColorMap()){O.activeTexture.set(N.TEXTURE0+2);let te=M.colorRampTexture;te||(te=M.colorRampTexture=new r.T(O,M.colorRamp,N.RGBA)),te.bind(N.LINEAR,N.CLAMP_TO_EDGE)}O.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(te,ne,ue){let ce=te.context,J=ce.gl,ie=ne.tileFramebuffer;ce.activeTexture.set(J.TEXTURE0);let re={u_texture:0,u_opacity:1.05*(Ce=ne.paint.get("raster-particle-fade-opacity-factor"))/(Ce+.05)},ge=te.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ce;for(let ae of ue){let[,,Ie,Me]=ae;ie.colorAttachment.set(Ie.targetColorTexture.texture),ce.viewport.set([0,0,ie.width,ie.height]),ce.clear({color:r.C.transparent}),Me&&(Ie.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),ge.draw(te,J.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,re,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments))}}(E,M,q),function(te,ne,ue,ce){let J=te.context,ie=J.gl,re=ue.tileFramebuffer,ge=te.transform.projection.name==="globe",Ce=ue.paint.get("raster-particle-max-speed");for(let ae of ce){let[Ie,Me,$e]=ae;J.activeTexture.set(ie.TEXTURE0+0),Me.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),re.colorAttachment.set($e.targetColorTexture.texture);let Ge=te.getOrCreateProgram("rasterParticleDraw",{defines:Me.defines,overrideFog:!1});J.activeTexture.set(ie.TEXTURE0+1);let Ve=Me.scalarData?[]:[0,1,2,3].map(Ne=>r.bZ[Ne](Ie));Ve.push(Ie);let xe=Ie.canonical.x,Re=Ie.canonical.y;for(let Ne of Ve){let ot=ne.getTile(ge?Ne.wrapped():Ne);if(!ot)continue;let ct=ot.rasterParticleState;if(!ct)continue;let at=Ne.canonical.x+(1<<Ne.canonical.z)*(Ne.wrap-Ie.wrap),je=Ne.canonical.y;ct.particleTexture0.bind(ie.NEAREST,ie.CLAMP_TO_EDGE);let He=am(1,ct.particleTexture0.size[0],[at-xe,je-Re],0,Me.texture.size,2,Ce,Me.textureOffset,Me.scale,Me.offset);Ge.draw(te,ie.POINTS,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,He,ue.id,ct.particleIndexBuffer,void 0,ct.particleSegment)}}}(E,C,M,q),O.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(te,ne,ue,ce){let J=te.context,ie=J.gl,re=ne.paint.get("raster-particle-max-speed"),ge=ce*ne.paint.get("raster-particle-speed-factor")*.15,Ce=function(Ie){return Math.pow(Ie,6)}(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),ae=ne.particleFramebuffer;J.viewport.set([0,0,ae.width,ae.height]);for(let Ie of ue){let[,Me,$e]=Ie;J.activeTexture.set(ie.TEXTURE0+0),Me.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),J.activeTexture.set(ie.TEXTURE0+1);let Ge=$e.particleTexture0;Ge.bind(ie.NEAREST,ie.CLAMP_TO_EDGE);let Ve=d1(1,Ge.size[0],0,Me.texture.size,re,ge,Ce,Me.textureOffset,Me.scale,Me.offset);ae.colorAttachment.set($e.particleTexture1.texture),J.clear({color:r.C.transparent}),te.getOrCreateProgram("rasterParticleUpdate",{defines:Me.defines}).draw(te,ie.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,Ve,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments)}}(E,M,q,ee)}(m,s,h,g),m.renderPass==="translucent"&&(function(E,C,M,P,O){let N=E.context,B=N.gl,V=!E.options.moving,G=E.transform.projection.name==="globe";if(!P.length)return;let[H,q]=E.stencilConfigForOverlap(P),W=[];G&&W.push("PROJECTION_GLOBE_VIEW");let ee=E.stencilModeFor3D();for(let te of q){let ne=te.toUnwrapped(),ue=C.getTile(te);if(!ue.rasterParticleState)continue;let ce=ue.rasterParticleState,J=100;ue.registerFadeDuration(J);let ie=C.findLoadedParent(te,0),re=wd(ue,ie,C,E.transform,J),ge,Ce;E.terrain&&E.terrain.prepareDrawTile(),N.activeTexture.set(B.TEXTURE0),ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),N.activeTexture.set(B.TEXTURE1),ie&&ie.rasterParticleState?(ie.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ge=Math.pow(2,ie.tileID.overscaledZ-ue.tileID.overscaledZ),Ce=[ue.tileID.canonical.x*ge%1,ue.tileID.canonical.y*ge%1]):ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let ae=G?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(ne,V),Ie=E.transform,Me=xy(Ie),$e=r.bc(te.canonical),Ge=r.bd($e.getCenter().lat),Ve,xe,Re,Ne,ot;G?(Ve=Float32Array.from(r.bf(r.bg(te.canonical))),xe=Float32Array.from(Ie.globeMatrix),Re=Float32Array.from(r.bb(Ie)),Ne=[r.aj(Ie.center.lng),r.ak(Ie.center.lat)],ot=Float32Array.from(r.be(te.canonical,$e,Ge,Ie.worldSize/Ie._pixelsPerMercatorPixel))):(Ve=new Float32Array(16),xe=new Float32Array(9),Re=new Float32Array(16),Ne=[0,0],ot=new Float32Array(9));let ct=sm(ae,Ve,xe,Re,ot,Ce||[0,0],r.a1(E.transform.zoom),Ne,Me,ge||1,re,250),at=E.isTileAffectedByFog(te),je=E.getOrCreateProgram("rasterParticle",{defines:W,overrideFog:at});if(E.uploadCommonUniforms(N,je,ne),G){let He=new r.ae(B.LEQUAL,r.ae.ReadWrite,E.depthRangeFor3D),st=0,pt=E.globeSharedBuffers;if(pt){let[Lt,Wt,fn]=pt.getGridBuffers(Ge,st!==0);je.draw(E,B.TRIANGLES,He,ee,r.a.alphaBlended,r.af.backCCW,ct,M.id,Lt,Wt,fn)}}else{let He=E.depthModeForSublayer(0,r.ae.ReadOnly),st=H[te.overscaledZ],{tileBoundsBuffer:pt,tileBoundsIndexBuffer:Lt,tileBoundsSegments:Wt}=E.getTileBoundsBuffers(ue);je.draw(E,B.TRIANGLES,He,st,r.a.alphaBlended,r.af.disabled,ct,M.id,pt,Lt,Wt)}}E.resetStencilClippingMasks()}(m,s,h,g),m.style.map.triggerRepaint())},background:function(m,s,h,g){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity"),E=h.paint.get("background-emissive-strength");if(x===0)return;let C=m.context,M=C.gl,P=m.transform,O=P.tileSize,N=h.paint.get("background-pattern"),B;if(N!==void 0&&(N===null||(B=m.imageManager.getPattern(N.toString(),h.scope,m.style.getLut(h.scope)),!B)))return;let V=!N&&v.a===1&&x===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==V)return;let G=r.ag.disabled,H=m.depthModeForSublayer(0,V==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly),q=m.colorModeForDrapableLayerRenderPass(E),W=N?"backgroundPattern":"background",ee,te=g;te||(ee=m.getBackgroundTiles(),te=Object.values(ee).map(ne=>ne.tileID)),N&&(C.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context,h.scope));for(let ne of te){let ue=m.isTileAffectedByFog(ne),ce=m.getOrCreateProgram(W,{overrideFog:ue}),J=ne.toUnwrapped(),ie=g?ne.projMatrix:m.transform.calculateProjMatrix(J);m.prepareDrawTile();let re=s?s.getTile(ne):ee?ee[ne.key]:new r.by(ne,O,P.zoom,m),ge=N?py(ie,E,x,m,0,h.scope,B,{tileID:ne,tileSize:O}):Cu(ie,E,x,v.toRenderColor(h.lut));m.uploadCommonUniforms(C,ce,J);let{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:ae,tileBoundsSegments:Ie}=m.getTileBoundsBuffers(re);ce.draw(m,M.TRIANGLES,H,G,q,r.af.disabled,ge,h.id,Ce,ae,Ie)}},sky:function(m,s,h){let g=m._atmosphere?r.a1(m.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;let x=m.context,E=h.paint.get("sky-type"),C=new r.ae(x.gl.LEQUAL,r.ae.ReadOnly,[0,1]),M=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?h.needsSkyboxCapture(m)&&(function(P,O,N,B){let V=P.context,G=V.gl,H=O.skyboxFbo;if(!H){H=O.skyboxFbo=V.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new ec(V),O.skyboxTexture=V.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,O.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let te=0;te<6;++te)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(H.framebuffer),V.viewport.set([0,0,32,32]);let q=O.getCenter(P,!0),W=P.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);r.ad.identity(ee),r.ad.rotateY(ee,ee,.5*-Math.PI),Jo(P,O,W,ee,q,0),r.ad.identity(ee),r.ad.rotateY(ee,ee,.5*Math.PI),Jo(P,O,W,ee,q,1),r.ad.identity(ee),r.ad.rotateX(ee,ee,.5*-Math.PI),Jo(P,O,W,ee,q,2),r.ad.identity(ee),r.ad.rotateX(ee,ee,.5*Math.PI),Jo(P,O,W,ee,q,3),r.ad.identity(ee),Jo(P,O,W,ee,q,4),r.ad.identity(ee),r.ad.rotateY(ee,ee,Math.PI),Jo(P,O,W,ee,q,5),V.viewport.set([0,0,P.width,P.height])}(m,h),h.markSkyboxValid(m)):m.renderPass==="sky"&&function(P,O,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skybox");G.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,O.skyboxTexture);let ee=((te,ne,ue,ce,J)=>({u_matrix:te,u_sun_direction:ne,u_cubemap:0,u_opacity:ce,u_temporal_offset:J}))(q.skyboxMatrix,O.getCenter(P,!1),0,B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,r.ag.disabled,P.colorModeForRenderPass(),r.af.backCW,ee,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(m,h,C,v,M):E==="gradient"&&m.renderPass==="sky"&&function(P,O,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new ec(G)),G.activeTexture.set(H.TEXTURE0);let ee=O.colorRampTexture;ee||(ee=O.colorRampTexture=new r.T(G,O.colorRamp,H.RGBA)),ee.bind(H.LINEAR,H.CLAMP_TO_EDGE);let te=((ne,ue,ce,J,ie)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ue,u_radius:r.ab(ce),u_opacity:J,u_temporal_offset:ie}))(q.skyboxMatrix,O.getCenter(P,!1),O.paint.get("sky-gradient-radius"),B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,r.ag.disabled,P.colorModeForRenderPass(),r.af.backCW,te,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(m,h,C,v,M)},debug:function(m,s,h,g,v,x){for(let E=0;E<h.length;E++)if(v){let P=new r.C(g.r*.8,g.g*.8,g.b*.8,1);dt(m,s,h[E],g,-1,-1,x),dt(m,s,h[E],g,-1,1,x),dt(m,s,h[E],g,1,1,x),dt(m,s,h[E],g,1,-1,x),dt(m,s,h[E],P,0,0,x)}else dt(m,s,h[E],g,0,0,x)},custom:function(m,s,h,g){let v=m.context,x=h.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&h.isDraped(s)){if(m.renderPass==="offscreen"){let E=x.prerender;if(E){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){let C=m.transform.pointMerc;E.call(x,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.a1(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else E.call(x,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){let C=x.renderToTile;if(C){let M=g[0].canonical,P=new r.Y(M.x+g[0].wrap*(1<<M.z),M.y,M.z);v.setDepthMode(r.ae.disabled),v.setStencilMode(r.ag.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),C.call(x,v.gl,P),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(r.ag.disabled);let E=x.renderingMode==="3d"?new r.ae(m.context.gl.LEQUAL,r.ae.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,r.ae.ReadOnly);if(v.setDepthMode(E),m.transform.projection.name==="globe"){let C=m.transform.pointMerc;x.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.a1(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else x.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,h,g){if(m.renderPass==="opaque")return;let v=h.paint.get("model-opacity");if(v===0)return;let x=h.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!x||m.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let E=m.shadowRenderer,C=h.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,C||(E.enabled=!1));let M=()=>{E&&(E.useNormalOffset=!0,C||(E.enabled=!0))},P=s.getSource();if(m.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(W,ee,te,ne,ue){let ce=W.transform;if(ce.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${ce.projection.name} projection is not yet implemented`);let J=ce.getFreeCameraOptions().position;if(!W.modelManager)return;let ie=W.modelManager;te.modelManager=ie;let re=W.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ge=te._unevaluatedLayout._values["model-id"],Ce=gt({},te.layout.get("model-id").parameters),ae=W.style.order.indexOf(te.fqid);for(let Ie of ne){let Me=ee.getTile(Ie).getBucket(te);if(!Me||Me.projection.name!==ce.projection.name)continue;let $e=Me.getModelUris();$e&&!Me.modelsRequested&&(ie.addModelsFromBucket($e,ue),Me.modelsRequested=!0);let Ge=Vi(Ie,ce);Ce.zoom=Ge;let Ve=ge.possiblyEvaluate(Ce);if(by(W,Me,Ie),Fr.shadowUniformsInitialized=!1,Fr.useSingleShadowCascade=!!re&&re.getMaxCascadeForTile(Ie.toUnwrapped())===0,W.renderPass==="shadow"&&re){if(W.currentShadowCascade===1&&Me.isInsideFirstShadowMapFrustum)continue;let Ne=ce.calculatePosMatrix(Ie.toUnwrapped(),ce.worldSize);if(Fr.tileMatrix.set(Ne),Fr.shadowTileMatrix=Float32Array.from(re.calculateShadowPassMatrixFromMatrix(Ne)),Fr.aabb.min.fill(0),Fr.aabb.max[0]=Fr.aabb.max[1]=r.a3,Fr.aabb.max[2]=0,Wi(Me,Fr,W,te.scope))continue}let xe=1<<Ie.canonical.z,Re=[((J.x-Ie.wrap)*xe-Ie.canonical.x)*r.a3,(J.y*xe-Ie.canonical.y)*r.a3,J.z*xe*r.a3];W.conflationActive&&Object.keys(Me.instancesPerModel).length>0&&W.style.isLayerClipped(te,ee.getSource())&&Me.updateReplacement(Ie,W.replacementSource,ae)&&(Me.uploaded=!1,Me.upload(W.context));for(let Ne in Me.instancesPerModel){let ot=Me.instancesPerModel[Ne];ot.features.length>0&&(Ne=Ve.evaluate(ot.features[0].feature,{}));let ct=ie.getModel(Ne,ue);if(ct&&ct.uploaded)for(let at of ct.nodes)po(W,te,at,ot,Re,Ie,Fr)}}}(m,s,h,g,P.type==="vector"?h.scope:""),void M();if(!P.loaded())return;if(P.type==="batched-model")return function(W,ee,te,ne){te.resetLayerRenderingStats(W);let ue=W.context,ce=W.transform,J=W.style.fog,ie=W.shadowRenderer;if(ce.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ce.projection.name} projection is not yet implemented`);let re=W.transform.getFreeCameraOptions().position,ge=r._.scale([],[re.x,re.y,re.z],W.transform.worldSize);r._.negate(ge,ge);let Ce=r.ad.identity([]),ae=r.cg(ce.center.lat,ce.zoom),Ie=r.ad.fromScaling([],[1,1,1/ae]);r.ad.translate(Ce,Ce,ge);let Me=te.paint.get("model-opacity"),$e=new r.ae(ue.gl.LEQUAL,r.ae.ReadWrite,W.depthRangeFor3D),Ge=new r.ae(ue.gl.LEQUAL,r.ae.ReadOnly,W.depthRangeFor3D),Ve=new r.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xe=W.renderPass==="shadow",Re=xe&&ie?ie.getCurrentCascadeFrustum():ce.getFrustum(ce.scaleZoom(ce.worldSize)),Ne=te.paint.get("model-front-cutoff"),ot=Ne[2]<1,ct=gs(W,te.paint.get("model-cutoff-fade-range")),at=te.getLayerRenderingStats();(function(je,He,st,pt){let Lt=je.terrain?je.terrain.exaggeration():0,Wt=je.transform.zoom;for(let fn of pt){let cn=He.getTile(fn).getBucket(st);cn&&(je.conflationActive&&cn.updateReplacement(fn,je.replacementSource),cn.evaluateScale(je,st),je.terrain&&Lt>0&&cn.elevationUpdate(je.terrain,Lt,fn,st.source),cn.needsReEvaluation(je,Wt,st)&&cn.evaluate(st))}})(W,ee,te,ne),function(){let je,He,st;ot?(je=ne.length-1,He=-1,st=-1):(je=0,He=ne.length,st=1);for(let pt=je;pt!==He;pt+=st){let Lt=ne[pt],Wt=ee.getTile(Lt).getBucket(te);if(!Wt||!Wt.uploaded)continue;let fn=!1;ie&&(fn=ie.getMaxCascadeForTile(Lt.toUnwrapped())===0);let cn=ce.calculatePosMatrix(Lt.toUnwrapped(),ce.worldSize),kn=Wt.modelTraits,$t=[];for(let Mn of Wt.getNodesInfo()){if(Mn.hiddenByReplacement||!Mn.node.meshes)continue;let Yn=Mn.node,Ln=0;W.terrain&&Yn.elevation&&(Ln=Yn.elevation*W.terrain.exaggeration());let on=Mn.evaluatedScale;if(on[0]<=1&&on[1]<=1&&on[2]<=1&&(()=>{let Te=Mn.aabb;return Ve.min=[...Te.min],Ve.max=[...Te.max],Ve.min[2]+=Ln,Ve.max[2]+=Ln,r._.transformMat4(Ve.min,Ve.min,cn),r._.transformMat4(Ve.max,Ve.max,cn),Ve})().intersects(Re)===0)continue;let Gt=[...cn],ei=Yn.anchor?Yn.anchor[0]:0,ii=Yn.anchor?Yn.anchor[1]:0;r.ad.translate(Gt,Gt,[ei*(on[0]-1),ii*(on[1]-1),Ln]),r._.exactEquals(on,r.cj)||r.ad.scale(Gt,Gt,on);let pn=r.ad.multiply([],Gt,Yn.matrix),Be=r.ad.multiply([],ce.expandedFarZProjMatrix,pn),ut=r.ad.multiply([],ce.expandedFarZProjMatrix,Gt),$i=r.aA.transformMat4([],[ei,ii,Ln,1],Be)[2];Yn.hidden=!1;let On=Me;xe||(ot&&(On*=Po(Gt,ce,Mn.aabb,Ne)),On*=mm(ct,$i)),On!==0?$t.push({nodeInfo:Mn,depth:$i,opacity:On,wvpForNode:Be,wvpForTile:ut,nodeModelMatrix:pn,tileModelMatrix:Gt}):Yn.hidden=!0}xe||$t.sort((Mn,Yn)=>!ot||Mn.opacity===1&&Yn.opacity===1?Mn.depth<Yn.depth?-1:1:Mn.opacity===1?-1:Yn.opacity===1?1:Mn.depth>Yn.depth?-1:1);for(let Mn of $t){let Yn=Mn.nodeInfo,Ln=Yn.node,on=r.ad.multiply([],Ie,Mn.tileModelMatrix);r.ad.multiply(on,Ce,on);let Gt=r.ad.invert([],on);r.ad.transpose(Gt,Gt),r.ad.scale(Gt,Gt,vs),on=r.ad.multiply(on,on,Ln.matrix);let ei=W.renderPass==="light-beam",ii=kn&r.cl.HasMapboxMeshFeatures,pn=ii?0:Yn.evaluatedRMEA[0][2];for(let Be=0;Be<Ln.meshes.length;++Be){let ut=Ln.meshes[Be],$i=Be===Ln.lightMeshIndex,On=Mn.wvpForNode;if($i){if(!ei&&!W.terrain&&W.shadowRenderer){W.currentLayer<W.firstLightBeamLayer&&(W.firstLightBeamLayer=W.currentLayer);continue}On=Mn.wvpForTile}else if(ei)continue;let Te={defines:[]},Nr=[];if(Pu(Te.defines,Nr,ut,W,te.lut),ii||Te.defines.push("DIFFUSE_SHADED"),fn&&Te.defines.push("SHADOWS_SINGLE_CASCADE"),at&&(xe?at.numRenderedVerticesInShadowPass+=ut.vertexArray.length:at.numRenderedVerticesInTransparentPass+=ut.vertexArray.length),xe){Lr(ut,Mn.nodeModelMatrix,W,te);continue}let yr=null;if(J){let la=tc(Mn.nodeModelMatrix,W.transform);if(yr=new Float32Array(la),ce.projection.name!=="globe"){let ca=ut.aabb.min,bs=ut.aabb.max,[ts,ws]=J.getOpacityForBounds(la,ca[0],ca[1],bs[0],bs[1]);Te.overrideFog=ts>=ai||ws>=ai}}let Zi=ut.material,Sr;Zi.occlusionTexture&&Zi.occlusionTexture.offsetScale&&(Sr=Zi.occlusionTexture.offsetScale,Te.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!xe&&ie&&(ie.useNormalOffset=!!ut.normalBuffer);let qr=W.getOrCreateProgram("model",Te);!xe&&ie&&ie.setupShadowsFromMatrix(Mn.tileModelMatrix,qr,ie.useNormalOffset),W.uploadCommonUniforms(ue,qr,null,yr);let go=Zi.pbrMetallicRoughness;go.metallicFactor=.9,go.roughnessFactor=.5;let to=Iu(new Float32Array(On),new Float32Array(on),new Float32Array(Gt),new Float32Array(Ln.matrix),W,Mn.opacity,go.baseColorFactor.toRenderColor(null),Zi.emissiveFactor,go.metallicFactor,go.roughnessFactor,Zi,pn,te,[0,0,0],Sr);!$i&&(Yn.hasTranslucentParts||Mn.opacity<1)&&qr.draw(W,ue.gl.TRIANGLES,$e,r.ag.disabled,r.a.disabled,r.af.backCCW,to,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Nr),qr.draw(W,ue.gl.TRIANGLES,$i?Ge:$e,r.ag.disabled,$i||Mn.opacity<1||Yn.hasTranslucentParts?r.a.alphaBlended:r.a.unblended,r.af.backCCW,to,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Nr)}}}}()}(m,s,h,g),void M();let O=P.getModels(),N=[],B=m.transform.getFreeCameraOptions().position,V=r._.scale([],[B.x,B.y,B.z],m.transform.worldSize);r._.negate(V,V);let G=[],H=[],q=0;for(let W of O){let ee=h.paint.get("model-rotation").constantOr(null),te=h.paint.get("model-scale").constantOr(null),ne=h.paint.get("model-translation").constantOr(null);W.computeModelMatrix(m,ee,te,ne,!0,!0,!1);let ue=r.ad.identity([]),ce=r.cg(W.position.lat,m.transform.zoom),J=r.ad.fromScaling([],[1,1,1/ce]);r.ad.translate(ue,ue,V),N.push({zScaleMatrix:J,negCameraPosMatrix:ue});for(let ie of W.nodes)_r(m.transform,ie,W.matrix,m.transform.expandedFarZProjMatrix,q,G,H);q++}if(G.sort((W,ee)=>ee.depth-W.depth),m.renderPass!=="shadow"){if(v===1)for(let W of H)Za(W,m,h,N[W.modelIndex],r.ag.disabled,m.colorModeForRenderPass());else{for(let W of H)Za(W,m,h,N[W.modelIndex],r.ag.disabled,r.a.disabled);for(let W of H)Za(W,m,h,N[W.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(let W of G)Za(W,m,h,N[W.modelIndex],r.ag.disabled,m.colorModeForRenderPass());M()}else{for(let W of H)Lr(W.mesh,W.nodeModelMatrix,m,h);for(let W of G)Lr(W.mesh,W.nodeModelMatrix,m,h);M()}}},wy={model:function(m,s,h){let g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?m.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(h.context)},raster:function(m,s,h){let g=s.getSource();if(!(g instanceof Hl&&g.loaded()))return;let v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=m.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let E=s.getIds().map(C=>s.getTileByID(C));for(let C of E)C.updateNeeded(v,x)&&g.prepareTile(C,v,x)},"raster-particle":function(m,s,h){let g=s.getSource();if(!(g instanceof Hl&&g.loaded()))return;let v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let E=s.getIds().map(C=>s.getTileByID(C));for(let C of E)C.updateNeeded(v,x)&&g.prepareTile(C,v,x)}};class Ey{constructor(s,h,g,v){this.context=new lu(s,h),this.occlusionBuffers=new y1(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=r.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let E of x)this._debugParams.enabledLayers[E]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let E of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],E);this.symbolParams=new Rl(v),this.setup(),this.numSublayers=r.bv.maxUnderzooming+r.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vd(this),this._wireframeDebugCache=new ku,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(s,h){let g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new em(this,s));let v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){let h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new em(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,h){if(this.width=s*r.e.devicePixelRatio,this.height=h*r.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let s=this.context,h=new r.bt;h.emplaceBack(0,0),h.emplaceBack(r.a3,0),h.emplaceBack(0,r.a3),h.emplaceBack(r.a3,r.a3),this.tileExtentBuffer=s.createVertexBuffer(h,r.br.members),this.tileExtentSegments=r.b.simpleSegment(0,0,4,2);let g=new r.bt;g.emplaceBack(0,0),g.emplaceBack(r.a3,0),g.emplaceBack(0,r.a3),g.emplaceBack(r.a3,r.a3),this.debugBuffer=s.createVertexBuffer(g,r.br.members),this.debugSegments=r.b.simpleSegment(0,0,4,5);let v=new r.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,r.br.members),this.viewportSegments=r.b.simpleSegment(0,0,4,2);let x=new r.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(r.a3,0,r.a3,0),x.emplaceBack(0,r.a3,0,r.a3),x.emplaceBack(r.a3,r.a3,r.a3,r.a3),this.mercatorBoundsBuffer=s.createVertexBuffer(x,r.cq.members),this.mercatorBoundsSegments=r.b.simpleSegment(0,0,4,2);let E=new r.bu;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);let C=new r.cr;for(let P of[0,1,3,2,0])C.emplaceBack(P);this.debugIndexBuffer=s.createIndexBuffer(C),this.emptyTexture=new r.T(s,new r.i({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=r.ad.create();let M=this.context.gl;this.stencilClearMode=new r.ag({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,r.ae.disabled,this.stencilClearMode,r.a.disabled,r.af.disabled,bd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(let M of g)if(this._tileClippingMaskIDs[M.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let C of g){let M=h.getTile(C),P=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(M);E.draw(this,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,bd(C.projMatrix),"$clipping",O,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let s=this.nextStencilID++,h=this.context.gl;return new r.ag({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);let h=this.context.gl;return new r.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){let h=this.context.gl,g=s.sort((E,C)=>C.overscaledZ-E.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let E={};for(let C=0;C<x;C++)E[C+v]=new r.ag({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,g]}return[{[v]:r.ag.disabled},g]}colorModeForRenderPass(){let s=this.context.gl;return this._showOverdrawInspector?new r.a([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(s){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new r.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,h,g,v=!1){if(this.depthOcclusion)return new r.ae(this.context.gl.GREATER,r.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return r.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new r.ae(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,h)=>s+h/this._fpsHistory.length,0))}render(s,h){let g=r.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=h;let v=this.style._mergedLayers,x=this.style.order.filter(ie=>{let re=v[ie];return!(re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[re.type]}),E=x.map(ie=>v[ie]),C=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(r.e.now()),this.imageManager.beginFrame();let M=0,P=!1;for(let ie in C){let re=C[ie];re.used&&(re.prepare(this.context),re.getSource().usedInConflation&&++M)}let O=!1;for(let ie of E)ie.isHidden(this.transform.zoom)||(ie.type==="clip"&&(O=!0),this.prepareLayer(ie));let N={},B={},V={},G={},H={};for(let ie in C){let re=C[ie];N[ie]=re.getVisibleCoordinates(),B[ie]=N[ie].slice().reverse(),V[ie]=re.getVisibleCoordinates(!0).reverse(),G[ie]=re.getShadowCasterCoordinates(),H[ie]=re.sortCoordinatesByDistance(N[ie])}let q=ie=>{let re=this.style.getLayerSourceCache(ie);return re&&re.used?re.getSource():null};if(M||O){let ie=[],re=[],ge=0;for(let Ce of E)this.isSourceForClippingOrConflation(Ce,q(Ce))&&(ie.push(Ce),re.push(ge)),ge++;if(ie&&(O||ie.length>1)){let Ce=[];for(let ae=0;ae<ie.length;ae++){let Ie=ie[ae],Me=re[ae],$e=this.style.getLayerSourceCache(Ie);if(!$e||!$e.used||!$e.getSource().usedInConflation&&Ie.type!=="clip")continue;let Ge=1/0,Ve=r.cu.None;if(Ie.type==="clip"){Ge=Me;for(let xe of Ie.layout.get("clip-layer-types"))Ve|=xe==="model"?r.cu.Model:xe==="symbol"?r.cu.Symbol:r.cu.FillExtrusion}Ce.push({layer:Ie.fqid,cache:$e,order:Ge,clipMask:Ve})}this.replacementSource.setSources(Ce),P=!0}}P||this.replacementSource.clear(),this.conflationActive=P,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ie=0;ie<E.length;ie++){let re=E[ie],ge=re.cutoffRange();if(this.longestCutoffRange=Math.max(ge,this.longestCutoffRange),ge>0){let Ce=q(re);Ce&&(this.minCutoffZoom=Math.max(Ce.minzoom,this.minCutoffZoom)),re.minzoom&&(this.minCutoffZoom=Math.max(re.minzoom,this.minCutoffZoom))}re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ie),this._lastOcclusionLayer=ie)}let W=this.style&&this.style.fog;W?(this._fogVisible=W.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=W.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(V),this.opaquePassCutoff=0);let ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(let ie in C)for(let re of N[ie]){let ge={min:0,max:0};this.terrain&&(ge=this.terrain.getMinMaxForTile(re)||ge),ee.addShadowReceiver(re.toUnwrapped(),ge.min,ge.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new pm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.ct(this.context.gl))return;this.renderPass="offscreen";for(let ie of E){let re=s.getLayerSourceCache(ie);if(!ie.hasOffscreenPass()||ie.isHidden(this.transform.zoom))continue;let ge=re?B[re.id]:void 0;(ie.type==="custom"||ie.type==="raster"||ie.type==="raster-particle"||ie.isSky()||ge&&ge.length)&&this.renderLayer(this,re,ie,ge)}this.depthRangeFor3D=[0,1-(E.length+2)*this.numSublayers*this.depthEpsilon];let te=this.terrain;te&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&te.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,G)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ne=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ue=(()=>{if(h.showOverdrawInspector)return r.C.black;let ie=this.style.fog;if(ie&&this.transform.projection.supportsFog){let re=this.style.getLut(ie.scope);if(!ne){let ge=ie.properties.get("color").toRenderColor(re).toArray01();return new r.C(...ge)}if(ne){let ge=ie.properties.get("space-color").toRenderColor(re).toArray01();return new r.C(...ge)}}return r.C.transparent})();if(this.context.clear({color:ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let ie=E[this.currentLayer],re=s.getLayerSourceCache(ie);if(ie.isSky())continue;let ge=re?(ie.is3D()?H:B)[re.id]:void 0;this._renderTileClippingMasks(ie,re,ge),this.renderLayer(this,re,ie,ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let ie=E[this.currentLayer],re=s.getLayerSourceCache(ie);ie.isSky()&&this.renderLayer(this,re,ie,re?B[re.id]:void 0)}function ce(ie,re){let ge;return re&&(ge=(ie.type==="symbol"?V:ie.is3D()?H:B)[re.id]),ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let ie=E[this.currentLayer];if(ie.type==="raster"){let re=s.getLayerSourceCache(ie);this.renderLayer(this,re,ie,ce(ie,re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let J=0;for(ee&&(J=ee.getShadowCastingLayerCount());this.currentLayer<x.length;){let ie=E[this.currentLayer],re=s.getLayerSourceCache(ie);if(ie.isSky())++this.currentLayer;else if(te&&this.style.isLayerDraped(ie)){if(ie.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=te.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(ie.is3D()||this.terrain||this._renderTileClippingMasks(ie,re,re?N[re.id]:void 0),this.renderLayer(this,re,ie,ce(ie,re)),!te&&ee&&J>0&&ie.hasShadowPass()&&--J==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ge;this.currentLayer++){let Ce=E[this.currentLayer];if(!Ce.hasLightBeamPass())continue;let ae=s.getLayerSourceCache(Ce);this.renderLayer(this,ae,Ce,ae?B[ae.id]:void 0)}this.currentLayer=ge,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let ge=this.currentLayer;this.depthOcclusion=!0;for(let Ce of this.layersWithOcclusionOpacity){this.currentLayer=Ce;let ae=E[this.currentLayer],Ie=s.getLayerSourceCache(ae),Me=Ie?B[Ie.id]:void 0;ae.is3D()||this.terrain||this._renderTileClippingMasks(ae,Ie,Ie?N[Ie.id]:void 0),this.renderLayer(this,Ie,ae,Me)}this.depthOcclusion=!1,this.currentLayer=ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ie=null;E.forEach(re=>{let ge=s.getLayerSourceCache(re);ge&&!re.isHidden(this.transform.zoom)&&ge.getVisibleCoordinates().length&&(!ie||ie.getSource().maxzoom<ge.getSource().maxzoom)&&(ie=ge)}),ie&&this.options.showTileBoundaries&&Ro.debug(this,ie,ie.getVisibleCoordinates(),r.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ro.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ie){let re=ie.transform.padding;Tn(ie,ie.transform.height-(re.top||0),3,Od),Tn(ie,re.bottom||0,3,dm),Cn(ie,re.left||0,3,Qo),Cn(ie,ie.transform.width-(re.right||0),3,fm);let ge=ie.transform.centerPoint;(function(Ce,ae,Ie,Me){Or(Ce,ae-1,Ie-10,2,20,Me),Or(Ce,ae-10,Ie-1,20,2,Me)})(ie,ge.x,ie.transform.height-ge.y,Ql)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),P||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);let{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(s.type);if(wy[s.type]&&(g||this.terrain&&s.type==="custom")){let v=this.style.getLayerSourceCache(s);wy[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||Ro[g.type](s,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let s=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){let s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){let h={};for(let g in s){let v=s[g],x=this.context.extTimerQuery,E=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),h[g]=E}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of s)v+=h.getQueryParameter(x,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(x);return v}translatePosMatrix(s,h,g,v,x){if(!g[0]&&!g[1])return s;let E=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(E){let P=Math.sin(E),O=Math.cos(E);g=[g[0]*O-g[1]*P,g[0]*P+g[1]*O]}let C=[x?g[0]:r.bB(h,g[0],this.transform.zoom),x?g[1]:r.bB(h,g[1],this.transform.zoom),0],M=new Float32Array(16);return r.ad.translate(M,s,C),M}saveTileTexture(s){let h=s.size[0],g=this._tileTextures[h];g?g.push(s):this._tileTextures[h]=[s]}getTileTexture(s){let h=this._tileTextures[s];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,h,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(s,h){this.cache=this.cache||{};let g=h&&h.defines||[],v=h&&h.config,x=this.currentGlobalDefines(s,h&&h.overrideFog,h&&h.overrideRtt).concat(g),E=bu.cacheKey(oy[s],s,x,v);return this.cache[E]||(this.cache[E]=new bu(this.context,s,oy[s],v,f1[s],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,h){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((E,C,M)=>{let P=E.properties.get("direction"),O=E.properties.get("color").toRenderColor(M.getLut(E.scope)).toArray01(),N=E.properties.get("intensity"),B=C.properties.get("color").toRenderColor(M.getLut(C.scope)).toArray01(),V=C.properties.get("intensity"),G=[P.x,P.y,P.z],H=r.bA(B,V),q=r.bA(O,N);return{u_lighting_ambient_color:H,u_lighting_directional_dir:G,u_lighting_directional_color:q,u_ground_radiance:ys(G,q,H)}})(g,v,this.style);h.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,h,g,v,x){if(this.uploadCommonLightUniforms(s,h),this.terrain&&this.terrain.renderingToTexture)return;let E=this.style.fog;if(E){let C=E.getOpacity(this.transform.pitch),M=((P,O,N,B,V,G,H,q,W,ee,te,ne)=>{let ue=P.transform,ce=O.properties.get("color").toRenderColor(P.style.getLut(O.scope)).toArray01();ce[3]=B;let J=P.frameCounter/1e3%1,[ie,re]=O.properties.get("vertical-range");return{u_fog_matrix:N?ue.calculateFogTileMatrix(N):ne||P.identityMat,u_fog_range:O.getFovAdjustedRange(ue._fov),u_fog_color:ce,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ie,re),re],u_fog_temporal_offset:J,u_frustum_tl:V,u_frustum_tr:G,u_frustum_br:H,u_frustum_bl:q,u_globe_pos:W,u_globe_radius:ee,u_viewport:te,u_globe_transition:r.a1(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,E,g,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.e.devicePixelRatio,this.transform.height*r.e.devicePixelRatio],v);h.setFogUniformValues(s,M)}x&&h.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){let s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){let s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)h[v.key]=s[v.key]||new r.by(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,h){return!(!s.is3D()||s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||s.sourceLayer!=="building")&&s.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[s.key];return h||(this._cachedTileFogOpacities[s.key]=h=this.style.fog.getOpacityForTile(s)),h[0]>=ai||h[1]>=ai}}class Dr{constructor(s,h,g,v){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let g,v;if(s instanceof r.P||typeof s[0]=="number"){let x=r.P.convert(s);g=[x],v=h.isPointAboveHorizon(x)}else{let x=r.P.convert(s[0]),E=r.P.convert(s[1]);g=[x,E],v=r.cv(x,E).every(C=>h.isPointAboveHorizon(C))}return new Dr(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return r.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),r.cw(v,s)}bufferedCameraGeometryGlobe(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(h,g,s),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>g.y))+((x.x>h.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(s,h,g,v=0){let x=s.queryPadding/h._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),C=s.tileID.wrap+(E.unwrapped?v:0),M=E.polygon.map(q=>r.cx(s.tileTransform,q,C));if(!r.cy(M,0,0,r.a3,r.a3))return;C=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let P=this.screenGeometryMercator.polygon.map(q=>r.cz(s.tileTransform,q,C)),O=P.map(q=>new r.P(q[0],q[1])),N=h.getFreeCameraOptions().position||new r.Y(0,0,0),B=r.cz(s.tileTransform,N,C),V=P.map(q=>{let W=r._.sub(q,q,B);return r._.normalize(W,W),new r.aT(B,W)}),G=r.bB(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:V,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(H=r.cA(M),H.min.x=r.at(H.min.x,0,r.a3),H.min.y=r.at(H.min.y,0,r.a3),H.max.x=r.at(H.max.x,0,r.a3),H.max.y=r.at(H.max.y,0,r.a3),H),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:G};var H}_bufferedScreenMercator(s,h){let g=_m(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,h){let g=_m(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,h){let g=function(x,E){let C=r.ad.multiply([],E.pixelMatrix,E.globeMatrix),M=[0,-r.cD,0,1],P=[0,r.cD,0,1],O=[0,0,0,1];r.aA.transformMat4(M,M,C),r.aA.transformMat4(P,P,C),r.aA.transformMat4(O,O,C);let N=new r.P(M[0]/M[3],M[1]/M[3]),B=new r.P(P[0]/P[3],P[1]/P[3]),V=r.cB(x,N)&&M[3]<O[3],G=r.cB(x,B)&&P[3]<O[3];if(!V&&!G)return null;let H=function(J,ie,re){for(let ge=1;ge<J.length;ge++){let Ce=ta(ie.pointCoordinate3D(J[ge-1]).x),ae=ta(ie.pointCoordinate3D(J[ge]).x);if(re<0){if(Ce<ae)return{idx:ge,t:-Ce/(ae-1-Ce)}}else if(ae<Ce)return{idx:ge,t:(1-Ce)/(ae+1-Ce)}}return null}(x,E,V?-1:1);if(!H)return null;let{idx:q,t:W}=H,ee=q>1?gm(x.slice(0,q),E):[],te=q<x.length?gm(x.slice(q),E):[];ee=ee.map(J=>new r.P(ta(J.x),J.y)),te=te.map(J=>new r.P(ta(J.x),J.y));let ne=[...ee];ne.length===0&&ne.push(te[te.length-1]);let ue=r.a2(ne[ne.length-1].y,(te.length===0?ee[0]:te[0]).y,W),ce;return ce=V?[new r.P(0,ue),new r.P(0,0),new r.P(1,0),new r.P(1,ue)]:[new r.P(1,ue),new r.P(1,1),new r.P(0,1),new r.P(0,ue)],ne.push(...ce),te.length===0?ne.push(ee[0]):ne.push(...te),{polygon:ne.map(J=>new r.Y(J.x,J.y)),unwrapped:!1}}(s,h);if(g)return g;let v=function(x,E){let C=!1,M=-1/0,P=0;for(let N=0;N<x.length-1;N++)x[N].x>M&&(M=x[N].x,P=N);for(let N=0;N<x.length-1;N++){let B=(P+N)%(x.length-1),V=x[B],G=x[B+1];Math.abs(V.x-G.x)>.5&&(V.x<G.x?(V.x+=1,B===0&&(x[x.length-1].x+=1)):(G.x+=1,B+1===x.length-1&&(x[0].x+=1)),C=!0)}let O=r.aj(E.center.lng);return C&&O<Math.abs(O-1)&&x.forEach(N=>{N.x-=1}),{polygon:x,unwrapped:C}}(gm(s,h).map(x=>new r.P(ta(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new r.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function gm(m,s){return r.cC(m,h=>{let g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function ta(m){return m<0?1+m%1:m%1}function _m(m){return 100*m|0}function v1(m,s){let h=r.ad.identity([]);return r.ad.scale(h,h,[.5*m.width,.5*-m.height,1]),r.ad.translate(h,h,[1,-1,0]),r.ad.multiply(h,h,m.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function x1(m,s,h,g,v,x,E,C=!1){let M=m.tilesIn(g,E,C);M.sort(nc);let P=[];for(let N of M)P.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,h,m._state,N,v,x,v1(m.transform,N.tile.tileID),C)});let O=function(N){let B={},V={};for(let G of N){let H=G.queryResults,q=G.wrappedTileID,W=V[q]=V[q]||{};for(let ee in H){let te=H[ee],ne=W[ee]=W[ee]||{},ue=B[ee]=B[ee]||[];for(let ce of te)ne[ce.featureIndex]||(ne[ce.featureIndex]=!0,ue.push(ce))}}return B}(P);for(let N in O)O[N].forEach(B=>{let V=B.feature,G=V.layer;G&&G.type!=="background"&&G.type!=="sky"&&G.type!=="slot"&&(V.source=G.source,G["source-layer"]&&(V.sourceLayer=G["source-layer"]),V.state=V.id!==void 0?m.getFeatureState(G["source-layer"],V.id):{})});return O}function Ou(m,s){let h=m.getRenderableIds().map(x=>m.getTileByID(x)),g=[],v={};for(let x=0;x<h.length;x++){let E=h[x],C=E.tileID.canonical.key;v[C]||(v[C]=!0,E.querySourceFeatures(g,s))}return g}function nc(m,s){let h=m.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class b1{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let s=!1,h=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:s,visibilityChanged:h});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:s,visibilityChanged:h})}}}onNewFrame(s){this.layersGotHidden=!1;for(let h of this.layers){let g=h.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(s)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(s,h){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,E=this.style.getLayerSourceCache(x),C=1;x.type==="fill-extrusion"&&(C=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let M=E?E.getTile(h):null;if(!M&&E&&h.canonical.z>E.getSource().minzoom){let P=h.scaledTo(Math.min(E.getSource().maxzoom,h.overscaledZ-1));for(;P.overscaledZ>=E.getSource().minzoom&&(M=E.getTile(P),!M&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(x):null,tileID:M?M.tileID:h,verticalScale:C})}s.hasAnyZOffset=!1;let g=!1;for(let v=0;v<s.symbolInstances.length;v++){let x=s.symbolInstances.get(v),E=x.zOffset,C=this._getHeightAtTileOffset(h,x.tileAnchorX,x.tileAnchorY);x.zOffset=C!==Number.NEGATIVE_INFINITY?C:E,g||E===x.zOffset||(g=!0),s.hasAnyZOffset||x.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,h,g,v){let x=h,E=g;if(s.canonical.z!==v.canonical.z){let C=v.canonical,M=1/(1<<s.canonical.z-C.z);x=(h+s.canonical.x*r.a3)*M-C.x*r.a3|0,E=(g+s.canonical.y*r.a3)*M-C.y*r.a3|0}return{tileX:x,tileY:E}}_getHeightAtTileOffset(s,h,g){let v,x;for(let E=0;E<this.layers.length;++E){if(this.layers[E].layer.type!=="fill-extrusion")continue;let{bucket:C,tileID:M,verticalScale:P}=this.currentBuildingBuckets[E];if(!C)continue;let{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,M),B=C.getHeightAtTileCoord(O,N);B&&B.height!==void 0&&(B.hidden?v=B.height:x=Math.max(B.height*P,x||0))}if(x!==void 0)return x;for(let E=0;E<this.layers.length;++E){let C=this.layers[E];if(C.layer.type!=="model"||!C.visible)continue;let{bucket:M,tileID:P}=this.currentBuildingBuckets[E];if(!M)continue;let{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,P),B=M.getHeightAtTileCoord(O,N);if(B&&!B.hidden)return B.height===void 0&&v!==void 0?Math.min(B.maxHeight,v)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ic(m,s){let h={};for(let g in m)g!=="ref"&&(h[g]=m[g]);return r.cE.forEach(g=>{g in s&&(h[g]=s[g])}),h}function ym(m){m=m.slice();let s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=ic(m[h],s[m[h].ref]));return m}let _n={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function xs(m,s,h){h.push({command:_n.addSource,args:[m,s[m]]})}function Ty(m,s,h){s.push({command:_n.removeSource,args:[m]}),h[m]=!0}function w1(m,s,h,g){Ty(m,h,g),xs(m,s,h)}function E1(m,s,h){let g;for(g in m[h])if(m[h].hasOwnProperty(g)&&g!=="data"&&!w(m[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&g!=="data"&&!w(m[h][g],s[h][g]))return!1;return!0}function Lu(m,s,h,g,v,x){let E;for(E in s=s||{},m=m||{})m.hasOwnProperty(E)&&(w(m[E],s[E])||h.push({command:x,args:[g,E,s[E],v]}));for(E in s)s.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(w(m[E],s[E])||h.push({command:x,args:[g,E,s[E],v]}))}function Ld(m){return m.id}function rc(m,s){return m[s.id]=s,m}class Cy{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=r.at(s,0,1);let h=1,g=this._distances[h],v=s*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];let x=h-1,E=this._distances[x],C=g-E,M=C>0?(v-E)/C:0;return this.points[x].mult(1-M).add(this.points[h].mult(M))}}class vm{constructor(s,h,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,v,x){this._forEachCell(h,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(s,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,h,g,v,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,h,g,v,x,E){this.circleCells[x].push(E)}_query(s,h,g,v,x,E){if(g<0||s>this.width||v<0||h>this.height)return!x&&[];let C=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){let P=this.circles[3*M],O=this.circles[3*M+1],N=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:P-N,y1:O-N,x2:P+N,y2:O+N})}return E?C.filter(E):C}return this._forEachCell(s,h,g,v,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?C.length>0:C}_queryCircle(s,h,g,v,x){let E=s-g,C=s+g,M=h-g,P=h+g;if(C<0||E>this.width||P<0||M>this.height)return!v&&[];let O=[];return this._forEachCell(E,M,C,P,this._queryCellCircle,O,{hitTest:v,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},x),v?O.length>0:O}query(s,h,g,v,x){return this._query(s,h,g,v,!1,x)}hitTest(s,h,g,v,x){return this._query(s,h,g,v,!0,x)}hitTestCircle(s,h,g,v){return this._queryCircle(s,h,g,!0,v)}_queryCell(s,h,g,v,x,E,C,M){let P=C.seenUids,O=this.boxCells[x];if(O!==null){let B=this.bboxes;for(let V of O)if(!P.box[V]){P.box[V]=!0;let G=4*V;if(s<=B[G+2]&&h<=B[G+3]&&g>=B[G+0]&&v>=B[G+1]&&(!M||M(this.boxKeys[V]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[V],x1:B[G],y1:B[G+1],x2:B[G+2],y2:B[G+3]})}}}let N=this.circleCells[x];if(N!==null){let B=this.circles;for(let V of N)if(!P.circle[V]){P.circle[V]=!0;let G=3*V;if(this._circleAndRectCollide(B[G],B[G+1],B[G+2],s,h,g,v)&&(!M||M(this.circleKeys[V]))){if(C.hitTest)return E.push(!0),!0;{let H=B[G],q=B[G+1],W=B[G+2];E.push({key:this.circleKeys[V],x1:H-W,y1:q-W,x2:H+W,y2:q+W})}}}}}_queryCellCircle(s,h,g,v,x,E,C,M){let P=C.circle,O=C.seenUids,N=this.boxCells[x];if(N!==null){let V=this.bboxes;for(let G of N)if(!O.box[G]){O.box[G]=!0;let H=4*G;if(this._circleAndRectCollide(P.x,P.y,P.radius,V[H+0],V[H+1],V[H+2],V[H+3])&&(!M||M(this.boxKeys[G])))return E.push(!0),!0}}let B=this.circleCells[x];if(B!==null){let V=this.circles;for(let G of B)if(!O.circle[G]){O.circle[G]=!0;let H=3*G;if(this._circlesCollide(V[H],V[H+1],V[H+2],P.x,P.y,P.radius)&&(!M||M(this.circleKeys[G])))return E.push(!0),!0}}}_forEachCell(s,h,g,v,x,E,C,M){let P=this._convertToXCellCoord(s),O=this._convertToYCellCoord(h),N=this._convertToXCellCoord(g),B=this._convertToYCellCoord(v);for(let V=P;V<=N;V++)for(let G=O;G<=B;G++)if(x.call(this,s,h,g,v,this.xCellCount*G+V,E,C,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,v,x,E){let C=v-s,M=x-h,P=g+E;return P*P>C*C+M*M}_circleAndRectCollide(s,h,g,v,x,E,C){let M=(E-v)/2,P=Math.abs(s-(v+M));if(P>M+g)return!1;let O=(C-x)/2,N=Math.abs(h-(x+O));if(N>O+g)return!1;if(P<=M||N<=O)return!0;let B=P-M,V=N-O;return B*B+V*V<=g*g}}let ko=100;class Iy{constructor(s,h,g=new vm(s.width+200,s.height+200,25),v=new vm(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ko,this.screenBottomBoundary=s.height+ko,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,v,x,E,C,M){let P=g.projectedAnchorX,O=g.projectedAnchorY,N=g.projectedAnchorZ,B=g.elevation,V=g.tileID,G=s.getProjection();if(B&&V){let[ce,J,ie]=G.upVector(V.canonical,g.tileAnchorX,g.tileAnchorY),re=G.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ce*B*re,O+=J*B*re,N+=ie*B*re}let H=this.projectAndGetPerspectiveRatio(C,P,O,N,g.tileID,G.name==="globe"||!!B||this.transform.pitch>0,G),q=E*H.perspectiveRatio,W=(g.x1*h+v.x-g.padding)*q+H.point.x,ee=(g.y1*h+v.y-g.padding)*q+H.point.y,te=(g.x2*h+v.x+g.padding)*q+H.point.x,ne=(g.y2*h+v.y+g.padding)*q+H.point.y,ue=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(W,ee,te,ne)||!x&&this.grid.hitTest(W,ee,te,ne,M)||ue?{box:[],offscreen:!1,occluded:H.occluded}:{box:[W,ee,te,ne],offscreen:this.isOffscreen(W,ee,te,ne),occluded:!1}}placeCollisionCircles(s,h,g,v,x,E,C,M,P,O,N,B,V,G,H){let q=[],W=this.transform.elevation,ee=s.getProjection(),te=W?W.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,ee):null,ne=new r.P(g.tileAnchorX,g.tileAnchorY),{x:ue,y:ce,z:J}=ee.projectTilePoint(ne.x,ne.y,H.canonical);if(te){let[Ve,xe,Re]=te(ne);ue+=Ve,ce+=xe,J+=Re}let ie=ee.name==="globe",re=this.projectAndGetPerspectiveRatio(C,ue,ce,J,H,ie||!!W||this.transform.pitch>0,ee),{perspectiveRatio:ge}=re,Ce=(N?E/ge:E*ge)/r.bN,ae=fo(ue,ce,J,M),Ie=re.signedDistanceFromCamera>0?_d(Ce,x,g.lineOffsetX*Ce,g.lineOffsetY*Ce,!1,ae,ne,g,v,M,{},W&&!N?te:null,N&&!!W,ee,H,N):null,Me=!1,$e=!1,Ge=!0;if(Ie&&!re.occluded){let Ve=.5*V*ge+G,xe=new r.P(-100,-100),Re=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Ne=new Cy,{first:ot,last:ct}=Ie,at=ot.path.length,je=[];for(let pt=at-1;pt>=1;pt--)je.push(ot.path[pt]);for(let pt=1;pt<ct.path.length;pt++)je.push(ct.path[pt]);let He=2.5*Ve;P&&(je=je.map(([pt,Lt,Wt],fn)=>(te&&!ie&&(Wt=te(fn<at-1?ot.tilePath[at-1-fn]:ct.tilePath[fn-at+2])[2]),fo(pt,Lt,Wt,P))),je.some(pt=>pt[3]<=0)&&(je=[]));let st=[];if(je.length>0){let pt=1/0,Lt=-1/0,Wt=1/0,fn=-1/0;for(let cn of je)pt=Math.min(pt,cn[0]),Wt=Math.min(Wt,cn[1]),Lt=Math.max(Lt,cn[0]),fn=Math.max(fn,cn[1]);Lt>=xe.x&&pt<=Re.x&&fn>=xe.y&&Wt<=Re.y&&(st=[je.map(cn=>new r.P(cn[0],cn[1]))],(pt<xe.x||Lt>Re.x||Wt<xe.y||fn>Re.y)&&(st=r.cF(st,xe.x,xe.y,Re.x,Re.y)))}for(let pt of st){Ne.reset(pt,.25*Ve);let Lt=0;Lt=Ne.length<=.5*Ve?1:Math.ceil(Ne.paddedLength/He)+1;for(let Wt=0;Wt<Lt;Wt++){let fn=Wt/Math.max(Lt-1,1),cn=Ne.lerp(fn),kn=cn.x+ko,$t=cn.y+ko;q.push(kn,$t,Ve,0);let Mn=kn-Ve,Yn=$t-Ve,Ln=kn+Ve,on=$t+Ve;if(Ge=Ge&&this.isOffscreen(Mn,Yn,Ln,on),$e=$e||this.isInsideGrid(Mn,Yn,Ln,on),!h&&this.grid.hitTestCircle(kn,$t,Ve,B)&&(Me=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Me,occluded:!1}}}}return{circles:!O&&Me||!$e?[]:q,offscreen:Ge,collisionDetected:Me,occluded:re.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],g=1/0,v=1/0,x=-1/0,E=-1/0;for(let O of s){let N=new r.P(O.x+ko,O.y+ko);g=Math.min(g,N.x),v=Math.min(v,N.y),x=Math.max(x,N.x),E=Math.max(E,N.y),h.push(N)}let C=this.grid.query(g,v,x,E).concat(this.ignoredGrid.query(g,v,x,E)),M={},P={};for(let O of C){let N=O.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;let B=[new r.P(O.x1,O.y1),new r.P(O.x2,O.y1),new r.P(O.x2,O.y2),new r.P(O.x1,O.y2)];r.cG(h,B)&&(M[N.bucketInstanceId][N.featureIndex]=!0,P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]=[]),P[N.bucketInstanceId].push(N.featureIndex))}return P}insertCollisionBox(s,h,g,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,v,x){let E=h?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let M=0;M<s.length;M+=4)E.insertCircle(C,s[M],s[M+1],s[M+2])}projectAndGetPerspectiveRatio(s,h,g,v,x,E,C){let M=[h,g,v,1],P=!1;v||this.transform.pitch>0?(r.aA.transformMat4(M,M,s),this.fogState&&x&&C.name!=="globe"&&(P=function(B,V,G,H,q,W){let ee=W.calculateFogTileMatrix(q),te=[V,G,H];return r._.transformMat4(te,te,ee),Bi(B,r._.length(te),W.pitch,W._fov)}(this.fogState,h,g,v,x.toUnwrapped(),this.transform)>.9)):Xo(M,M,s);let O=M[3];return{point:new r.P((M[0]/O+1)/2*this.transform.width+ko,(-M[1]/O+1)/2*this.transform.height+ko),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/O*.5,1.5),signedDistanceFromCamera:O,occluded:E&&M[2]>O||P}}isOffscreen(s,h,g,v){return g<ko||s>=this.screenRightBoundary||v<ko||h>this.screenBottomBoundary}isInsideGrid(s,h,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let s=r.ad.identity([]);return r.ad.translate(s,s,[-100,-100,0]),s}}class na{constructor(s,h,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class ia{constructor(s,h,g,v,x,E=!1){this.text=new na(s?s.text:null,h,g,x),this.icon=new na(s?s.icon:null,h,v,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fd{constructor(s,h,g,v=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=v}}class Dy{constructor(){this.invProjMatrix=r.ad.create(),this.viewportMatrix=r.ad.create(),this.circles=[]}}class Fu{constructor(s,h,g,v,x){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class Nu{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){let h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function xm(m,s,h,g,v){let{horizontalAlign:x,verticalAlign:E}=r.bQ(m),C=-(x-.5)*s,M=-(E-.5)*h,P=r.bP(m,g);return new r.P(C+P[0]*v,M+P[1]*v)}function zu(m,s,h,g,v){let x=new r.P(m,s);return h&&x._rotate(g?v:-v),x}class mo{constructor(s,h,g,v,x,E){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Iy(this.transform,x),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Nu(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,g,v){let x=g.getBucket(h),E=g.latestFeatureIndex;if(!x||!E||h.fqid!==x.layerIds[0])return;let C=x.layers[0].layout,M=g.collisionBoxArray,P=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),O=g.tileSize/r.a3,N=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let B=(V=g.tileID,G=x.getProjection(),H=this.transform,G.name===this.projection?H.calculateProjMatrix(V.toUnwrapped()):Ad(H,G,V));var V,G,H;let q=C.get("text-pitch-alignment")==="map",W=C.get("text-rotation-alignment")==="map";h.compileFilter();let ee=h.dynamicFilter(),te=h.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(g),ue=Ua(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne),ce=null;if(q){let re=Ul(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne);ce=r.ad.multiply([],this.transform.labelPlaneMatrix,re)}let J=null;ee&&g.latestFeatureIndex&&(J={unwrappedTileID:N,dynamicFilter:ee,dynamicFilterNeedsFeature:te,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Fu(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,g.tileID);let ie={bucket:x,layout:C,posMatrix:B,textLabelPlaneMatrix:ue,labelToScreenMatrix:ce,clippingData:J,scale:P,textPixelRatio:O,holdingForFade:g.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:r.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let re of x.sortKeyRanges){let{sortKey:ge,symbolInstanceStart:Ce,symbolInstanceEnd:ae}=re;s.push({sortKey:ge,symbolInstanceStart:Ce,symbolInstanceEnd:ae,parameters:ie})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(s,h,g,v,x,E,C,M,P,O,N,B,V,G,H,q,W,ee){let{textOffset0:te,textOffset1:ne,crossTileID:ue}=B,ce=[te,ne],J=xm(s,g,v,ce,x),ie=this.collisionIndex.placeCollisionBox(G,x,h,zu(J.x,J.y,E,C,this.transform.angle),N,M,P,O.predicate);if(q){let re=G.getSymbolInstanceIconSize(ee,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,re,q,zu(J.x,J.y,E,C,this.transform.angle),N,M,P,O.predicate).box.length===0)return}if(ie.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(re=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:ce,width:g,height:v,anchor:s,textScale:x,prevAnchor:re},this.markUsedJustification(G,s,B,H),G.allowVerticalPlacement&&(this.markUsedOrientation(G,H,B),this.placedOrientations[ue]=H),{shift:J,placedGlyphBoxes:ie}}}placeLayerBucketPart(s,h,g,v){let{bucket:x,layout:E,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:P,clippingData:O,textPixelRatio:N,holdingForFade:B,collisionBoxArray:V,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:H,collisionGroup:q}=s.parameters,W=E.get("text-optional"),ee=E.get("icon-optional"),te=E.get("text-allow-overlap"),ne=E.get("icon-allow-overlap"),ue=E.get("text-rotation-alignment")==="map",ce=E.get("text-pitch-alignment")==="map",J=E.get("symbol-z-order")==="viewport-y",ie=E.get("symbol-z-elevate");this.transform.setProjection(x.projection);let re=te&&(ne||!x.hasIconData()||ee),ge=ne&&(te||!x.hasTextData()||W);!x.collisionArrays&&V&&x.deserializeCollisionBoxes(V),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,V);let Ce=(ae,Ie,Me)=>{let{crossTileID:$e,numVerticalGlyphVertices:Ge}=ae;if(O){let Ln={zoom:this.transform.zoom,pitch:this.transform.pitch},on=null;if(O.dynamicFilterNeedsFeature){let Gt=this.retainedQueryData[x.bucketInstanceId];on=O.featureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:Gt.bucketIndex,sourceLayerIndex:Gt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(Ln,on,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(ae.tileAnchorX,ae.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[$e]=new Fd(!1,!1,!1,!0),void h.add($e)}if(h.has($e))return;if(B)return void(this.placements[$e]=new Fd(!1,!1,!1));let Ve=!1,xe=!1,Re=!0,Ne=!1,ot=!1,ct=null,at={box:null,offscreen:null,occluded:null},je={box:null,offscreen:null,occluded:null},He=null,st=null,pt=null,Lt=0,Wt=0,fn=0;Me.textFeatureIndex?Lt=Me.textFeatureIndex:ae.useRuntimeCollisionCircles&&(Lt=ae.featureIndex),Me.verticalTextFeatureIndex&&(Wt=Me.verticalTextFeatureIndex);let cn=Ln=>{Ln.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let on=this.transform.elevation;Ln.elevation=ae.zOffset+(on?on.getAtTileOffset(Ln.tileID,Ln.tileAnchorX,Ln.tileAnchorY):0)},kn=Me.textBox;if(kn){cn(kn);let Ln=Gt=>{let ei=r.aE.horizontal;if(x.allowVerticalPlacement&&!Gt&&this.prevPlacement){let ii=this.prevPlacement.placedOrientations[$e];ii&&(this.placedOrientations[$e]=ii,ei=ii,this.markUsedOrientation(x,ei,ae))}return ei},on=(Gt,ei)=>{if(x.allowVerticalPlacement&&Ge>0&&Me.verticalTextBox){for(let ii of x.writingModes)if(ii===r.aE.vertical?(at=ei(),je=at):at=Gt(),at&&at.box&&at.box.length)break}else at=Gt()};if(E.get("text-variable-anchor")){let Gt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e]){let pn=this.prevPlacement.variableOffsets[$e];Gt.indexOf(pn.anchor)>0&&(Gt=Gt.filter(Be=>Be!==pn.anchor),Gt.unshift(pn.anchor))}let ei=(pn,Be,ut)=>{let $i=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Ie),On=(pn.x2-pn.x1)*$i+2*pn.padding,Te=(pn.y2-pn.y1)*$i+2*pn.padding,Nr=ae.hasIconTextFit&&!ne?Be:null;Nr&&cn(Nr);let yr={box:[],offscreen:!1,occluded:!1},Zi=te?2*Gt.length:Gt.length;for(let Sr=0;Sr<Zi;++Sr){let qr=this.attemptAnchorPlacement(Gt[Sr%Gt.length],pn,On,Te,$i,ue,ce,N,C,q,Sr>=Gt.length,ae,Ie,x,ut,Nr,G,H);if(qr&&(yr=qr.placedGlyphBoxes,yr&&yr.box&&yr.box.length)){Ve=!0,ct=qr.shift;break}}return yr};on(()=>ei(kn,Me.iconBox,r.aE.horizontal),()=>{let pn=Me.verticalTextBox;return pn&&cn(pn),x.allowVerticalPlacement&&!(at&&at.box&&at.box.length)&&Ge>0&&pn?ei(pn,Me.verticalIconBox,r.aE.vertical):{box:null,offscreen:null,occluded:null}}),at&&(Ve=at.box,Re=at.offscreen,Ne=at.occluded);let ii=Ln(!(!at||!at.box));if(!Ve&&this.prevPlacement){let pn=this.prevPlacement.variableOffsets[$e];pn&&(this.variableOffsets[$e]=pn,this.markUsedJustification(x,pn.anchor,ae,ii))}}else{let Gt=(ei,ii)=>{let pn=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Ie),Be=this.collisionIndex.placeCollisionBox(x,pn,ei,new r.P(0,0),te,N,C,q.predicate);return Be&&Be.box&&Be.box.length&&(this.markUsedOrientation(x,ii,ae),this.placedOrientations[$e]=ii),Be};on(()=>Gt(kn,r.aE.horizontal),()=>{let ei=Me.verticalTextBox;return x.allowVerticalPlacement&&Ge>0&&ei?(cn(ei),Gt(ei,r.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Ln(!!(at&&at.box&&at.box.length))}}if(He=at,Ve=He&&He.box&&He.box.length>0,Re=He&&He.offscreen,Ne=He&&He.occluded,ae.useRuntimeCollisionCircles){let Ln=x.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex>=0?ae.centerJustifiedTextSymbolIndex:ae.verticalPlacedTextSymbolIndex),on=r.aF(x.textSizeData,G,Ln),Gt=E.get("text-padding");st=this.collisionIndex.placeCollisionCircles(x,te,Ln,x.lineVertexArray,x.glyphOffsetArray,on,C,M,P,g,ce,q.predicate,ae.collisionCircleDiameter*on/r.bN,Gt,this.retainedQueryData[x.bucketInstanceId].tileID),Ve=te||st.circles.length>0&&!st.collisionDetected,Re=Re&&st.offscreen,Ne=st.occluded}if(Me.iconFeatureIndex&&(fn=Me.iconFeatureIndex),Me.iconBox){let Ln=on=>{cn(on);let Gt=ae.hasIconTextFit&&ct?zu(ct.x,ct.y,ue,ce,this.transform.angle):new r.P(0,0),ei=x.getSymbolInstanceIconSize(H,this.transform.zoom,ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,ei,on,Gt,ne,N,C,q.predicate)};je&&je.box&&je.box.length&&Me.verticalIconBox?(pt=Ln(Me.verticalIconBox),xe=pt.box.length>0):(pt=Ln(Me.iconBox),xe=pt.box.length>0),Re=Re&&pt.offscreen,ot=pt.occluded}let $t=W||ae.numHorizontalGlyphVertices===0&&Ge===0,Mn=ee||ae.numIconVertices===0;if($t||Mn?Mn?$t||(xe=xe&&Ve):Ve=xe&&Ve:xe=Ve=xe&&Ve,Ve&&He&&He.box&&this.collisionIndex.insertCollisionBox(He.box,E.get("text-ignore-placement"),x.bucketInstanceId,je&&je.box&&Wt?Wt:Lt,q.ID),xe&&pt&&this.collisionIndex.insertCollisionBox(pt.box,E.get("icon-ignore-placement"),x.bucketInstanceId,fn,q.ID),st&&(Ve&&this.collisionIndex.insertCollisionCircles(st.circles,E.get("text-ignore-placement"),x.bucketInstanceId,Lt,q.ID),g)){let Ln=x.bucketInstanceId,on=this.collisionCircleArrays[Ln];on===void 0&&(on=this.collisionCircleArrays[Ln]=new Dy);for(let Gt=0;Gt<st.circles.length;Gt+=4)on.circles.push(st.circles[Gt+0]),on.circles.push(st.circles[Gt+1]),on.circles.push(st.circles[Gt+2]),on.circles.push(st.collisionDetected?1:0)}let Yn=x.projection.name!=="globe";re=re&&(Yn||!Ne),ge=ge&&(Yn||!ot),this.placements[$e]=new Fd(Ve||re,xe||ge,Re||x.justReloaded),h.add($e)};if(ie&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),J){let ae=x.getSortedSymbolIndexes(this.transform.angle);for(let Ie=ae.length-1;Ie>=0;--Ie){let Me=ae[Ie];Ce(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let ae=x.getSortedIndexesByZOffset();for(let Ie=0;Ie<ae.length;++Ie){let Me=ae[Ie];Ce(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}}else for(let ae=s.symbolInstanceStart;ae<s.symbolInstanceEnd;ae++)Ce(x.symbolInstances.get(ae),ae,x.collisionArrays[ae]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let ae=this.collisionCircleArrays[x.bucketInstanceId];r.ad.invert(ae.invProjMatrix,C),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,h,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:M,crossTileID:P}=g,O=r.cJ(h),N=v===r.aE.vertical?M:O==="left"?x:O==="center"?E:O==="right"?C:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=N>=0&&x!==N?0:P),E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=N>=0&&E!==N?0:P),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:P),M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:P)}markUsedOrientation(s,h,g){let v=h===r.aE.horizontal||h===r.aE.horizontalOnly?h:0,x=h===r.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P}=g,O=s.text.placedSymbolArray;E>=0&&(O.get(E).placedOrientation=v),C>=0&&(O.get(C).placedOrientation=v),M>=0&&(O.get(M).placedOrientation=v),P>=0&&(O.get(P).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(s):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(let M in this.placements){let P=this.placements[M],O=x[M];O?(this.opacities[M]=new ia(O,v,P.text,P.icon,null,P.clipped),g=g||P.text!==O.text.placed||P.icon!==O.icon.placed):(this.opacities[M]=new ia(null,v,P.text,P.icon,P.skipFade,P.clipped),g=g||P.text||P.icon)}for(let M in x){let P=x[M];if(!this.opacities[M]){let O=new ia(P,v,!1,!1);O.isHidden()||(this.opacities[M]=O,g=g||P.text.placed||P.icon.placed)}}for(let M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(let M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h,g,v){let x=new Set;for(let E of h){let C=E.getBucket(s);C&&E.latestFeatureIndex&&s.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,x,E.collisionBoxArray,g,v,E.tileID),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,E.tileID),C.updateZOffset()))}}updateBucketOpacities(s,h,g,v,x,E){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();let C=s.layers[0].layout,M=!!s.layers[0].dynamicFilter(),P=new ia(null,0,!1,!1,!0),O=C.get("text-allow-overlap"),N=C.get("icon-allow-overlap"),B=C.get("text-variable-anchor"),V=C.get("text-rotation-alignment")==="map",G=C.get("text-pitch-alignment")==="map",H=new ia(null,0,O&&(N||!s.hasIconData()||C.get("icon-optional")),N&&(O||!s.hasTextData()||C.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);let q=(ee,te,ne)=>{for(let ue=0;ue<te/4;ue++)ee.opacityVertexArray.emplaceBack(ne)},W=0;x&&s.updateReplacement(E,x);for(let ee=0;ee<s.symbolInstances.length;ee++){let te=s.symbolInstances.get(ee),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ue,crossTileID:ce,numIconVertices:J,tileAnchorX:ie,tileAnchorY:re}=te,ge=h.has(ce),Ce=this.opacities[ce];ge?Ce=P:Ce||(Ce=H,this.opacities[ce]=Ce),h.add(ce);let ae=ne>0||ue>0,Ie=J>0,Me=this.placedOrientations[ce],$e=Me===r.aE.vertical,Ge=Me===r.aE.horizontal||Me===r.aE.horizontalOnly;!ae&&!Ie||Ce.isHidden()||W++;let Ve=!1;if((ae||Ie)&&x)for(let xe of s.activeReplacements){if(xe.order<v||xe.order===1/0||!(xe.clipMask&r.cu.Symbol)||xe.min.x>ie||ie>xe.max.x||xe.min.y>re||re>xe.max.y)continue;let Re=r.cH(ie,re,E.canonical,xe.footprintTileId.canonical);if(Ve=r.cI(Re,xe),Ve)break}if(ae){let xe=Ve?ra:es(Ce.text);q(s.text,ne,$e?ra:xe),q(s.text,ue,Ge?ra:xe);let Re=Ce.text.isHidden(),{leftJustifiedTextSymbolIndex:Ne,centerJustifiedTextSymbolIndex:ot,rightJustifiedTextSymbolIndex:ct,verticalPlacedTextSymbolIndex:at}=te,je=s.text.placedSymbolArray,He=Re||$e?1:0;Ne>=0&&(je.get(Ne).hidden=He),ot>=0&&(je.get(ot).hidden=He),ct>=0&&(je.get(ct).hidden=He),at>=0&&(je.get(at).hidden=Re||Ge?1:0);let st=this.variableOffsets[ce];st&&this.markUsedJustification(s,st.anchor,te,Me);let pt=this.placedOrientations[ce];pt&&(this.markUsedJustification(s,"left",te,pt),this.markUsedOrientation(s,pt,te))}if(Ie){let xe=Ve?ra:es(Ce.icon),{placedIconSymbolIndex:Re,verticalPlacedIconSymbolIndex:Ne}=te,ot=s.icon.placedSymbolArray,ct=Ce.icon.isHidden()?1:0;Re>=0&&(q(s.icon,J,$e?ra:xe),ot.get(Re).hidden=ct),Ne>=0&&(q(s.icon,te.numVerticalIconVertices,Ge?ra:xe),ot.get(Ne).hidden=ct)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){let xe=s.collisionArrays[ee];if(xe){let Re=new r.P(0,0),Ne=!0;if(xe.textBox||xe.verticalTextBox){if(B){let ct=this.variableOffsets[ce];ct?(Re=xm(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textScale),V&&Re._rotate(G?this.transform.angle:-this.transform.angle)):Ne=!1}M&&(Ne=!Ce.clipped),xe.textBox&&Bu(s.textCollisionBox.collisionVertexArray,Ce.text.placed,!Ne||$e,Re.x,Re.y),xe.verticalTextBox&&Bu(s.textCollisionBox.collisionVertexArray,Ce.text.placed,!Ne||Ge,Re.x,Re.y)}let ot=Ne&&!!(!Ge&&xe.verticalIconBox);xe.iconBox&&Bu(s.iconCollisionBox.collisionVertexArray,Ce.icon.placed,ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0),xe.verticalIconBox&&Bu(s.iconCollisionBox.collisionVertexArray,Ce.icon.placed,!ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0)}}}if(s.fullyClipped=W===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){let ee=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ee.invProjMatrix,s.placementViewportMatrix=ee.viewportMatrix,s.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){let g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Bu(m,s,h,g,v){m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0)}let bm=Math.pow(2,25),rt=Math.pow(2,24),Sy=Math.pow(2,17),wm=Math.pow(2,16),Em=Math.pow(2,9),My=Math.pow(2,8),Nd=Math.pow(2,1);function es(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*bm+s*rt+h*Sy+s*wm+h*Em+s*My+h*Nd+s}let ra=0;class Xa{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,g,v,x){let E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<E.length;){let C=E[this._currentPartIndex];if(h.placeLayerBucketPart(C,this._seenCrossTileIDs,g,C.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class zd{constructor(s,h,g,v,x,E,C,M,P){this.placement=new mo(s,x,E,C,M,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g,v){let x=r.e.now(),E=()=>{let C=r.e.now()-x;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){let C=h[s[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){let P=C,O=P.layout.get("symbol-z-elevate"),N=this._inProgressLayer=this._inProgressLayer||new Xa(P),B=r.al(C.source,C.scope);if(N.continuePlacement(O?v[B]:g[B],this.placement,this._showCollisionBoxes,C,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}let oa=512/r.a3/2;class T1{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this.index=new r.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=s.canonical.x*r.a3,x=s.canonical.y*r.a3;for(let E=0;E<h.length;E++){let{key:C,crossTileID:M,tileAnchorX:P,tileAnchorY:O}=h.get(E),N=Math.floor((v+P)*oa),B=Math.floor((x+O)*oa);this.index.add(N,B),this.keys.push(C),this.crossTileIDs.push(M)}this.index.finish()}findMatches(s,h,g){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=oa/Math.pow(2,h.canonical.z-this.tileID.canonical.z),E=h.canonical.x*r.a3,C=h.canonical.y*r.a3;for(let M=0;M<s.length;M++){let P=s.get(M);if(P.crossTileID)continue;let{key:O,tileAnchorX:N,tileAnchorY:B}=P,V=Math.floor((E+N)*x),G=Math.floor((C+B)*x),H=this.index.range(V-v,G-v,V+v,G+v);for(let q of H){let W=this.crossTileIDs[q];if(this.keys[q]===O&&!g.has(W)){g.add(W),P.crossTileID=W;break}}}}}class C1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Tm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){let h=Math.round((s-this.lng)/360);if(h!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let E in v){let C=v[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),x[C.tileID.key]=C}this.indexes[g]=x}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);let v=this.usedCrossTileIDs[s.overscaledZ];for(let x in this.indexes){let E=this.indexes[x];if(Number(x)>s.overscaledZ)for(let C in E){let M=E[C];M.tileID.isChildOf(s)&&M.findMatches(h.symbolInstances,s,v)}else{let C=E[s.scaledTo(Number(x)).key];C&&C.findMatches(h.symbolInstances,s,v)}}for(let x=0;x<h.symbolInstances.length;x++){let E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=g.generate(),v.add(E.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new T1(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(let g of h.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let h=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)s[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],h=!0)}return h}}class I1{constructor(){this.layerIndexes={},this.crossTileIDs=new C1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,v){let x=this.layerIndexes[s.fqid];x===void 0&&(x=this.layerIndexes[s.fqid]=new Tm);let E=!1,C={};v.name!=="globe"&&x.handleWrapJump(g);for(let M of h){let P=M.getBucket(s);P&&s.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,P,this.crossTileIDs)&&(E=!0),C[P.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(s){let h={};s.forEach(g=>{h[g]=!0});for(let g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}let Ay=new r.N({data:new r.O(r.L.colorTheme.data)}),sa=(m,s)=>Ht(m,s&&s.filter(h=>h.identifier!=="source.canvas")),Cm=r.ah(_n,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),D1=r.ah(_n,["setCenter","setZoom","setBearing","setPitch"]),Py={version:8,layers:[],sources:{}},Ry={duration:300,delay:0};class Oo extends r.E{constructor(s,h={}){super(),this.map=s,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=r.W({},Ry),this._buildingIndex=new b1(this),this.crossTileSymbolIndex=new I1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new nn,this.dispatcher=h.dispatcher?h.dispatcher:new r.bw(r.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new cu,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new r.cM(s._requestManager,h.localFontFamily?r.cN.all:h.localIdeographFontFamily?r.cN.ideographs:r.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new ud(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",r.cO());let g=this;this._rtlTextPluginCallback=Oo.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,E)=>{if(r.cP(x),E&&E.every(C=>C))for(let C in g._sourceCaches){let M=g._sourceCaches[C],P=M.getSource().type;P!=="vector"&&P!=="geojson"||M.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let E in this._layers){let C=this._layers[E];C.source===x.id&&this._validateLayer(C)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(r.cQ(s))return s;let h=r.cR(s);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${r.cS(JSON.stringify(s))}`}_diffStyle(s,h,g){this.globalId=this._getGlobalId(s);let v=(x,E)=>{try{E(null,this.setState(x,g))}catch(C){E(C,!1)}};if(typeof s=="string"){let x=this.map._requestManager.normalizeStyleURL(s),E=this.map._requestManager.transformRequest(x,r.R.Style);r.g(E,(C,M)=>{C?this.fire(new r.d(C)):M&&v(M,h)})}else typeof s=="object"&&v(s,h)}loadURL(s,h={}){this.fire(new r.f("dataloading",{dataType:"style"}));let g=typeof h.validate=="boolean"?h.validate:!r.cQ(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,h.accessToken),this.resolvedImports.add(s);let v=this.importsCache.get(s);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(s,r.R.Style);this._request=r.g(x,(E,C)=>{if(this._request=null,E)this.fire(new r.d(E));else if(C)return this.importsCache.set(s,C),this._load(C,g)})}loadJSON(s,h={}){this.fire(new r.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=r.e.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new r.f("dataloading",{dataType:"style"})),this._load(Py,!1)}_loadImports(s,h,g){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of s){let E=this._createFragmentStyle(x),C=new Promise(O=>{E.once("style.import.load",O),E.once("error",O)}).then(()=>this.mergeAll());if(v.push(C),this.resolvedImports.has(x.url)){E.loadEmpty();continue}let M=x.data||this.importsCache.get(x.url);M?(E.loadJSON(M,{validate:h}),this._isInternalStyle(M)&&(E.globalId=null)):x.url?E.loadURL(x.url,{validate:h}):E.loadEmpty();let P={style:E,id:x.id,config:x.config};if(g){let O=this.fragments.findIndex(({id:N})=>N===g);this.fragments=this.fragments.slice(0,O).concat(P).concat(this.fragments.slice(O))}else this.fragments.push(P)}return Promise.allSettled(v)}getImportGlobalIds(s=this,h=new Set){for(let g of s.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(s){let h=this.scope?r.al(s.id,this.scope):s.id,g,v=this._initialConfig&&this._initialConfig[h];(s.config||v)&&(g=r.W({},s.config,v));let x=new Oo(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,h){let g=s.schema;if(this._isInternalStyle(s)){let E=r.W({},Py,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(E,h)}if(this.updateConfig(this._config,g),h&&sa(this,de(s)))return;this._loaded=!0,this.stylesheet=r.cT(s);let v=()=>{for(let P in s.sources)this.addSource(P,s.sources[P],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);let E=ym(this.stylesheet.layers);if(this._order=E.map(P=>P.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let P=this.stylesheet.lights[0];this.light=new mt(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new mt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let P of E){let O=r.cY(P,this.scope,this._styleColorTheme.lut,this.options);O.isConfigDependent&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O,this._serializedLayers[O.id]=O.serialize();let N=this.getOwnLayerSourceCache(O),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&O.canCastShadows()&&B&&(N.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.f("data",{dataType:"style"}));let M=this.isRootStyle();s.imports?this._loadImports(s.imports,h).then(()=>{this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let E=this._evaluateColorThemeData(x);this._loadColorTheme(E).then(()=>{v()}).catch(C=>{r.w(`Couldn't load color theme from the stylesheet: ${C}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,h,g,v,x,E,C,M,P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(s=O.light),O.stylesheet.lights)for(let N of O.stylesheet.lights)N.type==="ambient"&&O.ambientLight!=null&&(h=O.ambientLight),N.type==="directional"&&O.directionalLight!=null&&(g=O.directionalLight);v=this._prioritizeTerrain(v,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(x=O.fog),O.stylesheet.camera!=null&&(M=O.stylesheet.camera),O.stylesheet.projection!=null&&(E=O.stylesheet.projection),O.stylesheet.transition!=null&&(C=O.stylesheet.transition),P[O.scope]=O._styleColorTheme}}),this.light=s,this.ambientLight=h,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=P,v===null?delete this.terrain:this.terrain=v,this.camera=M||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=r.W({},Ry,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){let h=g=>{for(let v of g.fragments)h(v.style);s(g)};h(this)}_prioritizeTerrain(s,h,g){let v=s&&s.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?s:null:h!=null&&(!s||v||h&&h.drapeRenderMode===1)?h:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{s=this._prioritizeTerrain(s,h.terrain,h.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(s=h.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){let s={},h={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let E=r.al(x,v.scope);s[E]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let E=r.al(x,v.scope);h[E]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let E=r.al(x,v.scope);g[E]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){let s={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(let C of E._order){let M=E._layers[C];if(M.type==="slot"){let P=r.cU(C);if(s[P])continue;s[P]=[]}M.slot&&s[M.slot]?s[M.slot].push(M):h.push(M)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(E=[])=>{for(let C of E)if(C.type==="slot"){let M=r.cU(C.id);s[M]&&x(s[M]),this._mergedSlots.push(M)}else{let M=r.al(C.id,C.scope);this._mergedOrder.push(M),g[M]=C,C.is3D()&&(this._has3DLayers=!0),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=r.W({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(h,g,v){let x=r.W({},g);for(let C of Object.keys(r.L.colorTheme))x[C]===void 0&&(x[C]=r.L.colorTheme[C].default);let E=new r.U(Ay,h,new Map(v));return E.setTransitionOrValue(x,v),E.untransitioned().possiblyEvaluate(new r.X(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){return this._styleColorTheme.lutLoading=!0,new Promise((h,g)=>{let v="data:image/png;base64,";if(s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();s.startsWith(v)||(s=v+s);let x="mapbox-reserved-lut",E=new Image;E.src=s,E.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},E.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:C,height:M,data:P}=r.e.getImageData(E);if(M>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(C!==M*M)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new r.i({width:C,height:M},P),pixelRatio:1,sdf:!1,version:0});let O=this.imageManager.getImage(x,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:s},h()):g(new Error("Missing LUT image."))}})}getLut(s){let h=this._styleColorThemeForScope[s];return h?h.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(h,g,v){let x,E,C,M=r.e.devicePixelRatio>1?"@2x":"",P=r.g(g.transformRequest(g.normalizeSpriteURL(h,M,".json"),r.R.SpriteJSON),(B,V)=>{P=null,C||(C=B,x=V,N())}),O=r.h(g.transformRequest(g.normalizeSpriteURL(h,M,".png"),r.R.SpriteImage),(B,V)=>{O=null,C||(C=B,E=V,N())});function N(){if(C)v(C);else if(x&&E){let B=r.e.getImageData(E),V={};for(let G in x){let{width:H,height:q,x:W,y:ee,sdf:te,pixelRatio:ne,stretchX:ue,stretchY:ce,content:J}=x[G],ie=new r.i({width:H,height:q});r.i.copy(B,ie,{x:W,y:ee},{x:0,y:0},{width:H,height:q},null),V[G]={data:ie,pixelRatio:ne,sdf:te,stretchX:ue,stretchY:ce,content:J}}v(null,V)}}return{cancel(){P&&(P.cancel(),P=null),O&&(O.cancel(),O=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new r.d(h));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.f("data",{dataType:"style"}))})}_validateLayer(s){let h=this.getOwnSource(s.source);if(!h)return;let g=s.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new r.d(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,h)=>{let g=this.fragments[h];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){let s={};for(let h in this._sourceCaches){let g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){let h=[];for(let g of s){let v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(let s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){let h=this.getOwnLayer(s);if(h)return h;this.fire(new r.d(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){let h=this.getOwnSource(s);if(h)return h;this.fire(new r.d(new Error(`The source '${s}' does not exist in the map's style.`)))}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);let h=this.calculateLightsBrightness();s.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let E=this._changes.getLayerUpdatesByScope();for(let C in E){let{updatedIds:M,removedIds:P}=E[C];(M||P)&&(this._updateWorkerLayers(C,M,P),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}let x={};for(let E in this._mergedSourceCaches){let C=this._mergedSourceCaches[E];x[E]=C.used,C.used=!1,C.tileCoverLift=0}for(let E of this._mergedOrder){let C=this._mergedLayers[E];if(C.recalculate(s,this._availableImages),!C.isHidden(s.zoom)){let M=this.getLayerSourceCache(C);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,C.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let M=C.minzoom||0;M<(C.maxzoom||25.5);M++){let P=this.map.painter;if(P){let O=C.getProgramIds();if(!O)continue;for(let N of O){let B=C.getDefaultProgramParams(N,s.zoom,this._styleColorTheme.lut);B&&(P.style=this,this.fog&&(P._fogVisible=!0,B.overrideFog=!0,P.getOrCreateProgram(N,B)),P._fogVisible=!1,B.overrideFog=!1,P.getOrCreateProgram(N,B),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(B.overrideRtt=!0,P.getOrCreateProgram(N,B)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let E in x){let C=this._mergedSourceCaches[E];x[E]!==C.used&&C.getSource().fire(new r.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new r.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let s=this._changes.getUpdatedImages();if(s.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,h,g){let v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:s,removedIds:g||[],options:v.options})}setState(s,h){if(this._checkLoaded(),sa(this,de(s)))return!1;(s=r.cT(s)).layers=ym(s.layers);let g=function(E,C){if(!E)return[{command:_n.setStyle,args:[C]}];let M=[];try{if(!w(E.version,C.version))return[{command:_n.setStyle,args:[C]}];if(w(E.center,C.center)||M.push({command:_n.setCenter,args:[C.center]}),w(E.zoom,C.zoom)||M.push({command:_n.setZoom,args:[C.zoom]}),w(E.bearing,C.bearing)||M.push({command:_n.setBearing,args:[C.bearing]}),w(E.pitch,C.pitch)||M.push({command:_n.setPitch,args:[C.pitch]}),w(E.sprite,C.sprite)||M.push({command:_n.setSprite,args:[C.sprite]}),w(E.glyphs,C.glyphs)||M.push({command:_n.setGlyphs,args:[C.glyphs]}),w(E.imports,C.imports)||function(V=[],G=[],H){G=G||[];let q=(V=V||[]).map(Ld),W=G.map(Ld),ee=V.reduce(rc,{}),te=G.reduce(rc,{}),ne=q.slice(),ue,ce,J,ie;for(ue=0,ce=0;ue<q.length;ue++)J=q[ue],te.hasOwnProperty(J)?ce++:(H.push({command:_n.removeImport,args:[J]}),ne.splice(ne.indexOf(J,ce),1));for(ue=0,ce=0;ue<W.length;ue++)J=W[W.length-1-ue],ne[ne.length-1-ue]!==J&&(ee.hasOwnProperty(J)?(H.push({command:_n.removeImport,args:[J]}),ne.splice(ne.lastIndexOf(J,ne.length-ce),1)):ce++,ie=ne[ne.length-ue],H.push({command:_n.addImport,args:[te[J],ie]}),ne.splice(ne.length-ue,0,J));for(let re of G){let ge=ee[re.id];ge&&!w(ge,re)&&H.push({command:_n.updateImport,args:[re.id,re]})}}(E.imports,C.imports,M),w(E.transition,C.transition)||M.push({command:_n.setTransition,args:[C.transition]}),w(E.light,C.light)||M.push({command:_n.setLight,args:[C.light]}),w(E.fog,C.fog)||M.push({command:_n.setFog,args:[C.fog]}),w(E.projection,C.projection)||M.push({command:_n.setProjection,args:[C.projection]}),w(E.lights,C.lights)||M.push({command:_n.setLights,args:[C.lights]}),w(E.camera,C.camera)||M.push({command:_n.setCamera,args:[C.camera]}),!w(E["color-theme"],C["color-theme"]))return[{command:_n.setStyle,args:[C]}];let P={},O=[];(function(V,G,H,q){let W;for(W in G=G||{},V=V||{})V.hasOwnProperty(W)&&(G.hasOwnProperty(W)||Ty(W,H,q));for(W in G){if(!G.hasOwnProperty(W))continue;let ee=G[W];V.hasOwnProperty(W)?w(V[W],ee)||(V[W].type==="geojson"&&ee.type==="geojson"&&E1(V,G,W)?H.push({command:_n.setGeoJSONSourceData,args:[W,ee.data]}):w1(W,G,H,q)):xs(W,G,H)}})(E.sources,C.sources,O,P);let N=[];E.layers&&E.layers.forEach(V=>{V.source&&P[V.source]?M.push({command:_n.removeLayer,args:[V.id]}):N.push(V)});let B=E.terrain;B&&P[B.source]&&(M.push({command:_n.setTerrain,args:[void 0]}),B=void 0),M=M.concat(O),w(B,C.terrain)||M.push({command:_n.setTerrain,args:[C.terrain]}),function(V,G,H){G=G||[];let q=(V=V||[]).map(Ld),W=G.map(Ld),ee=V.reduce(rc,{}),te=G.reduce(rc,{}),ne=q.slice(),ue=Object.create(null),ce,J,ie,re,ge,Ce,ae;for(ce=0,J=0;ce<q.length;ce++)ie=q[ce],te.hasOwnProperty(ie)?J++:(H.push({command:_n.removeLayer,args:[ie]}),ne.splice(ne.indexOf(ie,J),1));for(ce=0,J=0;ce<W.length;ce++)ie=W[W.length-1-ce],ne[ne.length-1-ce]!==ie&&(ee.hasOwnProperty(ie)?(H.push({command:_n.removeLayer,args:[ie]}),ne.splice(ne.lastIndexOf(ie,ne.length-J),1)):J++,Ce=ne[ne.length-ce],H.push({command:_n.addLayer,args:[te[ie],Ce]}),ne.splice(ne.length-ce,0,ie),ue[ie]=!0);for(ce=0;ce<W.length;ce++)if(ie=W[ce],re=ee[ie],ge=te[ie],!ue[ie]&&!w(re,ge))if(w(re.source,ge.source)&&w(re["source-layer"],ge["source-layer"])&&w(re.type,ge.type)){for(ae in Lu(re.layout,ge.layout,H,ie,null,_n.setLayoutProperty),Lu(re.paint,ge.paint,H,ie,null,_n.setPaintProperty),w(re.slot,ge.slot)||H.push({command:_n.setSlot,args:[ie,ge.slot]}),w(re.filter,ge.filter)||H.push({command:_n.setFilter,args:[ie,ge.filter]}),w(re.minzoom,ge.minzoom)&&w(re.maxzoom,ge.maxzoom)||H.push({command:_n.setLayerZoomRange,args:[ie,ge.minzoom,ge.maxzoom]}),re)re.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?Lu(re[ae],ge[ae],H,ie,ae.slice(6),_n.setPaintProperty):w(re[ae],ge[ae])||H.push({command:_n.setLayerProperty,args:[ie,ae,ge[ae]]}));for(ae in ge)ge.hasOwnProperty(ae)&&!re.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?Lu(re[ae],ge[ae],H,ie,ae.slice(6),_n.setPaintProperty):w(re[ae],ge[ae])||H.push({command:_n.setLayerProperty,args:[ie,ae,ge[ae]]}))}else H.push({command:_n.removeLayer,args:[ie]}),Ce=ne[ne.lastIndexOf(ie)+1],H.push({command:_n.addLayer,args:[ge,Ce]})}(N,C.layers,M)}catch(P){console.warn("Unable to compute style diff:",P),M=[{command:_n.setStyle,args:[C]}]}return M}(this.serialize(),s).filter(E=>!(E.command in D1));if(g.length===0)return!1;let v=g.filter(E=>!(E.command in Cm));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);let x=[];return g.forEach(E=>{x.push(this[E.command].apply(this,E.args))}),h&&Promise.all(x).then(h),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,h){return this.getImage(s)?this.fire(new r.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,this.scope,h)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new r.d(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,h,g={}){return this._checkLoaded(),this._validate(en,`models.${s}`,h,null,g)||(this.modelManager.addModel(s,h,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new r.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,h,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(pe,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=Ed(s,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=E=>{let C=(E?"symbol:":"other:")+v.id,M=r.al(C,this.scope),P=this._sourceCaches[C]=new r.bv(M,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=P,P.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();let h=this.getOwnSource(s);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(s);for(let v of g){let x=r.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getOwnSource(s).setData(h),this._changes.setDirty()}getOwnSource(s){let h=this.getOwnSourceCache(s);return h&&h.getSource()}getOwnSources(){let s=[];for(let h in this._otherSourceCaches){let g=this.getOwnSourceCache(h);g&&s.push(g.getSource())}return s}areTilesLoaded(){let s=this._mergedSourceCaches;for(let h in s){let g=s[h]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let v of s){if(this._validate(Ae,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(h)}else this.ambientLight=new du(v,Kt,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(h)}else this.directionalLight=new du(v,kp,this.scope,this.options)}}let g=new r.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let s=this.directionalLight,h=this.ambientLight;if(!s||!h)return;let g=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),x=s.properties.get("intensity"),E=s.properties.get("direction"),C=1-r.ac(E.x,E.y,E.z)[2]/90,M=g(v)*x*C,P=h.properties.get("color").toRenderColor(null).toArray01(),O=h.properties.get("intensity");return(M+g(P)*O)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(r.cV(s)){let h=r.cW(s),g=this.fragments.find(({id:x})=>x===h);if(!g)throw new Error(`Style import not found: ${s}`);let v=r.cU(s);return g.style.getFragmentStyle(v)}{let h=this.fragments.find(({id:g})=>g===s);if(!h)throw new Error(`Style import not found: ${s}`);return h.style}}getConfigProperty(s,h){let g=this.getFragmentStyle(s);if(!g)return null;let v=r.al(h,g.scope),x=g.options.get(v),E=x?x.value||x.default:null;return E?E.serialize():null}setConfigProperty(s,h,g){let v=this.getFragmentStyle(s);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[h])return;let E=r.y(g);if(E.result!=="success")return void sa(this,E.value);let C=E.value.expression,M=r.al(h,v.scope),P=v.options.get(M);if(!P)return;let O,{minValue:N,maxValue:B,stepValue:V,type:G,values:H}=x[h],q=r.y(x[h].default);q.result==="success"&&(O=q.value.expression),O?(this.options.set(M,hi(gt({},P),{value:C,default:O,minValue:N,maxValue:B,stepValue:V,type:G,values:H})),this.updateConfigDependencies()):this.fire(new r.d(new Error(`No schema defined for the config option "${h}" in the "${s}" fragment.`)))}getConfig(s){let h=this.getFragmentStyle(s);if(!h)return null;let g=h.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let E=r.al(x,h.scope),C=h.options.get(E),M=C?C.value||C.default:null;v[x]=M?M.serialize():null}return v}setConfig(s,h){let g=this.getFragmentStyle(s);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){let h=this.getFragmentStyle(s);return h?h.stylesheet.schema:null}setSchema(s,h){let g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(s,h){if(this._config=s,s||h)if(h)for(let g in h){let v,x,E=r.y(h[g].default);if(E.result==="success"&&(v=E.value.expression),s&&s[g]!==void 0){let B=r.y(s[g]);B.result==="success"&&(x=B.value.expression)}let{minValue:C,maxValue:M,stepValue:P,type:O,values:N}=h[g];if(v){let B=r.al(g,this.scope);this.options.set(B,{default:v,value:x,minValue:C,maxValue:M,stepValue:P,type:O,values:N})}else this.fire(new r.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new r.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let s of this._configDependentLayers){let h=this.getLayer(s);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){let h=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut||s._styleColorTheme.lut&&h!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(s,h,g={}){this._checkLoaded();let v=s.id;if(this._layers[v])return void this.fire(new r.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(s.type==="custom"){if(sa(this,r.cX(s)))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=r.cT(s),s=r.W(s,{source:v})),this._validate(it,`layers.${v}`,s,{arrayIndex:-1},g))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let E=this._order.length;if(h){let O=this._order.indexOf(h);if(O===-1)return void this.fire(new r.d(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?E=O:r.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let C=this.getOwnLayerSourceCache(x),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&x.canCastShadows()&&M&&(C.castsShadows=!0);let P=this._changes.getRemovedLayer(x);if(P&&x.source&&C&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let O=r.al(x.source,x.scope);P.type!==x.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,h){this._checkLoaded();let g=this._checkLayer(s);if(!g||s===h)return;let v=this._order.indexOf(s);this._order.splice(v,1);let x=this._order.length;if(h){let E=this._order.indexOf(h);if(E===-1)return void this.fire(new r.d(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?x=E:r.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();let h=this._checkLayer(s);if(!h)return;h.setEventedParent(null);let g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],delete this._serializedLayers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let x=!1;for(let E in this._layers)if(this._layers[E].source===h.source&&this._layers[E].canCastShadows()){x=!0;break}v.castsShadows=x}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(let h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();let v=this._checkLayer(s);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,h){this._checkLoaded();let g=this._checkLayer(s);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(s,h,g={}){this._checkLoaded();let v=this._checkLayer(s);if(v&&!w(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Qe,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=r.cT(h),this._updateLayer(v)))}getFilter(s){let h=this._checkLayer(s);if(h)return r.cT(h.filter)}setLayoutProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(x&&!w(x.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&sa(x,Mt.call(de,{key:`layers.${s}.layout.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:r.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(h,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,h){let g=this._checkLayer(s);if(g)return g.getLayoutProperty(h)}setPaintProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(!x||w(x.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&sa(x,yt.call(de,{key:`layers.${s}.paint.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:r.L})))return;let E=x.setPaintProperty(h,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),E&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,h){let g=this._checkLayer(s);if(g)return g.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();let g=s.source,v=s.sourceLayer,x=this._checkSource(g);if(!x)return;let E=x.type;if(E==="geojson"&&v)return void this.fire(new r.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!v)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided.")));let C=this.getOwnSourceCaches(g);for(let M of C)M.setFeatureState(v,s.id,h)}removeFeatureState(s,h){this._checkLoaded();let g=s.source,v=this._checkSource(g);if(!v)return;let x=v.type,E=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!E)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new r.d(new Error("A feature id is required to remove its specific state property.")));let C=this.getOwnSourceCaches(g);for(let M of C)M.removeFeatureState(E,s.id,h)}getFeatureState(s){this._checkLoaded();let h=s.source,g=s.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=r.W({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return r.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let s=this.getTerrain(),h=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return r.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(s){this._changes.updateLayer(s);let h=this.getLayerSourceCache(s),g=r.al(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){let h=C=>this._mergedLayers[C].type==="fill-extrusion"||this._mergedLayers[C].type==="model",g=this.order,v={},x=[];for(let C=g.length-1;C>=0;C--){let M=g[C];if(h(M)){v[M]=C;for(let P of s){let O=P[M];if(O)for(let N of O)x.push(N)}}}x.sort((C,M)=>M.intersectionZ-C.intersectionZ);let E=[];for(let C=g.length-1;C>=0;C--){let M=g[C];if(h(M))for(let P=x.length-1;P>=0;P--){let O=x[P].feature;if(O.layer&&v[O.layer.id]<C)break;E.push(O),x.pop()}else for(let P of s){let O=P[M];if(O)for(let N of O)E.push(N.feature)}}return E}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(Qe,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new r.d(new Error("parameters.layers must be an Array."))),[];for(let P of h.layers){let O=this._mergedLayers[P];if(!O)return this.fire(new r.d(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}let x=[],E=h.serializedLayers||{},C=h&&h.layers?h.layers.some(P=>{let O=this.getLayer(P);return O&&O.is3D()}):this.has3DLayers(),M=Dr.createFromScreenPoints(s,g);for(let P in this._mergedSourceCaches){let O=this._mergedSourceCaches[P].getSource();if(!O||O.scope!==h.scope)continue;let N=this._mergedSourceCaches[P].getSource().id;h.layers&&!v[N]||x.push(x1(this._mergedSourceCaches[P],this._mergedLayers,E,M,h,g,C,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,O,N,B,V,G,H){let q={},W=G.queryRenderedSymbols(B),ee=[];for(let te of Object.keys(W).map(Number))ee.push(H[te]);ee.sort(nc);for(let te of ee){let ne=te.featureIndex.lookupSymbolFeatures(W[te.bucketInstanceId],O,te.bucketIndex,te.sourceLayerIndex,V.filter,V.layers,V.availableImages,P);for(let ue in ne){let ce=q[ue]=q[ue]||[],J=ne[ue];J.sort((ie,re)=>{let ge=te.featureSortOrder;if(ge){let Ce=ge.indexOf(ie.featureIndex);return ge.indexOf(re.featureIndex)-Ce}return re.featureIndex-ie.featureIndex});for(let ie of J)ce.push(ie)}}for(let te in q)q[te].forEach(ne=>{let ue=ne.feature,ce=N(P[te]);if(!ce)return;let J=ce.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=J});return q}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,h){h&&h.filter&&this._validate(Qe,"querySourceFeatures.filter",h.filter,null,h);let g=this.getOwnSourceCaches(s),v=[];for(let x of g)v=v.concat(Ou(x,h));return v}addSourceType(s,h,g){return Oo.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Oo.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,h,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let C in s)if(!w(s[C],v[C])){x=!0;break}if(!x)return;let E=this._getTransitionParameters();this.light.setLight(s,h,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,h=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s,v=s.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let C="terrain-dem-src";this.addSource(C,g.source),g=r.cT(g),g=r.W(g,{source:C})}let x=r.W({},g),E={};if(this.terrain&&v){x.source=this.terrain.get().source;let C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(E.style=C.serialize())}if(this._validate(ve,"terrain",x,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new r.f("data",{dataType:"style"}))}else{let x=this.terrain,E=x.get();for(let C of Object.keys(r.L.terrain))!g.hasOwnProperty(C)&&r.L.terrain[C].default&&(g[C]=r.L.terrain[C].default);for(let C in s)if(!w(s[C],E[C])){x.set(s,this.options),this.stylesheet.terrain=s;let M=this._getTransitionParameters({duration:0});x.updateTransitions(M),this.fire(new r.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){let h=this.fog=new ty(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!w(h.get(),s)){h.set(s,this.options),this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}setColorTheme(s){this._checkLoaded();let h=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=s,!s)return this._styleColorTheme.lut=null,void h();let g=this._evaluateColorThemeData(s);this._loadColorTheme(g).then(()=>{h()}).catch(v=>{r.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(s){return{now:r.e.now(),transition:r.W(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;let s=[],h=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?s.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){let g=this.terrain=new zn(s,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,g,v,x={}){if(x&&x.validate===!1)return!1;let E=r.W({},this.serialize());return sa(this,s.call(de,r.W({key:h,style:E,value:g,styleSpec:r.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){let h=this.getSourceCaches(s);for(let g of h)g.clearTiles()}clearSources(){for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){let h=this.getSourceCaches(s);for(let g of h)g.resume(),g.reload()}reloadSources(){for(let s of this.getSources())s.reload&&s.reload()}updateSources(s){let h;this.directionalLight&&(h=yu(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,h)}_generateCollisionBoxes(){for(let s in this._sourceCaches){let h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,g,v,x,E,C=!1){let M=!1,P=!1,O={},N={};for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=r.al(G.source,G.scope),q=O[H];if(!q){let ee=this.getLayerSourceCache(G);if(!ee)continue;let te=ee.getRenderableIds(!0).map(ne=>ee.getTileByID(ne));N[H]=te.slice(),q=O[H]=te.sort((ne,ue)=>ue.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ue.tileID)?-1:1))}let W=this.crossTileSymbolIndex.addLayer(G,q,h.center.lng,h.projection);M=M||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new r.f("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.e.now(),h.zoom))&&(this.pauseablePlacement=new zd(h,this._mergedOrder,C,g,v,x,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.e.now()),P=!0),M&&this.pauseablePlacement.placement.setStale()),P||M){this._buildingIndex.onNewFrame(h.zoom);for(let V=0;V<this._mergedOrder.length;V++){let G=this._mergedLayers[this._mergedOrder[V]];if(G.type!=="symbol")continue;let H=this.isLayerClipped(G)&&this._clipLayerIndices.some(q=>V<q);this.placement.updateLayerOpacities(G,O[r.al(G.source,G.scope)],V,H?E:null)}}let B=!1;for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=O[r.al(G.source,G.scope)];for(let q of H){let W=q.getBucket(G);W&&q.latestFeatureIndex&&G.fqid===W.layerIds[0]&&(B=W.updateOcclusionOpacities(s.context,s.symbolParams,s._dt)||B)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.e.now())||B,occlusionQueryBasedOpacityChanged:B}}_releaseSymbolFadeTiles(){for(let s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,h){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===s.id)!==-1)return void this.fire(new r.d(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!h)return g.push(s),this._loadImports([s],!0);let v=g.findIndex(({id:x})=>x===h);return v===-1&&this.fire(new r.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(s).concat(g.slice(v)),this._loadImports([s],!0,h)}updateImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);return v===-1?this:typeof h=="string"?(this.setImportUrl(s,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(s,h.url),w(h.config,g[v].config)||this.setImportConfig(s,h.config),w(h.data,g[v].data)||this.setImportData(s,h.data),this)}moveImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;let x=this.getImportIndex(h);if(x===-1)return this;let E=g[v],C=this.fragments[v];return g=g.filter(({id:M})=>M!==s),this.fragments=this.fragments.filter(({id:M})=>M!==s),this.stylesheet.imports=g.slice(0,x).concat(E).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(C).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;g[v].url=h;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(h),this}setImportData(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(s,v[g].url))}setImportConfig(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;let x=this.fragments[g],E=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=h,x.style.updateConfig(h,E),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){let h=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return h===-1&&this.fire(new r.d(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),h}getLayer(s){return this._mergedLayers[s]}getSources(){let s=[];for(let h in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[h];g&&s.push(g.getSource())}return s}getSource(s,h){let g=this.getSourceCache(s,h);return g&&g.getSource()}getLayerSource(s){let h=this.getLayerSourceCache(s);return h&&h.getSource()}getSourceCache(s,h){let g=r.al(s,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){let h=r.al(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[s]&&h.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&h.push(this._mergedSymbolSourceCaches[s]),h}updateSourceCaches(){let s=this._changes.getUpdatedSourceCaches();for(let h in s){let g=s[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(s){let h=this._changes.getUpdatedPaintProperties();for(let g of h){let v=this.getLayer(g);v&&v.updateTransitions(s)}}getImages(s,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(s,h,g){return r.c$(h,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){let h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){let h=this.getOwnSourceCaches(s);return h.length===0?(this.fire(new r.d(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,h){if(this._clipLayerIndices.length===0&&s.type!=="fill-extrusion")return!1;let g=s.type==="fill-extrusion"&&s.sourceLayer==="building",v=0;if(s.is3D()){if(g||h&&h.type==="batched-model")return!0;s.type==="model"&&(v=r.cu.Model)}else s.type==="symbol"&&(v=r.cu.Symbol);for(let x of this._clipLayerIndices){let E=this._mergedLayers[this._mergedOrder[x]];if(!E)continue;let C=[];for(let M of E.layout.get("clip-layer-types"))C.push(M==="model"?r.cu.Model:M==="symbol"?r.cu.Symbol:r.cu.FillExtrusion);for(let M of C)if(v&M)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Im(m,s){let h=!1,g=null,v=()=>{g=null,h&&(m(),g=setTimeout(v,s),h=!1)};return()=>(h=!0,g||v(),g)}Oo.getSourceType=function(m){return ir[m]},Oo.setSourceType=function(m,s){ir[m]=s},Oo.registerForPluginStateChange=r.cL;class S1{constructor(s){this._hashName=s&&encodeURIComponent(s),r.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Im(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let s=this._map;if(!s)return"";let h=Vu(s);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(E=>{let C=E.split("=")[0];return C===g?(v=!0,`${C}=${h}`):E}).filter(E=>E);return v||x.push(`${g}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let s=location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){let s=this._map;if(!s)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){let g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Vu(m,s){let h=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),E=Math.round(h.lng*x)/x,C=Math.round(h.lat*x)/x,M=m.getBearing(),P=m.getPitch(),O=s?`/${E}/${C}/${g}`:`${g}/${C}/${E}`;return(M||P)&&(O+="/"+Math.round(10*M)/10),P&&(O+=`/${Math.round(P)}`),O}let Bd={linearity:.3,easing:r.d0(0,0,.3,1)},ky=r.W({deceleration:2500,maxSpeed:1400},Bd),Dm=r.W({deceleration:20,maxSpeed:1400},Bd),Vd=r.W({deceleration:1e3,maxSpeed:360},Bd),Sm=r.W({deceleration:1e3,maxSpeed:90},Bd);class Ka{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.e.now(),settings:s})}_drainInertiaBuffer(){let s=this._inertiaBuffer,h=r.e.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=ju(h.pan.mag(),g,r.W({},ky,s||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,oc(v,x)}if(h.zoom){let x=ju(h.zoom,g,Dm);v.zoom=this._map.transform.zoom+x.amount,oc(v,x)}if(h.bearing){let x=ju(h.bearing,g,Vd);v.bearing=this._map.transform.bearing+r.at(x.amount,-179,179),oc(v,x)}if(h.pitch){let x=ju(h.pitch,g,Sm);v.pitch=this._map.transform.pitch+x.amount,oc(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function oc(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function ju(m,s,h){let{maxSpeed:g,linearity:v,deceleration:x}=h,E=r.at(m*v/(s/1e3),-g,g),C=Math.abs(E)/(x*v);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}class rr extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,v={}){let x=ft(h.getCanvasContainer(),g),E=h.unproject(x);super(s,r.W({point:x,lngLat:E,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class aa extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){let v=s==="touchend"?g.changedTouches:g.touches,x=Ue(h.getCanvasContainer(),v),E=x.map(M=>h.unproject(M)),C=x.reduce((M,P,O,N)=>M.add(P.div(N.length)),new r.P(0,0));super(s,{points:x,point:C,lngLats:E,lngLat:h.unproject(C),originalEvent:g}),this._defaultPrevented=!1}}class jd extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class Mm{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new jd(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new rr(s.type,this._map,s))}mouseup(s){this._map.fire(new rr(s.type,this._map,s))}preclick(s){let h=r.W({},s);h.type="preclick",this._map.fire(new rr(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new rr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new rr(s.type,this._map,s))}mouseover(s){this._map.fire(new rr(s.type,this._map,s))}mouseout(s){this._map.fire(new rr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new aa(s.type,this._map,s))}touchmove(s){this._map.fire(new aa(s.type,this._map,s))}touchend(s){this._map.fire(new aa(s.type,this._map,s))}touchcancel(s){this._map.fire(new aa(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uu{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new rr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new rr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ud{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(De(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;let g=h,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));let E=Math.min(v.x,g.x),C=Math.max(v.x,g.x),M=Math.min(v.y,g.y),P=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=C-E+"px",this._box.style.height=P-M+"px")})}mouseupWindow(s,h){if(!this._active)return;let g=this._startPos,v=h;if(g&&s.button===0){if(this.reset(),tt(),g.x!==v.x||g.y!==v.y)return this._map.fire(new r.f("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ke(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new r.f(s,{originalEvent:h}))}}function $u(m,s){let h={};for(let g=0;g<m.length;g++)h[m[g].identifier]=s[g];return h}class Oy{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new r.P(0,0);for(let E of v)x._add(E);return x.div(v.length)}(h),this.touches=$u(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;let v=$u(g,h);for(let x in this.touches){let E=v[x];(!E||E.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Gu{constructor(s){this.singleTap=new Oy(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){let v=this.singleTap.touchend(s,h,g);if(v){let x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class $d{constructor(){this._zoomIn=new Gu({numTouches:1,numTaps:2}),this._zoomOut=new Gu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){let v=this._zoomIn.touchend(s,h,g),x=this._zoomOut.touchend(s,h,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Hu={0:1,2:2};class Gd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;let g=Vt(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){let g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(v,x){let E=Hu[x];return v.buttons===void 0||(v.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(s){this._lastPoint&&Vt(s)===this._eventButton&&(this._moved&&tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ly extends Gd{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Am extends Gd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Qa extends Gd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class Fy{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),r.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!r.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);let v=$u(g,h),x=new r.P(0,0),E=new r.P(0,0),C=0;for(let P in v){let O=v[P],N=this._touches[P];N&&(x._add(O),E._add(O.sub(N)),C++,v[P]=O)}if(this._touches=v,C<this._minTouches||!E.mag())return;let M=E.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Pm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){let v=this._firstTwoTouches;if(!v)return;s.preventDefault();let[x,E]=v,C=Hd(g,h,x),M=Hd(g,h,E);if(!C||!M)return;let P=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],P,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,E=Hd(g,h,v),C=Hd(g,h,x);E&&C||(this._active&&tt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Hd(m,s,h){for(let g=0;g<m.length;g++)if(m[g].identifier===h)return s[g]}function Ny(m,s){return Math.log(m/s)/Math.LN2}class Rm extends Pm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){let g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Ny(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ny(this._distance,g),pinchAround:h}}}function qd(m,s){return 180*m.angleWith(s)/Math.PI}class km extends Pm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){let g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:qd(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());let h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=qd(s,g);return Math.abs(v)<h}}function qu(m){return Math.abs(m.y)>Math.abs(m.x)}class zy extends Pm{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,qu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){let v=this._lastPoints;if(!v)return;let x=s[0].sub(v[0]),E=s[1].sub(v[1]);return this._map._cooperativeGestures&&!r.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+E.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;let v=s.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let E=s.y>0==h.y>0;return qu(s)&&qu(h)&&E}}let By={panStep:100,bearingStep:15,pitchStep:10};class M1{constructor(){let s=By;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,v=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:C=>{let M=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Wu,zoom:h?Math.round(M)+h*(s.shiftKey?2:1):M,bearing:C.getBearing()+g*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wu(m){return m*(2-m)}let sc=4.000244140625,Vy=1/450;class eo{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vy,r.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||r.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,g=r.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%sc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=ft(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){let P=this._type==="wheel"&&Math.abs(this._delta)>sc?this._wheelZoomRate:this._defaultZoomRate,O=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&O!==0&&(O=1/O);let N=h(),B=Math.pow(2,N),V=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(V*O))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,E,C=!1;if(this._type==="wheel"&&v&&x){let P=Math.min((r.e.now()-this._lastWheelEventTime)/200,1),O=x(P);E=r.a2(v,g,O),P<1?this._frameId||(this._frameId=!0):C=!0}else E=g,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-h();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=r.d2;if(this._prevEase){let g=this._prevEase,v=(r.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),E=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-E*E);h=r.d0(E,C,.25,1)}return this._prevEase={start:r.e.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Om{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zd{constructor(){this._tap=new Gu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lm{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fm{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yd{constructor(s,h,g,v){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let ac=m=>m.zoom||m.drag||m.pitch||m.rotate;class Nm extends r.f{}class Xd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){let g=r._.sub([],h,s);this.radius=r._.length(g[2]<0?r._.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){r._.div(s,s,this.constants),r._.normalize(s,s),r._.mul(s,s,this.constants);let h=r._.scale([],s,this.radius);if(h[2]>0){let g=r._.scale([],[0,0,1],r._.dot(h,[0,0,1])),v=r._.scale([],r._.normalize([],[h[0],h[1],0]),this.radius),x=r._.add([],h,r._.scale([],r._.sub([],r._.add([],v,g),h),2));h[0]=x[0],h[1]=x[1]}return h}}function Zu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class jy{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ka(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),r.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,E]of this._listeners){let C=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,C,E)}}destroy(){for(let[s,h,g]of this._listeners){let v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(h,v,g)}}_addDefaultHandlers(s){let h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Mm(h,s));let v=h.boxZoom=new Ud(h,s);this._add("boxZoom",v);let x=new $d,E=new Wd;h.doubleClickZoom=new Om(E,x),this._add("tapZoom",x),this._add("clickZoom",E);let C=new Zd;this._add("tapDragZoom",C);let M=h.touchPitch=new zy(h);this._add("touchPitch",M);let P=new Am(s),O=new Qa(s);h.dragRotate=new Fm(s,P,O),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);let N=new Ly(s),B=new Fy(h,s);h.dragPan=new Lm(g,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);let V=new km,G=new Rm;h.touchZoomRotate=new Yd(g,G,V,C),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uu(h));let H=h.scrollZoom=new eo(h,this);this._add("scrollZoom",H,["mousePan"]);let q=h.keyboard=new M1;this._add("keyboard",q);for(let W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[W]&&h[W].enable(s[W])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ac(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(let v in s)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){let h=[];for(let g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;let g=s.type==="renderFrame",v=g?void 0:s,x={needsRenderFrame:!1},E={},C={},M=s.touches?this._getMapTouches(s.touches):void 0,P=M?Ue(this._el,M):g?void 0:ft(this._el,s);for(let{handlerName:B,handler:V,allowed:G}of this._handlers){if(!V.isEnabled())continue;let H;this._blockedByActive(C,G,B)?V.reset():V[h||s.type]&&(H=V[h||s.type](s,P,M),this.mergeHandlerResult(x,E,H,B,v),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||V.isActive())&&(C[B]=V)}let O={};for(let B in this._previousActiveHandlers)C[B]||(O[B]=v);this._previousActiveHandlers=C,(Object.keys(O).length||Zu(x))&&(this._changes.push([x,E,O]),this._triggerRenderFrame()),(Object.keys(C).length||Zu(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:N}=x;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(s,h,g,v,x){if(!g)return;r.W(s,g);let E={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(h.zoom=E),g.panDelta!==void 0&&(h.drag=E),g.pitchDelta!==void 0&&(h.pitch=E),g.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){let s={},h={},g={};for(let[v,x,E]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),r.W(h,x),r.W(g,E);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){let v=this._map,x=v.transform,E=ee=>[ee.x,ee.y,ee.z];if((ee=>{let te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!Zu(s)){let ee=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ee!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!Zu(s))return void this._fireEvents(h,g,!0);let{panDelta:C,zoomDelta:M,bearingDelta:P,pitchDelta:O,around:N,aroundCoord:B,pinchAround:V}=s;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),V!==void 0&&(N=V),(M||(ee=>h[ee]&&!this._eventsInProgress[ee])("drag"))&&N&&(this._dragOrigin=E(x.pointCoordinate3D(N)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),N=N||v.transform.centerPoint,P&&(x.bearing+=P),O&&(x.pitch+=O),x._updateCameraState();let G=[0,0,0];if(C)if(x.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N).dir),te=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N.sub(C)).dir);G[0]=te[0]-ee[0],G[1]=te[1]-ee[1]}else{let ee=x.pointCoordinate(N);if(x.projection.name==="globe"){C=C.rotate(-x.angle);let te=x._pixelsPerMercatorPixel/x.worldSize;G[0]=-C.x*r.d3(r.ay(ee.y))*te,G[1]=-C.y*r.d3(x.center.lat)*te}else{let te=x.pointCoordinate(N.sub(C));ee&&te&&(G[0]=te.x-ee.x,G[1]=te.y-ee.y)}}let H=x.zoom,q=[0,0,0];if(M){let ee=E(B||x.pointCoordinate3D(N)),te={dir:r._.normalize([],r._.sub([],ee,x._camera.position))};if(te.dir[2]<0){let ne=x.zoomDeltaToMovement(ee,M);r._.scale(q,te.dir,ne)}}let W=r._.add(G,G,q);x._translateCameraConstrained(W),M&&Math.abs(x.zoom-H)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){let v=ac(this._eventsInProgress),x=ac(s),E={};for(let O in s){let{originalEvent:N}=s[O];this._eventsInProgress[O]||(E[`${O}start`]=N),this._eventsInProgress[O]=s[O]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let O in E)this._fireEvent(O,E[O]);x&&this._fireEvent("move",x.originalEvent);for(let O in s){let{originalEvent:N}=s[O];this._fireEvent(O,N)}let C={},M;for(let O in this._eventsInProgress){let{handlerName:N,originalEvent:B}=this._eventsInProgress[O];this._handlersById[N].isActive()||(delete this._eventsInProgress[O],M=h[N]||B,C[`${O}end`]=M)}for(let O in C)this._fireEvent(O,C[O]);let P=ac(this._eventsInProgress);if(g&&(v||x)&&!P){this._updatingCamera=!0;let O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;O?(N(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:M})):(this._map.fire(new r.f("moveend",{originalEvent:M})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new r.f(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Nm("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Ja="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class A1 extends r.E{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,r.bp(["_renderFrameCallback"],this)}getCenter(){return new r.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=r.P.convert(s).mult(-1),this.panTo(this.transform.center,r.W({offset:s},h),g)}panTo(s,h,g){return this.easeTo(r.W({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(r.W({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(r.W({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,r.W({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(r.W({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=r.ai.convert(s);let g=h&&h.bearing||0,v=h&&h.pitch||0,x=s.getNorthWest(),E=s.getSouthEast();return this._cameraForBounds(this.transform,x,E,g,v,h)}_extendPadding(s){let h={top:0,right:0,bottom:0,left:0};return s==null?r.W({},h,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:r.W({},h,s)}_extendCameraOptions(s){return(s=r.W({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,h){let g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,v,x,E){let C=s.clone(),M=this._extendCameraOptions(E);C.bearing=v,C.pitch=x;let P=r.aI.convert(h),O=r.aI.convert(g),N=.5*(P.lat+O.lat),B=.5*(P.lng+O.lng),V=r.d4(N,B),G=r._.normalize([],V),H=r._.normalize([],r._.cross([],G,[0,1,0])),q=r._.cross([],H,G),W=[H[0],H[1],H[2],0,q[0],q[1],q[2],0,G[0],G[1],G[2],0,0,0,0,1],ee=[V,r.d4(P.lat,P.lng),r.d4(O.lat,P.lng),r.d4(O.lat,O.lng),r.d4(P.lat,O.lng),r.d4(N,P.lng),r.d4(N,O.lng),r.d4(P.lat,B),r.d4(O.lat,B)],te=r.b6.fromPoints(ee.map(Ne=>[r._.dot(H,Ne),r._.dot(q,Ne),r._.dot(G,Ne)])),ne=r._.transformMat4([],te.center,W);r._.squaredLength(ne)===0&&r._.set(ne,0,0,1),r._.normalize(ne,ne),r._.scale(ne,ne,r.cD),C.center=r.d5(ne);let ue=C.getWorldToCameraMatrix(),ce=r.ad.invert(new Float64Array(16),ue);te=r.b6.applyTransform(te,r.ad.multiply([],ue,W));let J=this._extendAABB(te,C,M,v);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=J,r._.transformMat4(ne,ne,ue);let ie=.5*(te.max[2]-te.min[2]),re=this._minimumAABBFrustumDistance(C,te),ge=r._.scale([],[0,0,1],ie),Ce=r._.add(ge,ne,ge),ae=re+(C.pitch===0?0:r._.distance(ne,Ce)),Ie=C.globeCenterInViewSpace,Me=r._.sub([],ne,[Ie[0],Ie[1],Ie[2]]);r._.normalize(Me,Me),r._.scale(Me,Me,ae);let $e=r._.add([],ne,Me);r._.transformMat4($e,$e,ce);let Ge=r.d7/r.cD,Ve=r._.length($e),xe=r.ax(Math.max(Ve*Ge-r.d7,Number.EPSILON),0),Re=Math.min(C.zoomFromMercatorZAdjusted(xe),M.maxZoom);return Re>.5*(r.b1+r.aU)?(C.setProjection({name:"mercator"}),C.zoom=Re,this._cameraForBounds(C,h,g,v,x,E)):{center:C.center,zoom:Re,bearing:v,pitch:x}}_extendAABB(s,h,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),C=E,M=x,P=x,O=E,N=h.width-(M+P),B=h.height-(C+O),V=r._.sub([],s.max,s.min),G=Math.min(N/V[0],B/V[1]),H=Math.min(h.scaleZoom(h.scale*G),g.maxZoom);if(isNaN(H))return null;let q=h.scale/h.zoomScale(H),W=new r.b6([s.min[0]-M*q,s.min[1]-O*q,s.min[2]],[s.max[0]+P*q,s.max[1]+C*q,s.max[2]]),ee=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new r.P(g.offset.x,g.offset.y):r.P.convert(g.offset)).rotate(-r.ab(v));return W.center[0]-=ee.x*q,W.center[1]+=ee.y*q,W}queryTerrainElevation(s,h){let g=this.transform.elevation;return g?(h=r.W({},{exaggerated:!0},h),g.getAtPoint(r.Y.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,v,x,E){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,g,v,x,E);let C=s.clone(),M=this._extendCameraOptions(E);C.bearing=v,C.pitch=x;let P=r.aI.convert(h),O=r.aI.convert(g),N=new r.aI(P.lng,O.lat),B=new r.aI(O.lng,P.lat),V=C.project(P),G=C.project(O),H=this.queryTerrainElevation(P),q=this.queryTerrainElevation(O),W=this.queryTerrainElevation(N),ee=this.queryTerrainElevation(B),te=[[V.x,V.y,Math.min(H||0,q||0,W||0,ee||0)],[G.x,G.y,Math.max(H||0,q||0,W||0,ee||0)]],ne=r.b6.fromPoints(te),ue=C.getWorldToCameraMatrix(),ce=r.ad.invert(new Float64Array(16),ue);ne=r.b6.applyTransform(ne,ue);let J=this._extendAABB(ne,C,M,v);if(!J)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=J;let ie=.5*r._.sub([],ne.max,ne.min)[2],re=this._minimumAABBFrustumDistance(C,ne),ge=[0,0,1,0];r.aA.transformMat4(ge,ge,ue),r.aA.normalize(ge,ge);let Ce=r._.scale([],ge,re+ie),ae=r._.add([],ne.center,Ce);r._.transformMat4(ne.center,ne.center,ce),r._.transformMat4(ae,ae,ce);let Ie=[ne.center[0],ne.center[1],ae[2]*C.pixelsPerMeter];r._.scale(Ie,Ie,1/C.worldSize);let Me=r.d6(Ie[0]),$e=r.ay(Ie[1]),Ge=Math.min(C._zoomFromMercatorZ(Ie[2]),M.maxZoom),Ve=new r.aI(Me,$e);return C.mercatorFromTransition&&Ge<.5*(r.b1+r.aU)?(C.setProjection({name:"globe"}),C.zoom=Ge,this._cameraForBounds(C,h,g,v,x,E)):{center:Ve,zoom:Ge,bearing:v,pitch:x}}fitBounds(s,h,g){let v=this.cameraForBounds(s,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(s,h,g,v,x){let E=r.P.convert(s),C=r.P.convert(h),M=new r.P(Math.min(E.x,C.x),Math.min(E.y,C.y)),P=new r.P(Math.max(E.x,C.x),Math.max(E.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,C))return this;let O=this.transform.pointLocation3D(M),N=this.transform.pointLocation3D(P),B=this.transform.pointLocation3D(new r.P(M.x,P.y)),V=this.transform.pointLocation3D(new r.P(P.x,M.y)),G=[Math.min(O.lng,N.lng,B.lng,V.lng),Math.min(O.lat,N.lat,B.lat,V.lat)],H=[Math.max(O.lng,N.lng,B.lng,V.lng),Math.max(O.lat,N.lat,B.lat,V.lat)],q=v&&v.pitch?v.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,G,H,g,q,v);return this._fitInternal(W,v,x)}_fitInternal(s,h,g){return s?(h=r.W(s,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(s,h){this.stop();let g=s.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,E=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=r.aI.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(x=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(E=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new r.f("movestart",h)).fire(new r.f("move",h)),v&&this.fire(new r.f("zoomstart",h)).fire(new r.f("zoom",h)).fire(new r.f("zoomend",h)),x&&this.fire(new r.f("rotatestart",h)).fire(new r.f("rotate",h)).fire(new r.f("rotateend",h)),E&&this.fire(new r.f("pitchstart",h)).fire(new r.f("pitch",h)).fire(new r.f("pitchend",h)),this.fire(new r.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Ja),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){let g=this.transform;if(!g.projection.supportsFreeCamera)return r.w(Ja),this;this.stop();let v=g.zoom,x=g.pitch,E=g.bearing;g.setFreeCameraOptions(s);let C=v!==g.zoom,M=x!==g.pitch,P=E!==g.bearing;return this.fire(new r.f("movestart",h)).fire(new r.f("move",h)),C&&this.fire(new r.f("zoomstart",h)).fire(new r.f("zoom",h)).fire(new r.f("zoomend",h)),P&&this.fire(new r.f("rotatestart",h)).fire(new r.f("rotate",h)).fire(new r.f("rotateend",h)),M&&this.fire(new r.f("pitchstart",h)).fire(new r.f("pitch",h)).fire(new r.f("pitchend",h)),this.fire(new r.f("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=r.W({offset:[0,0],duration:500,easing:r.d2},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in s?+s.zoom:v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,O="pitch"in s?+s.pitch:E,N=this._extendPadding(s.padding),B=r.P.convert(s.offset),V,G,H;if(g.projection.name==="globe"){let re=r.Y.fromLngLat(g.center),ge=B.rotate(-g.angle);re.x+=ge.x/g.worldSize,re.y+=ge.y/g.worldSize;let Ce=re.toLngLat(),ae=r.aI.convert(s.center||Ce);this._normalizeCenter(ae),V=g.centerPoint.add(ge),G=new r.P(re.x,re.y).mult(g.worldSize),H=new r.P(r.aj(ae.lng),r.ak(ae.lat)).mult(g.worldSize).sub(G)}else{V=g.centerPoint.add(B);let re=g.pointLocation(V),ge=r.aI.convert(s.center||re);this._normalizeCenter(ge),G=g.project(re),H=g.project(ge).sub(G)}let q=g.zoomScale(M-v),W,ee;s.around&&(W=r.aI.convert(s.around),ee=g.locationPoint(W));let te=this._zooming||M!==v,ne=this._rotating||x!==P,ue=this._pitching||O!==E,ce=!g.isPaddingEqual(N),J=re=>ge=>{if(te&&(re.zoom=r.a2(v,M,ge)),ne&&(re.bearing=r.a2(x,P,ge)),ue&&(re.pitch=r.a2(E,O,ge)),ce&&(re.interpolatePadding(C,N,ge),V=re.centerPoint.add(B)),W)re.setLocationAtPoint(W,ee);else{let Ce=re.zoomScale(re.zoom-v),ae=M>v?Math.min(2,q):Math.max(.5,q),Ie=Math.pow(ae,1-ge),Me=re.unproject(G.add(H.mult(ge*Ie)).mult(Ce));re.setLocationAtPoint(re.renderWorldCopies?Me.wrap():Me,V)}return s.preloadOnly||this._fireMoveEvents(h),re};if(s.preloadOnly){let re=this._emulate(J,s.duration,g);return this._preloadTiles(re),this}let ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=ne,this._pitching=ue,this._padding=ce,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,ie),this._ease(J(g),re=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,re)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new r.f("movestart",s)),this._zooming&&!g.zooming&&this.fire(new r.f("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new r.f("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new r.f("pitchstart",s))}_fireMoveEvents(s){this.fire(new r.f("move",s)),this._zooming&&this.fire(new r.f("zoom",s)),this._rotating&&this.fire(new r.f("rotate",s)),this._pitching&&this.fire(new r.f("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new r.f("zoomend",s)),v&&this.fire(new r.f("rotateend",s)),x&&this.fire(new r.f("pitchend",s)),this.fire(new r.f("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){let Re=r.ah(s,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Re,h)}this.stop(),s=r.W({offset:[0,0],speed:1.2,curve:1.42,easing:r.d2},s);let g=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),M="zoom"in s?r.at(+s.zoom,g.minZoom,g.maxZoom):v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,O="pitch"in s?+s.pitch:E,N=this._extendPadding(s.padding),B=g.zoomScale(M-v),V=r.P.convert(s.offset),G=g.centerPoint.add(V),H=g.pointLocation(G),q=r.aI.convert(s.center||H);this._normalizeCenter(q);let W=g.project(H),ee=g.project(q).sub(W),te=s.curve,ne=Math.max(g.width,g.height),ue=ne/B,ce=ee.mag();if("minZoom"in s){let Re=r.at(Math.min(s.minZoom,v,M),g.minZoom,g.maxZoom),Ne=ne/g.zoomScale(Re-v);te=Math.sqrt(Ne/ce*2)}let J=te*te;function ie(Re){let Ne=(ue*ue-ne*ne+(Re?-1:1)*J*J*ce*ce)/(2*(Re?ue:ne)*J*ce);return Math.log(Math.sqrt(Ne*Ne+1)-Ne)}function re(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ge(Re){return(Math.exp(Re)+Math.exp(-Re))/2}let Ce=ie(0),ae=function(Re){return ge(Ce)/ge(Ce+te*Re)},Ie=function(Re){return ne*((ge(Ce)*(re(Ne=Ce+te*Re)/ge(Ne))-re(Ce))/J)/ce;var Ne},Me=(ie(1)-Ce)/te;if(Math.abs(ce)<1e-6||!isFinite(Me)){if(Math.abs(ne-ue)<1e-6)return this.easeTo(s,h);let Re=ue<ne?-1:1;Me=Math.abs(Math.log(ue/ne))/te,Ie=function(){return 0},ae=function(Ne){return Math.exp(Re*te*Ne)}}s.duration="duration"in s?+s.duration:1e3*Me/("screenSpeed"in s?+s.screenSpeed/te:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);let $e=x!==P,Ge=O!==E,Ve=!g.isPaddingEqual(N),xe=Re=>Ne=>{let ot=Ne*Me,ct=1/ae(ot);Re.zoom=Ne===1?M:v+Re.scaleZoom(ct),$e&&(Re.bearing=r.a2(x,P,Ne)),Ge&&(Re.pitch=r.a2(E,O,Ne)),Ve&&(Re.interpolatePadding(C,N,Ne),G=Re.centerPoint.add(V));let at=Ne===1?q:Re.unproject(W.add(ee.mult(Ie(ot))).mult(ct));return Re.setLocationAtPoint(Re.renderWorldCopies?at.wrap():at,G),Re._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),Re};if(s.preloadOnly){let Re=this._emulate(xe,s.duration,g);return this._preloadTiles(Re),this}return this._zooming=!0,this._rotating=$e,this._pitching=Ge,this._padding=Ve,this._prepareEase(h,!1),this._ease(xe(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){let g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=r.e.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let s=Math.min((r.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=r.au(s,-180,180);let g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&r.e.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,g){let v=Math.ceil(15*h/1e3),x=[],E=s(g.clone());for(let C=0;C<=v;C++){let M=E(C/v);x.push(M.clone())}return x}_preloadTiles(s,h){}}class Uy{constructor(s={}){this.options=s,r.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){let h=this.options&&this.options.compact;return this._map=s,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),U("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){let g=this._map._getUIString(`AttributionControl.${h}`);s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d8.ACCESS_TOKEN}];if(s){let g=h.reduce((v,x,E)=>(x.value&&(v+=`${x.key}=${x.value}${E<h.length-1?"&":""}`),v),"?");s.href=`${r.d8.FEEDBACK_URL}/${g}#${Vu(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._mergedSourceCaches;for(let v in h){let x=h[v];if(x.used){let E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((v,x)=>v.length-x.length),s=s.filter((v,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));let g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $y{constructor(){r.bp(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=U("div","mapboxgl-ctrl");let h=U("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(let h in s){let g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let s=this._container.children;if(s.length){let h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Gy{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){let h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){let h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(let v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Hy(m,s,h){if(m=new r.aI(m.lng,m.lat),s){let g=new r.aI(m.lng-360,m.lat),v=new r.aI(m.lng+360,m.lat),x=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),E=h.locationPoint(m).distSqr(s),C=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(g).distSqr(s)<E&&(C||Math.abs(g.lng-h.center.lng)<x)?m=g:h.locationPoint(v).distSqr(s)<E&&(C||Math.abs(v.lng-h.center.lng)<x)&&(m=v)}for(;Math.abs(m.lng-h.center.lng)>180;){let g=h.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}let zm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yu extends r.E{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=r.W({element:s},h)),r.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=r.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=U("div");let x=41,E=27,C=Q("svg",{display:"block",height:x*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${x}`},this._element),M=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},C));Q("stop",{offset:"10%","stop-opacity":.4},M),Q("stop",{offset:"100%","stop-opacity":.05},M),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=r.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in zm)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=s&&s.className?s.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){let s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=r.aI.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){let h=s.code,g=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){let h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let s=this._map,h=this._pos;if(!s||!h)return!1;let g=s.unproject(h),v=s.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let s=this._map;if(!s)return;let h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();let g=s.unproject(h),v;s._showingGlobe()&&r.d9(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let s=this._pos;if(!s||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${zm[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||g!=="map")return"";if(!h._showingGlobe()){let M=h.getPitch();return M?`rotateX(${M}deg)`:""}let v=r.b0(r.da(h.transform,this._lngLat)),x=s.sub(r.db(h.transform)),E=Math.abs(x.x)+Math.abs(x.y);if(E===0)return"";let C=v/E;return`rotateX(${-x.y*C}deg) rotateY(${x.x*C}deg)`}_calculateZTransform(){let s=this._pos,h=this._map;if(!h||!s)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new r.aI(this._lngLat.lng,this._lngLat.lat+.001)),E=h.project(new r.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=r.b0(Math.atan2(E.y,E.x))-90}else g=-h.getBearing();else if(v==="horizon"){let x=r.$(4,6,h.getZoom()),E=r.db(h.transform);E.y+=x*h.transform.height;let C=s.sub(E),M=r.b0(Math.atan2(C.y,C.x));g=(M>90?M-270:M+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Hy(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=r.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){let h=this._map;if(!h)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<x)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.f("dragstart"))),this.fire(new r.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.f("dragend")),this._state="inactive"}_addDragHandler(s){let h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;let h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Bm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function el(m=new r.P(0,0),s="bottom"){if(typeof m=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new r.P(0,m);case"top-left":return new r.P(h,h);case"top-right":return new r.P(-h,h);case"bottom":return new r.P(0,-m);case"bottom-left":return new r.P(h,-h);case"bottom-right":return new r.P(-h,-h);case"left":return new r.P(m,0);case"right":return new r.P(-m,0)}return new r.P(0,0)}return m instanceof r.P||Array.isArray(m)?r.P.convert(m):r.P.convert(m[s]||[0,0])}class Wy{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;let h=r.b9((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}let Zy={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Yy{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let Vm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},tl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xy{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Am({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Qa({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),r.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),De()}move(s,h){let g=this.map,v=this.mouseRotate.mousemoveWindow(s,h),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let E=this.mousePitch.mousemoveWindow(s,h),C=E&&E.pitchDelta;C&&g.setPitch(g.getPitch()+C)}}off(){let s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ke(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(r.W({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),ft(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,ft(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ue(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ue(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let nl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ky={maxWidth:100,unit:"metric"},Kd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dt,supported:I,setRTLTextPlugin:r.dv,getRTLTextPluginStatus:r.dw,Map:class extends A1{constructor(m){r.dc.mark(r.dd.create);let s=m;if((m=r.W({},Vm,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&r.de(window)&&(m.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ko(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Gy,this._domRenderTaskQueue=new Gy,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.df(),this._locale=r.W({},Zy,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Wy(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new r.dg(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?gt({},m.contextCreateOptions):{},typeof m.container=="string"){let h=document.getElementById(m.container);if(!h)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=h}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),r.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Yy),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new jy(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||r.d8.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new S1(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});let h=m.bounds;h&&(this.resize(),this.fitBounds(h,r.W({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Uy({customAttribution:m.customAttribution})),this._logoControl=new $y,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new r.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new r.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new r.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=m.onAdd(this);this._controls.push(m);let g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new r.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let s=!this._moving;return s&&this.fire(new r.f("movestart",m)).fire(new r.f("move",m)),this.fire(new r.f("resize",m)),s&&this.fire(new r.f("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(r.ai.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(s=>s==="auto"?navigator.language:s):m}setLanguage(m){let s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let m=this.transform,s=m.projection.name,h;s==="globe"&&m.zoom>=r.aU?(m.setMercatorFromTransition(),h=!0):s==="mercator"&&m.zoom<r.aU&&(m.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s=m.name==="globe"&&this.transform.zoom>=r.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(r.aI.convert(m))}unproject(m){return this.transform.pointLocation3D(r.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let g=!1,v=E=>{let C=s.filter(P=>this.getLayer(P)),M=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];M.length?g||(g=!0,h.call(this,new rr(m,this,E.originalEvent,{features:M}))):g=!1},x=()=>{g=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}if(m==="mouseleave"||m==="mouseout"){let g=!1,v=E=>{let C=s.filter(M=>this.getLayer(M));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?g=!0:g&&(g=!1,h.call(this,new rr(m,this,E.originalEvent)))},x=E=>{g&&(g=!1,h.call(this,new rr(m,this,E.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=s.filter(C=>this.getLayer(C)),E=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];E.length&&(v.features=E,h.call(this,v),delete v.features)};return{layers:new Set(s),listener:h,delegates:{[m]:g}}}}on(m,s,h){if(typeof s=="function"||h===void 0)return super.on(m,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,s,h){if(typeof s=="function"||h===void 0)return super.once(m,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(m,s,h);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,s,h){if(typeof s=="function"||h===void 0)return super.off(m,s);let g=new Set(Array.isArray(s)?s:[s]);for(let E of g)if(!this._isValidId(E))return this;let v=(E,C)=>{if(E.size!==C.size)return!1;for(let M of E)if(!C.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(E=>{for(let C=0;C<E.length;C++){let M=E[C];if(M.listener===h&&v(M.layers,g)){for(let P in M.delegates)this.off(P,M.delegates[P]);return E.splice(C,1),this}}})(x),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(s!==void 0||m===void 0||m instanceof r.P||Array.isArray(m)||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],(s=s||{}).layers&&Array.isArray(s.layers)){for(let h of s.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(m,s,this.transform)}querySourceFeatures(m,s){return this._isValidId(m)?this.style.querySourceFeatures(m,s):[]}isPointOnSurface(m){let{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&r.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(m))}setStyle(m,s){return s=r.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(h,g)=>{h?(r.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(m,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){let s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){let h=r.W({},s);s&&s.config&&(h.initialConfig=s.config,delete h.config),this.style=new Oo(this,h).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new r.d(new Error("IDs can't be empty."))),!1):!r.cV(m)||(this.fire(new r.d(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){let{width:C,height:M,data:P}=r.e.getImageData(s);this.style.addImage(m,{data:new r.i({width:C,height:M},P),pixelRatio:h,stretchX:v,stretchY:x,content:E,sdf:g,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new r.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:C,height:M}=s,P=s;this.style.addImage(m,{data:new r.i({width:C,height:M},new Uint8Array(P.data)),pixelRatio:h,stretchX:v,stretchY:x,content:E,sdf:g,version:0,userImage:P}),P.onAdd&&P.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();let h=this.style.getImage(m);if(!h)return void this.fire(new r.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?r.e.getImageData(s):s,{width:v,height:x,data:E}=g;if(v===void 0||x===void 0)return void this.fire(new r.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||x!==h.data.height)return void this.fire(new r.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let C=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);h.data.replace(E,C),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new r.d(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){r.h(this._requestManager.transformRequest(m,r.R.Image),(h,g)=>{s(h,g instanceof HTMLImageElement?r.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new r.d(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){let s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s),this}updateImport(m,s){return typeof s!="string"&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){return this._isValidId(m)?this.style.getOwnLayer(m):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,h){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,h),this._update(!0)):this}setFilter(m,s,h={}){return this._isValidId(m)?(this.style.setFilter(m,s,h),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,h,g),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,h,g),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,h){return this.style.setConfigProperty(m,s,h),this._update(!0)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){let s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aI.convert(m),this.transform):0}setFeatureState(m,s){return this._isValidId(m.source)?(this.style.setFeatureState(m,s),this._update()):this}removeFeatureState(m,s){return this._isValidId(m.source)?(this.style.removeFeatureState(m,s),this._update()):this}getFeatureState(m){return this._isValidId(m.source)?this.style.getFeatureState(m):null}_updateContainerDimensions(){if(!this._container)return;let m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300,h,g,v,x=this._container;for(;x&&(!g||!v);){let E=window.getComputedStyle(x).transform;E&&E!=="none"&&(h=E.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();let s=this._canvasContainer=U("div","mapboxgl-canvas-container",m);this._canvas=U("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=U("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=U("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){let h=r.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){let s=this._markers.indexOf(m);s!==-1&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){let s=this._popups.indexOf(m);s!==-1&&this._popups.splice(s,1)}_setupPainter(){let m=r.W({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(r.dh(s,!0),this.painter=new Ey(s,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.di.testSupport(s)):this.fire(new r.d(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.f("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new r.f("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new r.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,g=r.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let P=this.transform.zoom,O=this.transform.pitch,N=r.e.now(),B=new r.X(P,{now:N,fadeDuration:x,pitch:O,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g);let C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(C&&(this._placementDirty=C.needsRerender,this._occlusionOpacityChanged=C.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.dc.mark(r.dd.load),this.fire(new r.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){let P=r.e.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let O=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new r.f("gpu-timing-frame",{cpuTime:P,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){let P=this.painter.collectGpuTimers();setTimeout(()=>{let O=this.painter.queryGpuTimers(P);this.fire(new r.f("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){let P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let O=this.painter.queryGpuTimeDeferredRender(P);this.fire(new r.f("gpu-timing-deferred-render",{gpuTime:O}))},50)}let M=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||E;if((this._sourcesDirty||this._styleDirty||E||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),M||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let P=!this.isMoving()&&this.loaded();if(P&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new r.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let O=this._calculateSpeedIndex();this.fire(new r.f("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!M&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,r.dc.mark(r.dd.fullLoad),this._performanceMetricsCollection&&r.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(let s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(let s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){let h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;let E=Math.abs(v-x);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){r.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===r.dl||m.status===401)){let s=this.painter.context.gl;r.dh(s,!1),this._logoControl instanceof $y&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){let m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());let h=this.painter.context.gl,g=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(m,s,h){let g=h[1]-h[0],v=m.length/4;for(let x=0;x<s.length;x++){let E=s[x],C=0;for(let M=0;M<E.length;M+=4)E[M]===m[M]&&E[M+1]===m[M+1]&&E[M+2]===m[M+2]&&E[M+3]===m[M+3]&&(C+=1);g+=(h[x+2]-h[x+1])*(1-C/v)}return g}remove(){this._hash&&this._hash.remove();for(let s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dp(this.painter.context.gl),r.dq.remove(),r.dr.remove(),this._removed=!0,this.fire(new r.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=r.e.frame(s=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(m){let s=this.style?this.style.getSourceCaches():[];return r.ds(s,(h,g)=>h._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){r.du(m,s)}_occlusionCriteriaSatisfied(){let m=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&m&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return r.dt}},NavigationControl:class{constructor(m){this.options=r.W({},tl,m),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(r.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let m=this._map;if(!m)return;let s=m.getZoom(),h=s===m.getMaxZoom(),g=s===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let m=this._map;if(!m)return;let s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xy(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){let m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){let h=U("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends r.E{constructor(m){super();let s=navigator.geolocation;this.options=r.W({geolocation:s},nl,m),r.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Im(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){let s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,m(h)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){let s=this._map.getMaxBounds(),h=m.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new r.f("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("geolocate",m)),this._finish()}}_updateCamera(m){let s=new r.aI(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,g=this._map.getBearing(),v=r.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),v,{geolocateSource:!0})}_updateMarker(m){if(m){let s=new r.aI(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let m=this._map.transform,s=r.ax(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{let s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.f("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Uy,ScaleControl:class{constructor(m){this.options=r.W({},Ky,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let m=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-m/2,v=s.unproject([g,h]),x=s.unproject([g+m,h]),E=v.distanceTo(x);if(this.options.unit==="imperial"){let C=3.2808*E;C>5280?this._setScale(m,C/5280,"mile"):this._setScale(m,C,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,s,h){this._map._requestDomTask(()=>{let g=function(x){let E=Math.pow(10,`${Math.floor(x)}`.length-1),C=x/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){let P=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*P)/P}(C),E*C}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${Kd[h]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:r.w("Full screen control 'container' must be a DOM element.")),r.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let m=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(m){super(),this.options=r.W(Object.create(Bm),m),r.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new r.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new r.f("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=r.aI.convert(m),this._pos=null,this._trackPointer=!1,this._update();let s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let s=document.createDocumentFragment(),h=document.createElement("body"),g;for(h.innerHTML=m;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){let h=this._closeButton=U("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;let s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,E=g.x<v/2,C=g.x>s.transform.width-v/2;if(g.y+m<x)return E?"top-left":C?"top-right":"top";if(g.y>s.transform.height-x){if(E)return"bottom-left";if(C)return"bottom-right"}return E?"left":C?"right":"bottom"}_updateClassList(){let m=this._container;if(!m)return;let s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){let s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=U("div","mapboxgl-popup",s.getContainer()),this._tip=U("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hy(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){let v=this._pos=this._trackPointer&&m?m:s.project(this._lngLat),x=el(this.options.offset),E=this._anchor=this._getAnchor(x.y),C=el(this.options.offset,E),M=v.add(C).round();s._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${zm[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&s._showingGlobe()){let v=r.d9(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(qy);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Yu,Style:Oo,LngLat:r.aI,LngLatBounds:r.ai,Point:r.P,MercatorCoordinate:r.Y,FreeCameraOptions:Hp,Evented:r.E,config:r.d8,prewarm:r.dx,clearPrewarmedResources:r.dy,get accessToken(){return r.d8.ACCESS_TOKEN},set accessToken(m){r.d8.ACCESS_TOKEN=m},get baseApiUrl(){return r.d8.API_URL},set baseApiUrl(m){r.d8.API_URL=m},get workerCount(){return r.dz.workerCount},set workerCount(m){r.dz.workerCount=m},get maxParallelImageRequests(){return r.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){r.d8.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){r.dA(m)},get workerUrl(){return r.dB.workerUrl},set workerUrl(m){r.dB.workerUrl=m},get workerClass(){return r.dB.workerClass},set workerClass(m){r.dB.workerClass=m},get workerParams(){return r.dB.workerParams},set workerParams(m){r.dB.workerParams=m},get dracoUrl(){return r.dC()},set dracoUrl(m){r.dD(m)},get meshoptUrl(){return r.dE()},set meshoptUrl(m){r.dF(m)},setNow:r.e.setNow,restoreNow:r.e.restoreNow}});var f=l;return f})});var j2=null;var wE=1,U2=Symbol("SIGNAL");function di(o){let n=j2;return j2=o,n}var $2={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function f4(o){if(!(CE(o)&&!o.dirty)&&!(!o.dirty&&o.lastCleanEpoch===wE)){if(!o.producerMustRecompute(o)&&!EE(o)){o.dirty=!1,o.lastCleanEpoch=wE;return}o.producerRecomputeValue(o),o.dirty=!1,o.lastCleanEpoch=wE}}function G2(o){return o&&(o.nextProducerIndex=0),di(o)}function H2(o,n){if(di(n),!(!o||o.producerNode===void 0||o.producerIndexOfThis===void 0||o.producerLastReadVersion===void 0)){if(CE(o))for(let l=o.nextProducerIndex;l<o.producerNode.length;l++)TE(o.producerNode[l],o.producerIndexOfThis[l]);for(;o.producerNode.length>o.nextProducerIndex;)o.producerNode.pop(),o.producerLastReadVersion.pop(),o.producerIndexOfThis.pop()}}function EE(o){ov(o);for(let n=0;n<o.producerNode.length;n++){let l=o.producerNode[n],c=o.producerLastReadVersion[n];if(c!==l.version||(f4(l),c!==l.version))return!0}return!1}function q2(o){if(ov(o),CE(o))for(let n=0;n<o.producerNode.length;n++)TE(o.producerNode[n],o.producerIndexOfThis[n]);o.producerNode.length=o.producerLastReadVersion.length=o.producerIndexOfThis.length=0,o.liveConsumerNode&&(o.liveConsumerNode.length=o.liveConsumerIndexOfThis.length=0)}function TE(o,n){if(p4(o),ov(o),o.liveConsumerNode.length===1)for(let c=0;c<o.producerNode.length;c++)TE(o.producerNode[c],o.producerIndexOfThis[c]);let l=o.liveConsumerNode.length-1;if(o.liveConsumerNode[n]=o.liveConsumerNode[l],o.liveConsumerIndexOfThis[n]=o.liveConsumerIndexOfThis[l],o.liveConsumerNode.length--,o.liveConsumerIndexOfThis.length--,n<o.liveConsumerNode.length){let c=o.liveConsumerIndexOfThis[n],f=o.liveConsumerNode[n];ov(f),f.producerIndexOfThis[c]=n}}function CE(o){return o.consumerIsAlwaysLive||(o?.liveConsumerNode?.length??0)>0}function ov(o){o.producerNode??=[],o.producerIndexOfThis??=[],o.producerLastReadVersion??=[]}function p4(o){o.liveConsumerNode??=[],o.liveConsumerIndexOfThis??=[]}function m4(){throw new Error}var g4=m4;function W2(o){g4=o}function Pn(o){return typeof o=="function"}function Df(o){let l=o(c=>{Error.call(c),c.stack=new Error().stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}var sv=Df(o=>function(l){o(this),this.message=l?`${l.length} errors occurred during unsubscription:
${l.map((c,f)=>`${f+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=l});function fh(o,n){if(o){let l=o.indexOf(n);0<=l&&o.splice(l,1)}}var Qi=class o{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:l}=this;if(l)if(this._parentage=null,Array.isArray(l))for(let r of l)r.remove(this);else l.remove(this);let{initialTeardown:c}=this;if(Pn(c))try{c()}catch(r){n=r instanceof sv?r.errors:[r]}let{_finalizers:f}=this;if(f){this._finalizers=null;for(let r of f)try{Z2(r)}catch(w){n=n??[],w instanceof sv?n=[...n,...w.errors]:n.push(w)}}if(n)throw new sv(n)}}add(n){var l;if(n&&n!==this)if(this.closed)Z2(n);else{if(n instanceof o){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(l=this._finalizers)!==null&&l!==void 0?l:[]).push(n)}}_hasParent(n){let{_parentage:l}=this;return l===n||Array.isArray(l)&&l.includes(n)}_addParent(n){let{_parentage:l}=this;this._parentage=Array.isArray(l)?(l.push(n),l):l?[l,n]:n}_removeParent(n){let{_parentage:l}=this;l===n?this._parentage=null:Array.isArray(l)&&fh(l,n)}remove(n){let{_finalizers:l}=this;l&&fh(l,n),n instanceof o&&n._removeParent(this)}};Qi.EMPTY=(()=>{let o=new Qi;return o.closed=!0,o})();var IE=Qi.EMPTY;function av(o){return o instanceof Qi||o&&"closed"in o&&Pn(o.remove)&&Pn(o.add)&&Pn(o.unsubscribe)}function Z2(o){Pn(o)?o():o.unsubscribe()}var Os={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Sf={setTimeout(o,n,...l){let{delegate:c}=Sf;return c?.setTimeout?c.setTimeout(o,n,...l):setTimeout(o,n,...l)},clearTimeout(o){let{delegate:n}=Sf;return(n?.clearTimeout||clearTimeout)(o)},delegate:void 0};function lv(o){Sf.setTimeout(()=>{let{onUnhandledError:n}=Os;if(n)n(o);else throw o})}function Cg(){}var Y2=DE("C",void 0,void 0);function X2(o){return DE("E",void 0,o)}function K2(o){return DE("N",o,void 0)}function DE(o,n,l){return{kind:o,value:n,error:l}}var ph=null;function Mf(o){if(Os.useDeprecatedSynchronousErrorHandling){let n=!ph;if(n&&(ph={errorThrown:!1,error:null}),o(),n){let{errorThrown:l,error:c}=ph;if(ph=null,l)throw c}}else o()}function Q2(o){Os.useDeprecatedSynchronousErrorHandling&&ph&&(ph.errorThrown=!0,ph.error=o)}var mh=class extends Qi{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,av(n)&&n.add(this)):this.destination=v4}static create(n,l,c){return new fl(n,l,c)}next(n){this.isStopped?ME(K2(n),this):this._next(n)}error(n){this.isStopped?ME(X2(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?ME(Y2,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},_4=Function.prototype.bind;function SE(o,n){return _4.call(o,n)}var AE=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:l}=this;if(l.next)try{l.next(n)}catch(c){cv(c)}}error(n){let{partialObserver:l}=this;if(l.error)try{l.error(n)}catch(c){cv(c)}else cv(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(l){cv(l)}}},fl=class extends mh{constructor(n,l,c){super();let f;if(Pn(n)||!n)f={next:n??void 0,error:l??void 0,complete:c??void 0};else{let r;this&&Os.useDeprecatedNextContext?(r=Object.create(n),r.unsubscribe=()=>this.unsubscribe(),f={next:n.next&&SE(n.next,r),error:n.error&&SE(n.error,r),complete:n.complete&&SE(n.complete,r)}):f=n}this.destination=new AE(f)}};function cv(o){Os.useDeprecatedSynchronousErrorHandling?Q2(o):lv(o)}function y4(o){throw o}function ME(o,n){let{onStoppedNotification:l}=Os;l&&Sf.setTimeout(()=>l(o,n))}var v4={closed:!0,next:Cg,error:y4,complete:Cg};var Af=typeof Symbol=="function"&&Symbol.observable||"@@observable";function zo(o){return o}function PE(...o){return RE(o)}function RE(o){return o.length===0?zo:o.length===1?o[0]:function(l){return o.reduce((c,f)=>f(c),l)}}var ri=(()=>{class o{constructor(l){l&&(this._subscribe=l)}lift(l){let c=new o;return c.source=this,c.operator=l,c}subscribe(l,c,f){let r=b4(l)?l:new fl(l,c,f);return Mf(()=>{let{operator:w,source:I}=this;r.add(w?w.call(r,I):I?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(l){try{return this._subscribe(l)}catch(c){l.error(c)}}forEach(l,c){return c=J2(c),new c((f,r)=>{let w=new fl({next:I=>{try{l(I)}catch(A){r(A),w.unsubscribe()}},error:r,complete:f});this.subscribe(w)})}_subscribe(l){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(l)}[Af](){return this}pipe(...l){return RE(l)(this)}toPromise(l){return l=J2(l),new l((c,f)=>{let r;this.subscribe(w=>r=w,w=>f(w),()=>c(r))})}}return o.create=n=>new o(n),o})();function J2(o){var n;return(n=o??Os.Promise)!==null&&n!==void 0?n:Promise}function x4(o){return o&&Pn(o.next)&&Pn(o.error)&&Pn(o.complete)}function b4(o){return o&&o instanceof mh||x4(o)&&av(o)}function kE(o){return Pn(o?.lift)}function Hn(o){return n=>{if(kE(n))return n.lift(function(l){try{return o(l,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Kn(o,n,l,c,f){return new OE(o,n,l,c,f)}var OE=class extends mh{constructor(n,l,c,f,r,w){super(n),this.onFinalize=r,this.shouldUnsubscribe=w,this._next=l?function(I){try{l(I)}catch(A){n.error(A)}}:super._next,this._error=f?function(I){try{f(I)}catch(A){n.error(A)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(I){n.error(I)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:l}=this;super.unsubscribe(),!l&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function Pf(){return Hn((o,n)=>{let l=null;o._refCount++;let c=Kn(n,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount){l=null;return}let f=o._connection,r=l;l=null,f&&(!r||f===r)&&f.unsubscribe(),n.unsubscribe()});o.subscribe(c),c.closed||(l=o.connect())})}var Rf=class extends ri{constructor(n,l){super(),this.source=n,this.subjectFactory=l,this._subject=null,this._refCount=0,this._connection=null,kE(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Qi;let l=this.getSubject();n.add(this.source.subscribe(Kn(l,void 0,()=>{this._teardown(),l.complete()},c=>{this._teardown(),l.error(c)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Qi.EMPTY)}return n}refCount(){return Pf()(this)}};var eP=Df(o=>function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var br=(()=>{class o extends ri{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(l){let c=new uv(this,this);return c.operator=l,c}_throwIfClosed(){if(this.closed)throw new eP}next(l){Mf(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(l)}})}error(l){Mf(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=l;let{observers:c}=this;for(;c.length;)c.shift().error(l)}})}complete(){Mf(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:l}=this;for(;l.length;)l.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var l;return((l=this.observers)===null||l===void 0?void 0:l.length)>0}_trySubscribe(l){return this._throwIfClosed(),super._trySubscribe(l)}_subscribe(l){return this._throwIfClosed(),this._checkFinalizedStatuses(l),this._innerSubscribe(l)}_innerSubscribe(l){let{hasError:c,isStopped:f,observers:r}=this;return c||f?IE:(this.currentObservers=null,r.push(l),new Qi(()=>{this.currentObservers=null,fh(r,l)}))}_checkFinalizedStatuses(l){let{hasError:c,thrownError:f,isStopped:r}=this;c?l.error(f):r&&l.complete()}asObservable(){let l=new ri;return l.source=this,l}}return o.create=(n,l)=>new uv(n,l),o})(),uv=class extends br{constructor(n,l){super(),this.destination=n,this.source=l}next(n){var l,c;(c=(l=this.destination)===null||l===void 0?void 0:l.next)===null||c===void 0||c.call(l,n)}error(n){var l,c;(c=(l=this.destination)===null||l===void 0?void 0:l.error)===null||c===void 0||c.call(l,n)}complete(){var n,l;(l=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||l===void 0||l.call(n)}_subscribe(n){var l,c;return(c=(l=this.source)===null||l===void 0?void 0:l.subscribe(n))!==null&&c!==void 0?c:IE}};var wr=class extends br{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let l=super._subscribe(n);return!l.closed&&n.next(this._value),l}getValue(){let{hasError:n,thrownError:l,_value:c}=this;if(n)throw l;return this._throwIfClosed(),c}next(n){super.next(this._value=n)}};var LE={now(){return(LE.delegate||Date).now()},delegate:void 0};var hv=class extends Qi{constructor(n,l){super()}schedule(n,l=0){return this}};var Ig={setInterval(o,n,...l){let{delegate:c}=Ig;return c?.setInterval?c.setInterval(o,n,...l):setInterval(o,n,...l)},clearInterval(o){let{delegate:n}=Ig;return(n?.clearInterval||clearInterval)(o)},delegate:void 0};var dv=class extends hv{constructor(n,l){super(n,l),this.scheduler=n,this.work=l,this.pending=!1}schedule(n,l=0){var c;if(this.closed)return this;this.state=n;let f=this.id,r=this.scheduler;return f!=null&&(this.id=this.recycleAsyncId(r,f,l)),this.pending=!0,this.delay=l,this.id=(c=this.id)!==null&&c!==void 0?c:this.requestAsyncId(r,this.id,l),this}requestAsyncId(n,l,c=0){return Ig.setInterval(n.flush.bind(n,this),c)}recycleAsyncId(n,l,c=0){if(c!=null&&this.delay===c&&this.pending===!1)return l;l!=null&&Ig.clearInterval(l)}execute(n,l){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let c=this._execute(n,l);if(c)return c;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,l){let c=!1,f;try{this.work(n)}catch(r){c=!0,f=r||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),f}unsubscribe(){if(!this.closed){let{id:n,scheduler:l}=this,{actions:c}=l;this.work=this.state=this.scheduler=null,this.pending=!1,fh(c,this),n!=null&&(this.id=this.recycleAsyncId(l,n,null)),this.delay=null,super.unsubscribe()}}};var kf=class o{constructor(n,l=o.now){this.schedulerActionCtor=n,this.now=l}schedule(n,l=0,c){return new this.schedulerActionCtor(this,n).schedule(c,l)}};kf.now=LE.now;var fv=class extends kf{constructor(n,l=kf.now){super(n,l),this.actions=[],this._active=!1}flush(n){let{actions:l}=this;if(this._active){l.push(n);return}let c;this._active=!0;do if(c=n.execute(n.state,n.delay))break;while(n=l.shift());if(this._active=!1,c){for(;n=l.shift();)n.unsubscribe();throw c}}};var tP=new fv(dv);var Bo=new ri(o=>o.complete());function nP(o){return o&&Pn(o.schedule)}function iP(o){return o[o.length-1]}function rP(o){return Pn(iP(o))?o.pop():void 0}function kc(o){return nP(iP(o))?o.pop():void 0}function sP(o,n,l,c){function f(r){return r instanceof l?r:new l(function(w){w(r)})}return new(l||(l=Promise))(function(r,w){function I(U){try{L(c.next(U))}catch(Q){w(Q)}}function A(U){try{L(c.throw(U))}catch(Q){w(Q)}}function L(U){U.done?r(U.value):f(U.value).then(I,A)}L((c=c.apply(o,n||[])).next())})}function oP(o){var n=typeof Symbol=="function"&&Symbol.iterator,l=n&&o[n],c=0;if(l)return l.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&c>=o.length&&(o=void 0),{value:o&&o[c++],done:!o}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function gh(o){return this instanceof gh?(this.v=o,this):new gh(o)}function aP(o,n,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=l.apply(o,n||[]),f,r=[];return f={},I("next"),I("throw"),I("return",w),f[Symbol.asyncIterator]=function(){return this},f;function w(he){return function(be){return Promise.resolve(be).then(he,Q)}}function I(he,be){c[he]&&(f[he]=function(De){return new Promise(function(Ke,Fe){r.push([he,De,Ke,Fe])>1||A(he,De)})},be&&(f[he]=be(f[he])))}function A(he,be){try{L(c[he](be))}catch(De){fe(r[0][3],De)}}function L(he){he.value instanceof gh?Promise.resolve(he.value.v).then(U,Q):fe(r[0][2],he)}function U(he){A("next",he)}function Q(he){A("throw",he)}function fe(he,be){he(be),r.shift(),r.length&&A(r[0][0],r[0][1])}}function lP(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=o[Symbol.asyncIterator],l;return n?n.call(o):(o=typeof oP=="function"?oP(o):o[Symbol.iterator](),l={},c("next"),c("throw"),c("return"),l[Symbol.asyncIterator]=function(){return this},l);function c(r){l[r]=o[r]&&function(w){return new Promise(function(I,A){w=o[r](w),f(I,A,w.done,w.value)})}}function f(r,w,I,A){Promise.resolve(A).then(function(L){r({value:L,done:I})},w)}}var pv=o=>o&&typeof o.length=="number"&&typeof o!="function";function mv(o){return Pn(o?.then)}function gv(o){return Pn(o[Af])}function _v(o){return Symbol.asyncIterator&&Pn(o?.[Symbol.asyncIterator])}function yv(o){return new TypeError(`You provided ${o!==null&&typeof o=="object"?"an invalid object":`'${o}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function w4(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var vv=w4();function xv(o){return Pn(o?.[vv])}function bv(o){return aP(this,arguments,function*(){let l=o.getReader();try{for(;;){let{value:c,done:f}=yield gh(l.read());if(f)return yield gh(void 0);yield yield gh(c)}}finally{l.releaseLock()}})}function wv(o){return Pn(o?.getReader)}function Ji(o){if(o instanceof ri)return o;if(o!=null){if(gv(o))return E4(o);if(pv(o))return T4(o);if(mv(o))return C4(o);if(_v(o))return cP(o);if(xv(o))return I4(o);if(wv(o))return D4(o)}throw yv(o)}function E4(o){return new ri(n=>{let l=o[Af]();if(Pn(l.subscribe))return l.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function T4(o){return new ri(n=>{for(let l=0;l<o.length&&!n.closed;l++)n.next(o[l]);n.complete()})}function C4(o){return new ri(n=>{o.then(l=>{n.closed||(n.next(l),n.complete())},l=>n.error(l)).then(null,lv)})}function I4(o){return new ri(n=>{for(let l of o)if(n.next(l),n.closed)return;n.complete()})}function cP(o){return new ri(n=>{S4(o,n).catch(l=>n.error(l))})}function D4(o){return cP(bv(o))}function S4(o,n){var l,c,f,r;return sP(this,void 0,void 0,function*(){try{for(l=lP(o);c=yield l.next(),!c.done;){let w=c.value;if(n.next(w),n.closed)return}}catch(w){f={error:w}}finally{try{c&&!c.done&&(r=l.return)&&(yield r.call(l))}finally{if(f)throw f.error}}n.complete()})}function bo(o,n,l,c=0,f=!1){let r=n.schedule(function(){l(),f?o.add(this.schedule(null,c)):this.unsubscribe()},c);if(o.add(r),!f)return r}function Ev(o,n=0){return Hn((l,c)=>{l.subscribe(Kn(c,f=>bo(c,o,()=>c.next(f),n),()=>bo(c,o,()=>c.complete(),n),f=>bo(c,o,()=>c.error(f),n)))})}function Tv(o,n=0){return Hn((l,c)=>{c.add(o.schedule(()=>l.subscribe(c),n))})}function uP(o,n){return Ji(o).pipe(Tv(n),Ev(n))}function hP(o,n){return Ji(o).pipe(Tv(n),Ev(n))}function dP(o,n){return new ri(l=>{let c=0;return n.schedule(function(){c===o.length?l.complete():(l.next(o[c++]),l.closed||this.schedule())})})}function fP(o,n){return new ri(l=>{let c;return bo(l,n,()=>{c=o[vv](),bo(l,n,()=>{let f,r;try{({value:f,done:r}=c.next())}catch(w){l.error(w);return}r?l.complete():l.next(f)},0,!0)}),()=>Pn(c?.return)&&c.return()})}function Cv(o,n){if(!o)throw new Error("Iterable cannot be null");return new ri(l=>{bo(l,n,()=>{let c=o[Symbol.asyncIterator]();bo(l,n,()=>{c.next().then(f=>{f.done?l.complete():l.next(f.value)})},0,!0)})})}function pP(o,n){return Cv(bv(o),n)}function mP(o,n){if(o!=null){if(gv(o))return uP(o,n);if(pv(o))return dP(o,n);if(mv(o))return hP(o,n);if(_v(o))return Cv(o,n);if(xv(o))return fP(o,n);if(wv(o))return pP(o,n)}throw yv(o)}function er(o,n){return n?mP(o,n):Ji(o)}function un(...o){let n=kc(o);return er(o,n)}function pl(o,n){let l=Pn(o)?o:()=>o,c=f=>f.error(l());return new ri(n?f=>n.schedule(c,0,f):c)}function FE(o){return!!o&&(o instanceof ri||Pn(o.lift)&&Pn(o.subscribe))}var ml=Df(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});function Sn(o,n){return Hn((l,c)=>{let f=0;l.subscribe(Kn(c,r=>{c.next(o.call(n,r,f++))}))})}var{isArray:M4}=Array;function A4(o,n){return M4(n)?o(...n):o(n)}function gP(o){return Sn(n=>A4(o,n))}var{isArray:P4}=Array,{getPrototypeOf:R4,prototype:k4,keys:O4}=Object;function _P(o){if(o.length===1){let n=o[0];if(P4(n))return{args:n,keys:null};if(L4(n)){let l=O4(n);return{args:l.map(c=>n[c]),keys:l}}}return{args:o,keys:null}}function L4(o){return o&&typeof o=="object"&&R4(o)===k4}function yP(o,n){return o.reduce((l,c,f)=>(l[c]=n[f],l),{})}function _h(...o){let n=kc(o),l=rP(o),{args:c,keys:f}=_P(o);if(c.length===0)return er([],n);let r=new ri(F4(c,n,f?w=>yP(f,w):zo));return l?r.pipe(gP(l)):r}function F4(o,n,l=zo){return c=>{vP(n,()=>{let{length:f}=o,r=new Array(f),w=f,I=f;for(let A=0;A<f;A++)vP(n,()=>{let L=er(o[A],n),U=!1;L.subscribe(Kn(c,Q=>{r[A]=Q,U||(U=!0,I--),I||c.next(l(r.slice()))},()=>{--w||c.complete()}))},c)},c)}}function vP(o,n,l){o?bo(l,o,n):n()}function xP(o,n,l,c,f,r,w,I){let A=[],L=0,U=0,Q=!1,fe=()=>{Q&&!A.length&&!L&&n.complete()},he=De=>L<c?be(De):A.push(De),be=De=>{r&&n.next(De),L++;let Ke=!1;Ji(l(De,U++)).subscribe(Kn(n,Fe=>{f?.(Fe),r?he(Fe):n.next(Fe)},()=>{Ke=!0},void 0,()=>{if(Ke)try{for(L--;A.length&&L<c;){let Fe=A.shift();w?bo(n,w,()=>be(Fe)):be(Fe)}fe()}catch(Fe){n.error(Fe)}}))};return o.subscribe(Kn(n,he,()=>{Q=!0,fe()})),()=>{I?.()}}function Er(o,n,l=1/0){return Pn(n)?Er((c,f)=>Sn((r,w)=>n(c,r,f,w))(Ji(o(c,f))),l):(typeof n=="number"&&(l=n),Hn((c,f)=>xP(c,f,o,l)))}function NE(o=1/0){return Er(zo,o)}function bP(){return NE(1)}function Oc(...o){return bP()(er(o,kc(o)))}function Iv(o){return new ri(n=>{Ji(o()).subscribe(n)})}function io(o,n){return Hn((l,c)=>{let f=0;l.subscribe(Kn(c,r=>o.call(n,r,f++)&&c.next(r)))})}function _a(o){return Hn((n,l)=>{let c=null,f=!1,r;c=n.subscribe(Kn(l,void 0,void 0,w=>{r=Ji(o(w,_a(o)(n))),c?(c.unsubscribe(),c=null,r.subscribe(l)):f=!0})),f&&(c.unsubscribe(),c=null,r.subscribe(l))})}function wP(o,n,l,c,f){return(r,w)=>{let I=l,A=n,L=0;r.subscribe(Kn(w,U=>{let Q=L++;A=I?o(A,U,Q):(I=!0,U),c&&w.next(A)},f&&(()=>{I&&w.next(A),w.complete()})))}}function Lc(o,n){return Pn(n)?Er(o,n,1):Er(o,1)}function zE(o,n=tP){return Hn((l,c)=>{let f=null,r=null,w=null,I=()=>{if(f){f.unsubscribe(),f=null;let L=r;r=null,c.next(L)}};function A(){let L=w+o,U=n.now();if(U<L){f=this.schedule(void 0,L-U),c.add(f);return}I()}l.subscribe(Kn(c,L=>{r=L,w=n.now(),f||(f=n.schedule(A,o),c.add(f))},()=>{I(),c.complete()},void 0,()=>{r=f=null}))})}function Fc(o){return Hn((n,l)=>{let c=!1;n.subscribe(Kn(l,f=>{c=!0,l.next(f)},()=>{c||l.next(o),l.complete()}))})}function Ls(o){return o<=0?()=>Bo:Hn((n,l)=>{let c=0;n.subscribe(Kn(l,f=>{++c<=o&&(l.next(f),o<=c&&l.complete())}))})}function BE(o){return Sn(()=>o)}function Dv(o=N4){return Hn((n,l)=>{let c=!1;n.subscribe(Kn(l,f=>{c=!0,l.next(f)},()=>c?l.complete():l.error(o())))})}function N4(){return new ml}function ya(o){return Hn((n,l)=>{try{n.subscribe(l)}finally{l.add(o)}})}function va(o,n){let l=arguments.length>=2;return c=>c.pipe(o?io((f,r)=>o(f,r,c)):zo,Ls(1),l?Fc(n):Dv(()=>new ml))}function Of(o){return o<=0?()=>Bo:Hn((n,l)=>{let c=[];n.subscribe(Kn(l,f=>{c.push(f),o<c.length&&c.shift()},()=>{for(let f of c)l.next(f);l.complete()},void 0,()=>{c=null}))})}function VE(o,n){let l=arguments.length>=2;return c=>c.pipe(o?io((f,r)=>o(f,r,c)):zo,Of(1),l?Fc(n):Dv(()=>new ml))}function jE(o,n){return Hn(wP(o,n,arguments.length>=2,!0))}function $E(o={}){let{connector:n=()=>new br,resetOnError:l=!0,resetOnComplete:c=!0,resetOnRefCountZero:f=!0}=o;return r=>{let w,I,A,L=0,U=!1,Q=!1,fe=()=>{I?.unsubscribe(),I=void 0},he=()=>{fe(),w=A=void 0,U=Q=!1},be=()=>{let De=w;he(),De?.unsubscribe()};return Hn((De,Ke)=>{L++,!Q&&!U&&fe();let Fe=A=A??n();Ke.add(()=>{L--,L===0&&!Q&&!U&&(I=UE(be,f))}),Fe.subscribe(Ke),!w&&L>0&&(w=new fl({next:tt=>Fe.next(tt),error:tt=>{Q=!0,fe(),I=UE(he,l,tt),Fe.error(tt)},complete:()=>{U=!0,fe(),I=UE(he,c),Fe.complete()}}),Ji(De).subscribe(w))})(r)}}function UE(o,n,...l){if(n===!0){o();return}if(n===!1)return;let c=new fl({next:()=>{c.unsubscribe(),o()}});return Ji(n(...l)).subscribe(c)}function GE(o){return io((n,l)=>o<=l)}function Dg(...o){let n=kc(o);return Hn((l,c)=>{(n?Oc(o,l,n):Oc(o,l)).subscribe(c)})}function wo(o,n){return Hn((l,c)=>{let f=null,r=0,w=!1,I=()=>w&&!f&&c.complete();l.subscribe(Kn(c,A=>{f?.unsubscribe();let L=0,U=r++;Ji(o(A,U)).subscribe(f=Kn(c,Q=>c.next(n?n(A,Q,U,L++):Q),()=>{f=null,I()}))},()=>{w=!0,I()}))})}function Sg(o){return Hn((n,l)=>{Ji(o).subscribe(Kn(l,()=>l.complete(),Cg)),!l.closed&&n.subscribe(l)})}function lr(o,n,l){let c=Pn(o)||n||l?{next:o,error:n,complete:l}:o;return c?Hn((f,r)=>{var w;(w=c.subscribe)===null||w===void 0||w.call(c);let I=!0;f.subscribe(Kn(r,A=>{var L;(L=c.next)===null||L===void 0||L.call(c,A),r.next(A)},()=>{var A;I=!1,(A=c.complete)===null||A===void 0||A.call(c),r.complete()},A=>{var L;I=!1,(L=c.error)===null||L===void 0||L.call(c,A),r.error(A)},()=>{var A,L;I&&((A=c.unsubscribe)===null||A===void 0||A.call(c)),(L=c.finalize)===null||L===void 0||L.call(c)}))}):zo}var z4="https://g.co/ng/security#xss",xt=class extends Error{constructor(n,l){super(ex(n,l)),this.code=n}};function ex(o,n){return`${`NG0${Math.abs(o)}`}${n?": "+n:""}`}function Ug(o){return{toString:o}.toString()}var Sv="__parameters__";function B4(o){return function(...l){if(o){let c=o(...l);for(let f in c)this[f]=c[f]}}}function aR(o,n,l){return Ug(()=>{let c=B4(n);function f(...r){if(this instanceof f)return c.apply(this,r),this;let w=new f(...r);return I.annotation=w,I;function I(A,L,U){let Q=A.hasOwnProperty(Sv)?A[Sv]:Object.defineProperty(A,Sv,{value:[]})[Sv];for(;Q.length<=U;)Q.push(null);return(Q[U]=Q[U]||[]).push(w),A}}return l&&(f.prototype=Object.create(l.prototype)),f.prototype.ngMetadataName=o,f.annotationCls=f,f})}var Mg=globalThis;function Mi(o){for(let n in o)if(o[n]===Mi)return n;throw Error("Could not find renamed property on target object.")}function oo(o){if(typeof o=="string")return o;if(Array.isArray(o))return"["+o.map(oo).join(", ")+"]";if(o==null)return""+o;if(o.overriddenName)return`${o.overriddenName}`;if(o.name)return`${o.name}`;let n=o.toString();if(n==null)return""+n;let l=n.indexOf(`
`);return l===-1?n:n.substring(0,l)}function EP(o,n){return o==null||o===""?n===null?"":n:n==null||n===""?o:o+" "+n}var V4=Mi({__forward_ref__:Mi});function nC(o){return o.__forward_ref__=nC,o.toString=function(){return oo(this())},o}function ro(o){return lR(o)?o():o}function lR(o){return typeof o=="function"&&o.hasOwnProperty(V4)&&o.__forward_ref__===nC}function At(o){return{token:o.token,providedIn:o.providedIn||null,factory:o.factory,value:void 0}}function cr(o){return{providers:o.providers||[],imports:o.imports||[]}}function tx(o){return TP(o,uR)||TP(o,hR)}function cR(o){return tx(o)!==null}function TP(o,n){return o.hasOwnProperty(n)?o[n]:null}function j4(o){let n=o&&(o[uR]||o[hR]);return n||null}function CP(o){return o&&(o.hasOwnProperty(IP)||o.hasOwnProperty(U4))?o[IP]:null}var uR=Mi({\u0275prov:Mi}),IP=Mi({\u0275inj:Mi}),hR=Mi({ngInjectableDef:Mi}),U4=Mi({ngInjectorDef:Mi}),an=class{constructor(n,l){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof l=="number"?this.__NG_ELEMENT_ID__=l:l!==void 0&&(this.\u0275prov=At({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function dR(o){return o&&!!o.\u0275providers}var $4=Mi({\u0275cmp:Mi}),G4=Mi({\u0275dir:Mi}),H4=Mi({\u0275pipe:Mi}),q4=Mi({\u0275mod:Mi}),Fv=Mi({\u0275fac:Mi}),Ag=Mi({__NG_ELEMENT_ID__:Mi}),DP=Mi({__NG_ENV_ID__:Mi});function Pg(o){return typeof o=="string"?o:o==null?"":String(o)}function W4(o){return typeof o=="function"?o.name||o.toString():typeof o=="object"&&o!=null&&typeof o.type=="function"?o.type.name||o.type.toString():Pg(o)}function Z4(o,n){let l=n?`. Dependency path: ${n.join(" > ")} > ${o}`:"";throw new xt(-200,o)}function iC(o,n){throw new xt(-201,!1)}var qn=function(o){return o[o.Default=0]="Default",o[o.Host=1]="Host",o[o.Self=2]="Self",o[o.SkipSelf=4]="SkipSelf",o[o.Optional=8]="Optional",o}(qn||{}),sT;function fR(){return sT}function ls(o){let n=sT;return sT=o,n}function pR(o,n,l){let c=tx(o);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(l&qn.Optional)return null;if(n!==void 0)return n;iC(o,"Injector")}var Y4={},Rg=Y4,aT="__NG_DI_FLAG__",Nv="ngTempTokenPath",X4="ngTokenPath",K4=/\n/gm,Q4="\u0275",SP="__source",Bf;function J4(){return Bf}function Nc(o){let n=Bf;return Bf=o,n}function ej(o,n=qn.Default){if(Bf===void 0)throw new xt(-203,!1);return Bf===null?pR(o,void 0,n):Bf.get(o,n&qn.Optional?null:void 0,n)}function Ut(o,n=qn.Default){return(fR()||ej)(ro(o),n)}function bt(o,n=qn.Default){return Ut(o,nx(n))}function nx(o){return typeof o>"u"||typeof o=="number"?o:0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)}function lT(o){let n=[];for(let l=0;l<o.length;l++){let c=ro(o[l]);if(Array.isArray(c)){if(c.length===0)throw new xt(900,!1);let f,r=qn.Default;for(let w=0;w<c.length;w++){let I=c[w],A=tj(I);typeof A=="number"?A===-1?f=I.token:r|=A:f=I}n.push(Ut(f,r))}else n.push(Ut(c))}return n}function mR(o,n){return o[aT]=n,o.prototype[aT]=n,o}function tj(o){return o[aT]}function nj(o,n,l,c){let f=o[Nv];throw n[SP]&&f.unshift(n[SP]),o.message=ij(`
`+o.message,f,l,c),o[X4]=f,o[Nv]=null,o}function ij(o,n,l,c=null){o=o&&o.charAt(0)===`
`&&o.charAt(1)==Q4?o.slice(2):o;let f=oo(n);if(Array.isArray(n))f=n.map(oo).join(" -> ");else if(typeof n=="object"){let r=[];for(let w in n)if(n.hasOwnProperty(w)){let I=n[w];r.push(w+":"+(typeof I=="string"?JSON.stringify(I):oo(I)))}f=`{${r.join(", ")}}`}return`${l}${c?"("+c+")":""}[${f}]: ${o.replace(K4,`
  `)}`}var Xf=mR(aR("Optional"),8);var $g=mR(aR("SkipSelf"),4);function jf(o,n){let l=o.hasOwnProperty(Fv);return l?o[Fv]:null}function rj(o,n,l){if(o.length!==n.length)return!1;for(let c=0;c<o.length;c++){let f=o[c],r=n[c];if(l&&(f=l(f),r=l(r)),r!==f)return!1}return!0}function oj(o){return o.flat(Number.POSITIVE_INFINITY)}function rC(o,n){o.forEach(l=>Array.isArray(l)?rC(l,n):n(l))}function gR(o,n,l){n>=o.length?o.push(l):o.splice(n,0,l)}function zv(o,n){return n>=o.length-1?o.pop():o.splice(n,1)[0]}function sj(o,n){let l=[];for(let c=0;c<o;c++)l.push(n);return l}function aj(o,n,l,c){let f=o.length;if(f==n)o.push(l,c);else if(f===1)o.push(c,o[0]),o[0]=l;else{for(f--,o.push(o[f-1],o[f]);f>n;){let r=f-2;o[f]=o[r],f--}o[n]=l,o[n+1]=c}}function lj(o,n,l){let c=Gg(o,n);return c>=0?o[c|1]=l:(c=~c,aj(o,c,n,l)),c}function HE(o,n){let l=Gg(o,n);if(l>=0)return o[l|1]}function Gg(o,n){return cj(o,n,1)}function cj(o,n,l){let c=0,f=o.length>>l;for(;f!==c;){let r=c+(f-c>>1),w=o[r<<l];if(n===w)return r<<l;w>n?f=r:c=r+1}return~(f<<l)}var kg={},Ns=[],Uf=new an(""),_R=new an("",-1),yR=new an(""),Bv=class{get(n,l=Rg){if(l===Rg){let c=new Error(`NullInjectorError: No provider for ${oo(n)}!`);throw c.name="NullInjectorError",c}return l}},vR=function(o){return o[o.OnPush=0]="OnPush",o[o.Default=1]="Default",o}(vR||{}),wa=function(o){return o[o.Emulated=0]="Emulated",o[o.None=2]="None",o[o.ShadowDom=3]="ShadowDom",o}(wa||{}),Eo=function(o){return o[o.None=0]="None",o[o.SignalBased=1]="SignalBased",o[o.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",o}(Eo||{});function uj(o,n,l){let c=o.length;for(;;){let f=o.indexOf(n,l);if(f===-1)return f;if(f===0||o.charCodeAt(f-1)<=32){let r=n.length;if(f+r===c||o.charCodeAt(f+r)<=32)return f}l=f+1}}function cT(o,n,l){let c=0;for(;c<l.length;){let f=l[c];if(typeof f=="number"){if(f!==0)break;c++;let r=l[c++],w=l[c++],I=l[c++];o.setAttribute(n,w,I,r)}else{let r=f,w=l[++c];dj(r)?o.setProperty(n,r,w):o.setAttribute(n,r,w),c++}}return c}function hj(o){return o===3||o===4||o===6}function dj(o){return o.charCodeAt(0)===64}function oC(o,n){if(!(n===null||n.length===0))if(o===null||o.length===0)o=n.slice();else{let l=-1;for(let c=0;c<n.length;c++){let f=n[c];typeof f=="number"?l=f:l===0||(l===-1||l===2?MP(o,l,f,null,n[++c]):MP(o,l,f,null,null))}}return o}function MP(o,n,l,c,f){let r=0,w=o.length;if(n===-1)w=-1;else for(;r<o.length;){let I=o[r++];if(typeof I=="number"){if(I===n){w=-1;break}else if(I>n){w=r-1;break}}}for(;r<o.length;){let I=o[r];if(typeof I=="number")break;if(I===l){if(c===null){f!==null&&(o[r+1]=f);return}else if(c===o[r+1]){o[r+2]=f;return}}r++,c!==null&&r++,f!==null&&r++}w!==-1&&(o.splice(w,0,n),r=w+1),o.splice(r++,0,l),c!==null&&o.splice(r++,0,c),f!==null&&o.splice(r++,0,f)}var xR="ng-template";function fj(o,n,l,c){let f=0;if(c){for(;f<n.length&&typeof n[f]=="string";f+=2)if(n[f]==="class"&&uj(n[f+1].toLowerCase(),l,0)!==-1)return!0}else if(sC(o))return!1;if(f=n.indexOf(1,f),f>-1){let r;for(;++f<n.length&&typeof(r=n[f])=="string";)if(r.toLowerCase()===l)return!0}return!1}function sC(o){return o.type===4&&o.value!==xR}function pj(o,n,l){let c=o.type===4&&!l?xR:o.value;return n===c}function mj(o,n,l){let c=4,f=o.attrs,r=f!==null?yj(f):0,w=!1;for(let I=0;I<n.length;I++){let A=n[I];if(typeof A=="number"){if(!w&&!Fs(c)&&!Fs(A))return!1;if(w&&Fs(A))continue;w=!1,c=A|c&1;continue}if(!w)if(c&4){if(c=2|c&1,A!==""&&!pj(o,A,l)||A===""&&n.length===1){if(Fs(c))return!1;w=!0}}else if(c&8){if(f===null||!fj(o,f,A,l)){if(Fs(c))return!1;w=!0}}else{let L=n[++I],U=gj(A,f,sC(o),l);if(U===-1){if(Fs(c))return!1;w=!0;continue}if(L!==""){let Q;if(U>r?Q="":Q=f[U+1].toLowerCase(),c&2&&L!==Q){if(Fs(c))return!1;w=!0}}}}return Fs(c)||w}function Fs(o){return(o&1)===0}function gj(o,n,l,c){if(n===null)return-1;let f=0;if(c||!l){let r=!1;for(;f<n.length;){let w=n[f];if(w===o)return f;if(w===3||w===6)r=!0;else if(w===1||w===2){let I=n[++f];for(;typeof I=="string";)I=n[++f];continue}else{if(w===4)break;if(w===0){f+=4;continue}}f+=r?1:2}return-1}else return vj(n,o)}function bR(o,n,l=!1){for(let c=0;c<n.length;c++)if(mj(o,n[c],l))return!0;return!1}function _j(o){let n=o.attrs;if(n!=null){let l=n.indexOf(5);if(!(l&1))return n[l+1]}return null}function yj(o){for(let n=0;n<o.length;n++){let l=o[n];if(hj(l))return n}return o.length}function vj(o,n){let l=o.indexOf(4);if(l>-1)for(l++;l<o.length;){let c=o[l];if(typeof c=="number")return-1;if(c===n)return l;l++}return-1}function xj(o,n){e:for(let l=0;l<n.length;l++){let c=n[l];if(o.length===c.length){for(let f=0;f<o.length;f++)if(o[f]!==c[f])continue e;return!0}}return!1}function AP(o,n){return o?":not("+n.trim()+")":n}function bj(o){let n=o[0],l=1,c=2,f="",r=!1;for(;l<o.length;){let w=o[l];if(typeof w=="string")if(c&2){let I=o[++l];f+="["+w+(I.length>0?'="'+I+'"':"")+"]"}else c&8?f+="."+w:c&4&&(f+=" "+w);else f!==""&&!Fs(w)&&(n+=AP(r,f),f=""),c=w,r=r||!Fs(c);l++}return f!==""&&(n+=AP(r,f)),n}function wj(o){return o.map(bj).join(",")}function Ej(o){let n=[],l=[],c=1,f=2;for(;c<o.length;){let r=o[c];if(typeof r=="string")f===2?r!==""&&n.push(r,o[++c]):f===8&&l.push(r);else{if(!Fs(f))break;f=r}c++}return{attrs:n,classes:l}}function pi(o){return Ug(()=>{let n=IR(o),l=hi(gt({},n),{decls:o.decls,vars:o.vars,template:o.template,consts:o.consts||null,ngContentSelectors:o.ngContentSelectors,onPush:o.changeDetection===vR.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&o.dependencies||null,getStandaloneInjector:null,signals:o.signals??!1,data:o.data||{},encapsulation:o.encapsulation||wa.Emulated,styles:o.styles||Ns,_:null,schemas:o.schemas||null,tView:null,id:""});DR(l);let c=o.dependencies;return l.directiveDefs=RP(c,!1),l.pipeDefs=RP(c,!0),l.id=Ij(l),l})}function Tj(o){return Bc(o)||wR(o)}function Cj(o){return o!==null}function ur(o){return Ug(()=>({type:o.type,bootstrap:o.bootstrap||Ns,declarations:o.declarations||Ns,imports:o.imports||Ns,exports:o.exports||Ns,transitiveCompileScopes:null,schemas:o.schemas||null,id:o.id||null}))}function PP(o,n){if(o==null)return kg;let l={};for(let c in o)if(o.hasOwnProperty(c)){let f=o[c],r,w,I=Eo.None;Array.isArray(f)?(I=f[0],r=f[1],w=f[2]??r):(r=f,w=f),n?(l[r]=I!==Eo.None?[c,I]:c,n[r]=w):l[r]=c}return l}function cs(o){return Ug(()=>{let n=IR(o);return DR(n),n})}function Bc(o){return o[$4]||null}function wR(o){return o[G4]||null}function ER(o){return o[H4]||null}function TR(o){let n=Bc(o)||wR(o)||ER(o);return n!==null?n.standalone:!1}function CR(o,n){let l=o[q4]||null;if(!l&&n===!0)throw new Error(`Type ${oo(o)} does not have '\u0275mod' property.`);return l}function IR(o){let n={};return{type:o.type,providersResolver:null,factory:null,hostBindings:o.hostBindings||null,hostVars:o.hostVars||0,hostAttrs:o.hostAttrs||null,contentQueries:o.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:o.inputs||kg,exportAs:o.exportAs||null,standalone:o.standalone===!0,signals:o.signals===!0,selectors:o.selectors||Ns,viewQuery:o.viewQuery||null,features:o.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:PP(o.inputs,n),outputs:PP(o.outputs),debugInfo:null}}function DR(o){o.features?.forEach(n=>n(o))}function RP(o,n){if(!o)return null;let l=n?ER:Tj;return()=>(typeof o=="function"?o():o).map(c=>l(c)).filter(Cj)}function Ij(o){let n=0,l=[o.selectors,o.ngContentSelectors,o.hostVars,o.hostAttrs,o.consts,o.vars,o.decls,o.encapsulation,o.standalone,o.signals,o.exportAs,JSON.stringify(o.inputs),JSON.stringify(o.outputs),Object.getOwnPropertyNames(o.type.prototype),!!o.contentQueries,!!o.viewQuery].join("|");for(let f of l)n=Math.imul(31,n)+f.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function $c(o){return{\u0275providers:o}}function Dj(...o){return{\u0275providers:SR(!0,o),\u0275fromNgModule:!0}}function SR(o,...n){let l=[],c=new Set,f,r=w=>{l.push(w)};return rC(n,w=>{let I=w;uT(I,r,[],c)&&(f||=[],f.push(I))}),f!==void 0&&MR(f,r),l}function MR(o,n){for(let l=0;l<o.length;l++){let{ngModule:c,providers:f}=o[l];aC(f,r=>{n(r,c)})}}function uT(o,n,l,c){if(o=ro(o),!o)return!1;let f=null,r=CP(o),w=!r&&Bc(o);if(!r&&!w){let A=o.ngModule;if(r=CP(A),r)f=A;else return!1}else{if(w&&!w.standalone)return!1;f=o}let I=c.has(f);if(w){if(I)return!1;if(c.add(f),w.dependencies){let A=typeof w.dependencies=="function"?w.dependencies():w.dependencies;for(let L of A)uT(L,n,l,c)}}else if(r){if(r.imports!=null&&!I){c.add(f);let L;try{rC(r.imports,U=>{uT(U,n,l,c)&&(L||=[],L.push(U))})}finally{}L!==void 0&&MR(L,n)}if(!I){let L=jf(f)||(()=>new f);n({provide:f,useFactory:L,deps:Ns},f),n({provide:yR,useValue:f,multi:!0},f),n({provide:Uf,useValue:()=>Ut(f),multi:!0},f)}let A=r.providers;if(A!=null&&!I){let L=o;aC(A,U=>{n(U,L)})}}else return!1;return f!==o&&o.providers!==void 0}function aC(o,n){for(let l of o)dR(l)&&(l=l.\u0275providers),Array.isArray(l)?aC(l,n):n(l)}var Sj=Mi({provide:String,useValue:Mi});function AR(o){return o!==null&&typeof o=="object"&&Sj in o}function Mj(o){return!!(o&&o.useExisting)}function Aj(o){return!!(o&&o.useFactory)}function $f(o){return typeof o=="function"}function Pj(o){return!!o.useClass}var ix=new an(""),Av={},Rj={},qE;function lC(){return qE===void 0&&(qE=new Bv),qE}var To=class{},Og=class extends To{get destroyed(){return this._destroyed}constructor(n,l,c,f){super(),this.parent=l,this.source=c,this.scopes=f,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,dT(n,w=>this.processProvider(w)),this.records.set(_R,Lf(void 0,this)),f.has("environment")&&this.records.set(To,Lf(void 0,this));let r=this.records.get(ix);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(yR,Ns,qn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let n=di(null);try{for(let c of this._ngOnDestroyHooks)c.ngOnDestroy();let l=this._onDestroyHooks;this._onDestroyHooks=[];for(let c of l)c()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),di(n)}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();let l=Nc(this),c=ls(void 0),f;try{return n()}finally{Nc(l),ls(c)}}get(n,l=Rg,c=qn.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(DP))return n[DP](this);c=nx(c);let f,r=Nc(this),w=ls(void 0);try{if(!(c&qn.SkipSelf)){let A=this.records.get(n);if(A===void 0){let L=Nj(n)&&tx(n);L&&this.injectableDefInScope(L)?A=Lf(hT(n),Av):A=null,this.records.set(n,A)}if(A!=null)return this.hydrate(n,A)}let I=c&qn.Self?lC():this.parent;return l=c&qn.Optional&&l===Rg?null:l,I.get(n,l)}catch(I){if(I.name==="NullInjectorError"){if((I[Nv]=I[Nv]||[]).unshift(oo(n)),r)throw I;return nj(I,n,"R3InjectorError",this.source)}else throw I}finally{ls(w),Nc(r)}}resolveInjectorInitializers(){let n=di(null),l=Nc(this),c=ls(void 0),f;try{let r=this.get(Uf,Ns,qn.Self);for(let w of r)w()}finally{Nc(l),ls(c),di(n)}}toString(){let n=[],l=this.records;for(let c of l.keys())n.push(oo(c));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new xt(205,!1)}processProvider(n){n=ro(n);let l=$f(n)?n:ro(n&&n.provide),c=Oj(n);if(!$f(n)&&n.multi===!0){let f=this.records.get(l);f||(f=Lf(void 0,Av,!0),f.factory=()=>lT(f.multi),this.records.set(l,f)),l=n,f.multi.push(n)}this.records.set(l,c)}hydrate(n,l){let c=di(null);try{return l.value===Av&&(l.value=Rj,l.value=l.factory()),typeof l.value=="object"&&l.value&&Fj(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}finally{di(c)}}injectableDefInScope(n){if(!n.providedIn)return!1;let l=ro(n.providedIn);return typeof l=="string"?l==="any"||this.scopes.has(l):this.injectorDefTypes.has(l)}removeOnDestroy(n){let l=this._onDestroyHooks.indexOf(n);l!==-1&&this._onDestroyHooks.splice(l,1)}};function hT(o){let n=tx(o),l=n!==null?n.factory:jf(o);if(l!==null)return l;if(o instanceof an)throw new xt(204,!1);if(o instanceof Function)return kj(o);throw new xt(204,!1)}function kj(o){if(o.length>0)throw new xt(204,!1);let l=j4(o);return l!==null?()=>l.factory(o):()=>new o}function Oj(o){if(AR(o))return Lf(void 0,o.useValue);{let n=PR(o);return Lf(n,Av)}}function PR(o,n,l){let c;if($f(o)){let f=ro(o);return jf(f)||hT(f)}else if(AR(o))c=()=>ro(o.useValue);else if(Aj(o))c=()=>o.useFactory(...lT(o.deps||[]));else if(Mj(o))c=()=>Ut(ro(o.useExisting));else{let f=ro(o&&(o.useClass||o.provide));if(Lj(o))c=()=>new f(...lT(o.deps));else return jf(f)||hT(f)}return c}function Lf(o,n,l=!1){return{factory:o,value:n,multi:l?[]:void 0}}function Lj(o){return!!o.deps}function Fj(o){return o!==null&&typeof o=="object"&&typeof o.ngOnDestroy=="function"}function Nj(o){return typeof o=="function"||typeof o=="object"&&o instanceof an}function dT(o,n){for(let l of o)Array.isArray(l)?dT(l,n):l&&dR(l)?dT(l.\u0275providers,n):n(l)}function Us(o,n){o instanceof Og&&o.assertNotDestroyed();let l,c=Nc(o),f=ls(void 0);try{return n()}finally{Nc(c),ls(f)}}function RR(){return fR()!==void 0||J4()!=null}function zj(o){if(!RR())throw new xt(-203,!1)}function Bj(o){return typeof o=="function"}var _l=0,$n=1,yn=2,Br=3,zs=4,jo=5,Lg=6,Fg=7,Bs=8,Gf=9,Ea=10,Tr=11,Ng=12,kP=13,Kf=14,Vs=15,Hg=16,Ff=17,gl=18,rx=19,kR=20,zc=21,WE=22,xh=23,js=25,OR=1;var bh=7,Vv=8,Hf=9,Vo=10,cC=function(o){return o[o.None=0]="None",o[o.HasTransplantedViews=2]="HasTransplantedViews",o}(cC||{});function yh(o){return Array.isArray(o)&&typeof o[OR]=="object"}function yl(o){return Array.isArray(o)&&o[OR]===!0}function uC(o){return(o.flags&4)!==0}function ox(o){return o.componentOffset>-1}function sx(o){return(o.flags&1)===1}function Qf(o){return!!o.template}function Vj(o){return(o[yn]&512)!==0}var fT=class{constructor(n,l,c){this.previousValue=n,this.currentValue=l,this.firstChange=c}isFirstChange(){return this.firstChange}};function LR(o,n,l,c){n!==null?n.applyValueToInputSignal(n,c):o[l]=c}function Mh(){return FR}function FR(o){return o.type.prototype.ngOnChanges&&(o.setInput=Uj),jj}Mh.ngInherit=!0;function jj(){let o=zR(this),n=o?.current;if(n){let l=o.previous;if(l===kg)o.previous=n;else for(let c in n)l[c]=n[c];o.current=null,this.ngOnChanges(n)}}function Uj(o,n,l,c,f){let r=this.declaredInputs[c],w=zR(o)||$j(o,{previous:kg,current:null}),I=w.current||(w.current={}),A=w.previous,L=A[r];I[r]=new fT(L&&L.currentValue,l,A===kg),LR(o,n,f,l)}var NR="__ngSimpleChanges__";function zR(o){return o[NR]||null}function $j(o,n){return o[NR]=n}var OP=null;var xa=function(o,n,l){OP?.(o,n,l)},BR="svg",Gj="math",Hj=!1;function qj(){return Hj}function Ta(o){for(;Array.isArray(o);)o=o[_l];return o}function VR(o,n){return Ta(n[o])}function $s(o,n){return Ta(n[o.index])}function jR(o,n){return o.data[n]}function Wj(o,n){return o[n]}function Gc(o,n){let l=n[o];return yh(l)?l:l[_l]}function Zj(o){return(o[yn]&4)===4}function hC(o){return(o[yn]&128)===128}function Yj(o){return yl(o[Br])}function qf(o,n){return n==null?null:o[n]}function UR(o){o[Ff]=0}function Xj(o){o[yn]&1024||(o[yn]|=1024,hC(o)&&zg(o))}function Kj(o,n){for(;o>0;)n=n[Kf],o--;return n}function dC(o){return!!(o[yn]&9216||o[xh]?.dirty)}function pT(o){o[Ea].changeDetectionScheduler?.notify(1),dC(o)?zg(o):o[yn]&64&&(qj()?(o[yn]|=1024,zg(o)):o[Ea].changeDetectionScheduler?.notify())}function zg(o){o[Ea].changeDetectionScheduler?.notify();let n=Bg(o);for(;n!==null&&!(n[yn]&8192||(n[yn]|=8192,!hC(n)));)n=Bg(n)}function $R(o,n){if((o[yn]&256)===256)throw new xt(911,!1);o[zc]===null&&(o[zc]=[]),o[zc].push(n)}function Qj(o,n){if(o[zc]===null)return;let l=o[zc].indexOf(n);l!==-1&&o[zc].splice(l,1)}function Bg(o){let n=o[Br];return yl(n)?n[Br]:n}var Fn={lFrame:QR(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Jj(){return Fn.lFrame.elementDepthCount}function eU(){Fn.lFrame.elementDepthCount++}function tU(){Fn.lFrame.elementDepthCount--}function GR(){return Fn.bindingsEnabled}function HR(){return Fn.skipHydrationRootTNode!==null}function nU(o){return Fn.skipHydrationRootTNode===o}function iU(){Fn.skipHydrationRootTNode=null}function xi(){return Fn.lFrame.lView}function Kr(){return Fn.lFrame.tView}function Ah(o){return Fn.lFrame.contextLView=o,o[Bs]}function Ph(o){return Fn.lFrame.contextLView=null,o}function Co(){let o=qR();for(;o!==null&&o.type===64;)o=o.parent;return o}function qR(){return Fn.lFrame.currentTNode}function rU(){let o=Fn.lFrame,n=o.currentTNode;return o.isParent?n:n.parent}function Rh(o,n){let l=Fn.lFrame;l.currentTNode=o,l.isParent=n}function fC(){return Fn.lFrame.isParent}function pC(){Fn.lFrame.isParent=!1}function oU(){return Fn.lFrame.contextLView}function sU(){let o=Fn.lFrame,n=o.bindingRootIndex;return n===-1&&(n=o.bindingRootIndex=o.tView.bindingStartIndex),n}function aU(){return Fn.lFrame.bindingIndex}function lU(o){return Fn.lFrame.bindingIndex=o}function WR(){return Fn.lFrame.bindingIndex++}function ZR(o){let n=Fn.lFrame,l=n.bindingIndex;return n.bindingIndex=n.bindingIndex+o,l}function cU(){return Fn.lFrame.inI18n}function uU(o,n){let l=Fn.lFrame;l.bindingIndex=l.bindingRootIndex=o,mT(n)}function hU(){return Fn.lFrame.currentDirectiveIndex}function mT(o){Fn.lFrame.currentDirectiveIndex=o}function dU(o){let n=Fn.lFrame.currentDirectiveIndex;return n===-1?null:o[n]}function YR(){return Fn.lFrame.currentQueryIndex}function mC(o){Fn.lFrame.currentQueryIndex=o}function fU(o){let n=o[$n];return n.type===2?n.declTNode:n.type===1?o[jo]:null}function XR(o,n,l){if(l&qn.SkipSelf){let f=n,r=o;for(;f=f.parent,f===null&&!(l&qn.Host);)if(f=fU(r),f===null||(r=r[Kf],f.type&10))break;if(f===null)return!1;n=f,o=r}let c=Fn.lFrame=KR();return c.currentTNode=n,c.lView=o,!0}function gC(o){let n=KR(),l=o[$n];Fn.lFrame=n,n.currentTNode=l.firstChild,n.lView=o,n.tView=l,n.contextLView=o,n.bindingIndex=l.bindingStartIndex,n.inI18n=!1}function KR(){let o=Fn.lFrame,n=o===null?null:o.child;return n===null?QR(o):n}function QR(o){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:o,child:null,inI18n:!1};return o!==null&&(o.child=n),n}function JR(){let o=Fn.lFrame;return Fn.lFrame=o.parent,o.currentTNode=null,o.lView=null,o}var ek=JR;function _C(){let o=JR();o.isParent=!0,o.tView=null,o.selectedIndex=-1,o.contextLView=null,o.elementDepthCount=0,o.currentDirectiveIndex=-1,o.currentNamespace=null,o.bindingRootIndex=-1,o.bindingIndex=-1,o.currentQueryIndex=0}function pU(o){return(Fn.lFrame.contextLView=Kj(o,Fn.lFrame.contextLView))[Bs]}function kh(){return Fn.lFrame.selectedIndex}function wh(o){Fn.lFrame.selectedIndex=o}function tk(){let o=Fn.lFrame;return jR(o.tView,o.selectedIndex)}function nk(){Fn.lFrame.currentNamespace=BR}function mU(){return Fn.lFrame.currentNamespace}var ik=!0;function ax(){return ik}function lx(o){ik=o}function gU(o,n,l){let{ngOnChanges:c,ngOnInit:f,ngDoCheck:r}=n.type.prototype;if(c){let w=FR(n);(l.preOrderHooks??=[]).push(o,w),(l.preOrderCheckHooks??=[]).push(o,w)}f&&(l.preOrderHooks??=[]).push(0-o,f),r&&((l.preOrderHooks??=[]).push(o,r),(l.preOrderCheckHooks??=[]).push(o,r))}function cx(o,n){for(let l=n.directiveStart,c=n.directiveEnd;l<c;l++){let r=o.data[l].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:I,ngAfterViewInit:A,ngAfterViewChecked:L,ngOnDestroy:U}=r;w&&(o.contentHooks??=[]).push(-l,w),I&&((o.contentHooks??=[]).push(l,I),(o.contentCheckHooks??=[]).push(l,I)),A&&(o.viewHooks??=[]).push(-l,A),L&&((o.viewHooks??=[]).push(l,L),(o.viewCheckHooks??=[]).push(l,L)),U!=null&&(o.destroyHooks??=[]).push(l,U)}}function Pv(o,n,l){rk(o,n,3,l)}function Rv(o,n,l,c){(o[yn]&3)===l&&rk(o,n,l,c)}function ZE(o,n){let l=o[yn];(l&3)===n&&(l&=16383,l+=1,o[yn]=l)}function rk(o,n,l,c){let f=c!==void 0?o[Ff]&65535:0,r=c??-1,w=n.length-1,I=0;for(let A=f;A<w;A++)if(typeof n[A+1]=="number"){if(I=n[A],c!=null&&I>=c)break}else n[A]<0&&(o[Ff]+=65536),(I<r||r==-1)&&(_U(o,l,n,A),o[Ff]=(o[Ff]&4294901760)+A+2),A++}function LP(o,n){xa(4,o,n);let l=di(null);try{n.call(o)}finally{di(l),xa(5,o,n)}}function _U(o,n,l,c){let f=l[c]<0,r=l[c+1],w=f?-l[c]:l[c],I=o[w];f?o[yn]>>14<o[Ff]>>16&&(o[yn]&3)===n&&(o[yn]+=16384,LP(I,r)):LP(I,r)}var Vf=-1,Eh=class{constructor(n,l,c){this.factory=n,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=c}};function yU(o){return o instanceof Eh}function vU(o){return(o.flags&8)!==0}function xU(o){return(o.flags&16)!==0}function ok(o){return o!==Vf}function jv(o){return o&32767}function bU(o){return o>>16}function Uv(o,n){let l=bU(o),c=n;for(;l>0;)c=c[Kf],l--;return c}var gT=!0;function FP(o){let n=gT;return gT=o,n}var wU=256,sk=wU-1,ak=5,EU=0,ba={};function TU(o,n,l){let c;typeof l=="string"?c=l.charCodeAt(0)||0:l.hasOwnProperty(Ag)&&(c=l[Ag]),c==null&&(c=l[Ag]=EU++);let f=c&sk,r=1<<f;n.data[o+(f>>ak)]|=r}function $v(o,n){let l=lk(o,n);if(l!==-1)return l;let c=n[$n];c.firstCreatePass&&(o.injectorIndex=n.length,YE(c.data,o),YE(n,null),YE(c.blueprint,null));let f=yC(o,n),r=o.injectorIndex;if(ok(f)){let w=jv(f),I=Uv(f,n),A=I[$n].data;for(let L=0;L<8;L++)n[r+L]=I[w+L]|A[w+L]}return n[r+8]=f,r}function YE(o,n){o.push(0,0,0,0,0,0,0,0,n)}function lk(o,n){return o.injectorIndex===-1||o.parent&&o.parent.injectorIndex===o.injectorIndex||n[o.injectorIndex+8]===null?-1:o.injectorIndex}function yC(o,n){if(o.parent&&o.parent.injectorIndex!==-1)return o.parent.injectorIndex;let l=0,c=null,f=n;for(;f!==null;){if(c=fk(f),c===null)return Vf;if(l++,f=f[Kf],c.injectorIndex!==-1)return c.injectorIndex|l<<16}return Vf}function _T(o,n,l){TU(o,n,l)}function ck(o,n,l){if(l&qn.Optional||o!==void 0)return o;iC(n,"NodeInjector")}function uk(o,n,l,c){if(l&qn.Optional&&c===void 0&&(c=null),!(l&(qn.Self|qn.Host))){let f=o[Gf],r=ls(void 0);try{return f?f.get(n,c,l&qn.Optional):pR(n,c,l&qn.Optional)}finally{ls(r)}}return ck(c,n,l)}function hk(o,n,l,c=qn.Default,f){if(o!==null){if(n[yn]&2048&&!(c&qn.Self)){let w=SU(o,n,l,c,ba);if(w!==ba)return w}let r=dk(o,n,l,c,ba);if(r!==ba)return r}return uk(n,l,c,f)}function dk(o,n,l,c,f){let r=IU(l);if(typeof r=="function"){if(!XR(n,o,c))return c&qn.Host?ck(f,l,c):uk(n,l,c,f);try{let w;if(w=r(c),w==null&&!(c&qn.Optional))iC(l);else return w}finally{ek()}}else if(typeof r=="number"){let w=null,I=lk(o,n),A=Vf,L=c&qn.Host?n[Vs][jo]:null;for((I===-1||c&qn.SkipSelf)&&(A=I===-1?yC(o,n):n[I+8],A===Vf||!zP(c,!1)?I=-1:(w=n[$n],I=jv(A),n=Uv(A,n)));I!==-1;){let U=n[$n];if(NP(r,I,U.data)){let Q=CU(I,n,l,w,c,L);if(Q!==ba)return Q}A=n[I+8],A!==Vf&&zP(c,n[$n].data[I+8]===L)&&NP(r,I,n)?(w=U,I=jv(A),n=Uv(A,n)):I=-1}}return f}function CU(o,n,l,c,f,r){let w=n[$n],I=w.data[o+8],A=c==null?ox(I)&&gT:c!=w&&(I.type&3)!==0,L=f&qn.Host&&r===I,U=kv(I,w,l,A,L);return U!==null?Th(n,w,U,I):ba}function kv(o,n,l,c,f){let r=o.providerIndexes,w=n.data,I=r&1048575,A=o.directiveStart,L=o.directiveEnd,U=r>>20,Q=c?I:I+U,fe=f?I+U:L;for(let he=Q;he<fe;he++){let be=w[he];if(he<A&&l===be||he>=A&&be.type===l)return he}if(f){let he=w[A];if(he&&Qf(he)&&he.type===l)return A}return null}function Th(o,n,l,c){let f=o[l],r=n.data;if(yU(f)){let w=f;w.resolving&&Z4(W4(r[l]));let I=FP(w.canSeeViewProviders);w.resolving=!0;let A,L=w.injectImpl?ls(w.injectImpl):null,U=XR(o,c,qn.Default);try{f=o[l]=w.factory(void 0,r,o,c),n.firstCreatePass&&l>=c.directiveStart&&gU(l,r[l],n)}finally{L!==null&&ls(L),FP(I),w.resolving=!1,ek()}}return f}function IU(o){if(typeof o=="string")return o.charCodeAt(0)||0;let n=o.hasOwnProperty(Ag)?o[Ag]:void 0;return typeof n=="number"?n>=0?n&sk:DU:n}function NP(o,n,l){let c=1<<o;return!!(l[n+(o>>ak)]&c)}function zP(o,n){return!(o&qn.Self)&&!(o&qn.Host&&n)}var vh=class{constructor(n,l){this._tNode=n,this._lView=l}get(n,l,c){return hk(this._tNode,this._lView,n,nx(c),l)}};function DU(){return new vh(Co(),xi())}function ux(o){return Ug(()=>{let n=o.prototype.constructor,l=n[Fv]||yT(n),c=Object.prototype,f=Object.getPrototypeOf(o.prototype).constructor;for(;f&&f!==c;){let r=f[Fv]||yT(f);if(r&&r!==l)return r;f=Object.getPrototypeOf(f)}return r=>new r})}function yT(o){return lR(o)?()=>{let n=yT(ro(o));return n&&n()}:jf(o)}function SU(o,n,l,c,f){let r=o,w=n;for(;r!==null&&w!==null&&w[yn]&2048&&!(w[yn]&512);){let I=dk(r,w,l,c|qn.Self,ba);if(I!==ba)return I;let A=r.parent;if(!A){let L=w[kR];if(L){let U=L.get(l,ba,c);if(U!==ba)return U}A=fk(w),w=w[Kf]}r=A}return f}function fk(o){let n=o[$n],l=n.type;return l===2?n.declTNode:l===1?o[jo]:null}function BP(o,n=null,l=null,c){let f=pk(o,n,l,c);return f.resolveInjectorInitializers(),f}function pk(o,n=null,l=null,c,f=new Set){let r=[l||Ns,Dj(o)];return c=c||(typeof o=="object"?void 0:oo(o)),new Og(r,n||lC(),c||null,f)}var vl=(()=>{let n=class n{static create(c,f){if(Array.isArray(c))return BP({name:""},f,c,"");{let r=c.name??"";return BP({name:r},c.parent,c.providers,r)}}};n.THROW_IF_NOT_FOUND=Rg,n.NULL=new Bv,n.\u0275prov=At({token:n,providedIn:"any",factory:()=>Ut(_R)}),n.__NG_ELEMENT_ID__=-1;let o=n;return o})();var MU="ngOriginalError";function XE(o){return o[MU]}var Ca=class{constructor(){this._console=console}handleError(n){let l=this._findOriginalError(n);this._console.error("ERROR",n),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(n){let l=n&&XE(n);for(;l&&XE(l);)l=XE(l);return l||null}},mk=new an("",{providedIn:"root",factory:()=>bt(Ca).handleError.bind(void 0)}),vC=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=AU,n.__NG_ENV_ID__=c=>c;let o=n;return o})(),vT=class extends vC{constructor(n){super(),this._lView=n}onDestroy(n){return $R(this._lView,n),()=>Qj(this._lView,n)}};function AU(){return new vT(xi())}function PU(){return Jf(Co(),xi())}function Jf(o,n){return new Vr($s(o,n))}var Vr=(()=>{let n=class n{constructor(c){this.nativeElement=c}};n.__NG_ELEMENT_ID__=PU;let o=n;return o})();function RU(o){return o instanceof Vr?o.nativeElement:o}var xT=class extends br{constructor(n=!1){super(),this.destroyRef=void 0,this.__isAsync=n,RR()&&(this.destroyRef=bt(vC,{optional:!0})??void 0)}emit(n){let l=di(null);try{super.next(n)}finally{di(l)}}subscribe(n,l,c){let f=n,r=l||(()=>null),w=c;if(n&&typeof n=="object"){let A=n;f=A.next?.bind(A),r=A.error?.bind(A),w=A.complete?.bind(A)}this.__isAsync&&(r=KE(r),f&&(f=KE(f)),w&&(w=KE(w)));let I=super.subscribe({next:f,error:r,complete:w});return n instanceof Qi&&n.add(I),I}};function KE(o){return n=>{setTimeout(o,void 0,n)}}var zr=xT;function kU(){return this._results[Symbol.iterator]()}var Gv=class o{get changes(){return this._changes??=new zr}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let l=o.prototype;l[Symbol.iterator]||(l[Symbol.iterator]=kU)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,l){return this._results.reduce(n,l)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,l){this.dirty=!1;let c=oj(n);(this._changesDetected=!rj(this._results,c,l))&&(this._results=c,this.length=c.length,this.last=c[this.length-1],this.first=c[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function gk(o){return(o.flags&128)===128}var _k=new Map,OU=0;function LU(){return OU++}function FU(o){_k.set(o[rx],o)}function NU(o){_k.delete(o[rx])}var VP="__ngContext__";function Vc(o,n){yh(n)?(o[VP]=n[rx],FU(n)):o[VP]=n}function yk(o){return xk(o[Ng])}function vk(o){return xk(o[zs])}function xk(o){for(;o!==null&&!yl(o);)o=o[zs];return o}var bT;function bk(o){bT=o}function zU(){if(bT!==void 0)return bT;if(typeof document<"u")return document;throw new xt(210,!1)}var hx=new an("",{providedIn:"root",factory:()=>BU}),BU="ng",xC=new an(""),Gs=new an("",{providedIn:"platform",factory:()=>"unknown"});var dx=new an(""),qg=new an("",{providedIn:"root",factory:()=>zU().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var VU="h",jU="b";var UU=()=>null;function bC(o,n,l=!1){return UU(o,n,l)}var wk=!1,$U=new an("",{providedIn:"root",factory:()=>wk});var wT=class{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${z4})`}};function wC(o){return o instanceof wT?o.changingThisBreaksApplicationSecurity:o}var GU=/^>|^->|<!--|-->|--!>|<!-$/g,HU=/(<|>)/g,qU="\u200B$1\u200B";function WU(o){return o.replace(GU,n=>n.replace(HU,qU))}function Ek(o){return o instanceof Function?o():o}function ZU(o){return(o??bt(vl)).get(Gs)==="browser"}var Ia=function(o){return o[o.Important=1]="Important",o[o.DashCase=2]="DashCase",o}(Ia||{}),YU;function EC(o,n){return YU(o,n)}function Nf(o,n,l,c,f){if(c!=null){let r,w=!1;yl(c)?r=c:yh(c)&&(w=!0,c=c[_l]);let I=Ta(c);o===0&&l!==null?f==null?Mk(n,l,I):Hv(n,l,I,f||null,!0):o===1&&l!==null?Hv(n,l,I,f||null,!0):o===2?h6(n,I,w):o===3&&n.destroyNode(I),r!=null&&f6(n,o,r,l,f)}}function XU(o,n){return o.createText(n)}function KU(o,n,l){o.setValue(n,l)}function QU(o,n){return o.createComment(WU(n))}function Tk(o,n,l){return o.createElement(n,l)}function JU(o,n){Ck(o,n),n[_l]=null,n[jo]=null}function e6(o,n,l,c,f,r){c[_l]=f,c[jo]=n,px(o,c,l,1,f,r)}function Ck(o,n){n[Ea].changeDetectionScheduler?.notify(1),px(o,n,n[Tr],2,null,null)}function t6(o){let n=o[Ng];if(!n)return QE(o[$n],o);for(;n;){let l=null;if(yh(n))l=n[Ng];else{let c=n[Vo];c&&(l=c)}if(!l){for(;n&&!n[zs]&&n!==o;)yh(n)&&QE(n[$n],n),n=n[Br];n===null&&(n=o),yh(n)&&QE(n[$n],n),l=n&&n[zs]}n=l}}function n6(o,n,l,c){let f=Vo+c,r=l.length;c>0&&(l[f-1][zs]=n),c<r-Vo?(n[zs]=l[f],gR(l,Vo+c,n)):(l.push(n),n[zs]=null),n[Br]=l;let w=n[Hg];w!==null&&l!==w&&i6(w,n);let I=n[gl];I!==null&&I.insertView(o),pT(n),n[yn]|=128}function i6(o,n){let l=o[Hf],f=n[Br][Br][Vs];n[Vs]!==f&&(o[yn]|=cC.HasTransplantedViews),l===null?o[Hf]=[n]:l.push(n)}function Ik(o,n){let l=o[Hf],c=l.indexOf(n);l.splice(c,1)}function ET(o,n){if(o.length<=Vo)return;let l=Vo+n,c=o[l];if(c){let f=c[Hg];f!==null&&f!==o&&Ik(f,c),n>0&&(o[l-1][zs]=c[zs]);let r=zv(o,Vo+n);JU(c[$n],c);let w=r[gl];w!==null&&w.detachView(r[$n]),c[Br]=null,c[zs]=null,c[yn]&=-129}return c}function Dk(o,n){if(!(n[yn]&256)){let l=n[Tr];l.destroyNode&&px(o,n,l,3,null,null),t6(n)}}function QE(o,n){if(n[yn]&256)return;let l=di(null);try{n[yn]&=-129,n[yn]|=256,n[xh]&&q2(n[xh]),o6(o,n),r6(o,n),n[$n].type===1&&n[Tr].destroy();let c=n[Hg];if(c!==null&&yl(n[Br])){c!==n[Br]&&Ik(c,n);let f=n[gl];f!==null&&f.detachView(o)}NU(n)}finally{di(l)}}function r6(o,n){let l=o.cleanup,c=n[Fg];if(l!==null)for(let r=0;r<l.length-1;r+=2)if(typeof l[r]=="string"){let w=l[r+3];w>=0?c[w]():c[-w].unsubscribe(),r+=2}else{let w=c[l[r+1]];l[r].call(w)}c!==null&&(n[Fg]=null);let f=n[zc];if(f!==null){n[zc]=null;for(let r=0;r<f.length;r++){let w=f[r];w()}}}function o6(o,n){let l;if(o!=null&&(l=o.destroyHooks)!=null)for(let c=0;c<l.length;c+=2){let f=n[l[c]];if(!(f instanceof Eh)){let r=l[c+1];if(Array.isArray(r))for(let w=0;w<r.length;w+=2){let I=f[r[w]],A=r[w+1];xa(4,I,A);try{A.call(I)}finally{xa(5,I,A)}}else{xa(4,f,r);try{r.call(f)}finally{xa(5,f,r)}}}}}function Sk(o,n,l){return s6(o,n.parent,l)}function s6(o,n,l){let c=n;for(;c!==null&&c.type&40;)n=c,c=n.parent;if(c===null)return l[_l];{let{componentOffset:f}=c;if(f>-1){let{encapsulation:r}=o.data[c.directiveStart+f];if(r===wa.None||r===wa.Emulated)return null}return $s(c,l)}}function Hv(o,n,l,c,f){o.insertBefore(n,l,c,f)}function Mk(o,n,l){o.appendChild(n,l)}function jP(o,n,l,c,f){c!==null?Hv(o,n,l,c,f):Mk(o,n,l)}function a6(o,n,l,c){o.removeChild(n,l,c)}function TC(o,n){return o.parentNode(n)}function l6(o,n){return o.nextSibling(n)}function Ak(o,n,l){return u6(o,n,l)}function c6(o,n,l){return o.type&40?$s(o,l):null}var u6=c6,UP;function fx(o,n,l,c){let f=Sk(o,c,n),r=n[Tr],w=c.parent||n[jo],I=Ak(w,c,n);if(f!=null)if(Array.isArray(l))for(let A=0;A<l.length;A++)jP(r,f,l[A],I,!1);else jP(r,f,l,I,!1);UP!==void 0&&UP(r,c,n,l,f)}function Ov(o,n){if(n!==null){let l=n.type;if(l&3)return $s(n,o);if(l&4)return TT(-1,o[n.index]);if(l&8){let c=n.child;if(c!==null)return Ov(o,c);{let f=o[n.index];return yl(f)?TT(-1,f):Ta(f)}}else{if(l&32)return EC(n,o)()||Ta(o[n.index]);{let c=Pk(o,n);if(c!==null){if(Array.isArray(c))return c[0];let f=Bg(o[Vs]);return Ov(f,c)}else return Ov(o,n.next)}}}return null}function Pk(o,n){if(n!==null){let c=o[Vs][jo],f=n.projection;return c.projection[f]}return null}function TT(o,n){let l=Vo+o+1;if(l<n.length){let c=n[l],f=c[$n].firstChild;if(f!==null)return Ov(c,f)}return n[bh]}function h6(o,n,l){let c=TC(o,n);c&&a6(o,c,n,l)}function CC(o,n,l,c,f,r,w){for(;l!=null;){let I=c[l.index],A=l.type;if(w&&n===0&&(I&&Vc(Ta(I),c),l.flags|=2),(l.flags&32)!==32)if(A&8)CC(o,n,l.child,c,f,r,!1),Nf(n,o,f,I,r);else if(A&32){let L=EC(l,c),U;for(;U=L();)Nf(n,o,f,U,r);Nf(n,o,f,I,r)}else A&16?Rk(o,n,c,l,f,r):Nf(n,o,f,I,r);l=w?l.projectionNext:l.next}}function px(o,n,l,c,f,r){CC(l,c,o.firstChild,n,f,r,!1)}function d6(o,n,l){let c=n[Tr],f=Sk(o,l,n),r=l.parent||n[jo],w=Ak(r,l,n);Rk(c,0,n,l,f,w)}function Rk(o,n,l,c,f,r){let w=l[Vs],A=w[jo].projection[c.projection];if(Array.isArray(A))for(let L=0;L<A.length;L++){let U=A[L];Nf(n,o,f,U,r)}else{let L=A,U=w[Br];gk(c)&&(L.flags|=128),CC(o,n,L,U,f,r,!0)}}function f6(o,n,l,c,f){let r=l[bh],w=Ta(l);r!==w&&Nf(n,o,c,r,f);for(let I=Vo;I<l.length;I++){let A=l[I];px(A[$n],A,o,n,c,r)}}function p6(o,n,l,c,f){if(n)f?o.addClass(l,c):o.removeClass(l,c);else{let r=c.indexOf("-")===-1?void 0:Ia.DashCase;f==null?o.removeStyle(l,c,r):(typeof f=="string"&&f.endsWith("!important")&&(f=f.slice(0,-10),r|=Ia.Important),o.setStyle(l,c,f,r))}}function m6(o,n,l){o.setAttribute(n,"style",l)}function kk(o,n,l){l===""?o.removeAttribute(n,"class"):o.setAttribute(n,"class",l)}function Ok(o,n,l){let{mergedAttrs:c,classes:f,styles:r}=l;c!==null&&cT(o,n,c),f!==null&&kk(o,n,f),r!==null&&m6(o,n,r)}var Da={};function Bn(o=1){Lk(Kr(),xi(),kh()+o,!1)}function Lk(o,n,l,c){if(!c)if((n[yn]&3)===3){let r=o.preOrderCheckHooks;r!==null&&Pv(n,r,l)}else{let r=o.preOrderHooks;r!==null&&Rv(n,r,0,l)}wh(l)}function Qn(o,n=qn.Default){let l=xi();if(l===null)return Ut(o,n);let c=Co();return hk(c,l,ro(o),n)}function Fk(o,n,l,c,f,r){let w=di(null);try{let I=null;f&Eo.SignalBased&&(I=n[c][U2]),I!==null&&I.transformFn!==void 0&&(r=I.transformFn(r)),f&Eo.HasDecoratorInputTransform&&(r=o.inputTransforms[c].call(n,r)),o.setInput!==null?o.setInput(n,I,r,l,c):LR(n,I,c,r)}finally{di(w)}}function g6(o,n){let l=o.hostBindingOpCodes;if(l!==null)try{for(let c=0;c<l.length;c++){let f=l[c];if(f<0)wh(~f);else{let r=f,w=l[++c],I=l[++c];uU(w,r);let A=n[r];I(2,A)}}}finally{wh(-1)}}function mx(o,n,l,c,f,r,w,I,A,L,U){let Q=n.blueprint.slice();return Q[_l]=f,Q[yn]=c|4|128|8|64,(L!==null||o&&o[yn]&2048)&&(Q[yn]|=2048),UR(Q),Q[Br]=Q[Kf]=o,Q[Bs]=l,Q[Ea]=w||o&&o[Ea],Q[Tr]=I||o&&o[Tr],Q[Gf]=A||o&&o[Gf]||null,Q[jo]=r,Q[rx]=LU(),Q[Lg]=U,Q[kR]=L,Q[Vs]=n.type==2?o[Vs]:Q,Q}function ep(o,n,l,c,f){let r=o.data[n];if(r===null)r=_6(o,n,l,c,f),cU()&&(r.flags|=32);else if(r.type&64){r.type=l,r.value=c,r.attrs=f;let w=rU();r.injectorIndex=w===null?-1:w.injectorIndex}return Rh(r,!0),r}function _6(o,n,l,c,f){let r=qR(),w=fC(),I=w?r:r&&r.parent,A=o.data[n]=E6(o,I,l,n,c,f);return o.firstChild===null&&(o.firstChild=A),r!==null&&(w?r.child==null&&A.parent!==null&&(r.child=A):r.next===null&&(r.next=A,A.prev=r)),A}function Nk(o,n,l,c){if(l===0)return-1;let f=n.length;for(let r=0;r<l;r++)n.push(c),o.blueprint.push(c),o.data.push(null);return f}function zk(o,n,l,c,f){let r=kh(),w=c&2;try{wh(-1),w&&n.length>js&&Lk(o,n,js,!1),xa(w?2:0,f),l(c,f)}finally{wh(r),xa(w?3:1,f)}}function IC(o,n,l){if(uC(n)){let c=di(null);try{let f=n.directiveStart,r=n.directiveEnd;for(let w=f;w<r;w++){let I=o.data[w];if(I.contentQueries){let A=l[w];I.contentQueries(1,A,w)}}}finally{di(c)}}}function DC(o,n,l){GR()&&(M6(o,n,l,$s(l,n)),(l.flags&64)===64&&Uk(o,n,l))}function SC(o,n,l=$s){let c=n.localNames;if(c!==null){let f=n.index+1;for(let r=0;r<c.length;r+=2){let w=c[r+1],I=w===-1?l(n,o):o[w];o[f++]=I}}}function Bk(o){let n=o.tView;return n===null||n.incompleteFirstPass?o.tView=MC(1,null,o.template,o.decls,o.vars,o.directiveDefs,o.pipeDefs,o.viewQuery,o.schemas,o.consts,o.id):n}function MC(o,n,l,c,f,r,w,I,A,L,U){let Q=js+c,fe=Q+f,he=y6(Q,fe),be=typeof L=="function"?L():L;return he[$n]={type:o,blueprint:he,template:l,queries:null,viewQuery:I,declTNode:n,data:he.slice().fill(null,Q),bindingStartIndex:Q,expandoStartIndex:fe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof w=="function"?w():w,firstChild:null,schemas:A,consts:be,incompleteFirstPass:!1,ssrId:U}}function y6(o,n){let l=[];for(let c=0;c<n;c++)l.push(c<o?null:Da);return l}function v6(o,n,l,c){let r=c.get($U,wk)||l===wa.ShadowDom,w=o.selectRootElement(n,r);return x6(w),w}function x6(o){b6(o)}var b6=()=>null;function w6(o,n,l,c){let f=Hk(n);f.push(l),o.firstCreatePass&&qk(o).push(c,f.length-1)}function E6(o,n,l,c,f,r){let w=n?n.injectorIndex:-1,I=0;return HR()&&(I|=128),{type:l,index:c,insertBeforeIndex:null,injectorIndex:w,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:I,providerIndexes:0,value:f,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function $P(o,n,l,c,f){for(let r in n){if(!n.hasOwnProperty(r))continue;let w=n[r];if(w===void 0)continue;c??={};let I,A=Eo.None;Array.isArray(w)?(I=w[0],A=w[1]):I=w;let L=r;if(f!==null){if(!f.hasOwnProperty(r))continue;L=f[r]}o===0?GP(c,l,L,I,A):GP(c,l,L,I)}return c}function GP(o,n,l,c,f){let r;o.hasOwnProperty(l)?(r=o[l]).push(n,c):r=o[l]=[n,c],f!==void 0&&r.push(f)}function T6(o,n,l){let c=n.directiveStart,f=n.directiveEnd,r=o.data,w=n.attrs,I=[],A=null,L=null;for(let U=c;U<f;U++){let Q=r[U],fe=l?l.get(Q):null,he=fe?fe.inputs:null,be=fe?fe.outputs:null;A=$P(0,Q.inputs,U,A,he),L=$P(1,Q.outputs,U,L,be);let De=A!==null&&w!==null&&!sC(n)?z6(A,U,w):null;I.push(De)}A!==null&&(A.hasOwnProperty("class")&&(n.flags|=8),A.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=I,n.inputs=A,n.outputs=L}function C6(o){return o==="class"?"className":o==="for"?"htmlFor":o==="formaction"?"formAction":o==="innerHtml"?"innerHTML":o==="readonly"?"readOnly":o==="tabindex"?"tabIndex":o}function Vk(o,n,l,c,f,r,w,I){let A=$s(n,l),L=n.inputs,U;!I&&L!=null&&(U=L[c])?(PC(o,l,U,c,f),ox(n)&&I6(l,n.index)):n.type&3?(c=C6(c),f=w!=null?w(f,n.value||"",c):f,r.setProperty(A,c,f)):n.type&12}function I6(o,n){let l=Gc(n,o);l[yn]&16||(l[yn]|=64)}function AC(o,n,l,c){if(GR()){let f=c===null?null:{"":-1},r=P6(o,l),w,I;r===null?w=I=null:[w,I]=r,w!==null&&jk(o,n,l,w,f,I),f&&R6(l,c,f)}l.mergedAttrs=oC(l.mergedAttrs,l.attrs)}function jk(o,n,l,c,f,r){for(let L=0;L<c.length;L++)_T($v(l,n),o,c[L].type);O6(l,o.data.length,c.length);for(let L=0;L<c.length;L++){let U=c[L];U.providersResolver&&U.providersResolver(U)}let w=!1,I=!1,A=Nk(o,n,c.length,null);for(let L=0;L<c.length;L++){let U=c[L];l.mergedAttrs=oC(l.mergedAttrs,U.hostAttrs),L6(o,l,n,A,U),k6(A,U,f),U.contentQueries!==null&&(l.flags|=4),(U.hostBindings!==null||U.hostAttrs!==null||U.hostVars!==0)&&(l.flags|=64);let Q=U.type.prototype;!w&&(Q.ngOnChanges||Q.ngOnInit||Q.ngDoCheck)&&((o.preOrderHooks??=[]).push(l.index),w=!0),!I&&(Q.ngOnChanges||Q.ngDoCheck)&&((o.preOrderCheckHooks??=[]).push(l.index),I=!0),A++}T6(o,l,r)}function D6(o,n,l,c,f){let r=f.hostBindings;if(r){let w=o.hostBindingOpCodes;w===null&&(w=o.hostBindingOpCodes=[]);let I=~n.index;S6(w)!=I&&w.push(I),w.push(l,c,r)}}function S6(o){let n=o.length;for(;n>0;){let l=o[--n];if(typeof l=="number"&&l<0)return l}return 0}function M6(o,n,l,c){let f=l.directiveStart,r=l.directiveEnd;ox(l)&&F6(n,l,o.data[f+l.componentOffset]),o.firstCreatePass||$v(l,n),Vc(c,n);let w=l.initialInputs;for(let I=f;I<r;I++){let A=o.data[I],L=Th(n,o,I,l);if(Vc(L,n),w!==null&&N6(n,I-f,L,A,l,w),Qf(A)){let U=Gc(l.index,n);U[Bs]=Th(n,o,I,l)}}}function Uk(o,n,l){let c=l.directiveStart,f=l.directiveEnd,r=l.index,w=hU();try{wh(r);for(let I=c;I<f;I++){let A=o.data[I],L=n[I];mT(I),(A.hostBindings!==null||A.hostVars!==0||A.hostAttrs!==null)&&A6(A,L)}}finally{wh(-1),mT(w)}}function A6(o,n){o.hostBindings!==null&&o.hostBindings(1,n)}function P6(o,n){let l=o.directiveRegistry,c=null,f=null;if(l)for(let r=0;r<l.length;r++){let w=l[r];if(bR(n,w.selectors,!1))if(c||(c=[]),Qf(w))if(w.findHostDirectiveDefs!==null){let I=[];f=f||new Map,w.findHostDirectiveDefs(w,I,f),c.unshift(...I,w);let A=I.length;CT(o,n,A)}else c.unshift(w),CT(o,n,0);else f=f||new Map,w.findHostDirectiveDefs?.(w,c,f),c.push(w)}return c===null?null:[c,f]}function CT(o,n,l){n.componentOffset=l,(o.components??=[]).push(n.index)}function R6(o,n,l){if(n){let c=o.localNames=[];for(let f=0;f<n.length;f+=2){let r=l[n[f+1]];if(r==null)throw new xt(-301,!1);c.push(n[f],r)}}}function k6(o,n,l){if(l){if(n.exportAs)for(let c=0;c<n.exportAs.length;c++)l[n.exportAs[c]]=o;Qf(n)&&(l[""]=o)}}function O6(o,n,l){o.flags|=1,o.directiveStart=n,o.directiveEnd=n+l,o.providerIndexes=n}function L6(o,n,l,c,f){o.data[c]=f;let r=f.factory||(f.factory=jf(f.type,!0)),w=new Eh(r,Qf(f),Qn);o.blueprint[c]=w,l[c]=w,D6(o,n,c,Nk(o,l,f.hostVars,Da),f)}function F6(o,n,l){let c=$s(n,o),f=Bk(l),r=o[Ea].rendererFactory,w=16;l.signals?w=4096:l.onPush&&(w=64);let I=gx(o,mx(o,f,null,w,c,n,null,r.createRenderer(c,l),null,null,null));o[n.index]=I}function N6(o,n,l,c,f,r){let w=r[n];if(w!==null)for(let I=0;I<w.length;){let A=w[I++],L=w[I++],U=w[I++],Q=w[I++];Fk(c,l,A,L,U,Q)}}function z6(o,n,l){let c=null,f=0;for(;f<l.length;){let r=l[f];if(r===0){f+=4;continue}else if(r===5){f+=2;continue}if(typeof r=="number")break;if(o.hasOwnProperty(r)){c===null&&(c=[]);let w=o[r];for(let I=0;I<w.length;I+=3)if(w[I]===n){c.push(r,w[I+1],w[I+2],l[f+1]);break}}f+=2}return c}function $k(o,n,l,c){return[o,!0,0,n,null,c,null,l,null,null]}function Gk(o,n){let l=o.contentQueries;if(l!==null){let c=di(null);try{for(let f=0;f<l.length;f+=2){let r=l[f],w=l[f+1];if(w!==-1){let I=o.data[w];mC(r),I.contentQueries(2,n[w],w)}}}finally{di(c)}}}function gx(o,n){return o[Ng]?o[kP][zs]=n:o[Ng]=n,o[kP]=n,n}function IT(o,n,l){mC(0);let c=di(null);try{n(o,l)}finally{di(c)}}function Hk(o){return o[Fg]||(o[Fg]=[])}function qk(o){return o.cleanup||(o.cleanup=[])}function Wk(o,n){let l=o[Gf],c=l?l.get(Ca,null):null;c&&c.handleError(n)}function PC(o,n,l,c,f){for(let r=0;r<l.length;){let w=l[r++],I=l[r++],A=l[r++],L=n[w],U=o.data[w];Fk(U,L,c,I,A,f)}}function Zk(o,n,l){let c=VR(n,o);KU(o[Tr],c,l)}function B6(o,n){let l=Gc(n,o),c=l[$n];V6(c,l);let f=l[_l];f!==null&&l[Lg]===null&&(l[Lg]=bC(f,l[Gf])),RC(c,l,l[Bs])}function V6(o,n){for(let l=n.length;l<o.blueprint.length;l++)n.push(o.blueprint[l])}function RC(o,n,l){gC(n);try{let c=o.viewQuery;c!==null&&IT(1,c,l);let f=o.template;f!==null&&zk(o,n,f,1,l),o.firstCreatePass&&(o.firstCreatePass=!1),n[gl]?.finishViewCreation(o),o.staticContentQueries&&Gk(o,n),o.staticViewQueries&&IT(2,o.viewQuery,l);let r=o.components;r!==null&&j6(n,r)}catch(c){throw o.firstCreatePass&&(o.incompleteFirstPass=!0,o.firstCreatePass=!1),c}finally{n[yn]&=-5,_C()}}function j6(o,n){for(let l=0;l<n.length;l++)B6(o,n[l])}function U6(o,n,l,c){let f=di(null);try{let r=n.tView,I=o[yn]&4096?4096:16,A=mx(o,r,l,I,null,n,null,null,c?.injector??null,c?.embeddedViewInjector??null,c?.dehydratedView??null),L=o[n.index];A[Hg]=L;let U=o[gl];return U!==null&&(A[gl]=U.createEmbeddedView(r)),RC(r,A,l),A}finally{di(f)}}function HP(o,n){return!n||n.firstChild===null||gk(o)}function $6(o,n,l,c=!0){let f=n[$n];if(n6(f,n,o,l),c){let w=TT(l,o),I=n[Tr],A=TC(I,o[bh]);A!==null&&e6(f,o[jo],I,n,A,w)}let r=n[Lg];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function qv(o,n,l,c,f=!1){for(;l!==null;){let r=n[l.index];r!==null&&c.push(Ta(r)),yl(r)&&G6(r,c);let w=l.type;if(w&8)qv(o,n,l.child,c);else if(w&32){let I=EC(l,n),A;for(;A=I();)c.push(A)}else if(w&16){let I=Pk(n,l);if(Array.isArray(I))c.push(...I);else{let A=Bg(n[Vs]);qv(A[$n],A,I,c,!0)}}l=f?l.projectionNext:l.next}return c}function G6(o,n){for(let l=Vo;l<o.length;l++){let c=o[l],f=c[$n].firstChild;f!==null&&qv(c[$n],c,f,n)}o[bh]!==o[_l]&&n.push(o[bh])}var Yk=[];function H6(o){return o[xh]??q6(o)}function q6(o){let n=Yk.pop()??Object.create(Z6);return n.lView=o,n}function W6(o){o.lView[xh]!==o&&(o.lView=null,Yk.push(o))}var Z6=hi(gt({},$2),{consumerIsAlwaysLive:!0,consumerMarkedDirty:o=>{zg(o.lView)},consumerOnSignalRead(){this.lView[xh]=this}}),Xk=100;function Kk(o,n=!0,l=0){let c=o[Ea],f=c.rendererFactory,r=!1;r||f.begin?.();try{Y6(o,l)}catch(w){throw n&&Wk(o,w),w}finally{r||(f.end?.(),c.inlineEffectRunner?.flush())}}function Y6(o,n){DT(o,n);let l=0;for(;dC(o);){if(l===Xk)throw new xt(103,!1);l++,DT(o,1)}}function X6(o,n,l,c){let f=n[yn];if((f&256)===256)return;let r=!1;!r&&n[Ea].inlineEffectRunner?.flush(),gC(n);let w=null,I=null;!r&&K6(o)&&(I=H6(n),w=G2(I));try{UR(n),lU(o.bindingStartIndex),l!==null&&zk(o,n,l,2,c);let A=(f&3)===3;if(!r)if(A){let Q=o.preOrderCheckHooks;Q!==null&&Pv(n,Q,null)}else{let Q=o.preOrderHooks;Q!==null&&Rv(n,Q,0,null),ZE(n,0)}if(Q6(n),Qk(n,0),o.contentQueries!==null&&Gk(o,n),!r)if(A){let Q=o.contentCheckHooks;Q!==null&&Pv(n,Q)}else{let Q=o.contentHooks;Q!==null&&Rv(n,Q,1),ZE(n,1)}g6(o,n);let L=o.components;L!==null&&eO(n,L,0);let U=o.viewQuery;if(U!==null&&IT(2,U,c),!r)if(A){let Q=o.viewCheckHooks;Q!==null&&Pv(n,Q)}else{let Q=o.viewHooks;Q!==null&&Rv(n,Q,2),ZE(n,2)}if(o.firstUpdatePass===!0&&(o.firstUpdatePass=!1),n[WE]){for(let Q of n[WE])Q();n[WE]=null}r||(n[yn]&=-73)}catch(A){throw zg(n),A}finally{I!==null&&(H2(I,w),W6(I)),_C()}}function K6(o){return o.type!==2}function Qk(o,n){for(let l=yk(o);l!==null;l=vk(l))for(let c=Vo;c<l.length;c++){let f=l[c];Jk(f,n)}}function Q6(o){for(let n=yk(o);n!==null;n=vk(n)){if(!(n[yn]&cC.HasTransplantedViews))continue;let l=n[Hf];for(let c=0;c<l.length;c++){let f=l[c],r=f[Br];Xj(f)}}}function J6(o,n,l){let c=Gc(n,o);Jk(c,l)}function Jk(o,n){hC(o)&&DT(o,n)}function DT(o,n){let c=o[$n],f=o[yn],r=o[xh],w=!!(n===0&&f&16);if(w||=!!(f&64&&n===0),w||=!!(f&1024),w||=!!(r?.dirty&&EE(r)),r&&(r.dirty=!1),o[yn]&=-9217,w)X6(c,o,c.template,o[Bs]);else if(f&8192){Qk(o,1);let I=c.components;I!==null&&eO(o,I,1)}}function eO(o,n,l){for(let c=0;c<n.length;c++)J6(o,n[c],l)}function kC(o){for(o[Ea].changeDetectionScheduler?.notify();o;){o[yn]|=64;let n=Bg(o);if(Vj(o)&&!n)return o;o=n}return null}var Ch=class{get rootNodes(){let n=this._lView,l=n[$n];return qv(l,n,l.firstChild,[])}constructor(n,l,c=!0){this._lView=n,this._cdRefInjectingView=l,this.notifyErrorHandler=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Bs]}set context(n){this._lView[Bs]=n}get destroyed(){return(this._lView[yn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Br];if(yl(n)){let l=n[Vv],c=l?l.indexOf(this):-1;c>-1&&(ET(n,c),zv(l,c))}this._attachedToViewContainer=!1}Dk(this._lView[$n],this._lView)}onDestroy(n){$R(this._lView,n)}markForCheck(){kC(this._cdRefInjectingView||this._lView)}detach(){this._lView[yn]&=-129}reattach(){pT(this._lView),this._lView[yn]|=128}detectChanges(){this._lView[yn]|=1024,Kk(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new xt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,Ck(this._lView[$n],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new xt(902,!1);this._appRef=n,pT(this._lView)}},jc=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=n8;let o=n;return o})(),e8=jc,t8=class extends e8{constructor(n,l,c){super(),this._declarationLView=n,this._declarationTContainer=l,this.elementRef=c}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,l){return this.createEmbeddedViewImpl(n,l)}createEmbeddedViewImpl(n,l,c){let f=U6(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:l,dehydratedView:c});return new Ch(f)}};function n8(){return _x(Co(),xi())}function _x(o,n){return o.type&4?new t8(n,o,Jf(o,n)):null}var Mte=new RegExp(`^(\\d+)*(${jU}|${VU})*(.*)`);var i8=()=>null;function qP(o,n){return i8(o,n)}var Wf=class{},ST=class{},Wv=class{};function r8(o){let n=Error(`No component factory found for ${oo(o)}.`);return n[o8]=o,n}var o8="ngComponent";var MT=class{resolveComponentFactory(n){throw r8(n)}},Wg=(()=>{let n=class n{};n.NULL=new MT;let o=n;return o})(),Ih=class{},Oh=(()=>{let n=class n{constructor(){this.destroyNode=null}};n.__NG_ELEMENT_ID__=()=>s8();let o=n;return o})();function s8(){let o=xi(),n=Co(),l=Gc(n.index,o);return(yh(l)?l:o)[Tr]}var a8=(()=>{let n=class n{};n.\u0275prov=At({token:n,providedIn:"root",factory:()=>null});let o=n;return o})(),JE={};var WP=new Set;function tp(o){WP.has(o)||(WP.add(o),performance?.mark?.("mark_feature_usage",{detail:{feature:o}}))}function ZP(...o){}function l8(){let o=typeof Mg.requestAnimationFrame=="function",n=Mg[o?"requestAnimationFrame":"setTimeout"],l=Mg[o?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&l){let c=n[Zone.__symbol__("OriginalDelegate")];c&&(n=c);let f=l[Zone.__symbol__("OriginalDelegate")];f&&(l=f)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:l}}var fi=class o{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new zr(!1),this.onMicrotaskEmpty=new zr(!1),this.onStable=new zr(!1),this.onError=new zr(!1),typeof Zone>"u")throw new xt(908,!1);Zone.assertZonePatched();let f=this;f._nesting=0,f._outer=f._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(f._inner=f._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(f._inner=f._inner.fork(Zone.longStackTraceZoneSpec)),f.shouldCoalesceEventChangeDetection=!c&&l,f.shouldCoalesceRunChangeDetection=c,f.lastRequestAnimationFrameId=-1,f.nativeRequestAnimationFrame=l8().nativeRequestAnimationFrame,h8(f)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!o.isInAngularZone())throw new xt(909,!1)}static assertNotInAngularZone(){if(o.isInAngularZone())throw new xt(909,!1)}run(n,l,c){return this._inner.run(n,l,c)}runTask(n,l,c,f){let r=this._inner,w=r.scheduleEventTask("NgZoneEvent: "+f,n,c8,ZP,ZP);try{return r.runTask(w,l,c)}finally{r.cancelTask(w)}}runGuarded(n,l,c){return this._inner.runGuarded(n,l,c)}runOutsideAngular(n){return this._outer.run(n)}},c8={};function OC(o){if(o._nesting==0&&!o.hasPendingMicrotasks&&!o.isStable)try{o._nesting++,o.onMicrotaskEmpty.emit(null)}finally{if(o._nesting--,!o.hasPendingMicrotasks)try{o.runOutsideAngular(()=>o.onStable.emit(null))}finally{o.isStable=!0}}}function u8(o){o.isCheckStableRunning||o.lastRequestAnimationFrameId!==-1||(o.lastRequestAnimationFrameId=o.nativeRequestAnimationFrame.call(Mg,()=>{o.fakeTopEventTask||(o.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{o.lastRequestAnimationFrameId=-1,AT(o),o.isCheckStableRunning=!0,OC(o),o.isCheckStableRunning=!1},void 0,()=>{},()=>{})),o.fakeTopEventTask.invoke()}),AT(o))}function h8(o){let n=()=>{u8(o)};o._inner=o._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,c,f,r,w,I)=>{if(d8(I))return l.invokeTask(f,r,w,I);try{return YP(o),l.invokeTask(f,r,w,I)}finally{(o.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||o.shouldCoalesceRunChangeDetection)&&n(),XP(o)}},onInvoke:(l,c,f,r,w,I,A)=>{try{return YP(o),l.invoke(f,r,w,I,A)}finally{o.shouldCoalesceRunChangeDetection&&n(),XP(o)}},onHasTask:(l,c,f,r)=>{l.hasTask(f,r),c===f&&(r.change=="microTask"?(o._hasPendingMicrotasks=r.microTask,AT(o),OC(o)):r.change=="macroTask"&&(o.hasPendingMacrotasks=r.macroTask))},onHandleError:(l,c,f,r)=>(l.handleError(f,r),o.runOutsideAngular(()=>o.onError.emit(r)),!1)})}function AT(o){o._hasPendingMicrotasks||(o.shouldCoalesceEventChangeDetection||o.shouldCoalesceRunChangeDetection)&&o.lastRequestAnimationFrameId!==-1?o.hasPendingMicrotasks=!0:o.hasPendingMicrotasks=!1}function YP(o){o._nesting++,o.isStable&&(o.isStable=!1,o.onUnstable.emit(null))}function XP(o){o._nesting--,OC(o)}function d8(o){return!Array.isArray(o)||o.length!==1?!1:o[0].data?.__ignore_ng_zone__===!0}var zf=function(o){return o[o.EarlyRead=0]="EarlyRead",o[o.Write=1]="Write",o[o.MixedReadWrite=2]="MixedReadWrite",o[o.Read=3]="Read",o}(zf||{}),f8={destroy(){}};function yx(o,n){!n&&zj(yx);let l=n?.injector??bt(vl);if(!ZU(l))return f8;tp("NgAfterNextRender");let c=l.get(LC),f=c.handler??=new RT,r=n?.phase??zf.MixedReadWrite,w=()=>{f.unregister(A),I()},I=l.get(vC).onDestroy(w),A=Us(l,()=>new PT(r,()=>{w(),o()}));return f.register(A),{destroy:w}}var PT=class{constructor(n,l){this.phase=n,this.callbackFn=l,this.zone=bt(fi),this.errorHandler=bt(Ca,{optional:!0}),bt(Wf,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(n){this.errorHandler?.handleError(n)}}},RT=class{constructor(){this.executingCallbacks=!1,this.buckets={[zf.EarlyRead]:new Set,[zf.Write]:new Set,[zf.MixedReadWrite]:new Set,[zf.Read]:new Set},this.deferredCallbacks=new Set}register(n){(this.executingCallbacks?this.deferredCallbacks:this.buckets[n.phase]).add(n)}unregister(n){this.buckets[n.phase].delete(n),this.deferredCallbacks.delete(n)}execute(){this.executingCallbacks=!0;for(let n of Object.values(this.buckets))for(let l of n)l.invoke();this.executingCallbacks=!1;for(let n of this.deferredCallbacks)this.buckets[n.phase].add(n);this.deferredCallbacks.clear()}destroy(){for(let n of Object.values(this.buckets))n.clear();this.deferredCallbacks.clear()}},LC=(()=>{let n=class n{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let c=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let f of c)f()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};n.\u0275prov=At({token:n,providedIn:"root",factory:()=>new n});let o=n;return o})();function Zv(o,n,l){let c=l?o.styles:null,f=l?o.classes:null,r=0;if(n!==null)for(let w=0;w<n.length;w++){let I=n[w];if(typeof I=="number")r=I;else if(r==1)f=EP(f,I);else if(r==2){let A=I,L=n[++w];c=EP(c,A+": "+L+";")}}l?o.styles=c:o.stylesWithoutHost=c,l?o.classes=f:o.classesWithoutHost=f}var Yv=class extends Wg{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let l=Bc(n);return new Zf(l,this.ngModule)}};function KP(o){let n=[];for(let l in o){if(!o.hasOwnProperty(l))continue;let c=o[l];c!==void 0&&n.push({propName:Array.isArray(c)?c[0]:c,templateName:l})}return n}function p8(o){let n=o.toLowerCase();return n==="svg"?BR:n==="math"?Gj:null}var kT=class{constructor(n,l){this.injector=n,this.parentInjector=l}get(n,l,c){c=nx(c);let f=this.injector.get(n,JE,c);return f!==JE||l===JE?f:this.parentInjector.get(n,l,c)}},Zf=class extends Wv{get inputs(){let n=this.componentDef,l=n.inputTransforms,c=KP(n.inputs);if(l!==null)for(let f of c)l.hasOwnProperty(f.propName)&&(f.transform=l[f.propName]);return c}get outputs(){return KP(this.componentDef.outputs)}constructor(n,l){super(),this.componentDef=n,this.ngModule=l,this.componentType=n.type,this.selector=wj(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!l}create(n,l,c,f){let r=di(null);try{f=f||this.ngModule;let w=f instanceof To?f:f?.injector;w&&this.componentDef.getStandaloneInjector!==null&&(w=this.componentDef.getStandaloneInjector(w)||w);let I=w?new kT(n,w):n,A=I.get(Ih,null);if(A===null)throw new xt(407,!1);let L=I.get(a8,null),U=I.get(LC,null),Q=I.get(Wf,null),fe={rendererFactory:A,sanitizer:L,inlineEffectRunner:null,afterRenderEventManager:U,changeDetectionScheduler:Q},he=A.createRenderer(null,this.componentDef),be=this.componentDef.selectors[0][0]||"div",De=c?v6(he,c,this.componentDef.encapsulation,I):Tk(he,be,p8(be)),Ke=512;this.componentDef.signals?Ke|=4096:this.componentDef.onPush||(Ke|=16);let Fe=null;De!==null&&(Fe=bC(De,I,!0));let tt=MC(0,null,null,1,0,null,null,null,null,null,null),ft=mx(null,tt,null,Ke,null,null,fe,he,I,null,Fe);gC(ft);let Ue,Vt;try{let Jt=this.componentDef,nn,Et=null;Jt.findHostDirectiveDefs?(nn=[],Et=new Map,Jt.findHostDirectiveDefs(Jt,nn,Et),nn.push(Jt)):nn=[Jt];let oi=m8(ft,De),It=g8(oi,De,Jt,nn,ft,fe,he);Vt=jR(tt,js),De&&v8(he,Jt,De,c),l!==void 0&&x8(Vt,this.ngContentSelectors,l),Ue=y8(It,Jt,nn,Et,ft,[b8]),RC(tt,ft,null)}finally{_C()}return new OT(this.componentType,Ue,Jf(Vt,ft),ft,Vt)}finally{di(r)}}},OT=class extends ST{constructor(n,l,c,f,r){super(),this.location=c,this._rootLView=f,this._tNode=r,this.previousInputValues=null,this.instance=l,this.hostView=this.changeDetectorRef=new Ch(f,void 0,!1),this.componentType=n}setInput(n,l){let c=this._tNode.inputs,f;if(c!==null&&(f=c[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),l))return;let r=this._rootLView;PC(r[$n],r,f,n,l),this.previousInputValues.set(n,l);let w=Gc(this._tNode.index,r);kC(w)}}get injector(){return new vh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function m8(o,n){let l=o[$n],c=js;return o[c]=n,ep(l,c,2,"#host",null)}function g8(o,n,l,c,f,r,w){let I=f[$n];_8(c,o,n,w);let A=null;n!==null&&(A=bC(n,f[Gf]));let L=r.rendererFactory.createRenderer(n,l),U=16;l.signals?U=4096:l.onPush&&(U=64);let Q=mx(f,Bk(l),null,U,f[o.index],o,r,L,null,null,A);return I.firstCreatePass&&CT(I,o,c.length-1),gx(f,Q),f[o.index]=Q}function _8(o,n,l,c){for(let f of o)n.mergedAttrs=oC(n.mergedAttrs,f.hostAttrs);n.mergedAttrs!==null&&(Zv(n,n.mergedAttrs,!0),l!==null&&Ok(c,l,n))}function y8(o,n,l,c,f,r){let w=Co(),I=f[$n],A=$s(w,f);jk(I,f,w,l,null,c);for(let U=0;U<l.length;U++){let Q=w.directiveStart+U,fe=Th(f,I,Q,w);Vc(fe,f)}Uk(I,f,w),A&&Vc(A,f);let L=Th(f,I,w.directiveStart+w.componentOffset,w);if(o[Bs]=f[Bs]=L,r!==null)for(let U of r)U(L,n);return IC(I,w,f),L}function v8(o,n,l,c){if(c)cT(o,l,["ng-version","17.3.11"]);else{let{attrs:f,classes:r}=Ej(n.selectors[0]);f&&cT(o,l,f),r&&r.length>0&&kk(o,l,r.join(" "))}}function x8(o,n,l){let c=o.projection=[];for(let f=0;f<n.length;f++){let r=l[f];c.push(r!=null?Array.from(r):null)}}function b8(){let o=Co();cx(xi()[$n],o)}var xl=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=w8;let o=n;return o})();function w8(){let o=Co();return nO(o,xi())}var E8=xl,tO=class extends E8{constructor(n,l,c){super(),this._lContainer=n,this._hostTNode=l,this._hostLView=c}get element(){return Jf(this._hostTNode,this._hostLView)}get injector(){return new vh(this._hostTNode,this._hostLView)}get parentInjector(){let n=yC(this._hostTNode,this._hostLView);if(ok(n)){let l=Uv(n,this._hostLView),c=jv(n),f=l[$n].data[c+8];return new vh(f,l)}else return new vh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let l=QP(this._lContainer);return l!==null&&l[n]||null}get length(){return this._lContainer.length-Vo}createEmbeddedView(n,l,c){let f,r;typeof c=="number"?f=c:c!=null&&(f=c.index,r=c.injector);let w=qP(this._lContainer,n.ssrId),I=n.createEmbeddedViewImpl(l||{},r,w);return this.insertImpl(I,f,HP(this._hostTNode,w)),I}createComponent(n,l,c,f,r){let w=n&&!Bj(n),I;if(w)I=l;else{let be=l||{};I=be.index,c=be.injector,f=be.projectableNodes,r=be.environmentInjector||be.ngModuleRef}let A=w?n:new Zf(Bc(n)),L=c||this.parentInjector;if(!r&&A.ngModule==null){let De=(w?L:this.parentInjector).get(To,null);De&&(r=De)}let U=Bc(A.componentType??{}),Q=qP(this._lContainer,U?.id??null),fe=Q?.firstChild??null,he=A.create(L,f,fe,r);return this.insertImpl(he.hostView,I,HP(this._hostTNode,Q)),he}insert(n,l){return this.insertImpl(n,l,!0)}insertImpl(n,l,c){let f=n._lView;if(Yj(f)){let I=this.indexOf(n);if(I!==-1)this.detach(I);else{let A=f[Br],L=new tO(A,A[jo],A[Br]);L.detach(L.indexOf(n))}}let r=this._adjustIndex(l),w=this._lContainer;return $6(w,f,r,c),n.attachToViewContainerRef(),gR(eT(w),r,n),n}move(n,l){return this.insert(n,l)}indexOf(n){let l=QP(this._lContainer);return l!==null?l.indexOf(n):-1}remove(n){let l=this._adjustIndex(n,-1),c=ET(this._lContainer,l);c&&(zv(eT(this._lContainer),l),Dk(c[$n],c))}detach(n){let l=this._adjustIndex(n,-1),c=ET(this._lContainer,l);return c&&zv(eT(this._lContainer),l)!=null?new Ch(c):null}_adjustIndex(n,l=0){return n??this.length+l}};function QP(o){return o[Vv]}function eT(o){return o[Vv]||(o[Vv]=[])}function nO(o,n){let l,c=n[o.index];return yl(c)?l=c:(l=$k(c,n,null,o),n[o.index]=l,gx(n,l)),C8(l,n,o,c),new tO(l,o,n)}function T8(o,n){let l=o[Tr],c=l.createComment(""),f=$s(n,o),r=TC(l,f);return Hv(l,r,c,l6(l,f),!1),c}var C8=S8,I8=()=>!1;function D8(o,n,l){return I8(o,n,l)}function S8(o,n,l,c){if(o[bh])return;let f;l.type&8?f=Ta(c):f=T8(n,l),o[bh]=f}var LT=class o{constructor(n){this.queryList=n,this.matches=null}clone(){return new o(this.queryList)}setDirty(){this.queryList.setDirty()}},FT=class o{constructor(n=[]){this.queries=n}createEmbeddedView(n){let l=n.queries;if(l!==null){let c=n.contentQueries!==null?n.contentQueries[0]:l.length,f=[];for(let r=0;r<c;r++){let w=l.getByIndex(r),I=this.queries[w.indexInDeclarationView];f.push(I.clone())}return new o(f)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let l=0;l<this.queries.length;l++)FC(n,l).matches!==null&&this.queries[l].setDirty()}},NT=class{constructor(n,l,c=null){this.flags=l,this.read=c,typeof n=="string"?this.predicate=F8(n):this.predicate=n}},zT=class o{constructor(n=[]){this.queries=n}elementStart(n,l){for(let c=0;c<this.queries.length;c++)this.queries[c].elementStart(n,l)}elementEnd(n){for(let l=0;l<this.queries.length;l++)this.queries[l].elementEnd(n)}embeddedTView(n){let l=null;for(let c=0;c<this.length;c++){let f=l!==null?l.length:0,r=this.getByIndex(c).embeddedTView(n,f);r&&(r.indexInDeclarationView=c,l!==null?l.push(r):l=[r])}return l!==null?new o(l):null}template(n,l){for(let c=0;c<this.queries.length;c++)this.queries[c].template(n,l)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},BT=class o{constructor(n,l=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=l}elementStart(n,l){this.isApplyingToNode(l)&&this.matchTNode(n,l)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,l){this.elementStart(n,l)}embeddedTView(n,l){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,l),new o(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let l=this._declarationNodeIndex,c=n.parent;for(;c!==null&&c.type&8&&c.index!==l;)c=c.parent;return l===(c!==null?c.index:-1)}return this._appliesToNextNode}matchTNode(n,l){let c=this.metadata.predicate;if(Array.isArray(c))for(let f=0;f<c.length;f++){let r=c[f];this.matchTNodeWithReadOption(n,l,M8(l,r)),this.matchTNodeWithReadOption(n,l,kv(l,n,r,!1,!1))}else c===jc?l.type&4&&this.matchTNodeWithReadOption(n,l,-1):this.matchTNodeWithReadOption(n,l,kv(l,n,c,!1,!1))}matchTNodeWithReadOption(n,l,c){if(c!==null){let f=this.metadata.read;if(f!==null)if(f===Vr||f===xl||f===jc&&l.type&4)this.addMatch(l.index,-2);else{let r=kv(l,n,f,!1,!1);r!==null&&this.addMatch(l.index,r)}else this.addMatch(l.index,c)}}addMatch(n,l){this.matches===null?this.matches=[n,l]:this.matches.push(n,l)}};function M8(o,n){let l=o.localNames;if(l!==null){for(let c=0;c<l.length;c+=2)if(l[c]===n)return l[c+1]}return null}function A8(o,n){return o.type&11?Jf(o,n):o.type&4?_x(o,n):null}function P8(o,n,l,c){return l===-1?A8(n,o):l===-2?R8(o,n,c):Th(o,o[$n],l,n)}function R8(o,n,l){if(l===Vr)return Jf(n,o);if(l===jc)return _x(n,o);if(l===xl)return nO(n,o)}function iO(o,n,l,c){let f=n[gl].queries[c];if(f.matches===null){let r=o.data,w=l.matches,I=[];for(let A=0;w!==null&&A<w.length;A+=2){let L=w[A];if(L<0)I.push(null);else{let U=r[L];I.push(P8(n,U,w[A+1],l.metadata.read))}}f.matches=I}return f.matches}function VT(o,n,l,c){let f=o.queries.getByIndex(l),r=f.matches;if(r!==null){let w=iO(o,n,f,l);for(let I=0;I<r.length;I+=2){let A=r[I];if(A>0)c.push(w[I/2]);else{let L=r[I+1],U=n[-A];for(let Q=Vo;Q<U.length;Q++){let fe=U[Q];fe[Hg]===fe[Br]&&VT(fe[$n],fe,L,c)}if(U[Hf]!==null){let Q=U[Hf];for(let fe=0;fe<Q.length;fe++){let he=Q[fe];VT(he[$n],he,L,c)}}}}}return c}function k8(o,n){return o[gl].queries[n].queryList}function O8(o,n,l){let c=new Gv((l&4)===4);return w6(o,n,c,c.destroy),(n[gl]??=new FT).queries.push(new LT(c))-1}function L8(o,n,l,c){let f=Kr();if(f.firstCreatePass){let r=Co();N8(f,new NT(n,l,c),r.index),z8(f,o),(l&2)===2&&(f.staticContentQueries=!0)}return O8(f,xi(),l)}function F8(o){return o.split(",").map(n=>n.trim())}function N8(o,n,l){o.queries===null&&(o.queries=new zT),o.queries.track(new BT(n,l))}function z8(o,n){let l=o.contentQueries||(o.contentQueries=[]),c=l.length?l[l.length-1]:-1;n!==c&&l.push(o.queries.length-1,n)}function FC(o,n){return o.queries.getByIndex(n)}function B8(o,n){let l=o[$n],c=FC(l,n);return c.crossesNgTemplate?VT(l,o,n,[]):iO(l,o,c,n)}var Uc=class{},Vg=class{};var jT=class extends Uc{constructor(n,l,c){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Yv(this);let f=CR(n);this._bootstrapComponents=Ek(f.bootstrap),this._r3Injector=pk(n,l,[{provide:Uc,useValue:this},{provide:Wg,useValue:this.componentFactoryResolver},...c],oo(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},UT=class extends Vg{constructor(n){super(),this.moduleType=n}create(n){return new jT(this.moduleType,n,[])}};var Xv=class extends Uc{constructor(n){super(),this.componentFactoryResolver=new Yv(this),this.instance=null;let l=new Og([...n.providers,{provide:Uc,useValue:this},{provide:Wg,useValue:this.componentFactoryResolver}],n.parent||lC(),n.debugName,new Set(["environment"]));this.injector=l,n.runEnvironmentInitializers&&l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function NC(o,n,l=null){return new Xv({providers:o,parent:n,debugName:l,runEnvironmentInitializers:!0}).injector}var Lh=(()=>{let n=class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new wr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let c=this.taskId++;return this.pendingTasks.add(c),c}remove(c){this.pendingTasks.delete(c),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function rO(o){return zC(o)?Array.isArray(o)||!(o instanceof Map)&&Symbol.iterator in o:!1}function V8(o,n){if(Array.isArray(o))for(let l=0;l<o.length;l++)n(o[l]);else{let l=o[Symbol.iterator](),c;for(;!(c=l.next()).done;)n(c.value)}}function zC(o){return o!==null&&(typeof o=="function"||typeof o=="object")}function j8(o,n,l){return o[n]=l}function Dh(o,n,l){let c=o[n];return Object.is(c,l)?!1:(o[n]=l,!0)}function U8(o,n,l,c){let f=Dh(o,n,l);return Dh(o,n+1,c)||f}function $8(o,n,l,c,f){let r=U8(o,n,l,c);return Dh(o,n+2,f)||r}function G8(o){return(o.flags&32)===32}function H8(o,n,l,c,f,r,w,I,A){let L=n.consts,U=ep(n,o,4,w||null,qf(L,I));AC(n,l,U,qf(L,A)),cx(n,U);let Q=U.tView=MC(2,U,c,f,r,n.directiveRegistry,n.pipeRegistry,null,n.schemas,L,null);return n.queries!==null&&(n.queries.template(n,U),Q.queries=n.queries.embeddedTView(U)),U}function jr(o,n,l,c,f,r,w,I){let A=xi(),L=Kr(),U=o+js,Q=L.firstCreatePass?H8(U,L,A,n,l,c,f,r,w):L.data[U];Rh(Q,!1);let fe=q8(L,A,Q,o);ax()&&fx(L,A,fe,Q),Vc(fe,A);let he=$k(fe,A,fe,Q);return A[U]=he,gx(A,he),D8(he,Q,A),sx(Q)&&DC(L,A,Q),w!=null&&SC(A,Q,I),jr}var q8=W8;function W8(o,n,l,c){return lx(!0),n[Tr].createComment("")}function oO(o,n,l,c){return Dh(o,WR(),l)?n+Pg(l)+c:Da}function Z8(o,n,l,c,f,r,w,I){let A=aU(),L=$8(o,A,l,f,w);return ZR(3),L?n+Pg(l)+c+Pg(f)+r+Pg(w)+I:Da}function Mv(o,n){return o<<17|n<<2}function Sh(o){return o>>17&32767}function Y8(o){return(o&2)==2}function X8(o,n){return o&131071|n<<17}function $T(o){return o|2}function Yf(o){return(o&131068)>>2}function tT(o,n){return o&-131069|n<<2}function K8(o){return(o&1)===1}function GT(o){return o|1}function Q8(o,n,l,c,f,r){let w=r?n.classBindings:n.styleBindings,I=Sh(w),A=Yf(w);o[c]=l;let L=!1,U;if(Array.isArray(l)){let Q=l;U=Q[1],(U===null||Gg(Q,U)>0)&&(L=!0)}else U=l;if(f)if(A!==0){let fe=Sh(o[I+1]);o[c+1]=Mv(fe,I),fe!==0&&(o[fe+1]=tT(o[fe+1],c)),o[I+1]=X8(o[I+1],c)}else o[c+1]=Mv(I,0),I!==0&&(o[I+1]=tT(o[I+1],c)),I=c;else o[c+1]=Mv(A,0),I===0?I=c:o[A+1]=tT(o[A+1],c),A=c;L&&(o[c+1]=$T(o[c+1])),JP(o,U,c,!0),JP(o,U,c,!1),J8(n,U,o,c,r),w=Mv(I,A),r?n.classBindings=w:n.styleBindings=w}function J8(o,n,l,c,f){let r=f?o.residualClasses:o.residualStyles;r!=null&&typeof n=="string"&&Gg(r,n)>=0&&(l[c+1]=GT(l[c+1]))}function JP(o,n,l,c){let f=o[l+1],r=n===null,w=c?Sh(f):Yf(f),I=!1;for(;w!==0&&(I===!1||r);){let A=o[w],L=o[w+1];e$(A,n)&&(I=!0,o[w+1]=c?GT(L):$T(L)),w=c?Sh(L):Yf(L)}I&&(o[l+1]=c?$T(f):GT(f))}function e$(o,n){return o===null||n==null||(Array.isArray(o)?o[1]:o)===n?!0:Array.isArray(o)&&typeof n=="string"?Gg(o,n)>=0:!1}function Ai(o,n,l){let c=xi(),f=WR();if(Dh(c,f,n)){let r=Kr(),w=tk();Vk(r,w,c,o,n,c[Tr],l,!1)}return Ai}function eR(o,n,l,c,f){let r=n.inputs,w=f?"class":"style";PC(o,l,r[w],w,c)}function Fh(o,n,l){return sO(o,n,l,!1),Fh}function np(o,n){return sO(o,n,null,!0),np}function sO(o,n,l,c){let f=xi(),r=Kr(),w=ZR(2);if(r.firstUpdatePass&&n$(r,o,w,c),n!==Da&&Dh(f,w,n)){let I=r.data[kh()];a$(r,I,f,f[Tr],o,f[w+1]=l$(n,l),c,w)}}function t$(o,n){return n>=o.expandoStartIndex}function n$(o,n,l,c){let f=o.data;if(f[l+1]===null){let r=f[kh()],w=t$(o,l);c$(r,c)&&n===null&&!w&&(n=!1),n=i$(f,r,n,c),Q8(f,r,n,l,w,c)}}function i$(o,n,l,c){let f=dU(o),r=c?n.residualClasses:n.residualStyles;if(f===null)(c?n.classBindings:n.styleBindings)===0&&(l=nT(null,o,n,l,c),l=jg(l,n.attrs,c),r=null);else{let w=n.directiveStylingLast;if(w===-1||o[w]!==f)if(l=nT(f,o,n,l,c),r===null){let A=r$(o,n,c);A!==void 0&&Array.isArray(A)&&(A=nT(null,o,n,A[1],c),A=jg(A,n.attrs,c),o$(o,n,c,A))}else r=s$(o,n,c)}return r!==void 0&&(c?n.residualClasses=r:n.residualStyles=r),l}function r$(o,n,l){let c=l?n.classBindings:n.styleBindings;if(Yf(c)!==0)return o[Sh(c)]}function o$(o,n,l,c){let f=l?n.classBindings:n.styleBindings;o[Sh(f)]=c}function s$(o,n,l){let c,f=n.directiveEnd;for(let r=1+n.directiveStylingLast;r<f;r++){let w=o[r].hostAttrs;c=jg(c,w,l)}return jg(c,n.attrs,l)}function nT(o,n,l,c,f){let r=null,w=l.directiveEnd,I=l.directiveStylingLast;for(I===-1?I=l.directiveStart:I++;I<w&&(r=n[I],c=jg(c,r.hostAttrs,f),r!==o);)I++;return o!==null&&(l.directiveStylingLast=I),c}function jg(o,n,l){let c=l?1:2,f=-1;if(n!==null)for(let r=0;r<n.length;r++){let w=n[r];typeof w=="number"?f=w:f===c&&(Array.isArray(o)||(o=o===void 0?[]:["",o]),lj(o,w,l?!0:n[++r]))}return o===void 0?null:o}function a$(o,n,l,c,f,r,w,I){if(!(n.type&3))return;let A=o.data,L=A[I+1],U=K8(L)?tR(A,n,l,f,Yf(L),w):void 0;if(!Kv(U)){Kv(r)||Y8(L)&&(r=tR(A,null,l,f,I,w));let Q=VR(kh(),l);p6(c,w,Q,f,r)}}function tR(o,n,l,c,f,r){let w=n===null,I;for(;f>0;){let A=o[f],L=Array.isArray(A),U=L?A[1]:A,Q=U===null,fe=l[f+1];fe===Da&&(fe=Q?Ns:void 0);let he=Q?HE(fe,c):U===c?fe:void 0;if(L&&!Kv(he)&&(he=HE(A,c)),Kv(he)&&(I=he,w))return I;let be=o[f+1];f=w?Sh(be):Yf(be)}if(n!==null){let A=r?n.residualClasses:n.residualStyles;A!=null&&(I=HE(A,c))}return I}function Kv(o){return o!==void 0}function l$(o,n){return o==null||o===""||(typeof n=="string"?o=o+n:typeof o=="object"&&(o=oo(wC(o)))),o}function c$(o,n){return(o.flags&(n?8:16))!==0}function u$(o,n,l,c,f,r){let w=n.consts,I=qf(w,f),A=ep(n,o,2,c,I);return AC(n,l,A,qf(w,r)),A.attrs!==null&&Zv(A,A.attrs,!1),A.mergedAttrs!==null&&Zv(A,A.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,A),A}function Ft(o,n,l,c){let f=xi(),r=Kr(),w=js+o,I=f[Tr],A=r.firstCreatePass?u$(w,r,f,n,l,c):r.data[w],L=h$(r,f,A,I,n,o);f[w]=L;let U=sx(A);return Rh(A,!0),Ok(I,L,A),!G8(A)&&ax()&&fx(r,f,L,A),Jj()===0&&Vc(L,f),eU(),U&&(DC(r,f,A),IC(r,A,f)),c!==null&&SC(f,A),Ft}function kt(){let o=Co();fC()?pC():(o=o.parent,Rh(o,!1));let n=o;nU(n)&&iU(),tU();let l=Kr();return l.firstCreatePass&&(cx(l,o),uC(o)&&l.queries.elementEnd(o)),n.classesWithoutHost!=null&&vU(n)&&eR(l,n,xi(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&xU(n)&&eR(l,n,xi(),n.stylesWithoutHost,!1),kt}function Wn(o,n,l,c){return Ft(o,n,l,c),kt(),Wn}var h$=(o,n,l,c,f,r)=>(lx(!0),Tk(c,f,mU()));function d$(o,n,l,c,f){let r=n.consts,w=qf(r,c),I=ep(n,o,8,"ng-container",w);w!==null&&Zv(I,w,!0);let A=qf(r,f);return AC(n,l,I,A),n.queries!==null&&n.queries.elementStart(n,I),I}function vx(o,n,l){let c=xi(),f=Kr(),r=o+js,w=f.firstCreatePass?d$(r,f,c,n,l):f.data[r];Rh(w,!0);let I=f$(f,c,w,o);return c[r]=I,ax()&&fx(f,c,I,w),Vc(I,c),sx(w)&&(DC(f,c,w),IC(f,w,c)),l!=null&&SC(c,w),vx}function xx(){let o=Co(),n=Kr();return fC()?pC():(o=o.parent,Rh(o,!1)),n.firstCreatePass&&(cx(n,o),uC(o)&&n.queries.elementEnd(o)),xx}function BC(o,n,l){return vx(o,n,l),xx(),BC}var f$=(o,n,l,c)=>(lx(!0),QU(n[Tr],""));function Nh(){return xi()}var Qv="en-US";var p$=Qv;function m$(o){typeof o=="string"&&(p$=o.toLowerCase().replace(/_/g,"-"))}function bi(o,n,l,c){let f=xi(),r=Kr(),w=Co();return _$(r,f,f[Tr],w,o,n,c),bi}function g$(o,n,l,c){let f=o.cleanup;if(f!=null)for(let r=0;r<f.length-1;r+=2){let w=f[r];if(w===l&&f[r+1]===c){let I=n[Fg],A=f[r+2];return I.length>A?I[A]:null}typeof w=="string"&&(r+=2)}return null}function _$(o,n,l,c,f,r,w){let I=sx(c),L=o.firstCreatePass&&qk(o),U=n[Bs],Q=Hk(n),fe=!0;if(c.type&3||w){let De=$s(c,n),Ke=w?w(De):De,Fe=Q.length,tt=w?Ue=>w(Ta(Ue[c.index])):c.index,ft=null;if(!w&&I&&(ft=g$(o,n,f,c.index)),ft!==null){let Ue=ft.__ngLastListenerFn__||ft;Ue.__ngNextListenerFn__=r,ft.__ngLastListenerFn__=r,fe=!1}else{r=iR(c,n,U,r,!1);let Ue=l.listen(Ke,f,r);Q.push(r,Ue),L&&L.push(f,tt,Fe,Fe+1)}}else r=iR(c,n,U,r,!1);let he=c.outputs,be;if(fe&&he!==null&&(be=he[f])){let De=be.length;if(De)for(let Ke=0;Ke<De;Ke+=2){let Fe=be[Ke],tt=be[Ke+1],Vt=n[Fe][tt].subscribe(r),Jt=Q.length;Q.push(r,Vt),L&&L.push(f,c.index,Jt,-(Jt+1))}}}function nR(o,n,l,c){let f=di(null);try{return xa(6,n,l),l(c)!==!1}catch(r){return Wk(o,r),!1}finally{xa(7,n,l),di(f)}}function iR(o,n,l,c,f){return function r(w){if(w===Function)return c;let I=o.componentOffset>-1?Gc(o.index,n):n;kC(I);let A=nR(n,l,c,w),L=r.__ngNextListenerFn__;for(;L;)A=nR(n,l,L,w)&&A,L=L.__ngNextListenerFn__;return f&&A===!1&&w.preventDefault(),A}}function Hs(o=1){return pU(o)}function y$(o,n){let l=null,c=_j(o);for(let f=0;f<n.length;f++){let r=n[f];if(r==="*"){l=f;continue}if(c===null?bR(o,r,!0):xj(c,r))return f}return l}function zh(o){let n=xi()[Vs][jo];if(!n.projection){let l=o?o.length:1,c=n.projection=sj(l,null),f=c.slice(),r=n.child;for(;r!==null;){let w=o?y$(r,o):0;w!==null&&(f[w]?f[w].projectionNext=r:c[w]=r,f[w]=r),r=r.next}}}function Bh(o,n=0,l){let c=xi(),f=Kr(),r=ep(f,js+o,16,null,l||null);r.projection===null&&(r.projection=n),pC(),(!c[Lg]||HR())&&(r.flags&32)!==32&&d6(f,c,r)}function VC(o,n,l){return Vh(o,"",n,"",l),VC}function Vh(o,n,l,c,f){let r=xi(),w=oO(r,n,l,c);if(w!==Da){let I=Kr(),A=tk();Vk(I,A,r,o,w,r[Tr],f,!1)}return Vh}function bx(o,n,l,c){L8(o,n,l,c)}function Zg(o){let n=xi(),l=Kr(),c=YR();mC(c+1);let f=FC(l,c);if(o.dirty&&Zj(n)===((f.metadata.flags&2)===2)){if(f.matches===null)o.reset([]);else{let r=B8(n,c);o.reset(r,RU),o.notifyOnChanges()}return!0}return!1}function Yg(){return k8(xi(),YR())}function wx(o){let n=oU();return Wj(n,js+o)}function Vn(o,n=""){let l=xi(),c=Kr(),f=o+js,r=c.firstCreatePass?ep(c,f,1,n,null):c.data[f],w=v$(c,l,r,n,o);l[f]=w,ax()&&fx(c,l,w,r),Rh(r,!1)}var v$=(o,n,l,c,f)=>(lx(!0),XU(n[Tr],c));function Ex(o){return Pr("",o,""),Ex}function Pr(o,n,l){let c=xi(),f=oO(c,o,n,l);return f!==Da&&Zk(c,kh(),f),Pr}function jC(o,n,l,c,f,r,w){let I=xi(),A=Z8(I,o,n,l,c,f,r,w);return A!==Da&&Zk(I,kh(),A),jC}function x$(o,n,l){let c=Kr();if(c.firstCreatePass){let f=Qf(o);HT(l,c.data,c.blueprint,f,!0),HT(n,c.data,c.blueprint,f,!1)}}function HT(o,n,l,c,f){if(o=ro(o),Array.isArray(o))for(let r=0;r<o.length;r++)HT(o[r],n,l,c,f);else{let r=Kr(),w=xi(),I=Co(),A=$f(o)?o:ro(o.provide),L=PR(o),U=I.providerIndexes&1048575,Q=I.directiveStart,fe=I.providerIndexes>>20;if($f(o)||!o.multi){let he=new Eh(L,f,Qn),be=rT(A,n,f?U:U+fe,Q);be===-1?(_T($v(I,w),r,A),iT(r,o,n.length),n.push(A),I.directiveStart++,I.directiveEnd++,f&&(I.providerIndexes+=1048576),l.push(he),w.push(he)):(l[be]=he,w[be]=he)}else{let he=rT(A,n,U+fe,Q),be=rT(A,n,U,U+fe),De=he>=0&&l[he],Ke=be>=0&&l[be];if(f&&!Ke||!f&&!De){_T($v(I,w),r,A);let Fe=E$(f?w$:b$,l.length,f,c,L);!f&&Ke&&(l[be].providerFactory=Fe),iT(r,o,n.length,0),n.push(A),I.directiveStart++,I.directiveEnd++,f&&(I.providerIndexes+=1048576),l.push(Fe),w.push(Fe)}else{let Fe=aO(l[f?be:he],L,!f&&c);iT(r,o,he>-1?he:be,Fe)}!f&&c&&Ke&&l[be].componentProviders++}}}function iT(o,n,l,c){let f=$f(n),r=Pj(n);if(f||r){let A=(r?ro(n.useClass):n).prototype.ngOnDestroy;if(A){let L=o.destroyHooks||(o.destroyHooks=[]);if(!f&&n.multi){let U=L.indexOf(l);U===-1?L.push(l,[c,A]):L[U+1].push(c,A)}else L.push(l,A)}}}function aO(o,n,l){return l&&o.componentProviders++,o.multi.push(n)-1}function rT(o,n,l,c){for(let f=l;f<c;f++)if(n[f]===o)return f;return-1}function b$(o,n,l,c){return qT(this.multi,[])}function w$(o,n,l,c){let f=this.multi,r;if(this.providerFactory){let w=this.providerFactory.componentProviders,I=Th(l,l[$n],this.providerFactory.index,c);r=I.slice(0,w),qT(f,r);for(let A=w;A<I.length;A++)r.push(I[A])}else r=[],qT(f,r);return r}function qT(o,n){for(let l=0;l<o.length;l++){let c=o[l];n.push(c())}return n}function E$(o,n,l,c,f){let r=new Eh(o,l,Qn);return r.multi=[],r.index=n,r.componentProviders=0,aO(r,f,c&&!l),r}function ip(o,n=[]){return l=>{l.providersResolver=(c,f)=>x$(c,f?f(o):o,n)}}var T$=(()=>{let n=class n{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c)){let f=SR(!1,c.type),r=f.length>0?NC([f],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c,r)}return this.cachedInjectors.get(c)}ngOnDestroy(){try{for(let c of this.cachedInjectors.values())c!==null&&c.destroy()}finally{this.cachedInjectors.clear()}}};n.\u0275prov=At({token:n,providedIn:"environment",factory:()=>new n(Ut(To))});let o=n;return o})();function mi(o){tp("NgStandalone"),o.getStandaloneInjector=n=>n.get(T$).getOrCreateStandaloneInjector(o)}function rp(o,n,l,c){return I$(xi(),sU(),o,n,l,c)}function C$(o,n){let l=o[n];return l===Da?void 0:l}function I$(o,n,l,c,f,r){let w=n+l;return Dh(o,w,f)?j8(o,w+1,r?c.call(r,f):c(f)):C$(o,w+1)}function UC(o,n){return _x(o,n)}var Tx=(()=>{let n=class n{log(c){console.log(c)}warn(c){console.warn(c)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"platform"});let o=n;return o})();var lO=new an("");function op(o){return!!o&&typeof o.then=="function"}function cO(o){return!!o&&typeof o.subscribe=="function"}var uO=new an(""),hO=(()=>{let n=class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((c,f)=>{this.resolve=c,this.reject=f}),this.appInits=bt(uO,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let c=[];for(let r of this.appInits){let w=r();if(op(w))c.push(w);else if(cO(w)){let I=new Promise((A,L)=>{w.subscribe({complete:A,error:L})});c.push(I)}}let f=()=>{this.done=!0,this.resolve()};Promise.all(c).then(()=>{f()}).catch(r=>{this.reject(r)}),c.length===0&&f(),this.initialized=!0}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),Cx=new an("");function D$(){W2(()=>{throw new xt(600,!1)})}function S$(o){return o.isBoundToModule}function M$(o,n,l){try{let c=l();return op(c)?c.catch(f=>{throw n.runOutsideAngular(()=>o.handleError(f)),f}):c}catch(c){throw n.runOutsideAngular(()=>o.handleError(c)),c}}var sp=(()=>{let n=class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=bt(mk),this.afterRenderEffectManager=bt(LC),this.externalTestViews=new Set,this.beforeRender=new br,this.afterTick=new br,this.componentTypes=[],this.components=[],this.isStable=bt(Lh).hasPendingTasks.pipe(Sn(c=>!c)),this._injector=bt(To)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(c,f){let r=c instanceof Wv;if(!this._injector.get(hO).done){let he=!r&&TR(c),be=!1;throw new xt(405,be)}let I;r?I=c:I=this._injector.get(Wg).resolveComponentFactory(c),this.componentTypes.push(I.componentType);let A=S$(I)?void 0:this._injector.get(Uc),L=f||I.selector,U=I.create(vl.NULL,[],L,A),Q=U.location.nativeElement,fe=U.injector.get(lO,null);return fe?.registerApplication(Q),U.onDestroy(()=>{this.detachView(U.hostView),oT(this.components,U),fe?.unregisterApplication(Q)}),this._loadComponent(U),U}tick(){this._tick(!0)}_tick(c){if(this._runningTick)throw new xt(101,!1);let f=di(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(c)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,di(f)}}detectChangesInAttachedViews(c){let f=0,r=this.afterRenderEffectManager;for(;;){if(f===Xk)throw new xt(103,!1);if(c){let w=f===0;this.beforeRender.next(w);for(let{_lView:I,notifyErrorHandler:A}of this._views)A$(I,w,A)}if(f++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>WT(w))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>WT(w))))break}}attachView(c){let f=c;this._views.push(f),f.attachToAppRef(this)}detachView(c){let f=c;oT(this._views,f),f.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);let f=this._injector.get(Cx,[]);[...this._bootstrapListeners,...f].forEach(r=>r(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>oT(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new xt(406,!1);let c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function oT(o,n){let l=o.indexOf(n);l>-1&&o.splice(l,1)}function A$(o,n,l){!n&&!WT(o)||P$(o,l,n)}function WT(o){return dC(o)}function P$(o,n,l){let c;l?(c=0,o[yn]|=1024):o[yn]&64?c=0:c=1,Kk(o,n,c)}var ZT=class{constructor(n,l){this.ngModuleFactory=n,this.componentFactories=l}},$C=(()=>{let n=class n{compileModuleSync(c){return new UT(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){let f=this.compileModuleSync(c),r=CR(c),w=Ek(r.declarations).reduce((I,A)=>{let L=Bc(A);return L&&I.push(new Zf(L)),I},[]);return new ZT(f,w)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var R$=(()=>{let n=class n{constructor(){this.zone=bt(fi),this.applicationRef=bt(sp)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function k$(o){return[{provide:fi,useFactory:o},{provide:Uf,multi:!0,useFactory:()=>{let n=bt(R$,{optional:!0});return()=>n.initialize()}},{provide:Uf,multi:!0,useFactory:()=>{let n=bt(N$);return()=>{n.initialize()}}},{provide:mk,useFactory:O$}]}function O$(){let o=bt(fi),n=bt(Ca);return l=>o.runOutsideAngular(()=>n.handleError(l))}function L$(o){let n=k$(()=>new fi(F$(o)));return $c([[],n])}function F$(o){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:o?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:o?.runCoalescing??!1}}var N$=(()=>{let n=class n{constructor(){this.subscription=new Qi,this.initialized=!1,this.zone=bt(fi),this.pendingTasks=bt(Lh)}initialize(){if(this.initialized)return;this.initialized=!0;let c=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(c=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{fi.assertNotInAngularZone(),queueMicrotask(()=>{c!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(c),c=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{fi.assertInAngularZone(),c??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function z$(){return typeof $localize<"u"&&$localize.locale||Qv}var Ix=new an("",{providedIn:"root",factory:()=>bt(Ix,qn.Optional|qn.SkipSelf)||z$()});var dO=new an("");var Lv=null;function B$(o=[],n){return vl.create({name:n,providers:[{provide:ix,useValue:"platform"},{provide:dO,useValue:new Set([()=>Lv=null])},...o]})}function V$(o=[]){if(Lv)return Lv;let n=B$(o);return Lv=n,D$(),j$(n),n}function j$(o){o.get(xC,null)?.forEach(l=>l())}var Hc=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=U$;let o=n;return o})();function U$(o){return $$(Co(),xi(),(o&16)===16)}function $$(o,n,l){if(ox(o)&&!l){let c=Gc(o.index,n);return new Ch(c,c)}else if(o.type&47){let c=n[Vs];return new Ch(c,n)}return null}var YT=class{constructor(){}supports(n){return rO(n)}create(n){return new XT(n)}},G$=(o,n)=>n,XT=class{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||G$}forEachItem(n){let l;for(l=this._itHead;l!==null;l=l._next)n(l)}forEachOperation(n){let l=this._itHead,c=this._removalsHead,f=0,r=null;for(;l||c;){let w=!c||l&&l.currentIndex<rR(c,f,r)?l:c,I=rR(w,f,r),A=w.currentIndex;if(w===c)f--,c=c._nextRemoved;else if(l=l._next,w.previousIndex==null)f++;else{r||(r=[]);let L=I-f,U=A-f;if(L!=U){for(let fe=0;fe<L;fe++){let he=fe<r.length?r[fe]:r[fe]=0,be=he+fe;U<=be&&be<L&&(r[fe]=he+1)}let Q=w.previousIndex;r[Q]=U-L}}I!==A&&n(w,I,A)}}forEachPreviousItem(n){let l;for(l=this._previousItHead;l!==null;l=l._nextPrevious)n(l)}forEachAddedItem(n){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)n(l)}forEachMovedItem(n){let l;for(l=this._movesHead;l!==null;l=l._nextMoved)n(l)}forEachRemovedItem(n){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)n(l)}forEachIdentityChange(n){let l;for(l=this._identityChangesHead;l!==null;l=l._nextIdentityChange)n(l)}diff(n){if(n==null&&(n=[]),!rO(n))throw new xt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l=this._itHead,c=!1,f,r,w;if(Array.isArray(n)){this.length=n.length;for(let I=0;I<this.length;I++)r=n[I],w=this._trackByFn(I,r),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,r,w,I),c=!0):(c&&(l=this._verifyReinsertion(l,r,w,I)),Object.is(l.item,r)||this._addIdentityChange(l,r)),l=l._next}else f=0,V8(n,I=>{w=this._trackByFn(f,I),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,I,w,f),c=!0):(c&&(l=this._verifyReinsertion(l,I,w,f)),Object.is(l.item,I)||this._addIdentityChange(l,I)),l=l._next,f++}),this.length=f;return this._truncate(l),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,l,c,f){let r;return n===null?r=this._itTail:(r=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null),n!==null?(Object.is(n.item,l)||this._addIdentityChange(n,l),this._reinsertAfter(n,r,f)):(n=this._linkedRecords===null?null:this._linkedRecords.get(c,f),n!==null?(Object.is(n.item,l)||this._addIdentityChange(n,l),this._moveAfter(n,r,f)):n=this._addAfter(new KT(l,c),r,f)),n}_verifyReinsertion(n,l,c,f){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null);return r!==null?n=this._reinsertAfter(r,n._prev,f):n.currentIndex!=f&&(n.currentIndex=f,this._addToMoves(n,f)),n}_truncate(n){for(;n!==null;){let l=n._next;this._addToRemovals(this._unlink(n)),n=l}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,l,c){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let f=n._prevRemoved,r=n._nextRemoved;return f===null?this._removalsHead=r:f._nextRemoved=r,r===null?this._removalsTail=f:r._prevRemoved=f,this._insertAfter(n,l,c),this._addToMoves(n,c),n}_moveAfter(n,l,c){return this._unlink(n),this._insertAfter(n,l,c),this._addToMoves(n,c),n}_addAfter(n,l,c){return this._insertAfter(n,l,c),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,l,c){let f=l===null?this._itHead:l._next;return n._next=f,n._prev=l,f===null?this._itTail=n:f._prev=n,l===null?this._itHead=n:l._next=n,this._linkedRecords===null&&(this._linkedRecords=new Jv),this._linkedRecords.put(n),n.currentIndex=c,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let l=n._prev,c=n._next;return l===null?this._itHead=c:l._next=c,c===null?this._itTail=l:c._prev=l,n}_addToMoves(n,l){return n.previousIndex===l||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new Jv),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,l){return n.item=l,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},KT=class{constructor(n,l){this.item=n,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},QT=class{constructor(){this._head=null,this._tail=null}add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,l){let c;for(c=this._head;c!==null;c=c._nextDup)if((l===null||l<=c.currentIndex)&&Object.is(c.trackById,n))return c;return null}remove(n){let l=n._prevDup,c=n._nextDup;return l===null?this._head=c:l._nextDup=c,c===null?this._tail=l:c._prevDup=l,this._head===null}},Jv=class{constructor(){this.map=new Map}put(n){let l=n.trackById,c=this.map.get(l);c||(c=new QT,this.map.set(l,c)),c.add(n)}get(n,l){let c=n,f=this.map.get(c);return f?f.get(n,l):null}remove(n){let l=n.trackById;return this.map.get(l).remove(n)&&this.map.delete(l),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function rR(o,n,l){let c=o.previousIndex;if(c===null)return c;let f=0;return l&&c<l.length&&(f=l[c]),c+n+f}var JT=class{constructor(){}supports(n){return n instanceof Map||zC(n)}create(){return new eC}},eC=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(n){let l;for(l=this._mapHead;l!==null;l=l._next)n(l)}forEachPreviousItem(n){let l;for(l=this._previousMapHead;l!==null;l=l._nextPrevious)n(l)}forEachChangedItem(n){let l;for(l=this._changesHead;l!==null;l=l._nextChanged)n(l)}forEachAddedItem(n){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)n(l)}forEachRemovedItem(n){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)n(l)}diff(n){if(!n)n=new Map;else if(!(n instanceof Map||zC(n)))throw new xt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(n,(c,f)=>{if(l&&l.key===f)this._maybeAddToChanges(l,c),this._appendAfter=l,l=l._next;else{let r=this._getOrCreateRecordForKey(f,c);l=this._insertBeforeOrAppend(l,r)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let c=l;c!==null;c=c._nextRemoved)c===this._mapHead&&(this._mapHead=null),this._records.delete(c.key),c._nextRemoved=c._next,c.previousValue=c.currentValue,c.currentValue=null,c._prev=null,c._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,l){if(n){let c=n._prev;return l._next=n,l._prev=c,n._prev=l,c&&(c._next=l),n===this._mapHead&&(this._mapHead=l),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(n,l){if(this._records.has(n)){let f=this._records.get(n);this._maybeAddToChanges(f,l);let r=f._prev,w=f._next;return r&&(r._next=w),w&&(w._prev=r),f._next=null,f._prev=null,f}let c=new tC(n);return this._records.set(n,c),c.currentValue=l,this._addToAdditions(c),c}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;n!==null;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;n!=null;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,l){Object.is(l,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=l,this._addToChanges(n))}_addToAdditions(n){this._additionsHead===null?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){this._changesHead===null?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,l){n instanceof Map?n.forEach(l):Object.keys(n).forEach(c=>l(n[c],c))}},tC=class{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function oR(){return new GC([new YT])}var GC=(()=>{let n=class n{constructor(c){this.factories=c}static create(c,f){if(f!=null){let r=f.factories.slice();c=c.concat(r)}return new n(c)}static extend(c){return{provide:n,useFactory:f=>n.create(c,f||oR()),deps:[[n,new $g,new Xf]]}}find(c){let f=this.factories.find(r=>r.supports(c));if(f!=null)return f;throw new xt(901,!1)}};n.\u0275prov=At({token:n,providedIn:"root",factory:oR});let o=n;return o})();function sR(){return new Dx([new JT])}var Dx=(()=>{let n=class n{constructor(c){this.factories=c}static create(c,f){if(f){let r=f.factories.slice();c=c.concat(r)}return new n(c)}static extend(c){return{provide:n,useFactory:f=>n.create(c,f||sR()),deps:[[n,new $g,new Xf]]}}find(c){let f=this.factories.find(r=>r.supports(c));if(f)return f;throw new xt(901,!1)}};n.\u0275prov=At({token:n,providedIn:"root",factory:sR});let o=n;return o})();function fO(o){try{let{rootComponent:n,appProviders:l,platformProviders:c}=o,f=V$(c),r=[L$(),...l||[]],I=new Xv({providers:r,parent:f,debugName:"",runEnvironmentInitializers:!1}).injector,A=I.get(fi);return A.run(()=>{I.resolveInjectorInitializers();let L=I.get(Ca,null),U;A.runOutsideAngular(()=>{U=A.onError.subscribe({next:he=>{L.handleError(he)}})});let Q=()=>I.destroy(),fe=f.get(dO);return fe.add(Q),I.onDestroy(()=>{U.unsubscribe(),fe.delete(Q)}),M$(L,A,()=>{let he=I.get(hO);return he.runInitializers(),he.donePromise.then(()=>{let be=I.get(Ix,Qv);m$(be||Qv);let De=I.get(sp);return n!==void 0&&De.bootstrap(n),De})})})}catch(n){return Promise.reject(n)}}function pO(o){let n=Bc(o);if(!n)return null;let l=new Zf(n);return{get selector(){return l.selector},get type(){return l.componentType},get inputs(){return l.inputs},get outputs(){return l.outputs},get ngContentSelectors(){return l.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}var bO=null;function ap(){return bO}function wO(o){bO??=o}var Sx=class{};var Pi=new an(""),EO=(()=>{let n=class n{historyGo(c){throw new Error("")}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>bt(H$),providedIn:"platform"});let o=n;return o})();var H$=(()=>{let n=class n extends EO{constructor(){super(),this._doc=bt(Pi),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ap().getBaseHref(this._doc)}onPopState(c){let f=ap().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",c,!1),()=>f.removeEventListener("popstate",c)}onHashChange(c){let f=ap().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",c,!1),()=>f.removeEventListener("hashchange",c)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(c){this._location.pathname=c}pushState(c,f,r){this._history.pushState(c,f,r)}replaceState(c,f,r){this._history.replaceState(c,f,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(c=0){this._history.go(c)}getState(){return this._history.state}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>new n,providedIn:"platform"});let o=n;return o})();function TO(o,n){if(o.length==0)return n;if(n.length==0)return o;let l=0;return o.endsWith("/")&&l++,n.startsWith("/")&&l++,l==2?o+n.substring(1):l==1?o+n:o+"/"+n}function mO(o){let n=o.match(/#|\?|$/),l=n&&n.index||o.length,c=l-(o[l-1]==="/"?1:0);return o.slice(0,c)+o.slice(l)}function jh(o){return o&&o[0]!=="?"?"?"+o:o}var Rx=(()=>{let n=class n{historyGo(c){throw new Error("")}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>bt(CO),providedIn:"root"});let o=n;return o})(),q$=new an(""),CO=(()=>{let n=class n extends Rx{constructor(c,f){super(),this._platformLocation=c,this._removeListenerFns=[],this._baseHref=f??this._platformLocation.getBaseHrefFromDOM()??bt(Pi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(c){this._removeListenerFns.push(this._platformLocation.onPopState(c),this._platformLocation.onHashChange(c))}getBaseHref(){return this._baseHref}prepareExternalUrl(c){return TO(this._baseHref,c)}path(c=!1){let f=this._platformLocation.pathname+jh(this._platformLocation.search),r=this._platformLocation.hash;return r&&c?`${f}${r}`:f}pushState(c,f,r,w){let I=this.prepareExternalUrl(r+jh(w));this._platformLocation.pushState(c,f,I)}replaceState(c,f,r,w){let I=this.prepareExternalUrl(r+jh(w));this._platformLocation.replaceState(c,f,I)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(c=0){this._platformLocation.historyGo?.(c)}};n.\u0275fac=function(f){return new(f||n)(Ut(EO),Ut(q$,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Xg=(()=>{let n=class n{constructor(c){this._subject=new zr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=c;let f=this._locationStrategy.getBaseHref();this._basePath=Y$(mO(gO(f))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(c=!1){return this.normalize(this._locationStrategy.path(c))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(c,f=""){return this.path()==this.normalize(c+jh(f))}normalize(c){return n.stripTrailingSlash(Z$(this._basePath,gO(c)))}prepareExternalUrl(c){return c&&c[0]!=="/"&&(c="/"+c),this._locationStrategy.prepareExternalUrl(c)}go(c,f="",r=null){this._locationStrategy.pushState(r,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+jh(f)),r)}replaceState(c,f="",r=null){this._locationStrategy.replaceState(r,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+jh(f)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(c=0){this._locationStrategy.historyGo?.(c)}onUrlChange(c){return this._urlChangeListeners.push(c),this._urlChangeSubscription??=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)}),()=>{let f=this._urlChangeListeners.indexOf(c);this._urlChangeListeners.splice(f,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(c="",f){this._urlChangeListeners.forEach(r=>r(c,f))}subscribe(c,f,r){return this._subject.subscribe({next:c,error:f,complete:r})}};n.normalizeQueryParams=jh,n.joinWithSlash=TO,n.stripTrailingSlash=mO,n.\u0275fac=function(f){return new(f||n)(Ut(Rx))},n.\u0275prov=At({token:n,factory:()=>W$(),providedIn:"root"});let o=n;return o})();function W$(){return new Xg(Ut(Rx))}function Z$(o,n){if(!o||!n.startsWith(o))return n;let l=n.substring(o.length);return l===""||["/",";","?","#"].includes(l[0])?l:n}function gO(o){return o.replace(/\/index.html$/,"")}function Y$(o){if(new RegExp("^(https?:)?//").test(o)){let[,l]=o.split(/\/\/[^\/]+/);return l}return o}function kx(o,n){n=encodeURIComponent(n);for(let l of o.split(";")){let c=l.indexOf("="),[f,r]=c==-1?[l,""]:[l.slice(0,c),l.slice(c+1)];if(f.trim()===n)return decodeURIComponent(r)}return null}var HC=/\s+/,_O=[],Ox=(()=>{let n=class n{constructor(c,f){this._ngEl=c,this._renderer=f,this.initialClasses=_O,this.stateMap=new Map}set klass(c){this.initialClasses=c!=null?c.trim().split(HC):_O}set ngClass(c){this.rawClass=typeof c=="string"?c.trim().split(HC):c}ngDoCheck(){for(let f of this.initialClasses)this._updateState(f,!0);let c=this.rawClass;if(Array.isArray(c)||c instanceof Set)for(let f of c)this._updateState(f,!0);else if(c!=null)for(let f of Object.keys(c))this._updateState(f,!!c[f]);this._applyStateDiff()}_updateState(c,f){let r=this.stateMap.get(c);r!==void 0?(r.enabled!==f&&(r.changed=!0,r.enabled=f),r.touched=!0):this.stateMap.set(c,{enabled:f,changed:!0,touched:!0})}_applyStateDiff(){for(let c of this.stateMap){let f=c[0],r=c[1];r.changed?(this._toggleClass(f,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(f,!1),this.stateMap.delete(f)),r.touched=!1}}_toggleClass(c,f){c=c.trim(),c.length>0&&c.split(HC).forEach(r=>{f?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}};n.\u0275fac=function(f){return new(f||n)(Qn(Vr),Qn(Oh))},n.\u0275dir=cs({type:n,selectors:[["","ngClass",""]],inputs:{klass:[Eo.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let o=n;return o})();var qC=class{constructor(n,l,c,f){this.$implicit=n,this.ngForOf=l,this.index=c,this.count=f}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},qc=(()=>{let n=class n{set ngForOf(c){this._ngForOf=c,this._ngForOfDirty=!0}set ngForTrackBy(c){this._trackByFn=c}get ngForTrackBy(){return this._trackByFn}constructor(c,f,r){this._viewContainer=c,this._template=f,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(c){c&&(this._template=c)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let c=this._ngForOf;if(!this._differ&&c)if(0)try{}catch{}else this._differ=this._differs.find(c).create(this.ngForTrackBy)}if(this._differ){let c=this._differ.diff(this._ngForOf);c&&this._applyChanges(c)}}_applyChanges(c){let f=this._viewContainer;c.forEachOperation((r,w,I)=>{if(r.previousIndex==null)f.createEmbeddedView(this._template,new qC(r.item,this._ngForOf,-1,-1),I===null?void 0:I);else if(I==null)f.remove(w===null?void 0:w);else if(w!==null){let A=f.get(w);f.move(A,I),yO(A,r)}});for(let r=0,w=f.length;r<w;r++){let A=f.get(r).context;A.index=r,A.count=w,A.ngForOf=this._ngForOf}c.forEachIdentityChange(r=>{let w=f.get(r.currentIndex);yO(w,r)})}static ngTemplateContextGuard(c,f){return!0}};n.\u0275fac=function(f){return new(f||n)(Qn(xl),Qn(jc),Qn(GC))},n.\u0275dir=cs({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let o=n;return o})();function yO(o,n){o.context.$implicit=n.item}var cp=(()=>{let n=class n{constructor(c,f){this._viewContainer=c,this._context=new WC,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(c){this._context.$implicit=this._context.ngIf=c,this._updateView()}set ngIfThen(c){vO("ngIfThen",c),this._thenTemplateRef=c,this._thenViewRef=null,this._updateView()}set ngIfElse(c){vO("ngIfElse",c),this._elseTemplateRef=c,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(c,f){return!0}};n.\u0275fac=function(f){return new(f||n)(Qn(xl),Qn(jc))},n.\u0275dir=cs({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let o=n;return o})(),WC=class{constructor(){this.$implicit=null,this.ngIf=null}};function vO(o,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${o} must be a TemplateRef, but received '${oo(n)}'.`)}var Lx=(()=>{let n=class n{constructor(c,f,r){this._ngEl=c,this._differs=f,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(c){this._ngStyle=c,!this._differ&&c&&(this._differ=this._differs.find(c).create())}ngDoCheck(){if(this._differ){let c=this._differ.diff(this._ngStyle);c&&this._applyChanges(c)}}_setStyle(c,f){let[r,w]=c.split("."),I=r.indexOf("-")===-1?void 0:Ia.DashCase;f!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,w?`${f}${w}`:f,I):this._renderer.removeStyle(this._ngEl.nativeElement,r,I)}_applyChanges(c){c.forEachRemovedItem(f=>this._setStyle(f.key,null)),c.forEachAddedItem(f=>this._setStyle(f.key,f.currentValue)),c.forEachChangedItem(f=>this._setStyle(f.key,f.currentValue))}};n.\u0275fac=function(f){return new(f||n)(Qn(Vr),Qn(Dx),Qn(Oh))},n.\u0275dir=cs({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let o=n;return o})();var qi=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=ur({type:n}),n.\u0275inj=cr({});let o=n;return o})(),ZC="browser",X$="server";function IO(o){return o===ZC}function Fx(o){return o===X$}var lp=class{};var Qg=class{},zx=class{},Uh=class o{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(l=>{let c=l.indexOf(":");if(c>0){let f=l.slice(0,c),r=f.toLowerCase(),w=l.slice(c+1).trim();this.maybeSetNormalizedName(f,r),this.headers.has(r)?this.headers.get(r).push(w):this.headers.set(r,[w])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((l,c)=>{this.setHeaderEntries(c,l)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([l,c])=>{this.setHeaderEntries(l,c)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let l=this.headers.get(n.toLowerCase());return l&&l.length>0?l[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,l){return this.clone({name:n,value:l,op:"a"})}set(n,l){return this.clone({name:n,value:l,op:"s"})}delete(n,l){return this.clone({name:n,value:l,op:"d"})}maybeSetNormalizedName(n,l){this.normalizedNames.has(l)||this.normalizedNames.set(l,n)}init(){this.lazyInit&&(this.lazyInit instanceof o?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(l=>{this.headers.set(l,n.headers.get(l)),this.normalizedNames.set(l,n.normalizedNames.get(l))})}clone(n){let l=new o;return l.lazyInit=this.lazyInit&&this.lazyInit instanceof o?this.lazyInit:this,l.lazyUpdate=(this.lazyUpdate||[]).concat([n]),l}applyUpdate(n){let l=n.name.toLowerCase();switch(n.op){case"a":case"s":let c=n.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(n.name,l);let f=(n.op==="a"?this.headers.get(l):void 0)||[];f.push(...c),this.headers.set(l,f);break;case"d":let r=n.value;if(!r)this.headers.delete(l),this.normalizedNames.delete(l);else{let w=this.headers.get(l);if(!w)return;w=w.filter(I=>r.indexOf(I)===-1),w.length===0?(this.headers.delete(l),this.normalizedNames.delete(l)):this.headers.set(l,w)}break}}setHeaderEntries(n,l){let c=(Array.isArray(l)?l:[l]).map(r=>r.toString()),f=n.toLowerCase();this.headers.set(f,c),this.maybeSetNormalizedName(n,f)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(l=>n(this.normalizedNames.get(l),this.headers.get(l)))}};var XC=class{encodeKey(n){return DO(n)}encodeValue(n){return DO(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function J$(o,n){let l=new Map;return o.length>0&&o.replace(/^\?/,"").split("&").forEach(f=>{let r=f.indexOf("="),[w,I]=r==-1?[n.decodeKey(f),""]:[n.decodeKey(f.slice(0,r)),n.decodeValue(f.slice(r+1))],A=l.get(w)||[];A.push(I),l.set(w,A)}),l}var eG=/%(\d[a-f0-9])/gi,tG={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function DO(o){return encodeURIComponent(o).replace(eG,(n,l)=>tG[l]??n)}function Nx(o){return`${o}`}var Wc=class o{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new XC,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=J$(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(l=>{let c=n.fromObject[l],f=Array.isArray(c)?c.map(Nx):[Nx(c)];this.map.set(l,f)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let l=this.map.get(n);return l?l[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,l){return this.clone({param:n,value:l,op:"a"})}appendAll(n){let l=[];return Object.keys(n).forEach(c=>{let f=n[c];Array.isArray(f)?f.forEach(r=>{l.push({param:c,value:r,op:"a"})}):l.push({param:c,value:f,op:"a"})}),this.clone(l)}set(n,l){return this.clone({param:n,value:l,op:"s"})}delete(n,l){return this.clone({param:n,value:l,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let l=this.encoder.encodeKey(n);return this.map.get(n).map(c=>l+"="+this.encoder.encodeValue(c)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let l=new o({encoder:this.encoder});return l.cloneFrom=this.cloneFrom||this,l.updates=(this.updates||[]).concat(n),l}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let l=(n.op==="a"?this.map.get(n.param):void 0)||[];l.push(Nx(n.value)),this.map.set(n.param,l);break;case"d":if(n.value!==void 0){let c=this.map.get(n.param)||[],f=c.indexOf(Nx(n.value));f!==-1&&c.splice(f,1),c.length>0?this.map.set(n.param,c):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var KC=class{constructor(){this.map=new Map}set(n,l){return this.map.set(n,l),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function nG(o){switch(o){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function SO(o){return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer}function MO(o){return typeof Blob<"u"&&o instanceof Blob}function AO(o){return typeof FormData<"u"&&o instanceof FormData}function iG(o){return typeof URLSearchParams<"u"&&o instanceof URLSearchParams}var Kg=class o{constructor(n,l,c,f){this.url=l,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase();let r;if(nG(this.method)||f?(this.body=c!==void 0?c:null,r=f):r=c,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new Uh,this.context??=new KC,!this.params)this.params=new Wc,this.urlWithParams=l;else{let w=this.params.toString();if(w.length===0)this.urlWithParams=l;else{let I=l.indexOf("?"),A=I===-1?"?":I<l.length-1?"&":"";this.urlWithParams=l+A+w}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||SO(this.body)||MO(this.body)||AO(this.body)||iG(this.body)?this.body:this.body instanceof Wc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||AO(this.body)?null:MO(this.body)?this.body.type||null:SO(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Wc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(n={}){let l=n.method||this.method,c=n.url||this.url,f=n.responseType||this.responseType,r=n.transferCache??this.transferCache,w=n.body!==void 0?n.body:this.body,I=n.withCredentials??this.withCredentials,A=n.reportProgress??this.reportProgress,L=n.headers||this.headers,U=n.params||this.params,Q=n.context??this.context;return n.setHeaders!==void 0&&(L=Object.keys(n.setHeaders).reduce((fe,he)=>fe.set(he,n.setHeaders[he]),L)),n.setParams&&(U=Object.keys(n.setParams).reduce((fe,he)=>fe.set(he,n.setParams[he]),U)),new o(l,c,w,{params:U,headers:L,context:Q,reportProgress:A,responseType:f,withCredentials:I,transferCache:r})}},up=function(o){return o[o.Sent=0]="Sent",o[o.UploadProgress=1]="UploadProgress",o[o.ResponseHeader=2]="ResponseHeader",o[o.DownloadProgress=3]="DownloadProgress",o[o.Response=4]="Response",o[o.User=5]="User",o}(up||{}),Jg=class{constructor(n,l=jx.Ok,c="OK"){this.headers=n.headers||new Uh,this.status=n.status!==void 0?n.status:l,this.statusText=n.statusText||c,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},QC=class o extends Jg{constructor(n={}){super(n),this.type=up.ResponseHeader}clone(n={}){return new o({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Bx=class o extends Jg{constructor(n={}){super(n),this.type=up.Response,this.body=n.body!==void 0?n.body:null}clone(n={}){return new o({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Vx=class extends Jg{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},jx=function(o){return o[o.Continue=100]="Continue",o[o.SwitchingProtocols=101]="SwitchingProtocols",o[o.Processing=102]="Processing",o[o.EarlyHints=103]="EarlyHints",o[o.Ok=200]="Ok",o[o.Created=201]="Created",o[o.Accepted=202]="Accepted",o[o.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",o[o.NoContent=204]="NoContent",o[o.ResetContent=205]="ResetContent",o[o.PartialContent=206]="PartialContent",o[o.MultiStatus=207]="MultiStatus",o[o.AlreadyReported=208]="AlreadyReported",o[o.ImUsed=226]="ImUsed",o[o.MultipleChoices=300]="MultipleChoices",o[o.MovedPermanently=301]="MovedPermanently",o[o.Found=302]="Found",o[o.SeeOther=303]="SeeOther",o[o.NotModified=304]="NotModified",o[o.UseProxy=305]="UseProxy",o[o.Unused=306]="Unused",o[o.TemporaryRedirect=307]="TemporaryRedirect",o[o.PermanentRedirect=308]="PermanentRedirect",o[o.BadRequest=400]="BadRequest",o[o.Unauthorized=401]="Unauthorized",o[o.PaymentRequired=402]="PaymentRequired",o[o.Forbidden=403]="Forbidden",o[o.NotFound=404]="NotFound",o[o.MethodNotAllowed=405]="MethodNotAllowed",o[o.NotAcceptable=406]="NotAcceptable",o[o.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",o[o.RequestTimeout=408]="RequestTimeout",o[o.Conflict=409]="Conflict",o[o.Gone=410]="Gone",o[o.LengthRequired=411]="LengthRequired",o[o.PreconditionFailed=412]="PreconditionFailed",o[o.PayloadTooLarge=413]="PayloadTooLarge",o[o.UriTooLong=414]="UriTooLong",o[o.UnsupportedMediaType=415]="UnsupportedMediaType",o[o.RangeNotSatisfiable=416]="RangeNotSatisfiable",o[o.ExpectationFailed=417]="ExpectationFailed",o[o.ImATeapot=418]="ImATeapot",o[o.MisdirectedRequest=421]="MisdirectedRequest",o[o.UnprocessableEntity=422]="UnprocessableEntity",o[o.Locked=423]="Locked",o[o.FailedDependency=424]="FailedDependency",o[o.TooEarly=425]="TooEarly",o[o.UpgradeRequired=426]="UpgradeRequired",o[o.PreconditionRequired=428]="PreconditionRequired",o[o.TooManyRequests=429]="TooManyRequests",o[o.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",o[o.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",o[o.InternalServerError=500]="InternalServerError",o[o.NotImplemented=501]="NotImplemented",o[o.BadGateway=502]="BadGateway",o[o.ServiceUnavailable=503]="ServiceUnavailable",o[o.GatewayTimeout=504]="GatewayTimeout",o[o.HttpVersionNotSupported=505]="HttpVersionNotSupported",o[o.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",o[o.InsufficientStorage=507]="InsufficientStorage",o[o.LoopDetected=508]="LoopDetected",o[o.NotExtended=510]="NotExtended",o[o.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",o}(jx||{});function YC(o,n){return{body:n,headers:o.headers,context:o.context,observe:o.observe,params:o.params,reportProgress:o.reportProgress,responseType:o.responseType,withCredentials:o.withCredentials,transferCache:o.transferCache}}var JC=(()=>{let n=class n{constructor(c){this.handler=c}request(c,f,r={}){let w;if(c instanceof Kg)w=c;else{let L;r.headers instanceof Uh?L=r.headers:L=new Uh(r.headers);let U;r.params&&(r.params instanceof Wc?U=r.params:U=new Wc({fromObject:r.params})),w=new Kg(c,f,r.body!==void 0?r.body:null,{headers:L,context:r.context,params:U,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let I=un(w).pipe(Lc(L=>this.handler.handle(L)));if(c instanceof Kg||r.observe==="events")return I;let A=I.pipe(io(L=>L instanceof Bx));switch(r.observe||"body"){case"body":switch(w.responseType){case"arraybuffer":return A.pipe(Sn(L=>{if(L.body!==null&&!(L.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return L.body}));case"blob":return A.pipe(Sn(L=>{if(L.body!==null&&!(L.body instanceof Blob))throw new Error("Response is not a Blob.");return L.body}));case"text":return A.pipe(Sn(L=>{if(L.body!==null&&typeof L.body!="string")throw new Error("Response is not a string.");return L.body}));case"json":default:return A.pipe(Sn(L=>L.body))}case"response":return A;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(c,f={}){return this.request("DELETE",c,f)}get(c,f={}){return this.request("GET",c,f)}head(c,f={}){return this.request("HEAD",c,f)}jsonp(c,f){return this.request("JSONP",c,{params:new Wc().append(f,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(c,f={}){return this.request("OPTIONS",c,f)}patch(c,f,r={}){return this.request("PATCH",c,YC(r,f))}post(c,f,r={}){return this.request("POST",c,YC(r,f))}put(c,f,r={}){return this.request("PUT",c,YC(r,f))}};n.\u0275fac=function(f){return new(f||n)(Ut(Qg))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function OO(o,n){return n(o)}function rG(o,n){return(l,c)=>n.intercept(l,{handle:f=>o(f,c)})}function oG(o,n,l){return(c,f)=>Us(l,()=>n(c,r=>o(r,f)))}var sG=new an(""),eI=new an(""),aG=new an(""),lG=new an("");function cG(){let o=null;return(n,l)=>{o===null&&(o=(bt(sG,{optional:!0})??[]).reduceRight(rG,OO));let c=bt(Lh),f=c.add();return o(n,l).pipe(ya(()=>c.remove(f)))}}var PO=(()=>{let n=class n extends Qg{constructor(c,f){super(),this.backend=c,this.injector=f,this.chain=null,this.pendingTasks=bt(Lh);let r=bt(lG,{optional:!0});this.backend=r??c}handle(c){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(eI),...this.injector.get(aG,[])]));this.chain=r.reduceRight((w,I)=>oG(w,I,this.injector),OO)}let f=this.pendingTasks.add();return this.chain(c,r=>this.backend.handle(r)).pipe(ya(()=>this.pendingTasks.remove(f)))}};n.\u0275fac=function(f){return new(f||n)(Ut(zx),Ut(To))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();var uG=/^\)\]\}',?\n/;function hG(o){return"responseURL"in o&&o.responseURL?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):null}var RO=(()=>{let n=class n{constructor(c){this.xhrFactory=c}handle(c){if(c.method==="JSONP")throw new xt(-2800,!1);let f=this.xhrFactory;return(f.\u0275loadImpl?er(f.\u0275loadImpl()):un(null)).pipe(wo(()=>new ri(w=>{let I=f.build();if(I.open(c.method,c.urlWithParams),c.withCredentials&&(I.withCredentials=!0),c.headers.forEach((Ke,Fe)=>I.setRequestHeader(Ke,Fe.join(","))),c.headers.has("Accept")||I.setRequestHeader("Accept","application/json, text/plain, */*"),!c.headers.has("Content-Type")){let Ke=c.detectContentTypeHeader();Ke!==null&&I.setRequestHeader("Content-Type",Ke)}if(c.responseType){let Ke=c.responseType.toLowerCase();I.responseType=Ke!=="json"?Ke:"text"}let A=c.serializeBody(),L=null,U=()=>{if(L!==null)return L;let Ke=I.statusText||"OK",Fe=new Uh(I.getAllResponseHeaders()),tt=hG(I)||c.url;return L=new QC({headers:Fe,status:I.status,statusText:Ke,url:tt}),L},Q=()=>{let{headers:Ke,status:Fe,statusText:tt,url:ft}=U(),Ue=null;Fe!==jx.NoContent&&(Ue=typeof I.response>"u"?I.responseText:I.response),Fe===0&&(Fe=Ue?jx.Ok:0);let Vt=Fe>=200&&Fe<300;if(c.responseType==="json"&&typeof Ue=="string"){let Jt=Ue;Ue=Ue.replace(uG,"");try{Ue=Ue!==""?JSON.parse(Ue):null}catch(nn){Ue=Jt,Vt&&(Vt=!1,Ue={error:nn,text:Ue})}}Vt?(w.next(new Bx({body:Ue,headers:Ke,status:Fe,statusText:tt,url:ft||void 0})),w.complete()):w.error(new Vx({error:Ue,headers:Ke,status:Fe,statusText:tt,url:ft||void 0}))},fe=Ke=>{let{url:Fe}=U(),tt=new Vx({error:Ke,status:I.status||0,statusText:I.statusText||"Unknown Error",url:Fe||void 0});w.error(tt)},he=!1,be=Ke=>{he||(w.next(U()),he=!0);let Fe={type:up.DownloadProgress,loaded:Ke.loaded};Ke.lengthComputable&&(Fe.total=Ke.total),c.responseType==="text"&&I.responseText&&(Fe.partialText=I.responseText),w.next(Fe)},De=Ke=>{let Fe={type:up.UploadProgress,loaded:Ke.loaded};Ke.lengthComputable&&(Fe.total=Ke.total),w.next(Fe)};return I.addEventListener("load",Q),I.addEventListener("error",fe),I.addEventListener("timeout",fe),I.addEventListener("abort",fe),c.reportProgress&&(I.addEventListener("progress",be),A!==null&&I.upload&&I.upload.addEventListener("progress",De)),I.send(A),w.next({type:up.Sent}),()=>{I.removeEventListener("error",fe),I.removeEventListener("abort",fe),I.removeEventListener("load",Q),I.removeEventListener("timeout",fe),c.reportProgress&&(I.removeEventListener("progress",be),A!==null&&I.upload&&I.upload.removeEventListener("progress",De)),I.readyState!==I.DONE&&I.abort()}})))}};n.\u0275fac=function(f){return new(f||n)(Ut(lp))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),LO=new an(""),dG="XSRF-TOKEN",fG=new an("",{providedIn:"root",factory:()=>dG}),pG="X-XSRF-TOKEN",mG=new an("",{providedIn:"root",factory:()=>pG}),Ux=class{},gG=(()=>{let n=class n{constructor(c,f,r){this.doc=c,this.platform=f,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let c=this.doc.cookie||"";return c!==this.lastCookieString&&(this.parseCount++,this.lastToken=kx(c,this.cookieName),this.lastCookieString=c),this.lastToken}};n.\u0275fac=function(f){return new(f||n)(Ut(Pi),Ut(Gs),Ut(fG))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function _G(o,n){let l=o.url.toLowerCase();if(!bt(LO)||o.method==="GET"||o.method==="HEAD"||l.startsWith("http://")||l.startsWith("https://"))return n(o);let c=bt(Ux).getToken(),f=bt(mG);return c!=null&&!o.headers.has(f)&&(o=o.clone({headers:o.headers.set(f,c)})),n(o)}var FO=function(o){return o[o.Interceptors=0]="Interceptors",o[o.LegacyInterceptors=1]="LegacyInterceptors",o[o.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",o[o.NoXsrfProtection=3]="NoXsrfProtection",o[o.JsonpSupport=4]="JsonpSupport",o[o.RequestsMadeViaParent=5]="RequestsMadeViaParent",o[o.Fetch=6]="Fetch",o}(FO||{});function yG(o,n){return{\u0275kind:o,\u0275providers:n}}function tI(...o){let n=[JC,RO,PO,{provide:Qg,useExisting:PO},{provide:zx,useExisting:RO},{provide:eI,useValue:_G,multi:!0},{provide:LO,useValue:!0},{provide:Ux,useClass:gG}];for(let l of o)n.push(...l.\u0275providers);return $c(n)}var kO=new an("");function vG(){return yG(FO.LegacyInterceptors,[{provide:kO,useFactory:cG},{provide:eI,useExisting:kO,multi:!0}])}var NO=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=ur({type:n}),n.\u0275inj=cr({providers:[tI(vG())]});let o=n;return o})();var rI=class extends Sx{constructor(){super(...arguments),this.supportsDOMEvents=!0}},oI=class o extends rI{static makeCurrent(){wO(new o)}onAndCancel(n,l,c){return n.addEventListener(l,c),()=>{n.removeEventListener(l,c)}}dispatchEvent(n,l){n.dispatchEvent(l)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,l){return l=l||this.getDefaultDocument(),l.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,l){return l==="window"?window:l==="document"?n:l==="body"?n.body:null}getBaseHref(n){let l=bG();return l==null?null:wG(l)}resetBaseElement(){e_=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return kx(document.cookie,n)}},e_=null;function bG(){return e_=e_||document.querySelector("base"),e_?e_.getAttribute("href"):null}function wG(o){return new URL(o,document.baseURI).pathname}var EG=(()=>{let n=class n{build(){return new XMLHttpRequest}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),sI=new an(""),VO=(()=>{let n=class n{constructor(c,f){this._zone=f,this._eventNameToPlugin=new Map,c.forEach(r=>{r.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,f,r){return this._findPluginFor(f).addEventListener(c,f,r)}getZone(){return this._zone}_findPluginFor(c){let f=this._eventNameToPlugin.get(c);if(f)return f;if(f=this._plugins.find(w=>w.supports(c)),!f)throw new xt(5101,!1);return this._eventNameToPlugin.set(c,f),f}};n.\u0275fac=function(f){return new(f||n)(Ut(sI),Ut(fi))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),$x=class{constructor(n){this._doc=n}},nI="ng-app-id",jO=(()=>{let n=class n{constructor(c,f,r,w={}){this.doc=c,this.appId=f,this.nonce=r,this.platformId=w,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Fx(w),this.resetHostNodes()}addStyles(c){for(let f of c)this.changeUsageCount(f,1)===1&&this.onStyleAdded(f)}removeStyles(c){for(let f of c)this.changeUsageCount(f,-1)<=0&&this.onStyleRemoved(f)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(f=>f.remove()),c.clear());for(let f of this.getAllStyles())this.onStyleRemoved(f);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let f of this.getAllStyles())this.addStyleToHost(c,f)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let f of this.hostNodes)this.addStyleToHost(f,c)}onStyleRemoved(c){let f=this.styleRef;f.get(c)?.elements?.forEach(r=>r.remove()),f.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${nI}="${this.appId}"]`);if(c?.length){let f=new Map;return c.forEach(r=>{r.textContent!=null&&f.set(r.textContent,r)}),f}return null}changeUsageCount(c,f){let r=this.styleRef;if(r.has(c)){let w=r.get(c);return w.usage+=f,w.usage}return r.set(c,{usage:f,elements:[]}),f}getStyleElement(c,f){let r=this.styleNodesInDOM,w=r?.get(f);if(w?.parentNode===c)return r.delete(f),w.removeAttribute(nI),w;{let I=this.doc.createElement("style");return this.nonce&&I.setAttribute("nonce",this.nonce),I.textContent=f,this.platformIsServer&&I.setAttribute(nI,this.appId),c.appendChild(I),I}}addStyleToHost(c,f){let r=this.getStyleElement(c,f),w=this.styleRef,I=w.get(f)?.elements;I?I.push(r):w.set(f,{elements:[r],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}};n.\u0275fac=function(f){return new(f||n)(Ut(Pi),Ut(hx),Ut(qg,8),Ut(Gs))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),iI={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},lI=/%COMP%/g,UO="%COMP%",TG=`_nghost-${UO}`,CG=`_ngcontent-${UO}`,IG=!0,DG=new an("",{providedIn:"root",factory:()=>IG});function SG(o){return CG.replace(lI,o)}function MG(o){return TG.replace(lI,o)}function $O(o,n){return n.map(l=>l.replace(lI,o))}var Gx=(()=>{let n=class n{constructor(c,f,r,w,I,A,L,U=null){this.eventManager=c,this.sharedStylesHost=f,this.appId=r,this.removeStylesOnCompDestroy=w,this.doc=I,this.platformId=A,this.ngZone=L,this.nonce=U,this.rendererByCompId=new Map,this.platformIsServer=Fx(A),this.defaultRenderer=new t_(c,I,L,this.platformIsServer)}createRenderer(c,f){if(!c||!f)return this.defaultRenderer;this.platformIsServer&&f.encapsulation===wa.ShadowDom&&(f=hi(gt({},f),{encapsulation:wa.Emulated}));let r=this.getOrCreateRenderer(c,f);return r instanceof Hx?r.applyToHost(c):r instanceof n_&&r.applyStyles(),r}getOrCreateRenderer(c,f){let r=this.rendererByCompId,w=r.get(f.id);if(!w){let I=this.doc,A=this.ngZone,L=this.eventManager,U=this.sharedStylesHost,Q=this.removeStylesOnCompDestroy,fe=this.platformIsServer;switch(f.encapsulation){case wa.Emulated:w=new Hx(L,U,f,this.appId,Q,I,A,fe);break;case wa.ShadowDom:return new aI(L,U,c,f,I,A,this.nonce,fe);default:w=new n_(L,U,f,Q,I,A,fe);break}r.set(f.id,w)}return w}ngOnDestroy(){this.rendererByCompId.clear()}};n.\u0275fac=function(f){return new(f||n)(Ut(VO),Ut(jO),Ut(hx),Ut(DG),Ut(Pi),Ut(Gs),Ut(fi),Ut(qg))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),t_=class{constructor(n,l,c,f){this.eventManager=n,this.doc=l,this.ngZone=c,this.platformIsServer=f,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,l){return l?this.doc.createElementNS(iI[l]||l,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,l){(zO(n)?n.content:n).appendChild(l)}insertBefore(n,l,c){n&&(zO(n)?n.content:n).insertBefore(l,c)}removeChild(n,l){n&&n.removeChild(l)}selectRootElement(n,l){let c=typeof n=="string"?this.doc.querySelector(n):n;if(!c)throw new xt(-5104,!1);return l||(c.textContent=""),c}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,l,c,f){if(f){l=f+":"+l;let r=iI[f];r?n.setAttributeNS(r,l,c):n.setAttribute(l,c)}else n.setAttribute(l,c)}removeAttribute(n,l,c){if(c){let f=iI[c];f?n.removeAttributeNS(f,l):n.removeAttribute(`${c}:${l}`)}else n.removeAttribute(l)}addClass(n,l){n.classList.add(l)}removeClass(n,l){n.classList.remove(l)}setStyle(n,l,c,f){f&(Ia.DashCase|Ia.Important)?n.style.setProperty(l,c,f&Ia.Important?"important":""):n.style[l]=c}removeStyle(n,l,c){c&Ia.DashCase?n.style.removeProperty(l):n.style[l]=""}setProperty(n,l,c){n!=null&&(n[l]=c)}setValue(n,l){n.nodeValue=l}listen(n,l,c){if(typeof n=="string"&&(n=ap().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${l}`);return this.eventManager.addEventListener(n,l,this.decoratePreventDefault(c))}decoratePreventDefault(n){return l=>{if(l==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(l)):n(l))===!1&&l.preventDefault()}}};function zO(o){return o.tagName==="TEMPLATE"&&o.content!==void 0}var aI=class extends t_{constructor(n,l,c,f,r,w,I,A){super(n,r,w,A),this.sharedStylesHost=l,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let L=$O(f.id,f.styles);for(let U of L){let Q=document.createElement("style");I&&Q.setAttribute("nonce",I),Q.textContent=U,this.shadowRoot.appendChild(Q)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,l){return super.appendChild(this.nodeOrShadowRoot(n),l)}insertBefore(n,l,c){return super.insertBefore(this.nodeOrShadowRoot(n),l,c)}removeChild(n,l){return super.removeChild(this.nodeOrShadowRoot(n),l)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},n_=class extends t_{constructor(n,l,c,f,r,w,I,A){super(n,r,w,I),this.sharedStylesHost=l,this.removeStylesOnCompDestroy=f,this.styles=A?$O(A,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Hx=class extends n_{constructor(n,l,c,f,r,w,I,A){let L=f+"-"+c.id;super(n,l,c,r,w,I,A,L),this.contentAttr=SG(L),this.hostAttr=MG(L)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,l){let c=super.createElement(n,l);return super.setAttribute(c,this.contentAttr,""),c}},AG=(()=>{let n=class n extends $x{constructor(c){super(c)}supports(c){return!0}addEventListener(c,f,r){return c.addEventListener(f,r,!1),()=>this.removeEventListener(c,f,r)}removeEventListener(c,f,r){return c.removeEventListener(f,r)}};n.\u0275fac=function(f){return new(f||n)(Ut(Pi))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),BO=["alt","control","meta","shift"],PG={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},RG={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey},kG=(()=>{let n=class n extends $x{constructor(c){super(c)}supports(c){return n.parseEventName(c)!=null}addEventListener(c,f,r){let w=n.parseEventName(f),I=n.eventCallback(w.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ap().onAndCancel(c,w.domEventName,I))}static parseEventName(c){let f=c.toLowerCase().split("."),r=f.shift();if(f.length===0||!(r==="keydown"||r==="keyup"))return null;let w=n._normalizeKey(f.pop()),I="",A=f.indexOf("code");if(A>-1&&(f.splice(A,1),I="code."),BO.forEach(U=>{let Q=f.indexOf(U);Q>-1&&(f.splice(Q,1),I+=U+".")}),I+=w,f.length!=0||w.length===0)return null;let L={};return L.domEventName=r,L.fullKey=I,L}static matchEventFullKeyCode(c,f){let r=PG[c.key]||c.key,w="";return f.indexOf("code.")>-1&&(r=c.code,w="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),BO.forEach(I=>{if(I!==r){let A=RG[I];A(c)&&(w+=I+".")}}),w+=r,w===f)}static eventCallback(c,f,r){return w=>{n.matchEventFullKeyCode(w,c)&&r.runGuarded(()=>f(w))}}static _normalizeKey(c){return c==="esc"?"escape":c}};n.\u0275fac=function(f){return new(f||n)(Ut(Pi))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function GO(o,n){return fO(gt({rootComponent:o},OG(n)))}function OG(o){return{appProviders:[...BG,...o?.providers??[]],platformProviders:zG}}function LG(){oI.makeCurrent()}function FG(){return new Ca}function NG(){return bk(document),document}var zG=[{provide:Gs,useValue:ZC},{provide:xC,useValue:LG,multi:!0},{provide:Pi,useFactory:NG,deps:[]}];var BG=[{provide:ix,useValue:"root"},{provide:Ca,useFactory:FG,deps:[]},{provide:sI,useClass:AG,multi:!0,deps:[Pi,fi,Gs]},{provide:sI,useClass:kG,multi:!0,deps:[Pi]},Gx,jO,VO,{provide:Ih,useExisting:Gx},{provide:lp,useClass:EG,deps:[]},[]];var HO=(()=>{let n=class n{constructor(c){this._doc=c}getTitle(){return this._doc.title}setTitle(c){this._doc.title=c||""}};n.\u0275fac=function(f){return new(f||n)(Ut(Pi))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Nn="primary",__=Symbol("RouteTitle"),fI=class{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let l=this.params[n];return Array.isArray(l)?l[0]:l}return null}getAll(n){if(this.has(n)){let l=this.params[n];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}};function mp(o){return new fI(o)}function jG(o,n,l){let c=l.path.split("/");if(c.length>o.length||l.pathMatch==="full"&&(n.hasChildren()||c.length<o.length))return null;let f={};for(let r=0;r<c.length;r++){let w=c[r],I=o[r];if(w.startsWith(":"))f[w.substring(1)]=I;else if(w!==I.path)return null}return{consumed:o.slice(0,c.length),posParams:f}}function UG(o,n){if(o.length!==n.length)return!1;for(let l=0;l<o.length;++l)if(!Ma(o[l],n[l]))return!1;return!0}function Ma(o,n){let l=o?pI(o):void 0,c=n?pI(n):void 0;if(!l||!c||l.length!=c.length)return!1;let f;for(let r=0;r<l.length;r++)if(f=l[r],!QO(o[f],n[f]))return!1;return!0}function pI(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function QO(o,n){if(Array.isArray(o)&&Array.isArray(n)){if(o.length!==n.length)return!1;let l=[...o].sort(),c=[...n].sort();return l.every((f,r)=>c[r]===f)}else return o===n}function JO(o){return o.length>0?o[o.length-1]:null}function Xc(o){return FE(o)?o:op(o)?er(Promise.resolve(o)):un(o)}var $G={exact:tL,subset:nL},eL={exact:GG,subset:HG,ignored:()=>!0};function qO(o,n,l){return $G[l.paths](o.root,n.root,l.matrixParams)&&eL[l.queryParams](o.queryParams,n.queryParams)&&!(l.fragment==="exact"&&o.fragment!==n.fragment)}function GG(o,n){return Ma(o,n)}function tL(o,n,l){if(!Gh(o.segments,n.segments)||!Zx(o.segments,n.segments,l)||o.numberOfChildren!==n.numberOfChildren)return!1;for(let c in n.children)if(!o.children[c]||!tL(o.children[c],n.children[c],l))return!1;return!0}function HG(o,n){return Object.keys(n).length<=Object.keys(o).length&&Object.keys(n).every(l=>QO(o[l],n[l]))}function nL(o,n,l){return iL(o,n,n.segments,l)}function iL(o,n,l,c){if(o.segments.length>l.length){let f=o.segments.slice(0,l.length);return!(!Gh(f,l)||n.hasChildren()||!Zx(f,l,c))}else if(o.segments.length===l.length){if(!Gh(o.segments,l)||!Zx(o.segments,l,c))return!1;for(let f in n.children)if(!o.children[f]||!nL(o.children[f],n.children[f],c))return!1;return!0}else{let f=l.slice(0,o.segments.length),r=l.slice(o.segments.length);return!Gh(o.segments,f)||!Zx(o.segments,f,c)||!o.children[Nn]?!1:iL(o.children[Nn],n,r,c)}}function Zx(o,n,l){return n.every((c,f)=>eL[l](o[f].parameters,c.parameters))}var Zc=class{constructor(n=new wi([],{}),l={},c=null){this.root=n,this.queryParams=l,this.fragment=c}get queryParamMap(){return this._queryParamMap??=mp(this.queryParams),this._queryParamMap}toString(){return ZG.serialize(this)}},wi=class{constructor(n,l){this.segments=n,this.children=l,this.parent=null,Object.values(l).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Yx(this)}},$h=class{constructor(n,l){this.path=n,this.parameters=l}get parameterMap(){return this._parameterMap??=mp(this.parameters),this._parameterMap}toString(){return oL(this)}};function qG(o,n){return Gh(o,n)&&o.every((l,c)=>Ma(l.parameters,n[c].parameters))}function Gh(o,n){return o.length!==n.length?!1:o.every((l,c)=>l.path===n[c].path)}function WG(o,n){let l=[];return Object.entries(o.children).forEach(([c,f])=>{c===Nn&&(l=l.concat(n(f,c)))}),Object.entries(o.children).forEach(([c,f])=>{c!==Nn&&(l=l.concat(n(f,c)))}),l}var VI=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>new Kx,providedIn:"root"});let o=n;return o})(),Kx=class{parse(n){let l=new gI(n);return new Zc(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(n){let l=`/${i_(n.root,!0)}`,c=KG(n.queryParams),f=typeof n.fragment=="string"?`#${YG(n.fragment)}`:"";return`${l}${c}${f}`}},ZG=new Kx;function Yx(o){return o.segments.map(n=>oL(n)).join("/")}function i_(o,n){if(!o.hasChildren())return Yx(o);if(n){let l=o.children[Nn]?i_(o.children[Nn],!1):"",c=[];return Object.entries(o.children).forEach(([f,r])=>{f!==Nn&&c.push(`${f}:${i_(r,!1)}`)}),c.length>0?`${l}(${c.join("//")})`:l}else{let l=WG(o,(c,f)=>f===Nn?[i_(o.children[Nn],!1)]:[`${f}:${i_(c,!1)}`]);return Object.keys(o.children).length===1&&o.children[Nn]!=null?`${Yx(o)}/${l[0]}`:`${Yx(o)}/(${l.join("//")})`}}function rL(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function qx(o){return rL(o).replace(/%3B/gi,";")}function YG(o){return encodeURI(o)}function mI(o){return rL(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Xx(o){return decodeURIComponent(o)}function WO(o){return Xx(o.replace(/\+/g,"%20"))}function oL(o){return`${mI(o.path)}${XG(o.parameters)}`}function XG(o){return Object.entries(o).map(([n,l])=>`;${mI(n)}=${mI(l)}`).join("")}function KG(o){let n=Object.entries(o).map(([l,c])=>Array.isArray(c)?c.map(f=>`${qx(l)}=${qx(f)}`).join("&"):`${qx(l)}=${qx(c)}`).filter(l=>l);return n.length?`?${n.join("&")}`:""}var QG=/^[^\/()?;#]+/;function cI(o){let n=o.match(QG);return n?n[0]:""}var JG=/^[^\/()?;=#]+/;function eH(o){let n=o.match(JG);return n?n[0]:""}var tH=/^[^=?&#]+/;function nH(o){let n=o.match(tH);return n?n[0]:""}var iH=/^[^&#]+/;function rH(o){let n=o.match(iH);return n?n[0]:""}var gI=class{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new wi([],{}):new wi([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(n.length>0||Object.keys(l).length>0)&&(c[Nn]=new wi(n,l)),c}parseSegment(){let n=cI(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new xt(4009,!1);return this.capture(n),new $h(Xx(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let l=eH(this.remaining);if(!l)return;this.capture(l);let c="";if(this.consumeOptional("=")){let f=cI(this.remaining);f&&(c=f,this.capture(c))}n[Xx(l)]=Xx(c)}parseQueryParam(n){let l=nH(this.remaining);if(!l)return;this.capture(l);let c="";if(this.consumeOptional("=")){let w=rH(this.remaining);w&&(c=w,this.capture(c))}let f=WO(l),r=WO(c);if(n.hasOwnProperty(f)){let w=n[f];Array.isArray(w)||(w=[w],n[f]=w),w.push(r)}else n[f]=r}parseParens(n){let l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=cI(this.remaining),f=this.remaining[c.length];if(f!=="/"&&f!==")"&&f!==";")throw new xt(4010,!1);let r;c.indexOf(":")>-1?(r=c.slice(0,c.indexOf(":")),this.capture(r),this.capture(":")):n&&(r=Nn);let w=this.parseChildren();l[r]=Object.keys(w).length===1?w[Nn]:new wi([],w),this.consumeOptional("//")}return l}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new xt(4011,!1)}};function sL(o){return o.segments.length>0?new wi([],{[Nn]:o}):o}function aL(o){let n={};for(let[c,f]of Object.entries(o.children)){let r=aL(f);if(c===Nn&&r.segments.length===0&&r.hasChildren())for(let[w,I]of Object.entries(r.children))n[w]=I;else(r.segments.length>0||r.hasChildren())&&(n[c]=r)}let l=new wi(o.segments,n);return oH(l)}function oH(o){if(o.numberOfChildren===1&&o.children[Nn]){let n=o.children[Nn];return new wi(o.segments.concat(n.segments),n.children)}return o}function gp(o){return o instanceof Zc}function sH(o,n,l=null,c=null){let f=lL(o);return cL(f,n,l,c)}function lL(o){let n;function l(r){let w={};for(let A of r.children){let L=l(A);w[A.outlet]=L}let I=new wi(r.url,w);return r===o&&(n=I),I}let c=l(o.root),f=sL(c);return n??f}function cL(o,n,l,c){let f=o;for(;f.parent;)f=f.parent;if(n.length===0)return uI(f,f,f,l,c);let r=aH(n);if(r.toRoot())return uI(f,f,new wi([],{}),l,c);let w=lH(r,f,o),I=w.processChildren?s_(w.segmentGroup,w.index,r.commands):hL(w.segmentGroup,w.index,r.commands);return uI(f,w.segmentGroup,I,l,c)}function Qx(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function c_(o){return typeof o=="object"&&o!=null&&o.outlets}function uI(o,n,l,c,f){let r={};c&&Object.entries(c).forEach(([A,L])=>{r[A]=Array.isArray(L)?L.map(U=>`${U}`):`${L}`});let w;o===n?w=l:w=uL(o,n,l);let I=sL(aL(w));return new Zc(I,r,f)}function uL(o,n,l){let c={};return Object.entries(o.children).forEach(([f,r])=>{r===n?c[f]=l:c[f]=uL(r,n,l)}),new wi(o.segments,c)}var Jx=class{constructor(n,l,c){if(this.isAbsolute=n,this.numberOfDoubleDots=l,this.commands=c,n&&c.length>0&&Qx(c[0]))throw new xt(4003,!1);let f=c.find(c_);if(f&&f!==JO(c))throw new xt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function aH(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new Jx(!0,0,o);let n=0,l=!1,c=o.reduce((f,r,w)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let I={};return Object.entries(r.outlets).forEach(([A,L])=>{I[A]=typeof L=="string"?L.split("/"):L}),[...f,{outlets:I}]}if(r.segmentPath)return[...f,r.segmentPath]}return typeof r!="string"?[...f,r]:w===0?(r.split("/").forEach((I,A)=>{A==0&&I==="."||(A==0&&I===""?l=!0:I===".."?n++:I!=""&&f.push(I))}),f):[...f,r]},[]);return new Jx(l,n,c)}var fp=class{constructor(n,l,c){this.segmentGroup=n,this.processChildren=l,this.index=c}};function lH(o,n,l){if(o.isAbsolute)return new fp(n,!0,0);if(!l)return new fp(n,!1,NaN);if(l.parent===null)return new fp(l,!0,0);let c=Qx(o.commands[0])?0:1,f=l.segments.length-1+c;return cH(l,f,o.numberOfDoubleDots)}function cH(o,n,l){let c=o,f=n,r=l;for(;r>f;){if(r-=f,c=c.parent,!c)throw new xt(4005,!1);f=c.segments.length}return new fp(c,!1,f-r)}function uH(o){return c_(o[0])?o[0].outlets:{[Nn]:o}}function hL(o,n,l){if(o??=new wi([],{}),o.segments.length===0&&o.hasChildren())return s_(o,n,l);let c=hH(o,n,l),f=l.slice(c.commandIndex);if(c.match&&c.pathIndex<o.segments.length){let r=new wi(o.segments.slice(0,c.pathIndex),{});return r.children[Nn]=new wi(o.segments.slice(c.pathIndex),o.children),s_(r,0,f)}else return c.match&&f.length===0?new wi(o.segments,{}):c.match&&!o.hasChildren()?_I(o,n,l):c.match?s_(o,0,f):_I(o,n,l)}function s_(o,n,l){if(l.length===0)return new wi(o.segments,{});{let c=uH(l),f={};if(Object.keys(c).some(r=>r!==Nn)&&o.children[Nn]&&o.numberOfChildren===1&&o.children[Nn].segments.length===0){let r=s_(o.children[Nn],n,l);return new wi(o.segments,r.children)}return Object.entries(c).forEach(([r,w])=>{typeof w=="string"&&(w=[w]),w!==null&&(f[r]=hL(o.children[r],n,w))}),Object.entries(o.children).forEach(([r,w])=>{c[r]===void 0&&(f[r]=w)}),new wi(o.segments,f)}}function hH(o,n,l){let c=0,f=n,r={match:!1,pathIndex:0,commandIndex:0};for(;f<o.segments.length;){if(c>=l.length)return r;let w=o.segments[f],I=l[c];if(c_(I))break;let A=`${I}`,L=c<l.length-1?l[c+1]:null;if(f>0&&A===void 0)break;if(A&&L&&typeof L=="object"&&L.outlets===void 0){if(!YO(A,L,w))return r;c+=2}else{if(!YO(A,{},w))return r;c++}f++}return{match:!0,pathIndex:f,commandIndex:c}}function _I(o,n,l){let c=o.segments.slice(0,n),f=0;for(;f<l.length;){let r=l[f];if(c_(r)){let A=dH(r.outlets);return new wi(c,A)}if(f===0&&Qx(l[0])){let A=o.segments[n];c.push(new $h(A.path,ZO(l[0]))),f++;continue}let w=c_(r)?r.outlets[Nn]:`${r}`,I=f<l.length-1?l[f+1]:null;w&&I&&Qx(I)?(c.push(new $h(w,ZO(I))),f+=2):(c.push(new $h(w,{})),f++)}return new wi(c,{})}function dH(o){let n={};return Object.entries(o).forEach(([l,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(n[l]=_I(new wi([],{}),0,c))}),n}function ZO(o){let n={};return Object.entries(o).forEach(([l,c])=>n[l]=`${c}`),n}function YO(o,n,l){return o==l.path&&Ma(n,l.parameters)}var a_="imperative",Ur=function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o}(Ur||{}),us=class{constructor(n,l){this.id=n,this.url=l}},u_=class extends us{constructor(n,l,c="imperative",f=null){super(n,l),this.type=Ur.NavigationStart,this.navigationTrigger=c,this.restoredState=f}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Hh=class extends us{constructor(n,l,c){super(n,l),this.urlAfterRedirects=c,this.type=Ur.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},$o=function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o}($o||{}),yI=function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o}(yI||{}),Yc=class extends us{constructor(n,l,c,f){super(n,l),this.reason=c,this.code=f,this.type=Ur.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},qh=class extends us{constructor(n,l,c,f){super(n,l),this.reason=c,this.code=f,this.type=Ur.NavigationSkipped}},h_=class extends us{constructor(n,l,c,f){super(n,l),this.error=c,this.target=f,this.type=Ur.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},eb=class extends us{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=Ur.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},vI=class extends us{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=Ur.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},xI=class extends us{constructor(n,l,c,f,r){super(n,l),this.urlAfterRedirects=c,this.state=f,this.shouldActivate=r,this.type=Ur.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},bI=class extends us{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=Ur.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},wI=class extends us{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=Ur.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},EI=class{constructor(n){this.route=n,this.type=Ur.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},TI=class{constructor(n){this.route=n,this.type=Ur.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},CI=class{constructor(n){this.snapshot=n,this.type=Ur.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},II=class{constructor(n){this.snapshot=n,this.type=Ur.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},DI=class{constructor(n){this.snapshot=n,this.type=Ur.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},SI=class{constructor(n){this.snapshot=n,this.type=Ur.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var d_=class{},f_=class{constructor(n){this.url=n}};var MI=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new vp,this.attachRef=null}},vp=(()=>{let n=class n{constructor(){this.contexts=new Map}onChildOutletCreated(c,f){let r=this.getOrCreateContext(c);r.outlet=f,this.contexts.set(c,r)}onChildOutletDestroyed(c){let f=this.getContext(c);f&&(f.outlet=null,f.attachRef=null)}onOutletDeactivated(){let c=this.contexts;return this.contexts=new Map,c}onOutletReAttached(c){this.contexts=c}getOrCreateContext(c){let f=this.getContext(c);return f||(f=new MI,this.contexts.set(c,f)),f}getContext(c){return this.contexts.get(c)||null}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),tb=class{constructor(n){this._root=n}get root(){return this._root.value}parent(n){let l=this.pathFromRoot(n);return l.length>1?l[l.length-2]:null}children(n){let l=AI(n,this._root);return l?l.children.map(c=>c.value):[]}firstChild(n){let l=AI(n,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(n){let l=PI(n,this._root);return l.length<2?[]:l[l.length-2].children.map(f=>f.value).filter(f=>f!==n)}pathFromRoot(n){return PI(n,this._root).map(l=>l.value)}};function AI(o,n){if(o===n.value)return n;for(let l of n.children){let c=AI(o,l);if(c)return c}return null}function PI(o,n){if(o===n.value)return[n];for(let l of n.children){let c=PI(o,l);if(c.length)return c.unshift(n),c}return[]}var Uo=class{constructor(n,l){this.value=n,this.children=l}toString(){return`TreeNode(${this.value})`}};function dp(o){let n={};return o&&o.children.forEach(l=>n[l.value.outlet]=l),n}var nb=class extends tb{constructor(n,l){super(n),this.snapshot=l,UI(this,n)}toString(){return this.snapshot.toString()}};function dL(o){let n=fH(o),l=new wr([new $h("",{})]),c=new wr({}),f=new wr({}),r=new wr({}),w=new wr(""),I=new _p(l,c,r,w,f,Nn,o,n.root);return I.snapshot=n.root,new nb(new Uo(I,[]),n)}function fH(o){let n={},l={},c={},f="",r=new p_([],n,c,f,l,Nn,o,null,{});return new ib("",new Uo(r,[]))}var _p=class{constructor(n,l,c,f,r,w,I,A){this.urlSubject=n,this.paramsSubject=l,this.queryParamsSubject=c,this.fragmentSubject=f,this.dataSubject=r,this.outlet=w,this.component=I,this._futureSnapshot=A,this.title=this.dataSubject?.pipe(Sn(L=>L[__]))??un(void 0),this.url=n,this.params=l,this.queryParams=c,this.fragment=f,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Sn(n=>mp(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Sn(n=>mp(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function jI(o,n,l="emptyOnly"){let c,{routeConfig:f}=o;return n!==null&&(l==="always"||f?.path===""||!n.component&&!n.routeConfig?.loadComponent)?c={params:gt(gt({},n.params),o.params),data:gt(gt({},n.data),o.data),resolve:gt(gt(gt(gt({},o.data),n.data),f?.data),o._resolvedData)}:c={params:gt({},o.params),data:gt({},o.data),resolve:gt(gt({},o.data),o._resolvedData??{})},f&&pL(f)&&(c.resolve[__]=f.title),c}var p_=class{get title(){return this.data?.[__]}constructor(n,l,c,f,r,w,I,A,L){this.url=n,this.params=l,this.queryParams=c,this.fragment=f,this.data=r,this.outlet=w,this.component=I,this.routeConfig=A,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=mp(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=mp(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(c=>c.toString()).join("/"),l=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${l}')`}},ib=class extends tb{constructor(n,l){super(l),this.url=n,UI(this,l)}toString(){return fL(this._root)}};function UI(o,n){n.value._routerState=o,n.children.forEach(l=>UI(o,l))}function fL(o){let n=o.children.length>0?` { ${o.children.map(fL).join(", ")} } `:"";return`${o.value}${n}`}function hI(o){if(o.snapshot){let n=o.snapshot,l=o._futureSnapshot;o.snapshot=l,Ma(n.queryParams,l.queryParams)||o.queryParamsSubject.next(l.queryParams),n.fragment!==l.fragment&&o.fragmentSubject.next(l.fragment),Ma(n.params,l.params)||o.paramsSubject.next(l.params),UG(n.url,l.url)||o.urlSubject.next(l.url),Ma(n.data,l.data)||o.dataSubject.next(l.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function RI(o,n){let l=Ma(o.params,n.params)&&qG(o.url,n.url),c=!o.parent!=!n.parent;return l&&!c&&(!o.parent||RI(o.parent,n.parent))}function pL(o){return typeof o.title=="string"||o.title===null}var $I=(()=>{let n=class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=Nn,this.activateEvents=new zr,this.deactivateEvents=new zr,this.attachEvents=new zr,this.detachEvents=new zr,this.parentContexts=bt(vp),this.location=bt(xl),this.changeDetector=bt(Hc),this.environmentInjector=bt(To),this.inputBinder=bt(ab,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(c){if(c.name){let{firstChange:f,previousValue:r}=c.name;if(f)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(c){return this.parentContexts.getContext(c)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let c=this.parentContexts.getContext(this.name);c?.route&&(c.attachRef?this.attach(c.attachRef,c.route):this.activateWith(c.route,c.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new xt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new xt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new xt(4012,!1);this.location.detach();let c=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(c.instance),c}attach(c,f){this.activated=c,this._activatedRoute=f,this.location.insert(c.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(c.instance)}deactivate(){if(this.activated){let c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(c,f){if(this.isActivated)throw new xt(4013,!1);this._activatedRoute=c;let r=this.location,I=c.snapshot.component,A=this.parentContexts.getOrCreateContext(this.name).children,L=new kI(c,A,r.injector);this.activated=r.createComponent(I,{index:r.length,injector:L,environmentInjector:f??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275dir=cs({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Mh]});let o=n;return o})(),kI=class o{__ngOutletInjector(n){return new o(this.route,this.childContexts,n)}constructor(n,l,c){this.route=n,this.childContexts=l,this.parent=c}get(n,l){return n===_p?this.route:n===vp?this.childContexts:this.parent.get(n,l)}},ab=new an(""),XO=(()=>{let n=class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(c){this.unsubscribeFromRouteData(c),this.subscribeToRouteData(c)}unsubscribeFromRouteData(c){this.outletDataSubscriptions.get(c)?.unsubscribe(),this.outletDataSubscriptions.delete(c)}subscribeToRouteData(c){let{activatedRoute:f}=c,r=_h([f.queryParams,f.params,f.data]).pipe(wo(([w,I,A],L)=>(A=gt(gt(gt({},w),I),A),L===0?un(A):Promise.resolve(A)))).subscribe(w=>{if(!c.isActivated||!c.activatedComponentRef||c.activatedRoute!==f||f.component===null){this.unsubscribeFromRouteData(c);return}let I=pO(f.component);if(!I){this.unsubscribeFromRouteData(c);return}for(let{templateName:A}of I.inputs)c.activatedComponentRef.setInput(A,w[A])});this.outletDataSubscriptions.set(c,r)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function pH(o,n,l){let c=m_(o,n._root,l?l._root:void 0);return new nb(c,n)}function m_(o,n,l){if(l&&o.shouldReuseRoute(n.value,l.value.snapshot)){let c=l.value;c._futureSnapshot=n.value;let f=mH(o,n,l);return new Uo(c,f)}else{if(o.shouldAttach(n.value)){let r=o.retrieve(n.value);if(r!==null){let w=r.route;return w.value._futureSnapshot=n.value,w.children=n.children.map(I=>m_(o,I)),w}}let c=gH(n.value),f=n.children.map(r=>m_(o,r));return new Uo(c,f)}}function mH(o,n,l){return n.children.map(c=>{for(let f of l.children)if(o.shouldReuseRoute(c.value,f.value.snapshot))return m_(o,c,f);return m_(o,c)})}function gH(o){return new _p(new wr(o.url),new wr(o.params),new wr(o.queryParams),new wr(o.fragment),new wr(o.data),o.outlet,o.component,o)}var mL="ngNavigationCancelingError";function gL(o,n){let{redirectTo:l,navigationBehaviorOptions:c}=gp(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,f=_L(!1,$o.Redirect);return f.url=l,f.navigationBehaviorOptions=c,f}function _L(o,n){let l=new Error(`NavigationCancelingError: ${o||""}`);return l[mL]=!0,l.cancellationCode=n,l}function _H(o){return yL(o)&&gp(o.url)}function yL(o){return!!o&&o[mL]}var yH=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=pi({type:n,selectors:[["ng-component"]],standalone:!0,features:[mi],decls:1,vars:0,template:function(f,r){f&1&&Wn(0,"router-outlet")},dependencies:[$I],encapsulation:2});let o=n;return o})();function vH(o,n){return o.providers&&!o._injector&&(o._injector=NC(o.providers,n,`Route: ${o.path}`)),o._injector??n}function GI(o){let n=o.children&&o.children.map(GI),l=n?hi(gt({},o),{children:n}):gt({},o);return!l.component&&!l.loadComponent&&(n||l.loadChildren)&&l.outlet&&l.outlet!==Nn&&(l.component=yH),l}function Aa(o){return o.outlet||Nn}function xH(o,n){let l=o.filter(c=>Aa(c)===n);return l.push(...o.filter(c=>Aa(c)!==n)),l}function y_(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let n=o.parent;n;n=n.parent){let l=n.routeConfig;if(l?._loadedInjector)return l._loadedInjector;if(l?._injector)return l._injector}return null}var bH=(o,n,l,c)=>Sn(f=>(new OI(n,f.targetRouterState,f.currentRouterState,l,c).activate(o),f)),OI=class{constructor(n,l,c,f,r){this.routeReuseStrategy=n,this.futureState=l,this.currState=c,this.forwardEvent=f,this.inputBindingEnabled=r}activate(n){let l=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,c,n),hI(this.futureState.root),this.activateChildRoutes(l,c,n)}deactivateChildRoutes(n,l,c){let f=dp(l);n.children.forEach(r=>{let w=r.value.outlet;this.deactivateRoutes(r,f[w],c),delete f[w]}),Object.values(f).forEach(r=>{this.deactivateRouteAndItsChildren(r,c)})}deactivateRoutes(n,l,c){let f=n.value,r=l?l.value:null;if(f===r)if(f.component){let w=c.getContext(f.outlet);w&&this.deactivateChildRoutes(n,l,w.children)}else this.deactivateChildRoutes(n,l,c);else r&&this.deactivateRouteAndItsChildren(l,c)}deactivateRouteAndItsChildren(n,l){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,l):this.deactivateRouteAndOutlet(n,l)}detachAndStoreRouteSubtree(n,l){let c=l.getContext(n.value.outlet),f=c&&n.value.component?c.children:l,r=dp(n);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,f);if(c&&c.outlet){let w=c.outlet.detach(),I=c.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:w,route:n,contexts:I})}}deactivateRouteAndOutlet(n,l){let c=l.getContext(n.value.outlet),f=c&&n.value.component?c.children:l,r=dp(n);for(let w of Object.values(r))this.deactivateRouteAndItsChildren(w,f);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(n,l,c){let f=dp(l);n.children.forEach(r=>{this.activateRoutes(r,f[r.value.outlet],c),this.forwardEvent(new SI(r.value.snapshot))}),n.children.length&&this.forwardEvent(new II(n.value.snapshot))}activateRoutes(n,l,c){let f=n.value,r=l?l.value:null;if(hI(f),f===r)if(f.component){let w=c.getOrCreateContext(f.outlet);this.activateChildRoutes(n,l,w.children)}else this.activateChildRoutes(n,l,c);else if(f.component){let w=c.getOrCreateContext(f.outlet);if(this.routeReuseStrategy.shouldAttach(f.snapshot)){let I=this.routeReuseStrategy.retrieve(f.snapshot);this.routeReuseStrategy.store(f.snapshot,null),w.children.onOutletReAttached(I.contexts),w.attachRef=I.componentRef,w.route=I.route.value,w.outlet&&w.outlet.attach(I.componentRef,I.route.value),hI(I.route.value),this.activateChildRoutes(n,null,w.children)}else{let I=y_(f.snapshot);w.attachRef=null,w.route=f,w.injector=I,w.outlet&&w.outlet.activateWith(f,w.injector),this.activateChildRoutes(n,null,w.children)}}else this.activateChildRoutes(n,null,c)}},rb=class{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},pp=class{constructor(n,l){this.component=n,this.route=l}};function wH(o,n,l){let c=o._root,f=n?n._root:null;return r_(c,f,l,[c.value])}function EH(o){let n=o.routeConfig?o.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:o,guards:n}}function xp(o,n){let l=Symbol(),c=n.get(o,l);return c===l?typeof o=="function"&&!cR(o)?o:n.get(o):c}function r_(o,n,l,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let r=dp(n);return o.children.forEach(w=>{TH(w,r[w.value.outlet],l,c.concat([w.value]),f),delete r[w.value.outlet]}),Object.entries(r).forEach(([w,I])=>l_(I,l.getContext(w),f)),f}function TH(o,n,l,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let r=o.value,w=n?n.value:null,I=l?l.getContext(o.value.outlet):null;if(w&&r.routeConfig===w.routeConfig){let A=CH(w,r,r.routeConfig.runGuardsAndResolvers);A?f.canActivateChecks.push(new rb(c)):(r.data=w.data,r._resolvedData=w._resolvedData),r.component?r_(o,n,I?I.children:null,c,f):r_(o,n,l,c,f),A&&I&&I.outlet&&I.outlet.isActivated&&f.canDeactivateChecks.push(new pp(I.outlet.component,w))}else w&&l_(n,I,f),f.canActivateChecks.push(new rb(c)),r.component?r_(o,null,I?I.children:null,c,f):r_(o,null,l,c,f);return f}function CH(o,n,l){if(typeof l=="function")return l(o,n);switch(l){case"pathParamsChange":return!Gh(o.url,n.url);case"pathParamsOrQueryParamsChange":return!Gh(o.url,n.url)||!Ma(o.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!RI(o,n)||!Ma(o.queryParams,n.queryParams);case"paramsChange":default:return!RI(o,n)}}function l_(o,n,l){let c=dp(o),f=o.value;Object.entries(c).forEach(([r,w])=>{f.component?n?l_(w,n.children.getContext(r),l):l_(w,null,l):l_(w,n,l)}),f.component?n&&n.outlet&&n.outlet.isActivated?l.canDeactivateChecks.push(new pp(n.outlet.component,f)):l.canDeactivateChecks.push(new pp(null,f)):l.canDeactivateChecks.push(new pp(null,f))}function v_(o){return typeof o=="function"}function IH(o){return typeof o=="boolean"}function DH(o){return o&&v_(o.canLoad)}function SH(o){return o&&v_(o.canActivate)}function MH(o){return o&&v_(o.canActivateChild)}function AH(o){return o&&v_(o.canDeactivate)}function PH(o){return o&&v_(o.canMatch)}function vL(o){return o instanceof ml||o?.name==="EmptyError"}var Wx=Symbol("INITIAL_VALUE");function yp(){return wo(o=>_h(o.map(n=>n.pipe(Ls(1),Dg(Wx)))).pipe(Sn(n=>{for(let l of n)if(l!==!0){if(l===Wx)return Wx;if(l===!1||l instanceof Zc)return l}return!0}),io(n=>n!==Wx),Ls(1)))}function RH(o,n){return Er(l=>{let{targetSnapshot:c,currentSnapshot:f,guards:{canActivateChecks:r,canDeactivateChecks:w}}=l;return w.length===0&&r.length===0?un(hi(gt({},l),{guardsResult:!0})):kH(w,c,f,o).pipe(Er(I=>I&&IH(I)?OH(c,r,o,n):un(I)),Sn(I=>hi(gt({},l),{guardsResult:I})))})}function kH(o,n,l,c){return er(o).pipe(Er(f=>BH(f.component,f.route,l,n,c)),va(f=>f!==!0,!0))}function OH(o,n,l,c){return er(n).pipe(Lc(f=>Oc(FH(f.route.parent,c),LH(f.route,c),zH(o,f.path,l),NH(o,f.route,l))),va(f=>f!==!0,!0))}function LH(o,n){return o!==null&&n&&n(new DI(o)),un(!0)}function FH(o,n){return o!==null&&n&&n(new CI(o)),un(!0)}function NH(o,n,l){let c=n.routeConfig?n.routeConfig.canActivate:null;if(!c||c.length===0)return un(!0);let f=c.map(r=>Iv(()=>{let w=y_(n)??l,I=xp(r,w),A=SH(I)?I.canActivate(n,o):Us(w,()=>I(n,o));return Xc(A).pipe(va())}));return un(f).pipe(yp())}function zH(o,n,l){let c=n[n.length-1],r=n.slice(0,n.length-1).reverse().map(w=>EH(w)).filter(w=>w!==null).map(w=>Iv(()=>{let I=w.guards.map(A=>{let L=y_(w.node)??l,U=xp(A,L),Q=MH(U)?U.canActivateChild(c,o):Us(L,()=>U(c,o));return Xc(Q).pipe(va())});return un(I).pipe(yp())}));return un(r).pipe(yp())}function BH(o,n,l,c,f){let r=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!r||r.length===0)return un(!0);let w=r.map(I=>{let A=y_(n)??f,L=xp(I,A),U=AH(L)?L.canDeactivate(o,n,l,c):Us(A,()=>L(o,n,l,c));return Xc(U).pipe(va())});return un(w).pipe(yp())}function VH(o,n,l,c){let f=n.canLoad;if(f===void 0||f.length===0)return un(!0);let r=f.map(w=>{let I=xp(w,o),A=DH(I)?I.canLoad(n,l):Us(o,()=>I(n,l));return Xc(A)});return un(r).pipe(yp(),xL(c))}function xL(o){return PE(lr(n=>{if(gp(n))throw gL(o,n)}),Sn(n=>n===!0))}function jH(o,n,l,c){let f=n.canMatch;if(!f||f.length===0)return un(!0);let r=f.map(w=>{let I=xp(w,o),A=PH(I)?I.canMatch(n,l):Us(o,()=>I(n,l));return Xc(A)});return un(r).pipe(yp(),xL(c))}var g_=class{constructor(n){this.segmentGroup=n||null}},ob=class extends Error{constructor(n){super(),this.urlTree=n}};function hp(o){return pl(new g_(o))}function UH(o){return pl(new xt(4e3,!1))}function $H(o){return pl(_L(!1,$o.GuardRejected))}var LI=class{constructor(n,l){this.urlSerializer=n,this.urlTree=l}lineralizeSegments(n,l){let c=[],f=l.root;for(;;){if(c=c.concat(f.segments),f.numberOfChildren===0)return un(c);if(f.numberOfChildren>1||!f.children[Nn])return UH(n.redirectTo);f=f.children[Nn]}}applyRedirectCommands(n,l,c){let f=this.applyRedirectCreateUrlTree(l,this.urlSerializer.parse(l),n,c);if(l.startsWith("/"))throw new ob(f);return f}applyRedirectCreateUrlTree(n,l,c,f){let r=this.createSegmentGroup(n,l.root,c,f);return new Zc(r,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(n,l){let c={};return Object.entries(n).forEach(([f,r])=>{if(typeof r=="string"&&r.startsWith(":")){let I=r.substring(1);c[f]=l[I]}else c[f]=r}),c}createSegmentGroup(n,l,c,f){let r=this.createSegments(n,l.segments,c,f),w={};return Object.entries(l.children).forEach(([I,A])=>{w[I]=this.createSegmentGroup(n,A,c,f)}),new wi(r,w)}createSegments(n,l,c,f){return l.map(r=>r.path.startsWith(":")?this.findPosParam(n,r,f):this.findOrReturn(r,c))}findPosParam(n,l,c){let f=c[l.path.substring(1)];if(!f)throw new xt(4001,!1);return f}findOrReturn(n,l){let c=0;for(let f of l){if(f.path===n.path)return l.splice(c),f;c++}return n}},FI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function GH(o,n,l,c,f){let r=HI(o,n,l);return r.matched?(c=vH(n,c),jH(c,n,l,f).pipe(Sn(w=>w===!0?r:gt({},FI)))):un(r)}function HI(o,n,l){if(n.path==="**")return HH(l);if(n.path==="")return n.pathMatch==="full"&&(o.hasChildren()||l.length>0)?gt({},FI):{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};let f=(n.matcher||jG)(l,o,n);if(!f)return gt({},FI);let r={};Object.entries(f.posParams??{}).forEach(([I,A])=>{r[I]=A.path});let w=f.consumed.length>0?gt(gt({},r),f.consumed[f.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:f.consumed,remainingSegments:l.slice(f.consumed.length),parameters:w,positionalParamSegments:f.posParams??{}}}function HH(o){return{matched:!0,parameters:o.length>0?JO(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function KO(o,n,l,c){return l.length>0&&ZH(o,l,c)?{segmentGroup:new wi(n,WH(c,new wi(l,o.children))),slicedSegments:[]}:l.length===0&&YH(o,l,c)?{segmentGroup:new wi(o.segments,qH(o,l,c,o.children)),slicedSegments:l}:{segmentGroup:new wi(o.segments,o.children),slicedSegments:l}}function qH(o,n,l,c){let f={};for(let r of l)if(lb(o,n,r)&&!c[Aa(r)]){let w=new wi([],{});f[Aa(r)]=w}return gt(gt({},c),f)}function WH(o,n){let l={};l[Nn]=n;for(let c of o)if(c.path===""&&Aa(c)!==Nn){let f=new wi([],{});l[Aa(c)]=f}return l}function ZH(o,n,l){return l.some(c=>lb(o,n,c)&&Aa(c)!==Nn)}function YH(o,n,l){return l.some(c=>lb(o,n,c))}function lb(o,n,l){return(o.hasChildren()||n.length>0)&&l.pathMatch==="full"?!1:l.path===""}function XH(o,n,l,c){return Aa(o)!==c&&(c===Nn||!lb(n,l,o))?!1:HI(n,o,l).matched}function KH(o,n,l){return n.length===0&&!o.children[l]}var NI=class{};function QH(o,n,l,c,f,r,w="emptyOnly"){return new zI(o,n,l,c,f,w,r).recognize()}var JH=31,zI=class{constructor(n,l,c,f,r,w,I){this.injector=n,this.configLoader=l,this.rootComponentType=c,this.config=f,this.urlTree=r,this.paramsInheritanceStrategy=w,this.urlSerializer=I,this.applyRedirects=new LI(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new xt(4002,`'${n.segmentGroup}'`)}recognize(){let n=KO(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Sn(l=>{let c=new p_([],Object.freeze({}),Object.freeze(gt({},this.urlTree.queryParams)),this.urlTree.fragment,{},Nn,this.rootComponentType,null,{}),f=new Uo(c,l),r=new ib("",f),w=sH(c,[],this.urlTree.queryParams,this.urlTree.fragment);return w.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(w),this.inheritParamsAndData(r._root,null),{state:r,tree:w}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n,Nn).pipe(_a(c=>{if(c instanceof ob)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof g_?this.noMatchError(c):c}))}inheritParamsAndData(n,l){let c=n.value,f=jI(c,l,this.paramsInheritanceStrategy);c.params=Object.freeze(f.params),c.data=Object.freeze(f.data),n.children.forEach(r=>this.inheritParamsAndData(r,c))}processSegmentGroup(n,l,c,f){return c.segments.length===0&&c.hasChildren()?this.processChildren(n,l,c):this.processSegment(n,l,c,c.segments,f,!0).pipe(Sn(r=>r instanceof Uo?[r]:[]))}processChildren(n,l,c){let f=[];for(let r of Object.keys(c.children))r==="primary"?f.unshift(r):f.push(r);return er(f).pipe(Lc(r=>{let w=c.children[r],I=xH(l,r);return this.processSegmentGroup(n,I,w,r)}),jE((r,w)=>(r.push(...w),r)),Fc(null),VE(),Er(r=>{if(r===null)return hp(c);let w=bL(r);return eq(w),un(w)}))}processSegment(n,l,c,f,r,w){return er(l).pipe(Lc(I=>this.processSegmentAgainstRoute(I._injector??n,l,I,c,f,r,w).pipe(_a(A=>{if(A instanceof g_)return un(null);throw A}))),va(I=>!!I),_a(I=>{if(vL(I))return KH(c,f,r)?un(new NI):hp(c);throw I}))}processSegmentAgainstRoute(n,l,c,f,r,w,I){return XH(c,f,r,w)?c.redirectTo===void 0?this.matchSegmentAgainstRoute(n,f,c,r,w):this.allowRedirects&&I?this.expandSegmentAgainstRouteUsingRedirect(n,f,l,c,r,w):hp(f):hp(f)}expandSegmentAgainstRouteUsingRedirect(n,l,c,f,r,w){let{matched:I,consumedSegments:A,positionalParamSegments:L,remainingSegments:U}=HI(l,f,r);if(!I)return hp(l);f.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>JH&&(this.allowRedirects=!1));let Q=this.applyRedirects.applyRedirectCommands(A,f.redirectTo,L);return this.applyRedirects.lineralizeSegments(f,Q).pipe(Er(fe=>this.processSegment(n,c,l,fe.concat(U),w,!1)))}matchSegmentAgainstRoute(n,l,c,f,r){let w=GH(l,c,f,n,this.urlSerializer);return c.path==="**"&&(l.children={}),w.pipe(wo(I=>I.matched?(n=c._injector??n,this.getChildConfig(n,c,f).pipe(wo(({routes:A})=>{let L=c._loadedInjector??n,{consumedSegments:U,remainingSegments:Q,parameters:fe}=I,he=new p_(U,fe,Object.freeze(gt({},this.urlTree.queryParams)),this.urlTree.fragment,nq(c),Aa(c),c.component??c._loadedComponent??null,c,iq(c)),{segmentGroup:be,slicedSegments:De}=KO(l,U,Q,A);if(De.length===0&&be.hasChildren())return this.processChildren(L,A,be).pipe(Sn(Fe=>Fe===null?null:new Uo(he,Fe)));if(A.length===0&&De.length===0)return un(new Uo(he,[]));let Ke=Aa(c)===r;return this.processSegment(L,A,be,De,Ke?Nn:r,!0).pipe(Sn(Fe=>new Uo(he,Fe instanceof Uo?[Fe]:[])))}))):hp(l)))}getChildConfig(n,l,c){return l.children?un({routes:l.children,injector:n}):l.loadChildren?l._loadedRoutes!==void 0?un({routes:l._loadedRoutes,injector:l._loadedInjector}):VH(n,l,c,this.urlSerializer).pipe(Er(f=>f?this.configLoader.loadChildren(n,l).pipe(lr(r=>{l._loadedRoutes=r.routes,l._loadedInjector=r.injector})):$H(l))):un({routes:[],injector:n})}};function eq(o){o.sort((n,l)=>n.value.outlet===Nn?-1:l.value.outlet===Nn?1:n.value.outlet.localeCompare(l.value.outlet))}function tq(o){let n=o.value.routeConfig;return n&&n.path===""}function bL(o){let n=[],l=new Set;for(let c of o){if(!tq(c)){n.push(c);continue}let f=n.find(r=>c.value.routeConfig===r.value.routeConfig);f!==void 0?(f.children.push(...c.children),l.add(f)):n.push(c)}for(let c of l){let f=bL(c.children);n.push(new Uo(c.value,f))}return n.filter(c=>!l.has(c))}function nq(o){return o.data||{}}function iq(o){return o.resolve||{}}function rq(o,n,l,c,f,r){return Er(w=>QH(o,n,l,c,w.extractedUrl,f,r).pipe(Sn(({state:I,tree:A})=>hi(gt({},w),{targetSnapshot:I,urlAfterRedirects:A}))))}function oq(o,n){return Er(l=>{let{targetSnapshot:c,guards:{canActivateChecks:f}}=l;if(!f.length)return un(l);let r=new Set(f.map(A=>A.route)),w=new Set;for(let A of r)if(!w.has(A))for(let L of wL(A))w.add(L);let I=0;return er(w).pipe(Lc(A=>r.has(A)?sq(A,c,o,n):(A.data=jI(A,A.parent,o).resolve,un(void 0))),lr(()=>I++),Of(1),Er(A=>I===w.size?un(l):Bo))})}function wL(o){let n=o.children.map(l=>wL(l)).flat();return[o,...n]}function sq(o,n,l,c){let f=o.routeConfig,r=o._resolve;return f?.title!==void 0&&!pL(f)&&(r[__]=f.title),aq(r,o,n,c).pipe(Sn(w=>(o._resolvedData=w,o.data=jI(o,o.parent,l).resolve,null)))}function aq(o,n,l,c){let f=pI(o);if(f.length===0)return un({});let r={};return er(f).pipe(Er(w=>lq(o[w],n,l,c).pipe(va(),lr(I=>{r[w]=I}))),Of(1),BE(r),_a(w=>vL(w)?Bo:pl(w)))}function lq(o,n,l,c){let f=y_(n)??c,r=xp(o,f),w=r.resolve?r.resolve(n,l):Us(f,()=>r(n,l));return Xc(w)}function dI(o){return wo(n=>{let l=o(n);return l?er(l).pipe(Sn(()=>n)):un(n)})}var EL=(()=>{let n=class n{buildTitle(c){let f,r=c.root;for(;r!==void 0;)f=this.getResolvedTitleForRoute(r)??f,r=r.children.find(w=>w.outlet===Nn);return f}getResolvedTitleForRoute(c){return c.data[__]}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>bt(cq),providedIn:"root"});let o=n;return o})(),cq=(()=>{let n=class n extends EL{constructor(c){super(),this.title=c}updateTitle(c){let f=this.buildTitle(c);f!==void 0&&this.title.setTitle(f)}};n.\u0275fac=function(f){return new(f||n)(Ut(HO))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),qI=new an("",{providedIn:"root",factory:()=>({})}),WI=new an(""),uq=(()=>{let n=class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=bt($C)}loadComponent(c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return un(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let f=Xc(c.loadComponent()).pipe(Sn(TL),lr(w=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=w}),ya(()=>{this.componentLoaders.delete(c)})),r=new Rf(f,()=>new br).pipe(Pf());return this.componentLoaders.set(c,r),r}loadChildren(c,f){if(this.childrenLoaders.get(f))return this.childrenLoaders.get(f);if(f._loadedRoutes)return un({routes:f._loadedRoutes,injector:f._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(f);let w=hq(f,this.compiler,c,this.onLoadEndListener).pipe(ya(()=>{this.childrenLoaders.delete(f)})),I=new Rf(w,()=>new br).pipe(Pf());return this.childrenLoaders.set(f,I),I}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function hq(o,n,l,c){return Xc(o.loadChildren()).pipe(Sn(TL),Er(f=>f instanceof Vg||Array.isArray(f)?un(f):er(n.compileModuleAsync(f))),Sn(f=>{c&&c(o);let r,w,I=!1;return Array.isArray(f)?(w=f,I=!0):(r=f.create(l).injector,w=r.get(WI,[],{optional:!0,self:!0}).flat()),{routes:w.map(GI),injector:r}}))}function dq(o){return o&&typeof o=="object"&&"default"in o}function TL(o){return dq(o)?o.default:o}var ZI=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>bt(fq),providedIn:"root"});let o=n;return o})(),fq=(()=>{let n=class n{shouldProcessUrl(c){return!0}extract(c){return c}merge(c,f){return c}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),CL=new an(""),IL=new an("");function pq(o,n,l){let c=o.get(IL),f=o.get(Pi);return o.get(fi).runOutsideAngular(()=>{if(!f.startViewTransition||c.skipNextTransition)return c.skipNextTransition=!1,new Promise(L=>setTimeout(L));let r,w=new Promise(L=>{r=L}),I=f.startViewTransition(()=>(r(),mq(o))),{onViewTransitionCreated:A}=c;return A&&Us(o,()=>A({transition:I,from:n,to:l})),w})}function mq(o){return new Promise(n=>{yx(n,{injector:o})})}var gq=(()=>{let n=class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new br,this.transitionAbortSubject=new br,this.configLoader=bt(uq),this.environmentInjector=bt(To),this.urlSerializer=bt(VI),this.rootContexts=bt(vp),this.location=bt(Xg),this.inputBindingEnabled=bt(ab,{optional:!0})!==null,this.titleStrategy=bt(EL),this.options=bt(qI,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=bt(ZI),this.createViewTransition=bt(CL,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>un(void 0),this.rootComponentType=null;let c=r=>this.events.next(new EI(r)),f=r=>this.events.next(new TI(r));this.configLoader.onLoadEndListener=f,this.configLoader.onLoadStartListener=c}complete(){this.transitions?.complete()}handleNavigationRequest(c){let f=++this.navigationId;this.transitions?.next(hi(gt(gt({},this.transitions.value),c),{id:f}))}setupNavigations(c,f,r){return this.transitions=new wr({id:0,currentUrlTree:f,currentRawUrl:f,extractedUrl:this.urlHandlingStrategy.extract(f),urlAfterRedirects:this.urlHandlingStrategy.extract(f),rawUrl:f,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:a_,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(io(w=>w.id!==0),Sn(w=>hi(gt({},w),{extractedUrl:this.urlHandlingStrategy.extract(w.rawUrl)})),wo(w=>{let I=!1,A=!1;return un(w).pipe(wo(L=>{if(this.navigationId>w.id)return this.cancelNavigationTransition(w,"",$o.SupersededByNewNavigation),Bo;this.currentTransition=w,this.currentNavigation={id:L.id,initialUrl:L.rawUrl,extractedUrl:L.extractedUrl,trigger:L.source,extras:L.extras,previousNavigation:this.lastSuccessfulNavigation?hi(gt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let U=!c.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Q=L.extras.onSameUrlNavigation??c.onSameUrlNavigation;if(!U&&Q!=="reload"){let fe="";return this.events.next(new qh(L.id,this.urlSerializer.serialize(L.rawUrl),fe,yI.IgnoredSameUrlNavigation)),L.resolve(null),Bo}if(this.urlHandlingStrategy.shouldProcessUrl(L.rawUrl))return un(L).pipe(wo(fe=>{let he=this.transitions?.getValue();return this.events.next(new u_(fe.id,this.urlSerializer.serialize(fe.extractedUrl),fe.source,fe.restoredState)),he!==this.transitions?.getValue()?Bo:Promise.resolve(fe)}),rq(this.environmentInjector,this.configLoader,this.rootComponentType,c.config,this.urlSerializer,this.paramsInheritanceStrategy),lr(fe=>{w.targetSnapshot=fe.targetSnapshot,w.urlAfterRedirects=fe.urlAfterRedirects,this.currentNavigation=hi(gt({},this.currentNavigation),{finalUrl:fe.urlAfterRedirects});let he=new eb(fe.id,this.urlSerializer.serialize(fe.extractedUrl),this.urlSerializer.serialize(fe.urlAfterRedirects),fe.targetSnapshot);this.events.next(he)}));if(U&&this.urlHandlingStrategy.shouldProcessUrl(L.currentRawUrl)){let{id:fe,extractedUrl:he,source:be,restoredState:De,extras:Ke}=L,Fe=new u_(fe,this.urlSerializer.serialize(he),be,De);this.events.next(Fe);let tt=dL(this.rootComponentType).snapshot;return this.currentTransition=w=hi(gt({},L),{targetSnapshot:tt,urlAfterRedirects:he,extras:hi(gt({},Ke),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=he,un(w)}else{let fe="";return this.events.next(new qh(L.id,this.urlSerializer.serialize(L.extractedUrl),fe,yI.IgnoredByUrlHandlingStrategy)),L.resolve(null),Bo}}),lr(L=>{let U=new vI(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(U)}),Sn(L=>(this.currentTransition=w=hi(gt({},L),{guards:wH(L.targetSnapshot,L.currentSnapshot,this.rootContexts)}),w)),RH(this.environmentInjector,L=>this.events.next(L)),lr(L=>{if(w.guardsResult=L.guardsResult,gp(L.guardsResult))throw gL(this.urlSerializer,L.guardsResult);let U=new xI(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot,!!L.guardsResult);this.events.next(U)}),io(L=>L.guardsResult?!0:(this.cancelNavigationTransition(L,"",$o.GuardRejected),!1)),dI(L=>{if(L.guards.canActivateChecks.length)return un(L).pipe(lr(U=>{let Q=new bI(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(Q)}),wo(U=>{let Q=!1;return un(U).pipe(oq(this.paramsInheritanceStrategy,this.environmentInjector),lr({next:()=>Q=!0,complete:()=>{Q||this.cancelNavigationTransition(U,"",$o.NoDataFromResolver)}}))}),lr(U=>{let Q=new wI(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(Q)}))}),dI(L=>{let U=Q=>{let fe=[];Q.routeConfig?.loadComponent&&!Q.routeConfig._loadedComponent&&fe.push(this.configLoader.loadComponent(Q.routeConfig).pipe(lr(he=>{Q.component=he}),Sn(()=>{})));for(let he of Q.children)fe.push(...U(he));return fe};return _h(U(L.targetSnapshot.root)).pipe(Fc(null),Ls(1))}),dI(()=>this.afterPreactivation()),wo(()=>{let{currentSnapshot:L,targetSnapshot:U}=w,Q=this.createViewTransition?.(this.environmentInjector,L.root,U.root);return Q?er(Q).pipe(Sn(()=>w)):un(w)}),Sn(L=>{let U=pH(c.routeReuseStrategy,L.targetSnapshot,L.currentRouterState);return this.currentTransition=w=hi(gt({},L),{targetRouterState:U}),this.currentNavigation.targetRouterState=U,w}),lr(()=>{this.events.next(new d_)}),bH(this.rootContexts,c.routeReuseStrategy,L=>this.events.next(L),this.inputBindingEnabled),Ls(1),lr({next:L=>{I=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Hh(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects))),this.titleStrategy?.updateTitle(L.targetRouterState.snapshot),L.resolve(!0)},complete:()=>{I=!0}}),Sg(this.transitionAbortSubject.pipe(lr(L=>{throw L}))),ya(()=>{!I&&!A&&this.cancelNavigationTransition(w,"",$o.SupersededByNewNavigation),this.currentTransition?.id===w.id&&(this.currentNavigation=null,this.currentTransition=null)}),_a(L=>{if(A=!0,yL(L))this.events.next(new Yc(w.id,this.urlSerializer.serialize(w.extractedUrl),L.message,L.cancellationCode)),_H(L)?this.events.next(new f_(L.url)):w.resolve(!1);else{this.events.next(new h_(w.id,this.urlSerializer.serialize(w.extractedUrl),L,w.targetSnapshot??void 0));try{w.resolve(c.errorHandler(L))}catch(U){this.options.resolveNavigationPromiseOnError?w.resolve(!1):w.reject(U)}}return Bo}))}))}cancelNavigationTransition(c,f,r){let w=new Yc(c.id,this.urlSerializer.serialize(c.extractedUrl),f,r);this.events.next(w),c.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function _q(o){return o!==a_}var yq=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>bt(vq),providedIn:"root"});let o=n;return o})(),BI=class{shouldDetach(n){return!1}store(n,l){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,l){return n.routeConfig===l.routeConfig}},vq=(()=>{let n=class n extends BI{};n.\u0275fac=(()=>{let c;return function(r){return(c||(c=ux(n)))(r||n)}})(),n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),DL=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>bt(xq),providedIn:"root"});let o=n;return o})(),xq=(()=>{let n=class n extends DL{constructor(){super(...arguments),this.location=bt(Xg),this.urlSerializer=bt(VI),this.options=bt(qI,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=bt(ZI),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Zc,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=dL(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(c){return this.location.subscribe(f=>{f.type==="popstate"&&c(f.url,f.state)})}handleRouterEvent(c,f){if(c instanceof u_)this.stateMemento=this.createStateMemento();else if(c instanceof qh)this.rawUrlTree=f.initialUrl;else if(c instanceof eb){if(this.urlUpdateStrategy==="eager"&&!f.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl);this.setBrowserUrl(r,f)}}else c instanceof d_?(this.currentUrlTree=f.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl),this.routerState=f.targetRouterState,this.urlUpdateStrategy==="deferred"&&(f.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,f))):c instanceof Yc&&(c.code===$o.GuardRejected||c.code===$o.NoDataFromResolver)?this.restoreHistory(f):c instanceof h_?this.restoreHistory(f,!0):c instanceof Hh&&(this.lastSuccessfulId=c.id,this.currentPageId=this.browserPageId)}setBrowserUrl(c,f){let r=this.urlSerializer.serialize(c);if(this.location.isCurrentPathEqualTo(r)||f.extras.replaceUrl){let w=this.browserPageId,I=gt(gt({},f.extras.state),this.generateNgRouterState(f.id,w));this.location.replaceState(r,"",I)}else{let w=gt(gt({},f.extras.state),this.generateNgRouterState(f.id,this.browserPageId+1));this.location.go(r,"",w)}}restoreHistory(c,f=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,w=this.currentPageId-r;w!==0?this.location.historyGo(w):this.currentUrlTree===c.finalUrl&&w===0&&(this.resetState(c),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(f&&this.resetState(c),this.resetUrlToCurrentUrlTree())}resetState(c){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,c.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(c,f){return this.canceledNavigationResolution==="computed"?{navigationId:c,\u0275routerPageId:f}:{navigationId:c}}};n.\u0275fac=(()=>{let c;return function(r){return(c||(c=ux(n)))(r||n)}})(),n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),o_=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(o_||{});function bq(o,n){o.events.pipe(io(l=>l instanceof Hh||l instanceof Yc||l instanceof h_||l instanceof qh),Sn(l=>l instanceof Hh||l instanceof qh?o_.COMPLETE:(l instanceof Yc?l.code===$o.Redirect||l.code===$o.SupersededByNewNavigation:!1)?o_.REDIRECTING:o_.FAILED),io(l=>l!==o_.REDIRECTING),Ls(1)).subscribe(()=>{n()})}function wq(o){throw o}var Eq={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Tq={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},cb=(()=>{let n=class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=bt(Tx),this.stateManager=bt(DL),this.options=bt(qI,{optional:!0})||{},this.pendingTasks=bt(Lh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=bt(gq),this.urlSerializer=bt(VI),this.location=bt(Xg),this.urlHandlingStrategy=bt(ZI),this._events=new br,this.errorHandler=this.options.errorHandler||wq,this.navigated=!1,this.routeReuseStrategy=bt(yq),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=bt(WI,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!bt(ab,{optional:!0}),this.eventsSubscription=new Qi,this.isNgZoneEnabled=bt(fi)instanceof fi&&fi.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:c=>{this.console.warn(c)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let c=this.navigationTransitions.events.subscribe(f=>{try{let r=this.navigationTransitions.currentTransition,w=this.navigationTransitions.currentNavigation;if(r!==null&&w!==null){if(this.stateManager.handleRouterEvent(f,w),f instanceof Yc&&f.code!==$o.Redirect&&f.code!==$o.SupersededByNewNavigation)this.navigated=!0;else if(f instanceof Hh)this.navigated=!0;else if(f instanceof f_){let I=this.urlHandlingStrategy.merge(f.url,r.currentRawUrl),A={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||_q(r.source)};this.scheduleNavigation(I,a_,null,A,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}Iq(f)&&this._events.next(f)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(c)}resetRootComponentType(c){this.routerState.root.component=c,this.navigationTransitions.rootComponentType=c}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),a_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((c,f)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(c,"popstate",f)},0)})}navigateToSyncWithBrowser(c,f,r){let w={replaceUrl:!0},I=r?.navigationId?r:null;if(r){let L=gt({},r);delete L.navigationId,delete L.\u0275routerPageId,Object.keys(L).length!==0&&(w.state=L)}let A=this.parseUrl(c);this.scheduleNavigation(A,f,I,w)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(c){this.config=c.map(GI),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(c,f={}){let{relativeTo:r,queryParams:w,fragment:I,queryParamsHandling:A,preserveFragment:L}=f,U=L?this.currentUrlTree.fragment:I,Q=null;switch(A){case"merge":Q=gt(gt({},this.currentUrlTree.queryParams),w);break;case"preserve":Q=this.currentUrlTree.queryParams;break;default:Q=w||null}Q!==null&&(Q=this.removeEmptyProps(Q));let fe;try{let he=r?r.snapshot:this.routerState.snapshot.root;fe=lL(he)}catch{(typeof c[0]!="string"||!c[0].startsWith("/"))&&(c=[]),fe=this.currentUrlTree.root}return cL(fe,c,Q,U??null)}navigateByUrl(c,f={skipLocationChange:!1}){let r=gp(c)?c:this.parseUrl(c),w=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(w,a_,null,f)}navigate(c,f={skipLocationChange:!1}){return Cq(c),this.navigateByUrl(this.createUrlTree(c,f),f)}serializeUrl(c){return this.urlSerializer.serialize(c)}parseUrl(c){try{return this.urlSerializer.parse(c)}catch{return this.urlSerializer.parse("/")}}isActive(c,f){let r;if(f===!0?r=gt({},Eq):f===!1?r=gt({},Tq):r=f,gp(c))return qO(this.currentUrlTree,c,r);let w=this.parseUrl(c);return qO(this.currentUrlTree,w,r)}removeEmptyProps(c){return Object.entries(c).reduce((f,[r,w])=>(w!=null&&(f[r]=w),f),{})}scheduleNavigation(c,f,r,w,I){if(this.disposed)return Promise.resolve(!1);let A,L,U;I?(A=I.resolve,L=I.reject,U=I.promise):U=new Promise((fe,he)=>{A=fe,L=he});let Q=this.pendingTasks.add();return bq(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Q))}),this.navigationTransitions.handleNavigationRequest({source:f,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:c,extras:w,resolve:A,reject:L,promise:U,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),U.catch(fe=>Promise.reject(fe))}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function Cq(o){for(let n=0;n<o.length;n++)if(o[n]==null)throw new xt(4008,!1)}function Iq(o){return!(o instanceof d_)&&!(o instanceof f_)}var Dq=new an("");function SL(o,...n){return $c([{provide:WI,multi:!0,useValue:o},[],{provide:_p,useFactory:Sq,deps:[cb]},{provide:Cx,multi:!0,useFactory:Mq},n.map(l=>l.\u0275providers)])}function Sq(o){return o.routerState.root}function ML(o,n){return{\u0275kind:o,\u0275providers:n}}function Mq(){let o=bt(vl);return n=>{let l=o.get(sp);if(n!==l.components[0])return;let c=o.get(cb),f=o.get(Aq);o.get(Pq)===1&&c.initialNavigation(),o.get(Rq,null,qn.Optional)?.setUpPreloading(),o.get(Dq,null,qn.Optional)?.init(),c.resetRootComponentType(l.componentTypes[0]),f.closed||(f.next(),f.complete(),f.unsubscribe())}}var Aq=new an("",{factory:()=>new br}),Pq=new an("",{providedIn:"root",factory:()=>1});var Rq=new an("");function AL(){return ML(8,[XO,{provide:ab,useExisting:XO}])}function PL(o){let n=[{provide:CL,useValue:pq},{provide:IL,useValue:gt({skipNextTransition:!!o?.skipInitialTransition},o)}];return ML(9,n)}function x_(o,n,l,c=!1){return{width:100,height:100,data:new Uint8ClampedArray(100*100*4),context:null,map:n,canvas:l,onAdd:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.context=l.getContext("2d")},render:function(){let r=this.width/2*.3,w=this.context,I=1e3,A=performance.now()%I/I;if(w){if(c){let L=this.width/2*.7*A+r;w.clearRect(0,0,this.width,this.height),w.beginPath(),w.arc(this.width/2,this.height/2,L,0,Math.PI*2),w.fillStyle=`${kq(o,A)}`,w.fill()}w.beginPath(),w.arc(this.width/2,this.height/2,r,0,Math.PI*2),w.fillStyle=o,w.strokeStyle="white",c?w.lineWidth=2+4*(1-A):w.lineWidth=4,w.fill(),w.stroke(),this.data=w.getImageData(0,0,this.width,this.height).data}return this.map?.triggerRepaint(),!0}}}function kq(o,n){let l=n-.1,c=1-l>.1?1-l:.1,f=Math.round(Math.min(Math.max(c??1,0),1)*255);return o+f.toString(16).toUpperCase()}var Oq=[{id:"1",latitude:50.05423456789012,longitude:19.93845678901234},{id:"2",latitude:50.051601681737964,longitude:19.94527204613522},{id:"3",latitude:50.05773375024379,longitude:19.943222265625},{id:"4",latitude:50.05490381469543,longitude:19.93778991699219},{id:"5",latitude:50.05760487599164,longitude:19.937191009521484},{id:"6",latitude:50.05824547073284,longitude:19.930737670577457},{id:"7",latitude:50.05684123456789,longitude:19.93645678012345},{id:"8",latitude:50.05567891234567,longitude:19.94123456789012},{id:"9",latitude:50.05345678901234,longitude:19.93987654321098},{id:"10",latitude:50.05234567890123,longitude:19.93876543210987},{id:"11",latitude:50.05123456789012,longitude:19.94098765432109},{id:"12",latitude:50.05987654321098,longitude:19.93567890123456},{id:"13",latitude:50.05876543210987,longitude:19.94456789012345},{id:"14",latitude:50.05432109876543,longitude:19.94234567890123},{id:"15",latitude:50.05543210987654,longitude:19.94345678901234},{id:"16",latitude:50.05754321098765,longitude:19.94198765432109},{id:"17",latitude:50.05643210987654,longitude:19.93912345678901},{id:"18",latitude:50.05321098765432,longitude:19.9380123456789},{id:"19",latitude:50.05210987654321,longitude:19.93765432109876},{id:"20",latitude:50.05198765432109,longitude:19.93654321098765},{id:"21",latitude:50.05123456789012,longitude:19.93712345678901},{id:"22",latitude:50.05234567890123,longitude:19.94123456789012},{id:"23",latitude:50.05345678901234,longitude:19.94234567890123},{id:"24",latitude:50.05456789012345,longitude:19.93845678901234},{id:"25",latitude:50.05567890123456,longitude:19.93956789012345},{id:"26",latitude:50.05678901234567,longitude:19.94067890123456},{id:"27",latitude:50.05789012345678,longitude:19.93578901234567},{id:"28",latitude:50.05890123456789,longitude:19.93689012345678},{id:"29",latitude:50.0590123456789,longitude:19.94112345678901},{id:"30",latitude:50.05112345678901,longitude:19.94323456789012},{id:"31",latitude:50.05223456789012,longitude:19.93734567890123},{id:"32",latitude:50.05334567890123,longitude:19.94245678901234},{id:"33",latitude:50.05445678901234,longitude:19.93856789012345},{id:"34",latitude:50.05556789012345,longitude:19.93967890123456},{id:"35",latitude:50.05667890123456,longitude:19.94078901234567},{id:"36",latitude:50.05778901234567,longitude:19.93589012345678},{id:"37",latitude:50.05889012345678,longitude:19.93690123456789},{id:"38",latitude:50.05990123456789,longitude:19.9410123456789},{id:"39",latitude:50.0510123456789,longitude:19.94312345678901},{id:"40",latitude:50.05212345678901,longitude:19.93723456789012},{id:"41",latitude:50.05323456789012,longitude:19.94234567890123},{id:"42",latitude:50.05434567890123,longitude:19.93845678901234},{id:"43",latitude:50.05545678901234,longitude:19.93956789012345},{id:"44",latitude:50.05656789012345,longitude:19.94067890123456},{id:"45",latitude:50.05767890123456,longitude:19.93578901234567},{id:"46",latitude:50.05878901234567,longitude:19.93689012345678},{id:"47",latitude:50.05989012345678,longitude:19.9410123456789},{id:"48",latitude:50.05190123456789,longitude:19.94312345678901},{id:"49",latitude:50.0520123456789,longitude:19.93723456789012},{id:"50",latitude:50.05312345678901,longitude:19.94234567890123}],kL=Oq;var Fq=o=>({width:o}),OL=(()=>{let n=class n{constructor(){this.batteryLevel=58,this.batteryCondition=bp.Medium}ngOnInit(){this.batteryCondition=this.calculateBatteryCondition(this.batteryLevel)}calculateBatteryCondition(c){return c>75?bp.Good:c>50?bp.Medium:c>25?bp.Low:bp.Critical}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=pi({type:n,selectors:[["app-battery-level"]],inputs:{batteryLevel:"batteryLevel"},standalone:!0,features:[mi],decls:6,vars:5,consts:[[1,"battery-label"],[1,"battery-container"],[1,"battery-level",3,"ngStyle"]],template:function(f,r){f&1&&(Ft(0,"div",0),Vn(1,"Battery Level"),kt(),Ft(2,"div",1)(3,"div",2),Vn(4),kt(),Vn(5),kt()),f&2&&(Bn(3),Ai("ngStyle",rp(3,Fq,r.batteryLevel+"%")),Bn(),Pr(" ",r.batteryLevel,"%"),Bn(),Pr(" ",r.batteryCondition,`
`))},dependencies:[qi,Lx],styles:[".battery-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#c2baba;border-radius:25px;display:flex;align-items:center;padding-right:10px;justify-content:space-between}.battery-container[_ngcontent-%COMP%]   .battery-level[_ngcontent-%COMP%]{height:inherit;display:flex;align-items:center;justify-content:center;border-radius:25px;background-color:#ecc6ef}.battery-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}"]});let o=n;return o})(),bp=function(o){return o.Good="GOOD",o.Medium="MEDIUM",o.Low="LOW",o.Critical="CRITICAL",o}(bp||{});function Nq(o,n){if(o&1&&(Ft(0,"div",11),Vn(1),kt()),o&2){let l=n.$implicit;VC("ngClass",l.alarmLevel),Bn(),Pr(" ",l.alarmCount," ")}}var YI=(()=>{let n=class n{constructor(){this.showSensorDetails=!1,this.sensorId="Sensor #471",this.responsible="Deratex Polska",this.alarmsData=[{alarmLevel:"critical",alarmCount:3},{alarmLevel:"high",alarmCount:1},{alarmLevel:"low",alarmCount:2}],this.batteryLevel=78,this.location={street:"ul. Malborska",building:"85",city:"Krak\xF3w",additionalInfo:"2 pi\u0119tro, zaraz za winklem"},this.hideDetails=new zr}emitHideDetails(){this.hideDetails.emit(!0)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=pi({type:n,selectors:[["app-sensor-details"]],inputs:{showSensorDetails:"showSensorDetails",sensorId:"sensorId",responsible:"responsible",alarmsData:"alarmsData",batteryLevel:"batteryLevel",location:"location"},outputs:{hideDetails:"hideDetails"},standalone:!0,features:[mi],decls:17,vars:7,consts:[[1,"close",3,"click"],[1,"overlay-container"],[1,"sensor-container"],[1,"responsible-label"],[1,"responsible-container"],[1,"alarms-label"],[1,"alarms-container"],["class","alarm",3,"ngClass",4,"ngFor","ngForOf"],[3,"batteryLevel"],[1,"localization-label"],[1,"localization-container"],[1,"alarm",3,"ngClass"]],template:function(f,r){f&1&&(Ft(0,"a",0),bi("click",function(){return r.emitHideDetails()}),kt(),Ft(1,"div",1)(2,"div",2),Vn(3),kt(),Ft(4,"div",3),Vn(5,"Responsible"),kt(),Ft(6,"div",4),Vn(7),kt(),Ft(8,"div",5),Vn(9,"Alarms"),kt(),Ft(10,"div",6),jr(11,Nq,2,2,"div",7),kt(),Wn(12,"app-battery-level",8),Ft(13,"div",9),Vn(14,"Localization"),kt(),Ft(15,"div",10),Vn(16),kt()()),f&2&&(Bn(3),Pr(" ",r.sensorId," "),Bn(4),Pr(" ",r.responsible," "),Bn(4),Ai("ngForOf",r.alarmsData),Bn(),Ai("batteryLevel",r.batteryLevel),Bn(4),jC(" ",r.location.street," ",r.location.building,", ",r.location.city," "))},dependencies:[qi,Ox,qc,OL],styles:['.overlay-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:60%;height:100%;z-index:100;background-color:#fff;opacity:.9;padding-left:20%;padding-right:20%;text-wrap:nowrap;display:flex;flex-direction:column;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif;transition:all .5s}.overlay-container[_ngcontent-%COMP%]   .sensor-container[_ngcontent-%COMP%]{width:100%;margin-top:10vh;font-size:150%}.overlay-container[_ngcontent-%COMP%]   .responsible-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:10vh}.overlay-container[_ngcontent-%COMP%]   .responsible-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.overlay-container[_ngcontent-%COMP%]   .alarms-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:30px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:20px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]   .alarm[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:40px;border-radius:50%}.overlay-container[_ngcontent-%COMP%]   .localization-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}.overlay-container[_ngcontent-%COMP%]   .localization-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.critical[_ngcontent-%COMP%]{background-color:#ecc6ef}.high[_ngcontent-%COMP%]{background-color:#ffeb82}.low[_ngcontent-%COMP%]{background-color:#eaebed}.close[_ngcontent-%COMP%]{position:absolute;z-index:105;right:32px;top:20px;width:20px;height:20px;scale:.7}.close[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}.close[_ngcontent-%COMP%]:before, .close[_ngcontent-%COMP%]:after{z-index:105;position:absolute;left:15px;content:" ";height:33px;width:2px;background-color:#333}.close[_ngcontent-%COMP%]:before{transform:rotate(45deg)}.close[_ngcontent-%COMP%]:after{transform:rotate(-45deg)}']});let o=n;return o})();var XI=(()=>{let n=class n{constructor(){this.url="http://localhost:3000/places"}getAllLocations(){return Tg(this,null,function*(){let f=yield(yield fetch(this.url)).text();return JSON.parse(f)??[]})}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Wh=class extends Map{constructor(n,l=Vq){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:l}}),n!=null)for(let[c,f]of n)this.set(c,f)}get(n){return super.get(FL(this,n))}has(n){return super.has(FL(this,n))}set(n,l){return super.set(zq(this,n),l)}delete(n){return super.delete(Bq(this,n))}};function FL({_intern:o,_key:n},l){let c=n(l);return o.has(c)?o.get(c):l}function zq({_intern:o,_key:n},l){let c=n(l);return o.has(c)?o.get(c):(o.set(c,l),l)}function Bq({_intern:o,_key:n},l){let c=n(l);return o.has(c)&&(l=o.get(c),o.delete(c)),l}function Vq(o){return o!==null&&typeof o=="object"?o.valueOf():o}function ub(o){return o}function hb(o,...n){return jq(o,ub,ub,n)}function jq(o,n,l,c){return function f(r,w){if(w>=c.length)return l(r);let I=new Wh,A=c[w++],L=-1;for(let U of r){let Q=A(U,++L,r),fe=I.get(Q);fe?fe.push(U):I.set(Q,[U])}for(let[U,Q]of I)I.set(U,f(Q,w));return n(I)}(o,0)}var Uq={value:()=>{}};function zL(){for(var o=0,n=arguments.length,l={},c;o<n;++o){if(!(c=arguments[o]+"")||c in l||/[\s.]/.test(c))throw new Error("illegal type: "+c);l[c]=[]}return new db(l)}function db(o){this._=o}function $q(o,n){return o.trim().split(/^|\s+/).map(function(l){var c="",f=l.indexOf(".");if(f>=0&&(c=l.slice(f+1),l=l.slice(0,f)),l&&!n.hasOwnProperty(l))throw new Error("unknown type: "+l);return{type:l,name:c}})}db.prototype=zL.prototype={constructor:db,on:function(o,n){var l=this._,c=$q(o+"",l),f,r=-1,w=c.length;if(arguments.length<2){for(;++r<w;)if((f=(o=c[r]).type)&&(f=Gq(l[f],o.name)))return f;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++r<w;)if(f=(o=c[r]).type)l[f]=NL(l[f],o.name,n);else if(n==null)for(f in l)l[f]=NL(l[f],o.name,null);return this},copy:function(){var o={},n=this._;for(var l in n)o[l]=n[l].slice();return new db(o)},call:function(o,n){if((f=arguments.length-2)>0)for(var l=new Array(f),c=0,f,r;c<f;++c)l[c]=arguments[c+2];if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(r=this._[o],c=0,f=r.length;c<f;++c)r[c].value.apply(n,l)},apply:function(o,n,l){if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(var c=this._[o],f=0,r=c.length;f<r;++f)c[f].value.apply(n,l)}};function Gq(o,n){for(var l=0,c=o.length,f;l<c;++l)if((f=o[l]).name===n)return f.value}function NL(o,n,l){for(var c=0,f=o.length;c<f;++c)if(o[c].name===n){o[c]=Uq,o=o.slice(0,c).concat(o.slice(c+1));break}return l!=null&&o.push({name:n,value:l}),o}var Zh=zL;var fb="http://www.w3.org/1999/xhtml",KI={svg:"http://www.w3.org/2000/svg",xhtml:fb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function bl(o){var n=o+="",l=n.indexOf(":");return l>=0&&(n=o.slice(0,l))!=="xmlns"&&(o=o.slice(l+1)),KI.hasOwnProperty(n)?{space:KI[n],local:o}:o}function Hq(o){return function(){var n=this.ownerDocument,l=this.namespaceURI;return l===fb&&n.documentElement.namespaceURI===fb?n.createElement(o):n.createElementNS(l,o)}}function qq(o){return function(){return this.ownerDocument.createElementNS(o.space,o.local)}}function pb(o){var n=bl(o);return(n.local?qq:Hq)(n)}function Wq(){}function Yh(o){return o==null?Wq:function(){return this.querySelector(o)}}function BL(o){typeof o!="function"&&(o=Yh(o));for(var n=this._groups,l=n.length,c=new Array(l),f=0;f<l;++f)for(var r=n[f],w=r.length,I=c[f]=new Array(w),A,L,U=0;U<w;++U)(A=r[U])&&(L=o.call(A,A.__data__,U,r))&&("__data__"in A&&(L.__data__=A.__data__),I[U]=L);return new Yi(c,this._parents)}function QI(o){return o==null?[]:Array.isArray(o)?o:Array.from(o)}function Zq(){return[]}function b_(o){return o==null?Zq:function(){return this.querySelectorAll(o)}}function Yq(o){return function(){return QI(o.apply(this,arguments))}}function VL(o){typeof o=="function"?o=Yq(o):o=b_(o);for(var n=this._groups,l=n.length,c=[],f=[],r=0;r<l;++r)for(var w=n[r],I=w.length,A,L=0;L<I;++L)(A=w[L])&&(c.push(o.call(A,A.__data__,L,w)),f.push(A));return new Yi(c,f)}function w_(o){return function(){return this.matches(o)}}function mb(o){return function(n){return n.matches(o)}}var Xq=Array.prototype.find;function Kq(o){return function(){return Xq.call(this.children,o)}}function Qq(){return this.firstElementChild}function jL(o){return this.select(o==null?Qq:Kq(typeof o=="function"?o:mb(o)))}var Jq=Array.prototype.filter;function e9(){return Array.from(this.children)}function t9(o){return function(){return Jq.call(this.children,o)}}function UL(o){return this.selectAll(o==null?e9:t9(typeof o=="function"?o:mb(o)))}function $L(o){typeof o!="function"&&(o=w_(o));for(var n=this._groups,l=n.length,c=new Array(l),f=0;f<l;++f)for(var r=n[f],w=r.length,I=c[f]=[],A,L=0;L<w;++L)(A=r[L])&&o.call(A,A.__data__,L,r)&&I.push(A);return new Yi(c,this._parents)}function gb(o){return new Array(o.length)}function GL(){return new Yi(this._enter||this._groups.map(gb),this._parents)}function E_(o,n){this.ownerDocument=o.ownerDocument,this.namespaceURI=o.namespaceURI,this._next=null,this._parent=o,this.__data__=n}E_.prototype={constructor:E_,appendChild:function(o){return this._parent.insertBefore(o,this._next)},insertBefore:function(o,n){return this._parent.insertBefore(o,n)},querySelector:function(o){return this._parent.querySelector(o)},querySelectorAll:function(o){return this._parent.querySelectorAll(o)}};function HL(o){return function(){return o}}function n9(o,n,l,c,f,r){for(var w=0,I,A=n.length,L=r.length;w<L;++w)(I=n[w])?(I.__data__=r[w],c[w]=I):l[w]=new E_(o,r[w]);for(;w<A;++w)(I=n[w])&&(f[w]=I)}function i9(o,n,l,c,f,r,w){var I,A,L=new Map,U=n.length,Q=r.length,fe=new Array(U),he;for(I=0;I<U;++I)(A=n[I])&&(fe[I]=he=w.call(A,A.__data__,I,n)+"",L.has(he)?f[I]=A:L.set(he,A));for(I=0;I<Q;++I)he=w.call(o,r[I],I,r)+"",(A=L.get(he))?(c[I]=A,A.__data__=r[I],L.delete(he)):l[I]=new E_(o,r[I]);for(I=0;I<U;++I)(A=n[I])&&L.get(fe[I])===A&&(f[I]=A)}function r9(o){return o.__data__}function qL(o,n){if(!arguments.length)return Array.from(this,r9);var l=n?i9:n9,c=this._parents,f=this._groups;typeof o!="function"&&(o=HL(o));for(var r=f.length,w=new Array(r),I=new Array(r),A=new Array(r),L=0;L<r;++L){var U=c[L],Q=f[L],fe=Q.length,he=o9(o.call(U,U&&U.__data__,L,c)),be=he.length,De=I[L]=new Array(be),Ke=w[L]=new Array(be),Fe=A[L]=new Array(fe);l(U,Q,De,Ke,Fe,he,n);for(var tt=0,ft=0,Ue,Vt;tt<be;++tt)if(Ue=De[tt]){for(tt>=ft&&(ft=tt+1);!(Vt=Ke[ft])&&++ft<be;);Ue._next=Vt||null}}return w=new Yi(w,c),w._enter=I,w._exit=A,w}function o9(o){return typeof o=="object"&&"length"in o?o:Array.from(o)}function WL(){return new Yi(this._exit||this._groups.map(gb),this._parents)}function ZL(o,n,l){var c=this.enter(),f=this,r=this.exit();return typeof o=="function"?(c=o(c),c&&(c=c.selection())):c=c.append(o+""),n!=null&&(f=n(f),f&&(f=f.selection())),l==null?r.remove():l(r),c&&f?c.merge(f).order():f}function YL(o){for(var n=o.selection?o.selection():o,l=this._groups,c=n._groups,f=l.length,r=c.length,w=Math.min(f,r),I=new Array(f),A=0;A<w;++A)for(var L=l[A],U=c[A],Q=L.length,fe=I[A]=new Array(Q),he,be=0;be<Q;++be)(he=L[be]||U[be])&&(fe[be]=he);for(;A<f;++A)I[A]=l[A];return new Yi(I,this._parents)}function XL(){for(var o=this._groups,n=-1,l=o.length;++n<l;)for(var c=o[n],f=c.length-1,r=c[f],w;--f>=0;)(w=c[f])&&(r&&w.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(w,r),r=w);return this}function KL(o){o||(o=s9);function n(Q,fe){return Q&&fe?o(Q.__data__,fe.__data__):!Q-!fe}for(var l=this._groups,c=l.length,f=new Array(c),r=0;r<c;++r){for(var w=l[r],I=w.length,A=f[r]=new Array(I),L,U=0;U<I;++U)(L=w[U])&&(A[U]=L);A.sort(n)}return new Yi(f,this._parents).order()}function s9(o,n){return o<n?-1:o>n?1:o>=n?0:NaN}function QL(){var o=arguments[0];return arguments[0]=this,o.apply(null,arguments),this}function JL(){return Array.from(this)}function eF(){for(var o=this._groups,n=0,l=o.length;n<l;++n)for(var c=o[n],f=0,r=c.length;f<r;++f){var w=c[f];if(w)return w}return null}function tF(){let o=0;for(let n of this)++o;return o}function nF(){return!this.node()}function iF(o){for(var n=this._groups,l=0,c=n.length;l<c;++l)for(var f=n[l],r=0,w=f.length,I;r<w;++r)(I=f[r])&&o.call(I,I.__data__,r,f);return this}function a9(o){return function(){this.removeAttribute(o)}}function l9(o){return function(){this.removeAttributeNS(o.space,o.local)}}function c9(o,n){return function(){this.setAttribute(o,n)}}function u9(o,n){return function(){this.setAttributeNS(o.space,o.local,n)}}function h9(o,n){return function(){var l=n.apply(this,arguments);l==null?this.removeAttribute(o):this.setAttribute(o,l)}}function d9(o,n){return function(){var l=n.apply(this,arguments);l==null?this.removeAttributeNS(o.space,o.local):this.setAttributeNS(o.space,o.local,l)}}function rF(o,n){var l=bl(o);if(arguments.length<2){var c=this.node();return l.local?c.getAttributeNS(l.space,l.local):c.getAttribute(l)}return this.each((n==null?l.local?l9:a9:typeof n=="function"?l.local?d9:h9:l.local?u9:c9)(l,n))}function _b(o){return o.ownerDocument&&o.ownerDocument.defaultView||o.document&&o||o.defaultView}function f9(o){return function(){this.style.removeProperty(o)}}function p9(o,n,l){return function(){this.style.setProperty(o,n,l)}}function m9(o,n,l){return function(){var c=n.apply(this,arguments);c==null?this.style.removeProperty(o):this.style.setProperty(o,c,l)}}function oF(o,n,l){return arguments.length>1?this.each((n==null?f9:typeof n=="function"?m9:p9)(o,n,l??"")):Kc(this.node(),o)}function Kc(o,n){return o.style.getPropertyValue(n)||_b(o).getComputedStyle(o,null).getPropertyValue(n)}function g9(o){return function(){delete this[o]}}function _9(o,n){return function(){this[o]=n}}function y9(o,n){return function(){var l=n.apply(this,arguments);l==null?delete this[o]:this[o]=l}}function sF(o,n){return arguments.length>1?this.each((n==null?g9:typeof n=="function"?y9:_9)(o,n)):this.node()[o]}function aF(o){return o.trim().split(/^|\s+/)}function JI(o){return o.classList||new lF(o)}function lF(o){this._node=o,this._names=aF(o.getAttribute("class")||"")}lF.prototype={add:function(o){var n=this._names.indexOf(o);n<0&&(this._names.push(o),this._node.setAttribute("class",this._names.join(" ")))},remove:function(o){var n=this._names.indexOf(o);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(o){return this._names.indexOf(o)>=0}};function cF(o,n){for(var l=JI(o),c=-1,f=n.length;++c<f;)l.add(n[c])}function uF(o,n){for(var l=JI(o),c=-1,f=n.length;++c<f;)l.remove(n[c])}function v9(o){return function(){cF(this,o)}}function x9(o){return function(){uF(this,o)}}function b9(o,n){return function(){(n.apply(this,arguments)?cF:uF)(this,o)}}function hF(o,n){var l=aF(o+"");if(arguments.length<2){for(var c=JI(this.node()),f=-1,r=l.length;++f<r;)if(!c.contains(l[f]))return!1;return!0}return this.each((typeof n=="function"?b9:n?v9:x9)(l,n))}function w9(){this.textContent=""}function E9(o){return function(){this.textContent=o}}function T9(o){return function(){var n=o.apply(this,arguments);this.textContent=n??""}}function dF(o){return arguments.length?this.each(o==null?w9:(typeof o=="function"?T9:E9)(o)):this.node().textContent}function C9(){this.innerHTML=""}function I9(o){return function(){this.innerHTML=o}}function D9(o){return function(){var n=o.apply(this,arguments);this.innerHTML=n??""}}function fF(o){return arguments.length?this.each(o==null?C9:(typeof o=="function"?D9:I9)(o)):this.node().innerHTML}function S9(){this.nextSibling&&this.parentNode.appendChild(this)}function pF(){return this.each(S9)}function M9(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function mF(){return this.each(M9)}function gF(o){var n=typeof o=="function"?o:pb(o);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function A9(){return null}function _F(o,n){var l=typeof o=="function"?o:pb(o),c=n==null?A9:typeof n=="function"?n:Yh(n);return this.select(function(){return this.insertBefore(l.apply(this,arguments),c.apply(this,arguments)||null)})}function P9(){var o=this.parentNode;o&&o.removeChild(this)}function yF(){return this.each(P9)}function R9(){var o=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(o,this.nextSibling):o}function k9(){var o=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(o,this.nextSibling):o}function vF(o){return this.select(o?k9:R9)}function xF(o){return arguments.length?this.property("__data__",o):this.node().__data__}function O9(o){return function(n){o.call(this,n,this.__data__)}}function L9(o){return o.trim().split(/^|\s+/).map(function(n){var l="",c=n.indexOf(".");return c>=0&&(l=n.slice(c+1),n=n.slice(0,c)),{type:n,name:l}})}function F9(o){return function(){var n=this.__on;if(n){for(var l=0,c=-1,f=n.length,r;l<f;++l)r=n[l],(!o.type||r.type===o.type)&&r.name===o.name?this.removeEventListener(r.type,r.listener,r.options):n[++c]=r;++c?n.length=c:delete this.__on}}}function N9(o,n,l){return function(){var c=this.__on,f,r=O9(n);if(c){for(var w=0,I=c.length;w<I;++w)if((f=c[w]).type===o.type&&f.name===o.name){this.removeEventListener(f.type,f.listener,f.options),this.addEventListener(f.type,f.listener=r,f.options=l),f.value=n;return}}this.addEventListener(o.type,r,l),f={type:o.type,name:o.name,value:n,listener:r,options:l},c?c.push(f):this.__on=[f]}}function bF(o,n,l){var c=L9(o+""),f,r=c.length,w;if(arguments.length<2){var I=this.node().__on;if(I){for(var A=0,L=I.length,U;A<L;++A)for(f=0,U=I[A];f<r;++f)if((w=c[f]).type===U.type&&w.name===U.name)return U.value}return}for(I=n?N9:F9,f=0;f<r;++f)this.each(I(c[f],n,l));return this}function wF(o,n,l){var c=_b(o),f=c.CustomEvent;typeof f=="function"?f=new f(n,l):(f=c.document.createEvent("Event"),l?(f.initEvent(n,l.bubbles,l.cancelable),f.detail=l.detail):f.initEvent(n,!1,!1)),o.dispatchEvent(f)}function z9(o,n){return function(){return wF(this,o,n)}}function B9(o,n){return function(){return wF(this,o,n.apply(this,arguments))}}function EF(o,n){return this.each((typeof n=="function"?B9:z9)(o,n))}function*TF(){for(var o=this._groups,n=0,l=o.length;n<l;++n)for(var c=o[n],f=0,r=c.length,w;f<r;++f)(w=c[f])&&(yield w)}var eD=[null];function Yi(o,n){this._groups=o,this._parents=n}function CF(){return new Yi([[document.documentElement]],eD)}function V9(){return this}Yi.prototype=CF.prototype={constructor:Yi,select:BL,selectAll:VL,selectChild:jL,selectChildren:UL,filter:$L,data:qL,enter:GL,exit:WL,join:ZL,merge:YL,selection:V9,order:XL,sort:KL,call:QL,nodes:JL,node:eF,size:tF,empty:nF,each:iF,attr:rF,style:oF,property:sF,classed:hF,text:dF,html:fF,raise:pF,lower:mF,append:gF,insert:_F,remove:yF,clone:vF,datum:xF,on:bF,dispatch:EF,[Symbol.iterator]:TF};var wl=CF;function so(o){return typeof o=="string"?new Yi([[document.querySelector(o)]],[document.documentElement]):new Yi([[o]],eD)}function IF(o){let n;for(;n=o.sourceEvent;)o=n;return o}function yb(o,n){if(o=IF(o),n===void 0&&(n=o.currentTarget),n){var l=n.ownerSVGElement||n;if(l.createSVGPoint){var c=l.createSVGPoint();return c.x=o.clientX,c.y=o.clientY,c=c.matrixTransform(n.getScreenCTM().inverse()),[c.x,c.y]}if(n.getBoundingClientRect){var f=n.getBoundingClientRect();return[o.clientX-f.left-n.clientLeft,o.clientY-f.top-n.clientTop]}}return[o.pageX,o.pageY]}var DF={passive:!1},Xh={capture:!0,passive:!1};function vb(o){o.stopImmediatePropagation()}function Qc(o){o.preventDefault(),o.stopImmediatePropagation()}function SF(o){var n=o.document.documentElement,l=so(o).on("dragstart.drag",Qc,Xh);"onselectstart"in n?l.on("selectstart.drag",Qc,Xh):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function MF(o,n){var l=o.document.documentElement,c=so(o).on("dragstart.drag",null);n&&(c.on("click.drag",Qc,Xh),setTimeout(function(){c.on("click.drag",null)},0)),"onselectstart"in l?c.on("selectstart.drag",null):(l.style.MozUserSelect=l.__noselect,delete l.__noselect)}var T_=o=>()=>o;function C_(o,{sourceEvent:n,subject:l,target:c,identifier:f,active:r,x:w,y:I,dx:A,dy:L,dispatch:U}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:l,enumerable:!0,configurable:!0},target:{value:c,enumerable:!0,configurable:!0},identifier:{value:f,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:w,enumerable:!0,configurable:!0},y:{value:I,enumerable:!0,configurable:!0},dx:{value:A,enumerable:!0,configurable:!0},dy:{value:L,enumerable:!0,configurable:!0},_:{value:U}})}C_.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function j9(o){return!o.ctrlKey&&!o.button}function U9(){return this.parentNode}function $9(o,n){return n??{x:o.x,y:o.y}}function G9(){return navigator.maxTouchPoints||"ontouchstart"in this}function I_(){var o=j9,n=U9,l=$9,c=G9,f={},r=Zh("start","drag","end"),w=0,I,A,L,U,Q=0;function fe(Ue){Ue.on("mousedown.drag",he).filter(c).on("touchstart.drag",Ke).on("touchmove.drag",Fe,DF).on("touchend.drag touchcancel.drag",tt).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function he(Ue,Vt){if(!(U||!o.call(this,Ue,Vt))){var Jt=ft(this,n.call(this,Ue,Vt),Ue,Vt,"mouse");Jt&&(so(Ue.view).on("mousemove.drag",be,Xh).on("mouseup.drag",De,Xh),SF(Ue.view),vb(Ue),L=!1,I=Ue.clientX,A=Ue.clientY,Jt("start",Ue))}}function be(Ue){if(Qc(Ue),!L){var Vt=Ue.clientX-I,Jt=Ue.clientY-A;L=Vt*Vt+Jt*Jt>Q}f.mouse("drag",Ue)}function De(Ue){so(Ue.view).on("mousemove.drag mouseup.drag",null),MF(Ue.view,L),Qc(Ue),f.mouse("end",Ue)}function Ke(Ue,Vt){if(o.call(this,Ue,Vt)){var Jt=Ue.changedTouches,nn=n.call(this,Ue,Vt),Et=Jt.length,oi,It;for(oi=0;oi<Et;++oi)(It=ft(this,nn,Ue,Vt,Jt[oi].identifier,Jt[oi]))&&(vb(Ue),It("start",Ue,Jt[oi]))}}function Fe(Ue){var Vt=Ue.changedTouches,Jt=Vt.length,nn,Et;for(nn=0;nn<Jt;++nn)(Et=f[Vt[nn].identifier])&&(Qc(Ue),Et("drag",Ue,Vt[nn]))}function tt(Ue){var Vt=Ue.changedTouches,Jt=Vt.length,nn,Et;for(U&&clearTimeout(U),U=setTimeout(function(){U=null},500),nn=0;nn<Jt;++nn)(Et=f[Vt[nn].identifier])&&(vb(Ue),Et("end",Ue,Vt[nn]))}function ft(Ue,Vt,Jt,nn,Et,oi){var It=r.copy(),Ei=yb(oi||Jt,Vt),Di,Ui,wn;if((wn=l.call(Ue,new C_("beforestart",{sourceEvent:Jt,target:fe,identifier:Et,active:w,x:Ei[0],y:Ei[1],dx:0,dy:0,dispatch:It}),nn))!=null)return Di=wn.x-Ei[0]||0,Ui=wn.y-Ei[1]||0,function qo(wt,jt,Zt){var vn=Ei,Nt;switch(wt){case"start":f[Et]=qo,Nt=w++;break;case"end":delete f[Et],--w;case"drag":Ei=yb(Zt||jt,Vt),Nt=w;break}It.call(wt,Ue,new C_(wt,{sourceEvent:jt,subject:wn,target:fe,identifier:Et,active:Nt,x:Ei[0]+Di,y:Ei[1]+Ui,dx:Ei[0]-vn[0],dy:Ei[1]-vn[1],dispatch:It}),nn)}}return fe.filter=function(Ue){return arguments.length?(o=typeof Ue=="function"?Ue:T_(!!Ue),fe):o},fe.container=function(Ue){return arguments.length?(n=typeof Ue=="function"?Ue:T_(Ue),fe):n},fe.subject=function(Ue){return arguments.length?(l=typeof Ue=="function"?Ue:T_(Ue),fe):l},fe.touchable=function(Ue){return arguments.length?(c=typeof Ue=="function"?Ue:T_(!!Ue),fe):c},fe.on=function(){var Ue=r.on.apply(r,arguments);return Ue===r?fe:Ue},fe.clickDistance=function(Ue){return arguments.length?(Q=(Ue=+Ue)*Ue,fe):Math.sqrt(Q)},fe}function xb(o,n,l){o.prototype=n.prototype=l,l.constructor=o}function tD(o,n){var l=Object.create(o.prototype);for(var c in n)l[c]=n[c];return l}function M_(){}var D_=.7,Eb=1/D_,wp="\\s*([+-]?\\d+)\\s*",S_="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",H9=/^#([0-9a-f]{3,8})$/,q9=new RegExp(`^rgb\\(${wp},${wp},${wp}\\)$`),W9=new RegExp(`^rgb\\(${Pa},${Pa},${Pa}\\)$`),Z9=new RegExp(`^rgba\\(${wp},${wp},${wp},${S_}\\)$`),Y9=new RegExp(`^rgba\\(${Pa},${Pa},${Pa},${S_}\\)$`),X9=new RegExp(`^hsl\\(${S_},${Pa},${Pa}\\)$`),K9=new RegExp(`^hsla\\(${S_},${Pa},${Pa},${S_}\\)$`),AF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};xb(M_,Jc,{copy(o){return Object.assign(new this.constructor,this,o)},displayable(){return this.rgb().displayable()},hex:PF,formatHex:PF,formatHex8:Q9,formatHsl:J9,formatRgb:RF,toString:RF});function PF(){return this.rgb().formatHex()}function Q9(){return this.rgb().formatHex8()}function J9(){return zF(this).formatHsl()}function RF(){return this.rgb().formatRgb()}function Jc(o){var n,l;return o=(o+"").trim().toLowerCase(),(n=H9.exec(o))?(l=n[1].length,n=parseInt(n[1],16),l===6?kF(n):l===3?new Io(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):l===8?bb(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):l===4?bb(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=q9.exec(o))?new Io(n[1],n[2],n[3],1):(n=W9.exec(o))?new Io(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=Z9.exec(o))?bb(n[1],n[2],n[3],n[4]):(n=Y9.exec(o))?bb(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=X9.exec(o))?FF(n[1],n[2]/100,n[3]/100,1):(n=K9.exec(o))?FF(n[1],n[2]/100,n[3]/100,n[4]):AF.hasOwnProperty(o)?kF(AF[o]):o==="transparent"?new Io(NaN,NaN,NaN,0):null}function kF(o){return new Io(o>>16&255,o>>8&255,o&255,1)}function bb(o,n,l,c){return c<=0&&(o=n=l=NaN),new Io(o,n,l,c)}function eW(o){return o instanceof M_||(o=Jc(o)),o?(o=o.rgb(),new Io(o.r,o.g,o.b,o.opacity)):new Io}function Ep(o,n,l,c){return arguments.length===1?eW(o):new Io(o,n,l,c??1)}function Io(o,n,l,c){this.r=+o,this.g=+n,this.b=+l,this.opacity=+c}xb(Io,Ep,tD(M_,{brighter(o){return o=o==null?Eb:Math.pow(Eb,o),new Io(this.r*o,this.g*o,this.b*o,this.opacity)},darker(o){return o=o==null?D_:Math.pow(D_,o),new Io(this.r*o,this.g*o,this.b*o,this.opacity)},rgb(){return this},clamp(){return new Io(Qh(this.r),Qh(this.g),Qh(this.b),Tb(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:OF,formatHex:OF,formatHex8:tW,formatRgb:LF,toString:LF}));function OF(){return`#${Kh(this.r)}${Kh(this.g)}${Kh(this.b)}`}function tW(){return`#${Kh(this.r)}${Kh(this.g)}${Kh(this.b)}${Kh((isNaN(this.opacity)?1:this.opacity)*255)}`}function LF(){let o=Tb(this.opacity);return`${o===1?"rgb(":"rgba("}${Qh(this.r)}, ${Qh(this.g)}, ${Qh(this.b)}${o===1?")":`, ${o})`}`}function Tb(o){return isNaN(o)?1:Math.max(0,Math.min(1,o))}function Qh(o){return Math.max(0,Math.min(255,Math.round(o)||0))}function Kh(o){return o=Qh(o),(o<16?"0":"")+o.toString(16)}function FF(o,n,l,c){return c<=0?o=n=l=NaN:l<=0||l>=1?o=n=NaN:n<=0&&(o=NaN),new qs(o,n,l,c)}function zF(o){if(o instanceof qs)return new qs(o.h,o.s,o.l,o.opacity);if(o instanceof M_||(o=Jc(o)),!o)return new qs;if(o instanceof qs)return o;o=o.rgb();var n=o.r/255,l=o.g/255,c=o.b/255,f=Math.min(n,l,c),r=Math.max(n,l,c),w=NaN,I=r-f,A=(r+f)/2;return I?(n===r?w=(l-c)/I+(l<c)*6:l===r?w=(c-n)/I+2:w=(n-l)/I+4,I/=A<.5?r+f:2-r-f,w*=60):I=A>0&&A<1?0:w,new qs(w,I,A,o.opacity)}function BF(o,n,l,c){return arguments.length===1?zF(o):new qs(o,n,l,c??1)}function qs(o,n,l,c){this.h=+o,this.s=+n,this.l=+l,this.opacity=+c}xb(qs,BF,tD(M_,{brighter(o){return o=o==null?Eb:Math.pow(Eb,o),new qs(this.h,this.s,this.l*o,this.opacity)},darker(o){return o=o==null?D_:Math.pow(D_,o),new qs(this.h,this.s,this.l*o,this.opacity)},rgb(){var o=this.h%360+(this.h<0)*360,n=isNaN(o)||isNaN(this.s)?0:this.s,l=this.l,c=l+(l<.5?l:1-l)*n,f=2*l-c;return new Io(nD(o>=240?o-240:o+120,f,c),nD(o,f,c),nD(o<120?o+240:o-120,f,c),this.opacity)},clamp(){return new qs(NF(this.h),wb(this.s),wb(this.l),Tb(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let o=Tb(this.opacity);return`${o===1?"hsl(":"hsla("}${NF(this.h)}, ${wb(this.s)*100}%, ${wb(this.l)*100}%${o===1?")":`, ${o})`}`}}));function NF(o){return o=(o||0)%360,o<0?o+360:o}function wb(o){return Math.max(0,Math.min(1,o||0))}function nD(o,n,l){return(o<60?n+(l-n)*o/60:o<180?l:o<240?n+(l-n)*(240-o)/60:n)*255}function iD(o,n,l,c,f){var r=o*o,w=r*o;return((1-3*o+3*r-w)*n+(4-6*r+3*w)*l+(1+3*o+3*r-3*w)*c+w*f)/6}function VF(o){var n=o.length-1;return function(l){var c=l<=0?l=0:l>=1?(l=1,n-1):Math.floor(l*n),f=o[c],r=o[c+1],w=c>0?o[c-1]:2*f-r,I=c<n-1?o[c+2]:2*r-f;return iD((l-c/n)*n,w,f,r,I)}}function jF(o){var n=o.length;return function(l){var c=Math.floor(((l%=1)<0?++l:l)*n),f=o[(c+n-1)%n],r=o[c%n],w=o[(c+1)%n],I=o[(c+2)%n];return iD((l-c/n)*n,f,r,w,I)}}var rD=o=>()=>o;function nW(o,n){return function(l){return o+l*n}}function iW(o,n,l){return o=Math.pow(o,l),n=Math.pow(n,l)-o,l=1/l,function(c){return Math.pow(o+c*n,l)}}function UF(o){return(o=+o)==1?Cb:function(n,l){return l-n?iW(n,l,o):rD(isNaN(n)?l:n)}}function Cb(o,n){var l=n-o;return l?nW(o,l):rD(isNaN(o)?n:o)}var Ib=function o(n){var l=UF(n);function c(f,r){var w=l((f=Ep(f)).r,(r=Ep(r)).r),I=l(f.g,r.g),A=l(f.b,r.b),L=Cb(f.opacity,r.opacity);return function(U){return f.r=w(U),f.g=I(U),f.b=A(U),f.opacity=L(U),f+""}}return c.gamma=o,c}(1);function $F(o){return function(n){var l=n.length,c=new Array(l),f=new Array(l),r=new Array(l),w,I;for(w=0;w<l;++w)I=Ep(n[w]),c[w]=I.r||0,f[w]=I.g||0,r[w]=I.b||0;return c=o(c),f=o(f),r=o(r),I.opacity=1,function(A){return I.r=c(A),I.g=f(A),I.b=r(A),I+""}}}var rW=$F(VF),oW=$F(jF);function hs(o,n){return o=+o,n=+n,function(l){return o*(1-l)+n*l}}var sD=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,oD=new RegExp(sD.source,"g");function sW(o){return function(){return o}}function aW(o){return function(n){return o(n)+""}}function aD(o,n){var l=sD.lastIndex=oD.lastIndex=0,c,f,r,w=-1,I=[],A=[];for(o=o+"",n=n+"";(c=sD.exec(o))&&(f=oD.exec(n));)(r=f.index)>l&&(r=n.slice(l,r),I[w]?I[w]+=r:I[++w]=r),(c=c[0])===(f=f[0])?I[w]?I[w]+=f:I[++w]=f:(I[++w]=null,A.push({i:w,x:hs(c,f)})),l=oD.lastIndex;return l<n.length&&(r=n.slice(l),I[w]?I[w]+=r:I[++w]=r),I.length<2?A[0]?aW(A[0].x):sW(n):(n=A.length,function(L){for(var U=0,Q;U<n;++U)I[(Q=A[U]).i]=Q.x(L);return I.join("")})}var GF=180/Math.PI,Db={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function lD(o,n,l,c,f,r){var w,I,A;return(w=Math.sqrt(o*o+n*n))&&(o/=w,n/=w),(A=o*l+n*c)&&(l-=o*A,c-=n*A),(I=Math.sqrt(l*l+c*c))&&(l/=I,c/=I,A/=I),o*c<n*l&&(o=-o,n=-n,A=-A,w=-w),{translateX:f,translateY:r,rotate:Math.atan2(n,o)*GF,skewX:Math.atan(A)*GF,scaleX:w,scaleY:I}}var Sb;function HF(o){let n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(o+"");return n.isIdentity?Db:lD(n.a,n.b,n.c,n.d,n.e,n.f)}function qF(o){return o==null?Db:(Sb||(Sb=document.createElementNS("http://www.w3.org/2000/svg","g")),Sb.setAttribute("transform",o),(o=Sb.transform.baseVal.consolidate())?(o=o.matrix,lD(o.a,o.b,o.c,o.d,o.e,o.f)):Db)}function WF(o,n,l,c){function f(L){return L.length?L.pop()+" ":""}function r(L,U,Q,fe,he,be){if(L!==Q||U!==fe){var De=he.push("translate(",null,n,null,l);be.push({i:De-4,x:hs(L,Q)},{i:De-2,x:hs(U,fe)})}else(Q||fe)&&he.push("translate("+Q+n+fe+l)}function w(L,U,Q,fe){L!==U?(L-U>180?U+=360:U-L>180&&(L+=360),fe.push({i:Q.push(f(Q)+"rotate(",null,c)-2,x:hs(L,U)})):U&&Q.push(f(Q)+"rotate("+U+c)}function I(L,U,Q,fe){L!==U?fe.push({i:Q.push(f(Q)+"skewX(",null,c)-2,x:hs(L,U)}):U&&Q.push(f(Q)+"skewX("+U+c)}function A(L,U,Q,fe,he,be){if(L!==Q||U!==fe){var De=he.push(f(he)+"scale(",null,",",null,")");be.push({i:De-4,x:hs(L,Q)},{i:De-2,x:hs(U,fe)})}else(Q!==1||fe!==1)&&he.push(f(he)+"scale("+Q+","+fe+")")}return function(L,U){var Q=[],fe=[];return L=o(L),U=o(U),r(L.translateX,L.translateY,U.translateX,U.translateY,Q,fe),w(L.rotate,U.rotate,Q,fe),I(L.skewX,U.skewX,Q,fe),A(L.scaleX,L.scaleY,U.scaleX,U.scaleY,Q,fe),L=U=null,function(he){for(var be=-1,De=fe.length,Ke;++be<De;)Q[(Ke=fe[be]).i]=Ke.x(he);return Q.join("")}}}var cD=WF(HF,"px, ","px)","deg)"),uD=WF(qF,", ",")",")");var Tp=0,P_=0,A_=0,YF=1e3,Mb,R_,Ab=0,Jh=0,Pb=0,k_=typeof performance=="object"&&performance.now?performance:Date,XF=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(o){setTimeout(o,17)};function L_(){return Jh||(XF(lW),Jh=k_.now()+Pb)}function lW(){Jh=0}function O_(){this._call=this._time=this._next=null}O_.prototype=Cp.prototype={constructor:O_,restart:function(o,n,l){if(typeof o!="function")throw new TypeError("callback is not a function");l=(l==null?L_():+l)+(n==null?0:+n),!this._next&&R_!==this&&(R_?R_._next=this:Mb=this,R_=this),this._call=o,this._time=l,hD()},stop:function(){this._call&&(this._call=null,this._time=1/0,hD())}};function Cp(o,n,l){var c=new O_;return c.restart(o,n,l),c}function KF(){L_(),++Tp;for(var o=Mb,n;o;)(n=Jh-o._time)>=0&&o._call.call(void 0,n),o=o._next;--Tp}function ZF(){Jh=(Ab=k_.now())+Pb,Tp=P_=0;try{KF()}finally{Tp=0,uW(),Jh=0}}function cW(){var o=k_.now(),n=o-Ab;n>YF&&(Pb-=n,Ab=o)}function uW(){for(var o,n=Mb,l,c=1/0;n;)n._call?(c>n._time&&(c=n._time),o=n,n=n._next):(l=n._next,n._next=null,n=o?o._next=l:Mb=l);R_=o,hD(c)}function hD(o){if(!Tp){P_&&(P_=clearTimeout(P_));var n=o-Jh;n>24?(o<1/0&&(P_=setTimeout(ZF,o-k_.now()-Pb)),A_&&(A_=clearInterval(A_))):(A_||(Ab=k_.now(),A_=setInterval(cW,YF)),Tp=1,XF(ZF))}}function Rb(o,n,l){var c=new O_;return n=n==null?0:+n,c.restart(f=>{c.stop(),o(f+n)},n,l),c}var hW=Zh("start","end","cancel","interrupt"),dW=[],eN=0,QF=1,Ob=2,kb=3,JF=4,Lb=5,F_=6;function eu(o,n,l,c,f,r){var w=o.__transition;if(!w)o.__transition={};else if(l in w)return;fW(o,l,{name:n,index:c,group:f,on:hW,tween:dW,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:eN})}function N_(o,n){var l=Cr(o,n);if(l.state>eN)throw new Error("too late; already scheduled");return l}function $r(o,n){var l=Cr(o,n);if(l.state>kb)throw new Error("too late; already running");return l}function Cr(o,n){var l=o.__transition;if(!l||!(l=l[n]))throw new Error("transition not found");return l}function fW(o,n,l){var c=o.__transition,f;c[n]=l,l.timer=Cp(r,0,l.time);function r(L){l.state=QF,l.timer.restart(w,l.delay,l.time),l.delay<=L&&w(L-l.delay)}function w(L){var U,Q,fe,he;if(l.state!==QF)return A();for(U in c)if(he=c[U],he.name===l.name){if(he.state===kb)return Rb(w);he.state===JF?(he.state=F_,he.timer.stop(),he.on.call("interrupt",o,o.__data__,he.index,he.group),delete c[U]):+U<n&&(he.state=F_,he.timer.stop(),he.on.call("cancel",o,o.__data__,he.index,he.group),delete c[U])}if(Rb(function(){l.state===kb&&(l.state=JF,l.timer.restart(I,l.delay,l.time),I(L))}),l.state=Ob,l.on.call("start",o,o.__data__,l.index,l.group),l.state===Ob){for(l.state=kb,f=new Array(fe=l.tween.length),U=0,Q=-1;U<fe;++U)(he=l.tween[U].value.call(o,o.__data__,l.index,l.group))&&(f[++Q]=he);f.length=Q+1}}function I(L){for(var U=L<l.duration?l.ease.call(null,L/l.duration):(l.timer.restart(A),l.state=Lb,1),Q=-1,fe=f.length;++Q<fe;)f[Q].call(o,U);l.state===Lb&&(l.on.call("end",o,o.__data__,l.index,l.group),A())}function A(){l.state=F_,l.timer.stop(),delete c[n];for(var L in c)return;delete o.__transition}}function Fb(o,n){var l=o.__transition,c,f,r=!0,w;if(l){n=n==null?null:n+"";for(w in l){if((c=l[w]).name!==n){r=!1;continue}f=c.state>Ob&&c.state<Lb,c.state=F_,c.timer.stop(),c.on.call(f?"interrupt":"cancel",o,o.__data__,c.index,c.group),delete l[w]}r&&delete o.__transition}}function tN(o){return this.each(function(){Fb(this,o)})}function pW(o,n){var l,c;return function(){var f=$r(this,o),r=f.tween;if(r!==l){c=l=r;for(var w=0,I=c.length;w<I;++w)if(c[w].name===n){c=c.slice(),c.splice(w,1);break}}f.tween=c}}function mW(o,n,l){var c,f;if(typeof l!="function")throw new Error;return function(){var r=$r(this,o),w=r.tween;if(w!==c){f=(c=w).slice();for(var I={name:n,value:l},A=0,L=f.length;A<L;++A)if(f[A].name===n){f[A]=I;break}A===L&&f.push(I)}r.tween=f}}function nN(o,n){var l=this._id;if(o+="",arguments.length<2){for(var c=Cr(this.node(),l).tween,f=0,r=c.length,w;f<r;++f)if((w=c[f]).name===o)return w.value;return null}return this.each((n==null?pW:mW)(l,o,n))}function Ip(o,n,l){var c=o._id;return o.each(function(){var f=$r(this,c);(f.value||(f.value={}))[n]=l.apply(this,arguments)}),function(f){return Cr(f,c).value[n]}}function Nb(o,n){var l;return(typeof n=="number"?hs:n instanceof Jc?Ib:(l=Jc(n))?(n=l,Ib):aD)(o,n)}function gW(o){return function(){this.removeAttribute(o)}}function _W(o){return function(){this.removeAttributeNS(o.space,o.local)}}function yW(o,n,l){var c,f=l+"",r;return function(){var w=this.getAttribute(o);return w===f?null:w===c?r:r=n(c=w,l)}}function vW(o,n,l){var c,f=l+"",r;return function(){var w=this.getAttributeNS(o.space,o.local);return w===f?null:w===c?r:r=n(c=w,l)}}function xW(o,n,l){var c,f,r;return function(){var w,I=l(this),A;return I==null?void this.removeAttribute(o):(w=this.getAttribute(o),A=I+"",w===A?null:w===c&&A===f?r:(f=A,r=n(c=w,I)))}}function bW(o,n,l){var c,f,r;return function(){var w,I=l(this),A;return I==null?void this.removeAttributeNS(o.space,o.local):(w=this.getAttributeNS(o.space,o.local),A=I+"",w===A?null:w===c&&A===f?r:(f=A,r=n(c=w,I)))}}function iN(o,n){var l=bl(o),c=l==="transform"?uD:Nb;return this.attrTween(o,typeof n=="function"?(l.local?bW:xW)(l,c,Ip(this,"attr."+o,n)):n==null?(l.local?_W:gW)(l):(l.local?vW:yW)(l,c,n))}function wW(o,n){return function(l){this.setAttribute(o,n.call(this,l))}}function EW(o,n){return function(l){this.setAttributeNS(o.space,o.local,n.call(this,l))}}function TW(o,n){var l,c;function f(){var r=n.apply(this,arguments);return r!==c&&(l=(c=r)&&EW(o,r)),l}return f._value=n,f}function CW(o,n){var l,c;function f(){var r=n.apply(this,arguments);return r!==c&&(l=(c=r)&&wW(o,r)),l}return f._value=n,f}function rN(o,n){var l="attr."+o;if(arguments.length<2)return(l=this.tween(l))&&l._value;if(n==null)return this.tween(l,null);if(typeof n!="function")throw new Error;var c=bl(o);return this.tween(l,(c.local?TW:CW)(c,n))}function IW(o,n){return function(){N_(this,o).delay=+n.apply(this,arguments)}}function DW(o,n){return n=+n,function(){N_(this,o).delay=n}}function oN(o){var n=this._id;return arguments.length?this.each((typeof o=="function"?IW:DW)(n,o)):Cr(this.node(),n).delay}function SW(o,n){return function(){$r(this,o).duration=+n.apply(this,arguments)}}function MW(o,n){return n=+n,function(){$r(this,o).duration=n}}function sN(o){var n=this._id;return arguments.length?this.each((typeof o=="function"?SW:MW)(n,o)):Cr(this.node(),n).duration}function AW(o,n){if(typeof n!="function")throw new Error;return function(){$r(this,o).ease=n}}function aN(o){var n=this._id;return arguments.length?this.each(AW(n,o)):Cr(this.node(),n).ease}function PW(o,n){return function(){var l=n.apply(this,arguments);if(typeof l!="function")throw new Error;$r(this,o).ease=l}}function lN(o){if(typeof o!="function")throw new Error;return this.each(PW(this._id,o))}function cN(o){typeof o!="function"&&(o=w_(o));for(var n=this._groups,l=n.length,c=new Array(l),f=0;f<l;++f)for(var r=n[f],w=r.length,I=c[f]=[],A,L=0;L<w;++L)(A=r[L])&&o.call(A,A.__data__,L,r)&&I.push(A);return new ao(c,this._parents,this._name,this._id)}function uN(o){if(o._id!==this._id)throw new Error;for(var n=this._groups,l=o._groups,c=n.length,f=l.length,r=Math.min(c,f),w=new Array(c),I=0;I<r;++I)for(var A=n[I],L=l[I],U=A.length,Q=w[I]=new Array(U),fe,he=0;he<U;++he)(fe=A[he]||L[he])&&(Q[he]=fe);for(;I<c;++I)w[I]=n[I];return new ao(w,this._parents,this._name,this._id)}function RW(o){return(o+"").trim().split(/^|\s+/).every(function(n){var l=n.indexOf(".");return l>=0&&(n=n.slice(0,l)),!n||n==="start"})}function kW(o,n,l){var c,f,r=RW(n)?N_:$r;return function(){var w=r(this,o),I=w.on;I!==c&&(f=(c=I).copy()).on(n,l),w.on=f}}function hN(o,n){var l=this._id;return arguments.length<2?Cr(this.node(),l).on.on(o):this.each(kW(l,o,n))}function OW(o){return function(){var n=this.parentNode;for(var l in this.__transition)if(+l!==o)return;n&&n.removeChild(this)}}function dN(){return this.on("end.remove",OW(this._id))}function fN(o){var n=this._name,l=this._id;typeof o!="function"&&(o=Yh(o));for(var c=this._groups,f=c.length,r=new Array(f),w=0;w<f;++w)for(var I=c[w],A=I.length,L=r[w]=new Array(A),U,Q,fe=0;fe<A;++fe)(U=I[fe])&&(Q=o.call(U,U.__data__,fe,I))&&("__data__"in U&&(Q.__data__=U.__data__),L[fe]=Q,eu(L[fe],n,l,fe,L,Cr(U,l)));return new ao(r,this._parents,n,l)}function pN(o){var n=this._name,l=this._id;typeof o!="function"&&(o=b_(o));for(var c=this._groups,f=c.length,r=[],w=[],I=0;I<f;++I)for(var A=c[I],L=A.length,U,Q=0;Q<L;++Q)if(U=A[Q]){for(var fe=o.call(U,U.__data__,Q,A),he,be=Cr(U,l),De=0,Ke=fe.length;De<Ke;++De)(he=fe[De])&&eu(he,n,l,De,fe,be);r.push(fe),w.push(U)}return new ao(r,w,n,l)}var LW=wl.prototype.constructor;function mN(){return new LW(this._groups,this._parents)}function FW(o,n){var l,c,f;return function(){var r=Kc(this,o),w=(this.style.removeProperty(o),Kc(this,o));return r===w?null:r===l&&w===c?f:f=n(l=r,c=w)}}function gN(o){return function(){this.style.removeProperty(o)}}function NW(o,n,l){var c,f=l+"",r;return function(){var w=Kc(this,o);return w===f?null:w===c?r:r=n(c=w,l)}}function zW(o,n,l){var c,f,r;return function(){var w=Kc(this,o),I=l(this),A=I+"";return I==null&&(A=I=(this.style.removeProperty(o),Kc(this,o))),w===A?null:w===c&&A===f?r:(f=A,r=n(c=w,I))}}function BW(o,n){var l,c,f,r="style."+n,w="end."+r,I;return function(){var A=$r(this,o),L=A.on,U=A.value[r]==null?I||(I=gN(n)):void 0;(L!==l||f!==U)&&(c=(l=L).copy()).on(w,f=U),A.on=c}}function _N(o,n,l){var c=(o+="")=="transform"?cD:Nb;return n==null?this.styleTween(o,FW(o,c)).on("end.style."+o,gN(o)):typeof n=="function"?this.styleTween(o,zW(o,c,Ip(this,"style."+o,n))).each(BW(this._id,o)):this.styleTween(o,NW(o,c,n),l).on("end.style."+o,null)}function VW(o,n,l){return function(c){this.style.setProperty(o,n.call(this,c),l)}}function jW(o,n,l){var c,f;function r(){var w=n.apply(this,arguments);return w!==f&&(c=(f=w)&&VW(o,w,l)),c}return r._value=n,r}function yN(o,n,l){var c="style."+(o+="");if(arguments.length<2)return(c=this.tween(c))&&c._value;if(n==null)return this.tween(c,null);if(typeof n!="function")throw new Error;return this.tween(c,jW(o,n,l??""))}function UW(o){return function(){this.textContent=o}}function $W(o){return function(){var n=o(this);this.textContent=n??""}}function vN(o){return this.tween("text",typeof o=="function"?$W(Ip(this,"text",o)):UW(o==null?"":o+""))}function GW(o){return function(n){this.textContent=o.call(this,n)}}function HW(o){var n,l;function c(){var f=o.apply(this,arguments);return f!==l&&(n=(l=f)&&GW(f)),n}return c._value=o,c}function xN(o){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(o==null)return this.tween(n,null);if(typeof o!="function")throw new Error;return this.tween(n,HW(o))}function bN(){for(var o=this._name,n=this._id,l=zb(),c=this._groups,f=c.length,r=0;r<f;++r)for(var w=c[r],I=w.length,A,L=0;L<I;++L)if(A=w[L]){var U=Cr(A,n);eu(A,o,l,L,w,{time:U.time+U.delay+U.duration,delay:0,duration:U.duration,ease:U.ease})}return new ao(c,this._parents,o,l)}function wN(){var o,n,l=this,c=l._id,f=l.size();return new Promise(function(r,w){var I={value:w},A={value:function(){--f===0&&r()}};l.each(function(){var L=$r(this,c),U=L.on;U!==o&&(n=(o=U).copy(),n._.cancel.push(I),n._.interrupt.push(I),n._.end.push(A)),L.on=n}),f===0&&r()})}var qW=0;function ao(o,n,l,c){this._groups=o,this._parents=n,this._name=l,this._id=c}function EN(o){return wl().transition(o)}function zb(){return++qW}var El=wl.prototype;ao.prototype=EN.prototype={constructor:ao,select:fN,selectAll:pN,selectChild:El.selectChild,selectChildren:El.selectChildren,filter:cN,merge:uN,selection:mN,transition:bN,call:El.call,nodes:El.nodes,node:El.node,size:El.size,empty:El.empty,each:El.each,on:hN,attr:iN,attrTween:rN,style:_N,styleTween:yN,text:vN,textTween:xN,remove:dN,tween:nN,delay:oN,duration:sN,ease:aN,easeVarying:lN,end:wN,[Symbol.iterator]:El[Symbol.iterator]};function Bb(o){return((o*=2)<=1?o*o*o:(o-=2)*o*o+2)/2}var WW={time:null,delay:0,duration:250,ease:Bb};function ZW(o,n){for(var l;!(l=o.__transition)||!(l=l[n]);)if(!(o=o.parentNode))throw new Error(`transition ${n} not found`);return l}function TN(o){var n,l;o instanceof ao?(n=o._id,o=o._name):(n=zb(),(l=WW).time=L_(),o=o==null?null:o+"");for(var c=this._groups,f=c.length,r=0;r<f;++r)for(var w=c[r],I=w.length,A,L=0;L<I;++L)(A=w[L])&&eu(A,o,n,L,w,l||ZW(A,n));return new ao(c,this._parents,o,n)}wl.prototype.interrupt=tN;wl.prototype.transition=TN;var{abs:Gle,max:Hle,min:qle}=Math;function CN(o){return[+o[0],+o[1]]}function YW(o){return[CN(o[0]),CN(o[1])]}var Wle={name:"x",handles:["w","e"].map(dD),input:function(o,n){return o==null?null:[[+o[0],n[0][1]],[+o[1],n[1][1]]]},output:function(o){return o&&[o[0][0],o[1][0]]}},Zle={name:"y",handles:["n","s"].map(dD),input:function(o,n){return o==null?null:[[n[0][0],+o[0]],[n[1][0],+o[1]]]},output:function(o){return o&&[o[0][1],o[1][1]]}},Yle={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(dD),input:function(o){return o==null?null:YW(o)},output:function(o){return o}};function dD(o){return{type:o}}function IN(o){let n=+this._x.call(null,o),l=+this._y.call(null,o);return DN(this.cover(n,l),n,l,o)}function DN(o,n,l,c){if(isNaN(n)||isNaN(l))return o;var f,r=o._root,w={data:c},I=o._x0,A=o._y0,L=o._x1,U=o._y1,Q,fe,he,be,De,Ke,Fe,tt;if(!r)return o._root=w,o;for(;r.length;)if((De=n>=(Q=(I+L)/2))?I=Q:L=Q,(Ke=l>=(fe=(A+U)/2))?A=fe:U=fe,f=r,!(r=r[Fe=Ke<<1|De]))return f[Fe]=w,o;if(he=+o._x.call(null,r.data),be=+o._y.call(null,r.data),n===he&&l===be)return w.next=r,f?f[Fe]=w:o._root=w,o;do f=f?f[Fe]=new Array(4):o._root=new Array(4),(De=n>=(Q=(I+L)/2))?I=Q:L=Q,(Ke=l>=(fe=(A+U)/2))?A=fe:U=fe;while((Fe=Ke<<1|De)===(tt=(be>=fe)<<1|he>=Q));return f[tt]=r,f[Fe]=w,o}function SN(o){var n,l,c=o.length,f,r,w=new Array(c),I=new Array(c),A=1/0,L=1/0,U=-1/0,Q=-1/0;for(l=0;l<c;++l)isNaN(f=+this._x.call(null,n=o[l]))||isNaN(r=+this._y.call(null,n))||(w[l]=f,I[l]=r,f<A&&(A=f),f>U&&(U=f),r<L&&(L=r),r>Q&&(Q=r));if(A>U||L>Q)return this;for(this.cover(A,L).cover(U,Q),l=0;l<c;++l)DN(this,w[l],I[l],o[l]);return this}function MN(o,n){if(isNaN(o=+o)||isNaN(n=+n))return this;var l=this._x0,c=this._y0,f=this._x1,r=this._y1;if(isNaN(l))f=(l=Math.floor(o))+1,r=(c=Math.floor(n))+1;else{for(var w=f-l||1,I=this._root,A,L;l>o||o>=f||c>n||n>=r;)switch(L=(n<c)<<1|o<l,A=new Array(4),A[L]=I,I=A,w*=2,L){case 0:f=l+w,r=c+w;break;case 1:l=f-w,r=c+w;break;case 2:f=l+w,c=r-w;break;case 3:l=f-w,c=r-w;break}this._root&&this._root.length&&(this._root=I)}return this._x0=l,this._y0=c,this._x1=f,this._y1=r,this}function AN(){var o=[];return this.visit(function(n){if(!n.length)do o.push(n.data);while(n=n.next)}),o}function PN(o){return arguments.length?this.cover(+o[0][0],+o[0][1]).cover(+o[1][0],+o[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Rr(o,n,l,c,f){this.node=o,this.x0=n,this.y0=l,this.x1=c,this.y1=f}function RN(o,n,l){var c,f=this._x0,r=this._y0,w,I,A,L,U=this._x1,Q=this._y1,fe=[],he=this._root,be,De;for(he&&fe.push(new Rr(he,f,r,U,Q)),l==null?l=1/0:(f=o-l,r=n-l,U=o+l,Q=n+l,l*=l);be=fe.pop();)if(!(!(he=be.node)||(w=be.x0)>U||(I=be.y0)>Q||(A=be.x1)<f||(L=be.y1)<r))if(he.length){var Ke=(w+A)/2,Fe=(I+L)/2;fe.push(new Rr(he[3],Ke,Fe,A,L),new Rr(he[2],w,Fe,Ke,L),new Rr(he[1],Ke,I,A,Fe),new Rr(he[0],w,I,Ke,Fe)),(De=(n>=Fe)<<1|o>=Ke)&&(be=fe[fe.length-1],fe[fe.length-1]=fe[fe.length-1-De],fe[fe.length-1-De]=be)}else{var tt=o-+this._x.call(null,he.data),ft=n-+this._y.call(null,he.data),Ue=tt*tt+ft*ft;if(Ue<l){var Vt=Math.sqrt(l=Ue);f=o-Vt,r=n-Vt,U=o+Vt,Q=n+Vt,c=he.data}}return c}function kN(o){if(isNaN(U=+this._x.call(null,o))||isNaN(Q=+this._y.call(null,o)))return this;var n,l=this._root,c,f,r,w=this._x0,I=this._y0,A=this._x1,L=this._y1,U,Q,fe,he,be,De,Ke,Fe;if(!l)return this;if(l.length)for(;;){if((be=U>=(fe=(w+A)/2))?w=fe:A=fe,(De=Q>=(he=(I+L)/2))?I=he:L=he,n=l,!(l=l[Ke=De<<1|be]))return this;if(!l.length)break;(n[Ke+1&3]||n[Ke+2&3]||n[Ke+3&3])&&(c=n,Fe=Ke)}for(;l.data!==o;)if(f=l,!(l=l.next))return this;return(r=l.next)&&delete l.next,f?(r?f.next=r:delete f.next,this):n?(r?n[Ke]=r:delete n[Ke],(l=n[0]||n[1]||n[2]||n[3])&&l===(n[3]||n[2]||n[1]||n[0])&&!l.length&&(c?c[Fe]=l:this._root=l),this):(this._root=r,this)}function ON(o){for(var n=0,l=o.length;n<l;++n)this.remove(o[n]);return this}function LN(){return this._root}function FN(){var o=0;return this.visit(function(n){if(!n.length)do++o;while(n=n.next)}),o}function NN(o){var n=[],l,c=this._root,f,r,w,I,A;for(c&&n.push(new Rr(c,this._x0,this._y0,this._x1,this._y1));l=n.pop();)if(!o(c=l.node,r=l.x0,w=l.y0,I=l.x1,A=l.y1)&&c.length){var L=(r+I)/2,U=(w+A)/2;(f=c[3])&&n.push(new Rr(f,L,U,I,A)),(f=c[2])&&n.push(new Rr(f,r,U,L,A)),(f=c[1])&&n.push(new Rr(f,L,w,I,U)),(f=c[0])&&n.push(new Rr(f,r,w,L,U))}return this}function zN(o){var n=[],l=[],c;for(this._root&&n.push(new Rr(this._root,this._x0,this._y0,this._x1,this._y1));c=n.pop();){var f=c.node;if(f.length){var r,w=c.x0,I=c.y0,A=c.x1,L=c.y1,U=(w+A)/2,Q=(I+L)/2;(r=f[0])&&n.push(new Rr(r,w,I,U,Q)),(r=f[1])&&n.push(new Rr(r,U,I,A,Q)),(r=f[2])&&n.push(new Rr(r,w,Q,U,L)),(r=f[3])&&n.push(new Rr(r,U,Q,A,L))}l.push(c)}for(;c=l.pop();)o(c.node,c.x0,c.y0,c.x1,c.y1);return this}function BN(o){return o[0]}function VN(o){return arguments.length?(this._x=o,this):this._x}function jN(o){return o[1]}function UN(o){return arguments.length?(this._y=o,this):this._y}function ed(o,n,l){var c=new fD(n??BN,l??jN,NaN,NaN,NaN,NaN);return o==null?c:c.addAll(o)}function fD(o,n,l,c,f,r){this._x=o,this._y=n,this._x0=l,this._y0=c,this._x1=f,this._y1=r,this._root=void 0}function $N(o){for(var n={data:o.data},l=n;o=o.next;)l=l.next={data:o.data};return n}var lo=ed.prototype=fD.prototype;lo.copy=function(){var o=new fD(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,l,c;if(!n)return o;if(!n.length)return o._root=$N(n),o;for(l=[{source:n,target:o._root=new Array(4)}];n=l.pop();)for(var f=0;f<4;++f)(c=n.source[f])&&(c.length?l.push({source:c,target:n.target[f]=new Array(4)}):n.target[f]=$N(c));return o};lo.add=IN;lo.addAll=SN;lo.cover=MN;lo.data=AN;lo.extent=PN;lo.find=RN;lo.remove=kN;lo.removeAll=ON;lo.root=LN;lo.size=FN;lo.visit=NN;lo.visitAfter=zN;lo.x=VN;lo.y=UN;function Qr(o){return function(){return o}}function tu(o){return(o()-.5)*1e-6}function XW(o){return o.x+o.vx}function KW(o){return o.y+o.vy}function z_(o){var n,l,c,f=1,r=1;typeof o!="function"&&(o=Qr(o==null?1:+o));function w(){for(var L,U=n.length,Q,fe,he,be,De,Ke,Fe=0;Fe<r;++Fe)for(Q=ed(n,XW,KW).visitAfter(I),L=0;L<U;++L)fe=n[L],De=l[fe.index],Ke=De*De,he=fe.x+fe.vx,be=fe.y+fe.vy,Q.visit(tt);function tt(ft,Ue,Vt,Jt,nn){var Et=ft.data,oi=ft.r,It=De+oi;if(Et){if(Et.index>fe.index){var Ei=he-Et.x-Et.vx,Di=be-Et.y-Et.vy,Ui=Ei*Ei+Di*Di;Ui<It*It&&(Ei===0&&(Ei=tu(c),Ui+=Ei*Ei),Di===0&&(Di=tu(c),Ui+=Di*Di),Ui=(It-(Ui=Math.sqrt(Ui)))/Ui*f,fe.vx+=(Ei*=Ui)*(It=(oi*=oi)/(Ke+oi)),fe.vy+=(Di*=Ui)*It,Et.vx-=Ei*(It=1-It),Et.vy-=Di*It)}return}return Ue>he+It||Jt<he-It||Vt>be+It||nn<be-It}}function I(L){if(L.data)return L.r=l[L.data.index];for(var U=L.r=0;U<4;++U)L[U]&&L[U].r>L.r&&(L.r=L[U].r)}function A(){if(n){var L,U=n.length,Q;for(l=new Array(U),L=0;L<U;++L)Q=n[L],l[Q.index]=+o(Q,L,n)}}return w.initialize=function(L,U){n=L,c=U,A()},w.iterations=function(L){return arguments.length?(r=+L,w):r},w.strength=function(L){return arguments.length?(f=+L,w):f},w.radius=function(L){return arguments.length?(o=typeof L=="function"?L:Qr(+L),A(),w):o},w}function GN(){let o=1;return()=>(o=(1664525*o+1013904223)%4294967296)/4294967296}function HN(o){return o.x}function qN(o){return o.y}var QW=10,JW=Math.PI*(3-Math.sqrt(5));function B_(o){var n,l=1,c=.001,f=1-Math.pow(c,1/300),r=0,w=.6,I=new Map,A=Cp(Q),L=Zh("tick","end"),U=GN();o==null&&(o=[]);function Q(){fe(),L.call("tick",n),l<c&&(A.stop(),L.call("end",n))}function fe(De){var Ke,Fe=o.length,tt;De===void 0&&(De=1);for(var ft=0;ft<De;++ft)for(l+=(r-l)*f,I.forEach(function(Ue){Ue(l)}),Ke=0;Ke<Fe;++Ke)tt=o[Ke],tt.fx==null?tt.x+=tt.vx*=w:(tt.x=tt.fx,tt.vx=0),tt.fy==null?tt.y+=tt.vy*=w:(tt.y=tt.fy,tt.vy=0);return n}function he(){for(var De=0,Ke=o.length,Fe;De<Ke;++De){if(Fe=o[De],Fe.index=De,Fe.fx!=null&&(Fe.x=Fe.fx),Fe.fy!=null&&(Fe.y=Fe.fy),isNaN(Fe.x)||isNaN(Fe.y)){var tt=QW*Math.sqrt(.5+De),ft=De*JW;Fe.x=tt*Math.cos(ft),Fe.y=tt*Math.sin(ft)}(isNaN(Fe.vx)||isNaN(Fe.vy))&&(Fe.vx=Fe.vy=0)}}function be(De){return De.initialize&&De.initialize(o,U),De}return he(),n={tick:fe,restart:function(){return A.restart(Q),n},stop:function(){return A.stop(),n},nodes:function(De){return arguments.length?(o=De,he(),I.forEach(be),n):o},alpha:function(De){return arguments.length?(l=+De,n):l},alphaMin:function(De){return arguments.length?(c=+De,n):c},alphaDecay:function(De){return arguments.length?(f=+De,n):+f},alphaTarget:function(De){return arguments.length?(r=+De,n):r},velocityDecay:function(De){return arguments.length?(w=1-De,n):1-w},randomSource:function(De){return arguments.length?(U=De,I.forEach(be),n):U},force:function(De,Ke){return arguments.length>1?(Ke==null?I.delete(De):I.set(De,be(Ke)),n):I.get(De)},find:function(De,Ke,Fe){var tt=0,ft=o.length,Ue,Vt,Jt,nn,Et;for(Fe==null?Fe=1/0:Fe*=Fe,tt=0;tt<ft;++tt)nn=o[tt],Ue=De-nn.x,Vt=Ke-nn.y,Jt=Ue*Ue+Vt*Vt,Jt<Fe&&(Et=nn,Fe=Jt);return Et},on:function(De,Ke){return arguments.length>1?(L.on(De,Ke),n):L.on(De)}}}function V_(){var o,n,l,c,f=Qr(-30),r,w=1,I=1/0,A=.81;function L(he){var be,De=o.length,Ke=ed(o,HN,qN).visitAfter(Q);for(c=he,be=0;be<De;++be)n=o[be],Ke.visit(fe)}function U(){if(o){var he,be=o.length,De;for(r=new Array(be),he=0;he<be;++he)De=o[he],r[De.index]=+f(De,he,o)}}function Q(he){var be=0,De,Ke,Fe=0,tt,ft,Ue;if(he.length){for(tt=ft=Ue=0;Ue<4;++Ue)(De=he[Ue])&&(Ke=Math.abs(De.value))&&(be+=De.value,Fe+=Ke,tt+=Ke*De.x,ft+=Ke*De.y);he.x=tt/Fe,he.y=ft/Fe}else{De=he,De.x=De.data.x,De.y=De.data.y;do be+=r[De.data.index];while(De=De.next)}he.value=be}function fe(he,be,De,Ke){if(!he.value)return!0;var Fe=he.x-n.x,tt=he.y-n.y,ft=Ke-be,Ue=Fe*Fe+tt*tt;if(ft*ft/A<Ue)return Ue<I&&(Fe===0&&(Fe=tu(l),Ue+=Fe*Fe),tt===0&&(tt=tu(l),Ue+=tt*tt),Ue<w&&(Ue=Math.sqrt(w*Ue)),n.vx+=Fe*he.value*c/Ue,n.vy+=tt*he.value*c/Ue),!0;if(he.length||Ue>=I)return;(he.data!==n||he.next)&&(Fe===0&&(Fe=tu(l),Ue+=Fe*Fe),tt===0&&(tt=tu(l),Ue+=tt*tt),Ue<w&&(Ue=Math.sqrt(w*Ue)));do he.data!==n&&(ft=r[he.data.index]*c/Ue,n.vx+=Fe*ft,n.vy+=tt*ft);while(he=he.next)}return L.initialize=function(he,be){o=he,l=be,U()},L.strength=function(he){return arguments.length?(f=typeof he=="function"?he:Qr(+he),U(),L):f},L.distanceMin=function(he){return arguments.length?(w=he*he,L):Math.sqrt(w)},L.distanceMax=function(he){return arguments.length?(I=he*he,L):Math.sqrt(I)},L.theta=function(he){return arguments.length?(A=he*he,L):Math.sqrt(A)},L}function j_(o){var n=Qr(.1),l,c,f;typeof o!="function"&&(o=Qr(o==null?0:+o));function r(I){for(var A=0,L=l.length,U;A<L;++A)U=l[A],U.vx+=(f[A]-U.x)*c[A]*I}function w(){if(l){var I,A=l.length;for(c=new Array(A),f=new Array(A),I=0;I<A;++I)c[I]=isNaN(f[I]=+o(l[I],I,l))?0:+n(l[I],I,l)}}return r.initialize=function(I){l=I,w()},r.strength=function(I){return arguments.length?(n=typeof I=="function"?I:Qr(+I),w(),r):n},r.x=function(I){return arguments.length?(o=typeof I=="function"?I:Qr(+I),w(),r):o},r}function U_(o){var n=Qr(.1),l,c,f;typeof o!="function"&&(o=Qr(o==null?0:+o));function r(I){for(var A=0,L=l.length,U;A<L;++A)U=l[A],U.vy+=(f[A]-U.y)*c[A]*I}function w(){if(l){var I,A=l.length;for(c=new Array(A),f=new Array(A),I=0;I<A;++I)c[I]=isNaN(f[I]=+o(l[I],I,l))?0:+n(l[I],I,l)}}return r.initialize=function(I){l=I,w()},r.strength=function(I){return arguments.length?(n=typeof I=="function"?I:Qr(+I),w(),r):n},r.y=function(I){return arguments.length?(o=typeof I=="function"?I:Qr(+I),w(),r):o},r}function nu(o,n,l){this.k=o,this.x=n,this.y=l}nu.prototype={constructor:nu,scale:function(o){return o===1?this:new nu(this.k*o,this.x,this.y)},translate:function(o,n){return o===0&n===0?this:new nu(this.k,this.x+this.k*o,this.y+this.k*n)},apply:function(o){return[o[0]*this.k+this.x,o[1]*this.k+this.y]},applyX:function(o){return o*this.k+this.x},applyY:function(o){return o*this.k+this.y},invert:function(o){return[(o[0]-this.x)/this.k,(o[1]-this.y)/this.k]},invertX:function(o){return(o-this.x)/this.k},invertY:function(o){return(o-this.y)/this.k},rescaleX:function(o){return o.copy().domain(o.range().map(this.invertX,this).map(o.invert,o))},rescaleY:function(o){return o.copy().domain(o.range().map(this.invertY,this).map(o.invert,o))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var pD=new nu(1,0,0);mD.prototype=nu.prototype;function mD(o){for(;!o.__zoom;)if(!(o=o.parentNode))return pD;return o.__zoom}var yD=bE(Vb());var ds=(()=>{let n=class n{constructor(){this.ACCESS_TOKEN="pk.eyJ1Ijoidml0YWxpaS1iaWxpbnNreWkiLCJhIjoiY2x5OGZqZDdsMDVjMjJucGh5Z2w3MmgzZSJ9.nKkXDgd7Q8u4sBZt_bsRrQ",this.mapStyle="mapbox://styles/vitalii-bilinskyi/cly8fp05900fz01pfaajw4fqa",this.map=null,this.source=null,this.layers=[],this.icons=[],this.showSensorData=new wr(!1),this.canvas=null,this.svg=null,this.height=window.innerWidth,this.width=window.innerHeight}setMap(c){this.map||(this.map=c)}setSource(c){this.source=c}setMapStyle(c){this.mapStyle=c}initializeMap(c){let A=c,{container:f,zoom:r,center:w}=A,I=as(A,["container","zoom","center"]);this.map=new yD.default.Map(gt({accessToken:this.ACCESS_TOKEN,container:f,style:this.mapStyle,zoom:r??12,center:w},I))}addSource(c,f){if(!this.map)throw new Error("Set map before adding source!");let U=f,{data:r,cluster:w,clusterMaxZoom:I,clusterRadius:A}=U,L=as(U,["data","cluster","clusterMaxZoom","clusterRadius"]);this.map.addSource(c,gt({type:"geojson",data:r,cluster:w,clusterMaxZoom:I??13,clusterRadius:A??100},L)),this.source=c}generatePointLayer(c){if(this.showUnconfiguredMapServiceErrors("creating point layer!"),Array.isArray(c))for(let f of c)this.createPointLayer(f);else this.createPointLayer(c)}createPointLayer(c){let U=c,{id:f,iconId:r,filter:w,layout:I,onPointClickHandler:A}=U,L=as(U,["id","iconId","filter","layout","onPointClickHandler"]);this.map.addLayer(gt({id:f,type:"symbol",source:this.source,filter:w,layout:gt({"icon-image":r,"icon-allow-overlap":!0},I)},L)),A&&this.map.on("click",f,Q=>{A(Q,this.map,f),this.showSensorData.next(!0)}),this.layers.push(c.id),this.icons.push(c.iconId)}generateClusterLayer(c){if(this.showUnconfiguredMapServiceErrors("creating cluster layer!"),Array.isArray(c))for(let f of c)this.createClusterLayer(f);else this.createClusterLayer(c)}createClusterLayer(c){let L=c,{id:f,filter:r,paint:w,onClusterClickHandler:I}=L,A=as(L,["id","filter","paint","onClusterClickHandler"]);this.map.addLayer(gt({id:f,type:"circle",source:this.source,filter:r,paint:gt({"circle-color":"#cd5dfc","circle-radius":20},w)},A)),this.layers.push(c.id),I&&this.map.on("click",f,U=>I(U,this.map,f))}drawD3JSCircles(){if(this.canvas=this.map.getCanvasContainer(),this.svg=so(".mapboxgl-canvas-container").append("div").style("view-transition-name","cube").style("position","absolute").style("width","100%").style("height",`${this.height}px`).style("top","0px").style("left","0px").append("svg").attr("width","100%").attr("height",this.height).style("position","absolute").style("left",0),!this.map?.getSource("workspaces")){console.error("GeoJSON source not found");return}let f=this.map?.querySourceFeatures("workspaces",{filter:["==","alarmLevel","high"]}),r=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-high"]}),w=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-moderate"]}),I=ZN(r,"id"),A=ZN(w,"id");console.log("uniqueFeatures1",I),console.log("uniqueFeatures2",A);let L=[...I,...A],U=I?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),Q=A?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),fe=[...U,...Q];if(console.log("dataToSave",fe),localStorage.setItem("pointsCoords",JSON.stringify(fe)),L&&this.svg){let he=this.svg.selectAll("circle.point").data(L).enter().append("circle").attr("class","point").attr("cx",be=>this.project(be.geometry.coordinates).x).attr("cy",be=>this.project(be.geometry.coordinates).y).attr("r",5).attr("fill","red")}}project(c){return this.map?.project(new yD.default.LngLat(+c[0],+c[1]))}updateZoom(c){let f=this.map.getCenter(),r=this.map.getZoom();this.map.easeTo({center:f,zoom:c,duration:2e3,linear:!0})}updatePitch(c){let f=this.map.getCenter(),r=this.map.getZoom();this.map.easeTo({center:f,zoom:r,pitch:c,duration:1e3,linear:!0})}showUnconfiguredMapServiceErrors(c){if(!this.map)throw new Error(`Set map before ${c}`);if(!this.source)throw new Error(`Set source before ${c}`)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function ZN(o,n){let l=new Set,c=[];for(let f of o){let r=f.properties[n];console.log("eature.properties[comparatorProperty];",f.properties),l.has(r)||(l.add(r),c.push(f))}return c}function e7(o,n){if(o&1){let l=Nh();Ft(0,"app-sensor-details",3),bi("hideDetails",function(f){Ah(l);let r=Hs();return Ph(r.hideDetails(f))}),kt()}o&2&&Ai("@enter",void 0)("@fadeOutOnLeave",void 0)}var XN=(()=>{let n=class n{constructor(c,f){this.mockDataService=c,this.mapService=f,this.lat=50.049683,this.lng=19.944544,this.zoomLevel=12,this.dotSize=100,this.context=null,this.pulsingDot_low=null,this.pulsingDot_moderate=null,this.pulsingDot_high=null,this.pulsingDot_sevire=null,this.canvas_low=document.createElement("canvas"),this.canvas_moderate=document.createElement("canvas"),this.canvas_high=document.createElement("canvas"),this.canvas_sevire=document.createElement("canvas"),this.showSensorDetails=!1,this.mapService.showSensorData?.subscribe(r=>{this.showSensorDetails=r})}hideDetails(c){this.showSensorDetails=!c}ngOnInit(){this.mockDataService.getAllLocations().then(c=>{this.mockData=YN([...c]),this.renderMap()}).catch(c=>{console.error("Failed to fetch mock data",c),this.mockData=YN([...kL]),this.renderMap()})}renderMap(){this.getSavedMapData(),this.mapService.initializeMap({container:"map",zoom:this.zoomLevel,center:[this.lng,this.lat],pitch:60,minZoom:4}),this.createPusingDots(),this.onMapLoadHandler()}getSavedMapData(){try{let c=localStorage.getItem("center");if(console.log(c),c){let r=JSON.parse(c);this.lng=r.lng,this.lat=r.lat}let f=localStorage.getItem("zoomLevel");if(console.log(f),f){let r=JSON.parse(f);this.zoomLevel=r}}catch(c){console.log("getCenterOfMap Exception: ",c)}}createPusingDots(){this.checkMapInitialization(),this.canvas_low.className="canvas_low",this.pulsingDot_low=x_("#B3ECCD",this.mapService.map,this.canvas_low),this.canvas_moderate.className="canvas_moderate",this.pulsingDot_moderate=x_("#FFEB82",this.mapService.map,this.canvas_moderate),this.canvas_high.className="canvas_high",this.pulsingDot_high=x_("#ffb682",this.mapService.map,this.canvas_high),this.canvas_sevire.className="canvas_sevire",this.pulsingDot_sevire=x_("#ECC6EF",this.mapService.map,this.canvas_sevire,!0)}onMapLoadHandler(){this.checkMapInitialization(),this.mapService.map.on("load",()=>{this.pulsingDot_low&&this.mapService.map.addImage("pulsingDot_low",this.pulsingDot_low,{pixelRatio:2}),this.pulsingDot_moderate&&this.mapService.map.addImage("pulsingDot_moderate",this.pulsingDot_moderate,{pixelRatio:2}),this.pulsingDot_high&&this.mapService.map.addImage("pulsingDot_high",this.pulsingDot_high,{pixelRatio:2}),this.pulsingDot_sevire&&this.mapService.map.addImage("pulsingDot_sevire",this.pulsingDot_sevire,{pixelRatio:2}),this.mapService.addSource("workspaces",{data:this.mockData,cluster:!0}),this.drawData()})}drawData(){this.mapService.generateClusterLayer({id:"clusters",filter:["has","point_count"],paint:{"circle-radius":20},onClusterClickHandler:this.onClusterClickHandler}),this.mapService.map.addLayer({id:"cluster-count",type:"symbol",source:"workspaces",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"white"}});let c=[{id:"unclustered-point-animated-sevire",filter:["==","alarmLevel","sevire"],iconId:"pulsingDot_sevire",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-high",filter:["==","alarmLevel","high"],iconId:"pulsingDot_high",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-moderate",filter:["==","alarmLevel","moderate"],iconId:"pulsingDot_moderate",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-low",filter:["==","alarmLevel","low"],iconId:"pulsingDot_low",onPointClickHandler:this.onUnlcusteredPointClickHandler}];this.mapService.generatePointLayer(c)}onClusterClickHandler(c,f,r){let w=f.queryRenderedFeatures(c.point,{layers:[r]});if(w&&w[0]&&w[0]?.properties){let I=w[0]?.properties.cluster_id;if(I){let A=f.getSource("workspaces"),L=f.getZoom();A?.getClusterExpansionZoom(I,(U,Q)=>{U||!Q||w[0].geometry.type==="Point"&&f.easeTo({center:w[0].geometry.coordinates,zoom:Q,duration:L<=8?2e3:L<=10?1500:1e3,linear:!0})})}}}onUnlcusteredPointClickHandler(c,f,r){let w=f.queryRenderedFeatures(c.point,{layers:[r]});if(w&&w[0]){let I=w[0];if(console.log(I),I.geometry.type==="Point"){let A={center:[I.geometry.coordinates[0],I.geometry.coordinates[1]],zoom:18};f.flyTo(hi(gt({},A),{duration:2500,essential:!0}))}}}checkMapInitialization(){if(!this.mapService.map)throw new Error("Map is not initialized")}};n.\u0275fac=function(f){return new(f||n)(Qn(XI),Qn(ds))},n.\u0275cmp=pi({type:n,selectors:[["map-view"]],standalone:!0,features:[ip([]),mi],decls:3,vars:3,consts:[["id","map",1,"match-parent"],[2,"position","absolute","top","100px","left","100px","z-index","999"],[3,"hideDetails",4,"ngIf"],[3,"hideDetails"]],template:function(f,r){f&1&&(Wn(0,"div",0)(1,"div",1),jr(2,e7,1,2,"app-sensor-details",2)),f&2&&(Bn(),Fh("view-transition-name","cube"),Bn(),Ai("ngIf",r.showSensorDetails))},dependencies:[NO,qi,cp,YI],styles:['.match-parent[_ngcontent-%COMP%]{width:100%;height:100%}#map[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;display:block;z-index:10;pointer-events:none;-webkit-box-shadow:inset 0 0 70px 60px white;-moz-box-shadow:inset 0 0 70px 60px white;box-shadow:inset 0 0 70px 60px #fff}[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}']});let o=n;return o})(),YN=o=>{let n=[],l=["high","moderate","low"];return o.forEach(c=>{n.push({type:"Feature",id:c.id,properties:{numberOfDevices:c.devices?.length,alarmLevel:c.id==="6"?"sevire":l[Math.floor(Math.random()*l.length)],id:c.id},geometry:{type:"Point",coordinates:[c.longitude,c.latitude]}})}),{type:"FeatureCollection",features:[...n]}};var zi=function(o){return o[o.GROUP=0]="GROUP",o[o.DEVICE=1]="DEVICE",o}(zi||{}),Xi=function(o){return o[o.LATCH=0]="LATCH",o[o.BATTERY=1]="BATTERY",o[o.SIGNAL=2]="SIGNAL",o[o.HUMIDITY=3]="HUMIDITY",o[o.TEMPERATURE=4]="TEMPERATURE",o}(Xi||{}),Zn=function(o){return o[o.LOW=0]="LOW",o[o.MODERATE=1]="MODERATE",o[o.HIGH=2]="HIGH",o[o.SEVIRE=3]="SEVIRE",o}(Zn||{}),t7=[{id:"id1.1",type:zi.GROUP,deviceType:Xi.LATCH,name:"Latch",r:75},{id:"id1.2",type:zi.GROUP,deviceType:Xi.TEMPERATURE,name:"Temperature",r:75},{id:"id1.3",type:zi.GROUP,deviceType:Xi.BATTERY,name:"Battery",r:75},{id:"id1.4",type:zi.GROUP,deviceType:Xi.HUMIDITY,name:"Humidity",r:75},{id:"id1.5",type:zi.GROUP,deviceType:Xi.SIGNAL,name:"Signal",r:75},{id:"id1.1.1",type:zi.DEVICE,deviceType:Xi.LATCH,name:"DEVICE_0",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:Zn.HIGH},{id:"2",message:"Something wrong with case",priority:Zn.LOW},{id:"3",message:"Something wrong with signal",priority:Zn.MODERATE}]},{id:"id1.1.2",type:zi.DEVICE,deviceType:Xi.LATCH,name:"DEVICE_1",r:30,alarms:[{id:"1",message:"Something wrong with latch",priority:Zn.MODERATE},{id:"2",message:"Something wrong with case",priority:Zn.MODERATE},{id:"3",message:"Something wrong with signal",priority:Zn.HIGH}]},{id:"id1.2.1",type:zi.DEVICE,deviceType:Xi.TEMPERATURE,name:"DEVICE_2",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:Zn.SEVIRE},{id:"2",message:"Something wrong with case",priority:Zn.HIGH},{id:"3",message:"Something wrong with signal",priority:Zn.LOW}]},{id:"id1.2.2",type:zi.DEVICE,deviceType:Xi.TEMPERATURE,name:"DEVICE_3",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:Zn.LOW},{id:"2",message:"Something wrong with case",priority:Zn.LOW},{id:"3",message:"Something wrong with signal",priority:Zn.LOW}]},{id:"id1.2.3",type:zi.DEVICE,deviceType:Xi.TEMPERATURE,name:"DEVICE_4",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:Zn.HIGH},{id:"2",message:"Something wrong with case",priority:Zn.SEVIRE},{id:"3",message:"Something wrong with signal",priority:Zn.SEVIRE}]},{id:"id1.3.1",type:zi.DEVICE,deviceType:Xi.BATTERY,name:"DEVICE_5",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:Zn.MODERATE},{id:"2",message:"Something wrong with case",priority:Zn.MODERATE},{id:"3",message:"Something wrong with signal",priority:Zn.MODERATE}]},{id:"id1.4.1",type:zi.DEVICE,deviceType:Xi.HUMIDITY,name:"DEVICE_6",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:Zn.LOW},{id:"2",message:"Something wrong with case",priority:Zn.MODERATE},{id:"3",message:"Something wrong with signal",priority:Zn.LOW}]},{id:"id1.4.2",type:zi.DEVICE,deviceType:Xi.HUMIDITY,name:"DEVICE_7",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:Zn.SEVIRE},{id:"2",message:"Something wrong with case",priority:Zn.SEVIRE},{id:"3",message:"Something wrong with signal",priority:Zn.LOW}]},{id:"id1.5.1",type:zi.DEVICE,deviceType:Xi.SIGNAL,name:"DEVICE_8",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:Zn.MODERATE},{id:"2",message:"Something wrong with case",priority:Zn.SEVIRE},{id:"3",message:"Something wrong with signal",priority:Zn.HIGH}]},{id:"id1.5.2",type:zi.DEVICE,deviceType:Xi.SIGNAL,name:"DEVICE_9",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:Zn.MODERATE},{id:"2",message:"Something wrong with case",priority:Zn.HIGH},{id:"3",message:"Something wrong with signal",priority:Zn.HIGH}]},{id:"id1.5.3",type:zi.DEVICE,deviceType:Xi.SIGNAL,name:"DEVICE_10",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:Zn.HIGH},{id:"2",message:"Something wrong with case",priority:Zn.LOW},{id:"3",message:"Something wrong with signal",priority:Zn.LOW}]}];function KN(o,n){return Math.floor(Math.random()*(n-o+1)+o)}var vD=(()=>{let n=class n{constructor(c){this.mapService=c,this.simulation=new Map,this.svg=null,this.nodeGroup=null,this.nodes=[],this.textGroup=null,this.texts=[],this.iconGroup=null,this.icons=[],this.center={x:window.innerWidth/2,y:window.innerHeight/2},this.xAxis=[],this.groups=this.calculateGroups("deviceType")}ngOnInit(){this.createSVGGroups(),this.loadSimulations(),this.restartSimulations()}createSVGGroups(){let c=so(".bubbles");this.svg=c.append("svg").attr("class","gravity-container").attr("viewBox",[-this.center.y,-this.center.x,window.innerHeight,window.innerWidth]).style("height",window.innerHeight).style("width",window.innerWidth),this.nodeGroup=this.svg.append("g").attr("class","bubbles-layer"),this.textGroup=this.svg.append("g").attr("class","text-layer"),this.iconGroup=this.svg.append("g").attr("class","icon-layer"),this.groups.forEach((f,r)=>{let w=(be,De)=>{be.active||this.simulation.get(r)?.alphaTarget(.3).restart(),De.fx=De.x,De.fy=De.y},I=(be,De)=>{De.fx=be.x,De.fy=be.y},A=(be,De)=>{be.active||this.simulation.get(r)?.alphaTarget(0),De.fx=null,De.fy=null},L=this.nodeGroup?.selectAll("circle").data(f,be=>be.id).enter().append("circle").attr("r",be=>this.getRadius(be.type)).attr("fill",be=>this.getColor(be.type,be.priority)).attr("cx",be=>be.x).attr("cy",be=>be.y).call(I_().on("start",w).on("drag",I).on("end",A));L&&this.nodes.push(L);let U=f.filter(be=>be.type!==zi.GROUP),Q=this.textGroup?.style("font","16px sans-serif").selectAll("text").data(U,be=>be.id).enter().append("text").attr("id",be=>be.id).attr("line-height","16px").attr("pointer-events","none").attr("text-anchor","middle").text(be=>be.count);Q&&this.texts.push(Q);let fe=f.filter(be=>be.type===zi.GROUP),he=this.iconGroup?.selectAll("image").data(fe,be=>be.id).enter().append("image").attr("r",8).attr("fill","#5484d1").attr("href",be=>this.getIcon(be.deviceType)).attr("height",be=>this.getRadius(be.type)).attr("width",be=>this.getRadius(be.type)).attr("style","position: absolute;");he&&this.icons.push(he)}),this.setFixedXAxisToGroupParent()}getColor(c,f){if(c===zi.GROUP)return"#F8F8F8";switch(f){case Zn.LOW:return"#B3ECCD";case Zn.MODERATE:return"#FFEB82";case Zn.HIGH:return"#ffb682";case Zn.SEVIRE:return"#ECC6EF";default:return"#D9D9D9"}}getRadius(c){return c===zi.GROUP?75:30}getIcon(c){switch(c){case Xi.BATTERY:return"../assets/icon_wf_battery.svg";case Xi.HUMIDITY:return"../assets/icon_wf_humidity.svg";case Xi.LATCH:return"../assets/icon_wf_latch.svg";case Xi.SIGNAL:return"../assets/icon_wf_signal.svg";case Xi.TEMPERATURE:return"../assets/icon_wf_temperature.svg"}}calculateGroups(c){let f=hb(t7,U=>U[c]),r=new Map([...f.entries()].sort()),w=[],I=new Wh,A=localStorage.getItem("pointsCoords");if(console.log(A),A){let U=JSON.parse(A);console.log("parsedCoords",U),console.log("slicedCoordsArray",U);for(let Q of U)console.log("slicedCoord",Q),w.push(Q)}let L=0;return r.forEach((U,Q)=>{let fe=[],he=[];U.forEach(Fe=>{if(Fe.type===zi.DEVICE){let tt=Fe,{alarms:ft}=tt,Ue=as(tt,["alarms"]);Fe.alarms.forEach(Vt=>{fe.push(hi(gt(gt({},Vt),Ue),{x:KN(-750,750),y:KN(350,-350)})),console.log("index",L),L+=1})}else he.push(Fe)});let be=fe.reduce((Fe,tt)=>(Fe[tt.priority]||(Fe[tt.priority]=hi(gt({},tt),{count:0})),Fe[tt.priority].count+=1,Fe),{}),De=Object.values(be),Ke=[...he,...De];I.set(Q,Ke)}),I}calculateXAxis(){return n7(-(window.innerWidth-100),window.innerWidth-100,this.groups.size)}setFixedXAxisToGroupParent(){this.xAxis=this.calculateXAxis(),this.groups.forEach(c=>{c.forEach((f,r)=>{f.type===zi.GROUP&&(f.fx=this.xAxis[r],f.fy=0)})})}loadSimulations(){let c=new Map;this.groups.forEach((f,r)=>{let w=()=>{this.groups.get(r)?.forEach(A=>{A.type===zi.GROUP&&(A.fx=this.xAxis[r],A.fy=0)}),this.nodes[r]?.attr("cx",A=>A.x).attr("cy",A=>A.y),this.texts[r]?.attr("x",A=>A.x).attr("y",A=>A.y),this.icons[r]?.attr("x",A=>A.x-this.getRadius(A.type)/2).attr("y",A=>A.y-this.getRadius(A.type)/2)},I=B_(this.groups.get(r)).alphaDecay(.01).velocityDecay(.2).force("charge",V_().strength(5)).force("x",j_(this.xAxis[r]).strength(.02)).force("y",U_().strength(.02)).force("collide",z_().radius(A=>A.type===zi.GROUP?A.r-15:A.r).iterations(3)).on("tick",w);c.set(r,I),console.log("this.groups.get(key)",this.groups.get(r))}),this.simulation=c}restartSimulations(){for(let c of this.simulation)c[1].restart()}};n.\u0275fac=function(f){return new(f||n)(Qn(ds))},n.\u0275cmp=pi({type:n,selectors:[["app-gravity-bubbles-view"]],standalone:!0,features:[mi],decls:3,vars:2,consts:[[1,"bubbles"],[2,"position","absolute","top","300px","left","1000px","z-index","999"],[2,"height","30px","width","30px"]],template:function(f,r){f&1&&(Wn(0,"div",0),Ft(1,"div",1),nk(),Wn(2,"svg",2),kt()),f&2&&(Bn(),Fh("view-transition-name","cube"))},dependencies:[qi],styles:["svg[_ngcontent-%COMP%]{view-transition-name:circle-image}img[_ngcontent-%COMP%]{view-transition-name:card-image}[_ngcontent-%COMP%]::vview-transition-group(cube){animation-duration:4s}"]});let o=n;return o})();function n7(o,n,l){let c=(n-o)/l,f=[];for(let r=0;r<l;r++){let w=o+r*c,I=w+c;f.push((w+I)/2)}return f}var QN=(()=>{let n=class n{handleMenuClick(c,f){c.cancelBubble=!0}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=pi({type:n,selectors:[["app-sensor-overview"]],standalone:!0,features:[mi],decls:21,vars:0,consts:[[1,"normal","menu-element",2,"text-align","left","padding-left","10px",3,"click"],["src","../../../assets/top-right-arrow.svg",2,"position","fixed","right","15px","margin-top","4px"],[1,"critical","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"high","menu-element",2,"height","fit-content","text-align","left","padding-left","10px",3,"click"],[1,"dotted"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%"],["src","../../../assets/alert-add.svg",1,"add-icon"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%","text-decoration-line","line-through","text-decoration-color","rgba(0, 0, 0, 0.5)","color","rgba(0, 0, 0, 0.5)"],["src","../../../assets/alert-close.svg",1,"add-icon"],[1,"regular","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"low","menu-element",2,"text-align","left","padding-left","10px",3,"click"]],template:function(f,r){f&1&&(Ft(0,"div",0),bi("click",function(I){return r.handleMenuClick(I,"normal")}),Vn(1," 7 tasks to delegate "),Wn(2,"img",1),kt(),Ft(3,"div",2),bi("click",function(I){return r.handleMenuClick(I,"critical")}),Vn(4," 3 critical alerts "),kt(),Ft(5,"div",3),bi("click",function(I){return r.handleMenuClick(I,"high")}),Vn(6," 8 high priority alerts "),Wn(7,"hr",4),Ft(8,"div",5),Vn(9,"4 mice to be released "),Wn(10,"img",6),kt(),Ft(11,"div",5),Vn(12,"2 batteries to be replaced "),Wn(13,"img",6),kt(),Ft(14,"div",7),Vn(15," 2 roofs to be cleared of snow "),Wn(16,"img",8),kt()(),Ft(17,"div",9),bi("click",function(I){return r.handleMenuClick(I,"regular")}),Vn(18," 29 regular statuses "),kt(),Ft(19,"div",10),bi("click",function(I){return r.handleMenuClick(I,"low")}),Vn(20," 3 low priority statuses "),kt())},dependencies:[qi]});let o=n;return o})();var JN=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:XN},{path:"bubbles",component:vD},{path:"sensors",component:QN,data:{animation:"sensorsPage"}}];var $_=class{},r7=(()=>{let n=class n extends $_{constructor(c){super(),this.http=c}getSvg(c){return this.http.get(c,{responseType:"text"})}};n.\u0275fac=function(f){return new(f||n)(Ut(JC))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),o7=new an("SERVER_URL"),xD=(()=>{let n=class n{constructor(){this.loader=bt($_),this.serverUrl=bt(o7,{optional:!0}),this.document=bt(Pi),this.iconsByUrl=new Map,this.iconsLoadingByUrl=new Map}addSvg(c,f){if(!this.iconsByUrl.has(c)){let r=this.document.createElement("DIV");r.innerHTML=f;let w=r.querySelector("svg");this.iconsByUrl.set(c,w)}}loadSvg(c,f=c){if(this.serverUrl&&c.match(/^(http(s)?):/)===null&&(c=this.serverUrl+c,f=c),this.iconsByUrl.has(f))return un(this.iconsByUrl.get(f));if(this.iconsLoadingByUrl.has(f))return this.iconsLoadingByUrl.get(f);let r=this.loader.getSvg(c).pipe(Sn(w=>{let I=this.document.createElement("DIV");return I.innerHTML=w,I.querySelector("svg")}),lr(w=>this.iconsByUrl.set(f,w)),_a(w=>(console.error(w),pl(w))),ya(()=>this.iconsLoadingByUrl.delete(f)),$E());return this.iconsLoadingByUrl.set(f,r),r}getSvgByName(c){return this.iconsByUrl.has(c)?un(this.iconsByUrl.get(c)):this.iconsLoadingByUrl.has(c)?this.iconsLoadingByUrl.get(c):pl(`No svg with name '${c}' has been loaded`)}unloadSvg(c){this.iconsByUrl.has(c)&&this.iconsByUrl.delete(c)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function s7(o){return o||new xD}var a7={provide:xD,deps:[[new Xf,new $g,xD]],useFactory:s7};function e3(o={}){return $c([a7,o.loader||{provide:$_,useClass:r7}])}var Rn=function(o){return o[o.State=0]="State",o[o.Transition=1]="Transition",o[o.Sequence=2]="Sequence",o[o.Group=3]="Group",o[o.Animate=4]="Animate",o[o.Keyframes=5]="Keyframes",o[o.Style=6]="Style",o[o.Trigger=7]="Trigger",o[o.Reference=8]="Reference",o[o.AnimateChild=9]="AnimateChild",o[o.AnimateRef=10]="AnimateRef",o[o.Query=11]="Query",o[o.Stagger=12]="Stagger",o}(Rn||{}),Ra="*";function t3(o,n){return{type:Rn.Trigger,name:o,definitions:n,options:{}}}function bD(o,n=null){return{type:Rn.Animate,styles:n,timings:o}}function n3(o,n=null){return{type:Rn.Group,steps:o,options:n}}function i3(o,n=null){return{type:Rn.Sequence,steps:o,options:n}}function Tl(o){return{type:Rn.Style,styles:o,offset:null}}function r3(o,n,l=null){return{type:Rn.Transition,expr:o,animation:n,options:l}}function jb(o,n,l=null){return{type:Rn.Query,selector:o,animation:n,options:l}}var iu=class{constructor(n=0,l=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=n+l}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(n=>n()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(n){this._position=this.totalTime?n*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(n){let l=n=="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},G_=class{constructor(n){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=n;let l=0,c=0,f=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(w=>{w.onDone(()=>{++l==r&&this._onFinish()}),w.onDestroy(()=>{++c==r&&this._onDestroy()}),w.onStart(()=>{++f==r&&this._onStart()})}),this.totalTime=this.players.reduce((w,I)=>Math.max(w,I.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this.players.forEach(n=>n.init())}onStart(n){this._onStartFns.push(n)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(n=>n()),this._onStartFns=[])}onDone(n){this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(n=>n.play())}pause(){this.players.forEach(n=>n.pause())}restart(){this.players.forEach(n=>n.restart())}finish(){this._onFinish(),this.players.forEach(n=>n.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(n=>n.destroy()),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this.players.forEach(n=>n.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(n){let l=n*this.totalTime;this.players.forEach(c=>{let f=c.totalTime?Math.min(1,l/c.totalTime):1;c.setPosition(f)})}getPosition(){let n=this.players.reduce((l,c)=>l===null||c.totalTime>l.totalTime?c:l,null);return n!=null?n.getPosition():0}beforeDestroy(){this.players.forEach(n=>{n.beforeDestroy&&n.beforeDestroy()})}triggerCallback(n){let l=n=="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},Ub="!";function o3(o){return new xt(3e3,!1)}function l7(){return new xt(3100,!1)}function c7(){return new xt(3101,!1)}function u7(o){return new xt(3001,!1)}function h7(o){return new xt(3003,!1)}function d7(o){return new xt(3004,!1)}function f7(o,n){return new xt(3005,!1)}function p7(){return new xt(3006,!1)}function m7(){return new xt(3007,!1)}function g7(o,n){return new xt(3008,!1)}function _7(o){return new xt(3002,!1)}function y7(o,n,l,c,f){return new xt(3010,!1)}function v7(){return new xt(3011,!1)}function x7(){return new xt(3012,!1)}function b7(){return new xt(3200,!1)}function w7(){return new xt(3202,!1)}function E7(){return new xt(3013,!1)}function T7(o){return new xt(3014,!1)}function C7(o){return new xt(3015,!1)}function I7(o){return new xt(3016,!1)}function D7(o,n){return new xt(3404,!1)}function S7(o){return new xt(3502,!1)}function M7(o){return new xt(3503,!1)}function A7(){return new xt(3300,!1)}function P7(o){return new xt(3504,!1)}function R7(o){return new xt(3301,!1)}function k7(o,n){return new xt(3302,!1)}function O7(o){return new xt(3303,!1)}function L7(o,n){return new xt(3400,!1)}function F7(o){return new xt(3401,!1)}function N7(o){return new xt(3402,!1)}function z7(o,n){return new xt(3505,!1)}function ru(o){switch(o.length){case 0:return new iu;case 1:return o[0];default:return new G_(o)}}function v3(o,n,l=new Map,c=new Map){let f=[],r=[],w=-1,I=null;if(n.forEach(A=>{let L=A.get("offset"),U=L==w,Q=U&&I||new Map;A.forEach((fe,he)=>{let be=he,De=fe;if(he!=="offset")switch(be=o.normalizePropertyName(be,f),De){case Ub:De=l.get(he);break;case Ra:De=c.get(he);break;default:De=o.normalizeStyleValue(he,be,De,f);break}Q.set(be,De)}),U||r.push(Q),I=Q,w=L}),f.length)throw S7(f);return r}function GD(o,n,l,c){switch(n){case"start":o.onStart(()=>c(l&&wD(l,"start",o)));break;case"done":o.onDone(()=>c(l&&wD(l,"done",o)));break;case"destroy":o.onDestroy(()=>c(l&&wD(l,"destroy",o)));break}}function wD(o,n,l){let c=l.totalTime,f=!!l.disabled,r=HD(o.element,o.triggerName,o.fromState,o.toState,n||o.phaseName,c??o.totalTime,f),w=o._data;return w!=null&&(r._data=w),r}function HD(o,n,l,c,f="",r=0,w){return{element:o,triggerName:n,fromState:l,toState:c,phaseName:f,totalTime:r,disabled:!!w}}function Ho(o,n,l){let c=o.get(n);return c||o.set(n,c=l),c}function s3(o){let n=o.indexOf(":"),l=o.substring(1,n),c=o.slice(n+1);return[l,c]}var B7=typeof document>"u"?null:document.documentElement;function qD(o){let n=o.parentNode||o.host||null;return n===B7?null:n}function V7(o){return o.substring(1,6)=="ebkit"}var nd=null,a3=!1;function j7(o){nd||(nd=U7()||{},a3=nd.style?"WebkitAppearance"in nd.style:!1);let n=!0;return nd.style&&!V7(o)&&(n=o in nd.style,!n&&a3&&(n="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in nd.style)),n}function U7(){return typeof document<"u"?document.body:null}function x3(o,n){for(;n;){if(n===o)return!0;n=qD(n)}return!1}function b3(o,n,l){if(l)return Array.from(o.querySelectorAll(n));let c=o.querySelector(n);return c?[c]:[]}var WD=(()=>{let n=class n{validateStyleProperty(c){return j7(c)}containsElement(c,f){return x3(c,f)}getParentElement(c){return qD(c)}query(c,f,r){return b3(c,f,r)}computeStyle(c,f,r){return r||""}animate(c,f,r,w,I,A=[],L){return new iu(r,w)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),KD=class KD{};KD.NOOP=new WD;var od=KD,sd=class{};var $7=1e3,w3="{{",G7="}}",E3="ng-enter",SD="ng-leave",$b="ng-trigger",Zb=".ng-trigger",l3="ng-animating",MD=".ng-animating";function Cl(o){if(typeof o=="number")return o;let n=o.match(/^(-?[\.\d]+)(m?s)/);return!n||n.length<2?0:AD(parseFloat(n[1]),n[2])}function AD(o,n){switch(n){case"s":return o*$7;default:return o}}function Yb(o,n,l){return o.hasOwnProperty("duration")?o:H7(o,n,l)}function H7(o,n,l){let c=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,f,r=0,w="";if(typeof o=="string"){let I=o.match(c);if(I===null)return n.push(o3(o)),{duration:0,delay:0,easing:""};f=AD(parseFloat(I[1]),I[2]);let A=I[3];A!=null&&(r=AD(parseFloat(A),I[4]));let L=I[5];L&&(w=L)}else f=o;if(!l){let I=!1,A=n.length;f<0&&(n.push(l7()),I=!0),r<0&&(n.push(c7()),I=!0),I&&n.splice(A,0,o3(o))}return{duration:f,delay:r,easing:w}}function q7(o){return o.length?o[0]instanceof Map?o:o.map(n=>new Map(Object.entries(n))):[]}function ka(o,n,l){n.forEach((c,f)=>{let r=ZD(f);l&&!l.has(f)&&l.set(f,o.style[r]),o.style[r]=c})}function rd(o,n){n.forEach((l,c)=>{let f=ZD(c);o.style[f]=""})}function H_(o){return Array.isArray(o)?o.length==1?o[0]:i3(o):o}function W7(o,n,l){let c=n.params||{},f=T3(o);f.length&&f.forEach(r=>{c.hasOwnProperty(r)||l.push(u7(r))})}var PD=new RegExp(`${w3}\\s*(.+?)\\s*${G7}`,"g");function T3(o){let n=[];if(typeof o=="string"){let l;for(;l=PD.exec(o);)n.push(l[1]);PD.lastIndex=0}return n}function W_(o,n,l){let c=`${o}`,f=c.replace(PD,(r,w)=>{let I=n[w];return I==null&&(l.push(h7(w)),I=""),I.toString()});return f==c?o:f}var Z7=/-+([a-z0-9])/g;function ZD(o){return o.replace(Z7,(...n)=>n[1].toUpperCase())}function Y7(o,n){return o===0||n===0}function X7(o,n,l){if(l.size&&n.length){let c=n[0],f=[];if(l.forEach((r,w)=>{c.has(w)||f.push(w),c.set(w,r)}),f.length)for(let r=1;r<n.length;r++){let w=n[r];f.forEach(I=>w.set(I,YD(o,I)))}}return n}function Go(o,n,l){switch(n.type){case Rn.Trigger:return o.visitTrigger(n,l);case Rn.State:return o.visitState(n,l);case Rn.Transition:return o.visitTransition(n,l);case Rn.Sequence:return o.visitSequence(n,l);case Rn.Group:return o.visitGroup(n,l);case Rn.Animate:return o.visitAnimate(n,l);case Rn.Keyframes:return o.visitKeyframes(n,l);case Rn.Style:return o.visitStyle(n,l);case Rn.Reference:return o.visitReference(n,l);case Rn.AnimateChild:return o.visitAnimateChild(n,l);case Rn.AnimateRef:return o.visitAnimateRef(n,l);case Rn.Query:return o.visitQuery(n,l);case Rn.Stagger:return o.visitStagger(n,l);default:throw d7(n.type)}}function YD(o,n){return window.getComputedStyle(o)[n]}var K7=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Xb=class extends sd{normalizePropertyName(n,l){return ZD(n)}normalizeStyleValue(n,l,c,f){let r="",w=c.toString().trim();if(K7.has(l)&&c!==0&&c!=="0")if(typeof c=="number")r="px";else{let I=c.match(/^[+-]?[\d\.]+([a-z]*)$/);I&&I[1].length==0&&f.push(f7(n,c))}return w+r}};var Kb="*";function Q7(o,n){let l=[];return typeof o=="string"?o.split(/\s*,\s*/).forEach(c=>J7(c,l,n)):l.push(o),l}function J7(o,n,l){if(o[0]==":"){let A=eZ(o,l);if(typeof A=="function"){n.push(A);return}o=A}let c=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(c==null||c.length<4)return l.push(C7(o)),n;let f=c[1],r=c[2],w=c[3];n.push(c3(f,w));let I=f==Kb&&w==Kb;r[0]=="<"&&!I&&n.push(c3(w,f))}function eZ(o,n){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(l,c)=>parseFloat(c)>parseFloat(l);case":decrement":return(l,c)=>parseFloat(c)<parseFloat(l);default:return n.push(I7(o)),"* => *"}}var Gb=new Set(["true","1"]),Hb=new Set(["false","0"]);function c3(o,n){let l=Gb.has(o)||Hb.has(o),c=Gb.has(n)||Hb.has(n);return(f,r)=>{let w=o==Kb||o==f,I=n==Kb||n==r;return!w&&l&&typeof f=="boolean"&&(w=f?Gb.has(o):Hb.has(o)),!I&&c&&typeof r=="boolean"&&(I=r?Gb.has(n):Hb.has(n)),w&&I}}var C3=":self",tZ=new RegExp(`s*${C3}s*,?`,"g");function I3(o,n,l,c){return new RD(o).build(n,l,c)}var u3="",RD=class{constructor(n){this._driver=n}build(n,l,c){let f=new kD(l);return this._resetContextStyleTimingState(f),Go(this,H_(n),f)}_resetContextStyleTimingState(n){n.currentQuerySelector=u3,n.collectedStyles=new Map,n.collectedStyles.set(u3,new Map),n.currentTime=0}visitTrigger(n,l){let c=l.queryCount=0,f=l.depCount=0,r=[],w=[];return n.name.charAt(0)=="@"&&l.errors.push(p7()),n.definitions.forEach(I=>{if(this._resetContextStyleTimingState(l),I.type==Rn.State){let A=I,L=A.name;L.toString().split(/\s*,\s*/).forEach(U=>{A.name=U,r.push(this.visitState(A,l))}),A.name=L}else if(I.type==Rn.Transition){let A=this.visitTransition(I,l);c+=A.queryCount,f+=A.depCount,w.push(A)}else l.errors.push(m7())}),{type:Rn.Trigger,name:n.name,states:r,transitions:w,queryCount:c,depCount:f,options:null}}visitState(n,l){let c=this.visitStyle(n.styles,l),f=n.options&&n.options.params||null;if(c.containsDynamicStyles){let r=new Set,w=f||{};c.styles.forEach(I=>{I instanceof Map&&I.forEach(A=>{T3(A).forEach(L=>{w.hasOwnProperty(L)||r.add(L)})})}),r.size&&l.errors.push(g7(n.name,[...r.values()]))}return{type:Rn.State,name:n.name,style:c,options:f?{params:f}:null}}visitTransition(n,l){l.queryCount=0,l.depCount=0;let c=Go(this,H_(n.animation),l),f=Q7(n.expr,l.errors);return{type:Rn.Transition,matchers:f,animation:c,queryCount:l.queryCount,depCount:l.depCount,options:id(n.options)}}visitSequence(n,l){return{type:Rn.Sequence,steps:n.steps.map(c=>Go(this,c,l)),options:id(n.options)}}visitGroup(n,l){let c=l.currentTime,f=0,r=n.steps.map(w=>{l.currentTime=c;let I=Go(this,w,l);return f=Math.max(f,l.currentTime),I});return l.currentTime=f,{type:Rn.Group,steps:r,options:id(n.options)}}visitAnimate(n,l){let c=oZ(n.timings,l.errors);l.currentAnimateTimings=c;let f,r=n.styles?n.styles:Tl({});if(r.type==Rn.Keyframes)f=this.visitKeyframes(r,l);else{let w=n.styles,I=!1;if(!w){I=!0;let L={};c.easing&&(L.easing=c.easing),w=Tl(L)}l.currentTime+=c.duration+c.delay;let A=this.visitStyle(w,l);A.isEmptyStep=I,f=A}return l.currentAnimateTimings=null,{type:Rn.Animate,timings:c,style:f,options:null}}visitStyle(n,l){let c=this._makeStyleAst(n,l);return this._validateStyleAst(c,l),c}_makeStyleAst(n,l){let c=[],f=Array.isArray(n.styles)?n.styles:[n.styles];for(let I of f)typeof I=="string"?I===Ra?c.push(I):l.errors.push(_7(I)):c.push(new Map(Object.entries(I)));let r=!1,w=null;return c.forEach(I=>{if(I instanceof Map&&(I.has("easing")&&(w=I.get("easing"),I.delete("easing")),!r)){for(let A of I.values())if(A.toString().indexOf(w3)>=0){r=!0;break}}}),{type:Rn.Style,styles:c,easing:w,offset:n.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(n,l){let c=l.currentAnimateTimings,f=l.currentTime,r=l.currentTime;c&&r>0&&(r-=c.duration+c.delay),n.styles.forEach(w=>{typeof w!="string"&&w.forEach((I,A)=>{let L=l.collectedStyles.get(l.currentQuerySelector),U=L.get(A),Q=!0;U&&(r!=f&&r>=U.startTime&&f<=U.endTime&&(l.errors.push(y7(A,U.startTime,U.endTime,r,f)),Q=!1),r=U.startTime),Q&&L.set(A,{startTime:r,endTime:f}),l.options&&W7(I,l.options,l.errors)})})}visitKeyframes(n,l){let c={type:Rn.Keyframes,styles:[],options:null};if(!l.currentAnimateTimings)return l.errors.push(v7()),c;let f=1,r=0,w=[],I=!1,A=!1,L=0,U=n.steps.map(Fe=>{let tt=this._makeStyleAst(Fe,l),ft=tt.offset!=null?tt.offset:rZ(tt.styles),Ue=0;return ft!=null&&(r++,Ue=tt.offset=ft),A=A||Ue<0||Ue>1,I=I||Ue<L,L=Ue,w.push(Ue),tt});A&&l.errors.push(x7()),I&&l.errors.push(b7());let Q=n.steps.length,fe=0;r>0&&r<Q?l.errors.push(w7()):r==0&&(fe=f/(Q-1));let he=Q-1,be=l.currentTime,De=l.currentAnimateTimings,Ke=De.duration;return U.forEach((Fe,tt)=>{let ft=fe>0?tt==he?1:fe*tt:w[tt],Ue=ft*Ke;l.currentTime=be+De.delay+Ue,De.duration=Ue,this._validateStyleAst(Fe,l),Fe.offset=ft,c.styles.push(Fe)}),c}visitReference(n,l){return{type:Rn.Reference,animation:Go(this,H_(n.animation),l),options:id(n.options)}}visitAnimateChild(n,l){return l.depCount++,{type:Rn.AnimateChild,options:id(n.options)}}visitAnimateRef(n,l){return{type:Rn.AnimateRef,animation:this.visitReference(n.animation,l),options:id(n.options)}}visitQuery(n,l){let c=l.currentQuerySelector,f=n.options||{};l.queryCount++,l.currentQuery=n;let[r,w]=nZ(n.selector);l.currentQuerySelector=c.length?c+" "+r:r,Ho(l.collectedStyles,l.currentQuerySelector,new Map);let I=Go(this,H_(n.animation),l);return l.currentQuery=null,l.currentQuerySelector=c,{type:Rn.Query,selector:r,limit:f.limit||0,optional:!!f.optional,includeSelf:w,animation:I,originalSelector:n.selector,options:id(n.options)}}visitStagger(n,l){l.currentQuery||l.errors.push(E7());let c=n.timings==="full"?{duration:0,delay:0,easing:"full"}:Yb(n.timings,l.errors,!0);return{type:Rn.Stagger,animation:Go(this,H_(n.animation),l),timings:c,options:null}}};function nZ(o){let n=!!o.split(/\s*,\s*/).find(l=>l==C3);return n&&(o=o.replace(tZ,"")),o=o.replace(/@\*/g,Zb).replace(/@\w+/g,l=>Zb+"-"+l.slice(1)).replace(/:animating/g,MD),[o,n]}function iZ(o){return o?gt({},o):null}var kD=class{constructor(n){this.errors=n,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function rZ(o){if(typeof o=="string")return null;let n=null;if(Array.isArray(o))o.forEach(l=>{if(l instanceof Map&&l.has("offset")){let c=l;n=parseFloat(c.get("offset")),c.delete("offset")}});else if(o instanceof Map&&o.has("offset")){let l=o;n=parseFloat(l.get("offset")),l.delete("offset")}return n}function oZ(o,n){if(o.hasOwnProperty("duration"))return o;if(typeof o=="number"){let r=Yb(o,n).duration;return ED(r,0,"")}let l=o;if(l.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=ED(0,0,"");return r.dynamic=!0,r.strValue=l,r}let f=Yb(l,n);return ED(f.duration,f.delay,f.easing)}function id(o){return o?(o=gt({},o),o.params&&(o.params=iZ(o.params))):o={},o}function ED(o,n,l){return{duration:o,delay:n,easing:l}}function XD(o,n,l,c,f,r,w=null,I=!1){return{type:1,element:o,keyframes:n,preStyleProps:l,postStyleProps:c,duration:f,delay:r,totalTime:f+r,easing:w,subTimeline:I}}var Z_=class{constructor(){this._map=new Map}get(n){return this._map.get(n)||[]}append(n,l){let c=this._map.get(n);c||this._map.set(n,c=[]),c.push(...l)}has(n){return this._map.has(n)}clear(){this._map.clear()}},sZ=1,aZ=":enter",lZ=new RegExp(aZ,"g"),cZ=":leave",uZ=new RegExp(cZ,"g");function D3(o,n,l,c,f,r=new Map,w=new Map,I,A,L=[]){return new OD().buildKeyframes(o,n,l,c,f,r,w,I,A,L)}var OD=class{buildKeyframes(n,l,c,f,r,w,I,A,L,U=[]){L=L||new Z_;let Q=new LD(n,l,L,f,r,U,[]);Q.options=A;let fe=A.delay?Cl(A.delay):0;Q.currentTimeline.delayNextStep(fe),Q.currentTimeline.setStyles([w],null,Q.errors,A),Go(this,c,Q);let he=Q.timelines.filter(be=>be.containsAnimation());if(he.length&&I.size){let be;for(let De=he.length-1;De>=0;De--){let Ke=he[De];if(Ke.element===l){be=Ke;break}}be&&!be.allowOnlyTimelineStyles()&&be.setStyles([I],null,Q.errors,A)}return he.length?he.map(be=>be.buildKeyframes()):[XD(l,[],[],[],0,fe,"",!1)]}visitTrigger(n,l){}visitState(n,l){}visitTransition(n,l){}visitAnimateChild(n,l){let c=l.subInstructions.get(l.element);if(c){let f=l.createSubContext(n.options),r=l.currentTimeline.currentTime,w=this._visitSubInstructions(c,f,f.options);r!=w&&l.transformIntoNewTimeline(w)}l.previousNode=n}visitAnimateRef(n,l){let c=l.createSubContext(n.options);c.transformIntoNewTimeline(),this._applyAnimationRefDelays([n.options,n.animation.options],l,c),this.visitReference(n.animation,c),l.transformIntoNewTimeline(c.currentTimeline.currentTime),l.previousNode=n}_applyAnimationRefDelays(n,l,c){for(let f of n){let r=f?.delay;if(r){let w=typeof r=="number"?r:Cl(W_(r,f?.params??{},l.errors));c.delayNextStep(w)}}}_visitSubInstructions(n,l,c){let r=l.currentTimeline.currentTime,w=c.duration!=null?Cl(c.duration):null,I=c.delay!=null?Cl(c.delay):null;return w!==0&&n.forEach(A=>{let L=l.appendInstructionToTimeline(A,w,I);r=Math.max(r,L.duration+L.delay)}),r}visitReference(n,l){l.updateOptions(n.options,!0),Go(this,n.animation,l),l.previousNode=n}visitSequence(n,l){let c=l.subContextCount,f=l,r=n.options;if(r&&(r.params||r.delay)&&(f=l.createSubContext(r),f.transformIntoNewTimeline(),r.delay!=null)){f.previousNode.type==Rn.Style&&(f.currentTimeline.snapshotCurrentStyles(),f.previousNode=Qb);let w=Cl(r.delay);f.delayNextStep(w)}n.steps.length&&(n.steps.forEach(w=>Go(this,w,f)),f.currentTimeline.applyStylesToKeyframe(),f.subContextCount>c&&f.transformIntoNewTimeline()),l.previousNode=n}visitGroup(n,l){let c=[],f=l.currentTimeline.currentTime,r=n.options&&n.options.delay?Cl(n.options.delay):0;n.steps.forEach(w=>{let I=l.createSubContext(n.options);r&&I.delayNextStep(r),Go(this,w,I),f=Math.max(f,I.currentTimeline.currentTime),c.push(I.currentTimeline)}),c.forEach(w=>l.currentTimeline.mergeTimelineCollectedStyles(w)),l.transformIntoNewTimeline(f),l.previousNode=n}_visitTiming(n,l){if(n.dynamic){let c=n.strValue,f=l.params?W_(c,l.params,l.errors):c;return Yb(f,l.errors)}else return{duration:n.duration,delay:n.delay,easing:n.easing}}visitAnimate(n,l){let c=l.currentAnimateTimings=this._visitTiming(n.timings,l),f=l.currentTimeline;c.delay&&(l.incrementTime(c.delay),f.snapshotCurrentStyles());let r=n.style;r.type==Rn.Keyframes?this.visitKeyframes(r,l):(l.incrementTime(c.duration),this.visitStyle(r,l),f.applyStylesToKeyframe()),l.currentAnimateTimings=null,l.previousNode=n}visitStyle(n,l){let c=l.currentTimeline,f=l.currentAnimateTimings;!f&&c.hasCurrentStyleProperties()&&c.forwardFrame();let r=f&&f.easing||n.easing;n.isEmptyStep?c.applyEmptyStep(r):c.setStyles(n.styles,r,l.errors,l.options),l.previousNode=n}visitKeyframes(n,l){let c=l.currentAnimateTimings,f=l.currentTimeline.duration,r=c.duration,I=l.createSubContext().currentTimeline;I.easing=c.easing,n.styles.forEach(A=>{let L=A.offset||0;I.forwardTime(L*r),I.setStyles(A.styles,A.easing,l.errors,l.options),I.applyStylesToKeyframe()}),l.currentTimeline.mergeTimelineCollectedStyles(I),l.transformIntoNewTimeline(f+r),l.previousNode=n}visitQuery(n,l){let c=l.currentTimeline.currentTime,f=n.options||{},r=f.delay?Cl(f.delay):0;r&&(l.previousNode.type===Rn.Style||c==0&&l.currentTimeline.hasCurrentStyleProperties())&&(l.currentTimeline.snapshotCurrentStyles(),l.previousNode=Qb);let w=c,I=l.invokeQuery(n.selector,n.originalSelector,n.limit,n.includeSelf,!!f.optional,l.errors);l.currentQueryTotal=I.length;let A=null;I.forEach((L,U)=>{l.currentQueryIndex=U;let Q=l.createSubContext(n.options,L);r&&Q.delayNextStep(r),L===l.element&&(A=Q.currentTimeline),Go(this,n.animation,Q),Q.currentTimeline.applyStylesToKeyframe();let fe=Q.currentTimeline.currentTime;w=Math.max(w,fe)}),l.currentQueryIndex=0,l.currentQueryTotal=0,l.transformIntoNewTimeline(w),A&&(l.currentTimeline.mergeTimelineCollectedStyles(A),l.currentTimeline.snapshotCurrentStyles()),l.previousNode=n}visitStagger(n,l){let c=l.parentContext,f=l.currentTimeline,r=n.timings,w=Math.abs(r.duration),I=w*(l.currentQueryTotal-1),A=w*l.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":A=I-A;break;case"full":A=c.currentStaggerTime;break}let U=l.currentTimeline;A&&U.delayNextStep(A);let Q=U.currentTime;Go(this,n.animation,l),l.previousNode=n,c.currentStaggerTime=f.currentTime-Q+(f.startTime-c.currentTimeline.startTime)}},Qb={},LD=class o{constructor(n,l,c,f,r,w,I,A){this._driver=n,this.element=l,this.subInstructions=c,this._enterClassName=f,this._leaveClassName=r,this.errors=w,this.timelines=I,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Qb,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=A||new Jb(this._driver,l,0),I.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(n,l){if(!n)return;let c=n,f=this.options;c.duration!=null&&(f.duration=Cl(c.duration)),c.delay!=null&&(f.delay=Cl(c.delay));let r=c.params;if(r){let w=f.params;w||(w=this.options.params={}),Object.keys(r).forEach(I=>{(!l||!w.hasOwnProperty(I))&&(w[I]=W_(r[I],w,this.errors))})}}_copyOptions(){let n={};if(this.options){let l=this.options.params;if(l){let c=n.params={};Object.keys(l).forEach(f=>{c[f]=l[f]})}}return n}createSubContext(n=null,l,c){let f=l||this.element,r=new o(this._driver,f,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(f,c||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(n),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(n){return this.previousNode=Qb,this.currentTimeline=this.currentTimeline.fork(this.element,n),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(n,l,c){let f={duration:l??n.duration,delay:this.currentTimeline.currentTime+(c??0)+n.delay,easing:""},r=new FD(this._driver,n.element,n.keyframes,n.preStyleProps,n.postStyleProps,f,n.stretchStartingKeyframe);return this.timelines.push(r),f}incrementTime(n){this.currentTimeline.forwardTime(this.currentTimeline.duration+n)}delayNextStep(n){n>0&&this.currentTimeline.delayNextStep(n)}invokeQuery(n,l,c,f,r,w){let I=[];if(f&&I.push(this.element),n.length>0){n=n.replace(lZ,"."+this._enterClassName),n=n.replace(uZ,"."+this._leaveClassName);let A=c!=1,L=this._driver.query(this.element,n,A);c!==0&&(L=c<0?L.slice(L.length+c,L.length):L.slice(0,c)),I.push(...L)}return!r&&I.length==0&&w.push(T7(l)),I}},Jb=class o{constructor(n,l,c,f){this._driver=n,this.element=l,this.startTime=c,this._elementTimelineStylesLookup=f,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(l),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(l,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(n){let l=this._keyframes.size===1&&this._pendingStyles.size;this.duration||l?(this.forwardTime(this.currentTime+n),l&&this.snapshotCurrentStyles()):this.startTime+=n}fork(n,l){return this.applyStylesToKeyframe(),new o(this._driver,n,l||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=sZ,this._loadKeyframe()}forwardTime(n){this.applyStylesToKeyframe(),this.duration=n,this._loadKeyframe()}_updateStyle(n,l){this._localTimelineStyles.set(n,l),this._globalTimelineStyles.set(n,l),this._styleSummary.set(n,{time:this.currentTime,value:l})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(n){n&&this._previousKeyframe.set("easing",n);for(let[l,c]of this._globalTimelineStyles)this._backFill.set(l,c||Ra),this._currentKeyframe.set(l,Ra);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(n,l,c,f){l&&this._previousKeyframe.set("easing",l);let r=f&&f.params||{},w=hZ(n,this._globalTimelineStyles);for(let[I,A]of w){let L=W_(A,r,c);this._pendingStyles.set(I,L),this._localTimelineStyles.has(I)||this._backFill.set(I,this._globalTimelineStyles.get(I)??Ra),this._updateStyle(I,L)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((n,l)=>{this._currentKeyframe.set(l,n)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((n,l)=>{this._currentKeyframe.has(l)||this._currentKeyframe.set(l,n)}))}snapshotCurrentStyles(){for(let[n,l]of this._localTimelineStyles)this._pendingStyles.set(n,l),this._updateStyle(n,l)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let n=[];for(let l in this._currentKeyframe)n.push(l);return n}mergeTimelineCollectedStyles(n){n._styleSummary.forEach((l,c)=>{let f=this._styleSummary.get(c);(!f||l.time>f.time)&&this._updateStyle(c,l.value)})}buildKeyframes(){this.applyStylesToKeyframe();let n=new Set,l=new Set,c=this._keyframes.size===1&&this.duration===0,f=[];this._keyframes.forEach((I,A)=>{let L=new Map([...this._backFill,...I]);L.forEach((U,Q)=>{U===Ub?n.add(Q):U===Ra&&l.add(Q)}),c||L.set("offset",A/this.duration),f.push(L)});let r=[...n.values()],w=[...l.values()];if(c){let I=f[0],A=new Map(I);I.set("offset",0),A.set("offset",1),f=[I,A]}return XD(this.element,f,r,w,this.duration,this.startTime,this.easing,!1)}},FD=class extends Jb{constructor(n,l,c,f,r,w,I=!1){super(n,l,w.delay),this.keyframes=c,this.preStyleProps=f,this.postStyleProps=r,this._stretchStartingKeyframe=I,this.timings={duration:w.duration,delay:w.delay,easing:w.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let n=this.keyframes,{delay:l,duration:c,easing:f}=this.timings;if(this._stretchStartingKeyframe&&l){let r=[],w=c+l,I=l/w,A=new Map(n[0]);A.set("offset",0),r.push(A);let L=new Map(n[0]);L.set("offset",h3(I)),r.push(L);let U=n.length-1;for(let Q=1;Q<=U;Q++){let fe=new Map(n[Q]),he=fe.get("offset"),be=l+he*c;fe.set("offset",h3(be/w)),r.push(fe)}c=w,l=0,f="",n=r}return XD(this.element,n,this.preStyleProps,this.postStyleProps,c,l,f,!0)}};function h3(o,n=3){let l=Math.pow(10,n-1);return Math.round(o*l)/l}function hZ(o,n){let l=new Map,c;return o.forEach(f=>{if(f==="*"){c??=n.keys();for(let r of c)l.set(r,Ra)}else for(let[r,w]of f)l.set(r,w)}),l}function d3(o,n,l,c,f,r,w,I,A,L,U,Q,fe){return{type:0,element:o,triggerName:n,isRemovalTransition:f,fromState:l,fromStyles:r,toState:c,toStyles:w,timelines:I,queriedElements:A,preStyleProps:L,postStyleProps:U,totalTime:Q,errors:fe}}var TD={},e1=class{constructor(n,l,c){this._triggerName=n,this.ast=l,this._stateStyles=c}match(n,l,c,f){return dZ(this.ast.matchers,n,l,c,f)}buildStyles(n,l,c){let f=this._stateStyles.get("*");return n!==void 0&&(f=this._stateStyles.get(n?.toString())||f),f?f.buildStyles(l,c):new Map}build(n,l,c,f,r,w,I,A,L,U){let Q=[],fe=this.ast.options&&this.ast.options.params||TD,he=I&&I.params||TD,be=this.buildStyles(c,he,Q),De=A&&A.params||TD,Ke=this.buildStyles(f,De,Q),Fe=new Set,tt=new Map,ft=new Map,Ue=f==="void",Vt={params:S3(De,fe),delay:this.ast.options?.delay},Jt=U?[]:D3(n,l,this.ast.animation,r,w,be,Ke,Vt,L,Q),nn=0;return Jt.forEach(Et=>{nn=Math.max(Et.duration+Et.delay,nn)}),Q.length?d3(l,this._triggerName,c,f,Ue,be,Ke,[],[],tt,ft,nn,Q):(Jt.forEach(Et=>{let oi=Et.element,It=Ho(tt,oi,new Set);Et.preStyleProps.forEach(Di=>It.add(Di));let Ei=Ho(ft,oi,new Set);Et.postStyleProps.forEach(Di=>Ei.add(Di)),oi!==l&&Fe.add(oi)}),d3(l,this._triggerName,c,f,Ue,be,Ke,Jt,[...Fe.values()],tt,ft,nn))}};function dZ(o,n,l,c,f){return o.some(r=>r(n,l,c,f))}function S3(o,n){let l=gt({},n);return Object.entries(o).forEach(([c,f])=>{f!=null&&(l[c]=f)}),l}var ND=class{constructor(n,l,c){this.styles=n,this.defaultParams=l,this.normalizer=c}buildStyles(n,l){let c=new Map,f=S3(n,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((w,I)=>{w&&(w=W_(w,f,l));let A=this.normalizer.normalizePropertyName(I,l);w=this.normalizer.normalizeStyleValue(I,A,w,l),c.set(I,w)})}),c}};function fZ(o,n,l){return new zD(o,n,l)}var zD=class{constructor(n,l,c){this.name=n,this.ast=l,this._normalizer=c,this.transitionFactories=[],this.states=new Map,l.states.forEach(f=>{let r=f.options&&f.options.params||{};this.states.set(f.name,new ND(f.style,r,c))}),f3(this.states,"true","1"),f3(this.states,"false","0"),l.transitions.forEach(f=>{this.transitionFactories.push(new e1(n,f,this.states))}),this.fallbackTransition=pZ(n,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(n,l,c,f){return this.transitionFactories.find(w=>w.match(n,l,c,f))||null}matchStyles(n,l,c){return this.fallbackTransition.buildStyles(n,l,c)}};function pZ(o,n,l){let c=[(w,I)=>!0],f={type:Rn.Sequence,steps:[],options:null},r={type:Rn.Transition,animation:f,matchers:c,options:null,queryCount:0,depCount:0};return new e1(o,r,n)}function f3(o,n,l){o.has(n)?o.has(l)||o.set(l,o.get(n)):o.has(l)&&o.set(n,o.get(l))}var mZ=new Z_,BD=class{constructor(n,l,c){this.bodyNode=n,this._driver=l,this._normalizer=c,this._animations=new Map,this._playersById=new Map,this.players=[]}register(n,l){let c=[],f=[],r=I3(this._driver,l,c,f);if(c.length)throw M7(c);f.length&&void 0,this._animations.set(n,r)}_buildPlayer(n,l,c){let f=n.element,r=v3(this._normalizer,n.keyframes,l,c);return this._driver.animate(f,r,n.duration,n.delay,n.easing,[],!0)}create(n,l,c={}){let f=[],r=this._animations.get(n),w,I=new Map;if(r?(w=D3(this._driver,l,r,E3,SD,new Map,new Map,c,mZ,f),w.forEach(U=>{let Q=Ho(I,U.element,new Map);U.postStyleProps.forEach(fe=>Q.set(fe,null))})):(f.push(A7()),w=[]),f.length)throw P7(f);I.forEach((U,Q)=>{U.forEach((fe,he)=>{U.set(he,this._driver.computeStyle(Q,he,Ra))})});let A=w.map(U=>{let Q=I.get(U.element);return this._buildPlayer(U,new Map,Q)}),L=ru(A);return this._playersById.set(n,L),L.onDestroy(()=>this.destroy(n)),this.players.push(L),L}destroy(n){let l=this._getPlayer(n);l.destroy(),this._playersById.delete(n);let c=this.players.indexOf(l);c>=0&&this.players.splice(c,1)}_getPlayer(n){let l=this._playersById.get(n);if(!l)throw R7(n);return l}listen(n,l,c,f){let r=HD(l,"","","");return GD(this._getPlayer(n),c,r,f),()=>{}}command(n,l,c,f){if(c=="register"){this.register(n,f[0]);return}if(c=="create"){let w=f[0]||{};this.create(n,l,w);return}let r=this._getPlayer(n);switch(c){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(f[0]));break;case"destroy":this.destroy(n);break}}},p3="ng-animate-queued",gZ=".ng-animate-queued",CD="ng-animate-disabled",_Z=".ng-animate-disabled",yZ="ng-star-inserted",vZ=".ng-star-inserted",xZ=[],M3={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},bZ={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ws="__ng_removed",Y_=class{get params(){return this.options.params}constructor(n,l=""){this.namespaceId=l;let c=n&&n.hasOwnProperty("value"),f=c?n.value:n;if(this.value=EZ(f),c){let r=n,{value:w}=r,I=as(r,["value"]);this.options=I}else this.options={};this.options.params||(this.options.params={})}absorbOptions(n){let l=n.params;if(l){let c=this.options.params;Object.keys(l).forEach(f=>{c[f]==null&&(c[f]=l[f])})}}},q_="void",ID=new Y_(q_),VD=class{constructor(n,l,c){this.id=n,this.hostElement=l,this._engine=c,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+n,fs(l,this._hostClassName)}listen(n,l,c,f){if(!this._triggers.has(l))throw k7(c,l);if(c==null||c.length==0)throw O7(l);if(!TZ(c))throw L7(c,l);let r=Ho(this._elementListeners,n,[]),w={name:l,phase:c,callback:f};r.push(w);let I=Ho(this._engine.statesByElement,n,new Map);return I.has(l)||(fs(n,$b),fs(n,$b+"-"+l),I.set(l,ID)),()=>{this._engine.afterFlush(()=>{let A=r.indexOf(w);A>=0&&r.splice(A,1),this._triggers.has(l)||I.delete(l)})}}register(n,l){return this._triggers.has(n)?!1:(this._triggers.set(n,l),!0)}_getTrigger(n){let l=this._triggers.get(n);if(!l)throw F7(n);return l}trigger(n,l,c,f=!0){let r=this._getTrigger(l),w=new X_(this.id,l,n),I=this._engine.statesByElement.get(n);I||(fs(n,$b),fs(n,$b+"-"+l),this._engine.statesByElement.set(n,I=new Map));let A=I.get(l),L=new Y_(c,this.id);if(!(c&&c.hasOwnProperty("value"))&&A&&L.absorbOptions(A.options),I.set(l,L),A||(A=ID),!(L.value===q_)&&A.value===L.value){if(!DZ(A.params,L.params)){let De=[],Ke=r.matchStyles(A.value,A.params,De),Fe=r.matchStyles(L.value,L.params,De);De.length?this._engine.reportError(De):this._engine.afterFlush(()=>{rd(n,Ke),ka(n,Fe)})}return}let fe=Ho(this._engine.playersByElement,n,[]);fe.forEach(De=>{De.namespaceId==this.id&&De.triggerName==l&&De.queued&&De.destroy()});let he=r.matchTransition(A.value,L.value,n,L.params),be=!1;if(!he){if(!f)return;he=r.fallbackTransition,be=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:l,transition:he,fromState:A,toState:L,player:w,isFallbackTransition:be}),be||(fs(n,p3),w.onStart(()=>{Sp(n,p3)})),w.onDone(()=>{let De=this.players.indexOf(w);De>=0&&this.players.splice(De,1);let Ke=this._engine.playersByElement.get(n);if(Ke){let Fe=Ke.indexOf(w);Fe>=0&&Ke.splice(Fe,1)}}),this.players.push(w),fe.push(w),w}deregister(n){this._triggers.delete(n),this._engine.statesByElement.forEach(l=>l.delete(n)),this._elementListeners.forEach((l,c)=>{this._elementListeners.set(c,l.filter(f=>f.name!=n))})}clearElementCache(n){this._engine.statesByElement.delete(n),this._elementListeners.delete(n);let l=this._engine.playersByElement.get(n);l&&(l.forEach(c=>c.destroy()),this._engine.playersByElement.delete(n))}_signalRemovalForInnerTriggers(n,l){let c=this._engine.driver.query(n,Zb,!0);c.forEach(f=>{if(f[Ws])return;let r=this._engine.fetchNamespacesByElement(f);r.size?r.forEach(w=>w.triggerLeaveAnimation(f,l,!1,!0)):this.clearElementCache(f)}),this._engine.afterFlushAnimationsDone(()=>c.forEach(f=>this.clearElementCache(f)))}triggerLeaveAnimation(n,l,c,f){let r=this._engine.statesByElement.get(n),w=new Map;if(r){let I=[];if(r.forEach((A,L)=>{if(w.set(L,A.value),this._triggers.has(L)){let U=this.trigger(n,L,q_,f);U&&I.push(U)}}),I.length)return this._engine.markElementAsRemoved(this.id,n,!0,l,w),c&&ru(I).onDone(()=>this._engine.processLeaveNode(n)),!0}return!1}prepareLeaveAnimationListeners(n){let l=this._elementListeners.get(n),c=this._engine.statesByElement.get(n);if(l&&c){let f=new Set;l.forEach(r=>{let w=r.name;if(f.has(w))return;f.add(w);let A=this._triggers.get(w).fallbackTransition,L=c.get(w)||ID,U=new Y_(q_),Q=new X_(this.id,w,n);this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:w,transition:A,fromState:L,toState:U,player:Q,isFallbackTransition:!0})})}}removeNode(n,l){let c=this._engine;if(n.childElementCount&&this._signalRemovalForInnerTriggers(n,l),this.triggerLeaveAnimation(n,l,!0))return;let f=!1;if(c.totalAnimations){let r=c.players.length?c.playersByQueriedElement.get(n):[];if(r&&r.length)f=!0;else{let w=n;for(;w=w.parentNode;)if(c.statesByElement.get(w)){f=!0;break}}}if(this.prepareLeaveAnimationListeners(n),f)c.markElementAsRemoved(this.id,n,!1,l);else{let r=n[Ws];(!r||r===M3)&&(c.afterFlush(()=>this.clearElementCache(n)),c.destroyInnerAnimations(n),c._onRemovalComplete(n,l))}}insertNode(n,l){fs(n,this._hostClassName)}drainQueuedTransitions(n){let l=[];return this._queue.forEach(c=>{let f=c.player;if(f.destroyed)return;let r=c.element,w=this._elementListeners.get(r);w&&w.forEach(I=>{if(I.name==c.triggerName){let A=HD(r,c.triggerName,c.fromState.value,c.toState.value);A._data=n,GD(c.player,I.phase,A,I.callback)}}),f.markedForDestroy?this._engine.afterFlush(()=>{f.destroy()}):l.push(c)}),this._queue=[],l.sort((c,f)=>{let r=c.transition.ast.depCount,w=f.transition.ast.depCount;return r==0||w==0?r-w:this._engine.driver.containsElement(c.element,f.element)?1:-1})}destroy(n){this.players.forEach(l=>l.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,n)}},jD=class{_onRemovalComplete(n,l){this.onRemovalComplete(n,l)}constructor(n,l,c){this.bodyNode=n,this.driver=l,this._normalizer=c,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(f,r)=>{}}get queuedPlayers(){let n=[];return this._namespaceList.forEach(l=>{l.players.forEach(c=>{c.queued&&n.push(c)})}),n}createNamespace(n,l){let c=new VD(n,l,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,l)?this._balanceNamespaceList(c,l):(this.newHostElements.set(l,c),this.collectEnterElement(l)),this._namespaceLookup[n]=c}_balanceNamespaceList(n,l){let c=this._namespaceList,f=this.namespacesByHostElement;if(c.length-1>=0){let w=!1,I=this.driver.getParentElement(l);for(;I;){let A=f.get(I);if(A){let L=c.indexOf(A);c.splice(L+1,0,n),w=!0;break}I=this.driver.getParentElement(I)}w||c.unshift(n)}else c.push(n);return f.set(l,n),n}register(n,l){let c=this._namespaceLookup[n];return c||(c=this.createNamespace(n,l)),c}registerTrigger(n,l,c){let f=this._namespaceLookup[n];f&&f.register(l,c)&&this.totalAnimations++}destroy(n,l){n&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let c=this._fetchNamespace(n);this.namespacesByHostElement.delete(c.hostElement);let f=this._namespaceList.indexOf(c);f>=0&&this._namespaceList.splice(f,1),c.destroy(l),delete this._namespaceLookup[n]}))}_fetchNamespace(n){return this._namespaceLookup[n]}fetchNamespacesByElement(n){let l=new Set,c=this.statesByElement.get(n);if(c){for(let f of c.values())if(f.namespaceId){let r=this._fetchNamespace(f.namespaceId);r&&l.add(r)}}return l}trigger(n,l,c,f){if(qb(l)){let r=this._fetchNamespace(n);if(r)return r.trigger(l,c,f),!0}return!1}insertNode(n,l,c,f){if(!qb(l))return;let r=l[Ws];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let w=this.collectedLeaveElements.indexOf(l);w>=0&&this.collectedLeaveElements.splice(w,1)}if(n){let w=this._fetchNamespace(n);w&&w.insertNode(l,c)}f&&this.collectEnterElement(l)}collectEnterElement(n){this.collectedEnterElements.push(n)}markElementAsDisabled(n,l){l?this.disabledNodes.has(n)||(this.disabledNodes.add(n),fs(n,CD)):this.disabledNodes.has(n)&&(this.disabledNodes.delete(n),Sp(n,CD))}removeNode(n,l,c){if(qb(l)){let f=n?this._fetchNamespace(n):null;f?f.removeNode(l,c):this.markElementAsRemoved(n,l,!1,c);let r=this.namespacesByHostElement.get(l);r&&r.id!==n&&r.removeNode(l,c)}else this._onRemovalComplete(l,c)}markElementAsRemoved(n,l,c,f,r){this.collectedLeaveElements.push(l),l[Ws]={namespaceId:n,setForRemoval:f,hasAnimation:c,removedBeforeQueried:!1,previousTriggersValues:r}}listen(n,l,c,f,r){return qb(l)?this._fetchNamespace(n).listen(l,c,f,r):()=>{}}_buildInstruction(n,l,c,f,r){return n.transition.build(this.driver,n.element,n.fromState.value,n.toState.value,c,f,n.fromState.options,n.toState.options,l,r)}destroyInnerAnimations(n){let l=this.driver.query(n,Zb,!0);l.forEach(c=>this.destroyActiveAnimationsForElement(c)),this.playersByQueriedElement.size!=0&&(l=this.driver.query(n,MD,!0),l.forEach(c=>this.finishActiveQueriedAnimationOnElement(c)))}destroyActiveAnimationsForElement(n){let l=this.playersByElement.get(n);l&&l.forEach(c=>{c.queued?c.markedForDestroy=!0:c.destroy()})}finishActiveQueriedAnimationOnElement(n){let l=this.playersByQueriedElement.get(n);l&&l.forEach(c=>c.finish())}whenRenderingDone(){return new Promise(n=>{if(this.players.length)return ru(this.players).onDone(()=>n());n()})}processLeaveNode(n){let l=n[Ws];if(l&&l.setForRemoval){if(n[Ws]=M3,l.namespaceId){this.destroyInnerAnimations(n);let c=this._fetchNamespace(l.namespaceId);c&&c.clearElementCache(n)}this._onRemovalComplete(n,l.setForRemoval)}n.classList?.contains(CD)&&this.markElementAsDisabled(n,!1),this.driver.query(n,_Z,!0).forEach(c=>{this.markElementAsDisabled(c,!1)})}flush(n=-1){let l=[];if(this.newHostElements.size&&(this.newHostElements.forEach((c,f)=>this._balanceNamespaceList(c,f)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let c=0;c<this.collectedEnterElements.length;c++){let f=this.collectedEnterElements[c];fs(f,yZ)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let c=[];try{l=this._flushAnimations(c,n)}finally{for(let f=0;f<c.length;f++)c[f]()}}else for(let c=0;c<this.collectedLeaveElements.length;c++){let f=this.collectedLeaveElements[c];this.processLeaveNode(f)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(c=>c()),this._flushFns=[],this._whenQuietFns.length){let c=this._whenQuietFns;this._whenQuietFns=[],l.length?ru(l).onDone(()=>{c.forEach(f=>f())}):c.forEach(f=>f())}}reportError(n){throw N7(n)}_flushAnimations(n,l){let c=new Z_,f=[],r=new Map,w=[],I=new Map,A=new Map,L=new Map,U=new Set;this.disabledNodes.forEach(wt=>{U.add(wt);let jt=this.driver.query(wt,gZ,!0);for(let Zt=0;Zt<jt.length;Zt++)U.add(jt[Zt])});let Q=this.bodyNode,fe=Array.from(this.statesByElement.keys()),he=_3(fe,this.collectedEnterElements),be=new Map,De=0;he.forEach((wt,jt)=>{let Zt=E3+De++;be.set(jt,Zt),wt.forEach(vn=>fs(vn,Zt))});let Ke=[],Fe=new Set,tt=new Set;for(let wt=0;wt<this.collectedLeaveElements.length;wt++){let jt=this.collectedLeaveElements[wt],Zt=jt[Ws];Zt&&Zt.setForRemoval&&(Ke.push(jt),Fe.add(jt),Zt.hasAnimation?this.driver.query(jt,vZ,!0).forEach(vn=>Fe.add(vn)):tt.add(jt))}let ft=new Map,Ue=_3(fe,Array.from(Fe));Ue.forEach((wt,jt)=>{let Zt=SD+De++;ft.set(jt,Zt),wt.forEach(vn=>fs(vn,Zt))}),n.push(()=>{he.forEach((wt,jt)=>{let Zt=be.get(jt);wt.forEach(vn=>Sp(vn,Zt))}),Ue.forEach((wt,jt)=>{let Zt=ft.get(jt);wt.forEach(vn=>Sp(vn,Zt))}),Ke.forEach(wt=>{this.processLeaveNode(wt)})});let Vt=[],Jt=[];for(let wt=this._namespaceList.length-1;wt>=0;wt--)this._namespaceList[wt].drainQueuedTransitions(l).forEach(Zt=>{let vn=Zt.player,Nt=Zt.element;if(Vt.push(vn),this.collectedEnterElements.length){let Fi=Nt[Ws];if(Fi&&Fi.setForMove){if(Fi.previousTriggersValues&&Fi.previousTriggersValues.has(Zt.triggerName)){let jn=Fi.previousTriggersValues.get(Zt.triggerName),dr=this.statesByElement.get(Zt.element);if(dr&&dr.has(Zt.triggerName)){let ms=dr.get(Zt.triggerName);ms.value=jn,dr.set(Zt.triggerName,ms)}}vn.destroy();return}}let hr=!Q||!this.driver.containsElement(Q,Nt),ni=ft.get(Nt),Jr=be.get(Nt),gi=this._buildInstruction(Zt,c,Jr,ni,hr);if(gi.errors&&gi.errors.length){Jt.push(gi);return}if(hr){vn.onStart(()=>rd(Nt,gi.fromStyles)),vn.onDestroy(()=>ka(Nt,gi.toStyles)),f.push(vn);return}if(Zt.isFallbackTransition){vn.onStart(()=>rd(Nt,gi.fromStyles)),vn.onDestroy(()=>ka(Nt,gi.toStyles)),f.push(vn);return}let Oa=[];gi.timelines.forEach(Fi=>{Fi.stretchStartingKeyframe=!0,this.disabledNodes.has(Fi.element)||Oa.push(Fi)}),gi.timelines=Oa,c.append(Nt,gi.timelines);let Rt={instruction:gi,player:vn,element:Nt};w.push(Rt),gi.queriedElements.forEach(Fi=>Ho(I,Fi,[]).push(vn)),gi.preStyleProps.forEach((Fi,jn)=>{if(Fi.size){let dr=A.get(jn);dr||A.set(jn,dr=new Set),Fi.forEach((ms,Zs)=>dr.add(Zs))}}),gi.postStyleProps.forEach((Fi,jn)=>{let dr=L.get(jn);dr||L.set(jn,dr=new Set),Fi.forEach((ms,Zs)=>dr.add(Zs))})});if(Jt.length){let wt=[];Jt.forEach(jt=>{wt.push(z7(jt.triggerName,jt.errors))}),Vt.forEach(jt=>jt.destroy()),this.reportError(wt)}let nn=new Map,Et=new Map;w.forEach(wt=>{let jt=wt.element;c.has(jt)&&(Et.set(jt,jt),this._beforeAnimationBuild(wt.player.namespaceId,wt.instruction,nn))}),f.forEach(wt=>{let jt=wt.element;this._getPreviousPlayers(jt,!1,wt.namespaceId,wt.triggerName,null).forEach(vn=>{Ho(nn,jt,[]).push(vn),vn.destroy()})});let oi=Ke.filter(wt=>y3(wt,A,L)),It=new Map;g3(It,this.driver,tt,L,Ra).forEach(wt=>{y3(wt,A,L)&&oi.push(wt)});let Di=new Map;he.forEach((wt,jt)=>{g3(Di,this.driver,new Set(wt),A,Ub)}),oi.forEach(wt=>{let jt=It.get(wt),Zt=Di.get(wt);It.set(wt,new Map([...jt?.entries()??[],...Zt?.entries()??[]]))});let Ui=[],wn=[],qo={};w.forEach(wt=>{let{element:jt,player:Zt,instruction:vn}=wt;if(c.has(jt)){if(U.has(jt)){Zt.onDestroy(()=>ka(jt,vn.toStyles)),Zt.disabled=!0,Zt.overrideTotalTime(vn.totalTime),f.push(Zt);return}let Nt=qo;if(Et.size>1){let ni=jt,Jr=[];for(;ni=ni.parentNode;){let gi=Et.get(ni);if(gi){Nt=gi;break}Jr.push(ni)}Jr.forEach(gi=>Et.set(gi,Nt))}let hr=this._buildAnimation(Zt.namespaceId,vn,nn,r,Di,It);if(Zt.setRealPlayer(hr),Nt===qo)Ui.push(Zt);else{let ni=this.playersByElement.get(Nt);ni&&ni.length&&(Zt.parentPlayer=ru(ni)),f.push(Zt)}}else rd(jt,vn.fromStyles),Zt.onDestroy(()=>ka(jt,vn.toStyles)),wn.push(Zt),U.has(jt)&&f.push(Zt)}),wn.forEach(wt=>{let jt=r.get(wt.element);if(jt&&jt.length){let Zt=ru(jt);wt.setRealPlayer(Zt)}}),f.forEach(wt=>{wt.parentPlayer?wt.syncPlayerEvents(wt.parentPlayer):wt.destroy()});for(let wt=0;wt<Ke.length;wt++){let jt=Ke[wt],Zt=jt[Ws];if(Sp(jt,SD),Zt&&Zt.hasAnimation)continue;let vn=[];if(I.size){let hr=I.get(jt);hr&&hr.length&&vn.push(...hr);let ni=this.driver.query(jt,MD,!0);for(let Jr=0;Jr<ni.length;Jr++){let gi=I.get(ni[Jr]);gi&&gi.length&&vn.push(...gi)}}let Nt=vn.filter(hr=>!hr.destroyed);Nt.length?CZ(this,jt,Nt):this.processLeaveNode(jt)}return Ke.length=0,Ui.forEach(wt=>{this.players.push(wt),wt.onDone(()=>{wt.destroy();let jt=this.players.indexOf(wt);this.players.splice(jt,1)}),wt.play()}),Ui}afterFlush(n){this._flushFns.push(n)}afterFlushAnimationsDone(n){this._whenQuietFns.push(n)}_getPreviousPlayers(n,l,c,f,r){let w=[];if(l){let I=this.playersByQueriedElement.get(n);I&&(w=I)}else{let I=this.playersByElement.get(n);if(I){let A=!r||r==q_;I.forEach(L=>{L.queued||!A&&L.triggerName!=f||w.push(L)})}}return(c||f)&&(w=w.filter(I=>!(c&&c!=I.namespaceId||f&&f!=I.triggerName))),w}_beforeAnimationBuild(n,l,c){let f=l.triggerName,r=l.element,w=l.isRemovalTransition?void 0:n,I=l.isRemovalTransition?void 0:f;for(let A of l.timelines){let L=A.element,U=L!==r,Q=Ho(c,L,[]);this._getPreviousPlayers(L,U,w,I,l.toState).forEach(he=>{let be=he.getRealPlayer();be.beforeDestroy&&be.beforeDestroy(),he.destroy(),Q.push(he)})}rd(r,l.fromStyles)}_buildAnimation(n,l,c,f,r,w){let I=l.triggerName,A=l.element,L=[],U=new Set,Q=new Set,fe=l.timelines.map(be=>{let De=be.element;U.add(De);let Ke=De[Ws];if(Ke&&Ke.removedBeforeQueried)return new iu(be.duration,be.delay);let Fe=De!==A,tt=IZ((c.get(De)||xZ).map(nn=>nn.getRealPlayer())).filter(nn=>{let Et=nn;return Et.element?Et.element===De:!1}),ft=r.get(De),Ue=w.get(De),Vt=v3(this._normalizer,be.keyframes,ft,Ue),Jt=this._buildPlayer(be,Vt,tt);if(be.subTimeline&&f&&Q.add(De),Fe){let nn=new X_(n,I,De);nn.setRealPlayer(Jt),L.push(nn)}return Jt});L.forEach(be=>{Ho(this.playersByQueriedElement,be.element,[]).push(be),be.onDone(()=>wZ(this.playersByQueriedElement,be.element,be))}),U.forEach(be=>fs(be,l3));let he=ru(fe);return he.onDestroy(()=>{U.forEach(be=>Sp(be,l3)),ka(A,l.toStyles)}),Q.forEach(be=>{Ho(f,be,[]).push(he)}),he}_buildPlayer(n,l,c){return l.length>0?this.driver.animate(n.element,l,n.duration,n.delay,n.easing,c):new iu(n.duration,n.delay)}},X_=class{constructor(n,l,c){this.namespaceId=n,this.triggerName=l,this.element=c,this._player=new iu,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(n){this._containsRealPlayer||(this._player=n,this._queuedCallbacks.forEach((l,c)=>{l.forEach(f=>GD(n,c,void 0,f))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(n.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(n){this.totalTime=n}syncPlayerEvents(n){let l=this._player;l.triggerCallback&&n.onStart(()=>l.triggerCallback("start")),n.onDone(()=>this.finish()),n.onDestroy(()=>this.destroy())}_queueEvent(n,l){Ho(this._queuedCallbacks,n,[]).push(l)}onDone(n){this.queued&&this._queueEvent("done",n),this._player.onDone(n)}onStart(n){this.queued&&this._queueEvent("start",n),this._player.onStart(n)}onDestroy(n){this.queued&&this._queueEvent("destroy",n),this._player.onDestroy(n)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(n){this.queued||this._player.setPosition(n)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(n){let l=this._player;l.triggerCallback&&l.triggerCallback(n)}};function wZ(o,n,l){let c=o.get(n);if(c){if(c.length){let f=c.indexOf(l);c.splice(f,1)}c.length==0&&o.delete(n)}return c}function EZ(o){return o??null}function qb(o){return o&&o.nodeType===1}function TZ(o){return o=="start"||o=="done"}function m3(o,n){let l=o.style.display;return o.style.display=n??"none",l}function g3(o,n,l,c,f){let r=[];l.forEach(A=>r.push(m3(A)));let w=[];c.forEach((A,L)=>{let U=new Map;A.forEach(Q=>{let fe=n.computeStyle(L,Q,f);U.set(Q,fe),(!fe||fe.length==0)&&(L[Ws]=bZ,w.push(L))}),o.set(L,U)});let I=0;return l.forEach(A=>m3(A,r[I++])),w}function _3(o,n){let l=new Map;if(o.forEach(I=>l.set(I,[])),n.length==0)return l;let c=1,f=new Set(n),r=new Map;function w(I){if(!I)return c;let A=r.get(I);if(A)return A;let L=I.parentNode;return l.has(L)?A=L:f.has(L)?A=c:A=w(L),r.set(I,A),A}return n.forEach(I=>{let A=w(I);A!==c&&l.get(A).push(I)}),l}function fs(o,n){o.classList?.add(n)}function Sp(o,n){o.classList?.remove(n)}function CZ(o,n,l){ru(l).onDone(()=>o.processLeaveNode(n))}function IZ(o){let n=[];return A3(o,n),n}function A3(o,n){for(let l=0;l<o.length;l++){let c=o[l];c instanceof G_?A3(c.players,n):n.push(c)}}function DZ(o,n){let l=Object.keys(o),c=Object.keys(n);if(l.length!=c.length)return!1;for(let f=0;f<l.length;f++){let r=l[f];if(!n.hasOwnProperty(r)||o[r]!==n[r])return!1}return!0}function y3(o,n,l){let c=l.get(o);if(!c)return!1;let f=n.get(o);return f?c.forEach(r=>f.add(r)):n.set(o,c),l.delete(o),!0}var Ap=class{constructor(n,l,c){this._driver=l,this._normalizer=c,this._triggerCache={},this.onRemovalComplete=(f,r)=>{},this._transitionEngine=new jD(n.body,l,c),this._timelineEngine=new BD(n.body,l,c),this._transitionEngine.onRemovalComplete=(f,r)=>this.onRemovalComplete(f,r)}registerTrigger(n,l,c,f,r){let w=n+"-"+f,I=this._triggerCache[w];if(!I){let A=[],L=[],U=I3(this._driver,r,A,L);if(A.length)throw D7(f,A);L.length&&void 0,I=fZ(f,U,this._normalizer),this._triggerCache[w]=I}this._transitionEngine.registerTrigger(l,f,I)}register(n,l){this._transitionEngine.register(n,l)}destroy(n,l){this._transitionEngine.destroy(n,l)}onInsert(n,l,c,f){this._transitionEngine.insertNode(n,l,c,f)}onRemove(n,l,c){this._transitionEngine.removeNode(n,l,c)}disableAnimations(n,l){this._transitionEngine.markElementAsDisabled(n,l)}process(n,l,c,f){if(c.charAt(0)=="@"){let[r,w]=s3(c),I=f;this._timelineEngine.command(r,l,w,I)}else this._transitionEngine.trigger(n,l,c,f)}listen(n,l,c,f,r){if(c.charAt(0)=="@"){let[w,I]=s3(c);return this._timelineEngine.listen(w,l,I,r)}return this._transitionEngine.listen(n,l,c,f,r)}flush(n=-1){this._transitionEngine.flush(n)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(n){this._transitionEngine.afterFlushAnimationsDone(n)}};function SZ(o,n){let l=null,c=null;return Array.isArray(n)&&n.length?(l=DD(n[0]),n.length>1&&(c=DD(n[n.length-1]))):n instanceof Map&&(l=DD(n)),l||c?new UD(o,l,c):null}var Mp=class Mp{constructor(n,l,c){this._element=n,this._startStyles=l,this._endStyles=c,this._state=0;let f=Mp.initialStylesByElement.get(n);f||Mp.initialStylesByElement.set(n,f=new Map),this._initialStyles=f}start(){this._state<1&&(this._startStyles&&ka(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ka(this._element,this._initialStyles),this._endStyles&&(ka(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Mp.initialStylesByElement.delete(this._element),this._startStyles&&(rd(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(rd(this._element,this._endStyles),this._endStyles=null),ka(this._element,this._initialStyles),this._state=3)}};Mp.initialStylesByElement=new WeakMap;var UD=Mp;function DD(o){let n=null;return o.forEach((l,c)=>{MZ(c)&&(n=n||new Map,n.set(c,l))}),n}function MZ(o){return o==="display"||o==="position"}var t1=class{constructor(n,l,c,f){this.element=n,this.keyframes=l,this.options=c,this._specialStyles=f,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=c.duration,this._delay=c.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let n=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,n,this.options),this._finalKeyframe=n.length?n[n.length-1]:new Map;let l=()=>this._onFinish();this.domPlayer.addEventListener("finish",l),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",l)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(n){let l=[];return n.forEach(c=>{l.push(Object.fromEntries(c))}),l}_triggerWebAnimation(n,l,c){return n.animate(this._convertKeyframesToObject(l),c)}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(n=>n()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}setPosition(n){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=n*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let n=new Map;this.hasStarted()&&this._finalKeyframe.forEach((c,f)=>{f!=="offset"&&n.set(f,this._finished?c:YD(this.element,f))}),this.currentSnapshot=n}triggerCallback(n){let l=n==="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},n1=class{validateStyleProperty(n){return!0}validateAnimatableStyleProperty(n){return!0}containsElement(n,l){return x3(n,l)}getParentElement(n){return qD(n)}query(n,l,c){return b3(n,l,c)}computeStyle(n,l,c){return YD(n,l)}animate(n,l,c,f,r,w=[]){let I=f==0?"both":"forwards",A={duration:c,delay:f,fill:I};r&&(A.easing=r);let L=new Map,U=w.filter(he=>he instanceof t1);Y7(c,f)&&U.forEach(he=>{he.currentSnapshot.forEach((be,De)=>L.set(De,be))});let Q=q7(l).map(he=>new Map(he));Q=X7(n,Q,L);let fe=SZ(n,Q);return new t1(n,Q,A,fe)}};var Wb="@",P3="@.disabled",i1=class{constructor(n,l,c,f){this.namespaceId=n,this.delegate=l,this.engine=c,this._onDestroy=f,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(n){this.delegate.destroyNode?.(n)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(n,l){return this.delegate.createElement(n,l)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}appendChild(n,l){this.delegate.appendChild(n,l),this.engine.onInsert(this.namespaceId,l,n,!1)}insertBefore(n,l,c,f=!0){this.delegate.insertBefore(n,l,c),this.engine.onInsert(this.namespaceId,l,n,f)}removeChild(n,l,c){this.engine.onRemove(this.namespaceId,l,this.delegate)}selectRootElement(n,l){return this.delegate.selectRootElement(n,l)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,l,c,f){this.delegate.setAttribute(n,l,c,f)}removeAttribute(n,l,c){this.delegate.removeAttribute(n,l,c)}addClass(n,l){this.delegate.addClass(n,l)}removeClass(n,l){this.delegate.removeClass(n,l)}setStyle(n,l,c,f){this.delegate.setStyle(n,l,c,f)}removeStyle(n,l,c){this.delegate.removeStyle(n,l,c)}setProperty(n,l,c){l.charAt(0)==Wb&&l==P3?this.disableAnimations(n,!!c):this.delegate.setProperty(n,l,c)}setValue(n,l){this.delegate.setValue(n,l)}listen(n,l,c){return this.delegate.listen(n,l,c)}disableAnimations(n,l){this.engine.disableAnimations(n,l)}},$D=class extends i1{constructor(n,l,c,f,r){super(l,c,f,r),this.factory=n,this.namespaceId=l}setProperty(n,l,c){l.charAt(0)==Wb?l.charAt(1)=="."&&l==P3?(c=c===void 0?!0:!!c,this.disableAnimations(n,c)):this.engine.process(this.namespaceId,n,l.slice(1),c):this.delegate.setProperty(n,l,c)}listen(n,l,c){if(l.charAt(0)==Wb){let f=AZ(n),r=l.slice(1),w="";return r.charAt(0)!=Wb&&([r,w]=PZ(r)),this.engine.listen(this.namespaceId,f,r,w,I=>{let A=I._data||-1;this.factory.scheduleListenerCallback(A,c,I)})}return this.delegate.listen(n,l,c)}};function AZ(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}function PZ(o){let n=o.indexOf("."),l=o.substring(0,n),c=o.slice(n+1);return[l,c]}var r1=class{constructor(n,l,c){this.delegate=n,this.engine=l,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,l.onRemovalComplete=(f,r)=>{let w=r?.parentNode(f);w&&r.removeChild(w,f)}}createRenderer(n,l){let c="",f=this.delegate.createRenderer(n,l);if(!n||!l?.data?.animation){let L=this._rendererCache,U=L.get(f);if(!U){let Q=()=>L.delete(f);U=new i1(c,f,this.engine,Q),L.set(f,U)}return U}let r=l.id,w=l.id+"-"+this._currentId;this._currentId++,this.engine.register(w,n);let I=L=>{Array.isArray(L)?L.forEach(I):this.engine.registerTrigger(r,w,n,L.name,L)};return l.data.animation.forEach(I),new $D(this,w,f,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,l,c){if(n>=0&&n<this._microtaskId){this._zone.run(()=>l(c));return}let f=this._animationCallbacksBuffer;f.length==0&&queueMicrotask(()=>{this._zone.run(()=>{f.forEach(r=>{let[w,I]=r;w(I)}),this._animationCallbacksBuffer=[]})}),f.push([l,c])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var kZ=(()=>{let n=class n extends Ap{constructor(c,f,r){super(c,f,r,bt(Wf,{optional:!0}))}ngOnDestroy(){this.flush()}};n.\u0275fac=function(f){return new(f||n)(Ut(Pi),Ut(od),Ut(sd))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function OZ(){return new Xb}function LZ(o,n,l){return new r1(o,n,l)}var R3=[{provide:sd,useFactory:OZ},{provide:Ap,useClass:kZ},{provide:Ih,useFactory:LZ,deps:[Gx,Ap,fi]}],FZ=[{provide:od,useFactory:()=>new n1},{provide:dx,useValue:"BrowserAnimations"},...R3],Nde=[{provide:od,useClass:WD},{provide:dx,useValue:"NoopAnimations"},...R3];function k3(){return tp("NgEagerAnimations"),[...FZ]}var O3={providers:[SL(JN,AL(),PL()),e3(),k3(),tI()]};var zZ={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},ife=hi(gt({},zZ),{"[class.ng-submitted]":"isSubmitted"});var BZ=new an("CallSetDisabledState",{providedIn:"root",factory:()=>L3}),L3="always";var VZ=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=ur({type:n}),n.\u0275inj=cr({});let o=n;return o})();var F3=(()=>{let n=class n{static withConfig(c){return{ngModule:n,providers:[{provide:BZ,useValue:c.callSetDisabledState??L3}]}}};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=ur({type:n}),n.\u0275inj=cr({imports:[VZ]});let o=n;return o})();function N3(o){return typeof o=="string"}function z3(o){return typeof o=="number"&&Number(o)==o}function s1(o,n=0,l="0"){return typeof o!="string"&&(o=o.toString()),n>o.length?Array(n-o.length+1).join(l)+o:o}function QD(o){let n,l,c,f=o.h,r=o.s,w=o.l;if(r==0)n=l=c=w;else{let I=function(Q,fe,he){return he<0&&(he+=1),he>1&&(he-=1),he<.16666666666666666?Q+(fe-Q)*6*he:he<.5?fe:he<.6666666666666666?Q+(fe-Q)*(.6666666666666666-he)*6:Q},A=w<.5?w*(1+r):w+r-w*r,L=2*w-A;n=I(L,A,f+1/3),l=I(L,A,f),c=I(L,A,f-1/3)}return{r:Math.round(n*255),g:Math.round(l*255),b:Math.round(c*255)}}function JD(o){let n=o.r/255,l=o.g/255,c=o.b/255,f=Math.max(n,l,c),r=Math.min(n,l,c),w=0,I=0,A=(f+r)/2;if(f===r)w=I=0;else{let L=f-r;switch(I=A>.5?L/(2-f-r):L/(f+r),f){case n:w=(l-c)/L+(l<c?6:0);break;case l:w=(c-n)/L+2;break;case c:w=(n-l)/L+4;break}w/=6}return{h:w,s:I,l:A}}function V3(o,n){return o&&{r:Math.max(0,Math.min(255,o.r+o1(o.r,n))),g:Math.max(0,Math.min(255,o.g+o1(o.g,n))),b:Math.max(0,Math.min(255,o.b+o1(o.b,n))),a:o.a}}function o1(o,n){let l=n>0?255-o:o;return Math.round(l*n)}function j3(o,n){if(o){let l=Math.min(Math.max(o.r,o.g,o.b),230),c=o1(l,n);return{r:Math.max(0,Math.min(255,Math.round(o.r+c))),g:Math.max(0,Math.min(255,Math.round(o.g+c))),b:Math.max(0,Math.min(255,Math.round(o.b+c))),a:o.a}}else return o}function B3(o){return(o.r*299+o.g*587+o.b*114)/1e3>=128}function U3(o,n){if(o===void 0||n==1)return o;let l=JD(o);return l.s=n,QD(l)}function $3(o,n={r:255,g:255,b:255},l={r:255,g:255,b:255}){let c=n,f=l;return B3(l)&&(c=l,f=n),B3(o)?f:c}function G3(o){return o[0]==="#"&&(o=o.substr(1)),o.length==3&&(o=o[0].repeat(2)+o[1].repeat(2)+o[2].repeat(2)),parseInt(o,16)}function GZ(o){o=o.replace(/[ ]/g,"");let n=o.match(/^rgb\(([0-9]*),([0-9]*),([0-9]*)\)/i);if(n)n.push("1");else if(n=o.match(/^rgba\(([0-9]*),([0-9]*),([0-9]*),([.0-9]*)\)/i),!n)return 0;let l="";for(let c=1;c<=3;c++){let f=parseInt(n[c]).toString(16);f.length==1&&(f="0"+f),l+=f}return G3(l)}function Pp(o){return K_.fromAny(o)}var K_=class o{constructor(n){Object.defineProperty(this,"_hex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hex=n|0}get hex(){return this._hex}get r(){return this._hex>>>16}get g(){return this._hex>>8&255}get b(){return this._hex&255}toCSS(n=1){return"rgba("+this.r+", "+this.g+", "+this.b+", "+n+")"}toCSSHex(){return"#"+s1(this.r.toString(16),2)+s1(this.g.toString(16),2)+s1(this.b.toString(16),2)}toHSL(n=1){return JD({r:this.r,g:this.g,b:this.b,a:n})}static fromHSL(n,l,c){let f=QD({h:n,s:l,l:c});return this.fromRGB(f.r,f.g,f.b)}toString(){return this.toCSSHex()}static fromHex(n){return new o(n)}static fromRGB(n,l,c){return new o((c|0)+(l<<8)+(n<<16))}static fromString(n){return new o(G3(n))}static fromCSS(n){return new o(GZ(n))}static fromAny(n){if(N3(n)){if(n[0]=="#")return o.fromString(n);if(n.substr(0,3)=="rgb")return o.fromCSS(n)}else{if(z3(n))return o.fromHex(n);if(n instanceof o)return o.fromHex(n.hex)}throw new Error("Unknown color syntax: "+n)}static alternative(n,l,c){let f=$3({r:n.r,g:n.g,b:n.b},l?{r:l.r,g:l.g,b:l.b}:void 0,c?{r:c.r,g:c.g,b:c.b}:void 0);return this.fromRGB(f.r,f.g,f.b)}static interpolate(n,l,c,f="rgb"){if(f=="hsl"){let r=l.toHSL(),w=c.toHSL();return o.fromHSL(ad(n,r.h,w.h),ad(n,r.s,w.s),ad(n,r.l,w.l))}else return o.fromRGB(ad(n,l.r,c.r),ad(n,l.g,c.g),ad(n,l.b,c.b))}static lighten(n,l){let c=V3({r:n.r,g:n.g,b:n.b},l);return o.fromRGB(c.r,c.g,c.b)}static brighten(n,l){let c=j3({r:n.r,g:n.g,b:n.b},l);return o.fromRGB(c.r,c.g,c.b)}static saturate(n,l){let c=U3({r:n.r,g:n.g,b:n.b},l);return o.fromRGB(c.r,c.g,c.b)}};function ad(o,n,l){return n+o*(l-n)}var Efe=[{name:"Root",children:[{name:"Sed et nulla a enim tincidunt gravida",shortName:"Gravida",color:Pp(8824281),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:80},{name:"Third",value:100},{name:"New",value:50,action:"add",color:Pp(13688048),radius:35}]},{name:"Fusce ut nisi eu nibh laoreet scelerisque",shortName:"Fusce ut nisi",color:Pp(8285892),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:25},{name:"Third",value:100},{name:"New",value:50,action:"add",color:Pp(14210285),radius:35}]}]}];var H3=bE(Vb());var q3=bE(Vb());var W3=t3("slideInAnimation",[r3("* <=> *",[jb(":enter, :leave",Tl({position:"fixed",width:"100%",zIndex:2}),{optional:!0}),n3([jb(":enter",[Tl({transform:"translateX(100%)"}),bD("0.5s ease-out",Tl({transform:"translateX(0%)"}))],{optional:!0}),jb(":leave",[Tl({transform:"translateX(0%)"}),bD("0.5s ease-out",Tl({transform:"translateX(-100%)"}))],{optional:!0})])])]);var eS;try{eS=typeof Intl<"u"&&Intl.v8BreakIterator}catch{eS=!1}var J_=(()=>{let n=class n{constructor(c){this._platformId=c,this.isBrowser=this._platformId?IO(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||eS)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};n.\u0275fac=function(f){return new(f||n)(Ut(Gs))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Q_;function WZ(){if(Q_==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Q_=!0}))}finally{Q_=Q_||!1}return Q_}function tS(o){return WZ()?o:!!o.capture}function Z3(o){return o.composedPath?o.composedPath()[0]:o.target}function Y3(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function nS(o){return Array.isArray(o)?o:[o]}function iS(o){return o instanceof Vr?o.nativeElement:o}var K3=new Set,ld,ZZ=(()=>{let n=class n{constructor(c,f){this._platform=c,this._nonce=f,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):XZ}matchMedia(c){return(this._platform.WEBKIT||this._platform.BLINK)&&YZ(c,this._nonce),this._matchMedia(c)}};n.\u0275fac=function(f){return new(f||n)(Ut(J_),Ut(qg,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function YZ(o,n){if(!K3.has(o))try{ld||(ld=document.createElement("style"),n&&ld.setAttribute("nonce",n),ld.setAttribute("type","text/css"),document.head.appendChild(ld)),ld.sheet&&(ld.sheet.insertRule(`@media ${o} {body{ }}`,0),K3.add(o))}catch(l){console.error(l)}}function XZ(o){return{matches:o==="all"||o==="",media:o,addListener:()=>{},removeListener:()=>{}}}var J3=(()=>{let n=class n{constructor(c,f){this._mediaMatcher=c,this._zone=f,this._queries=new Map,this._destroySubject=new br}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(c){return Q3(nS(c)).some(r=>this._registerQuery(r).mql.matches)}observe(c){let r=Q3(nS(c)).map(I=>this._registerQuery(I).observable),w=_h(r);return w=Oc(w.pipe(Ls(1)),w.pipe(GE(1),zE(0))),w.pipe(Sn(I=>{let A={matches:!1,breakpoints:{}};return I.forEach(({matches:L,query:U})=>{A.matches=A.matches||L,A.breakpoints[U]=L}),A}))}_registerQuery(c){if(this._queries.has(c))return this._queries.get(c);let f=this._mediaMatcher.matchMedia(c),w={observable:new ri(I=>{let A=L=>this._zone.run(()=>I.next(L));return f.addListener(A),()=>{f.removeListener(A)}}).pipe(Dg(f),Sn(({matches:I})=>({query:c,matches:I})),Sg(this._destroySubject)),mql:f};return this._queries.set(c,w),w}};n.\u0275fac=function(f){return new(f||n)(Ut(ZZ),Ut(fi))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function Q3(o){return o.map(n=>n.split(",")).reduce((n,l)=>n.concat(l)).map(n=>n.trim())}function nz(o){return o.buttons===0||o.detail===0}function iz(o){let n=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0];return!!n&&n.identifier===-1&&(n.radiusX==null||n.radiusX===1)&&(n.radiusY==null||n.radiusY===1)}var cd=function(o){return o[o.NONE=0]="NONE",o[o.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",o[o.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",o}(cd||{}),ez="cdk-high-contrast-black-on-white",tz="cdk-high-contrast-white-on-black",rS="cdk-high-contrast-active",rz=(()=>{let n=class n{constructor(c,f){this._platform=c,this._document=f,this._breakpointSubscription=bt(J3).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return cd.NONE;let c=this._document.createElement("div");c.style.backgroundColor="rgb(1,2,3)",c.style.position="absolute",this._document.body.appendChild(c);let f=this._document.defaultView||window,r=f&&f.getComputedStyle?f.getComputedStyle(c):null,w=(r&&r.backgroundColor||"").replace(/ /g,"");switch(c.remove(),w){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return cd.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return cd.BLACK_ON_WHITE}return cd.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let c=this._document.body.classList;c.remove(rS,ez,tz),this._hasCheckedHighContrastMode=!0;let f=this.getHighContrastMode();f===cd.BLACK_ON_WHITE?c.add(rS,ez):f===cd.WHITE_ON_BLACK&&c.add(rS,tz)}}};n.\u0275fac=function(f){return new(f||n)(Ut(J_),Ut(Pi))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var oS=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=ur({type:n}),n.\u0275inj=cr({});let o=n;return o})();function eY(){return!0}var tY=new an("mat-sanity-checks",{providedIn:"root",factory:eY}),lS=(()=>{let n=class n{constructor(c,f,r){this._sanityChecks=f,this._document=r,this._hasDoneGlobalChecks=!1,c._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(c){return Y3()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[c]}};n.\u0275fac=function(f){return new(f||n)(Ut(rz),Ut(tY,8),Ut(Pi))},n.\u0275mod=ur({type:n}),n.\u0275inj=cr({imports:[oS,oS]});let o=n;return o})();var ps=function(o){return o[o.FADING_IN=0]="FADING_IN",o[o.VISIBLE=1]="VISIBLE",o[o.FADING_OUT=2]="FADING_OUT",o[o.HIDDEN=3]="HIDDEN",o}(ps||{}),sS=class{constructor(n,l,c,f=!1){this._renderer=n,this.element=l,this.config=c,this._animationForciblyDisabledThroughCss=f,this.state=ps.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},oz=tS({passive:!0,capture:!0}),aS=class{constructor(){this._events=new Map,this._delegateEventHandler=n=>{let l=Z3(n);l&&this._events.get(n.type)?.forEach((c,f)=>{(f===l||f.contains(l))&&c.forEach(r=>r.handleEvent(n))})}}addHandler(n,l,c,f){let r=this._events.get(l);if(r){let w=r.get(c);w?w.add(f):r.set(c,new Set([f]))}else this._events.set(l,new Map([[c,new Set([f])]])),n.runOutsideAngular(()=>{document.addEventListener(l,this._delegateEventHandler,oz)})}removeHandler(n,l,c){let f=this._events.get(n);if(!f)return;let r=f.get(l);r&&(r.delete(c),r.size===0&&f.delete(l),f.size===0&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,oz)))}},sz={enterDuration:225,exitDuration:150},nY=800,az=tS({passive:!0,capture:!0}),lz=["mousedown","touchstart"],cz=["mouseup","mouseleave","touchend","touchcancel"],ey=class ey{constructor(n,l,c,f){this._target=n,this._ngZone=l,this._platform=f,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,f.isBrowser&&(this._containerElement=iS(c))}fadeInRipple(n,l,c={}){let f=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),r=gt(gt({},sz),c.animation);c.centered&&(n=f.left+f.width/2,l=f.top+f.height/2);let w=c.radius||iY(n,l,f),I=n-f.left,A=l-f.top,L=r.enterDuration,U=document.createElement("div");U.classList.add("mat-ripple-element"),U.style.left=`${I-w}px`,U.style.top=`${A-w}px`,U.style.height=`${w*2}px`,U.style.width=`${w*2}px`,c.color!=null&&(U.style.backgroundColor=c.color),U.style.transitionDuration=`${L}ms`,this._containerElement.appendChild(U);let Q=window.getComputedStyle(U),fe=Q.transitionProperty,he=Q.transitionDuration,be=fe==="none"||he==="0s"||he==="0s, 0s"||f.width===0&&f.height===0,De=new sS(this,U,c,be);U.style.transform="scale3d(1, 1, 1)",De.state=ps.FADING_IN,c.persistent||(this._mostRecentTransientRipple=De);let Ke=null;return!be&&(L||r.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Fe=()=>{Ke&&(Ke.fallbackTimer=null),clearTimeout(ft),this._finishRippleTransition(De)},tt=()=>this._destroyRipple(De),ft=setTimeout(tt,L+100);U.addEventListener("transitionend",Fe),U.addEventListener("transitioncancel",tt),Ke={onTransitionEnd:Fe,onTransitionCancel:tt,fallbackTimer:ft}}),this._activeRipples.set(De,Ke),(be||!L)&&this._finishRippleTransition(De),De}fadeOutRipple(n){if(n.state===ps.FADING_OUT||n.state===ps.HIDDEN)return;let l=n.element,c=gt(gt({},sz),n.config.animation);l.style.transitionDuration=`${c.exitDuration}ms`,l.style.opacity="0",n.state=ps.FADING_OUT,(n._animationForciblyDisabledThroughCss||!c.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){let l=iS(n);!this._platform.isBrowser||!l||l===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=l,lz.forEach(c=>{ey._eventManager.addHandler(this._ngZone,c,l,this)}))}handleEvent(n){n.type==="mousedown"?this._onMousedown(n):n.type==="touchstart"?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{cz.forEach(l=>{this._triggerElement.addEventListener(l,this,az)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===ps.FADING_IN?this._startFadeOutTransition(n):n.state===ps.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){let l=n===this._mostRecentTransientRipple,{persistent:c}=n.config;n.state=ps.VISIBLE,!c&&(!l||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){let l=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=ps.HIDDEN,l!==null&&(n.element.removeEventListener("transitionend",l.onTransitionEnd),n.element.removeEventListener("transitioncancel",l.onTransitionCancel),l.fallbackTimer!==null&&clearTimeout(l.fallbackTimer)),n.element.remove()}_onMousedown(n){let l=nz(n),c=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+nY;!this._target.rippleDisabled&&!l&&!c&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!iz(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let l=n.changedTouches;if(l)for(let c=0;c<l.length;c++)this.fadeInRipple(l[c].clientX,l[c].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{let l=n.state===ps.VISIBLE||n.config.terminateOnPointerUp&&n.state===ps.FADING_IN;!n.config.persistent&&l&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let n=this._triggerElement;n&&(lz.forEach(l=>ey._eventManager.removeHandler(l,n,this)),this._pointerUpEventsRegistered&&(cz.forEach(l=>n.removeEventListener(l,this,az)),this._pointerUpEventsRegistered=!1))}};ey._eventManager=new aS;var uz=ey;function iY(o,n,l){let c=Math.max(Math.abs(o-l.left),Math.abs(o-l.right)),f=Math.max(Math.abs(n-l.top),Math.abs(n-l.bottom));return Math.sqrt(c*c+f*f)}var hz=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=ur({type:n}),n.\u0275inj=cr({imports:[lS,lS]});let o=n;return o})();var rY=["*"];function oY(o,n){o&1&&(Ft(0,"div",1),Bh(1),kt())}var a1=(()=>{let n=class n{constructor(){this.tabTitle="",this.active=!1}ngOnInit(){}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=pi({type:n,selectors:[["app-tab"]],inputs:{tabTitle:"tabTitle",active:"active"},standalone:!0,features:[mi],ngContentSelectors:rY,decls:1,vars:1,consts:[["style","width: 100%; box-sizing: border-box; display: flex; align-content: center; flex-direction: column",4,"ngIf"],[2,"width","100%","box-sizing","border-box","display","flex","align-content","center","flex-direction","column"]],template:function(f,r){f&1&&(zh(),jr(0,oY,2,0,"div",0)),f&2&&Ai("ngIf",r.active)},dependencies:[qi,cp],encapsulation:2});let o=n;return o})();var sY=["*"];function aY(o,n){if(o&1){let l=Nh();Ft(0,"li",2),bi("click",function(){let f=Ah(l).$implicit,r=Hs();return Ph(r.selectTab(f))}),Vn(1),kt()}if(o&2){let l=n.$implicit;np("active",l.active),Bn(),Pr(" ",l.tabTitle," ")}}var dz=(()=>{let n=class n{constructor(){}ngAfterContentInit(){this.tabs.filter(f=>f.active).length===0&&this.selectTab(this.tabs.first)}selectTab(c){this.tabs.toArray().forEach(f=>f.active=!1),c.active=!0}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=pi({type:n,selectors:[["app-tabs"]],contentQueries:function(f,r,w){if(f&1&&bx(w,a1,4),f&2){let I;Zg(I=Yg())&&(r.tabs=I)}},standalone:!0,features:[mi],ngContentSelectors:sY,decls:3,vars:1,consts:[[1,"tabs"],[3,"active","click",4,"ngFor","ngForOf"],[3,"click"]],template:function(f,r){f&1&&(zh(),Ft(0,"ul",0),jr(1,aY,2,3,"li",1),kt(),Bh(2)),f&2&&(Bn(),Ai("ngForOf",r.tabs))},dependencies:[qi,qc],styles:[".tabs[_ngcontent-%COMP%]{list-style-type:none;padding:0;display:flex;cursor:pointer;justify-content:center;align-items:center}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{height:30px;width:40%;display:flex;align-items:center;justify-content:center;padding:5px 10px;border:1px solid #ccc}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(1){border-radius:10px 0 0 10px;border-right:none}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(2){border-radius:0 10px 10px 0;border-left:none}.tabs[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background-clip:content-box;background-color:#c7e1ff;background-size:75%;transition:all .5s}"]});let o=n;return o})();function lY(o,n){if(o&1){let l=Nh();Ft(0,"div",6),bi("click",function(){let f=Ah(l).$implicit,r=Hs();return Ph(r.setValue(f))}),Vn(1),kt()}if(o&2){let l=n.$implicit,c=Hs();Vh("id","item-",c.index,""),Bn(),Pr(" ",l," ")}}var fz=(()=>{let n=class n{constructor(c){this.document=c,this.isDropdownOpened=!1,this.index=0,this.data=["deratex","Sherlock Holmes","Lewis Hamiltion","Yousuf Dikec","Whoever can do this"],this.currentValue="Default Person"}toggleDropdown(c){this.isDropdownOpened=!this.isDropdownOpened;let f=this.document.getElementById(`arrow-dropdown-${this.index}`),r=this.document.getElementById(`dropdown-container-${this.index}`),w=this.document.getElementById(`content-${this.index}`);this.isDropdownOpened?this.openDropdown(f,r,w):this.closeDropdown(f,r,w)}openDropdown(c,f,r){c.style.transform="rotate(270deg)",f.style.transitionDelay="0s",f.style.borderRadius="20px 20px 0px 0px",r.style.height="200px"}closeDropdown(c,f,r){c.style.transform="rotate(90deg)",f.style.transitionDelay="0.4s",f.style.borderRadius="20px",r.style.height="0px"}setValue(c){let f=this.document.getElementById(`arrow-dropdown-${this.index}`),r=this.document.getElementById(`dropdown-container-${this.index}`),w=this.document.getElementById(`content-${this.index}`);this.currentValue=c,this.closeDropdown(f,r,w)}};n.\u0275fac=function(f){return new(f||n)(Qn(Pi))},n.\u0275cmp=pi({type:n,selectors:[["app-dropdown"]],inputs:{index:"index"},standalone:!0,features:[mi],decls:8,vars:8,consts:[[1,"container"],[1,"dropdown",3,"click","id"],[1,"icon"],["src","../../../assets/arrow-close.svg",1,"arrow",3,"id"],[1,"content-container",3,"id"],["class","dropdown-content",3,"id","click",4,"ngFor","ngForOf"],[1,"dropdown-content",3,"click","id"]],template:function(f,r){f&1&&(Ft(0,"div",0)(1,"div",1),bi("click",function(I){return r.toggleDropdown(I)}),Wn(2,"div",2),Ft(3,"p"),Vn(4),kt(),Wn(5,"img",3),kt(),Ft(6,"div",4),jr(7,lY,2,3,"div",5),kt()()),f&2&&(Bn(),Vh("id","dropdown-container-",r.index,""),Bn(3),Pr(" ",r.currentValue,""),Bn(),Vh("id","arrow-dropdown-",r.index,""),Bn(),Vh("id","content-",r.index,""),Bn(),Ai("ngForOf",r.data))},dependencies:[qi,qc],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.dropdown[_ngcontent-%COMP%]{cursor:pointer;background-color:#fff;padding:15px;height:50px;display:flex;align-items:center;margin-left:10px;border-radius:20px;transition:border-radius .5s}.dropdown[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:#888;border-radius:50%;width:30px;height:30px;margin-right:10px}.dropdown[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{transform:rotate(90deg);transition:all .5s}.dropdown[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:last-child{margin-left:auto}.content-container[_ngcontent-%COMP%]{z-index:999;max-height:200px;height:0px;overflow:auto;transition:all .5s}.dropdown-content[_ngcontent-%COMP%]{margin-left:10px;z-index:999;cursor:pointer;background-color:#fff;padding:15px;max-height:200px;border:1px lightgray solid;border-bottom:none}.dropdown-content[_ngcontent-%COMP%]:first-child{border-top:none}.dropdown-content[_ngcontent-%COMP%]:last-child{border-bottom:1px lightgray solid}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;margin-left:-10px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:#5484d1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#2651a0;cursor:grab}"]});let o=n;return o})();function cY(o,n){o&1&&BC(0)}function uY(o,n){if(o&1&&(vx(0),Ft(1,"div",11)(2,"div",12)(3,"p")(4,"b"),Vn(5),kt()(),Ft(6,"p"),Vn(7,"12:04"),kt()(),Ft(8,"p",13),Vn(9),kt(),Ft(10,"p",14),Vn(11),kt(),Wn(12,"app-dropdown",15),kt(),xx()),o&2){let l=n.$implicit,c=n.index;Bn(5),Pr("",l,"-001"),Bn(4),Pr("",l,"/00001"),Bn(2),Ex(l),Bn(),Ai("index",c)}}function hY(o,n){if(o&1&&jr(0,uY,13,4,"ng-container",10),o&2){let l=Hs();Ai("ngForOf",l.states)}}function dY(o,n){o&1&&(Ft(0,"div",16),Vn(1," Nic tutaj nie ma "),kt())}var pz=(()=>{let n=class n{constructor(){this.states=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=pi({type:n,selectors:[["app-right-bar-over"]],standalone:!0,features:[mi],decls:16,vars:3,consts:[["activeList",""],["emptyList",""],["id","mySidenav",1,"sidenav"],[1,"title-container"],[1,"alerts"],[1,"check"],[1,"custom-tabs"],["tabTitle","Aktywne",1,"content"],[4,"ngIf","ngIfThen","ngIfElse"],["tabTitle","Oddelegowane",1,"content"],[4,"ngFor","ngForOf"],[1,"card-container"],[1,"header"],[1,"name"],[1,"localization"],[3,"index"],[1,"empty-text"]],template:function(f,r){if(f&1&&(Ft(0,"div",2)(1,"div",3)(2,"div",4),Vn(3,"Alerty"),kt(),Ft(4,"div",5),Vn(5,"Zaznacz"),kt()(),Ft(6,"div",6)(7,"app-tabs")(8,"app-tab",7),jr(9,cY,1,0,"ng-container",8),kt(),Ft(10,"app-tab",9),Vn(11," Content of Tab 2 "),kt()()()(),jr(12,hY,1,1,"ng-template",null,0,UC)(14,dY,2,0,"ng-template",null,1,UC)),f&2){let w=wx(13),I=wx(15);Bn(9),Ai("ngIf",r.states.length)("ngIfThen",w)("ngIfElse",I)}},dependencies:[qi,qc,cp,hz,dz,a1,F3,fz],styles:[".sidenav[_ngcontent-%COMP%]{text-wrap:nowrap;background-color:#fff;height:100vh;overflow:auto}.title-container[_ngcontent-%COMP%]{padding:10%;position:sticky;display:flex;flex-direction:row;justify-content:space-between}.title-container[_ngcontent-%COMP%]   .alerts[_ngcontent-%COMP%]{cursor:pointer;font-size:larger}.title-container[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]{color:#a1c1e7}.content[_ngcontent-%COMP%]{display:flex;margin-left:7%;width:86%}.content[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]{padding:10px;margin-bottom:20px;height:200px;border:1px solid #ccc;border-radius:10px}.content[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{height:30px;margin-bottom:30px;display:flex;justify-content:space-between}.content[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:is(.name, .localization)[_ngcontent-%COMP%]{margin-top:0;margin-bottom:10px;height:fit-content}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;margin-top:20vh}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:#c7e1ff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#91c1f8;cursor:grab}"]});let o=n;return o})();var mz=o=>({"background-color":o}),gz=(()=>{let n=class n{constructor(c){this.router=c}ngAfterViewInit(){this.setBackgroundColorForPath()}navigate(c){this.router.navigateByUrl(c).then(()=>this.setBackgroundColorForPath())}setBackgroundColorForPath(){this.isMapView=window.location.pathname.includes("map"),this.isBubbleView=window.location.pathname.includes("bubbles")}};n.\u0275fac=function(f){return new(f||n)(Qn(cb))},n.\u0275cmp=pi({type:n,selectors:[["app-view-control-bar"]],standalone:!0,features:[mi],decls:5,vars:6,consts:[[1,"content-container"],[1,"item-container",3,"click","ngStyle"],["src","../../../assets/menu-map.svg",1,"menu-item"],["src","../../../assets/bubble-menu-item.svg",1,"menu-item"]],template:function(f,r){f&1&&(Ft(0,"div",0)(1,"div",1),bi("click",function(){return r.navigate("/map")}),Wn(2,"img",2),kt(),Ft(3,"div",1),bi("click",function(){return r.navigate("/bubbles")}),Wn(4,"img",3),kt()()),f&2&&(Bn(),Ai("ngStyle",rp(2,mz,r.isMapView?"lightgray":"white")),Bn(2),Ai("ngStyle",rp(4,mz,r.isBubbleView?"lightgray":"white")))},dependencies:[qi,Lx],styles:[".content-container[_ngcontent-%COMP%]{position:absolute;z-index:200;bottom:32px;left:32px;display:flex;justify-content:space-evenly;align-items:center;flex-direction:column;width:48px;height:96px;background-color:#fff;border-radius:8px;border:1px lightgray solid}.content-container[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:32px;width:32px;border-radius:8px;transition:background-color .5s linear;cursor:pointer}.content-container[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]{width:24px;height:24px}"]});let o=n;return o})();var _z=(()=>{let n=class n{constructor(c){this.mapService=c}handleZoomChange(c){this.mapService.updateZoom(c)}handlePitchChange(c){this.mapService.updatePitch(c)}};n.\u0275fac=function(f){return new(f||n)(Qn(ds))},n.\u0275cmp=pi({type:n,selectors:[["app-map-control-bar"]],standalone:!0,features:[mi],decls:10,vars:0,consts:[[1,"content-wrapper"],[1,"pitch-change-container",3,"click"],["src","../../../assets/map-2d-control.svg",1,"menu-item"],[1,"content-container"],[1,"item-container",3,"click"],["src","../../../assets/map-devices-control.svg",1,"menu-item"],["src","../../../assets/map-location-control.svg",1,"menu-item"],["src","../../../assets/map-cluster-control.svg",1,"menu-item"]],template:function(f,r){f&1&&(Ft(0,"div",0)(1,"div",1),bi("click",function(){return r.handlePitchChange(0)}),Wn(2,"img",2),kt(),Ft(3,"div",3)(4,"div",4),bi("click",function(){return r.handleZoomChange(15)}),Wn(5,"img",5),kt(),Ft(6,"div",4),bi("click",function(){return r.handleZoomChange(13)}),Wn(7,"img",6),kt(),Ft(8,"div",4),bi("click",function(){return r.handleZoomChange(11)}),Wn(9,"img",7),kt()()())},styles:[".content-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:200;bottom:144px;left:32px;display:flex;justify-content:space-evenly;align-items:center;flex-direction:column}.content-wrapper[_ngcontent-%COMP%]   .pitch-change-container[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;justify-content:center;margin-bottom:16px;background-color:#fff;width:48px;height:48px;border-radius:8px;border:1px lightgray solid}.content-wrapper[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]{width:48px;display:flex;justify-content:space-evenly;align-items:center;flex-direction:column;height:144px;background-color:#fff;border-radius:8px;border:1px lightgray solid}.content-wrapper[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;justify-content:center;height:32px;width:32px}"]});let o=n;return o})();var yz=(()=>{let n=class n{constructor(c){this.mapService=c}};n.\u0275fac=function(f){return new(f||n)(Qn(ds))},n.\u0275cmp=pi({type:n,selectors:[["app-top-toolbar"]],standalone:!0,features:[mi],decls:9,vars:0,consts:[[1,"content-container"],[1,"region-container"],["src","../../../assets/regions-menu.svg"],[1,"filter-container"],["src","../../../assets/filters-menu.svg"],[1,"profile-container"],["src","../../../assets/profile-icon.svg"]],template:function(f,r){f&1&&(Ft(0,"div",0)(1,"div",1),Wn(2,"img",2),Vn(3," Regiony "),kt(),Ft(4,"div",3),Wn(5,"img",4),Vn(6," Filtry "),kt(),Ft(7,"div",5),Wn(8,"img",6),kt()())},styles:[".content-container[_ngcontent-%COMP%]{position:absolute;z-index:200;top:32px;left:32px;display:flex;justify-content:space-between;align-items:center;width:300px;height:48px}.content-container[_ngcontent-%COMP%]   .region-container[_ngcontent-%COMP%]{cursor:pointer;background-color:#fff;border:1px lightgray solid;border-radius:8px;display:flex;align-items:center;justify-content:center;height:48px;width:120px;font-family:Arial,Helvetica,sans-serif;font-weight:700}.content-container[_ngcontent-%COMP%]   .region-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-right:6px}.content-container[_ngcontent-%COMP%]   .filter-container[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;background-color:#fff;border:1px lightgray solid;border-radius:8px;justify-content:center;height:48px;width:100px;font-family:Arial,Helvetica,sans-serif;font-weight:700}.content-container[_ngcontent-%COMP%]   .filter-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-right:6px}.content-container[_ngcontent-%COMP%]   .profile-container[_ngcontent-%COMP%]{cursor:pointer;display:flex;background-color:#fff;border:1px lightgray solid;border-radius:8px;align-items:center;justify-content:center;height:48px;width:48px}"]});let o=n;return o})();var vz=(()=>{let n=class n{constructor(c,f,r){this.contexts=c,this.document=f,this.mapService=r,this.openedSidebar=!1,this.title="GraphVizualization"}toggleSideBar(c){c?this.openedSidebar=!c:this.openedSidebar=!this.openedSidebar;let f=this.document.getElementById("arrow"),r=this.document.getElementById("main");this.openedSidebar?this.openSideBar(r,f):this.closeSideBar(r,f)}openSideBar(c,f){let r=this.mapService.map.getCenter(),w=this.mapService.map.getZoom();this.setOpenStyles(window.innerWidth,c,f),f.style.transform="rotate(0deg)",this.mapService.map.easeTo({center:r,zoom:w+.3,duration:1e3,linear:!0})}closeSideBar(c,f){let r=this.mapService.map.getCenter(),w=this.mapService.map.getZoom();c.style.marginLeft="0px",c.style.width="100%",f.style.right="30px",f.style.transform="rotate(180deg)",this.mapService.map.easeTo({center:r,zoom:w-.3,duration:1e3,linear:!0})}setOpenStyles(c,f,r){c>480?(f.style.marginLeft="-20%",f.style.width="80%",r.style.right="40%"):r.style.right="70%"}};n.\u0275fac=function(f){return new(f||n)(Qn(vp),Qn(Pi),Qn(ds))},n.\u0275cmp=pi({type:n,selectors:[["app-root"]],standalone:!0,features:[mi],decls:7,vars:2,consts:[["src","../assets/arrow-close.svg","id","arrow",3,"click"],["id","rightBar",3,"ngClass"],["id","main",2,"height","100%","width","100%","overflow","hidden","position","absolute","top","0","left","0"]],template:function(f,r){f&1&&(Ft(0,"img",0),bi("click",function(){return r.toggleSideBar()}),kt(),Wn(1,"app-top-toolbar")(2,"app-map-control-bar")(3,"app-view-control-bar")(4,"app-right-bar-over",1),Ft(5,"div",2),Wn(6,"router-outlet"),kt()),f&2&&(Bn(4),Ai("ngClass",r.openedSidebar?"opened":"closed"),Bn(),Ai("@slideInAnimation",void 0))},dependencies:[qi,Ox,$I,pz,gz,_z,yz],styles:["[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}#main[_ngcontent-%COMP%]{transition:all 1s}#arrow[_ngcontent-%COMP%]{position:fixed;right:30px;top:45%;transform:rotate(180deg);transition:all 1s;z-index:150}.opened[_ngcontent-%COMP%]{position:fixed;top:0;right:0;z-index:200;height:100vh;width:40%;transition:all 1s;resize:horizontal}.closed[_ngcontent-%COMP%]{position:fixed;top:0;right:0vw;z-index:-1;height:100vh;width:0%;transition:all 1s}@media (max-width: 480px){.opened[_ngcontent-%COMP%]{position:fixed;top:0;right:0;z-index:200;height:100vh;width:70%;overflow-y:auto;transition:all 1s}}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:#5484d1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#2651a0;cursor:grab}"],data:{animation:[W3]}});let o=n;return o})();GO(vz,O3).catch(o=>console.error(o));
