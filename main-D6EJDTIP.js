var $V=Object.create;var kT=Object.defineProperty,GV=Object.defineProperties,HV=Object.getOwnPropertyDescriptor,qV=Object.getOwnPropertyDescriptors,WV=Object.getOwnPropertyNames,yv=Object.getOwnPropertySymbols,ZV=Object.getPrototypeOf,OT=Object.prototype.hasOwnProperty,uP=Object.prototype.propertyIsEnumerable;var cP=(o,n,l)=>n in o?kT(o,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[n]=l,gt=(o,n)=>{for(var l in n||={})OT.call(n,l)&&cP(o,l,n[l]);if(yv)for(var l of yv(n))uP.call(n,l)&&cP(o,l,n[l]);return o},oi=(o,n)=>GV(o,qV(n));var ls=(o,n)=>{var l={};for(var c in o)OT.call(o,c)&&n.indexOf(c)<0&&(l[c]=o[c]);if(o!=null&&yv)for(var c of yv(o))n.indexOf(c)<0&&uP.call(o,c)&&(l[c]=o[c]);return l};var YV=(o,n)=>()=>(n||o((n={exports:{}}).exports,n),n.exports);var XV=(o,n,l,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let f of WV(n))!OT.call(o,f)&&f!==l&&kT(o,f,{get:()=>n[f],enumerable:!(c=HV(n,f))||c.enumerable});return o};var LT=(o,n,l)=>(l=o!=null?$V(ZV(o)):{},XV(n||!o||!o.__esModule?kT(l,"default",{value:o,enumerable:!0}):l,o));var Mg=(o,n,l)=>new Promise((c,f)=>{var i=A=>{try{C(l.next(A))}catch(L){f(L)}},w=A=>{try{C(l.throw(A))}catch(L){f(L)}},C=A=>A.done?c(A.value):Promise.resolve(A.value).then(i,w);C((l=l.apply(o,n)).next())});var Xb=YV((BS,VS)=>{"use strict";(function(o,n){typeof BS=="object"&&typeof VS<"u"?VS.exports=n():typeof define=="function"&&define.amd?define(n):(o=typeof globalThis<"u"?globalThis:o||self,o.mapboxgl=n())})(BS,function(){"use strict";var o,n,l;function c(i,w){if(!o)o=w;else if(!n)n=w;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",A={};o(A),l=w(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}c(["exports"],function(i){var w="3.5.0";let C,A={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{C=t}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!A.API_URL)return null;try{let t=new URL(A.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function L(t){return A.API_URL_REGEX.test(t)}function U(t){return t.indexOf("mapbox:")===0}function Q(t){return A.API_CDN_URL_REGEX.test(t)}function fe(t){return A.API_SPRITE_REGEX.test(t)}function he(t){return A.API_STYLE_REGEX.test(t)&&!fe(t)}let be={create:"create",load:"load",fullLoad:"fullLoad"},Se={mark(t){performance.mark(t)},measure(t,e,r){performance.measure(t,e,r)}};function Ke(t){let e=t.name.split("?")[0];return Q(e)&&e.includes("mapbox-gl.js")?"javascript":Q(e)&&e.includes("mapbox-gl.css")?"css":function(r){return A.API_FONTS_REGEX.test(r)}(e)?"fontRange":fe(e)?"sprite":he(e)?"style":function(r){return A.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}function Fe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var tt={},ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.setMatrixArrayType=function(t){ft.ARRAY_TYPE=zt=t},ft.toRadian=function(t){return t*tn},ft.equals=function(t,e){return Math.abs(t-e)<=Ue*Math.max(1,Math.abs(t),Math.abs(e))},ft.RANDOM=ft.ARRAY_TYPE=ft.EPSILON=void 0;var Ue=1e-6;ft.EPSILON=Ue;var zt=typeof Float32Array<"u"?Float32Array:Array;ft.ARRAY_TYPE=zt;var Kt=Math.random;ft.RANDOM=Kt;var tn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Tt={};function ri(t){return ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ri(t)}Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=function(){var t=new Ct.ARRAY_TYPE(4);return Ct.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Tt.clone=function(t){var e=new Ct.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Tt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Tt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Tt.fromValues=function(t,e,r,a){var u=new Ct.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=r,u[3]=a,u},Tt.set=function(t,e,r,a,u){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t},Tt.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Tt.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=r*d-u*a;return p?(t[0]=d*(p=1/p),t[1]=-a*p,t[2]=-u*p,t[3]=r*p,t):null},Tt.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},Tt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Tt.multiply=Ci,Tt.rotate=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(r),y=Math.cos(r);return t[0]=a*y+d*_,t[1]=u*y+p*_,t[2]=a*-_+d*y,t[3]=u*-_+p*y,t},Tt.scale=function(t,e,r){var a=e[1],u=e[2],d=e[3],p=r[0],_=r[1];return t[0]=e[0]*p,t[1]=a*p,t[2]=u*_,t[3]=d*_,t},Tt.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t},Tt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Tt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Tt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Tt.LDU=function(t,e,r,a){return t[2]=a[2]/a[0],r[0]=a[0],r[1]=a[1],r[3]=a[3]-t[2]*r[1],[t,e,r]},Tt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Tt.subtract=$i,Tt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Tt.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],p=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(r-p)<=Ct.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(a-_)<=Ct.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-y)<=Ct.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-b)<=Ct.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Tt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Tt.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t},Tt.sub=Tt.mul=void 0;var Ct=function(t,e){if(t&&t.__esModule)return t;if(t===null||ri(t)!=="object"&&typeof t!="function")return{default:t};var r=Ti(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}(ft);function Ti(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Ti=function(a){return a?r:e})(t)}function Ci(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=r[0],y=r[1],b=r[2],E=r[3];return t[0]=a*_+d*y,t[1]=u*_+p*y,t[2]=a*b+d*E,t[3]=u*b+p*E,t}function $i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}Tt.mul=Ci,Tt.sub=$i;var wn={};function Wo(t){return Wo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wo(t)}Object.defineProperty(wn,"__esModule",{value:!0}),wn.create=function(){var t=new wt.ARRAY_TYPE(6);return wt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},wn.clone=function(t){var e=new wt.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},wn.fromValues=function(t,e,r,a,u,d){var p=new wt.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=r,p[3]=a,p[4]=u,p[5]=d,p},wn.set=function(t,e,r,a,u,d,p){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t},wn.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=r*d-a*u;return y?(t[0]=d*(y=1/y),t[1]=-a*y,t[2]=-u*y,t[3]=r*y,t[4]=(u*_-d*p)*y,t[5]=(a*p-r*_)*y,t):null},wn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},wn.multiply=qt,wn.rotate=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=Math.sin(r),E=Math.cos(r);return t[0]=a*E+d*b,t[1]=u*E+p*b,t[2]=a*-b+d*E,t[3]=u*-b+p*E,t[4]=_,t[5]=y,t},wn.scale=function(t,e,r){var a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=r[0],b=r[1];return t[0]=e[0]*y,t[1]=a*y,t[2]=u*b,t[3]=d*b,t[4]=p,t[5]=_,t},wn.translate=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=r[0],E=r[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=a*b+d*E+_,t[5]=u*b+p*E+y,t},wn.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=-r,t[3]=a,t[4]=0,t[5]=0,t},wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},wn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},wn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},wn.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},wn.subtract=vn,wn.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},wn.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t},wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},wn.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=e[0],b=e[1],E=e[2],S=e[3],D=e[4],R=e[5];return Math.abs(r-y)<=wt.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-b)<=wt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(u-E)<=wt.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-S)<=wt.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-D)<=wt.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(_-R)<=wt.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},wn.sub=wn.mul=void 0;var wt=function(t,e){if(t&&t.__esModule)return t;if(t===null||Wo(t)!=="object"&&typeof t!="function")return{default:t};var r=Bt(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}(ft);function Bt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Bt=function(a){return a?r:e})(t)}function qt(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=r[0],E=r[1],S=r[2],D=r[3],R=r[4],k=r[5];return t[0]=a*b+d*E,t[1]=u*b+p*E,t[2]=a*S+d*D,t[3]=u*S+p*D,t[4]=a*R+d*k+_,t[5]=u*R+p*k+y,t}function vn(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}wn.mul=qt,wn.sub=vn;var Lt={};function dr(t){return dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dr(t)}Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.create=function(){var t=new ti.ARRAY_TYPE(9);return ti.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Lt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Lt.clone=function(t){var e=new ti.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Lt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Lt.fromValues=function(t,e,r,a,u,d,p,_,y){var b=new ti.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=r,b[3]=a,b[4]=u,b[5]=d,b[6]=p,b[7]=_,b[8]=y,b},Lt.set=function(t,e,r,a,u,d,p,_,y,b){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=b,t},Lt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Lt.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=a,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Lt.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],E=e[8],S=E*p-_*b,D=-E*d+_*y,R=b*d-p*y,k=r*S+a*D+u*R;return k?(t[0]=S*(k=1/k),t[1]=(-E*a+u*b)*k,t[2]=(_*a-u*p)*k,t[3]=D*k,t[4]=(E*r-u*y)*k,t[5]=(-_*r+u*d)*k,t[6]=R*k,t[7]=(-b*r+a*y)*k,t[8]=(p*r-a*d)*k,t):null},Lt.adjoint=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],E=e[8];return t[0]=p*E-_*b,t[1]=u*b-a*E,t[2]=a*_-u*p,t[3]=_*y-d*E,t[4]=r*E-u*y,t[5]=u*d-r*_,t[6]=d*b-p*y,t[7]=a*y-r*b,t[8]=r*p-a*d,t},Lt.determinant=function(t){var e=t[3],r=t[4],a=t[5],u=t[6],d=t[7],p=t[8];return t[0]*(p*r-a*d)+t[1]*(-p*e+a*u)+t[2]*(d*e-r*u)},Lt.multiply=pi,Lt.translate=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=e[8],D=r[0],R=r[1];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=D*a+R*p+b,t[7]=D*u+R*_+E,t[8]=D*d+R*y+S,t},Lt.rotate=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=e[8],D=Math.sin(r),R=Math.cos(r);return t[0]=R*a+D*p,t[1]=R*u+D*_,t[2]=R*d+D*y,t[3]=R*p-D*a,t[4]=R*_-D*u,t[5]=R*y-D*d,t[6]=b,t[7]=E,t[8]=S,t},Lt.scale=function(t,e,r){var a=r[0],u=r[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Lt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Lt.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Lt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Lt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Lt.fromQuat=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=r+r,_=a+a,y=u+u,b=r*p,E=a*p,S=a*_,D=u*p,R=u*_,k=u*y,F=d*p,z=d*_,j=d*y;return t[0]=1-S-k,t[3]=E-j,t[6]=D+z,t[1]=E+j,t[4]=1-b-k,t[7]=R-F,t[2]=D-z,t[5]=R+F,t[8]=1-b-S,t},Lt.normalFromMat4=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],E=e[8],S=e[9],D=e[10],R=e[11],k=e[12],F=e[13],z=e[14],j=e[15],Y=r*_-a*p,X=r*y-u*p,K=r*b-d*p,le=a*y-u*_,se=a*b-d*_,me=u*b-d*y,_e=E*F-S*k,Te=E*z-D*k,ke=E*j-R*k,De=S*z-D*F,ze=S*j-R*F,Ye=D*j-R*z,Le=Y*Ye-X*ze+K*De+le*ke-se*Te+me*_e;return Le?(t[0]=(_*Ye-y*ze+b*De)*(Le=1/Le),t[1]=(y*ke-p*Ye-b*Te)*Le,t[2]=(p*ze-_*ke+b*_e)*Le,t[3]=(u*ze-a*Ye-d*De)*Le,t[4]=(r*Ye-u*ke+d*Te)*Le,t[5]=(a*ke-r*ze-d*_e)*Le,t[6]=(F*me-z*se+j*le)*Le,t[7]=(z*K-k*me-j*X)*Le,t[8]=(k*se-F*K+j*Y)*Le,t):null},Lt.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Lt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Lt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Lt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},Lt.subtract=La,Lt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},Lt.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t},Lt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Lt.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],E=t[8],S=e[0],D=e[1],R=e[2],k=e[3],F=e[4],z=e[5],j=e[6],Y=e[7],X=e[8];return Math.abs(r-S)<=ti.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(a-D)<=ti.EPSILON*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(u-R)<=ti.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-k)<=ti.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(p-F)<=ti.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(_-z)<=ti.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(y-j)<=ti.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-Y)<=ti.EPSILON*Math.max(1,Math.abs(b),Math.abs(Y))&&Math.abs(E-X)<=ti.EPSILON*Math.max(1,Math.abs(E),Math.abs(X))},Lt.sub=Lt.mul=void 0;var ti=function(t,e){if(t&&t.__esModule)return t;if(t===null||dr(t)!=="object"&&typeof t!="function")return{default:t};var r=Jr(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}(ft);function Jr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Jr=function(a){return a?r:e})(t)}function pi(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=e[8],D=r[0],R=r[1],k=r[2],F=r[3],z=r[4],j=r[5],Y=r[6],X=r[7],K=r[8];return t[0]=D*a+R*p+k*b,t[1]=D*u+R*_+k*E,t[2]=D*d+R*y+k*S,t[3]=F*a+z*p+j*b,t[4]=F*u+z*_+j*E,t[5]=F*d+z*y+j*S,t[6]=Y*a+X*p+K*b,t[7]=Y*u+X*_+K*E,t[8]=Y*d+X*y+K*S,t}function La(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}Lt.mul=pi,Lt.sub=La;var Rt={};function Li(t){return Li=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Li(t)}Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=function(){var t=new Bn.ARRAY_TYPE(16);return Bn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Rt.clone=function(t){var e=new Bn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Rt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Rt.fromValues=function(t,e,r,a,u,d,p,_,y,b,E,S,D,R,k,F){var z=new Bn.ARRAY_TYPE(16);return z[0]=t,z[1]=e,z[2]=r,z[3]=a,z[4]=u,z[5]=d,z[6]=p,z[7]=_,z[8]=y,z[9]=b,z[10]=E,z[11]=S,z[12]=D,z[13]=R,z[14]=k,z[15]=F,z},Rt.set=function(t,e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=b,t[9]=E,t[10]=S,t[11]=D,t[12]=R,t[13]=k,t[14]=F,t[15]=z,t},Rt.identity=gs,Rt.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],u=e[3],d=e[6],p=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=d,t[11]=e[14],t[12]=u,t[13]=p,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Rt.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],E=e[8],S=e[9],D=e[10],R=e[11],k=e[12],F=e[13],z=e[14],j=e[15],Y=r*_-a*p,X=r*y-u*p,K=r*b-d*p,le=a*y-u*_,se=a*b-d*_,me=u*b-d*y,_e=E*F-S*k,Te=E*z-D*k,ke=E*j-R*k,De=S*z-D*F,ze=S*j-R*F,Ye=D*j-R*z,Le=Y*Ye-X*ze+K*De+le*ke-se*Te+me*_e;return Le?(t[0]=(_*Ye-y*ze+b*De)*(Le=1/Le),t[1]=(u*ze-a*Ye-d*De)*Le,t[2]=(F*me-z*se+j*le)*Le,t[3]=(D*se-S*me-R*le)*Le,t[4]=(y*ke-p*Ye-b*Te)*Le,t[5]=(r*Ye-u*ke+d*Te)*Le,t[6]=(z*K-k*me-j*X)*Le,t[7]=(E*me-D*K+R*X)*Le,t[8]=(p*ze-_*ke+b*_e)*Le,t[9]=(a*ke-r*ze-d*_e)*Le,t[10]=(k*se-F*K+j*Y)*Le,t[11]=(S*K-E*se-R*Y)*Le,t[12]=(_*Te-p*De-y*_e)*Le,t[13]=(r*De-a*Te+u*_e)*Le,t[14]=(F*X-k*le-z*Y)*Le,t[15]=(E*le-S*X+D*Y)*Le,t):null},Rt.adjoint=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=e[4],_=e[5],y=e[6],b=e[7],E=e[8],S=e[9],D=e[10],R=e[11],k=e[12],F=e[13],z=e[14],j=e[15];return t[0]=_*(D*j-R*z)-S*(y*j-b*z)+F*(y*R-b*D),t[1]=-(a*(D*j-R*z)-S*(u*j-d*z)+F*(u*R-d*D)),t[2]=a*(y*j-b*z)-_*(u*j-d*z)+F*(u*b-d*y),t[3]=-(a*(y*R-b*D)-_*(u*R-d*D)+S*(u*b-d*y)),t[4]=-(p*(D*j-R*z)-E*(y*j-b*z)+k*(y*R-b*D)),t[5]=r*(D*j-R*z)-E*(u*j-d*z)+k*(u*R-d*D),t[6]=-(r*(y*j-b*z)-p*(u*j-d*z)+k*(u*b-d*y)),t[7]=r*(y*R-b*D)-p*(u*R-d*D)+E*(u*b-d*y),t[8]=p*(S*j-R*F)-E*(_*j-b*F)+k*(_*R-b*S),t[9]=-(r*(S*j-R*F)-E*(a*j-d*F)+k*(a*R-d*S)),t[10]=r*(_*j-b*F)-p*(a*j-d*F)+k*(a*b-d*_),t[11]=-(r*(_*R-b*S)-p*(a*R-d*S)+E*(a*b-d*_)),t[12]=-(p*(S*z-D*F)-E*(_*z-y*F)+k*(_*D-y*S)),t[13]=r*(S*z-D*F)-E*(a*z-u*F)+k*(a*D-u*S),t[14]=-(r*(_*z-y*F)-p*(a*z-u*F)+k*(a*y-u*_)),t[15]=r*(_*D-y*S)-p*(a*D-u*S)+E*(a*y-u*_),t},Rt.determinant=function(t){var e=t[0],r=t[1],a=t[2],u=t[3],d=t[4],p=t[5],_=t[6],y=t[7],b=t[8],E=t[9],S=t[10],D=t[11],R=t[12],k=t[13],F=t[14],z=t[15];return(e*p-r*d)*(S*z-D*F)-(e*_-a*d)*(E*z-D*k)+(e*y-u*d)*(E*F-S*k)+(r*_-a*p)*(b*z-D*R)-(r*y-u*p)*(b*F-S*R)+(a*y-u*_)*(b*k-E*R)},Rt.multiply=Xs,Rt.translate=function(t,e,r){var a,u,d,p,_,y,b,E,S,D,R,k,F=r[0],z=r[1],j=r[2];return e===t?(t[12]=e[0]*F+e[4]*z+e[8]*j+e[12],t[13]=e[1]*F+e[5]*z+e[9]*j+e[13],t[14]=e[2]*F+e[6]*z+e[10]*j+e[14],t[15]=e[3]*F+e[7]*z+e[11]*j+e[15]):(u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=e[8],D=e[9],R=e[10],k=e[11],t[0]=a=e[0],t[1]=u,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=b,t[7]=E,t[8]=S,t[9]=D,t[10]=R,t[11]=k,t[12]=a*F+_*z+S*j+e[12],t[13]=u*F+y*z+D*j+e[13],t[14]=d*F+b*z+R*j+e[14],t[15]=p*F+E*z+k*j+e[15]),t},Rt.scale=function(t,e,r){var a=r[0],u=r[1],d=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Rt.rotate=function(t,e,r,a){var u,d,p,_,y,b,E,S,D,R,k,F,z,j,Y,X,K,le,se,me,_e,Te,ke,De,ze=a[0],Ye=a[1],Le=a[2],qe=Math.hypot(ze,Ye,Le);return qe<Bn.EPSILON?null:(ze*=qe=1/qe,Ye*=qe,Le*=qe,u=Math.sin(r),d=Math.cos(r),y=e[1],b=e[2],E=e[3],D=e[5],R=e[6],k=e[7],z=e[9],j=e[10],Y=e[11],X=ze*ze*(p=1-d)+d,se=ze*Ye*p-Le*u,me=Ye*Ye*p+d,_e=Le*Ye*p+ze*u,Te=ze*Le*p+Ye*u,ke=Ye*Le*p-ze*u,De=Le*Le*p+d,t[0]=(_=e[0])*X+(S=e[4])*(K=Ye*ze*p+Le*u)+(F=e[8])*(le=Le*ze*p-Ye*u),t[1]=y*X+D*K+z*le,t[2]=b*X+R*K+j*le,t[3]=E*X+k*K+Y*le,t[4]=_*se+S*me+F*_e,t[5]=y*se+D*me+z*_e,t[6]=b*se+R*me+j*_e,t[7]=E*se+k*me+Y*_e,t[8]=_*Te+S*ke+F*De,t[9]=y*Te+D*ke+z*De,t[10]=b*Te+R*ke+j*De,t[11]=E*Te+k*ke+Y*De,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Rt.rotateX=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),d=e[4],p=e[5],_=e[6],y=e[7],b=e[8],E=e[9],S=e[10],D=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*u+b*a,t[5]=p*u+E*a,t[6]=_*u+S*a,t[7]=y*u+D*a,t[8]=b*u-d*a,t[9]=E*u-p*a,t[10]=S*u-_*a,t[11]=D*u-y*a,t},Rt.rotateY=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),d=e[0],p=e[1],_=e[2],y=e[3],b=e[8],E=e[9],S=e[10],D=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u-b*a,t[1]=p*u-E*a,t[2]=_*u-S*a,t[3]=y*u-D*a,t[8]=d*a+b*u,t[9]=p*a+E*u,t[10]=_*a+S*u,t[11]=y*a+D*u,t},Rt.rotateZ=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),d=e[0],p=e[1],_=e[2],y=e[3],b=e[4],E=e[5],S=e[6],D=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u+b*a,t[1]=p*u+E*a,t[2]=_*u+S*a,t[3]=y*u+D*a,t[4]=b*u-d*a,t[5]=E*u-p*a,t[6]=S*u-_*a,t[7]=D*u-y*a,t},Rt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Rt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromRotation=function(t,e,r){var a,u,d,p=r[0],_=r[1],y=r[2],b=Math.hypot(p,_,y);return b<Bn.EPSILON?null:(p*=b=1/b,_*=b,y*=b,a=Math.sin(e),u=Math.cos(e),t[0]=p*p*(d=1-u)+u,t[1]=_*p*d+y*a,t[2]=y*p*d-_*a,t[3]=0,t[4]=p*_*d-y*a,t[5]=_*_*d+u,t[6]=y*_*d+p*a,t[7]=0,t[8]=p*y*d+_*a,t[9]=_*y*d-p*a,t[10]=y*y*d+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Rt.fromXRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromYRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromZRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.fromRotationTranslation=gu,Rt.fromQuat2=function(t,e){var r=new Bn.ARRAY_TYPE(3),a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=a*a+u*u+d*d+p*p;return S>0?(r[0]=2*(_*p+E*a+y*d-b*u)/S,r[1]=2*(y*p+E*u+b*a-_*d)/S,r[2]=2*(b*p+E*d+_*u-y*a)/S):(r[0]=2*(_*p+E*a+y*d-b*u),r[1]=2*(y*p+E*u+b*a-_*d),r[2]=2*(b*p+E*d+_*u-y*a)),gu(t,e,r),t},Rt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Rt.getScaling=Ml,Rt.getRotation=function(t,e){var r=new Bn.ARRAY_TYPE(3);Ml(r,e);var a=1/r[0],u=1/r[1],d=1/r[2],p=e[0]*a,_=e[1]*u,y=e[2]*d,b=e[4]*a,E=e[5]*u,S=e[6]*d,D=e[8]*a,R=e[9]*u,k=e[10]*d,F=p+E+k,z=0;return F>0?(z=2*Math.sqrt(F+1),t[3]=.25*z,t[0]=(S-R)/z,t[1]=(D-y)/z,t[2]=(_-b)/z):p>E&&p>k?(z=2*Math.sqrt(1+p-E-k),t[3]=(S-R)/z,t[0]=.25*z,t[1]=(_+b)/z,t[2]=(D+y)/z):E>k?(z=2*Math.sqrt(1+E-p-k),t[3]=(D-y)/z,t[0]=(_+b)/z,t[1]=.25*z,t[2]=(S+R)/z):(z=2*Math.sqrt(1+k-p-E),t[3]=(_-b)/z,t[0]=(D+y)/z,t[1]=(S+R)/z,t[2]=.25*z),t},Rt.fromRotationTranslationScale=function(t,e,r,a){var u=e[0],d=e[1],p=e[2],_=e[3],y=u+u,b=d+d,E=p+p,S=u*y,D=u*b,R=u*E,k=d*b,F=d*E,z=p*E,j=_*y,Y=_*b,X=_*E,K=a[0],le=a[1],se=a[2];return t[0]=(1-(k+z))*K,t[1]=(D+X)*K,t[2]=(R-Y)*K,t[3]=0,t[4]=(D-X)*le,t[5]=(1-(S+z))*le,t[6]=(F+j)*le,t[7]=0,t[8]=(R+Y)*se,t[9]=(F-j)*se,t[10]=(1-(S+k))*se,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},Rt.fromRotationTranslationScaleOrigin=function(t,e,r,a,u){var d=e[0],p=e[1],_=e[2],y=e[3],b=d+d,E=p+p,S=_+_,D=d*b,R=d*E,k=d*S,F=p*E,z=p*S,j=_*S,Y=y*b,X=y*E,K=y*S,le=a[0],se=a[1],me=a[2],_e=u[0],Te=u[1],ke=u[2],De=(1-(F+j))*le,ze=(R+K)*le,Ye=(k-X)*le,Le=(R-K)*se,qe=(1-(D+j))*se,Oe=(z+Y)*se,We=(k+X)*me,Je=(z-Y)*me,Ze=(1-(D+F))*me;return t[0]=De,t[1]=ze,t[2]=Ye,t[3]=0,t[4]=Le,t[5]=qe,t[6]=Oe,t[7]=0,t[8]=We,t[9]=Je,t[10]=Ze,t[11]=0,t[12]=r[0]+_e-(De*_e+Le*Te+We*ke),t[13]=r[1]+Te-(ze*_e+qe*Te+Je*ke),t[14]=r[2]+ke-(Ye*_e+Oe*Te+Ze*ke),t[15]=1,t},Rt.fromQuat=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=r+r,_=a+a,y=u+u,b=r*p,E=a*p,S=a*_,D=u*p,R=u*_,k=u*y,F=d*p,z=d*_,j=d*y;return t[0]=1-S-k,t[1]=E+j,t[2]=D-z,t[3]=0,t[4]=E-j,t[5]=1-b-k,t[6]=R+F,t[7]=0,t[8]=D+z,t[9]=R-F,t[10]=1-b-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Rt.frustum=function(t,e,r,a,u,d,p){var _=1/(r-e),y=1/(u-a),b=1/(d-p);return t[0]=2*d*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*y,t[6]=0,t[7]=0,t[8]=(r+e)*_,t[9]=(u+a)*y,t[10]=(p+d)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*d*2*b,t[15]=0,t},Rt.perspectiveNO=So,Rt.perspectiveZO=function(t,e,r,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(d=1/(a-u)),t[14]=u*a*d):(t[10]=-1,t[14]=-a),t},Rt.perspectiveFromFieldOfView=function(t,e,r,a){var u=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+_),b=2/(u+d);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(p-_)*y*.5,t[9]=(u-d)*b*.5,t[10]=a/(r-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*r/(r-a),t[15]=0,t},Rt.orthoNO=Do,Rt.orthoZO=function(t,e,r,a,u,d,p){var _=1/(e-r),y=1/(a-u),b=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+r)*_,t[13]=(u+a)*y,t[14]=d*b,t[15]=1,t},Rt.lookAt=function(t,e,r,a){var u,d,p,_,y,b,E,S,D,R,k=e[0],F=e[1],z=e[2],j=a[0],Y=a[1],X=a[2],K=r[0],le=r[1],se=r[2];return Math.abs(k-K)<Bn.EPSILON&&Math.abs(F-le)<Bn.EPSILON&&Math.abs(z-se)<Bn.EPSILON?gs(t):(E=k-K,S=F-le,D=z-se,u=Y*(D*=R=1/Math.hypot(E,S,D))-X*(S*=R),d=X*(E*=R)-j*D,p=j*S-Y*E,(R=Math.hypot(u,d,p))?(u*=R=1/R,d*=R,p*=R):(u=0,d=0,p=0),_=S*p-D*d,y=D*u-E*p,b=E*d-S*u,(R=Math.hypot(_,y,b))?(_*=R=1/R,y*=R,b*=R):(_=0,y=0,b=0),t[0]=u,t[1]=_,t[2]=E,t[3]=0,t[4]=d,t[5]=y,t[6]=S,t[7]=0,t[8]=p,t[9]=b,t[10]=D,t[11]=0,t[12]=-(u*k+d*F+p*z),t[13]=-(_*k+y*F+b*z),t[14]=-(E*k+S*F+D*z),t[15]=1,t)},Rt.targetTo=function(t,e,r,a){var u=e[0],d=e[1],p=e[2],_=a[0],y=a[1],b=a[2],E=u-r[0],S=d-r[1],D=p-r[2],R=E*E+S*S+D*D;R>0&&(E*=R=1/Math.sqrt(R),S*=R,D*=R);var k=y*D-b*S,F=b*E-_*D,z=_*S-y*E;return(R=k*k+F*F+z*z)>0&&(k*=R=1/Math.sqrt(R),F*=R,z*=R),t[0]=k,t[1]=F,t[2]=z,t[3]=0,t[4]=S*z-D*F,t[5]=D*k-E*z,t[6]=E*F-S*k,t[7]=0,t[8]=E,t[9]=S,t[10]=D,t[11]=0,t[12]=u,t[13]=d,t[14]=p,t[15]=1,t},Rt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Rt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Rt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},Rt.subtract=_u,Rt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},Rt.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t[9]=e[9]+r[9]*a,t[10]=e[10]+r[10]*a,t[11]=e[11]+r[11]*a,t[12]=e[12]+r[12]*a,t[13]=e[13]+r[13]*a,t[14]=e[14]+r[14]*a,t[15]=e[15]+r[15]*a,t},Rt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Rt.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],E=t[8],S=t[9],D=t[10],R=t[11],k=t[12],F=t[13],z=t[14],j=t[15],Y=e[0],X=e[1],K=e[2],le=e[3],se=e[4],me=e[5],_e=e[6],Te=e[7],ke=e[8],De=e[9],ze=e[10],Ye=e[11],Le=e[12],qe=e[13],Oe=e[14],We=e[15];return Math.abs(r-Y)<=Bn.EPSILON*Math.max(1,Math.abs(r),Math.abs(Y))&&Math.abs(a-X)<=Bn.EPSILON*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(u-K)<=Bn.EPSILON*Math.max(1,Math.abs(u),Math.abs(K))&&Math.abs(d-le)<=Bn.EPSILON*Math.max(1,Math.abs(d),Math.abs(le))&&Math.abs(p-se)<=Bn.EPSILON*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(_-me)<=Bn.EPSILON*Math.max(1,Math.abs(_),Math.abs(me))&&Math.abs(y-_e)<=Bn.EPSILON*Math.max(1,Math.abs(y),Math.abs(_e))&&Math.abs(b-Te)<=Bn.EPSILON*Math.max(1,Math.abs(b),Math.abs(Te))&&Math.abs(E-ke)<=Bn.EPSILON*Math.max(1,Math.abs(E),Math.abs(ke))&&Math.abs(S-De)<=Bn.EPSILON*Math.max(1,Math.abs(S),Math.abs(De))&&Math.abs(D-ze)<=Bn.EPSILON*Math.max(1,Math.abs(D),Math.abs(ze))&&Math.abs(R-Ye)<=Bn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ye))&&Math.abs(k-Le)<=Bn.EPSILON*Math.max(1,Math.abs(k),Math.abs(Le))&&Math.abs(F-qe)<=Bn.EPSILON*Math.max(1,Math.abs(F),Math.abs(qe))&&Math.abs(z-Oe)<=Bn.EPSILON*Math.max(1,Math.abs(z),Math.abs(Oe))&&Math.abs(j-We)<=Bn.EPSILON*Math.max(1,Math.abs(j),Math.abs(We))},Rt.sub=Rt.mul=Rt.ortho=Rt.perspective=void 0;var Bn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Li(t)!=="object"&&typeof t!="function")return{default:t};var r=fr(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}(ft);function fr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(fr=function(a){return a?r:e})(t)}function gs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xs(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=e[8],D=e[9],R=e[10],k=e[11],F=e[12],z=e[13],j=e[14],Y=e[15],X=r[0],K=r[1],le=r[2],se=r[3];return t[0]=X*a+K*_+le*S+se*F,t[1]=X*u+K*y+le*D+se*z,t[2]=X*d+K*b+le*R+se*j,t[3]=X*p+K*E+le*k+se*Y,t[4]=(X=r[4])*a+(K=r[5])*_+(le=r[6])*S+(se=r[7])*F,t[5]=X*u+K*y+le*D+se*z,t[6]=X*d+K*b+le*R+se*j,t[7]=X*p+K*E+le*k+se*Y,t[8]=(X=r[8])*a+(K=r[9])*_+(le=r[10])*S+(se=r[11])*F,t[9]=X*u+K*y+le*D+se*z,t[10]=X*d+K*b+le*R+se*j,t[11]=X*p+K*E+le*k+se*Y,t[12]=(X=r[12])*a+(K=r[13])*_+(le=r[14])*S+(se=r[15])*F,t[13]=X*u+K*y+le*D+se*z,t[14]=X*d+K*b+le*R+se*j,t[15]=X*p+K*E+le*k+se*Y,t}function gu(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=a+a,y=u+u,b=d+d,E=a*_,S=a*y,D=a*b,R=u*y,k=u*b,F=d*b,z=p*_,j=p*y,Y=p*b;return t[0]=1-(R+F),t[1]=S+Y,t[2]=D-j,t[3]=0,t[4]=S-Y,t[5]=1-(E+F),t[6]=k+z,t[7]=0,t[8]=D+j,t[9]=k-z,t[10]=1-(E+R),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Ml(t,e){var r=e[4],a=e[5],u=e[6],d=e[8],p=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,a,u),t[2]=Math.hypot(d,p,_),t}function So(t,e,r,a,u){var d,p=1/Math.tan(e/2);return t[0]=p/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+a)*(d=1/(a-u)),t[14]=2*u*a*d):(t[10]=-1,t[14]=-2*a),t}function Do(t,e,r,a,u,d,p){var _=1/(e-r),y=1/(a-u),b=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+r)*_,t[13]=(u+a)*y,t[14]=(p+d)*b,t[15]=1,t}function _u(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}Rt.perspective=So,Rt.ortho=Do,Rt.mul=Xs,Rt.sub=_u;var kt={},Ft={};function Al(t){return Al=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Al(t)}Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=Pl,Ft.clone=function(t){var e=new Hr.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Ft.length=Rl,Ft.fromValues=function(t,e,r){var a=new Hr.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=r,a},Ft.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Ft.set=function(t,e,r,a){return t[0]=e,t[1]=r,t[2]=a,t},Ft.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},Ft.subtract=yu,Ft.multiply=Ks,Ft.divide=Na,Ft.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Ft.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Ft.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},Ft.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},Ft.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Ft.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},Ft.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t},Ft.distance=kl,Ft.squaredDistance=vu,Ft.squaredLength=Ol,Ft.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Ft.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Ft.normalize=function(t,e){var r=e[0],a=e[1],u=e[2],d=r*r+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},Ft.dot=Ll,Ft.cross=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=r[0],_=r[1],y=r[2];return t[0]=u*y-d*_,t[1]=d*p-a*y,t[2]=a*_-u*p,t},Ft.lerp=function(t,e,r,a){var u=e[0],d=e[1],p=e[2];return t[0]=u+a*(r[0]-u),t[1]=d+a*(r[1]-d),t[2]=p+a*(r[2]-p),t},Ft.hermite=function(t,e,r,a,u,d){var p=d*d,_=p*(2*d-3)+1,y=p*(d-2)+d,b=p*(d-1),E=p*(3-2*d);return t[0]=e[0]*_+r[0]*y+a[0]*b+u[0]*E,t[1]=e[1]*_+r[1]*y+a[1]*b+u[1]*E,t[2]=e[2]*_+r[2]*y+a[2]*b+u[2]*E,t},Ft.bezier=function(t,e,r,a,u,d){var p=1-d,_=p*p,y=d*d,b=_*p,E=3*d*_,S=3*y*p,D=y*d;return t[0]=e[0]*b+r[0]*E+a[0]*S+u[0]*D,t[1]=e[1]*b+r[1]*E+a[1]*S+u[1]*D,t[2]=e[2]*b+r[2]*E+a[2]*S+u[2]*D,t},Ft.random=function(t,e){e=e||1;var r=2*Hr.RANDOM()*Math.PI,a=2*Hr.RANDOM()-1,u=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(r)*u,t[1]=Math.sin(r)*u,t[2]=a*e,t},Ft.transformMat4=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=r[3]*a+r[7]*u+r[11]*d+r[15];return t[0]=(r[0]*a+r[4]*u+r[8]*d+r[12])/(p=p||1),t[1]=(r[1]*a+r[5]*u+r[9]*d+r[13])/p,t[2]=(r[2]*a+r[6]*u+r[10]*d+r[14])/p,t},Ft.transformMat3=function(t,e,r){var a=e[0],u=e[1],d=e[2];return t[0]=a*r[0]+u*r[3]+d*r[6],t[1]=a*r[1]+u*r[4]+d*r[7],t[2]=a*r[2]+u*r[5]+d*r[8],t},Ft.transformQuat=function(t,e,r){var a=r[0],u=r[1],d=r[2],p=e[0],_=e[1],y=e[2],b=u*y-d*_,E=d*p-a*y,S=a*_-u*p,D=u*S-d*E,R=d*b-a*S,k=a*E-u*b,F=2*r[3];return E*=F,S*=F,R*=2,k*=2,t[0]=p+(b*=F)+(D*=2),t[1]=_+E+R,t[2]=y+S+k,t},Ft.rotateX=function(t,e,r,a){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0],d[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),d[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),t[0]=d[0]+r[0],t[1]=d[1]+r[1],t[2]=d[2]+r[2],t},Ft.rotateY=function(t,e,r,a){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),d[1]=u[1],d[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),t[0]=d[0]+r[0],t[1]=d[1]+r[1],t[2]=d[2]+r[2],t},Ft.rotateZ=function(t,e,r,a){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),d[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),d[2]=u[2],t[0]=d[0]+r[0],t[1]=d[1]+r[1],t[2]=d[2]+r[2],t},Ft.angle=function(t,e){var r=t[0],a=t[1],u=t[2],d=e[0],p=e[1],_=e[2],y=Math.sqrt(r*r+a*a+u*u)*Math.sqrt(d*d+p*p+_*_),b=y&&Ll(t,e)/y;return Math.acos(Math.min(Math.max(b,-1),1))},Ft.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Ft.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Ft.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Ft.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=e[0],p=e[1],_=e[2];return Math.abs(r-d)<=Hr.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-p)<=Hr.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(u-_)<=Hr.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))},Ft.forEach=Ft.sqrLen=Ft.len=Ft.sqrDist=Ft.dist=Ft.div=Ft.mul=Ft.sub=void 0;var Hr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Al(t)!=="object"&&typeof t!="function")return{default:t};var r=Fa(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}(ft);function Fa(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Fa=function(a){return a?r:e})(t)}function Pl(){var t=new Hr.ARRAY_TYPE(3);return Hr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Rl(t){return Math.hypot(t[0],t[1],t[2])}function yu(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Ks(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Na(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function kl(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function vu(t,e){var r=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2];return r*r+a*a+u*u}function Ol(t){var e=t[0],r=t[1],a=t[2];return e*e+r*r+a*a}function Ll(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Ft.sub=yu,Ft.mul=Ks,Ft.div=Na,Ft.dist=kl,Ft.sqrDist=vu,Ft.len=Rl,Ft.sqrLen=Ol;var ho,pd=(ho=Pl(),function(t,e,r,a,u,d){var p,_;for(e||(e=3),r||(r=0),_=a?Math.min(a*e+r,t.length):t.length,p=r;p<_;p+=e)ho[0]=t[p],ho[1]=t[p+1],ho[2]=t[p+2],u(ho,ho,d),t[p]=ho[0],t[p+1]=ho[1],t[p+2]=ho[2];return t});Ft.forEach=pd;var Nt={};function xu(t){return xu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xu(t)}Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.create=za,Nt.clone=function(t){var e=new Ii.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Nt.fromValues=function(t,e,r,a){var u=new Ii.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=r,u[3]=a,u},Nt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Nt.set=function(t,e,r,a,u){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t},Nt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Nt.subtract=Zo,Nt.multiply=Yo,Nt.divide=bu,Nt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Nt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Nt.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},Nt.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},Nt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Nt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Nt.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t},Nt.distance=Qs,Nt.squaredDistance=Js,Nt.length=Nl,Nt.squaredLength=zl,Nt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Nt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Nt.normalize=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=r*r+a*a+u*u+d*d;return p>0&&(p=1/Math.sqrt(p)),t[0]=r*p,t[1]=a*p,t[2]=u*p,t[3]=d*p,t},Nt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Nt.cross=function(t,e,r,a){var u=r[0]*a[1]-r[1]*a[0],d=r[0]*a[2]-r[2]*a[0],p=r[0]*a[3]-r[3]*a[0],_=r[1]*a[2]-r[2]*a[1],y=r[1]*a[3]-r[3]*a[1],b=r[2]*a[3]-r[3]*a[2],E=e[0],S=e[1],D=e[2],R=e[3];return t[0]=S*b-D*y+R*_,t[1]=-E*b+D*p-R*d,t[2]=E*y-S*p+R*u,t[3]=-E*_+S*d-D*u,t},Nt.lerp=function(t,e,r,a){var u=e[0],d=e[1],p=e[2],_=e[3];return t[0]=u+a*(r[0]-u),t[1]=d+a*(r[1]-d),t[2]=p+a*(r[2]-p),t[3]=_+a*(r[3]-_),t},Nt.random=function(t,e){var r,a,u,d,p,_;e=e||1;do p=(r=2*Ii.RANDOM()-1)*r+(a=2*Ii.RANDOM()-1)*a;while(p>=1);do _=(u=2*Ii.RANDOM()-1)*u+(d=2*Ii.RANDOM()-1)*d;while(_>=1);var y=Math.sqrt((1-p)/_);return t[0]=e*r,t[1]=e*a,t[2]=e*u*y,t[3]=e*d*y,t},Nt.transformMat4=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3];return t[0]=r[0]*a+r[4]*u+r[8]*d+r[12]*p,t[1]=r[1]*a+r[5]*u+r[9]*d+r[13]*p,t[2]=r[2]*a+r[6]*u+r[10]*d+r[14]*p,t[3]=r[3]*a+r[7]*u+r[11]*d+r[15]*p,t},Nt.transformQuat=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=r[0],_=r[1],y=r[2],b=r[3],E=b*a+_*d-y*u,S=b*u+y*a-p*d,D=b*d+p*u-_*a,R=-p*a-_*u-y*d;return t[0]=E*b+R*-p+S*-y-D*-_,t[1]=S*b+R*-_+D*-p-E*-y,t[2]=D*b+R*-y+E*-_-S*-p,t[3]=e[3],t},Nt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Nt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Nt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Nt.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],p=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(r-p)<=Ii.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(a-_)<=Ii.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-y)<=Ii.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-b)<=Ii.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Nt.forEach=Nt.sqrLen=Nt.len=Nt.sqrDist=Nt.dist=Nt.div=Nt.mul=Nt.sub=void 0;var Ii=function(t,e){if(t&&t.__esModule)return t;if(t===null||xu(t)!=="object"&&typeof t!="function")return{default:t};var r=Fl(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}(ft);function Fl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Fl=function(a){return a?r:e})(t)}function za(){var t=new Ii.ARRAY_TYPE(4);return Ii.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Zo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Yo(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function bu(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Qs(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Js(t,e){var r=e[0]-t[0],a=e[1]-t[1],u=e[2]-t[2],d=e[3]-t[3];return r*r+a*a+u*u+d*d}function Nl(t){return Math.hypot(t[0],t[1],t[2],t[3])}function zl(t){var e=t[0],r=t[1],a=t[2],u=t[3];return e*e+r*r+a*a+u*u}Nt.sub=Zo,Nt.mul=Yo,Nt.div=bu,Nt.dist=Qs,Nt.sqrDist=Js,Nt.len=Nl,Nt.sqrLen=zl;var md=function(){var t=za();return function(e,r,a,u,d,p){var _,y;for(r||(r=4),a||(a=0),y=u?Math.min(u*r+a,e.length):e.length,_=a;_<y;_+=r)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],d(t,t,p),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function Bl(t){return Bl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bl(t)}Nt.forEach=md,Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=Vl,kt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},kt.setAxisAngle=wu,kt.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),a=Math.sin(r/2);return a>fo.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),r},kt.getAngle=function(t,e){var r=pe(t,e);return Math.acos(2*r*r-1)},kt.multiply=jl,kt.rotateX=function(t,e,r){r*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(r),y=Math.cos(r);return t[0]=a*y+p*_,t[1]=u*y+d*_,t[2]=d*y-u*_,t[3]=p*y-a*_,t},kt.rotateY=function(t,e,r){r*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(r),y=Math.cos(r);return t[0]=a*y-d*_,t[1]=u*y+p*_,t[2]=d*y+a*_,t[3]=p*y-u*_,t},kt.rotateZ=function(t,e,r){r*=.5;var a=e[0],u=e[1],d=e[2],p=e[3],_=Math.sin(r),y=Math.cos(r);return t[0]=a*y+u*_,t[1]=u*y-a*_,t[2]=d*y+p*_,t[3]=p*y-d*_,t},kt.calculateW=function(t,e){var r=e[0],a=e[1],u=e[2];return t[0]=r,t[1]=a,t[2]=u,t[3]=Math.sqrt(Math.abs(1-r*r-a*a-u*u)),t},kt.exp=ye,kt.ln=$,kt.pow=function(t,e,r){return $(t,e),de(t,t,r),ye(t,t),t},kt.slerp=Z,kt.random=function(t){var e=fo.RANDOM(),r=fo.RANDOM(),a=fo.RANDOM(),u=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*r),t[1]=u*Math.cos(2*Math.PI*r),t[2]=d*Math.sin(2*Math.PI*a),t[3]=d*Math.cos(2*Math.PI*a),t},kt.invert=function(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=r*r+a*a+u*u+d*d,_=p?1/p:0;return t[0]=-r*_,t[1]=-a*_,t[2]=-u*_,t[3]=d*_,t},kt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},kt.fromMat3=oe,kt.fromEuler=function(t,e,r,a){var u=.5*Math.PI/180;e*=u,r*=u,a*=u;var d=Math.sin(e),p=Math.cos(e),_=Math.sin(r),y=Math.cos(r),b=Math.sin(a),E=Math.cos(a);return t[0]=d*y*E-p*_*b,t[1]=p*_*E+d*y*b,t[2]=p*y*b-d*_*E,t[3]=p*y*E+d*_*b,t},kt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},kt.setAxes=kt.sqlerp=kt.rotationTo=kt.equals=kt.exactEquals=kt.normalize=kt.sqrLen=kt.squaredLength=kt.len=kt.length=kt.lerp=kt.dot=kt.scale=kt.mul=kt.add=kt.set=kt.copy=kt.fromValues=kt.clone=void 0;var fo=Ba(ft),ea=Ba(Lt),po=Ba(Ft),nr=Ba(Nt);function gd(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(gd=function(a){return a?r:e})(t)}function Ba(t,e){if(t&&t.__esModule)return t;if(t===null||Bl(t)!=="object"&&typeof t!="function")return{default:t};var r=gd(e);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}function Vl(){var t=new fo.ARRAY_TYPE(4);return fo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function wu(t,e,r){r*=.5;var a=Math.sin(r);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(r),t}function jl(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=r[0],y=r[1],b=r[2],E=r[3];return t[0]=a*E+p*_+u*b-d*y,t[1]=u*E+p*y+d*_-a*b,t[2]=d*E+p*b+a*y-u*_,t[3]=p*E-a*_-u*y-d*b,t}function ye(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(r*r+a*a+u*u),_=Math.exp(d),y=p>0?_*Math.sin(p)/p:0;return t[0]=r*y,t[1]=a*y,t[2]=u*y,t[3]=_*Math.cos(p),t}function $(t,e){var r=e[0],a=e[1],u=e[2],d=e[3],p=Math.sqrt(r*r+a*a+u*u),_=p>0?Math.atan2(p,d)/p:0;return t[0]=r*_,t[1]=a*_,t[2]=u*_,t[3]=.5*Math.log(r*r+a*a+u*u+d*d),t}function Z(t,e,r,a){var u,d,p,_,y,b=e[0],E=e[1],S=e[2],D=e[3],R=r[0],k=r[1],F=r[2],z=r[3];return(d=b*R+E*k+S*F+D*z)<0&&(d=-d,R=-R,k=-k,F=-F,z=-z),1-d>fo.EPSILON?(u=Math.acos(d),p=Math.sin(u),_=Math.sin((1-a)*u)/p,y=Math.sin(a*u)/p):(_=1-a,y=a),t[0]=_*b+y*R,t[1]=_*E+y*k,t[2]=_*S+y*F,t[3]=_*D+y*z,t}function oe(t,e){var r,a=e[0]+e[4]+e[8];if(a>0)r=Math.sqrt(a+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var d=(u+1)%3,p=(u+2)%3;r=Math.sqrt(e[3*u+u]-e[3*d+d]-e[3*p+p]+1),t[u]=.5*r,t[3]=(e[3*d+p]-e[3*p+d])*(r=.5/r),t[d]=(e[3*d+u]+e[3*u+d])*r,t[p]=(e[3*p+u]+e[3*u+p])*r}return t}kt.clone=nr.clone,kt.fromValues=nr.fromValues,kt.copy=nr.copy,kt.set=nr.set,kt.add=nr.add,kt.mul=jl;var de=nr.scale;kt.scale=de;var pe=nr.dot;kt.dot=pe,kt.lerp=nr.lerp;var we=nr.length;kt.length=we,kt.len=we;var Ae=nr.squaredLength;kt.squaredLength=Ae,kt.sqrLen=Ae;var ve=nr.normalize;kt.normalize=ve,kt.exactEquals=nr.exactEquals,kt.equals=nr.equals;var Pe,it,Qe,yt=(Pe=po.create(),it=po.fromValues(1,0,0),Qe=po.fromValues(0,1,0),function(t,e,r){var a=po.dot(e,r);return a<-.999999?(po.cross(Pe,it,e),po.len(Pe)<1e-6&&po.cross(Pe,Qe,e),po.normalize(Pe,Pe),wu(t,Pe,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(po.cross(Pe,e,r),t[0]=Pe[0],t[1]=Pe[1],t[2]=Pe[2],t[3]=1+a,ve(t,t))});kt.rotationTo=yt;var Mt,Qt,rn=(Mt=Vl(),Qt=Vl(),function(t,e,r,a,u,d){return Z(Mt,e,u,d),Z(Qt,r,a,d),Z(t,Mt,Qt,2*d*(1-d)),t});kt.sqlerp=rn;var $t,hn=($t=ea.create(),function(t,e,r,a){return $t[0]=r[0],$t[3]=r[1],$t[6]=r[2],$t[1]=a[0],$t[4]=a[1],$t[7]=a[2],$t[2]=-e[0],$t[5]=-e[1],$t[8]=-e[2],ve(t,oe(t,$t))});kt.setAxes=hn;var mt={};function ai(t){return ai=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ai(t)}Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var t=new Nn.ARRAY_TYPE(8);return Nn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},mt.clone=function(t){var e=new Nn.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},mt.fromValues=function(t,e,r,a,u,d,p,_){var y=new Nn.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=r,y[3]=a,y[4]=u,y[5]=d,y[6]=p,y[7]=_,y},mt.fromRotationTranslationValues=function(t,e,r,a,u,d,p){var _=new Nn.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=r,_[3]=a;var y=.5*u,b=.5*d,E=.5*p;return _[4]=y*a+b*r-E*e,_[5]=b*a+E*t-y*r,_[6]=E*a+y*e-b*t,_[7]=-y*t-b*e-E*r,_},mt.fromRotationTranslation=pr,mt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},mt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.fromMat4=function(t,e){var r=_n.create();Ai.getRotation(r,e);var a=new Nn.ARRAY_TYPE(3);return Ai.getTranslation(a,e),pr(t,r,a),t},mt.copy=mr,mt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},mt.set=function(t,e,r,a,u,d,p,_,y){return t[0]=e,t[1]=r,t[2]=a,t[3]=u,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t},mt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},mt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},mt.getTranslation=function(t,e){var r=e[4],a=e[5],u=e[6],d=e[7],p=-e[0],_=-e[1],y=-e[2],b=e[3];return t[0]=2*(r*b+d*p+a*y-u*_),t[1]=2*(a*b+d*_+u*p-r*y),t[2]=2*(u*b+d*y+r*_-a*p),t},mt.translate=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=.5*r[0],y=.5*r[1],b=.5*r[2],E=e[4],S=e[5],D=e[6],R=e[7];return t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=p*_+u*b-d*y+E,t[5]=p*y+d*_-a*b+S,t[6]=p*b+a*y-u*_+D,t[7]=-a*_-u*y-d*b+R,t},mt.rotateX=function(t,e,r){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=_*p+E*a+y*d-b*u,D=y*p+E*u+b*a-_*d,R=b*p+E*d+_*u-y*a,k=E*p-_*a-y*u-b*d;return _n.rotateX(t,e,r),t[4]=S*(p=t[3])+k*(a=t[0])+D*(d=t[2])-R*(u=t[1]),t[5]=D*p+k*u+R*a-S*d,t[6]=R*p+k*d+S*u-D*a,t[7]=k*p-S*a-D*u-R*d,t},mt.rotateY=function(t,e,r){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=_*p+E*a+y*d-b*u,D=y*p+E*u+b*a-_*d,R=b*p+E*d+_*u-y*a,k=E*p-_*a-y*u-b*d;return _n.rotateY(t,e,r),t[4]=S*(p=t[3])+k*(a=t[0])+D*(d=t[2])-R*(u=t[1]),t[5]=D*p+k*u+R*a-S*d,t[6]=R*p+k*d+S*u-D*a,t[7]=k*p-S*a-D*u-R*d,t},mt.rotateZ=function(t,e,r){var a=-e[0],u=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],b=e[6],E=e[7],S=_*p+E*a+y*d-b*u,D=y*p+E*u+b*a-_*d,R=b*p+E*d+_*u-y*a,k=E*p-_*a-y*u-b*d;return _n.rotateZ(t,e,r),t[4]=S*(p=t[3])+k*(a=t[0])+D*(d=t[2])-R*(u=t[1]),t[5]=D*p+k*u+R*a-S*d,t[6]=R*p+k*d+S*u-D*a,t[7]=k*p-S*a-D*u-R*d,t},mt.rotateByQuatAppend=function(t,e,r){var a=r[0],u=r[1],d=r[2],p=r[3],_=e[0],y=e[1],b=e[2],E=e[3];return t[0]=_*p+E*a+y*d-b*u,t[1]=y*p+E*u+b*a-_*d,t[2]=b*p+E*d+_*u-y*a,t[3]=E*p-_*a-y*u-b*d,t[4]=(_=e[4])*p+(E=e[7])*a+(y=e[5])*d-(b=e[6])*u,t[5]=y*p+E*u+b*a-_*d,t[6]=b*p+E*d+_*u-y*a,t[7]=E*p-_*a-y*u-b*d,t},mt.rotateByQuatPrepend=function(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=r[0],y=r[1],b=r[2],E=r[3];return t[0]=a*E+p*_+u*b-d*y,t[1]=u*E+p*y+d*_-a*b,t[2]=d*E+p*b+a*y-u*_,t[3]=p*E-a*_-u*y-d*b,t[4]=a*(E=r[7])+p*(_=r[4])+u*(b=r[6])-d*(y=r[5]),t[5]=u*E+p*y+d*_-a*b,t[6]=d*E+p*b+a*y-u*_,t[7]=p*E-a*_-u*y-d*b,t},mt.rotateAroundAxis=function(t,e,r,a){if(Math.abs(a)<Nn.EPSILON)return mr(t,e);var u=Math.hypot(r[0],r[1],r[2]);a*=.5;var d=Math.sin(a),p=d*r[0]/u,_=d*r[1]/u,y=d*r[2]/u,b=Math.cos(a),E=e[0],S=e[1],D=e[2],R=e[3];t[0]=E*b+R*p+S*y-D*_,t[1]=S*b+R*_+D*p-E*y,t[2]=D*b+R*y+E*_-S*p,t[3]=R*b-E*p-S*_-D*y;var k=e[4],F=e[5],z=e[6],j=e[7];return t[4]=k*b+j*p+F*y-z*_,t[5]=F*b+j*_+z*p-k*y,t[6]=z*b+j*y+k*_-F*p,t[7]=j*b-k*p-F*_-z*y,t},mt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},mt.multiply=Va,mt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},mt.lerp=function(t,e,r,a){var u=1-a;return Np(e,r)<0&&(a=-a),t[0]=e[0]*u+r[0]*a,t[1]=e[1]*u+r[1]*a,t[2]=e[2]*u+r[2]*a,t[3]=e[3]*u+r[3]*a,t[4]=e[4]*u+r[4]*a,t[5]=e[5]*u+r[5]*a,t[6]=e[6]*u+r[6]*a,t[7]=e[7]*u+r[7]*a,t},mt.invert=function(t,e){var r=Tu(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},mt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},mt.normalize=function(t,e){var r=Tu(e);if(r>0){r=Math.sqrt(r);var a=e[0]/r,u=e[1]/r,d=e[2]/r,p=e[3]/r,_=e[4],y=e[5],b=e[6],E=e[7],S=a*_+u*y+d*b+p*E;t[0]=a,t[1]=u,t[2]=d,t[3]=p,t[4]=(_-a*S)/r,t[5]=(y-u*S)/r,t[6]=(b-d*S)/r,t[7]=(E-p*S)/r}return t},mt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},mt.equals=function(t,e){var r=t[0],a=t[1],u=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],E=e[0],S=e[1],D=e[2],R=e[3],k=e[4],F=e[5],z=e[6],j=e[7];return Math.abs(r-E)<=Nn.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(a-S)<=Nn.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(u-D)<=Nn.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(d-R)<=Nn.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-k)<=Nn.EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(_-F)<=Nn.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(y-z)<=Nn.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(b-j)<=Nn.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))},mt.sqrLen=mt.squaredLength=mt.len=mt.length=mt.dot=mt.mul=mt.setReal=mt.getReal=void 0;var Nn=Vi(ft),_n=Vi(kt),Ai=Vi(Rt);function li(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(li=function(a){return a?r:e})(t)}function Vi(t,e){if(t&&t.__esModule)return t;if(t===null||ai(t)!=="object"&&typeof t!="function")return{default:t};var r=li(e);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}function pr(t,e,r){var a=.5*r[0],u=.5*r[1],d=.5*r[2],p=e[0],_=e[1],y=e[2],b=e[3];return t[0]=p,t[1]=_,t[2]=y,t[3]=b,t[4]=a*b+u*y-d*_,t[5]=u*b+d*p-a*y,t[6]=d*b+a*_-u*p,t[7]=-a*p-u*_-d*y,t}function mr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Va(t,e,r){var a=e[0],u=e[1],d=e[2],p=e[3],_=r[4],y=r[5],b=r[6],E=r[7],S=e[4],D=e[5],R=e[6],k=e[7],F=r[0],z=r[1],j=r[2],Y=r[3];return t[0]=a*Y+p*F+u*j-d*z,t[1]=u*Y+p*z+d*F-a*j,t[2]=d*Y+p*j+a*z-u*F,t[3]=p*Y-a*F-u*z-d*j,t[4]=a*E+p*_+u*b-d*y+S*Y+k*F+D*j-R*z,t[5]=u*E+p*y+d*_-a*b+D*Y+k*z+R*F-S*j,t[6]=d*E+p*b+a*y-u*_+R*Y+k*j+S*z-D*F,t[7]=p*E-a*_-u*y-d*b+k*Y-S*F-D*z-R*j,t}mt.getReal=_n.copy,mt.setReal=_n.copy,mt.mul=Va;var Np=_n.dot;mt.dot=Np;var my=_n.length;mt.length=my,mt.len=my;var Tu=_n.squaredLength;mt.squaredLength=Tu,mt.sqrLen=Tu;var Yt={};function zp(t){return zp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zp(t)}Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.create=Vp,Yt.clone=function(t){var e=new ta.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Yt.fromValues=function(t,e){var r=new ta.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},Yt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Yt.set=function(t,e,r){return t[0]=e,t[1]=r,t},Yt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},Yt.subtract=jp,Yt.multiply=Up,Yt.divide=$p,Yt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Yt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Yt.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},Yt.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},Yt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Yt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},Yt.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t},Yt.distance=Gp,Yt.squaredDistance=Hp,Yt.length=qp,Yt.squaredLength=Wp,Yt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Yt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Yt.normalize=function(t,e){var r=e[0],a=e[1],u=r*r+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},Yt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Yt.cross=function(t,e,r){var a=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=a,t},Yt.lerp=function(t,e,r,a){var u=e[0],d=e[1];return t[0]=u+a*(r[0]-u),t[1]=d+a*(r[1]-d),t},Yt.random=function(t,e){e=e||1;var r=2*ta.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},Yt.transformMat2=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[2]*u,t[1]=r[1]*a+r[3]*u,t},Yt.transformMat2d=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[2]*u+r[4],t[1]=r[1]*a+r[3]*u+r[5],t},Yt.transformMat3=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[3]*u+r[6],t[1]=r[1]*a+r[4]*u+r[7],t},Yt.transformMat4=function(t,e,r){var a=e[0],u=e[1];return t[0]=r[0]*a+r[4]*u+r[12],t[1]=r[1]*a+r[5]*u+r[13],t},Yt.rotate=function(t,e,r,a){var u=e[0]-r[0],d=e[1]-r[1],p=Math.sin(a),_=Math.cos(a);return t[0]=u*_-d*p+r[0],t[1]=u*p+d*_+r[1],t},Yt.angle=function(t,e){var r=t[0],a=t[1],u=e[0],d=e[1],p=Math.sqrt(r*r+a*a)*Math.sqrt(u*u+d*d);return Math.acos(Math.min(Math.max(p&&(r*u+a*d)/p,-1),1))},Yt.zero=function(t){return t[0]=0,t[1]=0,t},Yt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Yt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Yt.equals=function(t,e){var r=t[0],a=t[1],u=e[0],d=e[1];return Math.abs(r-u)<=ta.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-d)<=ta.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},Yt.forEach=Yt.sqrLen=Yt.sqrDist=Yt.dist=Yt.div=Yt.mul=Yt.sub=Yt.len=void 0;var ta=function(t,e){if(t&&t.__esModule)return t;if(t===null||zp(t)!=="object"&&typeof t!="function")return{default:t};var r=Bp(void 0);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}(ft);function Bp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Bp=function(a){return a?r:e})(t)}function Vp(){var t=new ta.ARRAY_TYPE(2);return ta.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function jp(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Up(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function $p(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Gp(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Hp(t,e){var r=e[0]-t[0],a=e[1]-t[1];return r*r+a*a}function qp(t){return Math.hypot(t[0],t[1])}function Wp(t){var e=t[0],r=t[1];return e*e+r*r}Yt.len=qp,Yt.sub=jp,Yt.mul=Up,Yt.div=$p,Yt.dist=Gp,Yt.sqrDist=Hp,Yt.sqrLen=Wp;var gy=function(){var t=Vp();return function(e,r,a,u,d,p){var _,y;for(r||(r=2),a||(a=0),y=u?Math.min(u*r+a,e.length):e.length,_=a;_<y;_+=r)t[0]=e[_],t[1]=e[_+1],d(t,t,p),e[_]=t[0],e[_+1]=t[1];return e}}();function Ul(t){return Ul=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ul(t)}Yt.forEach=gy,Object.defineProperty(tt,"__esModule",{value:!0}),i.aA=tt.vec4=i._=tt.vec3=tt.vec2=tt.quat2=i.av=tt.quat=i.ad=tt.mat4=i.bC=tt.mat3=tt.mat2d=i.aC=tt.mat2=tt.glMatrix=void 0;var _d=Xo(ft);tt.glMatrix=_d;var yd=Xo(Tt);i.aC=tt.mat2=yd;var _y=Xo(wn);tt.mat2d=_y;var yy=Xo(Lt);i.bC=tt.mat3=yy;var vy=Xo(Rt);i.ad=tt.mat4=vy;var $l=Xo(kt);i.av=tt.quat=$l;var ln=Xo(mt);tt.quat2=ln;var w1=Xo(Yt);tt.vec2=w1;var T1=Xo(Ft);i._=tt.vec3=T1;var E1=Xo(Nt);function Zp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Zp=function(a){return a?r:e})(t)}function Xo(t,e){if(t&&t.__esModule)return t;if(t===null||Ul(t)!=="object"&&typeof t!="function")return{default:t};var r=Zp(e);if(r&&r.has(t))return r.get(t);var a={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=u?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=t[d]}return a.default=t,r&&r.set(t,a),a}i.aA=tt.vec4=E1;var Yp=Eu;function Eu(t,e,r,a){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=a}Eu.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,a=0;a<8;a++){var u=this.sampleCurveX(r)-t;if(Math.abs(u)<e)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=u/d}var p=0,_=1;for(r=t,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-t)<e));a++)t>u?p=r:_=r,r=.5*(_-p)+p;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Iu=Fe(Yp),vd=ja;function ja(t,e){this.x=t,this.y=e}ja.prototype={clone:function(){return new ja(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(t,e){var r=Math.cos(t),a=Math.sin(t),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ja.convert=function(t){return t instanceof ja?t:Array.isArray(t)?new ja(t[0],t[1]):t};var lt=Fe(vd);let xy=Math.PI/180,Cu=180/Math.PI;function dn(t){return t*xy}function gr(t){return t*Cu}let by=[[0,0],[1,0],[1,1],[0,1]];function Xp(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Su(t,e,r,a){let u=new Iu(t,e,r,a);return function(d){return u.solve(d)}}let Gl=Su(.25,.1,.25,1);function Jt(t,e,r){return Math.min(r,Math.max(e,t))}function Ua(t,e,r){return(r=Jt((r-t)/(e-t),0,1))*r*(3-2*r)}function $a(t,e,r){let a=r-e,u=((t-e)%a+a)%a+e;return u===e?r:u}function Hl(t,e,r){if(!t.length)return r(null,[]);let a=t.length,u=new Array(t.length),d=null;t.forEach((p,_)=>{e(p,(y,b)=>{y&&(d=y),u[_]=b,--a==0&&r(d,u)})})}function mo(t){let e=[];for(let r in t)e.push(t[r]);return e}function _r(t,...e){for(let r of e)for(let a in r)t[a]=r[a];return t}let I1=1;function xd(){return I1++}function bd(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Kp(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Qp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function wd(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Du(t,e){return t.indexOf(e,t.length-e.length)!==-1}function ql(t,e,r){let a={};for(let u in t)a[u]=e.call(this,t[u],u,t);return a}function Ga(t,e,r){let a={};for(let u in t)e.call(this,t[u],u,t)&&(a[u]=t[u]);return a}function Ko(t){return Array.isArray(t)?t.map(Ko):typeof t=="object"&&t?ql(t,Ko):t}let Jp={};function Pi(t){Jp[t]||(typeof console<"u"&&console.warn(t),Jp[t]=!0)}function Qo(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Ir(t){let e=0;for(let r,a,u=0,d=t.length,p=d-1;u<d;p=u++)r=t[u],a=t[p],e+=(a.x-r.x)*(r.y+a.y);return e}function _s([t,e,r]){let a=dn(e+90),u=dn(r);return{x:t*Math.cos(a)*Math.sin(u),y:t*Math.sin(a)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:r}}function ir(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function em(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,d)=>{let p=u||d;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let tm,Td,Wl,Mu,ys,Au,Ed=null;function Ha(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Pu(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function nm(t,e,r,a){for(;e<r;){let u=e+r>>1;t[u]<a?e=u+1:r=u}return e}function wy(t,e,r,a){for(;e<r;){let u=e+r>>1;t[u]<=a?e=u+1:r=u}return e}function Id(t){return t>0?1/(1.001-t):1+t}function Cd(t){return t>0?1-1/(1.001-t):-t}function Zl(){return tm==null&&(tm=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),tm}let rr={now:()=>Mu!==void 0?Mu:performance.now(),setNow(t){Mu=t},restoreNow(){Mu=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:r,height:a}=t;ys||(ys=document.createElement("canvas"));let u=ys.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>ys.width||a>ys.height)&&(ys.width=r,ys.height=a),u.clearRect(-e,-e,r+2*e,a+2*e),u.drawImage(t,0,0,r,a),u.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:t=>(Td||(Td=document.createElement("a")),Td.href=t,Td.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Wl==null&&(Wl=window.matchMedia("(prefers-reduced-motion: reduce)")),Wl.matches)},hasCanvasFingerprintNoise(){if(Au!==void 0)return Au;if(!Zl())return Au=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),r=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);let a=e.getImageData(0,0,t.width,t.height);r=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&r++!==a.data[u])return Au=!0,!0;return Au=!1,!1}};function Sd(t,e){let r=t.indexOf("?");if(r<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(r));for(let u in e)a.set(u,e[u]);return`${t.slice(0,r)}?${a.toString()}`}function im(t,e={persistentParams:[]}){let r=t.indexOf("?");if(r<0)return t;let a=new URLSearchParams,u=new URLSearchParams(t.slice(r));for(let p of e.persistentParams){let _=u.get(p);_&&a.set(p,_)}let d=a.toString();return`${t.slice(0,r)}${d.length>0?`?${d}`:""}`}let Ty="mapbox-tiles",rm=500,om=50,vs,Dd;function Ey(){try{return caches}catch{}}function Ru(){let t=Ey();t&&!vs&&(vs=t.open(Ty))}let Md=1/0,Ad={supported:!1,testSupport:function(t){!sm&&Xl&&(am?Iy(t):Yl=t)}},Yl,Xl,sm=!1,am=!1,lm=typeof self<"u"?self:{};function Iy(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Xl),t.isContextLost())return;Ad.supported=!0}catch{}t.deleteTexture(e),sm=!0}lm.document&&(Xl=lm.document.createElement("img"),Xl.onload=function(){Yl&&Iy(Yl),Yl=null,am=!0},Xl.onerror=function(){sm=!0,Yl=null},Xl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Pd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Pd);class cm extends Error{constructor(e,r,a){r===401&&L(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Rd=ir()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ku=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Rd())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){let d=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Rd(),referrerPolicy:a.referrerPolicy,signal:d.signal}),_=!1,y=!1,b=(E=p.url).indexOf("sku=")>0&&L(E);var E;a.type==="json"&&p.headers.set("Accept","application/json");let S=(R,k,F)=>{if(y)return;if(R&&R.message!=="SecurityError"&&Pi(R.toString()),k&&F)return D(k);let z=Date.now();fetch(p).then(j=>{if(j.ok){let Y=b?j.clone():null;return D(j,Y,z)}return u(new cm(j.statusText,j.status,a.url))}).catch(j=>{j.name!=="AbortError"&&u(new Error(`${j.message} ${a.url}`))})},D=(R,k,F)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then(z=>{y||(k&&F&&function(j,Y,X){if(Ru(),!vs)return;let K=em(Y.headers.get("Cache-Control")||"");if(K["no-store"])return;let le={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((_e,Te)=>le.headers.set(Te,_e)),K["max-age"]&&le.headers.set("Expires",new Date(X+1e3*K["max-age"]).toUTCString());let se=le.headers.get("Expires");if(!se||new Date(se).getTime()-X<42e4)return;let me=im(j.url,{persistentParams:["language","worldview"]});if(Y.status===206){let _e=j.headers.get("Range");if(!_e)return;le.status=200,me=Sd(me,{range:_e})}(function(_e,Te){if(Dd===void 0)try{new Response(new ReadableStream),Dd=!0}catch{Dd=!1}Dd?Te(_e.body):_e.blob().then(Te)})(Y,_e=>{let Te=new Response((ke=Y.status)!==200&&ke!==404&&[101,103,204,205,304].includes(ke)?null:_e,le);var ke;Ru(),vs&&vs.then(De=>De.put(me,Te)).catch(De=>Pi(De.message))})}(p,k,F),_=!0,u(null,z,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(z=>{y||u(new Error(z.message))})};return b?function(R,k){if(Ru(),!vs)return k(null);vs.then(F=>{let z=im(R.url,{persistentParams:["language","worldview"]}),j=R.headers.get("Range");j&&(z=Sd(z,{range:j})),F.match(z).then(Y=>{let X=function(K){if(!K)return!1;let le=new Date(K.headers.get("Expires")||0),se=em(K.headers.get("Cache-Control")||"");return le>Date.now()&&!se["no-cache"]}(Y);F.delete(z),X&&F.put(z,Y.clone()),k(null,Y,X)}).catch(k)}).catch(k)}(p,S):S(null,null),{cancel:()=>{y=!0,_||d.abort()}}}(t,e);if(ir()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(a,u){let d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let p in a.headers)d.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(a.type==="json")try{p=JSON.parse(d.response)}catch(_){return u(_)}u(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new cm(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(t,e)},qa=function(t,e){return ku(_r(t,{type:"arrayBuffer"}),e)};function Cy(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let um="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ou,Lu;Ou=[],Lu=0;let na=function(t,e){if(Ad.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Lu>=A.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ou.push(d),d}Lu++;let r=!1,a=()=>{if(!r)for(r=!0,Lu--;Ou.length&&Lu<A.MAX_PARALLEL_IMAGE_REQUESTS;){let d=Ou.shift(),{requestParameters:p,callback:_,cancelled:y}=d;y||(d.cancel=na(p,_).cancel)}},u=qa(t,(d,p,_,y)=>{a(),d?e(d):p&&(self.createImageBitmap?function(b,E){let S=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(S).then(D=>{E(null,D)}).catch(D=>{E(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(b,E)=>e(b,E,_,y)):function(b,E){let S=new Image;S.onload=()=>{E(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=um})},S.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(b)],{type:"image/png"});S.src=b.byteLength?URL.createObjectURL(D):um}(p,(b,E)=>e(b,E,_,y)))});return{cancel:()=>{u.cancel(),a()}}},hm="01",dm="NO_ACCESS_TOKEN",C1=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mo(t){let e=t.match(C1);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Kl(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let kd="mapbox.eventData";function Sy(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Fu{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let r=Sy(A.ACCESS_TOKEN),a="";return a=r&&r.u?btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(+("0x"+d)))):A.ACCESS_TOKEN||"",e?`${kd}.${e}:${a}`:`${kd}:${a}`}fetchEventData(){let e=Ha("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let u=localStorage.getItem(r);u&&(this.eventData=JSON.parse(u));let d=localStorage.getItem(a);d&&(this.anonId=d)}catch{Pi("Unable to read from LocalStorage")}}saveEventData(){let e=Ha("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(a,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Pi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,u){if(!A.EVENTS_URL)return;let d=Mo(A.EVENTS_URL);d.params.push(`access_token=${u||A.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},_=r?_r(p,r):p,y={url:Kl(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,E){return ku(_r(b,{method:"POST"}),E)}(y,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(u)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}let Dy=new class extends Fu{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){A.EVENTS_URL&&A.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>U(r)||L(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Sy(A.ACCESS_TOKEN),r=e?e.u:A.ACCESS_TOKEN,a=r!==this.eventData.tokenU;Qp(this.anonId)||(this.anonId=bd(),a=!0);let u=this.queue.shift();if(this.eventData.lastSuccess){let d=new Date(this.eventData.lastSuccess),p=new Date(u),_=(u-this.eventData.lastSuccess)/864e5;a=a||_>=1||_<-1||d.getDate()!==p.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:hm,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=r)},t):this.processRequests()}},fm=Dy.postTurnstileEvent.bind(Dy),Nu=new class extends Fu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,a){this.skuToken=e,this.errorCb=a,A.EVENTS_URL&&(r||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(dm)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Qp(this.anonId)||(this.anonId=bd()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:hm,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},My=Nu.postMapLoadEvent.bind(Nu),Ay=new class extends Fu{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=bd(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:r,style:a,importedStyles:u}=e;if(!A.EVENTS_URL||!t&&!A.ACCESS_TOKEN)return;let d=this.getMapInstanceId(r),p={mapInstanceId:d,eventId:this.getEventId(d),style:a};u.length&&(p.importedStyles=u),this.queueRequest({timestamp:Date.now(),payload:p},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:r}=this.queue.shift();this.postEvent(e,r,()=>{},t)}},S1=Ay.postStyleLoadEvent.bind(Ay),Od=new class extends Fu{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){A.EVENTS_URL&&(t||A.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:r}=this.queue.shift(),a=function(u){let d=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),_=function(R){let k={};if(R){for(let F in R)if(F!=="other")for(let z of R[F]){let j=`${F}ResolveRangeMin`,Y=`${F}ResolveRangeMax`,X=`${F}RequestCount`,K=`${F}RequestCachedCount`;k[j]=Math.min(k[j]||1/0,z.startTime),k[Y]=Math.max(k[Y]||-1/0,z.responseEnd);let le=se=>{k[se]===void 0&&(k[se]=0),++k[se]};z.transferSize!==void 0&&z.transferSize===0&&le(K),le(X)}}return k}(function(R,k){let F={};if(R)for(let z of R){let j=k(z);F[j]===void 0&&(F[j]=[]),F[j].push(z)}return F}(d,Ke)),y=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=b?b.effectiveType:void 0,S={counters:[],metadata:[],attributes:[]},D=(R,k,F)=>{F!=null&&R.push({name:k,value:F.toString()})};for(let R in _)D(S.counters,R,_[R]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(D(S.counters,"interactionRangeMin",u.interactionRange[0]),D(S.counters,"interactionRangeMax",u.interactionRange[1])),p)for(let R of Object.keys(be)){let k=be[R],F=p.find(z=>z.name===k);F&&D(S.counters,k,F.startTime)}return D(S.counters,"visibilityHidden",u.visibilityHidden),D(S.attributes,"style",function(R){if(R)for(let k of R){let F=k.name.split("?")[0];if(he(F)){let z=F.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(d)),D(S.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),D(S.attributes,"fogEnabled",u.fogEnabled?"true":"false"),D(S.attributes,"projection",u.projection),D(S.attributes,"zoom",u.zoom),D(S.metadata,"devicePixelRatio",y),D(S.metadata,"connectionEffectiveType",E),D(S.metadata,"navigatorUserAgent",navigator.userAgent),D(S.metadata,"screenWidth",window.screen.width),D(S.metadata,"screenHeight",window.screen.height),D(S.metadata,"windowWidth",window.innerWidth),D(S.metadata,"windowHeight",window.innerHeight),D(S.metadata,"mapWidth",u.width/y),D(S.metadata,"mapHeight",u.height/y),D(S.metadata,"webglRenderer",u.renderer),D(S.metadata,"webglVendor",u.vendor),D(S.metadata,"sdkVersion",w),D(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(r);for(let u of a.metadata);for(let u of a.counters);for(let u of a.attributes);this.postEvent(e,a,()=>{},t)}},D1=Od.postPerformanceEvent.bind(Od),Ql=new class extends Fu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,a){if(!A.API_URL||!A.SESSION_PATH)return;let u=Mo(A.API_URL+A.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||A.ACCESS_TOKEN||""}`);let d={url:Kl(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,_){return ku(_r(p,{method:"GET"}),_)}(d,p=>{this.pendingRequest=null,r(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,r,a){this.skuToken=e,this.errorCb=a,A.SESSION_PATH&&A.API_URL&&(r||A.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(dm)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Ld=Ql.getSessionAPI.bind(Ql),zu=new Set;var Wa={exports:{}},Py={exports:function(t,e){var r,a,u,d,p,_,y,b;for(a=t.length-(r=3&t.length),u=e,p=3432918353,_=461845907,b=0;b<a;)y=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,u=27492+(65535&(d=5*(65535&(u=(u^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,r){case 3:y^=(255&t.charCodeAt(b+2))<<16;case 2:y^=(255&t.charCodeAt(b+1))<<8;case 1:u^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(b)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}},M1={exports:function(t,e){for(var r,a=t.length,u=e^a,d=0;a>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:u^=(255&t.charCodeAt(d+2))<<16;case 2:u^=(255&t.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}},Ry=Py.exports,pm=M1.exports;Wa.exports=Ry,Wa.exports.murmur3=Ry,Wa.exports.murmur2=pm;var Jl=Fe(Wa.exports);function mm(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function ec(t,e,r){if(r&&r[t]){let a=r[t].indexOf(e);a!==-1&&r[t].splice(a,1)}}class Fr{constructor(e,r={}){_r(this,r),this.type=e}}class Fd extends Fr{constructor(e,r={}){super("error",_r({error:e},r))}}class Za{on(e,r){return this._listeners=this._listeners||{},mm(e,r,this._listeners),this}off(e,r){return ec(e,r,this._listeners),ec(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},mm(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Fr(e,r||{}));let a=e.type;if(this.listens(a)){e.target=this;let u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let _ of u)_.call(this,e);let d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let _ of d)ec(a,_,this._oneTimeListeners),_.call(this,e);let p=this._eventedParent;p&&(_r(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Fd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}i.F=void 0;var ky={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Nd(t){return(t=Math.round(t))<0?0:t>255?255:t}function gm(t){return Nd(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Bu(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Vu(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{i.F={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in ky)return ky[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),u=r.indexOf(")");if(a!==-1&&u+1===r.length){var d=r.substr(0,a),p=r.substr(a+1,u-(a+1)).split(","),_=1;switch(d){case"rgba":if(p.length!==4)return null;_=Bu(p.pop());case"rgb":return p.length!==3?null:[gm(p[0]),gm(p[1]),gm(p[2]),_];case"hsla":if(p.length!==4)return null;_=Bu(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,b=Bu(p[1]),E=Bu(p[2]),S=E<=.5?E*(b+1):E+b-E*b,D=2*E-S;return[Nd(255*Vu(D,S,y+1/3)),Nd(255*Vu(D,S,y)),Nd(255*Vu(D,S,y-1/3)),_];default:return null}}return null}}catch{}class Tn{constructor(e,r,a,u=1){this.r=e,this.g=r,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof Tn)return e;if(typeof e!="string")return;let r=i.F(e);return r?new Tn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[e,r,a,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${u})`}toRenderColor(e){let{r,g:a,b:u,a:d}=this;return new A1(e,r,a,u,d)}}class A1{constructor(e,r,a,u,d){if(e){let p=e.image.height,_=p*p;r=d===0?0:r/d*(p-1),a=d===0?0:a/d*(p-1),u=d===0?0:u/d*(p-1);let y=Math.floor(r),b=Math.floor(a),E=Math.floor(u),S=Math.ceil(r),D=Math.ceil(a),R=Math.ceil(u),k=r-y,F=a-b,z=u-E,j=e.image.data,Y=4*(y+b*_+E*p),X=4*(y+b*_+R*p),K=4*(y+D*_+E*p),le=4*(y+D*_+R*p),se=4*(S+b*_+E*p),me=4*(S+b*_+R*p),_e=4*(S+D*_+E*p),Te=4*(S+D*_+R*p);if(Y<0||Te>=j.length)throw new Error("out of range");this.r=St(St(St(j[Y],j[X],z),St(j[K],j[le],z),F),St(St(j[se],j[me],z),St(j[_e],j[Te],z),F),k)/255*d,this.g=St(St(St(j[Y+1],j[X+1],z),St(j[K+1],j[le+1],z),F),St(St(j[se+1],j[me+1],z),St(j[_e+1],j[Te+1],z),F),k)/255*d,this.b=St(St(St(j[Y+2],j[X+2],z),St(j[K+2],j[le+2],z),F),St(St(j[se+2],j[me+2],z),St(j[_e+2],j[Te+2],z),F),k)/255*d,this.a=d}else this.r=r,this.g=a,this.b=u,this.a=d}toArray(){let{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*a/u,u]}toArray01(){let{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,a/u,u]}toArray01Scaled(e){let{r,g:a,b:u,a:d}=this;return d===0?[0,0,0]:[r/d*e,a/d*e,u/d*e]}toArray01PremultipliedAlpha(){let{r:e,g:r,b:a,a:u}=this;return[e,r,a,u]}toArray01Linear(){let{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(r/u,2.2),Math.pow(a/u,2.2),u]}}function St(t,e,r){return t*(1-r)+e*r}function Oy(t,e,r){return t.map((a,u)=>St(a,e[u],r))}Tn.black=new Tn(0,0,0,1),Tn.white=new Tn(1,1,1,1),Tn.transparent=new Tn(0,0,0,0),Tn.red=new Tn(1,0,0,1),Tn.blue=new Tn(0,0,1,1);var zd=Object.freeze({__proto__:null,array:Oy,color:function(t,e,r){return new Tn(St(t.r,e.r,r),St(t.g,e.g,r),St(t.b,e.b,r),St(t.a,e.a,r))},number:St});function _m(t,...e){for(let r of e)for(let a in r)t[a]=r[a];return t}class Jo extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class ym{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[a,u]of r)this.bindings[a]=u}concat(e){return new ym(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let tc={kind:"null"},dt={kind:"number"},En={kind:"string"},In={kind:"boolean"},Nr={kind:"color"},nc={kind:"object"},xn={kind:"value"},Ao={kind:"collator"},ic={kind:"formatted"},es={kind:"resolvedImage"};function qr(t,e){return{kind:"array",itemType:t,N:e}}function Ri(t){if(t.kind==="array"){let e=Ri(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let P1=[tc,dt,En,In,Nr,ic,nc,qr(xn),es];function ju(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ju(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let r of P1)if(!ju(r,e))return null}}return`Expected ${Ri(t)} but found ${Ri(e)} instead.`}function vm(t,e){return e.some(r=>r.kind===t.kind)}function rc(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}class Uu{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ya{constructor(e,r,a,u,d){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=d}}class yr{constructor(e){this.sections=e}static fromString(e){return new yr([new Ya(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof yr?e:yr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);let a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class zr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new zr({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ly(t,e,r,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,r,a]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Br(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Tn||t instanceof Uu||t instanceof yr||t instanceof zr)return!0;if(Array.isArray(t)){for(let e of t)if(!Br(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Br(t[e]))return!1;return!0}return!1}function ji(t){if(t===null)return tc;if(typeof t=="string")return En;if(typeof t=="boolean")return In;if(typeof t=="number")return dt;if(t instanceof Tn)return Nr;if(t instanceof Uu)return Ao;if(t instanceof yr)return ic;if(t instanceof zr)return es;if(Array.isArray(t)){let e=t.length,r;for(let a of t){let u=ji(a);if(r){if(r===u)continue;r=xn;break}r=u}return qr(r||xn,e)}return nc}function go(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Tn||t instanceof yr||t instanceof zr?t.toString():JSON.stringify(t)}class xs{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Br(e[1]))return r.error("invalid value");let a=e[1],u=ji(a),d=r.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new xs(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Tn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof yr?this.value.serialize():this.value}}class Zi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let xm={string:En,number:dt,boolean:In,object:nc};class Po{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1,d=e[0];if(d==="array"){let _,y;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in xm)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=xm[b],u++}else _=xn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=e[2],u++}a=qr(_,y)}else a=xm[d];let p=[];for(;u<e.length;u++){let _=r.parse(e[u],u,xn);if(!_)return null;p.push(_)}return new Po(a,p)}evaluate(e){for(let r=0;r<this.args.length;r++){let a=this.args[r].evaluate(e);if(!ju(this.type,ji(a)))return a;if(r===this.args.length-1)throw new Zi(`Expected value to be of type ${Ri(this.type)}, but found ${Ri(ji(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,r=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);let u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(a=>a.serialize()))}}class $u{constructor(e){this.type=ic,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");let u=[],d=!1;for(let p=1;p<=e.length-1;++p){let _=e[p];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let y=null;if(_["font-scale"]&&(y=r.parse(_["font-scale"],1,dt),!y))return null;let b=null;if(_["text-font"]&&(b=r.parse(_["text-font"],1,qr(En)),!b))return null;let E=null;if(_["text-color"]&&(E=r.parse(_["text-color"],1,Nr),!E))return null;let S=u[u.length-1];S.scale=y,S.font=b,S.textColor=E}else{let y=r.parse(e[p],1,xn);if(!y)return null;let b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:y,scale:null,font:null,textColor:null})}}return new $u(u)}evaluate(e){return new yr(this.sections.map(r=>{let a=r.content.evaluate(e);return ji(a)===es?new Ya("",a,null,null,null):new Ya(go(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let r of this.sections){e.push(r.content.serialize());let a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class Gu{constructor(e,r){this.type=es,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let a=r.parse(e[1],1,En);if(!a)return r.error("No image name provided.");if(e.length===2)return new Gu(a);let u=r.parse(e[2],1,En);return u?new Gu(a,u):r.error("Secondary image variant is not a string.")}evaluate(e){let r=zr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Xa(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let R1={"to-boolean":In,"to-color":Nr,"to-number":dt,"to-string":En};class Ro{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a=e[0],u=[],d=tc;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);d=qr(r.expectedType.itemType,p)}else{if(!(p>0&&Br(e[1][0])))return null;d=qr(ji(e[1][0]),p)}for(let _=0;_<p;_++){let y=e[1][_],b;if(Xa(y)==="array")b=r.parse(y,void 0,d.itemType);else{let E=Xa(y);if(E!==d.itemType.kind)return r.error(`Expected ${d.itemType.kind} but found ${E}.`);b=r.registry.literal.parse(["literal",y===void 0?null:y],r)}if(!b)return null;u.push(b)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");d=R1[a];for(let p=1;p<e.length;p++){let _=r.parse(e[p],p,xn);if(!_)return null;u.push(_)}}return new Ro(d,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(let u of this.args){if(r=u.evaluate(e),a=null,r instanceof Tn)return r;if(typeof r=="string"){let d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ly(r[0],r[1],r[2],r[3]),!a))return new Tn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Zi(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let a of this.args){if(r=a.evaluate(e),r===null)return 0;let u=Number(r);if(!isNaN(u))return u}throw new Zi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?yr.fromString(go(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?zr.fromString(go(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):go(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new $u([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Gu(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}let Fy=["Unknown","Point","LineString","Polygon"];class Ny{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Tn.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class Cr{constructor(e,r,a,u,d){this.name=e,this.type=r,this._evaluate=a,this.args=u,this._overloadIndex=d}evaluate(e){if(!this._evaluate){let r=Cr.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){let a=e[0],u=Cr.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=[],y=null,b=-1;for(let[E,S]of p){if(Array.isArray(E)&&E.length!==e.length-1)continue;_.push(E),b++,y=new Zy(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);let D=[],R=!1;for(let k=1;k<e.length;k++){let F=e[k],z=Array.isArray(E)?E[k-1]:E.type,j=y.parse(F,1+D.length,z);if(!j){R=!0;break}D.push(j)}if(!R)if(Array.isArray(E)&&E.length!==D.length)y.error(`Expected ${E.length} arguments, but found ${D.length} instead.`);else{for(let k=0;k<D.length;k++){let F=Array.isArray(E)?E[k]:E.type,z=D[k];y.concat(k+1).checkSubtype(F,z.type)}if(y.errors.length===0)return new Cr(a,d,S,D,b)}}if(_.length===1)r.errors.push(...y.errors);else{let E=(_.length?_:p.map(([D])=>D)).map(bm).join(" | "),S=[];for(let D=1;D<e.length;D++){let R=r.parse(e[D],1+S.length);if(!R)return null;S.push(Ri(R.type))}r.error(`Expected arguments of type ${E}, but found (${S.join(", ")}) instead.`)}return null}static register(e,r){Cr.definitions=r;for(let a in r)e[a]=Cr}}function bm(t){return Array.isArray(t)?`(${t.map(Ri).join(", ")})`:`(${Ri(t.type)}...)`}class ia{constructor(e,r,a){this.type=Ao,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");let u=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,In);if(!u)return null;let d=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,In);if(!d)return null;let p=null;return a.locale&&(p=r.parse(a.locale,1,En),!p)?null:new ia(u,d,p)}evaluate(e){return new Uu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var wm={exports:{}};wm.exports=function(){function t(a,u,d,p,_){for(;p>d;){if(p-d>600){var y=p-d+1,b=u-d+1,E=Math.log(y),S=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*S*(y-S)/y)*(b-y/2<0?-1:1);t(a,u,Math.max(d,Math.floor(u-b*S/y+D)),Math.min(p,Math.floor(u+(y-b)*S/y+D)),_)}var R=a[u],k=d,F=p;for(e(a,d,u),_(a[p],R)>0&&e(a,d,p);k<F;){for(e(a,k,F),k++,F--;_(a[k],R)<0;)k++;for(;_(a[F],R)>0;)F--}_(a[d],R)===0?e(a,d,F):e(a,++F,p),F<=u&&(d=F+1),u<=F&&(p=F-1)}}function e(a,u,d){var p=a[u];a[u]=a[d],a[d]=p}function r(a,u){return a<u?-1:a>u?1:0}return function(a,u,d,p,_){t(a,u,d||0,p||a.length-1,_||r)}}();var k1=Fe(wm.exports);function O1(t){let e=0;for(let r,a,u=0,d=t.length,p=d-1;u<d;p=u++)r=t[u],a=t[p],e+=(a.x-r.x)*(r.y+a.y);return e}function Hu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function oc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function L1(t,e,r){let a=t[0]-e[0],u=t[1]-e[1],d=t[0]-r[0],p=t[1]-r[1];return a*p-d*u==0&&a*d<=0&&u*p<=0}function sc(t,e,r=!1){let a=!1;for(let _=0,y=e.length;_<y;_++){let b=e[_];for(let E=0,S=b.length,D=S-1;E<S;D=E++){let R=b[D],k=b[E];if(L1(t,R,k))return r;(d=R)[1]>(u=t)[1]!=(p=k)[1]>u[1]&&u[0]<(p[0]-d[0])*(u[1]-d[1])/(p[1]-d[1])+d[0]&&(a=!a)}}var u,d,p;return a}function Tm(t,e,r,a){let u=a[0]-r[0],d=a[1]-r[1],p=(t[0]-r[0])*d-u*(t[1]-r[1]),_=(e[0]-r[0])*d-u*(e[1]-r[1]);return p>0&&_<0||p<0&&_>0}function yn(t,e,r,a){return(u=[a[0]-r[0],a[1]-r[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*d[0]!=0&&!(!Tm(t,e,r,a)||!Tm(r,a,t,e));var u,d}let bs=8192;function zy(t,e){let r=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*bs),Math.round(a*u*bs)]}function F1(t,e){for(let r=0;r<e.length;r++)if(sc(t,e[r]))return!0;return!1}function N1(t,e,r){for(let a of r)for(let u=0,d=a.length,p=d-1;u<d;p=u++)if(yn(t,e,a[p],a[u]))return!0;return!1}function qu(t,e){for(let r=0;r<t.length;++r)if(!sc(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(N1(t[r],t[r+1],e))return!1;return!0}function Bd(t,e){for(let r=0;r<e.length;r++)if(qu(t,e[r]))return!0;return!1}function ac(t,e,r){let a=[];for(let u=0;u<t.length;u++){let d=[];for(let p=0;p<t[u].length;p++){let _=zy(t[u][p],r);Hu(e,_),d.push(_)}a.push(d)}return a}function By(t,e,r){let a=[];for(let u=0;u<t.length;u++){let d=ac(t[u],e,r);a.push(d)}return a}function Em(t,e,r,a){if(t[0]<r[0]||t[0]>r[2]){let u=.5*a,d=t[0]-r[0]>u?-a:r[0]-t[0]>u?a:0;d===0&&(d=t[0]-r[2]>u?-a:r[2]-t[0]>u?a:0),t[0]+=d}Hu(e,t)}function ko(t,e,r,a){let u=Math.pow(2,a.z)*bs,d=[a.x*bs,a.y*bs],p=[];if(!t)return p;for(let _ of t)for(let y of _){let b=[y.x+d[0],y.y+d[1]];Em(b,e,r,u),p.push(b)}return p}function Vy(t,e,r,a){let u=Math.pow(2,a.z)*bs,d=[a.x*bs,a.y*bs],p=[];if(!t)return p;for(let y of t){let b=[];for(let E of y){let S=[E.x+d[0],E.y+d[1]];Hu(e,S),b.push(S)}p.push(b)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let y of p)for(let b of y)Em(b,e,r,u)}var _;return p}class ra{constructor(e,r){this.type=In,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Br(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){let d=a.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ra(a,a.features[u].geometry)}else if(a.type==="Feature"){let u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ra(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ra(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){let u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let _=ac(a.coordinates,d,p),y=ko(r.geometry(),u,d,p);if(!oc(u,d))return!1;for(let b of y)if(!sc(b,_))return!1}if(a.type==="MultiPolygon"){let _=By(a.coordinates,d,p),y=ko(r.geometry(),u,d,p);if(!oc(u,d))return!1;for(let b of y)if(!F1(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){let u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let _=ac(a.coordinates,d,p),y=Vy(r.geometry(),u,d,p);if(!oc(u,d))return!1;for(let b of y)if(!qu(b,_))return!1}if(a.type==="MultiPolygon"){let _=By(a.coordinates,d,p),y=Vy(r.geometry(),u,d,p);if(!oc(u,d))return!1;for(let b of y)if(!Bd(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let oa={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Vd=1/298.257223563,jy=Vd*(2-Vd),Wu=Math.PI/180;class Zu{static fromTile(e,r,a){let u=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),d=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Wu;return new Zu(d,a)}static get units(){return oa}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!oa[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(oa).join(", ")}`);let a=6378.137*Wu*(r?oa[r]:1),u=Math.cos(e*Wu),d=1/(1-jy*(1-u*u)),p=Math.sqrt(d);this.kx=a*p*u,this.ky=a*p*d*(1-jy)}distance(e,r){let a=_o(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(a*a+u*u)}bearing(e,r){let a=_o(r[0]-e[0])*this.kx;return Math.atan2(a,(r[1]-e[1])*this.ky)/Wu}destination(e,r,a){let u=a*Wu;return this.offset(e,Math.sin(u)*r,Math.cos(u)*r)}offset(e,r,a){return[e[0]+r/this.kx,e[1]+a/this.ky]}lineDistance(e){let r=0;for(let a=0;a<e.length-1;a++)r+=this.distance(e[a],e[a+1]);return r}area(e){let r=0;for(let a=0;a<e.length;a++){let u=e[a];for(let d=0,p=u.length,_=p-1;d<p;_=d++)r+=_o(u[d][0]-u[_][0])*(u[d][1]+u[_][1])*(a?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let a=0;if(r<=0)return e[0];for(let u=0;u<e.length-1;u++){let d=e[u],p=e[u+1],_=this.distance(d,p);if(a+=_,a>r)return Yu(d,p,(r-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,r,a){let[u,d]=r,p=_o(a[0]-u)*this.kx,_=(a[1]-d)*this.ky;if(p!==0||_!==0){let y=(_o(e[0]-u)*this.kx*p+(e[1]-d)*this.ky*_)/(p*p+_*_);y>1?(u=a[0],d=a[1]):y>0&&(u+=p/this.kx*y,d+=_/this.ky*y)}return p=_o(e[0]-u)*this.kx,_=(e[1]-d)*this.ky,Math.sqrt(p*p+_*_)}pointOnLine(e,r){let a=1/0,u=e[0][0],d=e[0][1],p=0,_=0;for(let y=0;y<e.length-1;y++){let b=e[y][0],E=e[y][1],S=_o(e[y+1][0]-b)*this.kx,D=(e[y+1][1]-E)*this.ky,R=0;S===0&&D===0||(R=(_o(r[0]-b)*this.kx*S+(r[1]-E)*this.ky*D)/(S*S+D*D),R>1?(b=e[y+1][0],E=e[y+1][1]):R>0&&(b+=S/this.kx*R,E+=D/this.ky*R)),S=_o(r[0]-b)*this.kx,D=(r[1]-E)*this.ky;let k=S*S+D*D;k<a&&(a=k,u=b,d=E,p=y,_=R)}return{point:[u,d],index:p,t:Math.max(0,Math.min(1,_))}}lineSlice(e,r,a){let u=this.pointOnLine(a,e),d=this.pointOnLine(a,r);if(u.index>d.index||u.index===d.index&&u.t>d.t){let b=u;u=d,d=b}let p=[u.point],_=u.index+1,y=d.index;!Im(a[_],p[0])&&_<=y&&p.push(a[_]);for(let b=_+1;b<=y;b++)p.push(a[b]);return Im(a[y],d.point)||p.push(d.point),p}lineSliceAlong(e,r,a){let u=0,d=[];for(let p=0;p<a.length-1;p++){let _=a[p],y=a[p+1],b=this.distance(_,y);if(u+=b,u>e&&d.length===0&&d.push(Yu(_,y,(e-(u-b))/b)),u>=r)return d.push(Yu(_,y,(r-(u-b))/b)),d;u>e&&d.push(y)}return d}bufferPoint(e,r){let a=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-a,e[0]+u,e[1]+a]}bufferBBox(e,r){let a=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-a,e[2]+u,e[3]+a]}insideBBox(e,r){return _o(e[0]-r[0])>=0&&_o(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function Im(t,e){return t[0]===e[0]&&t[1]===e[1]}function Yu(t,e,r){let a=_o(e[0]-t[0]);return[t[0]+a*r,t[1]+(e[1]-t[1])*r]}function _o(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var Xu={exports:{}};(function(t,e){t.exports=function(){var r=function(u,d){if(u===void 0&&(u=[]),d===void 0&&(d=a),this.data=u,this.length=this.data.length,this.compare=d,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function a(u,d){return u<d?-1:u>d?1:0}return r.prototype.push=function(u){this.data.push(u),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var u=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),u}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(u){for(var d=this.data,p=this.compare,_=d[u];u>0;){var y=u-1>>1,b=d[y];if(p(_,b)>=0)break;d[u]=b,u=y}d[u]=_},r.prototype._down=function(u){for(var d=this.data,p=this.compare,_=this.length>>1,y=d[u];u<_;){var b=1+(u<<1),E=d[b],S=b+1;if(S<this.length&&p(d[S],E)<0&&(b=S,E=d[S]),p(E,y)>=0)break;d[u]=E,u=b}d[u]=y},r}()})(Xu);var Cm=Fe(Xu.exports),rt=8192;function Uy(t,e){return e.dist-t.dist}let Sm=100,Dm=50;function $y(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function jd(t){return t[1]-t[0]+1}function ts(t,e){let r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function sa(t,e){if(t[0]>t[1])return[null,null];let r=jd(t);if(e){if(r===2)return[t,null];let a=Math.floor(r/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(r===1)return[t,null];let a=Math.floor(r/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function Ka(t,e){let r=[1/0,1/0,-1/0,-1/0];if(!ts(e,t.length))return r;for(let a=e[0];a<=e[1];++a)Hu(r,t[a]);return r}function Ud(t){let e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let a=0;a<t[r].length;++a)Hu(e,t[r][a]);return e}function aa(t,e,r){if($y(t)||$y(e))return NaN;let a=0,u=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),r.distance([0,0],[a,u])}function z1(t){return 360*t-180}function B1(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Mm(t,e){let r=Math.pow(2,e.z),a=(t.y/rt+e.y)/r;return[z1((t.x/rt+e.x)/r),B1(a)]}function V1(t,e){let r=[];for(let a=0;a<t.length;++a)r.push(Mm(t[a],e));return r}function Gy(t,e,r){let a=r.pointOnLine(e,t).point;return r.distance(t,a)}function la(t,e,r,a,u){let d=r.slice(a[0],a[1]+1),p=1/0;for(let _=e[0];_<=e[1];++_)if((p=Math.min(p,Gy(t[_],d,u)))===0)return 0;return p}function Am(t,e,r,a,u){let d=Math.min(u.pointToSegmentDistance(t,r,a),u.pointToSegmentDistance(e,r,a)),p=Math.min(u.pointToSegmentDistance(r,t,e),u.pointToSegmentDistance(a,t,e));return Math.min(d,p)}function j1(t,e,r,a,u){if(!ts(e,t.length)||!ts(a,r.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let _=a[0];_<a[1];++_){if(yn(t[p],t[p+1],r[_],r[_+1]))return 0;d=Math.min(d,Am(t[p],t[p+1],r[_],r[_+1],u))}return d}function Hy(t,e,r,a,u){if(!ts(e,t.length)||!ts(a,r.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let _=a[0];_<=a[1];++_)if((d=Math.min(d,u.distance(t[p],r[_])))===0)return d;return d}function qy(t,e,r){if(sc(t,e,!0))return 0;let a=1/0;for(let u of e){let d=u.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[d-1]&&(a=Math.min(a,r.pointToSegmentDistance(t,u[d-1],u[0])))===0||(a=Math.min(a,Gy(t,u,r)))===0)return a}return a}function Oo(t,e,r,a){if(!ts(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(sc(t[d],r,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d)for(let p of r)for(let _=0,y=p.length,b=y-1;_<y;b=_++){if(yn(t[d],t[d+1],p[b],p[_]))return 0;u=Math.min(u,Am(t[d],t[d+1],p[b],p[_],a))}return u}function Pm(t,e){for(let r of t)for(let a=0;a<=r.length-1;++a)if(sc(r[a],e,!0))return!0;return!1}function U1(t,e,r,a=1/0){let u=Ud(t),d=Ud(e);if(a!==1/0&&aa(u,d,r)>=a)return a;if(oc(u,d)){if(Pm(t,e))return 0}else if(Pm(e,t))return 0;let p=a;for(let _ of t)for(let y=0,b=_.length,E=b-1;y<b;E=y++)for(let S of e)for(let D=0,R=S.length,k=R-1;D<R;k=D++){if(yn(_[E],_[y],S[k],S[D]))return 0;p=Math.min(p,Am(_[E],_[y],S[k],S[D],r))}return p}function Ku(t,e,r,a,u,d,p){if(d===null||p===null)return;let _=aa(Ka(a,d),Ka(u,p),r);_<e&&t.push({dist:_,range1:d,range2:p})}function $d(t,e,r,a,u=1/0){let d=Math.min(a.distance(t[0],r[0][0]),u);if(d===0)return d;let p=new Cm([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Uy),_=e?Dm:Sm,y=Ud(r);for(;p.length;){let b=p.pop();if(b.dist>=d)continue;let E=b.range1;if(jd(E)<=_){if(!ts(E,t.length))return NaN;if(e){let S=Oo(t,E,r,a);if((d=Math.min(d,S))===0)return d}else for(let S=E[0];S<=E[1];++S){let D=qy(t[S],r,a);if((d=Math.min(d,D))===0)return d}}else{let S=sa(E,e);if(S[0]!==null){let D=aa(Ka(t,S[0]),y,a);D<d&&p.push({dist:D,range1:S[0],range2:[0,0]})}if(S[1]!==null){let D=aa(Ka(t,S[1]),y,a);D<d&&p.push({dist:D,range1:S[1],range2:[0,0]})}}}return d}function Wy(t,e,r,a,u,d=1/0){let p=Math.min(d,u.distance(t[0],r[0]));if(p===0)return p;let _=new Cm([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],Uy),y=e?Dm:Sm,b=a?Dm:Sm;for(;_.length;){let E=_.pop();if(E.dist>=p)continue;let S=E.range1,D=E.range2;if(jd(S)<=y&&jd(D)<=b){if(!ts(S,t.length)||!ts(D,r.length))return NaN;if(e&&a?p=Math.min(p,j1(t,S,r,D,u)):e||a?e&&!a?p=Math.min(p,la(r,D,t,S,u)):!e&&a&&(p=Math.min(p,la(t,S,r,D,u))):p=Math.min(p,Hy(t,S,r,D,u)),p===0)return p}else{let R=sa(S,e),k=sa(D,a);Ku(_,p,u,t,r,R[0],k[0]),Ku(_,p,u,t,r,R[0],k[1]),Ku(_,p,u,t,r,R[1],k[0]),Ku(_,p,u,t,r,R[1],k[1])}}return p}function Rm(t,e,r,a,u=1/0){let d=u,p=Ka(t,[0,t.length-1]);for(let _ of r)if(!(d!==1/0&&aa(p,Ka(_,[0,_.length-1]),a)>=d)&&(d=Math.min(d,Wy(t,e,_,!0,a,d)),d===0))return d;return d}function Gd(t,e,r,a,u=1/0){let d=u,p=Ka(t,[0,t.length-1]);for(let _ of r){if(d!==1/0&&aa(p,Ud(_),a)>=d)continue;let y=$d(t,e,_,a,d);if(isNaN(y))return y;if((d=Math.min(d,y))===0)return d}return d}function km(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Qa{constructor(e,r){this.type=dt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Br(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(km(a.features[u].geometry.type))return new Qa(a,a.features[u].geometry)}else if(a.type==="Feature"){if(km(a.geometry.type))return new Qa(a,a.geometry)}else if(km(a.type))return new Qa(a,a)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let r=e.geometry(),a=e.canonicalID();if(r!=null&&a!=null){if(e.geometryType()==="Point")return function(u,d,p){let _=[];for(let b of u)for(let E of b)_.push(Mm(E,d));let y=new Zu(_[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Wy(_,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?Rm(_,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?Gd(_,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(r,a,this.geometries);if(e.geometryType()==="LineString")return function(u,d,p){let _=[];for(let b of u){let E=[];for(let S of b)E.push(Mm(S,d));_.push(E)}let y=new Zu(_[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Rm(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let b=1/0;for(let E=0;E<p.coordinates.length;E++){let S=Rm(p.coordinates[E],!0,_,y,b);if(isNaN(S))return S;if((b=Math.min(b,S))===0)return b}return b}if(p.type==="Polygon"||p.type==="MultiPolygon"){let b=1/0;for(let E=0;E<_.length;E++){let S=Gd(_[E],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,b);if(isNaN(S))return S;if((b=Math.min(b,S))===0)return b}return b}return null}(r,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,d,p){let _=[];for(let b of function(E,S){let D=E.length;if(D<=1)return[E];let R=[],k,F;for(let z=0;z<D;z++){let j=O1(E[z]);j!==0&&(E[z].area=Math.abs(j),F===void 0&&(F=j<0),F===j<0?(k&&R.push(k),k=[E[z]]):k.push(E[z]))}return k&&R.push(k),R}(u)){let E=[];for(let S=0;S<b.length;++S)E.push(V1(b[S],d));_.push(E)}let y=new Zu(_[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Gd(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let b=1/0;for(let E=0;E<p.coordinates.length;E++){let S=Gd(p.coordinates[E],!0,_,y,b);if(isNaN(S))return S;if((b=Math.min(b,S))===0)return b}return b}return p.type==="Polygon"||p.type==="MultiPolygon"?function(b,E,S){let D=1/0;for(let R of b)for(let k of E){let F=U1(R,k,S,D);if(isNaN(F))return F;if((D=Math.min(D,F))===0)return D}return D}(p.type==="Polygon"?[p.coordinates]:p.coordinates,_,y):null}(r,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function lc(t,e){switch(t){case"string":return go(e);case"number":return+e;case"boolean":return!!e;case"color":return Tn.parse(e);case"formatted":return yr.fromString(go(e));case"resolvedImage":return zr.fromString(go(e))}return e}function Qu(t,e,r,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),r!==void 0&&t>r&&(t=r),t}class or{constructor(e,r,a){this.type=e,this.key=r,this.scope=a}static parse(e,r){let a=r.expectedType;if(a==null&&(a=xn),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");let u=r.parse(e[1],1);if(!(u instanceof xs))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let d=r.parse(e[2],2);return d instanceof xs?new or(a,go(u.value),go(d.value)):r.error("Scope of 'config' expression must be a string literal.")}return new or(a,go(u.value))}evaluate(e){let r=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(r);if(!a)return null;let{type:u,value:d,values:p,minValue:_,maxValue:y,stepValue:b}=a,E=a.default.evaluate(e),S=E;if(d){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),S=d.evaluate(e),e.scope=D}return u&&(S=lc(u,S)),S===void 0||_===void 0&&y===void 0&&b===void 0||(typeof S=="number"?S=Qu(S,_,y,b):Array.isArray(S)&&(S=S.map(D=>typeof D=="number"?Qu(D,_,y,b):D))),d!==void 0&&S!==void 0&&p&&!p.includes(S)&&(S=E,u&&(S=lc(u,S))),(u&&u!==this.type||S!==void 0&&ji(S)!==this.type)&&(S=lc(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function ca(t){if(t instanceof Cr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ra||t instanceof Qa)return!1;let e=!0;return t.eachChild(r=>{e&&!ca(r)&&(e=!1)}),e}function Hd(t){if(t instanceof Cr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!Hd(r)&&(e=!1)}),e}function Om(t){if(t instanceof or)return!1;let e=!0;return t.eachChild(r=>{e&&!Om(r)&&(e=!1)}),e}function Ju(t,e){if(t instanceof Cr&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(a=>{r&&!Ju(a,e)&&(r=!1)}),r}class qd{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let a=e[1];return r.scope.has(a)?new qd(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class eh{constructor(e,r=[],a,u=new ym,d=[],p,_){this.registry=e,this.path=r,this.key=r.map(y=>`[${y}]`).join(""),this.scope=u,this.errors=d,this.expectedType=a,this._scope=p,this.options=_}parse(e,r,a,u,d={}){return r||a?this.concat(r,a,u)._parse(e,d):this._parse(e,d)}_parse(e,r){function a(u,d,p){return p==="assert"?new Po(d,[u]):p==="coerce"?new Ro(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){let p=this.expectedType,_=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||_.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(p,_))return null}else d=a(d,p,r.typeAnnotation||"coerce");else d=a(d,p,r.typeAnnotation||"assert")}if(!(d instanceof xs)&&d.type.kind!=="resolvedImage"&&th(d)){let p=new Ny(this._scope,this.options);try{d=new xs(d.type,d.evaluate(p))}catch(_){return this.error(_.message),null}}return d}return Ro.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){let u=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new eh(this.registry,u,r||null,d,this.errors,this._scope,this.options)}error(e,...r){let a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Jo(a,e))}checkSubtype(e,r){let a=ju(e,r);return a&&this.error(a),a}}var Zy=eh;function th(t){if(t instanceof qd)return th(t.boundExpression);if(t instanceof Cr&&t.name==="error"||t instanceof ia||t instanceof ra||t instanceof Qa||t instanceof or)return!1;let e=t instanceof Ro||t instanceof Po,r=!0;return t.eachChild(a=>{r=e?r&&th(a):r&&a instanceof xs}),!!r&&ca(t)&&Ju(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Wd(t,e){let r=t.length-1,a,u,d=0,p=r,_=0;for(;d<=p;)if(_=Math.floor((d+p)/2),a=t[_],u=t[_+1],a<=e){if(_===r||e<u)return _;d=_+1}else{if(!(a>e))throw new Zi("Input is not a number.");p=_-1}return 0}class nh{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[u,d]of a)this.labels.push(u),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let a=r.parse(e[1],1,dt);if(!a)return null;let u=[],d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let p=1;p<e.length;p+=2){let _=p===1?-1/0:e[p],y=e[p+1],b=p,E=p+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let S=r.parse(y,E,d);if(!S)return null;d=d||S.type,u.push([_,S])}return new nh(d,a,u)}evaluate(e){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);let u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);let d=r.length;return u>=r[d-1]?a[d-1].evaluate(e):a[Wd(r,u)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}let Zd=.95047,Yy=1.08883,Lm=4/29,Ja=6/29,Xy=3*Ja*Ja,Fm=Ja*Ja*Ja,Yd=Math.PI/180,Ky=180/Math.PI;function Nm(t){return t>Fm?Math.pow(t,1/3):t/Xy+Lm}function Xd(t){return t>Ja?t*t*t:Xy*(t-Lm)}function zm(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ih(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qy(t){let e=ih(t.r),r=ih(t.g),a=ih(t.b),u=Nm((.4124564*e+.3575761*r+.1804375*a)/Zd),d=Nm((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-Nm((.0193339*e+.119192*r+.9503041*a)/Yy)),alpha:t.a}}function Jy(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*Xd(e),r=Zd*Xd(r),a=Yy*Xd(a),new Tn(zm(3.2404542*r-1.5371385*e-.4985314*a),zm(-.969266*r+1.8760108*e+.041556*a),zm(.0556434*r-.2040259*e+1.0572252*a),t.alpha)}function $1(t,e,r){let a=e-t;return t+r*(a>180||a<-180?a-360*Math.round(a/360):a)}let rh={forward:Qy,reverse:Jy,interpolate:function(t,e,r){return{l:St(t.l,e.l,r),a:St(t.a,e.a,r),b:St(t.b,e.b,r),alpha:St(t.alpha,e.alpha,r)}}},cc={forward:function(t){let{l:e,a:r,b:a}=Qy(t),u=Math.atan2(a,r)*Ky;return{h:u<0?u+360:u,c:Math.sqrt(r*r+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Yd,r=t.c;return Jy({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:$1(t.h,e.h,r),c:St(t.c,e.c,r),l:St(t.l,e.l,r),alpha:St(t.alpha,e.alpha,r)}}};var e0=Object.freeze({__proto__:null,hcl:cc,lab:rh});class eo{constructor(e,r,a,u,d){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(let[p,_]of d)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,r,a,u){let d=0;if(e.name==="exponential")d=Bm(r,e.base,a,u);else if(e.name==="linear")d=Bm(r,1,a,u);else if(e.name==="cubic-bezier"){let p=e.controlPoints;d=new Iu(p[0],p[1],p[2],p[3]).solve(Bm(r,1,a,u))}return d}static parse(e,r){let[a,u,d,...p]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){let b=u[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:b}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{let b=u.slice(1);if(b.length!==4||b.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,dt),!d)return null;let _=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=Nr:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let b=0;b<p.length;b+=2){let E=p[b],S=p[b+1],D=b+3,R=b+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let k=r.parse(S,R,y);if(!k)return null;y=y||k.type,_.push([E,k])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new eo(y,a,u,d,_):r.error(`Type ${Ri(y)} is not interpolatable.`)}evaluate(e){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);let u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);let d=r.length;if(u>=r[d-1])return a[d-1].evaluate(e);let p=Wd(r,u),_=eo.interpolationFactor(this.interpolation,u,r[p],r[p+1]),y=a[p].evaluate(e),b=a[p+1].evaluate(e);return this.operator==="interpolate"?zd[this.type.kind.toLowerCase()](y,b,_):this.operator==="interpolate-hcl"?cc.reverse(cc.interpolate(cc.forward(y),cc.forward(b),_)):rh.reverse(rh.interpolate(rh.forward(y),rh.forward(b),_))}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Bm(t,e,r,a){let u=a-r,d=t-r;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}class Kd{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null,u=r.expectedType;u&&u.kind!=="value"&&(a=u);let d=[];for(let _ of e.slice(1)){let y=r.parse(_,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,d.push(y)}let p=u&&d.some(_=>ju(u,_.type));return new Kd(p?xn:a,d)}evaluate(e){let r,a=null,u=0;for(let d of this.args){if(u++,a=d.evaluate(e),a&&a instanceof zr&&!a.available&&(r||(r=a),a=null,u===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Qd{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let d=1;d<e.length-1;d+=2){let p=e[d];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);let _=r.parse(e[d+1],d+1);if(!_)return null;a.push([p,_])}let u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new Qd(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}class Vm{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,dt),u=r.parse(e[2],2,qr(r.expectedType||xn));return a&&u?new Vm(u.type.itemType,a,u):null}evaluate(e){let r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Zi(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Zi(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Zi(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class jm{constructor(e,r){this.type=In,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,xn),u=r.parse(e[2],2,xn);return a&&u?vm(a.type,[In,En,dt,tc,xn])?new jm(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(a.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!rc(r,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(ji(r))} instead.`);if(!rc(a,["string","array"]))throw new Zi(`Expected second argument to be of type array or string, but found ${Ri(ji(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Jd{constructor(e,r,a){this.type=dt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,xn),u=r.parse(e[2],2,xn);if(!a||!u)return null;if(!vm(a.type,[In,En,dt,tc,xn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(a.type)} instead`);if(e.length===4){let d=r.parse(e[3],3,dt);return d?new Jd(a,u,d):null}return new Jd(a,u)}evaluate(e){let r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!rc(r,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(ji(r))} instead.`);if(!rc(a,["string","array"]))throw new Zi(`Expected second argument to be of type array or string, but found ${Ri(ji(a))} instead.`);if(this.fromIndex){let u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class uc{constructor(e,r,a,u,d,p){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=d,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);let d={},p=[];for(let b=2;b<e.length-1;b+=2){let E=e[b],S=e[b+1];Array.isArray(E)||(E=[E]);let D=r.concat(b);if(E.length===0)return D.error("Expected at least one branch label.");for(let k of E){if(typeof k!="number"&&typeof k!="string")return D.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,ji(k)))return null}else a=ji(k);if(d[String(k)]!==void 0)return D.error("Branch labels must be unique.");d[String(k)]=p.length}let R=r.parse(S,b,u);if(!R)return null;u=u||R.type,p.push(R)}let _=r.parse(e[1],1,xn);if(!_)return null;let y=r.parse(e[e.length-1],e.length-1,u);return y?_.type.kind!=="value"&&r.concat(1).checkSubtype(a,_.type)?null:new uc(a,u,_,d,p,y):null}evaluate(e){let r=this.input.evaluate(e);return(ji(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],u={};for(let p of r){let _=u[this.cases[p]];_===void 0?(u[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[_][1].push(p)}let d=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,_]of a)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Um{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);let u=[];for(let p=1;p<e.length-1;p+=2){let _=r.parse(e[p],p,In);if(!_)return null;let y=r.parse(e[p+1],p+1,a);if(!y)return null;u.push([_,y]),a=a||y.type}let d=r.parse(e[e.length-1],e.length-1,a);return d?new Um(a,u,d):null}evaluate(e){for(let[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ef{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,xn),u=r.parse(e[2],2,dt);if(!a||!u)return null;if(!vm(a.type,[qr(xn),En,xn]))return r.error(`Expected first argument to be of type array or string, but found ${Ri(a.type)} instead`);if(e.length===4){let d=r.parse(e[3],3,dt);return d?new ef(a.type,a,u,d):null}return new ef(a.type,a,u)}evaluate(e){let r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!rc(r,["string","array"]))throw new Zi(`Expected first argument to be of type array or string, but found ${Ri(ji(r))} instead.`);if(this.endIndex){let u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function oh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function t0(t,e,r,a){return a.compare(e,r)===0}function el(t,e,r){let a=t!=="=="&&t!=="!=";return class L3{constructor(d,p,_){this.type=In,this.lhs=d,this.rhs=p,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");let _=d[0],y=p.parse(d[1],1,xn);if(!y)return null;if(!oh(_,y.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${Ri(y.type)}'.`);let b=p.parse(d[2],2,xn);if(!b)return null;if(!oh(_,b.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${Ri(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${Ri(y.type)}' and '${Ri(b.type)}'.`);a&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new Po(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new Po(y.type,[b])));let E=null;if(d.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(d[3],3,Ao),!E)return null}return new L3(y,b,E)}evaluate(d){let p=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){let y=ji(p),b=ji(_);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new Zi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=ji(p),b=ji(_);if(y.kind!=="string"||b.kind!=="string")return e(d,p,_)}return this.collator?r(d,p,_,this.collator.evaluate(d)):e(d,p,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[t];return this.eachChild(p=>{d.push(p.serialize())}),d}}}let G1=el("==",function(t,e,r){return e===r},t0),n0=el("!=",function(t,e,r){return e!==r},function(t,e,r,a){return!t0(0,e,r,a)}),i0=el("<",function(t,e,r){return e<r},function(t,e,r,a){return a.compare(e,r)<0}),r0=el(">",function(t,e,r){return e>r},function(t,e,r,a){return a.compare(e,r)>0}),o0=el("<=",function(t,e,r){return e<=r},function(t,e,r,a){return a.compare(e,r)<=0}),$m=el(">=",function(t,e,r){return e>=r},function(t,e,r,a){return a.compare(e,r)>=0});class sh{constructor(e,r,a,u,d,p){this.type=En,this.number=e,this.locale=r,this.currency=a,this.unit=u,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let a=r.parse(e[1],1,dt);if(!a)return null;let u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=r.parse(u.locale,1,En),!d))return null;let p=null;if(u.currency&&(p=r.parse(u.currency,1,En),!p))return null;let _=null;if(u.unit&&(_=r.parse(u.unit,1,En),!_))return null;let y=null;if(u["min-fraction-digits"]&&(y=r.parse(u["min-fraction-digits"],1,dt),!y))return null;let b=null;return u["max-fraction-digits"]&&(b=r.parse(u["max-fraction-digits"],1,dt),!b)?null:new sh(a,d,p,_,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Gm{constructor(e){this.type=dt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ri(a.type)} instead.`):new Gm(a):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Zi(`Expected value to be of type string or array, but found ${Ri(ji(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function s0(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let tl={"==":G1,"!=":n0,">":r0,"<":i0,">=":$m,"<=":o0,array:Po,at:Vm,boolean:Po,case:Um,coalesce:Kd,collator:ia,format:$u,image:Gu,in:jm,"index-of":Jd,interpolate:eo,"interpolate-hcl":eo,"interpolate-lab":eo,length:Gm,let:Qd,literal:xs,match:uc,number:Po,"number-format":sh,object:Po,slice:ef,step:nh,string:Po,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:qd,within:ra,distance:Qa,config:or};function a0(t,[e,r,a,u]){e=e.evaluate(t),r=r.evaluate(t),a=a.evaluate(t);let d=u?u.evaluate(t):1,p=Ly(e,r,a,d);if(p)throw new Zi(p);return new Tn(e/255*d,r/255*d,a/255*d,d)}function l0(t,[e,r,a,u]){e=e.evaluate(t),r=r.evaluate(t),a=a.evaluate(t);let d=u?u.evaluate(t):1,p=function(b,E,S,D){return typeof b=="number"&&b>=0&&b<=360?typeof E=="number"&&E>=0&&E<=100&&typeof S=="number"&&S>=0&&S<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[b,E,S,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[b,E,S,D]:[b,E,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[b,E,S,D]:[b,E,S]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,a,d);if(p)throw new Zi(p);let _=`hsla(${e}, ${r}%, ${a}%, ${d})`,y=Tn.parse(_);if(!y)throw new Zi(`Failed to parse HSLA color: ${_}`);return y}function c0(t,e){return t in e}function Hm(t,e){let r=e[t];return r===void 0?null:r}function nl(t){return{type:t}}function u0(t){return{result:"success",value:t}}function il(t){return{result:"error",value:t}}function h0(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function tf(t){return t["property-type"]==="data-driven"}function H1(t){return h0(t.expression,"measure-light")}function m(t){return h0(t.expression,"zoom")}function s(t){return!!t.expression&&t.expression.interpolated}function h(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function v(t,e){let r=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",u=a||!(a||t.property!==void 0),d=t.type||(s(e)?"exponential":"interval");if(r&&((t=_m({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],Tn.parse(b[1])])),t.default=Tn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!e0[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,_,y;if(d==="exponential")p=M;else if(d==="interval")p=I;else if(d==="categorical"){p=T,_=Object.create(null);for(let b of t.stops)_[b[0]]=b[1];y=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=P}if(a){let b={},E=[];for(let R=0;R<t.stops.length;R++){let k=t.stops[R],F=k[0].zoom;b[F]===void 0&&(b[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},E.push(F)),b[F].stops.push([k[0].value,k[1]])}let S=[];for(let R of E)S.push([b[R].zoom,v(b[R],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:eo.interpolationFactor.bind(void 0,D),zoomStops:S.map(R=>R[0]),evaluate:({zoom:R},k)=>M({stops:S,base:t.base},e,R).evaluate(R,k)}}if(u){let b=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:eo.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>p(t,e,E,_,y)}}return{kind:"source",evaluate(b,E){let S=E&&E.properties?E.properties[t.property]:void 0;return S===void 0?x(t.default,e.default):p(t,e,S,_,y)}}}function x(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function T(t,e,r,a,u){return x(typeof r===u?a[r]:void 0,t.default,e.default)}function I(t,e,r){if(Xa(r)!=="number")return x(t.default,e.default);let a=t.stops.length;if(a===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[a-1][0])return t.stops[a-1][1];let u=Wd(t.stops.map(d=>d[0]),r);return t.stops[u][1]}function M(t,e,r){let a=t.base!==void 0?t.base:1;if(Xa(r)!=="number")return x(t.default,e.default);let u=t.stops.length;if(u===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[u-1][0])return t.stops[u-1][1];let d=Wd(t.stops.map(E=>E[0]),r),p=function(E,S,D,R){let k=R-D,F=E-D;return k===0?0:S===1?F/k:(Math.pow(S,F)-1)/(Math.pow(S,k)-1)}(r,a,t.stops[d][0],t.stops[d+1][0]),_=t.stops[d][1],y=t.stops[d+1][1],b=zd[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let E=e0[t.colorSpace];b=(S,D)=>E.reverse(E.interpolate(E.forward(S),E.forward(D),p))}return typeof _.evaluate=="function"?{evaluate(...E){let S=_.evaluate.apply(void 0,E),D=y.evaluate.apply(void 0,E);if(S!==void 0&&D!==void 0)return b(S,D,p)}}:b(_,y,p)}function P(t,e,r){return e.type==="color"?r=Tn.parse(r):e.type==="formatted"?r=yr.fromString(r.toString()):e.type==="resolvedImage"?r=zr.fromString(r.toString()):Xa(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),x(r,t.default,e.default)}Cr.register(tl,{error:[{kind:"error"},[En],(t,[e])=>{throw new Zi(e.evaluate(t))}],typeof:[En,[xn],(t,[e])=>Ri(ji(e.evaluate(t)))],"to-rgba":[qr(dt,4),[Nr],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[Nr,[dt,dt,dt],a0],rgba:[Nr,[dt,dt,dt,dt],a0],hsl:[Nr,[dt,dt,dt],l0],hsla:[Nr,[dt,dt,dt,dt],l0],has:{type:In,overloads:[[[En],(t,[e])=>c0(e.evaluate(t),t.properties())],[[En,nc],(t,[e,r])=>c0(e.evaluate(t),r.evaluate(t))]]},get:{type:xn,overloads:[[[En],(t,[e])=>Hm(e.evaluate(t),t.properties())],[[En,nc],(t,[e,r])=>Hm(e.evaluate(t),r.evaluate(t))]]},"feature-state":[xn,[En],(t,[e])=>Hm(e.evaluate(t),t.featureState||{})],properties:[nc,[],t=>t.properties()],"geometry-type":[En,[],t=>t.geometryType()],id:[xn,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],pitch:[dt,[],t=>t.globals.pitch||0],"distance-from-center":[dt,[],t=>t.distanceFromCenter()],"measure-light":[dt,[En],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],"raster-value":[dt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[dt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[dt,[],t=>t.globals.skyRadialProgress||0],accumulated:[xn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[dt,nl(dt),(t,e)=>{let r=0;for(let a of e)r+=a.evaluate(t);return r}],"*":[dt,nl(dt),(t,e)=>{let r=1;for(let a of e)r*=a.evaluate(t);return r}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[dt,[dt,dt],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,nl(dt),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[dt,nl(dt),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{let r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[In,[En,xn],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[In,[xn],(t,[e])=>t.id()===e.value],"filter-type-==":[In,[En],(t,[e])=>t.geometryType()===e.value],"filter-<":[In,[En,xn],(t,[e,r])=>{let a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[In,[xn],(t,[e])=>{let r=t.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[In,[En,xn],(t,[e,r])=>{let a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[In,[xn],(t,[e])=>{let r=t.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[In,[En,xn],(t,[e,r])=>{let a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[In,[xn],(t,[e])=>{let r=t.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[In,[En,xn],(t,[e,r])=>{let a=t.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[In,[xn],(t,[e])=>{let r=t.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[In,[xn],(t,[e])=>e.value in t.properties()],"filter-has-id":[In,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[In,[qr(En)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[In,[qr(xn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[In,[En,qr(xn)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[In,[En,qr(xn)],(t,[e,r])=>function(a,u,d,p){for(;d<=p;){let _=d+p>>1;if(u[_]===a)return!0;u[_]>a?p=_-1:d=_+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:In,overloads:[[[In,In],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[nl(In),(t,e)=>{for(let r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:In,overloads:[[[In,In],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[nl(In),(t,e)=>{for(let r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[In,[In],(t,[e])=>!e.evaluate(t)],"is-supported-script":[In,[En],(t,[e])=>{let r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[En,[En],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[En,[En],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[En,nl(xn),(t,e)=>e.map(r=>go(r.evaluate(t))).join("")],"resolved-locale":[En,[Ao],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[dt,[dt,dt,xn],(t,e)=>{let[r,a,u]=e.map(p=>p.evaluate(t));if(r>a||r===a)return r;let d;if(typeof u=="string")d=function(p){let _=0;if(p.length===0)return _;for(let y=0;y<p.length;y++)_=(_<<5)-_+p.charCodeAt(y),_|=0;return _}(u);else{if(typeof u!="number")throw new Zi(`Invalid seed input: ${u}`);d=u}return r+s0(d)()*(a-r)}]});class O{constructor(e,r,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Ny(a,u),this._defaultValue=r?function(d){return d.type==="color"&&(h(d.default)||Array.isArray(d.default))?new Tn(0,0,0,0):d.type==="color"?Tn.parse(d.default)||null:d.default===void 0?null:d.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,u,d,p,_,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,d,p,_,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Zi(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function N(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in tl}function B(t,e,r,a){let u=new Zy(tl,[],e?function(p){let _={color:Nr,string:En,number:dt,enum:En,boolean:In,formatted:ic,resolvedImage:es};return p.type==="array"?qr(_[p.value]||xn,p.length):_[p.type]}(e):void 0,void 0,void 0,r,a),d=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?u0(new O(d,e,r,a)):il(u.errors)}class V{constructor(e,r,a){this.kind=e,this._styleExpression=r,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!Hd(r.expression),this.isConfigDependent=!Om(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,d,p)}evaluate(e,r,a,u,d,p){return this._styleExpression.evaluate(e,r,a,u,d,p)}}class G{constructor(e,r,a,u,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Hd(r.expression),this.isLightConstant=d,this.isConfigDependent=!Om(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,d,p)}evaluate(e,r,a,u,d,p){return this._styleExpression.evaluate(e,r,a,u,d,p)}interpolationFactor(e,r,a){return this.interpolationType?eo.interpolationFactor(this.interpolationType,e,r,a):0}}function H(t,e,r,a){if((t=B(t,e,r,a)).result==="error")return t;let u=t.value.expression,d=ca(u);if(!d&&!tf(e))return il([new Jo("","data expressions not supported")]);let p=Ju(u,["zoom","pitch","distance-from-center"]);if(!p&&!m(e))return il([new Jo("","zoom expressions not supported")]);let _=Ju(u,["measure-light"]);if(!_&&!H1(e))return il([new Jo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,b=W(u);return b||p||y?b instanceof Jo?il([b]):b instanceof eo&&!s(e)?il([new Jo("",'"interpolate" expressions cannot be used with this property')]):u0(b?new G(d?"camera":"composite",t.value,b.labels,b instanceof eo?b.interpolation:void 0,_):new V(d?"constant":"source",t.value,_)):il([new Jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class q{constructor(e,r){this._parameters=e,this._specification=r,_m(this,v(this._parameters,this._specification))}static deserialize(e){return new q(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function W(t){let e=null;if(t instanceof Qd)e=W(t.result);else if(t instanceof Kd){for(let r of t.args)if(e=W(r),e)break}else(t instanceof nh||t instanceof eo)&&t.input instanceof Cr&&t.input.name==="zoom"&&(e=t);return e instanceof Jo||t.eachChild(r=>{let a=W(r);a instanceof Jo?e=a:e&&a&&e!==a&&(e=new Jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ee=ne,te=3;function ne(t,e,r){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var d=0;d<this.d*this.d;d++){var p=u[te+d],_=u[te+d+1];a.push(p===_?null:u.subarray(p,_))}var y=u[te+a.length+1];this.keys=u.subarray(u[te+a.length],y),this.bboxes=u.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var E=r/e*t;this.min=-E,this.max=t+E}ne.prototype.insert=function(t,e,r,a,u){this._forEachCell(e,r,a,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u)},ne.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ne.prototype._insertCell=function(t,e,r,a,u,d){this.cells[u].push(d)},ne.prototype.query=function(t,e,r,a,u){var d=this.min,p=this.max;if(t<=d&&e<=d&&p<=r&&p<=a&&!u)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,r,a,this._queryCell,_,{},u),_},ne.prototype._queryCell=function(t,e,r,a,u,d,p,_){var y=this.cells[u];if(y!==null)for(var b=this.keys,E=this.bboxes,S=0;S<y.length;S++){var D=y[S];if(p[D]===void 0){var R=4*D;(_?_(E[R+0],E[R+1],E[R+2],E[R+3]):t<=E[R+2]&&e<=E[R+3]&&r>=E[R+0]&&a>=E[R+1])?(p[D]=!0,d.push(b[D])):p[D]=!1}}},ne.prototype._forEachCell=function(t,e,r,a,u,d,p,_){for(var y=this._convertToCellCoord(t),b=this._convertToCellCoord(e),E=this._convertToCellCoord(r),S=this._convertToCellCoord(a),D=y;D<=E;D++)for(var R=b;R<=S;R++){var k=this.d*R+D;if((!_||_(this._convertFromCellCoord(D),this._convertFromCellCoord(R),this._convertFromCellCoord(D+1),this._convertFromCellCoord(R+1)))&&u.call(this,t,e,r,a,k,d,p,_))return}},ne.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ne.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ne.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=te+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,p=0;p<t.length;p++){var _=t[p];u[te+p]=d,u.set(_,d),d+=_.length}return u[te+t.length]=d,u.set(this.keys,d),u[te+t.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};var ue=Fe(ee);let ce={};function J(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),ce[e]={klass:t,omit:r.omit||[]}}J(Object,"Object"),ue.serialize=function(t,e){let r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},ue.deserialize=function(t){return new ue(t.buffer)},Object.defineProperty(ue,"name",{value:"Grid"}),J(ue,"Grid"),J(Tn,"Color"),J(Error,"Error"),J(yr,"Formatted"),J(Ya,"FormattedSection"),J(cm,"AJAXError"),J(zr,"ResolvedImage"),J(q,"StylePropertyFunction"),J(O,"StyleExpression",{omit:["_evaluator"]}),J(G,"ZoomDependentExpression"),J(V,"ZoomConstantExpression"),J(Cr,"CompoundExpression",{omit:["_evaluate"]});for(let t in tl)ce[tl[t]._classRegistryKey]||J(tl[t],`Expression${t}`);function ie(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function re(t){return self.ImageBitmap&&t instanceof ImageBitmap}function ge(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ie(t)||re(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let r=t;return e&&e.add(r.buffer),r}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let r=[];for(let a of t)r.push(ge(a,e));return r}if(t instanceof Map){let r={$name:"Map"};for(let[a,u]of t.entries())r[a]=ge(u);return r}if(typeof t=="object"){let r=t.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let u=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(let d in t)t.hasOwnProperty(d)&&(ce[a].omit.indexOf(d)>=0||(u[d]=ge(t[d],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof t)}function Ie(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ie(t)||re(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ie);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let u=new Map;for(let d of Object.keys(t))d!=="$name"&&u.set(d,Ie(t[d]));return u}let{klass:r}=ce[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);let a=Object.create(r.prototype);for(let u of Object.keys(t))u!=="$name"&&(a[u]=Ie(t[u]));return a}throw new Error("can't deserialize object of type "+typeof t)}let ae={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ce(t){for(let e of t)if(Ge(e.charCodeAt(0)))return!0;return!1}function Me(t){for(let e of t)if(!$e(e.charCodeAt(0)))return!1;return!0}function $e(t){return!(ae.Arabic(t)||ae["Arabic Supplement"](t)||ae["Arabic Extended-A"](t)||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t))}function Ge(t){return!(t!==746&&t!==747&&(t<4352||!(ae["Bopomofo Extended"](t)||ae.Bopomofo(t)||ae["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ae["CJK Compatibility Ideographs"](t)||ae["CJK Compatibility"](t)||ae["CJK Radicals Supplement"](t)||ae["CJK Strokes"](t)||!(!ae["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ae["CJK Unified Ideographs Extension A"](t)||ae["CJK Unified Ideographs"](t)||ae["Enclosed CJK Letters and Months"](t)||ae["Hangul Compatibility Jamo"](t)||ae["Hangul Jamo Extended-A"](t)||ae["Hangul Jamo Extended-B"](t)||ae["Hangul Jamo"](t)||ae["Hangul Syllables"](t)||ae.Hiragana(t)||ae["Ideographic Description Characters"](t)||ae.Kanbun(t)||ae["Kangxi Radicals"](t)||ae["Katakana Phonetic Extensions"](t)||ae.Katakana(t)&&t!==12540||!(!ae["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ae["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ae["Unified Canadian Aboriginal Syllabics"](t)||ae["Unified Canadian Aboriginal Syllabics Extended"](t)||ae["Vertical Forms"](t)||ae["Yijing Hexagram Symbols"](t)||ae["Yi Syllables"](t)||ae["Yi Radicals"](t))))}function Ve(t){return!(Ge(t)||function(e){return!!(ae["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ae["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ae["Letterlike Symbols"](e)||ae["Number Forms"](e)||ae["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ae["Control Pictures"](e)&&e!==9251||ae["Optical Character Recognition"](e)||ae["Enclosed Alphanumerics"](e)||ae["Geometric Shapes"](e)||ae["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ae["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ae["CJK Symbols and Punctuation"](e)||ae.Katakana(e)||ae["Private Use Area"](e)||ae["CJK Compatibility Forms"](e)||ae["Small Form Variants"](e)||ae["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function xe(t){return t>=1424&&t<=2303||ae["Arabic Presentation Forms-A"](t)||ae["Arabic Presentation Forms-B"](t)}function Re(t,e){return!(!e&&xe(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ae.Khmer(t))}function Ne(t){for(let e of t)if(xe(e.charCodeAt(0)))return!0;return!1}let ot="deferred",ct="loading",at="loaded",je=null,He="unavailable",st=null,pt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(He="error"),je&&je(t)};function Ot(){Ht.fire(new Fr("pluginStateChange",{pluginStatus:He,pluginURL:st}))}let Ht=new Za,fn=function(){return He},cn=function(){if(He!==ot||!st)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");He=ct,Ot(),st&&qa({url:st},t=>{t?pt(t):(He=at,Ot())})},kn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>He===at||kn.applyArabicShaping!=null,isLoading:()=>He===ct,setState(t){He=t.pluginStatus,st=t.pluginURL},isParsed:()=>kn.applyArabicShaping!=null&&kn.processBidirectionalText!=null&&kn.processStyledBidirectionalText!=null,getPluginURL:()=>st};class jt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,a){for(let u of r)if(!Re(u.charCodeAt(0),a))return!1;return!0}(e,kn.isLoaded())}}class Mn{constructor(e,r,a,u){this.property=e,this.value=r,this.expression=function(d,p,_,y){if(h(d))return new q(d,p);if(N(d)||Array.isArray(d)&&d.length>0){let b=H(d,p,_,y);if(b.result==="error")throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));return b.value}{let b=d;return typeof d=="string"&&p.type==="color"&&(b=Tn.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(r===void 0?e.specification.default:r,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class qn{constructor(e,r,a){this.property=e,this.value=new Mn(e,void 0,r,a)}transitioned(e,r){return new on(this.property,this.value,r,_r({},e.transition,this.transition),e.now)}untransitioned(){return new on(this.property,this.value,null,{},0)}}class Ln{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=a,this.isConfigDependent=!1}getValue(e){return Ko(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new qn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Mn(this._values[e].property,r===null?void 0:Ko(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,r){r&&(this._options=r);let a=this._properties.properties;if(e)for(let u in e){let d=e[u];if(Du(u,"-transition")){let p=u.slice(0,-11);a[p]&&this.setTransition(p,d)}else a.hasOwnProperty(u)&&this.setValue(u,d)}}getTransition(e){return Ko(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new qn(this._values[e].property)),this._values[e].transition=Ko(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(e[r]=a);let u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){let a=new Ut(this._properties);for(let u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){let e=new Ut(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class on{constructor(e,r,a,u,d){let p=u.delay||0,_=u.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+p,this.end=this.begin+_,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){let u=e.now||0,d=this.value.possiblyEvaluate(e,r,a),p=this.prior;if(p){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return p.possiblyEvaluate(e,r,a);{let _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,a),d,Xp(_))}}return d}}class Ut{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){let u=new pn(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,a);return u}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Qn{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=a,this.isConfigDependent=!1}getValue(e){return Ko(this._values[e].value)}setValue(e,r){this._values[e]=new Mn(this._values[e].property,r===null?void 0:Ko(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){let u=new pn(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,a);return u}}class ni{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class pn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Be{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){let u=zd[this.specification.type];return u?u(e,r,a):e}}class ut{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new ni(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ni(this,{kind:"constant",value:void 0},e.parameters);let u=zd[this.specification.type];return u?new ni(this,{kind:"constant",value:u(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,u,d,p){return e.kind==="constant"?e.value:e.evaluate(r,a,u,d,p)}}class Gi{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class On{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let r=new jt(0,{});for(let a in e){let u=e[a];u.specification.overridable&&this.overridableProperties.push(a);let d=this.defaultPropertyValues[a]=new Mn(u,void 0),p=this.defaultTransitionablePropertyValues[a]=new qn(u);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(r)}}}J(ut,"DataDrivenProperty"),J(Be,"DataConstantProperty"),J(Gi,"ColorRampProperty");var Ee=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Vr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function vr(t){if(Array.isArray(t))return t.map(vr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let r in t)e[r]=vr(t[r]);return e}return Vr(t)}function Yi(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Yi(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sr(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Yi(t)||(t=ns(t));let r=t,a=!0;try{a=function(b){if(!to(b))return b;let E=vr(b);return yo(E),E=Wr(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}let u=Ee[`filter_${e}`],d=B(a,u),p=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));p=(b,E,S)=>d.value.evaluate(b,E,{},S);let _=null,y=null;if(a!==r){let b=B(r,u);if(b.result==="error")throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,S,D,R,k)=>b.value.evaluate(E,S,{},D,void 0,void 0,R,k),y=!ca(b.value.expression)}return{filter:p,dynamicFilter:_||void 0,needGeometry:ws(a),needFeature:!!y}}function Wr(t){if(!Array.isArray(t))return t;let e=function(r){if(ua.has(r[0])){for(let a=1;a<r.length;a++)if(to(r[a]))return!0}return r}(t);return e===!0?e:e.map(r=>Wr(r))}function yo(t){let e=!1,r=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||to(t[a]),r.push(t[a+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||to(t[1]);for(let a=2;a<t.length-1;a+=2)r.push(t[a+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||to(t[1]);for(let a=1;a<t.length-1;a+=2)r.push(t[a+1])}e&&(t.length=0,t.push("any",...r));for(let a=1;a<t.length;a++)yo(t[a])}function to(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(to(t[r]))return!0;return!1}let ua=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ha(t,e){return t<e?-1:t>e?1:0}function ws(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(ws(t[e]))return!0;return!1}function ns(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Ts(t[1],t[2],"=="):e==="!="?dc(Ts(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ts(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(ns))):e==="all"?["all"].concat(t.slice(1).map(ns)):e==="none"?["all"].concat(t.slice(1).map(ns).map(dc)):e==="in"?hc(t[1],t.slice(2)):e==="!in"?dc(hc(t[1],t.slice(2))):e==="has"?ah(t[1]):e!=="!has"||dc(ah(t[1]));var r}function Ts(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function hc(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(ha)]]:["filter-in-small",t,["literal",e]]}}function ah(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function dc(t){return["!",t]}let fc="";function nf(t,e){return e?`${t}${fc}${e}`:t}let rf="-transition",rl=new Set(["fill","line","background","hillshade","raster"]);class xr extends Za{constructor(e,r,a,u,d){if(super(),this.id=e.id,this.fqid=nf(this.id,a),this.type=e.type,this.scope=a,this.lut=u,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new Qn(r.layout,this.scope,d),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new Ln(r.paint,this.scope,d);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pn(r.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return rl.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,r),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Du(e,rf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){let a=this._transitionablePaint,u=a._properties.properties;if(Du(e,rf)){let S=e.slice(0,-11);return u[S]&&a.setTransition(S,r||void 0),!1}if(!u[e])return!1;let d=a._values[e],p=d.value.isDataDriven(),_=d.value;a.setValue(e,r),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,b=y.isDataDriven(),E=Du(e,"pattern")||e==="line-dasharray";return b||p||E||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,a){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return Ga({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof ni&&tf(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,a,u,d,p,_,y,b){}queryIntersectsMatchingFeature(e,r,a,u){}}let qm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class d0{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ci{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function An(t,e=1){let r=0,a=0;return{members:t.map(u=>{let d=qm[u.type].BYTES_PER_ELEMENT,p=r=kD(r,Math.max(e,d)),_=u.components||1;return a=Math.max(a,d),r+=d*_,{name:u.name,type:u.type,components:_,offset:p}}),size:kD(r,Math.max(a,e)),alignment:e}}function kD(t,e){return Math.ceil(t/e)*e}class Es extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){let u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}Es.prototype.bytesPerElement=4,J(Es,"StructArrayLayout2i4");class f0 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){let d=3*e;return this.int16[d+0]=r,this.int16[d+1]=a,this.int16[d+2]=u,e}}f0.prototype.bytesPerElement=6,J(f0,"StructArrayLayout3i6");class pc extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){let p=4*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=u,this.int16[p+3]=d,e}}pc.prototype.bytesPerElement=8,J(pc,"StructArrayLayout4i8");class q1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,u,d)}emplace(e,r,a,u,d,p){let _=5*e;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=u,this.int16[_+3]=d,this.int16[_+4]=p,e}}q1.prototype.bytesPerElement=10,J(q1,"StructArrayLayout5i10");class W1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,d,p,_)}emplace(e,r,a,u,d,p,_,y){let b=6*e,E=12*e,S=3*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.uint8[E+4]=u,this.uint8[E+5]=d,this.uint8[E+6]=p,this.uint8[E+7]=_,this.float32[S+2]=y,e}}W1.prototype.bytesPerElement=12,J(W1,"StructArrayLayout2i4ub1f12");class mc extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){let p=4*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=u,this.float32[p+3]=d,e}}mc.prototype.bytesPerElement=16,J(mc,"StructArrayLayout4f16");class gc extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){let d=3*e;return this.float32[d+0]=r,this.float32[d+1]=a,this.float32[d+2]=u,e}}gc.prototype.bytesPerElement=12,J(gc,"StructArrayLayout3f12");class _c extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,u,d)}emplace(e,r,a,u,d,p){let _=6*e,y=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=a,this.uint16[_+2]=u,this.uint16[_+3]=d,this.float32[y+2]=p,e}}_c.prototype.bytesPerElement=12,J(_c,"StructArrayLayout4ui1f12");class p0 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){let p=4*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=u,this.uint16[p+3]=d,e}}p0.prototype.bytesPerElement=8,J(p0,"StructArrayLayout4ui8");class m0 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,d,p)}emplace(e,r,a,u,d,p,_){let y=6*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=d,this.int16[y+4]=p,this.int16[y+5]=_,e}}m0.prototype.bytesPerElement=12,J(m0,"StructArrayLayout6i12");class Z1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_,y,b,E,S,D){let R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,u,d,p,_,y,b,E,S,D)}emplace(e,r,a,u,d,p,_,y,b,E,S,D,R){let k=12*e;return this.int16[k+0]=r,this.int16[k+1]=a,this.int16[k+2]=u,this.int16[k+3]=d,this.uint16[k+4]=p,this.uint16[k+5]=_,this.uint16[k+6]=y,this.uint16[k+7]=b,this.int16[k+8]=E,this.int16[k+9]=S,this.int16[k+10]=D,this.int16[k+11]=R,e}}Z1.prototype.bytesPerElement=24,J(Z1,"StructArrayLayout4i4ui4i24");class Y1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,d,p)}emplace(e,r,a,u,d,p,_){let y=10*e,b=5*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=u,this.float32[b+2]=d,this.float32[b+3]=p,this.float32[b+4]=_,e}}Y1.prototype.bytesPerElement=20,J(Y1,"StructArrayLayout3i3f20");class X1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}X1.prototype.bytesPerElement=4,J(X1,"StructArrayLayout1ul4");class lh extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}lh.prototype.bytesPerElement=4,J(lh,"StructArrayLayout1f4");class yc extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){let u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}yc.prototype.bytesPerElement=4,J(yc,"StructArrayLayout2ui4");class K1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_,y,b,E,S,D,R){let k=this.length;return this.resize(k+1),this.emplace(k,e,r,a,u,d,p,_,y,b,E,S,D,R)}emplace(e,r,a,u,d,p,_,y,b,E,S,D,R,k){let F=20*e,z=10*e;return this.int16[F+0]=r,this.int16[F+1]=a,this.int16[F+2]=u,this.int16[F+3]=d,this.int16[F+4]=p,this.float32[z+3]=_,this.float32[z+4]=y,this.float32[z+5]=b,this.float32[z+6]=E,this.int16[F+14]=S,this.uint32[z+8]=D,this.uint16[F+18]=R,this.uint16[F+19]=k,e}}K1.prototype.bytesPerElement=40,J(K1,"StructArrayLayout5i4f1i1ul2ui40");class g0 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,d,p,_)}emplace(e,r,a,u,d,p,_,y){let b=8*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+4]=d,this.int16[b+5]=p,this.int16[b+6]=_,this.int16[b+7]=y,e}}g0.prototype.bytesPerElement=16,J(g0,"StructArrayLayout3i2i2i16");class Q1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,u,d)}emplace(e,r,a,u,d,p){let _=4*e,y=8*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=u,this.int16[y+6]=d,this.int16[y+7]=p,e}}Q1.prototype.bytesPerElement=16,J(Q1,"StructArrayLayout2f1f2i16");class J1 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){let p=12*e,_=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=a,this.float32[_+1]=u,this.float32[_+2]=d,e}}J1.prototype.bytesPerElement=12,J(J1,"StructArrayLayout2ub2f12");class Qi extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){let d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,this.uint16[d+2]=u,e}}Qi.prototype.bytesPerElement=6,J(Qi,"StructArrayLayout3ui6");class ew extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j,Y,X,K,le){let se=this.length;return this.resize(se+1),this.emplace(se,e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j,Y,X,K,le)}emplace(e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j,Y,X,K,le,se){let me=30*e,_e=15*e,Te=60*e;return this.int16[me+0]=r,this.int16[me+1]=a,this.int16[me+2]=u,this.float32[_e+2]=d,this.float32[_e+3]=p,this.uint16[me+8]=_,this.uint16[me+9]=y,this.uint32[_e+5]=b,this.uint32[_e+6]=E,this.uint32[_e+7]=S,this.uint16[me+16]=D,this.uint16[me+17]=R,this.uint16[me+18]=k,this.float32[_e+10]=F,this.float32[_e+11]=z,this.uint8[Te+48]=j,this.uint8[Te+49]=Y,this.uint8[Te+50]=X,this.uint32[_e+13]=K,this.int16[me+28]=le,this.uint8[Te+58]=se,e}}ew.prototype.bytesPerElement=60,J(ew,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class tw extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j,Y,X,K,le,se,me,_e,Te,ke,De,ze,Ye,Le,qe,Oe,We,Je){let Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j,Y,X,K,le,se,me,_e,Te,ke,De,ze,Ye,Le,qe,Oe,We,Je)}emplace(e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j,Y,X,K,le,se,me,_e,Te,ke,De,ze,Ye,Le,qe,Oe,We,Je,Ze){let ht=22*e,Xe=44*e,nt=88*e;return this.float32[ht+0]=r,this.float32[ht+1]=a,this.int16[Xe+4]=u,this.int16[Xe+5]=d,this.int16[Xe+6]=p,this.int16[Xe+7]=_,this.int16[Xe+8]=y,this.int16[Xe+9]=b,this.int16[Xe+10]=E,this.int16[Xe+11]=S,this.int16[Xe+12]=D,this.uint16[Xe+13]=R,this.uint16[Xe+14]=k,this.uint16[Xe+15]=F,this.uint16[Xe+16]=z,this.uint16[Xe+17]=j,this.uint16[Xe+18]=Y,this.uint16[Xe+19]=X,this.uint16[Xe+20]=K,this.uint16[Xe+21]=le,this.uint16[Xe+22]=se,this.uint16[Xe+23]=me,this.uint16[Xe+24]=_e,this.uint16[Xe+25]=Te,this.uint16[Xe+26]=ke,this.uint16[Xe+27]=De,this.uint32[ht+14]=ze,this.float32[ht+15]=Ye,this.float32[ht+16]=Le,this.float32[ht+17]=qe,this.float32[ht+18]=Oe,this.float32[ht+19]=We,this.float32[ht+20]=Je,this.uint8[nt+84]=Ze,e}}tw.prototype.bytesPerElement=88,J(tw,"StructArrayLayout2f9i15ui1ul6f1ub88");class ch extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,u,d)}emplace(e,r,a,u,d,p){let _=5*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=u,this.float32[_+3]=d,this.float32[_+4]=p,e}}ch.prototype.bytesPerElement=20,J(ch,"StructArrayLayout5f20");class nw extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,d,p,_)}emplace(e,r,a,u,d,p,_,y){let b=7*e;return this.float32[b+0]=r,this.float32[b+1]=a,this.float32[b+2]=u,this.float32[b+3]=d,this.float32[b+4]=p,this.float32[b+5]=_,this.float32[b+6]=y,e}}nw.prototype.bytesPerElement=28,J(nw,"StructArrayLayout7f28");class of extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){let u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}of.prototype.bytesPerElement=8,J(of,"StructArrayLayout2f8");class iw extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,u)}emplace(e,r,a,u,d){let p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=u,this.uint16[p+4]=d,e}}iw.prototype.bytesPerElement=12,J(iw,"StructArrayLayout1ul3ui12");class Wm extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Wm.prototype.bytesPerElement=2,J(Wm,"StructArrayLayout1ui2");class rw extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z){let j=this.length;return this.resize(j+1),this.emplace(j,e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z)}emplace(e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j){let Y=16*e;return this.float32[Y+0]=r,this.float32[Y+1]=a,this.float32[Y+2]=u,this.float32[Y+3]=d,this.float32[Y+4]=p,this.float32[Y+5]=_,this.float32[Y+6]=y,this.float32[Y+7]=b,this.float32[Y+8]=E,this.float32[Y+9]=S,this.float32[Y+10]=D,this.float32[Y+11]=R,this.float32[Y+12]=k,this.float32[Y+13]=F,this.float32[Y+14]=z,this.float32[Y+15]=j,e}}rw.prototype.bytesPerElement=64,J(rw,"StructArrayLayout16f64");class _0 extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,d,p,_)}emplace(e,r,a,u,d,p,_,y){let b=10*e,E=5*e;return this.uint16[b+0]=r,this.uint16[b+1]=a,this.uint16[b+2]=u,this.uint16[b+3]=d,this.float32[E+2]=p,this.float32[E+3]=_,this.float32[E+4]=y,e}}_0.prototype.bytesPerElement=20,J(_0,"StructArrayLayout4ui3f20");class ow extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}ow.prototype.bytesPerElement=2,J(ow,"StructArrayLayout1i2");class sw extends ci{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}sw.prototype.bytesPerElement=1,J(sw,"StructArrayLayout1ub1");class OD extends d0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}OD.prototype.size=40;class aw extends K1{get(e){return new OD(this,e)}}J(aw,"CollisionBoxArray");class LD extends d0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}LD.prototype.size=60;class FD extends ew{get(e){return new LD(this,e)}}J(FD,"PlacedSymbolArray");class ND extends d0{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}ND.prototype.size=88;class zD extends tw{get(e){return new ND(this,e)}}J(zD,"SymbolInstanceArray");class BD extends lh{getoffsetX(e){return this.float32[1*e+0]}}J(BD,"GlyphOffsetArray");class VD extends Es{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}J(VD,"SymbolLineVertexArray");class jD extends d0{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}jD.prototype.size=12;class UD extends iw{get(e){return new jD(this,e)}}J(UD,"FeatureIndexArray");class $D extends yc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}J($D,"FillExtrusionCentroidArray");let rB=An([{name:"a_pos",components:2,type:"Int16"}],4),oB=An([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mi{constructor(e=[]){this.segments=e}_prepareSegment(e,r,a,u){let d=this.segments[this.segments.length-1];return e>mi.MAX_VERTEX_ARRAY_LENGTH&&Pi(`Max vertices per segment is ${mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>mi.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:r,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}prepareSegment(e,r,a,u){return this._prepareSegment(e,r.length,a.length,u)}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new mi([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function GD(t,e){return 256*(t=Jt(Math.floor(t),0,255))+Jt(Math.floor(e),0,255)}mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,J(mi,"SegmentVector");let sB=An([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),aB=An([{name:"a_dash",components:4,type:"Uint16"}]);class Zm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push(HD(e)),this.positions.push(r,a,u)}eachPosition(e,r){let a=HD(e),u=0,d=this.ids.length-1;for(;u<d;){let p=u+d>>1;this.ids[p]>=a?d=p:u=p+1}for(;this.ids[u]===a;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){let a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return lw(a,u,0,a.length-1),r&&(r.add(a.buffer),r.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){let r=new Zm,a;r.ids=e.ids,r.positions=e.positions;for(let u of r.ids)u!==a&&r.uniqueIds.push(u),a=u;return r.indexed=!0,r}}function HD(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Jl(String(t))}function lw(t,e,r,a){for(;r<a;){let u=t[r+a>>1],d=r-1,p=a+1;for(;;){do d++;while(t[d]<u);do p--;while(t[p]>u);if(d>=p)break;y0(t,d,p),y0(e,3*d,3*p),y0(e,3*d+1,3*p+1),y0(e,3*d+2,3*p+2)}p-r<a-p?(lw(t,e,r,p),r=p+1):(lw(t,e,p+1,a),a=p)}}function y0(t,e,r){let a=t[e];t[e]=t[r],t[r]=a}J(Zm,"FeaturePositionMap");class ol{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class v0 extends ol{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Zr extends ol{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class sl extends ol{constructor(e){super(e),this.current=[0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class cw extends ol{constructor(e){super(e),this.current=[0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class uw extends ol{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class qD extends ol{constructor(e){super(e),this.current=Tn.transparent.toRenderColor(null)}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let lB=new Float32Array(16);class Ym extends ol{constructor(e){super(e),this.current=lB}set(e,r,a){if(this.fetchUniformLocation(e,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let cB=new Float32Array(9),uB=new Float32Array(4);class hw extends ol{constructor(e){super(e),this.current=uB}set(e,r,a){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function dw(t){return[GD(255*t.r,255*t.g),GD(255*t.b,255*t.a)]}class Xm{constructor(e,r,a,u){this.value=e,this.uniformNames=r.map(d=>`u_${d}`),this.type=a,this.context=u}setUniform(e,r,a,u,d){let p=u.constantOr(this.value);r.set(e,d,p instanceof Tn?p.toRenderColor(this.context.lut):p)}getBinding(e,r){return this.type==="color"?new qD(e):new Zr(e)}}class sf{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,u,d){let p=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;p&&r.set(e,d,p)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new uw(e):new Zr(e)}}class al{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,d,p,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new jt(0,{brightness:p}),r,{},d,u,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b,this.context)}updatePaintArray(e,r,a,u,d,p,_){let y=this.expression.evaluate({zoom:0,brightness:_},a,u,void 0,d);this._setPaintValue(e,r,y,this.context)}_setPaintValue(e,r,a,u){if(this.type==="color"){let d=dw(a.toRenderColor(u.lut));for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,d[0],d[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Is{constructor(e,r,a,u,d,p){this.expression=e,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=u,this.context=d,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,a,u,d,p,_){let y=this.expression.evaluate(new jt(this.context.zoom,{brightness:p}),r,{},d,u,_),b=this.expression.evaluate(new jt(this.context.zoom+1,{brightness:p}),r,{},d,u,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,b,this.context)}updatePaintArray(e,r,a,u,d,p,_){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:_},a,u,void 0,d),b=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},a,u,void 0,d);this._setPaintValue(e,r,y,b,this.context)}_setPaintValue(e,r,a,u,d){if(this.type==="color"){let p=dw(a.toRenderColor(d.lut)),_=dw(a.toRenderColor(d.lut));for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,p[0],p[1],_[0],_[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,u,d){let p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=Jt(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);r.set(e,d,_)}getBinding(e,r){return new Zr(e)}}class vc{constructor(e,r,a,u,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?aB:sB).members;for(let p=0;p<r.length;++p);this.paintVertexArray=new u}populatePaintArray(e,r,a,u){let d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,d,p,_){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,r,a,u){if(!u||!a)return;let d=u[a];if(!d)return;let{tl:p,br:_,pixelRatio:y}=d;for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,p[0],p[1],_[0],_[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uh{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[],this.context=r;let u=[];for(let d in e.paint._values){let p=e.paint.get(d);if(!a(d)||!(p instanceof ni&&tf(p.property.specification)))continue;let _=dB(d,e.type),y=p.value,b=p.property.specification.type,E=!!p.property.useIntegerZoom,S=d==="line-dasharray"||d.endsWith("pattern"),D=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||D)if(y.kind==="source"||D||S){let R=WD(d,b,"source");this.binders[d]=S?new vc(y,_,b,R,e.id):new al(y,_,b,R),u.push(`/a_${d}`)}else{let R=WD(d,b,"composite");this.binders[d]=new Is(y,_,b,E,r,R),u.push(`/z_${d}`)}else this.binders[d]=S?new sf(y.value,_):new Xm(y.value,_,b,r),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof al||r instanceof Is?r.maxValue:0}populatePaintArrays(e,r,a,u,d,p,_){for(let y in this.binders){let b=this.binders[y];b.context=this.context,(b instanceof al||b instanceof Is||b instanceof vc)&&b.populatePaintArray(e,r,a,u,d,p,_)}}setConstantPatternPositions(e){for(let r in this.binders){let a=this.binders[r];a instanceof sf&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,u,d,p,_,y){let b=!1,E=Object.keys(e),S=E.length!==0,D=S?E:r.uniqueIds;this.context.lut=d.lut;for(let R in this.binders){let k=this.binders[R];if(k.context=this.context,(k instanceof al||k instanceof Is||k instanceof vc)&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){let F=d.paint.get(R);k.expression=F.value;for(let z of D){let j=e[z.toString()];r.eachPosition(z,(Y,X,K)=>{let le=u.feature(Y);k.updatePaintArray(X,K,le,j,p,_,y)})}if(!S)for(let z of a.uniqueIds){let j=e[z.toString()];a.eachPosition(z,(Y,X,K)=>{let le=u.feature(Y);k.updatePaintArray(X,K,le,j,p,_,y)})}b=!0}}return b}defines(){let e=[];for(let r in this.binders){let a=this.binders[r];(a instanceof Xm||a instanceof sf)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof al||a instanceof Is||a instanceof vc)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof Xm||a instanceof sf||a instanceof Is)for(let u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let r=[];for(let a in this.binders){let u=this.binders[a];if(u instanceof Xm||u instanceof sf||u instanceof Is)for(let d of u.uniformNames)r.push({name:d,property:a,binding:u.getBinding(e,d)})}return r}setUniforms(e,r,a,u,d){for(let{name:p,property:_,binding:y}of a)this.binders[_].setUniform(e,y,d,u.get(_),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let r=this.binders[e];(r instanceof al||r instanceof Is||r instanceof vc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(let r in this.binders){let a=this.binders[r];(a instanceof al||a instanceof Is||a instanceof vc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof al||r instanceof Is||r instanceof vc)&&r.destroy()}}}class xc{constructor(e,r,a=()=>!0){this.programConfigurations={};for(let u of e)this.programConfigurations[u.id]=new uh(u,r,a);this.needsUpload=!1,this._featureMap=new Zm,this._featureMapWithoutIds=new Zm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,a,u,d,p,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,u,d,p,_,y);r.id!==void 0?this._featureMap.add(r.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u,d,p){for(let _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,_,u,d,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let hB={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function dB(t,e){return hB[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let fB={"line-pattern":{source:_c,composite:_c},"fill-pattern":{source:_c,composite:_c},"fill-extrusion-pattern":{source:_c,composite:_c},"line-dasharray":{source:p0,composite:p0}},pB={color:{source:of,composite:mc},number:{source:lh,composite:of}};function WD(t,e,r){let a=fB[t];return a&&a[r]||pB[e][r]}J(Xm,"ConstantBinder"),J(sf,"PatternConstantBinder"),J(al,"SourceExpressionBinder"),J(vc,"PatternCompositeBinder"),J(Is,"CompositeExpressionBinder"),J(uh,"ProgramConfiguration",{omit:["_buffers"]}),J(xc,"ProgramConfigurationSet");let Yr=rt/Math.PI/2,fw=5,ZD=6,mB=16383,af=64,pw=[af,32,16],is=-Yr,rs=Yr;function lf(t,e,r,a=Yr){return r=dn(r),[t*Math.sin(r)*a,-e*a,t*Math.cos(r)*a]}function hh(t,e,r){return lf(Math.cos(dn(t)),Math.sin(dn(t)),e,r)}let cf=63710088e-1,mw=2*Math.PI*cf;class bn{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bn($a(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,a=this.lat*r,u=e.lat*r,d=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return cf*Math.acos(Math.min(d,1))}toBounds(e=0){let r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new bc({lng:this.lng-a,lat:this.lat-r},{lng:this.lng+a,lat:this.lat+r})}toEcef(e){return hh(this.lat,this.lng,Yr+e*Yr/cf)}static convert(e){if(e instanceof bn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new bn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new bn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class bc{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof bn?new bn(e.lng,e.lat):bn.convert(e),this}setSouthWest(e){return this._sw=e instanceof bn?new bn(e.lng,e.lat):bn.convert(e),this}extend(e){let r=this._sw,a=this._ne,u,d;if(e instanceof bn)u=e,d=e;else{if(!(e instanceof bc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(bc.convert(e)):this.extend(bn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(bn.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return r||a?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new bn(u.lng,u.lat),this._ne=new bn(d.lng,d.lat)),this}getCenter(){return new bn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new bn(this.getWest(),this.getNorth())}getSouthEast(){return new bn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:a}=bn.convert(e),u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof bc?e:new bc(e)}}var YD={};(function(t,e){(function(r){function a(d,p,_){var y=u(256*d,256*(p=Math.pow(2,_)-p-1),_),b=u(256*(d+1),256*(p+1),_);return y[0]+","+y[1]+","+b[0]+","+b[1]}function u(d,p,_){var y=2*Math.PI*6378137/256/Math.pow(2,_);return[d*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}r.getURL=function(d,p,_,y,b,E){return E=E||{},d+"?"+["bbox="+a(_,y,b),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+p].join("&")},r.getTileBBox=a,r.getMercCoords=u,Object.defineProperty(r,"__esModule",{value:!0})})(e)})(0,YD);var gB=YD;class dh{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Km(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){let a=gB.getTileBBox(this.x,this.y,this.z),u=function(d,p,_){let y,b="";for(let E=d;E>0;E--)y=1<<E-1,b+=(p&y?1:0)+(_&y?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class XD{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Km(e,r.z,r.z,r.x,r.y)}}class Hi{constructor(e,r,a,u,d){this.overscaledZ=e,this.wrap=r,this.canonical=new dh(a,+u,+d),this.key=r===0&&e===a?this.canonical.key:Km(r,e,a,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let r=this.canonical.z-e;return e>this.canonical.z?new Hi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Km(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return Km(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Hi(r,this.wrap,r,a,u),new Hi(r,this.wrap,r,a+1,u),new Hi(r,this.wrap,r,a,u+1),new Hi(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new XD(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Km(t,e,r,a,u){let d=1<<Math.min(r,22),p=d*(u%d)+a%d;return t&&r<22&&(p+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}let _B=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new Hi(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new Hi(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new Hi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Hi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];J(dh,"CanonicalTileID"),J(Hi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let yB=0,vB=25.5;function gw(t){return mw*Math.cos(t*Math.PI/180)}function da(t){return(180+t)/360}function fa(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Xr(t,e){return t/gw(e)}function no(t){return 360*t-180}function sr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function KD(t,e){return t*gw(sr(e))}let ki=85.051129;function QD(t){return Math.cos(dn(Jt(t,-ki,ki)))}function fh(t,e){let r=Jt(e,yB,vB),a=Math.pow(2,r);return QD(t)*mw/(512*a)}function JD(t){return 1/Math.cos(t*Math.PI/180)}function x0(t,e=0){let r=Math.exp(Math.PI*(1-(t.y+e/rt)/(1<<t.z)*2));return 80150034*r/(r*r+1)/rt/(1<<t.z)}class Dr{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){let a=bn.convert(e);return new Dr(da(a.lng),fa(a.lat),Xr(r,a.lat))}toLngLat(){return new bn(no(this.x),sr(this.y))}toAltitude(){return KD(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/mw*JD(sr(this.y))}}function _w(t,e,r,a,u,d,p,_,y){let b=(e+a)/2,E=(r+u)/2,S=new lt(b,E);_(S),function(D,R,k,F,z,j){let Y=k-z,X=F-j;return Math.abs((F-R)*Y-(k-D)*X)/Math.hypot(Y,X)}(S.x,S.y,d.x,d.y,p.x,p.y)>=y?(_w(t,e,r,b,E,d,S,_,y),_w(t,b,E,a,u,S,p,_,y)):t.push(p)}function eM(t,e,r){let a=t[0],u=a.x,d=a.y;e(a);let p=[a];for(let _=1;_<t.length;_++){let y=t[_],{x:b,y:E}=y;e(y),_w(p,u,d,b,E,a,y,e,r),u=b,d=E,a=y}return p}function yw(t,e,r,a){if(a(e,r)){let u=e.add(r)._mult(.5);yw(t,e,u,a),yw(t,u,r,a)}else t.push(r)}function xB(t,e){let r=t[0],a=[r];for(let u=1;u<t.length;u++){let d=t[u];yw(a,r,d,e),r=d}return a}let vw=Math.pow(2,14)-1,tM=-vw-1;function bB(t,e){let r=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=Jt(r,tM,vw),t.y=Jt(a,tM,vw),(r<t.x||r>t.x+1||a<t.y||a>t.y+1)&&Pi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Cs(t,e,r){let a=t.loadGeometry(),u=t.extent,d=rt/u;if(e&&r&&r.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:_,x:y,y:b,projection:E}=r,S=D=>{let R=no((e.x+D.x/u)/p),k=sr((e.y+D.y/u)/p),F=E.project(R,k);D.x=(F.x*_-y)*u,D.y=(F.y*_-b)*u};for(let D=0;D<a.length;D++)if(t.type!==1)a[D]=eM(a[D],S,1);else{let R=[];for(let k of a[D])k.x<0||k.x>=u||k.y<0||k.y>=u||(S(k),R.push(k));a[D]=R}}for(let p of a)for(let _ of p)bB(_,d);return a}function ll(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Cs(t):[]}}function b0(t,e,r,a,u){t.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}function w0(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class xw{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Es,this.indexArray=new Qi,this.segments=new mi,this.programConfigurations=new xc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,a,u){let d=this.layers[0],p=[],_=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(let{feature:b,id:E,index:S,sourceLayerIndex:D}of e){let R=this.layers[0]._featureFilter.needGeometry,k=ll(b,R);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),k,a))continue;let F=_?_.evaluate(k,{},a):void 0,z={id:E,properties:b.properties,type:b.type,sourceLayerIndex:D,index:S,geometry:R?k.geometry:Cs(b,a,u),patterns:{},sortKey:F};p.push(z)}_&&p.sort((b,E)=>b.sortKey-E.sortKey);let y=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new m0,y=u.projection);for(let b of p){let{geometry:E,index:S,sourceLayerIndex:D}=b,R=e[S].feature;this.addFeature(b,E,S,r.availableImages,a,y,r.brightness),r.featureIndex.insert(R,E,S,D,this.index)}}update(e,r,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,p?this.stateDependentLayers:this.layers,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,oB.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,u,d,p,_){for(let y of r)for(let b of y){let E=b.x,S=b.y;if(E<0||E>=rt||S<0||S>=rt)continue;if(p){let k=p.projectTilePoint(E,S,d),F=p.upVector(d,E,S),z=this.globeExtVertexArray;w0(z,k,F),w0(z,k,F),w0(z,k,F),w0(z,k,F)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=D.vertexLength;b0(this.layoutVertexArray,E,S,-1,-1),b0(this.layoutVertexArray,E,S,1,-1),b0(this.layoutVertexArray,E,S,1,1),b0(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,d,_)}}function bw(t,e){for(let r=0;r<t.length;r++)if(wc(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(wc(t,e[r]))return!0;return!!ww(t,e)}function wB(t,e,r){return!!wc(t,e)||!!Tw(e,t,r)}function nM(t,e){if(t.length===1)return rM(e,t[0]);for(let r=0;r<e.length;r++){let a=e[r];for(let u=0;u<a.length;u++)if(wc(t,a[u]))return!0}for(let r=0;r<t.length;r++)if(rM(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(ww(t,e[r]))return!0;return!1}function TB(t,e,r){if(t.length>1){if(ww(t,e))return!0;for(let a=0;a<e.length;a++)if(Tw(e[a],t,r))return!0}for(let a=0;a<t.length;a++)if(Tw(t[a],e,r))return!0;return!1}function ww(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){let a=t[r],u=t[r+1];for(let d=0;d<e.length-1;d++)if(EB(a,u,e[d],e[d+1]))return!0}return!1}function EB(t,e,r,a){return Qo(t,r,a)!==Qo(e,r,a)&&Qo(t,e,r)!==Qo(t,e,a)}function Tw(t,e,r){let a=r*r;if(e.length===1)return t.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(iM(t,e[u-1],e[u])<a)return!0;return!1}function iM(t,e,r){let a=e.distSqr(r);if(a===0)return t.distSqr(e);let u=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/a;return t.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function rM(t,e){let r,a,u,d=!1;for(let p=0;p<t.length;p++){r=t[p];for(let _=0,y=r.length-1;_<r.length;y=_++)a=r[_],u=r[y],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(d=!d)}return d}function wc(t,e){let r=!1;for(let a=0,u=t.length-1;a<t.length;u=a++){let d=t[a],p=t[u];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(r=!r)}return r}function oM(t,e,r,a,u){for(let p of t)if(e<=p.x&&r<=p.y&&a>=p.x&&u>=p.y)return!0;let d=[new lt(e,r),new lt(e,u),new lt(a,u),new lt(a,r)];if(t.length>2){for(let p of d)if(wc(t,p))return!0}for(let p=0;p<t.length-1;p++)if(IB(t[p],t[p+1],d))return!0;return!1}function IB(t,e,r){let a=r[0],u=r[2];if(t.x<a.x&&e.x<a.x||t.x>u.x&&e.x>u.x||t.y<a.y&&e.y<a.y||t.y>u.y&&e.y>u.y)return!1;let d=Qo(t,e,r[0]);return d!==Qo(t,e,r[1])||d!==Qo(t,e,r[2])||d!==Qo(t,e,r[3])}function uf(t,e,r,a,u,d){let p=e.y-t.y,_=t.x-e.x;if(d=d||0){let y=p*p+_*_;if(y===0)return!0;let b=Math.sqrt(y);p/=b,_/=b}return!((r.x-t.x)*p+(r.y-t.y)*_-d<0||(a.x-t.x)*p+(a.y-t.y)*_-d<0||(u.x-t.x)*p+(u.y-t.y)*_-d<0)}function Ew(t,e,r,a,u,d,p){return!(uf(t,e,a,u,d,p)||uf(e,r,a,u,d,p)||uf(r,t,a,u,d,p)||uf(a,u,t,e,r,p)||uf(u,d,t,e,r,p)||uf(d,a,t,e,r,p))}function hf(t,e,r){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(t)}function T0(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function sM(t,e,r,a,u){if(!e[0]&&!e[1])return t;let d=lt.convert(e)._mult(u);r==="viewport"&&d._rotate(-a);let p=[];for(let _=0;_<t.length;_++)p.push(t[_].sub(d));return p}function aM(t,e,r,a){let u=lt.convert(t)._mult(a);return e==="viewport"&&u._rotate(-r),u}J(xw,"CircleBucket",{omit:["layers"]});let CB=new On({"circle-sort-key":new ut(Ee.layout_circle["circle-sort-key"]),visibility:new Be(Ee.layout_circle.visibility)});var SB={paint:new On({"circle-radius":new ut(Ee.paint_circle["circle-radius"]),"circle-color":new ut(Ee.paint_circle["circle-color"]),"circle-blur":new ut(Ee.paint_circle["circle-blur"]),"circle-opacity":new ut(Ee.paint_circle["circle-opacity"]),"circle-translate":new Be(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new Be(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Be(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Be(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(Ee.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Be(Ee.paint_circle["circle-emissive-strength"])}),layout:CB};class Iw{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){let u=i._.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;let d=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,r,a){if(i._.equals(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;let[u,d,p]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],b=this.pos[2]-e[2],E=u*u+d*d+p*p,S=2*(_*u+y*d+b*p),D=S*S-4*E*(_*_+y*y+b*b-r*r);if(D<0){let R=Math.max(-S/2,0),k=_+u*R,F=y+d*R,z=b+p*R,j=Math.hypot(k,F,z);return a[0]=k*r/j,a[1]=F*r/j,a[2]=z*r/j,!1}{let R=(-S-Math.sqrt(D))/(2*E);if(R<0){let k=Math.hypot(_,y,b);return a[0]=_*r/k,a[1]=y*r/k,a[2]=b*r/k,!1}return a[0]=_+u*R,a[1]=y+d*R,a[2]=b+p*R,!0}}}class Cw{constructor(e,r,a,u,d){this.TL=e,this.TR=r,this.BR=a,this.BL=u,this.horizon=d}static fromInvProjectionMatrix(e,r,a){let u=[-1,1,1],d=[1,1,1],p=[1,-1,1],_=[-1,-1,1],y=i._.transformMat4(u,u,e),b=i._.transformMat4(d,d,e),E=i._.transformMat4(p,p,e),S=i._.transformMat4(_,_,e);return new Cw(y,b,E,S,r/a)}}function Qm(t,e,r){let a=1/0,u=-1/0,d=[];for(let p of t){i._.sub(d,p,e);let _=i._.dot(d,r);a=Math.min(a,_),u=Math.max(u,_)}return[a,u]}function lM(t,e){let r=!0;for(let a=0;a<t.planes.length;a++){let u=t.planes[a],d=0;for(let p=0;p<e.length;p++)d+=i._.dot(u,e[p])+u[3]>=0;if(d===0)return 0;d!==e.length&&(r=!1)}return r?2:1}function cM(t,e){for(let r of t.projections){let a=Qm(e,t.points[0],r.axis);if(r.projection[1]<a[0]||r.projection[0]>a[1])return 0}return 1}function uM(t,e){let r=0,a=[0,0,0,0];for(let u=0;u<t.length;u++)a[0]=t[u][0],a[1]=t[u][1],a[2]=t[u][2],a[3]=1,i.aA.dot(a,e)>=0&&r++;return r}class Sw{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=gi.fromPoints(this.points),this.projections=[],this.frustumEdges=[i._.sub([],this.points[2],this.points[3]),i._.sub([],this.points[0],this.points[3]),i._.sub([],this.points[4],this.points[0]),i._.sub([],this.points[5],this.points[1]),i._.sub([],this.points[6],this.points[2]),i._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let u=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:u,projection:Qm(this.points,this.points[0],u)}),this.projections.push({axis:d,projection:Qm(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,r,a,u){let d=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let E=i.aA.transformMat4([],b,e),S=1/E[3]/r*d;return i.aA.mul(E,E,[S,S,u?1/E[3]:S,S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let E=i._.sub([],p[b[0]],p[b[1]]),S=i._.sub([],p[b[2]],p[b[1]]),D=i._.normalize([],i._.cross([],E,S)),R=-i._.dot(D,p[b[1]]);return D.concat(R)}),y=[];for(let b=0;b<p.length;b++)y.push([p[b][0],p[b][1],p[b][2]]);return new Sw(y,_)}intersectsPrecise(e,r,a){for(let u=0;u<r.length;u++)if(!uM(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!uM(e,this.planes[u]))return 0;for(let u of a)for(let d of this.frustumEdges){let p=i._.cross([],u,d),_=i._.length(p);if(_===0)continue;i._.scale(p,p,1/_);let y=Qm(this.points,this.points[0],p),b=Qm(e,this.points[0],p);if(y[0]>b[1]||b[0]>y[1])return 0}return 1}}class gi{static fromPoints(e){let r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let u of e)i._.min(r,r,u),i._.max(a,a,u);return new gi(r,a)}static fromTileIdAndHeight(e,r,a){let u=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new gi([d/u,p/u,r],[(d+1)/u,(p+1)/u,a])}static applyTransform(e,r){let a=e.getCorners();for(let u=0;u<a.length;++u)i._.transformMat4(a[u],a[u],r);return gi.fromPoints(a)}static projectAabbCorners(e,r){let a=e.getCorners();for(let u=0;u<a.length;++u)i._.transformMat4(a[u],a[u],r);return a}constructor(e,r){this.min=e,this.max=r,this.center=i._.scale([],i._.add([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],a=i._.clone(this.min),u=i._.clone(this.max);for(let d=0;d<r.length;d++)a[d]=r[d]?this.min[d]:this.center[d],u[d]=r[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new gi(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?lM(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?lM(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?cM(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?cM(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}J(gi,"Aabb");let DB=An([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:E0}=DB,hM=An([{name:"a_pos_3",components:3,type:"Int16"}]);var Jm=An([{name:"a_pos",type:"Int16",components:2}]);function I0(t){return t*Yr/cf}let MB=[new gi([is,is,is],[rs,rs,rs]),new gi([is,is,is],[0,0,rs]),new gi([0,is,is],[rs,0,rs]),new gi([is,0,is],[0,rs,rs]),new gi([0,0,is],[rs,rs,rs])];function dM(t,e,r,a=!0){let u=i._.scale([],t._camera.position,t.worldSize),d=[e,r,1,1];i.aA.transformMat4(d,d,t.pixelMatrixInverse),i.aA.scale(d,d,1/d[3]);let p=i._.sub([],d,u),_=i._.normalize([],p),y=t.globeMatrix,b=[y[12],y[13],y[14]],E=i._.sub([],b,u),S=i._.length(E),D=i._.normalize([],E),R=t.worldSize/(2*Math.PI),k=i._.dot(D,_),F=Math.asin(R/S);if(F<Math.acos(k)){if(!a)return null;let De=[],ze=[];i._.scale(De,_,S/k),i._.normalize(ze,i._.sub(ze,De,E)),i._.normalize(_,i._.add(_,E,i._.scale(_,ze,Math.tan(F)*S)))}let z=[];new Iw(u,_).closestPointOnSphere(b,R,z);let j=i._.normalize([],Pu(y,0)),Y=i._.normalize([],Pu(y,1)),X=i._.normalize([],Pu(y,2)),K=i._.dot(j,z),le=i._.dot(Y,z),se=i._.dot(X,z),me=gr(Math.asin(-le/R)),_e=gr(Math.atan2(K,se));_e=t.center.lng+function(De,ze){let Ye=(ze-De+180)%360-180;return Ye<-180?Ye+360:Ye}(t.center.lng,_e);let Te=da(_e),ke=Jt(fa(me),0,1);return new Dr(Te,ke)}class AB{constructor(e,r,a){this.a=i._.sub([],e,a),this.b=i._.sub([],r,a),this.center=a;let u=i._.normalize([],this.a),d=i._.normalize([],this.b);this.angle=Math.acos(i._.dot(u,d))}}function Dw(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(a,u,d,p){let _=Math.sin(d);return a*(Math.sin((1-p)*d)/_)+u*(Math.sin(p*d)/_)}(t.a[e],t.b[e],t.angle,Jt(r,0,1))+t.center[e]}function pa(t){if(t.z<=1)return MB[t.z+2*t.y+t.x];let e=Mw(C0(t));return gi.fromPoints(e)}function cl(t,e,r){return i._.scale(t,t,1-r),i._.scaleAndAdd(t,t,e,r)}function fM(t,e){let r=ul(e.zoom);if(r===0)return pa(t);let a=C0(t),u=Mw(a),d=da(a.getWest())*e.worldSize,p=da(a.getEast())*e.worldSize,_=fa(a.getNorth())*e.worldSize,y=fa(a.getSouth())*e.worldSize,b=[d,_,0],E=[p,_,0],S=[d,y,0],D=[p,y,0],R=i.ad.invert([],e.globeMatrix);return i._.transformMat4(b,b,R),i._.transformMat4(E,E,R),i._.transformMat4(S,S,R),i._.transformMat4(D,D,R),u[0]=cl(u[0],S,r),u[1]=cl(u[1],D,r),u[2]=cl(u[2],E,r),u[3]=cl(u[3],b,r),gi.fromPoints(u)}function pM(t,e,r){for(let a of t)i._.transformMat4(a,a,e),i._.scale(a,a,r)}function mM(t,e,r,a){let u=e/t.worldSize,d=t.globeMatrix;if(r.z<=1){let Te=pa(r).getCorners();return pM(Te,d,u),gi.fromPoints(Te)}let p=C0(r,a),_=Mw(p,Yr+I0(t._tileCoverLift));pM(_,d,u);let y=Number.MAX_VALUE,b=[-y,-y,-y],E=[y,y,y];if(p.contains(t.center)){for(let De of _)i._.min(E,E,De),i._.max(b,b,De);b[2]=0;let Te=t.point,ke=[Te.x*u,Te.y*u,0];return i._.min(E,E,ke),i._.max(b,b,ke),new gi(E,b)}if(t._tileCoverLift>0){for(let Te of _)i._.min(E,E,Te),i._.max(b,b,Te);return new gi(E,b)}let S=[d[12]*u,d[13]*u,d[14]*u],D=p.getCenter(),R=Jt(t.center.lat,-ki,ki),k=Jt(D.lat,-ki,ki),F=da(t.center.lng),z=fa(R),j=F-da(D.lng),Y=z-fa(k);j>.5?j-=1:j<-.5&&(j+=1);let X=0;if(Math.abs(j)>Math.abs(Y))X=j>=0?1:3;else{X=Y>=0?0:2;let Te=[d[4]*u,d[5]*u,d[6]*u],ke=-Math.sin(dn(Y>=0?p.getSouth():p.getNorth()))*Yr;i._.scaleAndAdd(S,S,Te,ke)}let K=_[X],le=_[(X+1)%4],se=new AB(K,le,S),me=[Dw(se,0)||K[0],Dw(se,1)||K[1],Dw(se,2)||K[2]],_e=ul(t.zoom);if(_e>0){let Te=function({x:De,y:ze,z:Ye},Le,qe,Oe,We){let Je=1/(1<<Ye),Ze=De*Je,ht=Ze+Je,Xe=ze*Je,nt=Xe+Je,Et=0,xt=(Ze+ht)/2-Oe;return xt>.5?Et=-1:xt<-.5&&(Et=1),Ze=((Ze+Et)*Le-(Oe*=Le))*qe+Oe,ht=((ht+Et)*Le-Oe)*qe+Oe,Xe=(Xe*Le-(We*=Le))*qe+We,nt=(nt*Le-We)*qe+We,[[Ze,nt,0],[ht,nt,0],[ht,Xe,0],[Ze,Xe,0]]}(r,e,t._pixelsPerMercatorPixel,F,z);for(let De=0;De<_.length;De++)cl(_[De],Te[De],_e);let ke=i._.add([],Te[X],Te[(X+1)%4]);i._.scale(ke,ke,.5),cl(me,ke,_e)}for(let Te of _)i._.min(E,E,Te),i._.max(b,b,Te);return E[2]=Math.min(K[2],le[2]),i._.min(E,E,me),i._.max(b,b,me),new gi(E,b)}function C0({x:t,y:e,z:r},a=!1){let u=1/(1<<r),d=new bn(no(t*u),e===(1<<r)-1&&a?-90:sr((e+1)*u)),p=new bn(no((t+1)*u),e===0&&a?90:sr(e*u));return new bc(d,p)}function Mw(t,e=Yr){let r=dn(t.getNorth()),a=dn(t.getSouth()),u=Math.cos(r),d=Math.cos(a),p=Math.sin(r),_=Math.sin(a),y=t.getWest(),b=t.getEast();return[lf(d,_,y,e),lf(d,_,b,e),lf(u,p,b,e),lf(u,p,y,e)]}function eg(t,e,r,a){let u=1<<r.z,d=(t/rt+r.x)/u;return hh(sr((e/rt+r.y)/u),no(d),a)}function S0({min:t,max:e}){return mB/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let gM=new Float64Array(16);function tg(t){let e=S0(t),r=i.ad.fromScaling(gM,[e,e,e]);return i.ad.translate(r,r,i._.negate([],t.min))}function Aw(t){let e=i.ad.fromTranslation(gM,t.min),r=1/S0(t);return i.ad.scale(e,e,[r,r,r])}function Pw(t){let e=rt/(2*Math.PI);return t/(2*Math.PI)/e}function _M(t,e){return rt/(512*Math.pow(2,t))*S0(pa(e))}function yM(t,e,r,a,u){let d=Pw(r),p=[t,e,-r/(2*Math.PI)],_=i.ad.identity(new Float64Array(16));return i.ad.translate(_,_,p),i.ad.scale(_,_,[d,d,d]),i.ad.rotateX(_,_,dn(-u)),i.ad.rotateY(_,_,dn(-a)),_}function ul(t){return Ua(fw,ZD,t)}function vM(t,e){let r=hh(e.lat,e.lng),a=function(d){let p=hh(d._center.lat,d._center.lng),_=i._.fromValues(0,1,0),y=i._.cross([],_,p),b=i.ad.fromRotation([],-d.angle,p);y=i._.transformMat4(y,y,b),i.ad.fromRotation(b,-d._pitch,y);let E=i._.normalize([],p);return i._.scale(E,E,I0(d.cameraToCenterDistance/d.pixelsPerMeter)),i._.transformMat4(E,E,b),i._.add([],p,E)}(t),u=i._.subtract([],a,r);return i._.angle(u,r)}function Rw(t,e){return vM(t,e)>Math.PI/2*1.01}let xM=dn(85),PB=Math.cos(xM),RB=Math.sin(xM),kB=i.ad.create(),bM=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function wM(t,e,r,a,u,d,p,_,y){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(y*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,E=r.projection.upVectorScale(b,r.center.lat,r.worldSize).metersToTile;for(let S of e)for(let D of S){let R=D.add(_),k=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(R.x,R.y,!0):0,F=r.projection.projectTilePoint(R.x,R.y,b);if(k>0){let X=r.projection.upVector(b,R.x,R.y);F.x+=X[0]*E*k,F.y+=X[1]*E*k,F.z+=X[2]*E*k}let z=d?R:OB(F.x,F.y,F.z,a),j=d?t.tilespaceRays.map(X=>FB(X,k)):t.queryGeometry.screenGeometry,Y=i.aA.transformMat4([],[F.x,F.y,F.z,1],a);if(!p&&d?y*=Y[3]/r.cameraToCenterDistance:p&&!d&&(y*=r.cameraToCenterDistance/Y[3]),d){let X=sr((D.y/rt+b.y)/(1<<b.z));y/=r.projection.pixelsPerMeter(X,1)/Xr(1,X)}if(wB(j,z,y))return!0}return!1}function OB(t,e,r,a){let u=i.aA.transformMat4([],[t,e,r,1],a);return new lt(u[0]/u[3],u[1]/u[3])}let TM=i._.fromValues(0,0,0),LB=i._.fromValues(0,0,1);function FB(t,e){let r=i._.create();return TM[2]=e,t.intersectsPlane(TM,LB,r),new lt(r[0],r[1])}class EM extends xw{}function IM(t,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*a);return t.width=e,t.height=r,t.data=u,t}function CM(t,e,r){let{width:a,height:u}=e;a===t.width&&u===t.height||(kw(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,u)},r,null),t.width=a,t.height=u,t.data=e.data)}function kw(t,e,r,a,u,d,p,_){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||r.x>t.width-u.width||r.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,b=e.data,E=d===4&&_;for(let S=0;S<u.height;S++){let D=((r.y+S)*t.width+r.x)*d,R=((a.y+S)*e.width+a.x)*d;if(E)for(let k=0;k<u.width;k++){let F=D+k*d+3,z=R+k*d;b[z+0]=255,b[z+1]=255,b[z+2]=255,b[z+3]=y[F]}else if(p)for(let k=0;k<u.width;k++){let F=D+k*d,z=R+k*d,j=y[F+3],Y=new Tn(y[F+0]/255*j,y[F+1]/255*j,y[F+2]/255*j,j).toRenderColor(p).toArray();b[z+0]=Y[0],b[z+1]=Y[1],b[z+2]=Y[2],b[z+3]=Y[3]}else for(let k=0;k<u.width*d;k++)b[R+k]=y[D+k]}return e}J(EM,"HeatmapBucket",{omit:["layers"]});class Tc{constructor(e,r){IM(this,e,1,r)}resize(e){CM(this,new Tc(e),1)}clone(){return new Tc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,d){kw(e,r,a,u,d,1,null)}}class Lo{constructor(e,r){IM(this,e,4,r)}resize(e){CM(this,new Lo(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,d,p,_){kw(e,r,a,u,d,4,p,_)}}class SM{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}J(Tc,"AlphaImage"),J(Lo,"RGBAImage");let NB=new On({visibility:new Be(Ee.layout_heatmap.visibility)});var zB={paint:new On({"heatmap-radius":new ut(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Be(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gi(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Be(Ee.paint_heatmap["heatmap-opacity"])}),layout:NB};function ng(t){let e={},r=t.resolution||256,a=t.clips?t.clips.length:1,u=t.image||new Lo({width:r,height:a}),d=(p,_,y)=>{e[t.evaluationKey]=y;let b=t.expression.evaluate(e);b&&(u.data[p+_+0]=Math.floor(255*b.r/b.a),u.data[p+_+1]=Math.floor(255*b.g/b.a),u.data[p+_+2]=Math.floor(255*b.b/b.a),u.data[p+_+3]=Math.floor(255*b.a))};if(t.clips)for(let p=0,_=0;p<a;++p,_+=4*r)for(let y=0,b=0;y<r;y++,b+=4){let E=y/(r-1),{start:S,end:D}=t.clips[p];d(_,b,S*(1-E)+D*E)}else for(let p=0,_=0;p<r;p++,_+=4)d(0,_,p/(r-1));return u}let BB=new On({visibility:new Be(Ee.layout_hillshade.visibility)});var VB={paint:new On({"hillshade-illumination-direction":new Be(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Be(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Be(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Be(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Be(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Be(Ee.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Be(Ee.paint_hillshade["hillshade-emissive-strength"])}),layout:BB};let jB=An([{name:"a_pos",components:2,type:"Int16"}],4),{members:UB}=jB;function ig(t,e,r=2){let a=e&&e.length,u=a?e[0]*r:t.length,d=DM(t,0,u,r,!0),p=[];if(!d||d.next===d.prev)return p;let _,y,b;if(a&&(d=function(E,S,D,R){let k=[];for(let F=0,z=S.length;F<z;F++){let j=DM(E,S[F]*R,F<z-1?S[F+1]*R:E.length,R,!1);j===j.next&&(j.steiner=!0),k.push(XB(j))}k.sort(WB);for(let F=0;F<k.length;F++)D=ZB(k[F],D);return D}(t,e,d,r)),t.length>80*r){_=1/0,y=1/0;let E=-1/0,S=-1/0;for(let D=r;D<u;D+=r){let R=t[D],k=t[D+1];R<_&&(_=R),k<y&&(y=k),R>E&&(E=R),k>S&&(S=k)}b=Math.max(E-_,S-y),b=b!==0?32767/b:0}return rg(d,p,r,_,y,b,0),p}function DM(t,e,r,a,u){let d;if(u===function(p,_,y,b){let E=0;for(let S=_,D=y-b;S<y;S+=b)E+=(p[D]-p[S])*(p[S+1]+p[D+1]),D=S;return E}(t,e,r,a)>0)for(let p=e;p<r;p+=a)d=PM(p/a|0,t[p],t[p+1],d);else for(let p=r-a;p>=e;p-=a)d=PM(p/a|0,t[p],t[p+1],d);return d&&D0(d,d.next)&&(sg(d),d=d.next),d}function ph(t,e){if(!t)return t;e||(e=t);let r,a=t;do if(r=!1,a.steiner||!D0(a,a.next)&&qi(a.prev,a,a.next)!==0)a=a.next;else{if(sg(a),a=e=a.prev,a===a.next)break;r=!0}while(r||a!==e);return e}function rg(t,e,r,a,u,d,p){if(!t)return;!p&&d&&function(y,b,E,S){let D=y;do D.z===0&&(D.z=Ow(D.x,D.y,b,E,S)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==y);D.prevZ.nextZ=null,D.prevZ=null,function(R){let k,F=1;do{let z,j=R;R=null;let Y=null;for(k=0;j;){k++;let X=j,K=0;for(let se=0;se<F&&(K++,X=X.nextZ,X);se++);let le=F;for(;K>0||le>0&&X;)K!==0&&(le===0||!X||j.z<=X.z)?(z=j,j=j.nextZ,K--):(z=X,X=X.nextZ,le--),Y?Y.nextZ=z:R=z,z.prevZ=Y,Y=z;j=X}Y.nextZ=null,F*=2}while(k>1)}(D)}(t,a,u,d);let _=t;for(;t.prev!==t.next;){let y=t.prev,b=t.next;if(d?GB(t,a,u,d):$B(t))e.push(y.i,t.i,b.i),sg(t),t=b.next,_=b.next;else if((t=b)===_){p?p===1?rg(t=HB(ph(t),e),e,r,a,u,d,2):p===2&&qB(t,e,r,a,u,d):rg(ph(t),e,r,a,u,d,1);break}}}function $B(t){let e=t.prev,r=t,a=t.next;if(qi(e,r,a)>=0)return!1;let u=e.x,d=r.x,p=a.x,_=e.y,y=r.y,b=a.y,E=u<d?u<p?u:p:d<p?d:p,S=_<y?_<b?_:b:y<b?y:b,D=u>d?u>p?u:p:d>p?d:p,R=_>y?_>b?_:b:y>b?y:b,k=a.next;for(;k!==e;){if(k.x>=E&&k.x<=D&&k.y>=S&&k.y<=R&&df(u,_,d,y,p,b,k.x,k.y)&&qi(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function GB(t,e,r,a){let u=t.prev,d=t,p=t.next;if(qi(u,d,p)>=0)return!1;let _=u.x,y=d.x,b=p.x,E=u.y,S=d.y,D=p.y,R=_<y?_<b?_:b:y<b?y:b,k=E<S?E<D?E:D:S<D?S:D,F=_>y?_>b?_:b:y>b?y:b,z=E>S?E>D?E:D:S>D?S:D,j=Ow(R,k,e,r,a),Y=Ow(F,z,e,r,a),X=t.prevZ,K=t.nextZ;for(;X&&X.z>=j&&K&&K.z<=Y;){if(X.x>=R&&X.x<=F&&X.y>=k&&X.y<=z&&X!==u&&X!==p&&df(_,E,y,S,b,D,X.x,X.y)&&qi(X.prev,X,X.next)>=0||(X=X.prevZ,K.x>=R&&K.x<=F&&K.y>=k&&K.y<=z&&K!==u&&K!==p&&df(_,E,y,S,b,D,K.x,K.y)&&qi(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;X&&X.z>=j;){if(X.x>=R&&X.x<=F&&X.y>=k&&X.y<=z&&X!==u&&X!==p&&df(_,E,y,S,b,D,X.x,X.y)&&qi(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;K&&K.z<=Y;){if(K.x>=R&&K.x<=F&&K.y>=k&&K.y<=z&&K!==u&&K!==p&&df(_,E,y,S,b,D,K.x,K.y)&&qi(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function HB(t,e){let r=t;do{let a=r.prev,u=r.next.next;!D0(a,u)&&MM(a,r,r.next,u)&&og(a,u)&&og(u,a)&&(e.push(a.i,r.i,u.i),sg(r),sg(r.next),r=t=u),r=r.next}while(r!==t);return ph(r)}function qB(t,e,r,a,u,d){let p=t;do{let _=p.next.next;for(;_!==p.prev;){if(p.i!==_.i&&KB(p,_)){let y=AM(p,_);return p=ph(p,p.next),y=ph(y,y.next),rg(p,e,r,a,u,d,0),void rg(y,e,r,a,u,d,0)}_=_.next}p=p.next}while(p!==t)}function WB(t,e){return t.x-e.x}function ZB(t,e){let r=function(u,d){let p=d,_=u.x,y=u.y,b,E=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){let F=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=_&&F>E&&(E=F,b=p.x<p.next.x?p:p.next,F===_))return b}p=p.next}while(p!==d);if(!b)return null;let S=b,D=b.x,R=b.y,k=1/0;p=b;do{if(_>=p.x&&p.x>=D&&_!==p.x&&df(y<R?_:E,y,D,R,y<R?E:_,y,p.x,p.y)){let F=Math.abs(y-p.y)/(_-p.x);og(p,u)&&(F<k||F===k&&(p.x>b.x||p.x===b.x&&YB(b,p)))&&(b=p,k=F)}p=p.next}while(p!==S);return b}(t,e);if(!r)return e;let a=AM(r,t);return ph(a,a.next),ph(r,r.next)}function YB(t,e){return qi(t.prev,t,e.prev)<0&&qi(e.next,t,t.next)<0}function Ow(t,e,r,a,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function XB(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function df(t,e,r,a,u,d,p,_){return(u-p)*(e-_)>=(t-p)*(d-_)&&(t-p)*(a-_)>=(r-p)*(e-_)&&(r-p)*(d-_)>=(u-p)*(a-_)}function KB(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,a){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&MM(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(t,e)&&(og(t,e)&&og(e,t)&&function(r,a){let u=r,d=!1,p=(r.x+a.x)/2,_=(r.y+a.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&p<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==r);return d}(t,e)&&(qi(t.prev,t,e.prev)||qi(t,e.prev,e))||D0(t,e)&&qi(t.prev,t,t.next)>0&&qi(e.prev,e,e.next)>0)}function qi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function D0(t,e){return t.x===e.x&&t.y===e.y}function MM(t,e,r,a){let u=A0(qi(t,e,r)),d=A0(qi(t,e,a)),p=A0(qi(r,a,t)),_=A0(qi(r,a,e));return u!==d&&p!==_||!(u!==0||!M0(t,r,e))||!(d!==0||!M0(t,a,e))||!(p!==0||!M0(r,t,a))||!(_!==0||!M0(r,e,a))}function M0(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function A0(t){return t>0?1:t<0?-1:0}function og(t,e){return qi(t.prev,t,t.next)<0?qi(t,e,t.next)>=0&&qi(t,t.prev,e)>=0:qi(t,e,t.prev)<0||qi(t,t.next,e)<0}function AM(t,e){let r=Lw(t.i,t.x,t.y),a=Lw(e.i,e.x,e.y),u=t.next,d=e.prev;return t.next=e,e.prev=t,r.next=u,u.prev=r,a.next=r,r.prev=a,d.next=a,a.prev=d,a}function PM(t,e,r,a){let u=Lw(t,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function sg(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lw(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function P0(t,e){let r=t.length;if(r<=1)return[t];let a=[],u,d;for(let p=0;p<r;p++){let _=Ir(t[p]);_!==0&&(t[p].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(u&&a.push(u),u=[t[p]]):u.push(t[p]))}if(u&&a.push(u),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(k1(a[p],e,1,a[p].length-1,QB),a[p]=a[p].slice(0,e));return a}function QB(t,e){return e.area-t.area}function Fw(t,e,r){let a=r.patternDependencies,u=!1;for(let d of e){let p=d.paint.get(`${t}-pattern`);p.isConstant()||(u=!0);let _=p.constantOr(null);_&&(u=!0,a[_]=!0)}return u}function Nw(t,e,r,a,u){let d=u.patternDependencies;for(let p of e){let _=p.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:a},r,{},u.availableImages);y=y&&y.name?y.name:y,d[y]=!0,r.patterns[p.id]=y}}return r}class R0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Es,this.indexArray=new Qi,this.indexArray2=new yc,this.programConfigurations=new xc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new mi,this.segments2=new mi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}updateFootprints(e,r){}populate(e,r,a,u){this.hasPattern=Fw("fill",this.layers,r);let d=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:_,id:y,index:b,sourceLayerIndex:E}of e){let S=this.layers[0]._featureFilter.needGeometry,D=ll(_,S);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),D,a))continue;let R=d?d.evaluate(D,{},a,r.availableImages):void 0,k={id:y,properties:_.properties,type:_.type,sourceLayerIndex:E,index:b,geometry:S?D.geometry:Cs(_,a,u),patterns:{},sortKey:R};p.push(k)}d&&p.sort((_,y)=>_.sortKey-y.sortKey);for(let _ of p){let{geometry:y,index:b,sourceLayerIndex:E}=_;if(this.hasPattern){let S=Nw("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(_,y,b,a,{},r.availableImages,r.brightness);r.featureIndex.insert(e[b].feature,y,b,E,this.index)}}update(e,r,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,r,a,u,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UB),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,u,d,p=[],_){for(let y of P0(r,500)){let b=0;for(let F of y)b+=F.length;let E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=E.vertexLength,D=[],R=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&R.push(D.length/2);let z=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),j=z.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(j+F.length-1,j),D.push(F[0].x),D.push(F[0].y);for(let Y=1;Y<F.length;Y++)this.layoutVertexArray.emplaceBack(F[Y].x,F[Y].y),this.indexArray2.emplaceBack(j+Y-1,j+Y),D.push(F[Y].x),D.push(F[Y].y);z.vertexLength+=F.length,z.primitiveLength+=F.length}let k=ig(D,R);for(let F=0;F<k.length;F+=3)this.indexArray.emplaceBack(S+k[F],S+k[F+1],S+k[F+2]);E.vertexLength+=b,E.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,_)}}J(R0,"FillBucket",{omit:["layers","patternFeatures"]});let JB=new On({"fill-sort-key":new ut(Ee.layout_fill["fill-sort-key"]),visibility:new Be(Ee.layout_fill.visibility)});var e5={paint:new On({"fill-antialias":new Be(Ee.paint_fill["fill-antialias"]),"fill-opacity":new ut(Ee.paint_fill["fill-opacity"]),"fill-color":new ut(Ee.paint_fill["fill-color"]),"fill-outline-color":new ut(Ee.paint_fill["fill-outline-color"]),"fill-translate":new Be(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new Be(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new ut(Ee.paint_fill["fill-pattern"]),"fill-emissive-strength":new Be(Ee.paint_fill["fill-emissive-strength"])}),layout:JB};class zw{constructor(e,r,a,u){if(this.triangleCount=r.length/3,this.min=new lt(0,0),this.max=new lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[d,p]=[e[0].clone(),e[0].clone()];for(let S=1;S<e.length;++S){let D=e[S];d.x=Math.min(d.x,D.x),d.y=Math.min(d.y,D.y),p.x=Math.max(p.x,D.x),p.y=Math.max(p.y,D.y)}if(u){let S=Math.ceil(Math.max(p.x-d.x,p.y-d.y)/u);a=Math.max(a,S)}if(a===0)return;this.min=d,this.max=p;let _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);let y=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/y)),this.cellsY=Math.max(1,Math.ceil(_.y/y)),this.xScale=1/y,this.yScale=1/y;let b=[];for(let S=0;S<this.triangleCount;S++){let D=e[r[3*S+0]].sub(this.min),R=e[r[3*S+1]].sub(this.min),k=e[r[3*S+2]].sub(this.min),F=ma(Math.floor(Math.min(D.x,R.x,k.x)),this.xScale,this.cellsX),z=ma(Math.floor(Math.max(D.x,R.x,k.x)),this.xScale,this.cellsX),j=ma(Math.floor(Math.min(D.y,R.y,k.y)),this.yScale,this.cellsY),Y=ma(Math.floor(Math.max(D.y,R.y,k.y)),this.yScale,this.cellsY),X=new lt(0,0),K=new lt(0,0),le=new lt(0,0),se=new lt(0,0);for(let me=j;me<=Y;++me){X.y=K.y=me*y,le.y=se.y=(me+1)*y;for(let _e=F;_e<=z;++_e)X.x=le.x=_e*y,K.x=se.x=(_e+1)*y,(Ew(D,R,k,X,K,se)||Ew(D,R,k,X,se,le))&&b.push({cellIdx:me*this.cellsX+_e,triIdx:S})}}if(b.length===0)return;b.sort((S,D)=>S.cellIdx-D.cellIdx||S.triIdx-D.triIdx);let E=0;for(;E<b.length;){let S=b[E].cellIdx,D={start:this.payload.length,len:0};for(;E<b.length&&b[E].cellIdx===S;)++D.len,this.payload.push(b[E++].triIdx);this.cells[S]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=ma(e.x-this.min.x,this.xScale,this.cellsX),u=ma(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[u*this.cellsX+a];if(d){this._lazyInitLookup();for(let p=0;p<d.len;p++){let _=this.payload[d.start+p],y=Math.floor(_/8),b=1<<_%8;if(!(this.lookup[y]&b)&&(this.lookup[y]|=b,r.push(_),r.length===this.triangleCount))return}}}query(e,r,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();let u=ma(e.x-this.min.x,this.xScale,this.cellsX),d=ma(r.x-this.min.x,this.xScale,this.cellsX),p=ma(e.y-this.min.y,this.yScale,this.cellsY),_=ma(r.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=_;y++)for(let b=u;b<=d;b++){let E=this.cells[y*this.cellsX+b];if(E)for(let S=0;S<E.len;S++){let D=this.payload[E.start+S],R=Math.floor(D/8),k=1<<D%8;if(!(this.lookup[R]&k)&&(this.lookup[R]|=k,a.push(D),a.length===this.triangleCount))return}}}}function ma(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}J(zw,"TriangleGridIndex");class RM{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(let a of this.footprints)r.push({footprint:a,id:e})}populate(e,r,a,u){let d=[];for(let{feature:p,id:_,index:y,sourceLayerIndex:b}of e){let E=this.layers[0]._featureFilter.needGeometry,S=ll(p,E);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),S,a))continue;let D={id:_,properties:p.properties,type:p.type,sourceLayerIndex:b,index:y,geometry:E?S.geometry:Cs(p,a,u),patterns:{}};d.push(D)}for(let p of d){let{geometry:_,index:y,sourceLayerIndex:b}=p;this.addFeature(p,_,y,a,{},r.availableImages,r.brightness),r.featureIndex.insert(e[y].feature,_,y,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,a,u,d){}destroy(){}addFeature(e,r,a,u,d,p=[],_){for(let y of P0(r,2)){let b=[],E=[],S=[],D=new lt(1/0,1/0),R=new lt(-1/0,-1/0);for(let z of y)if(z.length!==0){z!==y[0]&&S.push(E.length/2);for(let j=0;j<z.length;j++)E.push(z[j].x),E.push(z[j].y),b.push(z[j]),D.x=Math.min(D.x,z[j].x),D.y=Math.min(D.y,z[j].y),R.x=Math.max(R.x,z[j].x),R.y=Math.max(R.y,z[j].y)}let k=ig(E,S),F=new zw(b,k,8,256);this.footprints.push({vertices:b,indices:k,grid:F,min:D,max:R})}}}J(RM,"ClipBucket",{omit:["layers"]});let t5=new On({"clip-layer-types":new Be(Ee.layout_clip["clip-layer-types"])});var n5={paint:new On({}),layout:t5};let i5=An([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),r5=An([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),o5=An([{name:"a_centroid_pos",components:2,type:"Uint16"}]),s5=An([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),a5=An([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:l5}=i5;var k0={},c5=vd,kM=ff;function ff(t,e,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=u,t.readFields(u5,this,e)}function u5(t,e,r){t==1?e.id=r.readVarint():t==2?function(a,u){for(var d=a.readVarint()+a.pos;a.pos<d;){var p=u._keys[a.readVarint()],_=u._values[a.readVarint()];u.properties[p]=_}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function h5(t){for(var e,r,a=0,u=0,d=t.length,p=d-1;u<d;p=u++)a+=((r=t[p]).x-(e=t[u]).x)*(e.y+r.y);return a}ff.types=["Unknown","Point","LineString","Polygon"],ff.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,a=1,u=0,d=0,p=0,_=[];t.pos<r;){if(u<=0){var y=t.readVarint();a=7&y,u=y>>3}if(u--,a===1||a===2)d+=t.readSVarint(),p+=t.readSVarint(),a===1&&(e&&_.push(e),e=[]),e.push(new c5(d,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},ff.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,a=0,u=0,d=0,p=1/0,_=-1/0,y=1/0,b=-1/0;t.pos<e;){if(a<=0){var E=t.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(u+=t.readSVarint())<p&&(p=u),u>_&&(_=u),(d+=t.readSVarint())<y&&(y=d),d>b&&(b=d);else if(r!==7)throw new Error("unknown command "+r)}return[p,y,_,b]},ff.prototype.toGeoJSON=function(t,e,r){var a,u,d=this.extent*Math.pow(2,r),p=this.extent*t,_=this.extent*e,y=this.loadGeometry(),b=ff.types[this.type];function E(R){for(var k=0;k<R.length;k++){var F=R[k];R[k]=[360*(F.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(a=0;a<y.length;a++)S[a]=y[a][0];E(y=S);break;case 2:for(a=0;a<y.length;a++)E(y[a]);break;case 3:for(y=function(R){var k=R.length;if(k<=1)return[R];for(var F,z,j=[],Y=0;Y<k;Y++){var X=h5(R[Y]);X!==0&&(z===void 0&&(z=X<0),z===X<0?(F&&j.push(F),F=[R[Y]]):F.push(R[Y]))}return F&&j.push(F),j}(y),a=0;a<y.length;a++)for(u=0;u<y[a].length;u++)E(y[a][u])}y.length===1?y=y[0]:b="Multi"+b;var D={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(D.id=this.id),D};var d5=kM,OM=LM;function LM(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(f5,this,e),this.length=this._features.length}function f5(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(a){for(var u=null,d=a.readVarint()+a.pos;a.pos<d;){var p=a.readVarint()>>3;u=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return u}(r))}LM.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new d5(this._pbf,e,this.extent,this._keys,this._values)};var p5=OM;function m5(t,e,r){if(t===3){var a=new p5(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var Bw=k0.VectorTile=function(t,e){this.layers=t.readFields(m5,{},e)},O0=k0.VectorTileFeature=kM;k0.VectorTileLayer=OM;class mh extends lt{constructor(e,r,a){super(e,r),this.z=a}}class FM extends mh{constructor(e,r,a,u){super(e,r,a),this.w=u}}function L0(t,e,r,a){let u=[],d=a===0?(p,_,y,b,E,S)=>{p.push(new lt(S,y+(S-_)/(b-_)*(E-y)))}:(p,_,y,b,E,S)=>{p.push(new lt(_+(S-y)/(E-y)*(b-_),S))};for(let p of t){let _=[];for(let y of p){if(y.length<=2)continue;let b=[];for(let D=0;D<y.length-1;D++){let R=y[D].x,k=y[D].y,F=y[D+1].x,z=y[D+1].y,j=a===0?R:k,Y=a===0?F:z;j<e?Y>e&&d(b,R,k,F,z,e):j>r?Y<r&&d(b,R,k,F,z,r):b.push(y[D]),Y<e&&j>=e&&d(b,R,k,F,z,e),Y>r&&j<=r&&d(b,R,k,F,z,r)}let E=y[y.length-1],S=a===0?E.x:E.y;S>=e&&S<=r&&b.push(E),b.length&&(E=b[b.length-1],b[0].x===E.x&&b[0].y===E.y||b.push(b[0]),_.push(b))}_.length&&u.push(_)}return u}function NM(t,e,r,a){let u=r==="x"?"y":"x",d=(a-t[r])/(e[r]-t[r]);t[u]=t[u]+(e[u]-t[u])*d,t[r]=a,t.hasOwnProperty("z")&&(t.z=St(t.z,e.z,d)),t.hasOwnProperty("w")&&(t.w=St(t.w,e.w,d))}function zM(t,e,r,a){let u=r,d=a;for(let p of["x","y"]){let _=t,y=e;_[p]>=y[p]&&(_=e,y=t),_[p]<u&&y[p]>u&&NM(_,y,p,u),_[p]<d&&y[p]>d&&NM(y,_,p,d)}}function F0(t,e){return t.x-e.x||t.y-e.y}function BM(t,e){return F0(t.min,e.min)===0&&F0(t.max,e.max)===0}function Vw(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function jw(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r].sourceId!==e[r].sourceId||!BM(t[r],e[r])||t[r].order!==e[r].order||t[r].clipMask!==e[r].clipMask)return!1;return!0}function VM(t,e,r){let a=1/rt,u=1/(1<<r.canonical.z),d=(e.x*a+r.canonical.x)*u+r.wrap,p=(e.y*a+r.canonical.y)*u;return{min:new lt((t.x*a+r.canonical.x)*u+r.wrap,(t.y*a+r.canonical.y)*u),max:new lt(d,p)}}function g5(t,e,r){let a=1<<r.canonical.z,u=((e.x-r.wrap)*a-r.canonical.x)*rt,d=(e.y*a-r.canonical.y)*rt;return{min:new lt(((t.x-r.wrap)*a-r.canonical.x)*rt,(t.y*a-r.canonical.y)*rt),max:new lt(u,d)}}function jM(t,e,r,a,u,d,p){let _=t.indices,y=t.vertices,b=[];for(let E=a;E<a+u;E+=3){let S=e[r[E+0]+d],D=e[r[E+1]+d],R=e[r[E+2]+d],k=Math.min(S.x,D.x,R.x),F=Math.max(S.x,D.x,R.x),z=Math.min(S.y,D.y,R.y),j=Math.max(S.y,D.y,R.y);b.length=0,t.grid.query(new lt(k,z),new lt(F,j),b);for(let Y=0;Y<b.length;Y++){let X=b[Y];if(Ew(y[_[3*X+0]],y[_[3*X+1]],y[_[3*X+2]],S,D,R,p))return!0}}return!1}function UM(t,e,r,a){if(!t||!r)return!1;let u=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(r.vertices.length<t.vertices.length)return UM(r,a,t,e);let d=e.canonical,p=a.canonical,_=Math.pow(2,p.z-d.z);u=t.vertices.map(y=>new lt((y.x+d.x*rt)*_-p.x*rt,(y.y+d.y*rt)*_-p.y*rt))}return jM(r,u,t.indices,0,t.indices.length,0,0)}function $M(t,e,r,a){let u=Math.pow(2,a.z-r.z);return new lt((t+r.x*rt)*u-a.x*rt,(e+r.y*rt)*u-a.y*rt)}function GM(t,e){let r=[];e.footprint.grid.queryPoint(t,r);let a=e.footprint.indices,u=e.footprint.vertices;for(let d=0;d<r.length;d++){let p=r[d];if(wc([u[a[3*p+0]],u[a[3*p+1]],u[a[3*p+2]]],t))return!0}return!1}class HM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){let a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function qM(t,e,r,a){let u=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(r[p]<t[p]||r[p]>e[p])return null}else{let _=1/a[p],y=(t[p]-r[p])*_,b=(e[p]-r[p])*_;if(y>b){let E=y;y=b,b=E}if(y>u&&(u=y),b<d&&(d=b),u>d)return null}return u}function WM(t,e,r,a,u,d,p,_,y,b,E){let S=a-t,D=u-e,R=d-r,k=p-t,F=_-e,z=y-r,j=E[1]*z-E[2]*F,Y=E[2]*k-E[0]*z,X=E[0]*F-E[1]*k,K=S*j+D*Y+R*X;if(Math.abs(K)<1e-15)return null;let le=1/K,se=b[0]-t,me=b[1]-e,_e=b[2]-r,Te=(se*j+me*Y+_e*X)*le;if(Te<0||Te>1)return null;let ke=me*R-_e*D,De=_e*S-se*R,ze=se*D-me*S,Ye=(E[0]*ke+E[1]*De+E[2]*ze)*le;return Ye<0||Te+Ye>1?null:(k*ke+F*De+z*ze)*le}function ZM(t,e,r){return(t-e)/(r-e)}function YM(t,e,r,a,u,d,p,_,y){let b=1<<r,E=d-a,S=p-u,D=(t+1)/b*E+a,R=(e+0)/b*S+u,k=(e+1)/b*S+u;_[0]=(t+0)/b*E+a,_[1]=R,y[0]=D,y[1]=k}class XM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(d){let p=Math.ceil(Math.log2(d.dim/8)),_=[],y=Math.ceil(Math.pow(2,p)),b=1/y,E=(R,k,F,z,j)=>{let Y=z?1:0,X=(R+1)*F-Y,K=k*F,le=(k+1)*F-Y;j[0]=R*F,j[1]=K,j[2]=X,j[3]=le},S=new HM(y),D=[];for(let R=0;R<y*y;R++){E(R%y,Math.floor(R/y),b,!1,D);let k=Ec(D[0],D[1],d),F=Ec(D[2],D[1],d),z=Ec(D[2],D[3],d),j=Ec(D[0],D[3],d);S.minimums.push(Math.min(k,F,z,j)),S.maximums.push(Math.max(k,F,z,j)),S.leaves.push(1)}for(_.push(S),y/=2;y>=1;y/=2){let R=_[_.length-1];S=new HM(y);for(let k=0;k<y*y;k++){E(k%y,Math.floor(k/y),2,!0,D);let F=R.getElevation(D[0],D[1]),z=R.getElevation(D[2],D[1]),j=R.getElevation(D[2],D[3]),Y=R.getElevation(D[0],D[3]),X=R.isLeaf(D[0],D[1]),K=R.isLeaf(D[2],D[1]),le=R.isLeaf(D[2],D[3]),se=R.isLeaf(D[0],D[3]),me=Math.min(F.min,z.min,j.min,Y.min),_e=Math.max(F.max,z.max,j.max,Y.max),Te=X&&K&&le&&se;S.maximums.push(_e),S.minimums.push(me),S.leaves.push(_e-me<=5&&Te?1:0)}_.push(S)}return _}(this.dem),a=r.length-1,u=r[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,u,d,p,_=1){return qM([e,r,-100],[a,u,this.maximums[0]*_],d,p)}raycast(e,r,a,u,d,p,_=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,r,a,u,d,p,_);if(y==null)return null;let b=[],E=[],S=[],D=[],R=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;R.length>0;){let{idx:k,t:F,nodex:z,nodey:j,depth:Y}=R.pop();if(this.leaves[k]){YM(z,j,Y,e,r,a,u,S,D);let K=1<<Y,le=(z+0)/K,se=(z+1)/K,me=(j+0)/K,_e=(j+1)/K,Te=Ec(le,me,this.dem)*_,ke=Ec(se,me,this.dem)*_,De=Ec(se,_e,this.dem)*_,ze=Ec(le,_e,this.dem)*_,Ye=WM(S[0],S[1],Te,D[0],S[1],ke,D[0],D[1],De,d,p),Le=WM(D[0],D[1],De,S[0],D[1],ze,S[0],S[1],Te,d,p),qe=Math.min(Ye!==null?Ye:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{let Oe=i._.scaleAndAdd([],d,p,F);if(KM(Te,ke,ze,De,ZM(Oe[0],S[0],D[0]),ZM(Oe[1],S[1],D[1]))>=Oe[2])return F}continue}let X=0;for(let K=0;K<this._siblingOffset.length;K++){YM((z<<1)+this._siblingOffset[K][0],(j<<1)+this._siblingOffset[K][1],Y+1,e,r,a,u,S,D),S[2]=-100,D[2]=this.maximums[this.childOffsets[k]+K]*_;let le=qM(S,D,d,p);if(le!=null){let se=le;b[K]=se;let me=!1;for(let _e=0;_e<X&&!me;_e++)se>=b[E[_e]]&&(E.splice(_e,0,K),me=!0);me||(E[X]=K),X++}}for(let K=0;K<X;K++){let le=E[K];R.push({idx:this.childOffsets[k]+le,t:b[le],nodex:(z<<1)+this._siblingOffset[le][0],nodey:(j<<1)+this._siblingOffset[le][1],depth:Y+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,u,d){if(e[u].isLeaf(r,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let p=u-1,_=e[p],y=0,b=0;for(let E=0;E<this._siblingOffset.length;E++){let S=2*r+this._siblingOffset[E][0],D=2*a+this._siblingOffset[E][1],R=_.getElevation(S,D),k=_.isLeaf(S,D),F=this._addNode(R.min,R.max,k);k&&(y|=1<<E),b||(b=F)}for(let E=0;E<this._siblingOffset.length;E++)y&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*a+this._siblingOffset[E][1],p,b+E)}}function KM(t,e,r,a,u,d){return St(St(t,r,d),St(e,a,d),u)}function Ec(t,e,r){let a=r.dim,u=Jt(t*a-.5,0,a-1),d=Jt(e*a-.5,0,a-1),p=Math.floor(u),_=Math.floor(d),y=Math.min(p+1,a-1),b=Math.min(_+1,a-1);return KM(r.get(p,_),r.get(y,_),r.get(p,b),r.get(y,b),u-p,d-_)}let _5={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function y5(t,e,r){return(256*t*256+256*e+r)/10-1e4}function v5(t,e,r){return 256*t+e+r/256-32768}class N0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Pi(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let d=this.dim=r.height-2,p=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let y=0;y<d;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(d,y)]=p[this._idx(d-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,d)]=p[this._idx(y,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}let _=a==="terrarium"?v5:y5;for(let y=0;y<p.length;++y){let b=4*y;this.floatView[y]=_(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=rr.now()}_buildQuadTree(){this._tree=new XM(this)}get(e,r,a=!1){a&&(e=Jt(e,-1,this.dim),r=Jt(r,-1,this.dim));let u=this._idx(e,r);return this.floatView[u]}set(e,r,a){let u=this._idx(e,r),d=this.floatView[u];return this.floatView[u]=a,a-d}static getUnpackVector(e){return _5[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){let a=[0,0,0,0],u=N0.getUnpackVector(r),d=Math.floor((e+u[3])/u[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new SM({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,d=r*this.dim+this.dim,p=a*this.dim,_=a*this.dim+this.dim;switch(r){case-1:u=d-1;break;case 1:d=u+1}switch(a){case-1:p=_-1;break;case 1:_=p+1}let y=-r*this.dim,b=-a*this.dim;for(let E=p;E<_;E++)for(let S=u;S<d;S++){let D=4*this._idx(S,E),R=4*this._idx(S+y,E+b);this.pixels[D+0]=e.pixels[R+0],this.pixels[D+1]=e.pixels[R+1],this.pixels[D+2]=e.pixels[R+2],this.pixels[D+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}J(N0,"DEMData"),J(XM,"DemMinMaxQuadTree",{omit:["dem"]});class pf{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){let u=a||e.findDEMTileFor(r);if(!u||!u.dem)return;let d=u.dem,p=u.tileID,_=1<<r.canonical.z-p.canonical.z;return new pf(u,d.dim/rt/_,[(r.canonical.x/_-p.canonical.x)*d.dim,(r.canonical.y/_-p.canonical.y)*d.dim])}tileCoordToPixel(e,r){let a=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new lt(u,d)}getElevationAt(e,r,a,u){let d=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],_=Math.floor(d),y=Math.floor(p),b=this._dem;return u=!!u,a?St(St(b.get(_,y,u),b.get(_,y+1,u),p-y),St(b.get(_+1,y,u),b.get(_+1,y+1,u),p-y),d-_):b.get(_,y,u)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Xr(1,e)*this._dem.stride}}let QM={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},x5=O0.types,b5=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],w5=["fill-extrusion-flood-light-ground-radius"],T5=Math.pow(2,13),E5=Math.pow(2,15)-1,JM=new lt(0,1),Ic=2147483648;function ag(t,e,r,a,u,d,p,_){t.emplaceBack((e<<1)+p,(r<<1)+d,(Math.floor(a*T5)<<1)+u,Math.round(_))}function z0(t,e,r,a,u,d){t.emplaceBack(e.x,e.y,(r.x<<1)+a,(r.y<<1)+u,d)}function lg(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class eA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class tA{constructor(){this.centroidXY=new lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class nA{constructor(){this.acc=new lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,a){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===rt)&&r.x===a.x)!=((r.y===0||r.y===rt)&&r.y===a.y)&&this.processBorderOverlap(r,a),u&&this.checkBorderIntersection(r,a)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,St(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>rt!=e.x>rt&&this.addBorderIntersection(1,St(r.y,e.y,(rt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,St(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>rt!=e.y>rt&&this.addBorderIntersection(3,St(r.x,e.x,(rt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new lt(0,0):new lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function iA(t,e){let r=t.add(e)._unit(),a=Jt(t.x*r.x+t.y*r.y,-1,1);var u,d,p;return u=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(u)))/4*E5*((d=t).x*(p=e).y-d.y*p.x<0?-1:1)}let I5=[t=>t.x<0,t=>t.x>rt,t=>t.y<0,t=>t.y>rt];function C5(t,e,r,a){let u=[4];if(a===0)return u;r._mult(a);let d=t.sub(r),p=e.sub(r),_=[t,e,d,p];for(let y=0;y<4;y++)for(let b of _)if(I5[y](b)){u.push(y);break}return u}class rA{constructor(e){this.vertexArray=new q1,this.indexArray=new Qi,this.programConfigurations=new xc(e.layers,{zoom:e.zoom,lut:e.lut},r=>w5.includes(r)),this._segments=new mi,this.hiddenByLandmarkVertexArray=new sw,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new mi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,a,u=!1){let d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let b=e[0],E=e[1];y=iA(b.sub(e[d-1])._perp()._unit(),E.sub(b)._perp()._unit())}for(let b=0;b<d;b++){let E=b===d-1?0:b+1,S=e[b],D=e[E],R=e[E===d-1?0:E+1],k=D.sub(S)._perp()._unit(),F=iA(k,R.sub(D)._perp()._unit()),z=y,j=F;if(Uw(S,D,r)||u&&aA(S,r)&&aA(D,r)){y=F;continue}let Y=_.vertexLength;z0(this.vertexArray,S,D,1,1,z),z0(this.vertexArray,S,D,1,0,z),z0(this.vertexArray,S,D,0,1,j),z0(this.vertexArray,S,D,0,0,j),_.vertexLength+=4;let X=C5(S,D,k,a);for(let K of X)this._segmentToGroundQuads[p].push({id:Y,region:K}),this._segmentToRegionTriCounts[p][K]+=2,_.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),r=e.length;for(let a=0;a<r;a++)this._segmentToGroundQuads[a].sort((u,d)=>u.region-d.region);for(let a=0;a<r;a++){let u=this._segmentToGroundQuads[a],d=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((y,b)=>y+b,0);let _=0;for(let y=0;y<=4;y++){let b=p[y];if(b!==0){let E=this.regionSegments[y];E||(E=this.regionSegments[y]=new mi);let S={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:b};E.get().push(S)}_+=b}for(let y=0;y<u.length;y++){let b=u[y].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,a,u,d,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,a,u,d,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,r5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,a,u,d,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,a,u,d,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&Ic?1:0;for(let u=e.groundVertexArrayOffset;u<r;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,s5.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let r=this.regionSegments[e];r&&r.destroy()}}}}class B0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Qi,this.footprintVertices=new Es,this.footprintSegments=[],this.layoutVertexArray=new pc,this.centroidVertexArray=new $D,this.indexArray=new Qi,this.programConfigurations=new xc(e.layers,{zoom:e.zoom,lut:e.lut},r=>b5.includes(r)),this.segments=new mi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new rA(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,a,u){this.features=[],this.hasPattern=Fw("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=x0(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:d,id:p,index:_,sourceLayerIndex:y}of e){let b=this.layers[0]._featureFilter.needGeometry,E=ll(d,b);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),E,a))continue;let S={id:p,sourceLayerIndex:y,index:_,geometry:b?E.geometry:Cs(d,a,u),properties:d.properties,type:d.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(Nw("fill-extrusion",this.layers,S,this.zoom,r)):this.addFeature(S,S.geometry,_,a,{},r.availableImages,u,r.brightness),r.featureIndex.insert(d,S.geometry,_,y,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,a,u,d,p){for(let _ of this.features){let{geometry:y}=_;this.addFeature(_,y,_.index,r,a,u,d,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,a,u,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,_,a,u,d),this.groundEffect.update(e,r,_,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l5),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,a5.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,o5.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u,d,p,_,y){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new lt(0,0),new lt(rt,rt)],S=_.projection,D=S.name==="globe",R=x5[e.type]==="Polygon",k=new nA;k.centroidDataIndex=this.centroidData.length;let F=new tA,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);F.height=j,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new m0);let Y=P0(r,500);for(let _e=Y.length-1;_e>=0;_e--){let Te=Y[_e];(Te.length===0||(X=Te[0]).every(ke=>ke.x<=0)||X.every(ke=>ke.x>=rt)||X.every(ke=>ke.y<=0)||X.every(ke=>ke.y>=rt))&&Y.splice(_e,1)}var X;let K;if(D)K=hA(Y,E,u);else{K=[];for(let _e of Y)K.push({polygon:_e,bounds:E})}let le=R?this.edgeRadius:0,se=le>0&&this.zoom<17,me=(_e,Te)=>{if(_e.length===0)return!1;let ke=_e[_e.length-1];return Te.x===ke.x&&Te.y===ke.y};for(let{polygon:_e,bounds:Te}of K){let ke=0,De=0;for(let qe of _e)R&&!qe[0].equals(qe[qe.length-1])&&qe.push(qe[0]),De+=R?qe.length-1:qe.length;let ze=this.segments.prepareSegment((R?5:4)*De,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let Ye={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Le=new eA;if(Le.vertexOffset=this.footprintVertices.length,Le.indexOffset=3*this.footprintIndices.length,Le.ringIndices=[],R){let qe=[],Oe=[];ke=ze.vertexLength;for(let Je=0;Je<_e.length;Je++){let Ze=_e[Je];Ze.length&&Je!==0&&Oe.push(qe.length/2);let ht=[],Xe,nt;Xe=Ze[1].sub(Ze[0])._perp()._unit(),Le.ringIndices.push(Ze.length-1);for(let Et=1;Et<Ze.length;Et++){let xt=Ze[Et],_t=Ze[Et===Ze.length-1?1:Et+1],et=xt.clone();if(le){nt=_t.sub(xt)._perp()._unit();let It=Xe.add(nt)._unit(),Wt=le*Math.min(4,1/(Xe.x*It.x+Xe.y*It.y));et.x+=Wt*It.x,et.y+=Wt*It.y,et.x=Math.round(et.x),et.y=Math.round(et.y),Xe=nt}!z||le!==0&&!se||me(ht,et)||ht.push(et),ag(this.layoutVertexArray,et.x,et.y,0,0,1,1,0),ze.vertexLength++,this.footprintVertices.emplaceBack(xt.x,xt.y),qe.push(xt.x,xt.y),D&&lg(this.layoutVertexExtArray,S.projectTilePoint(et.x,et.y,u),S.upVector(u,et.x,et.y))}z&&(le===0||se)&&(ht.length!==0&&me(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,Te,b))}let We=ig(qe,Oe);for(let Je=0;Je<We.length;Je+=3)this.footprintIndices.emplaceBack(Le.vertexOffset+We[Je+0],Le.vertexOffset+We[Je+1],Le.vertexOffset+We[Je+2]),this.indexArray.emplaceBack(ke+We[Je],ke+We[Je+2],ke+We[Je+1]),ze.primitiveLength++;Le.indexCount+=We.length,Le.vertexCount+=this.footprintVertices.length-Le.vertexOffset}for(let qe=0;qe<_e.length;qe++){let Oe=_e[qe];k.startRing(F,Oe[0]);let We=Oe.length>4&&lA(Oe[Oe.length-2],Oe[0],Oe[1]),Je=le?S5(Oe[Oe.length-2],Oe[0],Oe[1],le):0,Ze=[],ht,Xe,nt;Xe=Oe[1].sub(Oe[0])._perp()._unit();let Et=!0;for(let xt=1,_t=0;xt<Oe.length;xt++){let et=Oe[xt-1],It=Oe[xt],Wt=Oe[xt===Oe.length-1?1:xt+1];if(k.appendEdge(F,It,et),Uw(It,et,Te)){le&&(Xe=Wt.sub(It)._perp()._unit(),Et=!Et);continue}let Pt=It.sub(et)._perp(),Xt=Pt.x/(Math.abs(Pt.x)+Math.abs(Pt.y)),Zt=Pt.y>0?1:0,sn=et.dist(It);if(_t+sn>32768&&(_t=0),le){nt=Wt.sub(It)._perp()._unit();let Cn=sA(et,It,Wt,oA(Xe,nt),le);isNaN(Cn)&&(Cn=0);let mn=It.sub(et)._unit();et=et.add(mn.mult(Je))._round(),It=It.add(mn.mult(-Cn))._round(),Je=Cn,Xe=nt,z&&this.zoom>=17&&(me(Ze,et)||Ze.push(et),me(Ze,It)||Ze.push(It))}let Dt=ze.vertexLength,Un=Oe.length>4&&lA(et,It,Wt),Vn=cA(_t,We,Et);if(ag(this.layoutVertexArray,et.x,et.y,Xt,Zt,0,0,Vn),ag(this.layoutVertexArray,et.x,et.y,Xt,Zt,0,1,Vn),_t+=sn,Vn=cA(_t,Un,!Et),We=Un,ag(this.layoutVertexArray,It.x,It.y,Xt,Zt,0,0,Vn),ag(this.layoutVertexArray,It.x,It.y,Xt,Zt,0,1,Vn),ze.vertexLength+=4,this.indexArray.emplaceBack(Dt+0,Dt+1,Dt+2),this.indexArray.emplaceBack(Dt+1,Dt+3,Dt+2),ze.primitiveLength+=2,le){let Cn=ke+(xt===1?Oe.length-2:xt-2),mn=xt===1?ke:Cn+1;if(this.indexArray.emplaceBack(Dt+1,Cn,Dt+3),this.indexArray.emplaceBack(Cn,mn,Dt+3),ze.primitiveLength+=2,ht===void 0&&(ht=Dt),!Uw(Wt,Oe[xt],Te)){let Sn=xt===Oe.length-1?ht:ze.vertexLength;this.indexArray.emplaceBack(Dt+2,Dt+3,Sn),this.indexArray.emplaceBack(Dt+3,Sn+1,Sn),this.indexArray.emplaceBack(Dt+3,mn,Sn+1),ze.primitiveLength+=3}Et=!Et}if(D){let Cn=this.layoutVertexExtArray,mn=S.projectTilePoint(et.x,et.y,u),Sn=S.projectTilePoint(It.x,It.y,u),Jn=S.upVector(u,et.x,et.y),Wn=S.upVector(u,It.x,It.y);lg(Cn,mn,Jn),lg(Cn,mn,Jn),lg(Cn,Sn,Wn),lg(Cn,Sn,Wn)}}R&&(ke+=Oe.length-1),z&&le&&this.zoom>=17&&(Ze.length!==0&&me(Ze,Ze[0])&&Ze.pop(),this.groundEffect.addData(Ze,Te,b,le>0))}this.footprintSegments.push(Le),Ye.triangleCount=this.indexArray.length-Ye.triangleArrayOffset,this.polygonSegments.push(Ye),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=k.borders?JM:this.encodeCentroid(k,F),this.centroidData.push(F),k.borders){this.featuresOnBorder.push(k);let _e=this.featuresOnBorder.length-1;for(let Te=0;Te<k.borders.length;Te++)k.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(_e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,y),this.groundEffect.addPaintPropertiesData(e,a,d,p,u,y),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let y=this.centroidData[_],b=+(y.min.y+y.max.y>rt),E=2*b+(+(y.min.x+y.max.x>rt)^b);for(let S=0;S<y.polygonSegLen;S++){let D=y.polygonSegIdx+S;e.push({centroidIdx:_,subtile:E,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let r=new Qi;e.sort((_,y)=>_.triangleSegmentIdx===y.triangleSegmentIdx?_.subtile-y.subtile:_.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,u=0,d=0;for(let _ of e){if(_.triangleSegmentIdx!==a)break;d++}let p=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let _=0,y=u,b=u;for(let E=y;E<d&&e[E].subtile===_;E++)b++;for(;y!==d;){let E=e[y];_=E.subtile;let S=this.centroidData[E.centroidIdx].min.clone(),D=this.centroidData[E.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=y;k<b;k++){let F=e[k],z=this.polygonSegments[F.polygonSegmentIdx],j=this.centroidData[F.centroidIdx].min,Y=this.centroidData[F.centroidIdx].max,X=this.indexArray.uint16;for(let K=z.triangleArrayOffset;K<z.triangleArrayOffset+z.triangleCount;K++)r.emplaceBack(X[3*K],X[3*K+1],X[3*K+2]);R.primitiveLength+=z.triangleCount,S.x=Math.min(S.x,j.x),S.y=Math.min(S.y,j.y),D.x=Math.max(D.x,Y.x),D.y=Math.max(D.y,Y.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:S,max:D}),y=b;for(let k=y;k<d&&e[k].subtile===e[y].subtile;k++)b++}u=d;for(let E=u;E<p&&e[E].triangleSegmentIdx===e[u].triangleSegmentIdx;E++)d++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,a){let u=0,d=0,p=1<<e.canonical.z;if(r){let F=r.getMinMaxForTile(e);F&&(u=F.min,d=F.max)}d+=this.maxHeight;let _=e.toUnwrapped(),y,b=[_.canonical.x/p+_.wrap,_.canonical.y/p],E=[(_.canonical.x+1)/p+_.wrap,(_.canonical.y+1)/p],S=new mi,D=(F,z,j)=>[F[0]*(1-j[0])+z[0]*j[0],F[1]*(1-j[1])+z[1]*j[1]],R=[],k=[];for(let F of this.triangleSubSegments){R[0]=F.min.x/rt,R[1]=F.min.y/rt,k[0]=F.max.x/rt,k[1]=F.max.y/rt;let z=D(b,E,R),j=D(b,E,k);if(new gi([z[0],z[1],u],[j[0],j[1],d]).intersectsPrecise(a)===0){y&&(S.segments.push(y),y=void 0);continue}let Y=F.segment;y&&y.vertexOffset!==Y.vertexOffset&&(S.segments.push(y),y=void 0),y?(y.vertexLength+=Y.vertexLength,y.primitiveLength+=Y.primitiveLength):y={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&S.segments.push(y),S}encodeCentroid(e,r){let a=e.centroid(),u=r.span(),d=Math.min(7,Math.round(u.x*this.tileToMeter/10)),p=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new lt(Jt(a.x,1,rt-1)<<3|d,Jt(a.y,1,rt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new lt(0,0);let r=e.borders,a=Number.MAX_VALUE;if(r[0][0]!==a||r[1][0]!==a){let u=r[0][0]!==a?0:1;return new lt(6|(r[0][0]!==a?0:65528),(r[u][0]+r[u][1])/2<<3|6)}{let u=r[2][0]!==a?2:3;return new lt((r[u][0]+r[u][1])/2<<3|6,6|(r[2][0]!==a?0:65528))}}showCentroid(e){let r=this.centroidData[e.centroidDataIndex];r.flags&=Ic,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let r=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&Ic?JM:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||d!==u.x){for(let p=r;p<a;++p)this.centroidVertexArray.emplace(p,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,a){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let u=r.getReplacementRegionsForTile(e.toUnwrapped());if(jw(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let d=[];for(let p of this.activeReplacements){if(p.order<a)continue;let _=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&Ic||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let b=0;b<y.footprintSegLen;b++){let E=this.footprintSegments[y.footprintSegIdx+b];if(d.length=0,D5(this.footprintVertices,E.vertexOffset,E.vertexCount,p.footprintTileId.canonical,e.canonical,d),jM(p.footprint,d,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-_)){y.flags|=Ic;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,a){let u=!1;for(let d=0;d<a.footprintSegLen;d++){let p=this.footprintSegments[a.footprintSegIdx+d],_=0;for(let y of p.ringIndices){for(let b=_,E=y+_-1;b<y+_;E=b++){let S=this.footprintVertices.int16[2*(b+p.vertexOffset)+0],D=this.footprintVertices.int16[2*(b+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(E+p.vertexOffset)+1];D>r!=R>r&&e<(this.footprintVertices.int16[2*(E+p.vertexOffset)+0]-S)*(r-D)/(R-D)+S&&(u=!u)}_=y}}return u}getHeightAtTileCoord(e,r){let a=Number.NEGATIVE_INFINITY,u=!0,d=4*(e+rt)*rt+(r+rt);if(this.partLookup.hasOwnProperty(d)){let p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&Ic)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||r>p.max.y||p.min.y>r||this.footprintContainsPoint(e,r,p)&&p&&p.height>a&&(a=p.height,this.partLookup[d]=p,u=!!(p.flags&Ic));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[d]=void 0}}function oA(t,e){let r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function S5(t,e,r,a){let u=e.sub(t)._perp()._unit(),d=r.sub(e)._perp()._unit();return sA(t,e,r,oA(u,d),a)}function sA(t,e,r,a,u){let d=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(r)/3,u*d/a)}function Uw(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function aA(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function lA(t,e,r){if(t.x<0||t.x>=rt||e.x<0||e.x>=rt||r.x<0||r.x>=rt)return!1;let a=r.sub(e),u=a.perp(),d=t.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&u.x*d.x+u.y*d.y<0}function cA(t,e,r){let a=e?2|t:-3&t;return r?1|a:-2&a}function uA(){let t=Math.PI/32,e=Math.tan(t),r=cf;return r*Math.sqrt(1+2*e*e)-r}function hA(t,e,r){let a=1<<r.z,u=no(r.x/a),d=no((r.x+1)/a),p=sr(r.y/a),_=sr((r.y+1)/a);return function(y,b,E,S,D=0,R){let k=[];if(!y.length||!E||!S)return k;let F=(se,me)=>{for(let _e of se)k.push({polygon:_e,bounds:me})},z=Math.ceil(Math.log2(E)),j=Math.ceil(Math.log2(S)),Y=z-j,X=[];for(let se=0;se<Math.abs(Y);se++)X.push(Y>0?0:1);for(let se=0;se<Math.min(z,j);se++)X.push(0),X.push(1);let K=y;if(K=L0(K,b[0].y-D,b[1].y+D,1),K=L0(K,b[0].x-D,b[1].x+D,0),!K.length)return k;let le=[];for(X.length?le.push({polygons:K,bounds:b,depth:0}):F(K,b);le.length;){let se=le.pop(),me=se.depth,_e=X[me],Te=se.bounds[0],ke=se.bounds[1],De=_e===0?Te.x:Te.y,ze=_e===0?ke.x:ke.y,Ye=R?R(_e,De,ze):.5*(De+ze),Le=L0(se.polygons,De-D,Ye+D,_e),qe=L0(se.polygons,Ye-D,ze+D,_e);if(Le.length){let Oe=[Te,new lt(_e===0?Ye:ke.x,_e===1?Ye:ke.y)];X.length>me+1?le.push({polygons:Le,bounds:Oe,depth:me+1}):F(Le,Oe)}if(qe.length){let Oe=[new lt(_e===0?Ye:Te.x,_e===1?Ye:Te.y),ke];X.length>me+1?le.push({polygons:qe,bounds:Oe,depth:me+1}):F(qe,Oe)}}return k}(t,e,Math.ceil((d-u)/11.25),Math.ceil((p-_)/11.25),1,(y,b,E)=>{if(y===0)return .5*(b+E);{let S=sr((r.y+b/rt)/a);return(fa(.5*(sr((r.y+E/rt)/a)+S))*a-r.y)*rt}})}function D5(t,e,r,a,u,d){let p=Math.pow(2,a.z-u.z);for(let _=0;_<r;_++){let y=t.int16[2*(_+e)+0],b=t.int16[2*(_+e)+1];y=(y+u.x*rt)*p-a.x*rt,b=(b+u.y*rt)*p-a.y*rt,d.push(new lt(y,b))}}J(B0,"FillExtrusionBucket",{omit:["layers","features"]}),J(tA,"PartData"),J(eA,"FootprintSegment"),J(nA,"BorderCentroidData"),J(rA,"GroundEffect");let M5=new On({visibility:new Be(Ee["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Be(Ee["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var A5={paint:new On({"fill-extrusion-opacity":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ut(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ut(Ee["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ut(Ee["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Be(Ee["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:M5};function cg(t,e){return t.x*e.x+t.y*e.y}function dA(t,e){if(t.length===1){let r=0,a=e[r++],u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){let d=e[r],p=t[0],_=u.sub(a),y=d.sub(a),b=p.sub(a),E=cg(_,_),S=cg(_,y),D=cg(y,y),R=cg(b,_),k=cg(b,y),F=E*D-S*S,z=(D*R-S*k)/F,j=(E*k-S*R)/F,Y=a.z*(1-z-j)+u.z*z+d.z*j;if(isFinite(Y))return Y}return 1/0}{let r=1/0;for(let a of e)r=Math.min(r,a.z);return r}}function fA(t,e,r,a,u,d,p,_){let y=p*u.getElevationAt(t,e,!0,!0),b=d[0]!==0,E=b?d[1]===0?p*(d[0]/7-450):p*function(S,D,R){let k=Math.floor(D[0]/8),F=Math.floor(D[1]/8),z=10*(D[0]-8*k),j=10*(D[1]-8*F),Y=S.getElevationAt(k,F,!0,!0),X=S.getMeterToDEM(R),K=Math.floor(.5*(z*X-1)),le=Math.floor(.5*(j*X-1)),se=S.tileCoordToPixel(k,F),me=2*K+1,_e=2*le+1,Te=function(qe,Oe,We,Je,Ze){return[qe.getElevationAtPixel(Oe,We,!0),qe.getElevationAtPixel(Oe+Ze,We,!0),qe.getElevationAtPixel(Oe,We+Ze,!0),qe.getElevationAtPixel(Oe+Je,We+Ze,!0)]}(S,se.x-K,se.y-le,me,_e),ke=Math.abs(Te[0]-Te[1]),De=Math.abs(Te[2]-Te[3]),ze=Math.abs(Te[0]-Te[2])+Math.abs(Te[1]-Te[3]),Ye=Math.min(.25,.5*X*(ke+De)/me),Le=Math.min(.25,.5*X*ze/_e);return Y+Math.max(Ye*z,Le*j)}(u,d,_):y;return{base:y+(r===0)?-1:r,top:b?Math.max(E+a,y+r+2):y+a}}let P5=An([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:R5}=P5,k5=An([{name:"a_packed",components:4,type:"Float32"}]),{members:O5}=k5,L5=An([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:F5}=L5,N5=An([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),z5=An([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),B5=An([{name:"a_projected_pos",components:4,type:"Float32"}],4);An([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let $w=An([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),pA=An([{name:"a_z_offset",components:1,type:"Float32"}],4),V5=An([{name:"a_texb",components:2,type:"Uint16"}]),j5=An([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),U5=An([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);An([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let mA=An([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$5=An([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);An([{name:"triangle",components:3,type:"Uint16"}]),An([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),An([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),An([{type:"Float32",name:"offsetX"}]),An([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class gA{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Tc({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){let a=this.getKey(e,r);return this.positions[a]}trim(){let e=this.width,r=this.height=Kp(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){let u=[],d=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,_=!0;u.push({left:d,right:p,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){_=!_;let E=e[b];d=y*a,y+=E,p=y*a,u.push({left:d,right:p,isDash:_,zeroLength:E===0})}return u}addRoundDash(e,r,a){let u=r/2;for(let d=-a;d<=a;d++){let p=this.width*(this.nextRow+a+d),_=0,y=e[_];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++_]);let E=Math.abs(b-y.left),S=Math.abs(b-y.right),D=Math.min(E,S),R,k=d/a*(u+1);if(y.isDash){let F=u-Math.abs(k);R=Math.sqrt(D*D+F*F)}else R=u-Math.sqrt(D*D+k*k);this.image.data[p+b]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,r){for(let y=e.length-1;y>=0;--y){let b=e[y],E=e[y+1];b.zeroLength?e.splice(y,1):E&&E.isDash===b.isDash&&(E.left=b.left,e.splice(y,1))}let a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);let d=this.width*this.nextRow,p=0,_=e[p];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++p]);let b=Math.abs(y-_.left),E=Math.abs(y-_.right),S=Math.min(b,E);this.image.data[d+y]=Math.max(0,Math.min(255,(_.isDash?S:-S)+r+128))}}addDash(e,r){let a=this.getKey(e,r);if(this.positions[a])return this.positions[a];let u=r==="round",d=u?7:0,p=2*d+1;if(this.nextRow+p>this.height)return Pi("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let E=0;E<e.length;E++)e[E]<0&&(Pi("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),_+=e[E];if(_!==0){let E=this.width/_,S=this.getDashRanges(e,this.width,E);u?this.addRoundDash(S,E,d):this.addRegularDash(S,r==="square"?.5*E:0)}let y=this.nextRow+d;this.nextRow+=p;let b={tl:[y,d],br:[_,0]};return this.positions[a]=b,b}}J(gA,"LineAtlas");let G5=O0.types,H5=Math.cos(Math.PI/180*37.5),q5=Math.cos(Math.PI/180*5);class V0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new W1,this.layoutVertexArray2=new mc,this.patternVertexArray=new gc,this.indexArray=new Qi,this.programConfigurations=new xc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new mi,this.maxLineLength=0,this.zOffsetVertexArray=new lh,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:rt/64}updateFootprints(e,r){}populate(e,r,a,u){this.hasPattern=Fw("line",this.layers,r);let d=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let _=[];for(let{feature:S,id:D,index:R,sourceLayerIndex:k}of e){let F=this.layers[0]._featureFilter.needGeometry,z=ll(S,F);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),z,a))continue;let j=d?d.evaluate(z,{},a):void 0,Y={id:D,properties:S.properties,type:S.type,sourceLayerIndex:k,index:R,geometry:F?z.geometry:Cs(S,a,u),patterns:{},sortKey:j};_.push(Y)}d&&_.sort((S,D)=>S.sortKey-D.sortKey);let{lineAtlas:y,featureIndex:b}=r,E=this.addConstantDashes(y);for(let S of _){let{geometry:D,index:R,sourceLayerIndex:k}=S;if(E&&this.addFeatureDashes(S,y),this.hasPattern){let F=Nw("line",this.layers,S,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(S,D,R,a,y.positions,r.availableImages,r.brightness);b.insert(e[R].feature,D,R,k,this.index)}}addConstantDashes(e){let r=!1;for(let a of this.layers){let u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")r=!0;else{let p=d.value,_=u.value;if(!_)continue;e.addDash(_,p)}}return r}addFeatureDashes(e,r){let a=this.zoom;for(let u of this.layers){let d=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let _,y;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:a},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),r.addDash(_,y),e.patterns[u.id]=r.getKey(_,y)}}update(e,r,a,u,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,p?this.stateDependentLayers:this.layers,a,u,d)}addFeatures(e,r,a,u,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,a,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,O5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,F5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,pA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R5),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,d,p,_){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),E=y.get("line-cap").evaluate(e,{}),S=y.get("line-miter-limit"),D=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let R of r)this.addLine(R,e,u,b,E,S,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,u,_)}addLine(e,r,a,u,d,p,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},b=this.layers[0].layout,E=u==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<e.length-1;se++)this.totalDistance+=e[se].dist(e[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let S=G5[r.type]==="Polygon",D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let R=0;for(;R<D-1&&e[R].equals(e[R+1]);)R++;if(D<(S?3:2))return;u==="bevel"&&(p=1.05);let k=this.overscaling<=16?15*rt/(512*this.overscaling):0,F=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),z,j,Y,X,K,le;this.e1=this.e2=-1,S&&(z=e[D-2],K=e[R].sub(z)._unit()._perp());for(let se=R;se<D;se++){if(Y=se===D-1?S?e[R+1]:void 0:e[se+1],Y&&e[se].equals(Y))continue;if(K&&(X=K),z&&(j=z),z=e[se],this.hasZOffset){let Oe=b.get("line-z-offset").value;if(Oe.kind==="constant")le=Oe.value;else{if(this.lineClips){let We=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(We*this.lineClips.start+this.distance+(j?j.dist(z):0))/We}else Pi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;le=Oe.evaluate(y,r)}le=le||0}K=Y?Y.sub(z)._unit()._perp():X,X=X||K;let me=j&&Y,_e=me?u:S||E?"butt":d,Te=X.x*K.x+X.y*K.y;if(E){let Oe=function(We){if(We.patternJoinNone){let Je=We.segmentPoints.length/2,Ze=We.lineSoFar-We.segmentStart;for(let ht=0;ht<Je;++ht){let Xe=We.segmentPoints[2*ht+1],nt=Math.round(We.segmentPoints[2*ht])+.5+.25*Xe;We.patternVertexArray.emplaceBack(nt,Ze,We.segmentStart),We.patternVertexArray.emplaceBack(nt,Ze,We.segmentStart)}We.segmentPoints.length=0}We.e1=We.e2=-1};if(me&&Te<q5){this.updateDistance(j,z),this.addCurrentVertex(z,X,1,1,F,le),Oe(this),this.addCurrentVertex(z,K,-1,-1,F,le);continue}if(j){if(!Y){this.updateDistance(j,z),this.addCurrentVertex(z,X,1,1,F,le),Oe(this);continue}_e="miter"}}let ke=X.add(K);ke.x===0&&ke.y===0||ke._unit();let De=ke.x*K.x+ke.y*K.y,ze=De!==0?1/De:1/0,Ye=2*Math.sqrt(2-2*De),Le=De<H5&&j&&Y,qe=X.x*K.y-X.y*K.x>0;if(Le&&se>R){let Oe=z.dist(j);if(Oe>2*k){let We=z.sub(z.sub(j)._mult(k/Oe)._round());this.updateDistance(j,We),this.addCurrentVertex(We,X,0,0,F,le),j=We}}if(me&&_e==="round"&&(ze<_?_e="miter":ze<=2&&(_e="fakeround")),_e==="miter"&&ze>p&&(_e="bevel"),_e==="bevel"&&(ze>2&&(_e="flipbevel"),ze<p&&(_e="miter")),j&&this.updateDistance(j,z),_e==="miter")ke._mult(ze),this.addCurrentVertex(z,ke,0,0,F,le);else if(_e==="flipbevel"){if(ze>100)ke=K.mult(-1);else{let Oe=ze*X.add(K).mag()/X.sub(K).mag();ke._perp()._mult(Oe*(qe?-1:1))}this.addCurrentVertex(z,ke,0,0,F,le),this.addCurrentVertex(z,ke.mult(-1),0,0,F,le)}else if(_e==="bevel"||_e==="fakeround"){let Oe=-Math.sqrt(ze*ze-1),We=qe?Oe:0,Je=qe?0:Oe;if(j&&this.addCurrentVertex(z,X,We,Je,F,le),_e==="fakeround"){let Ze=Math.round(180*Ye/Math.PI/20);for(let ht=1;ht<Ze;ht++){let Xe=ht/Ze;if(Xe!==.5){let Et=Xe-.5;Xe+=Xe*Et*(Xe-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*Et*Et+(.848013+Te*(.215638*Te-1.06021)))}let nt=K.sub(X)._mult(Xe)._add(X)._unit()._mult(qe?-1:1);this.addHalfVertex(z,nt.x,nt.y,!1,qe,0,F,le)}}Y&&this.addCurrentVertex(z,K,-We,-Je,F,le)}else _e==="butt"?this.addCurrentVertex(z,ke,0,0,F,le):_e==="square"?(j||this.addCurrentVertex(z,ke,-1,-1,F,le),this.addCurrentVertex(z,ke,0,0,F,le),j&&this.addCurrentVertex(z,ke,1,1,F,le)):_e==="round"&&(j&&(this.addCurrentVertex(z,X,0,0,F,le),this.addCurrentVertex(z,X,1,1,F,le,!0)),Y&&(this.addCurrentVertex(z,K,-1,-1,F,le,!0),this.addCurrentVertex(z,K,0,0,F,le)));if(Le&&se<D-1){let Oe=z.dist(Y);if(Oe>2*k){let We=z.add(Y.sub(z)._mult(k/Oe)._round());this.updateDistance(z,We),this.addCurrentVertex(We,K,0,0,F,le),z=We}}}}addVerticesTo(e,r,a,u,d,p,_,y,b,E){let S=(r.w-e.w)/this.tessellationStep|0;if(S>1){this.lineSoFar=e.w;let D=(r.x-e.x)/S,R=(r.y-e.y)/S,k=(r.z-e.z)/S,F=(r.w-e.w)/S;for(let z=1;z<S;++z)e.x+=D,e.y+=R,e.z+=k,this.lineSoFar+=F,this.addHalfVertex(e,a,u,E,!1,_,b,e.z),this.addHalfVertex(e,d,p,E,!0,-y,b,e.z)}this.lineSoFar=r.w,this.addHalfVertex(r,a,u,E,!1,_,b,r.z),this.addHalfVertex(r,d,p,E,!0,-y,b,r.z)}addCurrentVertex(e,r,a,u,d,p,_=!1){let y=r.x+r.y*a,b=r.y-r.x*a,E=r.y*u-r.x,S=-r.y-r.x*u;if(p!=null){let R=rt+10,k=p,F=new FM(e.x,e.y,k,this.lineSoFar),z=_A(e,-10,R),j=this.lineSoFar;if(this.currentVertex)if(z){let Y=this.currentVertexIsOutside,X=this.currentVertex,K=new FM(e.x,e.y,k,this.lineSoFar);zM(X,K,-10,R),_A(K,-10,R)||(Y&&(this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,y,b,_,!1,a,d,X.z),this.addHalfVertex(X,E,S,_,!0,-u,d,X.z)),this.addVerticesTo(X,K,y,b,E,S,a,u,d,_))}else{let Y=this.currentVertex;this.currentVertexIsOutside&&(zM(Y,F,-10,R),this.e1=this.e2=-1,this.lineSoFar=Y.w,this.addHalfVertex(Y,y,b,_,!1,a,d,Y.z),this.addHalfVertex(Y,E,S,_,!0,-u,d,Y.z)),this.addVerticesTo(Y,F,y,b,E,S,a,u,d,_)}else z||(this.addHalfVertex(e,y,b,_,!1,a,d,p),this.addHalfVertex(e,E,S,_,!0,-u,d,p));this.currentVertex=F,this.currentVertexIsOutside=z,this.lineSoFar=j}else this.addHalfVertex(e,y,b,_,!1,a,d,p),this.addHalfVertex(e,E,S,_,!0,-u,d,p)}addHalfVertex({x:e,y:r},a,u,d,p,_,y,b){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let E=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),y.primitiveLength++),p?this.e2=E:this.e1=E,b!=null&&this.zOffsetVertexArray.emplaceBack(b)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}function _A(t,e,r){return t.x<e||t.x>r||t.y<e||t.y>r}J(V0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let W5=new On({"line-cap":new ut(Ee.layout_line["line-cap"]),"line-join":new ut(Ee.layout_line["line-join"]),"line-miter-limit":new Be(Ee.layout_line["line-miter-limit"]),"line-round-limit":new Be(Ee.layout_line["line-round-limit"]),"line-sort-key":new ut(Ee.layout_line["line-sort-key"]),"line-z-offset":new ut(Ee.layout_line["line-z-offset"]),visibility:new Be(Ee.layout_line.visibility)});var j0={paint:new On({"line-opacity":new ut(Ee.paint_line["line-opacity"]),"line-color":new ut(Ee.paint_line["line-color"]),"line-translate":new Be(Ee.paint_line["line-translate"]),"line-translate-anchor":new Be(Ee.paint_line["line-translate-anchor"]),"line-width":new ut(Ee.paint_line["line-width"]),"line-gap-width":new ut(Ee.paint_line["line-gap-width"]),"line-offset":new ut(Ee.paint_line["line-offset"]),"line-blur":new ut(Ee.paint_line["line-blur"]),"line-dasharray":new ut(Ee.paint_line["line-dasharray"]),"line-pattern":new ut(Ee.paint_line["line-pattern"]),"line-gradient":new Gi(Ee.paint_line["line-gradient"]),"line-trim-offset":new Be(Ee.paint_line["line-trim-offset"]),"line-trim-fade-range":new Be(Ee.paint_line["line-trim-fade-range"]),"line-trim-color":new Be(Ee.paint_line["line-trim-color"]),"line-emissive-strength":new Be(Ee.paint_line["line-emissive-strength"]),"line-border-width":new ut(Ee.paint_line["line-border-width"]),"line-border-color":new ut(Ee.paint_line["line-border-color"]),"line-occlusion-opacity":new Be(Ee.paint_line["line-occlusion-opacity"])}),layout:W5};function yA(t,e,r){return e*(rt/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}function vA(t,e){return 1/yA(t,1,e.tileZoom)}function xA(t,e,r,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let bA=t=>{let e=[];wA(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let r=t.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",u=!!t.paint.get("line-pattern").constantOr(1);return a&&u&&e.push("LINE_JOIN_NONE"),e};function wA(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class TA{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var Z5={read:function(t,e,r,a,u){var d,p,_=8*u-a-1,y=(1<<_)-1,b=y>>1,E=-7,S=r?u-1:0,D=r?-1:1,R=t[e+S];for(S+=D,d=R&(1<<-E)-1,R>>=-E,E+=_;E>0;d=256*d+t[e+S],S+=D,E-=8);for(p=d&(1<<-E)-1,d>>=-E,E+=a;E>0;p=256*p+t[e+S],S+=D,E-=8);if(d===0)d=1-b;else{if(d===y)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,a),d-=b}return(R?-1:1)*p*Math.pow(2,d-a)},write:function(t,e,r,a,u,d){var p,_,y,b=8*d-u-1,E=(1<<b)-1,S=E>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:d-1,k=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+S>=1?D/y:D*Math.pow(2,1-S))*y>=2&&(p++,y/=2),p+S>=E?(_=0,p=E):p+S>=1?(_=(e*y-1)*Math.pow(2,u),p+=S):(_=e*Math.pow(2,S-1)*Math.pow(2,u),p=0));u>=8;t[r+R]=255&_,R+=k,_/=256,u-=8);for(p=p<<u|_,b+=u;b>0;t[r+R]=255&p,R+=k,p/=256,b-=8);t[r+R-k]|=128*F}},EA=ui,U0=Z5;function ui(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ui.Varint=0,ui.Fixed64=1,ui.Bytes=2,ui.Fixed32=5;var Gw=4294967296,IA=1/Gw,CA=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function hl(t){return t.type===ui.Bytes?t.readVarint()+t.pos:t.pos+1}function mf(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function SA(t,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=t;u--)r.buf[u+a]=r.buf[u]}function Y5(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function X5(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function K5(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Q5(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function J5(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function e4(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function t4(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function n4(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function i4(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function $0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function gf(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function DA(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ui.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,d=this.pos;this.type=7&a,t(u,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=$0(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=DA(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=$0(this.buf,this.pos)+$0(this.buf,this.pos+4)*Gw;return this.pos+=8,t},readSFixed64:function(){var t=$0(this.buf,this.pos)+DA(this.buf,this.pos+4)*Gw;return this.pos+=8,t},readFloat:function(){var t=U0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=U0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(u,d,p){var _,y,b=p.buf;if(_=(112&(y=b[p.pos++]))>>4,y<128||(_|=(127&(y=b[p.pos++]))<<3,y<128)||(_|=(127&(y=b[p.pos++]))<<10,y<128)||(_|=(127&(y=b[p.pos++]))<<17,y<128)||(_|=(127&(y=b[p.pos++]))<<24,y<128)||(_|=(1&(y=b[p.pos++]))<<31,y<128))return mf(u,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&CA?function(r,a,u){return CA.decode(r.subarray(a,u))}(this.buf,e,t):function(r,a,u){for(var d="",p=a;p<u;){var _,y,b,E=r[p],S=null,D=E>239?4:E>223?3:E>191?2:1;if(p+D>u)break;D===1?E<128&&(S=E):D===2?(192&(_=r[p+1]))==128&&(S=(31&E)<<6|63&_)<=127&&(S=null):D===3?(y=r[p+2],(192&(_=r[p+1]))==128&&(192&y)==128&&((S=(15&E)<<12|(63&_)<<6|63&y)<=2047||S>=55296&&S<=57343)&&(S=null)):D===4&&(y=r[p+2],b=r[p+3],(192&(_=r[p+1]))==128&&(192&y)==128&&(192&b)==128&&((S=(15&E)<<18|(63&_)<<12|(63&y)<<6|63&b)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,D=1):S>65535&&(S-=65536,d+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),d+=String.fromCharCode(S),p+=D}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ui.Bytes)return t.push(this.readVarint(e));var r=hl(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ui.Bytes)return t.push(this.readSVarint());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ui.Bytes)return t.push(this.readBoolean());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ui.Bytes)return t.push(this.readFloat());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ui.Bytes)return t.push(this.readDouble());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ui.Bytes)return t.push(this.readFixed32());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ui.Bytes)return t.push(this.readSFixed32());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ui.Bytes)return t.push(this.readFixed64());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ui.Bytes)return t.push(this.readSFixed64());var e=hl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ui.Varint)for(;this.buf[this.pos++]>127;);else if(e===ui.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ui.Fixed32)this.pos+=4;else{if(e!==ui.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),gf(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),gf(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),gf(this.buf,-1&t,this.pos),gf(this.buf,Math.floor(t*IA),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),gf(this.buf,-1&t,this.pos),gf(this.buf,Math.floor(t*IA),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,p,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(a,0,r),function(d,p){var _=(7&d)<<4;p.buf[p.pos++]|=_|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(u,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,u,d){for(var p,_,y=0;y<u.length;y++){if((p=u.charCodeAt(y))>55295&&p<57344){if(!_){p>56319||y+1===u.length?(a[d++]=239,a[d++]=191,a[d++]=189):_=p;continue}if(p<56320){a[d++]=239,a[d++]=191,a[d++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(a[d++]=239,a[d++]=191,a[d++]=189,_=null);p<128?a[d++]=p:(p<2048?a[d++]=p>>6|192:(p<65536?a[d++]=p>>12|224:(a[d++]=p>>18|240,a[d++]=p>>12&63|128),a[d++]=p>>6&63|128),a[d++]=63&p|128)}return d}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&SA(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),U0.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),U0.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var a=this.pos-r;a>=128&&SA(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,r){this.writeTag(t,ui.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Y5,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,X5,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,J5,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,K5,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Q5,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,e4,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,t4,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,n4,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,i4,e)},writeBytesField:function(t,e){this.writeTag(t,ui.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ui.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ui.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ui.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ui.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ui.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ui.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ui.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ui.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ui.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var _f=Fe(EA);let r4=["id","tile","layer","source","sourceLayer","state"];class MA{constructor(e,r,a,u,d){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let r of r4)this[r]!==void 0&&(e[r]=this[r]);return e}}class o4{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){let u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},_r(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(let d in this.state[e][u])a[d]||(this.deletedStates[e][u][d]=null)}else for(let d in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;let u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){let a=String(r),u=_r({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let d=this.deletedStates[e][r];if(d===null)return{};for(let p in d)delete u[p]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){let a={};for(let u in this.stateChanges){this.state[u]=this.state[u]||{};let d={};for(let p in this.stateChanges[u])this.state[u][p]||(this.state[u][p]={}),_r(this.state[u][p],this.stateChanges[u][p]),d[p]=this.state[u][p];a[u]=d}for(let u in this.deletedStates){this.state[u]=this.state[u]||{};let d={};if(this.deletedStates[u]===null)for(let p in this.state[u])d[p]={},this.state[u][p]={};else for(let p in this.deletedStates[u]){if(this.deletedStates[u][p]===null)this.state[u][p]={};else if(this.state[u][p])for(let _ of Object.keys(this.deletedStates[u][p]))delete this.state[u][p][_];d[p]=this.state[u][p]}a[u]=a[u]||{},_r(a[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let u in e)e[u].setFeatureState(a,r)}}class AA{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ue(rt,16,0),this.featureIndexArray=new UD,this.promoteId=r,this.is3DTile=!1}insert(e,r,a,u,d,p=0,_=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,d,p);let b=this.grid;for(let E=0;E<r.length;E++){let S=r[E],D=[1/0,1/0,-1/0,-1/0];for(let R=0;R<S.length;R++){let k=S[R];D[0]=Math.min(D[0],k.x),D[1]=Math.min(D[1],k.y),D[2]=Math.max(D[2],k.x),D[3]=Math.max(D[3],k.y)}_!==0&&(D[0]-=_,D[1]-=_,D[2]+=_,D[3]+=_),D[0]<rt&&D[1]<rt&&D[2]>=0&&D[3]>=0&&b.insert(y,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Bw(new _f(this.rawTileData)).layers,this.sourceLayerCoder=new TA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,u){this.loadVTLayers();let d=e.params||{},p=Sr(d.filter),_=e.tileResult,y=e.transform,b=_.bufferedTilespaceBounds,E=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(k,F,z,j)=>oM(_.bufferedTilespaceGeometry,k,F,z,j));E.sort(s4);let S=null;y.elevation&&E.length>0&&(S=pf.create(y.elevation,this.tileID));let D={},R;for(let k=0;k<E.length;k++){let F=E[k];if(F===R)continue;R=F;let z=this.featureIndexArray.get(F),j=null;if(this.is3DTile){let Y=this.bucketLayerIDs[0][0],X=r[Y];if(X.type!=="model")continue;let{queryFeature:K,intersectionZ:le}=X.queryIntersectsMatchingFeature(_,z.featureIndex,p,y);K&&this.appendToResult(D,Y,z.featureIndex,K,le)}else this.loadMatchingFeature(D,z,p,d.layers,d.availableImages,r,a,u,(Y,X,K,le=0)=>(j||(j=Cs(Y,this.tileID.canonical,e.tileTransform)),X.queryIntersectsFeature(_,Y,K,j,this.z,e.transform,e.pixelPosMatrix,S,le)))}return D}loadMatchingFeature(e,r,a,u,d,p,_,y,b){let{featureIndex:E,bucketIndex:S,sourceLayerIndex:D,layoutVertexArrayOffset:R}=r,k=this.bucketLayerIDs[S];if(u&&!function(Y,X){for(let K=0;K<Y.length;K++)if(X.indexOf(Y[K])>=0)return!0;return!1}(u,k))return;let F=this.sourceLayerCoder.decode(D),z=this.vtLayers[F].feature(E);if(a.needGeometry){let Y=ll(z,!0);if(!a.filter(new jt(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!a.filter(new jt(this.tileID.overscaledZ),z))return;let j=this.getId(z,F);for(let Y=0;Y<k.length;Y++){let X=k[Y];if(u&&u.indexOf(X)<0)continue;let K=p[X];if(!K)continue;let le={};j!==void 0&&y&&(le=y.getState(K.sourceLayer||"_geojsonTileLayer",j));let se=!b||b(z,K,le,R);if(!se)continue;let me=new MA(z,this.z,this.x,this.y,j),_e=_r({},_[X]);_e.paint=PA(_e.paint,K.paint,z,le,d),_e.layout=PA(_e.layout,K.layout,z,le,d),me.layer=_e,this.appendToResult(e,X,E,me,se)}}appendToResult(e,r,a,u,d){let p=e[r];p===void 0&&(p=e[r]=[]),p.push({featureIndex:a,feature:u,intersectionZ:d})}lookupSymbolFeatures(e,r,a,u,d,p,_,y){let b={};this.loadVTLayers();let E=Sr(d);for(let S of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:u,featureIndex:S,layoutVertexArrayOffset:0},E,p,_,y,r);return b}loadFeature(e){let{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();let u=this.sourceLayerCoder.decode(a),d=this.vtFeatures[u];if(d[r])return d[r];let p=this.vtLayers[u].feature(r);return d[r]=p,p}hasLayer(e){for(let r of this.bucketLayerIDs)for(let a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){let u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function PA(t,e,r,a,u){return ql(t,(d,p)=>{let _=e instanceof pn?e.get(p):null;return _&&_.evaluate?_.evaluate(r,a,u):_})}function s4(t,e){return e-t}J(AA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var br=24;let Ss=128;function Hw(t,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new jt(t+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:u}=r,d=0;for(;d<a.length&&a[d]<=t;)d++;d=Math.max(0,d-1);let p=d;for(;p<a.length&&a[p]<t+1;)p++;p=Math.min(a.length-1,p);let _=a[d],y=a[p];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:y,minSize:r.evaluate(new jt(_)),maxSize:r.evaluate(new jt(y)),interpolationType:u}}}function G0(t,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return t.kind==="source"?a/Ss:t.kind==="composite"?St(a/Ss,u/Ss,r):e}function yf(t,e){let r=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:u,minZoom:d,maxZoom:p}=t,_=u?Jt(eo.interpolationFactor(u,e,d,p),0,1):0;t.kind==="camera"?a=St(t.minSize,t.maxSize,_):r=_}return{uSizeT:r,uSize:a}}var a4=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ss,evaluateSizeForFeature:G0,evaluateSizeForZoom:yf,getSizeData:Hw});function l4(t,e,r){return t.sections.forEach(a=>{a.text=function(u,d,p){let _=d.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),kn.applyArabicShaping&&(u=kn.applyArabicShaping(u)),u}(a.text,e,r)}),t}let ug={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function c4(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function u4(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let qw=3;function h4(t,e,r){e.glyphs=[],t===1&&r.readMessage(d4,e)}function d4(t,e,r){if(t===3){let{id:a,bitmap:u,width:d,height:p,left:_,top:y,advance:b}=r.readMessage(f4,{});e.glyphs.push({id:a,bitmap:new Tc({width:d+2*qw,height:p+2*qw},u),metrics:{width:d,height:p,left:_,top:y,advance:b}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function f4(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}let RA=qw,Fo={horizontal:1,vertical:2,horizontalOnly:3};class hg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){let a=new hg;return a.scale=e||1,a.fontStack=r,a}static forImage(e){let r=new hg;return r.imageName=e,r}}class vf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let a=new vf;for(let u=0;u<e.sections.length;u++){let d=e.sections[u];d.image?a.addImageSection(d):a.addTextSection(d,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,a){let u="";for(let d=0;d<r.length;d++){let p=r.charCodeAt(d+1)||null,_=r.charCodeAt(d-1)||null;u+=!a&&(p&&Ve(p)&&!ug[r[d+1]]||_&&Ve(_)&&!ug[r[d-1]])||!ug[r[d]]?r[d]:ug[r[d]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&H0[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&H0[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let a=new vf;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(hg.forText(e.scale,e.fontStack||r));let a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){let r=e.image?e.image.namePrimary:"";if(r.length===0)return void Pi("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(hg.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ww(t,e,r,a,u,d,p,_,y,b,E,S,D,R,k){let F=vf.fromFeature(t,u);S===Fo.vertical&&F.verticalizePunctuation(D);let z=[],j=function(se,me,_e,Te,ke,De){if(!se)return[];let ze=[],Ye=function(We,Je,Ze,ht,Xe,nt){let Et=0;for(let xt=0;xt<We.length();xt++){let _t=We.getSection(xt);Et+=kA(We.getCodePoint(xt),_t,ht,Xe,Je,nt)}return Et/Math.max(1,Math.ceil(Et/Ze))}(se,me,_e,Te,ke,De),Le=se.text.indexOf("\u200B")>=0,qe=0;for(let We=0;We<se.length();We++){let Je=se.getSection(We),Ze=se.getCodePoint(We);if(H0[Ze]||(qe+=kA(Ze,Je,Te,ke,me,De)),We<se.length()-1){let ht=!((Oe=Ze)<11904||!(ae["Bopomofo Extended"](Oe)||ae.Bopomofo(Oe)||ae["CJK Compatibility Forms"](Oe)||ae["CJK Compatibility Ideographs"](Oe)||ae["CJK Compatibility"](Oe)||ae["CJK Radicals Supplement"](Oe)||ae["CJK Strokes"](Oe)||ae["CJK Symbols and Punctuation"](Oe)||ae["CJK Unified Ideographs Extension A"](Oe)||ae["CJK Unified Ideographs"](Oe)||ae["Enclosed CJK Letters and Months"](Oe)||ae["Halfwidth and Fullwidth Forms"](Oe)||ae.Hiragana(Oe)||ae["Ideographic Description Characters"](Oe)||ae["Kangxi Radicals"](Oe)||ae["Katakana Phonetic Extensions"](Oe)||ae.Katakana(Oe)||ae["Vertical Forms"](Oe)||ae["Yi Radicals"](Oe)||ae["Yi Syllables"](Oe)));(p4[Ze]||ht||Je.imageName)&&ze.push(LA(We+1,qe,Ye,ze,m4(Ze,se.getCodePoint(We+1),ht&&Le),!1))}}var Oe;return FA(LA(se.length(),qe,Ye,ze,0,!0))}(F,b,d,e,a,R),{processBidirectionalText:Y,processStyledBidirectionalText:X}=kn;if(Y&&F.sections.length===1){let se=Y(F.toString(),j);for(let me of se){let _e=new vf;_e.text=me,_e.sections=F.sections;for(let Te=0;Te<me.length;Te++)_e.sectionIndex.push(0);z.push(_e)}}else if(X){let se=X(F.text,F.sectionIndex,j);for(let me of se){let _e=new vf;_e.text=me[0],_e.sectionIndex=me[1],_e.sections=F.sections,z.push(_e)}}else z=function(se,me){let _e=[],Te=se.text,ke=0;for(let De of me)_e.push(se.substring(ke,De)),ke=De;return ke<Te.length&&_e.push(se.substring(ke,Te.length)),_e}(F,j);let K=[],le={positionedLines:K,text:F.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,me,_e,Te,ke,De,ze,Ye,Le,qe,Oe,We){let Je=0,Ze=0,ht=0,Xe=Ye==="right"?1:Ye==="left"?0:.5,nt=!1;for(let Wt of ke){let Pt=Wt.getSections();for(let Xt of Pt){if(Xt.imageName)continue;let Zt=me[Xt.fontStack];if(Zt&&(nt=Zt.ascender!==void 0&&Zt.descender!==void 0,!nt))break}if(!nt)break}let Et=0;for(let Wt of ke){Wt.trim();let Pt=Wt.getMaxScale(),Xt=(Pt-1)*br,Zt={positionedGlyphs:[],lineOffset:0};se.positionedLines[Et]=Zt;let sn=Zt.positionedGlyphs,Dt=0;if(!Wt.length()){Ze+=De,++Et;continue}let Un=0,Vn=0;for(let mn=0;mn<Wt.length();mn++){let Sn=Wt.getSection(mn),Jn=Wt.getSectionIndex(mn),Wn=Wt.getCodePoint(mn),Ei=Sn.scale,_i=null,Mr=null,Si=null,hi=br,Ui=0,ar=!(Le===Fo.horizontal||!Oe&&!Ge(Wn)||Oe&&(H0[Wn]||(xt=Wn,ae.Arabic(xt)||ae["Arabic Supplement"](xt)||ae["Arabic Extended-A"](xt)||ae["Arabic Presentation Forms-A"](xt)||ae["Arabic Presentation Forms-B"](xt))));if(Sn.imageName){let lr=Te[Sn.imageName];if(!lr)continue;Si=Sn.imageName,se.iconsInText=se.iconsInText||!0,Mr=lr.paddedRect;let Yn=lr.displaySize;Ei=Ei*br/We,_i={width:Yn[0],height:Yn[1],left:0,top:-RA,advance:ar?Yn[1]:Yn[0],localGlyph:!1},Ui=nt?-_i.height*Ei:Pt*br-17-Yn[1]*Ei,hi=_i.advance;let Kr=(ar?Yn[0]:Yn[1])*Ei-br*Pt;Kr>0&&Kr>Dt&&(Dt=Kr)}else{let lr=_e[Sn.fontStack];if(!lr)continue;lr[Wn]&&(Mr=lr[Wn]);let Yn=me[Sn.fontStack];if(!Yn)continue;let Kr=Yn.glyphs[Wn];if(!Kr)continue;if(_i=Kr.metrics,hi=Wn!==8203?br:0,nt){let fl=Yn.ascender!==void 0?Math.abs(Yn.ascender):0,as=Yn.descender!==void 0?Math.abs(Yn.descender):0,Os=(fl+as)*Ei;Un<Os&&(Un=Os,Vn=(fl-as)/2*Ei),Ui=-fl*Ei}else Ui=(Pt-Ei)*br-17}ar?(se.verticalizable=!0,sn.push({glyph:Wn,imageName:Si,x:Je,y:Ze+Ui,vertical:ar,scale:Ei,localGlyph:_i.localGlyph,fontStack:Sn.fontStack,sectionIndex:Jn,metrics:_i,rect:Mr}),Je+=hi*Ei+qe):(sn.push({glyph:Wn,imageName:Si,x:Je,y:Ze+Ui,vertical:ar,scale:Ei,localGlyph:_i.localGlyph,fontStack:Sn.fontStack,sectionIndex:Jn,metrics:_i,rect:Mr}),Je+=_i.advance*Ei+qe)}sn.length!==0&&(ht=Math.max(Je-qe,ht),nt?NA(sn,Xe,Dt,Vn,De*Pt/2):NA(sn,Xe,Dt,0,De/2)),Je=0;let Cn=De*Pt+Dt;Zt.lineOffset=Math.max(Dt,Xt),Ze+=Cn,++Et}var xt;let _t=Ze,{horizontalAlign:et,verticalAlign:It}=Zw(ze);(function(Wt,Pt,Xt,Zt,sn,Dt){let Un=(Pt-Xt)*sn,Vn=-Dt*Zt;for(let Cn of Wt)for(let mn of Cn.positionedGlyphs)mn.x+=Un,mn.y+=Vn})(se.positionedLines,Xe,et,It,ht,_t),se.top+=-It*_t,se.bottom=se.top+_t,se.left+=-et*ht,se.right=se.left+ht,se.hasBaseline=nt}(le,e,r,a,z,p,_,y,S,b,D,k),!function(se){for(let me of se)if(me.positionedGlyphs.length!==0)return!1;return!0}(K)&&le}let H0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},p4={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kA(t,e,r,a,u,d){if(e.imageName){let p=a[e.imageName];return p?p.displaySize[0]*e.scale*br/d+u:0}{let p=r[e.fontStack],_=p&&p.glyphs[t];return _?_.metrics.advance*e.scale+u:0}}function OA(t,e,r,a){let u=Math.pow(t-e,2);return a?t<e?u/2:2*u:u+Math.abs(r)*r}function m4(t,e,r){let a=0;return t===10&&(a-=1e4),r&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function LA(t,e,r,a,u,d){let p=null,_=OA(e,r,u,d);for(let y of a){let b=OA(e-y.x,r,u,d)+y.badness;b<=_&&(p=y,_=b)}return{index:t,x:e,priorBreak:p,badness:_}}function FA(t){return t?FA(t.priorBreak).concat(t.index):[]}function Zw(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function NA(t,e,r,a,u){if(!(e||r||a||u))return;let d=t.length-1,p=t[d],_=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=d;y++)t[y].x-=_,t[y].y+=r+a+u}function g4(t,e,r,a){let{horizontalAlign:u,verticalAlign:d}=Zw(a),p=r[0]-t.displaySize[0]*u,_=r[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function zA(t,e,r,a,u,d){let p=t.imagePrimary,_;if(p.content){let z=p.content,j=p.pixelRatio||1;_=[z[0]/j,z[1]/j,p.displaySize[0]-z[2]/j,p.displaySize[1]-z[3]/j]}let y=e.left*d,b=e.right*d,E,S,D,R;r==="width"||r==="both"?(R=u[0]+y-a[3],S=u[0]+b+a[1]):(R=u[0]+(y+b-p.displaySize[0])/2,S=R+p.displaySize[0]);let k=e.top*d,F=e.bottom*d;return r==="height"||r==="both"?(E=u[1]+k-a[0],D=u[1]+F+a[2]):(E=u[1]+(k+F-p.displaySize[1])/2,D=E+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:E,right:S,bottom:D,left:R,collisionPadding:_}}class dl extends lt{constructor(e,r,a,u,d){super(e,r),this.angle=u,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new dl(this.x,this.y,this.z,this.angle,this.segment)}}function BA(t,e,r,a,u){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,_=0;for(;_>-r/2;){if(p--,p<0)return!1;_-=t[p].dist(d),d=t[p]}_+=t[p].dist(t[p+1]),p++;let y=[],b=0;for(;_<r/2;){let E=t[p],S=t[p+1];if(!S)return!1;let D=t[p-1].angleTo(E)-E.angleTo(S);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:D}),b+=D;_-y[0].distance>a;)b-=y.shift().angleDelta;if(b>u)return!1;p++,_+=E.dist(S)}return!0}function VA(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function jA(t,e,r){return t?.6*e*r:0}function UA(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function _4(t,e,r,a,u,d){let p=jA(r,u,d),_=UA(r,a)*d,y=0,b=VA(t)/2;for(let E=0;E<t.length-1;E++){let S=t[E],D=t[E+1],R=S.dist(D);if(y+R>b){let k=(b-y)/R,F=St(S.x,D.x,k),z=St(S.y,D.y,k),j=new dl(F,z,0,D.angleTo(S),E);return!p||BA(t,j,_,p,e)?j:void 0}y+=R}}function y4(t,e,r,a,u,d,p,_,y){let b=jA(a,d,p),E=UA(a,u),S=E*p,D=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-S<e/4&&(e=S+e/4),$A(t,D?e/2*_%e:(E/2+2*d)*p*_%e,e,b,r,S,D,!1,y)}function $A(t,e,r,a,u,d,p,_,y){let b=d/2,E=VA(t),S=0,D=e-r,R=[];for(let k=0;k<t.length-1;k++){let F=t[k],z=t[k+1],j=F.dist(z),Y=z.angleTo(F);for(;D+r<S+j;){D+=r;let X=(D-S)/j,K=St(F.x,z.x,X),le=St(F.y,z.y,X);if(K>=0&&K<y&&le>=0&&le<y&&D-b>=0&&D+b<=E){let se=new dl(K,le,0,Y,k);a&&!BA(t,se,d,a,u)||R.push(se)}}S+=j}return _||R.length||p||(R=$A(t,S/2,r,a,u,d,p,!0,y)),R}function GA(t,e,r,a,u){let d=[];for(let p=0;p<t.length;p++){let _=t[p],y;for(let b=0;b<_.length-1;b++){let E=_[b],S=_[b+1];E.x<e&&S.x<e||(E.x<e?E=new lt(e,E.y+(e-E.x)/(S.x-E.x)*(S.y-E.y))._round():S.x<e&&(S=new lt(e,E.y+(e-E.x)/(S.x-E.x)*(S.y-E.y))._round()),E.y<r&&S.y<r||(E.y<r?E=new lt(E.x+(r-E.y)/(S.y-E.y)*(S.x-E.x),r)._round():S.y<r&&(S=new lt(E.x+(r-E.y)/(S.y-E.y)*(S.x-E.x),r)._round()),E.x>=a&&S.x>=a||(E.x>=a?E=new lt(a,E.y+(a-E.x)/(S.x-E.x)*(S.y-E.y))._round():S.x>=a&&(S=new lt(a,E.y+(a-E.x)/(S.x-E.x)*(S.y-E.y))._round()),E.y>=u&&S.y>=u||(E.y>=u?E=new lt(E.x+(u-E.y)/(S.y-E.y)*(S.x-E.x),u)._round():S.y>=u&&(S=new lt(E.x+(u-E.y)/(S.y-E.y)*(S.x-E.x),u)._round()),y&&E.equals(y[y.length-1])||(y=[E],d.push(y)),y.push(S)))))}}return d}function HA(t){let e=0,r=0;for(let p of t)e+=p.w*p.h,r=Math.max(r,p.w);t.sort((p,_)=>_.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],u=0,d=0;for(let p of t)for(let _=a.length-1;_>=0;_--){let y=a[_];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,d=Math.max(d,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===y.w&&p.h===y.h){let b=a.pop();_<a.length&&(a[_]=b)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(a.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}J(dl,"Anchor");let vo=1;class Yw{constructor(e,{pixelRatio:r,version:a,stretchX:u,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=d,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+vo,this.paddedRect.y+vo]}get br(){return[this.paddedRect.x+this.paddedRect.w-vo,this.paddedRect.y+this.paddedRect.h-vo]}get displaySize(){return[(this.paddedRect.w-2*vo)/this.pixelRatio,(this.paddedRect.h-2*vo)/this.pixelRatio]}}class qA{constructor(e,r,a){let u={},d={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,u,p),this.addImages(r,d,p);let{w:_,h:y}=HA(p),b=new Lo({width:_||1,height:y||1});for(let E in e){let S=e[E],D=u[E].paddedRect;Lo.copy(S.data,b,{x:0,y:0},{x:D.x+vo,y:D.y+vo},S.data,a,S.sdf)}for(let E in r){let S=r[E],D=d[E].paddedRect,R=D.x+vo,k=D.y+vo,F=S.data.width,z=S.data.height;Lo.copy(S.data,b,{x:0,y:0},{x:R,y:k},S.data,a),Lo.copy(S.data,b,{x:0,y:z-1},{x:R,y:k-1},{width:F,height:1},a),Lo.copy(S.data,b,{x:0,y:0},{x:R,y:k+z},{width:F,height:1},a),Lo.copy(S.data,b,{x:F-1,y:0},{x:R-1,y:k},{width:1,height:z},a),Lo.copy(S.data,b,{x:0,y:0},{x:R+F,y:k},{width:1,height:z},a)}this.image=b,this.iconPositions=u,this.patternPositions=d}addImages(e,r,a){for(let u in e){let d=e[u],p={x:0,y:0,w:d.data.width+2*vo,h:d.data.height+2*vo};a.push(p),r[u]=new Yw(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let u in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,a),r),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;let[u,d]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(r.data,{useMipmap:p},{x:u,y:d})}}J(Yw,"ImagePosition"),J(qA,"ImageAtlas");let dg=1e20;function WA(t,e,r,a,u,d,p,_,y){for(let b=e;b<e+a;b++)ZA(t,r*d+b,d,u,p,_,y);for(let b=r;b<r+u;b++)ZA(t,b*d+e,1,a,p,_,y)}function ZA(t,e,r,a,u,d,p){d[0]=0,p[0]=-dg,p[1]=dg,u[0]=t[e];for(let _=1,y=0,b=0;_<a;_++){u[_]=t[e+_*r];let E=_*_;do{let S=d[y];b=(u[_]-u[S]+E-S*S)/(_-S)/2}while(b<=p[y]&&--y>-1);y++,d[y]=_,p[y]=b,p[y+1]=dg}for(let _=0,y=0;_<a;_++){for(;p[y+1]<_;)y++;let b=d[y],E=_-b;t[e+_*r]=u[b]+E*E}}let Ds=2,Xw={none:0,ideographs:1,all:2};class xf{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,a){let u=[],d=this.urls[r]||A.GLYPHS_URL;for(let p in e)for(let _ of e[p])u.push({stack:p,id:_});Hl(u,({stack:p,id:_},y)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=b.glyphs[_];if(E!==void 0)return void y(null,{stack:p,id:_,glyph:E});if(E=this._tinySDF(b,p,_),E)return b.glyphs[_]=E,void y(null,{stack:p,id:_,glyph:E});let S=Math.floor(_/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[S])return void y(null,{stack:p,id:_,glyph:E});let D=b.requests[S];D||(D=b.requests[S]=[],xf.loadGlyphRange(p,S,d,this.requestManager,(R,k)=>{if(k){b.ascender=k.ascender,b.descender=k.descender;for(let F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(b.glyphs[+F]=k.glyphs[+F]);b.ranges[S]=!0}for(let F of D)F(R,k);delete b.requests[S]})),D.push((R,k)=>{R?y(R):k&&y(null,{stack:p,id:_,glyph:k.glyphs[_]||null})})},(p,_)=>{if(p)a(p);else if(_){let y={};for(let{stack:b,id:E,glyph:S}of _)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Xw.none&&(this.localGlyphMode===Xw.all?!!this.localFontFamily:!!this.localFontFamily&&(ae["CJK Unified Ideographs"](e)||ae["Hangul Syllables"](e)||ae.Hiragana(e)||ae.Katakana(e)||ae["CJK Symbols and Punctuation"](e)||ae["CJK Unified Ideographs Extension A"](e)||ae["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,r,a){let u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(r)?F="900":/medium/i.test(r)?F="500":/light/i.test(r)&&(F="200"),d=e.tinySDF=new xf.TinySDF({fontFamily:u,fontWeight:F,fontSize:24*Ds,buffer:3*Ds,radius:8*Ds}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];let p=String.fromCodePoint(a),{data:_,width:y,height:b,glyphWidth:E,glyphHeight:S,glyphLeft:D,glyphTop:R,glyphAdvance:k}=d.draw(p);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Tc({width:y,height:b},_),metrics:{width:E/Ds,height:S/Ds,left:D/Ds,top:R/Ds-27,advance:k/Ds,localGlyph:!0}}}}xf.loadGlyphRange=function(t,e,r,a,u){let d=256*e,p=d+255,_=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${d}-${p}`),Pd.Glyphs);qa(_,(y,b)=>{if(y)u(y);else if(b){let E={},S=function(D){return new _f(D).readFields(h4,{})}(b);for(let D of S.glyphs)E[D.id]=D;u(null,{glyphs:E,ascender:S.ascender,descender:S.descender})}})},xf.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;let _=this.size=t+4*e,y=this._createCanvas(_),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${p} ${d} ${t}px ${u}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(t),p=Math.ceil(r),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),y=Math.min(this.size-this.buffer,p+Math.ceil(a)),b=_+2*this.buffer,E=y+2*this.buffer,S=Math.max(b*E,0),D=new Uint8ClampedArray(S),R={data:D,width:b,height:E,glyphWidth:_,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return R;let{ctx:k,buffer:F,gridInner:z,gridOuter:j}=this;k.clearRect(F,F,_,y),k.fillText(t,F,F+p);let Y=k.getImageData(F,F,_,y);j.fill(dg,0,S),z.fill(0,0,S);for(let X=0;X<y;X++)for(let K=0;K<_;K++){let le=Y.data[4*(X*_+K)+3]/255;if(le===0)continue;let se=(X+F)*b+K+F;if(le===1)j[se]=0,z[se]=dg;else{let me=.5-le;j[se]=me>0?me*me:0,z[se]=me<0?me*me:0}}WA(j,0,0,b,E,b,this.f,this.v,this.z),WA(z,F,F,_,y,b,this.f,this.v,this.z);for(let X=0;X<S;X++){let K=Math.sqrt(j[X])-Math.sqrt(z[X]);D[X]=Math.round(255-255*(K/this.radius+this.cutoff))}return R}};let Cc=vo;function YA(t,e,r,a){let u=[],d=t.imagePrimary,p=d.pixelRatio,_=d.paddedRect.w-2*Cc,y=d.paddedRect.h-2*Cc,b=t.right-t.left,E=t.bottom-t.top,S=d.stretchX||[[0,_]],D=d.stretchY||[[0,y]],R=(De,ze)=>De+ze[1]-ze[0],k=S.reduce(R,0),F=D.reduce(R,0),z=_-k,j=y-F,Y=0,X=k,K=0,le=F,se=0,me=z,_e=0,Te=j;if(d.content&&a){let De=d.content;Y=q0(S,0,De[0]),K=q0(D,0,De[1]),X=q0(S,De[0],De[2]),le=q0(D,De[1],De[3]),se=De[0]-Y,_e=De[1]-K,me=De[2]-De[0]-X,Te=De[3]-De[1]-le}let ke=(De,ze,Ye,Le)=>{let qe=W0(De.stretch-Y,X,b,t.left),Oe=Z0(De.fixed-se,me,De.stretch,k),We=W0(ze.stretch-K,le,E,t.top),Je=Z0(ze.fixed-_e,Te,ze.stretch,F),Ze=W0(Ye.stretch-Y,X,b,t.left),ht=Z0(Ye.fixed-se,me,Ye.stretch,k),Xe=W0(Le.stretch-K,le,E,t.top),nt=Z0(Le.fixed-_e,Te,Le.stretch,F),Et=new lt(qe,We),xt=new lt(Ze,We),_t=new lt(Ze,Xe),et=new lt(qe,Xe),It=new lt(Oe/p,Je/p),Wt=new lt(ht/p,nt/p),Pt=e*Math.PI/180;if(Pt){let Vn=Math.sin(Pt),Cn=Math.cos(Pt),mn=[Cn,-Vn,Vn,Cn];Et._matMult(mn),xt._matMult(mn),et._matMult(mn),_t._matMult(mn)}let Xt=De.stretch+De.fixed,Zt=Ye.stretch+Ye.fixed,sn=ze.stretch+ze.fixed,Dt=Le.stretch+Le.fixed,Un=t.imageSecondary;return{tl:Et,tr:xt,bl:et,br:_t,texPrimary:{x:d.paddedRect.x+Cc+Xt,y:d.paddedRect.y+Cc+sn,w:Zt-Xt,h:Dt-sn},texSecondary:Un?{x:Un.paddedRect.x+Cc+Xt,y:Un.paddedRect.y+Cc+sn,w:Zt-Xt,h:Dt-sn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:It,pixelOffsetBR:Wt,minFontScaleX:me/p/b,minFontScaleY:Te/p/E,isSDF:r}};if(a&&(d.stretchX||d.stretchY)){let De=XA(S,z,k),ze=XA(D,j,F);for(let Ye=0;Ye<De.length-1;Ye++){let Le=De[Ye],qe=De[Ye+1];for(let Oe=0;Oe<ze.length-1;Oe++)u.push(ke(Le,ze[Oe],qe,ze[Oe+1]))}}else u.push(ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return u}function q0(t,e,r){let a=0;for(let u of t)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function XA(t,e,r){let a=[{fixed:-Cc,stretch:0}];for(let[u,d]of t){let p=a[a.length-1];a.push({fixed:u-p.stretch,stretch:p.stretch}),a.push({fixed:u-p.stretch,stretch:p.stretch+(d-u)})}return a.push({fixed:e+Cc,stretch:r}),a}function W0(t,e,r,a){return t/e*r+a}function Z0(t,e,r,a){return t-e*r/a}function v4(t,e,r,a){let u=e+t.positionedLines[a].lineOffset;return a===0?r+u/2:r+(u+(e+t.positionedLines[a-1].lineOffset))/2}function x4(t,e=1,r=!1){let a=1/0,u=1/0,d=-1/0,p=-1/0,_=t[0];for(let R=0;R<_.length;R++){let k=_[R];(!R||k.x<a)&&(a=k.x),(!R||k.y<u)&&(u=k.y),(!R||k.x>d)&&(d=k.x),(!R||k.y>p)&&(p=k.y)}let y=Math.min(d-a,p-u),b=y/2,E=new Cm([],b4);if(y===0)return new lt(a,u);for(let R=a;R<d;R+=y)for(let k=u;k<p;k+=y)E.push(new bf(R+b,k+b,b,t));let S=function(R){let k=0,F=0,z=0,j=R[0];for(let Y=0,X=j.length,K=X-1;Y<X;K=Y++){let le=j[Y],se=j[K],me=le.x*se.y-se.x*le.y;F+=(le.x+se.x)*me,z+=(le.y+se.y)*me,k+=3*me}return new bf(F/k,z/k,0,R)}(t),D=E.length;for(;E.length;){let R=E.pop();(R.d>S.d||!S.d)&&(S=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,D)),R.max-S.d<=e||(b=R.h/2,E.push(new bf(R.p.x-b,R.p.y-b,b,t)),E.push(new bf(R.p.x+b,R.p.y-b,b,t)),E.push(new bf(R.p.x-b,R.p.y+b,b,t)),E.push(new bf(R.p.x+b,R.p.y+b,b,t)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${S.d}`)),S.p}function b4(t,e){return e.max-t.max}class bf{constructor(e,r,a,u){this.p=new lt(e,r),this.h=a,this.d=function(d,p){let _=!1,y=1/0;for(let b=0;b<p.length;b++){let E=p[b];for(let S=0,D=E.length,R=D-1;S<D;R=S++){let k=E[S],F=E[R];k.y>d.y!=F.y>d.y&&d.x<(F.x-k.x)*(d.y-k.y)/(F.y-k.y)+k.x&&(_=!_),y=Math.min(y,iM(d,k,F))}}return(_?1:-1)*Math.sqrt(y)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}let Kw=Number.POSITIVE_INFINITY,w4=Math.sqrt(2);function KA(t,[e,r]){let a=0,u=0;if(r===Kw){e<0&&(e=0);let d=e/w4;switch(t){case"top-right":case"top-left":u=d-7;break;case"bottom-right":case"bottom-left":u=7-d;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":u=r-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-r}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function Qw(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function T4(t,e,r,a,u,d,p,_,y,b,E,S,D,R,k){let F=d.textMaxSize.evaluate(e,{},S);F===void 0&&(F=p);let z=t.layers[0].layout,j=z.get("icon-offset").evaluate(e,{},S),Y=JA(r.horizontal)||r.vertical,X=D.name==="globe",K=br,le=p/K,se=t.tilePixelRatio*F/K,me=(qe=t.overscaling,t.zoom>18&&qe>2&&(qe>>=1),Math.max(rt/(512*qe),1)*z.get("symbol-spacing")),_e=z.get("text-padding")*t.tilePixelRatio,Te=z.get("icon-padding")*t.tilePixelRatio,ke=dn(z.get("text-max-angle")),De=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",ze=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ye=z.get("symbol-placement"),Le=me/2;var qe;let Oe=z.get("icon-text-fit").evaluate(e,{},S),We=z.get("icon-text-fit-padding").evaluate(e,{},S),Je=Oe!=="none",Ze;t.hasAnyIconTextFit===!1&&Je&&(t.hasAnyIconTextFit=!0),a&&Je&&(t.allowVerticalPlacement&&r.vertical&&(Ze=zA(a,r.vertical,Oe,We,j,le)),Y&&(a=zA(a,Y,Oe,We,j,le)));let ht=(Xe,nt,Et)=>{if(nt.x<0||nt.x>=rt||nt.y<0||nt.y>=rt)return;let xt=null;if(X){let{x:_t,y:et,z:It}=D.projectTilePoint(nt.x,nt.y,Et);xt={anchor:new dl(_t,et,It,0,void 0),up:D.upVector(Et,nt.x,nt.y)}}(function(_t,et,It,Wt,Pt,Xt,Zt,sn,Dt,Un,Vn,Cn,mn,Sn,Jn,Wn,Ei,_i,Mr,Si,hi,Ui,ar,lr,Yn,Kr,fl){let as=_t.addToLineVertexArray(et,Wt),Os,kc,Oc,bh,eP,tP,nP,iP=0,rP=0,oP=0,sP=0,ST=-1,DT=-1,ya={},aP=Jl(""),wh=It?It.anchor:et,MT=Dt.layout.get("icon-text-fit").evaluate(hi,{},Yn)!=="none",AT=0,PT=0;if(Dt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[AT,PT]=Dt.layout.get("text-offset").evaluate(hi,{},Yn).map(bo=>bo*br):(AT=Dt.layout.get("text-radial-offset").evaluate(hi,{},Yn)*br,PT=Kw),_t.allowVerticalPlacement&&Pt.vertical){let bo=Pt.vertical;if(Jn)tP=Jw(bo),sn&&(nP=Jw(sn));else{let wo=Dt.layout.get("text-rotate").evaluate(hi,{},Yn)+90;Oc=Y0(Un,wh,et,Vn,Cn,mn,bo,Sn,wo,Wn),sn&&(bh=Y0(Un,wh,et,Vn,Cn,mn,sn,_i,wo))}}if(Xt){let bo=Dt.layout.get("icon-rotate").evaluate(hi,{},Yn),wo=YA(Xt,bo,ar,MT),Af=sn?YA(sn,bo,ar,MT):void 0;kc=Y0(Un,wh,et,Vn,Cn,mn,Xt,_i,bo),iP=4*wo.length;let lP=_t.iconSizeData,Th=null;lP.kind==="source"?(Th=[Ss*Dt.layout.get("icon-size").evaluate(hi,{},Yn)],Th[0]>Sc&&Pi(`${_t.layerIds[0]}: Value for "icon-size" is >= ${fg}. Reduce your "icon-size".`)):lP.kind==="composite"&&(Th=[Ss*Ui.compositeIconSizes[0].evaluate(hi,{},Yn),Ss*Ui.compositeIconSizes[1].evaluate(hi,{},Yn)],(Th[0]>Sc||Th[1]>Sc)&&Pi(`${_t.layerIds[0]}: Value for "icon-size" is >= ${fg}. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,wo,Th,Si,Mr,hi,!1,It,et,as.lineStartIndex,as.lineLength,-1,lr,Yn,Kr,fl),ST=_t.icon.placedSymbolArray.length-1,Af&&(rP=4*Af.length,_t.addSymbols(_t.icon,Af,Th,Si,Mr,hi,Fo.vertical,It,et,as.lineStartIndex,as.lineLength,-1,lr,Yn,Kr,fl),DT=_t.icon.placedSymbolArray.length-1)}for(let bo in Pt.horizontal){let wo=Pt.horizontal[bo];Os||(aP=Jl(wo.text),Jn?eP=Jw(wo):Os=Y0(Un,wh,et,Vn,Cn,mn,wo,Sn,Dt.layout.get("text-rotate").evaluate(hi,{},Yn),Wn));let Af=wo.positionedLines.length===1;if(oP+=QA(_t,It,et,wo,Zt,Dt,Jn,hi,Wn,as,Pt.vertical?Fo.horizontal:Fo.horizontalOnly,Af?Object.keys(Pt.horizontal):[bo],ya,ST,Ui,lr,Yn,Kr),Af)break}Pt.vertical&&(sP+=QA(_t,It,et,Pt.vertical,Zt,Dt,Jn,hi,Wn,as,Fo.vertical,["vertical"],ya,DT,Ui,lr,Yn,Kr));let Lc=-1,RT=(bo,wo)=>bo?Math.max(bo,wo):wo;Lc=RT(eP,Lc),Lc=RT(tP,Lc),Lc=RT(nP,Lc);let UV=Lc>-1?1:0;_t.glyphOffsetArray.length>=65535&&Pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hi.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,hi.sortKey),_t.symbolInstances.emplaceBack(et.x,et.y,wh.x,wh.y,wh.z,ya.right>=0?ya.right:-1,ya.center>=0?ya.center:-1,ya.left>=0?ya.left:-1,ya.vertical>=0?ya.vertical:-1,ST,DT,aP,Os!==void 0?Os:_t.collisionBoxArray.length,Os!==void 0?Os+1:_t.collisionBoxArray.length,Oc!==void 0?Oc:_t.collisionBoxArray.length,Oc!==void 0?Oc+1:_t.collisionBoxArray.length,kc!==void 0?kc:_t.collisionBoxArray.length,kc!==void 0?kc+1:_t.collisionBoxArray.length,bh||_t.collisionBoxArray.length,bh?bh+1:_t.collisionBoxArray.length,Vn,oP,sP,iP,rP,UV,0,AT,PT,Lc,0,1,1,MT?1:0)})(t,nt,xt,Xe,r,a,u,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,De,y,0,Te,ze,j,e,d,b,E,S,R,k)};if(Ye==="line")for(let Xe of GA(e.geometry,0,0,rt,rt)){let nt=y4(Xe,me,ke,r.vertical||Y,a,K,se,t.overscaling,rt);for(let Et of nt)Y&&E4(t,Y.text,Le,Et)||ht(Xe,Et,S)}else if(Ye==="line-center"){for(let Xe of e.geometry)if(Xe.length>1){let nt=_4(Xe,ke,r.vertical||Y,a,K,se);nt&&ht(Xe,nt,S)}}else if(e.type==="Polygon")for(let Xe of P0(e.geometry,0)){let nt=x4(Xe,16);ht(Xe[0],new dl(nt.x,nt.y,0,0,void 0),S)}else if(e.type==="LineString")for(let Xe of e.geometry)ht(Xe,new dl(Xe[0].x,Xe[0].y,0,0,void 0),S);else if(e.type==="Point")for(let Xe of e.geometry)for(let nt of Xe)ht([nt],new dl(nt.x,nt.y,0,0,void 0),S)}let fg=255,Sc=fg*Ss;function QA(t,e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z,j){let Y=function(le,se,me,_e,Te,ke,De,ze){let Ye=[];if(se.positionedLines.length===0)return Ye;let Le=_e.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,qe=function(ht){let Xe=ht[0],nt=ht[1],Et=Xe*nt;return Et>0?[Xe,-nt]:Et<0?[-Xe,nt]:Xe===0?[nt,Xe]:[nt,-Xe]}(me),Oe=Math.abs(se.top-se.bottom);for(let ht of se.positionedLines)Oe-=ht.lineOffset;let We=se.positionedLines.length,Je=Oe/We,Ze=se.top-me[1];for(let ht=0;ht<We;++ht){let Xe=se.positionedLines[ht];Ze=v4(se,Je,Ze,ht);for(let nt of Xe.positionedGlyphs){if(!nt.rect)continue;let Et=nt.rect||{},xt=RA+1,_t=!0,et=1,It=0;if(nt.imageName){let Si=De[nt.imageName];if(!Si)continue;if(Si.sdf){Pi("SDF images are not supported in formatted text and will be ignored.");continue}_t=!1,et=Si.pixelRatio,xt=vo/et}let Wt=(Te||ze)&&nt.vertical,Pt=nt.metrics.advance*nt.scale/2,Xt=nt.metrics,Zt=nt.rect;if(Zt===null)continue;ze&&se.verticalizable&&(It=nt.imageName?Pt-nt.metrics.width*nt.scale/2:0);let sn=Te?[nt.x+Pt,nt.y]:[0,0],Dt=[0,0],Un=[0,0],Vn=!1;Te||(Wt?(Un=[nt.x+Pt+qe[0],nt.y+qe[1]-It],Vn=!0):Dt=[nt.x+Pt+me[0],nt.y+me[1]-It]);let Cn=Zt.w*nt.scale/(et*(nt.localGlyph?Ds:1)),mn=Zt.h*nt.scale/(et*(nt.localGlyph?Ds:1)),Sn,Jn,Wn,Ei;if(Wt){let Si=nt.y-Ze,hi=new lt(-Pt,Pt-Si),Ui=-Math.PI/2,ar=new lt(...Un);Sn=new lt(-Pt+Dt[0],Dt[1]),Sn._rotateAround(Ui,hi)._add(ar),Sn.x+=-Si+Pt,Sn.y-=(Xt.left-xt)*nt.scale;let lr=nt.imageName?Xt.advance*nt.scale:br*nt.scale,Yn=String.fromCodePoint(nt.glyph);c4(Yn)?Sn.x+=(1-xt)*nt.scale:u4(Yn)?Sn.x+=lr-Xt.height*nt.scale+(-xt-1)*nt.scale:Sn.x+=nt.imageName||Xt.width+2*xt===Zt.w&&Xt.height+2*xt===Zt.h?(lr-mn)/2:(lr-(Xt.height+2*xt)*nt.scale)/2,Jn=new lt(Sn.x,Sn.y-Cn),Wn=new lt(Sn.x+mn,Sn.y),Ei=new lt(Sn.x+mn,Sn.y-Cn)}else{let Si=(Xt.left-xt)*nt.scale-Pt+Dt[0],hi=(-Xt.top-xt)*nt.scale+Dt[1],Ui=Si+Cn,ar=hi+mn;Sn=new lt(Si,hi),Jn=new lt(Ui,hi),Wn=new lt(Si,ar),Ei=new lt(Ui,ar)}if(Le){let Si;Si=Te?new lt(0,0):Vn?new lt(qe[0],qe[1]):new lt(me[0],me[1]),Sn._rotateAround(Le,Si),Jn._rotateAround(Le,Si),Wn._rotateAround(Le,Si),Ei._rotateAround(Le,Si)}let _i=new lt(0,0),Mr=new lt(0,0);Ye.push({tl:Sn,tr:Jn,bl:Wn,br:Ei,texPrimary:Et,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:sn,sectionIndex:nt.sectionIndex,isSDF:_t,pixelOffsetTL:_i,pixelOffsetBR:Mr,minFontScaleX:0,minFontScaleY:0})}}return Ye}(0,a,y,d,p,_,u,t.allowVerticalPlacement),X=t.textSizeData,K=null;X.kind==="source"?(K=[Ss*d.layout.get("text-size").evaluate(_,{},z)],K[0]>Sc&&Pi(`${t.layerIds[0]}: Value for "text-size" is >= ${fg}. Reduce your "text-size".`)):X.kind==="composite"&&(K=[Ss*k.compositeTextSizes[0].evaluate(_,{},z),Ss*k.compositeTextSizes[1].evaluate(_,{},z)],(K[0]>Sc||K[1]>Sc)&&Pi(`${t.layerIds[0]}: Value for "text-size" is >= ${fg}. Reduce your "text-size".`)),t.addSymbols(t.text,Y,K,y,p,_,E,e,r,b.lineStartIndex,b.lineLength,R,F,z,j,!1);for(let le of S)D[le]=t.text.placedSymbolArray.length-1;return 4*Y.length}function JA(t){for(let e in t)return t[e];return null}function Y0(t,e,r,a,u,d,p,_,y,b){let E=p.top,S=p.bottom,D=p.left,R=p.right,k=p.collisionPadding;if(k&&(D-=k[0],E-=k[1],R+=k[2],S+=k[3]),y){let F=new lt(D,E),z=new lt(R,E),j=new lt(D,S),Y=new lt(R,S),X=dn(y),K=new lt(0,0);b&&(K=new lt(b[0],b[1])),F._rotateAround(X,K),z._rotateAround(X,K),j._rotateAround(X,K),Y._rotateAround(X,K),D=Math.min(F.x,z.x,j.x,Y.x),R=Math.max(F.x,z.x,j.x,Y.x),E=Math.min(F.y,z.y,j.y,Y.y),S=Math.max(F.y,z.y,j.y,Y.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,D,E,R,S,_,a,u,d),t.length-1}function Jw(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function E4(t,e,r,a){let u=t.compareText;if(e in u){let d=u[e];for(let p=d.length-1;p>=0;p--)if(a.dist(d[p])<r)return!0}else u[e]=[];return u[e].push(a),!1}function e2(t,e){let r=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),d=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),p=Math.sin(t._pitch)*d+u;return Math.min(1.01*p,u*(1/t._horizonShift))}function gh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let r=Math.pow(2,-t.z),a=t.x*r,u=(t.x+1)*r,d=t.y*r,p=(t.y+1)*r,_=no(a),y=no(u),b=sr(d),E=sr(p),S=e.project(_,b),D=e.project(y,b),R=e.project(y,E),k=e.project(_,E),F=Math.min(S.x,D.x,R.x,k.x),z=Math.min(S.y,D.y,R.y,k.y),j=Math.max(S.x,D.x,R.x,k.x),Y=Math.max(S.y,D.y,R.y,k.y),X=r/16;function K(se,me,_e,Te,ke,De){let ze=(_e+ke)/2,Ye=(Te+De)/2,Le=e.project(no(ze),sr(Ye)),qe=Math.max(0,F-Le.x,z-Le.y,Le.x-j,Le.y-Y);F=Math.min(F,Le.x),j=Math.max(j,Le.x),z=Math.min(z,Le.y),Y=Math.max(Y,Le.y),qe>X&&(K(se,Le,_e,Te,ze,Ye),K(Le,me,ze,Ye,ke,De))}K(S,D,a,d,u,d),K(D,R,u,d,u,p),K(R,k,u,p,a,p),K(k,S,a,p,a,d),F-=X,z-=X,j+=X,Y+=X;let le=1/Math.max(j-F,Y-z);return{scale:le,x:F*le,y:z*le,x2:j*le,y2:Y*le,projection:e}}function t2(t,{x:e,y:r},a=0){return new lt(((e-a)*t.scale-t.x)*rt,(r*t.scale-t.y)*rt)}let I4=i.ad.identity(new Float32Array(16));class Dc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new bn(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return Xr(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return e2(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,u){let d=e.horizonLineFromTop(!1),p=new lt(r,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,u))}pointCoordinate3D(e,r,a){let u=new lt(r,a);if(e.elevation)return e.elevation.pointCoordinate(u);{let d=this.pointCoordinate(e,u.x,u.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);let a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return I4}createTileMatrix(e,r,a){let u,d,p,_=a.canonical,y=i.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=gh(_,this);u=1,d=b.x+a.wrap*b.scale,p=b.y,i.ad.scale(y,y,[u/b.scale,u/b.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*a.wrap)*u,p=_.y*u;return i.ad.translate(y,y,[d,p,0]),i.ad.scale(y,y,[u/rt,u/rt,1]),y}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class C4 extends Dc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[r,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(dn(r));this.n=(u+Math.sin(dn(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){let{n:a,c:u,r0:d}=this,p=dn(e-this.center[0]),_=dn(r),y=Math.sqrt(u-2*a*Math.sin(_))/a;return{x:y*Math.sin(p*a),y:y*Math.cos(p*a)-d,z:0}}unproject(e,r){let{n:a,c:u,r0:d}=this,p=d+r,_=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));let y=dn(this.center[0])*a;_=$a(_,-Math.PI-y,Math.PI-y);let b=Jt(gr(_/a)+this.center[0],-180,180),E=Math.asin(Jt((u-(e*e+p*p)*a*a)/(2*a),-1,1)),S=Jt(gr(E),-ki,ki);return new bn(b,S)}}let pg=1.340264,mg=-.081106,gg=893e-6,_g=.003796,X0=Math.sqrt(3)/2;class S4 extends Dc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(X0*Math.sin(r)),u=a*a,d=u*u*u;return{x:.5*(e*Math.cos(a)/(X0*(pg+3*mg*u+d*(7*gg+9*_g*u)))/Math.PI+.5),y:1-.5*(a*(pg+mg*u+d*(gg+_g*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=a*a,d=u*u*u;for(let E,S,D,R=0;R<12&&(S=a*(pg+mg*u+d*(gg+_g*u))-r,D=pg+3*mg*u+d*(7*gg+9*_g*u),E=S/D,a=Jt(a-E,-Math.PI/3,Math.PI/3),u=a*a,d=u*u*u,!(Math.abs(E)<1e-12));++R);let p=X0*e*(pg+3*mg*u+d*(7*gg+9*_g*u))/Math.cos(a),_=Math.asin(Math.sin(a)/X0),y=Jt(180*p/Math.PI,-180,180),b=Jt(180*_/Math.PI,-ki,ki);return new bn(y,b)}}class D4 extends Dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){let a=360*(e-.5),u=Jt(360*(.5-r),-ki,ki);return new bn(a,u)}}let wf=Math.PI/2;function K0(t){return Math.tan((wf+t)/2)}class M4 extends Dc{constructor(e){super(e),this.center=e.center||[0,30];let[r,a]=this.parallels=e.parallels||[30,30],u=dn(r),d=dn(a);this.southernCenter=u+d<0,this.southernCenter&&(u=-u,d=-d);let p=Math.cos(u),_=K0(u);this.n=u===d?Math.sin(u):Math.log(p/Math.cos(d))/Math.log(K0(d)/_),this.f=p*Math.pow(K0(u),this.n)/this.n}project(e,r){r=dn(r),this.southernCenter&&(r=-r),e=dn(e-this.center[0]);let a=1e-6,{n:u,f:d}=this;d>0?r<-wf+a&&(r=-wf+a):r>wf-a&&(r=wf-a);let p=d/Math.pow(K0(r),u),_=p*Math.sin(u*e),y=d-p*Math.cos(u*e);return _=.5*(_/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:_,y:this.southernCenter?y:1-y,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;let{n:a,f:u}=this,d=u-r,p=Math.sign(d),_=Math.sign(a)*Math.sqrt(e*e+d*d),y=Math.atan2(e,Math.abs(d))*p;d*a<0&&(y-=Math.PI*Math.sign(e)*p);let b=Jt(gr(y/a)+this.center[0],-180,180),E=Jt(gr(2*Math.atan(Math.pow(u/_,1/a))-wf),-ki,ki);return new bn(b,this.southernCenter?-E:E)}}class n2 extends Dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:da(e),y:fa(r),z:0}}unproject(e,r){let a=no(e),u=sr(r);return new bn(a,u)}}let i2=dn(ki);class A4 extends Dc{project(e,r){let a=(r=dn(r))*r,u=a*a;return{x:.5*((e=dn(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=25,d=0,p=a*a;do{p=a*a;let b=p*p;d=(a*(1.007226+p*(.015085+b*(.028874*p-.044475-.005916*b)))-r)/(1.007226+p*(.045255+b*(.259866*p-.311325-.005916*11*b))),a=Jt(a-d,-i2,i2)}while(Math.abs(d)>1e-6&&--u>0);p=a*a;let _=Jt(gr(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=gr(a);return new bn(_,y)}}let r2=dn(ki);class P4 extends Dc{project(e,r){r=dn(r),e=dn(e);let a=Math.cos(r),u=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),p=Math.sin(d)/d,_=.5*(e*u+2*a*Math.sin(e/2)/p)||0,y=.5*(r+Math.sin(r)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,d=25,p=1e-6,_=0,y=0;do{let b=Math.cos(u),E=Math.sin(u),S=2*E*b,D=E*E,R=b*b,k=Math.cos(a/2),F=Math.sin(a/2),z=2*k*F,j=F*F,Y=1-R*k*k,X=Y?1/Y:0,K=Y?Math.acos(b*k)*Math.sqrt(1/Y):0,le=.5*(2*K*b*F+2*a/Math.PI)-e,se=.5*(K*E+u)-r,me=.5*X*(R*j+K*b*k*D)+1/Math.PI,_e=X*(z*S/4-K*E*F),Te=.125*X*(S*F-K*E*R*z),ke=.5*X*(D*k+K*j*b)+.5,De=_e*Te-ke*me;_=(se*_e-le*ke)/De,y=(le*Te-se*me)/De,a=Jt(a-_,-Math.PI,Math.PI),u=Jt(u-y,-r2,r2)}while((Math.abs(_)>p||Math.abs(y)>p)&&--d>0);return new bn(gr(a),gr(u))}}class o2 extends Dc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(dn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){let{scale:a,cosPhi:u}=this;return{x:dn(e)*u*a+.5,y:-Math.sin(dn(r))/u*a+.5,z:0}}unproject(e,r){let{scale:a,cosPhi:u}=this,d=-(r-.5)/a,p=Jt(gr((e-.5)/a)/u,-180,180),_=Math.asin(Jt(d*u,-1,1)),y=Jt(gr(_),-ki,ki);return new bn(p,y)}}class R4 extends n2{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){let u=eg(e,r,a),d=tg(pa(a));return i._.transformMat4(u,u,d),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r){let a=hh(r.lat,r.lng),u=i._.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,p=Xr(1,0)*rt*d;i._.scaleAndAdd(a,a,u,p);let _=i.ad.identity(new Float64Array(16));return i.ad.multiply(_,e.pixelMatrix,e.globeMatrix),i._.transformMat4(a,a,_),new lt(a[0],a[1])}pixelsPerMeter(e,r){return Xr(1,0)*r}pixelSpaceConversion(e,r,a){let u=Xr(1,e)*r,d=St(Xr(1,45)*r,u,a);return this.pixelsPerMeter(e,r)/d}createTileMatrix(e,r,a){let u=Aw(pa(a.canonical));return i.ad.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){let{center:a}=e,u=tg(pa(r));return i.ad.rotateY(u,u,dn(a.lng)),i.ad.rotateX(u,u,dn(a.lat)),i.ad.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,a,u){return dM(e,r,a,!0)||new Dr(0,0)}pointCoordinate3D(e,r,a){let u=this.pointCoordinate(e,r,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!dM(e,r.x,r.y,!1)}farthestPixelDistance(e){let r=function(u,d){let p=u.cameraToCenterDistance,_=u._centerAltitude*d,y=u._camera,b=u._camera.forward(),E=i._.add([],i._.scale([],b,-p),[0,0,_]),S=u.worldSize/(2*Math.PI),D=[0,0,-S],R=u.width/u.height,k=Math.tan(u.fovAboveCenter),F=i._.scale([],y.up(),k),z=i._.scale([],y.right(),k*R),j=i._.normalize([],i._.add([],i._.add([],b,F),z)),Y=[],X;if(new Iw(E,j).closestPointOnSphere(D,S,Y)){let K=i._.add([],Y,D),le=i._.sub([],K,E);X=Math.cos(u.fovAboveCenter)*i._.length(le)}else{let K=i._.sub([],E,D),le=i._.sub([],D,E);i._.normalize(le,le);let se=i._.length(K)-S;X=Math.sqrt(se*(se+2*S));let me=Math.acos(X/(S+se))-Math.acos(i._.dot(b,le));X*=Math.cos(me)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=ul(e.zoom);if(a>0){let u=e2(e,Xr(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return St(r,u+d*(1-Math.cos(p)),Math.pow(a,10))}return r}upVector(e,r,a){return eg(r,a,e,1)}upVectorScale(e){return{metersToTile:I0(S0(pa(e)))}}}function s2(t){let e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new n2(t);case"equirectangular":return new D4(t);case"naturalEarth":return new A4(t);case"equalEarth":return new S4(t);case"winkelTripel":return new P4(t);case"albers":return r?new o2(t):new C4(t);case"lambertConformalConic":return r?new o2(t):new M4(t);case"globe":return new R4(t)}throw new Error(`Invalid projection name: ${t.name}`)}let k4=(()=>{class t{constructor(r,a,u,d){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=r;let p=r.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||d||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class Tf{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}Tf.ReadOnly=!1,Tf.ReadWrite=!0,Tf.disabled=new Tf(519,Tf.ReadOnly,[0,1]);let eT=7680;class tT{constructor(e,r,a,u,d,p){this.test=e,this.ref=r,this.mask=a,this.fail=u,this.depthFail=d,this.pass=p}}tT.disabled=new tT({func:519,mask:0},0,0,eT,eT,eT);let yg=771;class xo{constructor(e,r,a,u){this.blendFunction=e,this.blendColor=r,this.mask=a,this.blendEquation=u}}xo.Replace=[1,0,1,0],xo.disabled=new xo(xo.Replace,Tn.transparent,[!1,!1,!1,!1]),xo.unblended=new xo(xo.Replace,Tn.transparent,[!0,!0,!0,!0]),xo.alphaBlended=new xo([1,yg,1,yg],Tn.transparent,[!0,!0,!0,!0]),xo.alphaBlendedNonPremultiplied=new xo([770,yg,770,yg],Tn.transparent,[!0,!0,!0,!0]),xo.multiply=new xo([774,0,774,0],Tn.transparent,[!0,!0,!0,!0]);let nT=1029,iT=2305;class Ms{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}Ms.disabled=new Ms(!1,nT,iT),Ms.backCCW=new Ms(!0,nT,iT),Ms.backCW=new Ms(!0,nT,2304),Ms.frontCW=new Ms(!0,1028,2304),Ms.frontCCW=new Ms(!0,1028,iT);let O4=O0.types,L4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Q0(t,e,r,a,u,d,p,_,y,b,E,S,D){let R=_?Math.min(Sc,Math.round(_[0])):0,k=_?Math.min(Sc,Math.round(_[1])):0;t.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),d,p,(R<<1)+(y?1:0),k,16*b,16*E,256*S,256*D)}function J0(t,e,r){t.emplaceBack(e,r)}function ev(t,e,r,a,u,d,p){t.emplaceBack(e,r,a,u,d,p)}function tv(t,e,r,a,u){t.emplaceBack(e,r,a,u),t.emplaceBack(e,r,a,u),t.emplaceBack(e,r,a,u),t.emplaceBack(e,r,a,u)}function F4(t){for(let e of t.sections)if(Ne(e.text))return!0;return!1}class rT{constructor(e){this.layoutVertexArray=new Z1,this.indexArray=new Qi,this.programConfigurations=e,this.segments=new mi,this.dynamicLayoutVertexArray=new mc,this.opacityVertexArray=new X1,this.occlusionQueryOpacityVertexArray=new lh,this.placedSymbolArray=new FD,this.iconTransitioningVertexArray=new yc,this.globeExtVertexArray=new Y1,this.zOffsetVertexArray=new lh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,a,u,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,N5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,B5.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,L4,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,$w.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,V5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,z5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,pA.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}J(rT,"SymbolBuffers");class oT{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new mi,this.collisionVertexArray=new J1,this.collisionVertexArrayExt=new mc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,j5.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,U5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}J(oT,"CollisionBuffers");class Ef{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=i.ad.identity([]),this.placementViewportMatrix=i.ad.identity([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hw(this.zoom,r["text-size"]),this.iconSizeData=Hw(this.zoom,r["icon-size"]);let a=this.layers[0].layout,u=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>Fo[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new rT(new xc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new rT(new xc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new BD,this.lineVertexArray=new VD,this.symbolInstances=new zD}calculateGlyphDependencies(e,r,a,u,d){for(let p=0;p<e.length;p++){let _=e.codePointAt(p);if(_===void 0)break;if(r[_]=!0,u&&d&&_<=65535){let y=ug[e.charAt(p)];y&&(r[y.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let a=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!jw(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,r,a,u){let d=this.layers[0],p=d.layout,_=this.projection.name==="globe",y=p.get("text-font"),b=p.get("text-field"),E=p.get("icon-image"),S=(b.value.kind!=="constant"||b.value.value instanceof yr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!S&&!D)return;let k=r.iconDependencies,F=r.glyphDependencies,z=r.availableImages,j=new jt(this.zoom);for(let{feature:Y,id:X,index:K,sourceLayerIndex:le}of e){let se=d._featureFilter.needGeometry,me=ll(Y,se);if(!d._featureFilter.filter(j,me,a))continue;if(se||(me.geometry=Cs(Y,a,u)),_&&Y.type!==1&&a.z<=5){let De=me.geometry,ze=.98078528056,Ye=(Le,qe)=>{let Oe=eg(Le.x,Le.y,a,1),We=eg(qe.x,qe.y,a,1);return i._.dot(Oe,We)<ze};for(let Le=0;Le<De.length;Le++)De[Le]=xB(De[Le],Ye)}let _e,Te;if(S){let De=d.getValueAndResolveTokens("text-field",me,a,z),ze=yr.factory(De);F4(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||fn()==="unavailable"||this.hasRTLText&&kn.isParsed())&&(_e=l4(ze,d,me))}if(D){let De=d.getValueAndResolveTokens("icon-image",me,a,z);Te=De instanceof zr?De:zr.fromString(De)}if(!_e&&!Te)continue;let ke=this.sortFeaturesByKey?R.evaluate(me,{},a):void 0;if(this.features.push({id:X,text:_e,icon:Te,index:K,sourceLayerIndex:le,geometry:me.geometry,properties:Y.properties,type:O4[Y.type],sortKey:ke}),Te&&(k[Te.namePrimary]=!0,Te.nameSecondary&&(k[Te.nameSecondary]=!0)),_e){let De=y.evaluate(me,{},a).join(","),ze=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fo.vertical)>=0;for(let Ye of _e.sections)if(Ye.image)k[Ye.image.namePrimary]=!0;else{let Le=Ce(_e.toString()),qe=Ye.fontStack||De,Oe=F[qe]=F[qe]||{};this.calculateGlyphDependencies(Ye.text,Oe,ze,this.allowVerticalPlacement,Le)}}}p.get("symbol-placement")==="line"&&(this.features=function(Y){let X={},K={},le=[],se=0;function me(De){le.push(Y[De]),se++}function _e(De,ze,Ye){let Le=K[De];return delete K[De],K[ze]=Le,le[Le].geometry[0].pop(),le[Le].geometry[0]=le[Le].geometry[0].concat(Ye[0]),Le}function Te(De,ze,Ye){let Le=X[ze];return delete X[ze],X[De]=Le,le[Le].geometry[0].shift(),le[Le].geometry[0]=Ye[0].concat(le[Le].geometry[0]),Le}function ke(De,ze,Ye){let Le=Ye?ze[0][ze[0].length-1]:ze[0][0];return`${De}:${Le.x}:${Le.y}`}for(let De=0;De<Y.length;De++){let ze=Y[De],Ye=ze.geometry,Le=ze.text?ze.text.toString():null;if(!Le){me(De);continue}let qe=ke(Le,Ye),Oe=ke(Le,Ye,!0);if(qe in K&&Oe in X&&K[qe]!==X[Oe]){let We=Te(qe,Oe,Ye),Je=_e(qe,Oe,le[We].geometry);delete X[qe],delete K[Oe],K[ke(Le,le[Je].geometry,!0)]=Je,le[We].geometry=null}else qe in K?_e(qe,Oe,Ye):Oe in X?Te(qe,Oe,Ye):(me(De),X[qe]=se-1,K[Oe]=se-1)}return le.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,X)=>Y.sortKey-X.sortKey)}update(e,r,a,u,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,_,a,u,d),this.icon.programConfigurations.updatePaintArrays(e,r,_,a,u,d)}updateOcclusionOpacities(e,r,a){if(!r.useOcclusionQueries)return!1;let u=this;if(u.projection.name==="globe")return!1;let d=!1;u.hasTextData()&&(d=d||u.text.occlusionQueryOpacityVertexArray.length!==0),u.hasIconData()&&(d=d||u.icon.occlusionQueryOpacityVertexArray.length!==0);let p=u.layers[0].paint,_=p.get("icon-occlusion-opacity").constantOr(0)!==1,y=p.get("text-occlusion-opacity").constantOr(0)!==1;if(!_&&!y)return!1;let b=!d;for(let R=0;R<u.symbolInstances.length;R++){let k=u.symbolInstances.get(R),F=k.occlusionOpacity;k.occlusionOpacity+=(k.occlusionState>.5?1:-1)*r.fadeSpeed*a*.001,k.occlusionOpacity=Jt(k.occlusionOpacity,0,1),b=b||k.occlusionOpacity!==F}if(!b)return!1;let E=0,S=0,D=(R,k,F,z)=>{let j=0,Y=0;F?(j=S,S+=z,Y=S):(j=E,E+=z,Y=E),Y>k.occlusionQueryOpacityVertexArray.length&&k.occlusionQueryOpacityVertexArray.resize(Y);let X=R.occlusionOpacity;for(let K=0;K<z;K++)k.occlusionQueryOpacityVertexArray.emplace(K+j,X)};for(let R=0;R<u.symbolInstances.length;R++){let k=u.symbolInstances.get(R),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:z,numIconVertices:j}=k,Y=j>0;if((F>0||z>0)&&(D(k,u.text,!1,F),D(k,u.text,!1,z)),Y){let{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:K}=k;X>=0&&D(k,u.icon,!0,j),K>=0&&D(k,u.icon,!0,k.numVerticalIconVertices)}}return u.hasTextData()&&u.text.occlusionQueryOpacityVertexBuffer&&(u.text.occlusionQueryOpacityVertexBuffer.length<u.text.occlusionQueryOpacityVertexArray.length?u.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.text.occlusionQueryOpacityVertexArray,$w.members,!0):u.text.occlusionQueryOpacityVertexBuffer.updateData(u.text.occlusionQueryOpacityVertexArray)),u.hasIconData()&&u.icon.occlusionQueryOpacityVertexBuffer&&(u.icon.occlusionQueryOpacityVertexBuffer.length<u.icon.occlusionQueryOpacityVertexArray.length?u.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.icon.occlusionQueryOpacityVertexArray,$w.members,!0):u.icon.occlusionQueryOpacityVertexBuffer.updateData(u.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(d,p,_)=>{a+=p,a>d.length&&d.resize(a);for(let y=-p;y<0;y++)d.emplace(y+a,_)},r=(d,p,_)=>{u+=p,u>d.length&&d.resize(u);for(let y=-p;y<0;y++)d.emplace(y+u,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:y,numIconVertices:b}=p,E=p.zOffset,S=b>0;if((_>0||y>0)&&(e(this.text.zOffsetVertexArray,_,E),e(this.text.zOffsetVertexArray,y,E)),S){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:R}=p;D>=0&&r(this.icon.zOffsetVertexArray,b,E),R>=0&&r(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=s2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,r){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:u,y:d}of r)this.lineVertexArray.emplaceBack(u,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,d,p,_,y,b,E,S,D,R,k,F,z){let j=e.indexArray,Y=e.layoutVertexArray,X=e.globeExtVertexArray,K=e.segments.prepareSegment(4*r.length,Y,j,this.canOverlap?p.sortKey:void 0),le=this.glyphOffsetArray.length,se=K.vertexLength,me=this.allowVerticalPlacement&&_===Fo.vertical?Math.PI/2:0,_e=p.text&&p.text.sections;for(let ke=0;ke<r.length;ke++){let{tl:De,tr:ze,bl:Ye,br:Le,texPrimary:qe,texSecondary:Oe,pixelOffsetTL:We,pixelOffsetBR:Je,minFontScaleX:Ze,minFontScaleY:ht,glyphOffset:Xe,isSDF:nt,sectionIndex:Et}=r[ke],xt=K.vertexLength,_t=Xe[1];if(Q0(Y,b.x,b.y,De.x,_t+De.y,qe.x,qe.y,a,nt,We.x,We.y,Ze,ht),Q0(Y,b.x,b.y,ze.x,_t+ze.y,qe.x+qe.w,qe.y,a,nt,Je.x,We.y,Ze,ht),Q0(Y,b.x,b.y,Ye.x,_t+Ye.y,qe.x,qe.y+qe.h,a,nt,We.x,Je.y,Ze,ht),Q0(Y,b.x,b.y,Le.x,_t+Le.y,qe.x+qe.w,qe.y+qe.h,a,nt,Je.x,Je.y,Ze,ht),y){let{x:et,y:It,z:Wt}=y.anchor,[Pt,Xt,Zt]=y.up;ev(X,et,It,Wt,Pt,Xt,Zt),ev(X,et,It,Wt,Pt,Xt,Zt),ev(X,et,It,Wt,Pt,Xt,Zt),ev(X,et,It,Wt,Pt,Xt,Zt),tv(e.dynamicLayoutVertexArray,et,It,Wt,me)}else tv(e.dynamicLayoutVertexArray,b.x,b.y,b.z,me);if(z){let et=Oe||qe;J0(e.iconTransitioningVertexArray,et.x,et.y),J0(e.iconTransitioningVertexArray,et.x+et.w,et.y),J0(e.iconTransitioningVertexArray,et.x,et.y+et.h),J0(e.iconTransitioningVertexArray,et.x+et.w,et.y+et.h)}j.emplaceBack(xt,xt+1,xt+2),j.emplaceBack(xt+1,xt+2,xt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),ke!==r.length-1&&Et===r[ke+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,p,p.index,{},R,k,F,_e&&_e[Et])}let Te=y?y.anchor:b;e.placedSymbolArray.emplaceBack(Te.x,Te.y,Te.z,b.x,b.y,le,this.glyphOffsetArray.length-le,se,E,S,b.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],_,0,!1,0,D,0)}_commitLayoutVertex(e,r,a,u,d,p,_){e.emplaceBack(r,a,u,d,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,r,a,u,d,p,_){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=y.vertexLength,E=_.tileAnchorX,S=_.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,r,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,S,new lt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,S,new lt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,S,new lt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,d,p,E,S,new lt(e.x1,e.y2)),y.vertexLength+=4;let D=a.indexArray;D.emplaceBack(b,b+1),D.emplaceBack(b+1,b+2),D.emplaceBack(b+2,b+3),D.emplaceBack(b+3,b),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,p,r,_);this._addCollisionDebugVertices(y,b,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,b,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new oT(g0,mA.members,yc),this.iconCollisionBox=new oT(g0,mA.members,yc);let a=yf(this.iconSizeData,e),u=yf(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,r,a,u){let d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),p=G0(this.textSizeData,e,d)/br;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,a){let u=this.icon.placedSymbolArray.get(a),d=G0(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,a,u){e.emplaceBack(r,-a,-a,u),e.emplaceBack(r,a,-a,u),e.emplaceBack(r,a,a,u),e.emplaceBack(r,-a,a,u)}_updateTextDebugCollisionBoxes(e,r,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,p,r,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,r,a,u,d,p){for(let _=u;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=yf(this.iconSizeData,e),u=yf(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(u,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,u,d,p,_,y,b){let E={};if(r<a){let{x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(r);E.textBox={x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},E.textFeatureIndex=le}if(u<d){let{x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(u);E.verticalTextBox={x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},E.verticalTextFeatureIndex=le}if(p<_){let{x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(p);E.iconBox={x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},E.iconFeatureIndex=le}if(y<b){let{x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:le}=e.get(y);E.verticalIconBox={x1:S,y1:D,x2:R,y2:k,padding:F,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},E.verticalIconFeatureIndex=le}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){let a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),a=Math.cos(e),u=[],d=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);let y=this.symbolInstances.get(_);u.push(0|Math.round(r*y.tileAnchorX+a*y.tileAnchorY)),d.push(y.featureIndex)}return p.sort((_,y)=>u[_]-u[y]||d[y]-d[_]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:b}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&d!==u&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}J(Ef,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ef.addDynamicAttributes=tv;class os{constructor(e,r,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,a){let{width:u,height:d}=e,{context:p}=this,{gl:_}=p;if(_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===d){let{x:y,y:b}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,y,b,_.RGBA,_.UNSIGNED_BYTE,e);else{let E=this.format,S=_.UNSIGNED_BYTE;this.format===_.R32F&&(E=_.RED,S=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,y,b,u,d,E,S,e.data)}}else if(this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===_.R8&&(y=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,y,_.UNSIGNED_BYTE,e)}else{let y=this.format,b=this.format,E=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,E=_.UNSIGNED_SHORT),this.format===_.R8&&(b=_.RED),this.format===_.R32F&&(E=_.FLOAT,b=_.RED),_.texImage2D(_.TEXTURE_2D,0,y,u,d,0,b,E,e.data)}this.useMipmap=!!(r&&r.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,r,a=!1){let{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,a,u){let{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class nv{constructor(e,r){this.context=e,this.texture=r}bind(e,r){let{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}let ss=32,ga=33,Mc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,a=0,u=0,d=0,p=0,_=0;for(1&e?u=d=p=ss:r=a=_=ss;(e>>=1)>1;){let b=r+u>>1,E=a+d>>1;1&e?(u=r,d=a,r=p,a=_):(r=u,a=d,u=p,d=_),p=b,_=E}let y=4*t;Mc[y+0]=r,Mc[y+1]=a,Mc[y+2]=u,Mc[y+3]=d}let _a=new Uint16Array(2178),Ac=new Uint8Array(1089),iv=new Uint16Array(1089);function a2(t){return t===0?-.03125:t===32?.03125:0}var rv=An([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),N4=An([{name:"a_index",type:"Int16",components:1}]);let l2={type:2,extent:rt,loadGeometry:()=>[[new lt(0,0),new lt(rt+1,0),new lt(rt+1,rt+1),new lt(0,rt+1),new lt(0,0)]]};class ov{constructor(e,r,a,u,d){this.tileID=e,this.uid=xd(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){let r=e+this.timeAdded;r<rr.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=gh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){let p={};if(!d)return p;for(let _ of u){let y=_.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>y.filter(E=>E.id===b)[0]));for(let b of y)p[b.fqid]=_}}return p}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(let u in this.buckets){let d=this.buckets[u];if(d instanceof Ef){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let u in this.buckets){let d=this.buckets[u];if(d instanceof Ef&&d.hasRTLText){this.hasRTLText=!0,kn.isLoading()||kn.isLoaded()||fn()!=="deferred"||cn();break}}this.queryPadding=0;for(let u in this.buckets){let d=this.buckets[u],p=r.style.getOwnLayer(u);if(!p)continue;let _=p.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new aw}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let u in this.buckets){let d=this.buckets[u];d.uploadPending()&&d.upload(e)}let r=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let u=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new os(e,a.image,r.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new os(e,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new os(e,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(e,r,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let u=r.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,r)))}queryRenderedFeatures(e,r,a,u,d,p,_,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:_,transform:p,params:d,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let u=a.loadVTLayers(),d=r?r.sourceLayer:"",p=u._geojsonTileLayer||u[d];if(!p)return;let _=Sr(r&&r.filter),{z:y,x:b,y:E}=this.tileID.canonical,S={z:y,x:b,y:E};for(let D=0;D<p.length;D++){let R=p.feature(D);if(_.needGeometry){let z=ll(R,!0);if(!_.filter(new jt(this.tileID.overscaledZ),z,this.tileID.canonical))continue}else if(!_.filter(new jt(this.tileID.overscaledZ),R))continue;let k=a.getId(R,d),F=new MA(R,y,b,E,k);F.tile=S,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let r=this.expirationTime;if(e.cacheControl){let a=em(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),u=!1;if(this.expirationTime>a)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{let d=this.expirationTime-r;d?this.expirationTime=a+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&r&&this.updateBuckets(e,r)}updateBuckets(e,r){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),u=r.style.listImages(),d=r.style.getBrightness();for(let p in this.buckets){if(!r.style.hasLayer(p))continue;let _=this.buckets[p],y=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],E={};if(e&&(E=e[y],!b||!E||Object.keys(E).length===0))continue;if(_.update(E,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),_ instanceof V0||_ instanceof R0){let D=r.style.getOwnSourceCache(_.layers[0].source);r._terrain&&r._terrain.enabled&&D&&_.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(D.id,this.tileID)}let S=r&&r.style&&r.style.getOwnLayer(p);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<rr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=rr.now()+e}setTexture(e,r){let a=r.context,u=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture&&this.texture instanceof os?this.texture.update(e,{useMipmap:!0}):(this.texture=new os(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,r){let a={};for(let u of r)a[u]=!0;this.dependencies[e]=a}hasDependency(e,r){for(let a of e){let u=this.dependencies[a];if(u){for(let d of r)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;let a=Cs(l2,this.tileID.canonical,this.tileTransform)[0],u=new Es,d=new Wm;for(let p=0;p<a.length;p++){let{x:_,y}=a[p];u.emplaceBack(_,y),d.emplaceBack(p)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,Jm.members),this._tileDebugSegments=mi.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;let a=Cs(l2,this.tileID.canonical,this.tileTransform)[0],u,d;if(this.isRaster){let p=function(_,y){let b=gh(_,y),E=Math.pow(2,_.z);for(let z=0;z<ga;z++)for(let j=0;j<ga;j++){let Y=no((_.x+(j+a2(j))/ss)/E),X=sr((_.y+(z+a2(z))/ss)/E),K=y.project(Y,X),le=z*ga+j;_a[2*le+0]=Math.round((K.x*b.scale-b.x)*rt),_a[2*le+1]=Math.round((K.y*b.scale-b.y)*rt)}Ac.fill(0),iv.fill(0);for(let z=2045;z>=0;z--){let j=4*z,Y=Mc[j+0],X=Mc[j+1],K=Mc[j+2],le=Mc[j+3],se=Y+K>>1,me=X+le>>1,_e=se+me-X,Te=me+Y-se,ke=X*ga+Y,De=le*ga+K,ze=me*ga+se,Ye=Math.hypot((_a[2*ke+0]+_a[2*De+0])/2-_a[2*ze+0],(_a[2*ke+1]+_a[2*De+1])/2-_a[2*ze+1])>=16;Ac[ze]=Ac[ze]||(Ye?1:0),z<1022&&(Ac[ze]=Ac[ze]||Ac[(X+Te>>1)*ga+(Y+_e>>1)]||Ac[(le+Te>>1)*ga+(K+_e>>1)])}let S=new pc,D=new Qi,R=0;function k(z,j){let Y=j*ga+z;return iv[Y]===0&&(S.emplaceBack(_a[2*Y+0],_a[2*Y+1],z*rt/ss,j*rt/ss),iv[Y]=++R),iv[Y]-1}function F(z,j,Y,X,K,le){let se=z+Y>>1,me=j+X>>1;if(Math.abs(z-K)+Math.abs(j-le)>1&&Ac[me*ga+se])F(K,le,z,j,se,me),F(Y,X,K,le,se,me);else{let _e=k(z,j),Te=k(Y,X),ke=k(K,le);D.emplaceBack(_e,Te,ke)}}return F(0,0,ss,ss,ss,0),F(ss,ss,0,0,0,ss),{vertices:S,indices:D}}(this.tileID.canonical,r);u=p.vertices,d=p.indices}else{u=new pc,d=new Qi;for(let{x:_,y}of a)u.emplaceBack(_,y,0,0);let p=ig(u.int16,void 0,4);for(let _=0;_<p.length;_+=3)d.emplaceBack(p[_],p[_+1],p[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,rv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=mi.simpleSegment(0,0,u.length,d.length)}_makeGlobeTileDebugBuffers(e,r){let a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;let u=this.tileID.canonical,d=tg(fM(u,r)),p=ul(r.zoom),_;p>0&&(_=i.ad.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,r,d,_,p),this._makeGlobeTileDebugTextBuffer(e,u,r,d,_,p)}_globePoint(e,r,a,u,d,p,_){let y=eg(e,r,a);if(p){let b=1<<a.z,E=da(u.center.lng),S=fa(u.center.lat),D=(a.x+.5)/b-E,R=0;D>.5?R=-1:D<-.5&&(R=1);let k=(e/rt+a.x)/b+R,F=(r/rt+a.y)/b;k=(k-E)*u._pixelsPerMercatorPixel+E,F=(F-S)*u._pixelsPerMercatorPixel+S;let z=[k*u.worldSize,F*u.worldSize,0];i._.transformMat4(z,z,p),y=cl(y,z,_)}return i._.transformMat4(y,y,d)}_makeGlobeTileDebugBorderBuffer(e,r,a,u,d,p){let _=new Es,y=new Wm,b=new f0,E=(D,R,k,F,z)=>{let j=(k-D)/(z-1),Y=(F-R)/(z-1),X=_.length;for(let K=0;K<z;K++){let le=D+K*j,se=R+K*Y;_.emplaceBack(le,se);let me=this._globePoint(le,se,r,a,u,d,p);b.emplaceBack(me[0],me[1],me[2]),y.emplaceBack(X+K)}},S=rt;E(0,0,S,0,16),E(S,0,S,S,16),E(S,S,0,S,16),E(0,S,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(_,Jm.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,hM.members),this._tileDebugSegments=mi.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugTextBuffer(e,r,a,u,d,p){let _=rt/4,y=new Es,b=new Qi,E=new f0,S=25;b.reserve(32),y.reserve(S),E.reserve(S);let D=(R,k)=>S*R+k;for(let R=0;R<S;R++){let k=R*_;for(let F=0;F<S;F++){let z=F*_;y.emplaceBack(z,k);let j=this._globePoint(z,k,r,a,u,d,p);E.emplaceBack(j[0],j[1],j[2])}}for(let R=0;R<4;R++)for(let k=0;k<4;k++){let F=D(R,k),z=D(R,k+1),j=D(R+1,k),Y=D(R+1,k+1);b.emplaceBack(F,z,j),b.emplaceBack(j,z,Y)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(y,Jm.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,hM.members),this._tileDebugTextSegments=mi.simpleSegment(0,0,S,32)}destroy(e=!1){for(let r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof os&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Gt={read:function(t,e){return t.readFields(Gt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,r){t===1?e.header_length=r.readFixed32():t===2?e.x=r.readVarint():t===3?e.y=r.readVarint():t===4?e.z=r.readVarint():t===5&&e.layers.push(Gt.Layer.read(r,r.readVarint()+r.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Gt.Filter.read=function(t,e){return t.readFields(Gt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Gt.Filter._readField=function(t,e,r){t===1?(e.delta_filter=Gt.Filter.Delta.read(r,r.readVarint()+r.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Gt.Filter.Zigzag.read(r,r.readVarint()+r.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Gt.Filter.BitShuffle.read(r,r.readVarint()+r.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Gt.Filter.ByteShuffle.read(r,r.readVarint()+r.pos),e.filter="byteshuffle_filter")},Gt.Filter.Delta={},Gt.Filter.Delta.read=function(t,e){return t.readFields(Gt.Filter.Delta._readField,{block_size:0},e)},Gt.Filter.Delta._readField=function(t,e,r){t===1&&(e.block_size=r.readVarint())},Gt.Filter.Zigzag={},Gt.Filter.Zigzag.read=function(t,e){return t.readFields(Gt.Filter.Zigzag._readField,{},e)},Gt.Filter.Zigzag._readField=function(t,e,r){},Gt.Filter.BitShuffle={},Gt.Filter.BitShuffle.read=function(t,e){return t.readFields(Gt.Filter.BitShuffle._readField,{},e)},Gt.Filter.BitShuffle._readField=function(t,e,r){},Gt.Filter.ByteShuffle={},Gt.Filter.ByteShuffle.read=function(t,e){return t.readFields(Gt.Filter.ByteShuffle._readField,{},e)},Gt.Filter.ByteShuffle._readField=function(t,e,r){},Gt.Codec={},Gt.Codec.read=function(t,e){return t.readFields(Gt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Gt.Codec._readField=function(t,e,r){t===1?(e.gzip_data=Gt.Codec.GzipData.read(r,r.readVarint()+r.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Gt.Codec.JpegImage.read(r,r.readVarint()+r.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Gt.Codec.WebpImage.read(r,r.readVarint()+r.pos),e.codec="webp_image"):t===4&&(e.png_image=Gt.Codec.PngImage.read(r,r.readVarint()+r.pos),e.codec="png_image")},Gt.Codec.GzipData={},Gt.Codec.GzipData.read=function(t,e){return t.readFields(Gt.Codec.GzipData._readField,{},e)},Gt.Codec.GzipData._readField=function(t,e,r){},Gt.Codec.JpegImage={},Gt.Codec.JpegImage.read=function(t,e){return t.readFields(Gt.Codec.JpegImage._readField,{},e)},Gt.Codec.JpegImage._readField=function(t,e,r){},Gt.Codec.WebpImage={},Gt.Codec.WebpImage.read=function(t,e){return t.readFields(Gt.Codec.WebpImage._readField,{},e)},Gt.Codec.WebpImage._readField=function(t,e,r){},Gt.Codec.PngImage={},Gt.Codec.PngImage.read=function(t,e){return t.readFields(Gt.Codec.PngImage._readField,{},e)},Gt.Codec.PngImage._readField=function(t,e,r){},Gt.DataIndexEntry={},Gt.DataIndexEntry.read=function(t,e){return t.readFields(Gt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Gt.DataIndexEntry._readField=function(t,e,r){t===1?e.first_byte=r.readFixed64():t===2?e.last_byte=r.readFixed64():t===3?e.filters.push(Gt.Filter.read(r,r.readVarint()+r.pos)):t===4?e.codec=Gt.Codec.read(r,r.readVarint()+r.pos):t===5?e.offset=r.readFloat():t===6?e.scale=r.readFloat():t===7&&e.bands.push(r.readString())},Gt.Layer={},Gt.Layer.read=function(t,e){return t.readFields(Gt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Gt.Layer._readField=function(t,e,r){t===1?e.version=r.readVarint():t===2?e.name=r.readString():t===3?e.units=r.readString():t===4?e.tilesize=r.readVarint():t===5?e.buffer=r.readVarint():t===6?e.pixel_format=r.readVarint():t===7&&e.data_index.push(Gt.DataIndexEntry.read(r,r.readVarint()+r.pos))};let As={read:function(t,e){return t.readFields(As._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,r){t===2?(e.uint32_values=As.Uint32Values.read(r,r.readVarint()+r.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=As.Fixed32Values.read(r,r.readVarint()+r.pos),e.values="fixed32_values")},Uint32Values:{}};As.Uint32Values.read=function(t,e){return t.readFields(As.Uint32Values._readField,{values:[]},e)},As.Uint32Values._readField=function(t,e,r){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let u=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(a),d=a.pos;return a.pos=u,function(p){a.pos=d;let _=0;for(;a.pos<u;){let y=a.readVarint();p[_++]=y}return p}}(r))},As.Fixed32Values={},As.Fixed32Values.read=function(t,e){return t.readFields(As.Fixed32Values._readField,{values:[]},e)},As.Fixed32Values._readField=function(t,e,r){throw new Error("Not implemented")};class z4{constructor(e=0,r=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=r}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let r=this.items[e];delete this.items[e],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}return this}entries(e=this.keys()){return e.map(r=>[r,this.get(r)])}evict(e=!1){if(e||this.size>0){let r=this.first;delete this.items[r.key],--this.size==0?(this.first=null,this.last=null):(this.first=r.next,this.first.prev=null)}return this}expiresAt(e){let r;return this.has(e)&&(r=this.items[e].expiry),r}get(e){let r;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(r=a.value,this.set(e,r,!0))}return r}has(e){return e in this.items}keys(){let e=[],r=this.first;for(;r!==null;)e.push(r.key),r=r.next;return e}set(e,r,a=!1,u=this.resetTtl){let d;if(a||this.has(e)){if(d=this.items[e],d.value=r,a===!1&&u&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){let p=this.last,_=d.next,y=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,p.next=d,y!==null&&(y.next=_),_!==null&&(_.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:r},++this.size==1?this.first=d:this.last.next=d;return this.last=d,this}values(e=this.keys()){return e.map(r=>this.get(r))}}function B4(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let a=2;a>=1;a--){let u=a===1?1:0,d=a===2?1:0;for(let p=0;p<e[0];p++){let _=e[1]*p;for(let y=u;y<e[1];y++){let b=e[2]*(y+_);for(let E=d;E<e[2];E++){let S=e[3]*(E+b);for(let D=0;D<e[3];D++){let R=S+D;t[R]+=t[R-r]}}}}r*=e[a]}return t}function V4(t){for(let e=0,r=t.length;e<r;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function j4(t,e){switch(e){case"uint32":return t;case"uint16":for(let r=0;r<t.length;r+=2){let a=t[r],u=t[r+1];t[r]=(240&a)>>4|(61440&a)>>8|(240&u)<<4|61440&u,t[r+1]=15&a|(3840&a)>>4|(15&u)<<8|(3840&u)<<4}return t;case"uint8":for(let r=0;r<t.length;r+=4){let a=t[r],u=t[r+1],d=t[r+2],p=t[r+3];t[r+0]=(192&a)>>6|(192&u)>>4|(192&d)>>2|192&p,t[r+1]=(48&a)>>4|(48&u)>>2|48&d|(48&p)<<2,t[r+2]=(12&a)>>2|12&u|(12&d)<<2|(12&p)<<4,t[r+3]=3&a|(3&u)<<2|(3&d)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Pc extends Error{constructor(e){super(e),this.name="MRTError"}}var No=Uint8Array,If=Uint16Array,U4=Int32Array,c2=new No([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u2=new No([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$4=new No([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h2=function(t,e){for(var r=new If(31),a=0;a<31;++a)r[a]=e+=1<<t[a-1];var u=new U4(r[30]);for(a=1;a<30;++a)for(var d=r[a];d<r[a+1];++d)u[d]=d-r[a]<<5|a;return{b:r,r:u}},d2=h2(c2,2),f2=d2.b,G4=d2.r;f2[28]=258,G4[258]=28;for(var H4=h2(u2,0).b,sT=new If(32768),Fi=0;Fi<32768;++Fi){var Cf=(43690&Fi)>>1|(21845&Fi)<<1;sT[Fi]=((65280&(Cf=(61680&(Cf=(52428&Cf)>>2|(13107&Cf)<<2))>>4|(3855&Cf)<<4))>>8|(255&Cf)<<8)>>1}var vg=function(t,e,r){for(var a=t.length,u=0,d=new If(e);u<a;++u)t[u]&&++d[t[u]-1];var p,_=new If(e);for(u=1;u<e;++u)_[u]=_[u-1]+d[u-1]<<1;if(r){p=new If(1<<e);var y=15-e;for(u=0;u<a;++u)if(t[u])for(var b=u<<4|t[u],E=e-t[u],S=_[t[u]-1]++<<E,D=S|(1<<E)-1;S<=D;++S)p[sT[S]>>y]=b}else for(p=new If(a),u=0;u<a;++u)t[u]&&(p[u]=sT[_[t[u]-1]++]>>15-t[u]);return p},xg=new No(288);for(Fi=0;Fi<144;++Fi)xg[Fi]=8;for(Fi=144;Fi<256;++Fi)xg[Fi]=9;for(Fi=256;Fi<280;++Fi)xg[Fi]=7;for(Fi=280;Fi<288;++Fi)xg[Fi]=8;var p2=new No(32);for(Fi=0;Fi<32;++Fi)p2[Fi]=5;var q4=vg(xg,9,1),W4=vg(p2,5,1),aT=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Ps=function(t,e,r){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&r},lT=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},Z4=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Rs=function(t,e,r){var a=new Error(e||Z4[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,Rs),!r)throw a;return a},Y4=new No(0),X4=typeof TextDecoder<"u"&&new TextDecoder;try{X4.decode(Y4,{stream:!0})}catch{}let K4={gzip_data:"gzip"},Q4={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},J4={uint32:1,uint16:2,uint8:4},eV={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class cT{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let r=new Uint8Array(e),a=new DataView(e);if(r[0]!==13)throw new Pc("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let r=new Uint8Array(e),a=this.getHeaderLength(e);if(r.length<a)throw new Pc(`Expected header with length >= ${a} but got buffer of length ${r.length}`);let u=new _f(r.subarray(0,a)),d=Gt.read(u);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Pc(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let p of d.layers)this.layers[p.name]=new tV(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let r=[],a=this.getLayer(e.layerName);for(let u=0;u<a.dataIndex.length;u++){let d=a.dataIndex[u],p=d.first_byte-e.firstByte,_=d.last_byte+1-e.firstByte;if(u<e.firstBlock||u>e.lastBlock||a._blocksInProgress.has(u))continue;let y={layerName:a.name,firstByte:p,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:u,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(b=>b.filter)};a._blocksInProgress.add(u),r.push(y)}return new m2(r,()=>{r.forEach(u=>a._blocksInProgress.delete(u.blockIndex))},(u,d)=>{if(r.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),u)throw u;d.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class tV{constructor({version:e,name:r,units:a,tilesize:u,pixel_format:d,buffer:p,data_index:_},y){if(this.version=e,this.version!==1)throw new Pc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=a,this.tileSize=u,this.buffer=p,this.pixelFormat=Q4[d],this.dataIndex=_,this.bandShape=[u+2*p,u+2*p,J4[this.pixelFormat]],this._decodedBlocks=function(b=1e3,E=0,S=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(E)||E<0)throw new TypeError("Invalid ttl value");if(typeof S!="boolean")throw new TypeError("Invalid resetTtl value");return new z4(b,E,S)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.set(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(let[a,u]of this.dataIndex.entries()){for(let[d,p]of u.bands.entries())if(p===e)return{bandIndex:r+d,blockIndex:a,blockBandIndex:d};r+=u.bands.length}break;case"number":for(let[a,u]of this.dataIndex.entries()){if(e>=r&&e<r+u.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-r};r+=u.bands.length}break;default:throw new Pc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Pc(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,a=-1/0,u=1/0,d=-1/0;for(let p of e){let{blockIndex:_}=this.getBlockForBand(p);if(_<0)throw new Pc(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[_];u=Math.min(u,_),d=Math.max(d,_),r=Math.min(r,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:r,lastByte:a,firstBlock:u,lastBlock:d}}hasBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){let{blockIndex:r,blockBandIndex:a}=this.getBlockForBand(e),u=this._decodedBlocks.get(r.toString());if(!u)throw new Pc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let d=this.dataIndex[r],p=this.bandShape.reduce((b,E)=>b*E,1),_=a*p,y=u.subarray(_,_+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class m2{constructor(e,r,a){this.tasks=e,this._onCancel=r,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}cT.performDecoding=function(t,e){return Promise.all(e.tasks.map(r=>{let{layerName:a,firstByte:u,lastByte:d,pixelFormat:p,blockShape:_,blockIndex:y,filters:b,codec:E}=r,S=new Uint8Array(t).subarray(u,d+1),D=new Uint32Array(_[0]*_[1]*_[2]),R;if(E!=="gzip_data")throw new Error(`Unhandled codec: ${E}`);return R=function(k,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((X=function(se){se[0]==31&&se[1]==139&&se[2]==8||Rs(6,"invalid gzip data");var me=se[3],_e=10;4&me&&(_e+=2+(se[10]|se[11]<<8));for(var Te=(me>>3&1)+(me>>4&1);Te>0;Te-=!se[_e++]);return _e+(2&me)}(Y=k))+8>Y.length&&Rs(6,"invalid gzip data"),function(se,me,_e,Te){var ke=se.length;if(!ke||me.f&&!me.l)return _e||new No(0);var De=!_e,ze=De||me.i!=2,Ye=me.i;De&&(_e=new No(3*ke));var Le,qe,Oe=function(kc){var Oc=_e.length;if(kc>Oc){var bh=new No(Math.max(2*Oc,kc));bh.set(_e),_e=bh}},We=me.f||0,Je=me.p||0,Ze=me.b||0,ht=me.l,Xe=me.d,nt=me.m,Et=me.n,xt=8*ke;do{if(!ht){We=Ps(se,Je,1);var _t=Ps(se,Je+1,3);if(Je+=3,!_t){var et=se[(mn=4+((Je+7)/8|0))-4]|se[mn-3]<<8,It=mn+et;if(It>ke){Ye&&Rs(0);break}ze&&Oe(Ze+et),_e.set(se.subarray(mn,It),Ze),me.b=Ze+=et,me.p=Je=8*It,me.f=We;continue}if(_t==1)ht=q4,Xe=W4,nt=9,Et=5;else if(_t==2){var Wt=Ps(se,Je,31)+257,Pt=Ps(se,Je+10,15)+4,Xt=Wt+Ps(se,Je+5,31)+1;Je+=14;for(var Zt=new No(Xt),sn=new No(19),Dt=0;Dt<Pt;++Dt)sn[$4[Dt]]=Ps(se,Je+3*Dt,7);Je+=3*Pt;var Un=aT(sn),Vn=(1<<Un)-1,Cn=vg(sn,Un,1);for(Dt=0;Dt<Xt;){var mn,Sn=Cn[Ps(se,Je,Vn)];if(Je+=15&Sn,(mn=Sn>>4)<16)Zt[Dt++]=mn;else{var Jn=0,Wn=0;for(mn==16?(Wn=3+Ps(se,Je,3),Je+=2,Jn=Zt[Dt-1]):mn==17?(Wn=3+Ps(se,Je,7),Je+=3):mn==18&&(Wn=11+Ps(se,Je,127),Je+=7);Wn--;)Zt[Dt++]=Jn}}var Ei=Zt.subarray(0,Wt),_i=Zt.subarray(Wt);nt=aT(Ei),Et=aT(_i),ht=vg(Ei,nt,1),Xe=vg(_i,Et,1)}else Rs(1);if(Je>xt){Ye&&Rs(0);break}}ze&&Oe(Ze+131072);for(var Mr=(1<<nt)-1,Si=(1<<Et)-1,hi=Je;;hi=Je){var Ui=(Jn=ht[lT(se,Je)&Mr])>>4;if((Je+=15&Jn)>xt){Ye&&Rs(0);break}if(Jn||Rs(2),Ui<256)_e[Ze++]=Ui;else{if(Ui==256){hi=Je,ht=null;break}var ar=Ui-254;Ui>264&&(ar=Ps(se,Je,(1<<(Kr=c2[Dt=Ui-257]))-1)+f2[Dt],Je+=Kr);var lr=Xe[lT(se,Je)&Si],Yn=lr>>4;if(lr||Rs(3),Je+=15&lr,_i=H4[Yn],Yn>3){var Kr=u2[Yn];_i+=lT(se,Je)&(1<<Kr)-1,Je+=Kr}if(Je>xt){Ye&&Rs(0);break}ze&&Oe(Ze+131072);var fl=Ze+ar;if(Ze<_i){var as=0-_i,Os=Math.min(_i,fl);for(as+Ze<0&&Rs(3);Ze<Os;++Ze)_e[Ze]=(void 0)[as+Ze]}for(;Ze<fl;++Ze)_e[Ze]=_e[Ze-_i]}}me.l=ht,me.p=hi,me.b=Ze,me.f=We,ht&&(We=1,me.m=nt,me.d=Xe,me.n=Et)}while(!We);return Ze!=_e.length&&De?(Le=_e,((qe=Ze)==null||qe>Le.length)&&(qe=Le.length),new No(Le.subarray(0,qe))):_e.subarray(0,Ze)}(Y.subarray(X,-8),{i:2},new No(((z=Y)[(j=z.length)-4]|z[j-3]<<8|z[j-2]<<16|z[j-1]<<24)>>>0))));var z,j,Y,X;let K=K4[F];if(!K)throw new Error(`Unhandled codec: ${F}`);let le=new globalThis.DecompressionStream(K);return new Response(new Blob([k]).stream().pipeThrough(le)).arrayBuffer().then(se=>new Uint8Array(se))}(S,E).then(k=>{let F=As.read(new _f(k));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(D),new eV[p](D.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),R.then(k=>{for(let F=b.length-1;F>=0;F--)switch(b[F]){case"delta_filter":B4(k,_);break;case"zigzag_filter":V4(k);break;case"bitshuffle_filter":j4(k,p);break;default:throw new Error(`Unhandled filter "${b[F]}"`)}return{layerName:a,blockIndex:y,data:k}}).catch(k=>{throw k})}))};class g2 extends ov{constructor(e,r,a,u,d){super(e,r,a,u,d),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,r){let a=r.context,u=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture&&this.texture instanceof os?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new os(a,e,u.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,r){let a=this._mrt=new cT(30),u=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=qa(u,(d,p,_,y)=>{if(d)r(d);else try{let b=a.getHeaderLength(p);if(b>e)return void(this.request=this.fetchHeader(b,r));a.parseHeader(p),this._isHeaderLoaded=!0;let E=0;for(let S of Object.values(a.layers))E=Math.max(E,S.dataIndex[S.dataIndex.length-1].last_byte);p.byteLength>=E&&(this.entireBuffer=p),r(null,this.entireBuffer||p,_,y)}catch(b){r(b)}}),this.request}fetchBand(e,r,a){let u=this._mrt;if(!this._isHeaderLoaded||!u)return void a(new Error("Tile header is not ready"));let d=this.actor;if(!d)return void a(new Error("Can't fetch tile band without an actor"));let p,_=(S,D)=>{p.complete(S,D),S?a(S):(this.updateTextureDescriptor(e,r),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(S,D)=>{if(S)return a(S);let R=d.send("decodeRasterArray",{buffer:D,task:p},_,void 0,!0);this._workQueue.push(()=>{R&&R.cancel(),p.cancel()})},b=u.getLayer(e);if(!b)return void a(new Error(`Unknown sourceLayer "${e}"`));if(b.hasDataForBand(r))return this.updateTextureDescriptor(e,r),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let E=b.getDataRange([r]);if(p=u.createDecodingTask(E),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(E.firstByte,E.lastByte+1));else{let S=Object.assign({},this.requestParams,{headers:{Range:`bytes=${E.firstByte}-${E.lastByte}`}}),D=qa(S,y);this._fetchQueue.push(()=>{D.cancel(),p.cancel()})}else a(null)}updateNeeded(e,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,r){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(r)||!a.hasDataForBand(r))return;let{bytes:u,tileSize:d,buffer:p,offset:_,scale:y}=a.getBandView(r),b=d+2*p,E={data:u,width:b,height:b},S=this.texture;S&&S instanceof os&&S.update(E,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:r,img:E,buffer:p,offset:_,tileSize:d,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class nV{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(let e in this.data)for(let r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){let u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);let d={value:r,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){let r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;let a=e.wrapped().key,u=r===void 0?0:this.data[a].indexOf(r),d=this.data[a][u];return this.data[a].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){let r=[];for(let a in this.data)for(let u of this.data[a])e(u.value)||r.push(u);for(let a of r)this.remove(a.value.tileID,a)}}class _h extends Za{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new nV(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new o4,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let r=this._tiles[e];if(r.state!=="errored"&&(r.state!=="loaded"||!r.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let r in this._tiles){let a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return mo(this._tiles).map(e=>e.tileID).sort(_2).map(e=>e.key)}getRenderableIds(e,r){let a=[];for(let u in this._tiles)this._isIdRenderable(+u,e,r)&&a.push(this._tiles[u]);return e?a.sort((u,d)=>{let p=u.tileID,_=d.tileID,y=new lt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new lt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||b.y-y.y||b.x-y.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(_2).map(u=>u.key)}hasRenderableParent(e){let r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Fd(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Fr("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=rr.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Fr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let r=this.getRenderableIds();for(let u=0;u<r.length;u++){let d=r[u];if(e.neighboringTiles&&e.neighboringTiles[d]){let p=this.getTileByID(d);a(e,p),a(p,e)}}function a(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let p=d.tileID.canonical.x-u.tileID.canonical.x,_=d.tileID.canonical.y-u.tileID.canonical.y,y=Math.pow(2,u.tileID.canonical.z),b=d.tileID.key;p===0&&_===0||Math.abs(_)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,p,_),u.neighboringTiles&&u.neighboringTiles[b]&&(u.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,u){for(let d in this._tiles){let p=this._tiles[d];if(u[d]||!p.hasData()||p.tileID.overscaledZ<=r||p.tileID.overscaledZ>a)continue;let _=p.tileID;for(;p&&p.tileID.overscaledZ>r+1;){let b=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[b.key],p&&p.hasData()&&(_=b)}let y=_;for(;y.overscaledZ>r;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){u[_.key]=_;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){let u=e.scaledTo(a),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){let r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;let a=Math.ceil(e.width/r)+1,u=Math.ceil(e.height/r)+1,d=Math.floor(a*u*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(_)}handleWrapJump(e){let r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){let a={};for(let u in this._tiles){let d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),a[d.tileID.key]=d}this._tiles=a;for(let u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(let u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,r,a,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Hi(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,d=y.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(d.push(new Hi(1,0,1,0,0)),d.push(new Hi(1,0,1,1,0)),d.push(new Hi(1,0,1,0,1)),d.push(new Hi(1,0,1,1,1)))}else if(d=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);d=d.filter(b=>y(b))}}else d=[];if(d.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!uT(this._source.type)){let y=e.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),b=Math.min(y,this._source.maxzoom),E=e.extendTileCoverForShadows(d,u,b);for(let S of E)this._shadowCasterTiles[S.key]=!0,d.push(S)}let p=this._updateRetainedTiles(d);if(uT(this._source.type)&&d.length!==0){let y={},b={},E=Object.keys(p);for(let D of E){let R=p[D],k=this._tiles[D];if(!k||k.fadeEndTime&&k.fadeEndTime<=rr.now())continue;let F=this.findLoadedParent(R,Math.max(R.overscaledZ-_h.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),b[D]=R}let S=d[d.length-1].overscaledZ;for(let D in this._tiles){let R=this._tiles[D];if(p[D]||!R.hasData())continue;let k=R.tileID;for(;k.overscaledZ>S;){k=k.scaledTo(k.overscaledZ-1);let F=this._tiles[k.key];if(F&&F.hasData()&&b[k.key]){p[D]=R.tileID;break}}}for(let D in y)p[D]||(this._coveredTiles[D]=!0,p[D]=y[D])}for(let y in p)this._tiles[y].clearFadeHold();let _=function(y,b){let E=[];for(let S in y)S in b||E.push(S);return E}(this._tiles,p);for(let y of _){let b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let r={};if(e.length===0)return r;let a={},u=e.reduce((b,E)=>Math.min(b,E.overscaledZ),1/0),d=e[0].overscaledZ,p=Math.max(d-_h.maxOverzooming,this._source.minzoom),_=Math.max(d+_h.maxUnderzooming,this._source.minzoom),y={};for(let b of e){let E=this._addTile(b);r[b.key]=b,E.hasData()||u<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,u,_,r);for(let b of e){let E=this._tiles[b.key];if(E.hasData())continue;if(b.canonical.z>=this._source.maxzoom){let D=b.children(this._source.maxzoom)[0],R=this.getTile(D);if(R&&R.hasData()){r[D.key]=D;continue}}else{let D=b.children(this._source.maxzoom);if(r[D[0].key]&&r[D[1].key]&&r[D[2].key]&&r[D[3].key])continue}let S=E.wasRequested();for(let D=b.overscaledZ-1;D>=p;--D){let R=b.scaledTo(D);if(a[R.key]||(a[R.key]=!0,E=this.getTile(R),!E&&S&&(E=this._addTile(R)),E&&(r[R.key]=R,S=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let r=[],a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}r.push(u.key);let d=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;u=d}for(let d of r)this._loadedParentTiles[d]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));let a=!!r;if(!a){let u=this.map?this.map.painter:null,d=this._source.tileSize*e.overscaleFactor();r=this._source.type==="raster-array"?new g2(e,d,this.transform.tileZoom,u,this._isRaster):new ov(e,d,this.transform.tileZoom,u,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new Fr("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){let u=[],d=this.transform;if(!d)return u;let p=d.projection.name==="globe",_=da(d.center.lng);for(let y in this._tiles){let b=this._tiles[y];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let E;if(p){let S=b.tileID.canonical;if(S.z===0){let D=[Math.abs(Jt(_,...bg(S,-1))-_),Math.abs(Jt(_,...bg(S,1))-_)];E=[0,2*D.indexOf(Math.min(...D))-1]}else{let D=[Math.abs(Jt(_,...bg(S,-1))-_),Math.abs(Jt(_,...bg(S,0))-_),Math.abs(Jt(_,...bg(S,1))-_)];E=[D.indexOf(Math.min(...D))-1]}}else E=[0];for(let S of E){let D=e.containsTile(b,d,r,S);D&&u.push(D)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,r){let a=this.getRenderableIds(e,r).map(d=>this._tiles[d].tileID),u=this.transform.projection.name==="globe";for(let d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=u?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){let r=e.slice(),a=this.transform._camera.position,u=this.transform._camera.forward(),d={};for(let p of r){let _=1/(1<<p.canonical.z);d[p.key]=((p.canonical.x+.5)*_+p.wrap-a[0])*u[0]+((p.canonical.y+.5)*_-a[1])*u[1]-a[2]*u[2]}return r.sort((p,_)=>d[p.key]-d[_.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(uT(this._source.type))for(let e in this._tiles){let r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=rr.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){let u=this._tiles[e];u&&u.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(let a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){let _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,r))};return void this._source.on("data",_)}let a=new Map,u=Array.isArray(e)?e:[e],d=this.map.painter.terrain,p=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(let _ of u){let y=_.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let b of y)a.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}Hl(Array.from(a.values()),(_,y)=>{let b=new ov(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,E=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),y(E,b)})},r)}}function _2(t,e){let r=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function uT(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function bg(t,e){let r=1<<t.z;return[t.x/r+e,(t.x+1)/r+e]}_h.maxOverzooming=10,_h.maxUnderzooming=3;let y2=new class extends ut{possiblyEvaluate(t,e){return e=new jt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,a){return e=_r({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,a)}}(j0.paint.properties["line-width"].specification);function v2(t,e){return e>0?e+2*t:t}y2.useIntegerZoom=!0;let iV=new On({"symbol-placement":new Be(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new Be(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Be(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Be(Ee.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Be(Ee.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Be(Ee.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Be(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new Be(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Be(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(Ee.layout_symbol["icon-size"]),"icon-text-fit":new ut(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(Ee.layout_symbol["icon-image"]),"icon-rotate":new ut(Ee.layout_symbol["icon-rotate"]),"icon-padding":new Be(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new Be(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(Ee.layout_symbol["icon-offset"]),"icon-anchor":new ut(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Be(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Be(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Be(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new ut(Ee.layout_symbol["text-field"]),"text-font":new ut(Ee.layout_symbol["text-font"]),"text-size":new ut(Ee.layout_symbol["text-size"]),"text-max-width":new ut(Ee.layout_symbol["text-max-width"]),"text-line-height":new ut(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new ut(Ee.layout_symbol["text-justify"]),"text-radial-offset":new ut(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Be(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new ut(Ee.layout_symbol["text-anchor"]),"text-max-angle":new Be(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new Be(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new ut(Ee.layout_symbol["text-rotate"]),"text-padding":new Be(Ee.layout_symbol["text-padding"]),"text-keep-upright":new Be(Ee.layout_symbol["text-keep-upright"]),"text-transform":new ut(Ee.layout_symbol["text-transform"]),"text-offset":new ut(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new Be(Ee.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Be(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new Be(Ee.layout_symbol["text-optional"]),visibility:new Be(Ee.layout_symbol.visibility)});var hT={paint:new On({"icon-opacity":new ut(Ee.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ut(Ee.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ut(Ee.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ut(Ee.paint_symbol["text-emissive-strength"]),"icon-color":new ut(Ee.paint_symbol["icon-color"]),"icon-halo-color":new ut(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new Be(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new Be(Ee.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Ee.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ut(Ee.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ut(Ee.paint_symbol["text-occlusion-opacity"]),"text-color":new ut(Ee.paint_symbol["text-color"],{runtimeType:Nr,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ut(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new ut(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(Ee.paint_symbol["text-halo-blur"]),"text-translate":new Be(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new Be(Ee.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Be(Ee.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Be(Ee.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Be(Ee.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Be(Ee.paint_symbol["icon-color-brightness-max"])}),layout:iV};class x2{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:tc,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}J(x2,"FormatSectionOverride",{omit:["defaultValue"]});class sv extends xr{constructor(e,r,a,u){super(e,hT,r,a,u),this._colorAdjustmentMatrix=i.ad.identity([])}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let u=[];for(let d of a)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,a,u){return this._saturation===e&&this._contrast===r&&this._brightnessMin===a&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(d,p,_,y){d=Cd(d),p=Id(p);let b=i.ad.create(),E=d/3,S=1-2*E,D=[S,E,E,0,E,S,E,0,E,E,S,0,0,0,0,1],R=.5-.5*p,k=y-_;return i.ad.multiply(b,[k,0,0,0,0,k,0,0,0,0,k,0,_,_,_,1],[p,0,0,0,0,p,0,0,0,0,p,0,R,R,R,1]),i.ad.multiply(b,b,D),b}(e,r,a,u),this._saturation=e,this._contrast=r,this._brightnessMin=a,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,a,u){let d=this.layout.get(e).evaluate(r,{},a,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||N(p.value)||!d?d:function(_,y){return y.replace(/{([^{}]+)}/g,(b,E)=>E in _?String(_[E]):"")}(r.properties,d)}createBucket(e){return new Ef(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of hT.paint.overridableProperties){if(!sv.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),a=new x2(r),u=new O(a,r.property.specification,this.scope,this.options),d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new V("source",u):new G("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new ni(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&sv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let a=e.get("text-field"),u=hT.paint.properties[r],d=!1,p=_=>{for(let y of _)if(u.overrides&&u.overrides.hasOverride(y))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof yr)p(a.value.value.sections);else if(a.value.kind==="source"){let _=b=>{d||(b instanceof xs&&ji(b.value)===ic?p(b.value.sections):b instanceof $u?p(b.sections):b.eachChild(_))},y=a.value;y._styleExpression&&_(y._styleExpression.expression)}return d}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,r=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),r&&a.push("symbolSDF"),a}getDefaultProgramParams(e,r,a){return{config:new uh(this,{zoom:r,lut:a}),overrideFog:!1}}}let rV=new On({visibility:new Be(Ee.layout_background.visibility)});var oV={paint:new On({"background-color":new Be(Ee.paint_background["background-color"]),"background-pattern":new Be(Ee.paint_background["background-pattern"]),"background-opacity":new Be(Ee.paint_background["background-opacity"]),"background-emissive-strength":new Be(Ee.paint_background["background-emissive-strength"])}),layout:rV};let sV=new On({visibility:new Be(Ee.layout_raster.visibility)});var aV={paint:new On({"raster-opacity":new Be(Ee.paint_raster["raster-opacity"]),"raster-color":new Gi(Ee.paint_raster["raster-color"]),"raster-color-mix":new Be(Ee.paint_raster["raster-color-mix"]),"raster-color-range":new Be(Ee.paint_raster["raster-color-range"]),"raster-hue-rotate":new Be(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Be(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Be(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new Be(Ee.paint_raster["raster-saturation"]),"raster-contrast":new Be(Ee.paint_raster["raster-contrast"]),"raster-resampling":new Be(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new Be(Ee.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Be(Ee.paint_raster["raster-emissive-strength"]),"raster-array-band":new Be(Ee.paint_raster["raster-array-band"]),"raster-elevation":new Be(Ee.paint_raster["raster-elevation"])}),layout:sV};function av(t,e,r,a,u,d,p,_){let y=[t,e,1,r,a,1,u,d,1],b=[p,_,1],E=i.bC.adjoint([],y),[S,D,R]=i._.transformMat3(b,b,E);return i.bC.multiply(y,y,[S,0,0,0,D,0,0,0,R])}function b2(t,e,r,a,u,d,p,_){let y=function(b,E,S,D,R,k,F,z){let j=av(0,0,1,0,1,1,0,1),Y=av(b,E,S,D,R,k,F,z),X=i.bC.adjoint([],j);return i.bC.multiply(Y,Y,X)}(t,e,r,a,u,d,p,_);return[y[2]/y[8]/rt,y[5]/y[8]/rt]}function lv(t){return[t[0],Math.min(Math.max(t[1],-ki),ki)]}class w2 extends Za{constructor(e,r,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Fr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=na(this.map._requestManager.transformRequest(this.url,Pd.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Fd(a)):u&&(this.image=u instanceof HTMLImageElement?rr.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new nv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Fr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof nv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],a=e[0][1];for(let d of e)d[1]>a&&(a=d[1]),d[1]<r&&(r=d[1]);let u=(a+r)/2;if(u>ki?this.onNorthPole=!0:u<-ki&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let d=e.map(Dr.fromLngLat);this.tileID=function(p){let _=1/0,y=1/0,b=-1/0,E=-1/0;for(let F of p)_=Math.min(_,F.x),y=Math.min(y,F.y),b=Math.max(b,F.x),E=Math.max(E,F.y);let S=Math.max(b-_,E-y),D=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),R=Math.pow(2,D),k=Math.floor((_+b)/2*R);return k>1&&(k-=1),new dh(D,k,Math.floor((y+E)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Fr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let z in this.tiles){let j=this.tiles[z];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let r=gh(new dh(0,0,0),this.map.transform.projection),a=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(z){let j=z[1].x-z[0].x,Y=z[1].y-z[0].y,X=z[2].x-z[1].x,K=z[2].y-z[1].y,le=z[3].x-z[2].x,se=z[3].y-z[2].y,me=z[0].x-z[3].x,_e=z[0].y-z[3].y,Te=j*K-X*Y,ke=X*se-le*K,De=le*_e-me*se,ze=me*Y-j*_e;return Te>0&&ke>0&&De>0&&ze>0||Te<0&&ke<0&&De<0&&ze<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let u=gh(this.tileID,this.map.transform.projection),[d,p,_,y]=this.coordinates.map(z=>{let j=u.projection.project(z[0],z[1]);return t2(u,j)._round()});this.perspectiveTransform=b2(d.x,d.y,p.x,p.y,_.x,_.y,y.x,y.y);let b=this._boundsArray=new pc;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(p.x,p.y,rt,0),b.emplaceBack(y.x,y.y,0,rt),b.emplaceBack(_.x,_.y,rt,rt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,rv.members),this.boundsSegments=mi.simpleSegment(0,0,4,2);let E=[],S=function(z){return[lv(z[0]),lv(z[1]),lv(z[2]),lv(z[3])]}(this.coordinates),[D,R,k,F]=function(z){let j=z[0][0],Y=j,X=z[0][1],K=X;for(let le=1;le<z.length;le++)z[le][0]<j?j=z[le][0]:z[le][0]>Y&&(Y=z[le][0]),z[le][1]<X?X=z[le][1]:z[le][1]>K&&(K=z[le][1]);return[j,X,Y-j,K-X]}(S);{let z=new pc,[j,Y,X,K]=function(Oe){let We=Oe[0].x,Je=We,Ze=Oe[0].y,ht=Ze;for(let Xe=1;Xe<Oe.length;Xe++)Oe[Xe].x<We?We=Oe[Xe].x:Oe[Xe].x>Je&&(Je=Oe[Xe].x),Oe[Xe].y<Ze?Ze=Oe[Xe].y:Oe[Xe].y>ht&&(ht=Oe[Xe].y);return[We,Ze,Je-We,ht-Ze]}(a),le=Oe=>[(Oe.x-j)/X,(Oe.y-Y)/K],[se,me,_e,Te]=a.map(le),ke=function(Oe,We,Je,Ze,ht,Xe,nt,Et){let xt=av(0,0,1,0,1,1,0,1),_t=av(Oe,We,Je,Ze,ht,Xe,nt,Et),et=i.bC.adjoint([],_t);return i.bC.multiply(xt,xt,et)}(se[0],se[1],me[0],me[1],_e[0],_e[1],Te[0],Te[1]);this.elevatedGlobePerspectiveTransform=b2(se[0],se[1],me[0],me[1],_e[0],_e[1],Te[0],Te[1]);let De=(Oe,We)=>{E.push(Oe.lng);let Je=Math.round((Oe.lng-D)/k*rt),Ze=Math.round((Oe.lat-R)/F*rt),ht=le(We),Xe=i._.transformMat3([],[ht[0],ht[1],1],ke),nt=Math.round(Xe[0]/Xe[2]*rt),Et=Math.round(Xe[1]/Xe[2]*rt);z.emplaceBack(Je,Ze,nt,Et)},ze=a[3].x-a[0].x,Ye=a[3].y-a[0].y,Le=a[2].x-a[1].x,qe=a[2].y-a[1].y;for(let Oe=0;Oe<65;Oe++){let We=Oe/64,Je=[a[0].x+We*ze,a[0].y+We*Ye],Ze=[a[1].x+We*Le,a[1].y+We*qe],ht=Ze[0]-Je[0],Xe=Ze[1]-Je[1];for(let nt=0;nt<65;nt++){let Et=nt/64,xt={x:Je[0]+ht*Et,y:Je[1]+Xe*Et,z:0};De(r.projection.unproject(xt.x,xt.y),xt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(z,rv.members)}{this.maxLongitudeTriangleSize=0;let z=[],j=new Qi,Y=(X,K,le)=>{j.emplaceBack(X,K,le);let se=E[X],me=E[K],_e=E[le],Te=Math.min(Math.min(se,me),_e),ke=Math.max(Math.max(se,me),_e)-Te;ke>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ke),z.push(Te+ke/2)};for(let X=0;X<64;X++)for(let K=0;K<64;K++){let le=65*X+K,se=le+1,me=le+65,_e=me+1;Y(le,me,se),Y(se,me,_e)}[z,j]=function(X,K){let le=Array.from({length:X.length},(_e,Te)=>Te);le.sort((_e,Te)=>X[_e]-X[Te]);let se=[],me=new Qi;for(let _e=0;_e<le.length;_e++){let Te=le[_e];se.push(X[Te]);let ke=3*Te,De=ke+1;me.emplaceBack(K.uint16[ke],K.uint16[De],K.uint16[De+1])}return[se,me]}(z,j),this.elevatedGlobeTrianglesCenterLongitudes=z,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(j)}this.elevatedGlobeSegments=mi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/rt,0,F/rt,0,0,R,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let r=this.map.painter.context,a=r.gl;!this._dirty||this.texture instanceof nv||(this.texture?this.texture.update(this.image):(this.texture=new os(r,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,u=(d=e+180)+360*Math.round((a[0]-d)/360);var d;let p=new mi,_=(S,D)=>{p.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:r.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=y){let S=wy(a,0,a.length,u+y);return S===a.length||_(S,nm(a,S+1,a.length,u+360-y)-S),p}u<a[0]&&(u+=360);let b=nm(a,0,a.length,u-y);if(b===a.length)return _(0,a.length),p;_(0,b-0);let E=wy(a,b+1,a.length,u+y);return E!==a.length&&_(E,a.length-E),p}}let lV=(Math.pow(256,2)-1)/16907520;class T2 extends xr{constructor(e,r,a,u){super(e,aV,r,a,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof w2&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let r=this._transitionablePaint._values["raster-color"].value.expression,[a,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(u)||a===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=ng({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,u])}}let cV=new On({visibility:new Be(Ee["layout_raster-particle"].visibility)});var uV={paint:new On({"raster-particle-array-band":new Be(Ee["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Be(Ee["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Gi(Ee["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Be(Ee["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Be(Ee["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Be(Ee["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Be(Ee["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:cV};class E2 extends xr{constructor(e,r,a,u){super(e,uV,r,a,u),this._updateColorRamp(),this.lastInvalidatedAt=rr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ng({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=rr.now()}}class hV extends xr{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let dV=new On({visibility:new Be(Ee.layout_sky.visibility)});var fV={paint:new On({"sky-type":new Be(Ee.paint_sky["sky-type"]),"sky-atmosphere-sun":new Be(Ee.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Be(Ee.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Be(Ee.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Be(Ee.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gi(Ee.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Be(Ee.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Be(Ee.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Be(Ee.paint_sky["sky-opacity"])}),layout:dV};function dT(t,e,r){let a=[0,0,1],u=i.av.identity([]);return i.av.rotateY(u,u,r?-dn(t)+Math.PI:dn(t)),i.av.rotateX(u,u,-dn(e)),i._.transformQuat(a,a,u),i._.normalize(a,a)}var pV={paint:new On({})};function I2(t,e){let r=cv(t.projection,t.zoom,t.width,t.height),a=function(d,p,_,y,b){let E=new bn(_.lng-180*Rc,_.lat),S=new bn(_.lng+180*Rc,_.lat),D=d.project(E.lng,E.lat),R=d.project(S.lng,S.lat),k=-Math.atan2(R.y-D.y,R.x-D.x),F=Dr.fromLngLat(_);F.y=Jt(F.y,-1+Rc,1-Rc);let z=F.toLngLat(),j=d.project(z.lng,z.lat),Y=Dr.fromLngLat(z);Y.x+=Rc;let X=Y.toLngLat(),K=d.project(X.lng,X.lat),le=D2(K.x-j.x,K.y-j.y,k),se=Dr.fromLngLat(z);se.y+=Rc;let me=se.toLngLat(),_e=d.project(me.lng,me.lat),Te=D2(_e.x-j.x,_e.y-j.y,k),ke=Math.abs(le.x)/Math.abs(Te.y),De=i.ad.identity([]);i.ad.rotateZ(De,De,-k*(1-(b?0:y)));let ze=i.ad.identity([]);return i.ad.scale(ze,ze,[1,1-(1-ke)*y,1]),ze[4]=-Te.x/Te.y*y,i.ad.rotateZ(ze,ze,k),i.ad.multiply(ze,De,ze),ze}(t.projection,0,t.center,r,e),u=C2(t);return i.ad.scale(a,a,[u,u,1]),a}function C2(t){let e=t.projection,r=cv(t.projection,t.zoom,t.width,t.height),a=S2(e,t.center),u=S2(e,bn.convert(e.center));return Math.pow(2,a*r+(1-r)*u)}function cv(t,e,r,a,u=1/0){let d=t.range;if(!d)return 0;let p=Math.min(u,Math.max(r,a)),_=Math.log(p/1024)/Math.LN2;return Ua(d[0]+_,d[1]+_,e)}let Rc=1/4e4;function S2(t,e){let r=Jt(e.lat,-ki,ki),a=new bn(e.lng-180*Rc,r),u=new bn(e.lng+180*Rc,r),d=t.project(a.lng,r),p=t.project(u.lng,r),_=Dr.fromLngLat(a),y=Dr.fromLngLat(u),b=p.x-d.x,E=p.y-d.y,S=y.x-_.x,D=y.y-_.y,R=Math.sqrt((S*S+D*D)/(b*b+E*E));return Math.log(R)/Math.LN2}function D2(t,e,r){let a=Math.cos(r),u=Math.sin(r);return{x:t*a-e*u,y:t*u+e*a}}function M2(t,e,r){i.ad.identity(t),i.ad.rotateZ(t,t,dn(e[2])),i.ad.rotateX(t,t,dn(e[0])),i.ad.rotateY(t,t,dn(e[1])),i.ad.scale(t,t,r),i.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function uv(t,e,r,a,u,d,p,_){let y=[r[0]-e[0],r[1]-e[1],0],b=[a[0]-e[0],a[1]-e[1],0];if(i._.length(y)<1e-12||i._.length(b)<1e-12)return i.av.identity(t);let E=i._.cross([],y,b);i._.normalize(E,E),i._.subtract(b,a,e),y[2]=(d-u)*_,b[2]=(p-u)*_;let S=y;return i._.cross(S,y,b),i._.normalize(S,S),i.av.rotationTo(t,E,S)}function fT(t,e,r=!1){let a=ul(e.zoom),u=function(d,p,_){let y=p.worldSize,b=[d[12],d[13],d[14]],E=sr(b[1]/y),S=no(b[0]/y),D=i.ad.identity([]),R=Xr(1,E)*y,k=Xr(1,0)*y*fh(E,p.zoom),F=1/Pw(y),z=k*F;if(_){let K=cv(p.projection,p.zoom,p.width,p.height,1024);z=F*p.projection.pixelSpaceConversion(p.center.lat,y,K)}let j=hh(E,S);i._.add(j,j,i._.scale([],i._.normalize([],j),R*z*b[2]));let Y=function(K){let le=[K[0],K[1],K[2]],se=[0,1,0],me=i._.cross([],se,le);return i._.cross(se,le,me),i._.squaredLength(se)===0&&(se=[0,1,0],i._.cross(me,le,se)),i._.normalize(me,me),i._.normalize(se,se),i._.normalize(le,le),[me[0],me[1],me[2],0,se[0],se[1],se[2],0,le[0],le[1],le[2],0,K[0],K[1],K[2],1]}(j);i.ad.scale(D,D,[z,z,z*R]),i.ad.translate(D,D,[-b[0],-b[1],-b[2]]);let X=i.ad.multiply([],p.globeMatrix,Y);return i.ad.multiply(X,X,D),i.ad.multiply(X,X,d),X}(t,e,r);if(a>0){let d=function(p,_){let y=_.worldSize,b=Xr(1,0)*y*fh(_.center.lat,_.zoom)/Pw(y),E=Xr(1,_.center.lat)*y,S=i.ad.identity([]);return i.ad.rotateY(S,S,dn(_.center.lng)),i.ad.rotateX(S,S,dn(_.center.lat)),i.ad.translate(S,S,[0,0,Yr]),i.ad.scale(S,S,[b,b,b*E]),i.ad.translate(S,S,[_.point.x-.5*y,_.point.y-.5*y,0]),i.ad.multiply(S,S,p),i.ad.multiply(S,_.globeMatrix,S)}(t,e);return function(p,_,y){let b=(k,F,z)=>{let j=i._.length(k),Y=i._.length(F),X=cl(k,F,z);return i._.scale(X,X,1/i._.length(X)*St(j,Y,z))},E=b([p[0],p[1],p[2]],[_[0],_[1],_[2]],y),S=b([p[4],p[5],p[6]],[_[4],_[5],_[6]],y),D=b([p[8],p[9],p[10]],[_[8],_[9],_[10]],y),R=cl([p[12],p[13],p[14]],[_[12],_[13],_[14]],y);return[E[0],E[1],E[2],0,S[0],S[1],S[2],0,D[0],D[1],D[2],0,R[0],R[1],R[2],1]}(u,d,a)}return u}function A2(t,e,r,a){let u=gi.projectAabbCorners(a,r),d=Number.MAX_VALUE,p=-1;for(let b=0;b<u.length;++b){let E=u[b];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<d&&(p=b,d=E[2])}let _=b=>new lt(u[b][0],u[b][1]),y;switch(p){case 0:case 6:y=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:y=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:y=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:y=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(bw(t,y))return d}let mV=An([{name:"a_pos_3f",components:3,type:"Float32"}]),gV=An([{name:"a_color_3f",components:3,type:"Float32"}]),_V=An([{name:"a_color_4f",components:4,type:"Float32"}]),yV=An([{name:"a_uv_2f",components:2,type:"Float32"}]),vV=An([{name:"a_normal_3f",components:3,type:"Float32"}]),xV=An([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),bV=An([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class hv{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function P2(t,e){let r=t.indexOf("://")===-1;try{return new URL(t,r&&e?"http://example.com":void 0),!0}catch{return!1}}class R2{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class k2{constructor(){this.instancedDataArray=new rw,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class pT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,a,u){this.tileToMeter=x0(a);let d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:_,index:y,sourceLayerIndex:b}of e){let E=_??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),S=ll(p,d);if(!this.layers[0]._featureFilter.filter(new jt(this.zoom),S,a))continue;let D={id:E,sourceLayerIndex:b,index:y,geometry:d?S.geometry:Cs(p,a,u),properties:p.properties,type:p.type,patterns:{}},R=this.addFeature(D,D.geometry,S);R&&r.featureIndex.insert(p,D.geometry,y,b,this.index,this.instancesPerModel[R].instancedDataArray.length,rt/32)}this.lookup=null}update(e,r,a,u){for(let d in this.instancesPerModel){let p=this.instancesPerModel[d];for(let _ in e)p.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(p.features[p.idToFeaturesIndex[_]],e[_],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let r in this.instancesPerModel){let a=this.instancesPerModel[r];for(let u of a.features){let d=this.layers[0],p=u.feature,_=this.canonical,y=d.paint.get("model-rotation").evaluate(p,{},_),b=d.paint.get("model-scale").evaluate(p,{},_),E=d.paint.get("model-translation").evaluate(p,{},_);i._.exactEquals(u.rotation,y)&&i._.exactEquals(u.scale,b)&&i._.exactEquals(u.translation,E)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,r,a){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let u=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(jw(this.activeReplacements,u))return!1;this.activeReplacements=u;let d=!1;for(let p in this.instancesPerModel){let _=this.instancesPerModel[p],y=_.instancedDataArray;for(let b of _.features){let E=b.instancedDataOffset,S=b.instancedDataCount;for(let D=0;D<S;D++){let R=16*(D+E),k=y.float32[R+0];k=k>rt?k-rt:k;let F=Math.floor(k),z=y.float32[R+1],j=!1;for(let Y of this.activeReplacements)if(!(Y.order<a||Y.order===1/0)&&Y.clipMask&QM.Model&&!(Y.min.x>F||F>Y.max.x||Y.min.y>z||z>Y.max.y)&&(j=GM($M(F,z,e.canonical,Y.footprintTileId.canonical),Y),j))break;y.float32[R]=j?k+rt:k,d=d||j}}}return d}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let r in this.instancesPerModel){let a=this.instancesPerModel[r];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,xV.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let r in this.instancesPerModel){let a=this.instancesPerModel[r];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,a){let u=this.layers[0],d=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return Pi(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),d;P2(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new k2);let p=this.instancesPerModel[d],_=p.instancedDataArray,y=new R2(a,_.length);for(let b of r)for(let E of b){if(E.x<0||E.x>=rt||E.y<0||E.y>=rt)continue;let S=(this.lookupDim-1)/rt,D=this.lookupDim*(E.y*S|0)+E.x*S|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let R=_.length;_.resize(R+1),p.instancesEvaluatedElevation.push(0),_.float32[16*R]=E.x,_.float32[16*R+1]=E.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),d}getModelUris(){return this.modelUris}evaluate(e,r,a,u){let d=this.layers[0],p=e.feature,_=this.canonical,y=e.rotation=d.paint.get("model-rotation").evaluate(p,r,_),b=e.scale=d.paint.get("model-scale").evaluate(p,r,_),E=e.translation=d.paint.get("model-translation").evaluate(p,r,_),S=d.paint.get("model-color").evaluate(p,r,_);S.a=d.paint.get("model-color-mix-intensity").evaluate(p,r,_);let D=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),M2(D,y,b);let R=Math.round(100*S.a)+S.b/1.05;for(let k=0;k<e.instancedDataCount;++k){let F=e.instancedDataOffset+k,z=16*F,j=a.instancedDataArray.float32,Y=0;u&&(Y=j[z+6]-a.instancesEvaluatedElevation[F]);let X=0|j[z+1];j[z]=(0|j[z])+S.r/1.05,j[z+1]=X+S.g/1.05,j[z+2]=R,j[z+3]=1/(_.z>10?this.tileToMeter:x0(_,X)),j[z+4]=E[0],j[z+5]=E[1],j[z+6]=E[2]+Y,j[z+7]=D[0],j[z+8]=D[1],j[z+9]=D[2],j[z+10]=D[4],j[z+11]=D[5],j[z+12]=D[6],j[z+13]=D[8],j[z+14]=D[9],j[z+15]=D[10],a.instancesEvaluatedElevation[F]=E[2]}}}J(pT,"ModelBucket",{omit:["layers"]}),J(k2,"PerModelAttributes"),J(R2,"ModelFeature");let wV=new On({visibility:new Be(Ee.layout_model.visibility),"model-id":new ut(Ee.layout_model["model-id"])});var TV={paint:new On({"model-opacity":new Be(Ee.paint_model["model-opacity"]),"model-rotation":new ut(Ee.paint_model["model-rotation"]),"model-scale":new ut(Ee.paint_model["model-scale"]),"model-translation":new ut(Ee.paint_model["model-translation"]),"model-color":new ut(Ee.paint_model["model-color"]),"model-color-mix-intensity":new ut(Ee.paint_model["model-color-mix-intensity"]),"model-type":new Be(Ee.paint_model["model-type"]),"model-cast-shadows":new Be(Ee.paint_model["model-cast-shadows"]),"model-receive-shadows":new Be(Ee.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Be(Ee.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ut(Ee.paint_model["model-emissive-strength"]),"model-roughness":new ut(Ee.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ut(Ee.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Be(Ee.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Be(Ee.paint_model["model-front-cutoff"])}),layout:wV};let yh=64,Sf={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function O2(t,e,r,a,u,d,p,_,y,b=!1){let E=r.zoom,S=r.project(a),D=fh(a.lat,E),R=1/D;i.ad.identity(t),i.ad.translate(t,t,[S.x+p[0]*R,S.y+p[1]*R,p[2]]);let k=1,F=1,z=r.worldSize;if(b){if(r.projection.name==="mercator"){let K=0;r.elevation&&(K=r.elevation.getAtPointOrZero(new Dr(S.x/z,S.y/z),0));let le=i.aA.transformMat4([],[S.x,S.y,K,1],r.projMatrix)[3]/r.cameraToCenterDistance;k=le,F=le*fh(r.center.lat,E)}else if(r.projection.name==="globe"){let K=fT(t,r),le=i.ad.multiply([],r.projMatrix,K),se=[0,0,0,1];i.aA.transformMat4(se,se,le);let me=se[3]/r.cameraToCenterDistance,_e=ul(E),Te=r.projection.pixelsPerMeter(a.lat,z)*fh(a.lat,E),ke=r.projection.pixelsPerMeter(r.center.lat,z)*fh(r.center.lat,E);k=me/St(Te,QD(r.center.lat),_e),F=me*D/Te,k*=ke,F*=ke}}else k=R;i.ad.scale(t,t,[k,k,F]);let j=[...t],Y=e.orientation,X=[];if(M2(X,[Y[0]+u[0],Y[1]+u[1],Y[2]+u[2]],d),i.ad.multiply(t,j,X),_&&r.elevation){let K=0,le=[];if(y&&r.elevation){K=function(_e,Te,ke,De,ze){let Ye=Te.elevation;if(!Ye)return 0;let Le=gi.projectAabbCorners(ke,De),qe=Xr(1,ze.lat)*Te.worldSize,Oe=function(It,Wt){let Pt=[0,0,1],Xt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Zt of Xt){let sn=It[Zt.corners[0]],Dt=It[Zt.corners[1]],Un=It[Zt.corners[2]],Vn=[Dt[0]-sn[0],Dt[1]-sn[1],Wt*(Dt[2]-sn[2])],Cn=i._.cross(Vn,Vn,[Un[0]-sn[0],Un[1]-sn[1],Wt*(Un[2]-sn[2])]);i._.normalize(Cn,Cn),Zt.dotProductWithUp=i._.dot(Cn,Pt)}return Xt.sort((Zt,sn)=>Zt.dotProductWithUp-sn.dotProductWithUp),Xt[0].corners}(Le,qe),We=Le[Oe[0]],Je=Le[Oe[1]],Ze=Le[Oe[2]],ht=Le[Oe[3]],Xe=Ye.getAtPointOrZero(new Dr(We[0]/Te.worldSize,We[1]/Te.worldSize),0),nt=Ye.getAtPointOrZero(new Dr(Je[0]/Te.worldSize,Je[1]/Te.worldSize),0),Et=Ye.getAtPointOrZero(new Dr(Ze[0]/Te.worldSize,Ze[1]/Te.worldSize),0),xt=Ye.getAtPointOrZero(new Dr(ht[0]/Te.worldSize,ht[1]/Te.worldSize),0),_t=(Xe+xt)/2,et=(nt+Et)/2;return _t>et?nt<Et?uv(_e,Je,ht,We,nt,xt,Xe,qe):uv(_e,Ze,We,ht,Et,Xe,xt,qe):Xe<xt?uv(_e,We,Je,Ze,Xe,nt,Et,qe):uv(_e,ht,Ze,Je,xt,Et,nt,qe),Math.max(_t,et)}(le,r,e.aabb,t,a);let se=i.ad.fromQuat([],le),me=i.ad.multiply([],se,X);i.ad.multiply(t,j,me)}else K=r.elevation.getAtPointOrZero(new Dr(S.x/z,S.y/z),0);K!==0&&(t[14]+=K)}}function wg(t,e,r=!1){t.uploaded||(t.gfxTexture=new os(e,t.image,r?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function EV(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,mV.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,vV.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,yV.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?gV:_V).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,bV.members,!0)),t.segments=mi.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&wg(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&wg(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&wg(a.normalTexture,e),a.occlusionTexture&&wg(a.occlusionTexture,e,r),a.emissionTexture&&wg(a.emissionTexture,e)}function mT(t,e,r){if(t.meshes)for(let a of t.meshes)EV(a,e,r);if(t.children)for(let a of t.children)mT(a,e,r)}function dv(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)dv(e)}function gT(t){if(t.meshes)for(let r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let r of t.children)gT(r)}class IV{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class CV{constructor(){this.tasks={},this.taskQueue=[],wd(["process"],this),this.invoker=new IV(this.process),this.nextId=0}add(e,r){let a=this.nextId++,u=function({type:d,isSymbolTile:p,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-_:d==="maybePrepare"&&p?400-_:500:200-_:100-_}(r);if(u===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:r,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){let d=this.tasks[this.taskQueue[u]];d.priority<r&&(r=d.priority,e=u)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class L2{constructor(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},wd(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new CV}send(e,r,a,u,d=!1,p){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[_]=a);let y=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:ge(r,y)},y),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){let r=e.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){let u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(r.mustQueue||ir()){let u=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,r),u&&u.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(r.error?a(Ie(r.error)):a(null,Ie(r.data)))}else{let a=new Set,u=r.hasCallback?(p,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?ge(p):null,data:ge(_,a)},a)}:p=>{},d=Ie(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,d,u);else if(this.parent.getWorkerSource){let p=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,p[0],d.source,d.scope)[p[1]](d,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let _T=(()=>{class t{constructor(r,a){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=xd();let u=this.workerPool.acquire(this.id);for(let d=0;d<u.length;d++){let p=new t.Actor(u[d],a,this.id);p.name=`Worker ${d}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,a,u){Hl(this.actors,(d,p)=>{d.send(r,a,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=L2,t})();var Tg={workerUrl:"",workerClass:null,workerParams:void 0};function SV(){return Tg.workerClass!=null?new Tg.workerClass:new self.Worker(Tg.workerUrl,Tg.workerParams)}let yT="mapboxgl_preloaded_worker_pool";class Eg{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Eg.workerCount;)this.workers.push(new SV);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yT]}numActive(){return Object.keys(this.active).length}}let Ig;function fv(){return Ig||(Ig=new Eg),Ig}Eg.workerCount=2;let pv,vT,ks,Df,xT,Mf=null;function F2(){return ir()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:vT||A.DRACO_URL}function N2(){if(ir()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Df)return Df;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Df=WebAssembly.validate(t)?A.MESHOPT_SIMD_URL:A.MESHOPT_URL,Df}let mv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},DV={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Cg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function z2(t,e,r){let a=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=a,r.json.bufferViews[a]={buffer:u,byteLength:t.byteLength},r.buffers[u]=t}let bT="KHR_draco_mesh_compression";function MV(t,e){let r=t.extensions&&t.extensions[bT];if(!r)return;let a=new ks.Decoder,u=U2(e,r.bufferView),d=new ks.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,d))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[t.indices],_=mv[p.componentType],y=p.count*_.BYTES_PER_ELEMENT,b=ks._malloc(y);_===Uint16Array?a.GetTrianglesUInt16Array(d,y,b):a.GetTrianglesUInt32Array(d,y,b),z2(ks.memory.buffer.slice(b,b+y),p,e),ks._free(b);for(let E of Object.keys(r.attributes)){let S=a.GetAttributeByUniqueId(d,r.attributes[E]),D=e.json.accessors[t.attributes[E]],R=DV[D.componentType],k=D.count*Cg[D.type]*mv[D.componentType].BYTES_PER_ELEMENT,F=ks._malloc(k);a.GetAttributeDataArrayForAllPoints(d,S,ks[R],k,F),z2(ks.memory.buffer.slice(F,F+k),D,e),ks._free(F)}a.destroy(),d.destroy(),delete t.extensions[bT]}let gv="EXT_meshopt_compression";function AV(t,e){if(!t.extensions||!t.extensions[gv])return;let r=t.extensions[gv],a=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),u=new Uint8Array(r.count*r.byteStride);xT.decodeGltfBuffer(u,r.count,r.byteStride,a,r.mode,r.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=u.buffer,delete t.extensions[gv]}let B2=1179937895,V2=new TextDecoder("utf8");function j2(t,e){return new URL(t,e).href}function PV(t,e,r,a){return fetch(j2(t.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function U2(t,e){let r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function RV(t,e,r,a){if(t.uri){let u=j2(t.uri,a);return fetch(u).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[r]=d})}if(t.bufferView!==void 0){let u=U2(e,t.bufferView),d=new Blob([u],{type:t.mimeType});return createImageBitmap(d).then(p=>{e.images[r]=p})}}function $2(t,e=0,r){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===B2){let E=new Uint32Array(t,e),S=2,D=(E[S++]>>2)-3,R=E[S++]>>2;if(S++,a.json=JSON.parse(V2.decode(E.subarray(S,S+R))),S+=R,S<D){let k=E[S++];S++;let F=e+(S<<2);a.buffers[0]=t.slice(F,F+k)}}else a.json=JSON.parse(V2.decode(new Uint8Array(t,e)));let{buffers:u,images:d,meshes:p,extensionsUsed:_,bufferViews:y}=a.json,b=Promise.resolve();if(u){let E=[];for(let S=0;S<u.length;S++){let D=u[S];D.uri?E.push(PV(D,a,S,r)):a.buffers[S]||(a.buffers[S]=null)}b=Promise.all(E)}return b.then(()=>{let E=[],S=_&&_.includes(bT),D=_&&_.includes(gv);if(S&&E.push(function(){if(!ks)return pv||(pv=function(R){let k,F=null;function z(){k=new Uint8Array(F.buffer)}function j(){throw new Error("Unexpected Draco error.")}let Y={a:{a:j,d:function(X,K,le){return k.copyWithin(X,K,K+le)},c:function(X){let K=k.length,le=Math.max(X>>>0,Math.ceil(1.2*K)),se=Math.ceil((le-K)/65536);try{return F.grow(se),z(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,Y):R.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,Y))).then(X=>{let{Rb:K,Qb:le,P:se,T:me,X:_e,Ja:Te,La:ke,Qa:De,Va:ze,Wa:Ye,eb:Le,jb:qe,f:Oe,e:We,yb:Je,zb:Ze,Ab:ht,Bb:Xe,Db:nt,Gb:Et}=X.instance.exports;F=We;let xt=(()=>{let _t=0,et=0,It=0,Wt=0;return Pt=>{It&&(K(Wt),K(_t),et+=It,It=_t=0),_t||(et+=128,_t=le(et));let Xt=Pt.length+7&-8,Zt=_t;Xt>=et&&(It=Xt,Zt=Wt=le(Xt));for(let sn=0;sn<Pt.length;sn++)k[Zt+sn]=Pt[sn];return Zt}})();return z(),Oe(),{memory:We,_free:K,_malloc:le,Mesh:class{constructor(){this.ptr=se()}destroy(){me(this.ptr)}},Decoder:class{constructor(){this.ptr=Te()}destroy(){qe(this.ptr)}DecodeArrayToMesh(_t,et,It){let Wt=xt(_t),Pt=ke(this.ptr,Wt,et,It.ptr);return!!_e(Pt)}GetAttributeByUniqueId(_t,et){return{ptr:De(this.ptr,_t.ptr,et)}}GetTrianglesUInt16Array(_t,et,It){ze(this.ptr,_t.ptr,et,It)}GetTrianglesUInt32Array(_t,et,It){Ye(this.ptr,_t.ptr,et,It)}GetAttributeDataArrayForAllPoints(_t,et,It,Wt,Pt){Le(this.ptr,_t.ptr,et.ptr,It,Wt,Pt)}},DT_INT8:Je(),DT_UINT8:Ze(),DT_INT16:ht(),DT_UINT16:Xe(),DT_UINT32:nt(),DT_FLOAT32:Et()}})}(fetch(F2())),pv.then(R=>{ks=R,pv=void 0}))}()),D&&E.push(function(){if(xT)return;let R=function(k){let F,z=WebAssembly.instantiateStreaming(k,{}).then(X=>{F=X.instance,F.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(X,K,le,se,me,_e){(function(Te,ke,De,ze,Ye,Le,qe){let Oe=Te.exports.sbrk,We=ze+3&-4,Je=Oe(We*Ye),Ze=Oe(Le.length),ht=new Uint8Array(Te.exports.memory.buffer);ht.set(Le,Ze);let Xe=ke(Je,ze,Ye,Ze,Le.length);if(Xe===0&&qe&&qe(Je,We,Ye),De.set(ht.subarray(Je,Je+ze*Ye)),Oe(Je-Oe(0)),Xe!==0)throw new Error(`Malformed buffer data: ${Xe}`)})(F,F.exports[Y[me]],X,K,le,se,F.exports[j[_e]])}}}(fetch(N2()));return R.ready.then(()=>{xT=R})}()),d)for(let R=0;R<d.length;R++)E.push(RV(d[R],a,R,r));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(S&&p)for(let{primitives:R}of p)for(let k of R)MV(k,a);if(D&&p&&y)for(let R of y)AV(R,a);return a})})}function vh(t,e){let r=t.json.bufferViews[e.bufferView],a=mv[e.componentType];return new a(t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Cg[e.type]*a.BYTES_PER_ELEMENT?r.byteStride/a.BYTES_PER_ELEMENT:Cg[e.type]))}function wT(t,e,r,a){let u=mv[e.componentType],d=function(E){switch(E){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),p=t.json.bufferViews[e.bufferView],_=p.byteStride?p.byteStride/u.BYTES_PER_ELEMENT:Cg[e.type],y=r.float32,b=y.length/r.capacity;for(let E=0,S=0;E<e.count*_;E+=_,S+=b)for(let D=0;D<b;D++)y[S+D]=a[E+D]*d;r._trim()}function kV(t,e,r){let a=t.indices,u=t.attributes,d={};d.indexArray=new Qi;let p=e.json.accessors[a],_=p.count/3;d.indexArray.reserve(_);let y=vh(e,p);for(let D=0;D<_;D++)d.indexArray.emplaceBack(y[3*D],y[3*D+1],y[3*D+2]);d.indexArray._trim(),d.vertexArray=new gc;let b=e.json.accessors[u.POSITION];d.vertexArray.reserve(b.count);let E=vh(e,b);for(let D=0;D<b.count;D++)d.vertexArray.emplaceBack(E[3*D],E[3*D+1],E[3*D+2]);if(d.vertexArray._trim(),d.aabb=new gi(b.min,b.max),d.centroid=function(D,R){let k=[0,0,0],F=D.length;if(F>0){for(let z=0;z<F;z++){let j=3*D[z];k[0]+=R[j],k[1]+=R[j+1],k[2]+=R[j+2]}k[0]/=F,k[1]/=F,k[2]/=F}return k}(y,E),u.COLOR_0!==void 0){let D=e.json.accessors[u.COLOR_0],R=Cg[D.type],k=vh(e,D);d.colorArray=R===3?new gc:new mc,d.colorArray.resize(D.count),wT(e,D,d.colorArray,k)}if(u.NORMAL!==void 0){d.normalArray=new gc;let D=e.json.accessors[u.NORMAL];d.normalArray.resize(D.count);let R=vh(e,D);wT(e,D,d.normalArray,R)}if(u.TEXCOORD_0!==void 0&&r.length>0){d.texcoordArray=new of;let D=e.json.accessors[u.TEXCOORD_0];d.texcoordArray.resize(D.count);let R=vh(e,D);wT(e,D,d.texcoordArray,R)}if(u._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=vh(e,D))}u._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(vh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));let S=t.material;return d.material=function(D,R){let{emissiveFactor:k=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:z=.5,normalTexture:j,occlusionTexture:Y,emissiveTexture:X,doubleSided:K}=D,{baseColorFactor:le=[1,1,1,1],metallicFactor:se=1,roughnessFactor:me=1,baseColorTexture:_e,metallicRoughnessTexture:Te}=D.pbrMetallicRoughness||{},ke=Y?R[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&ke){let De=Y.extensions.KHR_texture_transform;ke.offsetScale=[De.offset[0],De.offset[1],De.scale[0],De.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Tn(...le),metallicFactor:se,roughnessFactor:me,baseColorTexture:_e?R[_e.index]:void 0,metallicRoughnessTexture:Te?R[Te.index]:void 0},doubleSided:K,emissiveFactor:k,alphaMode:F,alphaCutoff:z,normalTexture:j?R[j.index]:void 0,occlusionTexture:ke,emissionTexture:X?R[X.index]:void 0,defined:D.defined===void 0}}(S!==void 0?e.json.materials[S]:{defined:!1},r),d}function G2(t,e,r){let{matrix:a,rotation:u,translation:d,scale:p,mesh:_,extras:y,children:b}=t,E={};if(E.matrix=a||i.ad.fromRotationTranslationScale([],u||[0,0,0,1],d||[0,0,0],p||[1,1,1]),_!==void 0){E.meshes=r[_];let S=E.anchor=[0,0];for(let D of E.meshes){let{min:R,max:k}=D.aabb;S[0]+=R[0]+k[0],S[1]+=R[1]+k[1]}S[0]=Math.floor(S[0]/E.meshes.length/2),S[1]=Math.floor(S[1]/E.meshes.length/2)}if(y&&(y.id&&(E.id=y.id),y.lights&&(E.lights=function(S){if(!S.length)return[];let D=function(j){let Y=atob(j),X=new Uint8Array(Y.length);for(let K=0;K<Y.length;K++)X[K]=Y.codePointAt(K);return X}(S),R=[],k=D.length/24,F=new Uint16Array(D.buffer),z=new Float32Array(D.buffer);for(let j=0;j<k;j++){let Y=F[2*j*6]/30,X=F[2*j*6+1]/30,K=F[2*j*6+10]/100,le=z[6*j+1],se=z[6*j+2],me=z[6*j+3],_e=z[6*j+4],Te=me-le,ke=_e-se,De=Math.hypot(Te,ke);R.push({pos:[le+.5*Te,se+.5*ke,X],normal:[ke/De,-Te/De,0],width:De,height:Y,depth:K,points:[le,se,me,_e]})}return R}(y.lights))),b){let S=[];for(let D of b)S.push(G2(e.json.nodes[D],e,r));E.children=S}return E}function OV(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new zw(t.vertices,t.indices,8,256),[r,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:r,max:a}}function LV(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;let a=[];for(let p of r){if(!Array.isArray(p)||p.length!==2)continue;let _=p[0],y=p[1];typeof _=="number"&&typeof y=="number"&&a.push(new lt(_,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let p=0;p<a.length;p++){let _=a[p],y=a[(p+1)%a.length],b=a[(p+2)%a.length];u+=(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)}u>0&&a.reverse();let d=ig(a.flatMap(p=>[p.x,p.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function FV(t,e){let r=[],a=[],u=0,d=[];for(let p of t){u=r.length;let _=p.vertexArray.float32,y=p.indexArray.uint16;for(let b=0;b<p.vertexArray.length;b++)d[0]=_[3*b+0],d[1]=_[3*b+1],d[2]=_[3*b+2],i._.transformMat4(d,d,e),r.push(new lt(d[0],d[1]));for(let b=0;b<3*p.indexArray.length;b++)a.push(y[b]+u)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){let _=r[a[p+0]],y=r[a[p+1]],b=r[a[p+2]];(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:r,indices:a}}function H2(t){let e=function(y,b){let E=[],S=WebGL2RenderingContext;if(y.json.textures)for(let D of y.json.textures){let R={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};D.sampler!==void 0&&Object.assign(R,y.json.samplers[D.sampler]),E.push({image:b[D.source],sampler:R,uploaded:!1})}return E}(t,t.images),r=function(y,b){let E=[];for(let S of y.json.meshes){let D=[];for(let R of S.primitives)D.push(kV(R,y,b));E.push(D)}return E}(t,e),{scenes:a,scene:u,nodes:d}=t.json,p=a?a[u||0].nodes:d,_=[];for(let y of p)_.push(G2(d[y],t,r));return function(y,b,E){let S={},D=new Set;for(let R=0;R<y.length;R++){let k=E[b[R]];if(!k.extras)continue;let F=k.extras["mapbox:footprint:version"],z=k.extras["mapbox:footprint:id"];(F||z)&&D.add(R),F==="1.0.0"&&z&&(S[z]=R)}for(let R=0;R<y.length;R++){if(D.has(R))continue;let k=y[R],F=E[b[R]];if(!F.extras)continue;let z=null;k.id in S&&(z=FV(y[S[k.id]].meshes,k.matrix)),z||(z=LV(F)),z&&(k.footprint=OV(z))}if(D.size>0){let R=Array.from(D.values()).sort((k,F)=>k-F);for(let k=R.length-1;k>=0;k--)y.splice(R[k],1)}}(_,p,t.json.nodes),_}function NV(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,r=t.aabb.min[0]-1,a=t.aabb.min[1]-1,u=yh/(t.aabb.max[0]-r+2),d=yh/(t.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){let _=e[p+2],y=(e[p+0]-r)*u|0,b=(e[p+1]-a)*d|0;_>t.heightmap[b*yh+y]&&(t.heightmap[b*yh+y]=_)}}function zV(t,e){let r={};r.indexArray=new Qi,r.indexArray.reserve(4*t.length),r.vertexArray=new gc,r.vertexArray.reserve(10*t.length),r.colorArray=new mc,r.vertexArray.reserve(10*t.length);let a=0;for(let p of t){let _=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],b=Math.min(.29,.1*p.width/p.depth),E=p.width-2*p.depth*e*(b+.01),S=i._.scaleAndAdd([],p.pos,y,E/2),D=i._.scaleAndAdd([],p.pos,y,-E/2),R=[S[0],S[1],S[2]+p.height],k=[D[0],D[1],D[2]+p.height],F=i._.scaleAndAdd([],p.normal,y,b);i._.scale(F,F,_);let z=i._.scaleAndAdd([],p.normal,y,-b);i._.scale(z,z,_),i._.add(F,S,F),i._.add(z,D,z),S[2]+=.1,D[2]+=.1,r.vertexArray.emplaceBack(F[0],F[1],F[2]),r.vertexArray.emplaceBack(z[0],z[1],z[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(F[0],F[1],F[2]),r.vertexArray.emplaceBack(z[0],z[1],z[2]);let j=E/_/2;r.colorArray.emplaceBack(-j-b,-1,j,.8),r.colorArray.emplaceBack(j+b,-1,j,.8),r.colorArray.emplaceBack(-j,0,j,1.3),r.colorArray.emplaceBack(j,0,j,1.3),r.colorArray.emplaceBack(j+b,-.8,j,.7),r.colorArray.emplaceBack(j+b,-.8,j,.7),r.colorArray.emplaceBack(0,0,j,1.3),r.colorArray.emplaceBack(0,0,j,1.3),r.colorArray.emplaceBack(j+b,-1.2,j,.8),r.colorArray.emplaceBack(j+b,-1.2,j,.8),r.indexArray.emplaceBack(6+a,4+a,8+a),r.indexArray.emplaceBack(7+a,9+a,5+a),r.indexArray.emplaceBack(0+a,1+a,2+a),r.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let u={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Tn.white,u.pbrMetallicRoughness=d,r.material=u,r.aabb=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}let TT=new Float32Array(262144),xh=new Uint8Array(262144);function q2(t){let e=0;if(t.meshes)for(let r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(let r of t.children)e=Math.max(e,q2(r));return e}function W2(t,e,r){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&r.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)W2(a,e,r)}let Z2=["","wall","door","roof","window","lamp","logo"];class Y2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:q2(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,r=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=gi.applyTransform(a.aabb,this.node.matrix),r.encapsulate(a.transformedAabb)),e++;this.aabb=r}return this.aabb}}class _v{constructor(e,r,a,u,d,p){this.id=r,this.modelTraits|=Sf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Sf.HasMapboxMeshFeatures),u&&(this.modelTraits|=Sf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new Y2(_)),W2(_,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,r){for(let a of this.getNodesInfo()){let u=a.node;u.footprint&&r.push({footprint:u.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let r=this.getNodesInfo();for(let a of r){let u=a.node;this.uploaded?this.updatePbrBuffer(u):mT(u,e,!0)}for(let a of r)dv(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),r=!0);return r}needsReEvaluation(e,r,a){let u=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||Sg(a.paint.get("model-color").value,p)||Sg(a.paint.get("model-color-mix-intensity").value,p)||Sg(a.paint.get("model-roughness").value,p)||Sg(a.paint.get("model-emissive-strength").value,p)||Sg(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=u,this.brightness=d,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),u=this.id.canonical;for(let d of a){let p=d.feature;d.evaluatedScale=r.paint.get("model-scale").evaluate(p,{},u)}}evaluate(e){let r=this.getNodesInfo();for(let a of r){if(!a.node.meshes)continue;let u=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],_=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let b=0;b<Z2.length;b++){let E=Z2[b];E.length&&(u.properties.part=E);let S=e.paint.get("model-color").evaluate(u,{},y).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(u,{},y);a.evaluatedColor[b]=[S.r,S.g,S.b,D],a.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(u,{},y),a.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(u,{},y),a.evaluatedRMEA[b][3]=S.a,a.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},y),!a.hasTranslucentParts&&S.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,VV(a,p!==a.evaluatedColor[2]||_!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,a,u){let d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;let p=pf.create(e,a,d);if(!p)return;this.modelTraits&Sf.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,u);for(let _ of this.getNodesInfo()){let y=_.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let b=y.footprint.vertices,E=p.getElevationAt(b[0].x,b[0].y,!0,!0);for(let S=1;S<b.length;S++)E=Math.min(E,p.getElevationAt(b[S].x,b[S].y,!0,!0));y.elevation=E}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,a,u){let d=r._dem._modifiedForSources[u];if(d===void 0&&(r._dem._modifiedForSources[u]=[],d=r._dem._modifiedForSources[u]),d.includes(a.canonical))return;let p=r._dem.dim;d.push(a.canonical);let _=!1;for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.grid)continue;let E=b.footprint.grid,S=r.tileCoordToPixel(E.min.x,E.min.y),D=r.tileCoordToPixel(E.max.x,E.max.y),R=Math.min(Math.min(p-D.y,S.x),Math.min(S.y,p-D.x));if(R<0)continue;let k=Jt(R,2,5),F=Math.max(0,S.x-k),z=Math.max(0,S.y-k),j=Math.min(D.x+k,p-1),Y=Math.min(D.y+k,p-1);for(let se=z;se<=Y;++se)for(let me=F;me<=j;++me)xh[se*p+me]=255;let X=0,K=0;for(let se=0;se<E.cellsY;++se)for(let me=0;me<E.cellsX;++me){if(!E.cells[se*E.cellsX+me])continue;let _e=r.tileCoordToPixel(E.min.x+me/E.xScale,E.min.y+se/E.yScale),Te=r.tileCoordToPixel(E.min.x+(me+1)/E.xScale,E.min.y+(se+1)/E.yScale);for(let ke=_e.y;ke<=Math.min(Te.y+1,p-1);++ke)for(let De=_e.x;De<=Math.min(Te.x+1,p-1);++De)xh[ke*p+De]===255&&(xh[ke*p+De]=0,X+=r.getElevationAtPixel(De,ke),K++)}let le=X/K;F=Math.max(1,S.x-k),z=Math.max(1,S.y-k),j=Math.min(D.x+k,p-2),Y=Math.min(D.y+k,p-2),_=!0;for(let se=z;se<=Y;++se)for(let me=F;me<=j;++me)xh[se*p+me]===0&&(TT[se*p+me]=r._dem.set(me,se,le));for(let se=1;se<k;++se){F=Math.max(1,S.x-se),z=Math.max(1,S.y-se),j=Math.min(D.x+se,p-2),Y=Math.min(D.y+se,p-2);for(let me=z;me<=Y;++me)for(let _e=F;_e<=j;++_e){let Te=me*p+_e;if(xh[Te]===255){let ke=0,De=0,ze=-1,Ye=-1;for(let Le=-1;Le<=1;++Le)for(let qe=-1;qe<=1;++qe){let Oe=(me+Le)*p+_e+qe;if(xh[Oe]>=se)continue;let We=TT[Oe],Je=Math.abs(We);Je>De&&(ke=We,De=Je,ze=qe,Ye=Le)}if(De>.1){let Le=1-(se+.5*Math.abs(ze*Ye))/k,qe=r._dem.get(_e,me)+ke*Le,Oe=r._dem.get(_e+ze,me+Ye),We=r._dem.get(_e-ze,me-Ye,!0);(qe-Oe)*(qe-We)>0&&(qe=(Oe+We)/2),TT[Te]=r._dem.set(_e,me,qe),xh[Te]=se}}}}}_&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=rr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let r of e)dv(r.node),gT(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let a=r.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){let p=u[d].node;u[d].hiddenByReplacement=!!p.footprint&&!a.find(_=>_.footprint===p.footprint)}}getHeightAtTileCoord(e,r){let a=this.getNodesInfo(),u=[],d=[0,0,0],p=i.ad.identity([]);for(let _=0;_<this.nodesInfo.length;_++){let y=a[_],b=y.node.meshes[0],E=b.transformedAabb;if(e<E.min[0]||r<E.min[1]||e>E.max[0]||r>E.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};i.ad.invert(p,y.node.matrix),d[0]=e,d[1]=r,i._.transformMat4(d,d,p);let S=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*yh|0,D=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*yh|0)*yh+Math.min(63,S),R=b.heightmap[D];if(!(R<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:R,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new lt(e,r),new lt(e,r),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Sg(t,e){return!t.isLightConstant&&e}function BV(t,e,r,a,u,d,p,_){let y=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;r[3]>0&&(y=St(y,255*r[0],r[3]),b=St(b,255*r[1],r[3]),E=St(E,255*r[2],r[3]));let S=y<<8|b,D=E<<8|Math.floor(255*a[3]),R=function(se){let me=Jt(se,0,2);return Math.min(Math.round(.5*me*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],k=Jt(u[0],0,1),F=Jt(u[1],0,1),z=Jt(u[2],0,1),j=Jt(u[3],0,1),Y,X,K,le;if(k!==F&&p!==d&&F!==k){let se=p-d;X=1/(se*(F-k)),K=-(d+se*k)/(se*(F-k));let me=Jt(u[4],-1,1);le=Math.pow(10,me),Y=255*z<<8|255*j}else Y=65535,X=0,K=1,le=1;if(t.emplaceBack(S,D,R,Y,X,K,le),_){let se=_.length;_.clear();for(let me=0;me<se;me++)_.emplaceBack(S,D,R,Y,X,K,le)}}function VV(t,e,r){let a=t.node,u=0,d=r&Sf.HasMeshoptCompression;for(let p of a.meshes){if(a.lights&&a.lightMeshIndex===u||!p.featureData)continue;p.featureArray=new _0,p.featureArray.reserve(p.featureData.length);let _=e;for(let y of p.featureData){let b=d?65535&y:y>>16&65535,E=d?y>>16&65535:65535&y,S=(15&E)<8?15&E:0,D=t.evaluatedRMEA[S],R=t.evaluatedColor[S],k=t.emissionHeightBasedParams[S],F;if(_&&S===2&&a.lights&&(F=new _0,F.resize(10*a.lights.length)),BV(p.featureArray,b,R,D,k,p.aabb.min[2],p.aabb.max[2],F),F&&_){_=!1;let z=a.meshes[a.lightMeshIndex];z.featureArray=F,z.featureArray._trim()}}p.featureArray._trim(),u++}}function X2(t,e,r,a){let u=1<<t.z;e.lat=sr((a/rt+t.y)/u),e.lng=no((r/rt+t.x)/u)}J(_v,"Tiled3dModelBucket",{omit:["layers"]}),J(Y2,"Tiled3dModelFeature");let jV={circle:class extends xr{constructor(t,e,r,a){super(t,SB,e,r,a)}createBucket(t){return new xw(t)}queryRadius(t){let e=t;return hf("circle-radius",this,e)+hf("circle-stroke-width",this,e)+T0(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,a,u,d,p,_){let y=aM(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return wM(t,a,d,p,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,r){let a=bM(this);return{config:new uh(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}},heatmap:class extends xr{createBucket(t){return new EM(t)}constructor(t,e,r,a){super(t,zB,e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ng({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return hf("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,a,u,d,p,_){let y=this.paint.get("heatmap-radius").evaluate(e,r);return wM(t,a,d,p,_,!0,!0,new lt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,r){return t==="heatmap"?{config:new uh(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends xr{constructor(t,e,r,a){super(t,VB,e,r,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,r){return{overrideFog:!1}}},fill:class extends xr{constructor(t,e,r,a){super(t,e5,e,r,a)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e,r){return{config:new uh(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new R0(t)}queryRadius(){return T0(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,a,u,d){return!t.queryGeometry.isAboveHorizon&&nM(sM(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends xr{constructor(t,e,r,a){super(t,A5,e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new B0(t)}queryRadius(){return T0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,r,a,u,d,p,_,y){let b=aM(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),S=this.paint.get("fill-extrusion-base").evaluate(e,r),D=[0,0],R=_&&d.elevation,k=d.elevation?d.elevation.exaggeration():1,F=t.tile.getBucket(this);if(R&&F instanceof B0){let K=F.centroidVertexArray,le=y+1;le<K.length&&(D[0]=K.geta_centroid_pos0(le),D[1]=K.geta_centroid_pos1(le))}if(D[0]===0&&D[1]===1)return!1;d.projection.name==="globe"&&(a=hA([a],[new lt(0,0),new lt(rt,rt)],t.tileID.canonical).map(K=>K.polygon).flat());let z=R?_:null,[j,Y]=function(K,le,se,me,_e,Te,ke,De,ze,Ye,Le){return K.projection.name==="globe"?function(qe,Oe,We,Je,Ze,ht,Xe,nt,Et,xt,_t){let et=[],It=[],Wt=qe.projection.upVectorScale(_t,qe.center.lat,qe.worldSize).metersToTile,Pt=[0,0,0,1],Xt=[0,0,0,1],Zt=(Dt,Un,Vn,Cn)=>{Dt[0]=Un,Dt[1]=Vn,Dt[2]=Cn,Dt[3]=1},sn=uA();We>0&&(We+=sn),Je+=sn;for(let Dt of Oe){let Un=[],Vn=[];for(let Cn of Dt){let mn=Cn.x+Ze.x,Sn=Cn.y+Ze.y,Jn=qe.projection.projectTilePoint(mn,Sn,_t),Wn=qe.projection.upVector(_t,Cn.x,Cn.y),Ei=We,_i=Je;if(Xe){let Mr=fA(mn,Sn,We,Je,Xe,nt,Et,xt);Ei+=Mr.base,_i+=Mr.top}We!==0?Zt(Pt,Jn.x+Wn[0]*Wt*Ei,Jn.y+Wn[1]*Wt*Ei,Jn.z+Wn[2]*Wt*Ei):Zt(Pt,Jn.x,Jn.y,Jn.z),Zt(Xt,Jn.x+Wn[0]*Wt*_i,Jn.y+Wn[1]*Wt*_i,Jn.z+Wn[2]*Wt*_i),i._.transformMat4(Pt,Pt,ht),i._.transformMat4(Xt,Xt,ht),Un.push(new mh(Pt[0],Pt[1],Pt[2])),Vn.push(new mh(Xt[0],Xt[1],Xt[2]))}et.push(Un),It.push(Vn)}return[et,It]}(K,le,se,me,_e,Te,ke,De,ze,Ye,Le):ke?function(qe,Oe,We,Je,Ze,ht,Xe,nt,Et){let xt=[],_t=[],et=[0,0,0,1];for(let It of qe){let Wt=[],Pt=[];for(let Xt of It){let Zt=Xt.x+Je.x,sn=Xt.y+Je.y,Dt=fA(Zt,sn,Oe,We,ht,Xe,nt,Et);et[0]=Zt,et[1]=sn,et[2]=Dt.base,et[3]=1,i.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Un=new mh(et[0]/et[3],et[1]/et[3],et[2]/et[3]);et[0]=Zt,et[1]=sn,et[2]=Dt.top,et[3]=1,i.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Vn=new mh(et[0]/et[3],et[1]/et[3],et[2]/et[3]);Wt.push(Un),Pt.push(Vn)}xt.push(Wt),_t.push(Pt)}return[xt,_t]}(le,se,me,_e,Te,ke,De,ze,Ye):function(qe,Oe,We,Je,Ze){let ht=[],Xe=[],nt=Ze[8]*Oe,Et=Ze[9]*Oe,xt=Ze[10]*Oe,_t=Ze[11]*Oe,et=Ze[8]*We,It=Ze[9]*We,Wt=Ze[10]*We,Pt=Ze[11]*We;for(let Xt of qe){let Zt=[],sn=[];for(let Dt of Xt){let Un=Dt.x+Je.x,Vn=Dt.y+Je.y,Cn=Ze[0]*Un+Ze[4]*Vn+Ze[12],mn=Ze[1]*Un+Ze[5]*Vn+Ze[13],Sn=Ze[2]*Un+Ze[6]*Vn+Ze[14],Jn=Ze[3]*Un+Ze[7]*Vn+Ze[15],Wn=Cn+nt,Ei=mn+Et,_i=Sn+xt,Mr=Math.max(Jn+_t,1e-5),Si=Cn+et,hi=mn+It,Ui=Sn+Wt,ar=Math.max(Jn+Pt,1e-5);Zt.push(new mh(Wn/Mr,Ei/Mr,_i/Mr)),sn.push(new mh(Si/ar,hi/ar,Ui/ar))}ht.push(Zt),Xe.push(sn)}return[ht,Xe]}(le,se,me,_e,Te)}(d,a,S,E,b,p,z,D,k,d.center.lat,t.tileID.canonical),X=t.queryGeometry;return function(K,le,se){let me=1/0;nM(se,le)&&(me=dA(se,le[0]));for(let _e=0;_e<le.length;_e++){let Te=le[_e],ke=K[_e];for(let De=0;De<Te.length-1;De++){let ze=Te[De],Ye=[ze,Te[De+1],ke[De+1],ke[De],ze];bw(se,Ye)&&(me=Math.min(me,dA(se,Ye)))}}return me!==1/0&&me}(j,Y,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends xr{constructor(t,e,r,a){super(t,j0,e,r,a),j0.layout&&(this.layout=new pn(j0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof nh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=y2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new V0(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,r){let a=bA(this);return{config:new uh(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}queryRadius(t){let e=t,r=v2(hf("line-width",this,e),hf("line-gap-width",this,e)),a=hf("line-offset",this,e);return r/2+Math.abs(a)+T0(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,a,u,d){if(t.queryGeometry.isAboveHorizon)return!1;let p=sM(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*v2(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),y=this.paint.get("line-offset").evaluate(e,r);return y&&(a=function(b,E){let S=[],D=new lt(0,0);for(let R=0;R<b.length;R++){let k=b[R],F=[];for(let z=0;z<k.length;z++){let j=k[z],Y=k[z+1],X=z===0?D:j.sub(k[z-1])._unit()._perp(),K=z===k.length-1?D:Y.sub(j)._unit()._perp(),le=X._add(K)._unit();le._mult(1/(le.x*K.x+le.y*K.y)),F.push(le._mult(E)._add(j))}S.push(F)}return S}(a,y*t.pixelToTileUnitsFactor)),function(b,E,S){for(let D=0;D<E.length;D++){let R=E[D];if(b.length>=3){for(let k=0;k<R.length;k++)if(wc(b,R[k]))return!0}if(TB(b,R,S))return!0}return!1}(p,a,_)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:sv,background:class extends xr{constructor(t,e,r,a){super(t,oV,e,r,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,r){return{overrideFog:!1}}},raster:T2,"raster-particle":E2,sky:class extends xr{constructor(t,e,r,a){super(t,fV,e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ng({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),u=!a,d=t.style.light,p=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&Pi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?dT(p.azimuthal,90-p.polar,e):dT(a[0],90-a[1],e)}let r=this.paint.get("sky-gradient-center");return dT(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends xr{constructor(t,e,r,a){super(t,pV,e,null)}},model:class extends xr{constructor(t,e,r,a){super(t,TV,e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new pT(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof _v?rt-1:0}queryIntersectsFeature(t,e,r,a,u,d){if(!this.modelManager)return!1;let p=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof pT))return!1;let y=_;for(let b in y.instancesPerModel){let E=y.instancesPerModel[b],S=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(S)){let D=E.features[E.idToFeaturesIndex[S]],R=p.getModel(b,this.scope);if(!R)return!1;let k=i.ad.create(),F=new bn(0,0),z=y.canonical,j=Number.MAX_VALUE;for(let Y=0;Y<D.instancedDataCount;++Y){let X=16*(D.instancedDataOffset+Y),K=E.instancedDataArray.float32,le=[K[X+4],K[X+5],K[X+6]];X2(z,F,K[X],0|K[X+1]),O2(k,R,d,F,D.rotation,D.scale,le,!1,!1,!1),d.projection.name==="globe"&&(k=fT(k,d));let se=i.ad.multiply([],d.projMatrix,k),me=t.queryGeometry,_e=A2(me.isPointQuery()?me.screenBounds:me.screenGeometry,d,se,R.aabb);_e!=null&&(j=Math.min(_e,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof G}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,r,a){let u=t.tile,d=u.getBucket(this),p=null,_=Number.MAX_VALUE;if(!(d&&d instanceof _v))return{queryFeature:p,intersectionZ:_};let y=d.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!r.filter(new jt(u.tileID.overscaledZ),y.feature,u.tileID.canonical))return{queryFeature:p,intersectionZ:_};let b=y.node,E=a.calculatePosMatrix(u.tileID.toUnwrapped(),a.worldSize),S=y.evaluatedScale,D=0;a.elevation&&b.elevation&&(D=b.elevation*a.elevation.exaggeration()),i.ad.translate(E,E,[(b.anchor?b.anchor[0]:0)*(S[0]-1),(b.anchor?b.anchor[1]:0)*(S[1]-1),D]),i.ad.scale(E,E,S),i.ad.multiply(E,E,b.matrix);let R=t.queryGeometry,k=R.isPointQuery()?R.screenBounds:R.screenGeometry,F=function(j){let Y=i.ad.multiply([],E,j.matrix),X=i.ad.multiply(Y,a.expandedFarZProjMatrix,Y);for(let K=0;K<j.meshes.length;++K){let le=j.meshes[K];if(K===j.lightMeshIndex)continue;let se=A2(k,a,X,le.aabb);se!=null&&(_=Math.min(se,_))}if(j.children)for(let K of j.children)F(K)};if(F(b),_===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:_};let z=new bn(0,0);return X2(u.tileID.canonical,z,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[z.lng,z.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:_}}},clip:class extends xr{constructor(t,e,r,a){super(t,n5,e,r,a)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new RM(t)}isTileClipped(){return!0}is3D(){return!0}}};J(m2,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let K2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ET{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);let d=K2[15&a];if(!d)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new ET(_,p,d,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let d=K2.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return IT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:p,nodeSize:_}=this,y=[0,d.length-1,0],b=[];for(;y.length;){let E=y.pop()||0,S=y.pop()||0,D=y.pop()||0;if(S-D<=_){for(let z=D;z<=S;z++){let j=p[2*z],Y=p[2*z+1];j>=e&&j<=a&&Y>=r&&Y<=u&&b.push(d[z])}continue}let R=D+S>>1,k=p[2*R],F=p[2*R+1];k>=e&&k<=a&&F>=r&&F<=u&&b.push(d[R]),(E===0?e<=k:r<=F)&&(y.push(D),y.push(R-1),y.push(1-E)),(E===0?a>=k:u>=F)&&(y.push(R+1),y.push(S),y.push(1-E))}return b}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:d,nodeSize:p}=this,_=[0,u.length-1,0],y=[],b=a*a;for(;_.length;){let E=_.pop()||0,S=_.pop()||0,D=_.pop()||0;if(S-D<=p){for(let z=D;z<=S;z++)J2(d[2*z],d[2*z+1],e,r)<=b&&y.push(u[z]);continue}let R=D+S>>1,k=d[2*R],F=d[2*R+1];J2(k,F,e,r)<=b&&y.push(u[R]),(E===0?e-a<=k:r-a<=F)&&(_.push(D),_.push(R-1),_.push(1-E)),(E===0?e+a>=k:r+a>=F)&&(_.push(R+1),_.push(S),_.push(1-E))}return y}}function IT(t,e,r,a,u,d){if(u-a<=r)return;let p=a+u>>1;Q2(t,e,p,a,u,d),IT(t,e,r,a,p-1,1-d),IT(t,e,r,p+1,u,1-d)}function Q2(t,e,r,a,u,d){for(;u>a;){if(u-a>600){let b=u-a+1,E=r-a+1,S=Math.log(b),D=.5*Math.exp(2*S/3),R=.5*Math.sqrt(S*D*(b-D)/b)*(E-b/2<0?-1:1);Q2(t,e,r,Math.max(a,Math.floor(r-E*D/b+R)),Math.min(u,Math.floor(r+(b-E)*D/b+R)),d)}let p=e[2*r+d],_=a,y=u;for(Dg(t,e,a,r),e[2*u+d]>p&&Dg(t,e,a,u);_<y;){for(Dg(t,e,_,y),_++,y--;e[2*_+d]<p;)_++;for(;e[2*y+d]>p;)y--}e[2*a+d]===p?Dg(t,e,a,y):(y++,Dg(t,e,y,u)),y<=r&&(a=y+1),r<=y&&(u=y-1)}}function Dg(t,e,r,a){CT(t,r,a),CT(e,2*r,2*a),CT(e,2*r+1,2*a+1)}function CT(t,e,r){let a=t[e];t[e]=t[r],t[r]=a}function J2(t,e,r,a){let u=t-r,d=e-a;return u*u+d*d}i.$=Ua,i.A=Ju,i.B=ca,i.C=Tn,i.D=Cr,i.E=Za,i.G=Yi,i.H=h,i.I=k4,i.J=H1,i.K=function(t){let e=t.value,r=[];if(!e)return r;let a=Xa(e);return a!=="string"?(r=r.concat([new hv(t.key,e,`string expected, "${a}" found`)]),r):(P2(e,!0)||(r=r.concat([new hv(t.key,e,`invalid url "${e}"`)])),r)},i.L=Ee,i.M=class{constructor(t,e,r,a){this.id=t,this.position=e!=null?new bn(e[0],e[1]):new bn(0,0),this.orientation=r??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(i.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let r of t.meshes){let a=gi.applyTransform(r.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){let t=i.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,r,a,u,d,p=!1){O2(this.matrix,this,t.transform,this.position,e,r,a,u,d,p)}upload(t){if(!this.uploaded){for(let e of this.nodes)mT(e,t);for(let e of this.nodes)dv(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)gT(t)}},i.N=On,i.O=Be,i.P=lt,i.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return _s(t.expression.evaluate(e))}interpolate(t,e,r){return{x:St(t.x,e.x,r),y:St(t.y,e.y,r),z:St(t.z,e.z,r),azimuthal:St(t.azimuthal,e.azimuthal,r),polar:St(t.polar,e.polar,r)}}},i.R=Pd,i.S=ow,i.T=os,i.U=Ln,i.V=hv,i.W=_r,i.X=jt,i.Y=Dr,i.Z=G,i.a=xo,i.a$=function(t){let{x:e,y:r}=t.point,{lng:a,lat:u}=t._center;return yM(e,r,t.worldSize,a,u)},i.a0=pn,i.a1=ul,i.a2=St,i.a3=rt,i.a4=Oy,i.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([r,a]){let u=_s([1,r,a]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return{x:St(t.x,e.x,r),y:St(t.y,e.y,r),z:St(t.z,e.z,r)}}},i.a6=Ym,i.a7=v0,i.a8=sl,i.a9=qD,i.aB=function(t,e){let{x:r,y:a}=t.point,u=yM(r,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return i.ad.multiply(u,u,Aw(pa(e)))},i.aD=yf,i.aE=Fo,i.aF=G0,i.aG=function(t,e,r,a,u){let d=5*e+2;t.float32[d+0]=r,t.float32[d+1]=a,t.float32[d+2]=u},i.aH=tv,i.aI=bn,i.aJ=s2,i.aK=XD,i.aL=Hi,i.aM=Sw,i.aN=C2,i.aO=dh,i.aP=mM,i.aQ=function(t,e,r,a,u,d,p,_,y){if(y.name==="globe")return mM(t,e,new dh(r,a,u),!1);let b=gh({z:r,x:a,y:u},y);return new gi([(d+b.x/b.scale)*e,e*(b.y/b.scale),p],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},i.aR=function(t,e,r){let a=0;for(let u=0;u<2;++u)t[u]>0&&(a+=(t[u]-0)*(t[u]-0)),e[u]<0&&(a+=(0-e[u])*(0-e[u]));return a},i.aS=ki,i.aT=Iw,i.aU=ZD,i.aV=function(t){let e=i.ad.identity(new Float64Array(16));i.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let r=[0,is,0],a=[0,rs,0];return i._.transformMat4(r,r,e),i._.transformMat4(a,a,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Rw(t,new bn(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!Rw(t,new bn(t.center.lat,-90))]},i.aW=function(t,e){let{scale:r}=t.tileTransform,a=r*rt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return i.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},i.aX=cv,i.aY=I2,i.aZ=function(t){let e=I2(t,!0);return i.aC.invert([],[e[0],e[1],e[4],e[5]])},i.a_=Cw,i.aa=Zr,i.ab=dn,i.ac=function(t,e,r){let a=Math.sqrt(t*t+e*e+r*r),u=a>0?Math.acos(r/a)*Cu:0,d=t!==0||e!==0?Math.atan2(-e,-t)*Cu+90:0;return d<0&&(d+=360),[a,d,u]},i.ae=Tf,i.af=Ms,i.ag=tT,i.ah=function(t,e){let r={};for(let a=0;a<e.length;a++){let u=e[a];u in t&&(r[u]=t[u])}return r},i.ai=bc,i.aj=da,i.ak=fa,i.al=nf,i.am=function(t){Md++,Md>om&&(t.getActor().send("enforceCacheSizeLimit",rm),Md=0)},i.an=fm,i.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,r,a){let u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){let[d,p]=u.result;return this.scheduler?this.scheduler.add(()=>{a(d,p)},e):a(d,p),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=r((d,p)=>{u.result=[d,p];for(let _ of u.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,p)},e):_(d,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(d=>d!==a),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}},i.ap=function(t,e,r){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{let d=qa(t.request,(p,_,y,b)=>{p?u(p):_&&u(null,{vectorTile:r?void 0:new Bw(new _f(_)),rawData:_,cacheControl:y,expires:b})});return()=>{d.cancel(),u()}},e)},i.aq=cw,i.ar=class extends ol{constructor(t){super(t),this.current=cB}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},i.as=uw,i.at=Jt,i.au=$a,i.aw=Pu,i.ax=Xr,i.ay=sr,i.az=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},i.b=mi,i.b$=Ic,i.b0=gr,i.b1=fw,i.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return by[e]},i.b3=45,i.b4=gw,i.b5=x0,i.b6=gi,i.b7=_s,i.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},i.b9=Xp,i.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},i.bB=yA,i.bD=_M,i.bE=Cd,i.bF=Id,i.bG=256,i.bH=function(t,e){let r=[0,0,0],a=tg(pa(e.canonical));return i._.transformMat4(r,r,a),i._.transformMat4(r,r,t),r},i.bI=t=>({u_camera_to_center_distance:new Zr(t),u_extrude_scale:new hw(t),u_device_pixel_ratio:new Zr(t),u_matrix:new Ym(t),u_inv_rot_matrix:new Ym(t),u_merc_center:new sl(t),u_tile_id:new cw(t),u_zoom_transition:new Zr(t),u_up_dir:new cw(t),u_emissive_strength:new Zr(t)}),i.bJ=t=>({u_matrix:new Ym(t),u_pixels_to_tile_units:new hw(t),u_device_pixel_ratio:new Zr(t),u_units_to_pixels:new sl(t),u_dash_image:new v0(t),u_gradient_image:new v0(t),u_image_height:new Zr(t),u_texsize:new sl(t),u_tile_units_to_pixels:new Zr(t),u_alpha_discard_threshold:new Zr(t),u_trim_offset:new sl(t),u_trim_fade_range:new sl(t),u_trim_color:new uw(t),u_emissive_strength:new Zr(t)}),i.bK=t=>({u_matrix:new Ym(t),u_texsize:new sl(t),u_pixels_to_tile_units:new hw(t),u_device_pixel_ratio:new Zr(t),u_image:new v0(t),u_units_to_pixels:new sl(t),u_tile_units_to_pixels:new Zr(t),u_alpha_discard_threshold:new Zr(t),u_trim_offset:new sl(t)}),i.bL=Q1,i.bM=$5,i.bN=br,i.bO=a4,i.bP=KA,i.bQ=Zw,i.bR=bM,i.bS=(t,e,r,a,u,d)=>{let p=t.transform,_=p.projection.name==="globe",y;if(d.paint.get("circle-pitch-alignment")==="map")if(_){let E=_M(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([E,0,0,E])}else y=p.calculatePixelsToTileUnitsMatrix(r);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:rr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:kB,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){b.u_inv_rot_matrix=a,b.u_merc_center=u,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=ul(p.zoom);let E=u[0]*rt,S=u[1]*rt;b.u_up_dir=p.projection.upVector(new dh(0,0,0),E,S)}return b},i.bT=bA,i.bU=(t,e,r,a,u,d)=>{let p=t.transform;return{u_matrix:xA(t,e,r,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:vA(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},i.bV=(t,e,r,a,u,d,p)=>{let _=t.transform,y=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:xA(t,e,r,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:wA(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:vA(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength")}},i.bW=Kp,i.bX=ng,i.bY=uA,i.bZ=_B,i.b_=B0,i.ba=function(t,e,r){let a=ul(r.zoom),u=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!u&&!d},i.bb=function(t){let e=t.pixelsPerMeter,r=e/Xr(1,t.center.lat),a=i.ad.identity(new Float64Array(16));return i.ad.translate(a,a,[t.point.x,t.point.y,0]),i.ad.scale(a,a,[r,r,e]),Float32Array.from(a)},i.bc=C0,i.bd=function(t){let e=ki-5;t=Jt(t,-e,e)/e*90;let r=Math.pow(Math.abs(Math.sin(dn(t))),3);return Math.round(r*(pw.length-1))},i.be=function(t,e,r,a){let u=e.getNorth(),d=e.getSouth(),p=e.getWest(),_=e.getEast(),y=1<<t.z,b=_-p,E=u-d,S=b/af,D=-E/pw[r],R=[0,S,0,D,0,0,u,p,0];if(t.z>0){let k=180/a;i.bC.multiply(R,R,[k/b+1,0,0,0,k/E+1,0,-.5*k/S,.5*k/D,1])}return R[2]=y,R[5]=t.x,R[8]=t.y,R},i.bf=tg,i.bg=pa,i.bh=function(t,e,r){let a=i.ad.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return i.ad.rotateY(a,r.globeMatrix,u),Float32Array.from(a)},i.bi=Zl,i.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},i.bk=T2,i.bl=E2,i.bm=w2,i.bn=function(t,e){let r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<t.length;a++){let u=document.createElement("source");Cy(t[a])||(r.crossOrigin="Anonymous"),u.src=t[a],r.appendChild(u)}return{cancel:()=>{}}},i.bo=nv,i.bp=wd,i.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let r=e.getSource().maxzoom,a=1<<r,u=Math.floor(t.x),d=Math.floor((t.x-u)*a),p=Math.floor(t.y*a),_=this.findDEMTileFor(new Hi(r,u,r,d,p));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let u=a.getSource().maxzoom,d=1<<u,p=Math.floor(t.x),_=t.x-p,y=new Hi(u,p,u,Math.floor(_*d),Math.floor(t.y*d)),b=this.findDEMTileFor(y);if(!b||!b.dem)return e;let E=b.dem,S=1<<b.tileID.canonical.z,D=(_*S-b.tileID.canonical.x)*E.dim,R=(t.y*S-b.tileID.canonical.y)*E.dim,k=Math.floor(D),F=Math.floor(R);return(r?this.exaggeration():1)*St(St(E.get(k,F),E.get(k,F+1),R-F),St(E.get(k+1,F),E.get(k+1,F+1),R-F),D-k)}getAtTileOffset(t,e,r){let a=1<<t.canonical.z;return this.getAtPointOrZero(new Dr(t.wrap+(t.canonical.x+e/rt)/a,(t.canonical.y+r/rt)/a))}getAtTileOffsetFunc(t,e,r,a){return u=>{let d=this.getAtTileOffset(t,u.x,u.y),p=a.upVector(t.canonical,u.x,u.y),_=a.upVectorScale(t.canonical,e,r).metersToTile;return i._.scale(p,p,d*_),p}}getForTilePoints(t,e,r,a){if(this.isUsingMockSource())return!1;let u=pf.create(this,t,a);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let r=e.dem.tree,a=e.tileID,u=1<<t.canonical.z-a.canonical.z,d=t.canonical.x/u-a.canonical.x,p=t.canonical.y/u-a.canonical.y,_=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!r.leaves[_];y++){d*=2,p*=2;let b=2*Math.floor(p)+Math.floor(d);_=r.childOffsets[_]+b,d%=1,p%=1}return{min:this.exaggeration()*r.minimums[_],max:this.exaggeration()*r.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,r=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let u of t){let d=this.getMinMaxForTile(u.tileID);d&&(r=Math.min(r,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:r,max:a}:null}},i.br=Jm,i.bs=I0,i.bt=Es,i.bu=Qi,i.bv=_h,i.bw=_T,i.bx=fv,i.by=ov,i.bz=SM,i.c=H2,i.c$=ku,i.c0=450,i.c1=7,i.c2=lV,i.c3=g2,i.c4=256,i.c5=fM,i.c6=Aw,i.c7=An,i.c8=gc,i.c9=ch,i.cA=function(t){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(let d of t)e=Math.min(e,d.x),r=Math.min(r,d.y),a=Math.max(a,d.x),u=Math.max(u,d.y);return{min:new lt(e,r),max:new lt(a,u)}},i.cB=wc,i.cC=eM,i.cD=Yr,i.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.cF=GA,i.cG=bw,i.cH=$M,i.cI=GM,i.cJ=Qw,i.cK=ET,i.cL=function(t){return t({pluginStatus:He,pluginURL:st}),Ht.on("pluginStateChange",t),t},i.cM=xf,i.cN=Xw,i.cO=Rd,i.cP=pt,i.cQ=U,i.cR=im,i.cS=Jl,i.cT=Ko,i.cU=function(t){let e=t.indexOf(fc);return e>=0?t.slice(0,e):t},i.cV=function(t){return t.indexOf(fc)>=0},i.cW=function(t){let e=t.indexOf(fc);return e>=0?t.slice(e+1):""},i.cX=function(t){let e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cY=function(t,e,r,a){return t.type==="custom"?new hV(t,e):new jV[t.type](t,e,r,a)},i.cZ=Ga,i.c_=Ht,i.ca=1,i.cb=yg,i.cc=0,i.cd=nw,i.ce=function(t,e,r,a,u){return Jt((t-e)/(r-e)*(u-a)+a,a,u)},i.cf=s0,i.cg=fh,i.ch=class{constructor(t,e,r,a){this.context=t,this.format=a,this.size=r,this.texture=t.gl.createTexture();let[u,d,p]=this.size,{gl:_}=t;_.bindTexture(_.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,b=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,b=_.UNSIGNED_SHORT),this.format===_.R8&&(a=_.RED),this.format===_.R32F&&(b=_.FLOAT,a=_.RED),_.texImage3D(_.TEXTURE_3D,0,y,u,d,p,0,a,b,e.data)}bind(t,e){let{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_3D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},i.ci=fT,i.cj=[1,1,1],i.ck=pf,i.cl=Sf,i.cm=yc,i.cn=of,i.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new lt(1/0,1/0),max:new lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let r=VM(new lt(0,0),new lt(rt,rt),t),a=[];if(e&&!Vw(r,this._globalClipBounds))return a;for(let u of this._activeRegions){if(u.hiddenByOverlap||!Vw(r,u))continue;let d=g5(u.min,u.max,t);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask})}return a}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let r=[];for(let a of e.cache.getVisibleCoordinates()){let u=e.cache.getTile(a).buckets[e.layer];u&&u.updateFootprints(a.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let r=t.getOrder(),a=t.getClipMask();for(let u of e){if(!u.footprint)continue;let d=VM(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:r,clipMask:a})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||F0(e.min,r.min)||F0(e.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let r=this._activeRegions[e],a=this._prevRegions[e];t=r.priority!==a.priority||!BM(r,a)||r.order!==a.order||r.clipMask!==a.clipMask,++e}}if(t){++this._updateTime;for(let r of this._activeRegions)r.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));let e=r=>{let a=this._activeRegions;if(r>=a.length)return r;let u=a[r].priority;for(;r<a.length&&a[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,a=e(r);for(;r!==a;){let u=r,d=r;for(;u!==a;){let p=this._activeRegions[u];p.hiddenByOverlap=!1;for(let _=0;_<d;_++){let y=this._activeRegions[_];if(!y.hiddenByOverlap&&p.order===1/0&&Vw(p,y)&&(p.hiddenByOverlap=UM(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++u}r=a,a=e(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},i.cp=pc,i.cq=rv,i.cr=Wm,i.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let r=new Es,a=new Qi,u=[],d=t+1+2,p=e[0]+1,_=e[0]+1+(1+e.length),y=(b,E,S)=>{let D=b===d-1?b-2:b===0?b:b-1;return D+=S?24575:0,[D,E]};for(let b=0;b<d;++b)r.emplaceBack(...y(b,0,!0));for(let b=0;b<p;++b)for(let E=0;E<d;++E)r.emplaceBack(...y(E,b,(E===0||E===d-1)&&!0));for(let b=0;b<e.length;++b){let E=e[b];for(let S=0;S<d;++S)r.emplaceBack(...y(S,E,!0))}for(let b=0;b<e.length;++b){let E=a.length,S=e[b]+1+2,D=new Qi;for(let F=0;F<S-1;F++){let z=F===S-2,j=z?d*(_-e.length+b-F):d;for(let Y=0;Y<d-1;Y++){let X=F*d+Y;F===0||z||Y===0||Y===d-2?(D.emplaceBack(X+1,X,X+j),D.emplaceBack(X+j,X+j+1,X+1)):(a.emplaceBack(X+1,X,X+j),a.emplaceBack(X+j,X+j+1,X+1))}}let R=mi.simpleSegment(0,E,r.length,a.length-E);for(let F=0;F<D.uint16.length;F+=3)a.emplaceBack(D.uint16[F],D.uint16[F+1],D.uint16[F+2]);let k=mi.simpleSegment(0,E,r.length,a.length-E);u.push({withoutSkirts:R,withSkirts:k})}return{vertices:r,indices:a,segments:u}}_createGrid(t){let e=this._fillGridMeshWithLods(af,pw);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Jm.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Qi;for(let p=0;p<=af;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let r=new ch,a=new ch,u=new ch,d=new ch;this._poleSegments=[];for(let p=0,_=0;p<fw;p++){let y=360/(1<<p);r.emplaceBack(0,-Yr,0,.5,0),a.emplaceBack(0,-Yr,0,.5,1),u.emplaceBack(0,-Yr,0,.5,.5),d.emplaceBack(0,-Yr,0,.5,.5);for(let b=0;b<=af;b++){let E=b/af,S=0,D=St(0,y,E),[R,k,F]=lf(PB,RB,D,Yr);r.emplaceBack(R,k,F,E,S),a.emplaceBack(R,k,F,E,1-S);let z=dn(D);E=.5+.5*Math.sin(z),S=.5+.5*Math.cos(z),u.emplaceBack(R,k,F,E,S),d.emplaceBack(R,k,F,E,1-S)}this._poleSegments.push(mi.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,E0,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,E0,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,E0,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,E0,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},i.ct=function(t){return zu.has(t)},i.cu=QM,i.cv=function(t,e,r=0,a=!0){let u=new lt(r,r),d=t.sub(u),p=e.add(u),_=[d,new lt(p.x,d.y),p,new lt(d.x,p.y)];return a&&_.push(d.clone()),_},i.cw=function(t,e){let r=[];for(let a=0;a<t.length;a++){let u=$a(a-1,-1,t.length-1),d=$a(a+1,-1,t.length-1),p=t[a],_=t[d],y=t[u].sub(p).unit(),b=_.sub(p).unit(),E=b.angleWithSep(y.x,y.y),S=y.add(b).unit().mult(-1*e/Math.sin(E/2));r.push(p.add(S))}return r},i.cx=t2,i.cy=oM,i.cz=function(t,e,r=0){return i._.fromValues(((e.x-r)*t.scale-t.x)*rt,(e.y*t.scale-t.y)*rt,KD(e.z,e.y))},i.d=Fd,i.d$=vd,i.d0=Su,i.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.d2=Gl,i.d3=JD,i.d4=hh,i.d5=function([t,e,r]){let a=Math.hypot(t,e,r),u=Math.atan2(t,r),d=.5*Math.PI-Math.acos(-e/a);return new bn(gr(u),gr(d))},i.d6=no,i.d7=cf,i.d8=A,i.d9=Rw,i.dA=function(t){let e=Ey();if(!e)return;let r=e.delete(Ty);t&&r.catch(t).then(()=>t())},i.dB=Tg,i.dC=F2,i.dD=function(t){vT=rr.resolveURL(t),Mf||(Mf=new _T(fv(),new Za)),Mf.broadcast("setDracoUrl",vT)},i.dE=N2,i.dF=function(t){Df=rr.resolveURL(t),Mf||(Mf=new _T(fv(),new Za)),Mf.broadcast("setMeshoptUrl",Df)},i.dG=mo,i.dH=J,i.dI=Tc,i.dJ=Ds,i.dK=gh,i.dL=aw,i.dM=TA,i.dN=AA,i.dO=gA,i.dP=ql,i.dQ=qA,i.dR=Ef,i.dS=function(t,e,r,a,u,d,p,_,y,b,E){t.createArrays(),t.tilePixelRatio=rt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let S=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:Y}=t.textSizeData;R.compositeTextSizes=[D["text-size"].possiblyEvaluate(new jt(j),_),D["text-size"].possiblyEvaluate(new jt(Y),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:Y}=t.iconSizeData;R.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new jt(j),_),D["icon-size"].possiblyEvaluate(new jt(Y),_)]}R.layoutTextSize=D["text-size"].possiblyEvaluate(new jt(y+1),_),R.layoutIconSize=D["icon-size"].possiblyEvaluate(new jt(y+1),_),R.textMaxSize=D["text-size"].possiblyEvaluate(new jt(18),_);let k=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",F=S.get("text-size"),z=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){z=!0;break}for(let j of t.features){let Y=S.get("text-font").evaluate(j,{},_).join(","),X=F.evaluate(j,{},_),K=R.layoutTextSize.evaluate(j,{},_),le=(R.layoutIconSize.evaluate(j,{},_),{horizontal:{},vertical:void 0}),se=j.text,me,_e=[0,0];if(se){let De=se.toString(),ze=S.get("text-letter-spacing").evaluate(j,{},_)*br,Ye=S.get("text-line-height").evaluate(j,{},_)*br,Le=Me(De)?ze:0,qe=S.get("text-anchor").evaluate(j,{},_),Oe=S.get("text-variable-anchor");if(!Oe){let Xe=S.get("text-radial-offset").evaluate(j,{},_);_e=Xe?KA(qe,[Xe*br,Kw]):S.get("text-offset").evaluate(j,{},_).map(nt=>nt*br)}let We=k?"center":S.get("text-justify").evaluate(j,{},_),Je=S.get("symbol-placement")==="point",Ze=Je?S.get("text-max-width").evaluate(j,{},_)*br:1/0,ht=Xe=>{t.allowVerticalPlacement&&Ce(De)&&(le.vertical=Ww(se,e,r,u,Y,Ze,Ye,qe,Xe,Le,_e,Fo.vertical,!0,K,X))};if(!k&&Oe){let Xe=We==="auto"?Oe.map(Et=>Qw(Et)):[We],nt=!1;for(let Et=0;Et<Xe.length;Et++){let xt=Xe[Et];if(!le.horizontal[xt])if(nt)le.horizontal[xt]=le.horizontal[0];else{let _t=Ww(se,e,r,u,Y,Ze,Ye,"center",xt,Le,_e,Fo.horizontal,!1,K,X);_t&&(le.horizontal[xt]=_t,nt=_t.positionedLines.length===1)}}ht("left")}else{if(We==="auto"&&(We=Qw(qe)),Je||S.get("text-writing-mode").indexOf("horizontal")>=0||!Ce(De)){let Xe=Ww(se,e,r,u,Y,Ze,Ye,qe,We,Le,_e,Fo.horizontal,!1,K,X);Xe&&(le.horizontal[We]=Xe)}ht(Je?"left":We)}}let Te=!1;if(j.icon&&j.icon.namePrimary){let De=a[j.icon.namePrimary];De&&(me=g4(u[j.icon.namePrimary],j.icon.nameSecondary?u[j.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(j,{},_),S.get("icon-anchor").evaluate(j,{},_)),Te=De.sdf,t.sdfIcons===void 0?t.sdfIcons=De.sdf:t.sdfIcons!==De.sdf&&Pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==t.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let ke=JA(le.horizontal)||le.vertical;t.iconsInText||(t.iconsInText=!!ke&&ke.iconsInText),(ke||me)&&T4(t,j,le,me,a,R,K,0,_e,Te,p,_,b,E,z)}d&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},i.dT=V0,i.dU=R0,i.dV=Bw,i.dW=_f,i.dX=N0,i.dY=cT,i.dZ=O0,i.d_=k0,i.da=vM,i.db=function(t){let e=[0,0,0],r=i.ad.identity(new Float64Array(16));return i.ad.multiply(r,t.pixelMatrix,t.globeMatrix),i._.transformMat4(e,e,r),new lt(e[0],e[1])},i.dc=Se,i.dd=be,i.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(r){if(Ed==null){let a=r.navigator?r.navigator.userAgent:null;Ed=!!r.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ed}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.df=xd,i.dg=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",hm,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!U(t))return t;let r=Mo(t);return r.params.push(`sdk=js-${w}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!U(t))return t;let r=Mo(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeModelURL(t,e){if(!U(t))return t;let r=Mo(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,a){if(!U(t))return t;let u=Mo(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),r&&u.params.push(`language=${r}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,a){let u=Mo(t);return U(t)?(u.path=`/styles/v1${u.path}/sprite${e}${r}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${r}`,Kl(u))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!U(t))return t;let a=Mo(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${Ad.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${A.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${A.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${A.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${A.TILE_URL_VERSION}${a.path}`);let u=this._customAccessToken||function(d){for(let p of d){let _=p.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(a.params)||A.ACCESS_TOKEN;return A.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(t,e){let r=Mo(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${A.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${r.path.replace(`/${A.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${A.TILE_URL_VERSION}/`,"")}`;let u=r.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(t,e){let r=!!e&&U(e),a=[];for(let u of t.tiles||[])L(u)?a.push(this.canonicalizeTileURL(u,r)):a.push(u);return a}_makeAPIURL(t,e){let r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Mo(A.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!A.REQUIRE_ACCESS_TOKEN)return Kl(t);if(e=e||A.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Kl(t)}},i.dh=function(t,e){e?zu.add(t):zu.delete(t)},i.di=Ad,i.dj=D1,i.dk=Ld,i.dl=dm,i.dm=My,i.dn=S1,i.dp=function(t){zu.delete(t)},i.dq=Ql,i.dr=Nu,i.ds=Hl,i.dt=w,i.du=function(t,e){rm=t,om=e},i.dv=function(t,e,r=!1){if(He===ot||He===ct||He===at)throw new Error("setRTLTextPlugin cannot be called multiple times.");st=rr.resolveURL(t),He=ot,je=e,Ot(),r||cn()},i.dw=fn,i.dx=function(){fv().acquire(yT)},i.dy=function(){let t=Ig;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(yT),Ig=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dz=Eg,i.e=rr,i.e0=EA,i.e1=Fe,i.e2=qa,i.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==B2){let r=new Uint32Array(t,0,7),[,,a,u,d,p]=r;e=r.byteLength+u+d+p+d,(a!==t.byteLength||e>=t.byteLength)&&Pi("Invalid b3dm header information.")}return $2(t,e)},i.e4=function(t,e){let r=H2(t);for(let a of r){for(let u of a.meshes)NV(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(zV(a.lights,e)))}return r},i.e5=_v,i.e6=L2,i.e7=kn,i.e8=function(t){Ru(),vs&&vs.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-t;a++)e.delete(r[a])})})},i.f=Fr,i.g=function(t,e){return ku(_r(t,{type:"json"}),e)},i.h=na,i.i=Lo,i.j=HA,i.k=Yw,i.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>$2(e,0,t))},i.m=class extends hv{},i.n=Xa,i.o=_m,i.p=N4,i.q=tf,i.r=m,i.s=s,i.t=N,i.u=Vr,i.v=vr,i.w=Pi,i.x=H,i.y=B,i.z=Hd}),c(["./shared"],function(i){function w(ye){let $=ye?ye.url.toString():void 0;return $?performance.getEntriesByName($):[]}function C(ye){if(typeof ye=="number"||typeof ye=="boolean"||typeof ye=="string"||ye==null)return JSON.stringify(ye);if(Array.isArray(ye)){let Z="[";for(let oe of ye)Z+=`${C(oe)},`;return`${Z}]`}let $="{";for(let Z of Object.keys(ye).sort())$+=`${Z}:${C(ye[Z])},`;return`${$}}`}function A(ye){let $="";for(let Z of i.cE)$+=`/${C(ye[Z])}`;return $}class L{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,Z){this._layerConfigs={},this._layers={},this.update($,[],Z)}update($,Z,oe){this._options=oe;for(let pe of $)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=i.cY(pe,this.scope,null,this._options)).compileFilter(),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(let pe of Z)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};let de=function(pe,we){let Ae={};for(let Pe=0;Pe<pe.length;Pe++){let it=we&&we[pe[Pe].id]||A(pe[Pe]);we&&(we[pe[Pe].id]=it);let Qe=Ae[it];Qe||(Qe=Ae[it]=[]),Qe.push(pe[Pe])}let ve=[];for(let Pe in Ae)ve.push(Ae[Pe]);return ve}(i.dG(this._layerConfigs),this.keyCache);for(let pe of de){let we=pe.map(yt=>this._layers[yt.id]),Ae=we[0];if(Ae.visibility==="none")continue;let ve=Ae.source||"",Pe=this.familiesBySource[ve];Pe||(Pe=this.familiesBySource[ve]={});let it=Ae.sourceLayer||"_geojsonTileLayer",Qe=Pe[it];Qe||(Qe=Pe[it]=[]),Qe.push(we)}}}let U=1*i.dJ;class Q{constructor($){let Z={},oe=[];for(let Ae in $){let ve=$[Ae],Pe=Z[Ae]={};for(let it in ve.glyphs){let Qe=ve.glyphs[+it];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;let yt=Qe.metrics.localGlyph?U:1,Mt={x:0,y:0,w:Qe.bitmap.width+2*yt,h:Qe.bitmap.height+2*yt};oe.push(Mt),Pe[it]=Mt}}let{w:de,h:pe}=i.j(oe),we=new i.dI({width:de||1,height:pe||1});for(let Ae in $){let ve=$[Ae];for(let Pe in ve.glyphs){let it=ve.glyphs[+Pe];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;let Qe=Z[Ae][Pe],yt=it.metrics.localGlyph?U:1;i.dI.copy(it.bitmap,we,{x:0,y:0},{x:Qe.x+yt,y:Qe.y+yt},it.bitmap)}}this.image=we,this.positions=Z}}i.dH(Q,"GlyphAtlas");class fe{constructor($){this.tileID=new i.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.lut=$.lut,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.scope=$.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.promoteId=$.promoteId,this.isSymbolTile=$.isSymbolTile,this.tileTransform=i.dK($.tileID.canonical,$.projection),this.projection=$.projection,this.brightness=$.brightness,this.extraShadowCaster=!!$.extraShadowCaster,this.tessellationStep=$.tessellationStep}parse($,Z,oe,de,pe){this.status="parsing",this.data=$,this.collisionBoxArray=new i.dL;let we=new i.dM(Object.keys($.layers).sort()),Ae=new i.dN(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];let ve={},Pe=new i.dO(256,256),it={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Pe,availableImages:oe,brightness:this.brightness},Qe=Z.familiesBySource[this.source];for(let mt in Qe){let ai=$.layers[mt];if(!ai)continue;let Nn=!1,_n=!1,Ai=!1;for(let pr of Qe[mt])pr[0].type==="symbol"?Nn=!0:_n=!0,pr[0].is3D()&&pr[0].type!=="model"&&(Ai=!0);if(this.extraShadowCaster&&!Ai||this.isSymbolTile===!0&&!Nn||this.isSymbolTile===!1&&!_n)continue;ai.version===1&&i.w(`Vector tile source "${this.source}" layer "${mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let li=we.encode(mt),Vi=[];for(let pr=0;pr<ai.length;pr++){let mr=ai.feature(pr),Va=Ae.getId(mr,mt);Vi.push({feature:mr,id:Va,index:pr,sourceLayerIndex:li})}for(let pr of Qe[mt]){let mr=pr[0];(!this.extraShadowCaster||mr.is3D()&&mr.type!=="model")&&(this.isSymbolTile!==void 0&&mr.type==="symbol"!==this.isSymbolTile||mr.minzoom&&this.zoom<Math.floor(mr.minzoom)||mr.maxzoom&&this.zoom>=mr.maxzoom||mr.visibility!=="none"&&(he(pr,this.zoom,it.brightness,oe),(ve[mr.id]=mr.createBucket({index:Ae.bucketLayerIDs.length,layers:pr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:li,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Vi,it,this.tileID.canonical,this.tileTransform),Ae.bucketLayerIDs.push(pr.map(Va=>Va.id))))}}let yt,Mt,Qt,rn;Pe.trim();let $t={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},hn=()=>{if(yt)return this.status="done",pe(yt);if(this.extraShadowCaster)this.status="done",pe(null,{buckets:i.dG(ve).filter(mt=>!mt.isEmpty()),featureIndex:Ae,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:it.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mt&&Qt&&rn){let mt=new Q(Mt),ai=new i.dQ(Qt,rn,this.lut);for(let Nn in ve){let _n=ve[Nn];_n instanceof i.dR?(he(_n.layers,this.zoom,it.brightness,oe),i.dS(_n,Mt,mt.positions,Qt,ai.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):_n.hasPattern&&(_n instanceof i.dT||_n instanceof i.dU||_n instanceof i.b_)&&(he(_n.layers,this.zoom,it.brightness,oe),_n.addFeatures(it,this.tileID.canonical,ai.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",pe(null,{buckets:i.dG(ve).filter(Nn=>!Nn.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mt.image,lineAtlas:Pe,imageAtlas:ai,brightness:it.brightness})}};if(!this.extraShadowCaster){let mt=i.dP(it.glyphDependencies,_n=>Object.keys(_n).map(Number));Object.keys(mt).length?de.send("getGlyphs",{uid:this.uid,stacks:mt,scope:this.scope},(_n,Ai)=>{yt||(yt=_n,Mt=Ai,hn())},void 0,!1,$t):Mt={};let ai=Object.keys(it.iconDependencies);ai.length?de.send("getImages",{icons:ai,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(_n,Ai)=>{yt||(yt=_n,Qt=Ai,hn())},void 0,!1,$t):Qt={};let Nn=Object.keys(it.patternDependencies);Nn.length?de.send("getImages",{icons:Nn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(_n,Ai)=>{yt||(yt=_n,rn=Ai,hn())},void 0,!1,$t):rn={}}hn()}}function he(ye,$,Z,oe){let de=new i.X($,{brightness:Z});for(let pe of ye)pe.recalculate(de,oe)}class be extends i.E{constructor($,Z,oe,de,pe,we){super(),this.actor=$,this.layerIndex=Z,this.availableImages=oe,this.loadVectorData=pe||i.ap,this.loading={},this.loaded={},this.deduped=new i.ao($.scheduler),this.isSpriteLoaded=de,this.scheduler=$.scheduler,this.brightness=we}loadTile($,Z){let oe=$.uid,de=$&&$.request,pe=de&&de.collectResourceTiming,we=this.loading[oe]=new fe($);we.abort=this.loadVectorData($,(Ae,ve)=>{let Pe=!this.loading[oe];if(delete this.loading[oe],Pe||Ae||!ve)return we.status="done",Pe||(this.loaded[oe]=we),Z(Ae);let it=ve.rawData,Qe={};ve.expires&&(Qe.expires=ve.expires),ve.cacheControl&&(Qe.cacheControl=ve.cacheControl),we.vectorTile=ve.vectorTile||new i.dV(new i.dW(it));let yt=()=>{we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mt,Qt)=>{if(Mt||!Qt)return Z(Mt);let rn={};if(pe){let $t=w(de);$t.length>0&&(rn.resourceTiming=JSON.parse(JSON.stringify($t)))}Z(null,i.W({rawTileData:it.slice(0)},Qt,Qe,rn))})};this.isSpriteLoaded?yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yt,{type:"parseTile",isSymbolTile:$.isSymbolTile,zoom:$.tileZoom}):yt()}),this.loaded=this.loaded||{},this.loaded[oe]=we})}reloadTile($,Z){let oe=this.loaded,de=$.uid;if(oe&&oe[de]){let pe=oe[de];pe.showCollisionBoxes=$.showCollisionBoxes,pe.projection=$.projection,pe.brightness=$.brightness,pe.tileTransform=i.dK($.tileID.canonical,$.projection),pe.extraShadowCaster=$.extraShadowCaster,pe.lut=$.lut;let we=(Ae,ve)=>{let Pe=pe.reloadCallback;Pe&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,Pe)),Z(Ae,ve)};pe.status==="parsing"?pe.reloadCallback=we:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,we):we())}else Z(null,void 0)}abortTile($,Z){let oe=$.uid,de=this.loading[oe];de&&(de.abort&&de.abort(),delete this.loading[oe]),Z()}removeTile($,Z){let oe=this.loaded,de=$.uid;oe&&oe[de]&&delete oe[de],Z()}}class Se{loadTile($,Z){let{uid:oe,encoding:de,rawImageData:pe,padding:we}=$,Ae=ImageBitmap&&pe instanceof ImageBitmap?this.getImageData(pe,we):pe;Z(null,new i.dX(oe,Ae,de,we<1))}getImageData($,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);let oe=this.offscreenCanvasContext.getImageData(-Z,-Z,$.width+2*Z,$.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}class Ke{decodeRasterArray({task:$,buffer:Z},oe){i.dY.performDecoding(Z,$).then(de=>{oe(null,de)},de=>{oe(de)})}}let Fe=i.dZ.prototype.toGeoJSON,tt=class{constructor(ye){this._feature=ye,this.extent=i.a3,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){let ye=[];for(let $ of this._feature.geometry)ye.push([new i.P($[0],$[1])]);return ye}{let ye=[];for(let $ of this._feature.geometry){let Z=[];for(let oe of $)Z.push(new i.P(oe[0],oe[1]));ye.push(Z)}return ye}}toGeoJSON(ye,$,Z){return Fe.call(this,ye,$,Z)}},ft=class{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.a3,this.length=ye.length,this._features=ye}feature(ye){return new tt(this._features[ye])}},Ue=64/4096;class zt{constructor(){this.features=new Map}clear(){this.features.clear()}load($=[],Z){for(let oe of $){let de=oe.id;if(de==null)continue;let pe=this.features.get(de);pe&&this.updateCache(pe,Z),oe.geometry?(pe=tn(oe),this.updateCache(pe,Z),this.features.set(de,pe)):this.features.delete(de),this.updateCache(pe,Z)}}updateCache($,Z){for(let{canonical:oe,uid:de}of Object.values(Z)){let{z:pe,x:we,y:Ae}=oe;Kt($,Math.pow(2,pe),we,Ae)&&delete Z[de]}}getTile($,Z,oe){let de=Math.pow(2,$),pe=[];for(let we of this.features.values())Kt(we,de,Z,oe)&&pe.push(Ti(we,de,Z,oe));return{features:pe}}getFeatures(){return[...this.features.values()]}}function Kt({minX:ye,minY:$,maxX:Z,maxY:oe},de,pe,we){return ye<(pe+1+Ue)/de&&$<(we+1+Ue)/de&&Z>(pe-Ue)/de&&oe>(we-Ue)/de}function tn(ye){let{id:$,geometry:Z,properties:oe}=ye;if(!Z)return;if(Z.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:de,coordinates:pe}=Z,we={id:$,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ae=we.geometry;if(de==="Point")Tt(pe,Ae,we);else if(de==="MultiPoint")for(let ve of pe)Tt(ve,Ae,we);else if(de==="LineString")we.type=2,ri(pe,Ae,we);else if(de==="MultiLineString")we.type=2,Ct(pe,Ae,we);else if(de==="Polygon")we.type=3,Ct(pe,Ae,we,!0);else{if(de!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");we.type=3;for(let ve of pe)Ct(ve,Ae,we,!0)}return we}function Tt([ye,$],Z,oe){let de=i.aj(ye),pe=i.ak($);pe=pe<0?0:pe>1?1:pe,Z.push(de,pe),oe.minX=Math.min(oe.minX,de),oe.minY=Math.min(oe.minY,pe),oe.maxX=Math.max(oe.maxX,de),oe.maxY=Math.max(oe.maxY,pe)}function ri(ye,$,Z,oe=!1,de=!1){let pe=[];for(let we of ye)Tt(we,pe,Z);$.push(pe),oe&&function(we,Ae){let ve=0;for(let Pe=0,it=we.length,Qe=it-2;Pe<it;Qe=Pe,Pe+=2)ve+=(we[Pe]-we[Qe])*(we[Pe+1]+we[Qe+1]);if(ve>0===Ae)for(let Pe=0,it=we.length;Pe<it/2;Pe+=2){let Qe=we[Pe],yt=we[Pe+1];we[Pe]=we[it-2-Pe],we[Pe+1]=we[it-1-Pe],we[it-2-Pe]=Qe,we[it-1-Pe]=yt}}(pe,de)}function Ct(ye,$,Z,oe=!1){for(let de=0;de<ye.length;de++)ri(ye[de],$,Z,oe,de===0)}function Ti(ye,$,Z,oe){let{id:de,type:pe,geometry:we,tags:Ae}=ye,ve=[];if(pe===1)Ci(we,$,Z,oe,ve);else for(let Pe of we)ve.push(Ci(Pe,$,Z,oe));return{id:de,type:pe,geometry:ve,tags:Ae}}function Ci(ye,$,Z,oe,de=[]){for(let pe=0;pe<ye.length;pe+=2)de.push($i(ye[pe],ye[pe+1],$,Z,oe));return de}function $i(ye,$,Z,oe,de){return[Math.round(i.a3*(ye*Z-oe)),Math.round(i.a3*($*Z-de))]}var wn={exports:{}},Wo=i.d$,wt=i.d_.VectorTileFeature,Bt=qt;function qt(ye,$){this.options=$||{},this.features=ye,this.length=ye.length}function vn(ye,$){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=$||4096}qt.prototype.feature=function(ye){return new vn(this.features[ye],this.options.extent)},vn.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var $=0;$<ye.length;$++){for(var Z=ye[$],oe=[],de=0;de<Z.length;de++)oe.push(new Wo(Z[de][0],Z[de][1]));this.geometry.push(oe)}return this.geometry},vn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,$=1/0,Z=-1/0,oe=1/0,de=-1/0,pe=0;pe<ye.length;pe++)for(var we=ye[pe],Ae=0;Ae<we.length;Ae++){var ve=we[Ae];$=Math.min($,ve.x),Z=Math.max(Z,ve.x),oe=Math.min(oe,ve.y),de=Math.max(de,ve.y)}return[$,oe,Z,de]},vn.prototype.toGeoJSON=wt.prototype.toGeoJSON;var Lt=i.e0,dr=Bt;function ti(ye){var $=new Lt;return function(Z,oe){for(var de in Z.layers)oe.writeMessage(3,Jr,Z.layers[de])}(ye,$),$.finish()}function Jr(ye,$){var Z;$.writeVarintField(15,ye.version||1),$.writeStringField(1,ye.name||""),$.writeVarintField(5,ye.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ye.length;Z++)oe.feature=ye.feature(Z),$.writeMessage(2,pi,oe);var de=oe.keys;for(Z=0;Z<de.length;Z++)$.writeStringField(3,de[Z]);var pe=oe.values;for(Z=0;Z<pe.length;Z++)$.writeMessage(4,fr,pe[Z])}function pi(ye,$){var Z=ye.feature;Z.id!==void 0&&$.writeVarintField(1,Z.id),$.writeMessage(2,La,ye),$.writeVarintField(3,Z.type),$.writeMessage(4,Bn,Z)}function La(ye,$){var Z=ye.feature,oe=ye.keys,de=ye.values,pe=ye.keycache,we=ye.valuecache;for(var Ae in Z.properties){var ve=Z.properties[Ae],Pe=pe[Ae];if(ve!==null){Pe===void 0&&(oe.push(Ae),pe[Ae]=Pe=oe.length-1),$.writeVarint(Pe);var it=typeof ve;it!=="string"&&it!=="boolean"&&it!=="number"&&(ve=JSON.stringify(ve));var Qe=it+":"+ve,yt=we[Qe];yt===void 0&&(de.push(ve),we[Qe]=yt=de.length-1),$.writeVarint(yt)}}}function Rt(ye,$){return($<<3)+(7&ye)}function Li(ye){return ye<<1^ye>>31}function Bn(ye,$){for(var Z=ye.loadGeometry(),oe=ye.type,de=0,pe=0,we=Z.length,Ae=0;Ae<we;Ae++){var ve=Z[Ae],Pe=1;oe===1&&(Pe=ve.length),$.writeVarint(Rt(1,Pe));for(var it=oe===3?ve.length-1:ve.length,Qe=0;Qe<it;Qe++){Qe===1&&oe!==1&&$.writeVarint(Rt(2,it-1));var yt=ve[Qe].x-de,Mt=ve[Qe].y-pe;$.writeVarint(Li(yt)),$.writeVarint(Li(Mt)),de+=yt,pe+=Mt}oe===3&&$.writeVarint(Rt(7,1))}}function fr(ye,$){var Z=typeof ye;Z==="string"?$.writeStringField(1,ye):Z==="boolean"?$.writeBooleanField(7,ye):Z==="number"&&(ye%1!=0?$.writeDoubleField(3,ye):ye<0?$.writeSVarintField(6,ye):$.writeVarintField(5,ye))}wn.exports=ti,wn.exports.fromVectorTileJs=ti,wn.exports.fromGeojsonVt=function(ye,$){$=$||{};var Z={};for(var oe in ye)Z[oe]=new dr(ye[oe].features,$),Z[oe].name=oe,Z[oe].version=$.version,Z[oe].extent=$.extent;return ti({layers:Z})},wn.exports.GeoJSONWrapper=dr;var gs=i.e1(wn.exports);let Xs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},gu=Math.fround||(Ml=new Float32Array(1),ye=>(Ml[0]=+ye,Ml[0]));var Ml;let So=3,Do=5,_u=6;class kt{constructor($){this.options=Object.assign(Object.create(Xs),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){let{log:Z,minZoom:oe,maxZoom:de}=this.options;Z&&console.time("total time");let pe=`prepare ${$.length} points`;Z&&console.time(pe),this.points=$;let we=[];for(let ve=0;ve<$.length;ve++){let Pe=$[ve];if(!Pe.geometry)continue;let[it,Qe]=Pe.geometry.coordinates,yt=gu(Hr(it)),Mt=gu(Fa(Qe));we.push(yt,Mt,1/0,ve,-1,1),this.options.reduce&&we.push(0)}let Ae=this.trees[de+1]=this._createTree(we);Z&&console.timeEnd(pe);for(let ve=de;ve>=oe;ve--){let Pe=+Date.now();Ae=this.trees[ve]=this._createTree(this._cluster(Ae,ve)),Z&&console.log("z%d: %d clusters in %dms",ve,Ae.numItems,+Date.now()-Pe)}return Z&&console.timeEnd("total time"),this}getClusters($,Z){let oe=(($[0]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,$[1])),pe=$[2]===180?180:(($[2]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)oe=-180,pe=180;else if(oe>pe){let Qe=this.getClusters([oe,de,180,we],Z),yt=this.getClusters([-180,de,pe,we],Z);return Qe.concat(yt)}let Ae=this.trees[this._limitZoom(Z)],ve=Ae.range(Hr(oe),Fa(we),Hr(pe),Fa(de)),Pe=Ae.data,it=[];for(let Qe of ve){let yt=this.stride*Qe;it.push(Pe[yt+Do]>1?Ft(Pe,yt,this.clusterProps):this.points[Pe[yt+So]])}return it}getChildren($){let Z=this._getOriginId($),oe=this._getOriginZoom($),de="No cluster with the specified id.",pe=this.trees[oe];if(!pe)throw new Error(de);let we=pe.data;if(Z*this.stride>=we.length)throw new Error(de);let Ae=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ve=pe.within(we[Z*this.stride],we[Z*this.stride+1],Ae),Pe=[];for(let it of ve){let Qe=it*this.stride;we[Qe+4]===$&&Pe.push(we[Qe+Do]>1?Ft(we,Qe,this.clusterProps):this.points[we[Qe+So]])}if(Pe.length===0)throw new Error(de);return Pe}getLeaves($,Z,oe){let de=[];return this._appendLeaves(de,$,Z=Z||10,oe=oe||0,0),de}getTile($,Z,oe){let de=this.trees[this._limitZoom($)],pe=Math.pow(2,$),{extent:we,radius:Ae}=this.options,ve=Ae/we,Pe=(oe-ve)/pe,it=(oe+1+ve)/pe,Qe={features:[]};return this._addTileFeatures(de.range((Z-ve)/pe,Pe,(Z+1+ve)/pe,it),de.data,Z,oe,pe,Qe),Z===0&&this._addTileFeatures(de.range(1-ve/pe,Pe,1,it),de.data,pe,oe,pe,Qe),Z===pe-1&&this._addTileFeatures(de.range(0,Pe,ve/pe,it),de.data,-1,oe,pe,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom($){let Z=this._getOriginZoom($)-1;for(;Z<=this.options.maxZoom;){let oe=this.getChildren($);if(Z++,oe.length!==1)break;$=oe[0].properties.cluster_id}return Z}_appendLeaves($,Z,oe,de,pe){let we=this.getChildren(Z);for(let Ae of we){let ve=Ae.properties;if(ve&&ve.cluster?pe+ve.point_count<=de?pe+=ve.point_count:pe=this._appendLeaves($,ve.cluster_id,oe,de,pe):pe<de?pe++:$.push(Ae),$.length===oe)break}return pe}_createTree($){let Z=new i.cK($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<$.length;oe+=this.stride)Z.add($[oe],$[oe+1]);return Z.finish(),Z.data=$,Z}_addTileFeatures($,Z,oe,de,pe,we){for(let Ae of $){let ve=Ae*this.stride,Pe=Z[ve+Do]>1,it,Qe,yt;if(Pe)it=Al(Z,ve,this.clusterProps),Qe=Z[ve],yt=Z[ve+1];else{let rn=this.points[Z[ve+So]];it=rn.properties;let[$t,hn]=rn.geometry.coordinates;Qe=Hr($t),yt=Fa(hn)}let Mt={type:1,geometry:[[Math.round(this.options.extent*(Qe*pe-oe)),Math.round(this.options.extent*(yt*pe-de))]],tags:it},Qt;Qt=Pe||this.options.generateId?Z[ve+So]:this.points[Z[ve+So]].id,Qt!==void 0&&(Mt.id=Qt),we.features.push(Mt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,Z){let{radius:oe,extent:de,reduce:pe,minPoints:we}=this.options,Ae=oe/(de*Math.pow(2,Z)),ve=$.data,Pe=[],it=this.stride;for(let Qe=0;Qe<ve.length;Qe+=it){if(ve[Qe+2]<=Z)continue;ve[Qe+2]=Z;let yt=ve[Qe],Mt=ve[Qe+1],Qt=$.within(ve[Qe],ve[Qe+1],Ae),rn=ve[Qe+Do],$t=rn;for(let hn of Qt){let mt=hn*it;ve[mt+2]>Z&&($t+=ve[mt+Do])}if($t>rn&&$t>=we){let hn,mt=yt*rn,ai=Mt*rn,Nn=-1,_n=(Qe/it<<5)+(Z+1)+this.points.length;for(let Ai of Qt){let li=Ai*it;if(ve[li+2]<=Z)continue;ve[li+2]=Z;let Vi=ve[li+Do];mt+=ve[li]*Vi,ai+=ve[li+1]*Vi,ve[li+4]=_n,pe&&(hn||(hn=this._map(ve,Qe,!0),Nn=this.clusterProps.length,this.clusterProps.push(hn)),pe(hn,this._map(ve,li)))}ve[Qe+4]=_n,Pe.push(mt/$t,ai/$t,1/0,_n,-1,$t),pe&&Pe.push(Nn)}else{for(let hn=0;hn<it;hn++)Pe.push(ve[Qe+hn]);if($t>1)for(let hn of Qt){let mt=hn*it;if(!(ve[mt+2]<=Z)){ve[mt+2]=Z;for(let ai=0;ai<it;ai++)Pe.push(ve[mt+ai])}}}}return Pe}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,Z,oe){if($[Z+Do]>1){let we=this.clusterProps[$[Z+_u]];return oe?Object.assign({},we):we}let de=this.points[$[Z+So]].properties,pe=this.options.map(de);return oe&&pe===de?Object.assign({},pe):pe}}function Ft(ye,$,Z){return{type:"Feature",id:ye[$+So],properties:Al(ye,$,Z),geometry:{type:"Point",coordinates:[(oe=ye[$],360*(oe-.5)),Pl(ye[$+1])]}};var oe}function Al(ye,$,Z){let oe=ye[$+Do],de=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,pe=ye[$+_u],we=pe===-1?{}:Object.assign({},Z[pe]);return Object.assign(we,{cluster:!0,cluster_id:ye[$+So],point_count:oe,point_count_abbreviated:de})}function Hr(ye){return ye/360+.5}function Fa(ye){let $=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function Pl(ye){let $=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function Rl(ye,$,Z,oe){let de=oe,pe=$+(Z-$>>1),we,Ae=Z-$,ve=ye[$],Pe=ye[$+1],it=ye[Z],Qe=ye[Z+1];for(let yt=$+3;yt<Z;yt+=3){let Mt=yu(ye[yt],ye[yt+1],ve,Pe,it,Qe);if(Mt>de)we=yt,de=Mt;else if(Mt===de){let Qt=Math.abs(yt-pe);Qt<Ae&&(we=yt,Ae=Qt)}}de>oe&&(we-$>3&&Rl(ye,$,we,oe),ye[we+2]=de,Z-we>3&&Rl(ye,we,Z,oe))}function yu(ye,$,Z,oe,de,pe){let we=de-Z,Ae=pe-oe;if(we!==0||Ae!==0){let ve=((ye-Z)*we+($-oe)*Ae)/(we*we+Ae*Ae);ve>1?(Z=de,oe=pe):ve>0&&(Z+=we*ve,oe+=Ae*ve)}return we=ye-Z,Ae=$-oe,we*we+Ae*Ae}function Ks(ye,$,Z,oe){let de={id:ye??null,type:$,geometry:Z,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")Na(de,Z);else if($==="Polygon")Na(de,Z[0]);else if($==="MultiLineString")for(let pe of Z)Na(de,pe);else if($==="MultiPolygon")for(let pe of Z)Na(de,pe[0]);return de}function Na(ye,$){for(let Z=0;Z<$.length;Z+=3)ye.minX=Math.min(ye.minX,$[Z]),ye.minY=Math.min(ye.minY,$[Z+1]),ye.maxX=Math.max(ye.maxX,$[Z]),ye.maxY=Math.max(ye.maxY,$[Z+1])}function kl(ye,$,Z,oe){if(!$.geometry)return;let de=$.geometry.coordinates;if(de&&de.length===0)return;let pe=$.geometry.type,we=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ae=[],ve=$.id;if(Z.promoteId?ve=$.properties[Z.promoteId]:Z.generateId&&(ve=oe||0),pe==="Point")vu(de,Ae);else if(pe==="MultiPoint")for(let Pe of de)vu(Pe,Ae);else if(pe==="LineString")Ol(de,Ae,we,!1);else if(pe==="MultiLineString"){if(Z.lineMetrics){for(let Pe of de)Ae=[],Ol(Pe,Ae,we,!1),ye.push(Ks(ve,"LineString",Ae,$.properties));return}Ll(de,Ae,we,!1)}else if(pe==="Polygon")Ll(de,Ae,we,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(let Pe of $.geometry.geometries)kl(ye,{id:ve,geometry:Pe,properties:$.properties},Z,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Pe of de){let it=[];Ll(Pe,it,we,!0),Ae.push(it)}}ye.push(Ks(ve,pe,Ae,$.properties))}function vu(ye,$){$.push(ho(ye[0]),pd(ye[1]),0)}function Ol(ye,$,Z,oe){let de,pe,we=0;for(let ve=0;ve<ye.length;ve++){let Pe=ho(ye[ve][0]),it=pd(ye[ve][1]);$.push(Pe,it,0),ve>0&&(we+=oe?(de*it-Pe*pe)/2:Math.sqrt(Math.pow(Pe-de,2)+Math.pow(it-pe,2))),de=Pe,pe=it}let Ae=$.length-3;$[2]=1,Rl($,0,Ae,Z),$[Ae+2]=1,$.size=Math.abs(we),$.start=0,$.end=$.size}function Ll(ye,$,Z,oe){for(let de=0;de<ye.length;de++){let pe=[];Ol(ye[de],pe,Z,oe),$.push(pe)}}function ho(ye){return ye/360+.5}function pd(ye){let $=Math.sin(ye*Math.PI/180),Z=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return Z<0?0:Z>1?1:Z}function Nt(ye,$,Z,oe,de,pe,we,Ae){if(oe/=$,pe>=(Z/=$)&&we<oe)return ye;if(we<Z||pe>=oe)return null;let ve=[];for(let Pe of ye){let it=Pe.geometry,Qe=Pe.type,yt=de===0?Pe.minX:Pe.minY,Mt=de===0?Pe.maxX:Pe.maxY;if(yt>=Z&&Mt<oe){ve.push(Pe);continue}if(Mt<Z||yt>=oe)continue;let Qt=[];if(Qe==="Point"||Qe==="MultiPoint")xu(it,Qt,Z,oe,de);else if(Qe==="LineString")Ii(it,Qt,Z,oe,de,!1,Ae.lineMetrics);else if(Qe==="MultiLineString")za(it,Qt,Z,oe,de,!1);else if(Qe==="Polygon")za(it,Qt,Z,oe,de,!0);else if(Qe==="MultiPolygon")for(let rn of it){let $t=[];za(rn,$t,Z,oe,de,!0),$t.length&&Qt.push($t)}if(Qt.length){if(Ae.lineMetrics&&Qe==="LineString"){for(let rn of Qt)ve.push(Ks(Pe.id,Qe,rn,Pe.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(Qt.length===1?(Qe="LineString",Qt=Qt[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=Qt.length===3?"Point":"MultiPoint"),ve.push(Ks(Pe.id,Qe,Qt,Pe.tags))}}return ve.length?ve:null}function xu(ye,$,Z,oe,de){for(let pe=0;pe<ye.length;pe+=3){let we=ye[pe+de];we>=Z&&we<=oe&&Zo($,ye[pe],ye[pe+1],ye[pe+2])}}function Ii(ye,$,Z,oe,de,pe,we){let Ae=Fl(ye),ve=de===0?Yo:bu,Pe,it,Qe=ye.start;for(let $t=0;$t<ye.length-3;$t+=3){let hn=ye[$t],mt=ye[$t+1],ai=ye[$t+2],Nn=ye[$t+3],_n=ye[$t+4],Ai=de===0?hn:mt,li=de===0?Nn:_n,Vi=!1;we&&(Pe=Math.sqrt(Math.pow(hn-Nn,2)+Math.pow(mt-_n,2))),Ai<Z?li>Z&&(it=ve(Ae,hn,mt,Nn,_n,Z),we&&(Ae.start=Qe+Pe*it)):Ai>oe?li<oe&&(it=ve(Ae,hn,mt,Nn,_n,oe),we&&(Ae.start=Qe+Pe*it)):Zo(Ae,hn,mt,ai),li<Z&&Ai>=Z&&(it=ve(Ae,hn,mt,Nn,_n,Z),Vi=!0),li>oe&&Ai<=oe&&(it=ve(Ae,hn,mt,Nn,_n,oe),Vi=!0),!pe&&Vi&&(we&&(Ae.end=Qe+Pe*it),$.push(Ae),Ae=Fl(ye)),we&&(Qe+=Pe)}let yt=ye.length-3,Mt=ye[yt],Qt=ye[yt+1],rn=de===0?Mt:Qt;rn>=Z&&rn<=oe&&Zo(Ae,Mt,Qt,ye[yt+2]),yt=Ae.length-3,pe&&yt>=3&&(Ae[yt]!==Ae[0]||Ae[yt+1]!==Ae[1])&&Zo(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&$.push(Ae)}function Fl(ye){let $=[];return $.size=ye.size,$.start=ye.start,$.end=ye.end,$}function za(ye,$,Z,oe,de,pe){for(let we of ye)Ii(we,$,Z,oe,de,pe,!1)}function Zo(ye,$,Z,oe){ye.push($,Z,oe)}function Yo(ye,$,Z,oe,de,pe){let we=(pe-$)/(oe-$);return Zo(ye,pe,Z+(de-Z)*we,1),we}function bu(ye,$,Z,oe,de,pe){let we=(pe-Z)/(de-Z);return Zo(ye,$+(oe-$)*we,pe,1),we}function Qs(ye,$){let Z=[];for(let oe=0;oe<ye.length;oe++){let de=ye[oe],pe=de.type,we;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")we=Js(de.geometry,$);else if(pe==="MultiLineString"||pe==="Polygon"){we=[];for(let Ae of de.geometry)we.push(Js(Ae,$))}else if(pe==="MultiPolygon"){we=[];for(let Ae of de.geometry){let ve=[];for(let Pe of Ae)ve.push(Js(Pe,$));we.push(ve)}}Z.push(Ks(de.id,pe,we,de.tags))}return Z}function Js(ye,$){let Z=[];Z.size=ye.size,ye.start!==void 0&&(Z.start=ye.start,Z.end=ye.end);for(let oe=0;oe<ye.length;oe+=3)Z.push(ye[oe]+$,ye[oe+1],ye[oe+2]);return Z}function Nl(ye,$){if(ye.transformed)return ye;let Z=1<<ye.z,oe=ye.x,de=ye.y;for(let pe of ye.features){let we=pe.geometry,Ae=pe.type;if(pe.geometry=[],Ae===1)for(let ve=0;ve<we.length;ve+=2)pe.geometry.push(zl(we[ve],we[ve+1],$,Z,oe,de));else for(let ve=0;ve<we.length;ve++){let Pe=[];for(let it=0;it<we[ve].length;it+=2)Pe.push(zl(we[ve][it],we[ve][it+1],$,Z,oe,de));pe.geometry.push(Pe)}}return ye.transformed=!0,ye}function zl(ye,$,Z,oe,de,pe){return[Math.round(Z*(ye*oe-de)),Math.round(Z*($*oe-pe))]}function md(ye,$,Z,oe,de){let pe=$===de.maxZoom?0:de.tolerance/((1<<$)*de.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:Z,y:oe,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ae of ye)Bl(we,Ae,pe,de);return we}function Bl(ye,$,Z,oe){let de=$.geometry,pe=$.type,we=[];if(ye.minX=Math.min(ye.minX,$.minX),ye.minY=Math.min(ye.minY,$.minY),ye.maxX=Math.max(ye.maxX,$.maxX),ye.maxY=Math.max(ye.maxY,$.maxY),pe==="Point"||pe==="MultiPoint")for(let Ae=0;Ae<de.length;Ae+=3)we.push(de[Ae],de[Ae+1]),ye.numPoints++,ye.numSimplified++;else if(pe==="LineString")fo(we,de,ye,Z,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Ae=0;Ae<de.length;Ae++)fo(we,de[Ae],ye,Z,pe==="Polygon",Ae===0);else if(pe==="MultiPolygon")for(let Ae=0;Ae<de.length;Ae++){let ve=de[Ae];for(let Pe=0;Pe<ve.length;Pe++)fo(we,ve[Pe],ye,Z,!0,Pe===0)}if(we.length){let Ae=$.tags||null;if(pe==="LineString"&&oe.lineMetrics){Ae={};for(let Pe in $.tags)Ae[Pe]=$.tags[Pe];Ae.mapbox_clip_start=de.start/de.size,Ae.mapbox_clip_end=de.end/de.size}let ve={geometry:we,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Ae};$.id!==null&&(ve.id=$.id),ye.features.push(ve)}}function fo(ye,$,Z,oe,de,pe){let we=oe*oe;if(oe>0&&$.size<(de?we:oe))return void(Z.numPoints+=$.length/3);let Ae=[];for(let ve=0;ve<$.length;ve+=3)(oe===0||$[ve+2]>we)&&(Z.numSimplified++,Ae.push($[ve],$[ve+1])),Z.numPoints++;de&&function(ve,Pe){let it=0;for(let Qe=0,yt=ve.length,Mt=yt-2;Qe<yt;Mt=Qe,Qe+=2)it+=(ve[Qe]-ve[Mt])*(ve[Qe+1]+ve[Mt+1]);if(it>0===Pe)for(let Qe=0,yt=ve.length;Qe<yt/2;Qe+=2){let Mt=ve[Qe],Qt=ve[Qe+1];ve[Qe]=ve[yt-2-Qe],ve[Qe+1]=ve[yt-1-Qe],ve[yt-2-Qe]=Mt,ve[yt-1-Qe]=Qt}}(Ae,pe),ye.push(Ae)}let ea={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class po{constructor($,Z){let oe=(Z=this.options=function(pe,we){for(let Ae in we)pe[Ae]=we[Ae];return pe}(Object.create(ea),Z)).debug;if(oe&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(pe,we){let Ae=[];if(pe.type==="FeatureCollection")for(let ve=0;ve<pe.features.length;ve++)kl(Ae,pe.features[ve],we,ve);else kl(Ae,pe.type==="Feature"?pe:{geometry:pe},we);return Ae}($,Z);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(pe,we){let Ae=we.buffer/we.extent,ve=pe,Pe=Nt(pe,1,-1-Ae,Ae,0,-1,2,we),it=Nt(pe,1,1-Ae,2+Ae,0,-1,2,we);return(Pe||it)&&(ve=Nt(pe,1,-Ae,1+Ae,0,-1,2,we)||[],Pe&&(ve=Qs(Pe,1).concat(ve)),it&&(ve=ve.concat(Qs(it,-1)))),ve}(de,Z),de.length&&this.splitTile(de,0,0,0),oe&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,Z,oe,de,pe,we,Ae){let ve=[$,Z,oe,de],Pe=this.options,it=Pe.debug;for(;ve.length;){de=ve.pop(),oe=ve.pop(),Z=ve.pop(),$=ve.pop();let Qe=1<<Z,yt=nr(Z,oe,de),Mt=this.tiles[yt];if(!Mt&&(it>1&&console.time("creation"),Mt=this.tiles[yt]=md($,Z,oe,de,Pe),this.tileCoords.push({z:Z,x:oe,y:de}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,oe,de,Mt.numFeatures,Mt.numPoints,Mt.numSimplified),console.timeEnd("creation"));let Vi=`z${Z}`;this.stats[Vi]=(this.stats[Vi]||0)+1,this.total++}if(Mt.source=$,pe==null){if(Z===Pe.indexMaxZoom||Mt.numPoints<=Pe.indexMaxPoints)continue}else{if(Z===Pe.maxZoom||Z===pe)continue;if(pe!=null){let Vi=pe-Z;if(oe!==we>>Vi||de!==Ae>>Vi)continue}}if(Mt.source=null,$.length===0)continue;it>1&&console.time("clipping");let Qt=.5*Pe.buffer/Pe.extent,rn=.5-Qt,$t=.5+Qt,hn=1+Qt,mt=null,ai=null,Nn=null,_n=null,Ai=Nt($,Qe,oe-Qt,oe+$t,0,Mt.minX,Mt.maxX,Pe),li=Nt($,Qe,oe+rn,oe+hn,0,Mt.minX,Mt.maxX,Pe);$=null,Ai&&(mt=Nt(Ai,Qe,de-Qt,de+$t,1,Mt.minY,Mt.maxY,Pe),ai=Nt(Ai,Qe,de+rn,de+hn,1,Mt.minY,Mt.maxY,Pe),Ai=null),li&&(Nn=Nt(li,Qe,de-Qt,de+$t,1,Mt.minY,Mt.maxY,Pe),_n=Nt(li,Qe,de+rn,de+hn,1,Mt.minY,Mt.maxY,Pe),li=null),it>1&&console.timeEnd("clipping"),ve.push(mt||[],Z+1,2*oe,2*de),ve.push(ai||[],Z+1,2*oe,2*de+1),ve.push(Nn||[],Z+1,2*oe+1,2*de),ve.push(_n||[],Z+1,2*oe+1,2*de+1)}}getTile($,Z,oe){$=+$,Z=+Z,oe=+oe;let de=this.options,{extent:pe,debug:we}=de;if($<0||$>24)return null;let Ae=1<<$,ve=nr($,Z=Z+Ae&Ae-1,oe);if(this.tiles[ve])return Nl(this.tiles[ve],pe);we>1&&console.log("drilling down to z%d-%d-%d",$,Z,oe);let Pe,it=$,Qe=Z,yt=oe;for(;!Pe&&it>0;)it--,Qe>>=1,yt>>=1,Pe=this.tiles[nr(it,Qe,yt)];return Pe&&Pe.source?(we>1&&(console.log("found parent tile z%d-%d-%d",it,Qe,yt),console.time("drilling down")),this.splitTile(Pe.source,it,Qe,yt,$,Z,oe),we>1&&console.timeEnd("drilling down"),this.tiles[ve]?Nl(this.tiles[ve],pe):null):null}}function nr(ye,$,Z){return 32*((1<<ye)*Z+$)+ye}function gd(ye,$){let Z=ye.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);let oe=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!oe)return $(null,null);let de=new ft(oe.features),pe=gs(de);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),$(null,{vectorTile:de,rawData:pe.buffer})}class Ba extends be{constructor($,Z,oe,de,pe,we){super($,Z,oe,de,gd,we),pe&&(this.loadGeoJSON=pe),this._dynamicIndex=new zt}loadData($,Z){let oe=$&&$.request,de=oe&&oe.collectResourceTiming;this.loadGeoJSON($,(pe,we)=>{if(pe||!we)return Z(pe);if(typeof we!="object")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{try{if($.filter){let ve=i.y($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));we.features=we.features.filter(Pe=>ve.value.evaluate({zoom:0},Pe))}$.dynamic?(we.type==="Feature"&&(we={type:"FeatureCollection",features:[we]}),$.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(we.features,this.loaded),$.cluster&&(we.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=$.cluster?new kt(function({superclusterOptions:ve,clusterProperties:Pe}){if(!Pe||!ve)return ve;let it={},Qe={},yt={accumulated:null,zoom:0},Mt={properties:null},Qt=Object.keys(Pe);for(let rn of Qt){let[$t,hn]=Pe[rn],mt=i.y(hn),ai=i.y(typeof $t=="string"?[$t,["accumulated"],["get",rn]]:$t);it[rn]=mt.value,Qe[rn]=ai.value}return ve.map=rn=>{Mt.properties=rn;let $t={};for(let hn of Qt)$t[hn]=it[hn].evaluate(yt,Mt);return $t},ve.reduce=(rn,$t)=>{Mt.properties=$t;for(let hn of Qt)yt.accumulated=rn[hn],rn[hn]=Qe[hn].evaluate(yt,Mt)},ve}($)).load(we.features):$.dynamic?this._dynamicIndex:function(ve,Pe){return new po(ve,Pe)}(we,$.geojsonVtOptions)}catch(ve){return Z(ve)}let Ae={};if(de){let ve=w(oe);ve&&(Ae.resourceTiming={},Ae.resourceTiming[$.source]=JSON.parse(JSON.stringify(ve)))}Z(null,Ae)}})}reloadTile($,Z){let oe=this.loaded;return oe&&oe[$.uid]?$.partial?Z(null,void 0):super.reloadTile($,Z):this.loadTile($,Z)}loadGeoJSON($,Z){if($.request)i.g($.request,Z);else{if(typeof $.data!="string")return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse($.data))}catch{return Z(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(oe){Z(oe)}}getClusterChildren($,Z){try{Z(null,this._geoJSONIndex.getChildren($.clusterId))}catch(oe){Z(oe)}}getClusterLeaves($,Z){try{Z(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(oe){Z(oe)}}}class Vl{constructor($,Z){this.tileID=new i.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=Z}parse($,Z,oe,de){this.status="parsing";let pe=new i.aL(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),we={},Ae=Z.familiesBySource[oe.source],ve=new i.dN(pe,oe.promoteId);return ve.bucketLayerIDs=[],ve.is3DTile=!0,i.e3($).then(Pe=>{if(!Pe)return de(new Error("Could not parse tile"));let it=i.e4(Pe,1/i.b5(oe.tileID.canonical)),Qe=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Pe.json.asset.extras&&Pe.json.asset.extras.MAPBOX_mesh_features,yt=Pe.json.extensionsUsed&&Pe.json.extensionsUsed.includes("EXT_meshopt_compression"),Mt=new i.X(this.zoom,{brightness:this.brightness});for(let Qt in Ae)for(let rn of Ae[Qt]){let $t=rn[0];ve.bucketLayerIDs.push(rn.map(mt=>mt.id)),$t.recalculate(Mt,[]);let hn=new i.e5(it,pe,Qe,yt,this.brightness,ve);Qe||(hn.needsUpload=!0),we[$t.fqid]=hn,hn.evaluate($t)}this.status="done",de(null,{buckets:we,featureIndex:ve})}).catch(Pe=>de(new Error(Pe.message)))}}class wu{constructor($,Z,oe,de,pe,we){this.actor=$,this.layerIndex=Z,this.brightness=we,this.loading={},this.loaded={}}loadTile($,Z){let oe=$.uid,de=this.loading[oe]=new Vl($,this.brightness);i.e2($.request,(pe,we)=>{let Ae=!this.loading[oe];return delete this.loading[oe],Ae||pe?(de.status="done",Ae||(this.loaded[oe]=de),Z(pe)):we&&we.byteLength!==0?void de.parse(we,this.layerIndex,$,(ve,Pe)=>{de.status="done",this.loaded=this.loaded||{},this.loaded[oe]=de,ve||!Pe?Z(ve):Z(null,Pe)}):(de.status="done",this.loaded[oe]=de,Z())})}reloadTile($,Z){let oe=this.loaded,de=$.uid;if(oe&&oe[de]){let pe=oe[de];pe.projection=$.projection,pe.brightness=$.brightness;let we=(Ae,ve)=>{pe.reloadCallback&&(delete pe.reloadCallback,this.loadTile($,Z)),Z(Ae,ve)};pe.status==="parsing"?pe.reloadCallback=we:pe.status==="done"&&this.loadTile($,Z)}}abortTile($,Z){let oe=$.uid;this.loading[oe]&&delete this.loading[oe],Z()}removeTile($,Z){let oe=this.loaded,de=$.uid;oe&&oe[de]&&delete oe[de],Z()}}class jl{constructor($){this.self=$,this.actor=new i.e6($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.aJ({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:Ba,"batched-model":wu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,oe)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=oe},this.self.registerRTLTextPlugin=Z=>{if(i.e7.isParsed())throw new Error("RTL text plugin already registered.");i.e7.applyArabicShaping=Z.applyArabicShaping,i.e7.processBidirectionalText=Z.processBidirectionalText,i.e7.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches($,Z,oe){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],delete this.rasterArrayWorkerSource,oe()}checkIfReady($,Z,oe){oe()}setReferrer($,Z){this.referrer=Z}spriteLoaded($,{scope:Z,isLoaded:oe}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][Z]=oe,this.workerSources[$]&&this.workerSources[$][Z])for(let de in this.workerSources[$][Z]){let pe=this.workerSources[$][Z][de];for(let we in pe){let Ae=pe[we];Ae instanceof be&&(Ae.isSpriteLoaded=oe,Ae.fire(new i.f("isSpriteLoaded")))}}}setImages($,{scope:Z,images:oe},de){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][Z]=oe,this.workerSources[$]&&this.workerSources[$][Z]){for(let pe in this.workerSources[$][Z]){let we=this.workerSources[$][Z][pe];for(let Ae in we)we[Ae].availableImages=oe}de()}else de()}setProjection($,Z){this.projections[$]=i.aJ(Z)}setBrightness($,Z,oe){this.brightness=Z,oe()}setLayers($,Z,oe){this.getLayerIndex($,Z.scope).replace(Z.layers,Z.options),oe()}updateLayers($,Z,oe){this.getLayerIndex($,Z.scope).update(Z.layers,Z.removedIds,Z.options),oe()}loadTile($,Z,oe){Z.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source,Z.scope).loadTile(Z,oe)}loadDEMTile($,Z,oe){this.getDEMWorkerSource($,Z.source,Z.scope).loadTile(Z,oe)}decodeRasterArray($,Z,oe){this.getRasterArrayWorkerSource().decodeRasterArray(Z,oe)}reloadTile($,Z,oe){Z.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,Z.type,Z.source,Z.scope).reloadTile(Z,oe)}abortTile($,Z,oe){this.getWorkerSource($,Z.type,Z.source,Z.scope).abortTile(Z,oe)}removeTile($,Z,oe){this.getWorkerSource($,Z.type,Z.source,Z.scope).removeTile(Z,oe)}removeSource($,Z,oe){if(!(this.workerSources[$]&&this.workerSources[$][Z.scope]&&this.workerSources[$][Z.scope][Z.type]&&this.workerSources[$][Z.scope][Z.type][Z.source]))return;let de=this.workerSources[$][Z.scope][Z.type][Z.source];delete this.workerSources[$][Z.scope][Z.type][Z.source],de.removeSource!==void 0?de.removeSource(Z,oe):oe()}loadWorkerSource($,Z,oe){try{this.self.importScripts(Z.url),oe()}catch(de){oe(de.toString())}}syncRTLPluginState($,Z,oe){try{i.e7.setState(Z);let de=i.e7.getPluginURL();if(i.e7.isLoaded()&&!i.e7.isParsed()&&de!=null){this.self.importScripts(de);let pe=i.e7.isParsed();oe(pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),pe)}}catch(de){oe(de.toString())}}setDracoUrl($,Z){this.dracoUrl=Z}getAvailableImages($,Z){this.availableImages[$]||(this.availableImages[$]={});let oe=this.availableImages[$][Z];return oe||(oe=[]),oe}getLayerIndex($,Z){this.layerIndexes[$]||(this.layerIndexes[$]={});let oe=this.layerIndexes[$][Z];return oe||(oe=this.layerIndexes[$][Z]=new L,oe.scope=Z),oe}getWorkerSource($,Z,oe,de){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][de]||(this.workerSources[$][de]={}),this.workerSources[$][de][Z]||(this.workerSources[$][de][Z]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][de][Z][oe]||(this.workerSources[$][de][Z][oe]=new this.workerSourceTypes[Z]({send:(pe,we,Ae,ve,Pe,it)=>{this.actor.send(pe,we,Ae,$,Pe,it)},scheduler:this.actor.scheduler},this.getLayerIndex($,de),this.getAvailableImages($,de),this.isSpriteLoaded[$][de],void 0,this.brightness)),this.workerSources[$][de][Z][oe]}getDEMWorkerSource($,Z,oe){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][oe]||(this.demWorkerSources[$][oe]={}),this.demWorkerSources[$][oe][Z]||(this.demWorkerSources[$][oe][Z]=new Se),this.demWorkerSources[$][oe][Z]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ke),this.rasterArrayWorkerSource}enforceCacheSizeLimit($,Z){i.e8(Z)}getWorkerPerformanceMetrics($,Z,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new jl(self)),jl}),c(["./shared"],function(i){function w(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let h=0;h<m.length;h++)if(!w(m[h],s[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&s!==null){if(typeof s!="object"||Object.keys(m).length!==Object.keys(s).length)return!1;for(let h in m)if(!w(m[h],s[h]))return!1;return!0}return m===s}var C=A;function A(m){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{v=new Worker(T),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(T),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(L[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(L[h]=function(g){var v,x=function(T){var I=document.createElement("canvas"),M=Object.create(A.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=T,I.getContext("webgl2",M)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),L[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(m)}var L={};function U(m,s,h){let g=document.createElement(m);return s!=null&&(g.className=s),h&&h.appendChild(g),g}function Q(m,s,h){let g=document.createElementNS("http://www.w3.org/2000/svg",m);for(let v of Object.keys(s))g.setAttributeNS(null,v,String(s[v]));return h&&h.appendChild(g),g}A.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let fe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,he=fe&&fe.userSelect!==void 0?"userSelect":"WebkitUserSelect",be;function Se(){fe&&he&&(be=fe[he],fe[he]="none")}function Ke(){fe&&he&&(fe[he]=be)}function Fe(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Fe,!0)}function tt(){window.addEventListener("click",Fe,!0),window.setTimeout(()=>{window.removeEventListener("click",Fe,!0)},0)}function ft(m,s){let h=m.getBoundingClientRect();return Kt(m,h,s)}function Ue(m,s){let h=m.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(Kt(m,h,s[v]));return g}function zt(m){return window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function Kt(m,s,h){let g=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new i.P((h.clientX-s.left)*g,(h.clientY-s.top)*g)}class tn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,h){this._updatedSourceCaches[s]=h,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){let h=s.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(s.id),this.setDirty()}removeLayer(s){let h=s.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][s.id]=s,this._updatedLayers[h].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){let s={};for(let h in this._updatedLayers)s[h]=s[h]||{},s[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)s[h]=s[h]||{},s[h].removedIds=Object.keys(this._removedLayers[h]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Tt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ri{constructor(s,h,g,v,x,T){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=T,this.context=s;let I=s.gl;this.buffer=I.createBuffer(),s.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){let v=h.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],T=h.attributes[x.name];T!==void 0&&s.vertexAttribPointer(T,x.components,s[Tt[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,h,g){for(let v=0;v<this.attributes.length;v++){let x=h.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ct{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ti extends Ct{getDefault(){return i.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ci extends Ct{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class $i extends Ct{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class wn extends Ct{getDefault(){return[!0,!0,!0,!0]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Wo extends Ct{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class wt extends Ct{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Bt extends Ct{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){let h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class qt extends Ct{getDefault(){let s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class vn extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Lt extends Ct{getDefault(){return[0,1]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class dr extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class ti extends Ct{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Jr extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class pi extends Ct{getDefault(){let s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class La extends Ct{getDefault(){return i.C.transparent}set(s){let h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Rt extends Ct{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class Li extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Bn extends Ct{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class fr extends Ct{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let gs=class extends Ct{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Xs extends Ct{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class gu extends Ct{getDefault(){let s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){let h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ml extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class So extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Do extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class _u extends Ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class kt extends Ct{getDefault(){return null}set(s){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ft extends Ct{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class Al extends Ct{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Hr extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Fa extends Ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Pl extends Ct{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Rl extends Pl{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class yu extends Pl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ks extends Pl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Na extends yu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class kl{constructor(s,h,g,v,x){this.context=s,this.width=h,this.height=g;let T=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new Rl(s,T)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new yu(s,T):new Ks(s,T))}destroy(){let s=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&s.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&s.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&s.deleteTexture(h)}s.deleteFramebuffer(this.framebuffer)}}class vu{constructor(s,h){this.gl=s,this.clearColor=new Ti(this),this.clearDepth=new Ci(this),this.clearStencil=new $i(this),this.colorMask=new wn(this),this.depthMask=new Wo(this),this.stencilMask=new wt(this),this.stencilFunc=new Bt(this),this.stencilOp=new qt(this),this.stencilTest=new vn(this),this.depthRange=new Lt(this),this.depthTest=new dr(this),this.depthFunc=new ti(this),this.blend=new Jr(this),this.blendFunc=new pi(this),this.blendColor=new La(this),this.blendEquation=new Rt(this),this.cullFace=new Li(this),this.cullFaceSide=new Bn(this),this.frontFace=new fr(this),this.program=new gs(this),this.activeTexture=new Xs(this),this.viewport=new gu(this),this.bindFramebuffer=new Ml(this),this.bindRenderbuffer=new So(this),this.bindTexture=new Do(this),this.bindVertexBuffer=new _u(this),this.bindElementBuffer=new kt(this),this.bindVertexArrayOES=new Ft(this),this.pixelStoreUnpack=new Al(this),this.pixelStoreUnpackPremultiplyAlpha=new Hr(this),this.pixelStoreUnpackFlipY=new Fa(this),this.options=h?gt({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h,g){return new i.I(this,s,h,g)}createVertexBuffer(s,h,g,v,x){return new ri(this,s,h,g,v,x)}createRenderbuffer(s,h,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),x}createFramebuffer(s,h,g,v){return new kl(this,s,h,g,v)}clear({color:s,depth:h,stencil:g,colorMask:v}){let x=this.gl,T=0;s&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(T)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){w(s.blendFunction,i.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Ol{constructor(s){this._gl=s.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let s=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,s}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class Ll{constructor(s){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,s.registerParameter(this,["Symbols"],"useOcclusionQueries"),s.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),s.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),s.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),s.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class ho{constructor(s,h,g,v){let x={width:g[0],height:g[1],data:null},T=s.gl;this.targetColorTexture=new i.T(s,x,T.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new i.T(s,x,T.RGBA,{useMipmap:!1}),this.context=s,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(s,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=h.width*h.height;this.particleTexture0=new i.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new i.S;x.reserve(v);for(let T=0;T<v;T++)x.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(x,i.p.members,!0),this.particleSegment=i.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=i.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class pd extends i.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,h){return i.l(this.requestManager.transformRequest(h,i.R.Model).url).then(g=>{if(!g)return;let v=i.c(g),x=new i.M(s,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new i.d(new Error(`Could not load model ${s} from ${h}: ${g.message}`)))})}load(s,h){this.models[h]||(this.models[h]={});let g=Object.keys(s);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,s[x]));Promise.allSettled(v).then(x=>{for(let T=0;T<x.length;T++){let{status:I,value:M}=x[T];I==="fulfilled"&&M&&(this.models[h][g[T]]={model:M,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new i.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new i.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,h){return!!this.getModel(s,h)}getModel(s,h){return this.models[h]||(this.models[h]={}),this.models[h][s]?this.models[h][s].model:void 0}addModel(s,h,g){this.models[g]||(this.models[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.load({[s]:this.requestManager.normalizeModelURL(h)},g)}addModels(s,h){this.models[h]||(this.models[h]={});let g={};for(let v in s)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(s[v]);this.load(g,h)}addModelsFromBucket(s,h){this.models[h]||(this.models[h]={});let g={};for(let v of s)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(s,h){if(this.models[h]&&this.models[h][s]&&(this.models[h][s].numReferences--,this.models[h][s].numReferences===0)){let g=this.models[h][s].model;delete this.models[h][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,h){this.models[h]||(this.models[h]={});for(let g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(s.context)}}function Nt(m){let{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class xu extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new i.i({width:1,height:1})}isLoaded(){for(let s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,h){if(this.loaded[h]!==s&&(this.loaded[h]=s,s)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(s,h){return!!this.getImage(s,h)}getImage(s,h){return this.images[h][s]}addImage(s,h,g){this._validate(s,g)&&(this.images[h][s]=g)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.d(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.d(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new i.d(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(let v of s){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h,g){g.version=this.images[h][s].version+1,this.images[h][s]=g,this.updatedImages[h][s]=!0}removeImage(s,h){let g=this.images[h][s];delete this.images[h][s],delete this.patterns[h][s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,h,g){let v=!0,x=!!this.loaded[h];if(!x)for(let T of s)this.images[h][T]||(v=!1);x||v?this._notify(s,h,g):this.requestors.push({ids:s,scope:h,callback:g})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,h,g){let v={};for(let x of s){this.images[h][x]||this.fire(new i.f("styleimagemissing",{id:x}));let T=this.images[h][x];T?v[x]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:i.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(s){let{width:h,height:g}=this.atlasImage[s];return{width:h,height:g}}getPattern(s,h,g){let v=this.patterns[h][s],x=this.getImage(s,h);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let T={w:x.data.width+2,h:x.data.height+2,x:0,y:0},I=new i.k(T,x);this.patterns[h][s]={bin:T,position:I}}return this._updatePatternAtlas(h,g),this.patterns[h][s].position}bind(s,h){let g=s.gl,v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new i.T(s,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,h){let g=[];for(let I in this.patterns[s])g.push(this.patterns[s][I].bin);let{w:v,h:x}=i.j(g),T=this.atlasImage[s];T.resize({width:v||1,height:x||1});for(let I in this.patterns[s]){let{bin:M}=this.patterns[s][I],P=M.x+1,O=M.y+1,N=this.images[s][I].data,B=N.width,V=N.height;i.i.copy(N,T,{x:0,y:0},{x:P,y:O},{width:B,height:V},h),i.i.copy(N,T,{x:0,y:V-1},{x:P,y:O-1},{width:B,height:1},h),i.i.copy(N,T,{x:0,y:0},{x:P,y:O+V},{width:B,height:1},h),i.i.copy(N,T,{x:B-1,y:0},{x:P-1,y:O},{width:1,height:V},h),i.i.copy(N,T,{x:0,y:0},{x:P+B,y:O},{width:1,height:V},h)}this.dirty=!0}beginFrame(){for(let s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,h){for(let g of s){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;let v=this.images[h][g];Nt(v)&&this.updateImage(g,h,v)}}}function Ii(m){let s=m.key,h=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},x=m.style,T=m.styleSpec,I=[],M=i.n(h);if(M!=="object")return[new i.V(s,h,`object expected, ${M} found`)];for(let P in h){let O=P.split(".")[0],N;v[O]?N=v[O]:g[O]?N=$:v["*"]?N=v["*"]:g["*"]&&(N=$),N?I=I.concat(N({key:(s&&`${s}.`)+P,value:h[P],valueSpec:g[O]||g["*"],style:x,styleSpec:T,object:h,objectKey:P},h)):I.push(new i.m(s,h[P],`unknown property "${P}"`))}for(let P in g)v[P]||g[P].required&&g[P].default===void 0&&h[P]===void 0&&I.push(new i.V(s,h,`missing required property "${P}"`));return I}function Fl(m){let s=m.value,h=m.valueSpec,g=m.style,v=m.styleSpec,x=m.key,T=m.arrayElementValidator||$;if(i.n(s)!=="array")return[new i.V(x,s,`array expected, ${i.n(s)} found`)];if(h.length&&s.length!==h.length)return[new i.V(x,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new i.V(x,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let I={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(I.function=h.function),i.n(h.value)==="object"&&(I=h.value);let M=[];for(let P=0;P<s.length;P++)M=M.concat(T({array:s,arrayIndex:P,value:s[P],valueSpec:I,style:g,styleSpec:v,key:`${x}[${P}]`},!0));return M}function za(m){let s=m.key,h=m.value,g=m.valueSpec,v=i.n(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new i.V(s,h,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(i.n(g.minimum)==="array"&&(x=g.minimum[m.arrayIndex]),h<x)return[new i.V(s,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(i.n(g.maximum)==="array"&&(x=g.maximum[m.arrayIndex]),h>x)return[new i.V(s,h,`${h} is greater than the maximum value ${x}`)]}return[]}function Zo(m){let s=m.valueSpec,h=i.u(m.value.type),g,v,x,T={},I=h!=="categorical"&&m.value.property===void 0,M=!I,P=i.n(m.value.stops)==="array"&&i.n(m.value.stops[0])==="array"&&i.n(m.value.stops[0][0])==="object",O=Ii({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(V){if(h==="identity")return[new i.V(V.key,V.value,'identity function may not have a "stops" property')];let G=[],H=V.value;return G=G.concat(Fl({key:V.key,value:H,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:N})),i.n(H)==="array"&&H.length===0&&G.push(new i.V(V.key,H,"array must have at least one stop")),G},default:function(V){return $({key:V.key,value:V.value,valueSpec:s,style:V.style,styleSpec:V.styleSpec})}}});return h==="identity"&&I&&O.push(new i.V(m.key,m.value,'missing required property "property"')),h==="identity"||m.value.stops||O.push(new i.V(m.key,m.value,'missing required property "stops"')),h==="exponential"&&m.valueSpec.expression&&!i.s(m.valueSpec)&&O.push(new i.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(M&&!i.q(m.valueSpec)?O.push(new i.V(m.key,m.value,"property functions not supported")):I&&!i.r(m.valueSpec)&&O.push(new i.V(m.key,m.value,"zoom functions not supported"))),h!=="categorical"&&!P||m.value.property!==void 0||O.push(new i.V(m.key,m.value,'"property" property is required')),O;function N(V){let G=[],H=V.value,q=V.key;if(i.n(H)!=="array")return[new i.V(q,H,`array expected, ${i.n(H)} found`)];if(H.length!==2)return[new i.V(q,H,`array length 2 expected, length ${H.length} found`)];if(P){if(i.n(H[0])!=="object")return[new i.V(q,H,`object expected, ${i.n(H[0])} found`)];if(H[0].zoom===void 0)return[new i.V(q,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new i.V(q,H,"object stop key must have value")];let W=i.u(H[0].zoom);if(typeof W!="number")return[new i.V(q,H[0].zoom,"stop zoom values must be numbers")];if(x&&x>W)return[new i.V(q,H[0].zoom,"stop zoom values must appear in ascending order")];W!==x&&(x=W,v=void 0,T={}),G=G.concat(Ii({key:`${q}[0]`,value:H[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:za,value:B}}))}else G=G.concat(B({key:`${q}[0]`,value:H[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},H));return i.t(i.v(H[1]))?G.concat([new i.V(`${q}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat($({key:`${q}[1]`,value:H[1],valueSpec:s,style:V.style,styleSpec:V.styleSpec}))}function B(V,G){let H=i.n(V.value),q=i.u(V.value),W=V.value!==null?V.value:G;if(g){if(H!==g)return[new i.V(V.key,W,`${H} stop domain type must match previous stop domain type ${g}`)]}else g=H;if(H!=="number"&&H!=="string"&&H!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new i.V(V.key,W,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&h!=="categorical"){let ee=`number expected, ${H} found`;return i.q(s)&&h===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(V.key,W,ee)]}return h!=="categorical"||H!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?h!=="categorical"&&H==="number"&&typeof q=="number"&&typeof v=="number"&&v!==void 0&&q<v?[new i.V(V.key,W,"stop domain values must appear in ascending order")]:(v=q,h==="categorical"&&q in T?[new i.V(V.key,W,"stop domain values must be unique")]:(T[q]=!0,[])):[new i.V(V.key,W,`integer expected, found ${String(q)}`)]}}function Yo(m){let s=(m.expressionContext==="property"?i.x:i.y)(i.v(m.value),m.valueSpec);if(s.result==="error")return s.value.map(g=>new i.V(`${m.key}${g.key}`,m.value,g.message));let h=s.value.expression||s.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!h.outputDefined())return[new i.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!i.z(h))return[new i.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return bu(h,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!i.A(h,["zoom","feature-state"]))return[new i.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!i.B(h))return[new i.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bu(m,s){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(let v of s.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];let g=[];return m instanceof i.D&&h.has(m.name)?[new i.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(v=>{g.push(...bu(v,s))}),g)}function Qs(m){let s=m.key,h=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(i.u(h))===-1&&v.push(new i.V(s,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(i.u(h))===-1&&v.push(new i.V(s,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function Js(m){return i.G(i.v(m.value))?Yo(i.o({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Nl(m)}function Nl(m){let s=m.value,h=m.key;if(i.n(s)!=="array")return[new i.V(h,s,`array expected, ${i.n(s)} found`)];let g=m.styleSpec,v,x=[];if(s.length<1)return[new i.V(h,s,"filter array must have at least 1 element")];switch(x=x.concat(Qs({key:`${h}[0]`,value:s[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),i.u(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&i.u(s[1])==="$type"&&x.push(new i.V(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new i.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=i.n(s[1]),v!=="string"&&x.push(new i.V(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let T=2;T<s.length;T++)v=i.n(s[T]),i.u(s[1])==="$type"?x=x.concat(Qs({key:`${h}[${T}]`,value:s[T],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new i.V(`${h}[${T}]`,s[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<s.length;T++)x=x.concat(Nl({key:`${h}[${T}]`,value:s[T],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=i.n(s[1]),s.length!==2?x.push(new i.V(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new i.V(`${h}[1]`,s[1],`string expected, ${v} found`))}return x}function zl(m,s){let h=m.key,g=m.style,v=m.layer,x=m.styleSpec,T=m.value,I=m.objectKey,M=x[`${s}_${m.layerType}`];if(!M)return[];let P=I.match(/^(.*)-transition$/);if(s==="paint"&&P&&M[P[1]]&&M[P[1]].transition)return $({key:h,value:T,valueSpec:x.transition,style:g,styleSpec:x});let O=m.valueSpec||M[I];if(!O)return[new i.m(h,T,`unknown property "${I}"`)];let N;if(i.n(T)==="string"&&i.q(O)&&!O.tokens&&(N=/^{([^}]+)}$/.exec(T))){let V=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new i.V(h,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}let B=[];if(m.layerType==="symbol")I!=="text-field"||!g||g.glyphs||g.imports||B.push(new i.V(h,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&i.H(i.v(T))&&i.u(T.type)==="identity"&&B.push(new i.V(h,T,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&s==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&i.q(O)&&(i.J(O)||i.r(O))){let V=i.x(i.v(T),O),G=V.value.expression||V.value._styleExpression.expression;G&&!i.A(G,["measure-light"])&&(I==="model-emissive-strength"&&i.B(G)&&i.z(G)||B.push(new i.V(h,T,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat($({key:m.key,value:T,valueSpec:O,style:g,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:I}))}function md(m){return zl(m,"paint")}function Bl(m){return zl(m,"layout")}function fo(m){let s=[],h=m.value,g=m.key,v=m.style,x=m.styleSpec;h.type||h.ref||s.push(new i.V(g,h,'either "type" or "ref" is required'));let T=i.u(h.type),I=i.u(h.ref);if(h.id){let M=i.u(h.id);for(let P=0;P<m.arrayIndex;P++){let O=v.layers[P];i.u(O.id)===M&&s.push(new i.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${O.id.__line__}`))}}if("ref"in h){let M;["type","source","source-layer","filter","layout"].forEach(P=>{P in h&&s.push(new i.V(g,h[P],`"${P}" is prohibited for ref layers`))}),v.layers.forEach(P=>{i.u(P.id)===I&&(M=P)}),M?M.ref?s.push(new i.V(g,h.ref,"ref cannot reference another ref layer")):T=i.u(M.type):typeof I=="string"&&s.push(new i.V(g,h.ref,`ref layer "${I}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(h.source){let M=v.sources&&v.sources[h.source],P=M&&i.u(M.type);M?P==="vector"&&T==="raster"?s.push(new i.V(g,h.source,`layer "${h.id}" requires a raster source`)):P==="raster"&&T!=="raster"?s.push(new i.V(g,h.source,`layer "${h.id}" requires a vector source`)):P!=="vector"||h["source-layer"]?P==="raster-dem"&&T!=="hillshade"?s.push(new i.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||P==="geojson"&&M.lineMetrics?T==="raster-particle"&&P!=="raster-array"&&s.push(new i.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):s.push(new i.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new i.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new i.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new i.V(g,h.source,`source "${h.source}" not found`))}else s.push(new i.V(g,h,'missing required property "source"'));return s=s.concat(Ii({key:g,value:h,valueSpec:x.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:m.style,styleSpec:m.styleSpec,object:h,objectKey:"type"}),filter:M=>Js(i.o({layerType:T},M)),layout:M=>Ii({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>Bl(i.o({layerType:T},P))}}),paint:M=>Ii({layer:h,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>md(i.o({layerType:T,layer:h},P))}})}})),s}function ea(m){let s=m.value,h=m.key,g=i.n(s);return g!=="string"?[new i.V(h,s,`string expected, ${g} found`)]:[]}let po={promoteId:function({key:m,value:s}){if(i.n(s)==="string")return ea({key:m,value:s});{let h=[];for(let g in s)h.push(...ea({key:`${m}.${g}`,value:s[g]}));return h}}};function nr(m){let s=m.value,h=m.key,g=m.styleSpec,v=m.style;if(!s.type)return[new i.V(h,s,'"type" is required')];let x=i.u(s.type),T=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||T.push(new i.m(h,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Ii({key:h,value:s,valueSpec:g[`source_${x.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:po})),T;case"geojson":if(T=Ii({key:h,value:s,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:po}),s.cluster)for(let I in s.clusterProperties){let[M,P]=s.clusterProperties[I],O=typeof M=="string"?[M,["accumulated"],["get",I]]:M;T.push(...Yo({key:`${h}.${I}.map`,value:P,expressionContext:"cluster-map"})),T.push(...Yo({key:`${h}.${I}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return T;case"video":return Ii({key:h,value:s,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return Ii({key:h,value:s,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new i.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qs({key:`${h}.type`,value:s.type,valueSpec:{values:gd(g)},style:v,styleSpec:g})}}function gd(m){return m.source.reduce((s,h)=>{let g=m[h];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values))),s},[])}function Ba(m){let s=m.value,h=m.styleSpec,g=h.light,v=m.style,x=[],T=i.n(s);if(s===void 0)return x;if(T!=="object")return x=x.concat([new i.V("light",s,`object expected, ${T} found`)]),x;for(let I in s){let M=I.match(/^(.*)-transition$/);x=x.concat(M&&g[M[1]]&&g[M[1]].transition?$({key:I,value:s[I],valueSpec:h.transition,style:v,styleSpec:h}):g[I]?$({key:I,value:s[I],valueSpec:g[I],style:v,styleSpec:h}):[new i.V(I,s[I],`unknown property "${I}"`)])}return x}function Vl(m){let s=m.value,h=[];if(!s)return h;let g=i.n(s);if(g!=="object")return h=h.concat([new i.V("light-3d",s,`object expected, ${g} found`)]),h;let v=m.styleSpec,x=v["light-3d"],T=m.key,I=m.style,M=m.style.lights;for(let N of["type","id"])if(!(N in s))return h=h.concat([new i.V("light-3d",s,`missing property ${N} on light`)]),h;if(s.type&&M)for(let N=0;N<m.arrayIndex;N++){let B=i.u(s.type),V=M[N];i.u(V.type)===B&&h.push(new i.V(T,s.id,`duplicate light type "${s.type}", previously defined at line ${V.id.__line__}`))}let P=`properties_light_${s.type}`;if(!(P in v))return h=h.concat([new i.V("light-3d",s,`Invalid light type ${s.type}`)]),h;let O=v[P];for(let N in s)if(N==="properties"){let B=s[N],V=i.n(B);if(V!=="object")return h=h.concat([new i.V("properties",B,`object expected, ${V} found`)]),h;for(let G in B)h=h.concat(O[G]?$({key:G,value:B[G],valueSpec:O[G],style:I,styleSpec:v}):[new i.m(m.key,B[G],`unknown property "${G}"`)])}else{let B=N.match(/^(.*)-transition$/);h=h.concat(B&&x[B[1]]&&x[B[1]].transition?$({key:N,value:s[N],valueSpec:v.transition,style:I,styleSpec:v}):x[N]?$({key:N,value:s[N],valueSpec:x[N],style:I,styleSpec:v}):[new i.m(N,s[N],`unknown property "${N}"`)])}return h}function wu(m){let s=m.value,h=m.key,g=m.style,v=m.styleSpec,x=v.terrain,T=[],I=i.n(s);if(s===void 0||I==="null")return T;if(I!=="object")return T=T.concat([new i.V("terrain",s,`object expected, ${I} found`)]),T;for(let M in s){let P=M.match(/^(.*)-transition$/);T=T.concat(P&&x[P[1]]&&x[P[1]].transition?$({key:M,value:s[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?$({key:M,value:s[M],valueSpec:x[M],style:g,styleSpec:v}):[new i.m(M,s[M],`unknown property "${M}"`)])}if(s.source){let M=g.sources&&g.sources[s.source],P=M&&i.u(M.type);M?P!=="raster-dem"&&T.push(new i.V(h,s.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):T.push(new i.V(h,s.source,`source "${s.source}" not found`))}else T.push(new i.V(h,s,'terrain is missing required property "source"'));return T}function jl(m){let s=m.value,h=m.style,g=m.styleSpec,v=g.fog,x=[],T=i.n(s);if(s===void 0)return x;if(T!=="object")return x=x.concat([new i.V("fog",s,`object expected, ${T} found`)]),x;for(let I in s){let M=I.match(/^(.*)-transition$/);x=x.concat(M&&v[M[1]]&&v[M[1]].transition?$({key:I,value:s[I],valueSpec:g.transition,style:h,styleSpec:g}):v[I]?$({key:I,value:s[I],valueSpec:v[I],style:h,styleSpec:g}):[new i.m(I,s[I],`unknown property "${I}"`)])}return x}let ye={"*":()=>[],array:Fl,boolean:function(m){let s=m.value,h=m.key,g=i.n(s);return g!=="boolean"?[new i.V(h,s,`boolean expected, ${g} found`)]:[]},number:za,color:function(m){let s=m.key,h=m.value,g=i.n(h);return g!=="string"?[new i.V(s,h,`color expected, ${g} found`)]:i.F(h)===null?[new i.V(s,h,`color expected, "${h}" found`)]:[]},enum:Qs,filter:Js,function:Zo,layer:fo,object:Ii,source:nr,model:i.K,light:Ba,"light-3d":Vl,terrain:wu,fog:jl,string:ea,formatted:function(m){return ea(m).length===0?[]:Yo(m)},resolvedImage:function(m){return ea(m).length===0?[]:Yo(m)},projection:function(m){let s=m.value,h=m.styleSpec,g=h.projection,v=m.style,x=[],T=i.n(s);if(T==="object")for(let I in s)x=x.concat($({key:I,value:s[I],valueSpec:g[I],style:v,styleSpec:h}));else T!=="string"&&(x=x.concat([new i.V("projection",s,`object or string expected, ${T} found`)]));return x},import:function(m){let{value:s,styleSpec:h}=m,T=s,{data:g}=T,v=ls(T,["data"]);Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let x=Ii(i.o({},m,{value:v,valueSpec:h.import}));return i.u(v.id)===""&&x.push(new i.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(oe(g,h,{key:`${m.key}.data`}))),x}};function $(m,s=!1){let h=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&i.H(i.u(h)))return Zo(m);if(g.expression&&i.t(i.v(h)))return Yo(m);if(g.type&&ye[g.type]){let x=ye[g.type](m);return s===!0&&x.length>0&&i.n(m.value)==="array"?Yo(m):x}return Ii(i.o({},m,{valueSpec:g.type?v[g.type]:g}))}function Z(m){let s=m.value,h=m.key,g=ea(m);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new i.V(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new i.V(h,s,'"glyphs" url must include a "{range}" token'))),g}function oe(m,s=i.L,h={}){return $({key:h.key||"",value:m,valueSpec:s.$root,styleSpec:s,style:m,objectElementValidators:{glyphs:Z,"*":()=>[]}})}function de(m,s=i.L){return rn(oe(m,s))}let pe=m=>rn(nr(m)),we=m=>rn(Ba(m)),Ae=m=>rn(Vl(m)),ve=m=>rn(wu(m)),Pe=m=>rn(jl(m)),it=m=>rn(fo(m)),Qe=m=>rn(Js(m)),yt=m=>rn(md(m)),Mt=m=>rn(Bl(m)),Qt=m=>rn(i.K(m));function rn(m){return m.slice().sort((s,h)=>s.line&&h.line?s.line-h.line:0)}function $t(m,s){let h=!1;if(s&&s.length)for(let g of s)g instanceof i.m?i.w(g.message):(m.fire(new i.d(new Error(g.message))),h=!0);return h}let hn=new i.N({anchor:new i.O(i.L.light.anchor),position:new i.Q(i.L.light.position),color:new i.O(i.L.light.color),intensity:new i.O(i.L.light.intensity)});class mt extends i.E{constructor(s,h="flat"){super(),this._transitionable=new i.U(hn),this.setLight(s,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h,g={}){this._validate(we,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=h)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&$t(this,s.call(de,i.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.L})))}}let ai=new i.N({source:new i.O(i.L.terrain.source),exaggeration:new i.O(i.L.terrain.exaggeration)}),Nn=class extends i.E{constructor(m,s,h,g){super(),this.scope=h,this._transitionable=new i.U(ai,h,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new i.X(m)).get("exaggeration")}isZoomDependent(){let m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof i.Z}},_n=45,Ai=65,li=.05;function Vi(m,s,h,g){let v=i.$(_n,Ai,h),[x,T]=pr(m,g),I=1-Math.min(1,Math.exp((s-x)/(T-x)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*v*m.alpha}function pr(m,s){let h=.5/Math.tan(.5*s);return[m.range[0]+h,m.range[1]+h]}function mr(m,s,h,g,v){let x=i._.transformMat4([],[s,h,g],v.mercatorFogMatrix);return Vi(m,i._.length(x),v.pitch,v._fov)}function Va(m,s,h,g,v,x,T){let I=[[h,g,0],[v,g,0],[v,x,0],[h,x,0]],M=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let O of I){let N=i._.transformMat4([],O,s),B=i._.length(N);M=Math.min(M,B),P=Math.max(P,B)}return[Vi(m,M,T.pitch,T._fov),Vi(m,P,T.pitch,T._fov)]}let Np=new i.N({range:new i.O(i.L.fog.range),color:new i.O(i.L.fog.color),"high-color":new i.O(i.L.fog["high-color"]),"space-color":new i.O(i.L.fog["space-color"]),"horizon-blend":new i.O(i.L.fog["horizon-blend"]),"star-intensity":new i.O(i.L.fog["star-intensity"]),"vertical-range":new i.O(i.L.fog["vertical-range"])});class my extends i.E{constructor(s,h,g,v){super(),this._transitionable=new i.U(Np,g,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new i.a0(Np),this.scope=g}get state(){let s=this._transform,h=s.projection.name==="globe",g=i.a1(s.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[i.a2(x[0],v[0],g),i.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h,g={}){if(this._validate(Pe,s,g))return;let v=i.W({},s);for(let x of Object.keys(i.L.fog))v[x]===void 0&&(v[x]=i.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.$(_n,Ai,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,v,x){let T=i.Y.fromLngLat(v),I=x.elevation?x.elevation.getAtPointOrZero(T):0;return mr(g,T.x,T.y,I,x)}(this.state,s,h):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Va(this.state,h,0,0,i.a3,i.a3,this._transform)}getOpacityForBounds(s,h,g,v,x){return this._transform.projection.supportsFog?Va(this.state,s,h,g,v,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?pr(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let g of h){let v=s.points[g],x;if(v[2]>=0)x=v;else{let T=s.points[g-4];x=i.a4(T,v,T[2]/(T[2]-v[2]))}if(mr(this.state,x[0],x[1],0,this._transform)>=li)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&$t(this,s.call(de,i.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.L})))}}class Tu extends i.E{constructor(s,h,g,v){super(),this.scope=g,this._options=s,this.properties=new i.a0(h),this._transitionable=new i.U(h,g,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,h){this._options=s,this._transitionable.setTransitionOrValue(s.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Yt=new i.N({color:new i.O(i.L.properties_light_ambient.color),intensity:new i.O(i.L.properties_light_ambient.intensity)}),zp=new i.N({direction:new i.a5(i.L.properties_light_directional.direction),color:new i.O(i.L.properties_light_directional.color),intensity:new i.O(i.L.properties_light_directional.intensity),"cast-shadows":new i.O(i.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new i.O(i.L.properties_light_directional["shadow-intensity"])});var ta=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Bp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Vp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,jp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Up=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,$p=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Gp=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Hp=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,qp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Wp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,gy=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Ul=[];$l(ta,Ul),$l(Vp,Ul),$l(Bp,Ul);let _d={"_prelude_fog.vertex.glsl":$p,"_prelude_terrain.vertex.glsl":Up,"_prelude_shadow.vertex.glsl":Wp,"_prelude_fog.fragment.glsl":Gp,"_prelude_shadow.fragment.glsl":gy,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Hp,"_prelude_raster_particle.glsl":qp},yd={};ln("",Up),ln(Gp,$p),ln(gy,Wp),ln(Hp,""),ln(qp,"");let _y=ln(Bp,Vp),yy=ta;var vy={background:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ln("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ln(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ln("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ln("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ln(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ln(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ln(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ln("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ln("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ln(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:ln(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ln("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ln(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,jp),skyboxGradient:ln(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,jp),skyboxCapture:ln(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ln(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ln(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:ln("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function $l(m,s){let h=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)s.includes(x)||s.push(x)}}function ln(m,s){let h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(P=>{let O=P.split(" ");return O[O.length-1]}),v=[...new Set(v)]);let x={},T=[],I=[];if(m=m.replace(h,(P,O)=>(I.push(O),"")),(s=s.replace(h,(P,O)=>(T.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...Ul];$l(m,M),$l(s,M);for(let P of[...T,...I])_d[P]||console.error(`Undefined include: ${P}`),yd[P]||(yd[P]=[],$l(_d[P],yd[P])),M=[...M,...yd[P]];return{fragmentSource:m=m.replace(g,(P,O,N,B,V)=>(x[V]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} ${V};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(g,(P,O,N,B,V)=>{let G=B==="float"?"vec2":B,H=V.match(/color/)?"color":G;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${N} ${B} a_${V};
#endif
`:x[V]?O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
out ${N} ${B} ${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${N} ${B} a_${V};
    out ${N} ${B} ${V};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${N} ${B} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${G} a_${V};
#else
uniform ${N} ${B} u_${V};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${N} ${B} ${V} = a_${V};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = a_${V};
#else
    ${N} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${B} ${V} = unpack_mix_${H}(a_${V}, u_${V}_t);
#else
    ${N} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:v,usedDefines:M,vertexIncludes:T,fragmentIncludes:I}}class w1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,v,x,T,I,M){this.context=s;let P=this.boundPaintVertexBuffers.length!==v.length;for(let N=0;!P&&N<v.length;N++)this.boundPaintVertexBuffers[N]!==v[N]&&(P=!0);let O=this.boundDynamicVertexBuffers.length!==I.length;for(let N=0;!O&&N<I.length;N++)this.boundDynamicVertexBuffers[N]!==I[N]&&(O=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||P||O||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(h,g,v,x,T,I,M);else{s.bindVertexArrayOES.set(this.vao);for(let N of I)N&&(N.bind(),M&&N.instanceCount&&N.setVertexAttribDivisor(s.gl,h,M));x&&x.dynamicDraw&&x.bind()}}freshBind(s,h,g,v,x,T,I){let M=s.numAttributes,P=this.context,O=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T,h.enableAttributes(O,s),h.bind(),h.setVertexAttribPointers(O,s,x);for(let N of g)N.enableAttributes(O,s),N.bind(),N.setVertexAttribPointers(O,s,x);for(let N of T)N&&(N.enableAttributes(O,s),N.bind(),N.setVertexAttribPointers(O,s,x),I&&N.instanceCount&&N.setVertexAttribDivisor(O,s,I));v&&v.bind(),P.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function T1(m,s){let h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new i.Y(0,g/h).toLngLat().lat,new i.Y(0,(g+1)/h).toLngLat().lat]}function E1(m,s,h,g,v,x,T){let I=m.context,M=I.gl,P=h.hillshadeFBO;if(!P)return;m.prepareDrawTile();let O=m.isTileAffectedByFog(s),N=m.getOrCreateProgram("hillshade",{overrideFog:O});I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get());let B=((q,W,ee,te)=>{let ne=ee.paint.get("hillshade-shadow-color"),ue=ee.paint.get("hillshade-highlight-color"),ce=ee.paint.get("hillshade-accent-color"),J=ee.paint.get("hillshade-emissive-strength"),ie=i.ab(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")ie-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let ge=q.style.directionalLight.properties.get("direction"),Ie=i.ac(ge.x,ge.y,ge.z);ie=i.ab(Ie[1])}let re=!q.options.moving;return{u_matrix:te||q.transform.calculateProjMatrix(W.tileID.toUnwrapped(),re),u_image:0,u_latrange:T1(0,W.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),ie],u_shadow:ne.toRenderColor(ee.lut),u_highlight:ue.toRenderColor(ee.lut),u_emissive_strength:J,u_accent:ce.toRenderColor(ee.lut)}})(m,h,g,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(I,N,s.toUnwrapped());let{tileBoundsBuffer:V,tileBoundsIndexBuffer:G,tileBoundsSegments:H}=m.getTileBoundsBuffers(h);N.draw(m,M.TRIANGLES,v,x,T,i.af.disabled,B,g.id,V,G,H)}function Zp(m,s,h){if(!s.needsDEMTextureUpload)return;let g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(h.stride);let x=h.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new i.T(g,x,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Xo(m,s,h){let g=m.context,v=g.gl;if(!s.dem)return;let x=s.dem;if(g.activeTexture.set(v.TEXTURE1),Zp(m,s,x),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let T=x.dim;g.activeTexture.set(v.TEXTURE0);let I=s.hillshadeFBO;if(!I){let B=new i.T(g,{width:T,height:T,data:null},v.RGBA);B.bind(v.LINEAR,v.CLAMP_TO_EDGE),I=s.hillshadeFBO=g.createFramebuffer(T,T,!0,"renderbuffer"),I.colorAttachment.set(B.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,T,T]);let{tileBoundsBuffer:M,tileBoundsIndexBuffer:P,tileBoundsSegments:O}=m.getMercatorTileBoundsBuffers(),N=[];m.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(m,v.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.disabled,((B,V)=>{let G=V.stride,H=i.ad.create();return i.ad.ortho(H,0,i.a3,-i.a3,0,0,1),i.ad.translate(H,H,[0,-i.a3,0]),{u_matrix:H,u_image:1,u_dimension:[G,G],u_zoom:B.overscaledZ}})(s.tileID,x),h.id,M,P,O),s.needsHillshadePrepare=!1}function Yp(m,s,h,g,v){let x=function(T,I){if(T)return v(T);if(I){if(m.url&&I.tiles&&m.tiles&&delete m.tiles,I.variants){if(!Array.isArray(I.variants))return v(new Error("variants must be an array"));for(let P of I.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return v(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){I=i.W(I,P);break}}}let M=i.ah(i.W(I,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(M.vectorLayers=I.vector_layers,M.vectorLayerIds=M.vectorLayers.map(P=>P.id)),I.raster_layers&&(M.rasterLayers=I.raster_layers,M.rasterLayerIds=M.rasterLayers.map(P=>P.id)),M.tiles=s.canonicalizeTileset(M,m.url),v(null,M)}};return m.url?i.g(s.transformRequest(s.normalizeSourceURL(m.url,null,h,g),i.R.Source),x):i.e.frame(()=>x(null,m))}class Eu{constructor(s,h,g){this.bounds=i.ai.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){let h=Math.pow(2,s.z),g=Math.floor(i.aj(this.bounds.getWest())*h),v=Math.floor(i.ak(this.bounds.getNorth())*h),x=Math.ceil(i.aj(this.bounds.getEast())*h),T=Math.ceil(i.ak(this.bounds.getSouth())*h);return s.x>=g&&s.x<x&&s.y>=v&&s.y<T}}class Iu extends i.E{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.W({type:"raster"},h),i.W(this,i.ah(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Yp(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new i.d(h)):g&&(i.W(this,g),g.bounds&&(this.tileBounds=new Eu(g.bounds,this.minzoom,this.maxzoom)),i.an(g.tiles),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=i.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return i.W({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){let g=i.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=i.h(this.map._requestManager.transformRequest(v,i.R.Tile),(x,T,I,M)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):x?(s.state="errored",h(x)):T?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:I,expires:M}),s.setTexture(T,this.map.painter),s.state="loaded",i.am(this.dispatcher),void h(null)):h(null)))}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h&&h()}unloadTile(s,h){s.texture&&s.texture instanceof i.T?(s.destroy(!0),s.texture&&s.texture instanceof i.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class vd extends i.E{constructor(s,h,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.W(this,i.ah(h,["url","scheme","tileSize","promoteId"])),this._options=i.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new i.ao}load(s){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Yp(this._options,this.map._requestManager,h,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new i.d(v))):x&&(i.W(this,x),x.bounds&&(this.tileBounds=new Eu(x.bounds,this.minzoom,this.maxzoom)),i.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=i.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return i.W({},this._options)}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,i.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,T={request:v,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(T.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",T,I.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",T,I.bind(this),void 0,!0);else{let M=i.ap.call({deduped:this._deduped},T,(P,O)=>{P||!O?I.call(this,P):(T.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},s.actor&&s.actor.send("loadTile",T,I.bind(this),void 0,!0))},!0);s.request={cancel:M}}function I(M,P){return delete s.request,s.aborted?h(null):M&&M.status!==404?h(M):(P&&P.resourceTiming&&(s.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&s.setExpiryData(P),s.loadVectorData(P,this.map.painter),i.am(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ja=m=>({u_matrix:new i.a6(m),u_image0:new i.a7(m),u_skirt_height:new i.aa(m),u_ground_shadow_factor:new i.aq(m)}),lt=(m,s,h)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:h}),xy=(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:I,u_frustum_br:M,u_frustum_bl:P,u_globe_pos:O,u_globe_radius:N,u_viewport:B,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:G});class Cu{constructor(s=0,h=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=v}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=i.a2(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=i.a2(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=i.a2(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=i.a2(s.right,h.right,g)),this}getCenter(s,h){let g=i.at((this.left+s-this.right)/2,0,s),v=i.at((this.top+h-this.bottom)/2,0,h);return new i.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Cu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function dn(m,s){let h=i.aw(m,3);i.ad.fromQuat(m,s),i.az(m,3,h)}function gr(m,s){let h=i.av.identity([]);return i.av.rotateZ(h,h,-s),i.av.rotateX(h,h,-m),h}function by(m,s){let h=[m[0],m[1],0],g=[s[0],s[1],0];if(i._.length(h)>=1e-15){let T=i._.normalize([],h);i._.scale(g,T,i._.dot(g,T)),s[0]=g[0],s[1]=g[1]}let v=i._.cross([],s,m);if(i._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return gr(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),x)}class Xp{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){let h=s instanceof i.Y?s:new i.Y(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=i.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(i.Y.fromLngLat(s)):0,x=i.Y.fromLngLat(s,v),T=[x.x-g.x,x.y-g.y,x.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=by(T,h)}setPitchBearing(s,h){this.orientation=gr(i.ab(s),i.ab(-h))}}class Su{constructor(s,h){this._transform=i.ad.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){let s=this.position;return new i.Y(s[0],s[1],s[2])}get position(){let s=i.aw(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&i.az(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||i.av.identity([]),s&&dn(this._transform,this._orientation)}getPitchBearing(){let s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=gr(s,h),dn(this._transform,this._orientation)}forward(){let s=i.aw(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){let s=i.aw(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){let s=i.aw(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){let g=new Float64Array(16);return i.ad.invert(g,this.getWorldToCamera(s,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,h,g){let v=this.position;i._.scale(v,v,-s);let x=new Float64Array(16);return i.ad.fromScaling(x,[g,g,g]),i.ad.translate(x,x,v),x[10]*=h,x}getWorldToCamera(s,h){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return i.av.conjugate(v,this._orientation),i._.scale(x,x,-s),i.ad.fromQuat(g,v),i.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,v){let x=new Float64Array(16);return i.ad.perspective(x,s,h,g,v),x}getCameraToClipOrthographic(s,h,g,v,x,T){let I=new Float64Array(16);return i.ad.ortho(I,s,h,g,v,x,T),I}getDistanceToElevation(s,h=!1){let g=s===0?0:i.ax(s,h?i.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Su([...this.position],[...this.orientation])}}let Gl={unknown:0,flipRequired:1,flipNotRequired:2},Jt=Math.tan(85*Math.PI/180);function Ua(m,s,h,g,v,x,T){let I=i.ad.create();if(h)if(x.name==="globe"){let M=i.aB(v,s);i.ad.multiply(I,I,M)}else{let M=i.aC.invert([],T);I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],g||i.ad.rotateZ(I,I,v.angle)}else i.ad.multiply(I,v.labelPlaneMatrix,m);return I}function $a(m,s,h,g,v,x,T){let I=Ua(m,s,h,g,v,x,T);return x.name==="globe"&&h||(I[2]=I[6]=I[10]=I[14]=0),I}function Hl(m,s,h,g,v,x,T){if(h){if(x.name==="globe"){let I=Ua(m,s,h,g,v,x,T);return i.ad.invert(I,I),i.ad.multiply(I,m,I),I}{let I=i.ad.clone(m),M=i.ad.identity([]);return M[0]=T[0],M[1]=T[1],M[4]=T[2],M[5]=T[3],i.ad.multiply(I,I,M),g||i.ad.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function mo(m,s,h,g){let v=[m,s,h,1];h?i.aA.transformMat4(v,v,g):Ko(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function _r(m,s){return Math.min(.5+m/s*.5,1.5)}function I1(m,s){let h=m[0]/m[3],g=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function xd(m,s,h,g,v,x,T,I,M,P){let O=h.transform,N=g?m.textSizeData:m.iconSizeData,B=i.aD(N,h.transform.zoom),V=O.projection.name==="globe",G=[256/h.width*2+1,256/h.height*2+1],H=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();let q=null;V&&(q=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);let W=m.lineVertexArray,ee=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,te=h.transform.width/h.transform.height,ne,ue=!1;for(let ce=0;ce<ee.length;ce++){let J=ee.get(ce),{numGlyphs:ie,writingMode:re}=J;if(re!==i.aE.vertical||ue||ne===i.aE.horizontal||(ue=!0),ne=re,(J.hidden||re===i.aE.vertical)&&!ue){Ga(ie,H);continue}ue=!1;let ge=new i.P(J.tileAnchorX,J.tileAnchorY),{x:Ie,y:ae,z:Ce}=O.projection.projectTilePoint(ge.x,ge.y,P.canonical);if(M){let[at,je,He]=M(ge);Ie+=at,ae+=je,Ce+=He}let Me=[Ie,ae,Ce,1];if(i.aA.transformMat4(Me,Me,s),!I1(Me,G)){Ga(ie,H);continue}let $e=Me[3],Ge=_r(h.transform.getCameraToCenterDistance(O.projection),$e),Ve=i.aF(N,B,J),xe=T?Ve/Ge:Ve*Ge,Re=mo(Ie,ae,Ce,v);if(Re[3]<=0){Ga(ie,H);continue}let Ne={},ot=T?null:M,ct=Qp(J,xe,!1,I,s,v,x,m.glyphOffsetArray,W,H,q,Re,ge,Ne,te,ot,O.projection,P,T);ue=ct.useVertical,ot&&ct.needsFlipping&&(Ne={}),(ct.notEnoughRoom||ue||ct.needsFlipping&&Qp(J,xe,!0,I,s,v,x,m.glyphOffsetArray,W,H,q,Re,ge,Ne,te,ot,O.projection,P,T).notEnoughRoom)&&Ga(ie,H)}g?(m.text.dynamicLayoutVertexBuffer.updateData(H),q&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(q)):(m.icon.dynamicLayoutVertexBuffer.updateData(H),q&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(q))}function bd(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H){let{lineStartIndex:q,glyphStartIndex:W,segment:ee}=I,te=W+I.numGlyphs,ne=q+I.lineLength,ue=s.getoffsetX(W),ce=s.getoffsetX(te-1),J=ql(m*ue,h,g,v,x,T,ee,q,ne,M,P,O,N,B,!0,V,G,H);if(!J)return null;let ie=ql(m*ce,h,g,v,x,T,ee,q,ne,M,P,O,N,B,!0,V,G,H);return ie?{first:J,last:ie}:null}function Kp(m,s,h,g){return m===i.aE.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:m===i.aE.vertical?g>0?{needsFlipping:!0}:null:s!==Gl.unknown&&function(v,x){return v===0||Math.abs(x/v)>Jt}(h,g)?s===Gl.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Qp(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q,W,ee){let te=s/24,ne=m.lineOffsetX*te,ue=m.lineOffsetY*te,{lineStartIndex:ce,glyphStartIndex:J,numGlyphs:ie,segment:re,writingMode:ge,flipState:Ie}=m,ae=ce+m.lineLength,Ce=Me=>{if(O){let[xe,Re,Ne]=Me.up,ot=P.length;i.aG(O,ot+0,xe,Re,Ne),i.aG(O,ot+1,xe,Re,Ne),i.aG(O,ot+2,xe,Re,Ne),i.aG(O,ot+3,xe,Re,Ne)}let[$e,Ge,Ve]=Me.point;i.aH(P,$e,Ge,Ve,Me.angle)};if(ie>1){let Me=bd(te,I,ne,ue,h,N,B,m,M,x,V,H,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};if(g&&!h){let[$e,Ge,Ve]=Me.first.point,[xe,Re,Ne]=Me.last.point;[$e,Ge]=mo($e,Ge,Ve,T),[xe,Re]=mo(xe,Re,Ne,T);let ot=Kp(ge,Ie,(xe-$e)*G,Re-Ge);if(m.flipState=ot&&ot.needsFlipping?Gl.flipRequired:Gl.flipNotRequired,ot)return ot}Ce(Me.first);for(let $e=J+1;$e<J+ie-1;$e++){let Ge=ql(te*I.getoffsetX($e),ne,ue,h,N,B,re,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Ge)return P.length-=4*($e-J),{notEnoughRoom:!0};Ce(Ge)}Ce(Me.last)}else{if(g&&!h){let $e=mo(B.x,B.y,0,v),Ge=ce+re+1,Ve=new i.P(M.getx(Ge),M.gety(Ge)),xe=mo(Ve.x,Ve.y,0,v),Re=xe[3]>0?xe:Du(B,Ve,$e,1,v,void 0,q,W.canonical),Ne=Kp(ge,Ie,(Re[0]-$e[0])*G,Re[1]-$e[1]);if(m.flipState=Ne&&Ne.needsFlipping?Gl.flipRequired:Gl.flipNotRequired,Ne)return Ne}let Me=ql(te*I.getoffsetX(J),ne,ue,h,N,B,re,ce,ae,M,x,V,H,!1,!1,q,W,ee);if(!Me)return{notEnoughRoom:!0};Ce(Me)}return{}}function wd(m,s,h,g,v){let{x,y:T,z:I}=g.projectTilePoint(m.x,m.y,s);if(!v)return mo(x,T,I,h);let[M,P,O]=v(m);return mo(x+M,T+P,I+O,h)}function Du(m,s,h,g,v,x,T,I){let M=wd(m.sub(s)._unit()._add(m),I,v,T,x);return i._.sub(M,h,M),i._.normalize(M,M),i._.scaleAndAdd(M,h,M,g)}function ql(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q,W){let ee=g?m-s:m+s,te=ee>0?1:-1,ne=0;g&&(te*=-1,ne=Math.PI),te<0&&(ne+=Math.PI);let ue=I+T+(te>0?0:1)|0,ce=v,J=v,ie=0,re=0,ge=Math.abs(ee),Ie=[],ae=[],Ce=x,Me=Ce,$e=()=>Du(Me,Ce,J,ge-ie+1,O,B,H,q.canonical);for(;ie+re<=ge;){if(ue+=te,ue<I||ue>=M)return null;if(J=ce,Me=Ce,Ie.push(J),V&&ae.push(Me),Ce=new i.P(P.getx(ue),P.gety(ue)),ce=N[ue],!ce){let je=wd(Ce,q.canonical,O,H,B);ce=je[3]>0?N[ue]=je:$e()}ie+=re,re=i._.distance(J,ce)}G&&B&&(N[ue]&&(ce=$e(),re=i._.distance(J,ce)),N[ue]=ce);let Ge=(ge-ie)/re,Ve=Ce.sub(Me)._mult(Ge)._add(Me),xe=i._.sub([],ce,J),Re=i._.scaleAndAdd([],J,xe,Ge),Ne=[0,0,1],ot=xe[0],ct=xe[1];if(W&&(Ne=H.upVector(q.canonical,Ve.x,Ve.y),Ne[0]!==0||Ne[1]!==0||Ne[2]!==1)){let je=[Ne[2],0,-Ne[0]],He=i._.cross([],Ne,je);i._.normalize(je,je),i._.normalize(He,He),ot=i._.dot(xe,je),ct=i._.dot(xe,He)}if(h){let je=i._.cross([],Ne,xe);i._.normalize(je,je),i._.scaleAndAdd(Re,Re,je,h*te)}let at=ne+Math.atan2(ct,ot);return Ie.push(Re),V&&ae.push(Ve),{point:Re,angle:at,path:Ie,tilePath:ae,up:Ne}}function Ga(m,s){let h=s.length,g=h+4*m;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function Ko(m,s,h){let g=s[0],v=s[1];return m[0]=h[0]*g+h[4]*v+h[12],m[1]=h[1]*g+h[5]*v+h[13],m[3]=h[3]*g+h[7]*v+h[15],m}let Jp=(m,s,h)=>(1-h)*m+h*s,Pi=m=>m*m*m*m*m;class Qo{constructor(s,h,g,v,x,T,I){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new i.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Cu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Su,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let s=new Qo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,h=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.ah(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=i.aJ(this.projectionOptions);let g=!w(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){let s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.aJ({name:"mercator"});let h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.au(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){let h=-s*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=i.aC.create(),i.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){let h=i.at(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=i.ab(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){let h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){let s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let T=0;T<h.length;T++){let I=new i.P(h[T][0]*this.width,g+h[T][1]*(this.height-g)),M=s.pointCoordinate(I);if(!M)continue;let P=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);v+=M[3]*P,x+=P}return x===0?NaN:v/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude())),g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];let v=i._.length(i._.sub([],this._camera.position,g));return i.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!i.av.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){let g=[s.position.x,s.position.y,s.position.z];i._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let s=this._camera.position,h=new Xp;return h.position=new i.Y(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!i.av.length(s))return!1;i.av.normalize(s,s);let h=i._.transformQuat([],[0,0,-1],s),g=i._.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;let v=by(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){let h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=i.at(s[2],v/g,v/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){let h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){let h=[new i.aK(0,s)];if(this.renderWorldCopies){let g=this.pointCoordinate(new i.P(0,0)),v=this.pointCoordinate(new i.P(this.width,0)),x=this.pointCoordinate(new i.P(this.width,this.height)),T=this.pointCoordinate(new i.P(0,this.height)),I=Math.floor(Math.min(g.x,v.x,x.x,T.x)),M=Math.floor(Math.max(g.x,v.x,x.x,T.x)),P=1;for(let O=I-P;O<=M+P;O++)O!==0&&h.push(new i.aK(O,s))}return h}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(s,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(let T of s){let I=T.canonical,M=T.overscaledZ,P=T.wrap,O=1<<I.z,N=I.x+1<O,B=I.x>0,V=I.y+1<O,G=I.y>0,H=T.wrap-(B?0:1),q=T.wrap+(N?0:1),W=B?I.x-1:O-1,ee=N?I.x+1:0;h[0]<0?(v.push(new i.aL(M,q,I.z,ee,I.y)),h[1]<0&&V&&(v.push(new i.aL(M,P,I.z,I.x,I.y+1)),v.push(new i.aL(M,q,I.z,ee,I.y+1))),h[1]>0&&G&&(v.push(new i.aL(M,P,I.z,I.x,I.y-1)),v.push(new i.aL(M,q,I.z,ee,I.y-1)))):h[0]>0?(v.push(new i.aL(M,H,I.z,W,I.y)),h[1]<0&&V&&(v.push(new i.aL(M,P,I.z,I.x,I.y+1)),v.push(new i.aL(M,H,I.z,W,I.y+1))),h[1]>0&&G&&(v.push(new i.aL(M,P,I.z,I.x,I.y-1)),v.push(new i.aL(M,H,I.z,W,I.y-1)))):h[1]<0&&V?v.push(new i.aL(M,P,I.z,I.x,I.y+1)):G&&v.push(new i.aL(M,P,I.z,I.x,I.y-1))}if(v.length>1){v.sort((M,P)=>M.overscaledZ-P.overscaledZ||M.wrap-P.wrap||M.canonical.z-P.canonical.z||M.canonical.x-P.canonical.x||M.canonical.y-P.canonical.y);let T=0,I=0;for(;I<v.length;)v[I].equals(v[T])?++I:v[++T]=v[I++];v.length=T+1}let x=[];for(let T of v)v.some(I=>T.isChildOf(I))||x.push(T);return v=x.filter(T=>!s.some(I=>!!(T.overscaledZ<g&&I.isChildOf(T))||T.equals(I)||T.isChildOf(I))),v}coveringTiles(s){let h=this.coveringZoomLevel(s),g=h,v=this.elevation&&this.elevation.exaggeration(),x=v&&!s.isTerrainDEM,T=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);let I=this.locationCoordinate(this.center),M=this.center.lat,P=1<<h,O=[P*I.x,P*I.y,0],N=this.projection.name==="globe",B=!N,V=i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,B),G=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=P*i.ax(1,this.center.lat),q=this._camera.position[2]/i.ax(1,this.center.lat),W=[P*G.x,P*G.y,q*(B?1:H)],ee=N||v,te=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ne=this.isLODDisabled(!0)?h:0,ue;if(this._elevation&&s.isTerrainDEM)ue=1e4*this._elevation.exaggeration();else if(this._elevation){let xe=this._elevation.getMinMaxForVisibleTiles();ue=xe?xe.max:this._centerAltitude}else ue=this._centerAltitude;let ce=s.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,J=this.projection.isReprojectedInTileSpace?i.aN(this):1,ie=xe=>{let Ne=new i.Y(xe.x+25e-6,xe.y,xe.z),ot=new i.Y(xe.x,xe.y+25e-6,xe.z),ct=xe.toLngLat(),at=Ne.toLngLat(),je=ot.toLngLat(),He=this.locationCoordinate(ct),st=this.locationCoordinate(at),pt=this.locationCoordinate(je),Ot=Math.hypot(st.x-He.x,st.y-He.y),Ht=Math.hypot(pt.x-He.x,pt.y-He.y);return Math.sqrt(Ot*Ht)*J/25e-6},re=xe=>{let Re=ue,Ne=ce;return{aabb:i.aQ(this,P,0,0,0,xe,Ne,Re,this.projection),zoom:0,x:0,y:0,minZ:Ne,maxZ:Re,wrap:xe,fullyVisible:!1}},ge=[],Ie=[],ae=h,Ce=s.reparseOverscaled?g:h,Me=xe=>xe*xe,$e=Me((q-this._centerAltitude)*H),Ge=xe=>{if(!this._elevation||!xe.tileID||!T)return;let Re=this._elevation.getMinMaxForTile(xe.tileID),Ne=xe.aabb;Re?(Ne.min[2]=Re.min,Ne.max[2]=Re.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(xe.shouldSplit=Ve(xe),xe.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},Ve=xe=>{if(xe.zoom<ne)return!0;if(xe.zoom===ae)return!1;if(xe.shouldSplit!=null)return xe.shouldSplit;let Re=xe.aabb.distanceX(W),Ne=xe.aabb.distanceY(W),ot=$e,ct=1;if(N){ot=Me(xe.aabb.distanceZ(W));let He=Math.pow(2,xe.zoom),st=i.ay((xe.y+1)/He),pt=i.ay(xe.y/He),Ot=Math.min(Math.max(M,st),pt),Ht=i.b4(Ot)/i.b4(M);if(ct=Ot===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ht/this._mercatorScaleRatio),this.zoom<=i.b1&&xe.zoom===ae-1&&Ht>=.9)return!0}else if(x&&(ot=Me(xe.aabb.distanceZ(W)*H)),this.projection.isReprojectedInTileSpace&&g<=5){let He=Math.pow(2,xe.zoom),st=ie(new i.Y((xe.x+.5)/He,(xe.y+.5)/He));ct=st>.85?1:st}let at=Re*Re+Ne*Ne+ot,je=Me((1<<ae-xe.zoom)*te*ct*((He,st)=>{if(st*Me(.707)<He)return 1;let pt=Math.sqrt(st/He);return pt/(1.4144271570014144+(Math.pow(1.1,pt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ot,$e),at));return at<je};if(this.renderWorldCopies)for(let xe=1;xe<=3;xe++)ge.push(re(-xe)),ge.push(re(xe));for(ge.push(re(0));ge.length>0;){let xe=ge.pop(),Re=xe.x,Ne=xe.y,ot=xe.fullyVisible,ct=()=>this.projection.name==="globe"&&(xe.y===0||xe.y===(1<<xe.zoom)-1);if(!ot){let at=ee?xe.aabb.intersects(V):xe.aabb.intersectsFlat(V);if(at===0&&ct()){let je=new i.aO(xe.zoom,Re,Ne);at=i.aP(this,P,je,!0).intersects(V)}if(at===0)continue;ot=at===2}if(xe.zoom!==ae&&Ve(xe))for(let at=0;at<4;at++){let je=(Re<<1)+at%2,He=(Ne<<1)+(at>>1),st={aabb:T?xe.aabb.quadrant(at):i.aQ(this,P,xe.zoom+1,je,He,xe.wrap,xe.minZ,xe.maxZ,this.projection),zoom:xe.zoom+1,x:je,y:He,wrap:xe.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:xe.minZ,maxZ:xe.maxZ};x&&!N&&(st.tileID=new i.aL(xe.zoom+1===ae?Ce:xe.zoom+1,xe.wrap,xe.zoom+1,je,He),Ge(st)),ge.push(st)}else{let at=xe.zoom===ae?Ce:xe.zoom;if(s.minzoom&&s.minzoom>at)continue;if(!ot){let pt=ee?xe.aabb.intersectsPrecise(V):xe.aabb.intersectsPreciseFlat(V);if(pt===0&&ct()){let Ot=new i.aO(xe.zoom,Re,Ne);pt=i.aP(this,P,Ot,!0).intersectsPrecise(V)}if(pt===0)continue}let je=O[0]-(.5+Re+(xe.wrap<<xe.zoom))*(1<<h-xe.zoom),He=O[1]-.5-Ne,st=xe.tileID?xe.tileID:new i.aL(at,xe.wrap,xe.zoom,Re,Ne);Ie.push({tileID:st,distanceSq:je*je+He*He})}}if(this.fogCullDistSq){let xe=this.fogCullDistSq,Re=this.horizonLineFromTop();Ie=Ie.filter(Ne=>{let ot=[0,0,0,1],ct=[i.a3,i.a3,0,1],at=this.calculateFogTileMatrix(Ne.tileID.toUnwrapped());i.aA.transformMat4(ot,ot,at),i.aA.transformMat4(ct,ct,at);let je=i.aA.min([],ot,ct),He=i.aA.max([],ot,ct),st=i.aR(je,He);if(st===0)return!0;let pt=!1,Ot=this._elevation;if(Ot&&st>xe&&Re!==0){let Ht=this.calculateProjMatrix(Ne.tileID.toUnwrapped()),fn;s.isTerrainDEM||(fn=Ot.getMinMaxForTile(Ne.tileID)),fn||(fn={min:ce,max:ue});let cn=i.b2(this.rotation),kn=[cn[0]*i.a3,cn[1]*i.a3,fn.max];i._.transformMat4(kn,kn,Ht),pt=(1-kn[1])*this.height*.5<Re}return st<xe||pt})}return Ie.sort((xe,Re)=>xe.distanceSq-Re.distanceSq).map(xe=>xe.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){let h=i.at(s.lat,-i.aS,i.aS),g=this.projection.project(s.lng,h);return new i.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let I=this.worldSize;g=(h.x-x.x)/I,v=(h.y-x.y)/I}else{let I=this.pointCoordinate(h),M=this.pointCoordinate(x);g=I.x-M.x,v=I.y-M.y}let T=this.locationCoordinate(s);this.setLocation(new i.Y(T.x-g,T.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){let g=h?i.ax(h,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new i.Y(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){let g=h??this._centerAltitude,v=[s.x,s.y,0,1],x=[s.x,s.y,1,1];i.aA.transformMat4(v,v,this.pixelMatrixInverse),i.aA.transformMat4(x,x,this.pixelMatrixInverse);let T=x[3];i.aA.scale(v,v,1/v[3]),i.aA.scale(x,x,1/T);let I=v[2],M=x[2];return{p0:v,p1:x,t:I===M?0:(g-I)/(M-I)}}screenPointToMercatorRay(s){let h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return i.aA.transformMat4(h,h,this.pixelMatrixInverse),i.aA.transformMat4(g,g,this.pixelMatrixInverse),i.aA.scale(h,h,1/h[3]),i.aA.scale(g,g,1/g[3]),h[2]=i.ax(h[2],this._center.lat)*this.worldSize,g[2]=i.ax(g[2],this._center.lat)*this.worldSize,i.aA.scale(h,h,1/this.worldSize),i.aA.scale(g,g,1/this.worldSize),new i.aT([h[0],h[1],h[2]],i._.normalize([],i._.sub([],g,h)))}rayIntersectionCoordinate(s){let{p0:h,p1:g,t:v}=s,x=i.ax(h[2],this._center.lat),T=i.ax(g[2],this._center.lat);return new i.Y(i.a2(h[0],g[0],v)/this.worldSize,i.a2(h[1],g[1],v)/this.worldSize,i.a2(x,T,v))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new i.Y(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);let x=.02*v,T=s.clone();for(let I=0;I<10&&v-g>x;I++){T.y=i.a2(g,v,.66);let M=this.projection.pointCoordinate3D(this,T.x,T.y);M?(v=T.y,h=M):g=T.y}return h?new i.Y(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=i.aU)return!this.isPointAboveHorizon(s);let h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){let g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return i.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new i.P(v[0]/v[3],v[1]/v[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new i.P(h,s)),T=this.pointLocation3D(new i.P(v,s)),I=this.pointLocation3D(new i.P(v,g)),M=this.pointLocation3D(new i.P(h,g)),P=Math.min(x.lng,T.lng,I.lng,M.lng),O=Math.max(x.lng,T.lng,I.lng,M.lng),N=Math.min(x.lat,T.lat,I.lat,M.lat),B=Math.max(x.lat,T.lat,I.lat,M.lat),V=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,H=(q,W,ee,te,ne)=>{let ue=(q+ee)/2,ce=(W+te)/2,J=new i.P(ue,ce),{lng:ie,lat:re}=this.pointLocation3D(J),ge=Math.max(0,P-ie,N-re,ie-O,re-B);P=Math.min(P,ie),O=Math.max(O,ie),N=Math.min(N,re),B=Math.max(B,re),(ne<G||ge>V)&&(H(q,W,ue,ce,ne+1),H(ue,ce,ee,te,ne+1))};if(H(h,s,v,s,1),H(v,s,v,g,1),H(v,g,h,g,1),H(h,g,h,s,1),this.projection.name==="globe"){let[q,W]=i.aV(this);q?(B=90,O=180,P=-180):W&&(N=-90,O=180,P=-180)}return new i.ai(new i.aI(P,N),new i.aI(O,B))}_getBoundsRectangular(s,h){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,I=new i.P(v,g),M=new i.P(T,g),P=new i.P(T,x),O=new i.P(v,x),N=this.pointCoordinate(I,s),B=this.pointCoordinate(M,s),V=this.pointCoordinate(P,h),G=this.pointCoordinate(O,h),H=(q,W)=>(W.y-q.y)/(W.x-q.x);return N.y>1&&B.y>=0?N=new i.Y((1-G.y)/H(G,N)+G.x,1):N.y<0&&B.y<=1&&(N=new i.Y(-G.y/H(G,N)+G.x,0)),B.y>1&&N.y>=0?B=new i.Y((1-V.y)/H(V,B)+V.x,1):B.y<0&&N.y<=1&&(B=new i.Y(-V.y/H(V,B)+V.x,0)),new i.ai().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){let s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-i.aS,this.maxLat=i.aS,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aj(this.minLng)*this.tileSize,this.worldMaxX=i.aj(this.maxLng)*this.tileSize,this.worldMinY=i.ak(this.maxLat)*this.tileSize,this.worldMaxY=i.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){let h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];let v=s.canonical,x=1/this.height,T=this.cameraWorldSize,I=T/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*s.wrap)*I,P=v.y*I,O=this.point;O.x*=T/this.worldSize,O.y*=T/this.worldSize;let N=this.angle,B=Math.sin(-N),V=-Math.cos(-N);return g[h]={bearing:[B,V],center:[(O.x-M)*x,(O.y-P)*x],scale:I/i.a3*x},g[h]}calculateFogTileMatrix(s){let h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return i.ad.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(s,h=!1,g=!1){let v=s.key,x;if(x=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let T=this.calculatePosMatrix(s,this.worldSize),I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,i.ad.multiply(T,I,T),x[v]=new Float32Array(T),x[v]}calculatePixelsToTileUnitsMatrix(s){let h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];let v=i.aW(s,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let s=1/this.worldSize,h=i.ad.fromScaling([],[s,s,s]);return i.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let s=this._elevation;this._updateCameraState();let h=i.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),x=i.ax(1,this._center.lat);g[2]/=x,v[2]/=x,i._.normalize(v,v);let T=s.raycast(g,v,s.exaggeration());if(T){let I=i._.scaleAndAdd([],g,v,T),M=new i.Y(I[0],I[1],i.ax(I[2],i.ay(I[1]))),P=(M.z+i._.length([M.x-g[0],M.y-g[1],M.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;let h=this._elevation,g=i.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=h.getAtPointOrZero(new i.Y(...v)),T=this.pixelsPerMeter/this.worldSize*x,I=this._minimumHeightOverTerrain(),M=v[2]-T;if(M<=I)if(M<0||s){let P=this.locationCoordinate(this._center,this._centerAltitude),O=[v[0],v[1],P.z-v[2]],N=i._.length(O);O[2]-=(I-M)/this._pixelsPerMercatorPixel;let B=i._.length(O);if(B===0)return;i._.scale(O,O,N/B*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],P.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){let B=this.center;return B.lat=i.at(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(B.lng=i.at(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}let h=this._unmodified,{x:g,y:v}=this.point,x=0,T=g,I=v,M=this.width/2,P=this.height/2,O=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(v-P<O&&(I=O+P),v+P>N&&(I=N-P),N-O<this.height&&(x=Math.max(x,this.height/(N-O)),I=(N+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,G=this.worldSize/2-(B+V)/2;T=(g+G+this.worldSize)%this.worldSize-G,T-M<B&&(T=B+M),T+M>V&&(T=V-M),V-B<this.width&&(x=Math.max(x,this.width/(V-B)),T=(V+B)/2)}T===g&&I===v||(this.center=this.unproject(new i.P(T,I))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let s=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ax(1,this.center.lat)/i.ax(1,i.b3));let v=i.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,T=this._camera.getWorldToCamera(this.worldSize,x),I,M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-s.x/this.width,M[9]=2*s.y/this.height,this.isOrthographic){let re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=re*this.aspect,Ie=-ge,ae=-re;ge-=s.x,Ie-=s.x,re+=s.y,ae+=s.y,I=this._camera.getCameraToClipOrthographic(Ie,ge,ae,re,this._nearZ,this._farZ),((Ce,Me,$e,Ge)=>{for(let Ve=0;Ve<16;Ve++)Ce[Ve]=Jp(Me[Ve],$e[Ve],Ge)})(I,I,M,Pi(this.pitch>=15?1:this.pitch/15))}else I=M;let P=i.ad.mul([],M,T),O=i.ad.mul([],I,T);if(this.projection.isReprojectedInTileSpace){let re=this.locationCoordinate(this.center),ge=i.ad.identity([]);i.ad.translate(ge,ge,[re.x*this.worldSize,re.y*this.worldSize,0]),i.ad.multiply(ge,ge,i.aY(this)),i.ad.translate(ge,ge,[-re.x*this.worldSize,-re.y*this.worldSize,0]),i.ad.multiply(O,O,ge),i.ad.multiply(P,P,ge),this.inverseAdjustmentMatrix=i.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.scale([],O,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=O,this.invProjMatrix=i.ad.invert(new Float64Array(16),this.projMatrix),h){let re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);re[8]=2*-s.x/this.width,re[9]=2*s.y/this.height,this.expandedFarZProjMatrix=i.ad.mul([],re,T)}else this.expandedFarZProjMatrix=this.projMatrix;let N=i.ad.invert([],I);this.frustumCorners=i.a_.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let B=new Float32Array(16);i.ad.identity(B),i.ad.scale(B,B,[1,-1,1]),i.ad.rotateX(B,B,this._pitch),i.ad.rotateZ(B,B,this.angle);let V=i.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.clone(V);let G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-s.x/this.width,V[9]=2*(s.y+G)/this.height,this.skyboxMatrix=i.ad.multiply(B,V,B);let H=this.point,q=H.x,W=H.y,ee=this.width%2/2,te=this.height%2/2,ne=Math.cos(this.angle),ue=Math.sin(this.angle),ce=q-Math.round(q)+ne*ee+ue*te,J=W-Math.round(W)+ne*te+ue*ee,ie=new Float64Array(O);if(i.ad.translate(ie,ie,[ce>.5?ce-1:ce,J>.5?J-1:J,0]),this.alignedProjMatrix=ie,O=i.ad.create(),i.ad.scale(O,O,[this.width/2,-this.height/2,1]),i.ad.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=i.ad.create(),i.ad.scale(O,O,[1,-1,1]),i.ad.translate(O,O,[-1,-1,0]),i.ad.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=i.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},O=i.ad.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.a$(this);let re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i._.transformMat4(re,re,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,h];i._.scale(x,x,v),i._.scale(g,g,-1),i._.multiply(g,g,x);let T=i.ad.create();i.ad.translate(T,T,g),i.ad.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,v)}_computeCameraPosition(s){let h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,s/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((h-g)/v,1)),this._camera.position=i._.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){let s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=i.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ab(this._maxPitch)),I=Math.max((s[2]-x)/Math.cos(g),T),M=this._zoomFromMercatorZ(I);i._.scaleAndAdd(s,s,h,I),this._pitch=i.at(g,i.ab(this.minPitch),i.ab(this.maxPitch)),this.angle=i.au(v,-Math.PI,Math.PI),this._setZoom(i.at(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.Y(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){let s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=i.aU,v=0,x=1/0;for(;g-h>1e-6&&g>h;){let T=h+.5*(g-h),I=this.tileSize*Math.pow(2,T),M=this.getCameraToCenterDistance(this.projection,T,I),P=this.scaleZoom(M/(s*this.tileSize)),O=Math.abs(T-P);O<x&&(x=O,v=T),T<P?h=T:g=T}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){let g=Math.min(s.x,h.x),v=Math.max(s.x,h.x),x=Math.min(s.y,h.y),T=Math.max(s.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let I=[new i.P(g,x),new i.P(v,T),new i.P(g,T),new i.P(v,x)],M=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(let O of I){let N=this.pointRayIntersection(O);if(N.t<0)return!0;let B=this.rayIntersectionCoordinate(N);if(B.x<M||B.y<0||B.x>P||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(s,h){let g=i._.length(i._.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let s=function([h,g,v],x){let T=[h,g,v,1];i.aA.transformMat4(T,T,x);let I=T[3]=Math.max(T[3],1e-6);return T[0]/=I,T[1]/=I,T[2]/=I,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(s[0],s[1])}{let s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){let v=i.aX(s,h,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,g,v),T=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(T=Jp(1,T,Pi(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){let s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.multiply(s,s,this.globeMatrix),s}getFrustum(s){return i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}let Ir={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},_s=(m,s)=>{if(s>0&&m.terrain&&i.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=m.transform,g=Math.max(Math.abs(h._zoom-(m.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?i.$(60,45,h.pitch):i.$(30,15,h.pitch),x=h._farZ-h._nearZ,T=s*h.height,I=((1-(M=v))*h.cameraToCenterDistance+M*(h._farZ+T))*g;var M;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(I-h._nearZ)/x,(I-T-h._nearZ)/x]}}},ir={cascadeCount:2,shadowMapResolution:2048};class em{constructor(s,h){this.aabb=s,this.lastCascade=h}}class tm{add(s,h){let g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[s.key]=new em(h,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,h,g){let v=i.b6.fromPoints(s.points),x=0;for(let T in this.receivers){let I=this.receivers[T];if(!I||!v.intersectsAabb(I.aabb))continue;I.aabb.min=v.closestPoint(I.aabb.min),I.aabb.max=v.closestPoint(I.aabb.max);let M=I.aabb.getCorners();for(let P=0;P<g.length;P++){let O=!0;for(let N of M){let B=[N[0]*h,N[1]*h,N[2]];if(i._.transformMat4(B,B,g[P].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){O=!1;break}}if(I.lastCascade=P,x=Math.max(x,P),O)break}}return x+1}}class Td{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new tm,this._depthMode=new i.ae(s.context.gl.LEQUAL,i.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(ir,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(ir,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,h){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((G,H)=>{let q=g.style._mergedLayers[H];return G+(q.hasShadowPass()&&!q.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,T=ir.shadowMapResolution,I=ir.shadowMapResolution;if(this._cascades.length===0||ir.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<ir.cascadeCount;++G){let H=g._shadowMapDebug,q=x.gl,W=x.createFramebuffer(T,I,H,"texture"),ee=new i.T(x,{width:T,height:I,data:null},q.DEPTH_COMPONENT);if(W.depthAttachment.set(ee.texture),H){let te=new i.T(x,{width:T,height:I,data:null},q.RGBA);W.colorAttachment.set(te.texture)}this._cascades.push({framebuffer:W,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.aM,scale:0})}}this.shadowDirection=Mu(h);let M=0;if(s.elevation){let G=s.elevation,H=[1e4,-1e4];G.visibleDemTiles.filter(q=>q.dem).forEach(q=>{let W=q.dem.tree;H[0]=Math.min(H[0],W.minimums[0]),H[1]=Math.max(H[1],W.maximums[0])}),H[0]!==1e4&&(M=(H[1]-H[0])*G.exaggeration())}let P=1.5*s.cameraToCenterDistance,O=3*P,N=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){let H=this._cascades[G],q=s.height/50,W=1;ir.cascadeCount===1?W=O:G===0?W=P:(q=P,W=O);let[ee,te]=Au(s,this.shadowDirection,q,W,ir.shadowMapResolution,M);H.scale=s.scale,H.matrix=ee,H.boundingSphereRadius=te,i.ad.invert(N,H.matrix),H.frustum=i.aM.fromInvProjectionMatrix(N,1,0,!0),H.far=W}let B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ir.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ir.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ir.ShadowMap0,this._uniformValues.u_shadowmap_1=Ir.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let V=g.transform.elevation;for(let G of this._groundShadowTiles){let H={min:0,max:0};if(V){let q=V.getMinMaxForTile(G);q&&(H=q)}this.addShadowReceiver(G.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,h){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,ir.shadowMapResolution,ir.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:i.C.white,depth:1});for(let T of s.order){let I=s._mergedLayers[T];if(!I.hasShadowPass()||I.isHidden(g.transform.zoom))continue;let M=s.getLayerSourceCache(I),P=M?h[M.id]:void 0;(I.type==="model"||P&&P.length)&&g.renderLayer(g,M,I,P)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let s=this.painter,h=s.style,g=s.context,v=h.directionalLight,x=h.ambientLight;if(!v||!x)return;let T=[],I=_s(s,s.longestCutoffRange);I.shouldRenderCutoff&&T.push("RENDER_CUTOFF");let M=ys(h,v,x),P=new i.ae(g.gl.LEQUAL,i.ae.ReadOnly,s.depthRangeFor3D);for(let O of this._groundShadowTiles){let N=O.toUnwrapped(),B=s.isTileAffectedByFog(O),V=s.getOrCreateProgram("groundShadow",{defines:T,overrideFog:B});this.setupShadows(N,V),s.uploadCommonUniforms(g,V,N,null,I);let G={u_matrix:s.transform.calculateProjMatrix(N),u_ground_shadow_factor:M};V.draw(s,g.gl.TRIANGLES,P,i.ag.disabled,i.a.multiply,i.af.disabled,G,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?i.a.unblended:i.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){let h=this.painter.transform,g=h.calculatePosMatrix(s,h.worldSize);return i.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return i.ad.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,h,g,v=0){if(!this.enabled)return;let x=this.painter.transform,T=this.painter.context,I=T.gl,M=this._uniformValues,P=new Float64Array(16),O=x.calculatePosMatrix(s,x.worldSize);for(let N=0;N<this._cascades.length;N++)i.ad.multiply(P,this._cascades[N].matrix,O),M[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),T.activeTexture.set(I.TEXTURE0+Ir.ShadowMap0+N),this._cascades[N].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let N=i.b5(s.canonical),B=2/x.tileSize*i.a3/ir.shadowMapResolution,V=B*this._cascades[0].boundingSphereRadius,G=B*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(g==="vector-tile"?1:3)/Math.pow(2,v-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));M.u_shadow_normal_offset=[N,V*H,G*H],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(T,M)}setupShadowsFromMatrix(s,h,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,T=this._uniformValues,I=new Float64Array(16);for(let M=0;M<ir.cascadeCount;M++)i.ad.multiply(I,this._cascades[M].matrix,s),T[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),v.activeTexture.set(x.TEXTURE0+Ir.ShadowMap0+M),this._cascades[M].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(T.u_shadow_normal_offset=[1,5,5],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,h,g,v){if(v[2]>=0)return{};let x=function(M,P,O){let N=O/(1<<M.canonical.z);return new i.b6([M.canonical.x*N+M.wrap*O,M.canonical.y*N+M.wrap*O,0],[(M.canonical.x+1)*N+M.wrap*O,(M.canonical.y+1)*N+M.wrap*O,P])}(s,h,g).getCorners(),T=h/-v[2];v[0]<0?(i._.add(x[0],x[0],[v[0]*T,0,0]),i._.add(x[3],x[3],[v[0]*T,0,0])):v[0]>0&&(i._.add(x[1],x[1],[v[0]*T,0,0]),i._.add(x[2],x[2],[v[0]*T,0,0])),v[1]<0?(i._.add(x[0],x[0],[0,v[1]*T,0]),i._.add(x[1],x[1],[0,v[1]*T,0])):v[1]>0&&(i._.add(x[2],x[2],[0,v[1]*T,0]),i._.add(x[3],x[3],[0,v[1]*T,0]));let I={};return I.vertices=x,I.planes=[Wl(x[1],x[0],x[4]),Wl(x[2],x[1],x[5]),Wl(x[3],x[2],x[6]),Wl(x[0],x[3],x[7])],I}addShadowReceiver(s,h,g){this._receivers.add(s,i.b6.fromTileIdAndHeight(s,h,g))}getMaxCascadeForTile(s){let h=this._receivers.get(s);return h&&h.lastCascade?h.lastCascade:0}}function Wl(m,s,h){let g=i._.sub([],h,s),v=i._.sub([],m,s),x=i._.cross([],g,v),T=i._.length(x);return T===0?[0,0,1,0]:(i._.scale(x,x,1/T),[x[0],x[1],x[2],-i._.dot(x,s)])}function Mu(m){let s=m.properties.get("direction"),h=i.ac(s.x,s.y,s.z);h[2]=i.at(h[2],0,75);let g=i.b7([h[0],h[1],h[2]]);return i._.fromValues(g.x,g.y,g.z)}function ys(m,s,h){let g=s.properties.get("color"),v=s.properties.get("intensity"),x=s.properties.get("direction"),T=[x.x,x.y,x.z],I=h.properties.get("color"),M=h.properties.get("intensity"),P=Math.max(i._.dot([0,0,1],T),0),O=[0,0,0];i._.scale(O,I.toRenderColor(m.getLut(s.scope)).toArray01Linear().slice(0,3),M);let N=[0,0,0];return i._.scale(N,g.toRenderColor(m.getLut(h.scope)).toArray01Linear().slice(0,3),P*v),i.b8([O[0]>0?O[0]/(O[0]+N[0]):0,O[1]>0?O[1]/(O[1]+N[1]):0,O[2]>0?O[2]/(O[2]+N[2]):0])}function Au(m,s,h,g,v,x){let T=m.zoom,I=m.scale,M=m.worldSize,P=1/M,O=m.aspect,N=Math.sqrt(1+O*O)*Math.tan(.5*m.fovX),B=N*N,V=g-h,G=g+h,H,q;B>V/G?(H=g,q=g*N):(H=.5*G*(1+B),q=.5*Math.sqrt(V*V+2*(g*g+h*h)*B+G*G*B*B));let W=m.projection.pixelsPerMeter(m.center.lat,M),ee=m._camera.getCameraToWorldMercator(),te=[0,0,-H*P];i._.transformMat4(te,te,ee);let ne=q*P,ue=m._edgeInsets;if(!(ue.left===0&&ue.top===0&&ue.right===0&&ue.bottom===0||ue.left===ue.right&&ue.top===ue.bottom)){let ot=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?W:1),ct=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,h,g);ct[8]=2*-m.centerOffset.x/m.width,ct[9]=2*m.centerOffset.y/m.height;let at=new Float64Array(16);i.ad.mul(at,ct,ot);let je=new Float64Array(16);i.ad.invert(je,at);let He=i.aM.fromInvProjectionMatrix(je,M,T,!0);for(let st of He.points){let pt=((ce=st)[0]/=I,ce[1]/=I,ce[2]=i.ax(ce[2],m._center.lat),ce);ne=Math.max(ne,i._.len(i._.subtract([],te,pt)))}}var ce;ne*=v/(v-1);let J=Math.acos(s[2]),ie=Math.atan2(-s[0],-s[1]),re=new Su;re.position=te,re.setPitchBearing(J,ie);let ge=re.getWorldToCamera(M,W),Ie=ne*M,ae=Math.min(m._mercatorZfromZoom(17)*M*-2,-2*Ie),Ce=re.getCameraToClipOrthographic(-Ie,Ie,-Ie,Ie,ae,(Ie+x*W)/s[2]),Me=new Float64Array(16);i.ad.multiply(Me,Ce,ge);let $e=i._.fromValues(Math.floor(1e6*te[0])/1e6*M,Math.floor(1e6*te[1])/1e6*M,0),Ge=.5*v,Ve=[0,0,0];i._.transformMat4(Ve,$e,Me),i._.scale(Ve,Ve,Ge);let xe=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],Re=[0,0,0];i._.sub(Re,Ve,xe),i._.scale(Re,Re,-1/Ge);let Ne=new Float64Array(16);return i.ad.identity(Ne),i.ad.translate(Ne,Ne,Re),i.ad.multiply(Me,Ne,Me),[Me,Ie]}function Ed(m,s){return m!=null&&s!=null&&!(!m.hasData()||!s.hasData())&&m.demTexture!=null&&s.demTexture!=null&&m.tileID.key!==s.tileID.key}let Ha=new class{constructor(){this.operations={}}newMorphing(m,s,h,g,v){if(m in this.operations){let x=this.operations[m];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[m]={startTime:g,phase:0,duration:v,from:s,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;let s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(let s in this.operations){let h=this.operations[s];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Pu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function nm(m,s,h){if(s===0)return 0;let g=s<1&&h===514?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*g}function wy(m,s){let h=1<<m.z;return!s&&(m.x===0||m.x===h-1)||m.y===0||m.y===h-1}let Id=m=>({u_matrix:m});function Cd(m,s,h,g,v){if(v>0){let x=i.e.now(),T=(x-m.timeAdded)/v,I=s?(x-s.timeAdded)/v:-1,M=h.getSource(),P=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),O=!s||Math.abs(s.tileID.overscaledZ-P)>Math.abs(m.tileID.overscaledZ-P),N=O&&m.refreshedUponExpiration?1:i.at(O?T:1-I,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Zl extends Iu{constructor(s,h,g,v){super(s,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=i.W({type:"raster-array"},h)}triggerRepaint(s){let h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,h){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,i.R.Tile);s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(x,T,I,M)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(x)return x.code===20?void 0:(s.state="errored",h(x));this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:I,expires:M}),s.state="empty",h(null)})}unloadTile(s,h){let g=s.texture;g&&g instanceof i.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,h,g){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(h,g,(v,x)=>{if(v)return s.state="errored",this.fire(new i.d(v)),void this.triggerRepaint(s);x&&(s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:x})=>x===s),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(s,h,g){if(!s)return;let v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;h instanceof i.bk?x=h.paint.get("raster-array-band"):h instanceof i.bl&&(x=h.paint.get("raster-particle-array-band"));let T=x||this.getInitialBand(v);if(T!=null)if(s.textureDescriptor){if(!s.updateNeeded(v,T)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,T)}}let rr={vector:vd,raster:Iu,"raster-dem":class extends Iu{constructor(m,s,h,g){super(m,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=i.W({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){let h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(m.state="errored",s(v)),x&&(m.dem=x,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=i.h(this.map._requestManager.transformRequest(h,i.R.Tile),(function(v,x,T,I){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(v)m.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:T,expires:I});let M=ImageBitmap&&x instanceof ImageBitmap&&i.bi(),P=1-(x.width-i.bj(x.width))/2;P<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));let O=M?x:i.e.getImageData(x,P),N={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:P};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",N,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){let s=m.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,v=s.x===0?m.wrap-1:m.wrap,x=(s.x+1+h)%h,T=s.x+1===h?m.wrap+1:m.wrap,I={};return I[new i.aL(m.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},I[new i.aL(m.overscaledZ,T,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(I[new i.aL(m.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},I[new i.aL(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new i.aL(m.overscaledZ,T,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<h&&(I[new i.aL(m.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},I[new i.aL(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new i.aL(m.overscaledZ,T,s.z,x,s.y+1).key]={backfilled:!1}),I}},"raster-array":Zl,geojson:class extends i.E{constructor(m,s,h,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=i.W({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;let v=i.a3/this.tileSize;this.workerOptions=i.W({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:i.a3,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:i.a3,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){return this._options.dynamic?typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection")?this.fire(new i.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...m.features):this._data=m,this._updateWorkerData(!0),this):this.fire(new i.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:h},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.f("dataloading",{dataType:"source"})),this._loaded=!1;let s=i.W({append:m},this.workerOptions);s.scope=this.scope;let h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(i.e.resolveURL(h),i.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new i.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new i.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,s){let h=m.actor?"reloadTile":"loadTile";m.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:i.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};m.request=this.actor.send(h,x,(T,I)=>v&&!I?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):T?s(T):(m.loadVectorData(I,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.bm{constructor(m,s,h,g){super(m,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;let m=this.options;this.urls=[];for(let s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,i.R.Source).url);i.bn(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new i.d(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){let s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new i.d(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(m,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.bm,model:class extends i.E{constructor(m,s,h,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){let m=[];for(let s in this._options.models){let h=this._options.models[s],g=i.l(this.map._requestManager.transformRequest(h.uri,i.R.Model).url).then(v=>{if(!v)return;let x=i.c(v),T=new i.M(s,h.position,h.orientation,x);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(v=>{this.fire(new i.d(new Error(`Could not load model ${s} from ${h.uri}: ${v.message}`)))});m.push(g)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new i.d(new Error(`Could not load models: ${s.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(m,s,h,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"}));let s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Yp(this._options,this.map._requestManager,s,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.d(g))):v&&(i.W(this,v),v.bounds&&(this.tileBounds=new Eu(v.bounds,this.minzoom,this.maxzoom)),i.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){let h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,i.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=s;else{if(m.buckets){let x=Object.values(m.buckets);for(let T of x)T.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,T){return m.aborted?s(null):x&&x.status!==404?s(x):(T&&(T.resourceTiming&&(m.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&m.setExpiryData(T),m.buckets=gt(gt({},m.buckets),T.buckets),T.featureIndex&&(m.latestFeatureIndex=T.featureIndex)),m.state="loaded",void s(null))}}serialize(){return i.W({},this._options)}},canvas:class extends i.bm{constructor(m,s,h,g){super(m,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new i.d(new i.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.d(new i.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new i.d(new i.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new i.d(new i.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.d(new i.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof i.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.E{constructor(m,s,h,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Eu(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),i.W(this,i.ah(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){let{x:s,y:h,z:g}=m.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){let{x:h,y:g,z:v}=m.tileID.canonical,x=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:x.signal})).then((function(T){return delete m.request,m.aborted?(m.state="unloaded",s(null)):T===void 0?(m.state="errored",s(null)):T===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(T)?(this.loadTileData(m,T),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(m.state="errored",s(T))}),m.request.cancel=()=>x.abort()}loadTileData(m,s){m.setTexture(s,this._map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof i.T?(m.destroy(!0),m.texture&&m.texture instanceof i.T&&this._map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){let{x:h,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){let m=i.al(this.id,this.scope);this._map.style.clearSource(m)}_update(){this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))}}},Sd=function(m,s,h,g){let v=new rr[s.type](m,s,h,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return i.bp(["load","abort","unload","serialize","prepare"],v),v};class im extends i.bv{constructor(s){let h={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new i.bw(i.bx(),null),v=Sd("mock-dem",h,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class Ty extends i.bv{constructor(s){let h=Sd("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new i.bw(i.bx(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;let v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){let I=new i.by(T,this._source.tileSize*T.overscaleFactor(),s.tileZoom);I.state="loaded",this._tiles[T.key]=I}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){let h=this.proxyCachedFBO[s];if(h!==void 0){let g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class rm extends i.aL{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class om extends i.bq{constructor(s,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(M){let P=new i.bt,O=new i.bu,N=131;P.reserve(17161),O.reserve(33800);let B=i.a3/128,V=i.a3+B/2,G=V+B;for(let q=-B;q<G;q+=B)for(let W=-B;W<G;W+=B){let ee=W<0||W>V||q<0||q>V?24575:0,te=i.at(Math.round(W),0,i.a3),ne=i.at(Math.round(q),0,i.a3);P.emplaceBack(te+ee,ne)}let H=(q,W)=>{let ee=W*N+q;O.emplaceBack(ee+1,ee,ee+N),O.emplaceBack(ee+N,ee+N+1,ee+1)};for(let q=1;q<129;q++)for(let W=1;W<129;W++)H(W,q);return[0,129].forEach(q=>{for(let W=0;W<130;W++)H(W,q),H(q,W)}),[P,O,32768]}(),T=s.context;this.gridBuffer=T.createVertexBuffer(g,i.br.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=i.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=i.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ty(h.map),this.orthoMatrix=i.ad.create(),i.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.a3,0,i.a3,0,1);let I=T.gl;this._overlapStencilMode=new i.ag({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new im(h.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);let v=s.terrain.properties,x=s.terrain.drapeRenderMode===0,T=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.e.now();let I=s.terrain&&s.terrain.scope,M=v.get("source"),P=x?this._mockSourceCache:s.getSourceCache(M,I);if(!P)return void i.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=P,this._exaggeration=T?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;let O=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let N=this.getScaledDemTileSize();this.sourceCache.update(h,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(s){let h=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;let v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=s.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(x);let I=x-this._previousZoom,M=this._previousUpdateTimestamp,P=x;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(x-P)>.5&&(I=.5*(x-P+I)),I*v<0&&(P+=I)),this._evaluationZoom=P;let O=T.getExaggeration(P),N=O===T.getExaggeration(Math.max(0,P-.1));if(N&&Math.abs(O-this._exaggeration)<.01)return O;let B=Math.min(.1,.00375*(this._updateTimestamp-M));return(N||O<.1||Math.abs(I)<1e-4)&&(B=Math.min(.2,4*B)),i.a2(this._exaggeration,O,B)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(i.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(M=>{let P=h.getTileByID(M).tileID;return P.projMatrix=g.calculateProjMatrix(P.toUnwrapped()),P});(function(M,P){let O=P.transform.pointCoordinate(P.transform.getCameraPoint()),N=new i.P(O.x,O.y);M.sort((B,V)=>{if(V.overscaledZ-B.overscaledZ)return V.overscaledZ-B.overscaledZ;let G=new i.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),H=new i.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),q=N.mult(1<<B.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(G)-q.distSqr(H)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};let T=this._style._mergedSourceCaches;for(let M in T){let P=T[M];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,s[M],x),P.usedForTerrain))continue;let O=s[M];P.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[h.id]=v.map(M=>new rm(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let I={};this._visibleDemTiles=[];for(let M of this.proxyCoords){let P=this.terrainTileForTile[M.key];if(!P)continue;let O=P.tileID.key;O in I||(this._visibleDemTiles.push(P),I[O]=O)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;let g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){let s=this.painter.context,h=s.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),Zp(this.painter,v,x))}}_prepareDemTileUniforms(s,h,g,v){if(!h||h.demTexture==null)return!1;let x=s.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-x.z),I=v||"";return g[`u_dem_tl${I}`]=[x.x*T%1,x.y*T%1],g[`u_dem_scale${I}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){let g=new i.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.T(s,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0,h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&s++,g+x},0);return s?h/s:0}_updateEmptyDEMTexture(){let s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let I=new i.bz({width:1,height:1},new Float32Array([g]));return[h.R32F,I]})();this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(x,{premultiply:!1}):T=this._emptyDEMTexture=new i.T(s,x,v,{premultiply:!1}),T}setupElevationDraw(s,h,g){let v=this.painter.context,x=v.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};T.u_exaggeration=this.exaggeration();let I=null,M=null,P=1;if(g&&g.morphing&&this._useVertexMorphing){let V=g.morphing.srcDemTile,G=g.morphing.dstDemTile;P=g.morphing.phase,V&&G&&(this._prepareDemTileUniforms(s,V,T,"_prev")&&(M=V),this._prepareDemTileUniforms(s,G,T)&&(I=G))}let O=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,N=null;var B;if(this.enabled?M&&I?(N=I.demTexture,v.activeTexture.set(x.TEXTURE4),M.demTexture.bind(O(M),x.CLAMP_TO_EDGE),T.u_dem_lerp=P):(I=this.terrainTileForTile[s.tileID.key],N=this._prepareDemTileUniforms(s,I,T)?I.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),N&&(T.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(O(I),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&I){let V=(1<<I.tileID.canonical.z)*i.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=V}if(g&&g.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,T),this.painter.transform.projection.name==="globe"){let V=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,V)}}globeUniformValues(s,h,g){let v=s.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,i.a3,0),u_tile_br_up:v.upVector(h,i.a3,i.a3),u_tile_bl_up:v.upVector(h,0,i.a3),u_tile_up_scale:g?i.bs(1):v.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){let h=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,T,I,M){if(v.transform.projection.name==="globe")(function(P,O,N,B,V){let G=P.context,H=G.gl,q,W,ee=P.transform,te=i.ba(P,G,ee),ne=(Ce,Me)=>{if(W===Me)return;let $e=[Pu[Me],"PROJECTION_GLOBE_VIEW"];te&&$e.push("CUSTOM_ANTIALIASING");let Ge=P.isTileAffectedByFog(Ce);q=P.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:Ge}),W=Me},ue=P.colorModeForRenderPass(),ce=new i.ae(H.LEQUAL,i.ae.ReadWrite,P.depthRangeFor3D);Ha.update(V);let J=i.bb(ee),ie=[i.aj(ee.center.lng),i.ak(ee.center.lat)],re=P.globeSharedBuffers,ge=[ee.width*i.e.devicePixelRatio,ee.height*i.e.devicePixelRatio],Ie=Float32Array.from(ee.globeMatrix),ae={useDenormalizedUpVectorScale:!0};{let Ce=P.transform,Me=nm(Ce.zoom,O.exaggeration(),O.sourceCache._source.tileSize);W=-1;let $e=H.TRIANGLES;for(let Ge of B){let Ve=N.getTile(Ge),xe=i.ag.disabled,Re=O.prevTerrainTileForTile[Ge.key],Ne=O.terrainTileForTile[Ge.key];Ed(Re,Ne)&&Ha.newMorphing(Ge.key,Re,Ne,V,250),G.activeTexture.set(H.TEXTURE0),Ve.texture&&Ve.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let ot=Ha.getMorphValuesForProxy(Ge.key),ct=ot?1:0;ot&&i.o(ae,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:i.b9(ot.phase)}});let at=i.bc(Ge.canonical),je=i.bd(at.getCenter().lat),He=i.be(Ge.canonical,at,je,Ce.worldSize/Ce._pixelsPerMercatorPixel),st=i.bf(i.bg(Ge.canonical)),pt=xy(Ce.expandedFarZProjMatrix,Ie,J,st,i.a1(Ce.zoom),ie,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,ge,Me,Ce._farZ,He);if(ne(Ge,ct),q&&(O.setupElevationDraw(Ve,q,ae),P.uploadCommonUniforms(G,q,Ge.toUnwrapped()),re)){let[Ot,Ht,fn]=re.getGridBuffers(je,Me!==0);q.draw(P,$e,ce,xe,ue,i.af.backCCW,pt,"globe_raster",Ot,Ht,fn)}}}if(re&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){let Ce=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&Ce.push("CUSTOM_ANTIALIASING"),q=P.getOrCreateProgram("globeRaster",{defines:Ce});for(let Me of B){let{x:$e,y:Ge,z:Ve}=Me.canonical,xe=Ge===0,Re=Ge===(1<<Ve)-1,[Ne,ot,ct,at]=re.getPoleBuffers(Ve,!1);if(at&&(xe||Re)){let je=N.getTile(Me);G.activeTexture.set(H.TEXTURE0),je.texture&&je.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let He=i.bh(Ve,$e,ee),st=i.bf(i.bg(Me.canonical)),pt=(Ot,Ht)=>Ot.draw(P,H.TRIANGLES,ce,i.ag.disabled,ue,i.af.disabled,xy(ee.expandedFarZProjMatrix,He,He,st,0,ie,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,ge,0,ee._farZ),"globe_pole_raster",Ht,ct,at);O.setupElevationDraw(je,q,ae),P.uploadCommonUniforms(G,q,Me.toUnwrapped()),xe&&P.renderDefaultNorthPole&&pt(q,Ne),Re&&P.renderDefaultSouthPole&&(He=i.ad.scale(i.ad.create(),He,[1,-1,1]),pt(q,ot))}}}})(v,x,T,I,M);else{let P=v.context,O=P.gl,N,B,V=v.shadowRenderer,G=_s(v,v.longestCutoffRange),H=ue=>{if(B===ue)return;let ce=[];ce.push(Pu[ue]),G.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),N=v.getOrCreateProgram("terrainRaster",{defines:ce}),B=ue},q=v.colorModeForRenderPass(),W=new i.ae(O.LEQUAL,i.ae.ReadWrite,v.depthRangeFor3D);Ha.update(M);let ee=v.transform,te=nm(ee.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ne=[0,0,0];if(V){let ue=v.style.directionalLight,ce=v.style.ambientLight;ue&&ce&&(ne=ys(v.style,ue,ce))}{B=-1;let ue=O.TRIANGLES,[ce,J]=[x.gridIndexBuffer,x.gridSegments];for(let ie of I){let re=T.getTile(ie),ge=i.ag.disabled,Ie=x.prevTerrainTileForTile[ie.key],ae=x.terrainTileForTile[ie.key];Ed(Ie,ae)&&Ha.newMorphing(ie.key,Ie,ae,M,250),P.activeTexture.set(O.TEXTURE0),re.texture&&re.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let Ce=Ha.getMorphValuesForProxy(ie.key),Me=Ce?1:0,$e;Ce&&($e={morphing:{srcDemTile:Ce.from,dstDemTile:Ce.to,phase:i.b9(Ce.phase)}});let Ge=lt(ie.projMatrix,wy(ie.canonical,ee.renderWorldCopies)?te/10:te,ne);if(H(Me),!N)continue;x.setupElevationDraw(re,N,$e);let Ve=ie.toUnwrapped();V&&V.setupShadows(Ve,N),v.uploadCommonUniforms(P,N,Ve,null,G),N.draw(v,ue,W,ge,q,i.af.backCCW,Ge,"terrain_raster",x.gridBuffer,ce,J)}}}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;let h=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),I=h.style.order,M=[],P=0;for(let O of x){let N=v.getTileByID(O.proxyTileKey),B=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][s]:void 0,V=B!==void 0?v.renderCache[B]:this.pool[P++],G=B!==void 0;if(N.texture=V.tex,G&&!V.dirty){M.push(N.tileID);continue}let H;g.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(g.clear({color:i.C.transparent,stencil:0}),V.dirty=!1);for(let q=T.start;q<=T.end;++q){let W=h.style._mergedLayers[I[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[O.key][ee.id]:[O];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}if(this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let W=h.style._mergedLayers[I[q]];if(W.isHidden(h.transform.zoom))continue;let ee=h.style.getLayerSourceCache(W),te=ee?this.proxyToSource[O.key][ee.id]:[O];if(!te)continue;let ne=te;g.viewport.set([0,0,V.fb.width,V.fb.height]),H!==(ee?ee.id:null)&&(this._setupStencil(V,te,W,ee),H=ee?ee.id:null),h.renderLayer(h,ee,W,ne)}this.renderedToTile?(V.dirty=!0,M.push(N.tileID)):G||--P,P===5&&(P=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}isLayerOrderingCorrect(s){let h=s.order.length,g=-1,v=h;for(let x=0;x<h;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let T=x.tileID,I=1<<T.overscaledZ,{x:M,y:P}=T.canonical,O=M/I,N=(M+1)/I,B=P/I,V=(P+1)/I;return{minx:O,miny:B,maxx:N,maxy:V,t:x.dem.tree.raycastRoot(O,B,N,V,s,h,g),tile:x}});v.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,h,g);if(T!=null)return T}return null}_createFBO(){let s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);let v=new i.T(s,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=s.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new Na(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{let h=this._style._mergedLayers[s],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(let g of this._style.getSources())if(g instanceof vd){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!h[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof i.Z){h[x.id]=!0;for(let T of this.proxyCoords){let I=this.proxyToSource[T.key][x.id];if(I)for(let M of I)this._clearRenderCacheForTile(x.id,M)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Iu){s=!0;break}if(!s)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||h[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let T=v.paint.get("raster-fade-duration");for(let I of this.proxyCoords){let M=this.proxyToSource[I.key][x.id];if(M)for(let P of M){let O=Cd(x.getTile(P),x.findLoadedParent(P,0),x,this.painter.transform,T);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(x.id,P)}}}}_setupDrapedRenderBatches(){let s=this._style.order,h=s.length;if(h===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,T=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<h;)T=this._style._mergedLayers[s[x]];for(;x<h;++x){let I=this._style._mergedLayers[s[x]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=x):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let I=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>I.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let I=0;I<T.length;++I){let M=Object.values(T[I]);h.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let T=g.length-1;T>=0;T--){let I=g[T];if(h.getTileByID(I.key),h.proxyCachedFBO[I.key]!==void 0){let M=s[I.key],P=this.proxyToSource[I.key],O=0;for(let N in P){let B=P[N],V=M[N];if(!V||V.length!==B.length||B.some((G,H)=>G!==V[H]||v[N]&&v[N].hasOwnProperty(G.key))){O=-1;break}++O}for(let N in h.proxyCachedFBO[I.key])h.renderCache[h.proxyCachedFBO[I.key][N]].dirty=O<0||O!==Object.values(M).length}}let x=[...this._drapedRenderBatches];x.sort((T,I)=>I.end-I.start-(T.end-T.start));for(let T of x)for(let I of g){if(h.proxyCachedFBO[I.key])continue;let M=h.renderCachePool.pop();M===void 0&&h.renderCache.length<50&&(M=h.renderCache.length,h.renderCache.push(this._createFBO())),M!==void 0&&(h.proxyCachedFBO[I.key]={},h.proxyCachedFBO[I.key][T.start]=M,h.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,T=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):i.ag.disabled}_renderTileClippingMasks(s,h){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(i.a.disabled),v.setDepthMode(i.ae.disabled);let T=g.getOrCreateProgram("clippingMask");for(let I of s){let M=g._tileClippingMaskIDs[I.key]=--h;T.draw(g,x.TRIANGLES,i.ae.disabled,new i.ag({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),i.a.disabled,i.af.disabled,Id(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){let h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;let g=[s.x,s.y,1,1];i.aA.transformMat4(g,g,h.pixelMatrixInverse),i.aA.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;let v=h._camera.position,x=i.ax(1,h.center.lat),T=[v[0],v[1],v[2]/x,0],I=i._.subtract([],g.slice(0,3),T);i._.normalize(I,I);let M=this.raycast(T,I,this._exaggeration);return M!==null&&M?(i._.scaleAndAdd(T,T,I,M),T[3]=T[2],T[2]*=x,T):null}drawDepth(){let s=this.painter,h=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let T=h.gl,I=h.createFramebuffer(v,x,!0,"renderbuffer");h.activeTexture.set(T.TEXTURE0);let M=new i.T(h,{width:v,height:x,data:null},T.RGBA);M.bind(T.NEAREST,T.CLAMP_TO_EDGE),I.colorAttachment.set(M.texture);let P=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);I.depthAttachment.set(P),this._depthFBO=I,this._depthTexture=M}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(T,I,M,P){if(T.transform.projection.name==="globe")return;let O=T.context,N=O.gl;O.clear({depth:1});let B=T.getOrCreateProgram("terrainDepth"),V=new i.ae(N.LESS,i.ae.ReadWrite,T.depthRangeFor3D);for(let G of P){let H=M.getTile(G),q=lt(G.projMatrix,0,[0,0,0]);I.setupElevationDraw(H,B),B.draw(T,N.TRIANGLES,V,i.ag.disabled,i.a.unblended,i.af.backCCW,q,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof i.bm)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let M=0;M<x.length;M++){let P=x[M],O=this._findTileCoveringTileID(P,s);if(O){let N=this._createProxiedId(P,O,g[P.key]&&g[P.key][s.id]);v.push(N),this.proxyToSource[P.key][s.id]=[N]}}let T=!1,I=new Set;for(let M=0;M<h.length;M++){let P=s.getTile(h[M]);if(!P||!P.hasData())continue;let O=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==P.tileID.canonical.z){let N=this.proxyToSource[O.tileID.key][s.id],B=this._createProxiedId(O.tileID,P,g[O.tileID.key]&&g[O.tileID.key][s.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[O.tileID.key][s.id]=[B];let V=this.proxyToSource[O.tileID.key][s.id];I.has(V)||I.add(V),v.push(B),T=!0}}if(this._sourceTilesOverlap[s.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(let M of I)M.sort((P,O)=>O.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords,T=s.getSource(),I=T.tileID;if(!I)return;let M=new i.P(I.x,I.y)._div(1<<I.z),P=T.coordinates.map(i.Y.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-M.x),N.min.y=Math.min(N.min.y,B.y-M.y),N.max.x=Math.max(N.max.x,B.x-M.x),N.max.y=Math.max(N.max.y,B.y-M.y),N),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(N,B)=>{let V=N.wrap+N.canonical.x/(1<<N.canonical.z),G=N.canonical.y/(1<<N.canonical.z),H=i.a3/(1<<N.canonical.z),q=B.wrap+B.canonical.x/(1<<B.canonical.z),W=B.canonical.y/(1<<B.canonical.z);return V+H<q+P.min.x||V>q+P.max.x||G+H<W+P.min.y||G>W+P.max.y};for(let N=0;N<x.length;N++){let B=x[N];for(let V=0;V<h.length;V++){let G=s.getTile(h[V]);if(!G||!G.hasData()||O(B,G.tileID))continue;let H=this._createProxiedId(B,G,g[B.key]&&g[B.key][s.id]),q=this.proxyToSource[B.key][s.id];q?q.push(H):this.proxyToSource[B.key][s.id]=[H],v.push(H)}}}_createProxiedId(s,h,g){let v=this.orthoMatrix;if(g){let x=g.find(T=>T.key===h.tileID.key);if(x)return x}if(h.tileID.key!==s.key){let x=s.canonical.z-h.tileID.canonical.z,T,I,M;v=i.ad.create();let P=h.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(T=i.a3>>x,I=T*((h.tileID.canonical.x<<x)-s.canonical.x+P),M=T*((h.tileID.canonical.y<<x)-s.canonical.y)):(T=i.a3<<-x,I=i.a3*(h.tileID.canonical.x-(s.canonical.x+P<<-x)),M=i.a3*(h.tileID.canonical.y-(s.canonical.y<<-x))),i.ad.ortho(v,0,T,0,T,0,1),i.ad.translate(v,v,[I,M,0])}return new rm(h.tileID,s.key,v)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[h.id],x=v[s.key];if(g=x?h.getTileByID(x):null,g&&g.hasData()||x===null)return g;let T=g?g.tileID:s,I=T.overscaledZ,M=h.getSource().minzoom,P=[];if(!x){let N=h.getSource().maxzoom;if(s.canonical.z>=N){let B=s.canonical.z-N;h.getSource().reparseOverscaled?(I=Math.max(s.canonical.z+2,h.transform.tileZoom),T=new i.aL(I,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B)):B!==0&&(I=N,T=new i.aL(I,s.wrap,N,s.canonical.x>>B,s.canonical.y>>B))}T.key!==s.key&&(P.push(T.key),g=h.getTile(T))}let O=N=>{P.forEach(B=>{v[B]=N}),P.length=0};for(I-=1;I>=M&&(!g||!g.hasData());I--){g&&O(g.tileID.key);let N=T.calculateScaledKey(I);if(g=h.getTileByID(N),g&&g.hasData())break;let B=v[N];if(B===null)break;B===void 0?P.push(N):g=h.getTileByID(B)}return O(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}}function vs(m,s,h){let g=function(I,M,P){let O=i._.dot(M,I),N=i._.dot(P,[.2126,.7152,.0722]),B=(G,H,q)=>(1-q)*G+q*H,V=B(1-.3*Math.min(N,1),1,Math.min(O+1,1));return B(.92,1,Math.asin(i.at(M[2],-1,1))/Math.PI+.5)*V}(m,[0,0,1],s),v=[0,0,0];i._.scale(v,h.slice(0,3),g);let x=[0,0,0];i._.scale(x,s.slice(0,3),m[2]);let T=[0,0,0];return i._.add(T,v,x),i.b8(T)}let Dd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ey=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ru{static cacheKey(s,h,g,v){let x=`${h}${v?v.cacheKey:""}`;for(let T of g)s.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(s,h,g,v,x,T){let I=s.gl;this.program=I.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...T];let M=v?v.getBinderAttributes():[],P=(g.staticAttributes||[]).concat(M),O=v?v.defines():[];O=O.concat(T.map(q=>`#define ${q}`));let N=`#version 300 es
`,B=N+O.concat("precision mediump float;",yy,_y.fragmentSource).join(`
`);for(let q of g.fragmentIncludes)B+=`
${_d[q]}`;B+=`
${g.fragmentSource}`;let V=N+O.concat("precision highp float;",yy,_y.vertexSource).join(`
`);for(let q of g.vertexIncludes)V+=`
${_d[q]}`;V+=`
${g.vertexSource}`;let G=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(G,B),I.compileShader(G),I.attachShader(this.program,G);let H=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(H,V),I.compileShader(H),I.attachShader(this.program,H),this.attributes={},this.numAttributes=P.length;for(let q=0;q<this.numAttributes;q++)if(P[q]){let W=P[q].startsWith("a_")?P[q]:`a_${P[q]}`;I.bindAttribLocation(this.program,q,W),this.attributes[W]=q}I.linkProgram(this.program),I.deleteShader(H),I.deleteShader(G),this.fixedUniforms=x(s),this.binderUniforms=v?v.getUniforms(s):[],T.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new i.a7(q),u_dem_prev:new i.a7(q),u_dem_tl:new i.a8(q),u_dem_scale:new i.aa(q),u_dem_tl_prev:new i.a8(q),u_dem_scale_prev:new i.aa(q),u_dem_size:new i.aa(q),u_dem_lerp:new i.aa(q),u_exaggeration:new i.aa(q),u_depth:new i.a7(q),u_depth_size_inv:new i.a8(q),u_meter_to_dem:new i.aa(q),u_label_plane_matrix_inv:new i.a6(q)}))(s)),T.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new i.aq(q),u_tile_tr_up:new i.aq(q),u_tile_br_up:new i.aq(q),u_tile_bl_up:new i.aq(q),u_tile_up_scale:new i.aa(q)}))(s)),T.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new i.a6(q),u_fog_range:new i.a8(q),u_fog_color:new i.as(q),u_fog_horizon_blend:new i.aa(q),u_fog_vertical_limit:new i.a8(q),u_fog_temporal_offset:new i.aa(q),u_frustum_tl:new i.aq(q),u_frustum_tr:new i.aq(q),u_frustum_br:new i.aq(q),u_frustum_bl:new i.aq(q),u_globe_pos:new i.aq(q),u_globe_radius:new i.aa(q),u_globe_transition:new i.aa(q),u_is_globe:new i.a7(q),u_viewport:new i.a8(q)}))(s)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new i.as(q)}))(s)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new i.aq(q),u_lighting_directional_dir:new i.aq(q),u_lighting_directional_color:new i.aq(q),u_ground_radiance:new i.aq(q)}))(s)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new i.a6(q),u_light_matrix_1:new i.a6(q),u_fade_range:new i.a8(q),u_shadow_normal_offset:new i.aq(q),u_shadow_intensity:new i.aa(q),u_shadow_texel_size:new i.aa(q),u_shadow_map_resolution:new i.aa(q),u_shadow_direction:new i.aq(q),u_shadow_bias:new i.aq(q),u_shadowmap_0:new i.a7(q),u_shadowmap_1:new i.a7(q)}))(s))}}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(s,h){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(s,h){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(s,h){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;s.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(s,h,g,v,x,T,I,M,P,O){let N=s.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;let B=s.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||s._terrain&&s._terrain.renderingToTexture||!Dd.includes(this.name))||!(!N.layers3D||!Ey.includes(this.name))))return;let V=B.gl,G=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,B);if(!G)return;let H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");let q=s.getOrCreateProgram(this.name,{config:this.configuration,defines:H});B.program.set(q.program);let W=(ne,ue,ce)=>{if(ue[ne]&&ce[ne])for(let J in ue[ne])ce[ne][J]&&ce[ne][J].set(ce.program,J,ue[ne][J].current)};P&&P.setUniforms(q.program,B,q.binderUniforms,I,{zoom:M}),W("fixedUniforms",this,q),W("terrainUniforms",this,q),W("globeUniforms",this,q),W("fogUniforms",this,q),W("lightsUniforms",this,q),W("shadowUniforms",this,q),G.bind(),B.setColorMode(new i.a([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],i.C.transparent,[!0,!0,!0,!1])),B.setDepthMode(new i.ae(h.func===V.LESS?V.LEQUAL:h.func,i.ae.ReadOnly,h.range)),B.setStencilMode(i.ag.disabled);let ee=3*T.primitiveLength*2,te=3*T.primitiveOffset*2*2;O&&O>1?V.drawElementsInstanced(V.LINES,ee,V.UNSIGNED_SHORT,te,O):V.drawElements(V.LINES,ee,V.UNSIGNED_SHORT,te),x.bind(),B.program.set(this.program),B.setDepthMode(h),B.setStencilMode(g),B.setColorMode(v)}draw(s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q){let W=s.context,ee=W.gl;if(this.failedToCreate)return;W.program.set(this.program),W.setDepthMode(g),W.setStencilMode(v),W.setColorMode(x),W.setCullFace(T);for(let ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,I[ue]);G&&G.setUniforms(this.program,W,this.binderUniforms,B,{zoom:V});let te={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[h],ne=q&&q>0?1:void 0;for(let ue of N.get()){let ce=ue.vaos||(ue.vaos={});(ce[M]||(ce[M]=new w1)).bind(W,this,P,G?G.getPaintVertexBuffers():[],O,ue.vertexOffset,H||[],ne),q&&q>1?ee.drawElementsInstanced(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2,q):O?ee.drawElements(h,ue.primitiveLength*te,ee.UNSIGNED_SHORT,ue.primitiveOffset*te*2):ee.drawArrays(h,ue.vertexOffset,ue.vertexLength),h===ee.TRIANGLES&&O&&this._drawDebugWireframe(s,g,v,x,O,ue,B,V,G,q)}}}function Md(m,s){let h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,m.transform.tileZoom)/h,v=g*(s.tileID.canonical.x+s.tileID.wrap*h),x=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.bB(s,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let Ad=i.ad.create(),Yl=(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H)=>{let q=s.style.light,W=q.properties.get("position"),ee=[W.x,W.y,W.z],te=i.bC.create();q.properties.get("anchor")==="viewport"&&(i.bC.fromRotation(te,-s.transform.angle),i._.transformMat3(ee,ee,te));let ne=q.properties.get("color"),ue=s.transform,ce={u_matrix:m,u_lightpos:ee,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ad,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:N,u_vertical_scale:B,u_flood_light_intensity:V,u_ground_shadow_factor:G,u_emissive_strength:H};return ue.projection.name==="globe"&&(ce.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],ce.u_zoom_transition=M,ce.u_inv_rot_matrix=O,ce.u_merc_center=P,ce.u_up_dir=ue.projection.upVector(new i.aO(0,0,0),P[0]*i.a3,P[1]*i.a3),ce.u_height_lift=I),ce},Xl=(m,s,h)=>({u_matrix:m,u_edge_radius:s,u_vertical_scale:h}),sm=(m,s,h,g,v,x,T,I,M,P,O,N,B,V)=>{let G=Yl(m,s,h,g,v,x,T,M,P,O,N,B,V,1,[0,0,0],0),H={u_height_factor:-Math.pow(2,T.overscaledZ)/I.tileSize/8};return i.W(G,Md(s,I),H)},am=(m,s)=>({u_matrix:m,u_emissive_strength:s}),lm=(m,s,h,g)=>i.W(am(m,s),Md(h,g)),Iy=(m,s,h)=>({u_matrix:m,u_world:h,u_emissive_strength:s}),Pd=(m,s,h,g,v)=>i.W(lm(m,s,h,g),{u_world:v}),cm=(m,s,h,g)=>{let v=i.a3/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},Rd=(m,s,h=1)=>({u_matrix:m,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),ku=i.ad.create(),qa=(m,s,h,g,v,x,T)=>{let I=m.transform,M=I.projection.name==="globe",P=M?i.bD(I.zoom,s.canonical)*I._pixelsPerMercatorPixel:i.bB(h,1,x),O={u_matrix:s.projMatrix,u_extrude_scale:P,u_intensity:T,u_inv_rot_matrix:ku,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){O.u_inv_rot_matrix=g,O.u_merc_center=v,O.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],O.u_zoom_transition=i.a1(I.zoom);let N=v[0]*i.a3,B=v[1]*i.a3;O.u_up_dir=I.projection.upVector(new i.aO(0,0,0),N,B)}return O};function Cy(m,[s,h,g,v],[x,T]){if(x===T)return[0,0,0,0];let I=255*(m-1)/(m*(T-x));return[s*I,h*I,g*I,v*I]}function um(m,s,[h,g]){return h===g?0:.5/m+(s-h)*(m-1)/(m*(g-h))}let Ou=(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q,W,ee,te,ne)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:O.mix,u_opacity:O.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:i.bE(N.paint.get("raster-saturation")),u_contrast_factor:i.bF(N.paint.get("raster-contrast")),u_spin_weights:Lu(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:V,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:M,u_colorization_mix:Cy(i.bG,H,W),u_colorization_offset:um(i.bG,q,W),u_color_ramp:G,u_texture_offset:[te/(ee+2*te),ee/(ee+2*te)],u_texture_res:[ee+2*te,ee+2*te],u_emissive_strength:ne});function Lu(m){m*=Math.PI/180;let s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}let na=.15,hm=(m,s,h,g,v,x,T,I,M,P,O,N)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:P,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:M}),dm=(m,s,h,g,v,x,T,I,M,P)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:h,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:T,u_uv_offset:I,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[na,na]}),C1=(m,s,h,g,v,x,T,I,M,P)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:M,u_data_offset:P,u_particle_pos_scale:1.3,u_particle_pos_offset:[na,na]}),Mo=i.ad.create(),Kl=(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q,W)=>{let ee=v.transform,te={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ee.getCameraToCenterDistance(H),u_rotate_symbol:+h,u_aspect_ratio:ee.width/ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+g,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Mo,u_up_vector:[0,-1,0],u_color_adj_mat:q,u_icon_transition:W||0};return H.name==="globe"&&(te.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],te.u_zoom_transition=N,te.u_inv_rot_matrix=V,te.u_merc_center=B,te.u_camera_forward=ee._camera.forward(),te.u_ecef_origin=i.bH(ee.globeMatrix,O.toUnwrapped()),te.u_tile_matrix=Float32Array.from(ee.globeMatrix),te.u_up_vector=G),te},kd=(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q)=>i.W(Kl(m,s,h,g,v,x,T,I,M,P,N,B,V,G,H,q),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(q)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:i.e.devicePixelRatio,u_is_halo:+O,undefined:void 0}),Sy=(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H)=>i.W(kd(m,s,h,g,v,x,T,I,!0,M,!0,O,N,B,V,G,H),{u_texsize_icon:P,u_texture_icon:1}),Fu=(m,s,h,g)=>({u_matrix:m,u_emissive_strength:s,u_opacity:h,u_color:g}),Dy=(m,s,h,g,v,x,T,I)=>i.W(function(M,P,O,N,B){let{width:V,height:G}=N.imageManager.getPixelSize(P),H=Math.pow(2,B.tileID.overscaledZ),q=B.tileSize*Math.pow(2,N.transform.tileZoom)/H,W=q*(B.tileID.canonical.x+B.tileID.wrap*H),ee=q*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[V,G],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/i.bB(B,1,N.transform.tileZoom),u_pixel_coord_upper:[W>>16,ee>>16],u_pixel_coord_lower:[65535&W,65535&ee]}}(0,x,T,g,I),{u_matrix:m,u_emissive_strength:s,u_opacity:h}),fm=new Float32Array(i.ad.identity([])),Nu=(m,s,h,g,v,x,T,I,M,P,O,N,B,V=[0,0,0],G)=>{let H=v.style.light,q=H.properties.get("position"),W=[-q.x,-q.y,q.z],ee=i.bC.create();H.properties.get("anchor")==="viewport"&&(i.bC.fromRotation(ee,-v.transform.angle),i._.transformMat3(W,W,ee));let te=O.alphaMode==="MASK",ne=H.properties.get("color").toRenderColor(null),ue=B.paint.get("model-ambient-occlusion-intensity"),ce=B.paint.get("model-color").constantOr(i.C.white).toRenderColor(null),J=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:h,u_node_matrix:g||fm,u_lightpos:W,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:V,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+te,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:M,u_roughnessFactor:P,u_baseColorTexture:Ir.BaseColor,u_metallicRoughnessTexture:Ir.MetallicRoughness,u_normalTexture:Ir.Normal,u_occlusionTexture:Ir.Occlusion,u_emissionTexture:Ir.Emission,u_lutTexture:Ir.LUT,u_color_mix:[ce.r,ce.g,ce.b,J],u_aoIntensity:ue,u_emissive_strength:N,u_occlusionTextureTransform:G||[0,0,0,0]}},My=(m,s=fm,h=fm)=>({u_matrix:m,u_instance:s,u_node_matrix:h}),Ay=(m,s,h,g,v)=>({u_matrix:Float32Array.from(m),u_anchorPos:s,u_screenSizePx:h,u_occluderSizePx:g,u_color:v}),S1={fillExtrusion:m=>({u_matrix:new i.a6(m),u_lightpos:new i.aq(m),u_lightintensity:new i.aa(m),u_lightcolor:new i.aq(m),u_vertical_gradient:new i.aa(m),u_opacity:new i.aa(m),u_edge_radius:new i.aa(m),u_ao:new i.a8(m),u_tile_id:new i.aq(m),u_zoom_transition:new i.aa(m),u_inv_rot_matrix:new i.a6(m),u_merc_center:new i.a8(m),u_up_dir:new i.aq(m),u_height_lift:new i.aa(m),u_flood_light_color:new i.aq(m),u_vertical_scale:new i.aa(m),u_flood_light_intensity:new i.aa(m),u_ground_shadow_factor:new i.aq(m),u_emissive_strength:new i.aa(m)}),fillExtrusionDepth:m=>({u_matrix:new i.a6(m),u_edge_radius:new i.aa(m),u_vertical_scale:new i.aa(m)}),fillExtrusionPattern:m=>({u_matrix:new i.a6(m),u_lightpos:new i.aq(m),u_lightintensity:new i.aa(m),u_lightcolor:new i.aq(m),u_vertical_gradient:new i.aa(m),u_height_factor:new i.aa(m),u_edge_radius:new i.aa(m),u_ao:new i.a8(m),u_tile_id:new i.aq(m),u_zoom_transition:new i.aa(m),u_inv_rot_matrix:new i.a6(m),u_merc_center:new i.a8(m),u_up_dir:new i.aq(m),u_height_lift:new i.aa(m),u_image:new i.a7(m),u_texsize:new i.a8(m),u_pixel_coord_upper:new i.a8(m),u_pixel_coord_lower:new i.a8(m),u_tile_units_to_pixels:new i.aa(m),u_opacity:new i.aa(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new i.a6(m),u_opacity:new i.aa(m),u_ao_pass:new i.aa(m),u_meter_to_tile:new i.aa(m),u_ao:new i.a8(m),u_flood_light_intensity:new i.aa(m),u_flood_light_color:new i.aq(m),u_attenuation:new i.aa(m),u_edge_radius:new i.aa(m),u_fb:new i.a7(m),u_fb_size:new i.aa(m)}),fill:m=>({u_matrix:new i.a6(m),u_emissive_strength:new i.aa(m)}),fillPattern:m=>({u_matrix:new i.a6(m),u_emissive_strength:new i.aa(m),u_image:new i.a7(m),u_texsize:new i.a8(m),u_pixel_coord_upper:new i.a8(m),u_pixel_coord_lower:new i.a8(m),u_tile_units_to_pixels:new i.aa(m)}),fillOutline:m=>({u_matrix:new i.a6(m),u_emissive_strength:new i.aa(m),u_world:new i.a8(m)}),fillOutlinePattern:m=>({u_matrix:new i.a6(m),u_emissive_strength:new i.aa(m),u_world:new i.a8(m),u_image:new i.a7(m),u_texsize:new i.a8(m),u_pixel_coord_upper:new i.a8(m),u_pixel_coord_lower:new i.a8(m),u_tile_units_to_pixels:new i.aa(m)}),circle:i.bI,collisionBox:m=>({u_matrix:new i.a6(m),u_camera_to_center_distance:new i.aa(m),u_extrude_scale:new i.a8(m)}),collisionCircle:m=>({u_matrix:new i.a6(m),u_inv_matrix:new i.a6(m),u_camera_to_center_distance:new i.aa(m),u_viewport_size:new i.a8(m)}),debug:m=>({u_color:new i.a9(m),u_matrix:new i.a6(m),u_overlay:new i.a7(m),u_overlay_scale:new i.aa(m)}),clippingMask:m=>({u_matrix:new i.a6(m)}),heatmap:m=>({u_extrude_scale:new i.aa(m),u_intensity:new i.aa(m),u_matrix:new i.a6(m),u_inv_rot_matrix:new i.a6(m),u_merc_center:new i.a8(m),u_tile_id:new i.aq(m),u_zoom_transition:new i.aa(m),u_up_dir:new i.aq(m)}),heatmapTexture:m=>({u_image:new i.a7(m),u_color_ramp:new i.a7(m),u_opacity:new i.aa(m)}),hillshade:m=>({u_matrix:new i.a6(m),u_image:new i.a7(m),u_latrange:new i.a8(m),u_light:new i.a8(m),u_shadow:new i.a9(m),u_highlight:new i.a9(m),u_emissive_strength:new i.aa(m),u_accent:new i.a9(m)}),hillshadePrepare:m=>({u_matrix:new i.a6(m),u_image:new i.a7(m),u_dimension:new i.a8(m),u_zoom:new i.aa(m)}),line:i.bJ,linePattern:i.bK,raster:m=>({u_matrix:new i.a6(m),u_normalize_matrix:new i.a6(m),u_globe_matrix:new i.a6(m),u_merc_matrix:new i.a6(m),u_grid_matrix:new i.ar(m),u_tl_parent:new i.a8(m),u_scale_parent:new i.aa(m),u_fade_t:new i.aa(m),u_opacity:new i.aa(m),u_image0:new i.a7(m),u_image1:new i.a7(m),u_brightness_low:new i.aa(m),u_brightness_high:new i.aa(m),u_saturation_factor:new i.aa(m),u_contrast_factor:new i.aa(m),u_spin_weights:new i.aq(m),u_perspective_transform:new i.a8(m),u_raster_elevation:new i.aa(m),u_zoom_transition:new i.aa(m),u_merc_center:new i.a8(m),u_cutoff_params:new i.as(m),u_colorization_mix:new i.as(m),u_colorization_offset:new i.aa(m),u_color_ramp:new i.a7(m),u_texture_offset:new i.a8(m),u_texture_res:new i.a8(m),u_emissive_strength:new i.aa(m)}),rasterParticle:m=>({u_matrix:new i.a6(m),u_normalize_matrix:new i.a6(m),u_globe_matrix:new i.a6(m),u_merc_matrix:new i.a6(m),u_grid_matrix:new i.ar(m),u_tl_parent:new i.a8(m),u_scale_parent:new i.aa(m),u_fade_t:new i.aa(m),u_opacity:new i.aa(m),u_image0:new i.a7(m),u_image1:new i.a7(m),u_raster_elevation:new i.aa(m),u_zoom_transition:new i.aa(m),u_merc_center:new i.a8(m),u_cutoff_params:new i.as(m)}),rasterParticleTexture:m=>({u_texture:new i.a7(m),u_opacity:new i.aa(m)}),rasterParticleDraw:m=>({u_particle_texture:new i.a7(m),u_particle_texture_side_len:new i.aa(m),u_tile_offset:new i.a8(m),u_velocity:new i.a7(m),u_color_ramp:new i.a7(m),u_velocity_res:new i.a8(m),u_max_speed:new i.aa(m),u_uv_offset:new i.a8(m),u_data_scale:new i.as(m),u_data_offset:new i.aa(m),u_particle_pos_scale:new i.aa(m),u_particle_pos_offset:new i.a8(m)}),rasterParticleUpdate:m=>({u_particle_texture:new i.a7(m),u_particle_texture_side_len:new i.aa(m),u_velocity:new i.a7(m),u_velocity_res:new i.a8(m),u_max_speed:new i.aa(m),u_speed_factor:new i.aa(m),u_reset_rate:new i.aa(m),u_rand_seed:new i.aa(m),u_uv_offset:new i.a8(m),u_data_scale:new i.as(m),u_data_offset:new i.aa(m),u_particle_pos_scale:new i.aa(m),u_particle_pos_offset:new i.a8(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new i.a7(m),u_is_size_feature_constant:new i.a7(m),u_size_t:new i.aa(m),u_size:new i.aa(m),u_camera_to_center_distance:new i.aa(m),u_rotate_symbol:new i.a7(m),u_aspect_ratio:new i.aa(m),u_fade_change:new i.aa(m),u_matrix:new i.a6(m),u_label_plane_matrix:new i.a6(m),u_coord_matrix:new i.a6(m),u_is_text:new i.a7(m),u_pitch_with_map:new i.a7(m),u_texsize:new i.a8(m),u_tile_id:new i.aq(m),u_zoom_transition:new i.aa(m),u_inv_rot_matrix:new i.a6(m),u_merc_center:new i.a8(m),u_camera_forward:new i.aq(m),u_tile_matrix:new i.a6(m),u_up_vector:new i.aq(m),u_ecef_origin:new i.aq(m),u_texture:new i.a7(m),u_icon_transition:new i.aa(m),u_color_adj_mat:new i.a6(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new i.a7(m),u_is_size_feature_constant:new i.a7(m),u_size_t:new i.aa(m),u_size:new i.aa(m),u_camera_to_center_distance:new i.aa(m),u_rotate_symbol:new i.a7(m),u_aspect_ratio:new i.aa(m),u_fade_change:new i.aa(m),u_matrix:new i.a6(m),u_label_plane_matrix:new i.a6(m),u_coord_matrix:new i.a6(m),u_is_text:new i.a7(m),u_pitch_with_map:new i.a7(m),u_texsize:new i.a8(m),u_texture:new i.a7(m),u_gamma_scale:new i.aa(m),u_device_pixel_ratio:new i.aa(m),u_tile_id:new i.aq(m),u_zoom_transition:new i.aa(m),u_inv_rot_matrix:new i.a6(m),u_merc_center:new i.a8(m),u_camera_forward:new i.aq(m),u_tile_matrix:new i.a6(m),u_up_vector:new i.aq(m),u_ecef_origin:new i.aq(m),u_is_halo:new i.a7(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new i.a7(m),u_is_size_feature_constant:new i.a7(m),u_size_t:new i.aa(m),u_size:new i.aa(m),u_camera_to_center_distance:new i.aa(m),u_rotate_symbol:new i.a7(m),u_aspect_ratio:new i.aa(m),u_fade_change:new i.aa(m),u_matrix:new i.a6(m),u_label_plane_matrix:new i.a6(m),u_coord_matrix:new i.a6(m),u_is_text:new i.a7(m),u_pitch_with_map:new i.a7(m),u_texsize:new i.a8(m),u_texsize_icon:new i.a8(m),u_texture:new i.a7(m),u_texture_icon:new i.a7(m),u_gamma_scale:new i.aa(m),u_device_pixel_ratio:new i.aa(m),u_is_halo:new i.a7(m)}),background:m=>({u_matrix:new i.a6(m),u_emissive_strength:new i.aa(m),u_opacity:new i.aa(m),u_color:new i.a9(m)}),backgroundPattern:m=>({u_matrix:new i.a6(m),u_emissive_strength:new i.aa(m),u_opacity:new i.aa(m),u_image:new i.a7(m),u_pattern_tl:new i.a8(m),u_pattern_br:new i.a8(m),u_texsize:new i.a8(m),u_pattern_size:new i.a8(m),u_pixel_coord_upper:new i.a8(m),u_pixel_coord_lower:new i.a8(m),u_tile_units_to_pixels:new i.aa(m)}),terrainRaster:ja,terrainDepth:ja,skybox:m=>({u_matrix:new i.a6(m),u_sun_direction:new i.aq(m),u_cubemap:new i.a7(m),u_opacity:new i.aa(m),u_temporal_offset:new i.aa(m)}),skyboxGradient:m=>({u_matrix:new i.a6(m),u_color_ramp:new i.a7(m),u_center_direction:new i.aq(m),u_radius:new i.aa(m),u_opacity:new i.aa(m),u_temporal_offset:new i.aa(m)}),skyboxCapture:m=>({u_matrix_3f:new i.ar(m),u_sun_direction:new i.aq(m),u_sun_intensity:new i.aa(m),u_color_tint_r:new i.as(m),u_color_tint_m:new i.as(m),u_luminance:new i.aa(m)}),globeRaster:m=>({u_proj_matrix:new i.a6(m),u_globe_matrix:new i.a6(m),u_normalize_matrix:new i.a6(m),u_merc_matrix:new i.a6(m),u_zoom_transition:new i.aa(m),u_merc_center:new i.a8(m),u_image0:new i.a7(m),u_grid_matrix:new i.ar(m),u_skirt_height:new i.aa(m),u_far_z_cutoff:new i.aa(m),u_frustum_tl:new i.aq(m),u_frustum_tr:new i.aq(m),u_frustum_br:new i.aq(m),u_frustum_bl:new i.aq(m),u_globe_pos:new i.aq(m),u_globe_radius:new i.aa(m),u_viewport:new i.a8(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.aq(m),u_frustum_tr:new i.aq(m),u_frustum_br:new i.aq(m),u_frustum_bl:new i.aq(m),u_horizon:new i.aa(m),u_transition:new i.aa(m),u_fadeout_range:new i.aa(m),u_color:new i.as(m),u_high_color:new i.as(m),u_space_color:new i.as(m),u_temporal_offset:new i.aa(m),u_horizon_angle:new i.aa(m)}),model:m=>({u_matrix:new i.a6(m),u_lighting_matrix:new i.a6(m),u_normal_matrix:new i.a6(m),u_node_matrix:new i.a6(m),u_lightpos:new i.aq(m),u_lightintensity:new i.aa(m),u_lightcolor:new i.aq(m),u_camera_pos:new i.aq(m),u_opacity:new i.aa(m),u_baseColorFactor:new i.as(m),u_emissiveFactor:new i.as(m),u_metallicFactor:new i.aa(m),u_roughnessFactor:new i.aa(m),u_baseTextureIsAlpha:new i.a7(m),u_alphaMask:new i.a7(m),u_alphaCutoff:new i.aa(m),u_baseColorTexture:new i.a7(m),u_metallicRoughnessTexture:new i.a7(m),u_normalTexture:new i.a7(m),u_occlusionTexture:new i.a7(m),u_emissionTexture:new i.a7(m),u_lutTexture:new i.a7(m),u_color_mix:new i.as(m),u_aoIntensity:new i.aa(m),u_emissive_strength:new i.aa(m),u_occlusionTextureTransform:new i.as(m)}),modelDepth:m=>({u_matrix:new i.a6(m),u_instance:new i.a6(m),u_node_matrix:new i.a6(m)}),groundShadow:m=>({u_matrix:new i.a6(m),u_ground_shadow_factor:new i.aq(m)}),stars:m=>({u_matrix:new i.a6(m),u_up:new i.aq(m),u_right:new i.aq(m),u_intensity_multiplier:new i.aa(m)}),occlusion:m=>({u_matrix:new i.a6(m),u_anchorPos:new i.aq(m),u_screenSizePx:new i.a8(m),u_occluderSizePx:new i.a8(m),u_color:new i.as(m)})};function Od(m,s,h){let g=s.createTileMatrix(m,m.worldSize,h.toUnwrapped());return i.ad.multiply(new Float32Array(16),m.projMatrix,g)}function D1(m,s,h){if(s.projection.name===h.projection.name)return m.projMatrix;let g=h.clone();return g.setProjection(s.projection),Od(g,s.getProjection(),m)}function Ql(m,s,h){return s.name===h.projection.name?m.projMatrix:Od(h,s,m)}let Ld;function zu(m,s,h,g,v,x,T){let I=m.context,M=I.gl,P=m.transform,O=m.getOrCreateProgram("collisionBox"),N=[],B=0,V=0;for(let ne=0;ne<g.length;ne++){let ue=g[ne],ce=s.getTile(ue),J=ce.getBucket(h);if(!J)continue;let ie=D1(ue,J,P),re=ie;v[0]===0&&v[1]===0||(re=m.translatePosMatrix(ie,ce,v,x));let ge=T?J.textCollisionBox:J.iconCollisionBox,Ie=J.collisionCircleArray;if(Ie.length>0){let ae=i.ad.create(),Ce=re;i.ad.mul(ae,J.placementInvProjMatrix,P.glCoordMatrix),i.ad.mul(ae,ae,J.placementViewportMatrix),N.push({circleArray:Ie,circleOffset:V,transform:Ce,invTransform:ae,projection:J.getProjection()}),B+=Ie.length/4,V=B}ge&&(m.terrain&&m.terrain.setupElevationDraw(ce,O),O.draw(m,M.LINES,i.ae.disabled,i.ag.disabled,m.colorModeForRenderPass(),i.af.disabled,cm(re,P,ce,J.getProjection()),h.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,P.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!T||!N.length)return;let G=m.getOrCreateProgram("collisionCircle"),H=new i.bL;H.resize(4*B),H._trim();let q=0;for(let ne of N)for(let ue=0;ue<ne.circleArray.length/4;ue++){let ce=4*ue,J=ne.circleArray[ce+0],ie=ne.circleArray[ce+1],re=ne.circleArray[ce+2],ge=ne.circleArray[ce+3];H.emplace(q++,J,ie,re,ge,0),H.emplace(q++,J,ie,re,ge,1),H.emplace(q++,J,ie,re,ge,2),H.emplace(q++,J,ie,re,ge,3)}(!Ld||Ld.length<2*B)&&(Ld=function(ne){let ue=2*ne,ce=new i.bu;ce.resize(ue),ce._trim();for(let J=0;J<ue;J++){let ie=6*J;ce.uint16[ie+0]=4*J+0,ce.uint16[ie+1]=4*J+1,ce.uint16[ie+2]=4*J+2,ce.uint16[ie+3]=4*J+2,ce.uint16[ie+4]=4*J+3,ce.uint16[ie+5]=4*J+0}return ce}(B));let W=I.createIndexBuffer(Ld,!0),ee=I.createVertexBuffer(H,i.bM.members,!0);for(let ne of N){let ue={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(te=P).getCameraToCenterDistance(ne.projection),u_viewport_size:[te.width,te.height]};G.draw(m,M.TRIANGLES,i.ae.disabled,i.ag.disabled,m.colorModeForRenderPass(),i.af.disabled,ue,h.id,ee,W,i.b.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,P.zoom)}var te;ee.destroy(),W.destroy()}let Wa=i.ad.create();function Py(m){let s=m._camera.getWorldToCamera(m.worldSize,1),h=i.ad.multiply([],s,m.globeMatrix);i.ad.invert(h,h);let g=[0,0,0],v=[0,1,0,0];return i.aA.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],i._.normalize(g,g),g}function M1({width:m,height:s,anchor:h,textOffset:g,textScale:v},x){let{horizontalAlign:T,verticalAlign:I}=i.bQ(h),M=-(T-.5)*m,P=-(I-.5)*s,O=i.bP(h,g);return new i.P((M/v+O[0])*x,(P/v+O[1])*x)}function Ry(m,s,h,g,v,x,T,I,M,P,O){let N=m.text.placedSymbolArray,B=m.text.dynamicLayoutVertexArray,V=m.icon.dynamicLayoutVertexArray,G={},H=m.getProjection(),q=Ql(I,H,x),W=x.elevation,ee=H.upVectorScale(I.canonical,x.center.lat,x.worldSize).metersToTile;B.clear();for(let te=0;te<N.length;te++){let ne=N.get(te),{tileAnchorX:ue,tileAnchorY:ce,numGlyphs:J}=ne,ie=ne.hidden||!ne.crossTileID||m.allowVerticalPlacement&&!ne.placedOrientation?null:g[ne.crossTileID];if(ie){let re=0,ge=0,Ie=0;if(W){let Ne=W?W.getAtTileOffset(I,ue,ce):0,[ot,ct,at]=H.upVector(I.canonical,ue,ce);re=Ne*ot*ee,ge=Ne*ct*ee,Ie=Ne*at*ee}let[ae,Ce,Me,$e]=mo(ne.projectedAnchorX+re,ne.projectedAnchorY+ge,ne.projectedAnchorZ+Ie,h?q:T),Ge=_r(x.getCameraToCenterDistance(H),$e),Ve=v.evaluateSizeForFeature(m.textSizeData,P,ne)*Ge/i.bN;h&&(Ve*=m.tilePixelRatio/M);let xe=M1(ie,Ve);h?({x:ae,y:Ce,z:Me}=H.projectTilePoint(ue+xe.x,ce+xe.y,I.canonical),[ae,Ce,Me]=mo(ae+re,Ce+ge,Me+Ie,T)):(s&&xe._rotate(-x.angle),ae+=xe.x,Ce+=xe.y,Me=0);let Re=m.allowVerticalPlacement&&ne.placedOrientation===i.aE.vertical?Math.PI/2:0;for(let Ne=0;Ne<J;Ne++)i.aH(B,ae,Ce,Me,Re);O&&ne.associatedIconIndex>=0&&(G[ne.associatedIconIndex]={x:ae,y:Ce,z:Me,angle:Re})}else Ga(J,B)}if(O){V.clear();let te=m.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){let ue=te.get(ne),{numGlyphs:ce}=ue,J=G[ne];if(ue.hidden||!J)Ga(ce,V);else{let{x:ie,y:re,z:ge,angle:Ie}=J;for(let ae=0;ae<ce;ae++)i.aH(V,ie,re,ge,Ie)}}m.icon.dynamicLayoutVertexBuffer.updateData(V)}m.text.dynamicLayoutVertexBuffer.updateData(B)}function pm(m,s,h,g,v,x,T={}){let I=h.paint.get("icon-translate"),M=h.paint.get("text-translate"),P=h.paint.get("icon-translate-anchor"),O=h.paint.get("text-translate-anchor"),N=h.layout.get("icon-rotation-alignment"),B=h.layout.get("text-rotation-alignment"),V=h.layout.get("icon-pitch-alignment"),G=h.layout.get("text-pitch-alignment"),H=h.layout.get("icon-keep-upright"),q=h.layout.get("text-keep-upright"),W=h.paint.get("icon-color-saturation"),ee=h.paint.get("icon-color-contrast"),te=h.paint.get("icon-color-brightness-min"),ne=h.paint.get("icon-color-brightness-max"),ue=h.paint.get("icon-occlusion-opacity").constantOr(0),ce=h.paint.get("text-occlusion-opacity").constantOr(0),J=m.context,ie=J.gl,re=m.transform,ge=N==="map",Ie=B==="map",ae=V==="map",Ce=G==="map",Me=ue!==1||ce!==1,$e=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ge=!1,Ve=m.depthModeForSublayer(0,i.ae.ReadOnly),xe=[i.aj(re.center.lng),i.ak(re.center.lat)],Re=h.layout.get("text-variable-anchor"),Ne=re.projection.name==="globe",ot=[],ct=[0,-1,0];for(let at of g){let je=s.getTile(at),He=je.getBucket(h);if(!He||He.projection.name==="mercator"&&Ne||He.fullyClipped)continue;let st=He.projection.name==="globe",pt=st?i.a1(re.zoom):0,Ot=Ql(at,He.getProjection(),re),Ht=re.calculatePixelsToTileUnitsMatrix(je),fn=Re&&He.hasTextData(),cn=He.hasIconTextFit()&&fn&&He.hasIconData(),kn=He.getProjection().createInversionMatrix(re,at.canonical),jt=()=>{let pn=ge&&h.layout.get("symbol-placement")!=="point",Be=[];Me&&m.symbolParams.useOcclusionQueries&&!st&&!Ne&&Be.push("OCCLUSION_QUERIES");let ut=pn||cn,Gi=h.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&ae&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),Gi>0&&Be.push("ICON_TRANSITION"),He.icon.zOffsetVertexBuffer&&Be.push("Z_OFFSET"),W===0&&ee===0&&te===0&&ne===1||Be.push("COLOR_ADJUSTMENT");let On=He.icon.programConfigurations.get(h.id),Ee=m.getOrCreateProgram(He.sdfIcons?"symbolSDF":"symbolIcon",{config:On,defines:Be}),Vr,vr=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],Yi=He.iconSizeData,Sr=i.aD(Yi,re.zoom),Wr=ae||re.pitch!==0,yo=Ua(Ot,je.tileID.canonical,ae,ge,re,He.getProjection(),Ht),to=Hl(Ot,je.tileID.canonical,ae,ge,re,He.getProjection(),Ht),ua=m.translatePosMatrix(to,je,I,P,!0),ha=m.translatePosMatrix(Ot,je,I,P),ws=ut?Wa:yo,ns=ge&&!ae&&!pn,Ts=ct;!Ne&&!re.mercatorFromTransition||ge||(Ts=Py(re));let hc=st?Ts:ct;if(He.sdfIcons&&!He.iconsInText)Vr=kd(Yi.kind,Sr,ns,ae,m,ha,ws,ua,!1,vr,!0,at,pt,xe,kn,hc,He.getProjection());else{let rl=h.getColorAdjustmentMatrix(W,ee,te,ne);Vr=Kl(Yi.kind,Sr,ns,ae,m,ha,ws,ua,!1,vr,at,pt,xe,kn,hc,He.getProjection(),rl,Gi)}let ah=je.imageAtlasTexture?je.imageAtlasTexture:null,dc=h.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear,fc=He.sdfIcons||m.options.rotating||m.options.zooming||dc||Wr?ie.LINEAR:ie.NEAREST,nf=He.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,rf=m.terrain&&ae&&pn?i.ad.invert(i.ad.create(),yo):Wa;if(pn&&He.icon){let rl=re.elevation,xr=rl?rl.getAtTileOffsetFunc(at,re.center.lat,re.worldSize,He.getProjection()):null,qm=$a(Ot,je.tileID.canonical,ae,ge,re,He.getProjection(),Ht);xd(He,Ot,m,!1,qm,to,ae,H,xr,at)}return{program:Ee,buffers:He.icon,uniformValues:Vr,atlasTexture:ah,atlasTextureIcon:null,atlasInterpolation:fc,atlasInterpolationIcon:null,isSDF:He.sdfIcons,hasHalo:nf,tile:je,labelPlaneMatrixInv:rf}},Mn=()=>{let pn=Ie&&h.layout.get("symbol-placement")!=="point",Be=[],ut=pn||Re||cn;Me&&m.symbolParams.useOcclusionQueries&&!st&&!Ne&&Be.push("OCCLUSION_QUERIES"),m.terrainRenderModeElevated()&&Ce&&Be.push("PITCH_WITH_MAP_TERRAIN"),st&&(Be.push("PROJECTION_GLOBE_VIEW"),ut&&Be.push("PROJECTED_POS_ON_VIEWPORT")),He.text.zOffsetVertexBuffer&&Be.push("Z_OFFSET");let Gi=He.text.programConfigurations.get(h.id),On=m.getOrCreateProgram(He.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Gi,defines:Be}),Ee,Vr=[0,0],vr=null,Yi=He.textSizeData;He.iconsInText&&(Vr=je.imageAtlasTexture?je.imageAtlasTexture.size:[0,0],vr=je.imageAtlasTexture?je.imageAtlasTexture:null,Ee=Ce||re.pitch!==0||m.options.rotating||m.options.zooming||Yi.kind==="composite"||Yi.kind==="camera"?ie.LINEAR:ie.NEAREST);let Sr=je.glyphAtlasTexture?je.glyphAtlasTexture.size:[0,0],Wr=i.aD(Yi,re.zoom),yo=Ua(Ot,je.tileID.canonical,Ce,Ie,re,He.getProjection(),Ht),to=Hl(Ot,je.tileID.canonical,Ce,Ie,re,He.getProjection(),Ht),ua=m.translatePosMatrix(to,je,M,O,!0),ha=m.translatePosMatrix(Ot,je,M,O),ws=ut?Wa:yo,ns=Ie&&!Ce&&!pn,Ts=ct;!Ne&&!re.mercatorFromTransition||Ie||(Ts=Py(re));let hc=st?Ts:ct,ah;ah=He.iconsInText?Sy(Yi.kind,Wr,ns,Ce,m,ha,ws,ua,Sr,Vr,at,pt,xe,kn,hc,He.getProjection()):kd(Yi.kind,Wr,ns,Ce,m,ha,ws,ua,!0,Sr,!0,at,pt,xe,kn,hc,He.getProjection());let dc=je.glyphAtlasTexture?je.glyphAtlasTexture:null,fc=ie.LINEAR,nf=h.paint.get("text-halo-width").constantOr(1)!==0,rf=m.terrain&&Ce&&pn?i.ad.invert(i.ad.create(),yo):Wa;if(pn&&He.text){let rl=re.elevation,xr=rl?rl.getAtTileOffsetFunc(at,re.center.lat,re.worldSize,He.getProjection()):null,qm=$a(Ot,je.tileID.canonical,Ce,Ie,re,He.getProjection(),Ht);xd(He,Ot,m,!0,qm,to,Ce,q,xr,at)}return{program:On,buffers:He.text,uniformValues:ah,atlasTexture:dc,atlasTextureIcon:vr,atlasInterpolation:fc,atlasInterpolationIcon:Ee,isSDF:!0,hasHalo:nf,tile:je,labelPlaneMatrixInv:rf}},qn=He.icon.segments.get().length,Ln=He.text.segments.get().length,on=qn&&!T.onlyText?jt():null,Ut=Ln&&!T.onlyIcons?Mn():null,Qn=h.paint.get("icon-opacity").constantOr(1),ni=h.paint.get("text-opacity").constantOr(1);if($e&&He.canOverlap){Ge=!0;let pn=Qn&&!T.onlyText?He.icon.segments.get():[],Be=ni&&!T.onlyIcons?He.text.segments.get():[];for(let ut of pn)ot.push({segments:new i.b([ut]),sortKey:ut.sortKey,state:on});for(let ut of Be)ot.push({segments:new i.b([ut]),sortKey:ut.sortKey,state:Ut})}else T.onlyText||ot.push({segments:Qn?He.icon.segments:new i.b([]),sortKey:0,state:on}),T.onlyIcons||ot.push({segments:ni?He.text.segments:new i.b([]),sortKey:0,state:Ut})}Ge&&ot.sort((at,je)=>at.sortKey-je.sortKey);for(let at of ot){let je=at.state;if(je)if(m.terrain&&m.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!1,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),J.activeTexture.set(ie.TEXTURE0),je.atlasTexture&&je.atlasTexture.bind(je.atlasInterpolation,ie.CLAMP_TO_EDGE,!0),je.atlasTextureIcon&&(J.activeTexture.set(ie.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,ie.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,je.program),je.hasHalo){let He=je.uniformValues;He.u_is_halo=1,Jl(je.buffers,at.segments,h,m,je.program,Ve,v,x,He,2),He.u_is_halo=0}else{if(je.isSDF){let He=je.uniformValues;je.hasHalo&&(He.u_is_halo=1,Jl(je.buffers,at.segments,h,m,je.program,Ve,v,x,He,1)),He.u_is_halo=0}Jl(je.buffers,at.segments,h,m,je.program,Ve,v,x,je.uniformValues,1)}}}function Jl(m,s,h,g,v,x,T,I,M,P){let O=g.context.gl,N=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];m.occlusionQueryOpacityVertexBuffer.length>0&&N.push(m.occlusionQueryOpacityVertexBuffer),v.draw(g,O.TRIANGLES,x,T,I,i.af.disabled,M,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,g.transform.zoom,m.programConfigurations.get(h.id),N,P)}function mm(m,s,h,g,v,x,T){let I=m.context.gl,M=h.paint.get("fill-pattern"),P=M&&M.constantOr(1),O,N,B,V,G;T?(N=P&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=I.LINES):(N=P?"fillPattern":"fill",O=I.TRIANGLES);for(let H of g){let q=s.getTile(H);if(P&&!q.patternsLoaded())continue;let W=q.getBucket(h);if(!W)continue;m.prepareDrawTile();let ee=W.programConfigurations.get(h.id),te=m.isTileAffectedByFog(H),ne=m.getOrCreateProgram(N,{config:ee,overrideFog:te});P&&(m.context.activeTexture.set(I.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ee.updatePaintBuffers());let ue=M.constantOr(null);if(ue&&q.imageAtlas){let ie=q.imageAtlas.patternPositions[ue.toString()];ie&&ee.setConstantPatternPositions(ie)}let ce=m.translatePosMatrix(H.projMatrix,q,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),J=h.paint.get("fill-emissive-strength");if(T){V=W.indexBuffer2,G=W.segments2;let ie=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];B=N==="fillOutlinePattern"&&P?Pd(ce,J,m,q,ie):Iy(ce,J,ie)}else V=W.indexBuffer,G=W.segments,B=P?lm(ce,J,m,q):am(ce,J);m.uploadCommonUniforms(m.context,ne,H.toUnwrapped()),ne.draw(m,O,v,m.stencilModeForClipping(H),x,i.af.disabled,B,h.id,W.layoutVertexBuffer,V,G,h.paint,m.transform.zoom,ee,void 0)}}function ec(m,s,h,g,v,x,T,I){h.resetLayerRenderingStats(m);let M=m.context,P=M.gl,O=m.transform,N=h.paint.get("fill-extrusion-pattern"),B=N.constantOr(1),V=h.paint.get("fill-extrusion-opacity"),G=m.style.enable3dLights(),H=h.paint.get(G&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H],W=h.layout.get("fill-extrusion-edge-radius"),ee=W>0&&!h.paint.get("fill-extrusion-rounded-roof"),te=ee?0:W,ne=O.projection.name==="globe"?i.bY():0,ue=O.projection.name==="globe",ce=ue?i.a1(O.zoom):0,J=[i.aj(O.center.lng),i.ak(O.center.lat)],ie=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),re=h.paint.get("fill-extrusion-flood-light-intensity"),ge=h.paint.get("fill-extrusion-vertical-scale"),Ie=_s(m,h.paint.get("fill-extrusion-cutoff-fade-range")),ae=h.paint.get("fill-extrusion-emissive-strength"),Ce=[],Me;ue&&Ce.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Ce.push("FAUX_AO"),ee&&Ce.push("ZERO_ROOF_RADIUS"),I&&Ce.push("HAS_CENTROID"),re>0&&Ce.push("FLOOD_LIGHT"),Ie.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");let $e=m.renderPass==="shadow",Ge=m.shadowRenderer,Ve=$e&&!!Ge;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let xe=[0,0,0];if(Ge){let ot=m.style.directionalLight,ct=m.style.ambientLight;ot&&ct&&(xe=ys(m.style,ot,ct)),Me=Ce.concat(["SHADOWS_SINGLE_CASCADE"])}let Re=Ve?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",Ne=h.getLayerRenderingStats();for(let ot of g){let ct=s.getTile(ot),at=ct.getBucket(h);if(!at||at.projection.name!==O.projection.name)continue;let je=!1;Ge&&(je=Ge.getMaxCascadeForTile(ot.toUnwrapped())===0);let He=m.isTileAffectedByFog(ot),st=at.programConfigurations.get(h.id),pt=m.getOrCreateProgram(Re,{config:st,defines:je?Me:Ce,overrideFog:He});if(m.terrain&&m.terrain.setupElevationDraw(ct,pt,{useMeterToDem:!0}),!at.centroidVertexBuffer){let jt=pt.attributes.a_centroid_pos;jt!==void 0&&P.vertexAttrib2f(jt,0,0)}!$e&&Ge&&Ge.setupShadows(ct.tileID.toUnwrapped(),pt,"vector-tile",ct.tileID.overscaledZ),B&&(m.context.activeTexture.set(P.TEXTURE0),ct.imageAtlasTexture&&ct.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),st.updatePaintBuffers());let Ot=N.constantOr(null);if(Ot&&ct.imageAtlas){let jt=ct.imageAtlas.patternPositions[Ot.toString()];jt&&st.setConstantPatternPositions(jt)}let Ht=h.paint.get("fill-extrusion-vertical-gradient"),fn;if($e&&Ge){if(gm(ct.tileID,at,m))continue;let jt=Ge.calculateShadowPassMatrixFromTile(ct.tileID.toUnwrapped());fn=Xl(jt,te,ge)}else{let jt=m.translatePosMatrix(ot.expandedProjMatrix,ct,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Mn=O.projection.createInversionMatrix(O,ot.canonical);fn=B?sm(jt,m,Ht,V,q,te,ot,ct,ne,ce,J,Mn,ie,ge):Yl(jt,m,Ht,V,q,te,ot,ne,ce,J,Mn,ie,ge,re,xe,ae)}m.uploadCommonUniforms(M,pt,ot.toUnwrapped(),null,Ie);let cn=at.segments;if(O.projection.name==="mercator"&&!$e&&(cn=at.getVisibleSegments(ct.tileID,m.terrain,m.transform.getFrustum(0)),!cn.get().length))continue;if(Ne)if($e)for(let jt of cn.get())Ne.numRenderedVerticesInShadowPass+=jt.primitiveLength;else for(let jt of cn.get())Ne.numRenderedVerticesInTransparentPass+=jt.primitiveLength;let kn=[];(m.terrain||I)&&kn.push(at.centroidVertexBuffer),ue&&kn.push(at.layoutVertexExtBuffer),pt.draw(m,M.gl.TRIANGLES,v,x,T,i.af.backCCW,fn,h.id,at.layoutVertexBuffer,at.indexBuffer,cn,h.paint,m.transform.zoom,st,kn)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Fr(m,s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q,W,ee){let te=m.context,ne=te.gl,ue=m.transform,ce=m.transform.zoom,J=[],ie=_s(m,h.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(J.push("CLEAR_SUBPASS"),ee&&(J.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(ne.TEXTURE0),ee.bind(ne.LINEAR,ne.CLAMP_TO_EDGE))):P==="sdf"&&J.push("SDF_SUBPASS"),q&&J.push("HAS_CENTROID"),ie.shouldRenderCutoff&&J.push("RENDER_CUTOFF");let re=h.layout.get("fill-extrusion-edge-radius"),ge=(Ie,ae,Ce,Me,$e)=>{let Ge=ae.programConfigurations.get(h.id),Ve=m.isTileAffectedByFog(Ie),xe=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ge,defines:J,overrideFog:Ve}),Re=((ot,ct,at,je,He,st,pt,Ot,Ht,fn,cn)=>({u_matrix:ct,u_opacity:at,u_ao_pass:je?1:0,u_meter_to_tile:He,u_ao:st,u_flood_light_intensity:pt,u_flood_light_color:Ot,u_attenuation:Ht,u_edge_radius:fn,u_fb:0,u_fb_size:cn}))(0,Me,O,M,$e,[N,B*$e],V,G,H,ce>=17?0:re*$e,ee?ee.size[0]:0),Ne=[];q&&Ne.push(ae.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(te,xe,Ie.toUnwrapped(),null,ie),xe.draw(m,te.gl.TRIANGLES,v,x,T,I,Re,h.id,ae.vertexBuffer,ae.indexBuffer,Ce,h.paint,ce,Ge,Ne)};for(let Ie of g){let ae=s.getTile(Ie),Ce=ae.getBucket(h);if(!Ce||Ce.projection.name!==ue.projection.name||!Ce.groundEffect||Ce.groundEffect&&!Ce.groundEffect.hasData())continue;let Me=Ce.groundEffect,$e=1/Ce.tileToMeter;{let Ge=m.translatePosMatrix(Ie.projMatrix,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ve=Me.getDefaultSegment();ge(Ie,Me,Ve,Ge,$e)}if(W)for(let Ge=0;Ge<4;Ge++){let Ve=i.bZ[Ge](Ie),xe=s.getTile(Ve);if(!xe)continue;let Re=xe.getBucket(h);if(!Re||Re.projection.name!==ue.projection.name||!Re.groundEffect||Re.groundEffect&&!Re.groundEffect.hasData())continue;let Ne=Re.groundEffect,ot,ct;Ge===0?(ot=[-i.a3,0,0],ct=1):Ge===1?(ot=[i.a3,0,0],ct=0):Ge===2?(ot=[0,-i.a3,0],ct=3):(ot=[0,i.a3,0],ct=2);let at=Ne.regionSegments[ct];if(!at)continue;let je=new Float32Array(16);i.ad.translate(je,Ie.projMatrix,ot),ge(Ie,Ne,at,m.translatePosMatrix(je,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$e)}}}function Fd(m,s,h,g,v,x,T){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let I=x?x.findDEMTileFor(h):null;if(!(I&&I.dem||T))return;let M=W=>new i.P(Math.ceil((W+i.c0)*i.c1),0),P=W=>{let ee=s.getSource().minzoom,te=ue=>{let ce=s.getTileByID(ue);if(ce&&ce.hasData())return ce.getBucket(v)},ne=[0,-1,1];for(let ue of ne){if(W.overscaledZ+ue<ee)continue;let ce=te(W.calculateScaledKey(W.overscaledZ+ue));if(ce)return ce}},O=[0,0,0],N=(W,ee)=>(O[0]=Math.min(W.min.y,ee.min.y),O[1]=Math.max(W.max.y,ee.max.y),O[2]=i.a3-ee.min.x>W.max.x?ee.min.x-i.a3:W.max.x,O),B=(W,ee)=>(O[0]=Math.min(W.min.x,ee.min.x),O[1]=Math.max(W.max.x,ee.max.x),O[2]=i.a3-ee.min.y>W.max.y?ee.min.y-i.a3:W.max.y,O),V=[(W,ee)=>N(W,ee),(W,ee)=>N(ee,W),(W,ee)=>B(W,ee),(W,ee)=>B(ee,W)],G=(W,ee,te,ne,ue,ce,J)=>{if(!x)return 0;let ie=[[ce?te:W,ce?W:te,0],[ce?te:ee,ce?ee:te,0]],re=J<0?i.a3+J:J,ge=[ce?re:(W+ee)/2,ce?(W+ee)/2:re,0];return te===0&&J<0||te!==0&&J>0?x.getForTilePoints(ue,[ge],!0,ne):ie.push(ge),x.getForTilePoints(h,ie,!0,I),Math.max(ie[0][2],ie[1][2],ge[2])/x.exaggeration()};for(let W=0;W<4;W++){let ee=g.borderFeatureIndices[W];if(ee.length===0)continue;let te=i.bZ[W](h),ne=P(te);if(!(ne&&ne instanceof i.b_)||g.borderDoneWithNeighborZ[W]===ne.canonical.z)continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();let ue=x?x.findDEMTileFor(te):null;if(!(ue&&ue.dem||T))continue;let ce=(W<2?1:5)-W,J=ne.borderDoneWithNeighborZ[ce]!==g.canonical.z,ie=ne.borderFeatureIndices[ce],re=0;if(g.canonical.z!==ne.canonical.z){for(let ge of ee)g.showCentroid(g.featuresOnBorder[ge]);if(J)for(let ge of ie)ne.showCentroid(ne.featuresOnBorder[ge]);g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}for(let ge of ee){let Ie=g.featuresOnBorder[ge],ae=g.centroidData[Ie.centroidDataIndex],Ce=Ie.borders[W],Me;for(;re<ie.length;){Me=ne.featuresOnBorder[ie[re]];let $e=Me.borders[ce];if($e[1]>Ce[0]+3||$e[0]>Ce[0]-3)break;ne.showCentroid(Me),re++}if(Me&&re<ie.length){let $e=re,Ge=0;for(;!(Me.borders[ce][0]>Ce[1]-3)&&(Ge++,++re!==ie.length);)Me=ne.featuresOnBorder[ie[re]];if(Me=ne.featuresOnBorder[ie[$e]],Ge>1){let Re=Me.borders[ce];Math.abs(Ce[0]-Re[0])<3&&Math.abs(Ce[1]-Re[1])<3&&(Ge=1,re=$e+1)}else if(Ge===0){g.showCentroid(Ie);continue}let Ve=ne.centroidData[Me.centroidDataIndex];T&&Ge===1&&(((H=ae).flags|(q=Ve).flags)&i.b$?(H.flags|=i.b$,q.flags|=i.b$):(H.flags&=~i.b$,q.flags&=~i.b$));let xe=Ie.intersectsCount()>1||Me.intersectsCount()>1;if(Ge>1)re=$e,ae.centroidXY=Ve.centroidXY=new i.P(0,0);else if(ue&&ue.dem&&!xe){let Re=V[W](ae,Ve),Ne=W%2?i.a3-1:0,ot=G(Re[0],Math.min(i.a3-1,Re[1]),Ne,ue,te,W<2,Re[2]);ae.centroidXY=Ve.centroidXY=M(ot)}else xe?ae.centroidXY=Ve.centroidXY=new i.P(0,0):(ae.centroidXY=g.encodeBorderCentroid(Ie),Ve.centroidXY=ne.encodeBorderCentroid(Me));g.writeCentroidToBuffer(ae),ne.writeCentroidToBuffer(Ve)}else g.showCentroid(Ie)}g.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[ce]=g.canonical.z}var H,q;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}let Za=[1,0,0],ky=[0,1,0],Nd=[0,0,1];function gm(m,s,h){let g=h.transform,v=h.shadowRenderer;if(!v)return!0;let x=m.toUnwrapped(),T=g.tileSize*v._cascades[h.currentShadowCascade].scale,I=s.maxHeight;if(g.elevation){let H=g.elevation.getMinMaxForTile(m);H&&(I+=H.max)}let M=[...v.shadowDirection];M[2]=-M[2];let P=v.computeSimplifiedTileShadowVolume(x,I,T,M);if(!P)return!1;let O=[Za,ky,Nd,M,[M[0],0,M[2]],[0,M[1],M[2]]],N=g.projection.name==="globe",B=g.scaleZoom(T),V=i.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,B,!N),G=v.getCurrentCascadeFrustum();return V.intersectsPrecise(P.vertices,P.planes,O)===0||G.intersectsPrecise(P.vertices,P.planes,O)===0}function Bu(m){return[m[0]*i.c2,m[1]*i.c2,m[2]*i.c2,0]}function Vu(m,s,h,g,v,x,T,I,M){let P=g.getSource(),O=h.globeSharedBuffers;if(!O)return;let N,B,V;if(s&&(N=g.getTile(s)),P instanceof i.bm?(B=P.texture,V=i.bh(0,0,h.transform)):N&&s&&(B=N.texture,V=i.bh(s.canonical.z,s.canonical.x,h.transform)),!B||!V)return;m||(V=i.ad.scale(i.ad.create(),V,[1,-1,1]));let G=h.context,H=G.gl,q=v.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR,W=h.colorModeForDrapableLayerRenderPass(x),ee=T.defines;ee.push("GLOBE_POLES");let te=new i.ae(H.LEQUAL,i.ae.ReadWrite,h.depthRangeFor3D),ne=Float32Array.from(h.transform.expandedFarZProjMatrix),ue=Float32Array.from(i.bf(i.bg(new i.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),G.activeTexture.set(H.TEXTURE0),B.bind(q,H.CLAMP_TO_EDGE),G.activeTexture.set(H.TEXTURE1),B.bind(q,H.CLAMP_TO_EDGE),B.useMipmap&&G.extTextureFilterAnisotropic&&h.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);let[ce,J,ie,re]=s?O.getPoleBuffers(s.canonical.z,!1):O.getPoleBuffers(0,!0),ge=v.paint.get("raster-elevation"),Ie;m?(Ie=ce,h.renderDefaultNorthPole=ge!==0):(Ie=J,h.renderDefaultSouthPole=ge!==0);let ae=Bu(T.mix),Ce=(($e,Ge,Ve,xe,Re,Ne,ot,ct,at,je,He,st,pt)=>Ou($e,Ge,Ve,new Float32Array(16),new Float32Array(9),[0,0],xe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ne,[0,0],ct,2,je,He,st,1,0,pt))(ne,ue,V,i.a1(h.transform.zoom),0,v,0,ge,0,ae,T.offset,T.range,x),Me=h.getOrCreateProgram("raster",{defines:ee});h.uploadCommonUniforms(G,Me,null),Me.draw(h,H.TRIANGLES,te,M,W,I,Ce,v.id,Ie,ie,re)}function Tn(m){let s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,v=.2*m.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}function A1(m,s,h,g){if(m)return s instanceof Zl&&m instanceof i.c3?s.getTextureDescriptor(m,h,!0):{texture:m.texture,mix:Bu(g.mix),offset:g.offset,buffer:0,tileSize:1}}function St(m,s,h){if(!m)return null;let g=s.getTextureDescriptor(m,h,!0);if(!g)return null;let{texture:v,mix:x,offset:T,tileSize:I,buffer:M,format:P}=g;if(!v||!P)return null;let O=!1;return P==="uint32"&&(O=!0,x[3]=0,x=Cy(i.c4,x,[0,h.paint.get("raster-particle-max-speed")]),T=um(i.c4,T,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[M/(I+2*M),I/(I+2*M)],tileSize:I,scalarData:O,scale:x,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function Oy(m){let s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,v=.2*m.height,x=s+v;return[s,h,(x-v-s)/g,(x-s)/g]}let zd=new i.C(1,0,0,1),_m=new i.C(0,1,0,1),Jo=new i.C(0,0,1,1),ym=new i.C(1,0,1,1),tc=new i.C(0,1,1,1);function dt(m,s,h,g,v,x,T){let I=m.context,M=m.transform,P=I.gl,O=M.projection.name==="globe",N=O?["PROJECTION_GLOBE_VIEW"]:[],B=i.ad.clone(h.projMatrix);if(O&&i.a1(M.zoom)>0){let ae=i.c5(h.canonical,M),Ce=i.c6(ae);B=i.ad.multiply(new Float32Array(16),M.globeMatrix,Ce),i.ad.multiply(B,M.projMatrix,B)}let V=i.ad.create();V[12]+=2*v/(i.e.devicePixelRatio*M.width),V[13]+=2*x/(i.e.devicePixelRatio*M.height),i.ad.multiply(B,V,B);let G=m.getOrCreateProgram("debug",{defines:N}),H=s.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(H,G);let q=i.ae.disabled,W=i.ag.disabled,ee=m.colorModeForRenderPass(),te="$debug";I.activeTexture.set(P.TEXTURE0),m.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),O?H._makeGlobeTileDebugBuffers(m.context,M):H._makeDebugTileBoundsBuffers(m.context,M.projection);let ne=H._tileDebugBuffer||m.debugBuffer,ue=H._tileDebugIndexBuffer||m.debugIndexBuffer,ce=H._tileDebugSegments||m.debugSegments;if(G.draw(m,P.LINE_STRIP,q,W,ee,i.af.disabled,Rd(B,g),te,ne,ue,ce,null,null,null,[H._globeTileDebugBorderBuffer]),T){let ae=H.latestRawTileData,Ce=Math.floor((ae&&ae.byteLength||0)/1024),Me=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Me+=` => ${h.overscaledZ}`),Me+=` ${H.state}`,Me+=` ${Ce}kb`,function($e,Ge){$e.initDebugOverlayCanvas();let Ve=$e.debugOverlayCanvas,xe=$e.context.gl,Re=$e.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,Ve.width,Ve.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(Ge,5,5),Re.strokeText(Ge,5,5),$e.debugOverlayTexture.update(Ve),$e.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(m,Me)}let J=s.getTile(h).tileSize,ie=512/Math.min(J,512)*(h.overscaledZ/M.zoom)*.5,re=H._tileDebugTextBuffer||m.debugBuffer,ge=H._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ie=H._tileDebugTextSegments||m.debugSegments;G.draw(m,P.TRIANGLES,q,W,i.a.alphaBlended,i.af.disabled,Rd(B,i.C.transparent,ie),te,re,ge,Ie,null,null,null,[H._globeTileDebugTextBuffer])}function En(m,s,h,g){Nr(m,0,s+h/2,m.transform.width,h,g)}function In(m,s,h,g){Nr(m,s-h/2,0,h,m.transform.height,g)}function Nr(m,s,h,g,v,x){let T=m.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(s*i.e.devicePixelRatio,h*i.e.devicePixelRatio,g*i.e.devicePixelRatio,v*i.e.devicePixelRatio),T.clear({color:x}),I.disable(I.SCISSOR_TEST)}let nc=i.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xn}=nc;function Ao(m,s,h,g){m.emplaceBack(s,h,g)}class ic{constructor(s){this.vertexArray=new i.c8,this.indices=new i.bu,Ao(this.vertexArray,-1,-1,1),Ao(this.vertexArray,1,-1,1),Ao(this.vertexArray,-1,1,1),Ao(this.vertexArray,1,1,1),Ao(this.vertexArray,-1,-1,-1),Ao(this.vertexArray,1,-1,-1),Ao(this.vertexArray,-1,1,-1),Ao(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,xn),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=i.b.simpleSegment(0,0,36,12)}}function es(m,s,h,g,v,x){let T=m.context.gl,I=s.paint.get("sky-atmosphere-color"),M=s.paint.get("sky-atmosphere-halo-color"),P=s.paint.get("sky-atmosphere-sun-intensity"),O=((N,B,V,G,H)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:V,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(i.bC.fromMat4(i.bC.create(),g),v,P,I,M);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),h.draw(m,T.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.frontCW,O,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}let qr=i.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ri{constructor(s){let h=new i.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let g=new i.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,qr.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=i.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let P1=i.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ju{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class vm{constructor(s){this.colorModeAlphaBlendedWriteRGB=new i.a([i.ca,i.cb,i.ca,i.cb],i.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new i.a([i.ca,i.cc,i.ca,i.cc],i.C.transparent,[!1,!1,!1,!0]),this.params=new ju,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){let h=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ri(h);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(O){let N=i.cf(30),B=[];for(let V=0;V<O;++V){let G=2*Math.PI*N(),H=Math.acos(1-2*N())-.5*Math.PI;B.push(i._.fromValues(Math.cos(H)*Math.cos(G),Math.cos(H)*Math.sin(G),Math.sin(H)))}return B}(this.params.starsCount),T=i.cf(300),I=new i.cd,M=new i.bu,P=0;for(let O=0;O<x.length;++O){let N=i._.scale([],x[O],200),B=Math.max(0,1+.01*g*(1*T()-.5)),V=Math.max(0,1+.01*v*(1*T()-.5));I.emplaceBack(N[0],N[1],N[2],-1,-1,B,V),I.emplaceBack(N[0],N[1],N[2],1,-1,B,V),I.emplaceBack(N[0],N[1],N[2],1,1,B,V),I.emplaceBack(N[0],N[1],N[2],-1,1,B,V),M.emplaceBack(P+0,P+1,P+2),M.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=h.createVertexBuffer(I,P1.members),this.starsIdx=h.createIndexBuffer(M),this.starsSegments=i.b.simpleSegment(0,0,I.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,h){let g=s.context,v=g.gl,x=s.transform,T=new i.ae(v.LEQUAL,i.ae.ReadOnly,[0,1]),I=i.a1(x.zoom),M=s.style.getLut(h.scope),P=h.properties.get("color").toRenderColor(M).toArray01(),O=h.properties.get("high-color").toRenderColor(M).toArray01(),N=h.properties.get("space-color").toRenderColor(M).toArray01PremultipliedAlpha(),B=5e-4,V=i.ce(h.properties.get("horizon-blend"),0,1,B,.25),G=i.ba(s,g,x)&&V===B?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,H=s.frameCounter/1e3%1,q=i._.length(x.globeCenterInViewSpace),W=Math.sqrt(Math.pow(q,2)-Math.pow(G,2)),ee=Math.acos(W/q),te=ne=>{let ue=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&ue.push("ALPHA_PASS");let ce=s.getOrCreateProgram("globeAtmosphere",{defines:ue}),J=((re,ge,Ie,ae,Ce,Me,$e,Ge,Ve,xe,Re,Ne)=>({u_frustum_tl:re,u_frustum_tr:ge,u_frustum_br:Ie,u_frustum_bl:ae,u_horizon:Ce,u_transition:Me,u_fadeout_range:$e,u_color:Ge,u_high_color:Ve,u_space_color:xe,u_temporal_offset:Re,u_horizon_angle:Ne}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,I,V,P,O,N,H,ee);s.uploadCommonUniforms(g,ce);let ie=this.atmosphereBuffer;ie&&ce.draw(s,v.TRIANGLES,T,i.ag.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,i.af.backCW,J,ne?"atmosphere_glow_alpha":"atmosphere_glow",ie.vertexBuffer,ie.indexBuffer,ie.segments)};te(!1),te(!0)}drawStars(s,h){let g=i.at(h.properties.get("star-intensity"),0,1);if(g===0)return;let v=s.context,x=v.gl,T=s.transform,I=s.getOrCreateProgram("stars"),M=i.av.identity([]);i.av.rotateX(M,M,-T._pitch),i.av.rotateZ(M,M,-T.angle),i.av.rotateX(M,M,i.ab(T._center.lat)),i.av.rotateY(M,M,-i.ab(T._center.lng));let P=i.ad.fromQuat(new Float32Array(16),M),O=i.ad.multiply([],T.starsProjMatrix,P),N=i.bC.fromMat4([],P),B=i.bC.invert([],N),V=[0,1,0];i._.transformMat3(V,V,B),i._.scale(V,V,this.params.sizeMultiplier);let G=[1,0,0];i._.transformMat3(G,G,B),i._.scale(G,G,this.params.sizeMultiplier);let H=(q=V,W=G,ee=g,{u_matrix:Float32Array.from(O),u_up:q,u_right:W,u_intensity_multiplier:ee});var q,W,ee;s.uploadCommonUniforms(v,I),this.starsVx&&this.starsIdx&&I.draw(s,x.TRIANGLES,i.ae.disabled,i.ag.disabled,this.colorModeAlphaBlendedWriteRGB,i.af.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function rc(m,s){let h=[...m],g=s.cameraWorldSizeForFog/s.worldSize,v=i.ad.identity([]);return i.ad.scale(v,v,[g,g,1]),i.ad.multiply(h,v,h),i.ad.multiply(h,s.worldToFogMatrix,h),h}function Uu(m,s,h,g,v){let x=h.material,T=g.context,{baseColorTexture:I,metallicRoughnessTexture:M}=x.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:O,emissionTexture:N}=x;function B(V,G,H){if(V&&(m.push(G),T.activeTexture.set(T.gl.TEXTURE0+H),V.gfxTexture)){let{minFilter:q,magFilter:W,wrapS:ee,wrapT:te}=V.sampler;V.gfxTexture.bindExtraParam(q,W,ee,te)}}B(I,"HAS_TEXTURE_u_baseColorTexture",Ir.BaseColor),B(M,"HAS_TEXTURE_u_metallicRoughnessTexture",Ir.MetallicRoughness),B(P,"HAS_TEXTURE_u_normalTexture",Ir.Normal),B(O,"HAS_TEXTURE_u_occlusionTexture",Ir.Occlusion),B(N,"HAS_TEXTURE_u_emissionTexture",Ir.Emission),v&&(v.texture||(v.texture=new i.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],T.gl.RGBA)),T.activeTexture.set(T.gl.TEXTURE0+Ir.LUT),v.texture&&v.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(h.texcoordBuffer)),h.colorBuffer&&(m.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(h.colorBuffer)),h.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(h.normalBuffer)),h.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(h.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES")}function Ya(m,s,h,g,v,x){let T=h.paint.get("model-opacity"),I=s.context,M=new i.ae(s.context.gl.LEQUAL,i.ae.ReadWrite,s.depthRangeFor3D),P=s.transform,O=m.mesh,N=O.material,B=N.pbrMetallicRoughness,V=s.style.fog,G;G=s.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:i.ad.multiply([],g.zScaleMatrix,m.nodeModelMatrix),i.ad.multiply(G,g.negCameraPosMatrix,G);let H=i.ad.invert([],G);i.ad.transpose(H,H);let q=h.paint.get("model-emissive-strength").constantOr(0),W=Nu(new Float32Array(m.worldViewProjection),new Float32Array(G),new Float32Array(H),null,s,T,B.baseColorFactor.toRenderColor(null),N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,q,h),ee={defines:[]},te=[];Uu(ee.defines,te,O,s,h.lut);let ne=s.shadowRenderer;ne&&(ne.useNormalOffset=!1);let ue=null;if(V){let ie=rc(m.nodeModelMatrix,s.transform);if(ue=new Float32Array(ie),P.projection.name!=="globe"){let re=O.aabb.min,ge=O.aabb.max,[Ie,ae]=V.getOpacityForBounds(ie,re[0],re[1],ge[0],ge[1]);ee.overrideFog=Ie>=li||ae>=li}}let ce=_s(s,h.paint.get("model-cutoff-fade-range"));ce.shouldRenderCutoff&&ee.defines.push("RENDER_CUTOFF");let J=s.getOrCreateProgram("model",ee);s.uploadCommonUniforms(I,J,null,ue,ce),s.renderPass!=="shadow"&&ne&&ne.setupShadowsFromMatrix(m.nodeModelMatrix,J),J.draw(s,I.gl.TRIANGLES,M,v,x,O.material.doubleSided?i.af.disabled:i.af.backCCW,W,h.id,O.vertexBuffer,O.indexBuffer,O.segments,h.paint,s.transform.zoom,void 0,te)}function yr(m,s,h,g,v,x,T){let I;I=m.projection.name==="globe"?i.ci(h,m):[...h],i.ad.multiply(I,I,s.matrix);let M=i.ad.multiply([],g,I);if(s.meshes)for(let P of s.meshes){if(P.material.alphaMode!=="BLEND"){T.push({mesh:P,depth:0,modelIndex:v,worldViewProjection:M,nodeModelMatrix:I});continue}let O=i._.transformMat4([],P.centroid,M);O[2]>0&&x.push({mesh:P,depth:O[2],modelIndex:v,worldViewProjection:M,nodeModelMatrix:I})}if(s.children)for(let P of s.children)yr(m,P,h,g,v,x,T)}function zr(m,s,h,g){let v=h.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),T=v.getShadowPassColorMode(),I=v.calculateShadowPassMatrixFromMatrix(s),M=My(I);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,x,i.ag.disabled,T,i.af.backCCW,M,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,h.transform.zoom,void 0,void 0)}function Ly(m,s,h){let g=s.updateZoomBasedPaintProperties(),v=function(x,T,I){let M,P,O,N=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&N>0){let B=x.terrain,V=B.findDEMTileFor(I);V&&V.dem?M=i.ck.create(B,I,V):N=0}if(N===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),N===T.validForExaggeration&&(N===0||M&&M._demTile&&M._demTile.tileID===T.validForDEMTile.id&&M._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(let B in T.instancesPerModel){let V=T.instancesPerModel[B];for(let G=0;G<V.instancedDataArray.length;++G){let H=(M?N*M.getElevationAt(0|V.instancedDataArray.float32[16*G],0|V.instancedDataArray.float32[16*G+1],!0,!0):0)+V.instancesEvaluatedElevation[G];V.instancedDataArray.float32[16*G+6]=H,P=P?Math.min(T.terrainElevationMin,H):H,O=O?Math.max(T.terrainElevationMax,H):H}}return T.terrainElevationMin=P||0,T.terrainElevationMax=O||0,T.validForExaggeration=N,T.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,h);(g||v)&&(s.uploaded=!1,s.upload(m.context))}let Br={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.b6([0,0,0],[i.a3,i.a3,0])};function ji(m,s){let h=1<<m.canonical.z,g=s.getFreeCameraOptions().position,v=s.elevation,x=m.canonical.x/h,T=(m.canonical.x+1)/h,I=m.canonical.y/h,M=(m.canonical.y+1)/h,P=s._centerAltitude;if(v){let V=v.getMinMaxForTile(m);V&&V.max>P&&(P=V.max)}let O=i.at(g.x,x,T)-g.x,N=i.at(g.y,I,M)-g.y,B=i.ax(P,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(O*O+N*N+B*B))}function go(m,s,h,g,v,x,T){let I=m.context,M=m.renderPass==="shadow",P=m.shadowRenderer,O=M&&P?P.getShadowPassDepthMode():new i.ae(I.gl.LEQUAL,i.ae.ReadWrite,m.depthRangeFor3D),N=m.isTileAffectedByFog(x);if(h.meshes)for(let B of h.meshes){let V=["MODEL_POSITION_ON_GPU"],G=[],H,q,W;g.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");let ee=_s(m,s.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),M&&P)H=m.getOrCreateProgram("modelDepth",{defines:V}),q=My(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(h.matrix)),W=P.getShadowPassColorMode();else{Uu(V,G,B,m,s.lut),H=m.getOrCreateProgram("model",{defines:V,overrideFog:N});let ne=B.material,ue=ne.pbrMetallicRoughness,ce=s.paint.get("model-opacity"),J=s.paint.get("model-emissive-strength").constantOr(0);q=Nu(x.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,m,ce,ue.baseColorFactor.toRenderColor(null),ne.emissiveFactor,ue.metallicFactor,ue.roughnessFactor,ne,J,s,v),P&&(T.shadowUniformsInitialized?H.setShadowUniformValues(I,P.getShadowUniformValues()):(P.setupShadows(x.toUnwrapped(),H,"model-tile",x.overscaledZ),T.shadowUniformsInitialized=!0)),W=ee.shouldRenderCutoff||ce<1||ne.alphaMode!=="OPAQUE"?i.a.alphaBlended:i.a.unblended}m.uploadCommonUniforms(I,H,x.toUnwrapped(),null,ee);let te=B.material.doubleSided?i.af.disabled:i.af.backCCW;if(g.instancedDataArray.length>20)G.push(g.instancedDataBuffer),H.draw(m,I.gl.TRIANGLES,O,i.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,m.transform.zoom,void 0,G,g.instancedDataArray.length);else{let ne=M?"u_instance":"u_normal_matrix";for(let ue=0;ue<g.instancedDataArray.length;++ue)q[ne]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ue,16),H.draw(m,I.gl.TRIANGLES,O,i.ag.disabled,W,te,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,m.transform.zoom,void 0,G)}}if(h.children)for(let B of h.children)go(m,s,B,g,v,x,T)}let xs=[1,-1,1];function Zi(m,s,h,g){if(!h.modelManager)return!0;let v=h.modelManager;if(!h.shadowRenderer)return!0;let x=h.shadowRenderer,T=s.aabb,I=!0,M=m.maxHeight;if(M===0){let O=0;for(let N in m.instancesPerModel){let B=v.getModel(N,g);B?O=Math.max(O,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):I=!1}M=m.maxScale*O*1.41+m.maxVerticalOffset,I&&(m.maxHeight=M)}T.max[2]=M,T.min[2]+=m.terrainElevationMin,T.max[2]+=m.terrainElevationMax,i._.transformMat4(T.min,T.min,s.tileMatrix),i._.transformMat4(T.max,T.max,s.tileMatrix);let P=T.intersects(x.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=P===2),P===0}function xm(m,s){let h=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],x=m.uniformValues.u_cutoff_params[3];return g===h||x===v?1:i.at(((s-h)/(g-h)-v)/(x-v),0,1)}function Po(m,s,h,g){if(s.pitch<20)return 1;let v=s.getWorldToCameraMatrix(),x=i.ad.multiply([],v,m),T=[...h.min,1],I=i.aA.transformMat4([],T,x),M=I,P=I;T[1]=h.max[1],I=i.aA.transformMat4([],T,x),M=I[1]<M[1]?I:M,P=I[1]>P[1]?I:P,T[0]=h.max[0],I=i.aA.transformMat4([],T,x),M=I[1]<M[1]?I:M,P=I[1]>P[1]?I:P,T[1]=h.min[1],I=i.aA.transformMat4([],T,x),M=I[1]<M[1]?I:M,P=I[1]>P[1]?I:P;let O=i.at(g[0],0,1),N=100*s.pixelsPerMeter*i.at(g[1],0,1),B=i.at(g[2],0,1),V=i._.lerp([],M,P,O),G=Math.tan(.5*s.fovX),H=-V[2]*G;if(N===0)return V[1]<-Math.abs(H)?B:1;let q=(-Math.abs(H)-V[1])/N,W=(te,ne,ue)=>(1-ue)*te+ue*ne,ee=i.at(W(1,B,q),B,1);return W(1,ee,i.at((s.pitch-20)/20,0,1))}class $u{}class Gu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,h,g){{let N=this._storage.get(h.id);if(N)return N.lastUsedFrameIdx=s,N.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),T=new ArrayBuffer(x),I=new Int16Array(T);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));let M=new i.cm;for(let N=0;N<x/2;N+=3){let B=I[N],V=I[N+1],G=I[N+2];M.emplaceBack(B,V),M.emplaceBack(V,G),M.emplaceBack(G,B)}let P=g.bindVertexArrayOES.current,O=new $u;return O.buf=new i.I(g,M),O.lastUsedFrameIdx=s,this._storage.set(h.id,O),g.bindVertexArrayOES.set(P),O.buf}update(s){for(let[h,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(let[s,h]of this._storage)h.buf.destroy(),this._storage.delete(s)}}let Xa=i.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class R1{constructor(s){let h=new i.cn,g=new i.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=i.b.simpleSegment(0,0,h.length,g.length),this.vx=s.createVertexBuffer(h,Xa.members),this.idx=s.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let Ro={symbol:function(m,s,h,g,v){if(m.renderPass!=="translucent")return;let x=i.ag.disabled,T=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(P,O,N,B,V,G,H){let q=O.transform,W=V==="map",ee=G==="map";for(let te of P){let ne=B.getTile(te),ue=ne.getBucket(N);if(!ue||!ue.text||!ue.text.segments.get().length)continue;let ce=i.aD(ue.textSizeData,q.zoom),J=Ql(te,ue.getProjection(),q),ie=q.calculatePixelsToTileUnitsMatrix(ne),re=Ua(J,ne.tileID.canonical,ee,W,q,ue.getProjection(),ie),ge=ue.hasIconTextFit()&&ue.hasIconData();if(ce){let Ie=Math.pow(2,q.zoom-ne.tileID.overscaledZ);Ry(ue,W,ee,H,i.bO,q,re,te,Ie,ce,ge)}}}(g,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);let I=h.paint.get("icon-opacity").constantOr(1)!==0,M=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||M)?pm(m,s,h,g,x,T):(I&&pm(m,s,h,g,x,T,{onlyIcons:!0}),M&&pm(m,s,h,g,x,T,{onlyText:!0}),function(P,O,N,B){if(!P.symbolParams.useOcclusionQueries)return;let V=P.context.gl,G=P.transform,H=N.paint,q=H.get("icon-occlusion-opacity").constantOr(0)!==1,W=H.get("text-occlusion-opacity").constantOr(0)!==1;if(!q&&!W)return;let ee=G.projection.name==="globe";for(let te of B){let ne=O.getTile(te),ue=ne.getBucket(N);if(!ue||ue.projection.name==="mercator"&&ee||ue.fullyClipped)continue;if(ue.projection.name==="globe"){i.w(`Occlusion not supported for globe mode. Layer: ${N.type}`);continue}let ce=Ql(te,ue.getProjection(),G),J=i.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,P.symbolParams.depthOffset,1),ie=i.ad.multiply([],J,ce),re=P.symbolParams.visualizeOcclusions!=="none"?1:P.symbolParams.occlusionQueryFrameWindow;for(let ge=0;ge<ue.symbolInstances.length;ge++){let Ie=ue.symbolInstances.get(ge),ae=P.style.placement.opacities[Ie.crossTileID];if(ae&&ae.isHidden()||(P.frameCounter+ge)%re!=0)continue;let Ce=Ie.tileAnchorX,Me=Ie.tileAnchorY,$e=Ie.zOffset,Ge;if(P.symbolParams.visualizeOcclusions==="none"){let ot=ue.queries.get(ge);if(ot){if(!ot.isFree()){if(!ot.isResultAvailable())continue;let ct=ot.consumeResult();Ie.occlusionState=ct===0?0:1;continue}Ge=ot}else Ge=new Ol(P.context),ue.queries.set(ge,Ge)}let Ve=P.getOrCreateProgram("occlusion"),xe=P.symbolParams.occluderSize,Re=Ay(ie,[Ce,Me,$e],[G.width,G.height],[xe,xe],P.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);P.terrain&&P.terrain.setupElevationDraw(ne,Ve,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.begin();let Ne=new i.ae(P.symbolParams.visualizeOcclusions==="zPass"?P.context.gl.ALWAYS:P.context.gl.LEQUAL,i.ae.ReadOnly,P.depthRangeFor3D);Ve.draw(P,V.TRIANGLES,Ne,i.ag.disabled,P.symbolParams.visualizeOcclusions!=="none"?i.a.alphaBlendedNonPremultiplied:i.a.disabled,i.af.disabled,Re,"occlusion",P.occlusionBuffers.vx,P.occlusionBuffers.idx,P.occlusionBuffers.segments),P.symbolParams.visualizeOcclusions==="none"&&Ge&&Ge.end()}}}(m,s,h,g)),s.map.showCollisionBoxes&&(zu(m,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),zu(m,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,g){if(m.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),I=h.layout.get("circle-sort-key").constantOr(1)!==void 0,M=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;let P=m.context,O=P.gl,N=m.transform,B=m.depthModeForSublayer(0,i.ae.ReadOnly),V=i.ag.disabled,G=m.colorModeForDrapableLayerRenderPass(M),H=N.projection.name==="globe",q=[i.aj(N.center.lng),i.ak(N.center.lat)],W=[];for(let te=0;te<g.length;te++){let ne=g[te],ue=s.getTile(ne),ce=ue.getBucket(h);if(!ce||ce.projection.name!==N.projection.name)continue;let J=ce.programConfigurations.get(h.id),ie=i.bR(h),re=m.isTileAffectedByFog(ne);H&&ie.push("PROJECTION_GLOBE_VIEW");let ge=m.getOrCreateProgram("circle",{config:J,defines:ie,overrideFog:re}),Ie=ce.layoutVertexBuffer,ae=ce.globeExtVertexBuffer,Ce=ce.indexBuffer,Me=N.projection.createInversionMatrix(N,ne.canonical),$e={programConfiguration:J,program:ge,layoutVertexBuffer:Ie,globeExtVertexBuffer:ae,indexBuffer:Ce,uniformValues:i.bS(m,ne,ue,Me,q,h),tile:ue};if(I){let Ge=ce.segments.get();for(let Ve of Ge)W.push({segments:new i.b([Ve]),sortKey:Ve.sortKey,state:$e})}else W.push({segments:ce.segments,sortKey:0,state:$e})}I&&W.sort((te,ne)=>te.sortKey-ne.sortKey);let ee={useDepthForOcclusion:N.depthOcclusionForCircles};for(let te of W){let{programConfiguration:ne,program:ue,layoutVertexBuffer:ce,globeExtVertexBuffer:J,indexBuffer:ie,uniformValues:re,tile:ge}=te.state,Ie=te.segments;m.terrain&&m.terrain.setupElevationDraw(ge,ue,ee),m.uploadCommonUniforms(P,ue,ge.tileID.toUnwrapped()),ue.draw(m,O.TRIANGLES,B,V,G,i.af.disabled,re,h.id,ce,ie,Ie,h.paint,N.zoom,ne,[J])}},heatmap:function(m,s,h,g){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){let v=m.context,x=v.gl,T=i.ag.disabled,I=new i.a([x.ONE,x.ONE,x.ONE,x.ONE],i.C.transparent,[!0,!0,!0,!0]);(function(V,G,H,q){let W=V.gl,ee=G.width*q,te=G.height*q;V.activeTexture.set(W.TEXTURE1),V.viewport.set([0,0,ee,te]);let ne=H.heatmapFbo;if(!ne||ne&&(ne.width!==ee||ne.height!==te)){ne&&ne.destroy();let ue=W.createTexture();W.bindTexture(W.TEXTURE_2D,ue),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ne=H.heatmapFbo=V.createFramebuffer(ee,te,!0,null),function(ce,J,ie,re,ge,Ie){let ae=ce.gl;ae.texImage2D(ae.TEXTURE_2D,0,ce.extRenderToTextureHalfFloat?ae.RGBA16F:ae.RGBA,ge,Ie,0,ae.RGBA,ce.extRenderToTextureHalfFloat?ae.HALF_FLOAT:ae.UNSIGNED_BYTE,null),re.colorAttachment.set(ie)}(V,0,ue,ne,ee,te)}else W.bindTexture(W.TEXTURE_2D,ne.colorAttachment.get()),V.bindFramebuffer.set(ne.framebuffer)})(v,m,h,m.transform.projection.name==="globe"?.5:.25),v.clear({color:i.C.transparent});let M=m.transform,P=M.projection.name==="globe",O=P?["PROJECTION_GLOBE_VIEW"]:[],N=P?i.af.frontCCW:i.af.disabled,B=[i.aj(M.center.lng),i.ak(M.center.lat)];for(let V=0;V<g.length;V++){let G=g[V];if(s.hasRenderableParent(G))continue;let H=s.getTile(G),q=H.getBucket(h);if(!q||q.projection.name!==M.projection.name)continue;let W=m.isTileAffectedByFog(G),ee=q.programConfigurations.get(h.id),te=m.getOrCreateProgram("heatmap",{config:ee,defines:O,overrideFog:W}),{zoom:ne}=m.transform;m.terrain&&m.terrain.setupElevationDraw(H,te),m.uploadCommonUniforms(v,te,G.toUnwrapped());let ue=M.projection.createInversionMatrix(M,G.canonical);te.draw(m,x.TRIANGLES,i.ae.disabled,T,I,N,qa(m,G,H,ue,B,ne,h.paint.get("heatmap-intensity")),h.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,h.paint,m.transform.zoom,ee,P?[q.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,x){let T=v.context,I=T.gl,M=x.heatmapFbo;if(!M)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1);let P=x.colorRampTexture;P||(P=x.colorRampTexture=new i.T(T,x.colorRamp,I.RGBA)),P.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,I.TRIANGLES,i.ae.disabled,i.ag.disabled,v.colorModeForRenderPass(),i.af.disabled,((O,N,B,V)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(m,h))},line:function(m,s,h,g){if(m.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let T=h.paint.get("line-emissive-strength"),I=h.paint.get("line-occlusion-opacity"),M=m.context,P=M.gl,O=h.layout.get("line-z-offset"),N=!O.isConstant()||!!O.constantOr(0),B=N?new i.ae(m.depthOcclusion?P.GREATER:P.LEQUAL,i.ae.ReadOnly,m.depthRangeFor3D):m.depthModeForSublayer(0,i.ae.ReadOnly),V=m.colorModeForDrapableLayerRenderPass(T),G=m.terrain&&m.terrain.renderingToTexture,H=G?1:i.e.devicePixelRatio,q=h.paint.get("line-dasharray"),W=q.constantOr(1),ee=h.layout.get("line-cap"),te=q.constantOr(null),ne=ee.constantOr(null),ue=h.paint.get("line-pattern"),ce=ue.constantOr(1),J=ue.constantOr(null),ie=h.paint.get("line-opacity").constantOr(1),re=!ce&&ie!==1||m.depthOcclusion&&I>0&&I<1,ge=h.paint.get("line-gradient"),Ie=ce?"linePattern":"line",ae=i.bT(h),Ce;if(G&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(re=!1),I!==0&&m.depthOcclusion){let $e=h.paint._values["line-opacity"];$e&&$e.value&&$e.value.kind==="constant"?Ce=$e.value:i.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(N&&(m.forceTerrainMode=!0),!N&&I!==0&&m.terrain&&!G)return void i.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Me=re&&N?m.stencilModeFor3D():i.ag.disabled;for(let $e of g){let Ge=s.getTile($e);if(ce&&!Ge.patternsLoaded())continue;let Ve=Ge.getBucket(h);if(!Ve)continue;m.prepareDrawTile();let xe=Ve.programConfigurations.get(h.id),Re=m.isTileAffectedByFog($e),Ne=m.getOrCreateProgram(Ie,{config:xe,defines:N?[...ae,"ELEVATED"]:ae,overrideFog:Re});if(J&&Ge.imageAtlas){let st=Ge.imageAtlas.patternPositions[J.toString()];st&&xe.setConstantPatternPositions(st)}if(!ce&&te&&ne&&Ge.lineAtlas){let st=Ge.lineAtlas.getDash(te,ne);st&&xe.setConstantPatternPositions(st)}let[ot,ct]=h.paint.get("line-trim-offset");(ne==="round"||ne==="square")&&ot!==ct&&(ot===0&&(ot-=1),ct===1&&(ct+=1));let at=G?$e.projMatrix:null,je=ce?i.bU(m,Ge,h,at,H,[ot,ct]):i.bV(m,Ge,h,at,Ve.lineClipsArray.length,H,[ot,ct]);if(ge){let st=Ve.gradients[h.id],pt=st.texture;if(h.gradientVersion!==st.version){let Ot=256;if(h.stepInterpolant){let Ht=s.getSource().maxzoom,fn=$e.canonical.z===Ht?Math.ceil(1<<m.transform.maxZoom-$e.canonical.z):1;Ot=i.at(i.bW(Ve.maxLineLength/i.a3*1024*fn),256,M.maxTextureSize)}st.gradient=i.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:st.gradient||void 0,clips:Ve.lineClipsArray}),st.texture?st.texture.update(st.gradient):st.texture=new i.T(M,st.gradient,P.RGBA),st.version=h.gradientVersion,pt=st.texture}M.activeTexture.set(P.TEXTURE1),pt.bind(h.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}W&&(M.activeTexture.set(P.TEXTURE0),Ge.lineAtlasTexture&&Ge.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),xe.updatePaintBuffers()),ce&&(M.activeTexture.set(P.TEXTURE0),Ge.imageAtlasTexture&&Ge.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xe.updatePaintBuffers()),N&&m.terrain.setupElevationDraw(Ge,Ne),m.uploadCommonUniforms(M,Ne,$e.toUnwrapped());let He=st=>{Ce!=null&&(Ce.value=ie*I),Ne.draw(m,P.TRIANGLES,B,st,V,i.af.disabled,je,h.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,h.paint,m.transform.zoom,xe,[Ve.layoutVertexBuffer2,Ve.patternVertexBuffer,Ve.zOffsetVertexBuffer]),Ce!=null&&(Ce.value=ie)};if(re&&!N){let st=m.stencilModeForClipping($e).ref;st===0&&G&&M.clear({stencil:0});let pt={func:P.EQUAL,mask:255};je.u_alpha_discard_threshold=.8,He(new i.ag(pt,st,255,P.KEEP,P.KEEP,P.INVERT)),je.u_alpha_discard_threshold=0,He(new i.ag(pt,st,255,P.KEEP,P.KEEP,P.KEEP))}else re&&N&&(je.u_alpha_discard_threshold=.001),He(N?Me:m.stencilModeForClipping($e))}re&&(m.resetStencilClippingMasks(),G&&M.clear({stencil:0})),I===0||m.depthOcclusion||G||m.layersWithOcclusionOpacity.push(m.currentLayer),N&&(m.forceTerrainMode=!1)},fill:function(m,s,h,g){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let T=h.paint.get("fill-emissive-strength"),I=m.colorModeForDrapableLayerRenderPass(T),M=h.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&v.constantOr(i.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===P){let O=m.depthModeForSublayer(1,m.renderPass==="opaque"?i.ae.ReadWrite:i.ae.ReadOnly);mm(m,s,h,g,O,I,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){let O=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,i.ae.ReadOnly);mm(m,s,h,g,O,I,!0)}},"fill-extrusion":function(m,s,h,g){let v=h.paint.get("fill-extrusion-opacity"),x=m.context,T=x.gl,I=m.terrain,M=I&&I.renderingToTexture;if(v===0)return;let P=m.conflationActive&&m.style.isLayerClipped(h,s.getSource()),O=m.style.order.indexOf(h.fqid);if(P&&function(N,B,V,G,H){for(let q of G){let W=B.getTile(q).getBucket(V);W&&(W.updateReplacement(q,N.replacementSource,H),W.uploadCentroid(N.context))}}(m,s,h,g,O),I||P)for(let N of g){let B=s.getTile(N).getBucket(h);B&&Fd(m.context,s,N,B,h,I,P)}if(m.renderPass==="shadow"&&m.shadowRenderer){let N=m.shadowRenderer;if(I&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.Z)return;let B=N.getShadowPassDepthMode(),V=N.getShadowPassColorMode();ec(m,s,h,g,B,i.ag.disabled,V,P)}else if(m.renderPass==="translucent"){let N=!h.paint.get("fill-extrusion-pattern").constantOr(1),B=h.paint.get("fill-extrusion-color").constantOr(i.C.white);if(!M&&B.a!==0){let V=new i.ae(m.context.gl.LEQUAL,i.ae.ReadWrite,m.depthRangeFor3D);v===1&&N?ec(m,s,h,g,V,i.ag.disabled,i.a.unblended,P):(ec(m,s,h,g,V,i.ag.disabled,i.a.disabled,P),ec(m,s,h,g,V,m.stencilModeFor3D(),m.colorModeForRenderPass(),P),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&N&&(!I&&m.transform.projection.name!=="globe"||M)){let V=h.paint.get("fill-extrusion-opacity"),G=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=h.paint.get("fill-extrusion-flood-light-intensity"),W=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),ee=G>0&&H>0,te=q>0,ne=(ce,J,ie)=>(1-ie)*ce+ie*J,ue=ce=>{let J=m.depthModeForSublayer(1,i.ae.ReadOnly,T.LEQUAL,!0),ie=h.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),re=ne(.1,3,ie),ge=m._showOverdrawInspector;if(!ge){let Ie=new i.ag({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ae=new i.a([T.ONE,T.ONE,T.ONE,T.ONE],i.C.transparent,[!1,!1,!1,!0],T.MIN);Fr(m,s,h,g,J,Ie,ae,i.af.disabled,ce,"sdf",V,G,H,q,W,re,P,!1)}{let Ie=ge?i.ag.disabled:new i.ag({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ae=ge?m.colorModeForRenderPass():new i.a([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],i.C.transparent,[!0,!0,!0,!0]);Fr(m,s,h,g,J,Ie,ae,i.af.disabled,ce,"color",V,G,H,q,W,re,P,!1)}};if(M){let ce=(J,ie,re)=>{let ge=m.depthModeForSublayer(1,i.ae.ReadOnly,T.LEQUAL,!1),Ie=h.paint.get(J?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ae=ne(.1,3,Ie);{let Ce=new i.a([T.ONE,T.ONE,T.ONE,T.ONE],i.C.transparent,[!1,!1,!1,!0]);Fr(m,s,h,g,ge,i.ag.disabled,Ce,i.af.disabled,J,"clear",V,G,H,q,W,ae,P,ie)}{let Ce=new i.ag({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Me=new i.a([T.ONE,T.ONE,T.ONE,T.ONE],i.C.transparent,[!1,!1,!1,!0],T.MIN);Fr(m,s,h,g,ge,Ce,Me,i.af.disabled,J,"sdf",V,G,H,q,W,ae,P,ie)}{let Ce=J?T.ZERO:T.ONE_MINUS_DST_ALPHA,Me=new i.ag({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),$e=new i.a([Ce,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],i.C.transparent,[!0,!0,!0,!0]);Fr(m,s,h,g,ge,Me,$e,i.af.disabled,J,"color",V,G,H,q,W,ae,P,ie)}{let Ce=new i.a([T.ONE,T.ONE,T.ONE,J?T.ZERO:T.ONE],i.C.transparent,[!1,!1,!1,!0],J?T.FUNC_ADD:T.MAX);Fr(m,s,h,g,ge,i.ag.disabled,Ce,i.af.disabled,J,"clear",V,G,H,q,W,ae,P,ie,re)}};if(ee||te){let J;if(m.prepareDrawTile(),I){let ie=I.drapeBufferSize[0],re=I.drapeBufferSize[1];J=I.framebufferCopyTexture,J&&(!J||J.size[0]===ie&&J.size[1]===re)||(J&&J.destroy(),J=I.framebufferCopyTexture=new i.T(x,new i.i({width:ie,height:re}),T.RGBA)),J.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexImage2D(T.TEXTURE_2D,0,T.RGBA,0,0,ie,re,0)}ee&&ce(!0,!1,J),te&&ce(!1,!0,J)}}else ee&&ue(!0),te&&ue(!1)}}},hillshade:function(m,s,h,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;let v=m.context,x=m.terrain&&m.terrain.renderingToTexture,[T,I]=m.renderPass!=="translucent"||x?[{},g]:m.stencilConfigForOverlap(g);for(let M of I){let P=s.getTile(M);if(P.needsHillshadePrepare&&m.renderPass==="offscreen")Xo(m,P,h);else if(m.renderPass==="translucent"){let O=m.depthModeForSublayer(0,i.ae.ReadOnly),N=h.paint.get("hillshade-emissive-strength"),B=m.colorModeForDrapableLayerRenderPass(N),V=x&&m.terrain?m.terrain.stencilModeForRTTOverlap(M):T[M.overscaledZ];E1(m,M,P,h,O,V,B)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,h,g,v,x){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let T=m.transform.projection.name==="globe",I=h.paint.get("raster-elevation")!==0,M=I&&T;if(m.renderElevatedRasterBackface&&!M)return;let P=m.context,O=P.gl,N=s.getSource(),B=function(ce,J,ie,re){let ge=J.paint.get("raster-color"),Ie=ce.type==="raster-array",ae=[],Ce=J.paint.get("raster-resampling"),Me=J.paint.get("raster-color-mix"),$e=J.paint.get("raster-color-range"),Ge=[Me[0],Me[1],Me[2],0],Ve=Me[3],xe=Ce==="nearest"?re.NEAREST:re.LINEAR;if(Ie&&(ae.push("RASTER_ARRAY"),ge||ae.push("RASTER_COLOR"),Ce==="linear"&&ae.push("RASTER_ARRAY_LINEAR"),xe=re.NEAREST,!$e&&ce.rasterLayers)){let Re=ce.rasterLayers.find(({id:Ne})=>Ne===J.sourceLayer);Re&&Re.fields&&Re.fields.range&&($e=Re.fields.range)}if($e=$e||[0,1],ge){ae.push("RASTER_COLOR"),ie.activeTexture.set(re.TEXTURE2),J.updateColorRamp($e);let Re=J.colorRampTexture;Re||(Re=J.colorRampTexture=new i.T(ie,J.colorRamp,re.RGBA)),Re.bind(re.LINEAR,re.CLAMP_TO_EDGE)}return{mix:Ge,range:$e,offset:Ve,defines:ae,resampling:xe}}(N,h,P,O);if(N instanceof i.bm&&!g.length&&!T)return;let V=h.paint.get("raster-emissive-strength"),G=m.colorModeForDrapableLayerRenderPass(V),H=m.terrain&&m.terrain.renderingToTexture,q=!m.options.moving,W=h.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(N instanceof i.bm&&!g.length&&(N.onNorthPole||N.onSouthPole)){let ce=I?m.stencilModeFor3D():i.ag.disabled;return void Vu(!!N.onNorthPole,null,m,s,h,V,B,i.af.disabled,ce)}if(!g.length)return;let[ee,te]=N instanceof i.bm||H?[{},g]:m.stencilConfigForOverlap(g),ne=te[te.length-1].overscaledZ;M&&B.defines.push("PROJECTION_GLOBE_VIEW"),I&&B.defines.push("RENDER_CUTOFF");let ue=(ce,J,ie)=>{for(let re of ce){let ge=re.toUnwrapped(),Ie=s.getTile(re);if(H&&(!Ie||!Ie.hasData()))continue;P.activeTexture.set(O.TEXTURE0);let ae=A1(Ie,N,h,B);if(!ae||!ae.texture)continue;let{texture:Ce,mix:Me,offset:$e,tileSize:Ge,buffer:Ve}=ae,xe,Re;H?(xe=i.ae.disabled,Re=re.projMatrix):I?(xe=new i.ae(O.LEQUAL,i.ae.ReadWrite,m.depthRangeFor3D),Re=T?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(ge,q)):(xe=m.depthModeForSublayer(re.overscaledZ-ne,h.paint.get("raster-opacity")===1?i.ae.ReadWrite:i.ae.ReadOnly,O.LESS),Re=m.transform.calculateProjMatrix(ge,q));let Ne=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(re):ee[re.overscaledZ],ot=x?0:h.paint.get("raster-fade-duration");Ie.registerFadeDuration(ot);let ct=s.findLoadedParent(re,0),at=Cd(Ie,ct,s,m.transform,ot),je,He;m.terrain&&m.terrain.prepareDrawTile(),P.activeTexture.set(O.TEXTURE0),Ce.bind(W,O.CLAMP_TO_EDGE),P.activeTexture.set(O.TEXTURE1),ct?(ct.texture&&ct.texture.bind(W,O.CLAMP_TO_EDGE),je=Math.pow(2,ct.tileID.overscaledZ-Ie.tileID.overscaledZ),He=[Ie.tileID.canonical.x*je%1,Ie.tileID.canonical.y*je%1]):Ce.bind(W,O.CLAMP_TO_EDGE),Ce.useMipmap&&P.extTextureFilterAnisotropic&&m.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);let st=m.transform,pt,Ot=I?Tn(st):[0,0,0,0],Ht,fn,cn,kn,jt,Mn=0;if(M&&N instanceof i.bm&&N.coordinates.length>3)Ht=Float32Array.from(i.bf(i.bg(new i.aO(0,0,0)))),fn=Float32Array.from(st.globeMatrix),cn=Float32Array.from(i.bb(st)),kn=[i.aj(st.center.lng),i.ak(st.center.lat)],pt=N.elevatedGlobePerspectiveTransform,jt=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){let Ut=i.bc(re.canonical);Mn=i.bd(Ut.getCenter().lat),Ht=Float32Array.from(i.bf(i.bg(re.canonical))),fn=Float32Array.from(st.globeMatrix),cn=Float32Array.from(i.bb(st)),kn=[i.aj(st.center.lng),i.ak(st.center.lat)],pt=[0,0],jt=Float32Array.from(i.be(re.canonical,Ut,Mn,st.worldSize/st._pixelsPerMercatorPixel))}else pt=N instanceof i.bm?N.perspectiveTransform:[0,0],Ht=new Float32Array(16),fn=new Float32Array(9),cn=new Float32Array(16),kn=[0,0],jt=new Float32Array(9);let qn=Ou(Re,Ht,fn,cn,jt,He||[0,0],i.a1(m.transform.zoom),kn,Ot,je||1,at,h,pt,I?h.paint.get("raster-elevation"):0,2,Me,$e,B.range,Ge,Ve,V),Ln=m.isTileAffectedByFog(re),on=m.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Ln});if(m.uploadCommonUniforms(P,on,ge),N instanceof i.bm){let Ut=N.elevatedGlobeVertexBuffer,Qn=N.elevatedGlobeIndexBuffer;if(H||!T)N.boundsBuffer&&N.boundsSegments&&on.draw(m,O.TRIANGLES,xe,i.ag.disabled,G,i.af.disabled,qn,h.id,N.boundsBuffer,m.quadTriangleIndexBuffer,N.boundsSegments);else if(Ut&&Qn){let ni=st.zoom<=i.b1?N.elevatedGlobeSegments:N.getSegmentsForLongitude(st.center.lng);ni&&on.draw(m,O.TRIANGLES,xe,i.ag.disabled,G,J,qn,h.id,Ut,Qn,ni)}}else if(M){xe=new i.ae(O.LEQUAL,i.ae.ReadOnly,m.depthRangeFor3D);let Ut=m.globeSharedBuffers;if(Ut){let[Qn,ni,pn]=Ut.getGridBuffers(Mn,!1);on.draw(m,O.TRIANGLES,xe,ie||Ne,m.colorModeForRenderPass(),J,qn,h.id,Qn,ni,pn)}}else{let{tileBoundsBuffer:Ut,tileBoundsIndexBuffer:Qn,tileBoundsSegments:ni}=m.getTileBoundsBuffers(Ie);on.draw(m,O.TRIANGLES,xe,Ne,G,i.af.disabled,qn,h.id,Ut,Qn,ni)}}if(!(N instanceof i.bm)&&M)for(let re of ce){let ge=re.canonical.y===(1<<re.canonical.z)-1;re.canonical.y===0&&Vu(!0,re,m,s,h,V,B,J,ie||i.ag.disabled),ge&&Vu(!1,re,m,s,h,V,B,J===i.af.frontCW?i.af.backCW:i.af.frontCW,ie||i.ag.disabled)}};M?ue(te,m.renderElevatedRasterBackface?i.af.backCW:i.af.frontCW,m.stencilModeFor3D()):ue(te,i.af.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,h,g,v,x){m.renderPass==="offscreen"&&function(T,I,M,P){if(!P.length)return;let O=T.context,N=O.gl,B=I.getSource();if(!(B instanceof Zl))return;let V=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count"))),G=M.particlePositionRGBAImage;if(!G||G.width!==V){let te=function(ne){let ue=ne*ne,ce=new Uint8Array(4*ue),J=function(re){return re|=0,re=Math.imul(2747636419^re,2654435769),re=Math.imul(re^re>>>16,2654435769),((re=Math.imul(re^re>>>16,2654435769))>>>0)/4294967296},ie=1/1.3;for(let re=0;re<ue;re++){let ge=ie*(J(2*re+0)+na),Ie=ie*(J(2*re+1)+na),ae=255*ge%1,Ce=255*Ie%1,Me=ae,$e=Ie-Ce/255,Ge=Ce;ce[4*re+0]=255*(ge-ae/255),ce[4*re+1]=255*Me,ce[4*re+2]=255*$e,ce[4*re+3]=255*Ge}return ce}(V);G=M.particlePositionRGBAImage=new i.i({width:V,height:V},te)}let H=M.particleFramebuffer;H?H.width!==V&&(H.destroy(),H=M.particleFramebuffer=O.createFramebuffer(V,V,!0,null)):H=M.particleFramebuffer=O.createFramebuffer(V,V,!0,null);let q=[];for(let te of P){let ne=I.getTile(te);if(!(ne instanceof i.c3))continue;let ue=St(ne,B,M);if(!ue)continue;let ce=[ne.tileSize,ne.tileSize],J=M.tileFramebuffer;J||(J=M.tileFramebuffer=O.createFramebuffer(ce[0],ce[1],!0,null));let ie=ne.rasterParticleState;ie||(ie=ne.rasterParticleState=new ho(O,te,ce,G));let re=ie.update(M.lastInvalidatedAt);ie.particleTextureDimension!==V&&ie.updateParticleTexture(te,G);let ge=ie.targetColorTexture;ie.targetColorTexture=ie.backgroundColorTexture,ie.backgroundColorTexture=ge;let Ie=ie.particleTexture0;ie.particleTexture0=ie.particleTexture1,ie.particleTexture1=Ie,q.push([te,ue,ie,re])}if(q.length===0)return;let W=i.e.now(),ee=M.previousDrawTimestamp?.001*(W-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=W,M.hasColorMap()){O.activeTexture.set(N.TEXTURE0+2);let te=M.colorRampTexture;te||(te=M.colorRampTexture=new i.T(O,M.colorRamp,N.RGBA)),te.bind(N.LINEAR,N.CLAMP_TO_EDGE)}O.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(te,ne,ue){let ce=te.context,J=ce.gl,ie=ne.tileFramebuffer;ce.activeTexture.set(J.TEXTURE0);let re={u_texture:0,u_opacity:1.05*(Ie=ne.paint.get("raster-particle-fade-opacity-factor"))/(Ie+.05)},ge=te.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ie;for(let ae of ue){let[,,Ce,Me]=ae;ie.colorAttachment.set(Ce.targetColorTexture.texture),ce.viewport.set([0,0,ie.width,ie.height]),ce.clear({color:i.C.transparent}),Me&&(Ce.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),ge.draw(te,J.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.alphaBlended,i.af.disabled,re,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments))}}(T,M,q),function(te,ne,ue,ce){let J=te.context,ie=J.gl,re=ue.tileFramebuffer,ge=te.transform.projection.name==="globe",Ie=ue.paint.get("raster-particle-max-speed");for(let ae of ce){let[Ce,Me,$e]=ae;J.activeTexture.set(ie.TEXTURE0+0),Me.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),re.colorAttachment.set($e.targetColorTexture.texture);let Ge=te.getOrCreateProgram("rasterParticleDraw",{defines:Me.defines,overrideFog:!1});J.activeTexture.set(ie.TEXTURE0+1);let Ve=Me.scalarData?[]:[0,1,2,3].map(Ne=>i.bZ[Ne](Ce));Ve.push(Ce);let xe=Ce.canonical.x,Re=Ce.canonical.y;for(let Ne of Ve){let ot=ne.getTile(ge?Ne.wrapped():Ne);if(!ot)continue;let ct=ot.rasterParticleState;if(!ct)continue;let at=Ne.canonical.x+(1<<Ne.canonical.z)*(Ne.wrap-Ce.wrap),je=Ne.canonical.y;ct.particleTexture0.bind(ie.NEAREST,ie.CLAMP_TO_EDGE);let He=dm(1,ct.particleTexture0.size[0],[at-xe,je-Re],0,Me.texture.size,2,Ie,Me.textureOffset,Me.scale,Me.offset);Ge.draw(te,ie.POINTS,i.ae.disabled,i.ag.disabled,i.a.alphaBlended,i.af.disabled,He,ue.id,ct.particleIndexBuffer,void 0,ct.particleSegment)}}}(T,I,M,q),O.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(te,ne,ue,ce){let J=te.context,ie=J.gl,re=ne.paint.get("raster-particle-max-speed"),ge=ce*ne.paint.get("raster-particle-speed-factor")*.15,Ie=function(Ce){return Math.pow(Ce,6)}(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),ae=ne.particleFramebuffer;J.viewport.set([0,0,ae.width,ae.height]);for(let Ce of ue){let[,Me,$e]=Ce;J.activeTexture.set(ie.TEXTURE0+0),Me.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),J.activeTexture.set(ie.TEXTURE0+1);let Ge=$e.particleTexture0;Ge.bind(ie.NEAREST,ie.CLAMP_TO_EDGE);let Ve=C1(1,Ge.size[0],0,Me.texture.size,re,ge,Ie,Me.textureOffset,Me.scale,Me.offset);ae.colorAttachment.set($e.particleTexture1.texture),J.clear({color:i.C.transparent}),te.getOrCreateProgram("rasterParticleUpdate",{defines:Me.defines}).draw(te,ie.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.disabled,Ve,ne.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments)}}(T,M,q,ee)}(m,s,h,g),m.renderPass==="translucent"&&(function(T,I,M,P,O){let N=T.context,B=N.gl,V=!T.options.moving,G=T.transform.projection.name==="globe";if(!P.length)return;let[H,q]=T.stencilConfigForOverlap(P),W=[];G&&W.push("PROJECTION_GLOBE_VIEW");let ee=T.stencilModeFor3D();for(let te of q){let ne=te.toUnwrapped(),ue=I.getTile(te);if(!ue.rasterParticleState)continue;let ce=ue.rasterParticleState,J=100;ue.registerFadeDuration(J);let ie=I.findLoadedParent(te,0),re=Cd(ue,ie,I,T.transform,J),ge,Ie;T.terrain&&T.terrain.prepareDrawTile(),N.activeTexture.set(B.TEXTURE0),ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),N.activeTexture.set(B.TEXTURE1),ie&&ie.rasterParticleState?(ie.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ge=Math.pow(2,ie.tileID.overscaledZ-ue.tileID.overscaledZ),Ie=[ue.tileID.canonical.x*ge%1,ue.tileID.canonical.y*ge%1]):ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let ae=G?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(ne,V),Ce=T.transform,Me=Oy(Ce),$e=i.bc(te.canonical),Ge=i.bd($e.getCenter().lat),Ve,xe,Re,Ne,ot;G?(Ve=Float32Array.from(i.bf(i.bg(te.canonical))),xe=Float32Array.from(Ce.globeMatrix),Re=Float32Array.from(i.bb(Ce)),Ne=[i.aj(Ce.center.lng),i.ak(Ce.center.lat)],ot=Float32Array.from(i.be(te.canonical,$e,Ge,Ce.worldSize/Ce._pixelsPerMercatorPixel))):(Ve=new Float32Array(16),xe=new Float32Array(9),Re=new Float32Array(16),Ne=[0,0],ot=new Float32Array(9));let ct=hm(ae,Ve,xe,Re,ot,Ie||[0,0],i.a1(T.transform.zoom),Ne,Me,ge||1,re,250),at=T.isTileAffectedByFog(te),je=T.getOrCreateProgram("rasterParticle",{defines:W,overrideFog:at});if(T.uploadCommonUniforms(N,je,ne),G){let He=new i.ae(B.LEQUAL,i.ae.ReadWrite,T.depthRangeFor3D),st=0,pt=T.globeSharedBuffers;if(pt){let[Ot,Ht,fn]=pt.getGridBuffers(Ge,st!==0);je.draw(T,B.TRIANGLES,He,ee,i.a.alphaBlended,i.af.backCCW,ct,M.id,Ot,Ht,fn)}}else{let He=T.depthModeForSublayer(0,i.ae.ReadOnly),st=H[te.overscaledZ],{tileBoundsBuffer:pt,tileBoundsIndexBuffer:Ot,tileBoundsSegments:Ht}=T.getTileBoundsBuffers(ue);je.draw(T,B.TRIANGLES,He,st,i.a.alphaBlended,i.af.disabled,ct,M.id,pt,Ot,Ht)}}T.resetStencilClippingMasks()}(m,s,h,g),m.style.map.triggerRepaint())},background:function(m,s,h,g){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity"),T=h.paint.get("background-emissive-strength");if(x===0)return;let I=m.context,M=I.gl,P=m.transform,O=P.tileSize,N=h.paint.get("background-pattern"),B;if(N!==void 0&&(N===null||(B=m.imageManager.getPattern(N.toString(),h.scope,m.style.getLut(h.scope)),!B)))return;let V=!N&&v.a===1&&x===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==V)return;let G=i.ag.disabled,H=m.depthModeForSublayer(0,V==="opaque"?i.ae.ReadWrite:i.ae.ReadOnly),q=m.colorModeForDrapableLayerRenderPass(T),W=N?"backgroundPattern":"background",ee,te=g;te||(ee=m.getBackgroundTiles(),te=Object.values(ee).map(ne=>ne.tileID)),N&&(I.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context,h.scope));for(let ne of te){let ue=m.isTileAffectedByFog(ne),ce=m.getOrCreateProgram(W,{overrideFog:ue}),J=ne.toUnwrapped(),ie=g?ne.projMatrix:m.transform.calculateProjMatrix(J);m.prepareDrawTile();let re=s?s.getTile(ne):ee?ee[ne.key]:new i.by(ne,O,P.zoom,m),ge=N?Dy(ie,T,x,m,0,h.scope,B,{tileID:ne,tileSize:O}):Fu(ie,T,x,v.toRenderColor(h.lut));m.uploadCommonUniforms(I,ce,J);let{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:ae,tileBoundsSegments:Ce}=m.getTileBoundsBuffers(re);ce.draw(m,M.TRIANGLES,H,G,q,i.af.disabled,ge,h.id,Ie,ae,Ce)}},sky:function(m,s,h){let g=m._atmosphere?i.a1(m.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;let x=m.context,T=h.paint.get("sky-type"),I=new i.ae(x.gl.LEQUAL,i.ae.ReadOnly,[0,1]),M=m.frameCounter/1e3%1;T==="atmosphere"?m.renderPass==="offscreen"?h.needsSkyboxCapture(m)&&(function(P,O,N,B){let V=P.context,G=V.gl,H=O.skyboxFbo;if(!H){H=O.skyboxFbo=V.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new ic(V),O.skyboxTexture=V.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,O.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let te=0;te<6;++te)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(H.framebuffer),V.viewport.set([0,0,32,32]);let q=O.getCenter(P,!0),W=P.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);i.ad.identity(ee),i.ad.rotateY(ee,ee,.5*-Math.PI),es(P,O,W,ee,q,0),i.ad.identity(ee),i.ad.rotateY(ee,ee,.5*Math.PI),es(P,O,W,ee,q,1),i.ad.identity(ee),i.ad.rotateX(ee,ee,.5*-Math.PI),es(P,O,W,ee,q,2),i.ad.identity(ee),i.ad.rotateX(ee,ee,.5*Math.PI),es(P,O,W,ee,q,3),i.ad.identity(ee),es(P,O,W,ee,q,4),i.ad.identity(ee),i.ad.rotateY(ee,ee,Math.PI),es(P,O,W,ee,q,5),V.viewport.set([0,0,P.width,P.height])}(m,h),h.markSkyboxValid(m)):m.renderPass==="sky"&&function(P,O,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skybox");G.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,O.skyboxTexture);let ee=((te,ne,ue,ce,J)=>({u_matrix:te,u_sun_direction:ne,u_cubemap:0,u_opacity:ce,u_temporal_offset:J}))(q.skyboxMatrix,O.getCenter(P,!1),0,B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,i.ag.disabled,P.colorModeForRenderPass(),i.af.backCW,ee,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(m,h,I,v,M):T==="gradient"&&m.renderPass==="sky"&&function(P,O,N,B,V){let G=P.context,H=G.gl,q=P.transform,W=P.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new ic(G)),G.activeTexture.set(H.TEXTURE0);let ee=O.colorRampTexture;ee||(ee=O.colorRampTexture=new i.T(G,O.colorRamp,H.RGBA)),ee.bind(H.LINEAR,H.CLAMP_TO_EDGE);let te=((ne,ue,ce,J,ie)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ue,u_radius:i.ab(ce),u_opacity:J,u_temporal_offset:ie}))(q.skyboxMatrix,O.getCenter(P,!1),O.paint.get("sky-gradient-radius"),B,V);P.uploadCommonUniforms(G,W),W.draw(P,H.TRIANGLES,N,i.ag.disabled,P.colorModeForRenderPass(),i.af.backCW,te,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(m,h,I,v,M)},debug:function(m,s,h,g,v,x){for(let T=0;T<h.length;T++)if(v){let P=new i.C(g.r*.8,g.g*.8,g.b*.8,1);dt(m,s,h[T],g,-1,-1,x),dt(m,s,h[T],g,-1,1,x),dt(m,s,h[T],g,1,1,x),dt(m,s,h[T],g,1,-1,x),dt(m,s,h[T],P,0,0,x)}else dt(m,s,h[T],g,0,0,x)},custom:function(m,s,h,g){let v=m.context,x=h.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&h.isDraped(s)){if(m.renderPass==="offscreen"){let T=x.prerender;if(T){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){let I=m.transform.pointMerc;T.call(x,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.a1(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else T.call(x,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){let I=x.renderToTile;if(I){let M=g[0].canonical,P=new i.Y(M.x+g[0].wrap*(1<<M.z),M.y,M.z);v.setDepthMode(i.ae.disabled),v.setStencilMode(i.ag.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),I.call(x,v.gl,P),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(i.ag.disabled);let T=x.renderingMode==="3d"?new i.ae(m.context.gl.LEQUAL,i.ae.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,i.ae.ReadOnly);if(v.setDepthMode(T),m.transform.projection.name==="globe"){let I=m.transform.pointMerc;x.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.a1(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else x.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,h,g){if(m.renderPass==="opaque")return;let v=h.paint.get("model-opacity");if(v===0)return;let x=h.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!x||m.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof i.Z))return;let T=m.shadowRenderer,I=h.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,I||(T.enabled=!1));let M=()=>{T&&(T.useNormalOffset=!0,I||(T.enabled=!0))},P=s.getSource();if(m.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(W,ee,te,ne,ue){let ce=W.transform;if(ce.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${ce.projection.name} projection is not yet implemented`);let J=ce.getFreeCameraOptions().position;if(!W.modelManager)return;let ie=W.modelManager;te.modelManager=ie;let re=W.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ge=te._unevaluatedLayout._values["model-id"],Ie=gt({},te.layout.get("model-id").parameters),ae=W.style.order.indexOf(te.fqid);for(let Ce of ne){let Me=ee.getTile(Ce).getBucket(te);if(!Me||Me.projection.name!==ce.projection.name)continue;let $e=Me.getModelUris();$e&&!Me.modelsRequested&&(ie.addModelsFromBucket($e,ue),Me.modelsRequested=!0);let Ge=ji(Ce,ce);Ie.zoom=Ge;let Ve=ge.possiblyEvaluate(Ie);if(Ly(W,Me,Ce),Br.shadowUniformsInitialized=!1,Br.useSingleShadowCascade=!!re&&re.getMaxCascadeForTile(Ce.toUnwrapped())===0,W.renderPass==="shadow"&&re){if(W.currentShadowCascade===1&&Me.isInsideFirstShadowMapFrustum)continue;let Ne=ce.calculatePosMatrix(Ce.toUnwrapped(),ce.worldSize);if(Br.tileMatrix.set(Ne),Br.shadowTileMatrix=Float32Array.from(re.calculateShadowPassMatrixFromMatrix(Ne)),Br.aabb.min.fill(0),Br.aabb.max[0]=Br.aabb.max[1]=i.a3,Br.aabb.max[2]=0,Zi(Me,Br,W,te.scope))continue}let xe=1<<Ce.canonical.z,Re=[((J.x-Ce.wrap)*xe-Ce.canonical.x)*i.a3,(J.y*xe-Ce.canonical.y)*i.a3,J.z*xe*i.a3];W.conflationActive&&Object.keys(Me.instancesPerModel).length>0&&W.style.isLayerClipped(te,ee.getSource())&&Me.updateReplacement(Ce,W.replacementSource,ae)&&(Me.uploaded=!1,Me.upload(W.context));for(let Ne in Me.instancesPerModel){let ot=Me.instancesPerModel[Ne];ot.features.length>0&&(Ne=Ve.evaluate(ot.features[0].feature,{}));let ct=ie.getModel(Ne,ue);if(ct&&ct.uploaded)for(let at of ct.nodes)go(W,te,at,ot,Re,Ce,Br)}}}(m,s,h,g,P.type==="vector"?h.scope:""),void M();if(!P.loaded())return;if(P.type==="batched-model")return function(W,ee,te,ne){te.resetLayerRenderingStats(W);let ue=W.context,ce=W.transform,J=W.style.fog,ie=W.shadowRenderer;if(ce.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${ce.projection.name} projection is not yet implemented`);let re=W.transform.getFreeCameraOptions().position,ge=i._.scale([],[re.x,re.y,re.z],W.transform.worldSize);i._.negate(ge,ge);let Ie=i.ad.identity([]),ae=i.cg(ce.center.lat,ce.zoom),Ce=i.ad.fromScaling([],[1,1,1/ae]);i.ad.translate(Ie,Ie,ge);let Me=te.paint.get("model-opacity"),$e=new i.ae(ue.gl.LEQUAL,i.ae.ReadWrite,W.depthRangeFor3D),Ge=new i.ae(ue.gl.LEQUAL,i.ae.ReadOnly,W.depthRangeFor3D),Ve=new i.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),xe=W.renderPass==="shadow",Re=xe&&ie?ie.getCurrentCascadeFrustum():ce.getFrustum(ce.scaleZoom(ce.worldSize)),Ne=te.paint.get("model-front-cutoff"),ot=Ne[2]<1,ct=_s(W,te.paint.get("model-cutoff-fade-range")),at=te.getLayerRenderingStats();(function(je,He,st,pt){let Ot=je.terrain?je.terrain.exaggeration():0,Ht=je.transform.zoom;for(let fn of pt){let cn=He.getTile(fn).getBucket(st);cn&&(je.conflationActive&&cn.updateReplacement(fn,je.replacementSource),cn.evaluateScale(je,st),je.terrain&&Ot>0&&cn.elevationUpdate(je.terrain,Ot,fn,st.source),cn.needsReEvaluation(je,Ht,st)&&cn.evaluate(st))}})(W,ee,te,ne),function(){let je,He,st;ot?(je=ne.length-1,He=-1,st=-1):(je=0,He=ne.length,st=1);for(let pt=je;pt!==He;pt+=st){let Ot=ne[pt],Ht=ee.getTile(Ot).getBucket(te);if(!Ht||!Ht.uploaded)continue;let fn=!1;ie&&(fn=ie.getMaxCascadeForTile(Ot.toUnwrapped())===0);let cn=ce.calculatePosMatrix(Ot.toUnwrapped(),ce.worldSize),kn=Ht.modelTraits,jt=[];for(let Mn of Ht.getNodesInfo()){if(Mn.hiddenByReplacement||!Mn.node.meshes)continue;let qn=Mn.node,Ln=0;W.terrain&&qn.elevation&&(Ln=qn.elevation*W.terrain.exaggeration());let on=Mn.evaluatedScale;if(on[0]<=1&&on[1]<=1&&on[2]<=1&&(()=>{let Ee=Mn.aabb;return Ve.min=[...Ee.min],Ve.max=[...Ee.max],Ve.min[2]+=Ln,Ve.max[2]+=Ln,i._.transformMat4(Ve.min,Ve.min,cn),i._.transformMat4(Ve.max,Ve.max,cn),Ve})().intersects(Re)===0)continue;let Ut=[...cn],Qn=qn.anchor?qn.anchor[0]:0,ni=qn.anchor?qn.anchor[1]:0;i.ad.translate(Ut,Ut,[Qn*(on[0]-1),ni*(on[1]-1),Ln]),i._.exactEquals(on,i.cj)||i.ad.scale(Ut,Ut,on);let pn=i.ad.multiply([],Ut,qn.matrix),Be=i.ad.multiply([],ce.expandedFarZProjMatrix,pn),ut=i.ad.multiply([],ce.expandedFarZProjMatrix,Ut),Gi=i.aA.transformMat4([],[Qn,ni,Ln,1],Be)[2];qn.hidden=!1;let On=Me;xe||(ot&&(On*=Po(Ut,ce,Mn.aabb,Ne)),On*=xm(ct,Gi)),On!==0?jt.push({nodeInfo:Mn,depth:Gi,opacity:On,wvpForNode:Be,wvpForTile:ut,nodeModelMatrix:pn,tileModelMatrix:Ut}):qn.hidden=!0}xe||jt.sort((Mn,qn)=>!ot||Mn.opacity===1&&qn.opacity===1?Mn.depth<qn.depth?-1:1:Mn.opacity===1?-1:qn.opacity===1?1:Mn.depth>qn.depth?-1:1);for(let Mn of jt){let qn=Mn.nodeInfo,Ln=qn.node,on=i.ad.multiply([],Ce,Mn.tileModelMatrix);i.ad.multiply(on,Ie,on);let Ut=i.ad.invert([],on);i.ad.transpose(Ut,Ut),i.ad.scale(Ut,Ut,xs),on=i.ad.multiply(on,on,Ln.matrix);let Qn=W.renderPass==="light-beam",ni=kn&i.cl.HasMapboxMeshFeatures,pn=ni?0:qn.evaluatedRMEA[0][2];for(let Be=0;Be<Ln.meshes.length;++Be){let ut=Ln.meshes[Be],Gi=Be===Ln.lightMeshIndex,On=Mn.wvpForNode;if(Gi){if(!Qn&&!W.terrain&&W.shadowRenderer){W.currentLayer<W.firstLightBeamLayer&&(W.firstLightBeamLayer=W.currentLayer);continue}On=Mn.wvpForTile}else if(Qn)continue;let Ee={defines:[]},Vr=[];if(Uu(Ee.defines,Vr,ut,W,te.lut),ni||Ee.defines.push("DIFFUSE_SHADED"),fn&&Ee.defines.push("SHADOWS_SINGLE_CASCADE"),at&&(xe?at.numRenderedVerticesInShadowPass+=ut.vertexArray.length:at.numRenderedVerticesInTransparentPass+=ut.vertexArray.length),xe){zr(ut,Mn.nodeModelMatrix,W,te);continue}let vr=null;if(J){let ua=rc(Mn.nodeModelMatrix,W.transform);if(vr=new Float32Array(ua),ce.projection.name!=="globe"){let ha=ut.aabb.min,ws=ut.aabb.max,[ns,Ts]=J.getOpacityForBounds(ua,ha[0],ha[1],ws[0],ws[1]);Ee.overrideFog=ns>=li||Ts>=li}}let Yi=ut.material,Sr;Yi.occlusionTexture&&Yi.occlusionTexture.offsetScale&&(Sr=Yi.occlusionTexture.offsetScale,Ee.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!xe&&ie&&(ie.useNormalOffset=!!ut.normalBuffer);let Wr=W.getOrCreateProgram("model",Ee);!xe&&ie&&ie.setupShadowsFromMatrix(Mn.tileModelMatrix,Wr,ie.useNormalOffset),W.uploadCommonUniforms(ue,Wr,null,vr);let yo=Yi.pbrMetallicRoughness;yo.metallicFactor=.9,yo.roughnessFactor=.5;let to=Nu(new Float32Array(On),new Float32Array(on),new Float32Array(Ut),new Float32Array(Ln.matrix),W,Mn.opacity,yo.baseColorFactor.toRenderColor(null),Yi.emissiveFactor,yo.metallicFactor,yo.roughnessFactor,Yi,pn,te,[0,0,0],Sr);!Gi&&(qn.hasTranslucentParts||Mn.opacity<1)&&Wr.draw(W,ue.gl.TRIANGLES,$e,i.ag.disabled,i.a.disabled,i.af.backCCW,to,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Vr),Wr.draw(W,ue.gl.TRIANGLES,Gi?Ge:$e,i.ag.disabled,Gi||Mn.opacity<1||qn.hasTranslucentParts?i.a.alphaBlended:i.a.unblended,i.af.backCCW,to,te.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,te.paint,W.transform.zoom,void 0,Vr)}}}}()}(m,s,h,g),void M();let O=P.getModels(),N=[],B=m.transform.getFreeCameraOptions().position,V=i._.scale([],[B.x,B.y,B.z],m.transform.worldSize);i._.negate(V,V);let G=[],H=[],q=0;for(let W of O){let ee=h.paint.get("model-rotation").constantOr(null),te=h.paint.get("model-scale").constantOr(null),ne=h.paint.get("model-translation").constantOr(null);W.computeModelMatrix(m,ee,te,ne,!0,!0,!1);let ue=i.ad.identity([]),ce=i.cg(W.position.lat,m.transform.zoom),J=i.ad.fromScaling([],[1,1,1/ce]);i.ad.translate(ue,ue,V),N.push({zScaleMatrix:J,negCameraPosMatrix:ue});for(let ie of W.nodes)yr(m.transform,ie,W.matrix,m.transform.expandedFarZProjMatrix,q,G,H);q++}if(G.sort((W,ee)=>ee.depth-W.depth),m.renderPass!=="shadow"){if(v===1)for(let W of H)Ya(W,m,h,N[W.modelIndex],i.ag.disabled,m.colorModeForRenderPass());else{for(let W of H)Ya(W,m,h,N[W.modelIndex],i.ag.disabled,i.a.disabled);for(let W of H)Ya(W,m,h,N[W.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(let W of G)Ya(W,m,h,N[W.modelIndex],i.ag.disabled,m.colorModeForRenderPass());M()}else{for(let W of H)zr(W.mesh,W.nodeModelMatrix,m,h);for(let W of G)zr(W.mesh,W.nodeModelMatrix,m,h);M()}}},Fy={model:function(m,s,h){let g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?m.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(h.context)},raster:function(m,s,h){let g=s.getSource();if(!(g instanceof Zl&&g.loaded()))return;let v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=m.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let T=s.getIds().map(I=>s.getTileByID(I));for(let I of T)I.updateNeeded(v,x)&&g.prepareTile(I,v,x)},"raster-particle":function(m,s,h){let g=s.getSource();if(!(g instanceof Zl&&g.loaded()))return;let v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let T=s.getIds().map(I=>s.getTileByID(I));for(let I of T)I.updateNeeded(v,x)&&g.prepareTile(I,v,x)}};class Ny{constructor(s,h,g,v){this.context=new vu(s,h),this.occlusionBuffers=new R1(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=i.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let T of x)this._debugParams.enabledLayers[T]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let T of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],T);this.symbolParams=new Ll(v),this.setup(),this.numSublayers=i.bv.maxUnderzooming+i.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Td(this),this._wireframeDebugCache=new Gu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(s,h){let g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new om(this,s));let v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){let h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new om(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,h){if(this.width=s*i.e.devicePixelRatio,this.height=h*i.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let s=this.context,h=new i.bt;h.emplaceBack(0,0),h.emplaceBack(i.a3,0),h.emplaceBack(0,i.a3),h.emplaceBack(i.a3,i.a3),this.tileExtentBuffer=s.createVertexBuffer(h,i.br.members),this.tileExtentSegments=i.b.simpleSegment(0,0,4,2);let g=new i.bt;g.emplaceBack(0,0),g.emplaceBack(i.a3,0),g.emplaceBack(0,i.a3),g.emplaceBack(i.a3,i.a3),this.debugBuffer=s.createVertexBuffer(g,i.br.members),this.debugSegments=i.b.simpleSegment(0,0,4,5);let v=new i.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,i.br.members),this.viewportSegments=i.b.simpleSegment(0,0,4,2);let x=new i.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(i.a3,0,i.a3,0),x.emplaceBack(0,i.a3,0,i.a3),x.emplaceBack(i.a3,i.a3,i.a3,i.a3),this.mercatorBoundsBuffer=s.createVertexBuffer(x,i.cq.members),this.mercatorBoundsSegments=i.b.simpleSegment(0,0,4,2);let T=new i.bu;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);let I=new i.cr;for(let P of[0,1,3,2,0])I.emplaceBack(P);this.debugIndexBuffer=s.createIndexBuffer(I),this.emptyTexture=new i.T(s,new i.i({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=i.ad.create();let M=this.context.gl;this.stencilClearMode=new i.ag({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,i.ae.disabled,this.stencilClearMode,i.a.disabled,i.af.disabled,Id(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(let M of g)if(this._tileClippingMaskIDs[M.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(i.a.disabled),v.setDepthMode(i.ae.disabled);let T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let I of g){let M=h.getTile(I),P=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(M);T.draw(this,x.TRIANGLES,i.ae.disabled,new i.ag({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),i.a.disabled,i.af.disabled,Id(I.projMatrix),"$clipping",O,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let s=this.nextStencilID++,h=this.context.gl;return new i.ag({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);let h=this.context.gl;return new i.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){let h=this.context.gl,g=s.sort((T,I)=>I.overscaledZ-T.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let T={};for(let I=0;I<x;I++)T[I+v]=new i.ag({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[T,g]}return[{[v]:i.ag.disabled},g]}colorModeForRenderPass(){let s=this.context.gl;return this._showOverdrawInspector?new i.a([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new i.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.a.unblended:i.a.alphaBlended}colorModeForDrapableLayerRenderPass(s){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new i.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new i.C(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,h,g,v=!1){if(this.depthOcclusion)return new i.ae(this.context.gl.GREATER,i.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return i.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new i.ae(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,h)=>s+h/this._fpsHistory.length,0))}render(s,h){let g=i.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=h;let v=this.style._mergedLayers,x=this.style.order.filter(ie=>{let re=v[ie];return!(re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[re.type]}),T=x.map(ie=>v[ie]),I=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(i.e.now()),this.imageManager.beginFrame();let M=0,P=!1;for(let ie in I){let re=I[ie];re.used&&(re.prepare(this.context),re.getSource().usedInConflation&&++M)}let O=!1;for(let ie of T)ie.isHidden(this.transform.zoom)||(ie.type==="clip"&&(O=!0),this.prepareLayer(ie));let N={},B={},V={},G={},H={};for(let ie in I){let re=I[ie];N[ie]=re.getVisibleCoordinates(),B[ie]=N[ie].slice().reverse(),V[ie]=re.getVisibleCoordinates(!0).reverse(),G[ie]=re.getShadowCasterCoordinates(),H[ie]=re.sortCoordinatesByDistance(N[ie])}let q=ie=>{let re=this.style.getLayerSourceCache(ie);return re&&re.used?re.getSource():null};if(M||O){let ie=[],re=[],ge=0;for(let Ie of T)this.isSourceForClippingOrConflation(Ie,q(Ie))&&(ie.push(Ie),re.push(ge)),ge++;if(ie&&(O||ie.length>1)){let Ie=[];for(let ae=0;ae<ie.length;ae++){let Ce=ie[ae],Me=re[ae],$e=this.style.getLayerSourceCache(Ce);if(!$e||!$e.used||!$e.getSource().usedInConflation&&Ce.type!=="clip")continue;let Ge=1/0,Ve=i.cu.None;if(Ce.type==="clip"){Ge=Me;for(let xe of Ce.layout.get("clip-layer-types"))Ve|=xe==="model"?i.cu.Model:xe==="symbol"?i.cu.Symbol:i.cu.FillExtrusion}Ie.push({layer:Ce.fqid,cache:$e,order:Ge,clipMask:Ve})}this.replacementSource.setSources(Ie),P=!0}}P||this.replacementSource.clear(),this.conflationActive=P,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ie=0;ie<T.length;ie++){let re=T[ie],ge=re.cutoffRange();if(this.longestCutoffRange=Math.max(ge,this.longestCutoffRange),ge>0){let Ie=q(re);Ie&&(this.minCutoffZoom=Math.max(Ie.minzoom,this.minCutoffZoom)),re.minzoom&&(this.minCutoffZoom=Math.max(re.minzoom,this.minCutoffZoom))}re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ie),this._lastOcclusionLayer=ie)}let W=this.style&&this.style.fog;W?(this._fogVisible=W.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=W.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(V),this.opaquePassCutoff=0);let ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(let ie in I)for(let re of N[ie]){let ge={min:0,max:0};this.terrain&&(ge=this.terrain.getMinMaxForTile(re)||ge),ee.addShadowReceiver(re.toUnwrapped(),ge.min,ge.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new vm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!i.ct(this.context.gl))return;this.renderPass="offscreen";for(let ie of T){let re=s.getLayerSourceCache(ie);if(!ie.hasOffscreenPass()||ie.isHidden(this.transform.zoom))continue;let ge=re?B[re.id]:void 0;(ie.type==="custom"||ie.type==="raster"||ie.type==="raster-particle"||ie.isSky()||ge&&ge.length)&&this.renderLayer(this,re,ie,ge)}this.depthRangeFor3D=[0,1-(T.length+2)*this.numSublayers*this.depthEpsilon];let te=this.terrain;te&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&te.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,G)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ne=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ue=(()=>{if(h.showOverdrawInspector)return i.C.black;let ie=this.style.fog;if(ie&&this.transform.projection.supportsFog){let re=this.style.getLut(ie.scope);if(!ne){let ge=ie.properties.get("color").toRenderColor(re).toArray01();return new i.C(...ge)}if(ne){let ge=ie.properties.get("space-color").toRenderColor(re).toArray01();return new i.C(...ge)}}return i.C.transparent})();if(this.context.clear({color:ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let ie=T[this.currentLayer],re=s.getLayerSourceCache(ie);if(ie.isSky())continue;let ge=re?(ie.is3D()?H:B)[re.id]:void 0;this._renderTileClippingMasks(ie,re,ge),this.renderLayer(this,re,ie,ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let ie=T[this.currentLayer],re=s.getLayerSourceCache(ie);ie.isSky()&&this.renderLayer(this,re,ie,re?B[re.id]:void 0)}function ce(ie,re){let ge;return re&&(ge=(ie.type==="symbol"?V:ie.is3D()?H:B)[re.id]),ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let ie=T[this.currentLayer];if(ie.type==="raster"){let re=s.getLayerSourceCache(ie);this.renderLayer(this,re,ie,ce(ie,re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let J=0;for(ee&&(J=ee.getShadowCastingLayerCount());this.currentLayer<x.length;){let ie=T[this.currentLayer],re=s.getLayerSourceCache(ie);if(ie.isSky())++this.currentLayer;else if(te&&this.style.isLayerDraped(ie)){if(ie.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=te.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(ie.is3D()||this.terrain||this._renderTileClippingMasks(ie,re,re?N[re.id]:void 0),this.renderLayer(this,re,ie,ce(ie,re)),!te&&ee&&J>0&&ie.hasShadowPass()&&--J==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ge;this.currentLayer++){let Ie=T[this.currentLayer];if(!Ie.hasLightBeamPass())continue;let ae=s.getLayerSourceCache(Ie);this.renderLayer(this,ae,Ie,ae?B[ae.id]:void 0)}this.currentLayer=ge,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let ge=this.currentLayer;this.depthOcclusion=!0;for(let Ie of this.layersWithOcclusionOpacity){this.currentLayer=Ie;let ae=T[this.currentLayer],Ce=s.getLayerSourceCache(ae),Me=Ce?B[Ce.id]:void 0;ae.is3D()||this.terrain||this._renderTileClippingMasks(ae,Ce,Ce?N[Ce.id]:void 0),this.renderLayer(this,Ce,ae,Me)}this.depthOcclusion=!1,this.currentLayer=ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ie=null;T.forEach(re=>{let ge=s.getLayerSourceCache(re);ge&&!re.isHidden(this.transform.zoom)&&ge.getVisibleCoordinates().length&&(!ie||ie.getSource().maxzoom<ge.getSource().maxzoom)&&(ie=ge)}),ie&&this.options.showTileBoundaries&&Ro.debug(this,ie,ie.getVisibleCoordinates(),i.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ro.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ie){let re=ie.transform.padding;En(ie,ie.transform.height-(re.top||0),3,zd),En(ie,re.bottom||0,3,_m),In(ie,re.left||0,3,Jo),In(ie,ie.transform.width-(re.right||0),3,ym);let ge=ie.transform.centerPoint;(function(Ie,ae,Ce,Me){Nr(Ie,ae-1,Ce-10,2,20,Me),Nr(Ie,ae-10,Ce-1,20,2,Me)})(ie,ge.x,ie.transform.height-ge.y,tc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),P||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);let{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(s.type);if(Fy[s.type]&&(g||this.terrain&&s.type==="custom")){let v=this.style.getLayerSourceCache(s);Fy[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||Ro[g.type](s,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let s=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){let s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){let h={};for(let g in s){let v=s[g],x=this.context.extTimerQuery,T=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),h[g]=T}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of s)v+=h.getQueryParameter(x,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(x);return v}translatePosMatrix(s,h,g,v,x){if(!g[0]&&!g[1])return s;let T=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){let P=Math.sin(T),O=Math.cos(T);g=[g[0]*O-g[1]*P,g[0]*P+g[1]*O]}let I=[x?g[0]:i.bB(h,g[0],this.transform.zoom),x?g[1]:i.bB(h,g[1],this.transform.zoom),0],M=new Float32Array(16);return i.ad.translate(M,s,I),M}saveTileTexture(s){let h=s.size[0],g=this._tileTextures[h];g?g.push(s):this._tileTextures[h]=[s]}getTileTexture(s){let h=this._tileTextures[s];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,h,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(s,h){this.cache=this.cache||{};let g=h&&h.defines||[],v=h&&h.config,x=this.currentGlobalDefines(s,h&&h.overrideFog,h&&h.overrideRtt).concat(g),T=Ru.cacheKey(vy[s],s,x,v);return this.cache[T]||(this.cache[T]=new Ru(this.context,s,vy[s],v,S1[s],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,h){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((T,I,M)=>{let P=T.properties.get("direction"),O=T.properties.get("color").toRenderColor(M.getLut(T.scope)).toArray01(),N=T.properties.get("intensity"),B=I.properties.get("color").toRenderColor(M.getLut(I.scope)).toArray01(),V=I.properties.get("intensity"),G=[P.x,P.y,P.z],H=i.bA(B,V),q=i.bA(O,N);return{u_lighting_ambient_color:H,u_lighting_directional_dir:G,u_lighting_directional_color:q,u_ground_radiance:vs(G,q,H)}})(g,v,this.style);h.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,h,g,v,x){if(this.uploadCommonLightUniforms(s,h),this.terrain&&this.terrain.renderingToTexture)return;let T=this.style.fog;if(T){let I=T.getOpacity(this.transform.pitch),M=((P,O,N,B,V,G,H,q,W,ee,te,ne)=>{let ue=P.transform,ce=O.properties.get("color").toRenderColor(P.style.getLut(O.scope)).toArray01();ce[3]=B;let J=P.frameCounter/1e3%1,[ie,re]=O.properties.get("vertical-range");return{u_fog_matrix:N?ue.calculateFogTileMatrix(N):ne||P.identityMat,u_fog_range:O.getFovAdjustedRange(ue._fov),u_fog_color:ce,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ie,re),re],u_fog_temporal_offset:J,u_frustum_tl:V,u_frustum_tr:G,u_frustum_br:H,u_frustum_bl:q,u_globe_pos:W,u_globe_radius:ee,u_viewport:te,u_globe_transition:i.a1(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,T,g,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.e.devicePixelRatio,this.transform.height*i.e.devicePixelRatio],v);h.setFogUniformValues(s,M)}x&&h.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){let s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){let s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)h[v.key]=s[v.key]||new i.by(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,h){return!(!s.is3D()||s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||s.sourceLayer!=="building")&&s.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[s.key];return h||(this._cachedTileFogOpacities[s.key]=h=this.style.fog.getOpacityForTile(s)),h[0]>=li||h[1]>=li}}class Cr{constructor(s,h,g,v){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let g,v;if(s instanceof i.P||typeof s[0]=="number"){let x=i.P.convert(s);g=[x],v=h.isPointAboveHorizon(x)}else{let x=i.P.convert(s[0]),T=i.P.convert(s[1]);g=[x,T],v=i.cv(x,T).every(I=>h.isPointAboveHorizon(I))}return new Cr(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return i.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.cv(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),i.cw(v,s)}bufferedCameraGeometryGlobe(s){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.cv(h,g,s),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>g.y))+((x.x>h.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(s,h,g,v=0){let x=s.queryPadding/h._pixelsPerMercatorPixel+1,T=g?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),I=s.tileID.wrap+(T.unwrapped?v:0),M=T.polygon.map(q=>i.cx(s.tileTransform,q,I));if(!i.cy(M,0,0,i.a3,i.a3))return;I=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let P=this.screenGeometryMercator.polygon.map(q=>i.cz(s.tileTransform,q,I)),O=P.map(q=>new i.P(q[0],q[1])),N=h.getFreeCameraOptions().position||new i.Y(0,0,0),B=i.cz(s.tileTransform,N,I),V=P.map(q=>{let W=i._.sub(q,q,B);return i._.normalize(W,W),new i.aT(B,W)}),G=i.bB(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:V,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(H=i.cA(M),H.min.x=i.at(H.min.x,0,i.a3),H.min.y=i.at(H.min.y,0,i.a3),H.max.x=i.at(H.max.x,0,i.a3),H.max.y=i.at(H.max.y,0,i.a3),H),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:G};var H}_bufferedScreenMercator(s,h){let g=wm(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,h){let g=wm(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,h){let g=function(x,T){let I=i.ad.multiply([],T.pixelMatrix,T.globeMatrix),M=[0,-i.cD,0,1],P=[0,i.cD,0,1],O=[0,0,0,1];i.aA.transformMat4(M,M,I),i.aA.transformMat4(P,P,I),i.aA.transformMat4(O,O,I);let N=new i.P(M[0]/M[3],M[1]/M[3]),B=new i.P(P[0]/P[3],P[1]/P[3]),V=i.cB(x,N)&&M[3]<O[3],G=i.cB(x,B)&&P[3]<O[3];if(!V&&!G)return null;let H=function(J,ie,re){for(let ge=1;ge<J.length;ge++){let Ie=ia(ie.pointCoordinate3D(J[ge-1]).x),ae=ia(ie.pointCoordinate3D(J[ge]).x);if(re<0){if(Ie<ae)return{idx:ge,t:-Ie/(ae-1-Ie)}}else if(ae<Ie)return{idx:ge,t:(1-Ie)/(ae+1-Ie)}}return null}(x,T,V?-1:1);if(!H)return null;let{idx:q,t:W}=H,ee=q>1?bm(x.slice(0,q),T):[],te=q<x.length?bm(x.slice(q),T):[];ee=ee.map(J=>new i.P(ia(J.x),J.y)),te=te.map(J=>new i.P(ia(J.x),J.y));let ne=[...ee];ne.length===0&&ne.push(te[te.length-1]);let ue=i.a2(ne[ne.length-1].y,(te.length===0?ee[0]:te[0]).y,W),ce;return ce=V?[new i.P(0,ue),new i.P(0,0),new i.P(1,0),new i.P(1,ue)]:[new i.P(1,ue),new i.P(1,1),new i.P(0,1),new i.P(0,ue)],ne.push(...ce),te.length===0?ne.push(ee[0]):ne.push(...te),{polygon:ne.map(J=>new i.Y(J.x,J.y)),unwrapped:!1}}(s,h);if(g)return g;let v=function(x,T){let I=!1,M=-1/0,P=0;for(let N=0;N<x.length-1;N++)x[N].x>M&&(M=x[N].x,P=N);for(let N=0;N<x.length-1;N++){let B=(P+N)%(x.length-1),V=x[B],G=x[B+1];Math.abs(V.x-G.x)>.5&&(V.x<G.x?(V.x+=1,B===0&&(x[x.length-1].x+=1)):(G.x+=1,B+1===x.length-1&&(x[0].x+=1)),I=!0)}let O=i.aj(T.center.lng);return I&&O<Math.abs(O-1)&&x.forEach(N=>{N.x-=1}),{polygon:x,unwrapped:I}}(bm(s,h).map(x=>new i.P(ia(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new i.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function bm(m,s){return i.cC(m,h=>{let g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function ia(m){return m<0?1+m%1:m%1}function wm(m){return 100*m|0}function k1(m,s){let h=i.ad.identity([]);return i.ad.scale(h,h,[.5*m.width,.5*-m.height,1]),i.ad.translate(h,h,[1,-1,0]),i.ad.multiply(h,h,m.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function O1(m,s,h,g,v,x,T,I=!1){let M=m.tilesIn(g,T,I);M.sort(oc);let P=[];for(let N of M)P.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,h,m._state,N,v,x,k1(m.transform,N.tile.tileID),I)});let O=function(N){let B={},V={};for(let G of N){let H=G.queryResults,q=G.wrappedTileID,W=V[q]=V[q]||{};for(let ee in H){let te=H[ee],ne=W[ee]=W[ee]||{},ue=B[ee]=B[ee]||[];for(let ce of te)ne[ce.featureIndex]||(ne[ce.featureIndex]=!0,ue.push(ce))}}return B}(P);for(let N in O)O[N].forEach(B=>{let V=B.feature,G=V.layer;G&&G.type!=="background"&&G.type!=="sky"&&G.type!=="slot"&&(V.source=G.source,G["source-layer"]&&(V.sourceLayer=G["source-layer"]),V.state=V.id!==void 0?m.getFeatureState(G["source-layer"],V.id):{})});return O}function Hu(m,s){let h=m.getRenderableIds().map(x=>m.getTileByID(x)),g=[],v={};for(let x=0;x<h.length;x++){let T=h[x],I=T.tileID.canonical.key;v[I]||(v[I]=!0,T.querySourceFeatures(g,s))}return g}function oc(m,s){let h=m.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class L1{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let s=!1,h=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:s,visibilityChanged:h});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:s,visibilityChanged:h})}}}onNewFrame(s){this.layersGotHidden=!1;for(let h of this.layers){let g=h.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(s)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(s,h){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,T=this.style.getLayerSourceCache(x),I=1;x.type==="fill-extrusion"&&(I=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let M=T?T.getTile(h):null;if(!M&&T&&h.canonical.z>T.getSource().minzoom){let P=h.scaledTo(Math.min(T.getSource().maxzoom,h.overscaledZ-1));for(;P.overscaledZ>=T.getSource().minzoom&&(M=T.getTile(P),!M&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(x):null,tileID:M?M.tileID:h,verticalScale:I})}s.hasAnyZOffset=!1;let g=!1;for(let v=0;v<s.symbolInstances.length;v++){let x=s.symbolInstances.get(v),T=x.zOffset,I=this._getHeightAtTileOffset(h,x.tileAnchorX,x.tileAnchorY);x.zOffset=I!==Number.NEGATIVE_INFINITY?I:T,g||T===x.zOffset||(g=!0),s.hasAnyZOffset||x.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,h,g,v){let x=h,T=g;if(s.canonical.z!==v.canonical.z){let I=v.canonical,M=1/(1<<s.canonical.z-I.z);x=(h+s.canonical.x*i.a3)*M-I.x*i.a3|0,T=(g+s.canonical.y*i.a3)*M-I.y*i.a3|0}return{tileX:x,tileY:T}}_getHeightAtTileOffset(s,h,g){let v,x;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;let{bucket:I,tileID:M,verticalScale:P}=this.currentBuildingBuckets[T];if(!I)continue;let{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,M),B=I.getHeightAtTileCoord(O,N);B&&B.height!==void 0&&(B.hidden?v=B.height:x=Math.max(B.height*P,x||0))}if(x!==void 0)return x;for(let T=0;T<this.layers.length;++T){let I=this.layers[T];if(I.layer.type!=="model"||!I.visible)continue;let{bucket:M,tileID:P}=this.currentBuildingBuckets[T];if(!M)continue;let{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(s,h,g,P),B=M.getHeightAtTileCoord(O,N);if(B&&!B.hidden)return B.height===void 0&&v!==void 0?Math.min(B.maxHeight,v)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function sc(m,s){let h={};for(let g in m)g!=="ref"&&(h[g]=m[g]);return i.cE.forEach(g=>{g in s&&(h[g]=s[g])}),h}function Tm(m){m=m.slice();let s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=sc(m[h],s[m[h].ref]));return m}let yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function bs(m,s,h){h.push({command:yn.addSource,args:[m,s[m]]})}function zy(m,s,h){s.push({command:yn.removeSource,args:[m]}),h[m]=!0}function F1(m,s,h,g){zy(m,h,g),bs(m,s,h)}function N1(m,s,h){let g;for(g in m[h])if(m[h].hasOwnProperty(g)&&g!=="data"&&!w(m[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&g!=="data"&&!w(m[h][g],s[h][g]))return!1;return!0}function qu(m,s,h,g,v,x){let T;for(T in s=s||{},m=m||{})m.hasOwnProperty(T)&&(w(m[T],s[T])||h.push({command:x,args:[g,T,s[T],v]}));for(T in s)s.hasOwnProperty(T)&&!m.hasOwnProperty(T)&&(w(m[T],s[T])||h.push({command:x,args:[g,T,s[T],v]}))}function Bd(m){return m.id}function ac(m,s){return m[s.id]=s,m}class By{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=i.at(s,0,1);let h=1,g=this._distances[h],v=s*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];let x=h-1,T=this._distances[x],I=g-T,M=I>0?(v-T)/I:0;return this.points[x].mult(1-M).add(this.points[h].mult(M))}}class Em{constructor(s,h,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,v,x){this._forEachCell(h,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(s,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,h,g,v,x,T){this.boxCells[x].push(T)}_insertCircleCell(s,h,g,v,x,T){this.circleCells[x].push(T)}_query(s,h,g,v,x,T){if(g<0||s>this.width||v<0||h>this.height)return!x&&[];let I=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){let P=this.circles[3*M],O=this.circles[3*M+1],N=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:P-N,y1:O-N,x2:P+N,y2:O+N})}return T?I.filter(T):I}return this._forEachCell(s,h,g,v,this._queryCell,I,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?I.length>0:I}_queryCircle(s,h,g,v,x){let T=s-g,I=s+g,M=h-g,P=h+g;if(I<0||T>this.width||P<0||M>this.height)return!v&&[];let O=[];return this._forEachCell(T,M,I,P,this._queryCellCircle,O,{hitTest:v,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},x),v?O.length>0:O}query(s,h,g,v,x){return this._query(s,h,g,v,!1,x)}hitTest(s,h,g,v,x){return this._query(s,h,g,v,!0,x)}hitTestCircle(s,h,g,v){return this._queryCircle(s,h,g,!0,v)}_queryCell(s,h,g,v,x,T,I,M){let P=I.seenUids,O=this.boxCells[x];if(O!==null){let B=this.bboxes;for(let V of O)if(!P.box[V]){P.box[V]=!0;let G=4*V;if(s<=B[G+2]&&h<=B[G+3]&&g>=B[G+0]&&v>=B[G+1]&&(!M||M(this.boxKeys[V]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[V],x1:B[G],y1:B[G+1],x2:B[G+2],y2:B[G+3]})}}}let N=this.circleCells[x];if(N!==null){let B=this.circles;for(let V of N)if(!P.circle[V]){P.circle[V]=!0;let G=3*V;if(this._circleAndRectCollide(B[G],B[G+1],B[G+2],s,h,g,v)&&(!M||M(this.circleKeys[V]))){if(I.hitTest)return T.push(!0),!0;{let H=B[G],q=B[G+1],W=B[G+2];T.push({key:this.circleKeys[V],x1:H-W,y1:q-W,x2:H+W,y2:q+W})}}}}}_queryCellCircle(s,h,g,v,x,T,I,M){let P=I.circle,O=I.seenUids,N=this.boxCells[x];if(N!==null){let V=this.bboxes;for(let G of N)if(!O.box[G]){O.box[G]=!0;let H=4*G;if(this._circleAndRectCollide(P.x,P.y,P.radius,V[H+0],V[H+1],V[H+2],V[H+3])&&(!M||M(this.boxKeys[G])))return T.push(!0),!0}}let B=this.circleCells[x];if(B!==null){let V=this.circles;for(let G of B)if(!O.circle[G]){O.circle[G]=!0;let H=3*G;if(this._circlesCollide(V[H],V[H+1],V[H+2],P.x,P.y,P.radius)&&(!M||M(this.circleKeys[G])))return T.push(!0),!0}}}_forEachCell(s,h,g,v,x,T,I,M){let P=this._convertToXCellCoord(s),O=this._convertToYCellCoord(h),N=this._convertToXCellCoord(g),B=this._convertToYCellCoord(v);for(let V=P;V<=N;V++)for(let G=O;G<=B;G++)if(x.call(this,s,h,g,v,this.xCellCount*G+V,T,I,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,v,x,T){let I=v-s,M=x-h,P=g+T;return P*P>I*I+M*M}_circleAndRectCollide(s,h,g,v,x,T,I){let M=(T-v)/2,P=Math.abs(s-(v+M));if(P>M+g)return!1;let O=(I-x)/2,N=Math.abs(h-(x+O));if(N>O+g)return!1;if(P<=M||N<=O)return!0;let B=P-M,V=N-O;return B*B+V*V<=g*g}}let ko=100;class Vy{constructor(s,h,g=new Em(s.width+200,s.height+200,25),v=new Em(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ko,this.screenBottomBoundary=s.height+ko,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,v,x,T,I,M){let P=g.projectedAnchorX,O=g.projectedAnchorY,N=g.projectedAnchorZ,B=g.elevation,V=g.tileID,G=s.getProjection();if(B&&V){let[ce,J,ie]=G.upVector(V.canonical,g.tileAnchorX,g.tileAnchorY),re=G.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ce*B*re,O+=J*B*re,N+=ie*B*re}let H=this.projectAndGetPerspectiveRatio(I,P,O,N,g.tileID,G.name==="globe"||!!B||this.transform.pitch>0,G),q=T*H.perspectiveRatio,W=(g.x1*h+v.x-g.padding)*q+H.point.x,ee=(g.y1*h+v.y-g.padding)*q+H.point.y,te=(g.x2*h+v.x+g.padding)*q+H.point.x,ne=(g.y2*h+v.y+g.padding)*q+H.point.y,ue=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(W,ee,te,ne)||!x&&this.grid.hitTest(W,ee,te,ne,M)||ue?{box:[],offscreen:!1,occluded:H.occluded}:{box:[W,ee,te,ne],offscreen:this.isOffscreen(W,ee,te,ne),occluded:!1}}placeCollisionCircles(s,h,g,v,x,T,I,M,P,O,N,B,V,G,H){let q=[],W=this.transform.elevation,ee=s.getProjection(),te=W?W.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,ee):null,ne=new i.P(g.tileAnchorX,g.tileAnchorY),{x:ue,y:ce,z:J}=ee.projectTilePoint(ne.x,ne.y,H.canonical);if(te){let[Ve,xe,Re]=te(ne);ue+=Ve,ce+=xe,J+=Re}let ie=ee.name==="globe",re=this.projectAndGetPerspectiveRatio(I,ue,ce,J,H,ie||!!W||this.transform.pitch>0,ee),{perspectiveRatio:ge}=re,Ie=(N?T/ge:T*ge)/i.bN,ae=mo(ue,ce,J,M),Ce=re.signedDistanceFromCamera>0?bd(Ie,x,g.lineOffsetX*Ie,g.lineOffsetY*Ie,!1,ae,ne,g,v,M,{},W&&!N?te:null,N&&!!W,ee,H,N):null,Me=!1,$e=!1,Ge=!0;if(Ce&&!re.occluded){let Ve=.5*V*ge+G,xe=new i.P(-100,-100),Re=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Ne=new By,{first:ot,last:ct}=Ce,at=ot.path.length,je=[];for(let pt=at-1;pt>=1;pt--)je.push(ot.path[pt]);for(let pt=1;pt<ct.path.length;pt++)je.push(ct.path[pt]);let He=2.5*Ve;P&&(je=je.map(([pt,Ot,Ht],fn)=>(te&&!ie&&(Ht=te(fn<at-1?ot.tilePath[at-1-fn]:ct.tilePath[fn-at+2])[2]),mo(pt,Ot,Ht,P))),je.some(pt=>pt[3]<=0)&&(je=[]));let st=[];if(je.length>0){let pt=1/0,Ot=-1/0,Ht=1/0,fn=-1/0;for(let cn of je)pt=Math.min(pt,cn[0]),Ht=Math.min(Ht,cn[1]),Ot=Math.max(Ot,cn[0]),fn=Math.max(fn,cn[1]);Ot>=xe.x&&pt<=Re.x&&fn>=xe.y&&Ht<=Re.y&&(st=[je.map(cn=>new i.P(cn[0],cn[1]))],(pt<xe.x||Ot>Re.x||Ht<xe.y||fn>Re.y)&&(st=i.cF(st,xe.x,xe.y,Re.x,Re.y)))}for(let pt of st){Ne.reset(pt,.25*Ve);let Ot=0;Ot=Ne.length<=.5*Ve?1:Math.ceil(Ne.paddedLength/He)+1;for(let Ht=0;Ht<Ot;Ht++){let fn=Ht/Math.max(Ot-1,1),cn=Ne.lerp(fn),kn=cn.x+ko,jt=cn.y+ko;q.push(kn,jt,Ve,0);let Mn=kn-Ve,qn=jt-Ve,Ln=kn+Ve,on=jt+Ve;if(Ge=Ge&&this.isOffscreen(Mn,qn,Ln,on),$e=$e||this.isInsideGrid(Mn,qn,Ln,on),!h&&this.grid.hitTestCircle(kn,jt,Ve,B)&&(Me=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Me,occluded:!1}}}}return{circles:!O&&Me||!$e?[]:q,offscreen:Ge,collisionDetected:Me,occluded:re.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],g=1/0,v=1/0,x=-1/0,T=-1/0;for(let O of s){let N=new i.P(O.x+ko,O.y+ko);g=Math.min(g,N.x),v=Math.min(v,N.y),x=Math.max(x,N.x),T=Math.max(T,N.y),h.push(N)}let I=this.grid.query(g,v,x,T).concat(this.ignoredGrid.query(g,v,x,T)),M={},P={};for(let O of I){let N=O.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;let B=[new i.P(O.x1,O.y1),new i.P(O.x2,O.y1),new i.P(O.x2,O.y2),new i.P(O.x1,O.y2)];i.cG(h,B)&&(M[N.bucketInstanceId][N.featureIndex]=!0,P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]=[]),P[N.bucketInstanceId].push(N.featureIndex))}return P}insertCollisionBox(s,h,g,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,v,x){let T=h?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let M=0;M<s.length;M+=4)T.insertCircle(I,s[M],s[M+1],s[M+2])}projectAndGetPerspectiveRatio(s,h,g,v,x,T,I){let M=[h,g,v,1],P=!1;v||this.transform.pitch>0?(i.aA.transformMat4(M,M,s),this.fogState&&x&&I.name!=="globe"&&(P=function(B,V,G,H,q,W){let ee=W.calculateFogTileMatrix(q),te=[V,G,H];return i._.transformMat4(te,te,ee),Vi(B,i._.length(te),W.pitch,W._fov)}(this.fogState,h,g,v,x.toUnwrapped(),this.transform)>.9)):Ko(M,M,s);let O=M[3];return{point:new i.P((M[0]/O+1)/2*this.transform.width+ko,(-M[1]/O+1)/2*this.transform.height+ko),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/O*.5,1.5),signedDistanceFromCamera:O,occluded:T&&M[2]>O||P}}isOffscreen(s,h,g,v){return g<ko||s>=this.screenRightBoundary||v<ko||h>this.screenBottomBoundary}isInsideGrid(s,h,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let s=i.ad.identity([]);return i.ad.translate(s,s,[-100,-100,0]),s}}class ra{constructor(s,h,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class oa{constructor(s,h,g,v,x,T=!1){this.text=new ra(s?s.text:null,h,g,x),this.icon=new ra(s?s.icon:null,h,v,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Vd{constructor(s,h,g,v=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=v}}class jy{constructor(){this.invProjMatrix=i.ad.create(),this.viewportMatrix=i.ad.create(),this.circles=[]}}class Wu{constructor(s,h,g,v,x){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class Zu{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){let h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function Im(m,s,h,g,v){let{horizontalAlign:x,verticalAlign:T}=i.bQ(m),I=-(x-.5)*s,M=-(T-.5)*h,P=i.bP(m,g);return new i.P(I+P[0]*v,M+P[1]*v)}function Yu(m,s,h,g,v){let x=new i.P(m,s);return h&&x._rotate(g?v:-v),x}class _o{constructor(s,h,g,v,x,T){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Vy(this.transform,x),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Zu(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,g,v){let x=g.getBucket(h),T=g.latestFeatureIndex;if(!x||!T||h.fqid!==x.layerIds[0])return;let I=x.layers[0].layout,M=g.collisionBoxArray,P=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),O=g.tileSize/i.a3,N=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let B=(V=g.tileID,G=x.getProjection(),H=this.transform,G.name===this.projection?H.calculateProjMatrix(V.toUnwrapped()):Od(H,G,V));var V,G,H;let q=I.get("text-pitch-alignment")==="map",W=I.get("text-rotation-alignment")==="map";h.compileFilter();let ee=h.dynamicFilter(),te=h.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(g),ue=$a(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne),ce=null;if(q){let re=Hl(B,g.tileID.canonical,q,W,this.transform,x.getProjection(),ne);ce=i.ad.multiply([],this.transform.labelPlaneMatrix,re)}let J=null;ee&&g.latestFeatureIndex&&(J={unwrappedTileID:N,dynamicFilter:ee,dynamicFilterNeedsFeature:te,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Wu(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,g.tileID);let ie={bucket:x,layout:I,posMatrix:B,textLabelPlaneMatrix:ue,labelToScreenMatrix:ce,clippingData:J,scale:P,textPixelRatio:O,holdingForFade:g.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:i.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let re of x.sortKeyRanges){let{sortKey:ge,symbolInstanceStart:Ie,symbolInstanceEnd:ae}=re;s.push({sortKey:ge,symbolInstanceStart:Ie,symbolInstanceEnd:ae,parameters:ie})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(s,h,g,v,x,T,I,M,P,O,N,B,V,G,H,q,W,ee){let{textOffset0:te,textOffset1:ne,crossTileID:ue}=B,ce=[te,ne],J=Im(s,g,v,ce,x),ie=this.collisionIndex.placeCollisionBox(G,x,h,Yu(J.x,J.y,T,I,this.transform.angle),N,M,P,O.predicate);if(q){let re=G.getSymbolInstanceIconSize(ee,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,re,q,Yu(J.x,J.y,T,I,this.transform.angle),N,M,P,O.predicate).box.length===0)return}if(ie.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(re=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:ce,width:g,height:v,anchor:s,textScale:x,prevAnchor:re},this.markUsedJustification(G,s,B,H),G.allowVerticalPlacement&&(this.markUsedOrientation(G,H,B),this.placedOrientations[ue]=H),{shift:J,placedGlyphBoxes:ie}}}placeLayerBucketPart(s,h,g,v){let{bucket:x,layout:T,posMatrix:I,textLabelPlaneMatrix:M,labelToScreenMatrix:P,clippingData:O,textPixelRatio:N,holdingForFade:B,collisionBoxArray:V,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:H,collisionGroup:q}=s.parameters,W=T.get("text-optional"),ee=T.get("icon-optional"),te=T.get("text-allow-overlap"),ne=T.get("icon-allow-overlap"),ue=T.get("text-rotation-alignment")==="map",ce=T.get("text-pitch-alignment")==="map",J=T.get("symbol-z-order")==="viewport-y",ie=T.get("symbol-z-elevate");this.transform.setProjection(x.projection);let re=te&&(ne||!x.hasIconData()||ee),ge=ne&&(te||!x.hasTextData()||W);!x.collisionArrays&&V&&x.deserializeCollisionBoxes(V),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,V);let Ie=(ae,Ce,Me)=>{let{crossTileID:$e,numVerticalGlyphVertices:Ge}=ae;if(O){let Ln={zoom:this.transform.zoom,pitch:this.transform.pitch},on=null;if(O.dynamicFilterNeedsFeature){let Ut=this.retainedQueryData[x.bucketInstanceId];on=O.featureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:Ut.bucketIndex,sourceLayerIndex:Ut.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(Ln,on,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new i.P(ae.tileAnchorX,ae.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[$e]=new Vd(!1,!1,!1,!0),void h.add($e)}if(h.has($e))return;if(B)return void(this.placements[$e]=new Vd(!1,!1,!1));let Ve=!1,xe=!1,Re=!0,Ne=!1,ot=!1,ct=null,at={box:null,offscreen:null,occluded:null},je={box:null,offscreen:null,occluded:null},He=null,st=null,pt=null,Ot=0,Ht=0,fn=0;Me.textFeatureIndex?Ot=Me.textFeatureIndex:ae.useRuntimeCollisionCircles&&(Ot=ae.featureIndex),Me.verticalTextFeatureIndex&&(Ht=Me.verticalTextFeatureIndex);let cn=Ln=>{Ln.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let on=this.transform.elevation;Ln.elevation=ae.zOffset+(on?on.getAtTileOffset(Ln.tileID,Ln.tileAnchorX,Ln.tileAnchorY):0)},kn=Me.textBox;if(kn){cn(kn);let Ln=Ut=>{let Qn=i.aE.horizontal;if(x.allowVerticalPlacement&&!Ut&&this.prevPlacement){let ni=this.prevPlacement.placedOrientations[$e];ni&&(this.placedOrientations[$e]=ni,Qn=ni,this.markUsedOrientation(x,Qn,ae))}return Qn},on=(Ut,Qn)=>{if(x.allowVerticalPlacement&&Ge>0&&Me.verticalTextBox){for(let ni of x.writingModes)if(ni===i.aE.vertical?(at=Qn(),je=at):at=Ut(),at&&at.box&&at.box.length)break}else at=Ut()};if(T.get("text-variable-anchor")){let Ut=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e]){let pn=this.prevPlacement.variableOffsets[$e];Ut.indexOf(pn.anchor)>0&&(Ut=Ut.filter(Be=>Be!==pn.anchor),Ut.unshift(pn.anchor))}let Qn=(pn,Be,ut)=>{let Gi=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Ce),On=(pn.x2-pn.x1)*Gi+2*pn.padding,Ee=(pn.y2-pn.y1)*Gi+2*pn.padding,Vr=ae.hasIconTextFit&&!ne?Be:null;Vr&&cn(Vr);let vr={box:[],offscreen:!1,occluded:!1},Yi=te?2*Ut.length:Ut.length;for(let Sr=0;Sr<Yi;++Sr){let Wr=this.attemptAnchorPlacement(Ut[Sr%Ut.length],pn,On,Ee,Gi,ue,ce,N,I,q,Sr>=Ut.length,ae,Ce,x,ut,Vr,G,H);if(Wr&&(vr=Wr.placedGlyphBoxes,vr&&vr.box&&vr.box.length)){Ve=!0,ct=Wr.shift;break}}return vr};on(()=>Qn(kn,Me.iconBox,i.aE.horizontal),()=>{let pn=Me.verticalTextBox;return pn&&cn(pn),x.allowVerticalPlacement&&!(at&&at.box&&at.box.length)&&Ge>0&&pn?Qn(pn,Me.verticalIconBox,i.aE.vertical):{box:null,offscreen:null,occluded:null}}),at&&(Ve=at.box,Re=at.offscreen,Ne=at.occluded);let ni=Ln(!(!at||!at.box));if(!Ve&&this.prevPlacement){let pn=this.prevPlacement.variableOffsets[$e];pn&&(this.variableOffsets[$e]=pn,this.markUsedJustification(x,pn.anchor,ae,ni))}}else{let Ut=(Qn,ni)=>{let pn=x.getSymbolInstanceTextSize(G,ae,this.transform.zoom,Ce),Be=this.collisionIndex.placeCollisionBox(x,pn,Qn,new i.P(0,0),te,N,I,q.predicate);return Be&&Be.box&&Be.box.length&&(this.markUsedOrientation(x,ni,ae),this.placedOrientations[$e]=ni),Be};on(()=>Ut(kn,i.aE.horizontal),()=>{let Qn=Me.verticalTextBox;return x.allowVerticalPlacement&&Ge>0&&Qn?(cn(Qn),Ut(Qn,i.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Ln(!!(at&&at.box&&at.box.length))}}if(He=at,Ve=He&&He.box&&He.box.length>0,Re=He&&He.offscreen,Ne=He&&He.occluded,ae.useRuntimeCollisionCircles){let Ln=x.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex>=0?ae.centerJustifiedTextSymbolIndex:ae.verticalPlacedTextSymbolIndex),on=i.aF(x.textSizeData,G,Ln),Ut=T.get("text-padding");st=this.collisionIndex.placeCollisionCircles(x,te,Ln,x.lineVertexArray,x.glyphOffsetArray,on,I,M,P,g,ce,q.predicate,ae.collisionCircleDiameter*on/i.bN,Ut,this.retainedQueryData[x.bucketInstanceId].tileID),Ve=te||st.circles.length>0&&!st.collisionDetected,Re=Re&&st.offscreen,Ne=st.occluded}if(Me.iconFeatureIndex&&(fn=Me.iconFeatureIndex),Me.iconBox){let Ln=on=>{cn(on);let Ut=ae.hasIconTextFit&&ct?Yu(ct.x,ct.y,ue,ce,this.transform.angle):new i.P(0,0),Qn=x.getSymbolInstanceIconSize(H,this.transform.zoom,ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Qn,on,Ut,ne,N,I,q.predicate)};je&&je.box&&je.box.length&&Me.verticalIconBox?(pt=Ln(Me.verticalIconBox),xe=pt.box.length>0):(pt=Ln(Me.iconBox),xe=pt.box.length>0),Re=Re&&pt.offscreen,ot=pt.occluded}let jt=W||ae.numHorizontalGlyphVertices===0&&Ge===0,Mn=ee||ae.numIconVertices===0;if(jt||Mn?Mn?jt||(xe=xe&&Ve):Ve=xe&&Ve:xe=Ve=xe&&Ve,Ve&&He&&He.box&&this.collisionIndex.insertCollisionBox(He.box,T.get("text-ignore-placement"),x.bucketInstanceId,je&&je.box&&Ht?Ht:Ot,q.ID),xe&&pt&&this.collisionIndex.insertCollisionBox(pt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,fn,q.ID),st&&(Ve&&this.collisionIndex.insertCollisionCircles(st.circles,T.get("text-ignore-placement"),x.bucketInstanceId,Ot,q.ID),g)){let Ln=x.bucketInstanceId,on=this.collisionCircleArrays[Ln];on===void 0&&(on=this.collisionCircleArrays[Ln]=new jy);for(let Ut=0;Ut<st.circles.length;Ut+=4)on.circles.push(st.circles[Ut+0]),on.circles.push(st.circles[Ut+1]),on.circles.push(st.circles[Ut+2]),on.circles.push(st.collisionDetected?1:0)}let qn=x.projection.name!=="globe";re=re&&(qn||!Ne),ge=ge&&(qn||!ot),this.placements[$e]=new Vd(Ve||re,xe||ge,Re||x.justReloaded),h.add($e)};if(ie&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),J){let ae=x.getSortedSymbolIndexes(this.transform.angle);for(let Ce=ae.length-1;Ce>=0;--Ce){let Me=ae[Ce];Ie(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}x.hasAnyZOffset&&i.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let ae=x.getSortedIndexesByZOffset();for(let Ce=0;Ce<ae.length;++Ce){let Me=ae[Ce];Ie(x.symbolInstances.get(Me),Me,x.collisionArrays[Me])}}else for(let ae=s.symbolInstanceStart;ae<s.symbolInstanceEnd;ae++)Ie(x.symbolInstances.get(ae),ae,x.collisionArrays[ae]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let ae=this.collisionCircleArrays[x.bucketInstanceId];i.ad.invert(ae.invProjMatrix,I),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,h,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:M,crossTileID:P}=g,O=i.cJ(h),N=v===i.aE.vertical?M:O==="left"?x:O==="center"?T:O==="right"?I:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=N>=0&&x!==N?0:P),T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=N>=0&&T!==N?0:P),I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=N>=0&&I!==N?0:P),M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:P)}markUsedOrientation(s,h,g){let v=h===i.aE.horizontal||h===i.aE.horizontalOnly?h:0,x=h===i.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P}=g,O=s.text.placedSymbolArray;T>=0&&(O.get(T).placedOrientation=v),I>=0&&(O.get(I).placedOrientation=v),M>=0&&(O.get(M).placedOrientation=v),P>=0&&(O.get(P).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(s):1,x=h?h.opacities:{},T=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(let M in this.placements){let P=this.placements[M],O=x[M];O?(this.opacities[M]=new oa(O,v,P.text,P.icon,null,P.clipped),g=g||P.text!==O.text.placed||P.icon!==O.icon.placed):(this.opacities[M]=new oa(null,v,P.text,P.icon,P.skipFade,P.clipped),g=g||P.text||P.icon)}for(let M in x){let P=x[M];if(!this.opacities[M]){let O=new oa(P,v,!1,!1);O.isHidden()||(this.opacities[M]=O,g=g||P.text.placed||P.icon.placed)}}for(let M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(let M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h,g,v){let x=new Set;for(let T of h){let I=T.getBucket(s);I&&T.latestFeatureIndex&&s.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,x,T.collisionBoxArray,g,v,T.tileID),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,T.tileID),I.updateZOffset()))}}updateBucketOpacities(s,h,g,v,x,T){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();let I=s.layers[0].layout,M=!!s.layers[0].dynamicFilter(),P=new oa(null,0,!1,!1,!0),O=I.get("text-allow-overlap"),N=I.get("icon-allow-overlap"),B=I.get("text-variable-anchor"),V=I.get("text-rotation-alignment")==="map",G=I.get("text-pitch-alignment")==="map",H=new oa(null,0,O&&(N||!s.hasIconData()||I.get("icon-optional")),N&&(O||!s.hasTextData()||I.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);let q=(ee,te,ne)=>{for(let ue=0;ue<te/4;ue++)ee.opacityVertexArray.emplaceBack(ne)},W=0;x&&s.updateReplacement(T,x);for(let ee=0;ee<s.symbolInstances.length;ee++){let te=s.symbolInstances.get(ee),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ue,crossTileID:ce,numIconVertices:J,tileAnchorX:ie,tileAnchorY:re}=te,ge=h.has(ce),Ie=this.opacities[ce];ge?Ie=P:Ie||(Ie=H,this.opacities[ce]=Ie),h.add(ce);let ae=ne>0||ue>0,Ce=J>0,Me=this.placedOrientations[ce],$e=Me===i.aE.vertical,Ge=Me===i.aE.horizontal||Me===i.aE.horizontalOnly;!ae&&!Ce||Ie.isHidden()||W++;let Ve=!1;if((ae||Ce)&&x)for(let xe of s.activeReplacements){if(xe.order<v||xe.order===1/0||!(xe.clipMask&i.cu.Symbol)||xe.min.x>ie||ie>xe.max.x||xe.min.y>re||re>xe.max.y)continue;let Re=i.cH(ie,re,T.canonical,xe.footprintTileId.canonical);if(Ve=i.cI(Re,xe),Ve)break}if(ae){let xe=Ve?sa:ts(Ie.text);q(s.text,ne,$e?sa:xe),q(s.text,ue,Ge?sa:xe);let Re=Ie.text.isHidden(),{leftJustifiedTextSymbolIndex:Ne,centerJustifiedTextSymbolIndex:ot,rightJustifiedTextSymbolIndex:ct,verticalPlacedTextSymbolIndex:at}=te,je=s.text.placedSymbolArray,He=Re||$e?1:0;Ne>=0&&(je.get(Ne).hidden=He),ot>=0&&(je.get(ot).hidden=He),ct>=0&&(je.get(ct).hidden=He),at>=0&&(je.get(at).hidden=Re||Ge?1:0);let st=this.variableOffsets[ce];st&&this.markUsedJustification(s,st.anchor,te,Me);let pt=this.placedOrientations[ce];pt&&(this.markUsedJustification(s,"left",te,pt),this.markUsedOrientation(s,pt,te))}if(Ce){let xe=Ve?sa:ts(Ie.icon),{placedIconSymbolIndex:Re,verticalPlacedIconSymbolIndex:Ne}=te,ot=s.icon.placedSymbolArray,ct=Ie.icon.isHidden()?1:0;Re>=0&&(q(s.icon,J,$e?sa:xe),ot.get(Re).hidden=ct),Ne>=0&&(q(s.icon,te.numVerticalIconVertices,Ge?sa:xe),ot.get(Ne).hidden=ct)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){let xe=s.collisionArrays[ee];if(xe){let Re=new i.P(0,0),Ne=!0;if(xe.textBox||xe.verticalTextBox){if(B){let ct=this.variableOffsets[ce];ct?(Re=Im(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textScale),V&&Re._rotate(G?this.transform.angle:-this.transform.angle)):Ne=!1}M&&(Ne=!Ie.clipped),xe.textBox&&Xu(s.textCollisionBox.collisionVertexArray,Ie.text.placed,!Ne||$e,Re.x,Re.y),xe.verticalTextBox&&Xu(s.textCollisionBox.collisionVertexArray,Ie.text.placed,!Ne||Ge,Re.x,Re.y)}let ot=Ne&&!!(!Ge&&xe.verticalIconBox);xe.iconBox&&Xu(s.iconCollisionBox.collisionVertexArray,Ie.icon.placed,ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0),xe.verticalIconBox&&Xu(s.iconCollisionBox.collisionVertexArray,Ie.icon.placed,!ot,te.hasIconTextFit?Re.x:0,te.hasIconTextFit?Re.y:0)}}}if(s.fullyClipped=W===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){let ee=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ee.invProjMatrix,s.placementViewportMatrix=ee.viewportMatrix,s.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){let g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Xu(m,s,h,g,v){m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0),m.emplaceBack(s?1:0,h?1:0,g||0,v||0)}let Cm=Math.pow(2,25),rt=Math.pow(2,24),Uy=Math.pow(2,17),Sm=Math.pow(2,16),Dm=Math.pow(2,9),$y=Math.pow(2,8),jd=Math.pow(2,1);function ts(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*Cm+s*rt+h*Uy+s*Sm+h*Dm+s*$y+h*jd+s}let sa=0;class Ka{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,g,v,x){let T=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(T,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((I,M)=>I.sortKey-M.sortKey));this._currentPartIndex<T.length;){let I=T[this._currentPartIndex];if(h.placeLayerBucketPart(I,this._seenCrossTileIDs,g,I.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Ud{constructor(s,h,g,v,x,T,I,M,P){this.placement=new _o(s,x,T,I,M,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g,v){let x=i.e.now(),T=()=>{let I=i.e.now()-x;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){let I=h[s[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=M)&&(!I.maxzoom||I.maxzoom>M)){let P=I,O=P.layout.get("symbol-z-elevate"),N=this._inProgressLayer=this._inProgressLayer||new Ka(P),B=i.al(I.source,I.scope);if(N.continuePlacement(O?v[B]:g[B],this.placement,this._showCollisionBoxes,I,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}let aa=512/i.a3/2;class z1{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this.index=new i.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=s.canonical.x*i.a3,x=s.canonical.y*i.a3;for(let T=0;T<h.length;T++){let{key:I,crossTileID:M,tileAnchorX:P,tileAnchorY:O}=h.get(T),N=Math.floor((v+P)*aa),B=Math.floor((x+O)*aa);this.index.add(N,B),this.keys.push(I),this.crossTileIDs.push(M)}this.index.finish()}findMatches(s,h,g){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=aa/Math.pow(2,h.canonical.z-this.tileID.canonical.z),T=h.canonical.x*i.a3,I=h.canonical.y*i.a3;for(let M=0;M<s.length;M++){let P=s.get(M);if(P.crossTileID)continue;let{key:O,tileAnchorX:N,tileAnchorY:B}=P,V=Math.floor((T+N)*x),G=Math.floor((I+B)*x),H=this.index.range(V-v,G-v,V+v,G+v);for(let q of H){let W=this.crossTileIDs[q];if(this.keys[q]===O&&!g.has(W)){g.add(W),P.crossTileID=W;break}}}}}class B1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Mm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){let h=Math.round((s-this.lng)/360);if(h!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let T in v){let I=v[T];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),x[I.tileID.key]=I}this.indexes[g]=x}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);let v=this.usedCrossTileIDs[s.overscaledZ];for(let x in this.indexes){let T=this.indexes[x];if(Number(x)>s.overscaledZ)for(let I in T){let M=T[I];M.tileID.isChildOf(s)&&M.findMatches(h.symbolInstances,s,v)}else{let I=T[s.scaledTo(Number(x)).key];I&&I.findMatches(h.symbolInstances,s,v)}}for(let x=0;x<h.symbolInstances.length;x++){let T=h.symbolInstances.get(x);T.crossTileID||(T.crossTileID=g.generate(),v.add(T.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new z1(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(let g of h.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let h=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)s[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],h=!0)}return h}}class V1{constructor(){this.layerIndexes={},this.crossTileIDs=new B1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,v){let x=this.layerIndexes[s.fqid];x===void 0&&(x=this.layerIndexes[s.fqid]=new Mm);let T=!1,I={};v.name!=="globe"&&x.handleWrapJump(g);for(let M of h){let P=M.getBucket(s);P&&s.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,P,this.crossTileIDs)&&(T=!0),I[P.bucketInstanceId]=!0)}return x.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(s){let h={};s.forEach(g=>{h[g]=!0});for(let g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}let Gy=new i.N({data:new i.O(i.L.colorTheme.data)}),la=(m,s)=>$t(m,s&&s.filter(h=>h.identifier!=="source.canvas")),Am=i.ah(yn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),j1=i.ah(yn,["setCenter","setZoom","setBearing","setPitch"]),Hy={version:8,layers:[],sources:{}},qy={duration:300,delay:0};class Oo extends i.E{constructor(s,h={}){super(),this.map=s,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=i.W({},qy),this._buildingIndex=new L1(this),this.crossTileSymbolIndex=new V1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new tn,this.dispatcher=h.dispatcher?h.dispatcher:new i.bw(i.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new xu,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new i.cM(s._requestManager,h.localFontFamily?i.cN.all:h.localIdeographFontFamily?i.cN.ideographs:i.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new pd(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",i.cO());let g=this;this._rtlTextPluginCallback=Oo.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,T)=>{if(i.cP(x),T&&T.every(I=>I))for(let I in g._sourceCaches){let M=g._sourceCaches[I],P=M.getSource().type;P!=="vector"&&P!=="geojson"||M.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let T in this._layers){let I=this._layers[T];I.source===x.id&&this._validateLayer(I)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(i.cQ(s))return s;let h=i.cR(s);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${i.cS(JSON.stringify(s))}`}_diffStyle(s,h,g){this.globalId=this._getGlobalId(s);let v=(x,T)=>{try{T(null,this.setState(x,g))}catch(I){T(I,!1)}};if(typeof s=="string"){let x=this.map._requestManager.normalizeStyleURL(s),T=this.map._requestManager.transformRequest(x,i.R.Style);i.g(T,(I,M)=>{I?this.fire(new i.d(I)):M&&v(M,h)})}else typeof s=="object"&&v(s,h)}loadURL(s,h={}){this.fire(new i.f("dataloading",{dataType:"style"}));let g=typeof h.validate=="boolean"?h.validate:!i.cQ(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,h.accessToken),this.resolvedImports.add(s);let v=this.importsCache.get(s);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(s,i.R.Style);this._request=i.g(x,(T,I)=>{if(this._request=null,T)this.fire(new i.d(T));else if(I)return this.importsCache.set(s,I),this._load(I,g)})}loadJSON(s,h={}){this.fire(new i.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=i.e.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new i.f("dataloading",{dataType:"style"})),this._load(Hy,!1)}_loadImports(s,h,g){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of s){let T=this._createFragmentStyle(x),I=new Promise(O=>{T.once("style.import.load",O),T.once("error",O)}).then(()=>this.mergeAll());if(v.push(I),this.resolvedImports.has(x.url)){T.loadEmpty();continue}let M=x.data||this.importsCache.get(x.url);M?(T.loadJSON(M,{validate:h}),this._isInternalStyle(M)&&(T.globalId=null)):x.url?T.loadURL(x.url,{validate:h}):T.loadEmpty();let P={style:T,id:x.id,config:x.config};if(g){let O=this.fragments.findIndex(({id:N})=>N===g);this.fragments=this.fragments.slice(0,O).concat(P).concat(this.fragments.slice(O))}else this.fragments.push(P)}return Promise.allSettled(v)}getImportGlobalIds(s=this,h=new Set){for(let g of s.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(s){let h=this.scope?i.al(s.id,this.scope):s.id,g,v=this._initialConfig&&this._initialConfig[h];(s.config||v)&&(g=i.W({},s.config,v));let x=new Oo(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,h){let g=s.schema;if(this._isInternalStyle(s)){let T=i.W({},Hy,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(T,h)}if(this.updateConfig(this._config,g),h&&la(this,de(s)))return;this._loaded=!0,this.stylesheet=i.cT(s);let v=()=>{for(let P in s.sources)this.addSource(P,s.sources[P],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);let T=Tm(this.stylesheet.layers);if(this._order=T.map(P=>P.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let P=this.stylesheet.lights[0];this.light=new mt(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new mt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let P of T){let O=i.cY(P,this.scope,this._styleColorTheme.lut,this.options);O.isConfigDependent&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O,this._serializedLayers[O.id]=O.serialize();let N=this.getOwnLayerSourceCache(O),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&O.canCastShadows()&&B&&(N.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.f("data",{dataType:"style"}));let M=this.isRootStyle();s.imports?this._loadImports(s.imports,h).then(()=>{this._reloadImports(),this.fire(new i.f(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.f(M?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let T=this._evaluateColorThemeData(x);this._loadColorTheme(T).then(()=>{v()}).catch(I=>{i.w(`Couldn't load color theme from the stylesheet: ${I}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,h,g,v,x,T,I,M,P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(s=O.light),O.stylesheet.lights)for(let N of O.stylesheet.lights)N.type==="ambient"&&O.ambientLight!=null&&(h=O.ambientLight),N.type==="directional"&&O.directionalLight!=null&&(g=O.directionalLight);v=this._prioritizeTerrain(v,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(x=O.fog),O.stylesheet.camera!=null&&(M=O.stylesheet.camera),O.stylesheet.projection!=null&&(T=O.stylesheet.projection),O.stylesheet.transition!=null&&(I=O.stylesheet.transition),P[O.scope]=O._styleColorTheme}}),this.light=s,this.ambientLight=h,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=P,v===null?delete this.terrain:this.terrain=v,this.camera=M||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=i.W({},qy,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){let h=g=>{for(let v of g.fragments)h(v.style);s(g)};h(this)}_prioritizeTerrain(s,h,g){let v=s&&s.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?s:null:h!=null&&(!s||v||h&&h.drapeRenderMode===1)?h:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{s=this._prioritizeTerrain(s,h.terrain,h.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(s=h.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){let s={},h={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let T=i.al(x,v.scope);s[T]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let T=i.al(x,v.scope);h[T]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let T=i.al(x,v.scope);g[T]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){let s={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(let I of T._order){let M=T._layers[I];if(M.type==="slot"){let P=i.cU(I);if(s[P])continue;s[P]=[]}M.slot&&s[M.slot]?s[M.slot].push(M):h.push(M)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(T=[])=>{for(let I of T)if(I.type==="slot"){let M=i.cU(I.id);s[M]&&x(s[M]),this._mergedSlots.push(M)}else{let M=i.al(I.id,I.scope);this._mergedOrder.push(M),g[M]=I,I.is3D()&&(this._has3DLayers=!0),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=i.W({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(h,g,v){let x=i.W({},g);for(let I of Object.keys(i.L.colorTheme))x[I]===void 0&&(x[I]=i.L.colorTheme[I].default);let T=new i.U(Gy,h,new Map(v));return T.setTransitionOrValue(x,v),T.untransitioned().possiblyEvaluate(new i.X(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){return this._styleColorTheme.lutLoading=!0,new Promise((h,g)=>{let v="data:image/png;base64,";if(s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();s.startsWith(v)||(s=v+s);let x="mapbox-reserved-lut",T=new Image;T.src=s,T.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},T.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:I,height:M,data:P}=i.e.getImageData(T);if(M>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(I!==M*M)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new i.i({width:I,height:M},P),pixelRatio:1,sdf:!1,version:0});let O=this.imageManager.getImage(x,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:s},h()):g(new Error("Missing LUT image."))}})}getLut(s){let h=this._styleColorThemeForScope[s];return h?h.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(h,g,v){let x,T,I,M=i.e.devicePixelRatio>1?"@2x":"",P=i.g(g.transformRequest(g.normalizeSpriteURL(h,M,".json"),i.R.SpriteJSON),(B,V)=>{P=null,I||(I=B,x=V,N())}),O=i.h(g.transformRequest(g.normalizeSpriteURL(h,M,".png"),i.R.SpriteImage),(B,V)=>{O=null,I||(I=B,T=V,N())});function N(){if(I)v(I);else if(x&&T){let B=i.e.getImageData(T),V={};for(let G in x){let{width:H,height:q,x:W,y:ee,sdf:te,pixelRatio:ne,stretchX:ue,stretchY:ce,content:J}=x[G],ie=new i.i({width:H,height:q});i.i.copy(B,ie,{x:W,y:ee},{x:0,y:0},{width:H,height:q},null),V[G]={data:ie,pixelRatio:ne,sdf:te,stretchX:ue,stretchY:ce,content:J}}v(null,V)}}return{cancel(){P&&(P.cancel(),P=null),O&&(O.cancel(),O=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new i.d(h));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.f("data",{dataType:"style"}))})}_validateLayer(s){let h=this.getOwnSource(s.source);if(!h)return;let g=s.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new i.d(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,h)=>{let g=this.fragments[h];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){let s={};for(let h in this._sourceCaches){let g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){let h=[];for(let g of s){let v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(let s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){let h=this.getOwnLayer(s);if(h)return h;this.fire(new i.d(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){let h=this.getOwnSource(s);if(h)return h;this.fire(new i.d(new Error(`The source '${s}' does not exist in the map's style.`)))}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);let h=this.calculateLightsBrightness();s.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let T=this._changes.getLayerUpdatesByScope();for(let I in T){let{updatedIds:M,removedIds:P}=T[I];(M||P)&&(this._updateWorkerLayers(I,M,P),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}let x={};for(let T in this._mergedSourceCaches){let I=this._mergedSourceCaches[T];x[T]=I.used,I.used=!1,I.tileCoverLift=0}for(let T of this._mergedOrder){let I=this._mergedLayers[T];if(I.recalculate(s,this._availableImages),!I.isHidden(s.zoom)){let M=this.getLayerSourceCache(I);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,I.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let M=I.minzoom||0;M<(I.maxzoom||25.5);M++){let P=this.map.painter;if(P){let O=I.getProgramIds();if(!O)continue;for(let N of O){let B=I.getDefaultProgramParams(N,s.zoom,this._styleColorTheme.lut);B&&(P.style=this,this.fog&&(P._fogVisible=!0,B.overrideFog=!0,P.getOrCreateProgram(N,B)),P._fogVisible=!1,B.overrideFog=!1,P.getOrCreateProgram(N,B),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(B.overrideRtt=!0,P.getOrCreateProgram(N,B)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let T in x){let I=this._mergedSourceCaches[T];x[T]!==I.used&&I.getSource().fire(new i.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new i.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let s=this._changes.getUpdatedImages();if(s.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,h,g){let v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:s,removedIds:g||[],options:v.options})}setState(s,h){if(this._checkLoaded(),la(this,de(s)))return!1;(s=i.cT(s)).layers=Tm(s.layers);let g=function(T,I){if(!T)return[{command:yn.setStyle,args:[I]}];let M=[];try{if(!w(T.version,I.version))return[{command:yn.setStyle,args:[I]}];if(w(T.center,I.center)||M.push({command:yn.setCenter,args:[I.center]}),w(T.zoom,I.zoom)||M.push({command:yn.setZoom,args:[I.zoom]}),w(T.bearing,I.bearing)||M.push({command:yn.setBearing,args:[I.bearing]}),w(T.pitch,I.pitch)||M.push({command:yn.setPitch,args:[I.pitch]}),w(T.sprite,I.sprite)||M.push({command:yn.setSprite,args:[I.sprite]}),w(T.glyphs,I.glyphs)||M.push({command:yn.setGlyphs,args:[I.glyphs]}),w(T.imports,I.imports)||function(V=[],G=[],H){G=G||[];let q=(V=V||[]).map(Bd),W=G.map(Bd),ee=V.reduce(ac,{}),te=G.reduce(ac,{}),ne=q.slice(),ue,ce,J,ie;for(ue=0,ce=0;ue<q.length;ue++)J=q[ue],te.hasOwnProperty(J)?ce++:(H.push({command:yn.removeImport,args:[J]}),ne.splice(ne.indexOf(J,ce),1));for(ue=0,ce=0;ue<W.length;ue++)J=W[W.length-1-ue],ne[ne.length-1-ue]!==J&&(ee.hasOwnProperty(J)?(H.push({command:yn.removeImport,args:[J]}),ne.splice(ne.lastIndexOf(J,ne.length-ce),1)):ce++,ie=ne[ne.length-ue],H.push({command:yn.addImport,args:[te[J],ie]}),ne.splice(ne.length-ue,0,J));for(let re of G){let ge=ee[re.id];ge&&!w(ge,re)&&H.push({command:yn.updateImport,args:[re.id,re]})}}(T.imports,I.imports,M),w(T.transition,I.transition)||M.push({command:yn.setTransition,args:[I.transition]}),w(T.light,I.light)||M.push({command:yn.setLight,args:[I.light]}),w(T.fog,I.fog)||M.push({command:yn.setFog,args:[I.fog]}),w(T.projection,I.projection)||M.push({command:yn.setProjection,args:[I.projection]}),w(T.lights,I.lights)||M.push({command:yn.setLights,args:[I.lights]}),w(T.camera,I.camera)||M.push({command:yn.setCamera,args:[I.camera]}),!w(T["color-theme"],I["color-theme"]))return[{command:yn.setStyle,args:[I]}];let P={},O=[];(function(V,G,H,q){let W;for(W in G=G||{},V=V||{})V.hasOwnProperty(W)&&(G.hasOwnProperty(W)||zy(W,H,q));for(W in G){if(!G.hasOwnProperty(W))continue;let ee=G[W];V.hasOwnProperty(W)?w(V[W],ee)||(V[W].type==="geojson"&&ee.type==="geojson"&&N1(V,G,W)?H.push({command:yn.setGeoJSONSourceData,args:[W,ee.data]}):F1(W,G,H,q)):bs(W,G,H)}})(T.sources,I.sources,O,P);let N=[];T.layers&&T.layers.forEach(V=>{V.source&&P[V.source]?M.push({command:yn.removeLayer,args:[V.id]}):N.push(V)});let B=T.terrain;B&&P[B.source]&&(M.push({command:yn.setTerrain,args:[void 0]}),B=void 0),M=M.concat(O),w(B,I.terrain)||M.push({command:yn.setTerrain,args:[I.terrain]}),function(V,G,H){G=G||[];let q=(V=V||[]).map(Bd),W=G.map(Bd),ee=V.reduce(ac,{}),te=G.reduce(ac,{}),ne=q.slice(),ue=Object.create(null),ce,J,ie,re,ge,Ie,ae;for(ce=0,J=0;ce<q.length;ce++)ie=q[ce],te.hasOwnProperty(ie)?J++:(H.push({command:yn.removeLayer,args:[ie]}),ne.splice(ne.indexOf(ie,J),1));for(ce=0,J=0;ce<W.length;ce++)ie=W[W.length-1-ce],ne[ne.length-1-ce]!==ie&&(ee.hasOwnProperty(ie)?(H.push({command:yn.removeLayer,args:[ie]}),ne.splice(ne.lastIndexOf(ie,ne.length-J),1)):J++,Ie=ne[ne.length-ce],H.push({command:yn.addLayer,args:[te[ie],Ie]}),ne.splice(ne.length-ce,0,ie),ue[ie]=!0);for(ce=0;ce<W.length;ce++)if(ie=W[ce],re=ee[ie],ge=te[ie],!ue[ie]&&!w(re,ge))if(w(re.source,ge.source)&&w(re["source-layer"],ge["source-layer"])&&w(re.type,ge.type)){for(ae in qu(re.layout,ge.layout,H,ie,null,yn.setLayoutProperty),qu(re.paint,ge.paint,H,ie,null,yn.setPaintProperty),w(re.slot,ge.slot)||H.push({command:yn.setSlot,args:[ie,ge.slot]}),w(re.filter,ge.filter)||H.push({command:yn.setFilter,args:[ie,ge.filter]}),w(re.minzoom,ge.minzoom)&&w(re.maxzoom,ge.maxzoom)||H.push({command:yn.setLayerZoomRange,args:[ie,ge.minzoom,ge.maxzoom]}),re)re.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?qu(re[ae],ge[ae],H,ie,ae.slice(6),yn.setPaintProperty):w(re[ae],ge[ae])||H.push({command:yn.setLayerProperty,args:[ie,ae,ge[ae]]}));for(ae in ge)ge.hasOwnProperty(ae)&&!re.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&ae!=="slot"&&(ae.indexOf("paint.")===0?qu(re[ae],ge[ae],H,ie,ae.slice(6),yn.setPaintProperty):w(re[ae],ge[ae])||H.push({command:yn.setLayerProperty,args:[ie,ae,ge[ae]]}))}else H.push({command:yn.removeLayer,args:[ie]}),Ie=ne[ne.lastIndexOf(ie)+1],H.push({command:yn.addLayer,args:[ge,Ie]})}(N,I.layers,M)}catch(P){console.warn("Unable to compute style diff:",P),M=[{command:yn.setStyle,args:[I]}]}return M}(this.serialize(),s).filter(T=>!(T.command in j1));if(g.length===0)return!1;let v=g.filter(T=>!(T.command in Am));if(v.length>0)throw new Error(`Unimplemented: ${v.map(T=>T.command).join(", ")}.`);let x=[];return g.forEach(T=>{x.push(this[T.command].apply(this,T.args))}),h&&Promise.all(x).then(h),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,h){return this.getImage(s)?this.fire(new i.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,this.scope,h)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new i.d(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,h,g={}){return this._checkLoaded(),this._validate(Qt,`models.${s}`,h,null,g)||(this.modelManager.addModel(s,h,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new i.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,h,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(pe,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=Sd(s,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=T=>{let I=(T?"symbol:":"other:")+v.id,M=i.al(I,this.scope),P=this._sourceCaches[I]=new i.bv(M,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=P,P.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();let h=this.getOwnSource(s);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===s)return this.fire(new i.d(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new i.d(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(s);for(let v of g){let x=i.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new i.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getOwnSource(s).setData(h),this._changes.setDirty()}getOwnSource(s){let h=this.getOwnSourceCache(s);return h&&h.getSource()}getOwnSources(){let s=[];for(let h in this._otherSourceCaches){let g=this.getOwnSourceCache(h);g&&s.push(g.getSource())}return s}areTilesLoaded(){let s=this._mergedSourceCaches;for(let h in s){let g=s[h]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let v of s){if(this._validate(Ae,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(h)}else this.ambientLight=new Tu(v,Yt,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(h)}else this.directionalLight=new Tu(v,zp,this.scope,this.options)}}let g=new i.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let s=this.directionalLight,h=this.ambientLight;if(!s||!h)return;let g=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),x=s.properties.get("intensity"),T=s.properties.get("direction"),I=1-i.ac(T.x,T.y,T.z)[2]/90,M=g(v)*x*I,P=h.properties.get("color").toRenderColor(null).toArray01(),O=h.properties.get("intensity");return(M+g(P)*O)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(i.cV(s)){let h=i.cW(s),g=this.fragments.find(({id:x})=>x===h);if(!g)throw new Error(`Style import not found: ${s}`);let v=i.cU(s);return g.style.getFragmentStyle(v)}{let h=this.fragments.find(({id:g})=>g===s);if(!h)throw new Error(`Style import not found: ${s}`);return h.style}}getConfigProperty(s,h){let g=this.getFragmentStyle(s);if(!g)return null;let v=i.al(h,g.scope),x=g.options.get(v),T=x?x.value||x.default:null;return T?T.serialize():null}setConfigProperty(s,h,g){let v=this.getFragmentStyle(s);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[h])return;let T=i.y(g);if(T.result!=="success")return void la(this,T.value);let I=T.value.expression,M=i.al(h,v.scope),P=v.options.get(M);if(!P)return;let O,{minValue:N,maxValue:B,stepValue:V,type:G,values:H}=x[h],q=i.y(x[h].default);q.result==="success"&&(O=q.value.expression),O?(this.options.set(M,oi(gt({},P),{value:I,default:O,minValue:N,maxValue:B,stepValue:V,type:G,values:H})),this.updateConfigDependencies()):this.fire(new i.d(new Error(`No schema defined for the config option "${h}" in the "${s}" fragment.`)))}getConfig(s){let h=this.getFragmentStyle(s);if(!h)return null;let g=h.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let T=i.al(x,h.scope),I=h.options.get(T),M=I?I.value||I.default:null;v[x]=M?M.serialize():null}return v}setConfig(s,h){let g=this.getFragmentStyle(s);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){let h=this.getFragmentStyle(s);return h?h.stylesheet.schema:null}setSchema(s,h){let g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(s,h){if(this._config=s,s||h)if(h)for(let g in h){let v,x,T=i.y(h[g].default);if(T.result==="success"&&(v=T.value.expression),s&&s[g]!==void 0){let B=i.y(s[g]);B.result==="success"&&(x=B.value.expression)}let{minValue:I,maxValue:M,stepValue:P,type:O,values:N}=h[g];if(v){let B=i.al(g,this.scope);this.options.set(B,{default:v,value:x,minValue:I,maxValue:M,stepValue:P,type:O,values:N})}else this.fire(new i.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new i.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let s of this._configDependentLayers){let h=this.getLayer(s);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){let h=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut||s._styleColorTheme.lut&&h!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(s,h,g={}){this._checkLoaded();let v=s.id;if(this._layers[v])return void this.fire(new i.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(s.type==="custom"){if(la(this,i.cX(s)))return;x=i.cY(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=i.cT(s),s=i.W(s,{source:v})),this._validate(it,`layers.${v}`,s,{arrayIndex:-1},g))return;x=i.cY(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let T=this._order.length;if(h){let O=this._order.indexOf(h);if(O===-1)return void this.fire(new i.d(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?T=O:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let I=this.getOwnLayerSourceCache(x),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&x.canCastShadows()&&M&&(I.castsShadows=!0);let P=this._changes.getRemovedLayer(x);if(P&&x.source&&I&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let O=i.al(x.source,x.scope);P.type!==x.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),I.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,h){this._checkLoaded();let g=this._checkLayer(s);if(!g||s===h)return;let v=this._order.indexOf(s);this._order.splice(v,1);let x=this._order.length;if(h){let T=this._order.indexOf(h);if(T===-1)return void this.fire(new i.d(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?x=T:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();let h=this._checkLayer(s);if(!h)return;h.setEventedParent(null);let g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],delete this._serializedLayers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let x=!1;for(let T in this._layers)if(this._layers[T].source===h.source&&this._layers[T].canCastShadows()){x=!0;break}v.castsShadows=x}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(let h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();let v=this._checkLayer(s);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,h){this._checkLoaded();let g=this._checkLayer(s);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(s,h,g={}){this._checkLoaded();let v=this._checkLayer(s);if(v&&!w(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Qe,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=i.cT(h),this._updateLayer(v)))}getFilter(s){let h=this._checkLayer(s);if(h)return i.cT(h.filter)}setLayoutProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(x&&!w(x.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&la(x,Mt.call(de,{key:`layers.${s}.layout.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:i.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(h,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,h){let g=this._checkLayer(s);if(g)return g.getLayoutProperty(h)}setPaintProperty(s,h,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(!x||w(x.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&la(x,yt.call(de,{key:`layers.${s}.paint.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:i.L})))return;let T=x.setPaintProperty(h,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),T&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,h){let g=this._checkLayer(s);if(g)return g.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();let g=s.source,v=s.sourceLayer,x=this._checkSource(g);if(!x)return;let T=x.type;if(T==="geojson"&&v)return void this.fire(new i.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new i.d(new Error("The feature id parameter must be provided.")));let I=this.getOwnSourceCaches(g);for(let M of I)M.setFeatureState(v,s.id,h)}removeFeatureState(s,h){this._checkLoaded();let g=s.source,v=this._checkSource(g);if(!v)return;let x=v.type,T=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new i.d(new Error("A feature id is required to remove its specific state property.")));let I=this.getOwnSourceCaches(g);for(let M of I)M.removeFeatureState(T,s.id,h)}getFeatureState(s){this._checkLoaded();let h=s.source,g=s.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return s.id===void 0&&this.fire(new i.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=i.W({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return i.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let s=this.getTerrain(),h=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return i.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(s){this._changes.updateLayer(s);let h=this.getLayerSourceCache(s),g=i.al(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){let h=I=>this._mergedLayers[I].type==="fill-extrusion"||this._mergedLayers[I].type==="model",g=this.order,v={},x=[];for(let I=g.length-1;I>=0;I--){let M=g[I];if(h(M)){v[M]=I;for(let P of s){let O=P[M];if(O)for(let N of O)x.push(N)}}}x.sort((I,M)=>M.intersectionZ-I.intersectionZ);let T=[];for(let I=g.length-1;I>=0;I--){let M=g[I];if(h(M))for(let P=x.length-1;P>=0;P--){let O=x[P].feature;if(O.layer&&v[O.layer.id]<I)break;T.push(O),x.pop()}else for(let P of s){let O=P[M];if(O)for(let N of O)T.push(N.feature)}}return T}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(Qe,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.d(new Error("parameters.layers must be an Array."))),[];for(let P of h.layers){let O=this._mergedLayers[P];if(!O)return this.fire(new i.d(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}let x=[],T=h.serializedLayers||{},I=h&&h.layers?h.layers.some(P=>{let O=this.getLayer(P);return O&&O.is3D()}):this.has3DLayers(),M=Cr.createFromScreenPoints(s,g);for(let P in this._mergedSourceCaches){let O=this._mergedSourceCaches[P].getSource();if(!O||O.scope!==h.scope)continue;let N=this._mergedSourceCaches[P].getSource().id;h.layers&&!v[N]||x.push(O1(this._mergedSourceCaches[P],this._mergedLayers,T,M,h,g,I,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,O,N,B,V,G,H){let q={},W=G.queryRenderedSymbols(B),ee=[];for(let te of Object.keys(W).map(Number))ee.push(H[te]);ee.sort(oc);for(let te of ee){let ne=te.featureIndex.lookupSymbolFeatures(W[te.bucketInstanceId],O,te.bucketIndex,te.sourceLayerIndex,V.filter,V.layers,V.availableImages,P);for(let ue in ne){let ce=q[ue]=q[ue]||[],J=ne[ue];J.sort((ie,re)=>{let ge=te.featureSortOrder;if(ge){let Ie=ge.indexOf(ie.featureIndex);return ge.indexOf(re.featureIndex)-Ie}return re.featureIndex-ie.featureIndex});for(let ie of J)ce.push(ie)}}for(let te in q)q[te].forEach(ne=>{let ue=ne.feature,ce=N(P[te]);if(!ce)return;let J=ce.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=J});return q}(this._mergedLayers,T,this.getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,h){h&&h.filter&&this._validate(Qe,"querySourceFeatures.filter",h.filter,null,h);let g=this.getOwnSourceCaches(s),v=[];for(let x of g)v=v.concat(Hu(x,h));return v}addSourceType(s,h,g){return Oo.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Oo.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,h,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let I in s)if(!w(s[I],v[I])){x=!0;break}if(!x)return;let T=this._getTransitionParameters();this.light.setLight(s,h,g),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,h=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s,v=s.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let I="terrain-dem-src";this.addSource(I,g.source),g=i.cT(g),g=i.W(g,{source:I})}let x=i.W({},g),T={};if(this.terrain&&v){x.source=this.terrain.get().source;let I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(T.style=I.serialize())}if(this._validate(ve,"terrain",x,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new i.f("data",{dataType:"style"}))}else{let x=this.terrain,T=x.get();for(let I of Object.keys(i.L.terrain))!g.hasOwnProperty(I)&&i.L.terrain[I].default&&(g[I]=i.L.terrain[I].default);for(let I in s)if(!w(s[I],T[I])){x.set(s,this.options),this.stylesheet.terrain=s;let M=this._getTransitionParameters({duration:0});x.updateTransitions(M),this.fire(new i.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){let h=this.fog=new my(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!w(h.get(),s)){h.set(s,this.options),this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}setColorTheme(s){this._checkLoaded();let h=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=s,!s)return this._styleColorTheme.lut=null,void h();let g=this._evaluateColorThemeData(s);this._loadColorTheme(g).then(()=>{h()}).catch(v=>{i.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(s){return{now:i.e.now(),transition:i.W(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;let s=[],h=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?s.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){let g=this.terrain=new Nn(s,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let s in this._layers){let h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,g,v,x={}){if(x&&x.validate===!1)return!1;let T=i.W({},this.serialize());return la(this,s.call(de,i.W({key:h,style:T,value:g,styleSpec:i.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){let h=this.getSourceCaches(s);for(let g of h)g.clearTiles()}clearSources(){for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){let h=this.getSourceCaches(s);for(let g of h)g.resume(),g.reload()}reloadSources(){for(let s of this.getSources())s.reload&&s.reload()}updateSources(s){let h;this.directionalLight&&(h=Mu(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,h)}_generateCollisionBoxes(){for(let s in this._sourceCaches){let h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,g,v,x,T,I=!1){let M=!1,P=!1,O={},N={};for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=i.al(G.source,G.scope),q=O[H];if(!q){let ee=this.getLayerSourceCache(G);if(!ee)continue;let te=ee.getRenderableIds(!0).map(ne=>ee.getTileByID(ne));N[H]=te.slice(),q=O[H]=te.sort((ne,ue)=>ue.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ue.tileID)?-1:1))}let W=this.crossTileSymbolIndex.addLayer(G,q,h.center.lng,h.projection);M=M||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new i.f("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.e.now(),h.zoom))&&(this.pauseablePlacement=new Ud(h,this._mergedOrder,I,g,v,x,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.e.now()),P=!0),M&&this.pauseablePlacement.placement.setStale()),P||M){this._buildingIndex.onNewFrame(h.zoom);for(let V=0;V<this._mergedOrder.length;V++){let G=this._mergedLayers[this._mergedOrder[V]];if(G.type!=="symbol")continue;let H=this.isLayerClipped(G)&&this._clipLayerIndices.some(q=>V<q);this.placement.updateLayerOpacities(G,O[i.al(G.source,G.scope)],V,H?T:null)}}let B=!1;for(let V of this._mergedOrder){let G=this._mergedLayers[V];if(G.type!=="symbol")continue;let H=O[i.al(G.source,G.scope)];for(let q of H){let W=q.getBucket(G);W&&q.latestFeatureIndex&&G.fqid===W.layerIds[0]&&(B=W.updateOcclusionOpacities(s.context,s.symbolParams,s._dt)||B)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.e.now())||B,occlusionQueryBasedOpacityChanged:B}}_releaseSymbolFadeTiles(){for(let s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,h){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===s.id)!==-1)return void this.fire(new i.d(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!h)return g.push(s),this._loadImports([s],!0);let v=g.findIndex(({id:x})=>x===h);return v===-1&&this.fire(new i.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(s).concat(g.slice(v)),this._loadImports([s],!0,h)}updateImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);return v===-1?this:typeof h=="string"?(this.setImportUrl(s,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(s,h.url),w(h.config,g[v].config)||this.setImportConfig(s,h.config),w(h.data,g[v].data)||this.setImportData(s,h.data),this)}moveImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;let x=this.getImportIndex(h);if(x===-1)return this;let T=g[v],I=this.fragments[v];return g=g.filter(({id:M})=>M!==s),this.fragments=this.fragments.filter(({id:M})=>M!==s),this.stylesheet.imports=g.slice(0,x).concat(T).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(I).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;g[v].url=h;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(h),this}setImportData(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(s,v[g].url))}setImportConfig(s,h){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;let x=this.fragments[g],T=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=h,x.style.updateConfig(h,T),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){let h=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return h===-1&&this.fire(new i.d(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),h}getLayer(s){return this._mergedLayers[s]}getSources(){let s=[];for(let h in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[h];g&&s.push(g.getSource())}return s}getSource(s,h){let g=this.getSourceCache(s,h);return g&&g.getSource()}getLayerSource(s){let h=this.getLayerSourceCache(s);return h&&h.getSource()}getSourceCache(s,h){let g=i.al(s,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){let h=i.al(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[s]&&h.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&h.push(this._mergedSymbolSourceCaches[s]),h}updateSourceCaches(){let s=this._changes.getUpdatedSourceCaches();for(let h in s){let g=s[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(s){let h=this._changes.getUpdatedPaintProperties();for(let g of h){let v=this.getLayer(g);v&&v.updateTransitions(s)}}getImages(s,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(s,h,g){return i.c$(h,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){let h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){let h=this.getOwnSourceCaches(s);return h.length===0?(this.fire(new i.d(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,h){if(this._clipLayerIndices.length===0&&s.type!=="fill-extrusion")return!1;let g=s.type==="fill-extrusion"&&s.sourceLayer==="building",v=0;if(s.is3D()){if(g||h&&h.type==="batched-model")return!0;s.type==="model"&&(v=i.cu.Model)}else s.type==="symbol"&&(v=i.cu.Symbol);for(let x of this._clipLayerIndices){let T=this._mergedLayers[this._mergedOrder[x]];if(!T)continue;let I=[];for(let M of T.layout.get("clip-layer-types"))I.push(M==="model"?i.cu.Model:M==="symbol"?i.cu.Symbol:i.cu.FillExtrusion);for(let M of I)if(v&M)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Pm(m,s){let h=!1,g=null,v=()=>{g=null,h&&(m(),g=setTimeout(v,s),h=!1)};return()=>(h=!0,g||v(),g)}Oo.getSourceType=function(m){return rr[m]},Oo.setSourceType=function(m,s){rr[m]=s},Oo.registerForPluginStateChange=i.cL;class U1{constructor(s){this._hashName=s&&encodeURIComponent(s),i.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Pm(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let s=this._map;if(!s)return"";let h=Ku(s);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(T=>{let I=T.split("=")[0];return I===g?(v=!0,`${I}=${h}`):T}).filter(T=>T);return v||x.push(`${g}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let s=location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){let s=this._map;if(!s)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){let g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ku(m,s){let h=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),T=Math.round(h.lng*x)/x,I=Math.round(h.lat*x)/x,M=m.getBearing(),P=m.getPitch(),O=s?`/${T}/${I}/${g}`:`${g}/${I}/${T}`;return(M||P)&&(O+="/"+Math.round(10*M)/10),P&&(O+=`/${Math.round(P)}`),O}let $d={linearity:.3,easing:i.d0(0,0,.3,1)},Wy=i.W({deceleration:2500,maxSpeed:1400},$d),Rm=i.W({deceleration:20,maxSpeed:1400},$d),Gd=i.W({deceleration:1e3,maxSpeed:360},$d),km=i.W({deceleration:1e3,maxSpeed:90},$d);class Qa{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.e.now(),settings:s})}_drainInertiaBuffer(){let s=this._inertiaBuffer,h=i.e.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=Qu(h.pan.mag(),g,i.W({},Wy,s||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,lc(v,x)}if(h.zoom){let x=Qu(h.zoom,g,Rm);v.zoom=this._map.transform.zoom+x.amount,lc(v,x)}if(h.bearing){let x=Qu(h.bearing,g,Gd);v.bearing=this._map.transform.bearing+i.at(x.amount,-179,179),lc(v,x)}if(h.pitch){let x=Qu(h.pitch,g,km);v.pitch=this._map.transform.pitch+x.amount,lc(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function lc(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function Qu(m,s,h){let{maxSpeed:g,linearity:v,deceleration:x}=h,T=i.at(m*v/(s/1e3),-g,g),I=Math.abs(T)/(x*v);return{easing:h.easing,duration:1e3*I,amount:T*(I/2)}}class or extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,v={}){let x=ft(h.getCanvasContainer(),g),T=h.unproject(x);super(s,i.W({point:x,lngLat:T,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class ca extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){let v=s==="touchend"?g.changedTouches:g.touches,x=Ue(h.getCanvasContainer(),v),T=x.map(M=>h.unproject(M)),I=x.reduce((M,P,O,N)=>M.add(P.div(N.length)),new i.P(0,0));super(s,{points:x,point:I,lngLats:T,lngLat:h.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class Hd extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class Om{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Hd(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new or(s.type,this._map,s))}mouseup(s){this._map.fire(new or(s.type,this._map,s))}preclick(s){let h=i.W({},s);h.type="preclick",this._map.fire(new or(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new or(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new or(s.type,this._map,s))}mouseover(s){this._map.fire(new or(s.type,this._map,s))}mouseout(s){this._map.fire(new or(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ca(s.type,this._map,s))}touchmove(s){this._map.fire(new ca(s.type,this._map,s))}touchend(s){this._map.fire(new ca(s.type,this._map,s))}touchcancel(s){this._map.fire(new ca(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ju{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new or(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new or(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qd{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(Se(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;let g=h,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));let T=Math.min(v.x,g.x),I=Math.max(v.x,g.x),M=Math.min(v.y,g.y),P=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${M}px)`,this._box.style.width=I-T+"px",this._box.style.height=P-M+"px")})}mouseupWindow(s,h){if(!this._active)return;let g=this._startPos,v=h;if(g&&s.button===0){if(this.reset(),tt(),g.x!==v.x||g.y!==v.y)return this._map.fire(new i.f("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ke(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new i.f(s,{originalEvent:h}))}}function eh(m,s){let h={};for(let g=0;g<m.length;g++)h[m[g].identifier]=s[g];return h}class Zy{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new i.P(0,0);for(let T of v)x._add(T);return x.div(v.length)}(h),this.touches=eh(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;let v=eh(g,h);for(let x in this.touches){let T=v[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class th{constructor(s){this.singleTap=new Zy(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){let v=this.singleTap.touchend(s,h,g);if(v){let x=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(x&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Wd{constructor(){this._zoomIn=new th({numTouches:1,numTaps:2}),this._zoomOut=new th({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){let v=this._zoomIn.touchend(s,h,g),x=this._zoomOut.touchend(s,h,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let nh={0:1,2:2};class Zd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;let g=zt(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){let g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(v,x){let T=nh[x];return v.buttons===void 0||(v.buttons&T)!==T}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(s){this._lastPoint&&zt(s)===this._eventButton&&(this._moved&&tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yy extends Zd{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Lm extends Zd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Ja extends Zd{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){let g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class Xy{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!i.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);let v=eh(g,h),x=new i.P(0,0),T=new i.P(0,0),I=0;for(let P in v){let O=v[P],N=this._touches[P];N&&(x._add(O),T._add(O.sub(N)),I++,v[P]=O)}if(this._touches=v,I<this._minTouches||!T.mag())return;let M=T.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Fm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){let v=this._firstTwoTouches;if(!v)return;s.preventDefault();let[x,T]=v,I=Yd(g,h,x),M=Yd(g,h,T);if(!I||!M)return;let P=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],P,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,T=Yd(g,h,v),I=Yd(g,h,x);T&&I||(this._active&&tt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Yd(m,s,h){for(let g=0;g<m.length;g++)if(m[g].identifier===h)return s[g]}function Ky(m,s){return Math.log(m/s)/Math.LN2}class Nm extends Fm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){let g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Ky(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ky(this._distance,g),pinchAround:h}}}function Xd(m,s){return 180*m.angleWith(s)/Math.PI}class zm extends Fm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){let g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Xd(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());let h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=Xd(s,g);return Math.abs(v)<h}}function ih(m){return Math.abs(m.y)>Math.abs(m.x)}class Qy extends Fm{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,ih(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){let v=this._lastPoints;if(!v)return;let x=s[0].sub(v[0]),T=s[1].sub(v[1]);return this._map._cooperativeGestures&&!i.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;let v=s.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let T=s.y>0==h.y>0;return ih(s)&&ih(h)&&T}}let Jy={panStep:100,bearingStep:15,pitchStep:10};class $1{constructor(){let s=Jy;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,v=0,x=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:I=>{let M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:rh,zoom:h?Math.round(M)+h*(s.shiftKey?2:1):M,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:I.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rh(m){return m*(2-m)}let cc=4.000244140625,e0=1/450;class eo{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=e0,i.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||i.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,g=i.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%cc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=ft(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){let P=this._type==="wheel"&&Math.abs(this._delta)>cc?this._wheelZoomRate:this._defaultZoomRate,O=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&O!==0&&(O=1/O);let N=h(),B=Math.pow(2,N),V=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(V*O))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,T,I=!1;if(this._type==="wheel"&&v&&x){let P=Math.min((i.e.now()-this._lastWheelEventTime)/200,1),O=x(P);T=i.a2(v,g,O),P<1?this._frameId||(this._frameId=!0):I=!0}else T=g,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=T-h();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=i.d2;if(this._prevEase){let g=this._prevEase,v=(i.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),T=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-T*T);h=i.d0(T,I,.25,1)}return this._prevEase={start:i.e.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Bm{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qd{constructor(){this._tap=new th({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vm{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jm{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jd{constructor(s,h,g,v){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let uc=m=>m.zoom||m.drag||m.pitch||m.rotate;class Um extends i.f{}class ef{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){let g=i._.sub([],h,s);this.radius=i._.length(g[2]<0?i._.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){i._.div(s,s,this.constants),i._.normalize(s,s),i._.mul(s,s,this.constants);let h=i._.scale([],s,this.radius);if(h[2]>0){let g=i._.scale([],[0,0,1],i._.dot(h,[0,0,1])),v=i._.scale([],i._.normalize([],[h[0],h[1],0]),this.radius),x=i._.add([],h,i._.scale([],i._.sub([],i._.add([],v,g),h),2));h[0]=x[0],h[1]=x[1]}return h}}function oh(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class t0{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qa(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ef,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,T]of this._listeners){let I=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,I,T)}}destroy(){for(let[s,h,g]of this._listeners){let v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(h,v,g)}}_addDefaultHandlers(s){let h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Om(h,s));let v=h.boxZoom=new qd(h,s);this._add("boxZoom",v);let x=new Wd,T=new Kd;h.doubleClickZoom=new Bm(T,x),this._add("tapZoom",x),this._add("clickZoom",T);let I=new Qd;this._add("tapDragZoom",I);let M=h.touchPitch=new Qy(h);this._add("touchPitch",M);let P=new Lm(s),O=new Ja(s);h.dragRotate=new jm(s,P,O),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);let N=new Yy(s),B=new Xy(h,s);h.dragPan=new Vm(g,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);let V=new zm,G=new Nm;h.touchZoomRotate=new Jd(g,G,V,I),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ju(h));let H=h.scrollZoom=new eo(h,this);this._add("scrollZoom",H,["mousePan"]);let q=h.keyboard=new $1;this._add("keyboard",q);for(let W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[W]&&h[W].enable(s[W])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!uc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(let v in s)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){let h=[];for(let g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;let g=s.type==="renderFrame",v=g?void 0:s,x={needsRenderFrame:!1},T={},I={},M=s.touches?this._getMapTouches(s.touches):void 0,P=M?Ue(this._el,M):g?void 0:ft(this._el,s);for(let{handlerName:B,handler:V,allowed:G}of this._handlers){if(!V.isEnabled())continue;let H;this._blockedByActive(I,G,B)?V.reset():V[h||s.type]&&(H=V[h||s.type](s,P,M),this.mergeHandlerResult(x,T,H,B,v),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||V.isActive())&&(I[B]=V)}let O={};for(let B in this._previousActiveHandlers)I[B]||(O[B]=v);this._previousActiveHandlers=I,(Object.keys(O).length||oh(x))&&(this._changes.push([x,T,O]),this._triggerRenderFrame()),(Object.keys(I).length||oh(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:N}=x;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(s,h,g,v,x){if(!g)return;i.W(s,g);let T={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(h.zoom=T),g.panDelta!==void 0&&(h.drag=T),g.pitchDelta!==void 0&&(h.pitch=T),g.bearingDelta!==void 0&&(h.rotate=T)}_applyChanges(){let s={},h={},g={};for(let[v,x,T]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new i.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),i.W(h,x),i.W(g,T);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){let v=this._map,x=v.transform,T=ee=>[ee.x,ee.y,ee.z];if((ee=>{let te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!oh(s)){let ee=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ee!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!oh(s))return void this._fireEvents(h,g,!0);let{panDelta:I,zoomDelta:M,bearingDelta:P,pitchDelta:O,around:N,aroundCoord:B,pinchAround:V}=s;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),V!==void 0&&(N=V),(M||(ee=>h[ee]&&!this._eventsInProgress[ee])("drag"))&&N&&(this._dragOrigin=T(x.pointCoordinate3D(N)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),N=N||v.transform.centerPoint,P&&(x.bearing+=P),O&&(x.pitch+=O),x._updateCameraState();let G=[0,0,0];if(I)if(x.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N).dir),te=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(N.sub(I)).dir);G[0]=te[0]-ee[0],G[1]=te[1]-ee[1]}else{let ee=x.pointCoordinate(N);if(x.projection.name==="globe"){I=I.rotate(-x.angle);let te=x._pixelsPerMercatorPixel/x.worldSize;G[0]=-I.x*i.d3(i.ay(ee.y))*te,G[1]=-I.y*i.d3(x.center.lat)*te}else{let te=x.pointCoordinate(N.sub(I));ee&&te&&(G[0]=te.x-ee.x,G[1]=te.y-ee.y)}}let H=x.zoom,q=[0,0,0];if(M){let ee=T(B||x.pointCoordinate3D(N)),te={dir:i._.normalize([],i._.sub([],ee,x._camera.position))};if(te.dir[2]<0){let ne=x.zoomDeltaToMovement(ee,M);i._.scale(q,te.dir,ne)}}let W=i._.add(G,G,q);x._translateCameraConstrained(W),M&&Math.abs(x.zoom-H)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){let v=uc(this._eventsInProgress),x=uc(s),T={};for(let O in s){let{originalEvent:N}=s[O];this._eventsInProgress[O]||(T[`${O}start`]=N),this._eventsInProgress[O]=s[O]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let O in T)this._fireEvent(O,T[O]);x&&this._fireEvent("move",x.originalEvent);for(let O in s){let{originalEvent:N}=s[O];this._fireEvent(O,N)}let I={},M;for(let O in this._eventsInProgress){let{handlerName:N,originalEvent:B}=this._eventsInProgress[O];this._handlersById[N].isActive()||(delete this._eventsInProgress[O],M=h[N]||B,I[`${O}end`]=M)}for(let O in I)this._fireEvent(O,I[O]);let P=uc(this._eventsInProgress);if(g&&(v||x)&&!P){this._updatingCamera=!0;let O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;O?(N(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:M})):(this._map.fire(new i.f("moveend",{originalEvent:M})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new i.f(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Um("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let el="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class G1 extends i.E{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.bp(["_renderFrameCallback"],this)}getCenter(){return new i.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=i.P.convert(s).mult(-1),this.panTo(this.transform.center,i.W({offset:s},h),g)}panTo(s,h,g){return this.easeTo(i.W({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(i.W({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(i.W({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,i.W({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(i.W({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=i.ai.convert(s);let g=h&&h.bearing||0,v=h&&h.pitch||0,x=s.getNorthWest(),T=s.getSouthEast();return this._cameraForBounds(this.transform,x,T,g,v,h)}_extendPadding(s){let h={top:0,right:0,bottom:0,left:0};return s==null?i.W({},h,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:i.W({},h,s)}_extendCameraOptions(s){return(s=i.W({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,h){let g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,v,x,T){let I=s.clone(),M=this._extendCameraOptions(T);I.bearing=v,I.pitch=x;let P=i.aI.convert(h),O=i.aI.convert(g),N=.5*(P.lat+O.lat),B=.5*(P.lng+O.lng),V=i.d4(N,B),G=i._.normalize([],V),H=i._.normalize([],i._.cross([],G,[0,1,0])),q=i._.cross([],H,G),W=[H[0],H[1],H[2],0,q[0],q[1],q[2],0,G[0],G[1],G[2],0,0,0,0,1],ee=[V,i.d4(P.lat,P.lng),i.d4(O.lat,P.lng),i.d4(O.lat,O.lng),i.d4(P.lat,O.lng),i.d4(N,P.lng),i.d4(N,O.lng),i.d4(P.lat,B),i.d4(O.lat,B)],te=i.b6.fromPoints(ee.map(Ne=>[i._.dot(H,Ne),i._.dot(q,Ne),i._.dot(G,Ne)])),ne=i._.transformMat4([],te.center,W);i._.squaredLength(ne)===0&&i._.set(ne,0,0,1),i._.normalize(ne,ne),i._.scale(ne,ne,i.cD),I.center=i.d5(ne);let ue=I.getWorldToCameraMatrix(),ce=i.ad.invert(new Float64Array(16),ue);te=i.b6.applyTransform(te,i.ad.multiply([],ue,W));let J=this._extendAABB(te,I,M,v);if(!J)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=J,i._.transformMat4(ne,ne,ue);let ie=.5*(te.max[2]-te.min[2]),re=this._minimumAABBFrustumDistance(I,te),ge=i._.scale([],[0,0,1],ie),Ie=i._.add(ge,ne,ge),ae=re+(I.pitch===0?0:i._.distance(ne,Ie)),Ce=I.globeCenterInViewSpace,Me=i._.sub([],ne,[Ce[0],Ce[1],Ce[2]]);i._.normalize(Me,Me),i._.scale(Me,Me,ae);let $e=i._.add([],ne,Me);i._.transformMat4($e,$e,ce);let Ge=i.d7/i.cD,Ve=i._.length($e),xe=i.ax(Math.max(Ve*Ge-i.d7,Number.EPSILON),0),Re=Math.min(I.zoomFromMercatorZAdjusted(xe),M.maxZoom);return Re>.5*(i.b1+i.aU)?(I.setProjection({name:"mercator"}),I.zoom=Re,this._cameraForBounds(I,h,g,v,x,T)):{center:I.center,zoom:Re,bearing:v,pitch:x}}_extendAABB(s,h,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),T=.5*((g.padding.top||0)+(g.padding.bottom||0)),I=T,M=x,P=x,O=T,N=h.width-(M+P),B=h.height-(I+O),V=i._.sub([],s.max,s.min),G=Math.min(N/V[0],B/V[1]),H=Math.min(h.scaleZoom(h.scale*G),g.maxZoom);if(isNaN(H))return null;let q=h.scale/h.zoomScale(H),W=new i.b6([s.min[0]-M*q,s.min[1]-O*q,s.min[2]],[s.max[0]+P*q,s.max[1]+I*q,s.max[2]]),ee=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new i.P(g.offset.x,g.offset.y):i.P.convert(g.offset)).rotate(-i.ab(v));return W.center[0]-=ee.x*q,W.center[1]+=ee.y*q,W}queryTerrainElevation(s,h){let g=this.transform.elevation;return g?(h=i.W({},{exaggerated:!0},h),g.getAtPoint(i.Y.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,v,x,T){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,g,v,x,T);let I=s.clone(),M=this._extendCameraOptions(T);I.bearing=v,I.pitch=x;let P=i.aI.convert(h),O=i.aI.convert(g),N=new i.aI(P.lng,O.lat),B=new i.aI(O.lng,P.lat),V=I.project(P),G=I.project(O),H=this.queryTerrainElevation(P),q=this.queryTerrainElevation(O),W=this.queryTerrainElevation(N),ee=this.queryTerrainElevation(B),te=[[V.x,V.y,Math.min(H||0,q||0,W||0,ee||0)],[G.x,G.y,Math.max(H||0,q||0,W||0,ee||0)]],ne=i.b6.fromPoints(te),ue=I.getWorldToCameraMatrix(),ce=i.ad.invert(new Float64Array(16),ue);ne=i.b6.applyTransform(ne,ue);let J=this._extendAABB(ne,I,M,v);if(!J)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=J;let ie=.5*i._.sub([],ne.max,ne.min)[2],re=this._minimumAABBFrustumDistance(I,ne),ge=[0,0,1,0];i.aA.transformMat4(ge,ge,ue),i.aA.normalize(ge,ge);let Ie=i._.scale([],ge,re+ie),ae=i._.add([],ne.center,Ie);i._.transformMat4(ne.center,ne.center,ce),i._.transformMat4(ae,ae,ce);let Ce=[ne.center[0],ne.center[1],ae[2]*I.pixelsPerMeter];i._.scale(Ce,Ce,1/I.worldSize);let Me=i.d6(Ce[0]),$e=i.ay(Ce[1]),Ge=Math.min(I._zoomFromMercatorZ(Ce[2]),M.maxZoom),Ve=new i.aI(Me,$e);return I.mercatorFromTransition&&Ge<.5*(i.b1+i.aU)?(I.setProjection({name:"globe"}),I.zoom=Ge,this._cameraForBounds(I,h,g,v,x,T)):{center:Ve,zoom:Ge,bearing:v,pitch:x}}fitBounds(s,h,g){let v=this.cameraForBounds(s,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(s,h,g,v,x){let T=i.P.convert(s),I=i.P.convert(h),M=new i.P(Math.min(T.x,I.x),Math.min(T.y,I.y)),P=new i.P(Math.max(T.x,I.x),Math.max(T.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,I))return this;let O=this.transform.pointLocation3D(M),N=this.transform.pointLocation3D(P),B=this.transform.pointLocation3D(new i.P(M.x,P.y)),V=this.transform.pointLocation3D(new i.P(P.x,M.y)),G=[Math.min(O.lng,N.lng,B.lng,V.lng),Math.min(O.lat,N.lat,B.lat,V.lat)],H=[Math.max(O.lng,N.lng,B.lng,V.lng),Math.max(O.lat,N.lat,B.lat,V.lat)],q=v&&v.pitch?v.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,G,H,g,q,v);return this._fitInternal(W,v,x)}_fitInternal(s,h,g){return s?(h=i.W(s,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(s,h){this.stop();let g=s.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,T=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=i.aI.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(x=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(T=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new i.f("movestart",h)).fire(new i.f("move",h)),v&&this.fire(new i.f("zoomstart",h)).fire(new i.f("zoom",h)).fire(new i.f("zoomend",h)),x&&this.fire(new i.f("rotatestart",h)).fire(new i.f("rotate",h)).fire(new i.f("rotateend",h)),T&&this.fire(new i.f("pitchstart",h)).fire(new i.f("pitch",h)).fire(new i.f("pitchend",h)),this.fire(new i.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(el),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){let g=this.transform;if(!g.projection.supportsFreeCamera)return i.w(el),this;this.stop();let v=g.zoom,x=g.pitch,T=g.bearing;g.setFreeCameraOptions(s);let I=v!==g.zoom,M=x!==g.pitch,P=T!==g.bearing;return this.fire(new i.f("movestart",h)).fire(new i.f("move",h)),I&&this.fire(new i.f("zoomstart",h)).fire(new i.f("zoom",h)).fire(new i.f("zoomend",h)),P&&this.fire(new i.f("rotatestart",h)).fire(new i.f("rotate",h)).fire(new i.f("rotateend",h)),M&&this.fire(new i.f("pitchstart",h)).fire(new i.f("pitch",h)).fire(new i.f("pitchend",h)),this.fire(new i.f("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=i.W({offset:[0,0],duration:500,easing:i.d2},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),I=this.getPadding(),M="zoom"in s?+s.zoom:v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,O="pitch"in s?+s.pitch:T,N=this._extendPadding(s.padding),B=i.P.convert(s.offset),V,G,H;if(g.projection.name==="globe"){let re=i.Y.fromLngLat(g.center),ge=B.rotate(-g.angle);re.x+=ge.x/g.worldSize,re.y+=ge.y/g.worldSize;let Ie=re.toLngLat(),ae=i.aI.convert(s.center||Ie);this._normalizeCenter(ae),V=g.centerPoint.add(ge),G=new i.P(re.x,re.y).mult(g.worldSize),H=new i.P(i.aj(ae.lng),i.ak(ae.lat)).mult(g.worldSize).sub(G)}else{V=g.centerPoint.add(B);let re=g.pointLocation(V),ge=i.aI.convert(s.center||re);this._normalizeCenter(ge),G=g.project(re),H=g.project(ge).sub(G)}let q=g.zoomScale(M-v),W,ee;s.around&&(W=i.aI.convert(s.around),ee=g.locationPoint(W));let te=this._zooming||M!==v,ne=this._rotating||x!==P,ue=this._pitching||O!==T,ce=!g.isPaddingEqual(N),J=re=>ge=>{if(te&&(re.zoom=i.a2(v,M,ge)),ne&&(re.bearing=i.a2(x,P,ge)),ue&&(re.pitch=i.a2(T,O,ge)),ce&&(re.interpolatePadding(I,N,ge),V=re.centerPoint.add(B)),W)re.setLocationAtPoint(W,ee);else{let Ie=re.zoomScale(re.zoom-v),ae=M>v?Math.min(2,q):Math.max(.5,q),Ce=Math.pow(ae,1-ge),Me=re.unproject(G.add(H.mult(ge*Ce)).mult(Ie));re.setLocationAtPoint(re.renderWorldCopies?Me.wrap():Me,V)}return s.preloadOnly||this._fireMoveEvents(h),re};if(s.preloadOnly){let re=this._emulate(J,s.duration,g);return this._preloadTiles(re),this}let ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=ne,this._pitching=ue,this._padding=ce,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,ie),this._ease(J(g),re=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,re)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new i.f("movestart",s)),this._zooming&&!g.zooming&&this.fire(new i.f("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new i.f("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new i.f("pitchstart",s))}_fireMoveEvents(s){this.fire(new i.f("move",s)),this._zooming&&this.fire(new i.f("zoom",s)),this._rotating&&this.fire(new i.f("rotate",s)),this._pitching&&this.fire(new i.f("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new i.f("zoomend",s)),v&&this.fire(new i.f("rotateend",s)),x&&this.fire(new i.f("pitchend",s)),this.fire(new i.f("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){let Re=i.ah(s,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Re,h)}this.stop(),s=i.W({offset:[0,0],speed:1.2,curve:1.42,easing:i.d2},s);let g=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),I=this.getPadding(),M="zoom"in s?i.at(+s.zoom,g.minZoom,g.maxZoom):v,P="bearing"in s?this._normalizeBearing(s.bearing,x):x,O="pitch"in s?+s.pitch:T,N=this._extendPadding(s.padding),B=g.zoomScale(M-v),V=i.P.convert(s.offset),G=g.centerPoint.add(V),H=g.pointLocation(G),q=i.aI.convert(s.center||H);this._normalizeCenter(q);let W=g.project(H),ee=g.project(q).sub(W),te=s.curve,ne=Math.max(g.width,g.height),ue=ne/B,ce=ee.mag();if("minZoom"in s){let Re=i.at(Math.min(s.minZoom,v,M),g.minZoom,g.maxZoom),Ne=ne/g.zoomScale(Re-v);te=Math.sqrt(Ne/ce*2)}let J=te*te;function ie(Re){let Ne=(ue*ue-ne*ne+(Re?-1:1)*J*J*ce*ce)/(2*(Re?ue:ne)*J*ce);return Math.log(Math.sqrt(Ne*Ne+1)-Ne)}function re(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ge(Re){return(Math.exp(Re)+Math.exp(-Re))/2}let Ie=ie(0),ae=function(Re){return ge(Ie)/ge(Ie+te*Re)},Ce=function(Re){return ne*((ge(Ie)*(re(Ne=Ie+te*Re)/ge(Ne))-re(Ie))/J)/ce;var Ne},Me=(ie(1)-Ie)/te;if(Math.abs(ce)<1e-6||!isFinite(Me)){if(Math.abs(ne-ue)<1e-6)return this.easeTo(s,h);let Re=ue<ne?-1:1;Me=Math.abs(Math.log(ue/ne))/te,Ce=function(){return 0},ae=function(Ne){return Math.exp(Re*te*Ne)}}s.duration="duration"in s?+s.duration:1e3*Me/("screenSpeed"in s?+s.screenSpeed/te:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);let $e=x!==P,Ge=O!==T,Ve=!g.isPaddingEqual(N),xe=Re=>Ne=>{let ot=Ne*Me,ct=1/ae(ot);Re.zoom=Ne===1?M:v+Re.scaleZoom(ct),$e&&(Re.bearing=i.a2(x,P,Ne)),Ge&&(Re.pitch=i.a2(T,O,Ne)),Ve&&(Re.interpolatePadding(I,N,Ne),G=Re.centerPoint.add(V));let at=Ne===1?q:Re.unproject(W.add(ee.mult(Ce(ot))).mult(ct));return Re.setLocationAtPoint(Re.renderWorldCopies?at.wrap():at,G),Re._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),Re};if(s.preloadOnly){let Re=this._emulate(xe,s.duration,g);return this._preloadTiles(Re),this}return this._zooming=!0,this._rotating=$e,this._pitching=Ge,this._padding=Ve,this._prepareEase(h,!1),this._ease(xe(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){let g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=i.e.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let s=Math.min((i.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=i.au(s,-180,180);let g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&i.e.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,g){let v=Math.ceil(15*h/1e3),x=[],T=s(g.clone());for(let I=0;I<=v;I++){let M=T(I/v);x.push(M.clone())}return x}_preloadTiles(s,h){}}class n0{constructor(s={}){this.options=s,i.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){let h=this.options&&this.options.compact;return this._map=s,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),U("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){let g=this._map._getUIString(`AttributionControl.${h}`);s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.d8.ACCESS_TOKEN}];if(s){let g=h.reduce((v,x,T)=>(x.value&&(v+=`${x.key}=${x.value}${T<h.length-1?"&":""}`),v),"?");s.href=`${i.d8.FEEDBACK_URL}/${g}#${Ku(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._mergedSourceCaches;for(let v in h){let x=h[v];if(x.used){let T=x.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s.sort((v,x)=>v.length-x.length),s=s.filter((v,x)=>{for(let T=x+1;T<s.length;T++)if(s[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));let g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class i0{constructor(){i.bp(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=U("div","mapboxgl-ctrl");let h=U("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(let h in s){let g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let s=this._container.children;if(s.length){let h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class r0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){let h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){let h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(let v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function o0(m,s,h){if(m=new i.aI(m.lng,m.lat),s){let g=new i.aI(m.lng-360,m.lat),v=new i.aI(m.lng+360,m.lat),x=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),T=h.locationPoint(m).distSqr(s),I=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(g).distSqr(s)<T&&(I||Math.abs(g.lng-h.center.lng)<x)?m=g:h.locationPoint(v).distSqr(s)<T&&(I||Math.abs(v.lng-h.center.lng)<x)&&(m=v)}for(;Math.abs(m.lng-h.center.lng)>180;){let g=h.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}let $m={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sh extends i.E{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=i.W({element:s},h)),i.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=i.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=U("div");let x=41,T=27,I=Q("svg",{display:"block",height:x*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${x}`},this._element),M=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},I));Q("stop",{offset:"10%","stop-opacity":.4},M),Q("stop",{offset:"100%","stop-opacity":.05},M),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=i.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in $m)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=s&&s.className?s.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){let s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=i.aI.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){let h=s.code,g=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){let h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let s=this._map,h=this._pos;if(!s||!h)return!1;let g=s.unproject(h),v=s.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let s=this._map;if(!s)return;let h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();let g=s.unproject(h),v;s._showingGlobe()&&i.d9(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let s=this._pos;if(!s||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${$m[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||g!=="map")return"";if(!h._showingGlobe()){let M=h.getPitch();return M?`rotateX(${M}deg)`:""}let v=i.b0(i.da(h.transform,this._lngLat)),x=s.sub(i.db(h.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";let I=v/T;return`rotateX(${-x.y*I}deg) rotateY(${x.x*I}deg)`}_calculateZTransform(){let s=this._pos,h=this._map;if(!h||!s)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new i.aI(this._lngLat.lng,this._lngLat.lat+.001)),T=h.project(new i.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=i.b0(Math.atan2(T.y,T.x))-90}else g=-h.getBearing();else if(v==="horizon"){let x=i.$(4,6,h.getZoom()),T=i.db(h.transform);T.y+=x*h.transform.height;let I=s.sub(T),M=i.b0(Math.atan2(I.y,I.x));g=(M>90?M-270:M+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=o0(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=i.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){let h=this._map;if(!h)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<x)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.f("dragstart"))),this.fire(new i.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.f("dragend")),this._state="inactive"}_addDragHandler(s){let h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;let h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Gm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},s0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function tl(m=new i.P(0,0),s="bottom"){if(typeof m=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new i.P(0,m);case"top-left":return new i.P(h,h);case"top-right":return new i.P(-h,h);case"bottom":return new i.P(0,-m);case"bottom-left":return new i.P(h,-h);case"bottom-right":return new i.P(-h,-h);case"left":return new i.P(m,0);case"right":return new i.P(-m,0)}return new i.P(0,0)}return m instanceof i.P||Array.isArray(m)?i.P.convert(m):i.P.convert(m[s]||[0,0])}class a0{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;let h=i.b9((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}let l0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class c0{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let Hm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},nl={showCompass:!0,showZoom:!0,visualizePitch:!1};class u0{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Lm({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Ja({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),i.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),Se()}move(s,h){let g=this.map,v=this.mouseRotate.mousemoveWindow(s,h),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let T=this.mousePitch.mousemoveWindow(s,h),I=T&&T.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){let s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ke(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(i.W({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),ft(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,ft(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ue(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ue(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},h0={maxWidth:100,unit:"metric"},tf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:i.dt,supported:C,setRTLTextPlugin:i.dv,getRTLTextPluginStatus:i.dw,Map:class extends G1{constructor(m){i.dc.mark(i.dd.create);let s=m;if((m=i.W({},Hm,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.de(window)&&(m.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Qo(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new r0,this._domRenderTaskQueue=new r0,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.df(),this._locale=i.W({},l0,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new a0(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new i.dg(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?gt({},m.contextCreateOptions):{},typeof m.container=="string"){let h=document.getElementById(m.container);if(!h)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=h}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),i.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new c0),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new t0(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||i.d8.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new U1(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});let h=m.bounds;h&&(this.resize(),this.fitBounds(h,i.W({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new n0({customAttribution:m.customAttribution})),this._logoControl=new i0,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new i.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new i.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=m.onAdd(this);this._controls.push(m);let g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let s=!this._moving;return s&&this.fire(new i.f("movestart",m)).fire(new i.f("move",m)),this.fire(new i.f("resize",m)),s&&this.fire(new i.f("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.ai.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.f("zoomstart")).fire(new i.f("zoom")).fire(new i.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.f("zoomstart")).fire(new i.f("zoom")).fire(new i.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.f("pitchstart")).fire(new i.f("pitch")).fire(new i.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.f("pitchstart")).fire(new i.f("pitch")).fire(new i.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(s=>s==="auto"?navigator.language:s):m}setLanguage(m){let s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let m=this.transform,s=m.projection.name,h;s==="globe"&&m.zoom>=i.aU?(m.setMercatorFromTransition(),h=!0):s==="mercator"&&m.zoom<i.aU&&(m.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s=m.name==="globe"&&this.transform.zoom>=i.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(i.aI.convert(m))}unproject(m){return this.transform.pointLocation3D(i.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let g=!1,v=T=>{let I=s.filter(P=>this.getLayer(P)),M=I.length?this.queryRenderedFeatures(T.point,{layers:I}):[];M.length?g||(g=!0,h.call(this,new or(m,this,T.originalEvent,{features:M}))):g=!1},x=()=>{g=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}if(m==="mouseleave"||m==="mouseout"){let g=!1,v=T=>{let I=s.filter(M=>this.getLayer(M));(I.length?this.queryRenderedFeatures(T.point,{layers:I}):[]).length?g=!0:g&&(g=!1,h.call(this,new or(m,this,T.originalEvent)))},x=T=>{g&&(g=!1,h.call(this,new or(m,this,T.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=s.filter(I=>this.getLayer(I)),T=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];T.length&&(v.features=T,h.call(this,v),delete v.features)};return{layers:new Set(s),listener:h,delegates:{[m]:g}}}}on(m,s,h){if(typeof s=="function"||h===void 0)return super.on(m,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,s,h){if(typeof s=="function"||h===void 0)return super.once(m,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(m,s,h);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,s,h){if(typeof s=="function"||h===void 0)return super.off(m,s);let g=new Set(Array.isArray(s)?s:[s]);for(let T of g)if(!this._isValidId(T))return this;let v=(T,I)=>{if(T.size!==I.size)return!1;for(let M of T)if(!I.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(T=>{for(let I=0;I<T.length;I++){let M=T[I];if(M.listener===h&&v(M.layers,g)){for(let P in M.delegates)this.off(P,M.delegates[P]);return T.splice(I,1),this}}})(x),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(s!==void 0||m===void 0||m instanceof i.P||Array.isArray(m)||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],(s=s||{}).layers&&Array.isArray(s.layers)){for(let h of s.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(m,s,this.transform)}querySourceFeatures(m,s){return this._isValidId(m)?this.style.querySourceFeatures(m,s):[]}isPointOnSurface(m){let{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&i.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(m))}setStyle(m,s){return s=i.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(h,g)=>{h?(i.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(m,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){let s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){let h=i.W({},s);s&&s.config&&(h.initialConfig=s.config,delete h.config),this.style=new Oo(this,h).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new i.d(new Error("IDs can't be empty."))),!1):!i.cV(m)||(this.fire(new i.d(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){let{width:I,height:M,data:P}=i.e.getImageData(s);this.style.addImage(m,{data:new i.i({width:I,height:M},P),pixelRatio:h,stretchX:v,stretchY:x,content:T,sdf:g,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new i.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:I,height:M}=s,P=s;this.style.addImage(m,{data:new i.i({width:I,height:M},new Uint8Array(P.data)),pixelRatio:h,stretchX:v,stretchY:x,content:T,sdf:g,version:0,userImage:P}),P.onAdd&&P.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();let h=this.style.getImage(m);if(!h)return void this.fire(new i.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?i.e.getImageData(s):s,{width:v,height:x,data:T}=g;if(v===void 0||x===void 0)return void this.fire(new i.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||x!==h.data.height)return void this.fire(new i.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let I=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);h.data.replace(T,I),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new i.d(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){i.h(this._requestManager.transformRequest(m,i.R.Image),(h,g)=>{s(h,g instanceof HTMLImageElement?i.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new i.d(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){let s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s),this}updateImport(m,s){return typeof s!="string"&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){return this._isValidId(m)?this.style.getOwnLayer(m):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,h){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,h),this._update(!0)):this}setFilter(m,s,h={}){return this._isValidId(m)?(this.style.setFilter(m,s,h),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,h,g),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,h,g),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,h){return this.style.setConfigProperty(m,s,h),this._update(!0)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){let s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aI.convert(m),this.transform):0}setFeatureState(m,s){return this._isValidId(m.source)?(this.style.setFeatureState(m,s),this._update()):this}removeFeatureState(m,s){return this._isValidId(m.source)?(this.style.removeFeatureState(m,s),this._update()):this}getFeatureState(m){return this._isValidId(m.source)?this.style.getFeatureState(m):null}_updateContainerDimensions(){if(!this._container)return;let m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300,h,g,v,x=this._container;for(;x&&(!g||!v);){let T=window.getComputedStyle(x).transform;T&&T!=="none"&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();let s=this._canvasContainer=U("div","mapboxgl-canvas-container",m);this._canvas=U("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=U("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=U("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){let h=i.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){let s=this._markers.indexOf(m);s!==-1&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){let s=this._popups.indexOf(m);s!==-1&&this._popups.splice(s,1)}_setupPainter(){let m=i.W({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(i.dh(s,!0),this.painter=new Ny(s,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.di.testSupport(s)):this.fire(new i.d(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.f("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new i.f("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new i.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,g=i.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let P=this.transform.zoom,O=this.transform.pitch,N=i.e.now(),B=new i.X(P,{now:N,fadeDuration:x,pitch:O,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(g);let I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(I&&(this._placementDirty=I.needsRerender,this._occlusionOpacityChanged=I.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,i.dc.mark(i.dd.load),this.fire(new i.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){let P=i.e.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let O=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new i.f("gpu-timing-frame",{cpuTime:P,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){let P=this.painter.collectGpuTimers();setTimeout(()=>{let O=this.painter.queryGpuTimers(P);this.fire(new i.f("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){let P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let O=this.painter.queryGpuTimeDeferredRender(P);this.fire(new i.f("gpu-timing-deferred-render",{gpuTime:O}))},50)}let M=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||T;if((this._sourcesDirty||this._styleDirty||T||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),M||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let P=!this.isMoving()&&this.loaded();if(P&&(T=this._updateAverageElevation(g,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new i.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let O=this._calculateSpeedIndex();this.fire(new i.f("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!M&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,i.dc.mark(i.dd.fullLoad),this._performanceMetricsCollection&&i.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(let s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(let s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){let h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;let T=Math.abs(v-x);if(T>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,m,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){i.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===i.dl||m.status===401)){let s=this.painter.context.gl;i.dh(s,!1),this._logoControl instanceof i0&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&i.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){let m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());let h=this.painter.context.gl,g=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(m,s,h){let g=h[1]-h[0],v=m.length/4;for(let x=0;x<s.length;x++){let T=s[x],I=0;for(let M=0;M<T.length;M+=4)T[M]===m[M]&&T[M+1]===m[M+1]&&T[M+2]===m[M+2]&&T[M+3]===m[M+3]&&(I+=1);g+=(h[x+2]-h[x+1])*(1-I/v)}return g}remove(){this._hash&&this._hash.remove();for(let s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.dp(this.painter.context.gl),i.dq.remove(),i.dr.remove(),this._removed=!0,this.fire(new i.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.e.frame(s=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(m){let s=this.style?this.style.getSourceCaches():[];return i.ds(s,(h,g)=>h._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){i.du(m,s)}_occlusionCriteriaSatisfied(){let m=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&m&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return i.dt}},NavigationControl:class{constructor(m){this.options=i.W({},nl,m),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(i.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let m=this._map;if(!m)return;let s=m.getZoom(),h=s===m.getMaxZoom(),g=s===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let m=this._map;if(!m)return;let s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new u0(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){let m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){let h=U("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.E{constructor(m){super();let s=navigator.geolocation;this.options=i.W({geolocation:s},il,m),i.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Pm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){let s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,m(h)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){let s=this._map.getMaxBounds(),h=m.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.f("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.f("geolocate",m)),this._finish()}}_updateCamera(m){let s=new i.aI(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,g=this._map.getBearing(),v=i.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),v,{geolocateSource:!0})}_updateMarker(m){if(m){let s=new i.aI(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let m=this._map.transform,s=i.ax(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.f("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{let s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.f("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:n0,ScaleControl:class{constructor(m){this.options=i.W({},h0,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let m=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-m/2,v=s.unproject([g,h]),x=s.unproject([g+m,h]),T=v.distanceTo(x);if(this.options.unit==="imperial"){let I=3.2808*T;I>5280?this._setScale(m,I/5280,"mile"):this._setScale(m,I,"foot")}else this.options.unit==="nautical"?this._setScale(m,T/1852,"nautical-mile"):T>=1e3?this._setScale(m,T/1e3,"kilometer"):this._setScale(m,T,"meter")}_setScale(m,s,h){this._map._requestDomTask(()=>{let g=function(x){let T=Math.pow(10,`${Math.floor(x)}`.length-1),I=x/T;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){let P=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*P)/P}(I),T*I}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${tf[h]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:i.w("Full screen control 'container' must be a DOM element.")),i.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let m=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(m){super(),this.options=i.W(Object.create(Gm),m),i.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.f("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.aI.convert(m),this._pos=null,this._trackPointer=!1,this._update();let s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let s=document.createDocumentFragment(),h=document.createElement("body"),g;for(h.innerHTML=m;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){let h=this._closeButton=U("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;let s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,T=g.x<v/2,I=g.x>s.transform.width-v/2;if(g.y+m<x)return T?"top-left":I?"top-right":"top";if(g.y>s.transform.height-x){if(T)return"bottom-left";if(I)return"bottom-right"}return T?"left":I?"right":"bottom"}_updateClassList(){let m=this._container;if(!m)return;let s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){let s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=U("div","mapboxgl-popup",s.getContainer()),this._tip=U("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=o0(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){let v=this._pos=this._trackPointer&&m?m:s.project(this._lngLat),x=tl(this.options.offset),T=this._anchor=this._getAnchor(x.y),I=tl(this.options.offset,T),M=v.add(I).round();s._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${$m[T]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&s._showingGlobe()){let v=i.d9(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(s0);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:sh,Style:Oo,LngLat:i.aI,LngLatBounds:i.ai,Point:i.P,MercatorCoordinate:i.Y,FreeCameraOptions:Xp,Evented:i.E,config:i.d8,prewarm:i.dx,clearPrewarmedResources:i.dy,get accessToken(){return i.d8.ACCESS_TOKEN},set accessToken(m){i.d8.ACCESS_TOKEN=m},get baseApiUrl(){return i.d8.API_URL},set baseApiUrl(m){i.d8.API_URL=m},get workerCount(){return i.dz.workerCount},set workerCount(m){i.dz.workerCount=m},get maxParallelImageRequests(){return i.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.d8.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.dA(m)},get workerUrl(){return i.dB.workerUrl},set workerUrl(m){i.dB.workerUrl=m},get workerClass(){return i.dB.workerClass},set workerClass(m){i.dB.workerClass=m},get workerParams(){return i.dB.workerParams},set workerParams(m){i.dB.workerParams=m},get dracoUrl(){return i.dC()},set dracoUrl(m){i.dD(m)},get meshoptUrl(){return i.dE()},set meshoptUrl(m){i.dF(m)},setNow:i.e.setNow,restoreNow:i.e.restoreNow}});var f=l;return f})});function KV(o,n){return Object.is(o,n)}var Ar=null,Ag=!1,vv=1,Fc=Symbol("SIGNAL");function di(o){let n=Ar;return Ar=o,n}function QV(){return Ag}var xv={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function NT(o){if(Ag)throw new Error("");if(Ar===null)return;Ar.consumerOnSignalRead(o);let n=Ar.nextProducerIndex++;if(Pf(Ar),n<Ar.producerNode.length&&Ar.producerNode[n]!==o&&Pg(Ar)){let l=Ar.producerNode[n];wv(l,Ar.producerIndexOfThis[n])}Ar.producerNode[n]!==o&&(Ar.producerNode[n]=o,Ar.producerIndexOfThis[n]=Pg(Ar)?pP(o,Ar,n):0),Ar.producerLastReadVersion[n]=o.version}function JV(){vv++}function ej(o){if(!(Pg(o)&&!o.dirty)&&!(!o.dirty&&o.lastCleanEpoch===vv)){if(!o.producerMustRecompute(o)&&!bv(o)){o.dirty=!1,o.lastCleanEpoch=vv;return}o.producerRecomputeValue(o),o.dirty=!1,o.lastCleanEpoch=vv}}function hP(o){if(o.liveConsumerNode===void 0)return;let n=Ag;Ag=!0;try{for(let l of o.liveConsumerNode)l.dirty||fP(l)}finally{Ag=n}}function dP(){return Ar?.consumerAllowSignalWrites!==!1}function fP(o){o.dirty=!0,hP(o),o.consumerMarkedDirty?.(o)}function zT(o){return o&&(o.nextProducerIndex=0),di(o)}function BT(o,n){if(di(n),!(!o||o.producerNode===void 0||o.producerIndexOfThis===void 0||o.producerLastReadVersion===void 0)){if(Pg(o))for(let l=o.nextProducerIndex;l<o.producerNode.length;l++)wv(o.producerNode[l],o.producerIndexOfThis[l]);for(;o.producerNode.length>o.nextProducerIndex;)o.producerNode.pop(),o.producerLastReadVersion.pop(),o.producerIndexOfThis.pop()}}function bv(o){Pf(o);for(let n=0;n<o.producerNode.length;n++){let l=o.producerNode[n],c=o.producerLastReadVersion[n];if(c!==l.version||(ej(l),c!==l.version))return!0}return!1}function VT(o){if(Pf(o),Pg(o))for(let n=0;n<o.producerNode.length;n++)wv(o.producerNode[n],o.producerIndexOfThis[n]);o.producerNode.length=o.producerLastReadVersion.length=o.producerIndexOfThis.length=0,o.liveConsumerNode&&(o.liveConsumerNode.length=o.liveConsumerIndexOfThis.length=0)}function pP(o,n,l){if(mP(o),Pf(o),o.liveConsumerNode.length===0)for(let c=0;c<o.producerNode.length;c++)o.producerIndexOfThis[c]=pP(o.producerNode[c],o,c);return o.liveConsumerIndexOfThis.push(l),o.liveConsumerNode.push(n)-1}function wv(o,n){if(mP(o),Pf(o),o.liveConsumerNode.length===1)for(let c=0;c<o.producerNode.length;c++)wv(o.producerNode[c],o.producerIndexOfThis[c]);let l=o.liveConsumerNode.length-1;if(o.liveConsumerNode[n]=o.liveConsumerNode[l],o.liveConsumerIndexOfThis[n]=o.liveConsumerIndexOfThis[l],o.liveConsumerNode.length--,o.liveConsumerIndexOfThis.length--,n<o.liveConsumerNode.length){let c=o.liveConsumerIndexOfThis[n],f=o.liveConsumerNode[n];Pf(f),f.producerIndexOfThis[c]=n}}function Pg(o){return o.consumerIsAlwaysLive||(o?.liveConsumerNode?.length??0)>0}function Pf(o){o.producerNode??=[],o.producerIndexOfThis??=[],o.producerLastReadVersion??=[]}function mP(o){o.liveConsumerNode??=[],o.liveConsumerIndexOfThis??=[]}function tj(){throw new Error}var gP=tj;function _P(){gP()}function yP(o){gP=o}var nj=null;function vP(o){let n=Object.create(jT);n.value=o;let l=()=>(NT(n),n.value);return l[Fc]=n,l}function Tv(o,n){dP()||_P(),o.equal(o.value,n)||(o.value=n,ij(o))}function xP(o,n){dP()||_P(),Tv(o,n(o.value))}var jT=oi(gt({},xv),{equal:KV,value:void 0});function ij(o){o.version++,JV(),hP(o),nj?.()}function bP(o,n,l){let c=Object.create(rj);l&&(c.consumerAllowSignalWrites=!0),c.fn=o,c.schedule=n;let f=A=>{c.cleanupFn=A};function i(A){return A.fn===null&&A.schedule===null}function w(A){i(A)||(VT(A),A.cleanupFn(),A.fn=null,A.schedule=null,A.cleanupFn=FT)}let C=()=>{if(c.fn===null)return;if(QV())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(c.dirty=!1,c.hasRun&&!bv(c))return;c.hasRun=!0;let A=zT(c);try{c.cleanupFn(),c.cleanupFn=FT,c.fn(f)}finally{BT(c,A)}};return c.ref={notify:()=>fP(c),run:C,cleanup:()=>c.cleanupFn(),destroy:()=>w(c),[Fc]:c},c.ref}var FT=()=>{},rj=oi(gt({},xv),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:o=>{o.schedule!==null&&o.schedule(o.ref)},hasRun:!1,cleanupFn:FT});function Pn(o){return typeof o=="function"}function Rf(o){let l=o(c=>{Error.call(c),c.stack=new Error().stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}var Ev=Rf(o=>function(l){o(this),this.message=l?`${l.length} errors occurred during unsubscription:
${l.map((c,f)=>`${f+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=l});function Eh(o,n){if(o){let l=o.indexOf(n);0<=l&&o.splice(l,1)}}var Ji=class o{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:l}=this;if(l)if(this._parentage=null,Array.isArray(l))for(let i of l)i.remove(this);else l.remove(this);let{initialTeardown:c}=this;if(Pn(c))try{c()}catch(i){n=i instanceof Ev?i.errors:[i]}let{_finalizers:f}=this;if(f){this._finalizers=null;for(let i of f)try{wP(i)}catch(w){n=n??[],w instanceof Ev?n=[...n,...w.errors]:n.push(w)}}if(n)throw new Ev(n)}}add(n){var l;if(n&&n!==this)if(this.closed)wP(n);else{if(n instanceof o){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(l=this._finalizers)!==null&&l!==void 0?l:[]).push(n)}}_hasParent(n){let{_parentage:l}=this;return l===n||Array.isArray(l)&&l.includes(n)}_addParent(n){let{_parentage:l}=this;this._parentage=Array.isArray(l)?(l.push(n),l):l?[l,n]:n}_removeParent(n){let{_parentage:l}=this;l===n?this._parentage=null:Array.isArray(l)&&Eh(l,n)}remove(n){let{_finalizers:l}=this;l&&Eh(l,n),n instanceof o&&n._removeParent(this)}};Ji.EMPTY=(()=>{let o=new Ji;return o.closed=!0,o})();var UT=Ji.EMPTY;function Iv(o){return o instanceof Ji||o&&"closed"in o&&Pn(o.remove)&&Pn(o.add)&&Pn(o.unsubscribe)}function wP(o){Pn(o)?o():o.unsubscribe()}var Ls={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var kf={setTimeout(o,n,...l){let{delegate:c}=kf;return c?.setTimeout?c.setTimeout(o,n,...l):setTimeout(o,n,...l)},clearTimeout(o){let{delegate:n}=kf;return(n?.clearTimeout||clearTimeout)(o)},delegate:void 0};function Cv(o){kf.setTimeout(()=>{let{onUnhandledError:n}=Ls;if(n)n(o);else throw o})}function Rg(){}var TP=$T("C",void 0,void 0);function EP(o){return $T("E",void 0,o)}function IP(o){return $T("N",o,void 0)}function $T(o,n,l){return{kind:o,value:n,error:l}}var Ih=null;function Of(o){if(Ls.useDeprecatedSynchronousErrorHandling){let n=!Ih;if(n&&(Ih={errorThrown:!1,error:null}),o(),n){let{errorThrown:l,error:c}=Ih;if(Ih=null,l)throw c}}else o()}function CP(o){Ls.useDeprecatedSynchronousErrorHandling&&Ih&&(Ih.errorThrown=!0,Ih.error=o)}var Ch=class extends Ji{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Iv(n)&&n.add(this)):this.destination=aj}static create(n,l,c){return new pl(n,l,c)}next(n){this.isStopped?HT(IP(n),this):this._next(n)}error(n){this.isStopped?HT(EP(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?HT(TP,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},oj=Function.prototype.bind;function GT(o,n){return oj.call(o,n)}var qT=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:l}=this;if(l.next)try{l.next(n)}catch(c){Sv(c)}}error(n){let{partialObserver:l}=this;if(l.error)try{l.error(n)}catch(c){Sv(c)}else Sv(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(l){Sv(l)}}},pl=class extends Ch{constructor(n,l,c){super();let f;if(Pn(n)||!n)f={next:n??void 0,error:l??void 0,complete:c??void 0};else{let i;this&&Ls.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),f={next:n.next&&GT(n.next,i),error:n.error&&GT(n.error,i),complete:n.complete&&GT(n.complete,i)}):f=n}this.destination=new qT(f)}};function Sv(o){Ls.useDeprecatedSynchronousErrorHandling?CP(o):Cv(o)}function sj(o){throw o}function HT(o,n){let{onStoppedNotification:l}=Ls;l&&kf.setTimeout(()=>l(o,n))}var aj={closed:!0,next:Rg,error:sj,complete:Rg};var Lf=typeof Symbol=="function"&&Symbol.observable||"@@observable";function zo(o){return o}function WT(...o){return ZT(o)}function ZT(o){return o.length===0?zo:o.length===1?o[0]:function(l){return o.reduce((c,f)=>f(c),l)}}var ii=(()=>{class o{constructor(l){l&&(this._subscribe=l)}lift(l){let c=new o;return c.source=this,c.operator=l,c}subscribe(l,c,f){let i=cj(l)?l:new pl(l,c,f);return Of(()=>{let{operator:w,source:C}=this;i.add(w?w.call(i,C):C?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(l){try{return this._subscribe(l)}catch(c){l.error(c)}}forEach(l,c){return c=SP(c),new c((f,i)=>{let w=new pl({next:C=>{try{l(C)}catch(A){i(A),w.unsubscribe()}},error:i,complete:f});this.subscribe(w)})}_subscribe(l){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(l)}[Lf](){return this}pipe(...l){return ZT(l)(this)}toPromise(l){return l=SP(l),new l((c,f)=>{let i;this.subscribe(w=>i=w,w=>f(w),()=>c(i))})}}return o.create=n=>new o(n),o})();function SP(o){var n;return(n=o??Ls.Promise)!==null&&n!==void 0?n:Promise}function lj(o){return o&&Pn(o.next)&&Pn(o.error)&&Pn(o.complete)}function cj(o){return o&&o instanceof Ch||lj(o)&&Iv(o)}function YT(o){return Pn(o?.lift)}function $n(o){return n=>{if(YT(n))return n.lift(function(l){try{return o(l,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Zn(o,n,l,c,f){return new XT(o,n,l,c,f)}var XT=class extends Ch{constructor(n,l,c,f,i,w){super(n),this.onFinalize=i,this.shouldUnsubscribe=w,this._next=l?function(C){try{l(C)}catch(A){n.error(A)}}:super._next,this._error=f?function(C){try{f(C)}catch(A){n.error(A)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(C){n.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:l}=this;super.unsubscribe(),!l&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function Ff(){return $n((o,n)=>{let l=null;o._refCount++;let c=Zn(n,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount){l=null;return}let f=o._connection,i=l;l=null,f&&(!i||f===i)&&f.unsubscribe(),n.unsubscribe()});o.subscribe(c),c.closed||(l=o.connect())})}var Nf=class extends ii{constructor(n,l){super(),this.source=n,this.subjectFactory=l,this._subject=null,this._refCount=0,this._connection=null,YT(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Ji;let l=this.getSubject();n.add(this.source.subscribe(Zn(l,void 0,()=>{this._teardown(),l.complete()},c=>{this._teardown(),l.error(c)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Ji.EMPTY)}return n}refCount(){return Ff()(this)}};var DP=Rf(o=>function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var cr=(()=>{class o extends ii{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(l){let c=new Dv(this,this);return c.operator=l,c}_throwIfClosed(){if(this.closed)throw new DP}next(l){Of(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(l)}})}error(l){Of(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=l;let{observers:c}=this;for(;c.length;)c.shift().error(l)}})}complete(){Of(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:l}=this;for(;l.length;)l.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var l;return((l=this.observers)===null||l===void 0?void 0:l.length)>0}_trySubscribe(l){return this._throwIfClosed(),super._trySubscribe(l)}_subscribe(l){return this._throwIfClosed(),this._checkFinalizedStatuses(l),this._innerSubscribe(l)}_innerSubscribe(l){let{hasError:c,isStopped:f,observers:i}=this;return c||f?UT:(this.currentObservers=null,i.push(l),new Ji(()=>{this.currentObservers=null,Eh(i,l)}))}_checkFinalizedStatuses(l){let{hasError:c,thrownError:f,isStopped:i}=this;c?l.error(f):i&&l.complete()}asObservable(){let l=new ii;return l.source=this,l}}return o.create=(n,l)=>new Dv(n,l),o})(),Dv=class extends cr{constructor(n,l){super(),this.destination=n,this.source=l}next(n){var l,c;(c=(l=this.destination)===null||l===void 0?void 0:l.next)===null||c===void 0||c.call(l,n)}error(n){var l,c;(c=(l=this.destination)===null||l===void 0?void 0:l.error)===null||c===void 0||c.call(l,n)}complete(){var n,l;(l=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||l===void 0||l.call(n)}_subscribe(n){var l,c;return(c=(l=this.source)===null||l===void 0?void 0:l.subscribe(n))!==null&&c!==void 0?c:UT}};var wr=class extends cr{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let l=super._subscribe(n);return!l.closed&&n.next(this._value),l}getValue(){let{hasError:n,thrownError:l,_value:c}=this;if(n)throw l;return this._throwIfClosed(),c}next(n){super.next(this._value=n)}};var KT={now(){return(KT.delegate||Date).now()},delegate:void 0};var Mv=class extends Ji{constructor(n,l){super()}schedule(n,l=0){return this}};var kg={setInterval(o,n,...l){let{delegate:c}=kg;return c?.setInterval?c.setInterval(o,n,...l):setInterval(o,n,...l)},clearInterval(o){let{delegate:n}=kg;return(n?.clearInterval||clearInterval)(o)},delegate:void 0};var Av=class extends Mv{constructor(n,l){super(n,l),this.scheduler=n,this.work=l,this.pending=!1}schedule(n,l=0){var c;if(this.closed)return this;this.state=n;let f=this.id,i=this.scheduler;return f!=null&&(this.id=this.recycleAsyncId(i,f,l)),this.pending=!0,this.delay=l,this.id=(c=this.id)!==null&&c!==void 0?c:this.requestAsyncId(i,this.id,l),this}requestAsyncId(n,l,c=0){return kg.setInterval(n.flush.bind(n,this),c)}recycleAsyncId(n,l,c=0){if(c!=null&&this.delay===c&&this.pending===!1)return l;l!=null&&kg.clearInterval(l)}execute(n,l){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let c=this._execute(n,l);if(c)return c;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,l){let c=!1,f;try{this.work(n)}catch(i){c=!0,f=i||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),f}unsubscribe(){if(!this.closed){let{id:n,scheduler:l}=this,{actions:c}=l;this.work=this.state=this.scheduler=null,this.pending=!1,Eh(c,this),n!=null&&(this.id=this.recycleAsyncId(l,n,null)),this.delay=null,super.unsubscribe()}}};var zf=class o{constructor(n,l=o.now){this.schedulerActionCtor=n,this.now=l}schedule(n,l=0,c){return new this.schedulerActionCtor(this,n).schedule(c,l)}};zf.now=KT.now;var Pv=class extends zf{constructor(n,l=zf.now){super(n,l),this.actions=[],this._active=!1}flush(n){let{actions:l}=this;if(this._active){l.push(n);return}let c;this._active=!0;do if(c=n.execute(n.state,n.delay))break;while(n=l.shift());if(this._active=!1,c){for(;n=l.shift();)n.unsubscribe();throw c}}};var MP=new Pv(Av);var Bo=new ii(o=>o.complete());function AP(o){return o&&Pn(o.schedule)}function PP(o){return o[o.length-1]}function RP(o){return Pn(PP(o))?o.pop():void 0}function Nc(o){return AP(PP(o))?o.pop():void 0}function OP(o,n,l,c){function f(i){return i instanceof l?i:new l(function(w){w(i)})}return new(l||(l=Promise))(function(i,w){function C(U){try{L(c.next(U))}catch(Q){w(Q)}}function A(U){try{L(c.throw(U))}catch(Q){w(Q)}}function L(U){U.done?i(U.value):f(U.value).then(C,A)}L((c=c.apply(o,n||[])).next())})}function kP(o){var n=typeof Symbol=="function"&&Symbol.iterator,l=n&&o[n],c=0;if(l)return l.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&c>=o.length&&(o=void 0),{value:o&&o[c++],done:!o}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sh(o){return this instanceof Sh?(this.v=o,this):new Sh(o)}function LP(o,n,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=l.apply(o,n||[]),f,i=[];return f={},C("next"),C("throw"),C("return",w),f[Symbol.asyncIterator]=function(){return this},f;function w(he){return function(be){return Promise.resolve(be).then(he,Q)}}function C(he,be){c[he]&&(f[he]=function(Se){return new Promise(function(Ke,Fe){i.push([he,Se,Ke,Fe])>1||A(he,Se)})},be&&(f[he]=be(f[he])))}function A(he,be){try{L(c[he](be))}catch(Se){fe(i[0][3],Se)}}function L(he){he.value instanceof Sh?Promise.resolve(he.value.v).then(U,Q):fe(i[0][2],he)}function U(he){A("next",he)}function Q(he){A("throw",he)}function fe(he,be){he(be),i.shift(),i.length&&A(i[0][0],i[0][1])}}function FP(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=o[Symbol.asyncIterator],l;return n?n.call(o):(o=typeof kP=="function"?kP(o):o[Symbol.iterator](),l={},c("next"),c("throw"),c("return"),l[Symbol.asyncIterator]=function(){return this},l);function c(i){l[i]=o[i]&&function(w){return new Promise(function(C,A){w=o[i](w),f(C,A,w.done,w.value)})}}function f(i,w,C,A){Promise.resolve(A).then(function(L){i({value:L,done:C})},w)}}var Rv=o=>o&&typeof o.length=="number"&&typeof o!="function";function kv(o){return Pn(o?.then)}function Ov(o){return Pn(o[Lf])}function Lv(o){return Symbol.asyncIterator&&Pn(o?.[Symbol.asyncIterator])}function Fv(o){return new TypeError(`You provided ${o!==null&&typeof o=="object"?"an invalid object":`'${o}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function uj(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Nv=uj();function zv(o){return Pn(o?.[Nv])}function Bv(o){return LP(this,arguments,function*(){let l=o.getReader();try{for(;;){let{value:c,done:f}=yield Sh(l.read());if(f)return yield Sh(void 0);yield yield Sh(c)}}finally{l.releaseLock()}})}function Vv(o){return Pn(o?.getReader)}function er(o){if(o instanceof ii)return o;if(o!=null){if(Ov(o))return hj(o);if(Rv(o))return dj(o);if(kv(o))return fj(o);if(Lv(o))return NP(o);if(zv(o))return pj(o);if(Vv(o))return mj(o)}throw Fv(o)}function hj(o){return new ii(n=>{let l=o[Lf]();if(Pn(l.subscribe))return l.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function dj(o){return new ii(n=>{for(let l=0;l<o.length&&!n.closed;l++)n.next(o[l]);n.complete()})}function fj(o){return new ii(n=>{o.then(l=>{n.closed||(n.next(l),n.complete())},l=>n.error(l)).then(null,Cv)})}function pj(o){return new ii(n=>{for(let l of o)if(n.next(l),n.closed)return;n.complete()})}function NP(o){return new ii(n=>{gj(o,n).catch(l=>n.error(l))})}function mj(o){return NP(Bv(o))}function gj(o,n){var l,c,f,i;return OP(this,void 0,void 0,function*(){try{for(l=FP(o);c=yield l.next(),!c.done;){let w=c.value;if(n.next(w),n.closed)return}}catch(w){f={error:w}}finally{try{c&&!c.done&&(i=l.return)&&(yield i.call(l))}finally{if(f)throw f.error}}n.complete()})}function To(o,n,l,c=0,f=!1){let i=n.schedule(function(){l(),f?o.add(this.schedule(null,c)):this.unsubscribe()},c);if(o.add(i),!f)return i}function jv(o,n=0){return $n((l,c)=>{l.subscribe(Zn(c,f=>To(c,o,()=>c.next(f),n),()=>To(c,o,()=>c.complete(),n),f=>To(c,o,()=>c.error(f),n)))})}function Uv(o,n=0){return $n((l,c)=>{c.add(o.schedule(()=>l.subscribe(c),n))})}function zP(o,n){return er(o).pipe(Uv(n),jv(n))}function BP(o,n){return er(o).pipe(Uv(n),jv(n))}function VP(o,n){return new ii(l=>{let c=0;return n.schedule(function(){c===o.length?l.complete():(l.next(o[c++]),l.closed||this.schedule())})})}function jP(o,n){return new ii(l=>{let c;return To(l,n,()=>{c=o[Nv](),To(l,n,()=>{let f,i;try{({value:f,done:i}=c.next())}catch(w){l.error(w);return}i?l.complete():l.next(f)},0,!0)}),()=>Pn(c?.return)&&c.return()})}function $v(o,n){if(!o)throw new Error("Iterable cannot be null");return new ii(l=>{To(l,n,()=>{let c=o[Symbol.asyncIterator]();To(l,n,()=>{c.next().then(f=>{f.done?l.complete():l.next(f.value)})},0,!0)})})}function UP(o,n){return $v(Bv(o),n)}function $P(o,n){if(o!=null){if(Ov(o))return zP(o,n);if(Rv(o))return VP(o,n);if(kv(o))return BP(o,n);if(Lv(o))return $v(o,n);if(zv(o))return jP(o,n);if(Vv(o))return UP(o,n)}throw Fv(o)}function tr(o,n){return n?$P(o,n):er(o)}function un(...o){let n=Nc(o);return tr(o,n)}function ml(o,n){let l=Pn(o)?o:()=>o,c=f=>f.error(l());return new ii(n?f=>n.schedule(c,0,f):c)}function QT(o){return!!o&&(o instanceof ii||Pn(o.lift)&&Pn(o.subscribe))}var gl=Rf(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});function Dn(o,n){return $n((l,c)=>{let f=0;l.subscribe(Zn(c,i=>{c.next(o.call(n,i,f++))}))})}var{isArray:_j}=Array;function yj(o,n){return _j(n)?o(...n):o(n)}function GP(o){return Dn(n=>yj(o,n))}var{isArray:vj}=Array,{getPrototypeOf:xj,prototype:bj,keys:wj}=Object;function HP(o){if(o.length===1){let n=o[0];if(vj(n))return{args:n,keys:null};if(Tj(n)){let l=wj(n);return{args:l.map(c=>n[c]),keys:l}}}return{args:o,keys:null}}function Tj(o){return o&&typeof o=="object"&&xj(o)===bj}function qP(o,n){return o.reduce((l,c,f)=>(l[c]=n[f],l),{})}function Dh(...o){let n=Nc(o),l=RP(o),{args:c,keys:f}=HP(o);if(c.length===0)return tr([],n);let i=new ii(Ej(c,n,f?w=>qP(f,w):zo));return l?i.pipe(GP(l)):i}function Ej(o,n,l=zo){return c=>{WP(n,()=>{let{length:f}=o,i=new Array(f),w=f,C=f;for(let A=0;A<f;A++)WP(n,()=>{let L=tr(o[A],n),U=!1;L.subscribe(Zn(c,Q=>{i[A]=Q,U||(U=!0,C--),C||c.next(l(i.slice()))},()=>{--w||c.complete()}))},c)},c)}}function WP(o,n,l){o?To(l,o,n):n()}function ZP(o,n,l,c,f,i,w,C){let A=[],L=0,U=0,Q=!1,fe=()=>{Q&&!A.length&&!L&&n.complete()},he=Se=>L<c?be(Se):A.push(Se),be=Se=>{i&&n.next(Se),L++;let Ke=!1;er(l(Se,U++)).subscribe(Zn(n,Fe=>{f?.(Fe),i?he(Fe):n.next(Fe)},()=>{Ke=!0},void 0,()=>{if(Ke)try{for(L--;A.length&&L<c;){let Fe=A.shift();w?To(n,w,()=>be(Fe)):be(Fe)}fe()}catch(Fe){n.error(Fe)}}))};return o.subscribe(Zn(n,he,()=>{Q=!0,fe()})),()=>{C?.()}}function Tr(o,n,l=1/0){return Pn(n)?Tr((c,f)=>Dn((i,w)=>n(c,i,f,w))(er(o(c,f))),l):(typeof n=="number"&&(l=n),$n((c,f)=>ZP(c,f,o,l)))}function JT(o=1/0){return Tr(zo,o)}function YP(){return JT(1)}function zc(...o){return YP()(tr(o,Nc(o)))}function Gv(o){return new ii(n=>{er(o()).subscribe(n)})}function io(o,n){return $n((l,c)=>{let f=0;l.subscribe(Zn(c,i=>o.call(n,i,f++)&&c.next(i)))})}function va(o){return $n((n,l)=>{let c=null,f=!1,i;c=n.subscribe(Zn(l,void 0,void 0,w=>{i=er(o(w,va(o)(n))),c?(c.unsubscribe(),c=null,i.subscribe(l)):f=!0})),f&&(c.unsubscribe(),c=null,i.subscribe(l))})}function XP(o,n,l,c,f){return(i,w)=>{let C=l,A=n,L=0;i.subscribe(Zn(w,U=>{let Q=L++;A=C?o(A,U,Q):(C=!0,U),c&&w.next(A)},f&&(()=>{C&&w.next(A),w.complete()})))}}function Bc(o,n){return Pn(n)?Tr(o,n,1):Tr(o,1)}function eE(o,n=MP){return $n((l,c)=>{let f=null,i=null,w=null,C=()=>{if(f){f.unsubscribe(),f=null;let L=i;i=null,c.next(L)}};function A(){let L=w+o,U=n.now();if(U<L){f=this.schedule(void 0,L-U),c.add(f);return}C()}l.subscribe(Zn(c,L=>{i=L,w=n.now(),f||(f=n.schedule(A,o),c.add(f))},()=>{C(),c.complete()},void 0,()=>{i=f=null}))})}function Vc(o){return $n((n,l)=>{let c=!1;n.subscribe(Zn(l,f=>{c=!0,l.next(f)},()=>{c||l.next(o),l.complete()}))})}function Fs(o){return o<=0?()=>Bo:$n((n,l)=>{let c=0;n.subscribe(Zn(l,f=>{++c<=o&&(l.next(f),o<=c&&l.complete())}))})}function tE(o){return Dn(()=>o)}function Hv(o=Ij){return $n((n,l)=>{let c=!1;n.subscribe(Zn(l,f=>{c=!0,l.next(f)},()=>c?l.complete():l.error(o())))})}function Ij(){return new gl}function xa(o){return $n((n,l)=>{try{n.subscribe(l)}finally{l.add(o)}})}function ba(o,n){let l=arguments.length>=2;return c=>c.pipe(o?io((f,i)=>o(f,i,c)):zo,Fs(1),l?Vc(n):Hv(()=>new gl))}function Bf(o){return o<=0?()=>Bo:$n((n,l)=>{let c=[];n.subscribe(Zn(l,f=>{c.push(f),o<c.length&&c.shift()},()=>{for(let f of c)l.next(f);l.complete()},void 0,()=>{c=null}))})}function nE(o,n){let l=arguments.length>=2;return c=>c.pipe(o?io((f,i)=>o(f,i,c)):zo,Bf(1),l?Vc(n):Hv(()=>new gl))}function iE(o,n){return $n(XP(o,n,arguments.length>=2,!0))}function oE(o={}){let{connector:n=()=>new cr,resetOnError:l=!0,resetOnComplete:c=!0,resetOnRefCountZero:f=!0}=o;return i=>{let w,C,A,L=0,U=!1,Q=!1,fe=()=>{C?.unsubscribe(),C=void 0},he=()=>{fe(),w=A=void 0,U=Q=!1},be=()=>{let Se=w;he(),Se?.unsubscribe()};return $n((Se,Ke)=>{L++,!Q&&!U&&fe();let Fe=A=A??n();Ke.add(()=>{L--,L===0&&!Q&&!U&&(C=rE(be,f))}),Fe.subscribe(Ke),!w&&L>0&&(w=new pl({next:tt=>Fe.next(tt),error:tt=>{Q=!0,fe(),C=rE(he,l,tt),Fe.error(tt)},complete:()=>{U=!0,fe(),C=rE(he,c),Fe.complete()}}),er(Se).subscribe(w))})(i)}}function rE(o,n,...l){if(n===!0){o();return}if(n===!1)return;let c=new pl({next:()=>{c.unsubscribe(),o()}});return er(n(...l)).subscribe(c)}function sE(o){return io((n,l)=>o<=l)}function Og(...o){let n=Nc(o);return $n((l,c)=>{(n?zc(o,l,n):zc(o,l)).subscribe(c)})}function Eo(o,n){return $n((l,c)=>{let f=null,i=0,w=!1,C=()=>w&&!f&&c.complete();l.subscribe(Zn(c,A=>{f?.unsubscribe();let L=0,U=i++;er(o(A,U)).subscribe(f=Zn(c,Q=>c.next(n?n(A,Q,U,L++):Q),()=>{f=null,C()}))},()=>{w=!0,C()}))})}function Lg(o){return $n((n,l)=>{er(o).subscribe(Zn(l,()=>l.complete(),Rg)),!l.closed&&n.subscribe(l)})}function ur(o,n,l){let c=Pn(o)||n||l?{next:o,error:n,complete:l}:o;return c?$n((f,i)=>{var w;(w=c.subscribe)===null||w===void 0||w.call(c);let C=!0;f.subscribe(Zn(i,A=>{var L;(L=c.next)===null||L===void 0||L.call(c,A),i.next(A)},()=>{var A;C=!1,(A=c.complete)===null||A===void 0||A.call(c),i.complete()},A=>{var L;C=!1,(L=c.error)===null||L===void 0||L.call(c,A),i.error(A)},()=>{var A,L;C&&((A=c.unsubscribe)===null||A===void 0||A.call(c)),(L=c.finalize)===null||L===void 0||L.call(c)}))}):zo}var NR="https://g.co/ng/security#xss",bt=class extends Error{constructor(n,l){super(bx(n,l)),this.code=n}};function bx(o,n){return`${`NG0${Math.abs(o)}`}${n?": "+n:""}`}var zR=Symbol("InputSignalNode#UNSET"),Cj=oi(gt({},jT),{transformFn:void 0,applyValueToInputSignal(o,n){Tv(o,n)}});function BR(o,n){let l=Object.create(Cj);l.value=o,l.transformFn=n?.transform;function c(){if(NT(l),l.value===zR)throw new bt(-950,!1);return l.value}return c[Fc]=l,c}function Wg(o){return{toString:o}.toString()}var qv="__parameters__";function Sj(o){return function(...l){if(o){let c=o(...l);for(let f in c)this[f]=c[f]}}}function VR(o,n,l){return Wg(()=>{let c=Sj(n);function f(...i){if(this instanceof f)return c.apply(this,i),this;let w=new f(...i);return C.annotation=w,C;function C(A,L,U){let Q=A.hasOwnProperty(qv)?A[qv]:Object.defineProperty(A,qv,{value:[]})[qv];for(;Q.length<=U;)Q.push(null);return(Q[U]=Q[U]||[]).push(w),A}}return l&&(f.prototype=Object.create(l.prototype)),f.prototype.ngMetadataName=o,f.annotationCls=f,f})}var Mh=globalThis;function Di(o){for(let n in o)if(o[n]===Di)return n;throw Error("Could not find renamed property on target object.")}function oo(o){if(typeof o=="string")return o;if(Array.isArray(o))return"["+o.map(oo).join(", ")+"]";if(o==null)return""+o;if(o.overriddenName)return`${o.overriddenName}`;if(o.name)return`${o.name}`;let n=o.toString();if(n==null)return""+n;let l=n.indexOf(`
`);return l===-1?n:n.substring(0,l)}function KP(o,n){return o==null||o===""?n===null?"":n:n==null||n===""?o:o+" "+n}var Dj=Di({__forward_ref__:Di});function jR(o){return o.__forward_ref__=jR,o.toString=function(){return oo(this())},o}function ro(o){return UR(o)?o():o}function UR(o){return typeof o=="function"&&o.hasOwnProperty(Dj)&&o.__forward_ref__===jR}function At(o){return{token:o.token,providedIn:o.providedIn||null,factory:o.factory,value:void 0}}function Rr(o){return{providers:o.providers||[],imports:o.imports||[]}}function wx(o){return QP(o,GR)||QP(o,HR)}function $R(o){return wx(o)!==null}function QP(o,n){return o.hasOwnProperty(n)?o[n]:null}function Mj(o){let n=o&&(o[GR]||o[HR]);return n||null}function JP(o){return o&&(o.hasOwnProperty(eR)||o.hasOwnProperty(Aj))?o[eR]:null}var GR=Di({\u0275prov:Di}),eR=Di({\u0275inj:Di}),HR=Di({ngInjectableDef:Di}),Aj=Di({ngInjectorDef:Di}),an=class{constructor(n,l){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof l=="number"?this.__NG_ELEMENT_ID__=l:l!==void 0&&(this.\u0275prov=At({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function qR(o){return o&&!!o.\u0275providers}var Pj=Di({\u0275cmp:Di}),Rj=Di({\u0275dir:Di}),kj=Di({\u0275pipe:Di}),Oj=Di({\u0275mod:Di}),nx=Di({\u0275fac:Di}),Fg=Di({__NG_ELEMENT_ID__:Di}),tR=Di({__NG_ENV_ID__:Di});function Ah(o){return typeof o=="string"?o:o==null?"":String(o)}function Lj(o){return typeof o=="function"?o.name||o.toString():typeof o=="object"&&o!=null&&typeof o.type=="function"?o.type.name||o.type.toString():Ah(o)}function Fj(o,n){let l=n?`. Dependency path: ${n.join(" > ")} > ${o}`:"";throw new bt(-200,o)}function yI(o,n){throw new bt(-201,!1)}var Gn=function(o){return o[o.Default=0]="Default",o[o.Host=1]="Host",o[o.Self=2]="Self",o[o.SkipSelf=4]="SkipSelf",o[o.Optional=8]="Optional",o}(Gn||{}),bE;function WR(){return bE}function cs(o){let n=bE;return bE=o,n}function ZR(o,n,l){let c=wx(o);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(l&Gn.Optional)return null;if(n!==void 0)return n;yI(o,"Injector")}var Nj={},Ng=Nj,wE="__NG_DI_FLAG__",ix="ngTempTokenPath",zj="ngTokenPath",Bj=/\n/gm,Vj="\u0275",nR="__source",Gf;function jj(){return Gf}function jc(o){let n=Gf;return Gf=o,n}function Uj(o,n=Gn.Default){if(Gf===void 0)throw new bt(-203,!1);return Gf===null?ZR(o,void 0,n):Gf.get(o,n&Gn.Optional?null:void 0,n)}function Vt(o,n=Gn.Default){return(WR()||Uj)(ro(o),n)}function vt(o,n=Gn.Default){return Vt(o,Tx(n))}function Tx(o){return typeof o>"u"||typeof o=="number"?o:0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)}function TE(o){let n=[];for(let l=0;l<o.length;l++){let c=ro(o[l]);if(Array.isArray(c)){if(c.length===0)throw new bt(900,!1);let f,i=Gn.Default;for(let w=0;w<c.length;w++){let C=c[w],A=$j(C);typeof A=="number"?A===-1?f=C.token:i|=A:f=C}n.push(Vt(f,i))}else n.push(Vt(c))}return n}function YR(o,n){return o[wE]=n,o.prototype[wE]=n,o}function $j(o){return o[wE]}function Gj(o,n,l,c){let f=o[ix];throw n[nR]&&f.unshift(n[nR]),o.message=Hj(`
`+o.message,f,l,c),o[zj]=f,o[ix]=null,o}function Hj(o,n,l,c=null){o=o&&o.charAt(0)===`
`&&o.charAt(1)==Vj?o.slice(2):o;let f=oo(n);if(Array.isArray(n))f=n.map(oo).join(" -> ");else if(typeof n=="object"){let i=[];for(let w in n)if(n.hasOwnProperty(w)){let C=n[w];i.push(w+":"+(typeof C=="string"?JSON.stringify(C):oo(C)))}f=`{${i.join(", ")}}`}return`${l}${c?"("+c+")":""}[${f}]: ${o.replace(Bj,`
  `)}`}var tp=YR(VR("Optional"),8);var Zg=YR(VR("SkipSelf"),4);function qf(o,n){let l=o.hasOwnProperty(nx);return l?o[nx]:null}function qj(o,n,l){if(o.length!==n.length)return!1;for(let c=0;c<o.length;c++){let f=o[c],i=n[c];if(l&&(f=l(f),i=l(i)),i!==f)return!1}return!0}function Wj(o){return o.flat(Number.POSITIVE_INFINITY)}function vI(o,n){o.forEach(l=>Array.isArray(l)?vI(l,n):n(l))}function XR(o,n,l){n>=o.length?o.push(l):o.splice(n,0,l)}function rx(o,n){return n>=o.length-1?o.pop():o.splice(n,1)[0]}function Zj(o,n){let l=[];for(let c=0;c<o;c++)l.push(n);return l}function Yj(o,n,l,c){let f=o.length;if(f==n)o.push(l,c);else if(f===1)o.push(c,o[0]),o[0]=l;else{for(f--,o.push(o[f-1],o[f]);f>n;){let i=f-2;o[f]=o[i],f--}o[n]=l,o[n+1]=c}}function Xj(o,n,l){let c=Yg(o,n);return c>=0?o[c|1]=l:(c=~c,Yj(o,c,n,l)),c}function aE(o,n){let l=Yg(o,n);if(l>=0)return o[l|1]}function Yg(o,n){return Kj(o,n,1)}function Kj(o,n,l){let c=0,f=o.length>>l;for(;f!==c;){let i=c+(f-c>>1),w=o[i<<l];if(n===w)return i<<l;w>n?f=i:c=i+1}return~(f<<l)}var zg={},zs=[],Wf=new an(""),KR=new an("",-1),QR=new an(""),ox=class{get(n,l=Ng){if(l===Ng){let c=new Error(`NullInjectorError: No provider for ${oo(n)}!`);throw c.name="NullInjectorError",c}return l}},JR=function(o){return o[o.OnPush=0]="OnPush",o[o.Default=1]="Default",o}(JR||{}),Ea=function(o){return o[o.Emulated=0]="Emulated",o[o.None=2]="None",o[o.ShadowDom=3]="ShadowDom",o}(Ea||{}),Ni=function(o){return o[o.None=0]="None",o[o.SignalBased=1]="SignalBased",o[o.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",o}(Ni||{});function Qj(o,n,l){let c=o.length;for(;;){let f=o.indexOf(n,l);if(f===-1)return f;if(f===0||o.charCodeAt(f-1)<=32){let i=n.length;if(f+i===c||o.charCodeAt(f+i)<=32)return f}l=f+1}}function EE(o,n,l){let c=0;for(;c<l.length;){let f=l[c];if(typeof f=="number"){if(f!==0)break;c++;let i=l[c++],w=l[c++],C=l[c++];o.setAttribute(n,w,C,i)}else{let i=f,w=l[++c];Jj(i)?o.setProperty(n,i,w):o.setAttribute(n,i,w),c++}}return c}function ek(o){return o===3||o===4||o===6}function Jj(o){return o.charCodeAt(0)===64}function xI(o,n){if(!(n===null||n.length===0))if(o===null||o.length===0)o=n.slice();else{let l=-1;for(let c=0;c<n.length;c++){let f=n[c];typeof f=="number"?l=f:l===0||(l===-1||l===2?iR(o,l,f,null,n[++c]):iR(o,l,f,null,null))}}return o}function iR(o,n,l,c,f){let i=0,w=o.length;if(n===-1)w=-1;else for(;i<o.length;){let C=o[i++];if(typeof C=="number"){if(C===n){w=-1;break}else if(C>n){w=i-1;break}}}for(;i<o.length;){let C=o[i];if(typeof C=="number")break;if(C===l){if(c===null){f!==null&&(o[i+1]=f);return}else if(c===o[i+1]){o[i+2]=f;return}}i++,c!==null&&i++,f!==null&&i++}w!==-1&&(o.splice(w,0,n),i=w+1),o.splice(i++,0,l),c!==null&&o.splice(i++,0,c),f!==null&&o.splice(i++,0,f)}var tk="ng-template";function eU(o,n,l,c){let f=0;if(c){for(;f<n.length&&typeof n[f]=="string";f+=2)if(n[f]==="class"&&Qj(n[f+1].toLowerCase(),l,0)!==-1)return!0}else if(bI(o))return!1;if(f=n.indexOf(1,f),f>-1){let i;for(;++f<n.length&&typeof(i=n[f])=="string";)if(i.toLowerCase()===l)return!0}return!1}function bI(o){return o.type===4&&o.value!==tk}function tU(o,n,l){let c=o.type===4&&!l?tk:o.value;return n===c}function nU(o,n,l){let c=4,f=o.attrs,i=f!==null?oU(f):0,w=!1;for(let C=0;C<n.length;C++){let A=n[C];if(typeof A=="number"){if(!w&&!Ns(c)&&!Ns(A))return!1;if(w&&Ns(A))continue;w=!1,c=A|c&1;continue}if(!w)if(c&4){if(c=2|c&1,A!==""&&!tU(o,A,l)||A===""&&n.length===1){if(Ns(c))return!1;w=!0}}else if(c&8){if(f===null||!eU(o,f,A,l)){if(Ns(c))return!1;w=!0}}else{let L=n[++C],U=iU(A,f,bI(o),l);if(U===-1){if(Ns(c))return!1;w=!0;continue}if(L!==""){let Q;if(U>i?Q="":Q=f[U+1].toLowerCase(),c&2&&L!==Q){if(Ns(c))return!1;w=!0}}}}return Ns(c)||w}function Ns(o){return(o&1)===0}function iU(o,n,l,c){if(n===null)return-1;let f=0;if(c||!l){let i=!1;for(;f<n.length;){let w=n[f];if(w===o)return f;if(w===3||w===6)i=!0;else if(w===1||w===2){let C=n[++f];for(;typeof C=="string";)C=n[++f];continue}else{if(w===4)break;if(w===0){f+=4;continue}}f+=i?1:2}return-1}else return sU(n,o)}function nk(o,n,l=!1){for(let c=0;c<n.length;c++)if(nU(o,n[c],l))return!0;return!1}function rU(o){let n=o.attrs;if(n!=null){let l=n.indexOf(5);if(!(l&1))return n[l+1]}return null}function oU(o){for(let n=0;n<o.length;n++){let l=o[n];if(ek(l))return n}return o.length}function sU(o,n){let l=o.indexOf(4);if(l>-1)for(l++;l<o.length;){let c=o[l];if(typeof c=="number")return-1;if(c===n)return l;l++}return-1}function aU(o,n){e:for(let l=0;l<n.length;l++){let c=n[l];if(o.length===c.length){for(let f=0;f<o.length;f++)if(o[f]!==c[f])continue e;return!0}}return!1}function rR(o,n){return o?":not("+n.trim()+")":n}function lU(o){let n=o[0],l=1,c=2,f="",i=!1;for(;l<o.length;){let w=o[l];if(typeof w=="string")if(c&2){let C=o[++l];f+="["+w+(C.length>0?'="'+C+'"':"")+"]"}else c&8?f+="."+w:c&4&&(f+=" "+w);else f!==""&&!Ns(w)&&(n+=rR(i,f),f=""),c=w,i=i||!Ns(c);l++}return f!==""&&(n+=rR(i,f)),n}function cU(o){return o.map(lU).join(",")}function uU(o){let n=[],l=[],c=1,f=2;for(;c<o.length;){let i=o[c];if(typeof i=="string")f===2?i!==""&&n.push(i,o[++c]):f===8&&l.push(i);else{if(!Ns(f))break;f=i}c++}return{attrs:n,classes:l}}function yi(o){return Wg(()=>{let n=ak(o),l=oi(gt({},n),{decls:o.decls,vars:o.vars,template:o.template,consts:o.consts||null,ngContentSelectors:o.ngContentSelectors,onPush:o.changeDetection===JR.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&o.dependencies||null,getStandaloneInjector:null,signals:o.signals??!1,data:o.data||{},encapsulation:o.encapsulation||Ea.Emulated,styles:o.styles||zs,_:null,schemas:o.schemas||null,tView:null,id:""});lk(l);let c=o.dependencies;return l.directiveDefs=sR(c,!1),l.pipeDefs=sR(c,!0),l.id=fU(l),l})}function hU(o){return $c(o)||ik(o)}function dU(o){return o!==null}function kr(o){return Wg(()=>({type:o.type,bootstrap:o.bootstrap||zs,declarations:o.declarations||zs,imports:o.imports||zs,exports:o.exports||zs,transitiveCompileScopes:null,schemas:o.schemas||null,id:o.id||null}))}function oR(o,n){if(o==null)return zg;let l={};for(let c in o)if(o.hasOwnProperty(c)){let f=o[c],i,w,C=Ni.None;Array.isArray(f)?(C=f[0],i=f[1],w=f[2]??i):(i=f,w=f),n?(l[i]=C!==Ni.None?[c,C]:c,n[i]=w):l[i]=c}return l}function us(o){return Wg(()=>{let n=ak(o);return lk(n),n})}function $c(o){return o[Pj]||null}function ik(o){return o[Rj]||null}function rk(o){return o[kj]||null}function ok(o){let n=$c(o)||ik(o)||rk(o);return n!==null?n.standalone:!1}function sk(o,n){let l=o[Oj]||null;if(!l&&n===!0)throw new Error(`Type ${oo(o)} does not have '\u0275mod' property.`);return l}function ak(o){let n={};return{type:o.type,providersResolver:null,factory:null,hostBindings:o.hostBindings||null,hostVars:o.hostVars||0,hostAttrs:o.hostAttrs||null,contentQueries:o.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:o.inputs||zg,exportAs:o.exportAs||null,standalone:o.standalone===!0,signals:o.signals===!0,selectors:o.selectors||zs,viewQuery:o.viewQuery||null,features:o.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:oR(o.inputs,n),outputs:oR(o.outputs),debugInfo:null}}function lk(o){o.features?.forEach(n=>n(o))}function sR(o,n){if(!o)return null;let l=n?rk:hU;return()=>(typeof o=="function"?o():o).map(c=>l(c)).filter(dU)}function fU(o){let n=0,l=[o.selectors,o.ngContentSelectors,o.hostVars,o.hostAttrs,o.consts,o.vars,o.decls,o.encapsulation,o.standalone,o.signals,o.exportAs,JSON.stringify(o.inputs),JSON.stringify(o.outputs),Object.getOwnPropertyNames(o.type.prototype),!!o.contentQueries,!!o.viewQuery].join("|");for(let f of l)n=Math.imul(31,n)+f.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function Zc(o){return{\u0275providers:o}}function pU(...o){return{\u0275providers:ck(!0,o),\u0275fromNgModule:!0}}function ck(o,...n){let l=[],c=new Set,f,i=w=>{l.push(w)};return vI(n,w=>{let C=w;IE(C,i,[],c)&&(f||=[],f.push(C))}),f!==void 0&&uk(f,i),l}function uk(o,n){for(let l=0;l<o.length;l++){let{ngModule:c,providers:f}=o[l];wI(f,i=>{n(i,c)})}}function IE(o,n,l,c){if(o=ro(o),!o)return!1;let f=null,i=JP(o),w=!i&&$c(o);if(!i&&!w){let A=o.ngModule;if(i=JP(A),i)f=A;else return!1}else{if(w&&!w.standalone)return!1;f=o}let C=c.has(f);if(w){if(C)return!1;if(c.add(f),w.dependencies){let A=typeof w.dependencies=="function"?w.dependencies():w.dependencies;for(let L of A)IE(L,n,l,c)}}else if(i){if(i.imports!=null&&!C){c.add(f);let L;try{vI(i.imports,U=>{IE(U,n,l,c)&&(L||=[],L.push(U))})}finally{}L!==void 0&&uk(L,n)}if(!C){let L=qf(f)||(()=>new f);n({provide:f,useFactory:L,deps:zs},f),n({provide:QR,useValue:f,multi:!0},f),n({provide:Wf,useValue:()=>Vt(f),multi:!0},f)}let A=i.providers;if(A!=null&&!C){let L=o;wI(A,U=>{n(U,L)})}}else return!1;return f!==o&&o.providers!==void 0}function wI(o,n){for(let l of o)qR(l)&&(l=l.\u0275providers),Array.isArray(l)?wI(l,n):n(l)}var mU=Di({provide:String,useValue:Di});function hk(o){return o!==null&&typeof o=="object"&&mU in o}function gU(o){return!!(o&&o.useExisting)}function _U(o){return!!(o&&o.useFactory)}function Zf(o){return typeof o=="function"}function yU(o){return!!o.useClass}var Ex=new an(""),Yv={},vU={},lE;function TI(){return lE===void 0&&(lE=new ox),lE}var Io=class{},Bg=class extends Io{get destroyed(){return this._destroyed}constructor(n,l,c,f){super(),this.parent=l,this.source=c,this.scopes=f,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,SE(n,w=>this.processProvider(w)),this.records.set(KR,Vf(void 0,this)),f.has("environment")&&this.records.set(Io,Vf(void 0,this));let i=this.records.get(Ex);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(QR,zs,Gn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let n=di(null);try{for(let c of this._ngOnDestroyHooks)c.ngOnDestroy();let l=this._onDestroyHooks;this._onDestroyHooks=[];for(let c of l)c()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),di(n)}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();let l=jc(this),c=cs(void 0),f;try{return n()}finally{jc(l),cs(c)}}get(n,l=Ng,c=Gn.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(tR))return n[tR](this);c=Tx(c);let f,i=jc(this),w=cs(void 0);try{if(!(c&Gn.SkipSelf)){let A=this.records.get(n);if(A===void 0){let L=EU(n)&&wx(n);L&&this.injectableDefInScope(L)?A=Vf(CE(n),Yv):A=null,this.records.set(n,A)}if(A!=null)return this.hydrate(n,A)}let C=c&Gn.Self?TI():this.parent;return l=c&Gn.Optional&&l===Ng?null:l,C.get(n,l)}catch(C){if(C.name==="NullInjectorError"){if((C[ix]=C[ix]||[]).unshift(oo(n)),i)throw C;return Gj(C,n,"R3InjectorError",this.source)}else throw C}finally{cs(w),jc(i)}}resolveInjectorInitializers(){let n=di(null),l=jc(this),c=cs(void 0),f;try{let i=this.get(Wf,zs,Gn.Self);for(let w of i)w()}finally{jc(l),cs(c),di(n)}}toString(){let n=[],l=this.records;for(let c of l.keys())n.push(oo(c));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new bt(205,!1)}processProvider(n){n=ro(n);let l=Zf(n)?n:ro(n&&n.provide),c=bU(n);if(!Zf(n)&&n.multi===!0){let f=this.records.get(l);f||(f=Vf(void 0,Yv,!0),f.factory=()=>TE(f.multi),this.records.set(l,f)),l=n,f.multi.push(n)}this.records.set(l,c)}hydrate(n,l){let c=di(null);try{return l.value===Yv&&(l.value=vU,l.value=l.factory()),typeof l.value=="object"&&l.value&&TU(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}finally{di(c)}}injectableDefInScope(n){if(!n.providedIn)return!1;let l=ro(n.providedIn);return typeof l=="string"?l==="any"||this.scopes.has(l):this.injectorDefTypes.has(l)}removeOnDestroy(n){let l=this._onDestroyHooks.indexOf(n);l!==-1&&this._onDestroyHooks.splice(l,1)}};function CE(o){let n=wx(o),l=n!==null?n.factory:qf(o);if(l!==null)return l;if(o instanceof an)throw new bt(204,!1);if(o instanceof Function)return xU(o);throw new bt(204,!1)}function xU(o){if(o.length>0)throw new bt(204,!1);let l=Mj(o);return l!==null?()=>l.factory(o):()=>new o}function bU(o){if(hk(o))return Vf(void 0,o.useValue);{let n=dk(o);return Vf(n,Yv)}}function dk(o,n,l){let c;if(Zf(o)){let f=ro(o);return qf(f)||CE(f)}else if(hk(o))c=()=>ro(o.useValue);else if(_U(o))c=()=>o.useFactory(...TE(o.deps||[]));else if(gU(o))c=()=>Vt(ro(o.useExisting));else{let f=ro(o&&(o.useClass||o.provide));if(wU(o))c=()=>new f(...TE(o.deps));else return qf(f)||CE(f)}return c}function Vf(o,n,l=!1){return{factory:o,value:n,multi:l?[]:void 0}}function wU(o){return!!o.deps}function TU(o){return o!==null&&typeof o=="object"&&typeof o.ngOnDestroy=="function"}function EU(o){return typeof o=="function"||typeof o=="object"&&o instanceof an}function SE(o,n){for(let l of o)Array.isArray(l)?SE(l,n):l&&qR(l)?SE(l.\u0275providers,n):n(l)}function Gs(o,n){o instanceof Bg&&o.assertNotDestroyed();let l,c=jc(o),f=cs(void 0);try{return n()}finally{jc(c),cs(f)}}function fk(){return WR()!==void 0||jj()!=null}function pk(o){if(!fk())throw new bt(-203,!1)}function IU(o){return typeof o=="function"}var yl=0,jn=1,gn=2,jr=3,Bs=4,jo=5,Vg=6,jg=7,Vs=8,Yf=9,js=10,hr=11,Ug=12,aR=13,np=14,Us=15,Xg=16,jf=17,_l=18,Ix=19,mk=20,Uc=21,Xv=22,kh=23,Ia=25,gk=1;var Oh=7,sx=8,Xf=9,Vo=10,EI=function(o){return o[o.None=0]="None",o[o.HasTransplantedViews=2]="HasTransplantedViews",o}(EI||{});function Ph(o){return Array.isArray(o)&&typeof o[gk]=="object"}function vl(o){return Array.isArray(o)&&o[gk]===!0}function II(o){return(o.flags&4)!==0}function Cx(o){return o.componentOffset>-1}function Sx(o){return(o.flags&1)===1}function ip(o){return!!o.template}function CU(o){return(o[gn]&512)!==0}var DE=class{constructor(n,l,c){this.previousValue=n,this.currentValue=l,this.firstChange=c}isFirstChange(){return this.firstChange}};function _k(o,n,l,c){n!==null?n.applyValueToInputSignal(n,c):o[l]=c}function xl(){return yk}function yk(o){return o.type.prototype.ngOnChanges&&(o.setInput=DU),SU}xl.ngInherit=!0;function SU(){let o=xk(this),n=o?.current;if(n){let l=o.previous;if(l===zg)o.previous=n;else for(let c in n)l[c]=n[c];o.current=null,this.ngOnChanges(n)}}function DU(o,n,l,c,f){let i=this.declaredInputs[c],w=xk(o)||MU(o,{previous:zg,current:null}),C=w.current||(w.current={}),A=w.previous,L=A[i];C[i]=new DE(L&&L.currentValue,l,A===zg),_k(o,n,f,l)}var vk="__ngSimpleChanges__";function xk(o){return o[vk]||null}function MU(o,n){return o[vk]=n}var lR=null;var wa=function(o,n,l){lR?.(o,n,l)},bk="svg",AU="math",PU=!1;function RU(){return PU}function Ca(o){for(;Array.isArray(o);)o=o[yl];return o}function wk(o,n){return Ca(n[o])}function hs(o,n){return Ca(n[o.index])}function Tk(o,n){return o.data[n]}function Yc(o,n){let l=n[o];return Ph(l)?l:l[yl]}function kU(o){return(o[gn]&4)===4}function CI(o){return(o[gn]&128)===128}function OU(o){return vl(o[jr])}function Kf(o,n){return n==null?null:o[n]}function Ek(o){o[jf]=0}function LU(o){o[gn]&1024||(o[gn]|=1024,CI(o)&&$g(o))}function FU(o,n){for(;o>0;)n=n[np],o--;return n}function SI(o){return!!(o[gn]&9216||o[kh]?.dirty)}function ME(o){o[js].changeDetectionScheduler?.notify(1),SI(o)?$g(o):o[gn]&64&&(RU()?(o[gn]|=1024,$g(o)):o[js].changeDetectionScheduler?.notify())}function $g(o){o[js].changeDetectionScheduler?.notify();let n=Gg(o);for(;n!==null&&!(n[gn]&8192||(n[gn]|=8192,!CI(n)));)n=Gg(n)}function Ik(o,n){if((o[gn]&256)===256)throw new bt(911,!1);o[Uc]===null&&(o[Uc]=[]),o[Uc].push(n)}function NU(o,n){if(o[Uc]===null)return;let l=o[Uc].indexOf(n);l!==-1&&o[Uc].splice(l,1)}function Gg(o){let n=o[jr];return vl(n)?n[jr]:n}var zn={lFrame:kk(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function zU(){return zn.lFrame.elementDepthCount}function BU(){zn.lFrame.elementDepthCount++}function VU(){zn.lFrame.elementDepthCount--}function Ck(){return zn.bindingsEnabled}function Sk(){return zn.skipHydrationRootTNode!==null}function jU(o){return zn.skipHydrationRootTNode===o}function UU(){zn.skipHydrationRootTNode=null}function ei(){return zn.lFrame.lView}function Ur(){return zn.lFrame.tView}function Kg(o){return zn.lFrame.contextLView=o,o[Vs]}function Qg(o){return zn.lFrame.contextLView=null,o}function so(){let o=Dk();for(;o!==null&&o.type===64;)o=o.parent;return o}function Dk(){return zn.lFrame.currentTNode}function $U(){let o=zn.lFrame,n=o.currentTNode;return o.isParent?n:n.parent}function jh(o,n){let l=zn.lFrame;l.currentTNode=o,l.isParent=n}function DI(){return zn.lFrame.isParent}function MI(){zn.lFrame.isParent=!1}function AI(){let o=zn.lFrame,n=o.bindingRootIndex;return n===-1&&(n=o.bindingRootIndex=o.tView.bindingStartIndex),n}function GU(){return zn.lFrame.bindingIndex}function HU(o){return zn.lFrame.bindingIndex=o}function PI(){return zn.lFrame.bindingIndex++}function Mk(o){let n=zn.lFrame,l=n.bindingIndex;return n.bindingIndex=n.bindingIndex+o,l}function qU(){return zn.lFrame.inI18n}function WU(o,n){let l=zn.lFrame;l.bindingIndex=l.bindingRootIndex=o,AE(n)}function ZU(){return zn.lFrame.currentDirectiveIndex}function AE(o){zn.lFrame.currentDirectiveIndex=o}function YU(o){let n=zn.lFrame.currentDirectiveIndex;return n===-1?null:o[n]}function Ak(){return zn.lFrame.currentQueryIndex}function RI(o){zn.lFrame.currentQueryIndex=o}function XU(o){let n=o[jn];return n.type===2?n.declTNode:n.type===1?o[jo]:null}function Pk(o,n,l){if(l&Gn.SkipSelf){let f=n,i=o;for(;f=f.parent,f===null&&!(l&Gn.Host);)if(f=XU(i),f===null||(i=i[np],f.type&10))break;if(f===null)return!1;n=f,o=i}let c=zn.lFrame=Rk();return c.currentTNode=n,c.lView=o,!0}function kI(o){let n=Rk(),l=o[jn];zn.lFrame=n,n.currentTNode=l.firstChild,n.lView=o,n.tView=l,n.contextLView=o,n.bindingIndex=l.bindingStartIndex,n.inI18n=!1}function Rk(){let o=zn.lFrame,n=o===null?null:o.child;return n===null?kk(o):n}function kk(o){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:o,child:null,inI18n:!1};return o!==null&&(o.child=n),n}function Ok(){let o=zn.lFrame;return zn.lFrame=o.parent,o.currentTNode=null,o.lView=null,o}var Lk=Ok;function OI(){let o=Ok();o.isParent=!0,o.tView=null,o.selectedIndex=-1,o.contextLView=null,o.elementDepthCount=0,o.currentDirectiveIndex=-1,o.currentNamespace=null,o.bindingRootIndex=-1,o.bindingIndex=-1,o.currentQueryIndex=0}function KU(o){return(zn.lFrame.contextLView=FU(o,zn.lFrame.contextLView))[Vs]}function Uh(){return zn.lFrame.selectedIndex}function Lh(o){zn.lFrame.selectedIndex=o}function LI(){let o=zn.lFrame;return Tk(o.tView,o.selectedIndex)}function Fk(){zn.lFrame.currentNamespace=bk}function QU(){return zn.lFrame.currentNamespace}var Nk=!0;function Dx(){return Nk}function Mx(o){Nk=o}function JU(o,n,l){let{ngOnChanges:c,ngOnInit:f,ngDoCheck:i}=n.type.prototype;if(c){let w=yk(n);(l.preOrderHooks??=[]).push(o,w),(l.preOrderCheckHooks??=[]).push(o,w)}f&&(l.preOrderHooks??=[]).push(0-o,f),i&&((l.preOrderHooks??=[]).push(o,i),(l.preOrderCheckHooks??=[]).push(o,i))}function Ax(o,n){for(let l=n.directiveStart,c=n.directiveEnd;l<c;l++){let i=o.data[l].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:C,ngAfterViewInit:A,ngAfterViewChecked:L,ngOnDestroy:U}=i;w&&(o.contentHooks??=[]).push(-l,w),C&&((o.contentHooks??=[]).push(l,C),(o.contentCheckHooks??=[]).push(l,C)),A&&(o.viewHooks??=[]).push(-l,A),L&&((o.viewHooks??=[]).push(l,L),(o.viewCheckHooks??=[]).push(l,L)),U!=null&&(o.destroyHooks??=[]).push(l,U)}}function Kv(o,n,l){zk(o,n,3,l)}function Qv(o,n,l,c){(o[gn]&3)===l&&zk(o,n,l,c)}function cE(o,n){let l=o[gn];(l&3)===n&&(l&=16383,l+=1,o[gn]=l)}function zk(o,n,l,c){let f=c!==void 0?o[jf]&65535:0,i=c??-1,w=n.length-1,C=0;for(let A=f;A<w;A++)if(typeof n[A+1]=="number"){if(C=n[A],c!=null&&C>=c)break}else n[A]<0&&(o[jf]+=65536),(C<i||i==-1)&&(e6(o,l,n,A),o[jf]=(o[jf]&4294901760)+A+2),A++}function cR(o,n){wa(4,o,n);let l=di(null);try{n.call(o)}finally{di(l),wa(5,o,n)}}function e6(o,n,l,c){let f=l[c]<0,i=l[c+1],w=f?-l[c]:l[c],C=o[w];f?o[gn]>>14<o[jf]>>16&&(o[gn]&3)===n&&(o[gn]+=16384,cR(C,i)):cR(C,i)}var Hf=-1,Fh=class{constructor(n,l,c){this.factory=n,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=c}};function t6(o){return o instanceof Fh}function n6(o){return(o.flags&8)!==0}function i6(o){return(o.flags&16)!==0}function Bk(o){return o!==Hf}function ax(o){return o&32767}function r6(o){return o>>16}function lx(o,n){let l=r6(o),c=n;for(;l>0;)c=c[np],l--;return c}var PE=!0;function uR(o){let n=PE;return PE=o,n}var o6=256,Vk=o6-1,jk=5,s6=0,Ta={};function a6(o,n,l){let c;typeof l=="string"?c=l.charCodeAt(0)||0:l.hasOwnProperty(Fg)&&(c=l[Fg]),c==null&&(c=l[Fg]=s6++);let f=c&Vk,i=1<<f;n.data[o+(f>>jk)]|=i}function cx(o,n){let l=Uk(o,n);if(l!==-1)return l;let c=n[jn];c.firstCreatePass&&(o.injectorIndex=n.length,uE(c.data,o),uE(n,null),uE(c.blueprint,null));let f=FI(o,n),i=o.injectorIndex;if(Bk(f)){let w=ax(f),C=lx(f,n),A=C[jn].data;for(let L=0;L<8;L++)n[i+L]=C[w+L]|A[w+L]}return n[i+8]=f,i}function uE(o,n){o.push(0,0,0,0,0,0,0,0,n)}function Uk(o,n){return o.injectorIndex===-1||o.parent&&o.parent.injectorIndex===o.injectorIndex||n[o.injectorIndex+8]===null?-1:o.injectorIndex}function FI(o,n){if(o.parent&&o.parent.injectorIndex!==-1)return o.parent.injectorIndex;let l=0,c=null,f=n;for(;f!==null;){if(c=Wk(f),c===null)return Hf;if(l++,f=f[np],c.injectorIndex!==-1)return c.injectorIndex|l<<16}return Hf}function RE(o,n,l){a6(o,n,l)}function l6(o,n){if(n==="class")return o.classes;if(n==="style")return o.styles;let l=o.attrs;if(l){let c=l.length,f=0;for(;f<c;){let i=l[f];if(ek(i))break;if(i===0)f=f+2;else if(typeof i=="number")for(f++;f<c&&typeof l[f]=="string";)f++;else{if(i===n)return l[f+1];f=f+2}}}return null}function $k(o,n,l){if(l&Gn.Optional||o!==void 0)return o;yI(n,"NodeInjector")}function Gk(o,n,l,c){if(l&Gn.Optional&&c===void 0&&(c=null),!(l&(Gn.Self|Gn.Host))){let f=o[Yf],i=cs(void 0);try{return f?f.get(n,c,l&Gn.Optional):ZR(n,c,l&Gn.Optional)}finally{cs(i)}}return $k(c,n,l)}function Hk(o,n,l,c=Gn.Default,f){if(o!==null){if(n[gn]&2048&&!(c&Gn.Self)){let w=d6(o,n,l,c,Ta);if(w!==Ta)return w}let i=qk(o,n,l,c,Ta);if(i!==Ta)return i}return Gk(n,l,c,f)}function qk(o,n,l,c,f){let i=u6(l);if(typeof i=="function"){if(!Pk(n,o,c))return c&Gn.Host?$k(f,l,c):Gk(n,l,c,f);try{let w;if(w=i(c),w==null&&!(c&Gn.Optional))yI(l);else return w}finally{Lk()}}else if(typeof i=="number"){let w=null,C=Uk(o,n),A=Hf,L=c&Gn.Host?n[Us][jo]:null;for((C===-1||c&Gn.SkipSelf)&&(A=C===-1?FI(o,n):n[C+8],A===Hf||!dR(c,!1)?C=-1:(w=n[jn],C=ax(A),n=lx(A,n)));C!==-1;){let U=n[jn];if(hR(i,C,U.data)){let Q=c6(C,n,l,w,c,L);if(Q!==Ta)return Q}A=n[C+8],A!==Hf&&dR(c,n[jn].data[C+8]===L)&&hR(i,C,n)?(w=U,C=ax(A),n=lx(A,n)):C=-1}}return f}function c6(o,n,l,c,f,i){let w=n[jn],C=w.data[o+8],A=c==null?Cx(C)&&PE:c!=w&&(C.type&3)!==0,L=f&Gn.Host&&i===C,U=Jv(C,w,l,A,L);return U!==null?Nh(n,w,U,C):Ta}function Jv(o,n,l,c,f){let i=o.providerIndexes,w=n.data,C=i&1048575,A=o.directiveStart,L=o.directiveEnd,U=i>>20,Q=c?C:C+U,fe=f?C+U:L;for(let he=Q;he<fe;he++){let be=w[he];if(he<A&&l===be||he>=A&&be.type===l)return he}if(f){let he=w[A];if(he&&ip(he)&&he.type===l)return A}return null}function Nh(o,n,l,c){let f=o[l],i=n.data;if(t6(f)){let w=f;w.resolving&&Fj(Lj(i[l]));let C=uR(w.canSeeViewProviders);w.resolving=!0;let A,L=w.injectImpl?cs(w.injectImpl):null,U=Pk(o,c,Gn.Default);try{f=o[l]=w.factory(void 0,i,o,c),n.firstCreatePass&&l>=c.directiveStart&&JU(l,i[l],n)}finally{L!==null&&cs(L),uR(C),w.resolving=!1,Lk()}}return f}function u6(o){if(typeof o=="string")return o.charCodeAt(0)||0;let n=o.hasOwnProperty(Fg)?o[Fg]:void 0;return typeof n=="number"?n>=0?n&Vk:h6:n}function hR(o,n,l){let c=1<<o;return!!(l[n+(o>>jk)]&c)}function dR(o,n){return!(o&Gn.Self)&&!(o&Gn.Host&&n)}var Rh=class{constructor(n,l){this._tNode=n,this._lView=l}get(n,l,c){return Hk(this._tNode,this._lView,n,Tx(c),l)}};function h6(){return new Rh(so(),ei())}function NI(o){return Wg(()=>{let n=o.prototype.constructor,l=n[nx]||kE(n),c=Object.prototype,f=Object.getPrototypeOf(o.prototype).constructor;for(;f&&f!==c;){let i=f[nx]||kE(f);if(i&&i!==l)return i;f=Object.getPrototypeOf(f)}return i=>new i})}function kE(o){return UR(o)?()=>{let n=kE(ro(o));return n&&n()}:qf(o)}function d6(o,n,l,c,f){let i=o,w=n;for(;i!==null&&w!==null&&w[gn]&2048&&!(w[gn]&512);){let C=qk(i,w,l,c|Gn.Self,Ta);if(C!==Ta)return C;let A=i.parent;if(!A){let L=w[mk];if(L){let U=L.get(l,Ta,c);if(U!==Ta)return U}A=Wk(w),w=w[np]}i=A}return f}function Wk(o){let n=o[jn],l=n.type;return l===2?n.declTNode:l===1?o[jo]:null}function Px(o){return l6(so(),o)}function fR(o,n=null,l=null,c){let f=Zk(o,n,l,c);return f.resolveInjectorInitializers(),f}function Zk(o,n=null,l=null,c,f=new Set){let i=[l||zs,pU(o)];return c=c||(typeof o=="object"?void 0:oo(o)),new Bg(i,n||TI(),c||null,f)}var bl=(()=>{let n=class n{static create(c,f){if(Array.isArray(c))return fR({name:""},f,c,"");{let i=c.name??"";return fR({name:i},c.parent,c.providers,i)}}};n.THROW_IF_NOT_FOUND=Ng,n.NULL=new ox,n.\u0275prov=At({token:n,providedIn:"any",factory:()=>Vt(KR)}),n.__NG_ELEMENT_ID__=-1;let o=n;return o})();var f6="ngOriginalError";function hE(o){return o[f6]}var $s=class{constructor(){this._console=console}handleError(n){let l=this._findOriginalError(n);this._console.error("ERROR",n),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(n){let l=n&&hE(n);for(;l&&hE(l);)l=hE(l);return l||null}},Yk=new an("",{providedIn:"root",factory:()=>vt($s).handleError.bind(void 0)}),Rx=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=p6,n.__NG_ENV_ID__=c=>c;let o=n;return o})(),OE=class extends Rx{constructor(n){super(),this._lView=n}onDestroy(n){return Ik(this._lView,n),()=>NU(this._lView,n)}};function p6(){return new OE(ei())}function pR(o,n){return BR(o,n)}function m6(o){return BR(zR,o)}var Da=(pR.required=m6,pR);function g6(){return rp(so(),ei())}function rp(o,n){return new Or(hs(o,n))}var Or=(()=>{let n=class n{constructor(c){this.nativeElement=c}};n.__NG_ELEMENT_ID__=g6;let o=n;return o})();function _6(o){return o instanceof Or?o.nativeElement:o}var LE=class extends cr{constructor(n=!1){super(),this.destroyRef=void 0,this.__isAsync=n,fk()&&(this.destroyRef=vt(Rx,{optional:!0})??void 0)}emit(n){let l=di(null);try{super.next(n)}finally{di(l)}}subscribe(n,l,c){let f=n,i=l||(()=>null),w=c;if(n&&typeof n=="object"){let A=n;f=A.next?.bind(A),i=A.error?.bind(A),w=A.complete?.bind(A)}this.__isAsync&&(i=dE(i),f&&(f=dE(f)),w&&(w=dE(w)));let C=super.subscribe({next:f,error:i,complete:w});return n instanceof Ji&&n.add(C),C}};function dE(o){return n=>{setTimeout(o,void 0,n)}}var Pr=LE;function y6(){return this._results[Symbol.iterator]()}var ux=class o{get changes(){return this._changes??=new Pr}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let l=o.prototype;l[Symbol.iterator]||(l[Symbol.iterator]=y6)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,l){return this._results.reduce(n,l)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,l){this.dirty=!1;let c=Wj(n);(this._changesDetected=!qj(this._results,c,l))&&(this._results=c,this.length=c.length,this.last=c[this.length-1],this.first=c[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function Xk(o){return(o.flags&128)===128}var Kk=new Map,v6=0;function x6(){return v6++}function b6(o){Kk.set(o[Ix],o)}function w6(o){Kk.delete(o[Ix])}var mR="__ngContext__";function Gc(o,n){Ph(n)?(o[mR]=n[Ix],b6(n)):o[mR]=n}function Qk(o){return eO(o[Ug])}function Jk(o){return eO(o[Bs])}function eO(o){for(;o!==null&&!vl(o);)o=o[Bs];return o}var FE;function tO(o){FE=o}function T6(){if(FE!==void 0)return FE;if(typeof document<"u")return document;throw new bt(210,!1)}var kx=new an("",{providedIn:"root",factory:()=>E6}),E6="ng",zI=new an(""),Hs=new an("",{providedIn:"platform",factory:()=>"unknown"});var Ox=new an(""),Jg=new an("",{providedIn:"root",factory:()=>T6().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var I6="h",C6="b";var S6=()=>null;function BI(o,n,l=!1){return S6(o,n,l)}var nO=!1,D6=new an("",{providedIn:"root",factory:()=>nO});var Wv;function M6(){if(Wv===void 0&&(Wv=null,Mh.trustedTypes))try{Wv=Mh.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:o=>o,createScript:o=>o,createScriptURL:o=>o})}catch{}return Wv}function gR(o){return M6()?.createScriptURL(o)||o}var hx=class{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${NR})`}};function e_(o){return o instanceof hx?o.changingThisBreaksApplicationSecurity:o}function VI(o,n){let l=A6(o);if(l!=null&&l!==n){if(l==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${l} (see ${NR})`)}return l===n}function A6(o){return o instanceof hx&&o.getTypeName()||null}var P6=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function iO(o){return o=String(o),o.match(P6)?o:"unsafe:"+o}var Lx=function(o){return o[o.NONE=0]="NONE",o[o.HTML=1]="HTML",o[o.STYLE=2]="STYLE",o[o.SCRIPT=3]="SCRIPT",o[o.URL=4]="URL",o[o.RESOURCE_URL=5]="RESOURCE_URL",o}(Lx||{});function R6(o){let n=oO();return n?n.sanitize(Lx.URL,o)||"":VI(o,"URL")?e_(o):iO(Ah(o))}function k6(o){let n=oO();if(n)return gR(n.sanitize(Lx.RESOURCE_URL,o)||"");if(VI(o,"ResourceURL"))return gR(e_(o));throw new bt(904,!1)}function O6(o,n){return n==="src"&&(o==="embed"||o==="frame"||o==="iframe"||o==="media"||o==="script")||n==="href"&&(o==="base"||o==="link")?k6:R6}function rO(o,n,l){return O6(n,l)(o)}function oO(){let o=ei();return o&&o[js].sanitizer}var L6=/^>|^->|<!--|-->|--!>|<!-$/g,F6=/(<|>)/g,N6="\u200B$1\u200B";function z6(o){return o.replace(L6,n=>n.replace(F6,N6))}function sO(o){return o instanceof Function?o():o}function B6(o){return(o??vt(bl)).get(Hs)==="browser"}var Sa=function(o){return o[o.Important=1]="Important",o[o.DashCase=2]="DashCase",o}(Sa||{}),V6;function jI(o,n){return V6(o,n)}function Uf(o,n,l,c,f){if(c!=null){let i,w=!1;vl(c)?i=c:Ph(c)&&(w=!0,c=c[yl]);let C=Ca(c);o===0&&l!==null?f==null?dO(n,l,C):dx(n,l,C,f||null,!0):o===1&&l!==null?dx(n,l,C,f||null,!0):o===2?n8(n,C,w):o===3&&n.destroyNode(C),i!=null&&r8(n,o,i,l,f)}}function j6(o,n){return o.createText(n)}function U6(o,n,l){o.setValue(n,l)}function $6(o,n){return o.createComment(z6(n))}function aO(o,n,l){return o.createElement(n,l)}function G6(o,n){lO(o,n),n[yl]=null,n[jo]=null}function H6(o,n,l,c,f,i){c[yl]=f,c[jo]=n,Nx(o,c,l,1,f,i)}function lO(o,n){n[js].changeDetectionScheduler?.notify(1),Nx(o,n,n[hr],2,null,null)}function q6(o){let n=o[Ug];if(!n)return fE(o[jn],o);for(;n;){let l=null;if(Ph(n))l=n[Ug];else{let c=n[Vo];c&&(l=c)}if(!l){for(;n&&!n[Bs]&&n!==o;)Ph(n)&&fE(n[jn],n),n=n[jr];n===null&&(n=o),Ph(n)&&fE(n[jn],n),l=n&&n[Bs]}n=l}}function W6(o,n,l,c){let f=Vo+c,i=l.length;c>0&&(l[f-1][Bs]=n),c<i-Vo?(n[Bs]=l[f],XR(l,Vo+c,n)):(l.push(n),n[Bs]=null),n[jr]=l;let w=n[Xg];w!==null&&l!==w&&Z6(w,n);let C=n[_l];C!==null&&C.insertView(o),ME(n),n[gn]|=128}function Z6(o,n){let l=o[Xf],f=n[jr][jr][Us];n[Us]!==f&&(o[gn]|=EI.HasTransplantedViews),l===null?o[Xf]=[n]:l.push(n)}function cO(o,n){let l=o[Xf],c=l.indexOf(n);l.splice(c,1)}function NE(o,n){if(o.length<=Vo)return;let l=Vo+n,c=o[l];if(c){let f=c[Xg];f!==null&&f!==o&&cO(f,c),n>0&&(o[l-1][Bs]=c[Bs]);let i=rx(o,Vo+n);G6(c[jn],c);let w=i[_l];w!==null&&w.detachView(i[jn]),c[jr]=null,c[Bs]=null,c[gn]&=-129}return c}function uO(o,n){if(!(n[gn]&256)){let l=n[hr];l.destroyNode&&Nx(o,n,l,3,null,null),q6(n)}}function fE(o,n){if(n[gn]&256)return;let l=di(null);try{n[gn]&=-129,n[gn]|=256,n[kh]&&VT(n[kh]),X6(o,n),Y6(o,n),n[jn].type===1&&n[hr].destroy();let c=n[Xg];if(c!==null&&vl(n[jr])){c!==n[jr]&&cO(c,n);let f=n[_l];f!==null&&f.detachView(o)}w6(n)}finally{di(l)}}function Y6(o,n){let l=o.cleanup,c=n[jg];if(l!==null)for(let i=0;i<l.length-1;i+=2)if(typeof l[i]=="string"){let w=l[i+3];w>=0?c[w]():c[-w].unsubscribe(),i+=2}else{let w=c[l[i+1]];l[i].call(w)}c!==null&&(n[jg]=null);let f=n[Uc];if(f!==null){n[Uc]=null;for(let i=0;i<f.length;i++){let w=f[i];w()}}}function X6(o,n){let l;if(o!=null&&(l=o.destroyHooks)!=null)for(let c=0;c<l.length;c+=2){let f=n[l[c]];if(!(f instanceof Fh)){let i=l[c+1];if(Array.isArray(i))for(let w=0;w<i.length;w+=2){let C=f[i[w]],A=i[w+1];wa(4,C,A);try{A.call(C)}finally{wa(5,C,A)}}else{wa(4,f,i);try{i.call(f)}finally{wa(5,f,i)}}}}}function hO(o,n,l){return K6(o,n.parent,l)}function K6(o,n,l){let c=n;for(;c!==null&&c.type&40;)n=c,c=n.parent;if(c===null)return l[yl];{let{componentOffset:f}=c;if(f>-1){let{encapsulation:i}=o.data[c.directiveStart+f];if(i===Ea.None||i===Ea.Emulated)return null}return hs(c,l)}}function dx(o,n,l,c,f){o.insertBefore(n,l,c,f)}function dO(o,n,l){o.appendChild(n,l)}function _R(o,n,l,c,f){c!==null?dx(o,n,l,c,f):dO(o,n,l)}function Q6(o,n,l,c){o.removeChild(n,l,c)}function UI(o,n){return o.parentNode(n)}function J6(o,n){return o.nextSibling(n)}function fO(o,n,l){return t8(o,n,l)}function e8(o,n,l){return o.type&40?hs(o,l):null}var t8=e8,yR;function Fx(o,n,l,c){let f=hO(o,c,n),i=n[hr],w=c.parent||n[jo],C=fO(w,c,n);if(f!=null)if(Array.isArray(l))for(let A=0;A<l.length;A++)_R(i,f,l[A],C,!1);else _R(i,f,l,C,!1);yR!==void 0&&yR(i,c,n,l,f)}function ex(o,n){if(n!==null){let l=n.type;if(l&3)return hs(n,o);if(l&4)return zE(-1,o[n.index]);if(l&8){let c=n.child;if(c!==null)return ex(o,c);{let f=o[n.index];return vl(f)?zE(-1,f):Ca(f)}}else{if(l&32)return jI(n,o)()||Ca(o[n.index]);{let c=pO(o,n);if(c!==null){if(Array.isArray(c))return c[0];let f=Gg(o[Us]);return ex(f,c)}else return ex(o,n.next)}}}return null}function pO(o,n){if(n!==null){let c=o[Us][jo],f=n.projection;return c.projection[f]}return null}function zE(o,n){let l=Vo+o+1;if(l<n.length){let c=n[l],f=c[jn].firstChild;if(f!==null)return ex(c,f)}return n[Oh]}function n8(o,n,l){let c=UI(o,n);c&&Q6(o,c,n,l)}function $I(o,n,l,c,f,i,w){for(;l!=null;){let C=c[l.index],A=l.type;if(w&&n===0&&(C&&Gc(Ca(C),c),l.flags|=2),(l.flags&32)!==32)if(A&8)$I(o,n,l.child,c,f,i,!1),Uf(n,o,f,C,i);else if(A&32){let L=jI(l,c),U;for(;U=L();)Uf(n,o,f,U,i);Uf(n,o,f,C,i)}else A&16?mO(o,n,c,l,f,i):Uf(n,o,f,C,i);l=w?l.projectionNext:l.next}}function Nx(o,n,l,c,f,i){$I(l,c,o.firstChild,n,f,i,!1)}function i8(o,n,l){let c=n[hr],f=hO(o,l,n),i=l.parent||n[jo],w=fO(i,l,n);mO(c,0,n,l,f,w)}function mO(o,n,l,c,f,i){let w=l[Us],A=w[jo].projection[c.projection];if(Array.isArray(A))for(let L=0;L<A.length;L++){let U=A[L];Uf(n,o,f,U,i)}else{let L=A,U=w[jr];Xk(c)&&(L.flags|=128),$I(o,n,L,U,f,i,!0)}}function r8(o,n,l,c,f){let i=l[Oh],w=Ca(l);i!==w&&Uf(n,o,c,i,f);for(let C=Vo;C<l.length;C++){let A=l[C];Nx(A[jn],A,o,n,c,i)}}function o8(o,n,l,c,f){if(n)f?o.addClass(l,c):o.removeClass(l,c);else{let i=c.indexOf("-")===-1?void 0:Sa.DashCase;f==null?o.removeStyle(l,c,i):(typeof f=="string"&&f.endsWith("!important")&&(f=f.slice(0,-10),i|=Sa.Important),o.setStyle(l,c,f,i))}}function s8(o,n,l){o.setAttribute(n,"style",l)}function gO(o,n,l){l===""?o.removeAttribute(n,"class"):o.setAttribute(n,"class",l)}function _O(o,n,l){let{mergedAttrs:c,classes:f,styles:i}=l;c!==null&&EE(o,n,c),f!==null&&gO(o,n,f),i!==null&&s8(o,n,i)}var qs={};function Xn(o=1){yO(Ur(),ei(),Uh()+o,!1)}function yO(o,n,l,c){if(!c)if((n[gn]&3)===3){let i=o.preOrderCheckHooks;i!==null&&Kv(n,i,l)}else{let i=o.preOrderHooks;i!==null&&Qv(n,i,0,l)}Lh(l)}function Kn(o,n=Gn.Default){let l=ei();if(l===null)return Vt(o,n);let c=so();return Hk(c,l,ro(o),n)}function vO(o,n,l,c,f,i){let w=di(null);try{let C=null;f&Ni.SignalBased&&(C=n[c][Fc]),C!==null&&C.transformFn!==void 0&&(i=C.transformFn(i)),f&Ni.HasDecoratorInputTransform&&(i=o.inputTransforms[c].call(n,i)),o.setInput!==null?o.setInput(n,C,i,l,c):_k(n,C,c,i)}finally{di(w)}}function a8(o,n){let l=o.hostBindingOpCodes;if(l!==null)try{for(let c=0;c<l.length;c++){let f=l[c];if(f<0)Lh(~f);else{let i=f,w=l[++c],C=l[++c];WU(w,i);let A=n[i];C(2,A)}}}finally{Lh(-1)}}function zx(o,n,l,c,f,i,w,C,A,L,U){let Q=n.blueprint.slice();return Q[yl]=f,Q[gn]=c|4|128|8|64,(L!==null||o&&o[gn]&2048)&&(Q[gn]|=2048),Ek(Q),Q[jr]=Q[np]=o,Q[Vs]=l,Q[js]=w||o&&o[js],Q[hr]=C||o&&o[hr],Q[Yf]=A||o&&o[Yf]||null,Q[jo]=i,Q[Ix]=x6(),Q[Vg]=U,Q[mk]=L,Q[Us]=n.type==2?o[Us]:Q,Q}function op(o,n,l,c,f){let i=o.data[n];if(i===null)i=l8(o,n,l,c,f),qU()&&(i.flags|=32);else if(i.type&64){i.type=l,i.value=c,i.attrs=f;let w=$U();i.injectorIndex=w===null?-1:w.injectorIndex}return jh(i,!0),i}function l8(o,n,l,c,f){let i=Dk(),w=DI(),C=w?i:i&&i.parent,A=o.data[n]=p8(o,C,l,n,c,f);return o.firstChild===null&&(o.firstChild=A),i!==null&&(w?i.child==null&&A.parent!==null&&(i.child=A):i.next===null&&(i.next=A,A.prev=i)),A}function xO(o,n,l,c){if(l===0)return-1;let f=n.length;for(let i=0;i<l;i++)n.push(c),o.blueprint.push(c),o.data.push(null);return f}function bO(o,n,l,c,f){let i=Uh(),w=c&2;try{Lh(-1),w&&n.length>Ia&&yO(o,n,Ia,!1),wa(w?2:0,f),l(c,f)}finally{Lh(i),wa(w?3:1,f)}}function GI(o,n,l){if(II(n)){let c=di(null);try{let f=n.directiveStart,i=n.directiveEnd;for(let w=f;w<i;w++){let C=o.data[w];if(C.contentQueries){let A=l[w];C.contentQueries(1,A,w)}}}finally{di(c)}}}function HI(o,n,l){Ck()&&(x8(o,n,l,hs(l,n)),(l.flags&64)===64&&IO(o,n,l))}function qI(o,n,l=hs){let c=n.localNames;if(c!==null){let f=n.index+1;for(let i=0;i<c.length;i+=2){let w=c[i+1],C=w===-1?l(n,o):o[w];o[f++]=C}}}function wO(o){let n=o.tView;return n===null||n.incompleteFirstPass?o.tView=WI(1,null,o.template,o.decls,o.vars,o.directiveDefs,o.pipeDefs,o.viewQuery,o.schemas,o.consts,o.id):n}function WI(o,n,l,c,f,i,w,C,A,L,U){let Q=Ia+c,fe=Q+f,he=c8(Q,fe),be=typeof L=="function"?L():L;return he[jn]={type:o,blueprint:he,template:l,queries:null,viewQuery:C,declTNode:n,data:he.slice().fill(null,Q),bindingStartIndex:Q,expandoStartIndex:fe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof w=="function"?w():w,firstChild:null,schemas:A,consts:be,incompleteFirstPass:!1,ssrId:U}}function c8(o,n){let l=[];for(let c=0;c<n;c++)l.push(c<o?null:qs);return l}function u8(o,n,l,c){let i=c.get(D6,nO)||l===Ea.ShadowDom,w=o.selectRootElement(n,i);return h8(w),w}function h8(o){d8(o)}var d8=()=>null;function f8(o,n,l,c){let f=DO(n);f.push(l),o.firstCreatePass&&MO(o).push(c,f.length-1)}function p8(o,n,l,c,f,i){let w=n?n.injectorIndex:-1,C=0;return Sk()&&(C|=128),{type:l,index:c,insertBeforeIndex:null,injectorIndex:w,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:C,providerIndexes:0,value:f,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function vR(o,n,l,c,f){for(let i in n){if(!n.hasOwnProperty(i))continue;let w=n[i];if(w===void 0)continue;c??={};let C,A=Ni.None;Array.isArray(w)?(C=w[0],A=w[1]):C=w;let L=i;if(f!==null){if(!f.hasOwnProperty(i))continue;L=f[i]}o===0?xR(c,l,L,C,A):xR(c,l,L,C)}return c}function xR(o,n,l,c,f){let i;o.hasOwnProperty(l)?(i=o[l]).push(n,c):i=o[l]=[n,c],f!==void 0&&i.push(f)}function m8(o,n,l){let c=n.directiveStart,f=n.directiveEnd,i=o.data,w=n.attrs,C=[],A=null,L=null;for(let U=c;U<f;U++){let Q=i[U],fe=l?l.get(Q):null,he=fe?fe.inputs:null,be=fe?fe.outputs:null;A=vR(0,Q.inputs,U,A,he),L=vR(1,Q.outputs,U,L,be);let Se=A!==null&&w!==null&&!bI(n)?P8(A,U,w):null;C.push(Se)}A!==null&&(A.hasOwnProperty("class")&&(n.flags|=8),A.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=C,n.inputs=A,n.outputs=L}function g8(o){return o==="class"?"className":o==="for"?"htmlFor":o==="formaction"?"formAction":o==="innerHtml"?"innerHTML":o==="readonly"?"readOnly":o==="tabindex"?"tabIndex":o}function TO(o,n,l,c,f,i,w,C){let A=hs(n,l),L=n.inputs,U;!C&&L!=null&&(U=L[c])?(YI(o,l,U,c,f),Cx(n)&&_8(l,n.index)):n.type&3?(c=g8(c),f=w!=null?w(f,n.value||"",c):f,i.setProperty(A,c,f)):n.type&12}function _8(o,n){let l=Yc(n,o);l[gn]&16||(l[gn]|=64)}function ZI(o,n,l,c){if(Ck()){let f=c===null?null:{"":-1},i=w8(o,l),w,C;i===null?w=C=null:[w,C]=i,w!==null&&EO(o,n,l,w,f,C),f&&T8(l,c,f)}l.mergedAttrs=xI(l.mergedAttrs,l.attrs)}function EO(o,n,l,c,f,i){for(let L=0;L<c.length;L++)RE(cx(l,n),o,c[L].type);I8(l,o.data.length,c.length);for(let L=0;L<c.length;L++){let U=c[L];U.providersResolver&&U.providersResolver(U)}let w=!1,C=!1,A=xO(o,n,c.length,null);for(let L=0;L<c.length;L++){let U=c[L];l.mergedAttrs=xI(l.mergedAttrs,U.hostAttrs),C8(o,l,n,A,U),E8(A,U,f),U.contentQueries!==null&&(l.flags|=4),(U.hostBindings!==null||U.hostAttrs!==null||U.hostVars!==0)&&(l.flags|=64);let Q=U.type.prototype;!w&&(Q.ngOnChanges||Q.ngOnInit||Q.ngDoCheck)&&((o.preOrderHooks??=[]).push(l.index),w=!0),!C&&(Q.ngOnChanges||Q.ngDoCheck)&&((o.preOrderCheckHooks??=[]).push(l.index),C=!0),A++}m8(o,l,i)}function y8(o,n,l,c,f){let i=f.hostBindings;if(i){let w=o.hostBindingOpCodes;w===null&&(w=o.hostBindingOpCodes=[]);let C=~n.index;v8(w)!=C&&w.push(C),w.push(l,c,i)}}function v8(o){let n=o.length;for(;n>0;){let l=o[--n];if(typeof l=="number"&&l<0)return l}return 0}function x8(o,n,l,c){let f=l.directiveStart,i=l.directiveEnd;Cx(l)&&S8(n,l,o.data[f+l.componentOffset]),o.firstCreatePass||cx(l,n),Gc(c,n);let w=l.initialInputs;for(let C=f;C<i;C++){let A=o.data[C],L=Nh(n,o,C,l);if(Gc(L,n),w!==null&&A8(n,C-f,L,A,l,w),ip(A)){let U=Yc(l.index,n);U[Vs]=Nh(n,o,C,l)}}}function IO(o,n,l){let c=l.directiveStart,f=l.directiveEnd,i=l.index,w=ZU();try{Lh(i);for(let C=c;C<f;C++){let A=o.data[C],L=n[C];AE(C),(A.hostBindings!==null||A.hostVars!==0||A.hostAttrs!==null)&&b8(A,L)}}finally{Lh(-1),AE(w)}}function b8(o,n){o.hostBindings!==null&&o.hostBindings(1,n)}function w8(o,n){let l=o.directiveRegistry,c=null,f=null;if(l)for(let i=0;i<l.length;i++){let w=l[i];if(nk(n,w.selectors,!1))if(c||(c=[]),ip(w))if(w.findHostDirectiveDefs!==null){let C=[];f=f||new Map,w.findHostDirectiveDefs(w,C,f),c.unshift(...C,w);let A=C.length;BE(o,n,A)}else c.unshift(w),BE(o,n,0);else f=f||new Map,w.findHostDirectiveDefs?.(w,c,f),c.push(w)}return c===null?null:[c,f]}function BE(o,n,l){n.componentOffset=l,(o.components??=[]).push(n.index)}function T8(o,n,l){if(n){let c=o.localNames=[];for(let f=0;f<n.length;f+=2){let i=l[n[f+1]];if(i==null)throw new bt(-301,!1);c.push(n[f],i)}}}function E8(o,n,l){if(l){if(n.exportAs)for(let c=0;c<n.exportAs.length;c++)l[n.exportAs[c]]=o;ip(n)&&(l[""]=o)}}function I8(o,n,l){o.flags|=1,o.directiveStart=n,o.directiveEnd=n+l,o.providerIndexes=n}function C8(o,n,l,c,f){o.data[c]=f;let i=f.factory||(f.factory=qf(f.type,!0)),w=new Fh(i,ip(f),Kn);o.blueprint[c]=w,l[c]=w,y8(o,n,c,xO(o,l,f.hostVars,qs),f)}function S8(o,n,l){let c=hs(n,o),f=wO(l),i=o[js].rendererFactory,w=16;l.signals?w=4096:l.onPush&&(w=64);let C=Bx(o,zx(o,f,null,w,c,n,null,i.createRenderer(c,l),null,null,null));o[n.index]=C}function D8(o,n,l,c,f,i){let w=hs(o,n);M8(n[hr],w,i,o.value,l,c,f)}function M8(o,n,l,c,f,i,w){if(i==null)o.removeAttribute(n,f,l);else{let C=w==null?Ah(i):w(i,c||"",f);o.setAttribute(n,f,C,l)}}function A8(o,n,l,c,f,i){let w=i[n];if(w!==null)for(let C=0;C<w.length;){let A=w[C++],L=w[C++],U=w[C++],Q=w[C++];vO(c,l,A,L,U,Q)}}function P8(o,n,l){let c=null,f=0;for(;f<l.length;){let i=l[f];if(i===0){f+=4;continue}else if(i===5){f+=2;continue}if(typeof i=="number")break;if(o.hasOwnProperty(i)){c===null&&(c=[]);let w=o[i];for(let C=0;C<w.length;C+=3)if(w[C]===n){c.push(i,w[C+1],w[C+2],l[f+1]);break}}f+=2}return c}function CO(o,n,l,c){return[o,!0,0,n,null,c,null,l,null,null]}function SO(o,n){let l=o.contentQueries;if(l!==null){let c=di(null);try{for(let f=0;f<l.length;f+=2){let i=l[f],w=l[f+1];if(w!==-1){let C=o.data[w];RI(i),C.contentQueries(2,n[w],w)}}}finally{di(c)}}}function Bx(o,n){return o[Ug]?o[aR][Bs]=n:o[Ug]=n,o[aR]=n,n}function VE(o,n,l){RI(0);let c=di(null);try{n(o,l)}finally{di(c)}}function DO(o){return o[jg]||(o[jg]=[])}function MO(o){return o.cleanup||(o.cleanup=[])}function AO(o,n){let l=o[Yf],c=l?l.get($s,null):null;c&&c.handleError(n)}function YI(o,n,l,c,f){for(let i=0;i<l.length;){let w=l[i++],C=l[i++],A=l[i++],L=n[w],U=o.data[w];vO(U,L,c,C,A,f)}}function PO(o,n,l){let c=wk(n,o);U6(o[hr],c,l)}function R8(o,n){let l=Yc(n,o),c=l[jn];k8(c,l);let f=l[yl];f!==null&&l[Vg]===null&&(l[Vg]=BI(f,l[Yf])),XI(c,l,l[Vs])}function k8(o,n){for(let l=n.length;l<o.blueprint.length;l++)n.push(o.blueprint[l])}function XI(o,n,l){kI(n);try{let c=o.viewQuery;c!==null&&VE(1,c,l);let f=o.template;f!==null&&bO(o,n,f,1,l),o.firstCreatePass&&(o.firstCreatePass=!1),n[_l]?.finishViewCreation(o),o.staticContentQueries&&SO(o,n),o.staticViewQueries&&VE(2,o.viewQuery,l);let i=o.components;i!==null&&O8(n,i)}catch(c){throw o.firstCreatePass&&(o.incompleteFirstPass=!0,o.firstCreatePass=!1),c}finally{n[gn]&=-5,OI()}}function O8(o,n){for(let l=0;l<n.length;l++)R8(o,n[l])}function L8(o,n,l,c){let f=di(null);try{let i=n.tView,C=o[gn]&4096?4096:16,A=zx(o,i,l,C,null,n,null,null,c?.injector??null,c?.embeddedViewInjector??null,c?.dehydratedView??null),L=o[n.index];A[Xg]=L;let U=o[_l];return U!==null&&(A[_l]=U.createEmbeddedView(i)),XI(i,A,l),A}finally{di(f)}}function bR(o,n){return!n||n.firstChild===null||Xk(o)}function F8(o,n,l,c=!0){let f=n[jn];if(W6(f,n,o,l),c){let w=zE(l,o),C=n[hr],A=UI(C,o[Oh]);A!==null&&H6(f,o[jo],C,n,A,w)}let i=n[Vg];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function fx(o,n,l,c,f=!1){for(;l!==null;){let i=n[l.index];i!==null&&c.push(Ca(i)),vl(i)&&N8(i,c);let w=l.type;if(w&8)fx(o,n,l.child,c);else if(w&32){let C=jI(l,n),A;for(;A=C();)c.push(A)}else if(w&16){let C=pO(n,l);if(Array.isArray(C))c.push(...C);else{let A=Gg(n[Us]);fx(A[jn],A,C,c,!0)}}l=f?l.projectionNext:l.next}return c}function N8(o,n){for(let l=Vo;l<o.length;l++){let c=o[l],f=c[jn].firstChild;f!==null&&fx(c[jn],c,f,n)}o[Oh]!==o[yl]&&n.push(o[Oh])}var RO=[];function z8(o){return o[kh]??B8(o)}function B8(o){let n=RO.pop()??Object.create(j8);return n.lView=o,n}function V8(o){o.lView[kh]!==o&&(o.lView=null,RO.push(o))}var j8=oi(gt({},xv),{consumerIsAlwaysLive:!0,consumerMarkedDirty:o=>{$g(o.lView)},consumerOnSignalRead(){this.lView[kh]=this}}),kO=100;function OO(o,n=!0,l=0){let c=o[js],f=c.rendererFactory,i=!1;i||f.begin?.();try{U8(o,l)}catch(w){throw n&&AO(o,w),w}finally{i||(f.end?.(),c.inlineEffectRunner?.flush())}}function U8(o,n){jE(o,n);let l=0;for(;SI(o);){if(l===kO)throw new bt(103,!1);l++,jE(o,1)}}function $8(o,n,l,c){let f=n[gn];if((f&256)===256)return;let i=!1;!i&&n[js].inlineEffectRunner?.flush(),kI(n);let w=null,C=null;!i&&G8(o)&&(C=z8(n),w=zT(C));try{Ek(n),HU(o.bindingStartIndex),l!==null&&bO(o,n,l,2,c);let A=(f&3)===3;if(!i)if(A){let Q=o.preOrderCheckHooks;Q!==null&&Kv(n,Q,null)}else{let Q=o.preOrderHooks;Q!==null&&Qv(n,Q,0,null),cE(n,0)}if(H8(n),LO(n,0),o.contentQueries!==null&&SO(o,n),!i)if(A){let Q=o.contentCheckHooks;Q!==null&&Kv(n,Q)}else{let Q=o.contentHooks;Q!==null&&Qv(n,Q,1),cE(n,1)}a8(o,n);let L=o.components;L!==null&&NO(n,L,0);let U=o.viewQuery;if(U!==null&&VE(2,U,c),!i)if(A){let Q=o.viewCheckHooks;Q!==null&&Kv(n,Q)}else{let Q=o.viewHooks;Q!==null&&Qv(n,Q,2),cE(n,2)}if(o.firstUpdatePass===!0&&(o.firstUpdatePass=!1),n[Xv]){for(let Q of n[Xv])Q();n[Xv]=null}i||(n[gn]&=-73)}catch(A){throw $g(n),A}finally{C!==null&&(BT(C,w),V8(C)),OI()}}function G8(o){return o.type!==2}function LO(o,n){for(let l=Qk(o);l!==null;l=Jk(l))for(let c=Vo;c<l.length;c++){let f=l[c];FO(f,n)}}function H8(o){for(let n=Qk(o);n!==null;n=Jk(n)){if(!(n[gn]&EI.HasTransplantedViews))continue;let l=n[Xf];for(let c=0;c<l.length;c++){let f=l[c],i=f[jr];LU(f)}}}function q8(o,n,l){let c=Yc(n,o);FO(c,l)}function FO(o,n){CI(o)&&jE(o,n)}function jE(o,n){let c=o[jn],f=o[gn],i=o[kh],w=!!(n===0&&f&16);if(w||=!!(f&64&&n===0),w||=!!(f&1024),w||=!!(i?.dirty&&bv(i)),i&&(i.dirty=!1),o[gn]&=-9217,w)$8(c,o,c.template,o[Vs]);else if(f&8192){LO(o,1);let C=c.components;C!==null&&NO(o,C,1)}}function NO(o,n,l){for(let c=0;c<n.length;c++)q8(o,n[c],l)}function KI(o){for(o[js].changeDetectionScheduler?.notify();o;){o[gn]|=64;let n=Gg(o);if(CU(o)&&!n)return o;o=n}return null}var zh=class{get rootNodes(){let n=this._lView,l=n[jn];return fx(l,n,l.firstChild,[])}constructor(n,l,c=!0){this._lView=n,this._cdRefInjectingView=l,this.notifyErrorHandler=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Vs]}set context(n){this._lView[Vs]=n}get destroyed(){return(this._lView[gn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[jr];if(vl(n)){let l=n[sx],c=l?l.indexOf(this):-1;c>-1&&(NE(n,c),rx(l,c))}this._attachedToViewContainer=!1}uO(this._lView[jn],this._lView)}onDestroy(n){Ik(this._lView,n)}markForCheck(){KI(this._cdRefInjectingView||this._lView)}detach(){this._lView[gn]&=-129}reattach(){ME(this._lView),this._lView[gn]|=128}detectChanges(){this._lView[gn]|=1024,OO(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new bt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,lO(this._lView[jn],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new bt(902,!1);this._appRef=n,ME(this._lView)}},Hc=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=Y8;let o=n;return o})(),W8=Hc,Z8=class extends W8{constructor(n,l,c){super(),this._declarationLView=n,this._declarationTContainer=l,this.elementRef=c}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,l){return this.createEmbeddedViewImpl(n,l)}createEmbeddedViewImpl(n,l,c){let f=L8(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:l,dehydratedView:c});return new zh(f)}};function Y8(){return QI(so(),ei())}function QI(o,n){return o.type&4?new Z8(n,o,rp(o,n)):null}var dne=new RegExp(`^(\\d+)*(${C6}|${I6})*(.*)`);var X8=()=>null;function wR(o,n){return X8(o,n)}var Qf=class{},UE=class{},px=class{};function K8(o){let n=Error(`No component factory found for ${oo(o)}.`);return n[Q8]=o,n}var Q8="ngComponent";var $E=class{resolveComponentFactory(n){throw K8(n)}},t_=(()=>{let n=class n{};n.NULL=new $E;let o=n;return o})(),Bh=class{},Xc=(()=>{let n=class n{constructor(){this.destroyNode=null}};n.__NG_ELEMENT_ID__=()=>J8();let o=n;return o})();function J8(){let o=ei(),n=so(),l=Yc(n.index,o);return(Ph(l)?l:o)[hr]}var e$=(()=>{let n=class n{};n.\u0275prov=At({token:n,providedIn:"root",factory:()=>null});let o=n;return o})(),pE={};var TR=new Set;function Kc(o){TR.has(o)||(TR.add(o),performance?.mark?.("mark_feature_usage",{detail:{feature:o}}))}function ER(...o){}function t$(){let o=typeof Mh.requestAnimationFrame=="function",n=Mh[o?"requestAnimationFrame":"setTimeout"],l=Mh[o?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&l){let c=n[Zone.__symbol__("OriginalDelegate")];c&&(n=c);let f=l[Zone.__symbol__("OriginalDelegate")];f&&(l=f)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:l}}var fi=class o{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Pr(!1),this.onMicrotaskEmpty=new Pr(!1),this.onStable=new Pr(!1),this.onError=new Pr(!1),typeof Zone>"u")throw new bt(908,!1);Zone.assertZonePatched();let f=this;f._nesting=0,f._outer=f._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(f._inner=f._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(f._inner=f._inner.fork(Zone.longStackTraceZoneSpec)),f.shouldCoalesceEventChangeDetection=!c&&l,f.shouldCoalesceRunChangeDetection=c,f.lastRequestAnimationFrameId=-1,f.nativeRequestAnimationFrame=t$().nativeRequestAnimationFrame,r$(f)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!o.isInAngularZone())throw new bt(909,!1)}static assertNotInAngularZone(){if(o.isInAngularZone())throw new bt(909,!1)}run(n,l,c){return this._inner.run(n,l,c)}runTask(n,l,c,f){let i=this._inner,w=i.scheduleEventTask("NgZoneEvent: "+f,n,n$,ER,ER);try{return i.runTask(w,l,c)}finally{i.cancelTask(w)}}runGuarded(n,l,c){return this._inner.runGuarded(n,l,c)}runOutsideAngular(n){return this._outer.run(n)}},n$={};function JI(o){if(o._nesting==0&&!o.hasPendingMicrotasks&&!o.isStable)try{o._nesting++,o.onMicrotaskEmpty.emit(null)}finally{if(o._nesting--,!o.hasPendingMicrotasks)try{o.runOutsideAngular(()=>o.onStable.emit(null))}finally{o.isStable=!0}}}function i$(o){o.isCheckStableRunning||o.lastRequestAnimationFrameId!==-1||(o.lastRequestAnimationFrameId=o.nativeRequestAnimationFrame.call(Mh,()=>{o.fakeTopEventTask||(o.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{o.lastRequestAnimationFrameId=-1,GE(o),o.isCheckStableRunning=!0,JI(o),o.isCheckStableRunning=!1},void 0,()=>{},()=>{})),o.fakeTopEventTask.invoke()}),GE(o))}function r$(o){let n=()=>{i$(o)};o._inner=o._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,c,f,i,w,C)=>{if(o$(C))return l.invokeTask(f,i,w,C);try{return IR(o),l.invokeTask(f,i,w,C)}finally{(o.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||o.shouldCoalesceRunChangeDetection)&&n(),CR(o)}},onInvoke:(l,c,f,i,w,C,A)=>{try{return IR(o),l.invoke(f,i,w,C,A)}finally{o.shouldCoalesceRunChangeDetection&&n(),CR(o)}},onHasTask:(l,c,f,i)=>{l.hasTask(f,i),c===f&&(i.change=="microTask"?(o._hasPendingMicrotasks=i.microTask,GE(o),JI(o)):i.change=="macroTask"&&(o.hasPendingMacrotasks=i.macroTask))},onHandleError:(l,c,f,i)=>(l.handleError(f,i),o.runOutsideAngular(()=>o.onError.emit(i)),!1)})}function GE(o){o._hasPendingMicrotasks||(o.shouldCoalesceEventChangeDetection||o.shouldCoalesceRunChangeDetection)&&o.lastRequestAnimationFrameId!==-1?o.hasPendingMicrotasks=!0:o.hasPendingMicrotasks=!1}function IR(o){o._nesting++,o.isStable&&(o.isStable=!1,o.onUnstable.emit(null))}function CR(o){o._nesting--,JI(o)}function o$(o){return!Array.isArray(o)||o.length!==1?!1:o[0].data?.__ignore_ng_zone__===!0}var $f=function(o){return o[o.EarlyRead=0]="EarlyRead",o[o.Write=1]="Write",o[o.MixedReadWrite=2]="MixedReadWrite",o[o.Read=3]="Read",o}($f||{}),s$={destroy(){}};function Vx(o,n){!n&&pk(Vx);let l=n?.injector??vt(bl);if(!B6(l))return s$;Kc("NgAfterNextRender");let c=l.get(eC),f=c.handler??=new qE,i=n?.phase??$f.MixedReadWrite,w=()=>{f.unregister(A),C()},C=l.get(Rx).onDestroy(w),A=Gs(l,()=>new HE(i,()=>{w(),o()}));return f.register(A),{destroy:w}}var HE=class{constructor(n,l){this.phase=n,this.callbackFn=l,this.zone=vt(fi),this.errorHandler=vt($s,{optional:!0}),vt(Qf,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(n){this.errorHandler?.handleError(n)}}},qE=class{constructor(){this.executingCallbacks=!1,this.buckets={[$f.EarlyRead]:new Set,[$f.Write]:new Set,[$f.MixedReadWrite]:new Set,[$f.Read]:new Set},this.deferredCallbacks=new Set}register(n){(this.executingCallbacks?this.deferredCallbacks:this.buckets[n.phase]).add(n)}unregister(n){this.buckets[n.phase].delete(n),this.deferredCallbacks.delete(n)}execute(){this.executingCallbacks=!0;for(let n of Object.values(this.buckets))for(let l of n)l.invoke();this.executingCallbacks=!1;for(let n of this.deferredCallbacks)this.buckets[n.phase].add(n);this.deferredCallbacks.clear()}destroy(){for(let n of Object.values(this.buckets))n.clear();this.deferredCallbacks.clear()}},eC=(()=>{let n=class n{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let c=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let f of c)f()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};n.\u0275prov=At({token:n,providedIn:"root",factory:()=>new n});let o=n;return o})();function mx(o,n,l){let c=l?o.styles:null,f=l?o.classes:null,i=0;if(n!==null)for(let w=0;w<n.length;w++){let C=n[w];if(typeof C=="number")i=C;else if(i==1)f=KP(f,C);else if(i==2){let A=C,L=n[++w];c=KP(c,A+": "+L+";")}}l?o.styles=c:o.stylesWithoutHost=c,l?o.classes=f:o.classesWithoutHost=f}var gx=class extends t_{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let l=$c(n);return new Jf(l,this.ngModule)}};function SR(o){let n=[];for(let l in o){if(!o.hasOwnProperty(l))continue;let c=o[l];c!==void 0&&n.push({propName:Array.isArray(c)?c[0]:c,templateName:l})}return n}function a$(o){let n=o.toLowerCase();return n==="svg"?bk:n==="math"?AU:null}var WE=class{constructor(n,l){this.injector=n,this.parentInjector=l}get(n,l,c){c=Tx(c);let f=this.injector.get(n,pE,c);return f!==pE||l===pE?f:this.parentInjector.get(n,l,c)}},Jf=class extends px{get inputs(){let n=this.componentDef,l=n.inputTransforms,c=SR(n.inputs);if(l!==null)for(let f of c)l.hasOwnProperty(f.propName)&&(f.transform=l[f.propName]);return c}get outputs(){return SR(this.componentDef.outputs)}constructor(n,l){super(),this.componentDef=n,this.ngModule=l,this.componentType=n.type,this.selector=cU(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!l}create(n,l,c,f){let i=di(null);try{f=f||this.ngModule;let w=f instanceof Io?f:f?.injector;w&&this.componentDef.getStandaloneInjector!==null&&(w=this.componentDef.getStandaloneInjector(w)||w);let C=w?new WE(n,w):n,A=C.get(Bh,null);if(A===null)throw new bt(407,!1);let L=C.get(e$,null),U=C.get(eC,null),Q=C.get(Qf,null),fe={rendererFactory:A,sanitizer:L,inlineEffectRunner:null,afterRenderEventManager:U,changeDetectionScheduler:Q},he=A.createRenderer(null,this.componentDef),be=this.componentDef.selectors[0][0]||"div",Se=c?u8(he,c,this.componentDef.encapsulation,C):aO(he,be,a$(be)),Ke=512;this.componentDef.signals?Ke|=4096:this.componentDef.onPush||(Ke|=16);let Fe=null;Se!==null&&(Fe=BI(Se,C,!0));let tt=WI(0,null,null,1,0,null,null,null,null,null,null),ft=zx(null,tt,null,Ke,null,null,fe,he,C,null,Fe);kI(ft);let Ue,zt;try{let Kt=this.componentDef,tn,Tt=null;Kt.findHostDirectiveDefs?(tn=[],Tt=new Map,Kt.findHostDirectiveDefs(Kt,tn,Tt),tn.push(Kt)):tn=[Kt];let ri=l$(ft,Se),Ct=c$(ri,Se,Kt,tn,ft,fe,he);zt=Tk(tt,Ia),Se&&d$(he,Kt,Se,c),l!==void 0&&f$(zt,this.ngContentSelectors,l),Ue=h$(Ct,Kt,tn,Tt,ft,[p$]),XI(tt,ft,null)}finally{OI()}return new ZE(this.componentType,Ue,rp(zt,ft),ft,zt)}finally{di(i)}}},ZE=class extends UE{constructor(n,l,c,f,i){super(),this.location=c,this._rootLView=f,this._tNode=i,this.previousInputValues=null,this.instance=l,this.hostView=this.changeDetectorRef=new zh(f,void 0,!1),this.componentType=n}setInput(n,l){let c=this._tNode.inputs,f;if(c!==null&&(f=c[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),l))return;let i=this._rootLView;YI(i[jn],i,f,n,l),this.previousInputValues.set(n,l);let w=Yc(this._tNode.index,i);KI(w)}}get injector(){return new Rh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function l$(o,n){let l=o[jn],c=Ia;return o[c]=n,op(l,c,2,"#host",null)}function c$(o,n,l,c,f,i,w){let C=f[jn];u$(c,o,n,w);let A=null;n!==null&&(A=BI(n,f[Yf]));let L=i.rendererFactory.createRenderer(n,l),U=16;l.signals?U=4096:l.onPush&&(U=64);let Q=zx(f,wO(l),null,U,f[o.index],o,i,L,null,null,A);return C.firstCreatePass&&BE(C,o,c.length-1),Bx(f,Q),f[o.index]=Q}function u$(o,n,l,c){for(let f of o)n.mergedAttrs=xI(n.mergedAttrs,f.hostAttrs);n.mergedAttrs!==null&&(mx(n,n.mergedAttrs,!0),l!==null&&_O(c,l,n))}function h$(o,n,l,c,f,i){let w=so(),C=f[jn],A=hs(w,f);EO(C,f,w,l,null,c);for(let U=0;U<l.length;U++){let Q=w.directiveStart+U,fe=Nh(f,C,Q,w);Gc(fe,f)}IO(C,f,w),A&&Gc(A,f);let L=Nh(f,C,w.directiveStart+w.componentOffset,w);if(o[Vs]=f[Vs]=L,i!==null)for(let U of i)U(L,n);return GI(C,w,f),L}function d$(o,n,l,c){if(c)EE(o,l,["ng-version","17.3.11"]);else{let{attrs:f,classes:i}=uU(n.selectors[0]);f&&EE(o,l,f),i&&i.length>0&&gO(o,l,i.join(" "))}}function f$(o,n,l){let c=o.projection=[];for(let f=0;f<n.length;f++){let i=l[f];c.push(i!=null?Array.from(i):null)}}function p$(){let o=so();Ax(ei()[jn],o)}var wl=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=m$;let o=n;return o})();function m$(){let o=so();return BO(o,ei())}var g$=wl,zO=class extends g${constructor(n,l,c){super(),this._lContainer=n,this._hostTNode=l,this._hostLView=c}get element(){return rp(this._hostTNode,this._hostLView)}get injector(){return new Rh(this._hostTNode,this._hostLView)}get parentInjector(){let n=FI(this._hostTNode,this._hostLView);if(Bk(n)){let l=lx(n,this._hostLView),c=ax(n),f=l[jn].data[c+8];return new Rh(f,l)}else return new Rh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let l=DR(this._lContainer);return l!==null&&l[n]||null}get length(){return this._lContainer.length-Vo}createEmbeddedView(n,l,c){let f,i;typeof c=="number"?f=c:c!=null&&(f=c.index,i=c.injector);let w=wR(this._lContainer,n.ssrId),C=n.createEmbeddedViewImpl(l||{},i,w);return this.insertImpl(C,f,bR(this._hostTNode,w)),C}createComponent(n,l,c,f,i){let w=n&&!IU(n),C;if(w)C=l;else{let be=l||{};C=be.index,c=be.injector,f=be.projectableNodes,i=be.environmentInjector||be.ngModuleRef}let A=w?n:new Jf($c(n)),L=c||this.parentInjector;if(!i&&A.ngModule==null){let Se=(w?L:this.parentInjector).get(Io,null);Se&&(i=Se)}let U=$c(A.componentType??{}),Q=wR(this._lContainer,U?.id??null),fe=Q?.firstChild??null,he=A.create(L,f,fe,i);return this.insertImpl(he.hostView,C,bR(this._hostTNode,Q)),he}insert(n,l){return this.insertImpl(n,l,!0)}insertImpl(n,l,c){let f=n._lView;if(OU(f)){let C=this.indexOf(n);if(C!==-1)this.detach(C);else{let A=f[jr],L=new zO(A,A[jo],A[jr]);L.detach(L.indexOf(n))}}let i=this._adjustIndex(l),w=this._lContainer;return F8(w,f,i,c),n.attachToViewContainerRef(),XR(mE(w),i,n),n}move(n,l){return this.insert(n,l)}indexOf(n){let l=DR(this._lContainer);return l!==null?l.indexOf(n):-1}remove(n){let l=this._adjustIndex(n,-1),c=NE(this._lContainer,l);c&&(rx(mE(this._lContainer),l),uO(c[jn],c))}detach(n){let l=this._adjustIndex(n,-1),c=NE(this._lContainer,l);return c&&rx(mE(this._lContainer),l)!=null?new zh(c):null}_adjustIndex(n,l=0){return n??this.length+l}};function DR(o){return o[sx]}function mE(o){return o[sx]||(o[sx]=[])}function BO(o,n){let l,c=n[o.index];return vl(c)?l=c:(l=CO(c,n,null,o),n[o.index]=l,Bx(n,l)),y$(l,n,o,c),new zO(l,o,n)}function _$(o,n){let l=o[hr],c=l.createComment(""),f=hs(n,o),i=UI(l,f);return dx(l,i,c,J6(l,f),!1),c}var y$=b$,v$=()=>!1;function x$(o,n,l){return v$(o,n,l)}function b$(o,n,l,c){if(o[Oh])return;let f;l.type&8?f=Ca(c):f=_$(n,l),o[Oh]=f}var YE=class o{constructor(n){this.queryList=n,this.matches=null}clone(){return new o(this.queryList)}setDirty(){this.queryList.setDirty()}},XE=class o{constructor(n=[]){this.queries=n}createEmbeddedView(n){let l=n.queries;if(l!==null){let c=n.contentQueries!==null?n.contentQueries[0]:l.length,f=[];for(let i=0;i<c;i++){let w=l.getByIndex(i),C=this.queries[w.indexInDeclarationView];f.push(C.clone())}return new o(f)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let l=0;l<this.queries.length;l++)tC(n,l).matches!==null&&this.queries[l].setDirty()}},KE=class{constructor(n,l,c=null){this.flags=l,this.read=c,typeof n=="string"?this.predicate=M$(n):this.predicate=n}},QE=class o{constructor(n=[]){this.queries=n}elementStart(n,l){for(let c=0;c<this.queries.length;c++)this.queries[c].elementStart(n,l)}elementEnd(n){for(let l=0;l<this.queries.length;l++)this.queries[l].elementEnd(n)}embeddedTView(n){let l=null;for(let c=0;c<this.length;c++){let f=l!==null?l.length:0,i=this.getByIndex(c).embeddedTView(n,f);i&&(i.indexInDeclarationView=c,l!==null?l.push(i):l=[i])}return l!==null?new o(l):null}template(n,l){for(let c=0;c<this.queries.length;c++)this.queries[c].template(n,l)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},JE=class o{constructor(n,l=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=l}elementStart(n,l){this.isApplyingToNode(l)&&this.matchTNode(n,l)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,l){this.elementStart(n,l)}embeddedTView(n,l){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,l),new o(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let l=this._declarationNodeIndex,c=n.parent;for(;c!==null&&c.type&8&&c.index!==l;)c=c.parent;return l===(c!==null?c.index:-1)}return this._appliesToNextNode}matchTNode(n,l){let c=this.metadata.predicate;if(Array.isArray(c))for(let f=0;f<c.length;f++){let i=c[f];this.matchTNodeWithReadOption(n,l,w$(l,i)),this.matchTNodeWithReadOption(n,l,Jv(l,n,i,!1,!1))}else c===Hc?l.type&4&&this.matchTNodeWithReadOption(n,l,-1):this.matchTNodeWithReadOption(n,l,Jv(l,n,c,!1,!1))}matchTNodeWithReadOption(n,l,c){if(c!==null){let f=this.metadata.read;if(f!==null)if(f===Or||f===wl||f===Hc&&l.type&4)this.addMatch(l.index,-2);else{let i=Jv(l,n,f,!1,!1);i!==null&&this.addMatch(l.index,i)}else this.addMatch(l.index,c)}}addMatch(n,l){this.matches===null?this.matches=[n,l]:this.matches.push(n,l)}};function w$(o,n){let l=o.localNames;if(l!==null){for(let c=0;c<l.length;c+=2)if(l[c]===n)return l[c+1]}return null}function T$(o,n){return o.type&11?rp(o,n):o.type&4?QI(o,n):null}function E$(o,n,l,c){return l===-1?T$(n,o):l===-2?I$(o,n,c):Nh(o,o[jn],l,n)}function I$(o,n,l){if(l===Or)return rp(n,o);if(l===Hc)return QI(n,o);if(l===wl)return BO(n,o)}function VO(o,n,l,c){let f=n[_l].queries[c];if(f.matches===null){let i=o.data,w=l.matches,C=[];for(let A=0;w!==null&&A<w.length;A+=2){let L=w[A];if(L<0)C.push(null);else{let U=i[L];C.push(E$(n,U,w[A+1],l.metadata.read))}}f.matches=C}return f.matches}function eI(o,n,l,c){let f=o.queries.getByIndex(l),i=f.matches;if(i!==null){let w=VO(o,n,f,l);for(let C=0;C<i.length;C+=2){let A=i[C];if(A>0)c.push(w[C/2]);else{let L=i[C+1],U=n[-A];for(let Q=Vo;Q<U.length;Q++){let fe=U[Q];fe[Xg]===fe[jr]&&eI(fe[jn],fe,L,c)}if(U[Xf]!==null){let Q=U[Xf];for(let fe=0;fe<Q.length;fe++){let he=Q[fe];eI(he[jn],he,L,c)}}}}}return c}function C$(o,n){return o[_l].queries[n].queryList}function S$(o,n,l){let c=new ux((l&4)===4);return f8(o,n,c,c.destroy),(n[_l]??=new XE).queries.push(new YE(c))-1}function D$(o,n,l,c){let f=Ur();if(f.firstCreatePass){let i=so();A$(f,new KE(n,l,c),i.index),P$(f,o),(l&2)===2&&(f.staticContentQueries=!0)}return S$(f,ei(),l)}function M$(o){return o.split(",").map(n=>n.trim())}function A$(o,n,l){o.queries===null&&(o.queries=new QE),o.queries.track(new JE(n,l))}function P$(o,n){let l=o.contentQueries||(o.contentQueries=[]),c=l.length?l[l.length-1]:-1;n!==c&&l.push(o.queries.length-1,n)}function tC(o,n){return o.queries.getByIndex(n)}function R$(o,n){let l=o[jn],c=tC(l,n);return c.crossesNgTemplate?eI(l,o,n,[]):VO(l,o,c,n)}function jO(o,n){Kc("NgSignals");let l=vP(o),c=l[Fc];return n?.equal&&(c.equal=n.equal),l.set=f=>Tv(c,f),l.update=f=>xP(c,f),l.asReadonly=k$.bind(l),l}function k$(){let o=this[Fc];if(o.readonlyFn===void 0){let n=()=>this();n[Fc]=o,o.readonlyFn=n}return o.readonlyFn}function sp(o){let n=o.inputConfig,l={};for(let c in n)if(n.hasOwnProperty(c)){let f=n[c];Array.isArray(f)&&f[3]&&(l[c]=f[3])}o.inputTransforms=l}var qc=class{},Hg=class{};var tI=class extends qc{constructor(n,l,c){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new gx(this);let f=sk(n);this._bootstrapComponents=sO(f.bootstrap),this._r3Injector=Zk(n,l,[{provide:qc,useValue:this},{provide:t_,useValue:this.componentFactoryResolver},...c],oo(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},nI=class extends Hg{constructor(n){super(),this.moduleType=n}create(n){return new tI(this.moduleType,n,[])}};var _x=class extends qc{constructor(n){super(),this.componentFactoryResolver=new gx(this),this.instance=null;let l=new Bg([...n.providers,{provide:qc,useValue:this},{provide:t_,useValue:this.componentFactoryResolver}],n.parent||TI(),n.debugName,new Set(["environment"]));this.injector=l,n.runEnvironmentInitializers&&l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function nC(o,n,l=null){return new _x({providers:o,parent:n,debugName:l,runEnvironmentInitializers:!0}).injector}var Qc=(()=>{let n=class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new wr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let c=this.taskId++;return this.pendingTasks.add(c),c}remove(c){this.pendingTasks.delete(c),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function UO(o){return iC(o)?Array.isArray(o)||!(o instanceof Map)&&Symbol.iterator in o:!1}function O$(o,n){if(Array.isArray(o))for(let l=0;l<o.length;l++)n(o[l]);else{let l=o[Symbol.iterator](),c;for(;!(c=l.next()).done;)n(c.value)}}function iC(o){return o!==null&&(typeof o=="function"||typeof o=="object")}function rC(o,n,l){return o[n]=l}function L$(o,n){return o[n]}function Wc(o,n,l){let c=o[n];return Object.is(c,l)?!1:(o[n]=l,!0)}function $O(o,n,l,c){let f=Wc(o,n,l);return Wc(o,n+1,c)||f}function F$(o,n,l,c,f){let i=$O(o,n,l,c);return Wc(o,n+2,f)||i}function N$(o){return(o.flags&32)===32}function z$(o,n,l,c,f,i,w,C,A){let L=n.consts,U=op(n,o,4,w||null,Kf(L,C));ZI(n,l,U,Kf(L,A)),Ax(n,U);let Q=U.tView=WI(2,U,c,f,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,L,null);return n.queries!==null&&(n.queries.template(n,U),Q.queries=n.queries.embeddedTView(U)),U}function ao(o,n,l,c,f,i,w,C){let A=ei(),L=Ur(),U=o+Ia,Q=L.firstCreatePass?z$(U,L,A,n,l,c,f,i,w):L.data[U];jh(Q,!1);let fe=B$(L,A,Q,o);Dx()&&Fx(L,A,fe,Q),Gc(fe,A);let he=CO(fe,A,fe,Q);return A[U]=he,Bx(A,he),x$(he,Q,A),Sx(Q)&&HI(L,A,Q),w!=null&&qI(A,Q,C),ao}var B$=V$;function V$(o,n,l,c){return Mx(!0),n[hr].createComment("")}function ap(o,n,l,c){let f=ei(),i=PI();if(Wc(f,i,n)){let w=Ur(),C=LI();D8(C,f,o,n,l,c)}return ap}function GO(o,n,l,c){return Wc(o,PI(),l)?n+Ah(l)+c:qs}function j$(o,n,l,c,f,i,w,C){let A=GU(),L=F$(o,A,l,f,w);return Mk(3),L?n+Ah(l)+c+Ah(f)+i+Ah(w)+C:qs}function Zv(o,n){return o<<17|n<<2}function Vh(o){return o>>17&32767}function U$(o){return(o&2)==2}function $$(o,n){return o&131071|n<<17}function iI(o){return o|2}function ep(o){return(o&131068)>>2}function gE(o,n){return o&-131069|n<<2}function G$(o){return(o&1)===1}function rI(o){return o|1}function H$(o,n,l,c,f,i){let w=i?n.classBindings:n.styleBindings,C=Vh(w),A=ep(w);o[c]=l;let L=!1,U;if(Array.isArray(l)){let Q=l;U=Q[1],(U===null||Yg(Q,U)>0)&&(L=!0)}else U=l;if(f)if(A!==0){let fe=Vh(o[C+1]);o[c+1]=Zv(fe,C),fe!==0&&(o[fe+1]=gE(o[fe+1],c)),o[C+1]=$$(o[C+1],c)}else o[c+1]=Zv(C,0),C!==0&&(o[C+1]=gE(o[C+1],c)),C=c;else o[c+1]=Zv(A,0),C===0?C=c:o[A+1]=gE(o[A+1],c),A=c;L&&(o[c+1]=iI(o[c+1])),MR(o,U,c,!0),MR(o,U,c,!1),q$(n,U,o,c,i),w=Zv(C,A),i?n.classBindings=w:n.styleBindings=w}function q$(o,n,l,c,f){let i=f?o.residualClasses:o.residualStyles;i!=null&&typeof n=="string"&&Yg(i,n)>=0&&(l[c+1]=rI(l[c+1]))}function MR(o,n,l,c){let f=o[l+1],i=n===null,w=c?Vh(f):ep(f),C=!1;for(;w!==0&&(C===!1||i);){let A=o[w],L=o[w+1];W$(A,n)&&(C=!0,o[w+1]=c?rI(L):iI(L)),w=c?Vh(L):ep(L)}C&&(o[l+1]=c?iI(f):rI(f))}function W$(o,n){return o===null||n==null||(Array.isArray(o)?o[1]:o)===n?!0:Array.isArray(o)&&typeof n=="string"?Yg(o,n)>=0:!1}function vi(o,n,l){let c=ei(),f=PI();if(Wc(c,f,n)){let i=Ur(),w=LI();TO(i,w,c,o,n,c[hr],l,!1)}return vi}function AR(o,n,l,c,f){let i=n.inputs,w=f?"class":"style";YI(o,l,i[w],w,c)}function $h(o,n,l){return HO(o,n,l,!1),$h}function n_(o,n){return HO(o,n,null,!0),n_}function HO(o,n,l,c){let f=ei(),i=Ur(),w=Mk(2);if(i.firstUpdatePass&&Y$(i,o,w,c),n!==qs&&Wc(f,w,n)){let C=i.data[Uh()];eG(i,C,f,f[hr],o,f[w+1]=tG(n,l),c,w)}}function Z$(o,n){return n>=o.expandoStartIndex}function Y$(o,n,l,c){let f=o.data;if(f[l+1]===null){let i=f[Uh()],w=Z$(o,l);nG(i,c)&&n===null&&!w&&(n=!1),n=X$(f,i,n,c),H$(f,i,n,l,w,c)}}function X$(o,n,l,c){let f=YU(o),i=c?n.residualClasses:n.residualStyles;if(f===null)(c?n.classBindings:n.styleBindings)===0&&(l=_E(null,o,n,l,c),l=qg(l,n.attrs,c),i=null);else{let w=n.directiveStylingLast;if(w===-1||o[w]!==f)if(l=_E(f,o,n,l,c),i===null){let A=K$(o,n,c);A!==void 0&&Array.isArray(A)&&(A=_E(null,o,n,A[1],c),A=qg(A,n.attrs,c),Q$(o,n,c,A))}else i=J$(o,n,c)}return i!==void 0&&(c?n.residualClasses=i:n.residualStyles=i),l}function K$(o,n,l){let c=l?n.classBindings:n.styleBindings;if(ep(c)!==0)return o[Vh(c)]}function Q$(o,n,l,c){let f=l?n.classBindings:n.styleBindings;o[Vh(f)]=c}function J$(o,n,l){let c,f=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<f;i++){let w=o[i].hostAttrs;c=qg(c,w,l)}return qg(c,n.attrs,l)}function _E(o,n,l,c,f){let i=null,w=l.directiveEnd,C=l.directiveStylingLast;for(C===-1?C=l.directiveStart:C++;C<w&&(i=n[C],c=qg(c,i.hostAttrs,f),i!==o);)C++;return o!==null&&(l.directiveStylingLast=C),c}function qg(o,n,l){let c=l?1:2,f=-1;if(n!==null)for(let i=0;i<n.length;i++){let w=n[i];typeof w=="number"?f=w:f===c&&(Array.isArray(o)||(o=o===void 0?[]:["",o]),Xj(o,w,l?!0:n[++i]))}return o===void 0?null:o}function eG(o,n,l,c,f,i,w,C){if(!(n.type&3))return;let A=o.data,L=A[C+1],U=G$(L)?PR(A,n,l,f,ep(L),w):void 0;if(!yx(U)){yx(i)||U$(L)&&(i=PR(A,null,l,f,C,w));let Q=wk(Uh(),l);o8(c,w,Q,f,i)}}function PR(o,n,l,c,f,i){let w=n===null,C;for(;f>0;){let A=o[f],L=Array.isArray(A),U=L?A[1]:A,Q=U===null,fe=l[f+1];fe===qs&&(fe=Q?zs:void 0);let he=Q?aE(fe,c):U===c?fe:void 0;if(L&&!yx(he)&&(he=aE(A,c)),yx(he)&&(C=he,w))return C;let be=o[f+1];f=w?Vh(be):ep(be)}if(n!==null){let A=i?n.residualClasses:n.residualStyles;A!=null&&(C=aE(A,c))}return C}function yx(o){return o!==void 0}function tG(o,n){return o==null||o===""||(typeof n=="string"?o=o+n:typeof o=="object"&&(o=oo(e_(o)))),o}function nG(o,n){return(o.flags&(n?8:16))!==0}function iG(o,n,l,c,f,i){let w=n.consts,C=Kf(w,f),A=op(n,o,2,c,C);return ZI(n,l,A,Kf(w,i)),A.attrs!==null&&mx(A,A.attrs,!1),A.mergedAttrs!==null&&mx(A,A.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,A),A}function nn(o,n,l,c){let f=ei(),i=Ur(),w=Ia+o,C=f[hr],A=i.firstCreatePass?iG(w,i,f,n,l,c):i.data[w],L=rG(i,f,A,C,n,o);f[w]=L;let U=Sx(A);return jh(A,!0),_O(C,L,A),!N$(A)&&Dx()&&Fx(i,f,L,A),zU()===0&&Gc(L,f),BU(),U&&(HI(i,f,A),GI(i,A,f)),c!==null&&qI(f,A),nn}function en(){let o=so();DI()?MI():(o=o.parent,jh(o,!1));let n=o;jU(n)&&UU(),VU();let l=Ur();return l.firstCreatePass&&(Ax(l,o),II(o)&&l.queries.elementEnd(o)),n.classesWithoutHost!=null&&n6(n)&&AR(l,n,ei(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&i6(n)&&AR(l,n,ei(),n.stylesWithoutHost,!1),en}function si(o,n,l,c){return nn(o,n,l,c),en(),si}var rG=(o,n,l,c,f,i)=>(Mx(!0),aO(c,f,QU()));function oG(o,n,l,c,f){let i=n.consts,w=Kf(i,c),C=op(n,o,8,"ng-container",w);w!==null&&mx(C,w,!0);let A=Kf(i,f);return ZI(n,l,C,A),n.queries!==null&&n.queries.elementStart(n,C),C}function oC(o,n,l){let c=ei(),f=Ur(),i=o+Ia,w=f.firstCreatePass?oG(i,f,c,n,l):f.data[i];jh(w,!0);let C=sG(f,c,w,o);return c[i]=C,Dx()&&Fx(f,c,C,w),Gc(C,c),Sx(w)&&(HI(f,c,w),GI(f,w,c)),l!=null&&qI(c,w),oC}function sC(){let o=so(),n=Ur();return DI()?MI():(o=o.parent,jh(o,!1)),n.firstCreatePass&&(Ax(n,o),II(o)&&n.queries.elementEnd(o)),sC}var sG=(o,n,l,c)=>(Mx(!0),$6(n[hr],""));function i_(){return ei()}var vx="en-US";var aG=vx;function lG(o){typeof o=="string"&&(aG=o.toLowerCase().replace(/_/g,"-"))}function Oi(o,n,l,c){let f=ei(),i=Ur(),w=so();return uG(i,f,f[hr],w,o,n,c),Oi}function cG(o,n,l,c){let f=o.cleanup;if(f!=null)for(let i=0;i<f.length-1;i+=2){let w=f[i];if(w===l&&f[i+1]===c){let C=n[jg],A=f[i+2];return C.length>A?C[A]:null}typeof w=="string"&&(i+=2)}return null}function uG(o,n,l,c,f,i,w){let C=Sx(c),L=o.firstCreatePass&&MO(o),U=n[Vs],Q=DO(n),fe=!0;if(c.type&3||w){let Se=hs(c,n),Ke=w?w(Se):Se,Fe=Q.length,tt=w?Ue=>w(Ca(Ue[c.index])):c.index,ft=null;if(!w&&C&&(ft=cG(o,n,f,c.index)),ft!==null){let Ue=ft.__ngLastListenerFn__||ft;Ue.__ngNextListenerFn__=i,ft.__ngLastListenerFn__=i,fe=!1}else{i=kR(c,n,U,i,!1);let Ue=l.listen(Ke,f,i);Q.push(i,Ue),L&&L.push(f,tt,Fe,Fe+1)}}else i=kR(c,n,U,i,!1);let he=c.outputs,be;if(fe&&he!==null&&(be=he[f])){let Se=be.length;if(Se)for(let Ke=0;Ke<Se;Ke+=2){let Fe=be[Ke],tt=be[Ke+1],zt=n[Fe][tt].subscribe(i),Kt=Q.length;Q.push(i,zt),L&&L.push(f,c.index,Kt,-(Kt+1))}}}function RR(o,n,l,c){let f=di(null);try{return wa(6,n,l),l(c)!==!1}catch(i){return AO(o,i),!1}finally{wa(7,n,l),di(f)}}function kR(o,n,l,c,f){return function i(w){if(w===Function)return c;let C=o.componentOffset>-1?Yc(o.index,n):n;KI(C);let A=RR(n,l,c,w),L=i.__ngNextListenerFn__;for(;L;)A=RR(n,l,L,w)&&A,L=L.__ngNextListenerFn__;return f&&A===!1&&w.preventDefault(),A}}function lp(o=1){return KU(o)}function hG(o,n){let l=null,c=rU(o);for(let f=0;f<n.length;f++){let i=n[f];if(i==="*"){l=f;continue}if(c===null?nk(o,i,!0):aU(c,i))return f}return l}function Jc(o){let n=ei()[Us][jo];if(!n.projection){let l=o?o.length:1,c=n.projection=Zj(l,null),f=c.slice(),i=n.child;for(;i!==null;){let w=o?hG(i,o):0;w!==null&&(f[w]?f[w].projectionNext=i:c[w]=i,f[w]=i),i=i.next}}}function eu(o,n=0,l){let c=ei(),f=Ur(),i=op(f,Ia+o,16,null,l||null);i.projection===null&&(i.projection=n),MI(),(!c[Vg]||Sk())&&(i.flags&32)!==32&&i8(f,c,i)}function aC(o,n,l){return qO(o,"",n,"",l),aC}function qO(o,n,l,c,f){let i=ei(),w=GO(i,n,l,c);if(w!==qs){let C=Ur(),A=LI();TO(C,A,i,o,w,i[hr],f,!1)}return qO}function jx(o,n,l,c){D$(o,n,l,c)}function r_(o){let n=ei(),l=Ur(),c=Ak();RI(c+1);let f=tC(l,c);if(o.dirty&&kU(n)===((f.metadata.flags&2)===2)){if(f.matches===null)o.reset([]);else{let i=R$(n,c);o.reset(i,_6),o.notifyOnChanges()}return!0}return!1}function o_(){return C$(ei(),Ak())}function xi(o,n=""){let l=ei(),c=Ur(),f=o+Ia,i=c.firstCreatePass?op(c,f,1,n,null):c.data[f],w=dG(c,l,i,n,o);l[f]=w,Dx()&&Fx(c,l,w,i),jh(i,!1)}var dG=(o,n,l,c,f)=>(Mx(!0),j6(n[hr],c));function Uo(o,n,l){let c=ei(),f=GO(c,o,n,l);return f!==qs&&PO(c,Uh(),f),Uo}function lC(o,n,l,c,f,i,w){let C=ei(),A=j$(C,o,n,l,c,f,i,w);return A!==qs&&PO(C,Uh(),A),lC}function fG(o,n,l){let c=Ur();if(c.firstCreatePass){let f=ip(o);oI(l,c.data,c.blueprint,f,!0),oI(n,c.data,c.blueprint,f,!1)}}function oI(o,n,l,c,f){if(o=ro(o),Array.isArray(o))for(let i=0;i<o.length;i++)oI(o[i],n,l,c,f);else{let i=Ur(),w=ei(),C=so(),A=Zf(o)?o:ro(o.provide),L=dk(o),U=C.providerIndexes&1048575,Q=C.directiveStart,fe=C.providerIndexes>>20;if(Zf(o)||!o.multi){let he=new Fh(L,f,Kn),be=vE(A,n,f?U:U+fe,Q);be===-1?(RE(cx(C,w),i,A),yE(i,o,n.length),n.push(A),C.directiveStart++,C.directiveEnd++,f&&(C.providerIndexes+=1048576),l.push(he),w.push(he)):(l[be]=he,w[be]=he)}else{let he=vE(A,n,U+fe,Q),be=vE(A,n,U,U+fe),Se=he>=0&&l[he],Ke=be>=0&&l[be];if(f&&!Ke||!f&&!Se){RE(cx(C,w),i,A);let Fe=gG(f?mG:pG,l.length,f,c,L);!f&&Ke&&(l[be].providerFactory=Fe),yE(i,o,n.length,0),n.push(A),C.directiveStart++,C.directiveEnd++,f&&(C.providerIndexes+=1048576),l.push(Fe),w.push(Fe)}else{let Fe=WO(l[f?be:he],L,!f&&c);yE(i,o,he>-1?he:be,Fe)}!f&&c&&Ke&&l[be].componentProviders++}}}function yE(o,n,l,c){let f=Zf(n),i=yU(n);if(f||i){let A=(i?ro(n.useClass):n).prototype.ngOnDestroy;if(A){let L=o.destroyHooks||(o.destroyHooks=[]);if(!f&&n.multi){let U=L.indexOf(l);U===-1?L.push(l,[c,A]):L[U+1].push(c,A)}else L.push(l,A)}}}function WO(o,n,l){return l&&o.componentProviders++,o.multi.push(n)-1}function vE(o,n,l,c){for(let f=l;f<c;f++)if(n[f]===o)return f;return-1}function pG(o,n,l,c){return sI(this.multi,[])}function mG(o,n,l,c){let f=this.multi,i;if(this.providerFactory){let w=this.providerFactory.componentProviders,C=Nh(l,l[jn],this.providerFactory.index,c);i=C.slice(0,w),sI(f,i);for(let A=w;A<C.length;A++)i.push(C[A])}else i=[],sI(f,i);return i}function sI(o,n){for(let l=0;l<o.length;l++){let c=o[l];n.push(c())}return n}function gG(o,n,l,c,f){let i=new Fh(o,l,Kn);return i.multi=[],i.index=n,i.componentProviders=0,WO(i,f,c&&!l),i}function Gh(o,n=[]){return l=>{l.providersResolver=(c,f)=>fG(c,f?f(o):o,n)}}var _G=(()=>{let n=class n{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c)){let f=ck(!1,c.type),i=f.length>0?nC([f],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c,i)}return this.cachedInjectors.get(c)}ngOnDestroy(){try{for(let c of this.cachedInjectors.values())c!==null&&c.destroy()}finally{this.cachedInjectors.clear()}}};n.\u0275prov=At({token:n,providedIn:"environment",factory:()=>new n(Vt(Io))});let o=n;return o})();function bi(o){Kc("NgStandalone"),o.getStandaloneInjector=n=>n.get(_G).getOrCreateStandaloneInjector(o)}function ZO(o,n,l){let c=AI()+o,f=ei();return f[c]===qs?rC(f,c,l?n.call(l):n()):L$(f,c)}function cC(o,n,l,c){return yG(ei(),AI(),o,n,l,c)}function uC(o,n,l,c,f){return vG(ei(),AI(),o,n,l,c,f)}function YO(o,n){let l=o[n];return l===qs?void 0:l}function yG(o,n,l,c,f,i){let w=n+l;return Wc(o,w,f)?rC(o,w+1,i?c.call(i,f):c(f)):YO(o,w+1)}function vG(o,n,l,c,f,i,w){let C=n+l;return $O(o,C,f,i)?rC(o,C+2,w?c.call(w,f,i):c(f,i)):YO(o,C+2)}var Ux=(()=>{let n=class n{log(c){console.log(c)}warn(c){console.warn(c)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"platform"});let o=n;return o})();var XO=new an("");function s_(o){return!!o&&typeof o.then=="function"}function KO(o){return!!o&&typeof o.subscribe=="function"}var QO=new an(""),JO=(()=>{let n=class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((c,f)=>{this.resolve=c,this.reject=f}),this.appInits=vt(QO,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let c=[];for(let i of this.appInits){let w=i();if(s_(w))c.push(w);else if(KO(w)){let C=new Promise((A,L)=>{w.subscribe({complete:A,error:L})});c.push(C)}}let f=()=>{this.done=!0,this.resolve()};Promise.all(c).then(()=>{f()}).catch(i=>{this.reject(i)}),c.length===0&&f(),this.initialized=!0}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),$x=new an("");function xG(){yP(()=>{throw new bt(600,!1)})}function bG(o){return o.isBoundToModule}function wG(o,n,l){try{let c=l();return s_(c)?c.catch(f=>{throw n.runOutsideAngular(()=>o.handleError(f)),f}):c}catch(c){throw n.runOutsideAngular(()=>o.handleError(c)),c}}var cp=(()=>{let n=class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=vt(Yk),this.afterRenderEffectManager=vt(eC),this.externalTestViews=new Set,this.beforeRender=new cr,this.afterTick=new cr,this.componentTypes=[],this.components=[],this.isStable=vt(Qc).hasPendingTasks.pipe(Dn(c=>!c)),this._injector=vt(Io)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(c,f){let i=c instanceof px;if(!this._injector.get(JO).done){let he=!i&&ok(c),be=!1;throw new bt(405,be)}let C;i?C=c:C=this._injector.get(t_).resolveComponentFactory(c),this.componentTypes.push(C.componentType);let A=bG(C)?void 0:this._injector.get(qc),L=f||C.selector,U=C.create(bl.NULL,[],L,A),Q=U.location.nativeElement,fe=U.injector.get(XO,null);return fe?.registerApplication(Q),U.onDestroy(()=>{this.detachView(U.hostView),xE(this.components,U),fe?.unregisterApplication(Q)}),this._loadComponent(U),U}tick(){this._tick(!0)}_tick(c){if(this._runningTick)throw new bt(101,!1);let f=di(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(c)}catch(i){this.internalErrorHandler(i)}finally{this.afterTick.next(),this._runningTick=!1,di(f)}}detectChangesInAttachedViews(c){let f=0,i=this.afterRenderEffectManager;for(;;){if(f===kO)throw new bt(103,!1);if(c){let w=f===0;this.beforeRender.next(w);for(let{_lView:C,notifyErrorHandler:A}of this._views)TG(C,w,A)}if(f++,i.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>aI(w))&&(i.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:w})=>aI(w))))break}}attachView(c){let f=c;this._views.push(f),f.attachToAppRef(this)}detachView(c){let f=c;xE(this._views,f),f.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);let f=this._injector.get($x,[]);[...this._bootstrapListeners,...f].forEach(i=>i(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>xE(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new bt(406,!1);let c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function xE(o,n){let l=o.indexOf(n);l>-1&&o.splice(l,1)}function TG(o,n,l){!n&&!aI(o)||EG(o,l,n)}function aI(o){return SI(o)}function EG(o,n,l){let c;l?(c=0,o[gn]|=1024):o[gn]&64?c=0:c=1,OO(o,n,c)}var lI=class{constructor(n,l){this.ngModuleFactory=n,this.componentFactories=l}},hC=(()=>{let n=class n{compileModuleSync(c){return new nI(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){let f=this.compileModuleSync(c),i=sk(c),w=sO(i.declarations).reduce((C,A)=>{let L=$c(A);return L&&C.push(new Jf(L)),C},[]);return new lI(f,w)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var IG=(()=>{let n=class n{constructor(){this.zone=vt(fi),this.applicationRef=vt(cp)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function CG(o){return[{provide:fi,useFactory:o},{provide:Wf,multi:!0,useFactory:()=>{let n=vt(IG,{optional:!0});return()=>n.initialize()}},{provide:Wf,multi:!0,useFactory:()=>{let n=vt(AG);return()=>{n.initialize()}}},{provide:Yk,useFactory:SG}]}function SG(){let o=vt(fi),n=vt($s);return l=>o.runOutsideAngular(()=>n.handleError(l))}function DG(o){let n=CG(()=>new fi(MG(o)));return Zc([[],n])}function MG(o){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:o?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:o?.runCoalescing??!1}}var AG=(()=>{let n=class n{constructor(){this.subscription=new Ji,this.initialized=!1,this.zone=vt(fi),this.pendingTasks=vt(Qc)}initialize(){if(this.initialized)return;this.initialized=!0;let c=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(c=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{fi.assertNotInAngularZone(),queueMicrotask(()=>{c!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(c),c=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{fi.assertInAngularZone(),c??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function PG(){return typeof $localize<"u"&&$localize.locale||vx}var Gx=new an("",{providedIn:"root",factory:()=>vt(Gx,Gn.Optional|Gn.SkipSelf)||PG()});var eL=new an("");var tx=null;function RG(o=[],n){return bl.create({name:n,providers:[{provide:Ex,useValue:"platform"},{provide:eL,useValue:new Set([()=>tx=null])},...o]})}function kG(o=[]){if(tx)return tx;let n=RG(o);return tx=n,xG(),OG(n),n}function OG(o){o.get(zI,null)?.forEach(l=>l())}var tu=(()=>{let n=class n{};n.__NG_ELEMENT_ID__=LG;let o=n;return o})();function LG(o){return FG(so(),ei(),(o&16)===16)}function FG(o,n,l){if(Cx(o)&&!l){let c=Yc(o.index,n);return new zh(c,c)}else if(o.type&47){let c=n[Us];return new zh(c,n)}return null}var cI=class{constructor(){}supports(n){return UO(n)}create(n){return new uI(n)}},NG=(o,n)=>n,uI=class{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||NG}forEachItem(n){let l;for(l=this._itHead;l!==null;l=l._next)n(l)}forEachOperation(n){let l=this._itHead,c=this._removalsHead,f=0,i=null;for(;l||c;){let w=!c||l&&l.currentIndex<OR(c,f,i)?l:c,C=OR(w,f,i),A=w.currentIndex;if(w===c)f--,c=c._nextRemoved;else if(l=l._next,w.previousIndex==null)f++;else{i||(i=[]);let L=C-f,U=A-f;if(L!=U){for(let fe=0;fe<L;fe++){let he=fe<i.length?i[fe]:i[fe]=0,be=he+fe;U<=be&&be<L&&(i[fe]=he+1)}let Q=w.previousIndex;i[Q]=U-L}}C!==A&&n(w,C,A)}}forEachPreviousItem(n){let l;for(l=this._previousItHead;l!==null;l=l._nextPrevious)n(l)}forEachAddedItem(n){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)n(l)}forEachMovedItem(n){let l;for(l=this._movesHead;l!==null;l=l._nextMoved)n(l)}forEachRemovedItem(n){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)n(l)}forEachIdentityChange(n){let l;for(l=this._identityChangesHead;l!==null;l=l._nextIdentityChange)n(l)}diff(n){if(n==null&&(n=[]),!UO(n))throw new bt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l=this._itHead,c=!1,f,i,w;if(Array.isArray(n)){this.length=n.length;for(let C=0;C<this.length;C++)i=n[C],w=this._trackByFn(C,i),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,i,w,C),c=!0):(c&&(l=this._verifyReinsertion(l,i,w,C)),Object.is(l.item,i)||this._addIdentityChange(l,i)),l=l._next}else f=0,O$(n,C=>{w=this._trackByFn(f,C),l===null||!Object.is(l.trackById,w)?(l=this._mismatch(l,C,w,f),c=!0):(c&&(l=this._verifyReinsertion(l,C,w,f)),Object.is(l.item,C)||this._addIdentityChange(l,C)),l=l._next,f++}),this.length=f;return this._truncate(l),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,l,c,f){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null),n!==null?(Object.is(n.item,l)||this._addIdentityChange(n,l),this._reinsertAfter(n,i,f)):(n=this._linkedRecords===null?null:this._linkedRecords.get(c,f),n!==null?(Object.is(n.item,l)||this._addIdentityChange(n,l),this._moveAfter(n,i,f)):n=this._addAfter(new hI(l,c),i,f)),n}_verifyReinsertion(n,l,c,f){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null);return i!==null?n=this._reinsertAfter(i,n._prev,f):n.currentIndex!=f&&(n.currentIndex=f,this._addToMoves(n,f)),n}_truncate(n){for(;n!==null;){let l=n._next;this._addToRemovals(this._unlink(n)),n=l}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,l,c){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let f=n._prevRemoved,i=n._nextRemoved;return f===null?this._removalsHead=i:f._nextRemoved=i,i===null?this._removalsTail=f:i._prevRemoved=f,this._insertAfter(n,l,c),this._addToMoves(n,c),n}_moveAfter(n,l,c){return this._unlink(n),this._insertAfter(n,l,c),this._addToMoves(n,c),n}_addAfter(n,l,c){return this._insertAfter(n,l,c),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,l,c){let f=l===null?this._itHead:l._next;return n._next=f,n._prev=l,f===null?this._itTail=n:f._prev=n,l===null?this._itHead=n:l._next=n,this._linkedRecords===null&&(this._linkedRecords=new xx),this._linkedRecords.put(n),n.currentIndex=c,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let l=n._prev,c=n._next;return l===null?this._itHead=c:l._next=c,c===null?this._itTail=l:c._prev=l,n}_addToMoves(n,l){return n.previousIndex===l||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new xx),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,l){return n.item=l,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},hI=class{constructor(n,l){this.item=n,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},dI=class{constructor(){this._head=null,this._tail=null}add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,l){let c;for(c=this._head;c!==null;c=c._nextDup)if((l===null||l<=c.currentIndex)&&Object.is(c.trackById,n))return c;return null}remove(n){let l=n._prevDup,c=n._nextDup;return l===null?this._head=c:l._nextDup=c,c===null?this._tail=l:c._prevDup=l,this._head===null}},xx=class{constructor(){this.map=new Map}put(n){let l=n.trackById,c=this.map.get(l);c||(c=new dI,this.map.set(l,c)),c.add(n)}get(n,l){let c=n,f=this.map.get(c);return f?f.get(n,l):null}remove(n){let l=n.trackById;return this.map.get(l).remove(n)&&this.map.delete(l),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function OR(o,n,l){let c=o.previousIndex;if(c===null)return c;let f=0;return l&&c<l.length&&(f=l[c]),c+n+f}var fI=class{constructor(){}supports(n){return n instanceof Map||iC(n)}create(){return new pI}},pI=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(n){let l;for(l=this._mapHead;l!==null;l=l._next)n(l)}forEachPreviousItem(n){let l;for(l=this._previousMapHead;l!==null;l=l._nextPrevious)n(l)}forEachChangedItem(n){let l;for(l=this._changesHead;l!==null;l=l._nextChanged)n(l)}forEachAddedItem(n){let l;for(l=this._additionsHead;l!==null;l=l._nextAdded)n(l)}forEachRemovedItem(n){let l;for(l=this._removalsHead;l!==null;l=l._nextRemoved)n(l)}diff(n){if(!n)n=new Map;else if(!(n instanceof Map||iC(n)))throw new bt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(n,(c,f)=>{if(l&&l.key===f)this._maybeAddToChanges(l,c),this._appendAfter=l,l=l._next;else{let i=this._getOrCreateRecordForKey(f,c);l=this._insertBeforeOrAppend(l,i)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let c=l;c!==null;c=c._nextRemoved)c===this._mapHead&&(this._mapHead=null),this._records.delete(c.key),c._nextRemoved=c._next,c.previousValue=c.currentValue,c.currentValue=null,c._prev=null,c._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,l){if(n){let c=n._prev;return l._next=n,l._prev=c,n._prev=l,c&&(c._next=l),n===this._mapHead&&(this._mapHead=l),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(n,l){if(this._records.has(n)){let f=this._records.get(n);this._maybeAddToChanges(f,l);let i=f._prev,w=f._next;return i&&(i._next=w),w&&(w._prev=i),f._next=null,f._prev=null,f}let c=new mI(n);return this._records.set(n,c),c.currentValue=l,this._addToAdditions(c),c}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;n!==null;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;n!=null;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,l){Object.is(l,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=l,this._addToChanges(n))}_addToAdditions(n){this._additionsHead===null?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){this._changesHead===null?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,l){n instanceof Map?n.forEach(l):Object.keys(n).forEach(c=>l(n[c],c))}},mI=class{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function LR(){return new dC([new cI])}var dC=(()=>{let n=class n{constructor(c){this.factories=c}static create(c,f){if(f!=null){let i=f.factories.slice();c=c.concat(i)}return new n(c)}static extend(c){return{provide:n,useFactory:f=>n.create(c,f||LR()),deps:[[n,new Zg,new tp]]}}find(c){let f=this.factories.find(i=>i.supports(c));if(f!=null)return f;throw new bt(901,!1)}};n.\u0275prov=At({token:n,providedIn:"root",factory:LR});let o=n;return o})();function FR(){return new a_([new fI])}var a_=(()=>{let n=class n{constructor(c){this.factories=c}static create(c,f){if(f){let i=f.factories.slice();c=c.concat(i)}return new n(c)}static extend(c){return{provide:n,useFactory:f=>n.create(c,f||FR()),deps:[[n,new Zg,new tp]]}}find(c){let f=this.factories.find(i=>i.supports(c));if(f)return f;throw new bt(901,!1)}};n.\u0275prov=At({token:n,providedIn:"root",factory:FR});let o=n;return o})();function tL(o){try{let{rootComponent:n,appProviders:l,platformProviders:c}=o,f=kG(c),i=[DG(),...l||[]],C=new _x({providers:i,parent:f,debugName:"",runEnvironmentInitializers:!1}).injector,A=C.get(fi);return A.run(()=>{C.resolveInjectorInitializers();let L=C.get($s,null),U;A.runOutsideAngular(()=>{U=A.onError.subscribe({next:he=>{L.handleError(he)}})});let Q=()=>C.destroy(),fe=f.get(eL);return fe.add(Q),C.onDestroy(()=>{U.unsubscribe(),fe.delete(Q)}),wG(L,A,()=>{let he=C.get(JO);return he.runInitializers(),he.donePromise.then(()=>{let be=C.get(Gx,vx);lG(be||vx);let Se=C.get(cp);return n!==void 0&&Se.bootstrap(n),Se})})})}catch(n){return Promise.reject(n)}}function Hh(o){return typeof o=="boolean"?o:o!=null&&o!=="false"}var zG=new an("",{providedIn:"root",factory:()=>vt(BG)}),BG=(()=>{let n=class n{};n.\u0275prov=At({token:n,providedIn:"root",factory:()=>new gI});let o=n;return o})(),gI=class{constructor(){this.queuedEffectCount=0,this.queues=new Map,this.pendingTasks=vt(Qc),this.taskId=null}scheduleEffect(n){if(this.enqueue(n),this.taskId===null){let l=this.taskId=this.pendingTasks.add();queueMicrotask(()=>{this.flush(),this.pendingTasks.remove(l),this.taskId=null})}}enqueue(n){let l=n.creationZone;this.queues.has(l)||this.queues.set(l,new Set);let c=this.queues.get(l);c.has(n)||(this.queuedEffectCount++,c.add(n))}flush(){for(;this.queuedEffectCount>0;)for(let[n,l]of this.queues)n===null?this.flushQueue(l):n.run(()=>this.flushQueue(l))}flushQueue(n){for(let l of n)n.delete(l),this.queuedEffectCount--,l.run()}},_I=class{constructor(n,l,c,f,i,w){this.scheduler=n,this.effectFn=l,this.creationZone=c,this.injector=i,this.watcher=bP(C=>this.runEffect(C),()=>this.schedule(),w),this.unregisterOnDestroy=f?.onDestroy(()=>this.destroy())}runEffect(n){try{this.effectFn(n)}catch(l){this.injector.get($s,null,{optional:!0})?.handleError(l)}}run(){this.watcher.run()}schedule(){this.scheduler.scheduleEffect(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function Ws(o,n){Kc("NgSignals"),!n?.injector&&pk(Ws);let l=n?.injector??vt(bl),c=n?.manualCleanup!==!0?l.get(Rx):null,f=new _I(l.get(zG),o,typeof Zone>"u"?null:Zone.current,c,l,n?.allowSignalWrites??!1),i=l.get(tu,null,{optional:!0});return!i||!(i._lView[gn]&8)?f.watcher.notify():(i._lView[Xv]??=[]).push(f.watcher.notify),f}function nL(o){let n=$c(o);if(!n)return null;let l=new Jf(n);return{get selector(){return l.selector},get type(){return l.componentType},get inputs(){return l.inputs},get outputs(){return l.outputs},get ngContentSelectors(){return l.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}var lL=null;function up(){return lL}function cL(o){lL??=o}var Hx=class{};var zi=new an(""),uL=(()=>{let n=class n{historyGo(c){throw new Error("")}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>vt(VG),providedIn:"platform"});let o=n;return o})();var VG=(()=>{let n=class n extends uL{constructor(){super(),this._doc=vt(zi),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return up().getBaseHref(this._doc)}onPopState(c){let f=up().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",c,!1),()=>f.removeEventListener("popstate",c)}onHashChange(c){let f=up().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",c,!1),()=>f.removeEventListener("hashchange",c)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(c){this._location.pathname=c}pushState(c,f,i){this._history.pushState(c,f,i)}replaceState(c,f,i){this._history.replaceState(c,f,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(c=0){this._history.go(c)}getState(){return this._history.state}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>new n,providedIn:"platform"});let o=n;return o})();function hL(o,n){if(o.length==0)return n;if(n.length==0)return o;let l=0;return o.endsWith("/")&&l++,n.startsWith("/")&&l++,l==2?o+n.substring(1):l==1?o+n:o+"/"+n}function iL(o){let n=o.match(/#|\?|$/),l=n&&n.index||o.length,c=l-(o[l-1]==="/"?1:0);return o.slice(0,c)+o.slice(l)}function qh(o){return o&&o[0]!=="?"?"?"+o:o}var dp=(()=>{let n=class n{historyGo(c){throw new Error("")}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>vt(dL),providedIn:"root"});let o=n;return o})(),jG=new an(""),dL=(()=>{let n=class n extends dp{constructor(c,f){super(),this._platformLocation=c,this._removeListenerFns=[],this._baseHref=f??this._platformLocation.getBaseHrefFromDOM()??vt(zi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(c){this._removeListenerFns.push(this._platformLocation.onPopState(c),this._platformLocation.onHashChange(c))}getBaseHref(){return this._baseHref}prepareExternalUrl(c){return hL(this._baseHref,c)}path(c=!1){let f=this._platformLocation.pathname+qh(this._platformLocation.search),i=this._platformLocation.hash;return i&&c?`${f}${i}`:f}pushState(c,f,i,w){let C=this.prepareExternalUrl(i+qh(w));this._platformLocation.pushState(c,f,C)}replaceState(c,f,i,w){let C=this.prepareExternalUrl(i+qh(w));this._platformLocation.replaceState(c,f,C)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(c=0){this._platformLocation.historyGo?.(c)}};n.\u0275fac=function(f){return new(f||n)(Vt(uL),Vt(jG,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var l_=(()=>{let n=class n{constructor(c){this._subject=new Pr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=c;let f=this._locationStrategy.getBaseHref();this._basePath=GG(iL(rL(f))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(c=!1){return this.normalize(this._locationStrategy.path(c))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(c,f=""){return this.path()==this.normalize(c+qh(f))}normalize(c){return n.stripTrailingSlash($G(this._basePath,rL(c)))}prepareExternalUrl(c){return c&&c[0]!=="/"&&(c="/"+c),this._locationStrategy.prepareExternalUrl(c)}go(c,f="",i=null){this._locationStrategy.pushState(i,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+qh(f)),i)}replaceState(c,f="",i=null){this._locationStrategy.replaceState(i,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+qh(f)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(c=0){this._locationStrategy.historyGo?.(c)}onUrlChange(c){return this._urlChangeListeners.push(c),this._urlChangeSubscription??=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)}),()=>{let f=this._urlChangeListeners.indexOf(c);this._urlChangeListeners.splice(f,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(c="",f){this._urlChangeListeners.forEach(i=>i(c,f))}subscribe(c,f,i){return this._subject.subscribe({next:c,error:f,complete:i})}};n.normalizeQueryParams=qh,n.joinWithSlash=hL,n.stripTrailingSlash=iL,n.\u0275fac=function(f){return new(f||n)(Vt(dp))},n.\u0275prov=At({token:n,factory:()=>UG(),providedIn:"root"});let o=n;return o})();function UG(){return new l_(Vt(dp))}function $G(o,n){if(!o||!n.startsWith(o))return n;let l=n.substring(o.length);return l===""||["/",";","?","#"].includes(l[0])?l:n}function rL(o){return o.replace(/\/index.html$/,"")}function GG(o){if(new RegExp("^(https?:)?//").test(o)){let[,l]=o.split(/\/\/[^\/]+/);return l}return o}function qx(o,n){n=encodeURIComponent(n);for(let l of o.split(";")){let c=l.indexOf("="),[f,i]=c==-1?[l,""]:[l.slice(0,c),l.slice(c+1)];if(f.trim()===n)return decodeURIComponent(i)}return null}var fC=/\s+/,oL=[],fp=(()=>{let n=class n{constructor(c,f){this._ngEl=c,this._renderer=f,this.initialClasses=oL,this.stateMap=new Map}set klass(c){this.initialClasses=c!=null?c.trim().split(fC):oL}set ngClass(c){this.rawClass=typeof c=="string"?c.trim().split(fC):c}ngDoCheck(){for(let f of this.initialClasses)this._updateState(f,!0);let c=this.rawClass;if(Array.isArray(c)||c instanceof Set)for(let f of c)this._updateState(f,!0);else if(c!=null)for(let f of Object.keys(c))this._updateState(f,!!c[f]);this._applyStateDiff()}_updateState(c,f){let i=this.stateMap.get(c);i!==void 0?(i.enabled!==f&&(i.changed=!0,i.enabled=f),i.touched=!0):this.stateMap.set(c,{enabled:f,changed:!0,touched:!0})}_applyStateDiff(){for(let c of this.stateMap){let f=c[0],i=c[1];i.changed?(this._toggleClass(f,i.enabled),i.changed=!1):i.touched||(i.enabled&&this._toggleClass(f,!1),this.stateMap.delete(f)),i.touched=!1}}_toggleClass(c,f){c=c.trim(),c.length>0&&c.split(fC).forEach(i=>{f?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}};n.\u0275fac=function(f){return new(f||n)(Kn(Or),Kn(Xc))},n.\u0275dir=us({type:n,selectors:[["","ngClass",""]],inputs:{klass:[Ni.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let o=n;return o})();var pC=class{constructor(n,l,c,f){this.$implicit=n,this.ngForOf=l,this.index=c,this.count=f}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},pp=(()=>{let n=class n{set ngForOf(c){this._ngForOf=c,this._ngForOfDirty=!0}set ngForTrackBy(c){this._trackByFn=c}get ngForTrackBy(){return this._trackByFn}constructor(c,f,i){this._viewContainer=c,this._template=f,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(c){c&&(this._template=c)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let c=this._ngForOf;if(!this._differ&&c)if(0)try{}catch{}else this._differ=this._differs.find(c).create(this.ngForTrackBy)}if(this._differ){let c=this._differ.diff(this._ngForOf);c&&this._applyChanges(c)}}_applyChanges(c){let f=this._viewContainer;c.forEachOperation((i,w,C)=>{if(i.previousIndex==null)f.createEmbeddedView(this._template,new pC(i.item,this._ngForOf,-1,-1),C===null?void 0:C);else if(C==null)f.remove(w===null?void 0:w);else if(w!==null){let A=f.get(w);f.move(A,C),sL(A,i)}});for(let i=0,w=f.length;i<w;i++){let A=f.get(i).context;A.index=i,A.count=w,A.ngForOf=this._ngForOf}c.forEachIdentityChange(i=>{let w=f.get(i.currentIndex);sL(w,i)})}static ngTemplateContextGuard(c,f){return!0}};n.\u0275fac=function(f){return new(f||n)(Kn(wl),Kn(Hc),Kn(dC))},n.\u0275dir=us({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let o=n;return o})();function sL(o,n){o.context.$implicit=n.item}var mp=(()=>{let n=class n{constructor(c,f){this._viewContainer=c,this._context=new mC,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(c){this._context.$implicit=this._context.ngIf=c,this._updateView()}set ngIfThen(c){aL("ngIfThen",c),this._thenTemplateRef=c,this._thenViewRef=null,this._updateView()}set ngIfElse(c){aL("ngIfElse",c),this._elseTemplateRef=c,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(c,f){return!0}};n.\u0275fac=function(f){return new(f||n)(Kn(wl),Kn(Hc))},n.\u0275dir=us({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let o=n;return o})(),mC=class{constructor(){this.$implicit=null,this.ngIf=null}};function aL(o,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${o} must be a TemplateRef, but received '${oo(n)}'.`)}var fL=(()=>{let n=class n{constructor(c,f,i){this._ngEl=c,this._differs=f,this._renderer=i,this._ngStyle=null,this._differ=null}set ngStyle(c){this._ngStyle=c,!this._differ&&c&&(this._differ=this._differs.find(c).create())}ngDoCheck(){if(this._differ){let c=this._differ.diff(this._ngStyle);c&&this._applyChanges(c)}}_setStyle(c,f){let[i,w]=c.split("."),C=i.indexOf("-")===-1?void 0:Sa.DashCase;f!=null?this._renderer.setStyle(this._ngEl.nativeElement,i,w?`${f}${w}`:f,C):this._renderer.removeStyle(this._ngEl.nativeElement,i,C)}_applyChanges(c){c.forEachRemovedItem(f=>this._setStyle(f.key,null)),c.forEachAddedItem(f=>this._setStyle(f.key,f.currentValue)),c.forEachChangedItem(f=>this._setStyle(f.key,f.currentValue))}};n.\u0275fac=function(f){return new(f||n)(Kn(Or),Kn(a_),Kn(Xc))},n.\u0275dir=us({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let o=n;return o})();var Wi=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=kr({type:n}),n.\u0275inj=Rr({});let o=n;return o})(),_C="browser",HG="server";function pL(o){return o===_C}function Wx(o){return o===HG}var hp=class{};var u_=class{},Yx=class{},Wh=class o{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(l=>{let c=l.indexOf(":");if(c>0){let f=l.slice(0,c),i=f.toLowerCase(),w=l.slice(c+1).trim();this.maybeSetNormalizedName(f,i),this.headers.has(i)?this.headers.get(i).push(w):this.headers.set(i,[w])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((l,c)=>{this.setHeaderEntries(c,l)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([l,c])=>{this.setHeaderEntries(l,c)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let l=this.headers.get(n.toLowerCase());return l&&l.length>0?l[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,l){return this.clone({name:n,value:l,op:"a"})}set(n,l){return this.clone({name:n,value:l,op:"s"})}delete(n,l){return this.clone({name:n,value:l,op:"d"})}maybeSetNormalizedName(n,l){this.normalizedNames.has(l)||this.normalizedNames.set(l,n)}init(){this.lazyInit&&(this.lazyInit instanceof o?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(l=>{this.headers.set(l,n.headers.get(l)),this.normalizedNames.set(l,n.normalizedNames.get(l))})}clone(n){let l=new o;return l.lazyInit=this.lazyInit&&this.lazyInit instanceof o?this.lazyInit:this,l.lazyUpdate=(this.lazyUpdate||[]).concat([n]),l}applyUpdate(n){let l=n.name.toLowerCase();switch(n.op){case"a":case"s":let c=n.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(n.name,l);let f=(n.op==="a"?this.headers.get(l):void 0)||[];f.push(...c),this.headers.set(l,f);break;case"d":let i=n.value;if(!i)this.headers.delete(l),this.normalizedNames.delete(l);else{let w=this.headers.get(l);if(!w)return;w=w.filter(C=>i.indexOf(C)===-1),w.length===0?(this.headers.delete(l),this.normalizedNames.delete(l)):this.headers.set(l,w)}break}}setHeaderEntries(n,l){let c=(Array.isArray(l)?l:[l]).map(i=>i.toString()),f=n.toLowerCase();this.headers.set(f,c),this.maybeSetNormalizedName(n,f)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(l=>n(this.normalizedNames.get(l),this.headers.get(l)))}};var vC=class{encodeKey(n){return mL(n)}encodeValue(n){return mL(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function ZG(o,n){let l=new Map;return o.length>0&&o.replace(/^\?/,"").split("&").forEach(f=>{let i=f.indexOf("="),[w,C]=i==-1?[n.decodeKey(f),""]:[n.decodeKey(f.slice(0,i)),n.decodeValue(f.slice(i+1))],A=l.get(w)||[];A.push(C),l.set(w,A)}),l}var YG=/%(\d[a-f0-9])/gi,XG={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function mL(o){return encodeURIComponent(o).replace(YG,(n,l)=>XG[l]??n)}function Zx(o){return`${o}`}var nu=class o{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new vC,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=ZG(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(l=>{let c=n.fromObject[l],f=Array.isArray(c)?c.map(Zx):[Zx(c)];this.map.set(l,f)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let l=this.map.get(n);return l?l[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,l){return this.clone({param:n,value:l,op:"a"})}appendAll(n){let l=[];return Object.keys(n).forEach(c=>{let f=n[c];Array.isArray(f)?f.forEach(i=>{l.push({param:c,value:i,op:"a"})}):l.push({param:c,value:f,op:"a"})}),this.clone(l)}set(n,l){return this.clone({param:n,value:l,op:"s"})}delete(n,l){return this.clone({param:n,value:l,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let l=this.encoder.encodeKey(n);return this.map.get(n).map(c=>l+"="+this.encoder.encodeValue(c)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let l=new o({encoder:this.encoder});return l.cloneFrom=this.cloneFrom||this,l.updates=(this.updates||[]).concat(n),l}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let l=(n.op==="a"?this.map.get(n.param):void 0)||[];l.push(Zx(n.value)),this.map.set(n.param,l);break;case"d":if(n.value!==void 0){let c=this.map.get(n.param)||[],f=c.indexOf(Zx(n.value));f!==-1&&c.splice(f,1),c.length>0?this.map.set(n.param,c):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var xC=class{constructor(){this.map=new Map}set(n,l){return this.map.set(n,l),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function KG(o){switch(o){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function gL(o){return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer}function _L(o){return typeof Blob<"u"&&o instanceof Blob}function yL(o){return typeof FormData<"u"&&o instanceof FormData}function QG(o){return typeof URLSearchParams<"u"&&o instanceof URLSearchParams}var c_=class o{constructor(n,l,c,f){this.url=l,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase();let i;if(KG(this.method)||f?(this.body=c!==void 0?c:null,i=f):i=c,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new Wh,this.context??=new xC,!this.params)this.params=new nu,this.urlWithParams=l;else{let w=this.params.toString();if(w.length===0)this.urlWithParams=l;else{let C=l.indexOf("?"),A=C===-1?"?":C<l.length-1?"&":"";this.urlWithParams=l+A+w}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||gL(this.body)||_L(this.body)||yL(this.body)||QG(this.body)?this.body:this.body instanceof nu?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||yL(this.body)?null:_L(this.body)?this.body.type||null:gL(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof nu?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(n={}){let l=n.method||this.method,c=n.url||this.url,f=n.responseType||this.responseType,i=n.transferCache??this.transferCache,w=n.body!==void 0?n.body:this.body,C=n.withCredentials??this.withCredentials,A=n.reportProgress??this.reportProgress,L=n.headers||this.headers,U=n.params||this.params,Q=n.context??this.context;return n.setHeaders!==void 0&&(L=Object.keys(n.setHeaders).reduce((fe,he)=>fe.set(he,n.setHeaders[he]),L)),n.setParams&&(U=Object.keys(n.setParams).reduce((fe,he)=>fe.set(he,n.setParams[he]),U)),new o(l,c,w,{params:U,headers:L,context:Q,reportProgress:A,responseType:f,withCredentials:C,transferCache:i})}},gp=function(o){return o[o.Sent=0]="Sent",o[o.UploadProgress=1]="UploadProgress",o[o.ResponseHeader=2]="ResponseHeader",o[o.DownloadProgress=3]="DownloadProgress",o[o.Response=4]="Response",o[o.User=5]="User",o}(gp||{}),h_=class{constructor(n,l=Qx.Ok,c="OK"){this.headers=n.headers||new Wh,this.status=n.status!==void 0?n.status:l,this.statusText=n.statusText||c,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},bC=class o extends h_{constructor(n={}){super(n),this.type=gp.ResponseHeader}clone(n={}){return new o({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Xx=class o extends h_{constructor(n={}){super(n),this.type=gp.Response,this.body=n.body!==void 0?n.body:null}clone(n={}){return new o({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Kx=class extends h_{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},Qx=function(o){return o[o.Continue=100]="Continue",o[o.SwitchingProtocols=101]="SwitchingProtocols",o[o.Processing=102]="Processing",o[o.EarlyHints=103]="EarlyHints",o[o.Ok=200]="Ok",o[o.Created=201]="Created",o[o.Accepted=202]="Accepted",o[o.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",o[o.NoContent=204]="NoContent",o[o.ResetContent=205]="ResetContent",o[o.PartialContent=206]="PartialContent",o[o.MultiStatus=207]="MultiStatus",o[o.AlreadyReported=208]="AlreadyReported",o[o.ImUsed=226]="ImUsed",o[o.MultipleChoices=300]="MultipleChoices",o[o.MovedPermanently=301]="MovedPermanently",o[o.Found=302]="Found",o[o.SeeOther=303]="SeeOther",o[o.NotModified=304]="NotModified",o[o.UseProxy=305]="UseProxy",o[o.Unused=306]="Unused",o[o.TemporaryRedirect=307]="TemporaryRedirect",o[o.PermanentRedirect=308]="PermanentRedirect",o[o.BadRequest=400]="BadRequest",o[o.Unauthorized=401]="Unauthorized",o[o.PaymentRequired=402]="PaymentRequired",o[o.Forbidden=403]="Forbidden",o[o.NotFound=404]="NotFound",o[o.MethodNotAllowed=405]="MethodNotAllowed",o[o.NotAcceptable=406]="NotAcceptable",o[o.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",o[o.RequestTimeout=408]="RequestTimeout",o[o.Conflict=409]="Conflict",o[o.Gone=410]="Gone",o[o.LengthRequired=411]="LengthRequired",o[o.PreconditionFailed=412]="PreconditionFailed",o[o.PayloadTooLarge=413]="PayloadTooLarge",o[o.UriTooLong=414]="UriTooLong",o[o.UnsupportedMediaType=415]="UnsupportedMediaType",o[o.RangeNotSatisfiable=416]="RangeNotSatisfiable",o[o.ExpectationFailed=417]="ExpectationFailed",o[o.ImATeapot=418]="ImATeapot",o[o.MisdirectedRequest=421]="MisdirectedRequest",o[o.UnprocessableEntity=422]="UnprocessableEntity",o[o.Locked=423]="Locked",o[o.FailedDependency=424]="FailedDependency",o[o.TooEarly=425]="TooEarly",o[o.UpgradeRequired=426]="UpgradeRequired",o[o.PreconditionRequired=428]="PreconditionRequired",o[o.TooManyRequests=429]="TooManyRequests",o[o.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",o[o.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",o[o.InternalServerError=500]="InternalServerError",o[o.NotImplemented=501]="NotImplemented",o[o.BadGateway=502]="BadGateway",o[o.ServiceUnavailable=503]="ServiceUnavailable",o[o.GatewayTimeout=504]="GatewayTimeout",o[o.HttpVersionNotSupported=505]="HttpVersionNotSupported",o[o.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",o[o.InsufficientStorage=507]="InsufficientStorage",o[o.LoopDetected=508]="LoopDetected",o[o.NotExtended=510]="NotExtended",o[o.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",o}(Qx||{});function yC(o,n){return{body:n,headers:o.headers,context:o.context,observe:o.observe,params:o.params,reportProgress:o.reportProgress,responseType:o.responseType,withCredentials:o.withCredentials,transferCache:o.transferCache}}var wC=(()=>{let n=class n{constructor(c){this.handler=c}request(c,f,i={}){let w;if(c instanceof c_)w=c;else{let L;i.headers instanceof Wh?L=i.headers:L=new Wh(i.headers);let U;i.params&&(i.params instanceof nu?U=i.params:U=new nu({fromObject:i.params})),w=new c_(c,f,i.body!==void 0?i.body:null,{headers:L,context:i.context,params:U,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials,transferCache:i.transferCache})}let C=un(w).pipe(Bc(L=>this.handler.handle(L)));if(c instanceof c_||i.observe==="events")return C;let A=C.pipe(io(L=>L instanceof Xx));switch(i.observe||"body"){case"body":switch(w.responseType){case"arraybuffer":return A.pipe(Dn(L=>{if(L.body!==null&&!(L.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return L.body}));case"blob":return A.pipe(Dn(L=>{if(L.body!==null&&!(L.body instanceof Blob))throw new Error("Response is not a Blob.");return L.body}));case"text":return A.pipe(Dn(L=>{if(L.body!==null&&typeof L.body!="string")throw new Error("Response is not a string.");return L.body}));case"json":default:return A.pipe(Dn(L=>L.body))}case"response":return A;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(c,f={}){return this.request("DELETE",c,f)}get(c,f={}){return this.request("GET",c,f)}head(c,f={}){return this.request("HEAD",c,f)}jsonp(c,f){return this.request("JSONP",c,{params:new nu().append(f,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(c,f={}){return this.request("OPTIONS",c,f)}patch(c,f,i={}){return this.request("PATCH",c,yC(i,f))}post(c,f,i={}){return this.request("POST",c,yC(i,f))}put(c,f,i={}){return this.request("PUT",c,yC(i,f))}};n.\u0275fac=function(f){return new(f||n)(Vt(u_))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function wL(o,n){return n(o)}function JG(o,n){return(l,c)=>n.intercept(l,{handle:f=>o(f,c)})}function eH(o,n,l){return(c,f)=>Gs(l,()=>n(c,i=>o(i,f)))}var tH=new an(""),TC=new an(""),nH=new an(""),iH=new an("");function rH(){let o=null;return(n,l)=>{o===null&&(o=(vt(tH,{optional:!0})??[]).reduceRight(JG,wL));let c=vt(Qc),f=c.add();return o(n,l).pipe(xa(()=>c.remove(f)))}}var vL=(()=>{let n=class n extends u_{constructor(c,f){super(),this.backend=c,this.injector=f,this.chain=null,this.pendingTasks=vt(Qc);let i=vt(iH,{optional:!0});this.backend=i??c}handle(c){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(TC),...this.injector.get(nH,[])]));this.chain=i.reduceRight((w,C)=>eH(w,C,this.injector),wL)}let f=this.pendingTasks.add();return this.chain(c,i=>this.backend.handle(i)).pipe(xa(()=>this.pendingTasks.remove(f)))}};n.\u0275fac=function(f){return new(f||n)(Vt(Yx),Vt(Io))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();var oH=/^\)\]\}',?\n/;function sH(o){return"responseURL"in o&&o.responseURL?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):null}var xL=(()=>{let n=class n{constructor(c){this.xhrFactory=c}handle(c){if(c.method==="JSONP")throw new bt(-2800,!1);let f=this.xhrFactory;return(f.\u0275loadImpl?tr(f.\u0275loadImpl()):un(null)).pipe(Eo(()=>new ii(w=>{let C=f.build();if(C.open(c.method,c.urlWithParams),c.withCredentials&&(C.withCredentials=!0),c.headers.forEach((Ke,Fe)=>C.setRequestHeader(Ke,Fe.join(","))),c.headers.has("Accept")||C.setRequestHeader("Accept","application/json, text/plain, */*"),!c.headers.has("Content-Type")){let Ke=c.detectContentTypeHeader();Ke!==null&&C.setRequestHeader("Content-Type",Ke)}if(c.responseType){let Ke=c.responseType.toLowerCase();C.responseType=Ke!=="json"?Ke:"text"}let A=c.serializeBody(),L=null,U=()=>{if(L!==null)return L;let Ke=C.statusText||"OK",Fe=new Wh(C.getAllResponseHeaders()),tt=sH(C)||c.url;return L=new bC({headers:Fe,status:C.status,statusText:Ke,url:tt}),L},Q=()=>{let{headers:Ke,status:Fe,statusText:tt,url:ft}=U(),Ue=null;Fe!==Qx.NoContent&&(Ue=typeof C.response>"u"?C.responseText:C.response),Fe===0&&(Fe=Ue?Qx.Ok:0);let zt=Fe>=200&&Fe<300;if(c.responseType==="json"&&typeof Ue=="string"){let Kt=Ue;Ue=Ue.replace(oH,"");try{Ue=Ue!==""?JSON.parse(Ue):null}catch(tn){Ue=Kt,zt&&(zt=!1,Ue={error:tn,text:Ue})}}zt?(w.next(new Xx({body:Ue,headers:Ke,status:Fe,statusText:tt,url:ft||void 0})),w.complete()):w.error(new Kx({error:Ue,headers:Ke,status:Fe,statusText:tt,url:ft||void 0}))},fe=Ke=>{let{url:Fe}=U(),tt=new Kx({error:Ke,status:C.status||0,statusText:C.statusText||"Unknown Error",url:Fe||void 0});w.error(tt)},he=!1,be=Ke=>{he||(w.next(U()),he=!0);let Fe={type:gp.DownloadProgress,loaded:Ke.loaded};Ke.lengthComputable&&(Fe.total=Ke.total),c.responseType==="text"&&C.responseText&&(Fe.partialText=C.responseText),w.next(Fe)},Se=Ke=>{let Fe={type:gp.UploadProgress,loaded:Ke.loaded};Ke.lengthComputable&&(Fe.total=Ke.total),w.next(Fe)};return C.addEventListener("load",Q),C.addEventListener("error",fe),C.addEventListener("timeout",fe),C.addEventListener("abort",fe),c.reportProgress&&(C.addEventListener("progress",be),A!==null&&C.upload&&C.upload.addEventListener("progress",Se)),C.send(A),w.next({type:gp.Sent}),()=>{C.removeEventListener("error",fe),C.removeEventListener("abort",fe),C.removeEventListener("load",Q),C.removeEventListener("timeout",fe),c.reportProgress&&(C.removeEventListener("progress",be),A!==null&&C.upload&&C.upload.removeEventListener("progress",Se)),C.readyState!==C.DONE&&C.abort()}})))}};n.\u0275fac=function(f){return new(f||n)(Vt(hp))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),TL=new an(""),aH="XSRF-TOKEN",lH=new an("",{providedIn:"root",factory:()=>aH}),cH="X-XSRF-TOKEN",uH=new an("",{providedIn:"root",factory:()=>cH}),Jx=class{},hH=(()=>{let n=class n{constructor(c,f,i){this.doc=c,this.platform=f,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let c=this.doc.cookie||"";return c!==this.lastCookieString&&(this.parseCount++,this.lastToken=qx(c,this.cookieName),this.lastCookieString=c),this.lastToken}};n.\u0275fac=function(f){return new(f||n)(Vt(zi),Vt(Hs),Vt(lH))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function dH(o,n){let l=o.url.toLowerCase();if(!vt(TL)||o.method==="GET"||o.method==="HEAD"||l.startsWith("http://")||l.startsWith("https://"))return n(o);let c=vt(Jx).getToken(),f=vt(uH);return c!=null&&!o.headers.has(f)&&(o=o.clone({headers:o.headers.set(f,c)})),n(o)}var EL=function(o){return o[o.Interceptors=0]="Interceptors",o[o.LegacyInterceptors=1]="LegacyInterceptors",o[o.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",o[o.NoXsrfProtection=3]="NoXsrfProtection",o[o.JsonpSupport=4]="JsonpSupport",o[o.RequestsMadeViaParent=5]="RequestsMadeViaParent",o[o.Fetch=6]="Fetch",o}(EL||{});function fH(o,n){return{\u0275kind:o,\u0275providers:n}}function EC(...o){let n=[wC,xL,vL,{provide:u_,useExisting:vL},{provide:Yx,useExisting:xL},{provide:TC,useValue:dH,multi:!0},{provide:TL,useValue:!0},{provide:Jx,useClass:hH}];for(let l of o)n.push(...l.\u0275providers);return Zc(n)}var bL=new an("");function pH(){return fH(EL.LegacyInterceptors,[{provide:bL,useFactory:rH},{provide:TC,useExisting:bL,multi:!0}])}var eb=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=kr({type:n}),n.\u0275inj=Rr({providers:[EC(pH())]});let o=n;return o})();var SC=class extends Hx{constructor(){super(...arguments),this.supportsDOMEvents=!0}},DC=class o extends SC{static makeCurrent(){cL(new o)}onAndCancel(n,l,c){return n.addEventListener(l,c),()=>{n.removeEventListener(l,c)}}dispatchEvent(n,l){n.dispatchEvent(l)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,l){return l=l||this.getDefaultDocument(),l.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,l){return l==="window"?window:l==="document"?n:l==="body"?n.body:null}getBaseHref(n){let l=gH();return l==null?null:_H(l)}resetBaseElement(){d_=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return qx(document.cookie,n)}},d_=null;function gH(){return d_=d_||document.querySelector("base"),d_?d_.getAttribute("href"):null}function _H(o){return new URL(o,document.baseURI).pathname}var yH=(()=>{let n=class n{build(){return new XMLHttpRequest}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),MC=new an(""),SL=(()=>{let n=class n{constructor(c,f){this._zone=f,this._eventNameToPlugin=new Map,c.forEach(i=>{i.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,f,i){return this._findPluginFor(f).addEventListener(c,f,i)}getZone(){return this._zone}_findPluginFor(c){let f=this._eventNameToPlugin.get(c);if(f)return f;if(f=this._plugins.find(w=>w.supports(c)),!f)throw new bt(5101,!1);return this._eventNameToPlugin.set(c,f),f}};n.\u0275fac=function(f){return new(f||n)(Vt(MC),Vt(fi))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),tb=class{constructor(n){this._doc=n}},IC="ng-app-id",DL=(()=>{let n=class n{constructor(c,f,i,w={}){this.doc=c,this.appId=f,this.nonce=i,this.platformId=w,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Wx(w),this.resetHostNodes()}addStyles(c){for(let f of c)this.changeUsageCount(f,1)===1&&this.onStyleAdded(f)}removeStyles(c){for(let f of c)this.changeUsageCount(f,-1)<=0&&this.onStyleRemoved(f)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(f=>f.remove()),c.clear());for(let f of this.getAllStyles())this.onStyleRemoved(f);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let f of this.getAllStyles())this.addStyleToHost(c,f)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let f of this.hostNodes)this.addStyleToHost(f,c)}onStyleRemoved(c){let f=this.styleRef;f.get(c)?.elements?.forEach(i=>i.remove()),f.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${IC}="${this.appId}"]`);if(c?.length){let f=new Map;return c.forEach(i=>{i.textContent!=null&&f.set(i.textContent,i)}),f}return null}changeUsageCount(c,f){let i=this.styleRef;if(i.has(c)){let w=i.get(c);return w.usage+=f,w.usage}return i.set(c,{usage:f,elements:[]}),f}getStyleElement(c,f){let i=this.styleNodesInDOM,w=i?.get(f);if(w?.parentNode===c)return i.delete(f),w.removeAttribute(IC),w;{let C=this.doc.createElement("style");return this.nonce&&C.setAttribute("nonce",this.nonce),C.textContent=f,this.platformIsServer&&C.setAttribute(IC,this.appId),c.appendChild(C),C}}addStyleToHost(c,f){let i=this.getStyleElement(c,f),w=this.styleRef,C=w.get(f)?.elements;C?C.push(i):w.set(f,{elements:[i],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}};n.\u0275fac=function(f){return new(f||n)(Vt(zi),Vt(kx),Vt(Jg,8),Vt(Hs))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),CC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},PC=/%COMP%/g,ML="%COMP%",vH=`_nghost-${ML}`,xH=`_ngcontent-${ML}`,bH=!0,wH=new an("",{providedIn:"root",factory:()=>bH});function TH(o){return xH.replace(PC,o)}function EH(o){return vH.replace(PC,o)}function AL(o,n){return n.map(l=>l.replace(PC,o))}var nb=(()=>{let n=class n{constructor(c,f,i,w,C,A,L,U=null){this.eventManager=c,this.sharedStylesHost=f,this.appId=i,this.removeStylesOnCompDestroy=w,this.doc=C,this.platformId=A,this.ngZone=L,this.nonce=U,this.rendererByCompId=new Map,this.platformIsServer=Wx(A),this.defaultRenderer=new f_(c,C,L,this.platformIsServer)}createRenderer(c,f){if(!c||!f)return this.defaultRenderer;this.platformIsServer&&f.encapsulation===Ea.ShadowDom&&(f=oi(gt({},f),{encapsulation:Ea.Emulated}));let i=this.getOrCreateRenderer(c,f);return i instanceof ib?i.applyToHost(c):i instanceof p_&&i.applyStyles(),i}getOrCreateRenderer(c,f){let i=this.rendererByCompId,w=i.get(f.id);if(!w){let C=this.doc,A=this.ngZone,L=this.eventManager,U=this.sharedStylesHost,Q=this.removeStylesOnCompDestroy,fe=this.platformIsServer;switch(f.encapsulation){case Ea.Emulated:w=new ib(L,U,f,this.appId,Q,C,A,fe);break;case Ea.ShadowDom:return new AC(L,U,c,f,C,A,this.nonce,fe);default:w=new p_(L,U,f,Q,C,A,fe);break}i.set(f.id,w)}return w}ngOnDestroy(){this.rendererByCompId.clear()}};n.\u0275fac=function(f){return new(f||n)(Vt(SL),Vt(DL),Vt(kx),Vt(wH),Vt(zi),Vt(Hs),Vt(fi),Vt(Jg))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),f_=class{constructor(n,l,c,f){this.eventManager=n,this.doc=l,this.ngZone=c,this.platformIsServer=f,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,l){return l?this.doc.createElementNS(CC[l]||l,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,l){(IL(n)?n.content:n).appendChild(l)}insertBefore(n,l,c){n&&(IL(n)?n.content:n).insertBefore(l,c)}removeChild(n,l){n&&n.removeChild(l)}selectRootElement(n,l){let c=typeof n=="string"?this.doc.querySelector(n):n;if(!c)throw new bt(-5104,!1);return l||(c.textContent=""),c}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,l,c,f){if(f){l=f+":"+l;let i=CC[f];i?n.setAttributeNS(i,l,c):n.setAttribute(l,c)}else n.setAttribute(l,c)}removeAttribute(n,l,c){if(c){let f=CC[c];f?n.removeAttributeNS(f,l):n.removeAttribute(`${c}:${l}`)}else n.removeAttribute(l)}addClass(n,l){n.classList.add(l)}removeClass(n,l){n.classList.remove(l)}setStyle(n,l,c,f){f&(Sa.DashCase|Sa.Important)?n.style.setProperty(l,c,f&Sa.Important?"important":""):n.style[l]=c}removeStyle(n,l,c){c&Sa.DashCase?n.style.removeProperty(l):n.style[l]=""}setProperty(n,l,c){n!=null&&(n[l]=c)}setValue(n,l){n.nodeValue=l}listen(n,l,c){if(typeof n=="string"&&(n=up().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${l}`);return this.eventManager.addEventListener(n,l,this.decoratePreventDefault(c))}decoratePreventDefault(n){return l=>{if(l==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(l)):n(l))===!1&&l.preventDefault()}}};function IL(o){return o.tagName==="TEMPLATE"&&o.content!==void 0}var AC=class extends f_{constructor(n,l,c,f,i,w,C,A){super(n,i,w,A),this.sharedStylesHost=l,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let L=AL(f.id,f.styles);for(let U of L){let Q=document.createElement("style");C&&Q.setAttribute("nonce",C),Q.textContent=U,this.shadowRoot.appendChild(Q)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,l){return super.appendChild(this.nodeOrShadowRoot(n),l)}insertBefore(n,l,c){return super.insertBefore(this.nodeOrShadowRoot(n),l,c)}removeChild(n,l){return super.removeChild(this.nodeOrShadowRoot(n),l)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},p_=class extends f_{constructor(n,l,c,f,i,w,C,A){super(n,i,w,C),this.sharedStylesHost=l,this.removeStylesOnCompDestroy=f,this.styles=A?AL(A,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ib=class extends p_{constructor(n,l,c,f,i,w,C,A){let L=f+"-"+c.id;super(n,l,c,i,w,C,A,L),this.contentAttr=TH(L),this.hostAttr=EH(L)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,l){let c=super.createElement(n,l);return super.setAttribute(c,this.contentAttr,""),c}},IH=(()=>{let n=class n extends tb{constructor(c){super(c)}supports(c){return!0}addEventListener(c,f,i){return c.addEventListener(f,i,!1),()=>this.removeEventListener(c,f,i)}removeEventListener(c,f,i){return c.removeEventListener(f,i)}};n.\u0275fac=function(f){return new(f||n)(Vt(zi))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),CL=["alt","control","meta","shift"],CH={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},SH={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey},DH=(()=>{let n=class n extends tb{constructor(c){super(c)}supports(c){return n.parseEventName(c)!=null}addEventListener(c,f,i){let w=n.parseEventName(f),C=n.eventCallback(w.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>up().onAndCancel(c,w.domEventName,C))}static parseEventName(c){let f=c.toLowerCase().split("."),i=f.shift();if(f.length===0||!(i==="keydown"||i==="keyup"))return null;let w=n._normalizeKey(f.pop()),C="",A=f.indexOf("code");if(A>-1&&(f.splice(A,1),C="code."),CL.forEach(U=>{let Q=f.indexOf(U);Q>-1&&(f.splice(Q,1),C+=U+".")}),C+=w,f.length!=0||w.length===0)return null;let L={};return L.domEventName=i,L.fullKey=C,L}static matchEventFullKeyCode(c,f){let i=CH[c.key]||c.key,w="";return f.indexOf("code.")>-1&&(i=c.code,w="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),CL.forEach(C=>{if(C!==i){let A=SH[C];A(c)&&(w+=C+".")}}),w+=i,w===f)}static eventCallback(c,f,i){return w=>{n.matchEventFullKeyCode(w,c)&&i.runGuarded(()=>f(w))}}static _normalizeKey(c){return c==="esc"?"escape":c}};n.\u0275fac=function(f){return new(f||n)(Vt(zi))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function PL(o,n){return tL(gt({rootComponent:o},MH(n)))}function MH(o){return{appProviders:[...OH,...o?.providers??[]],platformProviders:kH}}function AH(){DC.makeCurrent()}function PH(){return new $s}function RH(){return tO(document),document}var kH=[{provide:Hs,useValue:_C},{provide:zI,useValue:AH,multi:!0},{provide:zi,useFactory:RH,deps:[]}];var OH=[{provide:Ex,useValue:"root"},{provide:$s,useFactory:PH,deps:[]},{provide:MC,useClass:IH,multi:!0,deps:[zi,fi,Hs]},{provide:MC,useClass:DH,multi:!0,deps:[zi]},nb,DL,SL,{provide:Bh,useExisting:nb},{provide:hp,useClass:yH,deps:[]},[]];var RL=(()=>{let n=class n{constructor(c){this._doc=c}getTitle(){return this._doc.title}setTitle(c){this._doc.title=c||""}};n.\u0275fac=function(f){return new(f||n)(Vt(zi))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Fn="primary",M_=Symbol("RouteTitle"),FC=class{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let l=this.params[n];return Array.isArray(l)?l[0]:l}return null}getAll(n){if(this.has(n)){let l=this.params[n];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}};function bp(o){return new FC(o)}function FH(o,n,l){let c=l.path.split("/");if(c.length>o.length||l.pathMatch==="full"&&(n.hasChildren()||c.length<o.length))return null;let f={};for(let i=0;i<c.length;i++){let w=c[i],C=o[i];if(w.startsWith(":"))f[w.substring(1)]=C;else if(w!==C.path)return null}return{consumed:o.slice(0,c.length),posParams:f}}function NH(o,n){if(o.length!==n.length)return!1;for(let l=0;l<o.length;++l)if(!Aa(o[l],n[l]))return!1;return!0}function Aa(o,n){let l=o?NC(o):void 0,c=n?NC(n):void 0;if(!l||!c||l.length!=c.length)return!1;let f;for(let i=0;i<l.length;i++)if(f=l[i],!BL(o[f],n[f]))return!1;return!0}function NC(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function BL(o,n){if(Array.isArray(o)&&Array.isArray(n)){if(o.length!==n.length)return!1;let l=[...o].sort(),c=[...n].sort();return l.every((f,i)=>c[i]===f)}else return o===n}function VL(o){return o.length>0?o[o.length-1]:null}function su(o){return QT(o)?o:s_(o)?tr(Promise.resolve(o)):un(o)}var zH={exact:UL,subset:$L},jL={exact:BH,subset:VH,ignored:()=>!0};function kL(o,n,l){return zH[l.paths](o.root,n.root,l.matrixParams)&&jL[l.queryParams](o.queryParams,n.queryParams)&&!(l.fragment==="exact"&&o.fragment!==n.fragment)}function BH(o,n){return Aa(o,n)}function UL(o,n,l){if(!Yh(o.segments,n.segments)||!sb(o.segments,n.segments,l)||o.numberOfChildren!==n.numberOfChildren)return!1;for(let c in n.children)if(!o.children[c]||!UL(o.children[c],n.children[c],l))return!1;return!0}function VH(o,n){return Object.keys(n).length<=Object.keys(o).length&&Object.keys(n).every(l=>BL(o[l],n[l]))}function $L(o,n,l){return GL(o,n,n.segments,l)}function GL(o,n,l,c){if(o.segments.length>l.length){let f=o.segments.slice(0,l.length);return!(!Yh(f,l)||n.hasChildren()||!sb(f,l,c))}else if(o.segments.length===l.length){if(!Yh(o.segments,l)||!sb(o.segments,l,c))return!1;for(let f in n.children)if(!o.children[f]||!$L(o.children[f],n.children[f],c))return!1;return!0}else{let f=l.slice(0,o.segments.length),i=l.slice(o.segments.length);return!Yh(o.segments,f)||!sb(o.segments,f,c)||!o.children[Fn]?!1:GL(o.children[Fn],n,i,c)}}function sb(o,n,l){return n.every((c,f)=>jL[l](o[f].parameters,c.parameters))}var iu=class{constructor(n=new wi([],{}),l={},c=null){this.root=n,this.queryParams=l,this.fragment=c}get queryParamMap(){return this._queryParamMap??=bp(this.queryParams),this._queryParamMap}toString(){return $H.serialize(this)}},wi=class{constructor(n,l){this.segments=n,this.children=l,this.parent=null,Object.values(l).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ab(this)}},Zh=class{constructor(n,l){this.path=n,this.parameters=l}get parameterMap(){return this._parameterMap??=bp(this.parameters),this._parameterMap}toString(){return qL(this)}};function jH(o,n){return Yh(o,n)&&o.every((l,c)=>Aa(l.parameters,n[c].parameters))}function Yh(o,n){return o.length!==n.length?!1:o.every((l,c)=>l.path===n[c].path)}function UH(o,n){let l=[];return Object.entries(o.children).forEach(([c,f])=>{c===Fn&&(l=l.concat(n(f,c)))}),Object.entries(o.children).forEach(([c,f])=>{c!==Fn&&(l=l.concat(n(f,c)))}),l}var cS=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>new cb,providedIn:"root"});let o=n;return o})(),cb=class{parse(n){let l=new BC(n);return new iu(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(n){let l=`/${m_(n.root,!0)}`,c=qH(n.queryParams),f=typeof n.fragment=="string"?`#${GH(n.fragment)}`:"";return`${l}${c}${f}`}},$H=new cb;function ab(o){return o.segments.map(n=>qL(n)).join("/")}function m_(o,n){if(!o.hasChildren())return ab(o);if(n){let l=o.children[Fn]?m_(o.children[Fn],!1):"",c=[];return Object.entries(o.children).forEach(([f,i])=>{f!==Fn&&c.push(`${f}:${m_(i,!1)}`)}),c.length>0?`${l}(${c.join("//")})`:l}else{let l=UH(o,(c,f)=>f===Fn?[m_(o.children[Fn],!1)]:[`${f}:${m_(c,!1)}`]);return Object.keys(o.children).length===1&&o.children[Fn]!=null?`${ab(o)}/${l[0]}`:`${ab(o)}/(${l.join("//")})`}}function HL(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function rb(o){return HL(o).replace(/%3B/gi,";")}function GH(o){return encodeURI(o)}function zC(o){return HL(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function lb(o){return decodeURIComponent(o)}function OL(o){return lb(o.replace(/\+/g,"%20"))}function qL(o){return`${zC(o.path)}${HH(o.parameters)}`}function HH(o){return Object.entries(o).map(([n,l])=>`;${zC(n)}=${zC(l)}`).join("")}function qH(o){let n=Object.entries(o).map(([l,c])=>Array.isArray(c)?c.map(f=>`${rb(l)}=${rb(f)}`).join("&"):`${rb(l)}=${rb(c)}`).filter(l=>l);return n.length?`?${n.join("&")}`:""}var WH=/^[^\/()?;#]+/;function RC(o){let n=o.match(WH);return n?n[0]:""}var ZH=/^[^\/()?;=#]+/;function YH(o){let n=o.match(ZH);return n?n[0]:""}var XH=/^[^=?&#]+/;function KH(o){let n=o.match(XH);return n?n[0]:""}var QH=/^[^&#]+/;function JH(o){let n=o.match(QH);return n?n[0]:""}var BC=class{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new wi([],{}):new wi([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(n.length>0||Object.keys(l).length>0)&&(c[Fn]=new wi(n,l)),c}parseSegment(){let n=RC(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new bt(4009,!1);return this.capture(n),new Zh(lb(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let l=YH(this.remaining);if(!l)return;this.capture(l);let c="";if(this.consumeOptional("=")){let f=RC(this.remaining);f&&(c=f,this.capture(c))}n[lb(l)]=lb(c)}parseQueryParam(n){let l=KH(this.remaining);if(!l)return;this.capture(l);let c="";if(this.consumeOptional("=")){let w=JH(this.remaining);w&&(c=w,this.capture(c))}let f=OL(l),i=OL(c);if(n.hasOwnProperty(f)){let w=n[f];Array.isArray(w)||(w=[w],n[f]=w),w.push(i)}else n[f]=i}parseParens(n){let l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=RC(this.remaining),f=this.remaining[c.length];if(f!=="/"&&f!==")"&&f!==";")throw new bt(4010,!1);let i;c.indexOf(":")>-1?(i=c.slice(0,c.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=Fn);let w=this.parseChildren();l[i]=Object.keys(w).length===1?w[Fn]:new wi([],w),this.consumeOptional("//")}return l}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new bt(4011,!1)}};function WL(o){return o.segments.length>0?new wi([],{[Fn]:o}):o}function ZL(o){let n={};for(let[c,f]of Object.entries(o.children)){let i=ZL(f);if(c===Fn&&i.segments.length===0&&i.hasChildren())for(let[w,C]of Object.entries(i.children))n[w]=C;else(i.segments.length>0||i.hasChildren())&&(n[c]=i)}let l=new wi(o.segments,n);return eq(l)}function eq(o){if(o.numberOfChildren===1&&o.children[Fn]){let n=o.children[Fn];return new wi(o.segments.concat(n.segments),n.children)}return o}function wp(o){return o instanceof iu}function tq(o,n,l=null,c=null){let f=YL(o);return XL(f,n,l,c)}function YL(o){let n;function l(i){let w={};for(let A of i.children){let L=l(A);w[A.outlet]=L}let C=new wi(i.url,w);return i===o&&(n=C),C}let c=l(o.root),f=WL(c);return n??f}function XL(o,n,l,c){let f=o;for(;f.parent;)f=f.parent;if(n.length===0)return kC(f,f,f,l,c);let i=nq(n);if(i.toRoot())return kC(f,f,new wi([],{}),l,c);let w=iq(i,f,o),C=w.processChildren?y_(w.segmentGroup,w.index,i.commands):QL(w.segmentGroup,w.index,i.commands);return kC(f,w.segmentGroup,C,l,c)}function ub(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function b_(o){return typeof o=="object"&&o!=null&&o.outlets}function kC(o,n,l,c,f){let i={};c&&Object.entries(c).forEach(([A,L])=>{i[A]=Array.isArray(L)?L.map(U=>`${U}`):`${L}`});let w;o===n?w=l:w=KL(o,n,l);let C=WL(ZL(w));return new iu(C,i,f)}function KL(o,n,l){let c={};return Object.entries(o.children).forEach(([f,i])=>{i===n?c[f]=l:c[f]=KL(i,n,l)}),new wi(o.segments,c)}var hb=class{constructor(n,l,c){if(this.isAbsolute=n,this.numberOfDoubleDots=l,this.commands=c,n&&c.length>0&&ub(c[0]))throw new bt(4003,!1);let f=c.find(b_);if(f&&f!==VL(c))throw new bt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function nq(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new hb(!0,0,o);let n=0,l=!1,c=o.reduce((f,i,w)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let C={};return Object.entries(i.outlets).forEach(([A,L])=>{C[A]=typeof L=="string"?L.split("/"):L}),[...f,{outlets:C}]}if(i.segmentPath)return[...f,i.segmentPath]}return typeof i!="string"?[...f,i]:w===0?(i.split("/").forEach((C,A)=>{A==0&&C==="."||(A==0&&C===""?l=!0:C===".."?n++:C!=""&&f.push(C))}),f):[...f,i]},[]);return new hb(l,n,c)}var vp=class{constructor(n,l,c){this.segmentGroup=n,this.processChildren=l,this.index=c}};function iq(o,n,l){if(o.isAbsolute)return new vp(n,!0,0);if(!l)return new vp(n,!1,NaN);if(l.parent===null)return new vp(l,!0,0);let c=ub(o.commands[0])?0:1,f=l.segments.length-1+c;return rq(l,f,o.numberOfDoubleDots)}function rq(o,n,l){let c=o,f=n,i=l;for(;i>f;){if(i-=f,c=c.parent,!c)throw new bt(4005,!1);f=c.segments.length}return new vp(c,!1,f-i)}function oq(o){return b_(o[0])?o[0].outlets:{[Fn]:o}}function QL(o,n,l){if(o??=new wi([],{}),o.segments.length===0&&o.hasChildren())return y_(o,n,l);let c=sq(o,n,l),f=l.slice(c.commandIndex);if(c.match&&c.pathIndex<o.segments.length){let i=new wi(o.segments.slice(0,c.pathIndex),{});return i.children[Fn]=new wi(o.segments.slice(c.pathIndex),o.children),y_(i,0,f)}else return c.match&&f.length===0?new wi(o.segments,{}):c.match&&!o.hasChildren()?VC(o,n,l):c.match?y_(o,0,f):VC(o,n,l)}function y_(o,n,l){if(l.length===0)return new wi(o.segments,{});{let c=oq(l),f={};if(Object.keys(c).some(i=>i!==Fn)&&o.children[Fn]&&o.numberOfChildren===1&&o.children[Fn].segments.length===0){let i=y_(o.children[Fn],n,l);return new wi(o.segments,i.children)}return Object.entries(c).forEach(([i,w])=>{typeof w=="string"&&(w=[w]),w!==null&&(f[i]=QL(o.children[i],n,w))}),Object.entries(o.children).forEach(([i,w])=>{c[i]===void 0&&(f[i]=w)}),new wi(o.segments,f)}}function sq(o,n,l){let c=0,f=n,i={match:!1,pathIndex:0,commandIndex:0};for(;f<o.segments.length;){if(c>=l.length)return i;let w=o.segments[f],C=l[c];if(b_(C))break;let A=`${C}`,L=c<l.length-1?l[c+1]:null;if(f>0&&A===void 0)break;if(A&&L&&typeof L=="object"&&L.outlets===void 0){if(!FL(A,L,w))return i;c+=2}else{if(!FL(A,{},w))return i;c++}f++}return{match:!0,pathIndex:f,commandIndex:c}}function VC(o,n,l){let c=o.segments.slice(0,n),f=0;for(;f<l.length;){let i=l[f];if(b_(i)){let A=aq(i.outlets);return new wi(c,A)}if(f===0&&ub(l[0])){let A=o.segments[n];c.push(new Zh(A.path,LL(l[0]))),f++;continue}let w=b_(i)?i.outlets[Fn]:`${i}`,C=f<l.length-1?l[f+1]:null;w&&C&&ub(C)?(c.push(new Zh(w,LL(C))),f+=2):(c.push(new Zh(w,{})),f++)}return new wi(c,{})}function aq(o){let n={};return Object.entries(o).forEach(([l,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(n[l]=VC(new wi([],{}),0,c))}),n}function LL(o){let n={};return Object.entries(o).forEach(([l,c])=>n[l]=`${c}`),n}function FL(o,n,l){return o==l.path&&Aa(n,l.parameters)}var v_="imperative",$r=function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o}($r||{}),ds=class{constructor(n,l){this.id=n,this.url=l}},w_=class extends ds{constructor(n,l,c="imperative",f=null){super(n,l),this.type=$r.NavigationStart,this.navigationTrigger=c,this.restoredState=f}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ru=class extends ds{constructor(n,l,c){super(n,l),this.urlAfterRedirects=c,this.type=$r.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Go=function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o}(Go||{}),jC=function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o}(jC||{}),ou=class extends ds{constructor(n,l,c,f){super(n,l),this.reason=c,this.code=f,this.type=$r.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Xh=class extends ds{constructor(n,l,c,f){super(n,l),this.reason=c,this.code=f,this.type=$r.NavigationSkipped}},T_=class extends ds{constructor(n,l,c,f){super(n,l),this.error=c,this.target=f,this.type=$r.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},db=class extends ds{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=$r.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},UC=class extends ds{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=$r.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},$C=class extends ds{constructor(n,l,c,f,i){super(n,l),this.urlAfterRedirects=c,this.state=f,this.shouldActivate=i,this.type=$r.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},GC=class extends ds{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=$r.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},HC=class extends ds{constructor(n,l,c,f){super(n,l),this.urlAfterRedirects=c,this.state=f,this.type=$r.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},qC=class{constructor(n){this.route=n,this.type=$r.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},WC=class{constructor(n){this.route=n,this.type=$r.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},ZC=class{constructor(n){this.snapshot=n,this.type=$r.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},YC=class{constructor(n){this.snapshot=n,this.type=$r.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},XC=class{constructor(n){this.snapshot=n,this.type=$r.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},KC=class{constructor(n){this.snapshot=n,this.type=$r.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var E_=class{},I_=class{constructor(n){this.url=n}};var QC=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ep,this.attachRef=null}},Ep=(()=>{let n=class n{constructor(){this.contexts=new Map}onChildOutletCreated(c,f){let i=this.getOrCreateContext(c);i.outlet=f,this.contexts.set(c,i)}onChildOutletDestroyed(c){let f=this.getContext(c);f&&(f.outlet=null,f.attachRef=null)}onOutletDeactivated(){let c=this.contexts;return this.contexts=new Map,c}onOutletReAttached(c){this.contexts=c}getOrCreateContext(c){let f=this.getContext(c);return f||(f=new QC,this.contexts.set(c,f)),f}getContext(c){return this.contexts.get(c)||null}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),fb=class{constructor(n){this._root=n}get root(){return this._root.value}parent(n){let l=this.pathFromRoot(n);return l.length>1?l[l.length-2]:null}children(n){let l=JC(n,this._root);return l?l.children.map(c=>c.value):[]}firstChild(n){let l=JC(n,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(n){let l=eS(n,this._root);return l.length<2?[]:l[l.length-2].children.map(f=>f.value).filter(f=>f!==n)}pathFromRoot(n){return eS(n,this._root).map(l=>l.value)}};function JC(o,n){if(o===n.value)return n;for(let l of n.children){let c=JC(o,l);if(c)return c}return null}function eS(o,n){if(o===n.value)return[n];for(let l of n.children){let c=eS(o,l);if(c.length)return c.unshift(n),c}return[]}var $o=class{constructor(n,l){this.value=n,this.children=l}toString(){return`TreeNode(${this.value})`}};function yp(o){let n={};return o&&o.children.forEach(l=>n[l.value.outlet]=l),n}var pb=class extends fb{constructor(n,l){super(n),this.snapshot=l,hS(this,n)}toString(){return this.snapshot.toString()}};function JL(o){let n=lq(o),l=new wr([new Zh("",{})]),c=new wr({}),f=new wr({}),i=new wr({}),w=new wr(""),C=new Kh(l,c,i,w,f,Fn,o,n.root);return C.snapshot=n.root,new pb(new $o(C,[]),n)}function lq(o){let n={},l={},c={},f="",i=new C_([],n,c,f,l,Fn,o,null,{});return new mb("",new $o(i,[]))}var Kh=class{constructor(n,l,c,f,i,w,C,A){this.urlSubject=n,this.paramsSubject=l,this.queryParamsSubject=c,this.fragmentSubject=f,this.dataSubject=i,this.outlet=w,this.component=C,this._futureSnapshot=A,this.title=this.dataSubject?.pipe(Dn(L=>L[M_]))??un(void 0),this.url=n,this.params=l,this.queryParams=c,this.fragment=f,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Dn(n=>bp(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Dn(n=>bp(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function uS(o,n,l="emptyOnly"){let c,{routeConfig:f}=o;return n!==null&&(l==="always"||f?.path===""||!n.component&&!n.routeConfig?.loadComponent)?c={params:gt(gt({},n.params),o.params),data:gt(gt({},n.data),o.data),resolve:gt(gt(gt(gt({},o.data),n.data),f?.data),o._resolvedData)}:c={params:gt({},o.params),data:gt({},o.data),resolve:gt(gt({},o.data),o._resolvedData??{})},f&&tF(f)&&(c.resolve[M_]=f.title),c}var C_=class{get title(){return this.data?.[M_]}constructor(n,l,c,f,i,w,C,A,L){this.url=n,this.params=l,this.queryParams=c,this.fragment=f,this.data=i,this.outlet=w,this.component=C,this.routeConfig=A,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=bp(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=bp(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(c=>c.toString()).join("/"),l=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${l}')`}},mb=class extends fb{constructor(n,l){super(l),this.url=n,hS(this,l)}toString(){return eF(this._root)}};function hS(o,n){n.value._routerState=o,n.children.forEach(l=>hS(o,l))}function eF(o){let n=o.children.length>0?` { ${o.children.map(eF).join(", ")} } `:"";return`${o.value}${n}`}function OC(o){if(o.snapshot){let n=o.snapshot,l=o._futureSnapshot;o.snapshot=l,Aa(n.queryParams,l.queryParams)||o.queryParamsSubject.next(l.queryParams),n.fragment!==l.fragment&&o.fragmentSubject.next(l.fragment),Aa(n.params,l.params)||o.paramsSubject.next(l.params),NH(n.url,l.url)||o.urlSubject.next(l.url),Aa(n.data,l.data)||o.dataSubject.next(l.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function tS(o,n){let l=Aa(o.params,n.params)&&jH(o.url,n.url),c=!o.parent!=!n.parent;return l&&!c&&(!o.parent||tS(o.parent,n.parent))}function tF(o){return typeof o.title=="string"||o.title===null}var dS=(()=>{let n=class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=Fn,this.activateEvents=new Pr,this.deactivateEvents=new Pr,this.attachEvents=new Pr,this.detachEvents=new Pr,this.parentContexts=vt(Ep),this.location=vt(wl),this.changeDetector=vt(tu),this.environmentInjector=vt(Io),this.inputBinder=vt(yb,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(c){if(c.name){let{firstChange:f,previousValue:i}=c.name;if(f)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(c){return this.parentContexts.getContext(c)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let c=this.parentContexts.getContext(this.name);c?.route&&(c.attachRef?this.attach(c.attachRef,c.route):this.activateWith(c.route,c.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new bt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new bt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new bt(4012,!1);this.location.detach();let c=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(c.instance),c}attach(c,f){this.activated=c,this._activatedRoute=f,this.location.insert(c.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(c.instance)}deactivate(){if(this.activated){let c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(c,f){if(this.isActivated)throw new bt(4013,!1);this._activatedRoute=c;let i=this.location,C=c.snapshot.component,A=this.parentContexts.getOrCreateContext(this.name).children,L=new nS(c,A,i.injector);this.activated=i.createComponent(C,{index:i.length,injector:L,environmentInjector:f??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275dir=us({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[xl]});let o=n;return o})(),nS=class o{__ngOutletInjector(n){return new o(this.route,this.childContexts,n)}constructor(n,l,c){this.route=n,this.childContexts=l,this.parent=c}get(n,l){return n===Kh?this.route:n===Ep?this.childContexts:this.parent.get(n,l)}},yb=new an(""),NL=(()=>{let n=class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(c){this.unsubscribeFromRouteData(c),this.subscribeToRouteData(c)}unsubscribeFromRouteData(c){this.outletDataSubscriptions.get(c)?.unsubscribe(),this.outletDataSubscriptions.delete(c)}subscribeToRouteData(c){let{activatedRoute:f}=c,i=Dh([f.queryParams,f.params,f.data]).pipe(Eo(([w,C,A],L)=>(A=gt(gt(gt({},w),C),A),L===0?un(A):Promise.resolve(A)))).subscribe(w=>{if(!c.isActivated||!c.activatedComponentRef||c.activatedRoute!==f||f.component===null){this.unsubscribeFromRouteData(c);return}let C=nL(f.component);if(!C){this.unsubscribeFromRouteData(c);return}for(let{templateName:A}of C.inputs)c.activatedComponentRef.setInput(A,w[A])});this.outletDataSubscriptions.set(c,i)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function cq(o,n,l){let c=S_(o,n._root,l?l._root:void 0);return new pb(c,n)}function S_(o,n,l){if(l&&o.shouldReuseRoute(n.value,l.value.snapshot)){let c=l.value;c._futureSnapshot=n.value;let f=uq(o,n,l);return new $o(c,f)}else{if(o.shouldAttach(n.value)){let i=o.retrieve(n.value);if(i!==null){let w=i.route;return w.value._futureSnapshot=n.value,w.children=n.children.map(C=>S_(o,C)),w}}let c=hq(n.value),f=n.children.map(i=>S_(o,i));return new $o(c,f)}}function uq(o,n,l){return n.children.map(c=>{for(let f of l.children)if(o.shouldReuseRoute(c.value,f.value.snapshot))return S_(o,c,f);return S_(o,c)})}function hq(o){return new Kh(new wr(o.url),new wr(o.params),new wr(o.queryParams),new wr(o.fragment),new wr(o.data),o.outlet,o.component,o)}var nF="ngNavigationCancelingError";function iF(o,n){let{redirectTo:l,navigationBehaviorOptions:c}=wp(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,f=rF(!1,Go.Redirect);return f.url=l,f.navigationBehaviorOptions=c,f}function rF(o,n){let l=new Error(`NavigationCancelingError: ${o||""}`);return l[nF]=!0,l.cancellationCode=n,l}function dq(o){return oF(o)&&wp(o.url)}function oF(o){return!!o&&o[nF]}var fq=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["ng-component"]],standalone:!0,features:[bi],decls:1,vars:0,template:function(f,i){f&1&&si(0,"router-outlet")},dependencies:[dS],encapsulation:2});let o=n;return o})();function pq(o,n){return o.providers&&!o._injector&&(o._injector=nC(o.providers,n,`Route: ${o.path}`)),o._injector??n}function fS(o){let n=o.children&&o.children.map(fS),l=n?oi(gt({},o),{children:n}):gt({},o);return!l.component&&!l.loadComponent&&(n||l.loadChildren)&&l.outlet&&l.outlet!==Fn&&(l.component=fq),l}function Pa(o){return o.outlet||Fn}function mq(o,n){let l=o.filter(c=>Pa(c)===n);return l.push(...o.filter(c=>Pa(c)!==n)),l}function A_(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let n=o.parent;n;n=n.parent){let l=n.routeConfig;if(l?._loadedInjector)return l._loadedInjector;if(l?._injector)return l._injector}return null}var gq=(o,n,l,c)=>Dn(f=>(new iS(n,f.targetRouterState,f.currentRouterState,l,c).activate(o),f)),iS=class{constructor(n,l,c,f,i){this.routeReuseStrategy=n,this.futureState=l,this.currState=c,this.forwardEvent=f,this.inputBindingEnabled=i}activate(n){let l=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,c,n),OC(this.futureState.root),this.activateChildRoutes(l,c,n)}deactivateChildRoutes(n,l,c){let f=yp(l);n.children.forEach(i=>{let w=i.value.outlet;this.deactivateRoutes(i,f[w],c),delete f[w]}),Object.values(f).forEach(i=>{this.deactivateRouteAndItsChildren(i,c)})}deactivateRoutes(n,l,c){let f=n.value,i=l?l.value:null;if(f===i)if(f.component){let w=c.getContext(f.outlet);w&&this.deactivateChildRoutes(n,l,w.children)}else this.deactivateChildRoutes(n,l,c);else i&&this.deactivateRouteAndItsChildren(l,c)}deactivateRouteAndItsChildren(n,l){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,l):this.deactivateRouteAndOutlet(n,l)}detachAndStoreRouteSubtree(n,l){let c=l.getContext(n.value.outlet),f=c&&n.value.component?c.children:l,i=yp(n);for(let w of Object.values(i))this.deactivateRouteAndItsChildren(w,f);if(c&&c.outlet){let w=c.outlet.detach(),C=c.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:w,route:n,contexts:C})}}deactivateRouteAndOutlet(n,l){let c=l.getContext(n.value.outlet),f=c&&n.value.component?c.children:l,i=yp(n);for(let w of Object.values(i))this.deactivateRouteAndItsChildren(w,f);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(n,l,c){let f=yp(l);n.children.forEach(i=>{this.activateRoutes(i,f[i.value.outlet],c),this.forwardEvent(new KC(i.value.snapshot))}),n.children.length&&this.forwardEvent(new YC(n.value.snapshot))}activateRoutes(n,l,c){let f=n.value,i=l?l.value:null;if(OC(f),f===i)if(f.component){let w=c.getOrCreateContext(f.outlet);this.activateChildRoutes(n,l,w.children)}else this.activateChildRoutes(n,l,c);else if(f.component){let w=c.getOrCreateContext(f.outlet);if(this.routeReuseStrategy.shouldAttach(f.snapshot)){let C=this.routeReuseStrategy.retrieve(f.snapshot);this.routeReuseStrategy.store(f.snapshot,null),w.children.onOutletReAttached(C.contexts),w.attachRef=C.componentRef,w.route=C.route.value,w.outlet&&w.outlet.attach(C.componentRef,C.route.value),OC(C.route.value),this.activateChildRoutes(n,null,w.children)}else{let C=A_(f.snapshot);w.attachRef=null,w.route=f,w.injector=C,w.outlet&&w.outlet.activateWith(f,w.injector),this.activateChildRoutes(n,null,w.children)}}else this.activateChildRoutes(n,null,c)}},gb=class{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},xp=class{constructor(n,l){this.component=n,this.route=l}};function _q(o,n,l){let c=o._root,f=n?n._root:null;return g_(c,f,l,[c.value])}function yq(o){let n=o.routeConfig?o.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:o,guards:n}}function Ip(o,n){let l=Symbol(),c=n.get(o,l);return c===l?typeof o=="function"&&!$R(o)?o:n.get(o):c}function g_(o,n,l,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let i=yp(n);return o.children.forEach(w=>{vq(w,i[w.value.outlet],l,c.concat([w.value]),f),delete i[w.value.outlet]}),Object.entries(i).forEach(([w,C])=>x_(C,l.getContext(w),f)),f}function vq(o,n,l,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let i=o.value,w=n?n.value:null,C=l?l.getContext(o.value.outlet):null;if(w&&i.routeConfig===w.routeConfig){let A=xq(w,i,i.routeConfig.runGuardsAndResolvers);A?f.canActivateChecks.push(new gb(c)):(i.data=w.data,i._resolvedData=w._resolvedData),i.component?g_(o,n,C?C.children:null,c,f):g_(o,n,l,c,f),A&&C&&C.outlet&&C.outlet.isActivated&&f.canDeactivateChecks.push(new xp(C.outlet.component,w))}else w&&x_(n,C,f),f.canActivateChecks.push(new gb(c)),i.component?g_(o,null,C?C.children:null,c,f):g_(o,null,l,c,f);return f}function xq(o,n,l){if(typeof l=="function")return l(o,n);switch(l){case"pathParamsChange":return!Yh(o.url,n.url);case"pathParamsOrQueryParamsChange":return!Yh(o.url,n.url)||!Aa(o.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!tS(o,n)||!Aa(o.queryParams,n.queryParams);case"paramsChange":default:return!tS(o,n)}}function x_(o,n,l){let c=yp(o),f=o.value;Object.entries(c).forEach(([i,w])=>{f.component?n?x_(w,n.children.getContext(i),l):x_(w,null,l):x_(w,n,l)}),f.component?n&&n.outlet&&n.outlet.isActivated?l.canDeactivateChecks.push(new xp(n.outlet.component,f)):l.canDeactivateChecks.push(new xp(null,f)):l.canDeactivateChecks.push(new xp(null,f))}function P_(o){return typeof o=="function"}function bq(o){return typeof o=="boolean"}function wq(o){return o&&P_(o.canLoad)}function Tq(o){return o&&P_(o.canActivate)}function Eq(o){return o&&P_(o.canActivateChild)}function Iq(o){return o&&P_(o.canDeactivate)}function Cq(o){return o&&P_(o.canMatch)}function sF(o){return o instanceof gl||o?.name==="EmptyError"}var ob=Symbol("INITIAL_VALUE");function Tp(){return Eo(o=>Dh(o.map(n=>n.pipe(Fs(1),Og(ob)))).pipe(Dn(n=>{for(let l of n)if(l!==!0){if(l===ob)return ob;if(l===!1||l instanceof iu)return l}return!0}),io(n=>n!==ob),Fs(1)))}function Sq(o,n){return Tr(l=>{let{targetSnapshot:c,currentSnapshot:f,guards:{canActivateChecks:i,canDeactivateChecks:w}}=l;return w.length===0&&i.length===0?un(oi(gt({},l),{guardsResult:!0})):Dq(w,c,f,o).pipe(Tr(C=>C&&bq(C)?Mq(c,i,o,n):un(C)),Dn(C=>oi(gt({},l),{guardsResult:C})))})}function Dq(o,n,l,c){return tr(o).pipe(Tr(f=>Oq(f.component,f.route,l,n,c)),ba(f=>f!==!0,!0))}function Mq(o,n,l,c){return tr(n).pipe(Bc(f=>zc(Pq(f.route.parent,c),Aq(f.route,c),kq(o,f.path,l),Rq(o,f.route,l))),ba(f=>f!==!0,!0))}function Aq(o,n){return o!==null&&n&&n(new XC(o)),un(!0)}function Pq(o,n){return o!==null&&n&&n(new ZC(o)),un(!0)}function Rq(o,n,l){let c=n.routeConfig?n.routeConfig.canActivate:null;if(!c||c.length===0)return un(!0);let f=c.map(i=>Gv(()=>{let w=A_(n)??l,C=Ip(i,w),A=Tq(C)?C.canActivate(n,o):Gs(w,()=>C(n,o));return su(A).pipe(ba())}));return un(f).pipe(Tp())}function kq(o,n,l){let c=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(w=>yq(w)).filter(w=>w!==null).map(w=>Gv(()=>{let C=w.guards.map(A=>{let L=A_(w.node)??l,U=Ip(A,L),Q=Eq(U)?U.canActivateChild(c,o):Gs(L,()=>U(c,o));return su(Q).pipe(ba())});return un(C).pipe(Tp())}));return un(i).pipe(Tp())}function Oq(o,n,l,c,f){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return un(!0);let w=i.map(C=>{let A=A_(n)??f,L=Ip(C,A),U=Iq(L)?L.canDeactivate(o,n,l,c):Gs(A,()=>L(o,n,l,c));return su(U).pipe(ba())});return un(w).pipe(Tp())}function Lq(o,n,l,c){let f=n.canLoad;if(f===void 0||f.length===0)return un(!0);let i=f.map(w=>{let C=Ip(w,o),A=wq(C)?C.canLoad(n,l):Gs(o,()=>C(n,l));return su(A)});return un(i).pipe(Tp(),aF(c))}function aF(o){return WT(ur(n=>{if(wp(n))throw iF(o,n)}),Dn(n=>n===!0))}function Fq(o,n,l,c){let f=n.canMatch;if(!f||f.length===0)return un(!0);let i=f.map(w=>{let C=Ip(w,o),A=Cq(C)?C.canMatch(n,l):Gs(o,()=>C(n,l));return su(A)});return un(i).pipe(Tp(),aF(c))}var D_=class{constructor(n){this.segmentGroup=n||null}},_b=class extends Error{constructor(n){super(),this.urlTree=n}};function _p(o){return ml(new D_(o))}function Nq(o){return ml(new bt(4e3,!1))}function zq(o){return ml(rF(!1,Go.GuardRejected))}var rS=class{constructor(n,l){this.urlSerializer=n,this.urlTree=l}lineralizeSegments(n,l){let c=[],f=l.root;for(;;){if(c=c.concat(f.segments),f.numberOfChildren===0)return un(c);if(f.numberOfChildren>1||!f.children[Fn])return Nq(n.redirectTo);f=f.children[Fn]}}applyRedirectCommands(n,l,c){let f=this.applyRedirectCreateUrlTree(l,this.urlSerializer.parse(l),n,c);if(l.startsWith("/"))throw new _b(f);return f}applyRedirectCreateUrlTree(n,l,c,f){let i=this.createSegmentGroup(n,l.root,c,f);return new iu(i,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(n,l){let c={};return Object.entries(n).forEach(([f,i])=>{if(typeof i=="string"&&i.startsWith(":")){let C=i.substring(1);c[f]=l[C]}else c[f]=i}),c}createSegmentGroup(n,l,c,f){let i=this.createSegments(n,l.segments,c,f),w={};return Object.entries(l.children).forEach(([C,A])=>{w[C]=this.createSegmentGroup(n,A,c,f)}),new wi(i,w)}createSegments(n,l,c,f){return l.map(i=>i.path.startsWith(":")?this.findPosParam(n,i,f):this.findOrReturn(i,c))}findPosParam(n,l,c){let f=c[l.path.substring(1)];if(!f)throw new bt(4001,!1);return f}findOrReturn(n,l){let c=0;for(let f of l){if(f.path===n.path)return l.splice(c),f;c++}return n}},oS={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Bq(o,n,l,c,f){let i=pS(o,n,l);return i.matched?(c=pq(n,c),Fq(c,n,l,f).pipe(Dn(w=>w===!0?i:gt({},oS)))):un(i)}function pS(o,n,l){if(n.path==="**")return Vq(l);if(n.path==="")return n.pathMatch==="full"&&(o.hasChildren()||l.length>0)?gt({},oS):{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};let f=(n.matcher||FH)(l,o,n);if(!f)return gt({},oS);let i={};Object.entries(f.posParams??{}).forEach(([C,A])=>{i[C]=A.path});let w=f.consumed.length>0?gt(gt({},i),f.consumed[f.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:f.consumed,remainingSegments:l.slice(f.consumed.length),parameters:w,positionalParamSegments:f.posParams??{}}}function Vq(o){return{matched:!0,parameters:o.length>0?VL(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function zL(o,n,l,c){return l.length>0&&$q(o,l,c)?{segmentGroup:new wi(n,Uq(c,new wi(l,o.children))),slicedSegments:[]}:l.length===0&&Gq(o,l,c)?{segmentGroup:new wi(o.segments,jq(o,l,c,o.children)),slicedSegments:l}:{segmentGroup:new wi(o.segments,o.children),slicedSegments:l}}function jq(o,n,l,c){let f={};for(let i of l)if(vb(o,n,i)&&!c[Pa(i)]){let w=new wi([],{});f[Pa(i)]=w}return gt(gt({},c),f)}function Uq(o,n){let l={};l[Fn]=n;for(let c of o)if(c.path===""&&Pa(c)!==Fn){let f=new wi([],{});l[Pa(c)]=f}return l}function $q(o,n,l){return l.some(c=>vb(o,n,c)&&Pa(c)!==Fn)}function Gq(o,n,l){return l.some(c=>vb(o,n,c))}function vb(o,n,l){return(o.hasChildren()||n.length>0)&&l.pathMatch==="full"?!1:l.path===""}function Hq(o,n,l,c){return Pa(o)!==c&&(c===Fn||!vb(n,l,o))?!1:pS(n,o,l).matched}function qq(o,n,l){return n.length===0&&!o.children[l]}var sS=class{};function Wq(o,n,l,c,f,i,w="emptyOnly"){return new aS(o,n,l,c,f,w,i).recognize()}var Zq=31,aS=class{constructor(n,l,c,f,i,w,C){this.injector=n,this.configLoader=l,this.rootComponentType=c,this.config=f,this.urlTree=i,this.paramsInheritanceStrategy=w,this.urlSerializer=C,this.applyRedirects=new rS(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new bt(4002,`'${n.segmentGroup}'`)}recognize(){let n=zL(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Dn(l=>{let c=new C_([],Object.freeze({}),Object.freeze(gt({},this.urlTree.queryParams)),this.urlTree.fragment,{},Fn,this.rootComponentType,null,{}),f=new $o(c,l),i=new mb("",f),w=tq(c,[],this.urlTree.queryParams,this.urlTree.fragment);return w.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(w),this.inheritParamsAndData(i._root,null),{state:i,tree:w}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n,Fn).pipe(va(c=>{if(c instanceof _b)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof D_?this.noMatchError(c):c}))}inheritParamsAndData(n,l){let c=n.value,f=uS(c,l,this.paramsInheritanceStrategy);c.params=Object.freeze(f.params),c.data=Object.freeze(f.data),n.children.forEach(i=>this.inheritParamsAndData(i,c))}processSegmentGroup(n,l,c,f){return c.segments.length===0&&c.hasChildren()?this.processChildren(n,l,c):this.processSegment(n,l,c,c.segments,f,!0).pipe(Dn(i=>i instanceof $o?[i]:[]))}processChildren(n,l,c){let f=[];for(let i of Object.keys(c.children))i==="primary"?f.unshift(i):f.push(i);return tr(f).pipe(Bc(i=>{let w=c.children[i],C=mq(l,i);return this.processSegmentGroup(n,C,w,i)}),iE((i,w)=>(i.push(...w),i)),Vc(null),nE(),Tr(i=>{if(i===null)return _p(c);let w=lF(i);return Yq(w),un(w)}))}processSegment(n,l,c,f,i,w){return tr(l).pipe(Bc(C=>this.processSegmentAgainstRoute(C._injector??n,l,C,c,f,i,w).pipe(va(A=>{if(A instanceof D_)return un(null);throw A}))),ba(C=>!!C),va(C=>{if(sF(C))return qq(c,f,i)?un(new sS):_p(c);throw C}))}processSegmentAgainstRoute(n,l,c,f,i,w,C){return Hq(c,f,i,w)?c.redirectTo===void 0?this.matchSegmentAgainstRoute(n,f,c,i,w):this.allowRedirects&&C?this.expandSegmentAgainstRouteUsingRedirect(n,f,l,c,i,w):_p(f):_p(f)}expandSegmentAgainstRouteUsingRedirect(n,l,c,f,i,w){let{matched:C,consumedSegments:A,positionalParamSegments:L,remainingSegments:U}=pS(l,f,i);if(!C)return _p(l);f.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Zq&&(this.allowRedirects=!1));let Q=this.applyRedirects.applyRedirectCommands(A,f.redirectTo,L);return this.applyRedirects.lineralizeSegments(f,Q).pipe(Tr(fe=>this.processSegment(n,c,l,fe.concat(U),w,!1)))}matchSegmentAgainstRoute(n,l,c,f,i){let w=Bq(l,c,f,n,this.urlSerializer);return c.path==="**"&&(l.children={}),w.pipe(Eo(C=>C.matched?(n=c._injector??n,this.getChildConfig(n,c,f).pipe(Eo(({routes:A})=>{let L=c._loadedInjector??n,{consumedSegments:U,remainingSegments:Q,parameters:fe}=C,he=new C_(U,fe,Object.freeze(gt({},this.urlTree.queryParams)),this.urlTree.fragment,Kq(c),Pa(c),c.component??c._loadedComponent??null,c,Qq(c)),{segmentGroup:be,slicedSegments:Se}=zL(l,U,Q,A);if(Se.length===0&&be.hasChildren())return this.processChildren(L,A,be).pipe(Dn(Fe=>Fe===null?null:new $o(he,Fe)));if(A.length===0&&Se.length===0)return un(new $o(he,[]));let Ke=Pa(c)===i;return this.processSegment(L,A,be,Se,Ke?Fn:i,!0).pipe(Dn(Fe=>new $o(he,Fe instanceof $o?[Fe]:[])))}))):_p(l)))}getChildConfig(n,l,c){return l.children?un({routes:l.children,injector:n}):l.loadChildren?l._loadedRoutes!==void 0?un({routes:l._loadedRoutes,injector:l._loadedInjector}):Lq(n,l,c,this.urlSerializer).pipe(Tr(f=>f?this.configLoader.loadChildren(n,l).pipe(ur(i=>{l._loadedRoutes=i.routes,l._loadedInjector=i.injector})):zq(l))):un({routes:[],injector:n})}};function Yq(o){o.sort((n,l)=>n.value.outlet===Fn?-1:l.value.outlet===Fn?1:n.value.outlet.localeCompare(l.value.outlet))}function Xq(o){let n=o.value.routeConfig;return n&&n.path===""}function lF(o){let n=[],l=new Set;for(let c of o){if(!Xq(c)){n.push(c);continue}let f=n.find(i=>c.value.routeConfig===i.value.routeConfig);f!==void 0?(f.children.push(...c.children),l.add(f)):n.push(c)}for(let c of l){let f=lF(c.children);n.push(new $o(c.value,f))}return n.filter(c=>!l.has(c))}function Kq(o){return o.data||{}}function Qq(o){return o.resolve||{}}function Jq(o,n,l,c,f,i){return Tr(w=>Wq(o,n,l,c,w.extractedUrl,f,i).pipe(Dn(({state:C,tree:A})=>oi(gt({},w),{targetSnapshot:C,urlAfterRedirects:A}))))}function e9(o,n){return Tr(l=>{let{targetSnapshot:c,guards:{canActivateChecks:f}}=l;if(!f.length)return un(l);let i=new Set(f.map(A=>A.route)),w=new Set;for(let A of i)if(!w.has(A))for(let L of cF(A))w.add(L);let C=0;return tr(w).pipe(Bc(A=>i.has(A)?t9(A,c,o,n):(A.data=uS(A,A.parent,o).resolve,un(void 0))),ur(()=>C++),Bf(1),Tr(A=>C===w.size?un(l):Bo))})}function cF(o){let n=o.children.map(l=>cF(l)).flat();return[o,...n]}function t9(o,n,l,c){let f=o.routeConfig,i=o._resolve;return f?.title!==void 0&&!tF(f)&&(i[M_]=f.title),n9(i,o,n,c).pipe(Dn(w=>(o._resolvedData=w,o.data=uS(o,o.parent,l).resolve,null)))}function n9(o,n,l,c){let f=NC(o);if(f.length===0)return un({});let i={};return tr(f).pipe(Tr(w=>i9(o[w],n,l,c).pipe(ba(),ur(C=>{i[w]=C}))),Bf(1),tE(i),va(w=>sF(w)?Bo:ml(w)))}function i9(o,n,l,c){let f=A_(n)??c,i=Ip(o,f),w=i.resolve?i.resolve(n,l):Gs(f,()=>i(n,l));return su(w)}function LC(o){return Eo(n=>{let l=o(n);return l?tr(l).pipe(Dn(()=>n)):un(n)})}var uF=(()=>{let n=class n{buildTitle(c){let f,i=c.root;for(;i!==void 0;)f=this.getResolvedTitleForRoute(i)??f,i=i.children.find(w=>w.outlet===Fn);return f}getResolvedTitleForRoute(c){return c.data[M_]}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>vt(r9),providedIn:"root"});let o=n;return o})(),r9=(()=>{let n=class n extends uF{constructor(c){super(),this.title=c}updateTitle(c){let f=this.buildTitle(c);f!==void 0&&this.title.setTitle(f)}};n.\u0275fac=function(f){return new(f||n)(Vt(RL))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),mS=new an("",{providedIn:"root",factory:()=>({})}),gS=new an(""),o9=(()=>{let n=class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=vt(hC)}loadComponent(c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return un(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let f=su(c.loadComponent()).pipe(Dn(hF),ur(w=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=w}),xa(()=>{this.componentLoaders.delete(c)})),i=new Nf(f,()=>new cr).pipe(Ff());return this.componentLoaders.set(c,i),i}loadChildren(c,f){if(this.childrenLoaders.get(f))return this.childrenLoaders.get(f);if(f._loadedRoutes)return un({routes:f._loadedRoutes,injector:f._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(f);let w=s9(f,this.compiler,c,this.onLoadEndListener).pipe(xa(()=>{this.childrenLoaders.delete(f)})),C=new Nf(w,()=>new cr).pipe(Ff());return this.childrenLoaders.set(f,C),C}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function s9(o,n,l,c){return su(o.loadChildren()).pipe(Dn(hF),Tr(f=>f instanceof Hg||Array.isArray(f)?un(f):tr(n.compileModuleAsync(f))),Dn(f=>{c&&c(o);let i,w,C=!1;return Array.isArray(f)?(w=f,C=!0):(i=f.create(l).injector,w=i.get(gS,[],{optional:!0,self:!0}).flat()),{routes:w.map(fS),injector:i}}))}function a9(o){return o&&typeof o=="object"&&"default"in o}function hF(o){return a9(o)?o.default:o}var _S=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>vt(l9),providedIn:"root"});let o=n;return o})(),l9=(()=>{let n=class n{shouldProcessUrl(c){return!0}extract(c){return c}merge(c,f){return c}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),dF=new an(""),fF=new an("");function c9(o,n,l){let c=o.get(fF),f=o.get(zi);return o.get(fi).runOutsideAngular(()=>{if(!f.startViewTransition||c.skipNextTransition)return c.skipNextTransition=!1,new Promise(L=>setTimeout(L));let i,w=new Promise(L=>{i=L}),C=f.startViewTransition(()=>(i(),u9(o))),{onViewTransitionCreated:A}=c;return A&&Gs(o,()=>A({transition:C,from:n,to:l})),w})}function u9(o){return new Promise(n=>{Vx(n,{injector:o})})}var h9=(()=>{let n=class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new cr,this.transitionAbortSubject=new cr,this.configLoader=vt(o9),this.environmentInjector=vt(Io),this.urlSerializer=vt(cS),this.rootContexts=vt(Ep),this.location=vt(l_),this.inputBindingEnabled=vt(yb,{optional:!0})!==null,this.titleStrategy=vt(uF),this.options=vt(mS,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=vt(_S),this.createViewTransition=vt(dF,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>un(void 0),this.rootComponentType=null;let c=i=>this.events.next(new qC(i)),f=i=>this.events.next(new WC(i));this.configLoader.onLoadEndListener=f,this.configLoader.onLoadStartListener=c}complete(){this.transitions?.complete()}handleNavigationRequest(c){let f=++this.navigationId;this.transitions?.next(oi(gt(gt({},this.transitions.value),c),{id:f}))}setupNavigations(c,f,i){return this.transitions=new wr({id:0,currentUrlTree:f,currentRawUrl:f,extractedUrl:this.urlHandlingStrategy.extract(f),urlAfterRedirects:this.urlHandlingStrategy.extract(f),rawUrl:f,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:v_,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(io(w=>w.id!==0),Dn(w=>oi(gt({},w),{extractedUrl:this.urlHandlingStrategy.extract(w.rawUrl)})),Eo(w=>{let C=!1,A=!1;return un(w).pipe(Eo(L=>{if(this.navigationId>w.id)return this.cancelNavigationTransition(w,"",Go.SupersededByNewNavigation),Bo;this.currentTransition=w,this.currentNavigation={id:L.id,initialUrl:L.rawUrl,extractedUrl:L.extractedUrl,trigger:L.source,extras:L.extras,previousNavigation:this.lastSuccessfulNavigation?oi(gt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let U=!c.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Q=L.extras.onSameUrlNavigation??c.onSameUrlNavigation;if(!U&&Q!=="reload"){let fe="";return this.events.next(new Xh(L.id,this.urlSerializer.serialize(L.rawUrl),fe,jC.IgnoredSameUrlNavigation)),L.resolve(null),Bo}if(this.urlHandlingStrategy.shouldProcessUrl(L.rawUrl))return un(L).pipe(Eo(fe=>{let he=this.transitions?.getValue();return this.events.next(new w_(fe.id,this.urlSerializer.serialize(fe.extractedUrl),fe.source,fe.restoredState)),he!==this.transitions?.getValue()?Bo:Promise.resolve(fe)}),Jq(this.environmentInjector,this.configLoader,this.rootComponentType,c.config,this.urlSerializer,this.paramsInheritanceStrategy),ur(fe=>{w.targetSnapshot=fe.targetSnapshot,w.urlAfterRedirects=fe.urlAfterRedirects,this.currentNavigation=oi(gt({},this.currentNavigation),{finalUrl:fe.urlAfterRedirects});let he=new db(fe.id,this.urlSerializer.serialize(fe.extractedUrl),this.urlSerializer.serialize(fe.urlAfterRedirects),fe.targetSnapshot);this.events.next(he)}));if(U&&this.urlHandlingStrategy.shouldProcessUrl(L.currentRawUrl)){let{id:fe,extractedUrl:he,source:be,restoredState:Se,extras:Ke}=L,Fe=new w_(fe,this.urlSerializer.serialize(he),be,Se);this.events.next(Fe);let tt=JL(this.rootComponentType).snapshot;return this.currentTransition=w=oi(gt({},L),{targetSnapshot:tt,urlAfterRedirects:he,extras:oi(gt({},Ke),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=he,un(w)}else{let fe="";return this.events.next(new Xh(L.id,this.urlSerializer.serialize(L.extractedUrl),fe,jC.IgnoredByUrlHandlingStrategy)),L.resolve(null),Bo}}),ur(L=>{let U=new UC(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(U)}),Dn(L=>(this.currentTransition=w=oi(gt({},L),{guards:_q(L.targetSnapshot,L.currentSnapshot,this.rootContexts)}),w)),Sq(this.environmentInjector,L=>this.events.next(L)),ur(L=>{if(w.guardsResult=L.guardsResult,wp(L.guardsResult))throw iF(this.urlSerializer,L.guardsResult);let U=new $C(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot,!!L.guardsResult);this.events.next(U)}),io(L=>L.guardsResult?!0:(this.cancelNavigationTransition(L,"",Go.GuardRejected),!1)),LC(L=>{if(L.guards.canActivateChecks.length)return un(L).pipe(ur(U=>{let Q=new GC(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(Q)}),Eo(U=>{let Q=!1;return un(U).pipe(e9(this.paramsInheritanceStrategy,this.environmentInjector),ur({next:()=>Q=!0,complete:()=>{Q||this.cancelNavigationTransition(U,"",Go.NoDataFromResolver)}}))}),ur(U=>{let Q=new HC(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(Q)}))}),LC(L=>{let U=Q=>{let fe=[];Q.routeConfig?.loadComponent&&!Q.routeConfig._loadedComponent&&fe.push(this.configLoader.loadComponent(Q.routeConfig).pipe(ur(he=>{Q.component=he}),Dn(()=>{})));for(let he of Q.children)fe.push(...U(he));return fe};return Dh(U(L.targetSnapshot.root)).pipe(Vc(null),Fs(1))}),LC(()=>this.afterPreactivation()),Eo(()=>{let{currentSnapshot:L,targetSnapshot:U}=w,Q=this.createViewTransition?.(this.environmentInjector,L.root,U.root);return Q?tr(Q).pipe(Dn(()=>w)):un(w)}),Dn(L=>{let U=cq(c.routeReuseStrategy,L.targetSnapshot,L.currentRouterState);return this.currentTransition=w=oi(gt({},L),{targetRouterState:U}),this.currentNavigation.targetRouterState=U,w}),ur(()=>{this.events.next(new E_)}),gq(this.rootContexts,c.routeReuseStrategy,L=>this.events.next(L),this.inputBindingEnabled),Fs(1),ur({next:L=>{C=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ru(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects))),this.titleStrategy?.updateTitle(L.targetRouterState.snapshot),L.resolve(!0)},complete:()=>{C=!0}}),Lg(this.transitionAbortSubject.pipe(ur(L=>{throw L}))),xa(()=>{!C&&!A&&this.cancelNavigationTransition(w,"",Go.SupersededByNewNavigation),this.currentTransition?.id===w.id&&(this.currentNavigation=null,this.currentTransition=null)}),va(L=>{if(A=!0,oF(L))this.events.next(new ou(w.id,this.urlSerializer.serialize(w.extractedUrl),L.message,L.cancellationCode)),dq(L)?this.events.next(new I_(L.url)):w.resolve(!1);else{this.events.next(new T_(w.id,this.urlSerializer.serialize(w.extractedUrl),L,w.targetSnapshot??void 0));try{w.resolve(c.errorHandler(L))}catch(U){this.options.resolveNavigationPromiseOnError?w.resolve(!1):w.reject(U)}}return Bo}))}))}cancelNavigationTransition(c,f,i){let w=new ou(c.id,this.urlSerializer.serialize(c.extractedUrl),f,i);this.events.next(w),c.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function d9(o){return o!==v_}var f9=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>vt(p9),providedIn:"root"});let o=n;return o})(),lS=class{shouldDetach(n){return!1}store(n,l){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,l){return n.routeConfig===l.routeConfig}},p9=(()=>{let n=class n extends lS{};n.\u0275fac=(()=>{let c;return function(i){return(c||(c=NI(n)))(i||n)}})(),n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),pF=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:()=>vt(m9),providedIn:"root"});let o=n;return o})(),m9=(()=>{let n=class n extends pF{constructor(){super(...arguments),this.location=vt(l_),this.urlSerializer=vt(cS),this.options=vt(mS,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=vt(_S),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new iu,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=JL(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(c){return this.location.subscribe(f=>{f.type==="popstate"&&c(f.url,f.state)})}handleRouterEvent(c,f){if(c instanceof w_)this.stateMemento=this.createStateMemento();else if(c instanceof Xh)this.rawUrlTree=f.initialUrl;else if(c instanceof db){if(this.urlUpdateStrategy==="eager"&&!f.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl);this.setBrowserUrl(i,f)}}else c instanceof E_?(this.currentUrlTree=f.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl),this.routerState=f.targetRouterState,this.urlUpdateStrategy==="deferred"&&(f.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,f))):c instanceof ou&&(c.code===Go.GuardRejected||c.code===Go.NoDataFromResolver)?this.restoreHistory(f):c instanceof T_?this.restoreHistory(f,!0):c instanceof ru&&(this.lastSuccessfulId=c.id,this.currentPageId=this.browserPageId)}setBrowserUrl(c,f){let i=this.urlSerializer.serialize(c);if(this.location.isCurrentPathEqualTo(i)||f.extras.replaceUrl){let w=this.browserPageId,C=gt(gt({},f.extras.state),this.generateNgRouterState(f.id,w));this.location.replaceState(i,"",C)}else{let w=gt(gt({},f.extras.state),this.generateNgRouterState(f.id,this.browserPageId+1));this.location.go(i,"",w)}}restoreHistory(c,f=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,w=this.currentPageId-i;w!==0?this.location.historyGo(w):this.currentUrlTree===c.finalUrl&&w===0&&(this.resetState(c),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(f&&this.resetState(c),this.resetUrlToCurrentUrlTree())}resetState(c){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,c.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(c,f){return this.canceledNavigationResolution==="computed"?{navigationId:c,\u0275routerPageId:f}:{navigationId:c}}};n.\u0275fac=(()=>{let c;return function(i){return(c||(c=NI(n)))(i||n)}})(),n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})(),__=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(__||{});function g9(o,n){o.events.pipe(io(l=>l instanceof ru||l instanceof ou||l instanceof T_||l instanceof Xh),Dn(l=>l instanceof ru||l instanceof Xh?__.COMPLETE:(l instanceof ou?l.code===Go.Redirect||l.code===Go.SupersededByNewNavigation:!1)?__.REDIRECTING:__.FAILED),io(l=>l!==__.REDIRECTING),Fs(1)).subscribe(()=>{n()})}function _9(o){throw o}var y9={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},v9={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},R_=(()=>{let n=class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=vt(Ux),this.stateManager=vt(pF),this.options=vt(mS,{optional:!0})||{},this.pendingTasks=vt(Qc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=vt(h9),this.urlSerializer=vt(cS),this.location=vt(l_),this.urlHandlingStrategy=vt(_S),this._events=new cr,this.errorHandler=this.options.errorHandler||_9,this.navigated=!1,this.routeReuseStrategy=vt(f9),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=vt(gS,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!vt(yb,{optional:!0}),this.eventsSubscription=new Ji,this.isNgZoneEnabled=vt(fi)instanceof fi&&fi.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:c=>{this.console.warn(c)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let c=this.navigationTransitions.events.subscribe(f=>{try{let i=this.navigationTransitions.currentTransition,w=this.navigationTransitions.currentNavigation;if(i!==null&&w!==null){if(this.stateManager.handleRouterEvent(f,w),f instanceof ou&&f.code!==Go.Redirect&&f.code!==Go.SupersededByNewNavigation)this.navigated=!0;else if(f instanceof ru)this.navigated=!0;else if(f instanceof I_){let C=this.urlHandlingStrategy.merge(f.url,i.currentRawUrl),A={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||d9(i.source)};this.scheduleNavigation(C,v_,null,A,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}b9(f)&&this._events.next(f)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(c)}resetRootComponentType(c){this.routerState.root.component=c,this.navigationTransitions.rootComponentType=c}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),v_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((c,f)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(c,"popstate",f)},0)})}navigateToSyncWithBrowser(c,f,i){let w={replaceUrl:!0},C=i?.navigationId?i:null;if(i){let L=gt({},i);delete L.navigationId,delete L.\u0275routerPageId,Object.keys(L).length!==0&&(w.state=L)}let A=this.parseUrl(c);this.scheduleNavigation(A,f,C,w)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(c){this.config=c.map(fS),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(c,f={}){let{relativeTo:i,queryParams:w,fragment:C,queryParamsHandling:A,preserveFragment:L}=f,U=L?this.currentUrlTree.fragment:C,Q=null;switch(A){case"merge":Q=gt(gt({},this.currentUrlTree.queryParams),w);break;case"preserve":Q=this.currentUrlTree.queryParams;break;default:Q=w||null}Q!==null&&(Q=this.removeEmptyProps(Q));let fe;try{let he=i?i.snapshot:this.routerState.snapshot.root;fe=YL(he)}catch{(typeof c[0]!="string"||!c[0].startsWith("/"))&&(c=[]),fe=this.currentUrlTree.root}return XL(fe,c,Q,U??null)}navigateByUrl(c,f={skipLocationChange:!1}){let i=wp(c)?c:this.parseUrl(c),w=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(w,v_,null,f)}navigate(c,f={skipLocationChange:!1}){return x9(c),this.navigateByUrl(this.createUrlTree(c,f),f)}serializeUrl(c){return this.urlSerializer.serialize(c)}parseUrl(c){try{return this.urlSerializer.parse(c)}catch{return this.urlSerializer.parse("/")}}isActive(c,f){let i;if(f===!0?i=gt({},y9):f===!1?i=gt({},v9):i=f,wp(c))return kL(this.currentUrlTree,c,i);let w=this.parseUrl(c);return kL(this.currentUrlTree,w,i)}removeEmptyProps(c){return Object.entries(c).reduce((f,[i,w])=>(w!=null&&(f[i]=w),f),{})}scheduleNavigation(c,f,i,w,C){if(this.disposed)return Promise.resolve(!1);let A,L,U;C?(A=C.resolve,L=C.reject,U=C.promise):U=new Promise((fe,he)=>{A=fe,L=he});let Q=this.pendingTasks.add();return g9(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Q))}),this.navigationTransitions.handleNavigationRequest({source:f,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:c,extras:w,resolve:A,reject:L,promise:U,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),U.catch(fe=>Promise.reject(fe))}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function x9(o){for(let n=0;n<o.length;n++)if(o[n]==null)throw new bt(4008,!1)}function b9(o){return!(o instanceof E_)&&!(o instanceof I_)}var mF=(()=>{let n=class n{constructor(c,f,i,w,C,A){this.router=c,this.route=f,this.tabIndexAttribute=i,this.renderer=w,this.el=C,this.locationStrategy=A,this.href=null,this.commands=null,this.onChanges=new cr,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let L=C.nativeElement.tagName?.toLowerCase();this.isAnchorElement=L==="a"||L==="area",this.isAnchorElement?this.subscription=c.events.subscribe(U=>{U instanceof ru&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(c){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",c)}ngOnChanges(c){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(c){c!=null?(this.commands=Array.isArray(c)?c:[c],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(c,f,i,w,C){let A=this.urlTree;if(A===null||this.isAnchorElement&&(c!==0||f||i||w||C||typeof this.target=="string"&&this.target!="_self"))return!0;let L={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(A,L),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let c=this.urlTree;this.href=c!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(c)):null;let f=this.href===null?null:rO(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",f)}applyAttributeValue(c,f){let i=this.renderer,w=this.el.nativeElement;f!==null?i.setAttribute(w,c,f):i.removeAttribute(w,c)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};n.\u0275fac=function(f){return new(f||n)(Kn(R_),Kn(Kh),Px("tabindex"),Kn(Xc),Kn(Or),Kn(dp))},n.\u0275dir=us({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(f,i){f&1&&Oi("click",function(C){return i.onClick(C.button,C.ctrlKey,C.shiftKey,C.altKey,C.metaKey)}),f&2&&ap("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Ni.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Hh],skipLocationChange:[Ni.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Hh],replaceUrl:[Ni.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Hh],routerLink:"routerLink"},standalone:!0,features:[sp,xl]});let o=n;return o})();var w9=new an("");function gF(o,...n){return Zc([{provide:gS,multi:!0,useValue:o},[],{provide:Kh,useFactory:T9,deps:[R_]},{provide:$x,multi:!0,useFactory:E9},n.map(l=>l.\u0275providers)])}function T9(o){return o.routerState.root}function _F(o,n){return{\u0275kind:o,\u0275providers:n}}function E9(){let o=vt(bl);return n=>{let l=o.get(cp);if(n!==l.components[0])return;let c=o.get(R_),f=o.get(I9);o.get(C9)===1&&c.initialNavigation(),o.get(S9,null,Gn.Optional)?.setUpPreloading(),o.get(w9,null,Gn.Optional)?.init(),c.resetRootComponentType(l.componentTypes[0]),f.closed||(f.next(),f.complete(),f.unsubscribe())}}var I9=new an("",{factory:()=>new cr}),C9=new an("",{providedIn:"root",factory:()=>1});var S9=new an("");function yF(){return _F(8,[NL,{provide:yb,useExisting:NL}])}function vF(o){let n=[{provide:dF,useValue:c9},{provide:fF,useValue:gt({skipNextTransition:!!o?.skipInitialTransition},o)}];return _F(9,n)}function k_(o,n,l,c=!1){return{width:100,height:100,data:new Uint8ClampedArray(100*100*4),context:null,map:n,canvas:l,onAdd:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.context=l.getContext("2d")},render:function(){let i=this.width/2*.3,w=this.context,C=1e3,A=performance.now()%C/C;if(w){if(c){let L=this.width/2*.7*A+i;w.clearRect(0,0,this.width,this.height),w.beginPath(),w.arc(this.width/2,this.height/2,L,0,Math.PI*2),w.fillStyle=`${D9(o,A)}`,w.fill()}w.beginPath(),w.arc(this.width/2,this.height/2,i,0,Math.PI*2),w.fillStyle=o,w.strokeStyle="white",c?w.lineWidth=2+4*(1-A):w.lineWidth=4,w.fill(),w.stroke(),this.data=w.getImageData(0,0,this.width,this.height).data}return this.map?.triggerRepaint(),!0}}}function D9(o,n){let l=n-.1,c=1-l>.1?1-l:.1,f=Math.round(Math.min(Math.max(c??1,0),1)*255);return o+f.toString(16).toUpperCase()}var M9=[{id:"1",latitude:50.05423456789012,longitude:19.93845678901234},{id:"2",latitude:50.051601681737964,longitude:19.94527204613522},{id:"3",latitude:50.05773375024379,longitude:19.943222265625},{id:"4",latitude:50.05490381469543,longitude:19.93778991699219},{id:"5",latitude:50.05760487599164,longitude:19.937191009521484},{id:"6",latitude:50.05824547073284,longitude:19.930737670577457},{id:"7",latitude:50.05684123456789,longitude:19.93645678012345},{id:"8",latitude:50.05567891234567,longitude:19.94123456789012},{id:"9",latitude:50.05345678901234,longitude:19.93987654321098},{id:"10",latitude:50.05234567890123,longitude:19.93876543210987},{id:"11",latitude:50.05123456789012,longitude:19.94098765432109},{id:"12",latitude:50.05987654321098,longitude:19.93567890123456},{id:"13",latitude:50.05876543210987,longitude:19.94456789012345},{id:"14",latitude:50.05432109876543,longitude:19.94234567890123},{id:"15",latitude:50.05543210987654,longitude:19.94345678901234},{id:"16",latitude:50.05754321098765,longitude:19.94198765432109},{id:"17",latitude:50.05643210987654,longitude:19.93912345678901},{id:"18",latitude:50.05321098765432,longitude:19.9380123456789},{id:"19",latitude:50.05210987654321,longitude:19.93765432109876},{id:"20",latitude:50.05198765432109,longitude:19.93654321098765},{id:"21",latitude:50.05123456789012,longitude:19.93712345678901},{id:"22",latitude:50.05234567890123,longitude:19.94123456789012},{id:"23",latitude:50.05345678901234,longitude:19.94234567890123},{id:"24",latitude:50.05456789012345,longitude:19.93845678901234},{id:"25",latitude:50.05567890123456,longitude:19.93956789012345},{id:"26",latitude:50.05678901234567,longitude:19.94067890123456},{id:"27",latitude:50.05789012345678,longitude:19.93578901234567},{id:"28",latitude:50.05890123456789,longitude:19.93689012345678},{id:"29",latitude:50.0590123456789,longitude:19.94112345678901},{id:"30",latitude:50.05112345678901,longitude:19.94323456789012},{id:"31",latitude:50.05223456789012,longitude:19.93734567890123},{id:"32",latitude:50.05334567890123,longitude:19.94245678901234},{id:"33",latitude:50.05445678901234,longitude:19.93856789012345},{id:"34",latitude:50.05556789012345,longitude:19.93967890123456},{id:"35",latitude:50.05667890123456,longitude:19.94078901234567},{id:"36",latitude:50.05778901234567,longitude:19.93589012345678},{id:"37",latitude:50.05889012345678,longitude:19.93690123456789},{id:"38",latitude:50.05990123456789,longitude:19.9410123456789},{id:"39",latitude:50.0510123456789,longitude:19.94312345678901},{id:"40",latitude:50.05212345678901,longitude:19.93723456789012},{id:"41",latitude:50.05323456789012,longitude:19.94234567890123},{id:"42",latitude:50.05434567890123,longitude:19.93845678901234},{id:"43",latitude:50.05545678901234,longitude:19.93956789012345},{id:"44",latitude:50.05656789012345,longitude:19.94067890123456},{id:"45",latitude:50.05767890123456,longitude:19.93578901234567},{id:"46",latitude:50.05878901234567,longitude:19.93689012345678},{id:"47",latitude:50.05989012345678,longitude:19.9410123456789},{id:"48",latitude:50.05190123456789,longitude:19.94312345678901},{id:"49",latitude:50.0520123456789,longitude:19.93723456789012},{id:"50",latitude:50.05312345678901,longitude:19.94234567890123}],bF=M9;var P9=o=>({width:o}),wF=(()=>{let n=class n{constructor(){this.batteryLevel=58,this.batteryCondition=Cp.Medium}ngOnInit(){this.batteryCondition=this.calculateBatteryCondition(this.batteryLevel)}calculateBatteryCondition(c){return c>75?Cp.Good:c>50?Cp.Medium:c>25?Cp.Low:Cp.Critical}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-battery-level"]],inputs:{batteryLevel:"batteryLevel"},standalone:!0,features:[bi],decls:6,vars:5,consts:[[1,"battery-label"],[1,"battery-container"],[1,"battery-level",3,"ngStyle"]],template:function(f,i){f&1&&(nn(0,"div",0),xi(1,"Battery Level"),en(),nn(2,"div",1)(3,"div",2),xi(4),en(),xi(5),en()),f&2&&(Xn(3),vi("ngStyle",cC(3,P9,i.batteryLevel+"%")),Xn(),Uo(" ",i.batteryLevel,"%"),Xn(),Uo(" ",i.batteryCondition,`
`))},dependencies:[Wi,fL],styles:[".battery-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#c2baba;border-radius:25px;display:flex;align-items:center;padding-right:10px;justify-content:space-between}.battery-container[_ngcontent-%COMP%]   .battery-level[_ngcontent-%COMP%]{height:inherit;display:flex;align-items:center;justify-content:center;border-radius:25px;background-color:#ecc6ef}.battery-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}"]});let o=n;return o})(),Cp=function(o){return o.Good="GOOD",o.Medium="MEDIUM",o.Low="LOW",o.Critical="CRITICAL",o}(Cp||{});function R9(o,n){if(o&1&&(nn(0,"div",11),xi(1),en()),o&2){let l=n.$implicit;aC("ngClass",l.alarmLevel),Xn(),Uo(" ",l.alarmCount," ")}}var yS=(()=>{let n=class n{constructor(){this.showSensorDetails=!1,this.sensorId="Sensor #471",this.responsible="Deratex Polska",this.alarmsData=[{alarmLevel:"critical",alarmCount:3},{alarmLevel:"high",alarmCount:1},{alarmLevel:"low",alarmCount:2}],this.batteryLevel=78,this.location={street:"ul. Malborska",building:"85",city:"Krak\xF3w",additionalInfo:"2 pi\u0119tro, zaraz za winklem"},this.hideDetails=new Pr}emitHideDetails(){this.hideDetails.emit(!0)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-sensor-details"]],inputs:{showSensorDetails:"showSensorDetails",sensorId:"sensorId",responsible:"responsible",alarmsData:"alarmsData",batteryLevel:"batteryLevel",location:"location"},outputs:{hideDetails:"hideDetails"},standalone:!0,features:[bi],decls:17,vars:7,consts:[[1,"close",3,"click"],[1,"overlay-container"],[1,"sensor-container"],[1,"responsible-label"],[1,"responsible-container"],[1,"alarms-label"],[1,"alarms-container"],["class","alarm",3,"ngClass",4,"ngFor","ngForOf"],[3,"batteryLevel"],[1,"localization-label"],[1,"localization-container"],[1,"alarm",3,"ngClass"]],template:function(f,i){f&1&&(nn(0,"a",0),Oi("click",function(){return i.emitHideDetails()}),en(),nn(1,"div",1)(2,"div",2),xi(3),en(),nn(4,"div",3),xi(5,"Responsible"),en(),nn(6,"div",4),xi(7),en(),nn(8,"div",5),xi(9,"Alarms"),en(),nn(10,"div",6),ao(11,R9,2,2,"div",7),en(),si(12,"app-battery-level",8),nn(13,"div",9),xi(14,"Localization"),en(),nn(15,"div",10),xi(16),en()()),f&2&&(Xn(3),Uo(" ",i.sensorId," "),Xn(4),Uo(" ",i.responsible," "),Xn(4),vi("ngForOf",i.alarmsData),Xn(),vi("batteryLevel",i.batteryLevel),Xn(4),lC(" ",i.location.street," ",i.location.building,", ",i.location.city," "))},dependencies:[Wi,fp,pp,wF],styles:['.overlay-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:60%;height:100%;z-index:100;background-color:#fff;opacity:.9;padding-left:20%;padding-right:20%;text-wrap:nowrap;display:flex;flex-direction:column;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif;transition:all .5s}.overlay-container[_ngcontent-%COMP%]   .sensor-container[_ngcontent-%COMP%]{width:100%;margin-top:10vh;font-size:150%}.overlay-container[_ngcontent-%COMP%]   .responsible-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:10vh}.overlay-container[_ngcontent-%COMP%]   .responsible-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.overlay-container[_ngcontent-%COMP%]   .alarms-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:30px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:20px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]   .alarm[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:40px;border-radius:50%}.overlay-container[_ngcontent-%COMP%]   .localization-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}.overlay-container[_ngcontent-%COMP%]   .localization-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.critical[_ngcontent-%COMP%]{background-color:#ecc6ef}.high[_ngcontent-%COMP%]{background-color:#ffeb82}.low[_ngcontent-%COMP%]{background-color:#eaebed}.close[_ngcontent-%COMP%]{position:absolute;z-index:105;right:32px;top:20px;width:20px;height:20px;scale:.7}.close[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}.close[_ngcontent-%COMP%]:before, .close[_ngcontent-%COMP%]:after{z-index:105;position:absolute;left:15px;content:" ";height:33px;width:2px;background-color:#333}.close[_ngcontent-%COMP%]:before{transform:rotate(45deg)}.close[_ngcontent-%COMP%]:after{transform:rotate(-45deg)}']});let o=n;return o})();var vS=(()=>{let n=class n{constructor(){this.url="http://localhost:3000/places"}getAllLocations(){return Mg(this,null,function*(){let f=yield(yield fetch(this.url)).text();return JSON.parse(f)??[]})}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Qh=class extends Map{constructor(n,l=L9){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:l}}),n!=null)for(let[c,f]of n)this.set(c,f)}get(n){return super.get(EF(this,n))}has(n){return super.has(EF(this,n))}set(n,l){return super.set(k9(this,n),l)}delete(n){return super.delete(O9(this,n))}};function EF({_intern:o,_key:n},l){let c=n(l);return o.has(c)?o.get(c):l}function k9({_intern:o,_key:n},l){let c=n(l);return o.has(c)?o.get(c):(o.set(c,l),l)}function O9({_intern:o,_key:n},l){let c=n(l);return o.has(c)&&(l=o.get(c),o.delete(c)),l}function L9(o){return o!==null&&typeof o=="object"?o.valueOf():o}function xb(o){return o}function bb(o,...n){return F9(o,xb,xb,n)}function F9(o,n,l,c){return function f(i,w){if(w>=c.length)return l(i);let C=new Qh,A=c[w++],L=-1;for(let U of i){let Q=A(U,++L,i),fe=C.get(Q);fe?fe.push(U):C.set(Q,[U])}for(let[U,Q]of C)C.set(U,f(Q,w));return n(C)}(o,0)}var N9={value:()=>{}};function CF(){for(var o=0,n=arguments.length,l={},c;o<n;++o){if(!(c=arguments[o]+"")||c in l||/[\s.]/.test(c))throw new Error("illegal type: "+c);l[c]=[]}return new wb(l)}function wb(o){this._=o}function z9(o,n){return o.trim().split(/^|\s+/).map(function(l){var c="",f=l.indexOf(".");if(f>=0&&(c=l.slice(f+1),l=l.slice(0,f)),l&&!n.hasOwnProperty(l))throw new Error("unknown type: "+l);return{type:l,name:c}})}wb.prototype=CF.prototype={constructor:wb,on:function(o,n){var l=this._,c=z9(o+"",l),f,i=-1,w=c.length;if(arguments.length<2){for(;++i<w;)if((f=(o=c[i]).type)&&(f=B9(l[f],o.name)))return f;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++i<w;)if(f=(o=c[i]).type)l[f]=IF(l[f],o.name,n);else if(n==null)for(f in l)l[f]=IF(l[f],o.name,null);return this},copy:function(){var o={},n=this._;for(var l in n)o[l]=n[l].slice();return new wb(o)},call:function(o,n){if((f=arguments.length-2)>0)for(var l=new Array(f),c=0,f,i;c<f;++c)l[c]=arguments[c+2];if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(i=this._[o],c=0,f=i.length;c<f;++c)i[c].value.apply(n,l)},apply:function(o,n,l){if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(var c=this._[o],f=0,i=c.length;f<i;++f)c[f].value.apply(n,l)}};function B9(o,n){for(var l=0,c=o.length,f;l<c;++l)if((f=o[l]).name===n)return f.value}function IF(o,n,l){for(var c=0,f=o.length;c<f;++c)if(o[c].name===n){o[c]=N9,o=o.slice(0,c).concat(o.slice(c+1));break}return l!=null&&o.push({name:n,value:l}),o}var Jh=CF;var Tb="http://www.w3.org/1999/xhtml",xS={svg:"http://www.w3.org/2000/svg",xhtml:Tb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Tl(o){var n=o+="",l=n.indexOf(":");return l>=0&&(n=o.slice(0,l))!=="xmlns"&&(o=o.slice(l+1)),xS.hasOwnProperty(n)?{space:xS[n],local:o}:o}function V9(o){return function(){var n=this.ownerDocument,l=this.namespaceURI;return l===Tb&&n.documentElement.namespaceURI===Tb?n.createElement(o):n.createElementNS(l,o)}}function j9(o){return function(){return this.ownerDocument.createElementNS(o.space,o.local)}}function Eb(o){var n=Tl(o);return(n.local?j9:V9)(n)}function U9(){}function ed(o){return o==null?U9:function(){return this.querySelector(o)}}function SF(o){typeof o!="function"&&(o=ed(o));for(var n=this._groups,l=n.length,c=new Array(l),f=0;f<l;++f)for(var i=n[f],w=i.length,C=c[f]=new Array(w),A,L,U=0;U<w;++U)(A=i[U])&&(L=o.call(A,A.__data__,U,i))&&("__data__"in A&&(L.__data__=A.__data__),C[U]=L);return new Xi(c,this._parents)}function bS(o){return o==null?[]:Array.isArray(o)?o:Array.from(o)}function $9(){return[]}function O_(o){return o==null?$9:function(){return this.querySelectorAll(o)}}function G9(o){return function(){return bS(o.apply(this,arguments))}}function DF(o){typeof o=="function"?o=G9(o):o=O_(o);for(var n=this._groups,l=n.length,c=[],f=[],i=0;i<l;++i)for(var w=n[i],C=w.length,A,L=0;L<C;++L)(A=w[L])&&(c.push(o.call(A,A.__data__,L,w)),f.push(A));return new Xi(c,f)}function L_(o){return function(){return this.matches(o)}}function Ib(o){return function(n){return n.matches(o)}}var H9=Array.prototype.find;function q9(o){return function(){return H9.call(this.children,o)}}function W9(){return this.firstElementChild}function MF(o){return this.select(o==null?W9:q9(typeof o=="function"?o:Ib(o)))}var Z9=Array.prototype.filter;function Y9(){return Array.from(this.children)}function X9(o){return function(){return Z9.call(this.children,o)}}function AF(o){return this.selectAll(o==null?Y9:X9(typeof o=="function"?o:Ib(o)))}function PF(o){typeof o!="function"&&(o=L_(o));for(var n=this._groups,l=n.length,c=new Array(l),f=0;f<l;++f)for(var i=n[f],w=i.length,C=c[f]=[],A,L=0;L<w;++L)(A=i[L])&&o.call(A,A.__data__,L,i)&&C.push(A);return new Xi(c,this._parents)}function Cb(o){return new Array(o.length)}function RF(){return new Xi(this._enter||this._groups.map(Cb),this._parents)}function F_(o,n){this.ownerDocument=o.ownerDocument,this.namespaceURI=o.namespaceURI,this._next=null,this._parent=o,this.__data__=n}F_.prototype={constructor:F_,appendChild:function(o){return this._parent.insertBefore(o,this._next)},insertBefore:function(o,n){return this._parent.insertBefore(o,n)},querySelector:function(o){return this._parent.querySelector(o)},querySelectorAll:function(o){return this._parent.querySelectorAll(o)}};function kF(o){return function(){return o}}function K9(o,n,l,c,f,i){for(var w=0,C,A=n.length,L=i.length;w<L;++w)(C=n[w])?(C.__data__=i[w],c[w]=C):l[w]=new F_(o,i[w]);for(;w<A;++w)(C=n[w])&&(f[w]=C)}function Q9(o,n,l,c,f,i,w){var C,A,L=new Map,U=n.length,Q=i.length,fe=new Array(U),he;for(C=0;C<U;++C)(A=n[C])&&(fe[C]=he=w.call(A,A.__data__,C,n)+"",L.has(he)?f[C]=A:L.set(he,A));for(C=0;C<Q;++C)he=w.call(o,i[C],C,i)+"",(A=L.get(he))?(c[C]=A,A.__data__=i[C],L.delete(he)):l[C]=new F_(o,i[C]);for(C=0;C<U;++C)(A=n[C])&&L.get(fe[C])===A&&(f[C]=A)}function J9(o){return o.__data__}function OF(o,n){if(!arguments.length)return Array.from(this,J9);var l=n?Q9:K9,c=this._parents,f=this._groups;typeof o!="function"&&(o=kF(o));for(var i=f.length,w=new Array(i),C=new Array(i),A=new Array(i),L=0;L<i;++L){var U=c[L],Q=f[L],fe=Q.length,he=e7(o.call(U,U&&U.__data__,L,c)),be=he.length,Se=C[L]=new Array(be),Ke=w[L]=new Array(be),Fe=A[L]=new Array(fe);l(U,Q,Se,Ke,Fe,he,n);for(var tt=0,ft=0,Ue,zt;tt<be;++tt)if(Ue=Se[tt]){for(tt>=ft&&(ft=tt+1);!(zt=Ke[ft])&&++ft<be;);Ue._next=zt||null}}return w=new Xi(w,c),w._enter=C,w._exit=A,w}function e7(o){return typeof o=="object"&&"length"in o?o:Array.from(o)}function LF(){return new Xi(this._exit||this._groups.map(Cb),this._parents)}function FF(o,n,l){var c=this.enter(),f=this,i=this.exit();return typeof o=="function"?(c=o(c),c&&(c=c.selection())):c=c.append(o+""),n!=null&&(f=n(f),f&&(f=f.selection())),l==null?i.remove():l(i),c&&f?c.merge(f).order():f}function NF(o){for(var n=o.selection?o.selection():o,l=this._groups,c=n._groups,f=l.length,i=c.length,w=Math.min(f,i),C=new Array(f),A=0;A<w;++A)for(var L=l[A],U=c[A],Q=L.length,fe=C[A]=new Array(Q),he,be=0;be<Q;++be)(he=L[be]||U[be])&&(fe[be]=he);for(;A<f;++A)C[A]=l[A];return new Xi(C,this._parents)}function zF(){for(var o=this._groups,n=-1,l=o.length;++n<l;)for(var c=o[n],f=c.length-1,i=c[f],w;--f>=0;)(w=c[f])&&(i&&w.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(w,i),i=w);return this}function BF(o){o||(o=t7);function n(Q,fe){return Q&&fe?o(Q.__data__,fe.__data__):!Q-!fe}for(var l=this._groups,c=l.length,f=new Array(c),i=0;i<c;++i){for(var w=l[i],C=w.length,A=f[i]=new Array(C),L,U=0;U<C;++U)(L=w[U])&&(A[U]=L);A.sort(n)}return new Xi(f,this._parents).order()}function t7(o,n){return o<n?-1:o>n?1:o>=n?0:NaN}function VF(){var o=arguments[0];return arguments[0]=this,o.apply(null,arguments),this}function jF(){return Array.from(this)}function UF(){for(var o=this._groups,n=0,l=o.length;n<l;++n)for(var c=o[n],f=0,i=c.length;f<i;++f){var w=c[f];if(w)return w}return null}function $F(){let o=0;for(let n of this)++o;return o}function GF(){return!this.node()}function HF(o){for(var n=this._groups,l=0,c=n.length;l<c;++l)for(var f=n[l],i=0,w=f.length,C;i<w;++i)(C=f[i])&&o.call(C,C.__data__,i,f);return this}function n7(o){return function(){this.removeAttribute(o)}}function i7(o){return function(){this.removeAttributeNS(o.space,o.local)}}function r7(o,n){return function(){this.setAttribute(o,n)}}function o7(o,n){return function(){this.setAttributeNS(o.space,o.local,n)}}function s7(o,n){return function(){var l=n.apply(this,arguments);l==null?this.removeAttribute(o):this.setAttribute(o,l)}}function a7(o,n){return function(){var l=n.apply(this,arguments);l==null?this.removeAttributeNS(o.space,o.local):this.setAttributeNS(o.space,o.local,l)}}function qF(o,n){var l=Tl(o);if(arguments.length<2){var c=this.node();return l.local?c.getAttributeNS(l.space,l.local):c.getAttribute(l)}return this.each((n==null?l.local?i7:n7:typeof n=="function"?l.local?a7:s7:l.local?o7:r7)(l,n))}function Sb(o){return o.ownerDocument&&o.ownerDocument.defaultView||o.document&&o||o.defaultView}function l7(o){return function(){this.style.removeProperty(o)}}function c7(o,n,l){return function(){this.style.setProperty(o,n,l)}}function u7(o,n,l){return function(){var c=n.apply(this,arguments);c==null?this.style.removeProperty(o):this.style.setProperty(o,c,l)}}function WF(o,n,l){return arguments.length>1?this.each((n==null?l7:typeof n=="function"?u7:c7)(o,n,l??"")):au(this.node(),o)}function au(o,n){return o.style.getPropertyValue(n)||Sb(o).getComputedStyle(o,null).getPropertyValue(n)}function h7(o){return function(){delete this[o]}}function d7(o,n){return function(){this[o]=n}}function f7(o,n){return function(){var l=n.apply(this,arguments);l==null?delete this[o]:this[o]=l}}function ZF(o,n){return arguments.length>1?this.each((n==null?h7:typeof n=="function"?f7:d7)(o,n)):this.node()[o]}function YF(o){return o.trim().split(/^|\s+/)}function wS(o){return o.classList||new XF(o)}function XF(o){this._node=o,this._names=YF(o.getAttribute("class")||"")}XF.prototype={add:function(o){var n=this._names.indexOf(o);n<0&&(this._names.push(o),this._node.setAttribute("class",this._names.join(" ")))},remove:function(o){var n=this._names.indexOf(o);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(o){return this._names.indexOf(o)>=0}};function KF(o,n){for(var l=wS(o),c=-1,f=n.length;++c<f;)l.add(n[c])}function QF(o,n){for(var l=wS(o),c=-1,f=n.length;++c<f;)l.remove(n[c])}function p7(o){return function(){KF(this,o)}}function m7(o){return function(){QF(this,o)}}function g7(o,n){return function(){(n.apply(this,arguments)?KF:QF)(this,o)}}function JF(o,n){var l=YF(o+"");if(arguments.length<2){for(var c=wS(this.node()),f=-1,i=l.length;++f<i;)if(!c.contains(l[f]))return!1;return!0}return this.each((typeof n=="function"?g7:n?p7:m7)(l,n))}function _7(){this.textContent=""}function y7(o){return function(){this.textContent=o}}function v7(o){return function(){var n=o.apply(this,arguments);this.textContent=n??""}}function eN(o){return arguments.length?this.each(o==null?_7:(typeof o=="function"?v7:y7)(o)):this.node().textContent}function x7(){this.innerHTML=""}function b7(o){return function(){this.innerHTML=o}}function w7(o){return function(){var n=o.apply(this,arguments);this.innerHTML=n??""}}function tN(o){return arguments.length?this.each(o==null?x7:(typeof o=="function"?w7:b7)(o)):this.node().innerHTML}function T7(){this.nextSibling&&this.parentNode.appendChild(this)}function nN(){return this.each(T7)}function E7(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function iN(){return this.each(E7)}function rN(o){var n=typeof o=="function"?o:Eb(o);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function I7(){return null}function oN(o,n){var l=typeof o=="function"?o:Eb(o),c=n==null?I7:typeof n=="function"?n:ed(n);return this.select(function(){return this.insertBefore(l.apply(this,arguments),c.apply(this,arguments)||null)})}function C7(){var o=this.parentNode;o&&o.removeChild(this)}function sN(){return this.each(C7)}function S7(){var o=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(o,this.nextSibling):o}function D7(){var o=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(o,this.nextSibling):o}function aN(o){return this.select(o?D7:S7)}function lN(o){return arguments.length?this.property("__data__",o):this.node().__data__}function M7(o){return function(n){o.call(this,n,this.__data__)}}function A7(o){return o.trim().split(/^|\s+/).map(function(n){var l="",c=n.indexOf(".");return c>=0&&(l=n.slice(c+1),n=n.slice(0,c)),{type:n,name:l}})}function P7(o){return function(){var n=this.__on;if(n){for(var l=0,c=-1,f=n.length,i;l<f;++l)i=n[l],(!o.type||i.type===o.type)&&i.name===o.name?this.removeEventListener(i.type,i.listener,i.options):n[++c]=i;++c?n.length=c:delete this.__on}}}function R7(o,n,l){return function(){var c=this.__on,f,i=M7(n);if(c){for(var w=0,C=c.length;w<C;++w)if((f=c[w]).type===o.type&&f.name===o.name){this.removeEventListener(f.type,f.listener,f.options),this.addEventListener(f.type,f.listener=i,f.options=l),f.value=n;return}}this.addEventListener(o.type,i,l),f={type:o.type,name:o.name,value:n,listener:i,options:l},c?c.push(f):this.__on=[f]}}function cN(o,n,l){var c=A7(o+""),f,i=c.length,w;if(arguments.length<2){var C=this.node().__on;if(C){for(var A=0,L=C.length,U;A<L;++A)for(f=0,U=C[A];f<i;++f)if((w=c[f]).type===U.type&&w.name===U.name)return U.value}return}for(C=n?R7:P7,f=0;f<i;++f)this.each(C(c[f],n,l));return this}function uN(o,n,l){var c=Sb(o),f=c.CustomEvent;typeof f=="function"?f=new f(n,l):(f=c.document.createEvent("Event"),l?(f.initEvent(n,l.bubbles,l.cancelable),f.detail=l.detail):f.initEvent(n,!1,!1)),o.dispatchEvent(f)}function k7(o,n){return function(){return uN(this,o,n)}}function O7(o,n){return function(){return uN(this,o,n.apply(this,arguments))}}function hN(o,n){return this.each((typeof n=="function"?O7:k7)(o,n))}function*dN(){for(var o=this._groups,n=0,l=o.length;n<l;++n)for(var c=o[n],f=0,i=c.length,w;f<i;++f)(w=c[f])&&(yield w)}var TS=[null];function Xi(o,n){this._groups=o,this._parents=n}function fN(){return new Xi([[document.documentElement]],TS)}function L7(){return this}Xi.prototype=fN.prototype={constructor:Xi,select:SF,selectAll:DF,selectChild:MF,selectChildren:AF,filter:PF,data:OF,enter:RF,exit:LF,join:FF,merge:NF,selection:L7,order:zF,sort:BF,call:VF,nodes:jF,node:UF,size:$F,empty:GF,each:HF,attr:qF,style:WF,property:ZF,classed:JF,text:eN,html:tN,raise:nN,lower:iN,append:rN,insert:oN,remove:sN,clone:aN,datum:lN,on:cN,dispatch:hN,[Symbol.iterator]:dN};var El=fN;function lo(o){return typeof o=="string"?new Xi([[document.querySelector(o)]],[document.documentElement]):new Xi([[o]],TS)}function pN(o){let n;for(;n=o.sourceEvent;)o=n;return o}function Db(o,n){if(o=pN(o),n===void 0&&(n=o.currentTarget),n){var l=n.ownerSVGElement||n;if(l.createSVGPoint){var c=l.createSVGPoint();return c.x=o.clientX,c.y=o.clientY,c=c.matrixTransform(n.getScreenCTM().inverse()),[c.x,c.y]}if(n.getBoundingClientRect){var f=n.getBoundingClientRect();return[o.clientX-f.left-n.clientLeft,o.clientY-f.top-n.clientTop]}}return[o.pageX,o.pageY]}var mN={passive:!1},td={capture:!0,passive:!1};function Mb(o){o.stopImmediatePropagation()}function lu(o){o.preventDefault(),o.stopImmediatePropagation()}function gN(o){var n=o.document.documentElement,l=lo(o).on("dragstart.drag",lu,td);"onselectstart"in n?l.on("selectstart.drag",lu,td):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function _N(o,n){var l=o.document.documentElement,c=lo(o).on("dragstart.drag",null);n&&(c.on("click.drag",lu,td),setTimeout(function(){c.on("click.drag",null)},0)),"onselectstart"in l?c.on("selectstart.drag",null):(l.style.MozUserSelect=l.__noselect,delete l.__noselect)}var N_=o=>()=>o;function z_(o,{sourceEvent:n,subject:l,target:c,identifier:f,active:i,x:w,y:C,dx:A,dy:L,dispatch:U}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:l,enumerable:!0,configurable:!0},target:{value:c,enumerable:!0,configurable:!0},identifier:{value:f,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:w,enumerable:!0,configurable:!0},y:{value:C,enumerable:!0,configurable:!0},dx:{value:A,enumerable:!0,configurable:!0},dy:{value:L,enumerable:!0,configurable:!0},_:{value:U}})}z_.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function F7(o){return!o.ctrlKey&&!o.button}function N7(){return this.parentNode}function z7(o,n){return n??{x:o.x,y:o.y}}function B7(){return navigator.maxTouchPoints||"ontouchstart"in this}function B_(){var o=F7,n=N7,l=z7,c=B7,f={},i=Jh("start","drag","end"),w=0,C,A,L,U,Q=0;function fe(Ue){Ue.on("mousedown.drag",he).filter(c).on("touchstart.drag",Ke).on("touchmove.drag",Fe,mN).on("touchend.drag touchcancel.drag",tt).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function he(Ue,zt){if(!(U||!o.call(this,Ue,zt))){var Kt=ft(this,n.call(this,Ue,zt),Ue,zt,"mouse");Kt&&(lo(Ue.view).on("mousemove.drag",be,td).on("mouseup.drag",Se,td),gN(Ue.view),Mb(Ue),L=!1,C=Ue.clientX,A=Ue.clientY,Kt("start",Ue))}}function be(Ue){if(lu(Ue),!L){var zt=Ue.clientX-C,Kt=Ue.clientY-A;L=zt*zt+Kt*Kt>Q}f.mouse("drag",Ue)}function Se(Ue){lo(Ue.view).on("mousemove.drag mouseup.drag",null),_N(Ue.view,L),lu(Ue),f.mouse("end",Ue)}function Ke(Ue,zt){if(o.call(this,Ue,zt)){var Kt=Ue.changedTouches,tn=n.call(this,Ue,zt),Tt=Kt.length,ri,Ct;for(ri=0;ri<Tt;++ri)(Ct=ft(this,tn,Ue,zt,Kt[ri].identifier,Kt[ri]))&&(Mb(Ue),Ct("start",Ue,Kt[ri]))}}function Fe(Ue){var zt=Ue.changedTouches,Kt=zt.length,tn,Tt;for(tn=0;tn<Kt;++tn)(Tt=f[zt[tn].identifier])&&(lu(Ue),Tt("drag",Ue,zt[tn]))}function tt(Ue){var zt=Ue.changedTouches,Kt=zt.length,tn,Tt;for(U&&clearTimeout(U),U=setTimeout(function(){U=null},500),tn=0;tn<Kt;++tn)(Tt=f[zt[tn].identifier])&&(Mb(Ue),Tt("end",Ue,zt[tn]))}function ft(Ue,zt,Kt,tn,Tt,ri){var Ct=i.copy(),Ti=Db(ri||Kt,zt),Ci,$i,wn;if((wn=l.call(Ue,new z_("beforestart",{sourceEvent:Kt,target:fe,identifier:Tt,active:w,x:Ti[0],y:Ti[1],dx:0,dy:0,dispatch:Ct}),tn))!=null)return Ci=wn.x-Ti[0]||0,$i=wn.y-Ti[1]||0,function Wo(wt,Bt,qt){var vn=Ti,Lt;switch(wt){case"start":f[Tt]=Wo,Lt=w++;break;case"end":delete f[Tt],--w;case"drag":Ti=Db(qt||Bt,zt),Lt=w;break}Ct.call(wt,Ue,new z_(wt,{sourceEvent:Bt,subject:wn,target:fe,identifier:Tt,active:Lt,x:Ti[0]+Ci,y:Ti[1]+$i,dx:Ti[0]-vn[0],dy:Ti[1]-vn[1],dispatch:Ct}),tn)}}return fe.filter=function(Ue){return arguments.length?(o=typeof Ue=="function"?Ue:N_(!!Ue),fe):o},fe.container=function(Ue){return arguments.length?(n=typeof Ue=="function"?Ue:N_(Ue),fe):n},fe.subject=function(Ue){return arguments.length?(l=typeof Ue=="function"?Ue:N_(Ue),fe):l},fe.touchable=function(Ue){return arguments.length?(c=typeof Ue=="function"?Ue:N_(!!Ue),fe):c},fe.on=function(){var Ue=i.on.apply(i,arguments);return Ue===i?fe:Ue},fe.clickDistance=function(Ue){return arguments.length?(Q=(Ue=+Ue)*Ue,fe):Math.sqrt(Q)},fe}function Ab(o,n,l){o.prototype=n.prototype=l,l.constructor=o}function ES(o,n){var l=Object.create(o.prototype);for(var c in n)l[c]=n[c];return l}function U_(){}var V_=.7,kb=1/V_,Sp="\\s*([+-]?\\d+)\\s*",j_="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ra="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",V7=/^#([0-9a-f]{3,8})$/,j7=new RegExp(`^rgb\\(${Sp},${Sp},${Sp}\\)$`),U7=new RegExp(`^rgb\\(${Ra},${Ra},${Ra}\\)$`),$7=new RegExp(`^rgba\\(${Sp},${Sp},${Sp},${j_}\\)$`),G7=new RegExp(`^rgba\\(${Ra},${Ra},${Ra},${j_}\\)$`),H7=new RegExp(`^hsl\\(${j_},${Ra},${Ra}\\)$`),q7=new RegExp(`^hsla\\(${j_},${Ra},${Ra},${j_}\\)$`),yN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ab(U_,cu,{copy(o){return Object.assign(new this.constructor,this,o)},displayable(){return this.rgb().displayable()},hex:vN,formatHex:vN,formatHex8:W7,formatHsl:Z7,formatRgb:xN,toString:xN});function vN(){return this.rgb().formatHex()}function W7(){return this.rgb().formatHex8()}function Z7(){return CN(this).formatHsl()}function xN(){return this.rgb().formatRgb()}function cu(o){var n,l;return o=(o+"").trim().toLowerCase(),(n=V7.exec(o))?(l=n[1].length,n=parseInt(n[1],16),l===6?bN(n):l===3?new Co(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):l===8?Pb(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):l===4?Pb(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=j7.exec(o))?new Co(n[1],n[2],n[3],1):(n=U7.exec(o))?new Co(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=$7.exec(o))?Pb(n[1],n[2],n[3],n[4]):(n=G7.exec(o))?Pb(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=H7.exec(o))?EN(n[1],n[2]/100,n[3]/100,1):(n=q7.exec(o))?EN(n[1],n[2]/100,n[3]/100,n[4]):yN.hasOwnProperty(o)?bN(yN[o]):o==="transparent"?new Co(NaN,NaN,NaN,0):null}function bN(o){return new Co(o>>16&255,o>>8&255,o&255,1)}function Pb(o,n,l,c){return c<=0&&(o=n=l=NaN),new Co(o,n,l,c)}function Y7(o){return o instanceof U_||(o=cu(o)),o?(o=o.rgb(),new Co(o.r,o.g,o.b,o.opacity)):new Co}function Dp(o,n,l,c){return arguments.length===1?Y7(o):new Co(o,n,l,c??1)}function Co(o,n,l,c){this.r=+o,this.g=+n,this.b=+l,this.opacity=+c}Ab(Co,Dp,ES(U_,{brighter(o){return o=o==null?kb:Math.pow(kb,o),new Co(this.r*o,this.g*o,this.b*o,this.opacity)},darker(o){return o=o==null?V_:Math.pow(V_,o),new Co(this.r*o,this.g*o,this.b*o,this.opacity)},rgb(){return this},clamp(){return new Co(id(this.r),id(this.g),id(this.b),Ob(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wN,formatHex:wN,formatHex8:X7,formatRgb:TN,toString:TN}));function wN(){return`#${nd(this.r)}${nd(this.g)}${nd(this.b)}`}function X7(){return`#${nd(this.r)}${nd(this.g)}${nd(this.b)}${nd((isNaN(this.opacity)?1:this.opacity)*255)}`}function TN(){let o=Ob(this.opacity);return`${o===1?"rgb(":"rgba("}${id(this.r)}, ${id(this.g)}, ${id(this.b)}${o===1?")":`, ${o})`}`}function Ob(o){return isNaN(o)?1:Math.max(0,Math.min(1,o))}function id(o){return Math.max(0,Math.min(255,Math.round(o)||0))}function nd(o){return o=id(o),(o<16?"0":"")+o.toString(16)}function EN(o,n,l,c){return c<=0?o=n=l=NaN:l<=0||l>=1?o=n=NaN:n<=0&&(o=NaN),new Zs(o,n,l,c)}function CN(o){if(o instanceof Zs)return new Zs(o.h,o.s,o.l,o.opacity);if(o instanceof U_||(o=cu(o)),!o)return new Zs;if(o instanceof Zs)return o;o=o.rgb();var n=o.r/255,l=o.g/255,c=o.b/255,f=Math.min(n,l,c),i=Math.max(n,l,c),w=NaN,C=i-f,A=(i+f)/2;return C?(n===i?w=(l-c)/C+(l<c)*6:l===i?w=(c-n)/C+2:w=(n-l)/C+4,C/=A<.5?i+f:2-i-f,w*=60):C=A>0&&A<1?0:w,new Zs(w,C,A,o.opacity)}function SN(o,n,l,c){return arguments.length===1?CN(o):new Zs(o,n,l,c??1)}function Zs(o,n,l,c){this.h=+o,this.s=+n,this.l=+l,this.opacity=+c}Ab(Zs,SN,ES(U_,{brighter(o){return o=o==null?kb:Math.pow(kb,o),new Zs(this.h,this.s,this.l*o,this.opacity)},darker(o){return o=o==null?V_:Math.pow(V_,o),new Zs(this.h,this.s,this.l*o,this.opacity)},rgb(){var o=this.h%360+(this.h<0)*360,n=isNaN(o)||isNaN(this.s)?0:this.s,l=this.l,c=l+(l<.5?l:1-l)*n,f=2*l-c;return new Co(IS(o>=240?o-240:o+120,f,c),IS(o,f,c),IS(o<120?o+240:o-120,f,c),this.opacity)},clamp(){return new Zs(IN(this.h),Rb(this.s),Rb(this.l),Ob(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let o=Ob(this.opacity);return`${o===1?"hsl(":"hsla("}${IN(this.h)}, ${Rb(this.s)*100}%, ${Rb(this.l)*100}%${o===1?")":`, ${o})`}`}}));function IN(o){return o=(o||0)%360,o<0?o+360:o}function Rb(o){return Math.max(0,Math.min(1,o||0))}function IS(o,n,l){return(o<60?n+(l-n)*o/60:o<180?l:o<240?n+(l-n)*(240-o)/60:n)*255}function CS(o,n,l,c,f){var i=o*o,w=i*o;return((1-3*o+3*i-w)*n+(4-6*i+3*w)*l+(1+3*o+3*i-3*w)*c+w*f)/6}function DN(o){var n=o.length-1;return function(l){var c=l<=0?l=0:l>=1?(l=1,n-1):Math.floor(l*n),f=o[c],i=o[c+1],w=c>0?o[c-1]:2*f-i,C=c<n-1?o[c+2]:2*i-f;return CS((l-c/n)*n,w,f,i,C)}}function MN(o){var n=o.length;return function(l){var c=Math.floor(((l%=1)<0?++l:l)*n),f=o[(c+n-1)%n],i=o[c%n],w=o[(c+1)%n],C=o[(c+2)%n];return CS((l-c/n)*n,f,i,w,C)}}var SS=o=>()=>o;function K7(o,n){return function(l){return o+l*n}}function Q7(o,n,l){return o=Math.pow(o,l),n=Math.pow(n,l)-o,l=1/l,function(c){return Math.pow(o+c*n,l)}}function AN(o){return(o=+o)==1?Lb:function(n,l){return l-n?Q7(n,l,o):SS(isNaN(n)?l:n)}}function Lb(o,n){var l=n-o;return l?K7(o,l):SS(isNaN(o)?n:o)}var Fb=function o(n){var l=AN(n);function c(f,i){var w=l((f=Dp(f)).r,(i=Dp(i)).r),C=l(f.g,i.g),A=l(f.b,i.b),L=Lb(f.opacity,i.opacity);return function(U){return f.r=w(U),f.g=C(U),f.b=A(U),f.opacity=L(U),f+""}}return c.gamma=o,c}(1);function PN(o){return function(n){var l=n.length,c=new Array(l),f=new Array(l),i=new Array(l),w,C;for(w=0;w<l;++w)C=Dp(n[w]),c[w]=C.r||0,f[w]=C.g||0,i[w]=C.b||0;return c=o(c),f=o(f),i=o(i),C.opacity=1,function(A){return C.r=c(A),C.g=f(A),C.b=i(A),C+""}}}var J7=PN(DN),eW=PN(MN);function fs(o,n){return o=+o,n=+n,function(l){return o*(1-l)+n*l}}var MS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,DS=new RegExp(MS.source,"g");function tW(o){return function(){return o}}function nW(o){return function(n){return o(n)+""}}function AS(o,n){var l=MS.lastIndex=DS.lastIndex=0,c,f,i,w=-1,C=[],A=[];for(o=o+"",n=n+"";(c=MS.exec(o))&&(f=DS.exec(n));)(i=f.index)>l&&(i=n.slice(l,i),C[w]?C[w]+=i:C[++w]=i),(c=c[0])===(f=f[0])?C[w]?C[w]+=f:C[++w]=f:(C[++w]=null,A.push({i:w,x:fs(c,f)})),l=DS.lastIndex;return l<n.length&&(i=n.slice(l),C[w]?C[w]+=i:C[++w]=i),C.length<2?A[0]?nW(A[0].x):tW(n):(n=A.length,function(L){for(var U=0,Q;U<n;++U)C[(Q=A[U]).i]=Q.x(L);return C.join("")})}var RN=180/Math.PI,Nb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function PS(o,n,l,c,f,i){var w,C,A;return(w=Math.sqrt(o*o+n*n))&&(o/=w,n/=w),(A=o*l+n*c)&&(l-=o*A,c-=n*A),(C=Math.sqrt(l*l+c*c))&&(l/=C,c/=C,A/=C),o*c<n*l&&(o=-o,n=-n,A=-A,w=-w),{translateX:f,translateY:i,rotate:Math.atan2(n,o)*RN,skewX:Math.atan(A)*RN,scaleX:w,scaleY:C}}var zb;function kN(o){let n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(o+"");return n.isIdentity?Nb:PS(n.a,n.b,n.c,n.d,n.e,n.f)}function ON(o){return o==null?Nb:(zb||(zb=document.createElementNS("http://www.w3.org/2000/svg","g")),zb.setAttribute("transform",o),(o=zb.transform.baseVal.consolidate())?(o=o.matrix,PS(o.a,o.b,o.c,o.d,o.e,o.f)):Nb)}function LN(o,n,l,c){function f(L){return L.length?L.pop()+" ":""}function i(L,U,Q,fe,he,be){if(L!==Q||U!==fe){var Se=he.push("translate(",null,n,null,l);be.push({i:Se-4,x:fs(L,Q)},{i:Se-2,x:fs(U,fe)})}else(Q||fe)&&he.push("translate("+Q+n+fe+l)}function w(L,U,Q,fe){L!==U?(L-U>180?U+=360:U-L>180&&(L+=360),fe.push({i:Q.push(f(Q)+"rotate(",null,c)-2,x:fs(L,U)})):U&&Q.push(f(Q)+"rotate("+U+c)}function C(L,U,Q,fe){L!==U?fe.push({i:Q.push(f(Q)+"skewX(",null,c)-2,x:fs(L,U)}):U&&Q.push(f(Q)+"skewX("+U+c)}function A(L,U,Q,fe,he,be){if(L!==Q||U!==fe){var Se=he.push(f(he)+"scale(",null,",",null,")");be.push({i:Se-4,x:fs(L,Q)},{i:Se-2,x:fs(U,fe)})}else(Q!==1||fe!==1)&&he.push(f(he)+"scale("+Q+","+fe+")")}return function(L,U){var Q=[],fe=[];return L=o(L),U=o(U),i(L.translateX,L.translateY,U.translateX,U.translateY,Q,fe),w(L.rotate,U.rotate,Q,fe),C(L.skewX,U.skewX,Q,fe),A(L.scaleX,L.scaleY,U.scaleX,U.scaleY,Q,fe),L=U=null,function(he){for(var be=-1,Se=fe.length,Ke;++be<Se;)Q[(Ke=fe[be]).i]=Ke.x(he);return Q.join("")}}}var RS=LN(kN,"px, ","px)","deg)"),kS=LN(ON,", ",")",")");var Mp=0,G_=0,$_=0,NN=1e3,Bb,H_,Vb=0,rd=0,jb=0,q_=typeof performance=="object"&&performance.now?performance:Date,zN=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(o){setTimeout(o,17)};function Z_(){return rd||(zN(iW),rd=q_.now()+jb)}function iW(){rd=0}function W_(){this._call=this._time=this._next=null}W_.prototype=Ap.prototype={constructor:W_,restart:function(o,n,l){if(typeof o!="function")throw new TypeError("callback is not a function");l=(l==null?Z_():+l)+(n==null?0:+n),!this._next&&H_!==this&&(H_?H_._next=this:Bb=this,H_=this),this._call=o,this._time=l,OS()},stop:function(){this._call&&(this._call=null,this._time=1/0,OS())}};function Ap(o,n,l){var c=new W_;return c.restart(o,n,l),c}function BN(){Z_(),++Mp;for(var o=Bb,n;o;)(n=rd-o._time)>=0&&o._call.call(void 0,n),o=o._next;--Mp}function FN(){rd=(Vb=q_.now())+jb,Mp=G_=0;try{BN()}finally{Mp=0,oW(),rd=0}}function rW(){var o=q_.now(),n=o-Vb;n>NN&&(jb-=n,Vb=o)}function oW(){for(var o,n=Bb,l,c=1/0;n;)n._call?(c>n._time&&(c=n._time),o=n,n=n._next):(l=n._next,n._next=null,n=o?o._next=l:Bb=l);H_=o,OS(c)}function OS(o){if(!Mp){G_&&(G_=clearTimeout(G_));var n=o-rd;n>24?(o<1/0&&(G_=setTimeout(FN,o-q_.now()-jb)),$_&&($_=clearInterval($_))):($_||(Vb=q_.now(),$_=setInterval(rW,NN)),Mp=1,zN(FN))}}function Ub(o,n,l){var c=new W_;return n=n==null?0:+n,c.restart(f=>{c.stop(),o(f+n)},n,l),c}var sW=Jh("start","end","cancel","interrupt"),aW=[],UN=0,VN=1,Gb=2,$b=3,jN=4,Hb=5,Y_=6;function uu(o,n,l,c,f,i){var w=o.__transition;if(!w)o.__transition={};else if(l in w)return;lW(o,l,{name:n,index:c,group:f,on:sW,tween:aW,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:UN})}function X_(o,n){var l=Er(o,n);if(l.state>UN)throw new Error("too late; already scheduled");return l}function Gr(o,n){var l=Er(o,n);if(l.state>$b)throw new Error("too late; already running");return l}function Er(o,n){var l=o.__transition;if(!l||!(l=l[n]))throw new Error("transition not found");return l}function lW(o,n,l){var c=o.__transition,f;c[n]=l,l.timer=Ap(i,0,l.time);function i(L){l.state=VN,l.timer.restart(w,l.delay,l.time),l.delay<=L&&w(L-l.delay)}function w(L){var U,Q,fe,he;if(l.state!==VN)return A();for(U in c)if(he=c[U],he.name===l.name){if(he.state===$b)return Ub(w);he.state===jN?(he.state=Y_,he.timer.stop(),he.on.call("interrupt",o,o.__data__,he.index,he.group),delete c[U]):+U<n&&(he.state=Y_,he.timer.stop(),he.on.call("cancel",o,o.__data__,he.index,he.group),delete c[U])}if(Ub(function(){l.state===$b&&(l.state=jN,l.timer.restart(C,l.delay,l.time),C(L))}),l.state=Gb,l.on.call("start",o,o.__data__,l.index,l.group),l.state===Gb){for(l.state=$b,f=new Array(fe=l.tween.length),U=0,Q=-1;U<fe;++U)(he=l.tween[U].value.call(o,o.__data__,l.index,l.group))&&(f[++Q]=he);f.length=Q+1}}function C(L){for(var U=L<l.duration?l.ease.call(null,L/l.duration):(l.timer.restart(A),l.state=Hb,1),Q=-1,fe=f.length;++Q<fe;)f[Q].call(o,U);l.state===Hb&&(l.on.call("end",o,o.__data__,l.index,l.group),A())}function A(){l.state=Y_,l.timer.stop(),delete c[n];for(var L in c)return;delete o.__transition}}function qb(o,n){var l=o.__transition,c,f,i=!0,w;if(l){n=n==null?null:n+"";for(w in l){if((c=l[w]).name!==n){i=!1;continue}f=c.state>Gb&&c.state<Hb,c.state=Y_,c.timer.stop(),c.on.call(f?"interrupt":"cancel",o,o.__data__,c.index,c.group),delete l[w]}i&&delete o.__transition}}function $N(o){return this.each(function(){qb(this,o)})}function cW(o,n){var l,c;return function(){var f=Gr(this,o),i=f.tween;if(i!==l){c=l=i;for(var w=0,C=c.length;w<C;++w)if(c[w].name===n){c=c.slice(),c.splice(w,1);break}}f.tween=c}}function uW(o,n,l){var c,f;if(typeof l!="function")throw new Error;return function(){var i=Gr(this,o),w=i.tween;if(w!==c){f=(c=w).slice();for(var C={name:n,value:l},A=0,L=f.length;A<L;++A)if(f[A].name===n){f[A]=C;break}A===L&&f.push(C)}i.tween=f}}function GN(o,n){var l=this._id;if(o+="",arguments.length<2){for(var c=Er(this.node(),l).tween,f=0,i=c.length,w;f<i;++f)if((w=c[f]).name===o)return w.value;return null}return this.each((n==null?cW:uW)(l,o,n))}function Pp(o,n,l){var c=o._id;return o.each(function(){var f=Gr(this,c);(f.value||(f.value={}))[n]=l.apply(this,arguments)}),function(f){return Er(f,c).value[n]}}function Wb(o,n){var l;return(typeof n=="number"?fs:n instanceof cu?Fb:(l=cu(n))?(n=l,Fb):AS)(o,n)}function hW(o){return function(){this.removeAttribute(o)}}function dW(o){return function(){this.removeAttributeNS(o.space,o.local)}}function fW(o,n,l){var c,f=l+"",i;return function(){var w=this.getAttribute(o);return w===f?null:w===c?i:i=n(c=w,l)}}function pW(o,n,l){var c,f=l+"",i;return function(){var w=this.getAttributeNS(o.space,o.local);return w===f?null:w===c?i:i=n(c=w,l)}}function mW(o,n,l){var c,f,i;return function(){var w,C=l(this),A;return C==null?void this.removeAttribute(o):(w=this.getAttribute(o),A=C+"",w===A?null:w===c&&A===f?i:(f=A,i=n(c=w,C)))}}function gW(o,n,l){var c,f,i;return function(){var w,C=l(this),A;return C==null?void this.removeAttributeNS(o.space,o.local):(w=this.getAttributeNS(o.space,o.local),A=C+"",w===A?null:w===c&&A===f?i:(f=A,i=n(c=w,C)))}}function HN(o,n){var l=Tl(o),c=l==="transform"?kS:Wb;return this.attrTween(o,typeof n=="function"?(l.local?gW:mW)(l,c,Pp(this,"attr."+o,n)):n==null?(l.local?dW:hW)(l):(l.local?pW:fW)(l,c,n))}function _W(o,n){return function(l){this.setAttribute(o,n.call(this,l))}}function yW(o,n){return function(l){this.setAttributeNS(o.space,o.local,n.call(this,l))}}function vW(o,n){var l,c;function f(){var i=n.apply(this,arguments);return i!==c&&(l=(c=i)&&yW(o,i)),l}return f._value=n,f}function xW(o,n){var l,c;function f(){var i=n.apply(this,arguments);return i!==c&&(l=(c=i)&&_W(o,i)),l}return f._value=n,f}function qN(o,n){var l="attr."+o;if(arguments.length<2)return(l=this.tween(l))&&l._value;if(n==null)return this.tween(l,null);if(typeof n!="function")throw new Error;var c=Tl(o);return this.tween(l,(c.local?vW:xW)(c,n))}function bW(o,n){return function(){X_(this,o).delay=+n.apply(this,arguments)}}function wW(o,n){return n=+n,function(){X_(this,o).delay=n}}function WN(o){var n=this._id;return arguments.length?this.each((typeof o=="function"?bW:wW)(n,o)):Er(this.node(),n).delay}function TW(o,n){return function(){Gr(this,o).duration=+n.apply(this,arguments)}}function EW(o,n){return n=+n,function(){Gr(this,o).duration=n}}function ZN(o){var n=this._id;return arguments.length?this.each((typeof o=="function"?TW:EW)(n,o)):Er(this.node(),n).duration}function IW(o,n){if(typeof n!="function")throw new Error;return function(){Gr(this,o).ease=n}}function YN(o){var n=this._id;return arguments.length?this.each(IW(n,o)):Er(this.node(),n).ease}function CW(o,n){return function(){var l=n.apply(this,arguments);if(typeof l!="function")throw new Error;Gr(this,o).ease=l}}function XN(o){if(typeof o!="function")throw new Error;return this.each(CW(this._id,o))}function KN(o){typeof o!="function"&&(o=L_(o));for(var n=this._groups,l=n.length,c=new Array(l),f=0;f<l;++f)for(var i=n[f],w=i.length,C=c[f]=[],A,L=0;L<w;++L)(A=i[L])&&o.call(A,A.__data__,L,i)&&C.push(A);return new co(c,this._parents,this._name,this._id)}function QN(o){if(o._id!==this._id)throw new Error;for(var n=this._groups,l=o._groups,c=n.length,f=l.length,i=Math.min(c,f),w=new Array(c),C=0;C<i;++C)for(var A=n[C],L=l[C],U=A.length,Q=w[C]=new Array(U),fe,he=0;he<U;++he)(fe=A[he]||L[he])&&(Q[he]=fe);for(;C<c;++C)w[C]=n[C];return new co(w,this._parents,this._name,this._id)}function SW(o){return(o+"").trim().split(/^|\s+/).every(function(n){var l=n.indexOf(".");return l>=0&&(n=n.slice(0,l)),!n||n==="start"})}function DW(o,n,l){var c,f,i=SW(n)?X_:Gr;return function(){var w=i(this,o),C=w.on;C!==c&&(f=(c=C).copy()).on(n,l),w.on=f}}function JN(o,n){var l=this._id;return arguments.length<2?Er(this.node(),l).on.on(o):this.each(DW(l,o,n))}function MW(o){return function(){var n=this.parentNode;for(var l in this.__transition)if(+l!==o)return;n&&n.removeChild(this)}}function e3(){return this.on("end.remove",MW(this._id))}function t3(o){var n=this._name,l=this._id;typeof o!="function"&&(o=ed(o));for(var c=this._groups,f=c.length,i=new Array(f),w=0;w<f;++w)for(var C=c[w],A=C.length,L=i[w]=new Array(A),U,Q,fe=0;fe<A;++fe)(U=C[fe])&&(Q=o.call(U,U.__data__,fe,C))&&("__data__"in U&&(Q.__data__=U.__data__),L[fe]=Q,uu(L[fe],n,l,fe,L,Er(U,l)));return new co(i,this._parents,n,l)}function n3(o){var n=this._name,l=this._id;typeof o!="function"&&(o=O_(o));for(var c=this._groups,f=c.length,i=[],w=[],C=0;C<f;++C)for(var A=c[C],L=A.length,U,Q=0;Q<L;++Q)if(U=A[Q]){for(var fe=o.call(U,U.__data__,Q,A),he,be=Er(U,l),Se=0,Ke=fe.length;Se<Ke;++Se)(he=fe[Se])&&uu(he,n,l,Se,fe,be);i.push(fe),w.push(U)}return new co(i,w,n,l)}var AW=El.prototype.constructor;function i3(){return new AW(this._groups,this._parents)}function PW(o,n){var l,c,f;return function(){var i=au(this,o),w=(this.style.removeProperty(o),au(this,o));return i===w?null:i===l&&w===c?f:f=n(l=i,c=w)}}function r3(o){return function(){this.style.removeProperty(o)}}function RW(o,n,l){var c,f=l+"",i;return function(){var w=au(this,o);return w===f?null:w===c?i:i=n(c=w,l)}}function kW(o,n,l){var c,f,i;return function(){var w=au(this,o),C=l(this),A=C+"";return C==null&&(A=C=(this.style.removeProperty(o),au(this,o))),w===A?null:w===c&&A===f?i:(f=A,i=n(c=w,C))}}function OW(o,n){var l,c,f,i="style."+n,w="end."+i,C;return function(){var A=Gr(this,o),L=A.on,U=A.value[i]==null?C||(C=r3(n)):void 0;(L!==l||f!==U)&&(c=(l=L).copy()).on(w,f=U),A.on=c}}function o3(o,n,l){var c=(o+="")=="transform"?RS:Wb;return n==null?this.styleTween(o,PW(o,c)).on("end.style."+o,r3(o)):typeof n=="function"?this.styleTween(o,kW(o,c,Pp(this,"style."+o,n))).each(OW(this._id,o)):this.styleTween(o,RW(o,c,n),l).on("end.style."+o,null)}function LW(o,n,l){return function(c){this.style.setProperty(o,n.call(this,c),l)}}function FW(o,n,l){var c,f;function i(){var w=n.apply(this,arguments);return w!==f&&(c=(f=w)&&LW(o,w,l)),c}return i._value=n,i}function s3(o,n,l){var c="style."+(o+="");if(arguments.length<2)return(c=this.tween(c))&&c._value;if(n==null)return this.tween(c,null);if(typeof n!="function")throw new Error;return this.tween(c,FW(o,n,l??""))}function NW(o){return function(){this.textContent=o}}function zW(o){return function(){var n=o(this);this.textContent=n??""}}function a3(o){return this.tween("text",typeof o=="function"?zW(Pp(this,"text",o)):NW(o==null?"":o+""))}function BW(o){return function(n){this.textContent=o.call(this,n)}}function VW(o){var n,l;function c(){var f=o.apply(this,arguments);return f!==l&&(n=(l=f)&&BW(f)),n}return c._value=o,c}function l3(o){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(o==null)return this.tween(n,null);if(typeof o!="function")throw new Error;return this.tween(n,VW(o))}function c3(){for(var o=this._name,n=this._id,l=Zb(),c=this._groups,f=c.length,i=0;i<f;++i)for(var w=c[i],C=w.length,A,L=0;L<C;++L)if(A=w[L]){var U=Er(A,n);uu(A,o,l,L,w,{time:U.time+U.delay+U.duration,delay:0,duration:U.duration,ease:U.ease})}return new co(c,this._parents,o,l)}function u3(){var o,n,l=this,c=l._id,f=l.size();return new Promise(function(i,w){var C={value:w},A={value:function(){--f===0&&i()}};l.each(function(){var L=Gr(this,c),U=L.on;U!==o&&(n=(o=U).copy(),n._.cancel.push(C),n._.interrupt.push(C),n._.end.push(A)),L.on=n}),f===0&&i()})}var jW=0;function co(o,n,l,c){this._groups=o,this._parents=n,this._name=l,this._id=c}function h3(o){return El().transition(o)}function Zb(){return++jW}var Il=El.prototype;co.prototype=h3.prototype={constructor:co,select:t3,selectAll:n3,selectChild:Il.selectChild,selectChildren:Il.selectChildren,filter:KN,merge:QN,selection:i3,transition:c3,call:Il.call,nodes:Il.nodes,node:Il.node,size:Il.size,empty:Il.empty,each:Il.each,on:JN,attr:HN,attrTween:qN,style:o3,styleTween:s3,text:a3,textTween:l3,remove:e3,tween:GN,delay:WN,duration:ZN,ease:YN,easeVarying:XN,end:u3,[Symbol.iterator]:Il[Symbol.iterator]};function Yb(o){return((o*=2)<=1?o*o*o:(o-=2)*o*o+2)/2}var UW={time:null,delay:0,duration:250,ease:Yb};function $W(o,n){for(var l;!(l=o.__transition)||!(l=l[n]);)if(!(o=o.parentNode))throw new Error(`transition ${n} not found`);return l}function d3(o){var n,l;o instanceof co?(n=o._id,o=o._name):(n=Zb(),(l=UW).time=Z_(),o=o==null?null:o+"");for(var c=this._groups,f=c.length,i=0;i<f;++i)for(var w=c[i],C=w.length,A,L=0;L<C;++L)(A=w[L])&&uu(A,o,n,L,w,l||$W(A,n));return new co(c,this._parents,o,n)}El.prototype.interrupt=$N;El.prototype.transition=d3;var{abs:Tce,max:Ece,min:Ice}=Math;function f3(o){return[+o[0],+o[1]]}function GW(o){return[f3(o[0]),f3(o[1])]}var Cce={name:"x",handles:["w","e"].map(LS),input:function(o,n){return o==null?null:[[+o[0],n[0][1]],[+o[1],n[1][1]]]},output:function(o){return o&&[o[0][0],o[1][0]]}},Sce={name:"y",handles:["n","s"].map(LS),input:function(o,n){return o==null?null:[[n[0][0],+o[0]],[n[1][0],+o[1]]]},output:function(o){return o&&[o[0][1],o[1][1]]}},Dce={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(LS),input:function(o){return o==null?null:GW(o)},output:function(o){return o}};function LS(o){return{type:o}}function p3(o){let n=+this._x.call(null,o),l=+this._y.call(null,o);return m3(this.cover(n,l),n,l,o)}function m3(o,n,l,c){if(isNaN(n)||isNaN(l))return o;var f,i=o._root,w={data:c},C=o._x0,A=o._y0,L=o._x1,U=o._y1,Q,fe,he,be,Se,Ke,Fe,tt;if(!i)return o._root=w,o;for(;i.length;)if((Se=n>=(Q=(C+L)/2))?C=Q:L=Q,(Ke=l>=(fe=(A+U)/2))?A=fe:U=fe,f=i,!(i=i[Fe=Ke<<1|Se]))return f[Fe]=w,o;if(he=+o._x.call(null,i.data),be=+o._y.call(null,i.data),n===he&&l===be)return w.next=i,f?f[Fe]=w:o._root=w,o;do f=f?f[Fe]=new Array(4):o._root=new Array(4),(Se=n>=(Q=(C+L)/2))?C=Q:L=Q,(Ke=l>=(fe=(A+U)/2))?A=fe:U=fe;while((Fe=Ke<<1|Se)===(tt=(be>=fe)<<1|he>=Q));return f[tt]=i,f[Fe]=w,o}function g3(o){var n,l,c=o.length,f,i,w=new Array(c),C=new Array(c),A=1/0,L=1/0,U=-1/0,Q=-1/0;for(l=0;l<c;++l)isNaN(f=+this._x.call(null,n=o[l]))||isNaN(i=+this._y.call(null,n))||(w[l]=f,C[l]=i,f<A&&(A=f),f>U&&(U=f),i<L&&(L=i),i>Q&&(Q=i));if(A>U||L>Q)return this;for(this.cover(A,L).cover(U,Q),l=0;l<c;++l)m3(this,w[l],C[l],o[l]);return this}function _3(o,n){if(isNaN(o=+o)||isNaN(n=+n))return this;var l=this._x0,c=this._y0,f=this._x1,i=this._y1;if(isNaN(l))f=(l=Math.floor(o))+1,i=(c=Math.floor(n))+1;else{for(var w=f-l||1,C=this._root,A,L;l>o||o>=f||c>n||n>=i;)switch(L=(n<c)<<1|o<l,A=new Array(4),A[L]=C,C=A,w*=2,L){case 0:f=l+w,i=c+w;break;case 1:l=f-w,i=c+w;break;case 2:f=l+w,c=i-w;break;case 3:l=f-w,c=i-w;break}this._root&&this._root.length&&(this._root=C)}return this._x0=l,this._y0=c,this._x1=f,this._y1=i,this}function y3(){var o=[];return this.visit(function(n){if(!n.length)do o.push(n.data);while(n=n.next)}),o}function v3(o){return arguments.length?this.cover(+o[0][0],+o[0][1]).cover(+o[1][0],+o[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Lr(o,n,l,c,f){this.node=o,this.x0=n,this.y0=l,this.x1=c,this.y1=f}function x3(o,n,l){var c,f=this._x0,i=this._y0,w,C,A,L,U=this._x1,Q=this._y1,fe=[],he=this._root,be,Se;for(he&&fe.push(new Lr(he,f,i,U,Q)),l==null?l=1/0:(f=o-l,i=n-l,U=o+l,Q=n+l,l*=l);be=fe.pop();)if(!(!(he=be.node)||(w=be.x0)>U||(C=be.y0)>Q||(A=be.x1)<f||(L=be.y1)<i))if(he.length){var Ke=(w+A)/2,Fe=(C+L)/2;fe.push(new Lr(he[3],Ke,Fe,A,L),new Lr(he[2],w,Fe,Ke,L),new Lr(he[1],Ke,C,A,Fe),new Lr(he[0],w,C,Ke,Fe)),(Se=(n>=Fe)<<1|o>=Ke)&&(be=fe[fe.length-1],fe[fe.length-1]=fe[fe.length-1-Se],fe[fe.length-1-Se]=be)}else{var tt=o-+this._x.call(null,he.data),ft=n-+this._y.call(null,he.data),Ue=tt*tt+ft*ft;if(Ue<l){var zt=Math.sqrt(l=Ue);f=o-zt,i=n-zt,U=o+zt,Q=n+zt,c=he.data}}return c}function b3(o){if(isNaN(U=+this._x.call(null,o))||isNaN(Q=+this._y.call(null,o)))return this;var n,l=this._root,c,f,i,w=this._x0,C=this._y0,A=this._x1,L=this._y1,U,Q,fe,he,be,Se,Ke,Fe;if(!l)return this;if(l.length)for(;;){if((be=U>=(fe=(w+A)/2))?w=fe:A=fe,(Se=Q>=(he=(C+L)/2))?C=he:L=he,n=l,!(l=l[Ke=Se<<1|be]))return this;if(!l.length)break;(n[Ke+1&3]||n[Ke+2&3]||n[Ke+3&3])&&(c=n,Fe=Ke)}for(;l.data!==o;)if(f=l,!(l=l.next))return this;return(i=l.next)&&delete l.next,f?(i?f.next=i:delete f.next,this):n?(i?n[Ke]=i:delete n[Ke],(l=n[0]||n[1]||n[2]||n[3])&&l===(n[3]||n[2]||n[1]||n[0])&&!l.length&&(c?c[Fe]=l:this._root=l),this):(this._root=i,this)}function w3(o){for(var n=0,l=o.length;n<l;++n)this.remove(o[n]);return this}function T3(){return this._root}function E3(){var o=0;return this.visit(function(n){if(!n.length)do++o;while(n=n.next)}),o}function I3(o){var n=[],l,c=this._root,f,i,w,C,A;for(c&&n.push(new Lr(c,this._x0,this._y0,this._x1,this._y1));l=n.pop();)if(!o(c=l.node,i=l.x0,w=l.y0,C=l.x1,A=l.y1)&&c.length){var L=(i+C)/2,U=(w+A)/2;(f=c[3])&&n.push(new Lr(f,L,U,C,A)),(f=c[2])&&n.push(new Lr(f,i,U,L,A)),(f=c[1])&&n.push(new Lr(f,L,w,C,U)),(f=c[0])&&n.push(new Lr(f,i,w,L,U))}return this}function C3(o){var n=[],l=[],c;for(this._root&&n.push(new Lr(this._root,this._x0,this._y0,this._x1,this._y1));c=n.pop();){var f=c.node;if(f.length){var i,w=c.x0,C=c.y0,A=c.x1,L=c.y1,U=(w+A)/2,Q=(C+L)/2;(i=f[0])&&n.push(new Lr(i,w,C,U,Q)),(i=f[1])&&n.push(new Lr(i,U,C,A,Q)),(i=f[2])&&n.push(new Lr(i,w,Q,U,L)),(i=f[3])&&n.push(new Lr(i,U,Q,A,L))}l.push(c)}for(;c=l.pop();)o(c.node,c.x0,c.y0,c.x1,c.y1);return this}function S3(o){return o[0]}function D3(o){return arguments.length?(this._x=o,this):this._x}function M3(o){return o[1]}function A3(o){return arguments.length?(this._y=o,this):this._y}function od(o,n,l){var c=new FS(n??S3,l??M3,NaN,NaN,NaN,NaN);return o==null?c:c.addAll(o)}function FS(o,n,l,c,f,i){this._x=o,this._y=n,this._x0=l,this._y0=c,this._x1=f,this._y1=i,this._root=void 0}function P3(o){for(var n={data:o.data},l=n;o=o.next;)l=l.next={data:o.data};return n}var uo=od.prototype=FS.prototype;uo.copy=function(){var o=new FS(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,l,c;if(!n)return o;if(!n.length)return o._root=P3(n),o;for(l=[{source:n,target:o._root=new Array(4)}];n=l.pop();)for(var f=0;f<4;++f)(c=n.source[f])&&(c.length?l.push({source:c,target:n.target[f]=new Array(4)}):n.target[f]=P3(c));return o};uo.add=p3;uo.addAll=g3;uo.cover=_3;uo.data=y3;uo.extent=v3;uo.find=x3;uo.remove=b3;uo.removeAll=w3;uo.root=T3;uo.size=E3;uo.visit=I3;uo.visitAfter=C3;uo.x=D3;uo.y=A3;function Qr(o){return function(){return o}}function hu(o){return(o()-.5)*1e-6}function HW(o){return o.x+o.vx}function qW(o){return o.y+o.vy}function K_(o){var n,l,c,f=1,i=1;typeof o!="function"&&(o=Qr(o==null?1:+o));function w(){for(var L,U=n.length,Q,fe,he,be,Se,Ke,Fe=0;Fe<i;++Fe)for(Q=od(n,HW,qW).visitAfter(C),L=0;L<U;++L)fe=n[L],Se=l[fe.index],Ke=Se*Se,he=fe.x+fe.vx,be=fe.y+fe.vy,Q.visit(tt);function tt(ft,Ue,zt,Kt,tn){var Tt=ft.data,ri=ft.r,Ct=Se+ri;if(Tt){if(Tt.index>fe.index){var Ti=he-Tt.x-Tt.vx,Ci=be-Tt.y-Tt.vy,$i=Ti*Ti+Ci*Ci;$i<Ct*Ct&&(Ti===0&&(Ti=hu(c),$i+=Ti*Ti),Ci===0&&(Ci=hu(c),$i+=Ci*Ci),$i=(Ct-($i=Math.sqrt($i)))/$i*f,fe.vx+=(Ti*=$i)*(Ct=(ri*=ri)/(Ke+ri)),fe.vy+=(Ci*=$i)*Ct,Tt.vx-=Ti*(Ct=1-Ct),Tt.vy-=Ci*Ct)}return}return Ue>he+Ct||Kt<he-Ct||zt>be+Ct||tn<be-Ct}}function C(L){if(L.data)return L.r=l[L.data.index];for(var U=L.r=0;U<4;++U)L[U]&&L[U].r>L.r&&(L.r=L[U].r)}function A(){if(n){var L,U=n.length,Q;for(l=new Array(U),L=0;L<U;++L)Q=n[L],l[Q.index]=+o(Q,L,n)}}return w.initialize=function(L,U){n=L,c=U,A()},w.iterations=function(L){return arguments.length?(i=+L,w):i},w.strength=function(L){return arguments.length?(f=+L,w):f},w.radius=function(L){return arguments.length?(o=typeof L=="function"?L:Qr(+L),A(),w):o},w}function R3(){let o=1;return()=>(o=(1664525*o+1013904223)%4294967296)/4294967296}function k3(o){return o.x}function O3(o){return o.y}var WW=10,ZW=Math.PI*(3-Math.sqrt(5));function Q_(o){var n,l=1,c=.001,f=1-Math.pow(c,1/300),i=0,w=.6,C=new Map,A=Ap(Q),L=Jh("tick","end"),U=R3();o==null&&(o=[]);function Q(){fe(),L.call("tick",n),l<c&&(A.stop(),L.call("end",n))}function fe(Se){var Ke,Fe=o.length,tt;Se===void 0&&(Se=1);for(var ft=0;ft<Se;++ft)for(l+=(i-l)*f,C.forEach(function(Ue){Ue(l)}),Ke=0;Ke<Fe;++Ke)tt=o[Ke],tt.fx==null?tt.x+=tt.vx*=w:(tt.x=tt.fx,tt.vx=0),tt.fy==null?tt.y+=tt.vy*=w:(tt.y=tt.fy,tt.vy=0);return n}function he(){for(var Se=0,Ke=o.length,Fe;Se<Ke;++Se){if(Fe=o[Se],Fe.index=Se,Fe.fx!=null&&(Fe.x=Fe.fx),Fe.fy!=null&&(Fe.y=Fe.fy),isNaN(Fe.x)||isNaN(Fe.y)){var tt=WW*Math.sqrt(.5+Se),ft=Se*ZW;Fe.x=tt*Math.cos(ft),Fe.y=tt*Math.sin(ft)}(isNaN(Fe.vx)||isNaN(Fe.vy))&&(Fe.vx=Fe.vy=0)}}function be(Se){return Se.initialize&&Se.initialize(o,U),Se}return he(),n={tick:fe,restart:function(){return A.restart(Q),n},stop:function(){return A.stop(),n},nodes:function(Se){return arguments.length?(o=Se,he(),C.forEach(be),n):o},alpha:function(Se){return arguments.length?(l=+Se,n):l},alphaMin:function(Se){return arguments.length?(c=+Se,n):c},alphaDecay:function(Se){return arguments.length?(f=+Se,n):+f},alphaTarget:function(Se){return arguments.length?(i=+Se,n):i},velocityDecay:function(Se){return arguments.length?(w=1-Se,n):1-w},randomSource:function(Se){return arguments.length?(U=Se,C.forEach(be),n):U},force:function(Se,Ke){return arguments.length>1?(Ke==null?C.delete(Se):C.set(Se,be(Ke)),n):C.get(Se)},find:function(Se,Ke,Fe){var tt=0,ft=o.length,Ue,zt,Kt,tn,Tt;for(Fe==null?Fe=1/0:Fe*=Fe,tt=0;tt<ft;++tt)tn=o[tt],Ue=Se-tn.x,zt=Ke-tn.y,Kt=Ue*Ue+zt*zt,Kt<Fe&&(Tt=tn,Fe=Kt);return Tt},on:function(Se,Ke){return arguments.length>1?(L.on(Se,Ke),n):L.on(Se)}}}function J_(){var o,n,l,c,f=Qr(-30),i,w=1,C=1/0,A=.81;function L(he){var be,Se=o.length,Ke=od(o,k3,O3).visitAfter(Q);for(c=he,be=0;be<Se;++be)n=o[be],Ke.visit(fe)}function U(){if(o){var he,be=o.length,Se;for(i=new Array(be),he=0;he<be;++he)Se=o[he],i[Se.index]=+f(Se,he,o)}}function Q(he){var be=0,Se,Ke,Fe=0,tt,ft,Ue;if(he.length){for(tt=ft=Ue=0;Ue<4;++Ue)(Se=he[Ue])&&(Ke=Math.abs(Se.value))&&(be+=Se.value,Fe+=Ke,tt+=Ke*Se.x,ft+=Ke*Se.y);he.x=tt/Fe,he.y=ft/Fe}else{Se=he,Se.x=Se.data.x,Se.y=Se.data.y;do be+=i[Se.data.index];while(Se=Se.next)}he.value=be}function fe(he,be,Se,Ke){if(!he.value)return!0;var Fe=he.x-n.x,tt=he.y-n.y,ft=Ke-be,Ue=Fe*Fe+tt*tt;if(ft*ft/A<Ue)return Ue<C&&(Fe===0&&(Fe=hu(l),Ue+=Fe*Fe),tt===0&&(tt=hu(l),Ue+=tt*tt),Ue<w&&(Ue=Math.sqrt(w*Ue)),n.vx+=Fe*he.value*c/Ue,n.vy+=tt*he.value*c/Ue),!0;if(he.length||Ue>=C)return;(he.data!==n||he.next)&&(Fe===0&&(Fe=hu(l),Ue+=Fe*Fe),tt===0&&(tt=hu(l),Ue+=tt*tt),Ue<w&&(Ue=Math.sqrt(w*Ue)));do he.data!==n&&(ft=i[he.data.index]*c/Ue,n.vx+=Fe*ft,n.vy+=tt*ft);while(he=he.next)}return L.initialize=function(he,be){o=he,l=be,U()},L.strength=function(he){return arguments.length?(f=typeof he=="function"?he:Qr(+he),U(),L):f},L.distanceMin=function(he){return arguments.length?(w=he*he,L):Math.sqrt(w)},L.distanceMax=function(he){return arguments.length?(C=he*he,L):Math.sqrt(C)},L.theta=function(he){return arguments.length?(A=he*he,L):Math.sqrt(A)},L}function ey(o){var n=Qr(.1),l,c,f;typeof o!="function"&&(o=Qr(o==null?0:+o));function i(C){for(var A=0,L=l.length,U;A<L;++A)U=l[A],U.vx+=(f[A]-U.x)*c[A]*C}function w(){if(l){var C,A=l.length;for(c=new Array(A),f=new Array(A),C=0;C<A;++C)c[C]=isNaN(f[C]=+o(l[C],C,l))?0:+n(l[C],C,l)}}return i.initialize=function(C){l=C,w()},i.strength=function(C){return arguments.length?(n=typeof C=="function"?C:Qr(+C),w(),i):n},i.x=function(C){return arguments.length?(o=typeof C=="function"?C:Qr(+C),w(),i):o},i}function ty(o){var n=Qr(.1),l,c,f;typeof o!="function"&&(o=Qr(o==null?0:+o));function i(C){for(var A=0,L=l.length,U;A<L;++A)U=l[A],U.vy+=(f[A]-U.y)*c[A]*C}function w(){if(l){var C,A=l.length;for(c=new Array(A),f=new Array(A),C=0;C<A;++C)c[C]=isNaN(f[C]=+o(l[C],C,l))?0:+n(l[C],C,l)}}return i.initialize=function(C){l=C,w()},i.strength=function(C){return arguments.length?(n=typeof C=="function"?C:Qr(+C),w(),i):n},i.y=function(C){return arguments.length?(o=typeof C=="function"?C:Qr(+C),w(),i):o},i}function du(o,n,l){this.k=o,this.x=n,this.y=l}du.prototype={constructor:du,scale:function(o){return o===1?this:new du(this.k*o,this.x,this.y)},translate:function(o,n){return o===0&n===0?this:new du(this.k,this.x+this.k*o,this.y+this.k*n)},apply:function(o){return[o[0]*this.k+this.x,o[1]*this.k+this.y]},applyX:function(o){return o*this.k+this.x},applyY:function(o){return o*this.k+this.y},invert:function(o){return[(o[0]-this.x)/this.k,(o[1]-this.y)/this.k]},invertX:function(o){return(o-this.x)/this.k},invertY:function(o){return(o-this.y)/this.k},rescaleX:function(o){return o.copy().domain(o.range().map(this.invertX,this).map(o.invert,o))},rescaleY:function(o){return o.copy().domain(o.range().map(this.invertY,this).map(o.invert,o))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var NS=new du(1,0,0);zS.prototype=du.prototype;function zS(o){for(;!o.__zoom;)if(!(o=o.parentNode))return NS;return o.__zoom}var jS=LT(Xb());var Cl=(()=>{let n=class n{constructor(){this.ACCESS_TOKEN="pk.eyJ1Ijoidml0YWxpaS1iaWxpbnNreWkiLCJhIjoiY2x5OGZqZDdsMDVjMjJucGh5Z2w3MmgzZSJ9.nKkXDgd7Q8u4sBZt_bsRrQ",this.mapStyle="mapbox://styles/vitalii-bilinskyi/cly8fp05900fz01pfaajw4fqa",this.map=null,this.source=null,this.layers=[],this.icons=[],this.showSensorData=new wr(!1),this.canvas=null,this.svg=null,this.height=window.innerWidth,this.width=window.innerHeight}setMap(c){this.map||(this.map=c)}setSource(c){this.source=c}setMapStyle(c){this.mapStyle=c}initializeMap(c){let A=c,{container:f,zoom:i,center:w}=A,C=ls(A,["container","zoom","center"]);this.map=new jS.default.Map(gt({accessToken:this.ACCESS_TOKEN,container:f,style:this.mapStyle,zoom:i??12,center:w},C))}addSource(c,f){if(!this.map)throw new Error("Set map before adding source!");let U=f,{data:i,cluster:w,clusterMaxZoom:C,clusterRadius:A}=U,L=ls(U,["data","cluster","clusterMaxZoom","clusterRadius"]);this.map.addSource(c,gt({type:"geojson",data:i,cluster:w,clusterMaxZoom:C??13,clusterRadius:A??100},L)),this.source=c}generatePointLayer(c){if(this.showUnconfiguredMapServiceErrors("creating point layer!"),Array.isArray(c))for(let f of c)this.createPointLayer(f);else this.createPointLayer(c)}createPointLayer(c){let U=c,{id:f,iconId:i,filter:w,layout:C,onPointClickHandler:A}=U,L=ls(U,["id","iconId","filter","layout","onPointClickHandler"]);this.map.addLayer(gt({id:f,type:"symbol",source:this.source,filter:w,layout:gt({"icon-image":i,"icon-allow-overlap":!0},C)},L)),A&&this.map.on("click",f,Q=>{A(Q,this.map,f),this.showSensorData.next(!0)}),this.layers.push(c.id),this.icons.push(c.iconId)}generateClusterLayer(c){if(this.showUnconfiguredMapServiceErrors("creating cluster layer!"),Array.isArray(c))for(let f of c)this.createClusterLayer(f);else this.createClusterLayer(c)}createClusterLayer(c){let L=c,{id:f,filter:i,paint:w,onClusterClickHandler:C}=L,A=ls(L,["id","filter","paint","onClusterClickHandler"]);this.map.addLayer(gt({id:f,type:"circle",source:this.source,filter:i,paint:gt({"circle-color":"#cd5dfc","circle-radius":20},w)},A)),this.layers.push(c.id),C&&this.map.on("click",f,U=>C(U,this.map,f))}drawD3JSCircles(){if(this.canvas=this.map.getCanvasContainer(),this.svg=lo(".mapboxgl-canvas-container").append("div").style("view-transition-name","cube").style("position","absolute").style("width","100%").style("height",`${this.height}px`).style("top","0px").style("left","0px").append("svg").attr("width","100%").attr("height",this.height).style("position","absolute").style("left",0),!this.map?.getSource("workspaces")){console.error("GeoJSON source not found");return}let f=this.map?.querySourceFeatures("workspaces",{filter:["==","alarmLevel","high"]}),i=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-high"]}),w=this.map?.queryRenderedFeatures({layers:["unclustered-point-animated-moderate"]}),C=F3(i,"id"),A=F3(w,"id");console.log("uniqueFeatures1",C),console.log("uniqueFeatures2",A);let L=[...C,...A],U=C?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),Q=A?.map(he=>[this.project(he.geometry.coordinates).x,this.project(he.geometry.coordinates).y]),fe=[...U,...Q];if(console.log("dataToSave",fe),localStorage.setItem("pointsCoords",JSON.stringify(fe)),L&&this.svg){let he=this.svg.selectAll("circle.point").data(L).enter().append("circle").attr("class","point").attr("cx",be=>this.project(be.geometry.coordinates).x).attr("cy",be=>this.project(be.geometry.coordinates).y).attr("r",5).attr("fill","red")}}project(c){return this.map?.project(new jS.default.LngLat(+c[0],+c[1]))}showUnconfiguredMapServiceErrors(c){if(!this.map)throw new Error(`Set map before ${c}`);if(!this.source)throw new Error(`Set source before ${c}`)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function F3(o,n){let l=new Set,c=[];for(let f of o){let i=f.properties[n];console.log("eature.properties[comparatorProperty];",f.properties),l.has(i)||(l.add(i),c.push(f))}return c}function YW(o,n){if(o&1){let l=i_();nn(0,"app-sensor-details",3),Oi("hideDetails",function(f){Kg(l);let i=lp();return Qg(i.hideDetails(f))}),en()}o&2&&vi("@enter",void 0)("@fadeOutOnLeave",void 0)}var z3=(()=>{let n=class n{constructor(c,f){this.mockDataService=c,this.mapService=f,this.lat=50.049683,this.lng=19.944544,this.zoomLevel=12,this.dotSize=100,this.context=null,this.pulsingDot_low=null,this.pulsingDot_moderate=null,this.pulsingDot_high=null,this.pulsingDot_sevire=null,this.canvas_low=document.createElement("canvas"),this.canvas_moderate=document.createElement("canvas"),this.canvas_high=document.createElement("canvas"),this.canvas_sevire=document.createElement("canvas"),this.showSensorDetails=!1,this.mapService.showSensorData?.subscribe(i=>{this.showSensorDetails=i})}hideDetails(c){this.showSensorDetails=!c}ngOnInit(){this.mockDataService.getAllLocations().then(c=>{this.mockData=N3([...c]),this.renderMap()}).catch(c=>{console.error("Failed to fetch mock data",c),this.mockData=N3([...bF]),this.renderMap()})}renderMap(){this.getSavedMapData(),this.mapService.initializeMap({container:"map",zoom:this.zoomLevel,center:[this.lng,this.lat],minZoom:4}),this.createPusingDots(),this.onMapLoadHandler()}getSavedMapData(){try{let c=localStorage.getItem("center");if(console.log(c),c){let i=JSON.parse(c);this.lng=i.lng,this.lat=i.lat}let f=localStorage.getItem("zoomLevel");if(console.log(f),f){let i=JSON.parse(f);this.zoomLevel=i}}catch(c){console.log("getCenterOfMap Exception: ",c)}}createPusingDots(){this.checkMapInitialization(),this.canvas_low.className="canvas_low",this.pulsingDot_low=k_("#B3ECCD",this.mapService.map,this.canvas_low),this.canvas_moderate.className="canvas_moderate",this.pulsingDot_moderate=k_("#FFEB82",this.mapService.map,this.canvas_moderate),this.canvas_high.className="canvas_high",this.pulsingDot_high=k_("#ffb682",this.mapService.map,this.canvas_high),this.canvas_sevire.className="canvas_sevire",this.pulsingDot_sevire=k_("#ECC6EF",this.mapService.map,this.canvas_sevire,!0)}onMapLoadHandler(){this.checkMapInitialization(),this.mapService.map.on("load",()=>{this.pulsingDot_low&&this.mapService.map.addImage("pulsingDot_low",this.pulsingDot_low,{pixelRatio:2}),this.pulsingDot_moderate&&this.mapService.map.addImage("pulsingDot_moderate",this.pulsingDot_moderate,{pixelRatio:2}),this.pulsingDot_high&&this.mapService.map.addImage("pulsingDot_high",this.pulsingDot_high,{pixelRatio:2}),this.pulsingDot_sevire&&this.mapService.map.addImage("pulsingDot_sevire",this.pulsingDot_sevire,{pixelRatio:2}),this.mapService.addSource("workspaces",{data:this.mockData,cluster:!0}),this.drawData()})}drawData(){this.mapService.generateClusterLayer({id:"clusters",filter:["has","point_count"],paint:{"circle-radius":20},onClusterClickHandler:this.onClusterClickHandler}),this.mapService.map.addLayer({id:"cluster-count",type:"symbol",source:"workspaces",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"white"}});let c=[{id:"unclustered-point-animated-sevire",filter:["==","alarmLevel","sevire"],iconId:"pulsingDot_sevire",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-high",filter:["==","alarmLevel","high"],iconId:"pulsingDot_high",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-moderate",filter:["==","alarmLevel","moderate"],iconId:"pulsingDot_moderate",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-low",filter:["==","alarmLevel","low"],iconId:"pulsingDot_low",onPointClickHandler:this.onUnlcusteredPointClickHandler}];this.mapService.generatePointLayer(c)}onClusterClickHandler(c,f,i){let w=f.queryRenderedFeatures(c.point,{layers:[i]});if(w&&w[0]&&w[0]?.properties){let C=w[0]?.properties.cluster_id;if(C){let A=f.getSource("workspaces"),L=f.getZoom();A?.getClusterExpansionZoom(C,(U,Q)=>{U||!Q||w[0].geometry.type==="Point"&&f.easeTo({center:w[0].geometry.coordinates,zoom:Q,duration:L<=8?2e3:L<=10?1500:1e3,linear:!0})})}}}onUnlcusteredPointClickHandler(c,f,i){let w=f.queryRenderedFeatures(c.point,{layers:[i]});if(w&&w[0]){let C=w[0];if(console.log(C),C.geometry.type==="Point"){let A={center:[C.geometry.coordinates[0],C.geometry.coordinates[1]],zoom:18};f.flyTo(oi(gt({},A),{duration:2500,essential:!0}))}}}checkMapInitialization(){if(!this.mapService.map)throw new Error("Map is not initialized")}};n.\u0275fac=function(f){return new(f||n)(Kn(vS),Kn(Cl))},n.\u0275cmp=yi({type:n,selectors:[["map-view"]],standalone:!0,features:[Gh([]),bi],decls:3,vars:3,consts:[["id","map",1,"match-parent"],[2,"position","absolute","top","100px","left","100px","z-index","999"],[3,"hideDetails",4,"ngIf"],[3,"hideDetails"]],template:function(f,i){f&1&&(si(0,"div",0)(1,"div",1),ao(2,YW,1,2,"app-sensor-details",2)),f&2&&(Xn(),$h("view-transition-name","cube"),Xn(),vi("ngIf",i.showSensorDetails))},dependencies:[eb,Wi,mp,yS],styles:['.match-parent[_ngcontent-%COMP%]{width:100%;height:100%}#map[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;display:block;z-index:10;pointer-events:none;-webkit-box-shadow:inset 0 0 70px 60px white;-moz-box-shadow:inset 0 0 70px 60px white;box-shadow:inset 0 0 70px 60px #fff}[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}']});let o=n;return o})(),N3=o=>{let n=[],l=["high","moderate","low"];return o.forEach(c=>{n.push({type:"Feature",id:c.id,properties:{numberOfDevices:c.devices?.length,alarmLevel:c.id==="6"?"sevire":l[Math.floor(Math.random()*l.length)],id:c.id},geometry:{type:"Point",coordinates:[c.longitude,c.latitude]}})}),{type:"FeatureCollection",features:[...n]}};var Bi=function(o){return o[o.GROUP=0]="GROUP",o[o.DEVICE=1]="DEVICE",o}(Bi||{}),Ki=function(o){return o[o.LATCH=0]="LATCH",o[o.BATTERY=1]="BATTERY",o[o.SIGNAL=2]="SIGNAL",o[o.HUMIDITY=3]="HUMIDITY",o[o.TEMPERATURE=4]="TEMPERATURE",o}(Ki||{}),Hn=function(o){return o[o.LOW=0]="LOW",o[o.MODERATE=1]="MODERATE",o[o.HIGH=2]="HIGH",o[o.SEVIRE=3]="SEVIRE",o}(Hn||{}),XW=[{id:"id1.1",type:Bi.GROUP,deviceType:Ki.LATCH,name:"Latch",r:75},{id:"id1.2",type:Bi.GROUP,deviceType:Ki.TEMPERATURE,name:"Temperature",r:75},{id:"id1.3",type:Bi.GROUP,deviceType:Ki.BATTERY,name:"Battery",r:75},{id:"id1.4",type:Bi.GROUP,deviceType:Ki.HUMIDITY,name:"Humidity",r:75},{id:"id1.5",type:Bi.GROUP,deviceType:Ki.SIGNAL,name:"Signal",r:75},{id:"id1.1.1",type:Bi.DEVICE,deviceType:Ki.LATCH,name:"DEVICE_0",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:Hn.HIGH},{id:"2",message:"Something wrong with case",priority:Hn.LOW},{id:"3",message:"Something wrong with signal",priority:Hn.MODERATE}]},{id:"id1.1.2",type:Bi.DEVICE,deviceType:Ki.LATCH,name:"DEVICE_1",r:30,alarms:[{id:"1",message:"Something wrong with latch",priority:Hn.MODERATE},{id:"2",message:"Something wrong with case",priority:Hn.MODERATE},{id:"3",message:"Something wrong with signal",priority:Hn.HIGH}]},{id:"id1.2.1",type:Bi.DEVICE,deviceType:Ki.TEMPERATURE,name:"DEVICE_2",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:Hn.SEVIRE},{id:"2",message:"Something wrong with case",priority:Hn.HIGH},{id:"3",message:"Something wrong with signal",priority:Hn.LOW}]},{id:"id1.2.2",type:Bi.DEVICE,deviceType:Ki.TEMPERATURE,name:"DEVICE_3",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:Hn.LOW},{id:"2",message:"Something wrong with case",priority:Hn.LOW},{id:"3",message:"Something wrong with signal",priority:Hn.LOW}]},{id:"id1.2.3",type:Bi.DEVICE,deviceType:Ki.TEMPERATURE,name:"DEVICE_4",r:30,alarms:[{id:"1",message:"Something wrong with temperature",priority:Hn.HIGH},{id:"2",message:"Something wrong with case",priority:Hn.SEVIRE},{id:"3",message:"Something wrong with signal",priority:Hn.SEVIRE}]},{id:"id1.3.1",type:Bi.DEVICE,deviceType:Ki.BATTERY,name:"DEVICE_5",r:30,alarms:[{id:"1",message:"Something wrong with battery",priority:Hn.MODERATE},{id:"2",message:"Something wrong with case",priority:Hn.MODERATE},{id:"3",message:"Something wrong with signal",priority:Hn.MODERATE}]},{id:"id1.4.1",type:Bi.DEVICE,deviceType:Ki.HUMIDITY,name:"DEVICE_6",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:Hn.LOW},{id:"2",message:"Something wrong with case",priority:Hn.MODERATE},{id:"3",message:"Something wrong with signal",priority:Hn.LOW}]},{id:"id1.4.2",type:Bi.DEVICE,deviceType:Ki.HUMIDITY,name:"DEVICE_7",r:30,alarms:[{id:"1",message:"Something wrong with humidity",priority:Hn.SEVIRE},{id:"2",message:"Something wrong with case",priority:Hn.SEVIRE},{id:"3",message:"Something wrong with signal",priority:Hn.LOW}]},{id:"id1.5.1",type:Bi.DEVICE,deviceType:Ki.SIGNAL,name:"DEVICE_8",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:Hn.MODERATE},{id:"2",message:"Something wrong with case",priority:Hn.SEVIRE},{id:"3",message:"Something wrong with signal",priority:Hn.HIGH}]},{id:"id1.5.2",type:Bi.DEVICE,deviceType:Ki.SIGNAL,name:"DEVICE_9",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:Hn.MODERATE},{id:"2",message:"Something wrong with case",priority:Hn.HIGH},{id:"3",message:"Something wrong with signal",priority:Hn.HIGH}]},{id:"id1.5.3",type:Bi.DEVICE,deviceType:Ki.SIGNAL,name:"DEVICE_10",r:30,alarms:[{id:"1",message:"Something wrong with signal",priority:Hn.HIGH},{id:"2",message:"Something wrong with case",priority:Hn.LOW},{id:"3",message:"Something wrong with signal",priority:Hn.LOW}]}];function B3(o,n){return Math.floor(Math.random()*(n-o+1)+o)}var US=(()=>{let n=class n{constructor(c){this.mapService=c,this.simulation=new Map,this.svg=null,this.nodeGroup=null,this.nodes=[],this.textGroup=null,this.texts=[],this.iconGroup=null,this.icons=[],this.center={x:window.innerWidth/2,y:window.innerHeight/2},this.xAxis=[],this.groups=this.calculateGroups("deviceType")}ngOnInit(){this.createSVGGroups(),this.loadSimulations(),this.restartSimulations()}createSVGGroups(){let c=lo(".bubbles");this.svg=c.append("svg").attr("class","gravity-container").attr("viewBox",[-this.center.y,-this.center.x,window.innerHeight,window.innerWidth]).style("height",window.innerHeight).style("width",window.innerWidth),this.nodeGroup=this.svg.append("g").attr("class","bubbles-layer"),this.textGroup=this.svg.append("g").attr("class","text-layer"),this.iconGroup=this.svg.append("g").attr("class","icon-layer"),this.groups.forEach((f,i)=>{let w=(be,Se)=>{be.active||this.simulation.get(i)?.alphaTarget(.3).restart(),Se.fx=Se.x,Se.fy=Se.y},C=(be,Se)=>{Se.fx=be.x,Se.fy=be.y},A=(be,Se)=>{be.active||this.simulation.get(i)?.alphaTarget(0),Se.fx=null,Se.fy=null},L=this.nodeGroup?.selectAll("circle").data(f,be=>be.id).enter().append("circle").attr("r",be=>this.getRadius(be.type)).attr("fill",be=>this.getColor(be.type,be.priority)).attr("cx",be=>be.x).attr("cy",be=>be.y).call(B_().on("start",w).on("drag",C).on("end",A));L&&this.nodes.push(L);let U=f.filter(be=>be.type!==Bi.GROUP),Q=this.textGroup?.style("font","16px sans-serif").selectAll("text").data(U,be=>be.id).enter().append("text").attr("id",be=>be.id).attr("line-height","16px").attr("pointer-events","none").attr("text-anchor","middle").text(be=>be.count);Q&&this.texts.push(Q);let fe=f.filter(be=>be.type===Bi.GROUP),he=this.iconGroup?.selectAll("image").data(fe,be=>be.id).enter().append("image").attr("r",8).attr("fill","#5484d1").attr("href",be=>this.getIcon(be.deviceType)).attr("height",be=>this.getRadius(be.type)).attr("width",be=>this.getRadius(be.type)).attr("style","position: absolute;");he&&this.icons.push(he)}),this.setFixedXAxisToGroupParent()}getColor(c,f){if(c===Bi.GROUP)return"#F8F8F8";switch(f){case Hn.LOW:return"#B3ECCD";case Hn.MODERATE:return"#FFEB82";case Hn.HIGH:return"#ffb682";case Hn.SEVIRE:return"#ECC6EF";default:return"#D9D9D9"}}getRadius(c){return c===Bi.GROUP?75:30}getIcon(c){switch(c){case Ki.BATTERY:return"../assets/icon_wf_battery.svg";case Ki.HUMIDITY:return"../assets/icon_wf_humidity.svg";case Ki.LATCH:return"../assets/icon_wf_latch.svg";case Ki.SIGNAL:return"../assets/icon_wf_signal.svg";case Ki.TEMPERATURE:return"../assets/icon_wf_temperature.svg"}}calculateGroups(c){let f=bb(XW,U=>U[c]),i=new Map([...f.entries()].sort()),w=[],C=new Qh,A=localStorage.getItem("pointsCoords");if(console.log(A),A){let U=JSON.parse(A);console.log("parsedCoords",U),console.log("slicedCoordsArray",U);for(let Q of U)console.log("slicedCoord",Q),w.push(Q)}let L=0;return i.forEach((U,Q)=>{let fe=[],he=[];U.forEach(Fe=>{if(Fe.type===Bi.DEVICE){let tt=Fe,{alarms:ft}=tt,Ue=ls(tt,["alarms"]);Fe.alarms.forEach(zt=>{fe.push(oi(gt(gt({},zt),Ue),{x:B3(-750,750),y:B3(350,-350)})),console.log("index",L),L+=1})}else he.push(Fe)});let be=fe.reduce((Fe,tt)=>(Fe[tt.priority]||(Fe[tt.priority]=oi(gt({},tt),{count:0})),Fe[tt.priority].count+=1,Fe),{}),Se=Object.values(be),Ke=[...he,...Se];C.set(Q,Ke)}),C}calculateXAxis(){return KW(-(window.innerWidth-100),window.innerWidth-100,this.groups.size)}setFixedXAxisToGroupParent(){this.xAxis=this.calculateXAxis(),this.groups.forEach(c=>{c.forEach((f,i)=>{f.type===Bi.GROUP&&(f.fx=this.xAxis[i],f.fy=0)})})}loadSimulations(){let c=new Map;this.groups.forEach((f,i)=>{let w=()=>{this.groups.get(i)?.forEach(A=>{A.type===Bi.GROUP&&(A.fx=this.xAxis[i],A.fy=0)}),this.nodes[i]?.attr("cx",A=>A.x).attr("cy",A=>A.y),this.texts[i]?.attr("x",A=>A.x).attr("y",A=>A.y),this.icons[i]?.attr("x",A=>A.x-this.getRadius(A.type)/2).attr("y",A=>A.y-this.getRadius(A.type)/2)},C=Q_(this.groups.get(i)).alphaDecay(.01).velocityDecay(.2).force("charge",J_().strength(5)).force("x",ey(this.xAxis[i]).strength(.02)).force("y",ty().strength(.02)).force("collide",K_().radius(A=>A.type===Bi.GROUP?A.r-15:A.r).iterations(3)).on("tick",w);c.set(i,C),console.log("this.groups.get(key)",this.groups.get(i))}),this.simulation=c}restartSimulations(){for(let c of this.simulation)c[1].restart()}};n.\u0275fac=function(f){return new(f||n)(Kn(Cl))},n.\u0275cmp=yi({type:n,selectors:[["app-gravity-bubbles-view"]],standalone:!0,features:[bi],decls:3,vars:2,consts:[[1,"bubbles"],[2,"position","absolute","top","300px","left","1000px","z-index","999"],[2,"height","30px","width","30px"]],template:function(f,i){f&1&&(si(0,"div",0),nn(1,"div",1),Fk(),si(2,"svg",2),en()),f&2&&(Xn(),$h("view-transition-name","cube"))},dependencies:[Wi],styles:["svg[_ngcontent-%COMP%]{view-transition-name:circle-image}img[_ngcontent-%COMP%]{view-transition-name:card-image}[_ngcontent-%COMP%]::vview-transition-group(cube){animation-duration:4s}"]});let o=n;return o})();function KW(o,n,l){let c=(n-o)/l,f=[];for(let i=0;i<l;i++){let w=o+i*c,C=w+c;f.push((w+C)/2)}return f}var V3=(()=>{let n=class n{handleMenuClick(c,f){c.cancelBubble=!0}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-sensor-overview"]],standalone:!0,features:[bi],decls:21,vars:0,consts:[[1,"normal","menu-element",2,"text-align","left","padding-left","10px",3,"click"],["src","../../../assets/top-right-arrow.svg",2,"position","fixed","right","15px","margin-top","4px"],[1,"critical","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"high","menu-element",2,"height","fit-content","text-align","left","padding-left","10px",3,"click"],[1,"dotted"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%"],["src","../../../assets/alert-add.svg",1,"add-icon"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%","text-decoration-line","line-through","text-decoration-color","rgba(0, 0, 0, 0.5)","color","rgba(0, 0, 0, 0.5)"],["src","../../../assets/alert-close.svg",1,"add-icon"],[1,"regular","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"low","menu-element",2,"text-align","left","padding-left","10px",3,"click"]],template:function(f,i){f&1&&(nn(0,"div",0),Oi("click",function(C){return i.handleMenuClick(C,"normal")}),xi(1," 7 tasks to delegate "),si(2,"img",1),en(),nn(3,"div",2),Oi("click",function(C){return i.handleMenuClick(C,"critical")}),xi(4," 3 critical alerts "),en(),nn(5,"div",3),Oi("click",function(C){return i.handleMenuClick(C,"high")}),xi(6," 8 high priority alerts "),si(7,"hr",4),nn(8,"div",5),xi(9,"4 mice to be released "),si(10,"img",6),en(),nn(11,"div",5),xi(12,"2 batteries to be replaced "),si(13,"img",6),en(),nn(14,"div",7),xi(15," 2 roofs to be cleared of snow "),si(16,"img",8),en()(),nn(17,"div",9),Oi("click",function(C){return i.handleMenuClick(C,"regular")}),xi(18," 29 regular statuses "),en(),nn(19,"div",10),Oi("click",function(C){return i.handleMenuClick(C,"low")}),xi(20," 3 low priority statuses "),en())},dependencies:[Wi]});let o=n;return o})();var j3=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:z3},{path:"bubbles",component:US},{path:"sensors",component:V3,data:{animation:"sensorsPage"}}];var QW=["*"],fu=class{},Jb=(()=>{let n=class n extends fu{constructor(c){super(),this.http=c}getSvg(c){return this.http.get(c,{responseType:"text"})}};n.\u0275fac=function(f){return new(f||n)(Vt(wC))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),JW=new an("SERVER_URL"),Kb=(()=>{let n=class n{constructor(){this.loader=vt(fu),this.serverUrl=vt(JW,{optional:!0}),this.document=vt(zi),this.iconsByUrl=new Map,this.iconsLoadingByUrl=new Map}addSvg(c,f){if(!this.iconsByUrl.has(c)){let i=this.document.createElement("DIV");i.innerHTML=f;let w=i.querySelector("svg");this.iconsByUrl.set(c,w)}}loadSvg(c,f=c){if(this.serverUrl&&c.match(/^(http(s)?):/)===null&&(c=this.serverUrl+c,f=c),this.iconsByUrl.has(f))return un(this.iconsByUrl.get(f));if(this.iconsLoadingByUrl.has(f))return this.iconsLoadingByUrl.get(f);let i=this.loader.getSvg(c).pipe(Dn(w=>{let C=this.document.createElement("DIV");return C.innerHTML=w,C.querySelector("svg")}),ur(w=>this.iconsByUrl.set(f,w)),va(w=>(console.error(w),ml(w))),xa(()=>this.iconsLoadingByUrl.delete(f)),oE());return this.iconsLoadingByUrl.set(f,i),i}getSvgByName(c){return this.iconsByUrl.has(c)?un(this.iconsByUrl.get(c)):this.iconsLoadingByUrl.has(c)?this.iconsLoadingByUrl.get(c):ml(`No svg with name '${c}' has been loaded`)}unloadSvg(c){this.iconsByUrl.has(c)&&this.iconsByUrl.delete(c)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function eZ(o){return o||new Kb}var e1={provide:Kb,deps:[[new tp,new Zg,Kb]],useFactory:eZ},Qb=class{constructor(){this.loaded=!1}},U3=(()=>{let n=class n{constructor(){this.element=vt(Or),this.differs=vt(a_),this.renderer=vt(Xc),this.iconReg=vt(Kb),this.src=Da.required(),this.name=Da(),this.stretch=Da(!1),this.applyClass=Da(!1),this.svgClass=Da(),this.klass=Da(void 0,{alias:"class"}),this.viewBox=Da(),this.svgAriaLabel=Da(),this.svg=jO(0),this.svgStyle=Da(),this.helper=new Qb,Ws(()=>{(this.src()||this.name())&&(this.destroy(),this.init(this.src(),this.name()))},{allowSignalWrites:!0}),Ws(()=>{let i=this.viewBox();this.svg()&&this.updateViewBox(i)}),Ws(()=>{let i=this.svgStyle()||{};this.svg()&&this.applyChanges(this.helper.differ.diff(i))}),Ws(()=>{let i=this.svg();this.applyClass()?this.setClass(this.elemSvg,null,this.klass()):this.setClass(this.elemSvg,this.klass(),null)});let c;Ws(()=>{let i=this.svg();this.setClass(this.elemSvg,c,this.svgClass()),c=this.svgClass()});let f;Ws(()=>{let i=this.svg(),w=this.element.nativeElement;this.setClass(w,f,this.klass()),this.setClass(this.elemSvg,f,this.applyClass()?this.klass():null),f=this.klass()}),Ws(()=>{let i=this.svg();this.doAria(this.svgAriaLabel())}),Ws(()=>{let i=this.svg();this.stylize(this.stretch())})}ngOnDestroy(){this.destroy()}get elemSvg(){return this.element.nativeElement.firstChild}init(c,f){if(f){let i=this.iconReg.getSvgByName(f);i&&(this.helper.icnSub=i.subscribe(w=>this.initSvg(w)))}else if(c){let i=this.iconReg.loadSvg(c);i&&(this.helper.icnSub=i.subscribe(w=>this.initSvg(w)))}else this.element.nativeElement.innerHTML="",this.svg.set(0)}initSvg(c){!this.helper.loaded&&c&&this.setSvg(c)}destroy(){this.helper.icnSub?.unsubscribe(),this.helper=new Qb,this.helper.differ=this.differs.find({}).create()}setSvg(c){if(!this.helper.loaded&&c){this.helper.svg=c;let f=c.cloneNode(!0),i=this.element.nativeElement;i.innerHTML="",this.renderer.appendChild(i,f),this.helper.loaded=!0,this.copyNgContentAttribute(i,f),this.svg.update(w=>w+1)}}updateViewBox(c){if(c){let f=this.elemSvg;if(c==="auto"){let i=f.getAttribute("width"),w=f.getAttribute("height");if(w&&i){let C=`0 0 ${i} ${w}`;this.renderer.setAttribute(f,"viewBox",C),this.renderer.removeAttribute(f,"width"),this.renderer.removeAttribute(f,"height")}}else c!==""&&(this.renderer.setAttribute(f,"viewBox",c),this.renderer.removeAttribute(f,"width"),this.renderer.removeAttribute(f,"height"))}}copyNgContentAttribute(c,f){let i=c.attributes,w=i.length;for(let C=0;C<w;C+=1){let A=i.item(C);if(A&&A.name.startsWith("_ngcontent")){this.setNgContentAttribute(f,A.name);break}}}setNgContentAttribute(c,f){this.renderer.setAttribute(c,f,"");let i=c.childNodes.length;for(let w=0;w<i;w+=1){let C=c.childNodes[w];C instanceof Element&&this.setNgContentAttribute(C,f)}}stylize(c){if(this.helper.svg){let f=this.element.nativeElement.firstChild;c===!0?this.renderer.setAttribute(f,"preserveAspectRatio","none"):c===!1&&this.renderer.removeAttribute(f,"preserveAspectRatio")}}applyChanges(c){c&&(c.forEachRemovedItem(f=>this.setStyle(f.key,null)),c.forEachAddedItem(f=>this.setStyle(f.key,f.currentValue)),c.forEachChangedItem(f=>this.setStyle(f.key,f.currentValue)))}setStyle(c,f){let[i,w]=c.split(".");f=f!==null&&w?`${f}${w}`:f;let C=this.elemSvg;f!==null?this.renderer.setStyle(C,i,f):this.renderer.removeStyle(C,i)}setClass(c,f,i){if(c){if(f){let w=(Array.isArray(f)?f:f.split(" ")).filter(C=>C);for(let C of w)this.renderer.removeClass(c,C)}if(i){let w=(Array.isArray(i)?i:i.split(" ")).filter(C=>C);for(let C of w)this.renderer.addClass(c,C)}}}doAria(c){let f=this.element.nativeElement.firstChild;f&&!(c===void 0&&f.hasAttribute("aria-label"))&&(c===""?(this.renderer.setAttribute(f,"aria-hidden","true"),this.renderer.removeAttribute(f,"aria-label")):(this.renderer.removeAttribute(f,"aria-hidden"),this.renderer.setAttribute(f,"aria-label",c)))}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["svg-icon"]],inputs:{src:[Ni.SignalBased,"src"],name:[Ni.SignalBased,"name"],stretch:[Ni.SignalBased,"stretch"],applyClass:[Ni.SignalBased,"applyClass"],svgClass:[Ni.SignalBased,"svgClass"],klass:[Ni.SignalBased,"class","klass"],viewBox:[Ni.SignalBased,"viewBox"],svgAriaLabel:[Ni.SignalBased,"svgAriaLabel"],svgStyle:[Ni.SignalBased,"svgStyle"]},standalone:!0,features:[bi],ngContentSelectors:QW,decls:1,vars:0,template:function(f,i){f&1&&(Jc(),eu(0))},encapsulation:2,changeDetection:0});let o=n;return o})();function $3(o={}){return Zc([e1,o.loader||{provide:fu,useClass:Jb}])}var G3=(()=>{let n=class n{static forRoot(c={}){return{ngModule:n,providers:[e1,c.loader||{provide:fu,useClass:Jb}]}}};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=kr({type:n}),n.\u0275inj=Rr({});let o=n;return o})();var Rn=function(o){return o[o.State=0]="State",o[o.Transition=1]="Transition",o[o.Sequence=2]="Sequence",o[o.Group=3]="Group",o[o.Animate=4]="Animate",o[o.Keyframes=5]="Keyframes",o[o.Style=6]="Style",o[o.Trigger=7]="Trigger",o[o.Reference=8]="Reference",o[o.AnimateChild=9]="AnimateChild",o[o.AnimateRef=10]="AnimateRef",o[o.Query=11]="Query",o[o.Stagger=12]="Stagger",o}(Rn||{}),ka="*";function H3(o,n){return{type:Rn.Trigger,name:o,definitions:n,options:{}}}function $S(o,n=null){return{type:Rn.Animate,styles:n,timings:o}}function q3(o,n=null){return{type:Rn.Group,steps:o,options:n}}function W3(o,n=null){return{type:Rn.Sequence,steps:o,options:n}}function Sl(o){return{type:Rn.Style,styles:o,offset:null}}function Z3(o,n,l=null){return{type:Rn.Transition,expr:o,animation:n,options:l}}function t1(o,n,l=null){return{type:Rn.Query,selector:o,animation:n,options:l}}var pu=class{constructor(n=0,l=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=n+l}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(n=>n()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(n){this._position=this.totalTime?n*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(n){let l=n=="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},iy=class{constructor(n){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=n;let l=0,c=0,f=0,i=this.players.length;i==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(w=>{w.onDone(()=>{++l==i&&this._onFinish()}),w.onDestroy(()=>{++c==i&&this._onDestroy()}),w.onStart(()=>{++f==i&&this._onStart()})}),this.totalTime=this.players.reduce((w,C)=>Math.max(w,C.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this.players.forEach(n=>n.init())}onStart(n){this._onStartFns.push(n)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(n=>n()),this._onStartFns=[])}onDone(n){this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(n=>n.play())}pause(){this.players.forEach(n=>n.pause())}restart(){this.players.forEach(n=>n.restart())}finish(){this._onFinish(),this.players.forEach(n=>n.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(n=>n.destroy()),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this.players.forEach(n=>n.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(n){let l=n*this.totalTime;this.players.forEach(c=>{let f=c.totalTime?Math.min(1,l/c.totalTime):1;c.setPosition(f)})}getPosition(){let n=this.players.reduce((l,c)=>l===null||c.totalTime>l.totalTime?c:l,null);return n!=null?n.getPosition():0}beforeDestroy(){this.players.forEach(n=>{n.beforeDestroy&&n.beforeDestroy()})}triggerCallback(n){let l=n=="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},n1="!";function Y3(o){return new bt(3e3,!1)}function nZ(){return new bt(3100,!1)}function iZ(){return new bt(3101,!1)}function rZ(o){return new bt(3001,!1)}function oZ(o){return new bt(3003,!1)}function sZ(o){return new bt(3004,!1)}function aZ(o,n){return new bt(3005,!1)}function lZ(){return new bt(3006,!1)}function cZ(){return new bt(3007,!1)}function uZ(o,n){return new bt(3008,!1)}function hZ(o){return new bt(3002,!1)}function dZ(o,n,l,c,f){return new bt(3010,!1)}function fZ(){return new bt(3011,!1)}function pZ(){return new bt(3012,!1)}function mZ(){return new bt(3200,!1)}function gZ(){return new bt(3202,!1)}function _Z(){return new bt(3013,!1)}function yZ(o){return new bt(3014,!1)}function vZ(o){return new bt(3015,!1)}function xZ(o){return new bt(3016,!1)}function bZ(o,n){return new bt(3404,!1)}function wZ(o){return new bt(3502,!1)}function TZ(o){return new bt(3503,!1)}function EZ(){return new bt(3300,!1)}function IZ(o){return new bt(3504,!1)}function CZ(o){return new bt(3301,!1)}function SZ(o,n){return new bt(3302,!1)}function DZ(o){return new bt(3303,!1)}function MZ(o,n){return new bt(3400,!1)}function AZ(o){return new bt(3401,!1)}function PZ(o){return new bt(3402,!1)}function RZ(o,n){return new bt(3505,!1)}function mu(o){switch(o.length){case 0:return new pu;case 1:return o[0];default:return new iy(o)}}function cz(o,n,l=new Map,c=new Map){let f=[],i=[],w=-1,C=null;if(n.forEach(A=>{let L=A.get("offset"),U=L==w,Q=U&&C||new Map;A.forEach((fe,he)=>{let be=he,Se=fe;if(he!=="offset")switch(be=o.normalizePropertyName(be,f),Se){case n1:Se=l.get(he);break;case ka:Se=c.get(he);break;default:Se=o.normalizeStyleValue(he,be,Se,f);break}Q.set(be,Se)}),U||i.push(Q),C=Q,w=L}),f.length)throw wZ(f);return i}function dD(o,n,l,c){switch(n){case"start":o.onStart(()=>c(l&&GS(l,"start",o)));break;case"done":o.onDone(()=>c(l&&GS(l,"done",o)));break;case"destroy":o.onDestroy(()=>c(l&&GS(l,"destroy",o)));break}}function GS(o,n,l){let c=l.totalTime,f=!!l.disabled,i=fD(o.element,o.triggerName,o.fromState,o.toState,n||o.phaseName,c??o.totalTime,f),w=o._data;return w!=null&&(i._data=w),i}function fD(o,n,l,c,f="",i=0,w){return{element:o,triggerName:n,fromState:l,toState:c,phaseName:f,totalTime:i,disabled:!!w}}function qo(o,n,l){let c=o.get(n);return c||o.set(n,c=l),c}function X3(o){let n=o.indexOf(":"),l=o.substring(1,n),c=o.slice(n+1);return[l,c]}var kZ=typeof document>"u"?null:document.documentElement;function pD(o){let n=o.parentNode||o.host||null;return n===kZ?null:n}function OZ(o){return o.substring(1,6)=="ebkit"}var sd=null,K3=!1;function LZ(o){sd||(sd=FZ()||{},K3=sd.style?"WebkitAppearance"in sd.style:!1);let n=!0;return sd.style&&!OZ(o)&&(n=o in sd.style,!n&&K3&&(n="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in sd.style)),n}function FZ(){return typeof document<"u"?document.body:null}function uz(o,n){for(;n;){if(n===o)return!0;n=pD(n)}return!1}function hz(o,n,l){if(l)return Array.from(o.querySelectorAll(n));let c=o.querySelector(n);return c?[c]:[]}var mD=(()=>{let n=class n{validateStyleProperty(c){return LZ(c)}containsElement(c,f){return uz(c,f)}getParentElement(c){return pD(c)}query(c,f,i){return hz(c,f,i)}computeStyle(c,f,i){return i||""}animate(c,f,i,w,C,A=[],L){return new pu(i,w)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})(),vD=class vD{};vD.NOOP=new mD;var cd=vD,ud=class{};var NZ=1e3,dz="{{",zZ="}}",fz="ng-enter",XS="ng-leave",i1="ng-trigger",l1=".ng-trigger",Q3="ng-animating",KS=".ng-animating";function Dl(o){if(typeof o=="number")return o;let n=o.match(/^(-?[\.\d]+)(m?s)/);return!n||n.length<2?0:QS(parseFloat(n[1]),n[2])}function QS(o,n){switch(n){case"s":return o*NZ;default:return o}}function c1(o,n,l){return o.hasOwnProperty("duration")?o:BZ(o,n,l)}function BZ(o,n,l){let c=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,f,i=0,w="";if(typeof o=="string"){let C=o.match(c);if(C===null)return n.push(Y3(o)),{duration:0,delay:0,easing:""};f=QS(parseFloat(C[1]),C[2]);let A=C[3];A!=null&&(i=QS(parseFloat(A),C[4]));let L=C[5];L&&(w=L)}else f=o;if(!l){let C=!1,A=n.length;f<0&&(n.push(nZ()),C=!0),i<0&&(n.push(iZ()),C=!0),C&&n.splice(A,0,Y3(o))}return{duration:f,delay:i,easing:w}}function VZ(o){return o.length?o[0]instanceof Map?o:o.map(n=>new Map(Object.entries(n))):[]}function Oa(o,n,l){n.forEach((c,f)=>{let i=gD(f);l&&!l.has(f)&&l.set(f,o.style[i]),o.style[i]=c})}function ld(o,n){n.forEach((l,c)=>{let f=gD(c);o.style[f]=""})}function ry(o){return Array.isArray(o)?o.length==1?o[0]:W3(o):o}function jZ(o,n,l){let c=n.params||{},f=pz(o);f.length&&f.forEach(i=>{c.hasOwnProperty(i)||l.push(rZ(i))})}var JS=new RegExp(`${dz}\\s*(.+?)\\s*${zZ}`,"g");function pz(o){let n=[];if(typeof o=="string"){let l;for(;l=JS.exec(o);)n.push(l[1]);JS.lastIndex=0}return n}function sy(o,n,l){let c=`${o}`,f=c.replace(JS,(i,w)=>{let C=n[w];return C==null&&(l.push(oZ(w)),C=""),C.toString()});return f==c?o:f}var UZ=/-+([a-z0-9])/g;function gD(o){return o.replace(UZ,(...n)=>n[1].toUpperCase())}function $Z(o,n){return o===0||n===0}function GZ(o,n,l){if(l.size&&n.length){let c=n[0],f=[];if(l.forEach((i,w)=>{c.has(w)||f.push(w),c.set(w,i)}),f.length)for(let i=1;i<n.length;i++){let w=n[i];f.forEach(C=>w.set(C,_D(o,C)))}}return n}function Ho(o,n,l){switch(n.type){case Rn.Trigger:return o.visitTrigger(n,l);case Rn.State:return o.visitState(n,l);case Rn.Transition:return o.visitTransition(n,l);case Rn.Sequence:return o.visitSequence(n,l);case Rn.Group:return o.visitGroup(n,l);case Rn.Animate:return o.visitAnimate(n,l);case Rn.Keyframes:return o.visitKeyframes(n,l);case Rn.Style:return o.visitStyle(n,l);case Rn.Reference:return o.visitReference(n,l);case Rn.AnimateChild:return o.visitAnimateChild(n,l);case Rn.AnimateRef:return o.visitAnimateRef(n,l);case Rn.Query:return o.visitQuery(n,l);case Rn.Stagger:return o.visitStagger(n,l);default:throw sZ(n.type)}}function _D(o,n){return window.getComputedStyle(o)[n]}var HZ=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),u1=class extends ud{normalizePropertyName(n,l){return gD(n)}normalizeStyleValue(n,l,c,f){let i="",w=c.toString().trim();if(HZ.has(l)&&c!==0&&c!=="0")if(typeof c=="number")i="px";else{let C=c.match(/^[+-]?[\d\.]+([a-z]*)$/);C&&C[1].length==0&&f.push(aZ(n,c))}return w+i}};var h1="*";function qZ(o,n){let l=[];return typeof o=="string"?o.split(/\s*,\s*/).forEach(c=>WZ(c,l,n)):l.push(o),l}function WZ(o,n,l){if(o[0]==":"){let A=ZZ(o,l);if(typeof A=="function"){n.push(A);return}o=A}let c=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(c==null||c.length<4)return l.push(vZ(o)),n;let f=c[1],i=c[2],w=c[3];n.push(J3(f,w));let C=f==h1&&w==h1;i[0]=="<"&&!C&&n.push(J3(w,f))}function ZZ(o,n){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(l,c)=>parseFloat(c)>parseFloat(l);case":decrement":return(l,c)=>parseFloat(c)<parseFloat(l);default:return n.push(xZ(o)),"* => *"}}var r1=new Set(["true","1"]),o1=new Set(["false","0"]);function J3(o,n){let l=r1.has(o)||o1.has(o),c=r1.has(n)||o1.has(n);return(f,i)=>{let w=o==h1||o==f,C=n==h1||n==i;return!w&&l&&typeof f=="boolean"&&(w=f?r1.has(o):o1.has(o)),!C&&c&&typeof i=="boolean"&&(C=i?r1.has(n):o1.has(n)),w&&C}}var mz=":self",YZ=new RegExp(`s*${mz}s*,?`,"g");function gz(o,n,l,c){return new eD(o).build(n,l,c)}var ez="",eD=class{constructor(n){this._driver=n}build(n,l,c){let f=new tD(l);return this._resetContextStyleTimingState(f),Ho(this,ry(n),f)}_resetContextStyleTimingState(n){n.currentQuerySelector=ez,n.collectedStyles=new Map,n.collectedStyles.set(ez,new Map),n.currentTime=0}visitTrigger(n,l){let c=l.queryCount=0,f=l.depCount=0,i=[],w=[];return n.name.charAt(0)=="@"&&l.errors.push(lZ()),n.definitions.forEach(C=>{if(this._resetContextStyleTimingState(l),C.type==Rn.State){let A=C,L=A.name;L.toString().split(/\s*,\s*/).forEach(U=>{A.name=U,i.push(this.visitState(A,l))}),A.name=L}else if(C.type==Rn.Transition){let A=this.visitTransition(C,l);c+=A.queryCount,f+=A.depCount,w.push(A)}else l.errors.push(cZ())}),{type:Rn.Trigger,name:n.name,states:i,transitions:w,queryCount:c,depCount:f,options:null}}visitState(n,l){let c=this.visitStyle(n.styles,l),f=n.options&&n.options.params||null;if(c.containsDynamicStyles){let i=new Set,w=f||{};c.styles.forEach(C=>{C instanceof Map&&C.forEach(A=>{pz(A).forEach(L=>{w.hasOwnProperty(L)||i.add(L)})})}),i.size&&l.errors.push(uZ(n.name,[...i.values()]))}return{type:Rn.State,name:n.name,style:c,options:f?{params:f}:null}}visitTransition(n,l){l.queryCount=0,l.depCount=0;let c=Ho(this,ry(n.animation),l),f=qZ(n.expr,l.errors);return{type:Rn.Transition,matchers:f,animation:c,queryCount:l.queryCount,depCount:l.depCount,options:ad(n.options)}}visitSequence(n,l){return{type:Rn.Sequence,steps:n.steps.map(c=>Ho(this,c,l)),options:ad(n.options)}}visitGroup(n,l){let c=l.currentTime,f=0,i=n.steps.map(w=>{l.currentTime=c;let C=Ho(this,w,l);return f=Math.max(f,l.currentTime),C});return l.currentTime=f,{type:Rn.Group,steps:i,options:ad(n.options)}}visitAnimate(n,l){let c=JZ(n.timings,l.errors);l.currentAnimateTimings=c;let f,i=n.styles?n.styles:Sl({});if(i.type==Rn.Keyframes)f=this.visitKeyframes(i,l);else{let w=n.styles,C=!1;if(!w){C=!0;let L={};c.easing&&(L.easing=c.easing),w=Sl(L)}l.currentTime+=c.duration+c.delay;let A=this.visitStyle(w,l);A.isEmptyStep=C,f=A}return l.currentAnimateTimings=null,{type:Rn.Animate,timings:c,style:f,options:null}}visitStyle(n,l){let c=this._makeStyleAst(n,l);return this._validateStyleAst(c,l),c}_makeStyleAst(n,l){let c=[],f=Array.isArray(n.styles)?n.styles:[n.styles];for(let C of f)typeof C=="string"?C===ka?c.push(C):l.errors.push(hZ(C)):c.push(new Map(Object.entries(C)));let i=!1,w=null;return c.forEach(C=>{if(C instanceof Map&&(C.has("easing")&&(w=C.get("easing"),C.delete("easing")),!i)){for(let A of C.values())if(A.toString().indexOf(dz)>=0){i=!0;break}}}),{type:Rn.Style,styles:c,easing:w,offset:n.offset,containsDynamicStyles:i,options:null}}_validateStyleAst(n,l){let c=l.currentAnimateTimings,f=l.currentTime,i=l.currentTime;c&&i>0&&(i-=c.duration+c.delay),n.styles.forEach(w=>{typeof w!="string"&&w.forEach((C,A)=>{let L=l.collectedStyles.get(l.currentQuerySelector),U=L.get(A),Q=!0;U&&(i!=f&&i>=U.startTime&&f<=U.endTime&&(l.errors.push(dZ(A,U.startTime,U.endTime,i,f)),Q=!1),i=U.startTime),Q&&L.set(A,{startTime:i,endTime:f}),l.options&&jZ(C,l.options,l.errors)})})}visitKeyframes(n,l){let c={type:Rn.Keyframes,styles:[],options:null};if(!l.currentAnimateTimings)return l.errors.push(fZ()),c;let f=1,i=0,w=[],C=!1,A=!1,L=0,U=n.steps.map(Fe=>{let tt=this._makeStyleAst(Fe,l),ft=tt.offset!=null?tt.offset:QZ(tt.styles),Ue=0;return ft!=null&&(i++,Ue=tt.offset=ft),A=A||Ue<0||Ue>1,C=C||Ue<L,L=Ue,w.push(Ue),tt});A&&l.errors.push(pZ()),C&&l.errors.push(mZ());let Q=n.steps.length,fe=0;i>0&&i<Q?l.errors.push(gZ()):i==0&&(fe=f/(Q-1));let he=Q-1,be=l.currentTime,Se=l.currentAnimateTimings,Ke=Se.duration;return U.forEach((Fe,tt)=>{let ft=fe>0?tt==he?1:fe*tt:w[tt],Ue=ft*Ke;l.currentTime=be+Se.delay+Ue,Se.duration=Ue,this._validateStyleAst(Fe,l),Fe.offset=ft,c.styles.push(Fe)}),c}visitReference(n,l){return{type:Rn.Reference,animation:Ho(this,ry(n.animation),l),options:ad(n.options)}}visitAnimateChild(n,l){return l.depCount++,{type:Rn.AnimateChild,options:ad(n.options)}}visitAnimateRef(n,l){return{type:Rn.AnimateRef,animation:this.visitReference(n.animation,l),options:ad(n.options)}}visitQuery(n,l){let c=l.currentQuerySelector,f=n.options||{};l.queryCount++,l.currentQuery=n;let[i,w]=XZ(n.selector);l.currentQuerySelector=c.length?c+" "+i:i,qo(l.collectedStyles,l.currentQuerySelector,new Map);let C=Ho(this,ry(n.animation),l);return l.currentQuery=null,l.currentQuerySelector=c,{type:Rn.Query,selector:i,limit:f.limit||0,optional:!!f.optional,includeSelf:w,animation:C,originalSelector:n.selector,options:ad(n.options)}}visitStagger(n,l){l.currentQuery||l.errors.push(_Z());let c=n.timings==="full"?{duration:0,delay:0,easing:"full"}:c1(n.timings,l.errors,!0);return{type:Rn.Stagger,animation:Ho(this,ry(n.animation),l),timings:c,options:null}}};function XZ(o){let n=!!o.split(/\s*,\s*/).find(l=>l==mz);return n&&(o=o.replace(YZ,"")),o=o.replace(/@\*/g,l1).replace(/@\w+/g,l=>l1+"-"+l.slice(1)).replace(/:animating/g,KS),[o,n]}function KZ(o){return o?gt({},o):null}var tD=class{constructor(n){this.errors=n,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function QZ(o){if(typeof o=="string")return null;let n=null;if(Array.isArray(o))o.forEach(l=>{if(l instanceof Map&&l.has("offset")){let c=l;n=parseFloat(c.get("offset")),c.delete("offset")}});else if(o instanceof Map&&o.has("offset")){let l=o;n=parseFloat(l.get("offset")),l.delete("offset")}return n}function JZ(o,n){if(o.hasOwnProperty("duration"))return o;if(typeof o=="number"){let i=c1(o,n).duration;return HS(i,0,"")}let l=o;if(l.split(/\s+/).some(i=>i.charAt(0)=="{"&&i.charAt(1)=="{")){let i=HS(0,0,"");return i.dynamic=!0,i.strValue=l,i}let f=c1(l,n);return HS(f.duration,f.delay,f.easing)}function ad(o){return o?(o=gt({},o),o.params&&(o.params=KZ(o.params))):o={},o}function HS(o,n,l){return{duration:o,delay:n,easing:l}}function yD(o,n,l,c,f,i,w=null,C=!1){return{type:1,element:o,keyframes:n,preStyleProps:l,postStyleProps:c,duration:f,delay:i,totalTime:f+i,easing:w,subTimeline:C}}var ay=class{constructor(){this._map=new Map}get(n){return this._map.get(n)||[]}append(n,l){let c=this._map.get(n);c||this._map.set(n,c=[]),c.push(...l)}has(n){return this._map.has(n)}clear(){this._map.clear()}},eY=1,tY=":enter",nY=new RegExp(tY,"g"),iY=":leave",rY=new RegExp(iY,"g");function _z(o,n,l,c,f,i=new Map,w=new Map,C,A,L=[]){return new nD().buildKeyframes(o,n,l,c,f,i,w,C,A,L)}var nD=class{buildKeyframes(n,l,c,f,i,w,C,A,L,U=[]){L=L||new ay;let Q=new iD(n,l,L,f,i,U,[]);Q.options=A;let fe=A.delay?Dl(A.delay):0;Q.currentTimeline.delayNextStep(fe),Q.currentTimeline.setStyles([w],null,Q.errors,A),Ho(this,c,Q);let he=Q.timelines.filter(be=>be.containsAnimation());if(he.length&&C.size){let be;for(let Se=he.length-1;Se>=0;Se--){let Ke=he[Se];if(Ke.element===l){be=Ke;break}}be&&!be.allowOnlyTimelineStyles()&&be.setStyles([C],null,Q.errors,A)}return he.length?he.map(be=>be.buildKeyframes()):[yD(l,[],[],[],0,fe,"",!1)]}visitTrigger(n,l){}visitState(n,l){}visitTransition(n,l){}visitAnimateChild(n,l){let c=l.subInstructions.get(l.element);if(c){let f=l.createSubContext(n.options),i=l.currentTimeline.currentTime,w=this._visitSubInstructions(c,f,f.options);i!=w&&l.transformIntoNewTimeline(w)}l.previousNode=n}visitAnimateRef(n,l){let c=l.createSubContext(n.options);c.transformIntoNewTimeline(),this._applyAnimationRefDelays([n.options,n.animation.options],l,c),this.visitReference(n.animation,c),l.transformIntoNewTimeline(c.currentTimeline.currentTime),l.previousNode=n}_applyAnimationRefDelays(n,l,c){for(let f of n){let i=f?.delay;if(i){let w=typeof i=="number"?i:Dl(sy(i,f?.params??{},l.errors));c.delayNextStep(w)}}}_visitSubInstructions(n,l,c){let i=l.currentTimeline.currentTime,w=c.duration!=null?Dl(c.duration):null,C=c.delay!=null?Dl(c.delay):null;return w!==0&&n.forEach(A=>{let L=l.appendInstructionToTimeline(A,w,C);i=Math.max(i,L.duration+L.delay)}),i}visitReference(n,l){l.updateOptions(n.options,!0),Ho(this,n.animation,l),l.previousNode=n}visitSequence(n,l){let c=l.subContextCount,f=l,i=n.options;if(i&&(i.params||i.delay)&&(f=l.createSubContext(i),f.transformIntoNewTimeline(),i.delay!=null)){f.previousNode.type==Rn.Style&&(f.currentTimeline.snapshotCurrentStyles(),f.previousNode=d1);let w=Dl(i.delay);f.delayNextStep(w)}n.steps.length&&(n.steps.forEach(w=>Ho(this,w,f)),f.currentTimeline.applyStylesToKeyframe(),f.subContextCount>c&&f.transformIntoNewTimeline()),l.previousNode=n}visitGroup(n,l){let c=[],f=l.currentTimeline.currentTime,i=n.options&&n.options.delay?Dl(n.options.delay):0;n.steps.forEach(w=>{let C=l.createSubContext(n.options);i&&C.delayNextStep(i),Ho(this,w,C),f=Math.max(f,C.currentTimeline.currentTime),c.push(C.currentTimeline)}),c.forEach(w=>l.currentTimeline.mergeTimelineCollectedStyles(w)),l.transformIntoNewTimeline(f),l.previousNode=n}_visitTiming(n,l){if(n.dynamic){let c=n.strValue,f=l.params?sy(c,l.params,l.errors):c;return c1(f,l.errors)}else return{duration:n.duration,delay:n.delay,easing:n.easing}}visitAnimate(n,l){let c=l.currentAnimateTimings=this._visitTiming(n.timings,l),f=l.currentTimeline;c.delay&&(l.incrementTime(c.delay),f.snapshotCurrentStyles());let i=n.style;i.type==Rn.Keyframes?this.visitKeyframes(i,l):(l.incrementTime(c.duration),this.visitStyle(i,l),f.applyStylesToKeyframe()),l.currentAnimateTimings=null,l.previousNode=n}visitStyle(n,l){let c=l.currentTimeline,f=l.currentAnimateTimings;!f&&c.hasCurrentStyleProperties()&&c.forwardFrame();let i=f&&f.easing||n.easing;n.isEmptyStep?c.applyEmptyStep(i):c.setStyles(n.styles,i,l.errors,l.options),l.previousNode=n}visitKeyframes(n,l){let c=l.currentAnimateTimings,f=l.currentTimeline.duration,i=c.duration,C=l.createSubContext().currentTimeline;C.easing=c.easing,n.styles.forEach(A=>{let L=A.offset||0;C.forwardTime(L*i),C.setStyles(A.styles,A.easing,l.errors,l.options),C.applyStylesToKeyframe()}),l.currentTimeline.mergeTimelineCollectedStyles(C),l.transformIntoNewTimeline(f+i),l.previousNode=n}visitQuery(n,l){let c=l.currentTimeline.currentTime,f=n.options||{},i=f.delay?Dl(f.delay):0;i&&(l.previousNode.type===Rn.Style||c==0&&l.currentTimeline.hasCurrentStyleProperties())&&(l.currentTimeline.snapshotCurrentStyles(),l.previousNode=d1);let w=c,C=l.invokeQuery(n.selector,n.originalSelector,n.limit,n.includeSelf,!!f.optional,l.errors);l.currentQueryTotal=C.length;let A=null;C.forEach((L,U)=>{l.currentQueryIndex=U;let Q=l.createSubContext(n.options,L);i&&Q.delayNextStep(i),L===l.element&&(A=Q.currentTimeline),Ho(this,n.animation,Q),Q.currentTimeline.applyStylesToKeyframe();let fe=Q.currentTimeline.currentTime;w=Math.max(w,fe)}),l.currentQueryIndex=0,l.currentQueryTotal=0,l.transformIntoNewTimeline(w),A&&(l.currentTimeline.mergeTimelineCollectedStyles(A),l.currentTimeline.snapshotCurrentStyles()),l.previousNode=n}visitStagger(n,l){let c=l.parentContext,f=l.currentTimeline,i=n.timings,w=Math.abs(i.duration),C=w*(l.currentQueryTotal-1),A=w*l.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":A=C-A;break;case"full":A=c.currentStaggerTime;break}let U=l.currentTimeline;A&&U.delayNextStep(A);let Q=U.currentTime;Ho(this,n.animation,l),l.previousNode=n,c.currentStaggerTime=f.currentTime-Q+(f.startTime-c.currentTimeline.startTime)}},d1={},iD=class o{constructor(n,l,c,f,i,w,C,A){this._driver=n,this.element=l,this.subInstructions=c,this._enterClassName=f,this._leaveClassName=i,this.errors=w,this.timelines=C,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=d1,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=A||new f1(this._driver,l,0),C.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(n,l){if(!n)return;let c=n,f=this.options;c.duration!=null&&(f.duration=Dl(c.duration)),c.delay!=null&&(f.delay=Dl(c.delay));let i=c.params;if(i){let w=f.params;w||(w=this.options.params={}),Object.keys(i).forEach(C=>{(!l||!w.hasOwnProperty(C))&&(w[C]=sy(i[C],w,this.errors))})}}_copyOptions(){let n={};if(this.options){let l=this.options.params;if(l){let c=n.params={};Object.keys(l).forEach(f=>{c[f]=l[f]})}}return n}createSubContext(n=null,l,c){let f=l||this.element,i=new o(this._driver,f,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(f,c||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(n),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(n){return this.previousNode=d1,this.currentTimeline=this.currentTimeline.fork(this.element,n),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(n,l,c){let f={duration:l??n.duration,delay:this.currentTimeline.currentTime+(c??0)+n.delay,easing:""},i=new rD(this._driver,n.element,n.keyframes,n.preStyleProps,n.postStyleProps,f,n.stretchStartingKeyframe);return this.timelines.push(i),f}incrementTime(n){this.currentTimeline.forwardTime(this.currentTimeline.duration+n)}delayNextStep(n){n>0&&this.currentTimeline.delayNextStep(n)}invokeQuery(n,l,c,f,i,w){let C=[];if(f&&C.push(this.element),n.length>0){n=n.replace(nY,"."+this._enterClassName),n=n.replace(rY,"."+this._leaveClassName);let A=c!=1,L=this._driver.query(this.element,n,A);c!==0&&(L=c<0?L.slice(L.length+c,L.length):L.slice(0,c)),C.push(...L)}return!i&&C.length==0&&w.push(yZ(l)),C}},f1=class o{constructor(n,l,c,f){this._driver=n,this.element=l,this.startTime=c,this._elementTimelineStylesLookup=f,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(l),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(l,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(n){let l=this._keyframes.size===1&&this._pendingStyles.size;this.duration||l?(this.forwardTime(this.currentTime+n),l&&this.snapshotCurrentStyles()):this.startTime+=n}fork(n,l){return this.applyStylesToKeyframe(),new o(this._driver,n,l||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=eY,this._loadKeyframe()}forwardTime(n){this.applyStylesToKeyframe(),this.duration=n,this._loadKeyframe()}_updateStyle(n,l){this._localTimelineStyles.set(n,l),this._globalTimelineStyles.set(n,l),this._styleSummary.set(n,{time:this.currentTime,value:l})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(n){n&&this._previousKeyframe.set("easing",n);for(let[l,c]of this._globalTimelineStyles)this._backFill.set(l,c||ka),this._currentKeyframe.set(l,ka);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(n,l,c,f){l&&this._previousKeyframe.set("easing",l);let i=f&&f.params||{},w=oY(n,this._globalTimelineStyles);for(let[C,A]of w){let L=sy(A,i,c);this._pendingStyles.set(C,L),this._localTimelineStyles.has(C)||this._backFill.set(C,this._globalTimelineStyles.get(C)??ka),this._updateStyle(C,L)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((n,l)=>{this._currentKeyframe.set(l,n)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((n,l)=>{this._currentKeyframe.has(l)||this._currentKeyframe.set(l,n)}))}snapshotCurrentStyles(){for(let[n,l]of this._localTimelineStyles)this._pendingStyles.set(n,l),this._updateStyle(n,l)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let n=[];for(let l in this._currentKeyframe)n.push(l);return n}mergeTimelineCollectedStyles(n){n._styleSummary.forEach((l,c)=>{let f=this._styleSummary.get(c);(!f||l.time>f.time)&&this._updateStyle(c,l.value)})}buildKeyframes(){this.applyStylesToKeyframe();let n=new Set,l=new Set,c=this._keyframes.size===1&&this.duration===0,f=[];this._keyframes.forEach((C,A)=>{let L=new Map([...this._backFill,...C]);L.forEach((U,Q)=>{U===n1?n.add(Q):U===ka&&l.add(Q)}),c||L.set("offset",A/this.duration),f.push(L)});let i=[...n.values()],w=[...l.values()];if(c){let C=f[0],A=new Map(C);C.set("offset",0),A.set("offset",1),f=[C,A]}return yD(this.element,f,i,w,this.duration,this.startTime,this.easing,!1)}},rD=class extends f1{constructor(n,l,c,f,i,w,C=!1){super(n,l,w.delay),this.keyframes=c,this.preStyleProps=f,this.postStyleProps=i,this._stretchStartingKeyframe=C,this.timings={duration:w.duration,delay:w.delay,easing:w.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let n=this.keyframes,{delay:l,duration:c,easing:f}=this.timings;if(this._stretchStartingKeyframe&&l){let i=[],w=c+l,C=l/w,A=new Map(n[0]);A.set("offset",0),i.push(A);let L=new Map(n[0]);L.set("offset",tz(C)),i.push(L);let U=n.length-1;for(let Q=1;Q<=U;Q++){let fe=new Map(n[Q]),he=fe.get("offset"),be=l+he*c;fe.set("offset",tz(be/w)),i.push(fe)}c=w,l=0,f="",n=i}return yD(this.element,n,this.preStyleProps,this.postStyleProps,c,l,f,!0)}};function tz(o,n=3){let l=Math.pow(10,n-1);return Math.round(o*l)/l}function oY(o,n){let l=new Map,c;return o.forEach(f=>{if(f==="*"){c??=n.keys();for(let i of c)l.set(i,ka)}else for(let[i,w]of f)l.set(i,w)}),l}function nz(o,n,l,c,f,i,w,C,A,L,U,Q,fe){return{type:0,element:o,triggerName:n,isRemovalTransition:f,fromState:l,fromStyles:i,toState:c,toStyles:w,timelines:C,queriedElements:A,preStyleProps:L,postStyleProps:U,totalTime:Q,errors:fe}}var qS={},p1=class{constructor(n,l,c){this._triggerName=n,this.ast=l,this._stateStyles=c}match(n,l,c,f){return sY(this.ast.matchers,n,l,c,f)}buildStyles(n,l,c){let f=this._stateStyles.get("*");return n!==void 0&&(f=this._stateStyles.get(n?.toString())||f),f?f.buildStyles(l,c):new Map}build(n,l,c,f,i,w,C,A,L,U){let Q=[],fe=this.ast.options&&this.ast.options.params||qS,he=C&&C.params||qS,be=this.buildStyles(c,he,Q),Se=A&&A.params||qS,Ke=this.buildStyles(f,Se,Q),Fe=new Set,tt=new Map,ft=new Map,Ue=f==="void",zt={params:yz(Se,fe),delay:this.ast.options?.delay},Kt=U?[]:_z(n,l,this.ast.animation,i,w,be,Ke,zt,L,Q),tn=0;return Kt.forEach(Tt=>{tn=Math.max(Tt.duration+Tt.delay,tn)}),Q.length?nz(l,this._triggerName,c,f,Ue,be,Ke,[],[],tt,ft,tn,Q):(Kt.forEach(Tt=>{let ri=Tt.element,Ct=qo(tt,ri,new Set);Tt.preStyleProps.forEach(Ci=>Ct.add(Ci));let Ti=qo(ft,ri,new Set);Tt.postStyleProps.forEach(Ci=>Ti.add(Ci)),ri!==l&&Fe.add(ri)}),nz(l,this._triggerName,c,f,Ue,be,Ke,Kt,[...Fe.values()],tt,ft,tn))}};function sY(o,n,l,c,f){return o.some(i=>i(n,l,c,f))}function yz(o,n){let l=gt({},n);return Object.entries(o).forEach(([c,f])=>{f!=null&&(l[c]=f)}),l}var oD=class{constructor(n,l,c){this.styles=n,this.defaultParams=l,this.normalizer=c}buildStyles(n,l){let c=new Map,f=yz(n,this.defaultParams);return this.styles.styles.forEach(i=>{typeof i!="string"&&i.forEach((w,C)=>{w&&(w=sy(w,f,l));let A=this.normalizer.normalizePropertyName(C,l);w=this.normalizer.normalizeStyleValue(C,A,w,l),c.set(C,w)})}),c}};function aY(o,n,l){return new sD(o,n,l)}var sD=class{constructor(n,l,c){this.name=n,this.ast=l,this._normalizer=c,this.transitionFactories=[],this.states=new Map,l.states.forEach(f=>{let i=f.options&&f.options.params||{};this.states.set(f.name,new oD(f.style,i,c))}),iz(this.states,"true","1"),iz(this.states,"false","0"),l.transitions.forEach(f=>{this.transitionFactories.push(new p1(n,f,this.states))}),this.fallbackTransition=lY(n,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(n,l,c,f){return this.transitionFactories.find(w=>w.match(n,l,c,f))||null}matchStyles(n,l,c){return this.fallbackTransition.buildStyles(n,l,c)}};function lY(o,n,l){let c=[(w,C)=>!0],f={type:Rn.Sequence,steps:[],options:null},i={type:Rn.Transition,animation:f,matchers:c,options:null,queryCount:0,depCount:0};return new p1(o,i,n)}function iz(o,n,l){o.has(n)?o.has(l)||o.set(l,o.get(n)):o.has(l)&&o.set(n,o.get(l))}var cY=new ay,aD=class{constructor(n,l,c){this.bodyNode=n,this._driver=l,this._normalizer=c,this._animations=new Map,this._playersById=new Map,this.players=[]}register(n,l){let c=[],f=[],i=gz(this._driver,l,c,f);if(c.length)throw TZ(c);f.length&&void 0,this._animations.set(n,i)}_buildPlayer(n,l,c){let f=n.element,i=cz(this._normalizer,n.keyframes,l,c);return this._driver.animate(f,i,n.duration,n.delay,n.easing,[],!0)}create(n,l,c={}){let f=[],i=this._animations.get(n),w,C=new Map;if(i?(w=_z(this._driver,l,i,fz,XS,new Map,new Map,c,cY,f),w.forEach(U=>{let Q=qo(C,U.element,new Map);U.postStyleProps.forEach(fe=>Q.set(fe,null))})):(f.push(EZ()),w=[]),f.length)throw IZ(f);C.forEach((U,Q)=>{U.forEach((fe,he)=>{U.set(he,this._driver.computeStyle(Q,he,ka))})});let A=w.map(U=>{let Q=C.get(U.element);return this._buildPlayer(U,new Map,Q)}),L=mu(A);return this._playersById.set(n,L),L.onDestroy(()=>this.destroy(n)),this.players.push(L),L}destroy(n){let l=this._getPlayer(n);l.destroy(),this._playersById.delete(n);let c=this.players.indexOf(l);c>=0&&this.players.splice(c,1)}_getPlayer(n){let l=this._playersById.get(n);if(!l)throw CZ(n);return l}listen(n,l,c,f){let i=fD(l,"","","");return dD(this._getPlayer(n),c,i,f),()=>{}}command(n,l,c,f){if(c=="register"){this.register(n,f[0]);return}if(c=="create"){let w=f[0]||{};this.create(n,l,w);return}let i=this._getPlayer(n);switch(c){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(f[0]));break;case"destroy":this.destroy(n);break}}},rz="ng-animate-queued",uY=".ng-animate-queued",WS="ng-animate-disabled",hY=".ng-animate-disabled",dY="ng-star-inserted",fY=".ng-star-inserted",pY=[],vz={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},mY={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ys="__ng_removed",ly=class{get params(){return this.options.params}constructor(n,l=""){this.namespaceId=l;let c=n&&n.hasOwnProperty("value"),f=c?n.value:n;if(this.value=_Y(f),c){let i=n,{value:w}=i,C=ls(i,["value"]);this.options=C}else this.options={};this.options.params||(this.options.params={})}absorbOptions(n){let l=n.params;if(l){let c=this.options.params;Object.keys(l).forEach(f=>{c[f]==null&&(c[f]=l[f])})}}},oy="void",ZS=new ly(oy),lD=class{constructor(n,l,c){this.id=n,this.hostElement=l,this._engine=c,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+n,ps(l,this._hostClassName)}listen(n,l,c,f){if(!this._triggers.has(l))throw SZ(c,l);if(c==null||c.length==0)throw DZ(l);if(!yY(c))throw MZ(c,l);let i=qo(this._elementListeners,n,[]),w={name:l,phase:c,callback:f};i.push(w);let C=qo(this._engine.statesByElement,n,new Map);return C.has(l)||(ps(n,i1),ps(n,i1+"-"+l),C.set(l,ZS)),()=>{this._engine.afterFlush(()=>{let A=i.indexOf(w);A>=0&&i.splice(A,1),this._triggers.has(l)||C.delete(l)})}}register(n,l){return this._triggers.has(n)?!1:(this._triggers.set(n,l),!0)}_getTrigger(n){let l=this._triggers.get(n);if(!l)throw AZ(n);return l}trigger(n,l,c,f=!0){let i=this._getTrigger(l),w=new cy(this.id,l,n),C=this._engine.statesByElement.get(n);C||(ps(n,i1),ps(n,i1+"-"+l),this._engine.statesByElement.set(n,C=new Map));let A=C.get(l),L=new ly(c,this.id);if(!(c&&c.hasOwnProperty("value"))&&A&&L.absorbOptions(A.options),C.set(l,L),A||(A=ZS),!(L.value===oy)&&A.value===L.value){if(!bY(A.params,L.params)){let Se=[],Ke=i.matchStyles(A.value,A.params,Se),Fe=i.matchStyles(L.value,L.params,Se);Se.length?this._engine.reportError(Se):this._engine.afterFlush(()=>{ld(n,Ke),Oa(n,Fe)})}return}let fe=qo(this._engine.playersByElement,n,[]);fe.forEach(Se=>{Se.namespaceId==this.id&&Se.triggerName==l&&Se.queued&&Se.destroy()});let he=i.matchTransition(A.value,L.value,n,L.params),be=!1;if(!he){if(!f)return;he=i.fallbackTransition,be=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:l,transition:he,fromState:A,toState:L,player:w,isFallbackTransition:be}),be||(ps(n,rz),w.onStart(()=>{kp(n,rz)})),w.onDone(()=>{let Se=this.players.indexOf(w);Se>=0&&this.players.splice(Se,1);let Ke=this._engine.playersByElement.get(n);if(Ke){let Fe=Ke.indexOf(w);Fe>=0&&Ke.splice(Fe,1)}}),this.players.push(w),fe.push(w),w}deregister(n){this._triggers.delete(n),this._engine.statesByElement.forEach(l=>l.delete(n)),this._elementListeners.forEach((l,c)=>{this._elementListeners.set(c,l.filter(f=>f.name!=n))})}clearElementCache(n){this._engine.statesByElement.delete(n),this._elementListeners.delete(n);let l=this._engine.playersByElement.get(n);l&&(l.forEach(c=>c.destroy()),this._engine.playersByElement.delete(n))}_signalRemovalForInnerTriggers(n,l){let c=this._engine.driver.query(n,l1,!0);c.forEach(f=>{if(f[Ys])return;let i=this._engine.fetchNamespacesByElement(f);i.size?i.forEach(w=>w.triggerLeaveAnimation(f,l,!1,!0)):this.clearElementCache(f)}),this._engine.afterFlushAnimationsDone(()=>c.forEach(f=>this.clearElementCache(f)))}triggerLeaveAnimation(n,l,c,f){let i=this._engine.statesByElement.get(n),w=new Map;if(i){let C=[];if(i.forEach((A,L)=>{if(w.set(L,A.value),this._triggers.has(L)){let U=this.trigger(n,L,oy,f);U&&C.push(U)}}),C.length)return this._engine.markElementAsRemoved(this.id,n,!0,l,w),c&&mu(C).onDone(()=>this._engine.processLeaveNode(n)),!0}return!1}prepareLeaveAnimationListeners(n){let l=this._elementListeners.get(n),c=this._engine.statesByElement.get(n);if(l&&c){let f=new Set;l.forEach(i=>{let w=i.name;if(f.has(w))return;f.add(w);let A=this._triggers.get(w).fallbackTransition,L=c.get(w)||ZS,U=new ly(oy),Q=new cy(this.id,w,n);this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:w,transition:A,fromState:L,toState:U,player:Q,isFallbackTransition:!0})})}}removeNode(n,l){let c=this._engine;if(n.childElementCount&&this._signalRemovalForInnerTriggers(n,l),this.triggerLeaveAnimation(n,l,!0))return;let f=!1;if(c.totalAnimations){let i=c.players.length?c.playersByQueriedElement.get(n):[];if(i&&i.length)f=!0;else{let w=n;for(;w=w.parentNode;)if(c.statesByElement.get(w)){f=!0;break}}}if(this.prepareLeaveAnimationListeners(n),f)c.markElementAsRemoved(this.id,n,!1,l);else{let i=n[Ys];(!i||i===vz)&&(c.afterFlush(()=>this.clearElementCache(n)),c.destroyInnerAnimations(n),c._onRemovalComplete(n,l))}}insertNode(n,l){ps(n,this._hostClassName)}drainQueuedTransitions(n){let l=[];return this._queue.forEach(c=>{let f=c.player;if(f.destroyed)return;let i=c.element,w=this._elementListeners.get(i);w&&w.forEach(C=>{if(C.name==c.triggerName){let A=fD(i,c.triggerName,c.fromState.value,c.toState.value);A._data=n,dD(c.player,C.phase,A,C.callback)}}),f.markedForDestroy?this._engine.afterFlush(()=>{f.destroy()}):l.push(c)}),this._queue=[],l.sort((c,f)=>{let i=c.transition.ast.depCount,w=f.transition.ast.depCount;return i==0||w==0?i-w:this._engine.driver.containsElement(c.element,f.element)?1:-1})}destroy(n){this.players.forEach(l=>l.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,n)}},cD=class{_onRemovalComplete(n,l){this.onRemovalComplete(n,l)}constructor(n,l,c){this.bodyNode=n,this.driver=l,this._normalizer=c,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(f,i)=>{}}get queuedPlayers(){let n=[];return this._namespaceList.forEach(l=>{l.players.forEach(c=>{c.queued&&n.push(c)})}),n}createNamespace(n,l){let c=new lD(n,l,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,l)?this._balanceNamespaceList(c,l):(this.newHostElements.set(l,c),this.collectEnterElement(l)),this._namespaceLookup[n]=c}_balanceNamespaceList(n,l){let c=this._namespaceList,f=this.namespacesByHostElement;if(c.length-1>=0){let w=!1,C=this.driver.getParentElement(l);for(;C;){let A=f.get(C);if(A){let L=c.indexOf(A);c.splice(L+1,0,n),w=!0;break}C=this.driver.getParentElement(C)}w||c.unshift(n)}else c.push(n);return f.set(l,n),n}register(n,l){let c=this._namespaceLookup[n];return c||(c=this.createNamespace(n,l)),c}registerTrigger(n,l,c){let f=this._namespaceLookup[n];f&&f.register(l,c)&&this.totalAnimations++}destroy(n,l){n&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let c=this._fetchNamespace(n);this.namespacesByHostElement.delete(c.hostElement);let f=this._namespaceList.indexOf(c);f>=0&&this._namespaceList.splice(f,1),c.destroy(l),delete this._namespaceLookup[n]}))}_fetchNamespace(n){return this._namespaceLookup[n]}fetchNamespacesByElement(n){let l=new Set,c=this.statesByElement.get(n);if(c){for(let f of c.values())if(f.namespaceId){let i=this._fetchNamespace(f.namespaceId);i&&l.add(i)}}return l}trigger(n,l,c,f){if(s1(l)){let i=this._fetchNamespace(n);if(i)return i.trigger(l,c,f),!0}return!1}insertNode(n,l,c,f){if(!s1(l))return;let i=l[Ys];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;let w=this.collectedLeaveElements.indexOf(l);w>=0&&this.collectedLeaveElements.splice(w,1)}if(n){let w=this._fetchNamespace(n);w&&w.insertNode(l,c)}f&&this.collectEnterElement(l)}collectEnterElement(n){this.collectedEnterElements.push(n)}markElementAsDisabled(n,l){l?this.disabledNodes.has(n)||(this.disabledNodes.add(n),ps(n,WS)):this.disabledNodes.has(n)&&(this.disabledNodes.delete(n),kp(n,WS))}removeNode(n,l,c){if(s1(l)){let f=n?this._fetchNamespace(n):null;f?f.removeNode(l,c):this.markElementAsRemoved(n,l,!1,c);let i=this.namespacesByHostElement.get(l);i&&i.id!==n&&i.removeNode(l,c)}else this._onRemovalComplete(l,c)}markElementAsRemoved(n,l,c,f,i){this.collectedLeaveElements.push(l),l[Ys]={namespaceId:n,setForRemoval:f,hasAnimation:c,removedBeforeQueried:!1,previousTriggersValues:i}}listen(n,l,c,f,i){return s1(l)?this._fetchNamespace(n).listen(l,c,f,i):()=>{}}_buildInstruction(n,l,c,f,i){return n.transition.build(this.driver,n.element,n.fromState.value,n.toState.value,c,f,n.fromState.options,n.toState.options,l,i)}destroyInnerAnimations(n){let l=this.driver.query(n,l1,!0);l.forEach(c=>this.destroyActiveAnimationsForElement(c)),this.playersByQueriedElement.size!=0&&(l=this.driver.query(n,KS,!0),l.forEach(c=>this.finishActiveQueriedAnimationOnElement(c)))}destroyActiveAnimationsForElement(n){let l=this.playersByElement.get(n);l&&l.forEach(c=>{c.queued?c.markedForDestroy=!0:c.destroy()})}finishActiveQueriedAnimationOnElement(n){let l=this.playersByQueriedElement.get(n);l&&l.forEach(c=>c.finish())}whenRenderingDone(){return new Promise(n=>{if(this.players.length)return mu(this.players).onDone(()=>n());n()})}processLeaveNode(n){let l=n[Ys];if(l&&l.setForRemoval){if(n[Ys]=vz,l.namespaceId){this.destroyInnerAnimations(n);let c=this._fetchNamespace(l.namespaceId);c&&c.clearElementCache(n)}this._onRemovalComplete(n,l.setForRemoval)}n.classList?.contains(WS)&&this.markElementAsDisabled(n,!1),this.driver.query(n,hY,!0).forEach(c=>{this.markElementAsDisabled(c,!1)})}flush(n=-1){let l=[];if(this.newHostElements.size&&(this.newHostElements.forEach((c,f)=>this._balanceNamespaceList(c,f)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let c=0;c<this.collectedEnterElements.length;c++){let f=this.collectedEnterElements[c];ps(f,dY)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let c=[];try{l=this._flushAnimations(c,n)}finally{for(let f=0;f<c.length;f++)c[f]()}}else for(let c=0;c<this.collectedLeaveElements.length;c++){let f=this.collectedLeaveElements[c];this.processLeaveNode(f)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(c=>c()),this._flushFns=[],this._whenQuietFns.length){let c=this._whenQuietFns;this._whenQuietFns=[],l.length?mu(l).onDone(()=>{c.forEach(f=>f())}):c.forEach(f=>f())}}reportError(n){throw PZ(n)}_flushAnimations(n,l){let c=new ay,f=[],i=new Map,w=[],C=new Map,A=new Map,L=new Map,U=new Set;this.disabledNodes.forEach(wt=>{U.add(wt);let Bt=this.driver.query(wt,uY,!0);for(let qt=0;qt<Bt.length;qt++)U.add(Bt[qt])});let Q=this.bodyNode,fe=Array.from(this.statesByElement.keys()),he=az(fe,this.collectedEnterElements),be=new Map,Se=0;he.forEach((wt,Bt)=>{let qt=fz+Se++;be.set(Bt,qt),wt.forEach(vn=>ps(vn,qt))});let Ke=[],Fe=new Set,tt=new Set;for(let wt=0;wt<this.collectedLeaveElements.length;wt++){let Bt=this.collectedLeaveElements[wt],qt=Bt[Ys];qt&&qt.setForRemoval&&(Ke.push(Bt),Fe.add(Bt),qt.hasAnimation?this.driver.query(Bt,fY,!0).forEach(vn=>Fe.add(vn)):tt.add(Bt))}let ft=new Map,Ue=az(fe,Array.from(Fe));Ue.forEach((wt,Bt)=>{let qt=XS+Se++;ft.set(Bt,qt),wt.forEach(vn=>ps(vn,qt))}),n.push(()=>{he.forEach((wt,Bt)=>{let qt=be.get(Bt);wt.forEach(vn=>kp(vn,qt))}),Ue.forEach((wt,Bt)=>{let qt=ft.get(Bt);wt.forEach(vn=>kp(vn,qt))}),Ke.forEach(wt=>{this.processLeaveNode(wt)})});let zt=[],Kt=[];for(let wt=this._namespaceList.length-1;wt>=0;wt--)this._namespaceList[wt].drainQueuedTransitions(l).forEach(qt=>{let vn=qt.player,Lt=qt.element;if(zt.push(vn),this.collectedEnterElements.length){let Li=Lt[Ys];if(Li&&Li.setForMove){if(Li.previousTriggersValues&&Li.previousTriggersValues.has(qt.triggerName)){let Bn=Li.previousTriggersValues.get(qt.triggerName),fr=this.statesByElement.get(qt.element);if(fr&&fr.has(qt.triggerName)){let gs=fr.get(qt.triggerName);gs.value=Bn,fr.set(qt.triggerName,gs)}}vn.destroy();return}}let dr=!Q||!this.driver.containsElement(Q,Lt),ti=ft.get(Lt),Jr=be.get(Lt),pi=this._buildInstruction(qt,c,Jr,ti,dr);if(pi.errors&&pi.errors.length){Kt.push(pi);return}if(dr){vn.onStart(()=>ld(Lt,pi.fromStyles)),vn.onDestroy(()=>Oa(Lt,pi.toStyles)),f.push(vn);return}if(qt.isFallbackTransition){vn.onStart(()=>ld(Lt,pi.fromStyles)),vn.onDestroy(()=>Oa(Lt,pi.toStyles)),f.push(vn);return}let La=[];pi.timelines.forEach(Li=>{Li.stretchStartingKeyframe=!0,this.disabledNodes.has(Li.element)||La.push(Li)}),pi.timelines=La,c.append(Lt,pi.timelines);let Rt={instruction:pi,player:vn,element:Lt};w.push(Rt),pi.queriedElements.forEach(Li=>qo(C,Li,[]).push(vn)),pi.preStyleProps.forEach((Li,Bn)=>{if(Li.size){let fr=A.get(Bn);fr||A.set(Bn,fr=new Set),Li.forEach((gs,Xs)=>fr.add(Xs))}}),pi.postStyleProps.forEach((Li,Bn)=>{let fr=L.get(Bn);fr||L.set(Bn,fr=new Set),Li.forEach((gs,Xs)=>fr.add(Xs))})});if(Kt.length){let wt=[];Kt.forEach(Bt=>{wt.push(RZ(Bt.triggerName,Bt.errors))}),zt.forEach(Bt=>Bt.destroy()),this.reportError(wt)}let tn=new Map,Tt=new Map;w.forEach(wt=>{let Bt=wt.element;c.has(Bt)&&(Tt.set(Bt,Bt),this._beforeAnimationBuild(wt.player.namespaceId,wt.instruction,tn))}),f.forEach(wt=>{let Bt=wt.element;this._getPreviousPlayers(Bt,!1,wt.namespaceId,wt.triggerName,null).forEach(vn=>{qo(tn,Bt,[]).push(vn),vn.destroy()})});let ri=Ke.filter(wt=>lz(wt,A,L)),Ct=new Map;sz(Ct,this.driver,tt,L,ka).forEach(wt=>{lz(wt,A,L)&&ri.push(wt)});let Ci=new Map;he.forEach((wt,Bt)=>{sz(Ci,this.driver,new Set(wt),A,n1)}),ri.forEach(wt=>{let Bt=Ct.get(wt),qt=Ci.get(wt);Ct.set(wt,new Map([...Bt?.entries()??[],...qt?.entries()??[]]))});let $i=[],wn=[],Wo={};w.forEach(wt=>{let{element:Bt,player:qt,instruction:vn}=wt;if(c.has(Bt)){if(U.has(Bt)){qt.onDestroy(()=>Oa(Bt,vn.toStyles)),qt.disabled=!0,qt.overrideTotalTime(vn.totalTime),f.push(qt);return}let Lt=Wo;if(Tt.size>1){let ti=Bt,Jr=[];for(;ti=ti.parentNode;){let pi=Tt.get(ti);if(pi){Lt=pi;break}Jr.push(ti)}Jr.forEach(pi=>Tt.set(pi,Lt))}let dr=this._buildAnimation(qt.namespaceId,vn,tn,i,Ci,Ct);if(qt.setRealPlayer(dr),Lt===Wo)$i.push(qt);else{let ti=this.playersByElement.get(Lt);ti&&ti.length&&(qt.parentPlayer=mu(ti)),f.push(qt)}}else ld(Bt,vn.fromStyles),qt.onDestroy(()=>Oa(Bt,vn.toStyles)),wn.push(qt),U.has(Bt)&&f.push(qt)}),wn.forEach(wt=>{let Bt=i.get(wt.element);if(Bt&&Bt.length){let qt=mu(Bt);wt.setRealPlayer(qt)}}),f.forEach(wt=>{wt.parentPlayer?wt.syncPlayerEvents(wt.parentPlayer):wt.destroy()});for(let wt=0;wt<Ke.length;wt++){let Bt=Ke[wt],qt=Bt[Ys];if(kp(Bt,XS),qt&&qt.hasAnimation)continue;let vn=[];if(C.size){let dr=C.get(Bt);dr&&dr.length&&vn.push(...dr);let ti=this.driver.query(Bt,KS,!0);for(let Jr=0;Jr<ti.length;Jr++){let pi=C.get(ti[Jr]);pi&&pi.length&&vn.push(...pi)}}let Lt=vn.filter(dr=>!dr.destroyed);Lt.length?vY(this,Bt,Lt):this.processLeaveNode(Bt)}return Ke.length=0,$i.forEach(wt=>{this.players.push(wt),wt.onDone(()=>{wt.destroy();let Bt=this.players.indexOf(wt);this.players.splice(Bt,1)}),wt.play()}),$i}afterFlush(n){this._flushFns.push(n)}afterFlushAnimationsDone(n){this._whenQuietFns.push(n)}_getPreviousPlayers(n,l,c,f,i){let w=[];if(l){let C=this.playersByQueriedElement.get(n);C&&(w=C)}else{let C=this.playersByElement.get(n);if(C){let A=!i||i==oy;C.forEach(L=>{L.queued||!A&&L.triggerName!=f||w.push(L)})}}return(c||f)&&(w=w.filter(C=>!(c&&c!=C.namespaceId||f&&f!=C.triggerName))),w}_beforeAnimationBuild(n,l,c){let f=l.triggerName,i=l.element,w=l.isRemovalTransition?void 0:n,C=l.isRemovalTransition?void 0:f;for(let A of l.timelines){let L=A.element,U=L!==i,Q=qo(c,L,[]);this._getPreviousPlayers(L,U,w,C,l.toState).forEach(he=>{let be=he.getRealPlayer();be.beforeDestroy&&be.beforeDestroy(),he.destroy(),Q.push(he)})}ld(i,l.fromStyles)}_buildAnimation(n,l,c,f,i,w){let C=l.triggerName,A=l.element,L=[],U=new Set,Q=new Set,fe=l.timelines.map(be=>{let Se=be.element;U.add(Se);let Ke=Se[Ys];if(Ke&&Ke.removedBeforeQueried)return new pu(be.duration,be.delay);let Fe=Se!==A,tt=xY((c.get(Se)||pY).map(tn=>tn.getRealPlayer())).filter(tn=>{let Tt=tn;return Tt.element?Tt.element===Se:!1}),ft=i.get(Se),Ue=w.get(Se),zt=cz(this._normalizer,be.keyframes,ft,Ue),Kt=this._buildPlayer(be,zt,tt);if(be.subTimeline&&f&&Q.add(Se),Fe){let tn=new cy(n,C,Se);tn.setRealPlayer(Kt),L.push(tn)}return Kt});L.forEach(be=>{qo(this.playersByQueriedElement,be.element,[]).push(be),be.onDone(()=>gY(this.playersByQueriedElement,be.element,be))}),U.forEach(be=>ps(be,Q3));let he=mu(fe);return he.onDestroy(()=>{U.forEach(be=>kp(be,Q3)),Oa(A,l.toStyles)}),Q.forEach(be=>{qo(f,be,[]).push(he)}),he}_buildPlayer(n,l,c){return l.length>0?this.driver.animate(n.element,l,n.duration,n.delay,n.easing,c):new pu(n.duration,n.delay)}},cy=class{constructor(n,l,c){this.namespaceId=n,this.triggerName=l,this.element=c,this._player=new pu,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(n){this._containsRealPlayer||(this._player=n,this._queuedCallbacks.forEach((l,c)=>{l.forEach(f=>dD(n,c,void 0,f))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(n.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(n){this.totalTime=n}syncPlayerEvents(n){let l=this._player;l.triggerCallback&&n.onStart(()=>l.triggerCallback("start")),n.onDone(()=>this.finish()),n.onDestroy(()=>this.destroy())}_queueEvent(n,l){qo(this._queuedCallbacks,n,[]).push(l)}onDone(n){this.queued&&this._queueEvent("done",n),this._player.onDone(n)}onStart(n){this.queued&&this._queueEvent("start",n),this._player.onStart(n)}onDestroy(n){this.queued&&this._queueEvent("destroy",n),this._player.onDestroy(n)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(n){this.queued||this._player.setPosition(n)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(n){let l=this._player;l.triggerCallback&&l.triggerCallback(n)}};function gY(o,n,l){let c=o.get(n);if(c){if(c.length){let f=c.indexOf(l);c.splice(f,1)}c.length==0&&o.delete(n)}return c}function _Y(o){return o??null}function s1(o){return o&&o.nodeType===1}function yY(o){return o=="start"||o=="done"}function oz(o,n){let l=o.style.display;return o.style.display=n??"none",l}function sz(o,n,l,c,f){let i=[];l.forEach(A=>i.push(oz(A)));let w=[];c.forEach((A,L)=>{let U=new Map;A.forEach(Q=>{let fe=n.computeStyle(L,Q,f);U.set(Q,fe),(!fe||fe.length==0)&&(L[Ys]=mY,w.push(L))}),o.set(L,U)});let C=0;return l.forEach(A=>oz(A,i[C++])),w}function az(o,n){let l=new Map;if(o.forEach(C=>l.set(C,[])),n.length==0)return l;let c=1,f=new Set(n),i=new Map;function w(C){if(!C)return c;let A=i.get(C);if(A)return A;let L=C.parentNode;return l.has(L)?A=L:f.has(L)?A=c:A=w(L),i.set(C,A),A}return n.forEach(C=>{let A=w(C);A!==c&&l.get(A).push(C)}),l}function ps(o,n){o.classList?.add(n)}function kp(o,n){o.classList?.remove(n)}function vY(o,n,l){mu(l).onDone(()=>o.processLeaveNode(n))}function xY(o){let n=[];return xz(o,n),n}function xz(o,n){for(let l=0;l<o.length;l++){let c=o[l];c instanceof iy?xz(c.players,n):n.push(c)}}function bY(o,n){let l=Object.keys(o),c=Object.keys(n);if(l.length!=c.length)return!1;for(let f=0;f<l.length;f++){let i=l[f];if(!n.hasOwnProperty(i)||o[i]!==n[i])return!1}return!0}function lz(o,n,l){let c=l.get(o);if(!c)return!1;let f=n.get(o);return f?c.forEach(i=>f.add(i)):n.set(o,c),l.delete(o),!0}var Lp=class{constructor(n,l,c){this._driver=l,this._normalizer=c,this._triggerCache={},this.onRemovalComplete=(f,i)=>{},this._transitionEngine=new cD(n.body,l,c),this._timelineEngine=new aD(n.body,l,c),this._transitionEngine.onRemovalComplete=(f,i)=>this.onRemovalComplete(f,i)}registerTrigger(n,l,c,f,i){let w=n+"-"+f,C=this._triggerCache[w];if(!C){let A=[],L=[],U=gz(this._driver,i,A,L);if(A.length)throw bZ(f,A);L.length&&void 0,C=aY(f,U,this._normalizer),this._triggerCache[w]=C}this._transitionEngine.registerTrigger(l,f,C)}register(n,l){this._transitionEngine.register(n,l)}destroy(n,l){this._transitionEngine.destroy(n,l)}onInsert(n,l,c,f){this._transitionEngine.insertNode(n,l,c,f)}onRemove(n,l,c){this._transitionEngine.removeNode(n,l,c)}disableAnimations(n,l){this._transitionEngine.markElementAsDisabled(n,l)}process(n,l,c,f){if(c.charAt(0)=="@"){let[i,w]=X3(c),C=f;this._timelineEngine.command(i,l,w,C)}else this._transitionEngine.trigger(n,l,c,f)}listen(n,l,c,f,i){if(c.charAt(0)=="@"){let[w,C]=X3(c);return this._timelineEngine.listen(w,l,C,i)}return this._transitionEngine.listen(n,l,c,f,i)}flush(n=-1){this._transitionEngine.flush(n)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(n){this._transitionEngine.afterFlushAnimationsDone(n)}};function wY(o,n){let l=null,c=null;return Array.isArray(n)&&n.length?(l=YS(n[0]),n.length>1&&(c=YS(n[n.length-1]))):n instanceof Map&&(l=YS(n)),l||c?new uD(o,l,c):null}var Op=class Op{constructor(n,l,c){this._element=n,this._startStyles=l,this._endStyles=c,this._state=0;let f=Op.initialStylesByElement.get(n);f||Op.initialStylesByElement.set(n,f=new Map),this._initialStyles=f}start(){this._state<1&&(this._startStyles&&Oa(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Oa(this._element,this._initialStyles),this._endStyles&&(Oa(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Op.initialStylesByElement.delete(this._element),this._startStyles&&(ld(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ld(this._element,this._endStyles),this._endStyles=null),Oa(this._element,this._initialStyles),this._state=3)}};Op.initialStylesByElement=new WeakMap;var uD=Op;function YS(o){let n=null;return o.forEach((l,c)=>{TY(c)&&(n=n||new Map,n.set(c,l))}),n}function TY(o){return o==="display"||o==="position"}var m1=class{constructor(n,l,c,f){this.element=n,this.keyframes=l,this.options=c,this._specialStyles=f,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=c.duration,this._delay=c.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let n=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,n,this.options),this._finalKeyframe=n.length?n[n.length-1]:new Map;let l=()=>this._onFinish();this.domPlayer.addEventListener("finish",l),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",l)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(n){let l=[];return n.forEach(c=>{l.push(Object.fromEntries(c))}),l}_triggerWebAnimation(n,l,c){return n.animate(this._convertKeyframesToObject(l),c)}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(n=>n()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}setPosition(n){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=n*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let n=new Map;this.hasStarted()&&this._finalKeyframe.forEach((c,f)=>{f!=="offset"&&n.set(f,this._finished?c:_D(this.element,f))}),this.currentSnapshot=n}triggerCallback(n){let l=n==="start"?this._onStartFns:this._onDoneFns;l.forEach(c=>c()),l.length=0}},g1=class{validateStyleProperty(n){return!0}validateAnimatableStyleProperty(n){return!0}containsElement(n,l){return uz(n,l)}getParentElement(n){return pD(n)}query(n,l,c){return hz(n,l,c)}computeStyle(n,l,c){return _D(n,l)}animate(n,l,c,f,i,w=[]){let C=f==0?"both":"forwards",A={duration:c,delay:f,fill:C};i&&(A.easing=i);let L=new Map,U=w.filter(he=>he instanceof m1);$Z(c,f)&&U.forEach(he=>{he.currentSnapshot.forEach((be,Se)=>L.set(Se,be))});let Q=VZ(l).map(he=>new Map(he));Q=GZ(n,Q,L);let fe=wY(n,Q);return new m1(n,Q,A,fe)}};var a1="@",bz="@.disabled",_1=class{constructor(n,l,c,f){this.namespaceId=n,this.delegate=l,this.engine=c,this._onDestroy=f,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(n){this.delegate.destroyNode?.(n)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(n,l){return this.delegate.createElement(n,l)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}appendChild(n,l){this.delegate.appendChild(n,l),this.engine.onInsert(this.namespaceId,l,n,!1)}insertBefore(n,l,c,f=!0){this.delegate.insertBefore(n,l,c),this.engine.onInsert(this.namespaceId,l,n,f)}removeChild(n,l,c){this.engine.onRemove(this.namespaceId,l,this.delegate)}selectRootElement(n,l){return this.delegate.selectRootElement(n,l)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,l,c,f){this.delegate.setAttribute(n,l,c,f)}removeAttribute(n,l,c){this.delegate.removeAttribute(n,l,c)}addClass(n,l){this.delegate.addClass(n,l)}removeClass(n,l){this.delegate.removeClass(n,l)}setStyle(n,l,c,f){this.delegate.setStyle(n,l,c,f)}removeStyle(n,l,c){this.delegate.removeStyle(n,l,c)}setProperty(n,l,c){l.charAt(0)==a1&&l==bz?this.disableAnimations(n,!!c):this.delegate.setProperty(n,l,c)}setValue(n,l){this.delegate.setValue(n,l)}listen(n,l,c){return this.delegate.listen(n,l,c)}disableAnimations(n,l){this.engine.disableAnimations(n,l)}},hD=class extends _1{constructor(n,l,c,f,i){super(l,c,f,i),this.factory=n,this.namespaceId=l}setProperty(n,l,c){l.charAt(0)==a1?l.charAt(1)=="."&&l==bz?(c=c===void 0?!0:!!c,this.disableAnimations(n,c)):this.engine.process(this.namespaceId,n,l.slice(1),c):this.delegate.setProperty(n,l,c)}listen(n,l,c){if(l.charAt(0)==a1){let f=EY(n),i=l.slice(1),w="";return i.charAt(0)!=a1&&([i,w]=IY(i)),this.engine.listen(this.namespaceId,f,i,w,C=>{let A=C._data||-1;this.factory.scheduleListenerCallback(A,c,C)})}return this.delegate.listen(n,l,c)}};function EY(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}function IY(o){let n=o.indexOf("."),l=o.substring(0,n),c=o.slice(n+1);return[l,c]}var y1=class{constructor(n,l,c){this.delegate=n,this.engine=l,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,l.onRemovalComplete=(f,i)=>{let w=i?.parentNode(f);w&&i.removeChild(w,f)}}createRenderer(n,l){let c="",f=this.delegate.createRenderer(n,l);if(!n||!l?.data?.animation){let L=this._rendererCache,U=L.get(f);if(!U){let Q=()=>L.delete(f);U=new _1(c,f,this.engine,Q),L.set(f,U)}return U}let i=l.id,w=l.id+"-"+this._currentId;this._currentId++,this.engine.register(w,n);let C=L=>{Array.isArray(L)?L.forEach(C):this.engine.registerTrigger(i,w,n,L.name,L)};return l.data.animation.forEach(C),new hD(this,w,f,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,l,c){if(n>=0&&n<this._microtaskId){this._zone.run(()=>l(c));return}let f=this._animationCallbacksBuffer;f.length==0&&queueMicrotask(()=>{this._zone.run(()=>{f.forEach(i=>{let[w,C]=i;w(C)}),this._animationCallbacksBuffer=[]})}),f.push([l,c])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var SY=(()=>{let n=class n extends Lp{constructor(c,f,i){super(c,f,i,vt(Qf,{optional:!0}))}ngOnDestroy(){this.flush()}};n.\u0275fac=function(f){return new(f||n)(Vt(zi),Vt(cd),Vt(ud))},n.\u0275prov=At({token:n,factory:n.\u0275fac});let o=n;return o})();function DY(){return new u1}function MY(o,n,l){return new y1(o,n,l)}var wz=[{provide:ud,useFactory:DY},{provide:Lp,useClass:SY},{provide:Bh,useFactory:MY,deps:[nb,Lp,fi]}],AY=[{provide:cd,useFactory:()=>new g1},{provide:Ox,useValue:"BrowserAnimations"},...wz],ffe=[{provide:cd,useClass:mD},{provide:Ox,useValue:"NoopAnimations"},...wz];function Tz(){return Kc("NgEagerAnimations"),[...AY]}var Ez={providers:[gF(j3,yF(),vF()),$3(),Tz(),EC()]};function Iz(o){return typeof o=="string"}function Cz(o){return typeof o=="number"&&Number(o)==o}function x1(o,n=0,l="0"){return typeof o!="string"&&(o=o.toString()),n>o.length?Array(n-o.length+1).join(l)+o:o}function xD(o){let n,l,c,f=o.h,i=o.s,w=o.l;if(i==0)n=l=c=w;else{let C=function(Q,fe,he){return he<0&&(he+=1),he>1&&(he-=1),he<.16666666666666666?Q+(fe-Q)*6*he:he<.5?fe:he<.6666666666666666?Q+(fe-Q)*(.6666666666666666-he)*6:Q},A=w<.5?w*(1+i):w+i-w*i,L=2*w-A;n=C(L,A,f+1/3),l=C(L,A,f),c=C(L,A,f-1/3)}return{r:Math.round(n*255),g:Math.round(l*255),b:Math.round(c*255)}}function bD(o){let n=o.r/255,l=o.g/255,c=o.b/255,f=Math.max(n,l,c),i=Math.min(n,l,c),w=0,C=0,A=(f+i)/2;if(f===i)w=C=0;else{let L=f-i;switch(C=A>.5?L/(2-f-i):L/(f+i),f){case n:w=(l-c)/L+(l<c?6:0);break;case l:w=(c-n)/L+2;break;case c:w=(n-l)/L+4;break}w/=6}return{h:w,s:C,l:A}}function Dz(o,n){return o&&{r:Math.max(0,Math.min(255,o.r+v1(o.r,n))),g:Math.max(0,Math.min(255,o.g+v1(o.g,n))),b:Math.max(0,Math.min(255,o.b+v1(o.b,n))),a:o.a}}function v1(o,n){let l=n>0?255-o:o;return Math.round(l*n)}function Mz(o,n){if(o){let l=Math.min(Math.max(o.r,o.g,o.b),230),c=v1(l,n);return{r:Math.max(0,Math.min(255,Math.round(o.r+c))),g:Math.max(0,Math.min(255,Math.round(o.g+c))),b:Math.max(0,Math.min(255,Math.round(o.b+c))),a:o.a}}else return o}function Sz(o){return(o.r*299+o.g*587+o.b*114)/1e3>=128}function Az(o,n){if(o===void 0||n==1)return o;let l=bD(o);return l.s=n,xD(l)}function Pz(o,n={r:255,g:255,b:255},l={r:255,g:255,b:255}){let c=n,f=l;return Sz(l)&&(c=l,f=n),Sz(o)?f:c}function Rz(o){return o[0]==="#"&&(o=o.substr(1)),o.length==3&&(o=o[0].repeat(2)+o[1].repeat(2)+o[2].repeat(2)),parseInt(o,16)}function OY(o){o=o.replace(/[ ]/g,"");let n=o.match(/^rgb\(([0-9]*),([0-9]*),([0-9]*)\)/i);if(n)n.push("1");else if(n=o.match(/^rgba\(([0-9]*),([0-9]*),([0-9]*),([.0-9]*)\)/i),!n)return 0;let l="";for(let c=1;c<=3;c++){let f=parseInt(n[c]).toString(16);f.length==1&&(f="0"+f),l+=f}return Rz(l)}function Fp(o){return uy.fromAny(o)}var uy=class o{constructor(n){Object.defineProperty(this,"_hex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hex=n|0}get hex(){return this._hex}get r(){return this._hex>>>16}get g(){return this._hex>>8&255}get b(){return this._hex&255}toCSS(n=1){return"rgba("+this.r+", "+this.g+", "+this.b+", "+n+")"}toCSSHex(){return"#"+x1(this.r.toString(16),2)+x1(this.g.toString(16),2)+x1(this.b.toString(16),2)}toHSL(n=1){return bD({r:this.r,g:this.g,b:this.b,a:n})}static fromHSL(n,l,c){let f=xD({h:n,s:l,l:c});return this.fromRGB(f.r,f.g,f.b)}toString(){return this.toCSSHex()}static fromHex(n){return new o(n)}static fromRGB(n,l,c){return new o((c|0)+(l<<8)+(n<<16))}static fromString(n){return new o(Rz(n))}static fromCSS(n){return new o(OY(n))}static fromAny(n){if(Iz(n)){if(n[0]=="#")return o.fromString(n);if(n.substr(0,3)=="rgb")return o.fromCSS(n)}else{if(Cz(n))return o.fromHex(n);if(n instanceof o)return o.fromHex(n.hex)}throw new Error("Unknown color syntax: "+n)}static alternative(n,l,c){let f=Pz({r:n.r,g:n.g,b:n.b},l?{r:l.r,g:l.g,b:l.b}:void 0,c?{r:c.r,g:c.g,b:c.b}:void 0);return this.fromRGB(f.r,f.g,f.b)}static interpolate(n,l,c,f="rgb"){if(f=="hsl"){let i=l.toHSL(),w=c.toHSL();return o.fromHSL(hd(n,i.h,w.h),hd(n,i.s,w.s),hd(n,i.l,w.l))}else return o.fromRGB(hd(n,l.r,c.r),hd(n,l.g,c.g),hd(n,l.b,c.b))}static lighten(n,l){let c=Dz({r:n.r,g:n.g,b:n.b},l);return o.fromRGB(c.r,c.g,c.b)}static brighten(n,l){let c=Mz({r:n.r,g:n.g,b:n.b},l);return o.fromRGB(c.r,c.g,c.b)}static saturate(n,l){let c=Az({r:n.r,g:n.g,b:n.b},l);return o.fromRGB(c.r,c.g,c.b)}};function hd(o,n,l){return n+o*(l-n)}var zfe=[{name:"Root",children:[{name:"Sed et nulla a enim tincidunt gravida",shortName:"Gravida",color:Fp(8824281),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:80},{name:"Third",value:100},{name:"New",value:50,action:"add",color:Fp(13688048),radius:35}]},{name:"Fusce ut nisi eu nibh laoreet scelerisque",shortName:"Fusce ut nisi",color:Fp(8285892),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:25},{name:"Third",value:100},{name:"New",value:50,action:"add",color:Fp(14210285),radius:35}]}]}];var kz=LT(Xb());var Oz=LT(Xb());var NY=(o,n)=>({"width.px":o,"height.px":n,margin:"auto"}),Lz=(()=>{let n=class n{constructor(){this.size=hy.SM,this.name="",this.customClass="",this.customStyle={},this.iconPath="",this.IconSize=hy}ngOnInit(){this.iconPath=this.name?`assets/${this.name}`:""}ngOnChanges(c){c.name&&(this.iconPath=`assets/${c.name.currentValue}`)}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-svg-icon"]],inputs:{size:"size",name:"name",customClass:"customClass",customStyle:"customStyle"},standalone:!0,features:[Gh([e1,{provide:fu,useClass:Jb}]),xl,bi],decls:1,vars:6,consts:[[1,"block",3,"svgClass","src","svgStyle"]],template:function(f,i){f&1&&si(0,"svg-icon",0),f&2&&vi("svgClass",i.customClass)("src",i.iconPath)("svgStyle",uC(3,NY,i.size===i.IconSize.XL?30:i.size===i.IconSize.LG?25:i.size===i.IconSize.MD?20:i.size===i.IconSize.SM?15:10,i.size===i.IconSize.XL?30:i.size===i.IconSize.LG?25:i.size===i.IconSize.MD?20:i.size===i.IconSize.SM?15:10))},dependencies:[Wi,eb,G3,U3],encapsulation:2});let o=n;return o})(),hy=function(o){return o.XS="XS",o.SM="SM",o.MD="MD",o.LG="LG",o.XL="XL",o}(hy||{});var wD=(()=>{let n=class n{constructor(c,f){this.mapService=c,this.router=f,this.IconSize=hy,this.routerEvent=new Pr}onGlobeLick(){this.routerEvent.emit(!0),this.mapService.map?.zoomTo(4,{animate:!0,duration:1500})}onMenuCubeClick(){let c=this.mapService.map?.getCenter(),f=this.mapService.map?.getZoom();this.routerEvent.emit(!0),console.log("onMenuCubeClick",c),c&&localStorage.setItem("center",JSON.stringify(c)),f&&localStorage.setItem("zoomLevel",JSON.stringify(f))}onMapClick(){this.router.url.includes("map")||this.routerEvent.emit(!0)}};n.\u0275fac=function(f){return new(f||n)(Kn(Cl),Kn(R_))},n.\u0275cmp=yi({type:n,selectors:[["app-left-bar"]],outputs:{routerEvent:"routerEvent"},standalone:!0,features:[bi],decls:6,vars:6,consts:[[1,"left-bar"],["name","menu-globe.svg","customClass","menu-item",3,"click","size"],[1,"solid"],["name","menu-map.svg","customClass","menu-item",3,"click","size","routerLink"],["name","menu-cube.svg","customClass","menu-item",3,"click","size","routerLink"],["name","menu-stars.svg","customClass","menu-item",3,"size"]],template:function(f,i){f&1&&(nn(0,"div",0)(1,"app-svg-icon",1),Oi("click",function(){return i.onGlobeLick()}),en(),si(2,"hr",2),nn(3,"app-svg-icon",3),Oi("click",function(){return i.onMapClick()}),en(),nn(4,"app-svg-icon",4),Oi("click",function(){return i.onMenuCubeClick()}),en(),si(5,"app-svg-icon",5),en()),f&2&&(Xn(),vi("size",i.IconSize.XL),Xn(2),vi("size",i.IconSize.XL)("routerLink","/map"),Xn(),vi("size",i.IconSize.XL)("routerLink","/bubbles"),Xn(),vi("size",i.IconSize.XL))},dependencies:[mF,Lz],styles:[".left-bar[_ngcontent-%COMP%]{opacity:1;background-color:#fff0!important;position:fixed;width:fit-content;background-color:#fff;padding:10px 20px 0;height:220px;z-index:999;top:30%;left:0;display:flex;flex-direction:column;align-items:center;row-gap:12px}.left-bar[_ngcontent-%COMP%]   app-svg-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.left-bar[_ngcontent-%COMP%]   hr.solid[_ngcontent-%COMP%]{border-top:3px solid #bbb;width:130%;margin-left:-15%}"]});let o=n;return o})();var TD=(()=>{let n=class n{constructor(){this.addMenuOpened=!1}toggleAddMenu(){this.addMenuOpened=!this.addMenuOpened}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-footer"]],standalone:!0,features:[bi],decls:9,vars:1,consts:[[1,"timeline"],["src","../../assets/timeline.svg"],[1,"add-sensor",3,"click"],["src","../../assets/add-icon.svg"],[1,"add-sensor-menu",3,"ngClass"],[1,"add-qr-wrapper"],["src","../../../assets/add-qr.svg"],[1,"add-nfc-wrapper"],["src","../../../assets/add-nfc.svg"]],template:function(f,i){f&1&&(nn(0,"div",0),si(1,"img",1),en(),nn(2,"div",2),Oi("click",function(){return i.toggleAddMenu()}),si(3,"img",3),en(),nn(4,"div",4)(5,"div",5),si(6,"img",6),en(),nn(7,"div",7),si(8,"img",8),en()()),f&2&&(Xn(4),vi("ngClass",i.addMenuOpened?"opened":"closed"))},dependencies:[Wi,fp],styles:[".timeline[_ngcontent-%COMP%]{position:fixed;padding-left:20px;padding-bottom:20px;left:0;bottom:0;z-index:95}.timeline[_ngcontent-%COMP%]:hover{cursor:pointer}.add-sensor[_ngcontent-%COMP%]{z-index:95;width:50px;height:50px;background-color:#eaebed;position:fixed;margin-bottom:20px;margin-right:5px;border-radius:50%;right:0;bottom:0;display:flex;align-items:center;justify-content:center}.add-sensor-menu[_ngcontent-%COMP%]{z-index:90;position:fixed;right:0;bottom:0;padding-bottom:30px;padding-right:30px}.add-sensor-menu[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border-radius:50%;width:60px;height:60px;background-color:#fff}.add-sensor-menu[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:hover{cursor:pointer}.add-sensor-menu[_ngcontent-%COMP%]   .add-nfc-wrapper[_ngcontent-%COMP%]{margin-left:-40px}.add-sensor[_ngcontent-%COMP%]:hover{cursor:pointer}.closed[_ngcontent-%COMP%]{scale:0%;transition:.5s}.opened[_ngcontent-%COMP%]{scale:100%;transition:.5s}"]});let o=n;return o})();var Fz=H3("slideInAnimation",[Z3("* <=> *",[t1(":enter, :leave",Sl({position:"fixed",width:"100%",zIndex:2}),{optional:!0}),q3([t1(":enter",[Sl({transform:"translateX(100%)"}),$S("0.5s ease-out",Sl({transform:"translateX(0%)"}))],{optional:!0}),t1(":leave",[Sl({transform:"translateX(0%)"}),$S("0.5s ease-out",Sl({transform:"translateX(-100%)"}))],{optional:!0})])])]);var ED;try{ED=typeof Intl<"u"&&Intl.v8BreakIterator}catch{ED=!1}var fy=(()=>{let n=class n{constructor(c){this._platformId=c,this.isBrowser=this._platformId?pL(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||ED)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};n.\u0275fac=function(f){return new(f||n)(Vt(Hs))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var dy;function zY(){if(dy==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>dy=!0}))}finally{dy=dy||!1}return dy}function ID(o){return zY()?o:!!o.capture}function Nz(o){return o.composedPath?o.composedPath()[0]:o.target}function zz(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function CD(o){return Array.isArray(o)?o:[o]}function SD(o){return o instanceof Or?o.nativeElement:o}var Vz=new Set,dd,BY=(()=>{let n=class n{constructor(c,f){this._platform=c,this._nonce=f,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):jY}matchMedia(c){return(this._platform.WEBKIT||this._platform.BLINK)&&VY(c,this._nonce),this._matchMedia(c)}};n.\u0275fac=function(f){return new(f||n)(Vt(fy),Vt(Jg,8))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function VY(o,n){if(!Vz.has(o))try{dd||(dd=document.createElement("style"),n&&dd.setAttribute("nonce",n),dd.setAttribute("type","text/css"),document.head.appendChild(dd)),dd.sheet&&(dd.sheet.insertRule(`@media ${o} {body{ }}`,0),Vz.add(o))}catch(l){console.error(l)}}function jY(o){return{matches:o==="all"||o==="",media:o,addListener:()=>{},removeListener:()=>{}}}var Uz=(()=>{let n=class n{constructor(c,f){this._mediaMatcher=c,this._zone=f,this._queries=new Map,this._destroySubject=new cr}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(c){return jz(CD(c)).some(i=>this._registerQuery(i).mql.matches)}observe(c){let i=jz(CD(c)).map(C=>this._registerQuery(C).observable),w=Dh(i);return w=zc(w.pipe(Fs(1)),w.pipe(sE(1),eE(0))),w.pipe(Dn(C=>{let A={matches:!1,breakpoints:{}};return C.forEach(({matches:L,query:U})=>{A.matches=A.matches||L,A.breakpoints[U]=L}),A}))}_registerQuery(c){if(this._queries.has(c))return this._queries.get(c);let f=this._mediaMatcher.matchMedia(c),w={observable:new ii(C=>{let A=L=>this._zone.run(()=>C.next(L));return f.addListener(A),()=>{f.removeListener(A)}}).pipe(Og(f),Dn(({matches:C})=>({query:c,matches:C})),Lg(this._destroySubject)),mql:f};return this._queries.set(c,w),w}};n.\u0275fac=function(f){return new(f||n)(Vt(BY),Vt(fi))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function jz(o){return o.map(n=>n.split(",")).reduce((n,l)=>n.concat(l)).map(n=>n.trim())}function Hz(o){return o.buttons===0||o.detail===0}function qz(o){let n=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0];return!!n&&n.identifier===-1&&(n.radiusX==null||n.radiusX===1)&&(n.radiusY==null||n.radiusY===1)}var fd=function(o){return o[o.NONE=0]="NONE",o[o.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",o[o.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",o}(fd||{}),$z="cdk-high-contrast-black-on-white",Gz="cdk-high-contrast-white-on-black",DD="cdk-high-contrast-active",Wz=(()=>{let n=class n{constructor(c,f){this._platform=c,this._document=f,this._breakpointSubscription=vt(Uz).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return fd.NONE;let c=this._document.createElement("div");c.style.backgroundColor="rgb(1,2,3)",c.style.position="absolute",this._document.body.appendChild(c);let f=this._document.defaultView||window,i=f&&f.getComputedStyle?f.getComputedStyle(c):null,w=(i&&i.backgroundColor||"").replace(/ /g,"");switch(c.remove(),w){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return fd.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return fd.BLACK_ON_WHITE}return fd.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let c=this._document.body.classList;c.remove(DD,$z,Gz),this._hasCheckedHighContrastMode=!0;let f=this.getHighContrastMode();f===fd.BLACK_ON_WHITE?c.add(DD,$z):f===fd.WHITE_ON_BLACK&&c.add(DD,Gz)}}};n.\u0275fac=function(f){return new(f||n)(Vt(fy),Vt(zi))},n.\u0275prov=At({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var MD=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=kr({type:n}),n.\u0275inj=Rr({});let o=n;return o})();function HY(){return!0}var qY=new an("mat-sanity-checks",{providedIn:"root",factory:HY}),RD=(()=>{let n=class n{constructor(c,f,i){this._sanityChecks=f,this._document=i,this._hasDoneGlobalChecks=!1,c._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(c){return zz()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[c]}};n.\u0275fac=function(f){return new(f||n)(Vt(Wz),Vt(qY,8),Vt(zi))},n.\u0275mod=kr({type:n}),n.\u0275inj=Rr({imports:[MD,MD]});let o=n;return o})();var ms=function(o){return o[o.FADING_IN=0]="FADING_IN",o[o.VISIBLE=1]="VISIBLE",o[o.FADING_OUT=2]="FADING_OUT",o[o.HIDDEN=3]="HIDDEN",o}(ms||{}),AD=class{constructor(n,l,c,f=!1){this._renderer=n,this.element=l,this.config=c,this._animationForciblyDisabledThroughCss=f,this.state=ms.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},Zz=ID({passive:!0,capture:!0}),PD=class{constructor(){this._events=new Map,this._delegateEventHandler=n=>{let l=Nz(n);l&&this._events.get(n.type)?.forEach((c,f)=>{(f===l||f.contains(l))&&c.forEach(i=>i.handleEvent(n))})}}addHandler(n,l,c,f){let i=this._events.get(l);if(i){let w=i.get(c);w?w.add(f):i.set(c,new Set([f]))}else this._events.set(l,new Map([[c,new Set([f])]])),n.runOutsideAngular(()=>{document.addEventListener(l,this._delegateEventHandler,Zz)})}removeHandler(n,l,c){let f=this._events.get(n);if(!f)return;let i=f.get(l);i&&(i.delete(c),i.size===0&&f.delete(l),f.size===0&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,Zz)))}},Yz={enterDuration:225,exitDuration:150},WY=800,Xz=ID({passive:!0,capture:!0}),Kz=["mousedown","touchstart"],Qz=["mouseup","mouseleave","touchend","touchcancel"],py=class py{constructor(n,l,c,f){this._target=n,this._ngZone=l,this._platform=f,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,f.isBrowser&&(this._containerElement=SD(c))}fadeInRipple(n,l,c={}){let f=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=gt(gt({},Yz),c.animation);c.centered&&(n=f.left+f.width/2,l=f.top+f.height/2);let w=c.radius||ZY(n,l,f),C=n-f.left,A=l-f.top,L=i.enterDuration,U=document.createElement("div");U.classList.add("mat-ripple-element"),U.style.left=`${C-w}px`,U.style.top=`${A-w}px`,U.style.height=`${w*2}px`,U.style.width=`${w*2}px`,c.color!=null&&(U.style.backgroundColor=c.color),U.style.transitionDuration=`${L}ms`,this._containerElement.appendChild(U);let Q=window.getComputedStyle(U),fe=Q.transitionProperty,he=Q.transitionDuration,be=fe==="none"||he==="0s"||he==="0s, 0s"||f.width===0&&f.height===0,Se=new AD(this,U,c,be);U.style.transform="scale3d(1, 1, 1)",Se.state=ms.FADING_IN,c.persistent||(this._mostRecentTransientRipple=Se);let Ke=null;return!be&&(L||i.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Fe=()=>{Ke&&(Ke.fallbackTimer=null),clearTimeout(ft),this._finishRippleTransition(Se)},tt=()=>this._destroyRipple(Se),ft=setTimeout(tt,L+100);U.addEventListener("transitionend",Fe),U.addEventListener("transitioncancel",tt),Ke={onTransitionEnd:Fe,onTransitionCancel:tt,fallbackTimer:ft}}),this._activeRipples.set(Se,Ke),(be||!L)&&this._finishRippleTransition(Se),Se}fadeOutRipple(n){if(n.state===ms.FADING_OUT||n.state===ms.HIDDEN)return;let l=n.element,c=gt(gt({},Yz),n.config.animation);l.style.transitionDuration=`${c.exitDuration}ms`,l.style.opacity="0",n.state=ms.FADING_OUT,(n._animationForciblyDisabledThroughCss||!c.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){let l=SD(n);!this._platform.isBrowser||!l||l===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=l,Kz.forEach(c=>{py._eventManager.addHandler(this._ngZone,c,l,this)}))}handleEvent(n){n.type==="mousedown"?this._onMousedown(n):n.type==="touchstart"?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Qz.forEach(l=>{this._triggerElement.addEventListener(l,this,Xz)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===ms.FADING_IN?this._startFadeOutTransition(n):n.state===ms.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){let l=n===this._mostRecentTransientRipple,{persistent:c}=n.config;n.state=ms.VISIBLE,!c&&(!l||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){let l=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=ms.HIDDEN,l!==null&&(n.element.removeEventListener("transitionend",l.onTransitionEnd),n.element.removeEventListener("transitioncancel",l.onTransitionCancel),l.fallbackTimer!==null&&clearTimeout(l.fallbackTimer)),n.element.remove()}_onMousedown(n){let l=Hz(n),c=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+WY;!this._target.rippleDisabled&&!l&&!c&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!qz(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let l=n.changedTouches;if(l)for(let c=0;c<l.length;c++)this.fadeInRipple(l[c].clientX,l[c].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{let l=n.state===ms.VISIBLE||n.config.terminateOnPointerUp&&n.state===ms.FADING_IN;!n.config.persistent&&l&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let n=this._triggerElement;n&&(Kz.forEach(l=>py._eventManager.removeHandler(l,n,this)),this._pointerUpEventsRegistered&&(Qz.forEach(l=>n.removeEventListener(l,this,Xz)),this._pointerUpEventsRegistered=!1))}};py._eventManager=new PD;var Jz=py;function ZY(o,n,l){let c=Math.max(Math.abs(o-l.left),Math.abs(o-l.right)),f=Math.max(Math.abs(n-l.top),Math.abs(n-l.bottom));return Math.sqrt(c*c+f*f)}var eB=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275mod=kr({type:n}),n.\u0275inj=Rr({imports:[RD,RD]});let o=n;return o})();var YY=["*"];function XY(o,n){o&1&&(nn(0,"div",1),eu(1),en())}var b1=(()=>{let n=class n{constructor(){this.tabTitle="",this.active=!1}ngOnInit(){}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-tab"]],inputs:{tabTitle:"tabTitle",active:"active"},standalone:!0,features:[bi],ngContentSelectors:YY,decls:1,vars:1,consts:[["style","width: 100%; box-sizing: border-box; display: flex; align-content: center; flex-direction: column",4,"ngIf"],[2,"width","100%","box-sizing","border-box","display","flex","align-content","center","flex-direction","column"]],template:function(f,i){f&1&&(Jc(),ao(0,XY,2,0,"div",0)),f&2&&vi("ngIf",i.active)},dependencies:[Wi,mp],encapsulation:2});let o=n;return o})();var KY=["*"];function QY(o,n){if(o&1){let l=i_();nn(0,"li",2),Oi("click",function(){let f=Kg(l).$implicit,i=lp();return Qg(i.selectTab(f))}),xi(1),en()}if(o&2){let l=n.$implicit;n_("active",l.active),Xn(),Uo(" ",l.tabTitle," ")}}var tB=(()=>{let n=class n{constructor(){}ngAfterContentInit(){this.tabs.filter(f=>f.active).length===0&&this.selectTab(this.tabs.first)}selectTab(c){this.tabs.toArray().forEach(f=>f.active=!1),c.active=!0}};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-tabs"]],contentQueries:function(f,i,w){if(f&1&&jx(w,b1,4),f&2){let C;r_(C=o_())&&(i.tabs=C)}},standalone:!0,features:[bi],ngContentSelectors:KY,decls:3,vars:1,consts:[[1,"tabs"],[3,"active","click",4,"ngFor","ngForOf"],[3,"click"]],template:function(f,i){f&1&&(Jc(),nn(0,"ul",0),ao(1,QY,2,3,"li",1),en(),eu(2)),f&2&&(Xn(),vi("ngForOf",i.tabs))},dependencies:[Wi,pp],styles:[".tabs[_ngcontent-%COMP%]{list-style-type:none;padding:0;display:flex;cursor:pointer;justify-content:center;align-items:center}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{height:30px;width:40%;display:flex;align-items:center;justify-content:center;padding:5px 10px;border:1px solid #ccc}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(1){border-radius:10px 0 0 10px;border-right:none}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(2){border-radius:0 10px 10px 0;border-left:none}.tabs[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background-clip:content-box;background-color:#c7e1ff;background-size:75%;transition:all .5s}"]});let o=n;return o})();var JY=()=>[];function eX(o,n){if(o&1&&(oC(0),nn(1,"div",8),xi(2),en(),sC()),o&2){let l=n.index;Xn(2),Uo(" Content nr ",l,"")}}var nB=(()=>{let n=class n{};n.\u0275fac=function(f){return new(f||n)},n.\u0275cmp=yi({type:n,selectors:[["app-right-bar-over"]],standalone:!0,features:[bi],decls:12,vars:2,consts:[["id","mySidenav",1,"sidenav"],[1,"title-container"],[1,"alerts"],[1,"check"],[1,"custom-tabs"],["tabTitle","Aktywne",1,"content"],[4,"ngFor","ngForOf"],["tabTitle","Oddelegowane",1,"content"],[1,"card-container"]],template:function(f,i){f&1&&(nn(0,"div",0)(1,"div",1)(2,"div",2),xi(3,"Alerty"),en(),nn(4,"div",3),xi(5,"Zaznacz"),en()(),nn(6,"div",4)(7,"app-tabs")(8,"app-tab",5),ao(9,eX,3,1,"ng-container",6),en(),nn(10,"app-tab",7),xi(11," Content of Tab 2 "),en()()()()),f&2&&(Xn(9),vi("ngForOf",ZO(1,JY).constructor(10)))},dependencies:[Wi,pp,eB,tB,b1],styles:[".sidenav[_ngcontent-%COMP%]{text-wrap:nowrap;background-color:#fff;height:100vh;overflow:auto}.title-container[_ngcontent-%COMP%]{padding:10%;position:sticky;display:flex;flex-direction:row;justify-content:space-between}.title-container[_ngcontent-%COMP%]   .alerts[_ngcontent-%COMP%]{cursor:pointer;font-size:larger}.title-container[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]{color:#a1c1e7}.content[_ngcontent-%COMP%]{display:flex;margin-left:7%;width:86%}.content[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]{padding:10px;margin-bottom:20px;height:150px;border:1px solid #ccc;border-radius:10px}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;margin-top:20vh}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:#c7e1ff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#91c1f8;cursor:grab}"]});let o=n;return o})();function tX(o,n){o&1&&si(0,"app-footer")}var iB=(()=>{let n=class n{constructor(c,f,i){this.contexts=c,this.document=f,this.mapService=i,this.openedSidebar=!1,this.title="GraphVizualization"}toggleSideBar(c){c?this.openedSidebar=!c:this.openedSidebar=!this.openedSidebar;let f=this.document.getElementById("arrow"),i=this.document.getElementById("main");this.openedSidebar?this.openSideBar(i,f):this.closeSideBar(i,f)}openSideBar(c,f){let i=this.mapService.map.getCenter(),w=this.mapService.map.getZoom();this.setOpenStyles(window.innerWidth,c,f),f.style.transform="rotate(0deg)",this.mapService.map.easeTo({center:i,zoom:w+.3,duration:1e3,linear:!0})}closeSideBar(c,f){let i=this.mapService.map.getCenter(),w=this.mapService.map.getZoom();c.style.marginLeft="0px",c.style.width="100%",f.style.right="30px",f.style.transform="rotate(180deg)",this.mapService.map.easeTo({center:i,zoom:w-.3,duration:1e3,linear:!0})}setOpenStyles(c,f,i){c>480?(f.style.marginLeft="-20%",f.style.width="80%",i.style.right="40%"):i.style.right="70%"}};n.\u0275fac=function(f){return new(f||n)(Kn(Ep),Kn(zi),Kn(Cl))},n.\u0275cmp=yi({type:n,selectors:[["app-root"]],standalone:!0,features:[bi],decls:6,vars:3,consts:[["src","../assets/arrow-close.svg","id","arrow",3,"click"],[3,"routerEvent"],[4,"ngIf"],["id","rightBar",3,"ngClass"],["id","main",2,"height","100%","width","100%","overflow","hidden","position","absolute","top","0","left","0"]],template:function(f,i){f&1&&(nn(0,"img",0),Oi("click",function(){return i.toggleSideBar()}),en(),nn(1,"app-left-bar",1),Oi("routerEvent",function(C){return i.toggleSideBar(C)}),en(),ao(2,tX,1,0,"app-footer",2),si(3,"app-right-bar-over",3),nn(4,"div",4),si(5,"router-outlet"),en()),f&2&&(Xn(2),vi("ngIf",!i.openedSidebar),Xn(),vi("ngClass",i.openedSidebar?"opened":"closed"),Xn(),vi("@slideInAnimation",void 0))},dependencies:[Wi,fp,mp,dS,wD,TD,nB],styles:["[_ngcontent-%COMP%]::view-transition-group(cube){animation-duration:4s}#main[_ngcontent-%COMP%]{transition:all 1s}#arrow[_ngcontent-%COMP%]{position:fixed;right:30px;top:45%;transform:rotate(180deg);transition:all 1s;z-index:150}.opened[_ngcontent-%COMP%]{position:fixed;top:0;right:0;z-index:200;height:100vh;width:40%;transition:all 1s}.closed[_ngcontent-%COMP%]{position:fixed;top:0;right:0vw;z-index:-1;height:100vh;width:0%;transition:all 1s}@media (max-width: 480px){.opened[_ngcontent-%COMP%]{position:fixed;top:0;right:0;z-index:200;height:100vh;width:70%;overflow-y:auto;transition:all 1s}}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:#5484d1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#2651a0;cursor:grab}"],data:{animation:[Fz]}});let o=n;return o})();PL(iB,Ez).catch(o=>console.error(o));
