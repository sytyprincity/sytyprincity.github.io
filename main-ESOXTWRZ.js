var bB=Object.create;var dw=Object.defineProperty,wB=Object.defineProperties,EB=Object.getOwnPropertyDescriptor,TB=Object.getOwnPropertyDescriptors,IB=Object.getOwnPropertyNames,c0=Object.getOwnPropertySymbols,DB=Object.getPrototypeOf,fw=Object.prototype.hasOwnProperty,iA=Object.prototype.propertyIsEnumerable;var rA=(o,i,c)=>i in o?dw(o,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[i]=c,xt=(o,i)=>{for(var c in i||={})fw.call(i,c)&&rA(o,c,i[c]);if(c0)for(var c of c0(i))iA.call(i,c)&&rA(o,c,i[c]);return o},Tr=(o,i)=>wB(o,TB(i));var Xs=(o,i)=>{var c={};for(var h in o)fw.call(o,h)&&i.indexOf(h)<0&&(c[h]=o[h]);if(o!=null&&c0)for(var h of c0(o))i.indexOf(h)<0&&iA.call(o,h)&&(c[h]=o[h]);return c};var SB=(o,i)=>()=>(i||o((i={exports:{}}).exports,i),i.exports);var CB=(o,i,c,h)=>{if(i&&typeof i=="object"||typeof i=="function")for(let m of IB(i))!fw.call(o,m)&&m!==c&&dw(o,m,{get:()=>i[m],enumerable:!(h=EB(i,m))||h.enumerable});return o};var pw=(o,i,c)=>(c=o!=null?bB(DB(o)):{},CB(i||!o||!o.__esModule?dw(c,"default",{value:o,enumerable:!0}):c,o));var Nm=(o,i,c)=>new Promise((h,m)=>{var r=O=>{try{C(c.next(O))}catch(z){m(z)}},E=O=>{try{C(c.throw(O))}catch(z){m(z)}},C=O=>O.done?h(O.value):Promise.resolve(O.value).then(r,E);C((c=c.apply(o,i)).next())});var Jx=SB((TD,ID)=>{"use strict";(function(o,i){typeof TD=="object"&&typeof ID<"u"?ID.exports=i():typeof define=="function"&&define.amd?define(i):(o=typeof globalThis<"u"?globalThis:o||self,o.mapboxgl=i())})(TD,function(){"use strict";var o,i,c;function h(r,E){if(!o)o=E;else if(!i)i=E;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",O={};o(O),c=E(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}h(["exports"],function(r){var E="3.5.0";let C,O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{C=t}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{let t=new URL(O.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function z(t){return O.API_URL_REGEX.test(t)}function Z(t){return t.indexOf("mapbox:")===0}function ce(t){return O.API_CDN_URL_REGEX.test(t)}function Ie(t){return O.API_SPRITE_REGEX.test(t)}function be(t){return O.API_STYLE_REGEX.test(t)&&!Ie(t)}let qe={create:"create",load:"load",fullLoad:"fullLoad"},ot={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function dt(t){let e=t.name.split("?")[0];return ce(e)&&e.includes("mapbox-gl.js")?"javascript":ce(e)&&e.includes("mapbox-gl.css")?"css":function(n){return O.API_FONTS_REGEX.test(n)}(e)?"fontRange":Ie(e)?"sprite":be(e)?"style":function(n){return O.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function ct(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bt={},St={};Object.defineProperty(St,"__esModule",{value:!0}),St.setMatrixArrayType=function(t){St.ARRAY_TYPE=dr=t},St.toRadian=function(t){return t*ir},St.equals=function(t,e){return Math.abs(t-e)<=$t*Math.max(1,Math.abs(t),Math.abs(e))},St.RANDOM=St.ARRAY_TYPE=St.EPSILON=void 0;var $t=1e-6;St.EPSILON=$t;var dr=typeof Float32Array<"u"?Float32Array:Array;St.ARRAY_TYPE=dr;var Xn=Math.random;St.RANDOM=Xn;var ir=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Yt={};function di(t){return di=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},di(t)}Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.create=function(){var t=new Xt.ARRAY_TYPE(4);return Xt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Yt.clone=function(t){var e=new Xt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Yt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Yt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Yt.fromValues=function(t,e,n,a){var l=new Xt.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=a,l},Yt.set=function(t,e,n,a,l){return t[0]=e,t[1]=n,t[2]=a,t[3]=l,t},Yt.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Yt.invert=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=n*d-l*a;return f?(t[0]=d*(f=1/f),t[1]=-a*f,t[2]=-l*f,t[3]=n*f,t):null},Yt.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Yt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Yt.multiply=Ni,Yt.rotate=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+d*_,t[1]=l*y+f*_,t[2]=a*-_+d*y,t[3]=l*-_+f*y,t},Yt.scale=function(t,e,n){var a=e[1],l=e[2],d=e[3],f=n[0],_=n[1];return t[0]=e[0]*f,t[1]=a*f,t[2]=l*_,t[3]=d*_,t},Yt.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},Yt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Yt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Yt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Yt.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},Yt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Yt.subtract=Is,Yt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Yt.equals=function(t,e){var n=t[0],a=t[1],l=t[2],d=t[3],f=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(n-f)<=Xt.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-_)<=Xt.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-y)<=Xt.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-b)<=Xt.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Yt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Yt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Yt.sub=Yt.mul=void 0;var Xt=function(t,e){if(t&&t.__esModule)return t;if(t===null||di(t)!=="object"&&typeof t!="function")return{default:t};var n=fa(void 0);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(St);function fa(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(fa=function(a){return a?n:e})(t)}function Ni(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*_+d*y,t[1]=l*_+f*y,t[2]=a*b+d*T,t[3]=l*b+f*T,t}function Is(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Yt.mul=Ni,Yt.sub=Is;var On={};function Ds(t){return Ds=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ds(t)}Object.defineProperty(On,"__esModule",{value:!0}),On.create=function(){var t=new vt.ARRAY_TYPE(6);return vt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},On.clone=function(t){var e=new vt.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},On.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},On.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},On.fromValues=function(t,e,n,a,l,d){var f=new vt.ARRAY_TYPE(6);return f[0]=t,f[1]=e,f[2]=n,f[3]=a,f[4]=l,f[5]=d,f},On.set=function(t,e,n,a,l,d,f){return t[0]=e,t[1]=n,t[2]=a,t[3]=l,t[4]=d,t[5]=f,t},On.invert=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=e[4],_=e[5],y=n*d-a*l;return y?(t[0]=d*(y=1/y),t[1]=-a*y,t[2]=-l*y,t[3]=n*y,t[4]=(l*_-d*f)*y,t[5]=(a*f-n*_)*y,t):null},On.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},On.multiply=Gt,On.rotate=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=Math.sin(n),T=Math.cos(n);return t[0]=a*T+d*b,t[1]=l*T+f*b,t[2]=a*-b+d*T,t[3]=l*-b+f*T,t[4]=_,t[5]=y,t},On.scale=function(t,e,n){var a=e[1],l=e[2],d=e[3],f=e[4],_=e[5],y=n[0],b=n[1];return t[0]=e[0]*y,t[1]=a*y,t[2]=l*b,t[3]=d*b,t[4]=f,t[5]=_,t},On.translate=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=n[0],T=n[1];return t[0]=a,t[1]=l,t[2]=d,t[3]=f,t[4]=a*b+d*T+_,t[5]=l*b+f*T+y,t},On.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},On.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},On.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},On.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},On.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},On.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},On.subtract=En,On.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},On.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},On.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},On.equals=function(t,e){var n=t[0],a=t[1],l=t[2],d=t[3],f=t[4],_=t[5],y=e[0],b=e[1],T=e[2],D=e[3],S=e[4],P=e[5];return Math.abs(n-y)<=vt.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-b)<=vt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-T)<=vt.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(d-D)<=vt.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(f-S)<=vt.EPSILON*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(_-P)<=vt.EPSILON*Math.max(1,Math.abs(_),Math.abs(P))},On.sub=On.mul=void 0;var vt=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ds(t)!=="object"&&typeof t!="function")return{default:t};var n=Nt(void 0);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(St);function Nt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Nt=function(a){return a?n:e})(t)}function Gt(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=n[0],T=n[1],D=n[2],S=n[3],P=n[4],R=n[5];return t[0]=a*b+d*T,t[1]=l*b+f*T,t[2]=a*D+d*S,t[3]=l*D+f*S,t[4]=a*P+d*R+_,t[5]=l*P+f*R+y,t}function En(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}On.mul=Gt,On.sub=En;var zt={};function Kr(t){return Kr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kr(t)}Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=function(){var t=new Zn.ARRAY_TYPE(9);return Zn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},zt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},zt.clone=function(t){var e=new Zn.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},zt.fromValues=function(t,e,n,a,l,d,f,_,y){var b=new Zn.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=n,b[3]=a,b[4]=l,b[5]=d,b[6]=f,b[7]=_,b[8]=y,b},zt.set=function(t,e,n,a,l,d,f,_,y,b){return t[0]=e,t[1]=n,t[2]=a,t[3]=l,t[4]=d,t[5]=f,t[6]=_,t[7]=y,t[8]=b,t},zt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},zt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},zt.invert=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=T*f-_*b,S=-T*d+_*y,P=b*d-f*y,R=n*D+a*S+l*P;return R?(t[0]=D*(R=1/R),t[1]=(-T*a+l*b)*R,t[2]=(_*a-l*f)*R,t[3]=S*R,t[4]=(T*n-l*y)*R,t[5]=(-_*n+l*d)*R,t[6]=P*R,t[7]=(-b*n+a*y)*R,t[8]=(f*n-a*d)*R,t):null},zt.adjoint=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8];return t[0]=f*T-_*b,t[1]=l*b-a*T,t[2]=a*_-l*f,t[3]=_*y-d*T,t[4]=n*T-l*y,t[5]=l*d-n*_,t[6]=d*b-f*y,t[7]=a*y-n*b,t[8]=n*f-a*d,t},zt.determinant=function(t){var e=t[3],n=t[4],a=t[5],l=t[6],d=t[7],f=t[8];return t[0]*(f*n-a*d)+t[1]*(-f*e+a*l)+t[2]*(d*e-n*l)},zt.multiply=or,zt.translate=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=n[0],P=n[1];return t[0]=a,t[1]=l,t[2]=d,t[3]=f,t[4]=_,t[5]=y,t[6]=S*a+P*f+b,t[7]=S*l+P*_+T,t[8]=S*d+P*y+D,t},zt.rotate=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=Math.sin(n),P=Math.cos(n);return t[0]=P*a+S*f,t[1]=P*l+S*_,t[2]=P*d+S*y,t[3]=P*f-S*a,t[4]=P*_-S*l,t[5]=P*y-S*d,t[6]=b,t[7]=T,t[8]=D,t},zt.scale=function(t,e,n){var a=n[0],l=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=l*e[3],t[4]=l*e[4],t[5]=l*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},zt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},zt.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},zt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},zt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},zt.fromQuat=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=n+n,_=a+a,y=l+l,b=n*f,T=a*f,D=a*_,S=l*f,P=l*_,R=l*y,k=d*f,N=d*_,V=d*y;return t[0]=1-D-R,t[3]=T-V,t[6]=S+N,t[1]=T+V,t[4]=1-b-R,t[7]=P-k,t[2]=S-N,t[5]=P+k,t[8]=1-b-D,t},zt.normalFromMat4=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=e[9],S=e[10],P=e[11],R=e[12],k=e[13],N=e[14],V=e[15],Y=n*_-a*f,X=n*y-l*f,K=n*b-d*f,ae=a*y-l*_,oe=a*b-d*_,fe=l*b-d*y,me=T*k-D*R,xe=T*N-S*R,Pe=T*V-P*R,De=D*N-S*k,ke=D*V-P*k,He=S*V-P*N,Oe=Y*He-X*ke+K*De+ae*Pe-oe*xe+fe*me;return Oe?(t[0]=(_*He-y*ke+b*De)*(Oe=1/Oe),t[1]=(y*Pe-f*He-b*xe)*Oe,t[2]=(f*ke-_*Pe+b*me)*Oe,t[3]=(l*ke-a*He-d*De)*Oe,t[4]=(n*He-l*Pe+d*xe)*Oe,t[5]=(a*Pe-n*ke-d*me)*Oe,t[6]=(k*fe-N*oe+V*ae)*Oe,t[7]=(N*K-R*fe-V*X)*Oe,t[8]=(R*oe-k*K+V*Y)*Oe,t):null},zt.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},zt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},zt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},zt.subtract=pa,zt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},zt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},zt.equals=function(t,e){var n=t[0],a=t[1],l=t[2],d=t[3],f=t[4],_=t[5],y=t[6],b=t[7],T=t[8],D=e[0],S=e[1],P=e[2],R=e[3],k=e[4],N=e[5],V=e[6],Y=e[7],X=e[8];return Math.abs(n-D)<=Zn.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(a-S)<=Zn.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-P)<=Zn.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(d-R)<=Zn.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(f-k)<=Zn.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(_-N)<=Zn.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(y-V)<=Zn.EPSILON*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(b-Y)<=Zn.EPSILON*Math.max(1,Math.abs(b),Math.abs(Y))&&Math.abs(T-X)<=Zn.EPSILON*Math.max(1,Math.abs(T),Math.abs(X))},zt.sub=zt.mul=void 0;var Zn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Kr(t)!=="object"&&typeof t!="function")return{default:t};var n=zi(void 0);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(St);function zi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(zi=function(a){return a?n:e})(t)}function or(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=n[0],P=n[1],R=n[2],k=n[3],N=n[4],V=n[5],Y=n[6],X=n[7],K=n[8];return t[0]=S*a+P*f+R*b,t[1]=S*l+P*_+R*T,t[2]=S*d+P*y+R*D,t[3]=k*a+N*f+V*b,t[4]=k*l+N*_+V*T,t[5]=k*d+N*y+V*D,t[6]=Y*a+X*f+K*b,t[7]=Y*l+X*_+K*T,t[8]=Y*d+X*y+K*D,t}function pa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}zt.mul=or,zt.sub=pa;var Ct={};function wr(t){return wr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wr(t)}Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.create=function(){var t=new kn.ARRAY_TYPE(16);return kn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Ct.clone=function(t){var e=new kn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Ct.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ct.fromValues=function(t,e,n,a,l,d,f,_,y,b,T,D,S,P,R,k){var N=new kn.ARRAY_TYPE(16);return N[0]=t,N[1]=e,N[2]=n,N[3]=a,N[4]=l,N[5]=d,N[6]=f,N[7]=_,N[8]=y,N[9]=b,N[10]=T,N[11]=D,N[12]=S,N[13]=P,N[14]=R,N[15]=k,N},Ct.set=function(t,e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N){return t[0]=e,t[1]=n,t[2]=a,t[3]=l,t[4]=d,t[5]=f,t[6]=_,t[7]=y,t[8]=b,t[9]=T,t[10]=D,t[11]=S,t[12]=P,t[13]=R,t[14]=k,t[15]=N,t},Ct.identity=Yo,Ct.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],l=e[3],d=e[6],f=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=d,t[11]=e[14],t[12]=l,t[13]=f,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Ct.invert=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=e[9],S=e[10],P=e[11],R=e[12],k=e[13],N=e[14],V=e[15],Y=n*_-a*f,X=n*y-l*f,K=n*b-d*f,ae=a*y-l*_,oe=a*b-d*_,fe=l*b-d*y,me=T*k-D*R,xe=T*N-S*R,Pe=T*V-P*R,De=D*N-S*k,ke=D*V-P*k,He=S*V-P*N,Oe=Y*He-X*ke+K*De+ae*Pe-oe*xe+fe*me;return Oe?(t[0]=(_*He-y*ke+b*De)*(Oe=1/Oe),t[1]=(l*ke-a*He-d*De)*Oe,t[2]=(k*fe-N*oe+V*ae)*Oe,t[3]=(S*oe-D*fe-P*ae)*Oe,t[4]=(y*Pe-f*He-b*xe)*Oe,t[5]=(n*He-l*Pe+d*xe)*Oe,t[6]=(N*K-R*fe-V*X)*Oe,t[7]=(T*fe-S*K+P*X)*Oe,t[8]=(f*ke-_*Pe+b*me)*Oe,t[9]=(a*Pe-n*ke-d*me)*Oe,t[10]=(R*oe-k*K+V*Y)*Oe,t[11]=(D*K-T*oe-P*Y)*Oe,t[12]=(_*xe-f*De-y*me)*Oe,t[13]=(n*De-a*xe+l*me)*Oe,t[14]=(k*X-R*ae-N*Y)*Oe,t[15]=(T*ae-D*X+S*Y)*Oe,t):null},Ct.adjoint=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=e[4],_=e[5],y=e[6],b=e[7],T=e[8],D=e[9],S=e[10],P=e[11],R=e[12],k=e[13],N=e[14],V=e[15];return t[0]=_*(S*V-P*N)-D*(y*V-b*N)+k*(y*P-b*S),t[1]=-(a*(S*V-P*N)-D*(l*V-d*N)+k*(l*P-d*S)),t[2]=a*(y*V-b*N)-_*(l*V-d*N)+k*(l*b-d*y),t[3]=-(a*(y*P-b*S)-_*(l*P-d*S)+D*(l*b-d*y)),t[4]=-(f*(S*V-P*N)-T*(y*V-b*N)+R*(y*P-b*S)),t[5]=n*(S*V-P*N)-T*(l*V-d*N)+R*(l*P-d*S),t[6]=-(n*(y*V-b*N)-f*(l*V-d*N)+R*(l*b-d*y)),t[7]=n*(y*P-b*S)-f*(l*P-d*S)+T*(l*b-d*y),t[8]=f*(D*V-P*k)-T*(_*V-b*k)+R*(_*P-b*D),t[9]=-(n*(D*V-P*k)-T*(a*V-d*k)+R*(a*P-d*D)),t[10]=n*(_*V-b*k)-f*(a*V-d*k)+R*(a*b-d*_),t[11]=-(n*(_*P-b*D)-f*(a*P-d*D)+T*(a*b-d*_)),t[12]=-(f*(D*N-S*k)-T*(_*N-y*k)+R*(_*S-y*D)),t[13]=n*(D*N-S*k)-T*(a*N-l*k)+R*(a*S-l*D),t[14]=-(n*(_*N-y*k)-f*(a*N-l*k)+R*(a*y-l*_)),t[15]=n*(_*S-y*D)-f*(a*S-l*D)+T*(a*y-l*_),t},Ct.determinant=function(t){var e=t[0],n=t[1],a=t[2],l=t[3],d=t[4],f=t[5],_=t[6],y=t[7],b=t[8],T=t[9],D=t[10],S=t[11],P=t[12],R=t[13],k=t[14],N=t[15];return(e*f-n*d)*(D*N-S*k)-(e*_-a*d)*(T*N-S*R)+(e*y-l*d)*(T*k-D*R)+(n*_-a*f)*(b*N-S*P)-(n*y-l*f)*(b*k-D*P)+(a*y-l*_)*(b*R-T*P)},Ct.multiply=Ss,Ct.translate=function(t,e,n){var a,l,d,f,_,y,b,T,D,S,P,R,k=n[0],N=n[1],V=n[2];return e===t?(t[12]=e[0]*k+e[4]*N+e[8]*V+e[12],t[13]=e[1]*k+e[5]*N+e[9]*V+e[13],t[14]=e[2]*k+e[6]*N+e[10]*V+e[14],t[15]=e[3]*k+e[7]*N+e[11]*V+e[15]):(l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=e[9],P=e[10],R=e[11],t[0]=a=e[0],t[1]=l,t[2]=d,t[3]=f,t[4]=_,t[5]=y,t[6]=b,t[7]=T,t[8]=D,t[9]=S,t[10]=P,t[11]=R,t[12]=a*k+_*N+D*V+e[12],t[13]=l*k+y*N+S*V+e[13],t[14]=d*k+b*N+P*V+e[14],t[15]=f*k+T*N+R*V+e[15]),t},Ct.scale=function(t,e,n){var a=n[0],l=n[1],d=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ct.rotate=function(t,e,n,a){var l,d,f,_,y,b,T,D,S,P,R,k,N,V,Y,X,K,ae,oe,fe,me,xe,Pe,De,ke=a[0],He=a[1],Oe=a[2],je=Math.hypot(ke,He,Oe);return je<kn.EPSILON?null:(ke*=je=1/je,He*=je,Oe*=je,l=Math.sin(n),d=Math.cos(n),y=e[1],b=e[2],T=e[3],S=e[5],P=e[6],R=e[7],N=e[9],V=e[10],Y=e[11],X=ke*ke*(f=1-d)+d,oe=ke*He*f-Oe*l,fe=He*He*f+d,me=Oe*He*f+ke*l,xe=ke*Oe*f+He*l,Pe=He*Oe*f-ke*l,De=Oe*Oe*f+d,t[0]=(_=e[0])*X+(D=e[4])*(K=He*ke*f+Oe*l)+(k=e[8])*(ae=Oe*ke*f-He*l),t[1]=y*X+S*K+N*ae,t[2]=b*X+P*K+V*ae,t[3]=T*X+R*K+Y*ae,t[4]=_*oe+D*fe+k*me,t[5]=y*oe+S*fe+N*me,t[6]=b*oe+P*fe+V*me,t[7]=T*oe+R*fe+Y*me,t[8]=_*xe+D*Pe+k*De,t[9]=y*xe+S*Pe+N*De,t[10]=b*xe+P*Pe+V*De,t[11]=T*xe+R*Pe+Y*De,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Ct.rotateX=function(t,e,n){var a=Math.sin(n),l=Math.cos(n),d=e[4],f=e[5],_=e[6],y=e[7],b=e[8],T=e[9],D=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*l+b*a,t[5]=f*l+T*a,t[6]=_*l+D*a,t[7]=y*l+S*a,t[8]=b*l-d*a,t[9]=T*l-f*a,t[10]=D*l-_*a,t[11]=S*l-y*a,t},Ct.rotateY=function(t,e,n){var a=Math.sin(n),l=Math.cos(n),d=e[0],f=e[1],_=e[2],y=e[3],b=e[8],T=e[9],D=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*l-b*a,t[1]=f*l-T*a,t[2]=_*l-D*a,t[3]=y*l-S*a,t[8]=d*a+b*l,t[9]=f*a+T*l,t[10]=_*a+D*l,t[11]=y*a+S*l,t},Ct.rotateZ=function(t,e,n){var a=Math.sin(n),l=Math.cos(n),d=e[0],f=e[1],_=e[2],y=e[3],b=e[4],T=e[5],D=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*l+b*a,t[1]=f*l+T*a,t[2]=_*l+D*a,t[3]=y*l+S*a,t[4]=b*l-d*a,t[5]=T*l-f*a,t[6]=D*l-_*a,t[7]=S*l-y*a,t},Ct.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Ct.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ct.fromRotation=function(t,e,n){var a,l,d,f=n[0],_=n[1],y=n[2],b=Math.hypot(f,_,y);return b<kn.EPSILON?null:(f*=b=1/b,_*=b,y*=b,a=Math.sin(e),l=Math.cos(e),t[0]=f*f*(d=1-l)+l,t[1]=_*f*d+y*a,t[2]=y*f*d-_*a,t[3]=0,t[4]=f*_*d-y*a,t[5]=_*_*d+l,t[6]=y*_*d+f*a,t[7]=0,t[8]=f*y*d+_*a,t[9]=_*y*d-f*a,t[10]=y*y*d+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Ct.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ct.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ct.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ct.fromRotationTranslation=Uc,Ct.fromQuat2=function(t,e){var n=new kn.ARRAY_TYPE(3),a=-e[0],l=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=a*a+l*l+d*d+f*f;return D>0?(n[0]=2*(_*f+T*a+y*d-b*l)/D,n[1]=2*(y*f+T*l+b*a-_*d)/D,n[2]=2*(b*f+T*d+_*l-y*a)/D):(n[0]=2*(_*f+T*a+y*d-b*l),n[1]=2*(y*f+T*l+b*a-_*d),n[2]=2*(b*f+T*d+_*l-y*a)),Uc(t,e,n),t},Ct.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Ct.getScaling=ol,Ct.getRotation=function(t,e){var n=new kn.ARRAY_TYPE(3);ol(n,e);var a=1/n[0],l=1/n[1],d=1/n[2],f=e[0]*a,_=e[1]*l,y=e[2]*d,b=e[4]*a,T=e[5]*l,D=e[6]*d,S=e[8]*a,P=e[9]*l,R=e[10]*d,k=f+T+R,N=0;return k>0?(N=2*Math.sqrt(k+1),t[3]=.25*N,t[0]=(D-P)/N,t[1]=(S-y)/N,t[2]=(_-b)/N):f>T&&f>R?(N=2*Math.sqrt(1+f-T-R),t[3]=(D-P)/N,t[0]=.25*N,t[1]=(_+b)/N,t[2]=(S+y)/N):T>R?(N=2*Math.sqrt(1+T-f-R),t[3]=(S-y)/N,t[0]=(_+b)/N,t[1]=.25*N,t[2]=(D+P)/N):(N=2*Math.sqrt(1+R-f-T),t[3]=(_-b)/N,t[0]=(S+y)/N,t[1]=(D+P)/N,t[2]=.25*N),t},Ct.fromRotationTranslationScale=function(t,e,n,a){var l=e[0],d=e[1],f=e[2],_=e[3],y=l+l,b=d+d,T=f+f,D=l*y,S=l*b,P=l*T,R=d*b,k=d*T,N=f*T,V=_*y,Y=_*b,X=_*T,K=a[0],ae=a[1],oe=a[2];return t[0]=(1-(R+N))*K,t[1]=(S+X)*K,t[2]=(P-Y)*K,t[3]=0,t[4]=(S-X)*ae,t[5]=(1-(D+N))*ae,t[6]=(k+V)*ae,t[7]=0,t[8]=(P+Y)*oe,t[9]=(k-V)*oe,t[10]=(1-(D+R))*oe,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Ct.fromRotationTranslationScaleOrigin=function(t,e,n,a,l){var d=e[0],f=e[1],_=e[2],y=e[3],b=d+d,T=f+f,D=_+_,S=d*b,P=d*T,R=d*D,k=f*T,N=f*D,V=_*D,Y=y*b,X=y*T,K=y*D,ae=a[0],oe=a[1],fe=a[2],me=l[0],xe=l[1],Pe=l[2],De=(1-(k+V))*ae,ke=(P+K)*ae,He=(R-X)*ae,Oe=(P-K)*oe,je=(1-(S+V))*oe,Re=(N+Y)*oe,$e=(R+X)*fe,Ye=(N-Y)*fe,Ge=(1-(S+k))*fe;return t[0]=De,t[1]=ke,t[2]=He,t[3]=0,t[4]=Oe,t[5]=je,t[6]=Re,t[7]=0,t[8]=$e,t[9]=Ye,t[10]=Ge,t[11]=0,t[12]=n[0]+me-(De*me+Oe*xe+$e*Pe),t[13]=n[1]+xe-(ke*me+je*xe+Ye*Pe),t[14]=n[2]+Pe-(He*me+Re*xe+Ge*Pe),t[15]=1,t},Ct.fromQuat=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=n+n,_=a+a,y=l+l,b=n*f,T=a*f,D=a*_,S=l*f,P=l*_,R=l*y,k=d*f,N=d*_,V=d*y;return t[0]=1-D-R,t[1]=T+V,t[2]=S-N,t[3]=0,t[4]=T-V,t[5]=1-b-R,t[6]=P+k,t[7]=0,t[8]=S+N,t[9]=P-k,t[10]=1-b-D,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ct.frustum=function(t,e,n,a,l,d,f){var _=1/(n-e),y=1/(l-a),b=1/(d-f);return t[0]=2*d*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*y,t[6]=0,t[7]=0,t[8]=(n+e)*_,t[9]=(l+a)*y,t[10]=(f+d)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*d*2*b,t[15]=0,t},Ct.perspectiveNO=lo,Ct.perspectiveZO=function(t,e,n,a,l){var d,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=l*(d=1/(a-l)),t[14]=l*a*d):(t[10]=-1,t[14]=-a),t},Ct.perspectiveFromFieldOfView=function(t,e,n,a){var l=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),f=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),y=2/(f+_),b=2/(l+d);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(f-_)*y*.5,t[9]=(l-d)*b*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},Ct.orthoNO=co,Ct.orthoZO=function(t,e,n,a,l,d,f){var _=1/(e-n),y=1/(a-l),b=1/(d-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+n)*_,t[13]=(l+a)*y,t[14]=d*b,t[15]=1,t},Ct.lookAt=function(t,e,n,a){var l,d,f,_,y,b,T,D,S,P,R=e[0],k=e[1],N=e[2],V=a[0],Y=a[1],X=a[2],K=n[0],ae=n[1],oe=n[2];return Math.abs(R-K)<kn.EPSILON&&Math.abs(k-ae)<kn.EPSILON&&Math.abs(N-oe)<kn.EPSILON?Yo(t):(T=R-K,D=k-ae,S=N-oe,l=Y*(S*=P=1/Math.hypot(T,D,S))-X*(D*=P),d=X*(T*=P)-V*S,f=V*D-Y*T,(P=Math.hypot(l,d,f))?(l*=P=1/P,d*=P,f*=P):(l=0,d=0,f=0),_=D*f-S*d,y=S*l-T*f,b=T*d-D*l,(P=Math.hypot(_,y,b))?(_*=P=1/P,y*=P,b*=P):(_=0,y=0,b=0),t[0]=l,t[1]=_,t[2]=T,t[3]=0,t[4]=d,t[5]=y,t[6]=D,t[7]=0,t[8]=f,t[9]=b,t[10]=S,t[11]=0,t[12]=-(l*R+d*k+f*N),t[13]=-(_*R+y*k+b*N),t[14]=-(T*R+D*k+S*N),t[15]=1,t)},Ct.targetTo=function(t,e,n,a){var l=e[0],d=e[1],f=e[2],_=a[0],y=a[1],b=a[2],T=l-n[0],D=d-n[1],S=f-n[2],P=T*T+D*D+S*S;P>0&&(T*=P=1/Math.sqrt(P),D*=P,S*=P);var R=y*S-b*D,k=b*T-_*S,N=_*D-y*T;return(P=R*R+k*k+N*N)>0&&(R*=P=1/Math.sqrt(P),k*=P,N*=P),t[0]=R,t[1]=k,t[2]=N,t[3]=0,t[4]=D*N-S*k,t[5]=S*R-T*N,t[6]=T*k-D*R,t[7]=0,t[8]=T,t[9]=D,t[10]=S,t[11]=0,t[12]=l,t[13]=d,t[14]=f,t[15]=1,t},Ct.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Ct.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Ct.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Ct.subtract=Vc,Ct.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Ct.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},Ct.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Ct.equals=function(t,e){var n=t[0],a=t[1],l=t[2],d=t[3],f=t[4],_=t[5],y=t[6],b=t[7],T=t[8],D=t[9],S=t[10],P=t[11],R=t[12],k=t[13],N=t[14],V=t[15],Y=e[0],X=e[1],K=e[2],ae=e[3],oe=e[4],fe=e[5],me=e[6],xe=e[7],Pe=e[8],De=e[9],ke=e[10],He=e[11],Oe=e[12],je=e[13],Re=e[14],$e=e[15];return Math.abs(n-Y)<=kn.EPSILON*Math.max(1,Math.abs(n),Math.abs(Y))&&Math.abs(a-X)<=kn.EPSILON*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(l-K)<=kn.EPSILON*Math.max(1,Math.abs(l),Math.abs(K))&&Math.abs(d-ae)<=kn.EPSILON*Math.max(1,Math.abs(d),Math.abs(ae))&&Math.abs(f-oe)<=kn.EPSILON*Math.max(1,Math.abs(f),Math.abs(oe))&&Math.abs(_-fe)<=kn.EPSILON*Math.max(1,Math.abs(_),Math.abs(fe))&&Math.abs(y-me)<=kn.EPSILON*Math.max(1,Math.abs(y),Math.abs(me))&&Math.abs(b-xe)<=kn.EPSILON*Math.max(1,Math.abs(b),Math.abs(xe))&&Math.abs(T-Pe)<=kn.EPSILON*Math.max(1,Math.abs(T),Math.abs(Pe))&&Math.abs(D-De)<=kn.EPSILON*Math.max(1,Math.abs(D),Math.abs(De))&&Math.abs(S-ke)<=kn.EPSILON*Math.max(1,Math.abs(S),Math.abs(ke))&&Math.abs(P-He)<=kn.EPSILON*Math.max(1,Math.abs(P),Math.abs(He))&&Math.abs(R-Oe)<=kn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Oe))&&Math.abs(k-je)<=kn.EPSILON*Math.max(1,Math.abs(k),Math.abs(je))&&Math.abs(N-Re)<=kn.EPSILON*Math.max(1,Math.abs(N),Math.abs(Re))&&Math.abs(V-$e)<=kn.EPSILON*Math.max(1,Math.abs(V),Math.abs($e))},Ct.sub=Ct.mul=Ct.ortho=Ct.perspective=void 0;var kn=function(t,e){if(t&&t.__esModule)return t;if(t===null||wr(t)!=="object"&&typeof t!="function")return{default:t};var n=Qr(void 0);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(St);function Qr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Qr=function(a){return a?n:e})(t)}function Yo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ss(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=e[8],S=e[9],P=e[10],R=e[11],k=e[12],N=e[13],V=e[14],Y=e[15],X=n[0],K=n[1],ae=n[2],oe=n[3];return t[0]=X*a+K*_+ae*D+oe*k,t[1]=X*l+K*y+ae*S+oe*N,t[2]=X*d+K*b+ae*P+oe*V,t[3]=X*f+K*T+ae*R+oe*Y,t[4]=(X=n[4])*a+(K=n[5])*_+(ae=n[6])*D+(oe=n[7])*k,t[5]=X*l+K*y+ae*S+oe*N,t[6]=X*d+K*b+ae*P+oe*V,t[7]=X*f+K*T+ae*R+oe*Y,t[8]=(X=n[8])*a+(K=n[9])*_+(ae=n[10])*D+(oe=n[11])*k,t[9]=X*l+K*y+ae*S+oe*N,t[10]=X*d+K*b+ae*P+oe*V,t[11]=X*f+K*T+ae*R+oe*Y,t[12]=(X=n[12])*a+(K=n[13])*_+(ae=n[14])*D+(oe=n[15])*k,t[13]=X*l+K*y+ae*S+oe*N,t[14]=X*d+K*b+ae*P+oe*V,t[15]=X*f+K*T+ae*R+oe*Y,t}function Uc(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=a+a,y=l+l,b=d+d,T=a*_,D=a*y,S=a*b,P=l*y,R=l*b,k=d*b,N=f*_,V=f*y,Y=f*b;return t[0]=1-(P+k),t[1]=D+Y,t[2]=S-V,t[3]=0,t[4]=D-Y,t[5]=1-(T+k),t[6]=R+N,t[7]=0,t[8]=S+V,t[9]=R-N,t[10]=1-(T+P),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ol(t,e){var n=e[4],a=e[5],l=e[6],d=e[8],f=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,l),t[2]=Math.hypot(d,f,_),t}function lo(t,e,n,a,l){var d,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+a)*(d=1/(a-l)),t[14]=2*l*a*d):(t[10]=-1,t[14]=-2*a),t}function co(t,e,n,a,l,d,f){var _=1/(e-n),y=1/(a-l),b=1/(d-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+n)*_,t[13]=(l+a)*y,t[14]=(f+d)*b,t[15]=1,t}function Vc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Ct.perspective=lo,Ct.ortho=co,Ct.mul=Ss,Ct.sub=Vc;var Mt={},Pt={};function sl(t){return sl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sl(t)}Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=al,Pt.clone=function(t){var e=new Mi.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Pt.length=ll,Pt.fromValues=function(t,e,n){var a=new Mi.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},Pt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Pt.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},Pt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Pt.subtract=jc,Pt.multiply=Cs,Pt.divide=ga,Pt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Pt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Pt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Pt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Pt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Pt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Pt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},Pt.distance=cl,Pt.squaredDistance=$c,Pt.squaredLength=ul,Pt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Pt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Pt.normalize=function(t,e){var n=e[0],a=e[1],l=e[2],d=n*n+a*a+l*l;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},Pt.dot=hl,Pt.cross=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=n[0],_=n[1],y=n[2];return t[0]=l*y-d*_,t[1]=d*f-a*y,t[2]=a*_-l*f,t},Pt.lerp=function(t,e,n,a){var l=e[0],d=e[1],f=e[2];return t[0]=l+a*(n[0]-l),t[1]=d+a*(n[1]-d),t[2]=f+a*(n[2]-f),t},Pt.hermite=function(t,e,n,a,l,d){var f=d*d,_=f*(2*d-3)+1,y=f*(d-2)+d,b=f*(d-1),T=f*(3-2*d);return t[0]=e[0]*_+n[0]*y+a[0]*b+l[0]*T,t[1]=e[1]*_+n[1]*y+a[1]*b+l[1]*T,t[2]=e[2]*_+n[2]*y+a[2]*b+l[2]*T,t},Pt.bezier=function(t,e,n,a,l,d){var f=1-d,_=f*f,y=d*d,b=_*f,T=3*d*_,D=3*y*f,S=y*d;return t[0]=e[0]*b+n[0]*T+a[0]*D+l[0]*S,t[1]=e[1]*b+n[1]*T+a[1]*D+l[1]*S,t[2]=e[2]*b+n[2]*T+a[2]*D+l[2]*S,t},Pt.random=function(t,e){e=e||1;var n=2*Mi.RANDOM()*Math.PI,a=2*Mi.RANDOM()-1,l=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*l,t[1]=Math.sin(n)*l,t[2]=a*e,t},Pt.transformMat4=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=n[3]*a+n[7]*l+n[11]*d+n[15];return t[0]=(n[0]*a+n[4]*l+n[8]*d+n[12])/(f=f||1),t[1]=(n[1]*a+n[5]*l+n[9]*d+n[13])/f,t[2]=(n[2]*a+n[6]*l+n[10]*d+n[14])/f,t},Pt.transformMat3=function(t,e,n){var a=e[0],l=e[1],d=e[2];return t[0]=a*n[0]+l*n[3]+d*n[6],t[1]=a*n[1]+l*n[4]+d*n[7],t[2]=a*n[2]+l*n[5]+d*n[8],t},Pt.transformQuat=function(t,e,n){var a=n[0],l=n[1],d=n[2],f=e[0],_=e[1],y=e[2],b=l*y-d*_,T=d*f-a*y,D=a*_-l*f,S=l*D-d*T,P=d*b-a*D,R=a*T-l*b,k=2*n[3];return T*=k,D*=k,P*=2,R*=2,t[0]=f+(b*=k)+(S*=2),t[1]=_+T+P,t[2]=y+D+R,t},Pt.rotateX=function(t,e,n,a){var l=[],d=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],d[0]=l[0],d[1]=l[1]*Math.cos(a)-l[2]*Math.sin(a),d[2]=l[1]*Math.sin(a)+l[2]*Math.cos(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Pt.rotateY=function(t,e,n,a){var l=[],d=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],d[0]=l[2]*Math.sin(a)+l[0]*Math.cos(a),d[1]=l[1],d[2]=l[2]*Math.cos(a)-l[0]*Math.sin(a),t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Pt.rotateZ=function(t,e,n,a){var l=[],d=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],d[0]=l[0]*Math.cos(a)-l[1]*Math.sin(a),d[1]=l[0]*Math.sin(a)+l[1]*Math.cos(a),d[2]=l[2],t[0]=d[0]+n[0],t[1]=d[1]+n[1],t[2]=d[2]+n[2],t},Pt.angle=function(t,e){var n=t[0],a=t[1],l=t[2],d=e[0],f=e[1],_=e[2],y=Math.sqrt(n*n+a*a+l*l)*Math.sqrt(d*d+f*f+_*_),b=y&&hl(t,e)/y;return Math.acos(Math.min(Math.max(b,-1),1))},Pt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Pt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Pt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Pt.equals=function(t,e){var n=t[0],a=t[1],l=t[2],d=e[0],f=e[1],_=e[2];return Math.abs(n-d)<=Mi.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-f)<=Mi.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-_)<=Mi.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))},Pt.forEach=Pt.sqrLen=Pt.len=Pt.sqrDist=Pt.dist=Pt.div=Pt.mul=Pt.sub=void 0;var Mi=function(t,e){if(t&&t.__esModule)return t;if(t===null||sl(t)!=="object"&&typeof t!="function")return{default:t};var n=ma(void 0);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(St);function ma(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ma=function(a){return a?n:e})(t)}function al(){var t=new Mi.ARRAY_TYPE(3);return Mi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ll(t){return Math.hypot(t[0],t[1],t[2])}function jc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Cs(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ga(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function cl(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function $c(t,e){var n=e[0]-t[0],a=e[1]-t[1],l=e[2]-t[2];return n*n+a*a+l*l}function ul(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function hl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Pt.sub=jc,Pt.mul=Cs,Pt.div=ga,Pt.dist=cl,Pt.sqrDist=$c,Pt.len=ll,Pt.sqrLen=ul;var Wi,Mh=(Wi=al(),function(t,e,n,a,l,d){var f,_;for(e||(e=3),n||(n=0),_=a?Math.min(a*e+n,t.length):t.length,f=n;f<_;f+=e)Wi[0]=t[f],Wi[1]=t[f+1],Wi[2]=t[f+2],l(Wi,Wi,d),t[f]=Wi[0],t[f+1]=Wi[1],t[f+2]=Wi[2];return t});Pt.forEach=Mh;var Rt={};function Gc(t){return Gc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gc(t)}Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=_a,Rt.clone=function(t){var e=new fr.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Rt.fromValues=function(t,e,n,a){var l=new fr.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=a,l},Rt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Rt.set=function(t,e,n,a,l){return t[0]=e,t[1]=n,t[2]=a,t[3]=l,t},Rt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Rt.subtract=Mo,Rt.multiply=Ao,Rt.divide=qc,Rt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Rt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Rt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Rt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Rt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Rt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Rt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Rt.distance=Ms,Rt.squaredDistance=As,Rt.length=fl,Rt.squaredLength=pl,Rt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Rt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Rt.normalize=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=n*n+a*a+l*l+d*d;return f>0&&(f=1/Math.sqrt(f)),t[0]=n*f,t[1]=a*f,t[2]=l*f,t[3]=d*f,t},Rt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Rt.cross=function(t,e,n,a){var l=n[0]*a[1]-n[1]*a[0],d=n[0]*a[2]-n[2]*a[0],f=n[0]*a[3]-n[3]*a[0],_=n[1]*a[2]-n[2]*a[1],y=n[1]*a[3]-n[3]*a[1],b=n[2]*a[3]-n[3]*a[2],T=e[0],D=e[1],S=e[2],P=e[3];return t[0]=D*b-S*y+P*_,t[1]=-T*b+S*f-P*d,t[2]=T*y-D*f+P*l,t[3]=-T*_+D*d-S*l,t},Rt.lerp=function(t,e,n,a){var l=e[0],d=e[1],f=e[2],_=e[3];return t[0]=l+a*(n[0]-l),t[1]=d+a*(n[1]-d),t[2]=f+a*(n[2]-f),t[3]=_+a*(n[3]-_),t},Rt.random=function(t,e){var n,a,l,d,f,_;e=e||1;do f=(n=2*fr.RANDOM()-1)*n+(a=2*fr.RANDOM()-1)*a;while(f>=1);do _=(l=2*fr.RANDOM()-1)*l+(d=2*fr.RANDOM()-1)*d;while(_>=1);var y=Math.sqrt((1-f)/_);return t[0]=e*n,t[1]=e*a,t[2]=e*l*y,t[3]=e*d*y,t},Rt.transformMat4=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3];return t[0]=n[0]*a+n[4]*l+n[8]*d+n[12]*f,t[1]=n[1]*a+n[5]*l+n[9]*d+n[13]*f,t[2]=n[2]*a+n[6]*l+n[10]*d+n[14]*f,t[3]=n[3]*a+n[7]*l+n[11]*d+n[15]*f,t},Rt.transformQuat=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=n[0],_=n[1],y=n[2],b=n[3],T=b*a+_*d-y*l,D=b*l+y*a-f*d,S=b*d+f*l-_*a,P=-f*a-_*l-y*d;return t[0]=T*b+P*-f+D*-y-S*-_,t[1]=D*b+P*-_+S*-f-T*-y,t[2]=S*b+P*-y+T*-_-D*-f,t[3]=e[3],t},Rt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Rt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Rt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Rt.equals=function(t,e){var n=t[0],a=t[1],l=t[2],d=t[3],f=e[0],_=e[1],y=e[2],b=e[3];return Math.abs(n-f)<=fr.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-_)<=fr.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-y)<=fr.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-b)<=fr.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Rt.forEach=Rt.sqrLen=Rt.len=Rt.sqrDist=Rt.dist=Rt.div=Rt.mul=Rt.sub=void 0;var fr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Gc(t)!=="object"&&typeof t!="function")return{default:t};var n=dl(void 0);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(St);function dl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(dl=function(a){return a?n:e})(t)}function _a(){var t=new fr.ARRAY_TYPE(4);return fr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Mo(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Ao(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function qc(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ms(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function As(t,e){var n=e[0]-t[0],a=e[1]-t[1],l=e[2]-t[2],d=e[3]-t[3];return n*n+a*a+l*l+d*d}function fl(t){return Math.hypot(t[0],t[1],t[2],t[3])}function pl(t){var e=t[0],n=t[1],a=t[2],l=t[3];return e*e+n*n+a*a+l*l}Rt.sub=Mo,Rt.mul=Ao,Rt.div=qc,Rt.dist=Ms,Rt.sqrDist=As,Rt.len=fl,Rt.sqrLen=pl;var Ah=function(){var t=_a();return function(e,n,a,l,d,f){var _,y;for(n||(n=4),a||(a=0),y=l?Math.min(l*n+a,e.length):e.length,_=a;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],d(t,t,f),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function ml(t){return ml=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ml(t)}Rt.forEach=Ah,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=gl,Mt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Mt.setAxisAngle=Hc,Mt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>Zi.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},Mt.getAngle=function(t,e){var n=de(t,e);return Math.acos(2*n*n-1)},Mt.multiply=_l,Mt.rotateX=function(t,e,n){n*=.5;var a=e[0],l=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+f*_,t[1]=l*y+d*_,t[2]=d*y-l*_,t[3]=f*y-a*_,t},Mt.rotateY=function(t,e,n){n*=.5;var a=e[0],l=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y-d*_,t[1]=l*y+f*_,t[2]=d*y+a*_,t[3]=f*y-l*_,t},Mt.rotateZ=function(t,e,n){n*=.5;var a=e[0],l=e[1],d=e[2],f=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=a*y+l*_,t[1]=l*y-a*_,t[2]=d*y+f*_,t[3]=f*y-d*_,t},Mt.calculateW=function(t,e){var n=e[0],a=e[1],l=e[2];return t[0]=n,t[1]=a,t[2]=l,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-l*l)),t},Mt.exp=ge,Mt.ln=j,Mt.pow=function(t,e,n){return j(t,e),he(t,t,n),ge(t,t),t},Mt.slerp=W,Mt.random=function(t){var e=Zi.RANDOM(),n=Zi.RANDOM(),a=Zi.RANDOM(),l=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=l*Math.sin(2*Math.PI*n),t[1]=l*Math.cos(2*Math.PI*n),t[2]=d*Math.sin(2*Math.PI*a),t[3]=d*Math.cos(2*Math.PI*a),t},Mt.invert=function(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=n*n+a*a+l*l+d*d,_=f?1/f:0;return t[0]=-n*_,t[1]=-a*_,t[2]=-l*_,t[3]=d*_,t},Mt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Mt.fromMat3=ie,Mt.fromEuler=function(t,e,n,a){var l=.5*Math.PI/180;e*=l,n*=l,a*=l;var d=Math.sin(e),f=Math.cos(e),_=Math.sin(n),y=Math.cos(n),b=Math.sin(a),T=Math.cos(a);return t[0]=d*y*T-f*_*b,t[1]=f*_*T+d*y*b,t[2]=f*y*b-d*_*T,t[3]=f*y*T+d*_*b,t},Mt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Mt.setAxes=Mt.sqlerp=Mt.rotationTo=Mt.equals=Mt.exactEquals=Mt.normalize=Mt.sqrLen=Mt.squaredLength=Mt.len=Mt.length=Mt.lerp=Mt.dot=Mt.scale=Mt.mul=Mt.add=Mt.set=Mt.copy=Mt.fromValues=Mt.clone=void 0;var Zi=ya(St),Ps=ya(zt),Yi=ya(Pt),jr=ya(Rt);function Ph(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ph=function(a){return a?n:e})(t)}function ya(t,e){if(t&&t.__esModule)return t;if(t===null||ml(t)!=="object"&&typeof t!="function")return{default:t};var n=Ph(e);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function gl(){var t=new Zi.ARRAY_TYPE(4);return Zi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Hc(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function _l(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*T+f*_+l*b-d*y,t[1]=l*T+f*y+d*_-a*b,t[2]=d*T+f*b+a*y-l*_,t[3]=f*T-a*_-l*y-d*b,t}function ge(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=Math.sqrt(n*n+a*a+l*l),_=Math.exp(d),y=f>0?_*Math.sin(f)/f:0;return t[0]=n*y,t[1]=a*y,t[2]=l*y,t[3]=_*Math.cos(f),t}function j(t,e){var n=e[0],a=e[1],l=e[2],d=e[3],f=Math.sqrt(n*n+a*a+l*l),_=f>0?Math.atan2(f,d)/f:0;return t[0]=n*_,t[1]=a*_,t[2]=l*_,t[3]=.5*Math.log(n*n+a*a+l*l+d*d),t}function W(t,e,n,a){var l,d,f,_,y,b=e[0],T=e[1],D=e[2],S=e[3],P=n[0],R=n[1],k=n[2],N=n[3];return(d=b*P+T*R+D*k+S*N)<0&&(d=-d,P=-P,R=-R,k=-k,N=-N),1-d>Zi.EPSILON?(l=Math.acos(d),f=Math.sin(l),_=Math.sin((1-a)*l)/f,y=Math.sin(a*l)/f):(_=1-a,y=a),t[0]=_*b+y*P,t[1]=_*T+y*R,t[2]=_*D+y*k,t[3]=_*S+y*N,t}function ie(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var l=0;e[4]>e[0]&&(l=1),e[8]>e[3*l+l]&&(l=2);var d=(l+1)%3,f=(l+2)%3;n=Math.sqrt(e[3*l+l]-e[3*d+d]-e[3*f+f]+1),t[l]=.5*n,t[3]=(e[3*d+f]-e[3*f+d])*(n=.5/n),t[d]=(e[3*d+l]+e[3*l+d])*n,t[f]=(e[3*f+l]+e[3*l+f])*n}return t}Mt.clone=jr.clone,Mt.fromValues=jr.fromValues,Mt.copy=jr.copy,Mt.set=jr.set,Mt.add=jr.add,Mt.mul=_l;var he=jr.scale;Mt.scale=he;var de=jr.dot;Mt.dot=de,Mt.lerp=jr.lerp;var ve=jr.length;Mt.length=ve,Mt.len=ve;var Ce=jr.squaredLength;Mt.squaredLength=Ce,Mt.sqrLen=Ce;var _e=jr.normalize;Mt.normalize=_e,Mt.exactEquals=jr.exactEquals,Mt.equals=jr.equals;var Me,Qe,Ze,pt=(Me=Yi.create(),Qe=Yi.fromValues(1,0,0),Ze=Yi.fromValues(0,1,0),function(t,e,n){var a=Yi.dot(e,n);return a<-.999999?(Yi.cross(Me,Qe,e),Yi.len(Me)<1e-6&&Yi.cross(Me,Ze,e),Yi.normalize(Me,Me),Hc(t,Me,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Yi.cross(Me,e,n),t[0]=Me[0],t[1]=Me[1],t[2]=Me[2],t[3]=1+a,_e(t,t))});Mt.rotationTo=pt;var It,Wt,Kt=(It=gl(),Wt=gl(),function(t,e,n,a,l,d){return W(It,e,l,d),W(Wt,n,a,d),W(t,It,Wt,2*d*(1-d)),t});Mt.sqlerp=Kt;var kt,nn=(kt=Ps.create(),function(t,e,n,a){return kt[0]=n[0],kt[3]=n[1],kt[6]=n[2],kt[1]=a[0],kt[4]=a[1],kt[7]=a[2],kt[2]=-e[0],kt[5]=-e[1],kt[8]=-e[2],_e(t,ie(t,kt))});Mt.setAxes=nn;var ht={};function Kn(t){return Kn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(t)}Object.defineProperty(ht,"__esModule",{value:!0}),ht.create=function(){var t=new Ln.ARRAY_TYPE(8);return Ln.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},ht.clone=function(t){var e=new Ln.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},ht.fromValues=function(t,e,n,a,l,d,f,_){var y=new Ln.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=a,y[4]=l,y[5]=d,y[6]=f,y[7]=_,y},ht.fromRotationTranslationValues=function(t,e,n,a,l,d,f){var _=new Ln.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=n,_[3]=a;var y=.5*l,b=.5*d,T=.5*f;return _[4]=y*a+b*n-T*e,_[5]=b*a+T*t-y*n,_[6]=T*a+y*e-b*t,_[7]=-y*t-b*e-T*n,_},ht.fromRotationTranslation=Jr,ht.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},ht.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},ht.fromMat4=function(t,e){var n=un.create();_r.getRotation(n,e);var a=new Ln.ARRAY_TYPE(3);return _r.getTranslation(a,e),Jr(t,n,a),t},ht.copy=ei,ht.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},ht.set=function(t,e,n,a,l,d,f,_,y){return t[0]=e,t[1]=n,t[2]=a,t[3]=l,t[4]=d,t[5]=f,t[6]=_,t[7]=y,t},ht.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},ht.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},ht.getTranslation=function(t,e){var n=e[4],a=e[5],l=e[6],d=e[7],f=-e[0],_=-e[1],y=-e[2],b=e[3];return t[0]=2*(n*b+d*f+a*y-l*_),t[1]=2*(a*b+d*_+l*f-n*y),t[2]=2*(l*b+d*y+n*_-a*f),t},ht.translate=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=.5*n[0],y=.5*n[1],b=.5*n[2],T=e[4],D=e[5],S=e[6],P=e[7];return t[0]=a,t[1]=l,t[2]=d,t[3]=f,t[4]=f*_+l*b-d*y+T,t[5]=f*y+d*_-a*b+D,t[6]=f*b+a*y-l*_+S,t[7]=-a*_-l*y-d*b+P,t},ht.rotateX=function(t,e,n){var a=-e[0],l=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=_*f+T*a+y*d-b*l,S=y*f+T*l+b*a-_*d,P=b*f+T*d+_*l-y*a,R=T*f-_*a-y*l-b*d;return un.rotateX(t,e,n),t[4]=D*(f=t[3])+R*(a=t[0])+S*(d=t[2])-P*(l=t[1]),t[5]=S*f+R*l+P*a-D*d,t[6]=P*f+R*d+D*l-S*a,t[7]=R*f-D*a-S*l-P*d,t},ht.rotateY=function(t,e,n){var a=-e[0],l=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=_*f+T*a+y*d-b*l,S=y*f+T*l+b*a-_*d,P=b*f+T*d+_*l-y*a,R=T*f-_*a-y*l-b*d;return un.rotateY(t,e,n),t[4]=D*(f=t[3])+R*(a=t[0])+S*(d=t[2])-P*(l=t[1]),t[5]=S*f+R*l+P*a-D*d,t[6]=P*f+R*d+D*l-S*a,t[7]=R*f-D*a-S*l-P*d,t},ht.rotateZ=function(t,e,n){var a=-e[0],l=-e[1],d=-e[2],f=e[3],_=e[4],y=e[5],b=e[6],T=e[7],D=_*f+T*a+y*d-b*l,S=y*f+T*l+b*a-_*d,P=b*f+T*d+_*l-y*a,R=T*f-_*a-y*l-b*d;return un.rotateZ(t,e,n),t[4]=D*(f=t[3])+R*(a=t[0])+S*(d=t[2])-P*(l=t[1]),t[5]=S*f+R*l+P*a-D*d,t[6]=P*f+R*d+D*l-S*a,t[7]=R*f-D*a-S*l-P*d,t},ht.rotateByQuatAppend=function(t,e,n){var a=n[0],l=n[1],d=n[2],f=n[3],_=e[0],y=e[1],b=e[2],T=e[3];return t[0]=_*f+T*a+y*d-b*l,t[1]=y*f+T*l+b*a-_*d,t[2]=b*f+T*d+_*l-y*a,t[3]=T*f-_*a-y*l-b*d,t[4]=(_=e[4])*f+(T=e[7])*a+(y=e[5])*d-(b=e[6])*l,t[5]=y*f+T*l+b*a-_*d,t[6]=b*f+T*d+_*l-y*a,t[7]=T*f-_*a-y*l-b*d,t},ht.rotateByQuatPrepend=function(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=n[0],y=n[1],b=n[2],T=n[3];return t[0]=a*T+f*_+l*b-d*y,t[1]=l*T+f*y+d*_-a*b,t[2]=d*T+f*b+a*y-l*_,t[3]=f*T-a*_-l*y-d*b,t[4]=a*(T=n[7])+f*(_=n[4])+l*(b=n[6])-d*(y=n[5]),t[5]=l*T+f*y+d*_-a*b,t[6]=d*T+f*b+a*y-l*_,t[7]=f*T-a*_-l*y-d*b,t},ht.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<Ln.EPSILON)return ei(t,e);var l=Math.hypot(n[0],n[1],n[2]);a*=.5;var d=Math.sin(a),f=d*n[0]/l,_=d*n[1]/l,y=d*n[2]/l,b=Math.cos(a),T=e[0],D=e[1],S=e[2],P=e[3];t[0]=T*b+P*f+D*y-S*_,t[1]=D*b+P*_+S*f-T*y,t[2]=S*b+P*y+T*_-D*f,t[3]=P*b-T*f-D*_-S*y;var R=e[4],k=e[5],N=e[6],V=e[7];return t[4]=R*b+V*f+k*y-N*_,t[5]=k*b+V*_+N*f-R*y,t[6]=N*b+V*y+R*_-k*f,t[7]=V*b-R*f-k*_-N*y,t},ht.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},ht.multiply=va,ht.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},ht.lerp=function(t,e,n,a){var l=1-a;return qf(e,n)<0&&(a=-a),t[0]=e[0]*l+n[0]*a,t[1]=e[1]*l+n[1]*a,t[2]=e[2]*l+n[2]*a,t[3]=e[3]*l+n[3]*a,t[4]=e[4]*l+n[4]*a,t[5]=e[5]*l+n[5]*a,t[6]=e[6]*l+n[6]*a,t[7]=e[7]*l+n[7]*a,t},ht.invert=function(t,e){var n=Wc(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},ht.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},ht.normalize=function(t,e){var n=Wc(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,l=e[1]/n,d=e[2]/n,f=e[3]/n,_=e[4],y=e[5],b=e[6],T=e[7],D=a*_+l*y+d*b+f*T;t[0]=a,t[1]=l,t[2]=d,t[3]=f,t[4]=(_-a*D)/n,t[5]=(y-l*D)/n,t[6]=(b-d*D)/n,t[7]=(T-f*D)/n}return t},ht.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},ht.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},ht.equals=function(t,e){var n=t[0],a=t[1],l=t[2],d=t[3],f=t[4],_=t[5],y=t[6],b=t[7],T=e[0],D=e[1],S=e[2],P=e[3],R=e[4],k=e[5],N=e[6],V=e[7];return Math.abs(n-T)<=Ln.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-D)<=Ln.EPSILON*Math.max(1,Math.abs(a),Math.abs(D))&&Math.abs(l-S)<=Ln.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(d-P)<=Ln.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-R)<=Ln.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(_-k)<=Ln.EPSILON*Math.max(1,Math.abs(_),Math.abs(k))&&Math.abs(y-N)<=Ln.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(b-V)<=Ln.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))},ht.sqrLen=ht.squaredLength=ht.len=ht.length=ht.dot=ht.mul=ht.setReal=ht.getReal=void 0;var Ln=Dr(St),un=Dr(Mt),_r=Dr(Ct);function Qn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Qn=function(a){return a?n:e})(t)}function Dr(t,e){if(t&&t.__esModule)return t;if(t===null||Kn(t)!=="object"&&typeof t!="function")return{default:t};var n=Qn(e);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}function Jr(t,e,n){var a=.5*n[0],l=.5*n[1],d=.5*n[2],f=e[0],_=e[1],y=e[2],b=e[3];return t[0]=f,t[1]=_,t[2]=y,t[3]=b,t[4]=a*b+l*y-d*_,t[5]=l*b+d*f-a*y,t[6]=d*b+a*_-l*f,t[7]=-a*f-l*_-d*y,t}function ei(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function va(t,e,n){var a=e[0],l=e[1],d=e[2],f=e[3],_=n[4],y=n[5],b=n[6],T=n[7],D=e[4],S=e[5],P=e[6],R=e[7],k=n[0],N=n[1],V=n[2],Y=n[3];return t[0]=a*Y+f*k+l*V-d*N,t[1]=l*Y+f*N+d*k-a*V,t[2]=d*Y+f*V+a*N-l*k,t[3]=f*Y-a*k-l*N-d*V,t[4]=a*T+f*_+l*b-d*y+D*Y+R*k+S*V-P*N,t[5]=l*T+f*y+d*_-a*b+S*Y+R*N+P*k-D*V,t[6]=d*T+f*b+a*y-l*_+P*Y+R*V+D*N-S*k,t[7]=f*T-a*_-l*y-d*b+R*Y-D*k-S*N-P*V,t}ht.getReal=un.copy,ht.setReal=un.copy,ht.mul=va;var qf=un.dot;ht.dot=qf;var s_=un.length;ht.length=s_,ht.len=s_;var Wc=un.squaredLength;ht.squaredLength=Wc,ht.sqrLen=Wc;var qt={};function Hf(t){return Hf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hf(t)}Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=Zf,qt.clone=function(t){var e=new Rs.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},qt.fromValues=function(t,e){var n=new Rs.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},qt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},qt.set=function(t,e,n){return t[0]=e,t[1]=n,t},qt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},qt.subtract=Yf,qt.multiply=Xf,qt.divide=Kf,qt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},qt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},qt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},qt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},qt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},qt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},qt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},qt.distance=Qf,qt.squaredDistance=Jf,qt.length=ep,qt.squaredLength=tp,qt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},qt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},qt.normalize=function(t,e){var n=e[0],a=e[1],l=n*n+a*a;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t},qt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},qt.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},qt.lerp=function(t,e,n,a){var l=e[0],d=e[1];return t[0]=l+a*(n[0]-l),t[1]=d+a*(n[1]-d),t},qt.random=function(t,e){e=e||1;var n=2*Rs.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},qt.transformMat2=function(t,e,n){var a=e[0],l=e[1];return t[0]=n[0]*a+n[2]*l,t[1]=n[1]*a+n[3]*l,t},qt.transformMat2d=function(t,e,n){var a=e[0],l=e[1];return t[0]=n[0]*a+n[2]*l+n[4],t[1]=n[1]*a+n[3]*l+n[5],t},qt.transformMat3=function(t,e,n){var a=e[0],l=e[1];return t[0]=n[0]*a+n[3]*l+n[6],t[1]=n[1]*a+n[4]*l+n[7],t},qt.transformMat4=function(t,e,n){var a=e[0],l=e[1];return t[0]=n[0]*a+n[4]*l+n[12],t[1]=n[1]*a+n[5]*l+n[13],t},qt.rotate=function(t,e,n,a){var l=e[0]-n[0],d=e[1]-n[1],f=Math.sin(a),_=Math.cos(a);return t[0]=l*_-d*f+n[0],t[1]=l*f+d*_+n[1],t},qt.angle=function(t,e){var n=t[0],a=t[1],l=e[0],d=e[1],f=Math.sqrt(n*n+a*a)*Math.sqrt(l*l+d*d);return Math.acos(Math.min(Math.max(f&&(n*l+a*d)/f,-1),1))},qt.zero=function(t){return t[0]=0,t[1]=0,t},qt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},qt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},qt.equals=function(t,e){var n=t[0],a=t[1],l=e[0],d=e[1];return Math.abs(n-l)<=Rs.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-d)<=Rs.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},qt.forEach=qt.sqrLen=qt.sqrDist=qt.dist=qt.div=qt.mul=qt.sub=qt.len=void 0;var Rs=function(t,e){if(t&&t.__esModule)return t;if(t===null||Hf(t)!=="object"&&typeof t!="function")return{default:t};var n=Wf(void 0);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}(St);function Wf(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Wf=function(a){return a?n:e})(t)}function Zf(){var t=new Rs.ARRAY_TYPE(2);return Rs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Yf(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Xf(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Kf(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Qf(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Jf(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function ep(t){return Math.hypot(t[0],t[1])}function tp(t){var e=t[0],n=t[1];return e*e+n*n}qt.len=ep,qt.sub=Yf,qt.mul=Xf,qt.div=Kf,qt.dist=Qf,qt.sqrDist=Jf,qt.sqrLen=tp;var a_=function(){var t=Zf();return function(e,n,a,l,d,f){var _,y;for(n||(n=2),a||(a=0),y=l?Math.min(l*n+a,e.length):e.length,_=a;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],d(t,t,f),e[_]=t[0],e[_+1]=t[1];return e}}();function yl(t){return yl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yl(t)}qt.forEach=a_,Object.defineProperty(bt,"__esModule",{value:!0}),r.aA=bt.vec4=r._=bt.vec3=bt.vec2=bt.quat2=r.av=bt.quat=r.ad=bt.mat4=r.bC=bt.mat3=bt.mat2d=r.aC=bt.mat2=bt.glMatrix=void 0;var Rh=Po(St);bt.glMatrix=Rh;var Oh=Po(Yt);r.aC=bt.mat2=Oh;var l_=Po(On);bt.mat2d=l_;var c_=Po(zt);r.bC=bt.mat3=c_;var u_=Po(Ct);r.ad=bt.mat4=u_;var vl=Po(Mt);r.av=bt.quat=vl;var en=Po(ht);bt.quat2=en;var t1=Po(qt);bt.vec2=t1;var n1=Po(Pt);r._=bt.vec3=n1;var r1=Po(Rt);function np(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(np=function(a){return a?n:e})(t)}function Po(t,e){if(t&&t.__esModule)return t;if(t===null||yl(t)!=="object"&&typeof t!="function")return{default:t};var n=np(e);if(n&&n.has(t))return n.get(t);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var f=l?Object.getOwnPropertyDescriptor(t,d):null;f&&(f.get||f.set)?Object.defineProperty(a,d,f):a[d]=t[d]}return a.default=t,n&&n.set(t,a),a}r.aA=bt.vec4=r1;var rp=Zc;function Zc(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Zc.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var l=this.sampleCurveX(n)-t;if(Math.abs(l)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=l/d}var f=0,_=1;for(n=t,a=0;a<20&&(l=this.sampleCurveX(n),!(Math.abs(l-t)<e));a++)t>l?f=n:_=n,n=.5*(_-f)+f;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Yc=ct(rp),Lh=xa;function xa(t,e){this.x=t,this.y=e}xa.prototype={clone:function(){return new xa(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),l=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xa.convert=function(t){return t instanceof xa?t:Array.isArray(t)?new xa(t[0],t[1]):t};var rt=ct(Lh);let h_=Math.PI/180,Xc=180/Math.PI;function rn(t){return t*h_}function ti(t){return t*Xc}let d_=[[0,0],[1,0],[1,1],[0,1]];function ip(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Kc(t,e,n,a){let l=new Yc(t,e,n,a);return function(d){return l.solve(d)}}let xl=Kc(.25,.1,.25,1);function Zt(t,e,n){return Math.min(n,Math.max(e,t))}function ba(t,e,n){return(n=Zt((n-t)/(e-t),0,1))*n*(3-2*n)}function wa(t,e,n){let a=n-e,l=((t-e)%a+a)%a+e;return l===e?n:l}function bl(t,e,n){if(!t.length)return n(null,[]);let a=t.length,l=new Array(t.length),d=null;t.forEach((f,_)=>{e(f,(y,b)=>{y&&(d=y),l[_]=b,--a==0&&n(d,l)})})}function Xi(t){let e=[];for(let n in t)e.push(t[n]);return e}function ni(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}let i1=1;function kh(){return i1++}function Fh(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function op(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function sp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Nh(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Qc(t,e){return t.indexOf(e,t.length-e.length)!==-1}function wl(t,e,n){let a={};for(let l in t)a[l]=e.call(this,t[l],l,t);return a}function Ea(t,e,n){let a={};for(let l in t)e.call(this,t[l],l,t)&&(a[l]=t[l]);return a}function Ro(t){return Array.isArray(t)?t.map(Ro):typeof t=="object"&&t?wl(t,Ro):t}let ap={};function yr(t){ap[t]||(typeof console<"u"&&console.warn(t),ap[t]=!0)}function Oo(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function fi(t){let e=0;for(let n,a,l=0,d=t.length,f=d-1;l<d;f=l++)n=t[l],a=t[f],e+=(a.x-n.x)*(n.y+a.y);return e}function Xo([t,e,n]){let a=rn(e+90),l=rn(n);return{x:t*Math.cos(a)*Math.sin(l),y:t*Math.sin(a)*Math.sin(l),z:t*Math.cos(l),azimuthal:e,polar:n}}function $r(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function lp(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,l,d)=>{let f=l||d;return e[a]=!f||f.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let cp,zh,El,Jc,Ko,eu,Bh=null;function Ta(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function tu(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function up(t,e,n,a){for(;e<n;){let l=e+n>>1;t[l]<a?e=l+1:n=l}return e}function f_(t,e,n,a){for(;e<n;){let l=e+n>>1;t[l]<=a?e=l+1:n=l}return e}function Uh(t){return t>0?1/(1.001-t):1+t}function Vh(t){return t>0?1-1/(1.001-t):-t}function Tl(){return cp==null&&(cp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),cp}let Gr={now:()=>Jc!==void 0?Jc:performance.now(),setNow(t){Jc=t},restoreNow(){Jc=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:a}=t;Ko||(Ko=document.createElement("canvas"));let l=Ko.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(n>Ko.width||a>Ko.height)&&(Ko.width=n,Ko.height=a),l.clearRect(-e,-e,n+2*e,a+2*e),l.drawImage(t,0,0,n,a),l.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(zh||(zh=document.createElement("a")),zh.href=t,zh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(El==null&&(El=window.matchMedia("(prefers-reduced-motion: reduce)")),El.matches)},hasCanvasFingerprintNoise(){if(eu!==void 0)return eu;if(!Tl())return eu=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let l=0;l<t.width;++l)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(l,0,1,1);let a=e.getImageData(0,0,t.width,t.height);n=0;for(let l=0;l<a.data.length;++l)if(l%4!=3&&n++!==a.data[l])return eu=!0,!0;return eu=!1,!1}};function jh(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(n));for(let l in e)a.set(l,e[l]);return`${t.slice(0,n)}?${a.toString()}`}function hp(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let a=new URLSearchParams,l=new URLSearchParams(t.slice(n));for(let f of e.persistentParams){let _=l.get(f);_&&a.set(f,_)}let d=a.toString();return`${t.slice(0,n)}${d.length>0?`?${d}`:""}`}let p_="mapbox-tiles",dp=500,fp=50,Qo,$h;function m_(){try{return caches}catch{}}function nu(){let t=m_();t&&!Qo&&(Qo=t.open(p_))}let Gh=1/0,qh={supported:!1,testSupport:function(t){!pp&&Dl&&(mp?g_(t):Il=t)}},Il,Dl,pp=!1,mp=!1,gp=typeof self<"u"?self:{};function g_(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Dl),t.isContextLost())return;qh.supported=!0}catch{}t.deleteTexture(e),pp=!0}gp.document&&(Dl=gp.document.createElement("img"),Dl.onload=function(){Il&&g_(Il),Il=null,mp=!0},Dl.onerror=function(){pp=!0,Il=null},Dl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Hh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Hh);class _p extends Error{constructor(e,n,a){n===401&&z(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Wh=$r()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ru=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Wh())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,l){let d=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Wh(),referrerPolicy:a.referrerPolicy,signal:d.signal}),_=!1,y=!1,b=(T=f.url).indexOf("sku=")>0&&z(T);var T;a.type==="json"&&f.headers.set("Accept","application/json");let D=(P,R,k)=>{if(y)return;if(P&&P.message!=="SecurityError"&&yr(P.toString()),R&&k)return S(R);let N=Date.now();fetch(f).then(V=>{if(V.ok){let Y=b?V.clone():null;return S(V,Y,N)}return l(new _p(V.statusText,V.status,a.url))}).catch(V=>{V.name!=="AbortError"&&l(new Error(`${V.message} ${a.url}`))})},S=(P,R,k)=>{(a.type==="arrayBuffer"?P.arrayBuffer():a.type==="json"?P.json():P.text()).then(N=>{y||(R&&k&&function(V,Y,X){if(nu(),!Qo)return;let K=lp(Y.headers.get("Cache-Control")||"");if(K["no-store"])return;let ae={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((me,xe)=>ae.headers.set(xe,me)),K["max-age"]&&ae.headers.set("Expires",new Date(X+1e3*K["max-age"]).toUTCString());let oe=ae.headers.get("Expires");if(!oe||new Date(oe).getTime()-X<42e4)return;let fe=hp(V.url,{persistentParams:["language","worldview"]});if(Y.status===206){let me=V.headers.get("Range");if(!me)return;ae.status=200,fe=jh(fe,{range:me})}(function(me,xe){if($h===void 0)try{new Response(new ReadableStream),$h=!0}catch{$h=!1}$h?xe(me.body):me.blob().then(xe)})(Y,me=>{let xe=new Response((Pe=Y.status)!==200&&Pe!==404&&[101,103,204,205,304].includes(Pe)?null:me,ae);var Pe;nu(),Qo&&Qo.then(De=>De.put(fe,xe)).catch(De=>yr(De.message))})}(f,R,k),_=!0,l(null,N,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(N=>{y||l(new Error(N.message))})};return b?function(P,R){if(nu(),!Qo)return R(null);Qo.then(k=>{let N=hp(P.url,{persistentParams:["language","worldview"]}),V=P.headers.get("Range");V&&(N=jh(N,{range:V})),k.match(N).then(Y=>{let X=function(K){if(!K)return!1;let ae=new Date(K.headers.get("Expires")||0),oe=lp(K.headers.get("Cache-Control")||"");return ae>Date.now()&&!oe["no-cache"]}(Y);k.delete(N),X&&k.put(N,Y.clone()),R(null,Y,X)}).catch(R)}).catch(R)}(f,D):D(null,null),{cancel:()=>{y=!0,_||d.abort()}}}(t,e);if($r()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,l){let d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let f in a.headers)d.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{l(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(a.type==="json")try{f=JSON.parse(d.response)}catch(_){return l(_)}l(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else l(new _p(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(t,e)},Ia=function(t,e){return ru(ni(t,{type:"arrayBuffer"}),e)};function __(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let yp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",iu,ou;iu=[],ou=0;let Os=function(t,e){if(qh.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ou>=O.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return iu.push(d),d}ou++;let n=!1,a=()=>{if(!n)for(n=!0,ou--;iu.length&&ou<O.MAX_PARALLEL_IMAGE_REQUESTS;){let d=iu.shift(),{requestParameters:f,callback:_,cancelled:y}=d;y||(d.cancel=Os(f,_).cancel)}},l=Ia(t,(d,f,_,y)=>{a(),d?e(d):f&&(self.createImageBitmap?function(b,T){let D=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(D).then(S=>{T(null,S)}).catch(S=>{T(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,T)=>e(b,T,_,y)):function(b,T){let D=new Image;D.onload=()=>{T(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=yp})},D.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(b)],{type:"image/png"});D.src=b.byteLength?URL.createObjectURL(S):yp}(f,(b,T)=>e(b,T,_,y)))});return{cancel:()=>{l.cancel(),a()}}},vp="01",xp="NO_ACCESS_TOKEN",o1=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function uo(t){let e=t.match(o1);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Sl(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Zh="mapbox.eventData";function y_(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class su{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=y_(O.ACCESS_TOKEN),a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(l,d)=>String.fromCharCode(+("0x"+d)))):O.ACCESS_TOKEN||"",e?`${Zh}.${e}:${a}`:`${Zh}:${a}`}fetchEventData(){let e=Ta("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let l=localStorage.getItem(n);l&&(this.eventData=JSON.parse(l));let d=localStorage.getItem(a);d&&(this.anonId=d)}catch{yr("Unable to read from LocalStorage")}}saveEventData(){let e=Ta("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),l=this.anonId;if(e&&l)try{localStorage.setItem(a,l),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{yr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,l){if(!O.EVENTS_URL)return;let d=uo(O.EVENTS_URL);d.params.push(`access_token=${l||O.ACCESS_TOKEN||""}`);let f={event:this.type,created:new Date(e).toISOString()},_=n?ni(f,n):f,y={url:Sl(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,T){return ru(ni(b,{method:"POST"}),T)}(y,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(l)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let v_=new class extends su{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Z(n)||z(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=y_(O.ACCESS_TOKEN),n=e?e.u:O.ACCESS_TOKEN,a=n!==this.eventData.tokenU;sp(this.anonId)||(this.anonId=Fh(),a=!0);let l=this.queue.shift();if(this.eventData.lastSuccess){let d=new Date(this.eventData.lastSuccess),f=new Date(l),_=(l-this.eventData.lastSuccess)/864e5;a=a||_>=1||_<-1||d.getDate()!==f.getDate()}else a=!0;a?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:vp,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=l,this.eventData.tokenU=n)},t):this.processRequests()}},bp=v_.postTurnstileEvent.bind(v_),au=new class extends su{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,O.EVENTS_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(xp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),sp(this.anonId)||(this.anonId=Fh()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:vp,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},x_=au.postMapLoadEvent.bind(au),b_=new class extends su{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=Fh(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:a,importedStyles:l}=e;if(!O.EVENTS_URL||!t&&!O.ACCESS_TOKEN)return;let d=this.getMapInstanceId(n),f={mapInstanceId:d,eventId:this.getEventId(d),style:a};l.length&&(f.importedStyles=l),this.queueRequest({timestamp:Date.now(),payload:f},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},s1=b_.postStyleLoadEvent.bind(b_),Yh=new class extends su{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){O.EVENTS_URL&&(t||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(l){let d=performance.getEntriesByType("resource"),f=performance.getEntriesByType("mark"),_=function(P){let R={};if(P){for(let k in P)if(k!=="other")for(let N of P[k]){let V=`${k}ResolveRangeMin`,Y=`${k}ResolveRangeMax`,X=`${k}RequestCount`,K=`${k}RequestCachedCount`;R[V]=Math.min(R[V]||1/0,N.startTime),R[Y]=Math.max(R[Y]||-1/0,N.responseEnd);let ae=oe=>{R[oe]===void 0&&(R[oe]=0),++R[oe]};N.transferSize!==void 0&&N.transferSize===0&&ae(K),ae(X)}}return R}(function(P,R){let k={};if(P)for(let N of P){let V=R(N);k[V]===void 0&&(k[V]=[]),k[V].push(N)}return k}(d,dt)),y=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=b?b.effectiveType:void 0,D={counters:[],metadata:[],attributes:[]},S=(P,R,k)=>{k!=null&&P.push({name:R,value:k.toString()})};for(let P in _)S(D.counters,P,_[P]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(S(D.counters,"interactionRangeMin",l.interactionRange[0]),S(D.counters,"interactionRangeMax",l.interactionRange[1])),f)for(let P of Object.keys(qe)){let R=qe[P],k=f.find(N=>N.name===R);k&&S(D.counters,R,k.startTime)}return S(D.counters,"visibilityHidden",l.visibilityHidden),S(D.attributes,"style",function(P){if(P)for(let R of P){let k=R.name.split("?")[0];if(be(k)){let N=k.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(d)),S(D.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),S(D.attributes,"fogEnabled",l.fogEnabled?"true":"false"),S(D.attributes,"projection",l.projection),S(D.attributes,"zoom",l.zoom),S(D.metadata,"devicePixelRatio",y),S(D.metadata,"connectionEffectiveType",T),S(D.metadata,"navigatorUserAgent",navigator.userAgent),S(D.metadata,"screenWidth",window.screen.width),S(D.metadata,"screenHeight",window.screen.height),S(D.metadata,"windowWidth",window.innerWidth),S(D.metadata,"windowHeight",window.innerHeight),S(D.metadata,"mapWidth",l.width/y),S(D.metadata,"mapHeight",l.height/y),S(D.metadata,"webglRenderer",l.renderer),S(D.metadata,"webglVendor",l.vendor),S(D.metadata,"sdkVersion",E),S(D.metadata,"sdkIdentifier","mapbox-gl-js"),D}(n);for(let l of a.metadata);for(let l of a.counters);for(let l of a.attributes);this.postEvent(e,a,()=>{},t)}},a1=Yh.postPerformanceEvent.bind(Yh),Cl=new class extends su{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!O.API_URL||!O.SESSION_PATH)return;let l=uo(O.API_URL+O.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${a||O.ACCESS_TOKEN||""}`);let d={url:Sl(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,_){return ru(ni(f,{method:"GET"}),_)}(d,f=>{this.pendingRequest=null,n(f),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,O.SESSION_PATH&&O.API_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(xp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Xh=Cl.getSessionAPI.bind(Cl),lu=new Set;var Da={exports:{}},w_={exports:function(t,e){var n,a,l,d,f,_,y,b;for(a=t.length-(n=3&t.length),l=e,f=3432918353,_=461845907,b=0;b<a;)y=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,l=27492+(65535&(d=5*(65535&(l=(l^=y=(65535&(y=(y=(65535&y)*f+(((y>>>16)*f&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(b+2))<<16;case 2:y^=(255&t.charCodeAt(b+1))<<8;case 1:l^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(b)))*f+(((y>>>16)*f&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}},l1={exports:function(t,e){for(var n,a=t.length,l=e^a,d=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:l^=(255&t.charCodeAt(d+2))<<16;case 2:l^=(255&t.charCodeAt(d+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(d)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}},E_=w_.exports,wp=l1.exports;Da.exports=E_,Da.exports.murmur3=E_,Da.exports.murmur2=wp;var Ml=ct(Da.exports);function Ep(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Al(t,e,n){if(n&&n[t]){let a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class vi{constructor(e,n={}){ni(this,n),this.type=e}}class Kh extends vi{constructor(e,n={}){super("error",ni({error:e},n))}}class Sa{on(e,n){return this._listeners=this._listeners||{},Ep(e,n,this._listeners),this}off(e,n){return Al(e,n,this._listeners),Al(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ep(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new vi(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let _ of l)_.call(this,e);let d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let _ of d)Al(a,_,this._oneTimeListeners),_.call(this,e);let f=this._eventedParent;f&&(ni(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof Kh&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}r.F=void 0;var T_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Qh(t){return(t=Math.round(t))<0?0:t>255?255:t}function Tp(t){return Qh(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function cu(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function uu(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{r.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in T_)return T_[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),l=n.indexOf(")");if(a!==-1&&l+1===n.length){var d=n.substr(0,a),f=n.substr(a+1,l-(a+1)).split(","),_=1;switch(d){case"rgba":if(f.length!==4)return null;_=cu(f.pop());case"rgb":return f.length!==3?null:[Tp(f[0]),Tp(f[1]),Tp(f[2]),_];case"hsla":if(f.length!==4)return null;_=cu(f.pop());case"hsl":if(f.length!==3)return null;var y=(parseFloat(f[0])%360+360)%360/360,b=cu(f[1]),T=cu(f[2]),D=T<=.5?T*(b+1):T+b-T*b,S=2*T-D;return[Qh(255*uu(S,D,y+1/3)),Qh(255*uu(S,D,y)),Qh(255*uu(S,D,y-1/3)),_];default:return null}}return null}}catch{}class _n{constructor(e,n,a,l=1){this.r=e,this.g=n,this.b=a,this.a=l}static parse(e){if(!e)return;if(e instanceof _n)return e;if(typeof e!="string")return;let n=r.F(e);return n?new _n(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,l]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${l})`}toRenderColor(e){let{r:n,g:a,b:l,a:d}=this;return new c1(e,n,a,l,d)}}class c1{constructor(e,n,a,l,d){if(e){let f=e.image.height,_=f*f;n=d===0?0:n/d*(f-1),a=d===0?0:a/d*(f-1),l=d===0?0:l/d*(f-1);let y=Math.floor(n),b=Math.floor(a),T=Math.floor(l),D=Math.ceil(n),S=Math.ceil(a),P=Math.ceil(l),R=n-y,k=a-b,N=l-T,V=e.image.data,Y=4*(y+b*_+T*f),X=4*(y+b*_+P*f),K=4*(y+S*_+T*f),ae=4*(y+S*_+P*f),oe=4*(D+b*_+T*f),fe=4*(D+b*_+P*f),me=4*(D+S*_+T*f),xe=4*(D+S*_+P*f);if(Y<0||xe>=V.length)throw new Error("out of range");this.r=wt(wt(wt(V[Y],V[X],N),wt(V[K],V[ae],N),k),wt(wt(V[oe],V[fe],N),wt(V[me],V[xe],N),k),R)/255*d,this.g=wt(wt(wt(V[Y+1],V[X+1],N),wt(V[K+1],V[ae+1],N),k),wt(wt(V[oe+1],V[fe+1],N),wt(V[me+1],V[xe+1],N),k),R)/255*d,this.b=wt(wt(wt(V[Y+2],V[X+2],N),wt(V[K+2],V[ae+2],N),k),wt(wt(V[oe+2],V[fe+2],N),wt(V[me+2],V[xe+2],N),k),R)/255*d,this.a=d}else this.r=n,this.g=a,this.b=l,this.a=d}toArray(){let{r:e,g:n,b:a,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*n/l,255*a/l,l]}toArray01(){let{r:e,g:n,b:a,a:l}=this;return l===0?[0,0,0,0]:[e/l,n/l,a/l,l]}toArray01Scaled(e){let{r:n,g:a,b:l,a:d}=this;return d===0?[0,0,0]:[n/d*e,a/d*e,l/d*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:l}=this;return[e,n,a,l]}toArray01Linear(){let{r:e,g:n,b:a,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(n/l,2.2),Math.pow(a/l,2.2),l]}}function wt(t,e,n){return t*(1-n)+e*n}function I_(t,e,n){return t.map((a,l)=>wt(a,e[l],n))}_n.black=new _n(0,0,0,1),_n.white=new _n(1,1,1,1),_n.transparent=new _n(0,0,0,0),_n.red=new _n(1,0,0,1),_n.blue=new _n(0,0,1,1);var Jh=Object.freeze({__proto__:null,array:I_,color:function(t,e,n){return new _n(wt(t.r,e.r,n),wt(t.g,e.g,n),wt(t.b,e.b,n),wt(t.a,e.a,n))},number:wt});function Ip(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}class Lo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Dp{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,l]of n)this.bindings[a]=l}concat(e){return new Dp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Pl={kind:"null"},lt={kind:"number"},yn={kind:"string"},vn={kind:"boolean"},xi={kind:"color"},Rl={kind:"object"},fn={kind:"value"},ho={kind:"collator"},Ol={kind:"formatted"},ko={kind:"resolvedImage"};function Ai(t,e){return{kind:"array",itemType:t,N:e}}function vr(t){if(t.kind==="array"){let e=vr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let u1=[Pl,lt,yn,vn,xi,Ol,Rl,Ai(fn),ko];function hu(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!hu(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of u1)if(!hu(n,e))return null}}return`Expected ${vr(t)} but found ${vr(e)} instead.`}function Sp(t,e){return e.some(n=>n.kind===t.kind)}function Ll(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class du{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ca{constructor(e,n,a,l,d){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=l,this.textColor=d}}class ri{constructor(e){this.sections=e}static fromString(e){return new ri([new Ca(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof ri?e:ri.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class bi{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new bi({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function D_(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wi(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof _n||t instanceof du||t instanceof ri||t instanceof bi)return!0;if(Array.isArray(t)){for(let e of t)if(!wi(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!wi(t[e]))return!1;return!0}return!1}function Sr(t){if(t===null)return Pl;if(typeof t=="string")return yn;if(typeof t=="boolean")return vn;if(typeof t=="number")return lt;if(t instanceof _n)return xi;if(t instanceof du)return ho;if(t instanceof ri)return Ol;if(t instanceof bi)return ko;if(Array.isArray(t)){let e=t.length,n;for(let a of t){let l=Sr(a);if(n){if(n===l)continue;n=fn;break}n=l}return Ai(n||fn,e)}return Rl}function Ki(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof _n||t instanceof ri||t instanceof bi?t.toString():JSON.stringify(t)}class Jo{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wi(e[1]))return n.error("invalid value");let a=e[1],l=Sr(a),d=n.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new Jo(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _n?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ri?this.value.serialize():this.value}}class Or{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Cp={string:yn,number:lt,boolean:vn,object:Rl};class fo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,l=1,d=e[0];if(d==="array"){let _,y;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in Cp)||b==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=Cp[b],l++}else _=fn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],l++}a=Ai(_,y)}else a=Cp[d];let f=[];for(;l<e.length;l++){let _=n.parse(e[l],l,fn);if(!_)return null;f.push(_)}return new fo(a,f)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!hu(this.type,Sr(a)))return a;if(n===this.args.length-1)throw new Or(`Expected value to be of type ${vr(this.type)}, but found ${vr(Sr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let l=e.N;(typeof l=="number"||this.args.length>1)&&n.push(l)}}return n.concat(this.args.map(a=>a.serialize()))}}class fu{constructor(e){this.type=Ol,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let l=[],d=!1;for(let f=1;f<=e.length-1;++f){let _=e[f];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let y=null;if(_["font-scale"]&&(y=n.parse(_["font-scale"],1,lt),!y))return null;let b=null;if(_["text-font"]&&(b=n.parse(_["text-font"],1,Ai(yn)),!b))return null;let T=null;if(_["text-color"]&&(T=n.parse(_["text-color"],1,xi),!T))return null;let D=l[l.length-1];D.scale=y,D.font=b,D.textColor=T}else{let y=n.parse(e[f],1,fn);if(!y)return null;let b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:y,scale:null,font:null,textColor:null})}}return new fu(l)}evaluate(e){return new ri(this.sections.map(n=>{let a=n.content.evaluate(e);return Sr(a)===ko?new Ca("",a,null,null,null):new Ca(Ki(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class pu{constructor(e,n){this.type=ko,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=n.parse(e[1],1,yn);if(!a)return n.error("No image name provided.");if(e.length===2)return new pu(a);let l=n.parse(e[2],1,yn);return l?new pu(a,l):n.error("Secondary image variant is not a string.")}evaluate(e){let n=bi.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ma(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let h1={"to-boolean":vn,"to-color":xi,"to-number":lt,"to-string":yn};class po{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0],l=[],d=Pl;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let f=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);d=Ai(n.expectedType.itemType,f)}else{if(!(f>0&&wi(e[1][0])))return null;d=Ai(Sr(e[1][0]),f)}for(let _=0;_<f;_++){let y=e[1][_],b;if(Ma(y)==="array")b=n.parse(y,void 0,d.itemType);else{let T=Ma(y);if(T!==d.itemType.kind)return n.error(`Expected ${d.itemType.kind} but found ${T}.`);b=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!b)return null;l.push(b)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");d=h1[a];for(let f=1;f<e.length;f++){let _=n.parse(e[f],f,fn);if(!_)return null;l.push(_)}}return new po(d,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let l of this.args){if(n=l.evaluate(e),a=null,n instanceof _n)return n;if(typeof n=="string"){let d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:D_(n[0],n[1],n[2],n[3]),!a))return new _n(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Or(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let l=Number(n);if(!isNaN(l))return l}throw new Or(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?ri.fromString(Ki(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?bi.fromString(Ki(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Ki(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new fu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new pu(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let S_=["Unknown","Point","LineString","Polygon"];class C_{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?S_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(l*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=_n.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class pi{constructor(e,n,a,l,d){this.name=e,this.type=n,this._evaluate=a,this.args=l,this._overloadIndex=d}evaluate(e){if(!this._evaluate){let n=pi.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],l=pi.definitions[a];if(!l)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,_=[],y=null,b=-1;for(let[T,D]of f){if(Array.isArray(T)&&T.length!==e.length-1)continue;_.push(T),b++,y=new B_(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let S=[],P=!1;for(let R=1;R<e.length;R++){let k=e[R],N=Array.isArray(T)?T[R-1]:T.type,V=y.parse(k,1+S.length,N);if(!V){P=!0;break}S.push(V)}if(!P)if(Array.isArray(T)&&T.length!==S.length)y.error(`Expected ${T.length} arguments, but found ${S.length} instead.`);else{for(let R=0;R<S.length;R++){let k=Array.isArray(T)?T[R]:T.type,N=S[R];y.concat(R+1).checkSubtype(k,N.type)}if(y.errors.length===0)return new pi(a,d,D,S,b)}}if(_.length===1)n.errors.push(...y.errors);else{let T=(_.length?_:f.map(([S])=>S)).map(Mp).join(" | "),D=[];for(let S=1;S<e.length;S++){let P=n.parse(e[S],1+D.length);if(!P)return null;D.push(vr(P.type))}n.error(`Expected arguments of type ${T}, but found (${D.join(", ")}) instead.`)}return null}static register(e,n){pi.definitions=n;for(let a in n)e[a]=pi}}function Mp(t){return Array.isArray(t)?`(${t.map(vr).join(", ")})`:`(${vr(t.type)}...)`}class Ls{constructor(e,n,a){this.type=ho,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let l=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,vn);if(!l)return null;let d=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,vn);if(!d)return null;let f=null;return a.locale&&(f=n.parse(a.locale,1,yn),!f)?null:new Ls(l,d,f)}evaluate(e){return new du(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Ap={exports:{}};Ap.exports=function(){function t(a,l,d,f,_){for(;f>d;){if(f-d>600){var y=f-d+1,b=l-d+1,T=Math.log(y),D=.5*Math.exp(2*T/3),S=.5*Math.sqrt(T*D*(y-D)/y)*(b-y/2<0?-1:1);t(a,l,Math.max(d,Math.floor(l-b*D/y+S)),Math.min(f,Math.floor(l+(y-b)*D/y+S)),_)}var P=a[l],R=d,k=f;for(e(a,d,l),_(a[f],P)>0&&e(a,d,f);R<k;){for(e(a,R,k),R++,k--;_(a[R],P)<0;)R++;for(;_(a[k],P)>0;)k--}_(a[d],P)===0?e(a,d,k):e(a,++k,f),k<=l&&(d=k+1),l<=k&&(f=k-1)}}function e(a,l,d){var f=a[l];a[l]=a[d],a[d]=f}function n(a,l){return a<l?-1:a>l?1:0}return function(a,l,d,f,_){t(a,l,d||0,f||a.length-1,_||n)}}();var d1=ct(Ap.exports);function f1(t){let e=0;for(let n,a,l=0,d=t.length,f=d-1;l<d;f=l++)n=t[l],a=t[f],e+=(a.x-n.x)*(n.y+a.y);return e}function mu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function kl(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function p1(t,e,n){let a=t[0]-e[0],l=t[1]-e[1],d=t[0]-n[0],f=t[1]-n[1];return a*f-d*l==0&&a*d<=0&&l*f<=0}function Fl(t,e,n=!1){let a=!1;for(let _=0,y=e.length;_<y;_++){let b=e[_];for(let T=0,D=b.length,S=D-1;T<D;S=T++){let P=b[S],R=b[T];if(p1(t,P,R))return n;(d=P)[1]>(l=t)[1]!=(f=R)[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(a=!a)}}var l,d,f;return a}function Pp(t,e,n,a){let l=a[0]-n[0],d=a[1]-n[1],f=(t[0]-n[0])*d-l*(t[1]-n[1]),_=(e[0]-n[0])*d-l*(e[1]-n[1]);return f>0&&_<0||f<0&&_>0}function hn(t,e,n,a){return(l=[a[0]-n[0],a[1]-n[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-l[1]*d[0]!=0&&!(!Pp(t,e,n,a)||!Pp(n,a,t,e));var l,d}let es=8192;function M_(t,e){let n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(n*l*es),Math.round(a*l*es)]}function m1(t,e){for(let n=0;n<e.length;n++)if(Fl(t,e[n]))return!0;return!1}function g1(t,e,n){for(let a of n)for(let l=0,d=a.length,f=d-1;l<d;f=l++)if(hn(t,e,a[f],a[l]))return!0;return!1}function gu(t,e){for(let n=0;n<t.length;++n)if(!Fl(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(g1(t[n],t[n+1],e))return!1;return!0}function ed(t,e){for(let n=0;n<e.length;n++)if(gu(t,e[n]))return!0;return!1}function Nl(t,e,n){let a=[];for(let l=0;l<t.length;l++){let d=[];for(let f=0;f<t[l].length;f++){let _=M_(t[l][f],n);mu(e,_),d.push(_)}a.push(d)}return a}function A_(t,e,n){let a=[];for(let l=0;l<t.length;l++){let d=Nl(t[l],e,n);a.push(d)}return a}function Rp(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){let l=.5*a,d=t[0]-n[0]>l?-a:n[0]-t[0]>l?a:0;d===0&&(d=t[0]-n[2]>l?-a:n[2]-t[0]>l?a:0),t[0]+=d}mu(e,t)}function mo(t,e,n,a){let l=Math.pow(2,a.z)*es,d=[a.x*es,a.y*es],f=[];if(!t)return f;for(let _ of t)for(let y of _){let b=[y.x+d[0],y.y+d[1]];Rp(b,e,n,l),f.push(b)}return f}function P_(t,e,n,a){let l=Math.pow(2,a.z)*es,d=[a.x*es,a.y*es],f=[];if(!t)return f;for(let y of t){let b=[];for(let T of y){let D=[T.x+d[0],T.y+d[1]];mu(e,D),b.push(D)}f.push(b)}if(e[2]-e[0]<=l/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let y of f)for(let b of y)Rp(b,e,n,l)}var _;return f}class ks{constructor(e,n){this.type=vn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wi(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let l=0;l<a.features.length;++l){let d=a.features[l].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ks(a,a.features[l].geometry)}else if(a.type==="Feature"){let l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new ks(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ks(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(a.type==="Polygon"){let _=Nl(a.coordinates,d,f),y=mo(n.geometry(),l,d,f);if(!kl(l,d))return!1;for(let b of y)if(!Fl(b,_))return!1}if(a.type==="MultiPolygon"){let _=A_(a.coordinates,d,f),y=mo(n.geometry(),l,d,f);if(!kl(l,d))return!1;for(let b of y)if(!m1(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(a.type==="Polygon"){let _=Nl(a.coordinates,d,f),y=P_(n.geometry(),l,d,f);if(!kl(l,d))return!1;for(let b of y)if(!gu(b,_))return!1}if(a.type==="MultiPolygon"){let _=A_(a.coordinates,d,f),y=P_(n.geometry(),l,d,f);if(!kl(l,d))return!1;for(let b of y)if(!ed(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Fs={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},td=1/298.257223563,R_=td*(2-td),_u=Math.PI/180;class yu{static fromTile(e,n,a){let l=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),d=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/_u;return new yu(d,a)}static get units(){return Fs}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Fs[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Fs).join(", ")}`);let a=6378.137*_u*(n?Fs[n]:1),l=Math.cos(e*_u),d=1/(1-R_*(1-l*l)),f=Math.sqrt(d);this.kx=a*f*l,this.ky=a*f*d*(1-R_)}distance(e,n){let a=Qi(e[0]-n[0])*this.kx,l=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+l*l)}bearing(e,n){let a=Qi(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/_u}destination(e,n,a){let l=a*_u;return this.offset(e,Math.sin(l)*n,Math.cos(l)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){let l=e[a];for(let d=0,f=l.length,_=f-1;d<f;_=d++)n+=Qi(l[d][0]-l[_][0])*(l[d][1]+l[_][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let l=0;l<e.length-1;l++){let d=e[l],f=e[l+1],_=this.distance(d,f);if(a+=_,a>n)return vu(d,f,(n-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[l,d]=n,f=Qi(a[0]-l)*this.kx,_=(a[1]-d)*this.ky;if(f!==0||_!==0){let y=(Qi(e[0]-l)*this.kx*f+(e[1]-d)*this.ky*_)/(f*f+_*_);y>1?(l=a[0],d=a[1]):y>0&&(l+=f/this.kx*y,d+=_/this.ky*y)}return f=Qi(e[0]-l)*this.kx,_=(e[1]-d)*this.ky,Math.sqrt(f*f+_*_)}pointOnLine(e,n){let a=1/0,l=e[0][0],d=e[0][1],f=0,_=0;for(let y=0;y<e.length-1;y++){let b=e[y][0],T=e[y][1],D=Qi(e[y+1][0]-b)*this.kx,S=(e[y+1][1]-T)*this.ky,P=0;D===0&&S===0||(P=(Qi(n[0]-b)*this.kx*D+(n[1]-T)*this.ky*S)/(D*D+S*S),P>1?(b=e[y+1][0],T=e[y+1][1]):P>0&&(b+=D/this.kx*P,T+=S/this.ky*P)),D=Qi(n[0]-b)*this.kx,S=(n[1]-T)*this.ky;let R=D*D+S*S;R<a&&(a=R,l=b,d=T,f=y,_=P)}return{point:[l,d],index:f,t:Math.max(0,Math.min(1,_))}}lineSlice(e,n,a){let l=this.pointOnLine(a,e),d=this.pointOnLine(a,n);if(l.index>d.index||l.index===d.index&&l.t>d.t){let b=l;l=d,d=b}let f=[l.point],_=l.index+1,y=d.index;!Op(a[_],f[0])&&_<=y&&f.push(a[_]);for(let b=_+1;b<=y;b++)f.push(a[b]);return Op(a[y],d.point)||f.push(d.point),f}lineSliceAlong(e,n,a){let l=0,d=[];for(let f=0;f<a.length-1;f++){let _=a[f],y=a[f+1],b=this.distance(_,y);if(l+=b,l>e&&d.length===0&&d.push(vu(_,y,(e-(l-b))/b)),l>=n)return d.push(vu(_,y,(n-(l-b))/b)),d;l>e&&d.push(y)}return d}bufferPoint(e,n){let a=n/this.ky,l=n/this.kx;return[e[0]-l,e[1]-a,e[0]+l,e[1]+a]}bufferBBox(e,n){let a=n/this.ky,l=n/this.kx;return[e[0]-l,e[1]-a,e[2]+l,e[3]+a]}insideBBox(e,n){return Qi(e[0]-n[0])>=0&&Qi(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Op(t,e){return t[0]===e[0]&&t[1]===e[1]}function vu(t,e,n){let a=Qi(e[0]-t[0]);return[t[0]+a*n,t[1]+(e[1]-t[1])*n]}function Qi(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var xu={exports:{}};(function(t,e){t.exports=function(){var n=function(l,d){if(l===void 0&&(l=[]),d===void 0&&(d=a),this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function a(l,d){return l<d?-1:l>d?1:0}return n.prototype.push=function(l){this.data.push(l),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var l=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),l}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(l){for(var d=this.data,f=this.compare,_=d[l];l>0;){var y=l-1>>1,b=d[y];if(f(_,b)>=0)break;d[l]=b,l=y}d[l]=_},n.prototype._down=function(l){for(var d=this.data,f=this.compare,_=this.length>>1,y=d[l];l<_;){var b=1+(l<<1),T=d[b],D=b+1;if(D<this.length&&f(d[D],T)<0&&(b=D,T=d[D]),f(T,y)>=0)break;d[l]=T,l=b}d[l]=y},n}()})(xu);var Lp=ct(xu.exports),Je=8192;function O_(t,e){return e.dist-t.dist}let kp=100,Fp=50;function L_(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function nd(t){return t[1]-t[0]+1}function Fo(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Ns(t,e){if(t[0]>t[1])return[null,null];let n=nd(t);if(e){if(n===2)return[t,null];let a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];let a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function Aa(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Fo(e,t.length))return n;for(let a=e[0];a<=e[1];++a)mu(n,t[a]);return n}function rd(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)mu(e,t[n][a]);return e}function zs(t,e,n){if(L_(t)||L_(e))return NaN;let a=0,l=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(l=t[1]-e[3]),t[3]<e[1]&&(l=e[1]-t[3]),n.distance([0,0],[a,l])}function _1(t){return 360*t-180}function y1(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Np(t,e){let n=Math.pow(2,e.z),a=(t.y/Je+e.y)/n;return[_1((t.x/Je+e.x)/n),y1(a)]}function v1(t,e){let n=[];for(let a=0;a<t.length;++a)n.push(Np(t[a],e));return n}function k_(t,e,n){let a=n.pointOnLine(e,t).point;return n.distance(t,a)}function Bs(t,e,n,a,l){let d=n.slice(a[0],a[1]+1),f=1/0;for(let _=e[0];_<=e[1];++_)if((f=Math.min(f,k_(t[_],d,l)))===0)return 0;return f}function zp(t,e,n,a,l){let d=Math.min(l.pointToSegmentDistance(t,n,a),l.pointToSegmentDistance(e,n,a)),f=Math.min(l.pointToSegmentDistance(n,t,e),l.pointToSegmentDistance(a,t,e));return Math.min(d,f)}function x1(t,e,n,a,l){if(!Fo(e,t.length)||!Fo(a,n.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let _=a[0];_<a[1];++_){if(hn(t[f],t[f+1],n[_],n[_+1]))return 0;d=Math.min(d,zp(t[f],t[f+1],n[_],n[_+1],l))}return d}function F_(t,e,n,a,l){if(!Fo(e,t.length)||!Fo(a,n.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let _=a[0];_<=a[1];++_)if((d=Math.min(d,l.distance(t[f],n[_])))===0)return d;return d}function N_(t,e,n){if(Fl(t,e,!0))return 0;let a=1/0;for(let l of e){let d=l.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[d-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,l[d-1],l[0])))===0||(a=Math.min(a,k_(t,l,n)))===0)return a}return a}function go(t,e,n,a){if(!Fo(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Fl(t[d],n,!0))return 0;let l=1/0;for(let d=e[0];d<e[1];++d)for(let f of n)for(let _=0,y=f.length,b=y-1;_<y;b=_++){if(hn(t[d],t[d+1],f[b],f[_]))return 0;l=Math.min(l,zp(t[d],t[d+1],f[b],f[_],a))}return l}function Bp(t,e){for(let n of t)for(let a=0;a<=n.length-1;++a)if(Fl(n[a],e,!0))return!0;return!1}function b1(t,e,n,a=1/0){let l=rd(t),d=rd(e);if(a!==1/0&&zs(l,d,n)>=a)return a;if(kl(l,d)){if(Bp(t,e))return 0}else if(Bp(e,t))return 0;let f=a;for(let _ of t)for(let y=0,b=_.length,T=b-1;y<b;T=y++)for(let D of e)for(let S=0,P=D.length,R=P-1;S<P;R=S++){if(hn(_[T],_[y],D[R],D[S]))return 0;f=Math.min(f,zp(_[T],_[y],D[R],D[S],n))}return f}function bu(t,e,n,a,l,d,f){if(d===null||f===null)return;let _=zs(Aa(a,d),Aa(l,f),n);_<e&&t.push({dist:_,range1:d,range2:f})}function id(t,e,n,a,l=1/0){let d=Math.min(a.distance(t[0],n[0][0]),l);if(d===0)return d;let f=new Lp([{dist:0,range1:[0,t.length-1],range2:[0,0]}],O_),_=e?Fp:kp,y=rd(n);for(;f.length;){let b=f.pop();if(b.dist>=d)continue;let T=b.range1;if(nd(T)<=_){if(!Fo(T,t.length))return NaN;if(e){let D=go(t,T,n,a);if((d=Math.min(d,D))===0)return d}else for(let D=T[0];D<=T[1];++D){let S=N_(t[D],n,a);if((d=Math.min(d,S))===0)return d}}else{let D=Ns(T,e);if(D[0]!==null){let S=zs(Aa(t,D[0]),y,a);S<d&&f.push({dist:S,range1:D[0],range2:[0,0]})}if(D[1]!==null){let S=zs(Aa(t,D[1]),y,a);S<d&&f.push({dist:S,range1:D[1],range2:[0,0]})}}}return d}function z_(t,e,n,a,l,d=1/0){let f=Math.min(d,l.distance(t[0],n[0]));if(f===0)return f;let _=new Lp([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],O_),y=e?Fp:kp,b=a?Fp:kp;for(;_.length;){let T=_.pop();if(T.dist>=f)continue;let D=T.range1,S=T.range2;if(nd(D)<=y&&nd(S)<=b){if(!Fo(D,t.length)||!Fo(S,n.length))return NaN;if(e&&a?f=Math.min(f,x1(t,D,n,S,l)):e||a?e&&!a?f=Math.min(f,Bs(n,S,t,D,l)):!e&&a&&(f=Math.min(f,Bs(t,D,n,S,l))):f=Math.min(f,F_(t,D,n,S,l)),f===0)return f}else{let P=Ns(D,e),R=Ns(S,a);bu(_,f,l,t,n,P[0],R[0]),bu(_,f,l,t,n,P[0],R[1]),bu(_,f,l,t,n,P[1],R[0]),bu(_,f,l,t,n,P[1],R[1])}}return f}function Up(t,e,n,a,l=1/0){let d=l,f=Aa(t,[0,t.length-1]);for(let _ of n)if(!(d!==1/0&&zs(f,Aa(_,[0,_.length-1]),a)>=d)&&(d=Math.min(d,z_(t,e,_,!0,a,d)),d===0))return d;return d}function od(t,e,n,a,l=1/0){let d=l,f=Aa(t,[0,t.length-1]);for(let _ of n){if(d!==1/0&&zs(f,rd(_),a)>=d)continue;let y=id(t,e,_,a,d);if(isNaN(y))return y;if((d=Math.min(d,y))===0)return d}return d}function Vp(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Pa{constructor(e,n){this.type=lt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(wi(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let l=0;l<a.features.length;++l)if(Vp(a.features[l].geometry.type))return new Pa(a,a.features[l].geometry)}else if(a.type==="Feature"){if(Vp(a.geometry.type))return new Pa(a,a.geometry)}else if(Vp(a.type))return new Pa(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(l,d,f){let _=[];for(let b of l)for(let T of b)_.push(Np(T,d));let y=new yu(_[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?z_(_,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y):f.type==="MultiLineString"?Up(_,!1,f.coordinates,y):f.type==="Polygon"||f.type==="MultiPolygon"?od(_,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,y):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(l,d,f){let _=[];for(let b of l){let T=[];for(let D of b)T.push(Np(D,d));_.push(T)}let y=new yu(_[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Up(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,y);if(f.type==="MultiLineString"){let b=1/0;for(let T=0;T<f.coordinates.length;T++){let D=Up(f.coordinates[T],!0,_,y,b);if(isNaN(D))return D;if((b=Math.min(b,D))===0)return b}return b}if(f.type==="Polygon"||f.type==="MultiPolygon"){let b=1/0;for(let T=0;T<_.length;T++){let D=od(_[T],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,y,b);if(isNaN(D))return D;if((b=Math.min(b,D))===0)return b}return b}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(l,d,f){let _=[];for(let b of function(T,D){let S=T.length;if(S<=1)return[T];let P=[],R,k;for(let N=0;N<S;N++){let V=f1(T[N]);V!==0&&(T[N].area=Math.abs(V),k===void 0&&(k=V<0),k===V<0?(R&&P.push(R),R=[T[N]]):R.push(T[N]))}return R&&P.push(R),P}(l)){let T=[];for(let D=0;D<b.length;++D)T.push(v1(b[D],d));_.push(T)}let y=new yu(_[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return od(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,y);if(f.type==="MultiLineString"){let b=1/0;for(let T=0;T<f.coordinates.length;T++){let D=od(f.coordinates[T],!0,_,y,b);if(isNaN(D))return D;if((b=Math.min(b,D))===0)return b}return b}return f.type==="Polygon"||f.type==="MultiPolygon"?function(b,T,D){let S=1/0;for(let P of b)for(let R of T){let k=b1(P,R,D,S);if(isNaN(k))return k;if((S=Math.min(S,k))===0)return S}return S}(f.type==="Polygon"?[f.coordinates]:f.coordinates,_,y):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function zl(t,e){switch(t){case"string":return Ki(e);case"number":return+e;case"boolean":return!!e;case"color":return _n.parse(e);case"formatted":return ri.fromString(Ki(e));case"resolvedImage":return bi.fromString(Ki(e))}return e}function wu(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class qr{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=fn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let l=n.parse(e[1],1);if(!(l instanceof Jo))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let d=n.parse(e[2],2);return d instanceof Jo?new qr(a,Ki(l.value),Ki(d.value)):n.error("Scope of 'config' expression must be a string literal.")}return new qr(a,Ki(l.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;let{type:l,value:d,values:f,minValue:_,maxValue:y,stepValue:b}=a,T=a.default.evaluate(e),D=T;if(d){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),D=d.evaluate(e),e.scope=S}return l&&(D=zl(l,D)),D===void 0||_===void 0&&y===void 0&&b===void 0||(typeof D=="number"?D=wu(D,_,y,b):Array.isArray(D)&&(D=D.map(S=>typeof S=="number"?wu(S,_,y,b):S))),d!==void 0&&D!==void 0&&f&&!f.includes(D)&&(D=T,l&&(D=zl(l,D))),(l&&l!==this.type||D!==void 0&&Sr(D)!==this.type)&&(D=zl(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Us(t){if(t instanceof pi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ks||t instanceof Pa)return!1;let e=!0;return t.eachChild(n=>{e&&!Us(n)&&(e=!1)}),e}function sd(t){if(t instanceof pi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!sd(n)&&(e=!1)}),e}function jp(t){if(t instanceof qr)return!1;let e=!0;return t.eachChild(n=>{e&&!jp(n)&&(e=!1)}),e}function Eu(t,e){if(t instanceof pi&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!Eu(a,e)&&(n=!1)}),n}class ad{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new ad(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tu{constructor(e,n=[],a,l=new Dp,d=[],f,_){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=l,this.errors=d,this.expectedType=a,this._scope=f,this.options=_}parse(e,n,a,l,d={}){return n||a?this.concat(n,a,l)._parse(e,d):this._parse(e,d)}_parse(e,n){function a(l,d,f){return f==="assert"?new fo(d,[l]):f==="coerce"?new po(d,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let d=l.parse(e,this);if(!d)return null;if(this.expectedType){let f=this.expectedType,_=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||_.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(f,_))return null}else d=a(d,f,n.typeAnnotation||"coerce");else d=a(d,f,n.typeAnnotation||"assert")}if(!(d instanceof Jo)&&d.type.kind!=="resolvedImage"&&Iu(d)){let f=new C_(this._scope,this.options);try{d=new Jo(d.type,d.evaluate(f))}catch(_){return this.error(_.message),null}}return d}return po.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let l=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new Tu(this.registry,l,n||null,d,this.errors,this._scope,this.options)}error(e,...n){let a=`${this.key}${n.map(l=>`[${l}]`).join("")}`;this.errors.push(new Lo(a,e))}checkSubtype(e,n){let a=hu(e,n);return a&&this.error(a),a}}var B_=Tu;function Iu(t){if(t instanceof ad)return Iu(t.boundExpression);if(t instanceof pi&&t.name==="error"||t instanceof Ls||t instanceof ks||t instanceof Pa||t instanceof qr)return!1;let e=t instanceof po||t instanceof fo,n=!0;return t.eachChild(a=>{n=e?n&&Iu(a):n&&a instanceof Jo}),!!n&&Us(t)&&Eu(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ld(t,e){let n=t.length-1,a,l,d=0,f=n,_=0;for(;d<=f;)if(_=Math.floor((d+f)/2),a=t[_],l=t[_+1],a<=e){if(_===n||e<l)return _;d=_+1}else{if(!(a>e))throw new Or("Input is not a number.");f=_-1}return 0}class Du{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[l,d]of a)this.labels.push(l),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,lt);if(!a)return null;let l=[],d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let f=1;f<e.length;f+=2){let _=f===1?-1/0:e[f],y=e[f+1],b=f,T=f+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let D=n.parse(y,T,d);if(!D)return null;d=d||D.type,l.push([_,D])}return new Du(d,a,l)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let l=this.input.evaluate(e);if(l<=n[0])return a[0].evaluate(e);let d=n.length;return l>=n[d-1]?a[d-1].evaluate(e):a[ld(n,l)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let cd=.95047,U_=1.08883,$p=4/29,Ra=6/29,V_=3*Ra*Ra,Gp=Ra*Ra*Ra,ud=Math.PI/180,j_=180/Math.PI;function qp(t){return t>Gp?Math.pow(t,1/3):t/V_+$p}function hd(t){return t>Ra?t*t*t:V_*(t-$p)}function Hp(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Su(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $_(t){let e=Su(t.r),n=Su(t.g),a=Su(t.b),l=qp((.4124564*e+.3575761*n+.1804375*a)/cd),d=qp((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*d-16,a:500*(l-d),b:200*(d-qp((.0193339*e+.119192*n+.9503041*a)/U_)),alpha:t.a}}function G_(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*hd(e),n=cd*hd(n),a=U_*hd(a),new _n(Hp(3.2404542*n-1.5371385*e-.4985314*a),Hp(-.969266*n+1.8760108*e+.041556*a),Hp(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function w1(t,e,n){let a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let Cu={forward:$_,reverse:G_,interpolate:function(t,e,n){return{l:wt(t.l,e.l,n),a:wt(t.a,e.a,n),b:wt(t.b,e.b,n),alpha:wt(t.alpha,e.alpha,n)}}},Bl={forward:function(t){let{l:e,a:n,b:a}=$_(t),l=Math.atan2(a,n)*j_;return{h:l<0?l+360:l,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*ud,n=t.c;return G_({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:w1(t.h,e.h,n),c:wt(t.c,e.c,n),l:wt(t.l,e.l,n),alpha:wt(t.alpha,e.alpha,n)}}};var q_=Object.freeze({__proto__:null,hcl:Bl,lab:Cu});class Bi{constructor(e,n,a,l,d){this.type=e,this.operator=n,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(let[f,_]of d)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,n,a,l){let d=0;if(e.name==="exponential")d=Wp(n,e.base,a,l);else if(e.name==="linear")d=Wp(n,1,a,l);else if(e.name==="cubic-bezier"){let f=e.controlPoints;d=new Yc(f[0],f[1],f[2],f[3]).solve(Wp(n,1,a,l))}return d}static parse(e,n){let[a,l,d,...f]=e;if(!Array.isArray(l)||l.length===0)return n.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let b=l[1];if(typeof b!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let b=l.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,lt),!d)return null;let _=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=xi:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let b=0;b<f.length;b+=2){let T=f[b],D=f[b+1],S=b+3,P=b+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(_.length&&_[_.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let R=n.parse(D,P,y);if(!R)return null;y=y||R.type,_.push([T,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Bi(y,a,l,d,_):n.error(`Type ${vr(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let l=this.input.evaluate(e);if(l<=n[0])return a[0].evaluate(e);let d=n.length;if(l>=n[d-1])return a[d-1].evaluate(e);let f=ld(n,l),_=Bi.interpolationFactor(this.interpolation,l,n[f],n[f+1]),y=a[f].evaluate(e),b=a[f+1].evaluate(e);return this.operator==="interpolate"?Jh[this.type.kind.toLowerCase()](y,b,_):this.operator==="interpolate-hcl"?Bl.reverse(Bl.interpolate(Bl.forward(y),Bl.forward(b),_)):Cu.reverse(Cu.interpolate(Cu.forward(y),Cu.forward(b),_))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function Wp(t,e,n,a){let l=a-n,d=t-n;return l===0?0:e===1?d/l:(Math.pow(e,d)-1)/(Math.pow(e,l)-1)}class dd{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,l=n.expectedType;l&&l.kind!=="value"&&(a=l);let d=[];for(let _ of e.slice(1)){let y=n.parse(_,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,d.push(y)}let f=l&&d.some(_=>hu(l,_.type));return new dd(f?fn:a,d)}evaluate(e){let n,a=null,l=0;for(let d of this.args){if(l++,a=d.evaluate(e),a&&a instanceof bi&&!a.available&&(n||(n=a),a=null,l===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class fd{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let d=1;d<e.length-1;d+=2){let f=e[d];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);let _=n.parse(e[d+1],d+1);if(!_)return null;a.push([f,_])}let l=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return l?new fd(a,l):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class Zp{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,lt),l=n.parse(e[2],2,Ai(n.expectedType||fn));return a&&l?new Zp(l.type.itemType,a,l):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new Or(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Or(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Or(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Yp{constructor(e,n){this.type=vn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,fn),l=n.parse(e[2],2,fn);return a&&l?Sp(a.type,[vn,yn,lt,Pl,fn])?new Yp(a,l):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${vr(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Ll(n,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${vr(Sr(n))} instead.`);if(!Ll(a,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${vr(Sr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pd{constructor(e,n,a){this.type=lt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,fn),l=n.parse(e[2],2,fn);if(!a||!l)return null;if(!Sp(a.type,[vn,yn,lt,Pl,fn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${vr(a.type)} instead`);if(e.length===4){let d=n.parse(e[3],3,lt);return d?new pd(a,l,d):null}return new pd(a,l)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Ll(n,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${vr(Sr(n))} instead.`);if(!Ll(a,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${vr(Sr(a))} instead.`);if(this.fromIndex){let l=this.fromIndex.evaluate(e);return a.indexOf(n,l)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ul{constructor(e,n,a,l,d,f){this.inputType=e,this.type=n,this.input=a,this.cases=l,this.outputs=d,this.otherwise=f}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);let d={},f=[];for(let b=2;b<e.length-1;b+=2){let T=e[b],D=e[b+1];Array.isArray(T)||(T=[T]);let S=n.concat(b);if(T.length===0)return S.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return S.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return S.error("Numeric branch labels must be integer values.");if(a){if(S.checkSubtype(a,Sr(R)))return null}else a=Sr(R);if(d[String(R)]!==void 0)return S.error("Branch labels must be unique.");d[String(R)]=f.length}let P=n.parse(D,b,l);if(!P)return null;l=l||P.type,f.push(P)}let _=n.parse(e[1],1,fn);if(!_)return null;let y=n.parse(e[e.length-1],e.length-1,l);return y?_.type.kind!=="value"&&n.concat(1).checkSubtype(a,_.type)?null:new Ul(a,l,_,d,f,y):null}evaluate(e){let n=this.input.evaluate(e);return(Sr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],l={};for(let f of n){let _=l[this.cases[f]];_===void 0?(l[this.cases[f]]=a.length,a.push([this.cases[f],[f]])):a[_][1].push(f)}let d=f=>this.inputType.kind==="number"?Number(f):f;for(let[f,_]of a)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Xp{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let l=[];for(let f=1;f<e.length-1;f+=2){let _=n.parse(e[f],f,vn);if(!_)return null;let y=n.parse(e[f+1],f+1,a);if(!y)return null;l.push([_,y]),a=a||y.type}let d=n.parse(e[e.length-1],e.length-1,a);return d?new Xp(a,l,d):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class md{constructor(e,n,a,l){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,fn),l=n.parse(e[2],2,lt);if(!a||!l)return null;if(!Sp(a.type,[Ai(fn),yn,fn]))return n.error(`Expected first argument to be of type array or string, but found ${vr(a.type)} instead`);if(e.length===4){let d=n.parse(e[3],3,lt);return d?new md(a.type,a,l,d):null}return new md(a.type,a,l)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Ll(n,["string","array"]))throw new Or(`Expected first argument to be of type array or string, but found ${vr(Sr(n))} instead.`);if(this.endIndex){let l=this.endIndex.evaluate(e);return n.slice(a,l)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Mu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function H_(t,e,n,a){return a.compare(e,n)===0}function Oa(t,e,n){let a=t!=="=="&&t!=="!=";return class gF{constructor(d,f,_){this.type=vn,this.lhs=d,this.rhs=f,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");let _=d[0],y=f.parse(d[1],1,fn);if(!y)return null;if(!Mu(_,y.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${vr(y.type)}'.`);let b=f.parse(d[2],2,fn);if(!b)return null;if(!Mu(_,b.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${vr(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${vr(y.type)}' and '${vr(b.type)}'.`);a&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new fo(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new fo(y.type,[b])));let T=null;if(d.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(T=f.parse(d[3],3,ho),!T)return null}return new gF(y,b,T)}evaluate(d){let f=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){let y=Sr(f),b=Sr(_);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new Or(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=Sr(f),b=Sr(_);if(y.kind!=="string"||b.kind!=="string")return e(d,f,_)}return this.collator?n(d,f,_,this.collator.evaluate(d)):e(d,f,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[t];return this.eachChild(f=>{d.push(f.serialize())}),d}}}let E1=Oa("==",function(t,e,n){return e===n},H_),W_=Oa("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!H_(0,e,n,a)}),Z_=Oa("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),Y_=Oa(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),X_=Oa("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),Kp=Oa(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class Au{constructor(e,n,a,l,d,f){this.type=yn,this.number=e,this.locale=n,this.currency=a,this.unit=l,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,lt);if(!a)return null;let l=e[2];if(typeof l!="object"||Array.isArray(l))return n.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=n.parse(l.locale,1,yn),!d))return null;let f=null;if(l.currency&&(f=n.parse(l.currency,1,yn),!f))return null;let _=null;if(l.unit&&(_=n.parse(l.unit,1,yn),!_))return null;let y=null;if(l["min-fraction-digits"]&&(y=n.parse(l["min-fraction-digits"],1,lt),!y))return null;let b=null;return l["max-fraction-digits"]&&(b=n.parse(l["max-fraction-digits"],1,lt),!b)?null:new Au(a,d,f,_,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Qp{constructor(e){this.type=lt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${vr(a.type)} instead.`):new Qp(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Or(`Expected value to be of type string or array, but found ${vr(Sr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function K_(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let La={"==":E1,"!=":W_,">":Y_,"<":Z_,">=":Kp,"<=":X_,array:fo,at:Zp,boolean:fo,case:Xp,coalesce:dd,collator:Ls,format:fu,image:pu,in:Yp,"index-of":pd,interpolate:Bi,"interpolate-hcl":Bi,"interpolate-lab":Bi,length:Qp,let:fd,literal:Jo,match:Ul,number:fo,"number-format":Au,object:fo,slice:md,step:Du,string:fo,"to-boolean":po,"to-color":po,"to-number":po,"to-string":po,var:ad,within:ks,distance:Pa,config:qr};function Q_(t,[e,n,a,l]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let d=l?l.evaluate(t):1,f=D_(e,n,a,d);if(f)throw new Or(f);return new _n(e/255*d,n/255*d,a/255*d,d)}function J_(t,[e,n,a,l]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let d=l?l.evaluate(t):1,f=function(b,T,D,S){return typeof b=="number"&&b>=0&&b<=360?typeof T=="number"&&T>=0&&T<=100&&typeof D=="number"&&D>=0&&D<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[b,T,D,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[b,T,D,S]:[b,T,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[b,T,D,S]:[b,T,D]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,d);if(f)throw new Or(f);let _=`hsla(${e}, ${n}%, ${a}%, ${d})`,y=_n.parse(_);if(!y)throw new Or(`Failed to parse HSLA color: ${_}`);return y}function ey(t,e){return t in e}function Jp(t,e){let n=e[t];return n===void 0?null:n}function ka(t){return{type:t}}function ty(t){return{result:"success",value:t}}function Fa(t){return{result:"error",value:t}}function ny(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function gd(t){return t["property-type"]==="data-driven"}function T1(t){return ny(t.expression,"measure-light")}function p(t){return ny(t.expression,"zoom")}function s(t){return!!t.expression&&t.expression.interpolated}function u(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function v(t,e){let n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",l=a||!(a||t.property!==void 0),d=t.type||(s(e)?"exponential":"interval");if(n&&((t=Ip({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],_n.parse(b[1])])),t.default=_n.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!q_[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,_,y;if(d==="exponential")f=M;else if(d==="interval")f=I;else if(d==="categorical"){f=w,_=Object.create(null);for(let b of t.stops)_[b[0]]=b[1];y=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=A}if(a){let b={},T=[];for(let P=0;P<t.stops.length;P++){let R=t.stops[P],k=R[0].zoom;b[k]===void 0&&(b[k]={zoom:k,type:t.type,property:t.property,default:t.default,stops:[]},T.push(k)),b[k].stops.push([R[0].value,R[1]])}let D=[];for(let P of T)D.push([b[P].zoom,v(b[P],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:Bi.interpolationFactor.bind(void 0,S),zoomStops:D.map(P=>P[0]),evaluate:({zoom:P},R)=>M({stops:D,base:t.base},e,P).evaluate(P,R)}}if(l){let b=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Bi.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>f(t,e,T,_,y)}}return{kind:"source",evaluate(b,T){let D=T&&T.properties?T.properties[t.property]:void 0;return D===void 0?x(t.default,e.default):f(t,e,D,_,y)}}}function x(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function w(t,e,n,a,l){return x(typeof n===l?a[n]:void 0,t.default,e.default)}function I(t,e,n){if(Ma(n)!=="number")return x(t.default,e.default);let a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];let l=ld(t.stops.map(d=>d[0]),n);return t.stops[l][1]}function M(t,e,n){let a=t.base!==void 0?t.base:1;if(Ma(n)!=="number")return x(t.default,e.default);let l=t.stops.length;if(l===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[l-1][0])return t.stops[l-1][1];let d=ld(t.stops.map(T=>T[0]),n),f=function(T,D,S,P){let R=P-S,k=T-S;return R===0?0:D===1?k/R:(Math.pow(D,k)-1)/(Math.pow(D,R)-1)}(n,a,t.stops[d][0],t.stops[d+1][0]),_=t.stops[d][1],y=t.stops[d+1][1],b=Jh[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=q_[t.colorSpace];b=(D,S)=>T.reverse(T.interpolate(T.forward(D),T.forward(S),f))}return typeof _.evaluate=="function"?{evaluate(...T){let D=_.evaluate.apply(void 0,T),S=y.evaluate.apply(void 0,T);if(D!==void 0&&S!==void 0)return b(D,S,f)}}:b(_,y,f)}function A(t,e,n){return e.type==="color"?n=_n.parse(n):e.type==="formatted"?n=ri.fromString(n.toString()):e.type==="resolvedImage"?n=bi.fromString(n.toString()):Ma(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,t.default,e.default)}pi.register(La,{error:[{kind:"error"},[yn],(t,[e])=>{throw new Or(e.evaluate(t))}],typeof:[yn,[fn],(t,[e])=>vr(Sr(e.evaluate(t)))],"to-rgba":[Ai(lt,4),[xi],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[xi,[lt,lt,lt],Q_],rgba:[xi,[lt,lt,lt,lt],Q_],hsl:[xi,[lt,lt,lt],J_],hsla:[xi,[lt,lt,lt,lt],J_],has:{type:vn,overloads:[[[yn],(t,[e])=>ey(e.evaluate(t),t.properties())],[[yn,Rl],(t,[e,n])=>ey(e.evaluate(t),n.evaluate(t))]]},get:{type:fn,overloads:[[[yn],(t,[e])=>Jp(e.evaluate(t),t.properties())],[[yn,Rl],(t,[e,n])=>Jp(e.evaluate(t),n.evaluate(t))]]},"feature-state":[fn,[yn],(t,[e])=>Jp(e.evaluate(t),t.featureState||{})],properties:[Rl,[],t=>t.properties()],"geometry-type":[yn,[],t=>t.geometryType()],id:[fn,[],t=>t.id()],zoom:[lt,[],t=>t.globals.zoom],pitch:[lt,[],t=>t.globals.pitch||0],"distance-from-center":[lt,[],t=>t.distanceFromCenter()],"measure-light":[lt,[yn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[lt,[],t=>t.globals.heatmapDensity||0],"line-progress":[lt,[],t=>t.globals.lineProgress||0],"raster-value":[lt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[lt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[lt,[],t=>t.globals.skyRadialProgress||0],accumulated:[fn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[lt,ka(lt),(t,e)=>{let n=0;for(let a of e)n+=a.evaluate(t);return n}],"*":[lt,ka(lt),(t,e)=>{let n=1;for(let a of e)n*=a.evaluate(t);return n}],"-":{type:lt,overloads:[[[lt,lt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[lt],(t,[e])=>-e.evaluate(t)]]},"/":[lt,[lt,lt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[lt,[lt,lt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[lt,[lt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))],log2:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[lt,[lt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[lt,[lt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[lt,[lt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[lt,[lt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[lt,[lt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[lt,[lt],(t,[e])=>Math.atan(e.evaluate(t))],min:[lt,ka(lt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[lt,ka(lt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[lt,[lt],(t,[e])=>Math.abs(e.evaluate(t))],round:[lt,[lt],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[lt,[lt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[lt,[lt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[vn,[yn,fn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[vn,[fn],(t,[e])=>t.id()===e.value],"filter-type-==":[vn,[yn],(t,[e])=>t.geometryType()===e.value],"filter-<":[vn,[yn,fn],(t,[e,n])=>{let a=t.properties()[e.value],l=n.value;return typeof a==typeof l&&a<l}],"filter-id-<":[vn,[fn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[vn,[yn,fn],(t,[e,n])=>{let a=t.properties()[e.value],l=n.value;return typeof a==typeof l&&a>l}],"filter-id->":[vn,[fn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[vn,[yn,fn],(t,[e,n])=>{let a=t.properties()[e.value],l=n.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[vn,[fn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[vn,[yn,fn],(t,[e,n])=>{let a=t.properties()[e.value],l=n.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[vn,[fn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[vn,[fn],(t,[e])=>e.value in t.properties()],"filter-has-id":[vn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[vn,[Ai(yn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[vn,[Ai(fn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[vn,[yn,Ai(fn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[vn,[yn,Ai(fn)],(t,[e,n])=>function(a,l,d,f){for(;d<=f;){let _=d+f>>1;if(l[_]===a)return!0;l[_]>a?f=_-1:d=_+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:vn,overloads:[[[vn,vn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[ka(vn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:vn,overloads:[[[vn,vn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[ka(vn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[vn,[vn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[vn,[yn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[yn,[yn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[yn,[yn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[yn,ka(fn),(t,e)=>e.map(n=>Ki(n.evaluate(t))).join("")],"resolved-locale":[yn,[ho],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[lt,[lt,lt,fn],(t,e)=>{let[n,a,l]=e.map(f=>f.evaluate(t));if(n>a||n===a)return n;let d;if(typeof l=="string")d=function(f){let _=0;if(f.length===0)return _;for(let y=0;y<f.length;y++)_=(_<<5)-_+f.charCodeAt(y),_|=0;return _}(l);else{if(typeof l!="number")throw new Or(`Invalid seed input: ${l}`);d=l}return n+K_(d)()*(a-n)}]});class L{constructor(e,n,a,l){this.expression=e,this._warningHistory={},this._evaluator=new C_(a,l),this._defaultValue=n?function(d){return d.type==="color"&&(u(d.default)||Array.isArray(d.default))?new _n(0,0,0,0):d.type==="color"?_n.parse(d.default)||null:d.default===void 0?null:d.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,l,d,f,_,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,l,d,f,_,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Or(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function F(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in La}function B(t,e,n,a){let l=new B_(La,[],e?function(f){let _={color:xi,string:yn,number:lt,enum:yn,boolean:vn,formatted:Ol,resolvedImage:ko};return f.type==="array"?Ai(_[f.value]||fn,f.length):_[f.type]}(e):void 0,void 0,void 0,n,a),d=l.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?ty(new L(d,e,n,a)):Fa(l.errors)}class U{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!sd(n.expression),this.isConfigDependent=!jp(n.expression)}evaluateWithoutErrorHandling(e,n,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,l,d,f)}evaluate(e,n,a,l,d,f){return this._styleExpression.evaluate(e,n,a,l,d,f)}}class ${constructor(e,n,a,l,d){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!sd(n.expression),this.isLightConstant=d,this.isConfigDependent=!jp(n.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,n,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,l,d,f)}evaluate(e,n,a,l,d,f){return this._styleExpression.evaluate(e,n,a,l,d,f)}interpolationFactor(e,n,a){return this.interpolationType?Bi.interpolationFactor(this.interpolationType,e,n,a):0}}function G(t,e,n,a){if((t=B(t,e,n,a)).result==="error")return t;let l=t.value.expression,d=Us(l);if(!d&&!gd(e))return Fa([new Lo("","data expressions not supported")]);let f=Eu(l,["zoom","pitch","distance-from-center"]);if(!f&&!p(e))return Fa([new Lo("","zoom expressions not supported")]);let _=Eu(l,["measure-light"]);if(!_&&!T1(e))return Fa([new Lo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,b=H(l);return b||f||y?b instanceof Lo?Fa([b]):b instanceof Bi&&!s(e)?Fa([new Lo("",'"interpolate" expressions cannot be used with this property')]):ty(b?new $(d?"camera":"composite",t.value,b.labels,b instanceof Bi?b.interpolation:void 0,_):new U(d?"constant":"source",t.value,_)):Fa([new Lo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class q{constructor(e,n){this._parameters=e,this._specification=n,Ip(this,v(this._parameters,this._specification))}static deserialize(e){return new q(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function H(t){let e=null;if(t instanceof fd)e=H(t.result);else if(t instanceof dd){for(let n of t.args)if(e=H(n),e)break}else(t instanceof Du||t instanceof Bi)&&t.input instanceof pi&&t.input.name==="zoom"&&(e=t);return e instanceof Lo||t.eachChild(n=>{let a=H(n);a instanceof Lo?e=a:e&&a&&e!==a&&(e=new Lo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var J=te,ee=3;function te(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(n=l[2]);for(var d=0;d<this.d*this.d;d++){var f=l[ee+d],_=l[ee+d+1];a.push(f===_?null:l.subarray(f,_))}var y=l[ee+a.length+1];this.keys=l.subarray(l[ee+a.length],y),this.bboxes=l.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var T=n/e*t;this.min=-T,this.max=t+T}te.prototype.insert=function(t,e,n,a,l){this._forEachCell(e,n,a,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l)},te.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},te.prototype._insertCell=function(t,e,n,a,l,d){this.cells[l].push(d)},te.prototype.query=function(t,e,n,a,l){var d=this.min,f=this.max;if(t<=d&&e<=d&&f<=n&&f<=a&&!l)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,n,a,this._queryCell,_,{},l),_},te.prototype._queryCell=function(t,e,n,a,l,d,f,_){var y=this.cells[l];if(y!==null)for(var b=this.keys,T=this.bboxes,D=0;D<y.length;D++){var S=y[D];if(f[S]===void 0){var P=4*S;(_?_(T[P+0],T[P+1],T[P+2],T[P+3]):t<=T[P+2]&&e<=T[P+3]&&n>=T[P+0]&&a>=T[P+1])?(f[S]=!0,d.push(b[S])):f[S]=!1}}},te.prototype._forEachCell=function(t,e,n,a,l,d,f,_){for(var y=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(n),D=this._convertToCellCoord(a),S=y;S<=T;S++)for(var P=b;P<=D;P++){var R=this.d*P+S;if((!_||_(this._convertFromCellCoord(S),this._convertFromCellCoord(P),this._convertFromCellCoord(S+1),this._convertFromCellCoord(P+1)))&&l.call(this,t,e,n,a,R,d,f,_))return}},te.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},te.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},te.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ee+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var l=new Int32Array(e+n+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var d=e,f=0;f<t.length;f++){var _=t[f];l[ee+f]=d,l.set(_,d),d+=_.length}return l[ee+t.length]=d,l.set(this.keys,d),l[ee+t.length+1]=d+=this.keys.length,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer};var ue=ct(J);let le={};function Q(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),le[e]={klass:t,omit:n.omit||[]}}Q(Object,"Object"),ue.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ue.deserialize=function(t){return new ue(t.buffer)},Object.defineProperty(ue,"name",{value:"Grid"}),Q(ue,"Grid"),Q(_n,"Color"),Q(Error,"Error"),Q(ri,"Formatted"),Q(Ca,"FormattedSection"),Q(_p,"AJAXError"),Q(bi,"ResolvedImage"),Q(q,"StylePropertyFunction"),Q(L,"StyleExpression",{omit:["_evaluator"]}),Q($,"ZoomDependentExpression"),Q(U,"ZoomConstantExpression"),Q(pi,"CompoundExpression",{omit:["_evaluate"]});for(let t in La)le[La[t]._classRegistryKey]||Q(La[t],`Expression${t}`);function ne(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function re(t){return self.ImageBitmap&&t instanceof ImageBitmap}function pe(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ne(t)||re(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let a of t)n.push(pe(a,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[a,l]of t.entries())n[a]=pe(l);return n}if(typeof t=="object"){let n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let l=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let d in t)t.hasOwnProperty(d)&&(le[a].omit.indexOf(d)>=0||(l[d]=pe(t[d],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof t)}function Ee(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ne(t)||re(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ee);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let l=new Map;for(let d of Object.keys(t))d!=="$name"&&l.set(d,Ee(t[d]));return l}let{klass:n}=le[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let a=Object.create(n.prototype);for(let l of Object.keys(t))l!=="$name"&&(a[l]=Ee(t[l]));return a}throw new Error("can't deserialize object of type "+typeof t)}let se={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Te(t){for(let e of t)if(Ue(e.charCodeAt(0)))return!0;return!1}function Se(t){for(let e of t)if(!Be(e.charCodeAt(0)))return!1;return!0}function Be(t){return!(se.Arabic(t)||se["Arabic Supplement"](t)||se["Arabic Extended-A"](t)||se["Arabic Presentation Forms-A"](t)||se["Arabic Presentation Forms-B"](t))}function Ue(t){return!(t!==746&&t!==747&&(t<4352||!(se["Bopomofo Extended"](t)||se.Bopomofo(t)||se["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||se["CJK Compatibility Ideographs"](t)||se["CJK Compatibility"](t)||se["CJK Radicals Supplement"](t)||se["CJK Strokes"](t)||!(!se["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||se["CJK Unified Ideographs Extension A"](t)||se["CJK Unified Ideographs"](t)||se["Enclosed CJK Letters and Months"](t)||se["Hangul Compatibility Jamo"](t)||se["Hangul Jamo Extended-A"](t)||se["Hangul Jamo Extended-B"](t)||se["Hangul Jamo"](t)||se["Hangul Syllables"](t)||se.Hiragana(t)||se["Ideographic Description Characters"](t)||se.Kanbun(t)||se["Kangxi Radicals"](t)||se["Katakana Phonetic Extensions"](t)||se.Katakana(t)&&t!==12540||!(!se["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!se["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||se["Unified Canadian Aboriginal Syllabics"](t)||se["Unified Canadian Aboriginal Syllabics Extended"](t)||se["Vertical Forms"](t)||se["Yijing Hexagram Symbols"](t)||se["Yi Syllables"](t)||se["Yi Radicals"](t))))}function Ne(t){return!(Ue(t)||function(e){return!!(se["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||se["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||se["Letterlike Symbols"](e)||se["Number Forms"](e)||se["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||se["Control Pictures"](e)&&e!==9251||se["Optical Character Recognition"](e)||se["Enclosed Alphanumerics"](e)||se["Geometric Shapes"](e)||se["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||se["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||se["CJK Symbols and Punctuation"](e)||se.Katakana(e)||se["Private Use Area"](e)||se["CJK Compatibility Forms"](e)||se["Small Form Variants"](e)||se["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function ye(t){return t>=1424&&t<=2303||se["Arabic Presentation Forms-A"](t)||se["Arabic Presentation Forms-B"](t)}function Ae(t,e){return!(!e&&ye(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||se.Khmer(t))}function Le(t){for(let e of t)if(ye(e.charCodeAt(0)))return!0;return!1}let et="deferred",it="loading",nt="loaded",ze=null,Ve="unavailable",tt=null,ut=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ve="error"),ze&&ze(t)};function At(){Bt.fire(new vi("pluginStateChange",{pluginStatus:Ve,pluginURL:tt}))}let Bt=new Sa,on=function(){return Ve},tn=function(){if(Ve!==et||!tt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ve=it,At(),tt&&Ia({url:tt},t=>{t?ut(t):(Ve=nt,At())})},Cn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ve===nt||Cn.applyArabicShaping!=null,isLoading:()=>Ve===it,setState(t){Ve=t.pluginStatus,tt=t.pluginURL},isParsed:()=>Cn.applyArabicShaping!=null&&Cn.processBidirectionalText!=null&&Cn.processStyledBidirectionalText!=null,getPluginURL:()=>tt};class Ot{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(let l of n)if(!Ae(l.charCodeAt(0),a))return!1;return!0}(e,Cn.isLoaded())}}class Tn{constructor(e,n,a,l){this.property=e,this.value=n,this.expression=function(d,f,_,y){if(u(d))return new q(d,f);if(F(d)||Array.isArray(d)&&d.length>0){let b=G(d,f,_,y);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=d;return typeof d=="string"&&f.type==="color"&&(b=_n.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(n===void 0?e.specification.default:n,e.specification,a,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class Un{constructor(e,n,a){this.property=e,this.value=new Tn(e,void 0,n,a)}transitioned(e,n){return new Qt(this.property,this.value,n,ni({},e.transition,this.transition),e.now)}untransitioned(){return new Qt(this.property,this.value,null,{},0)}}class An{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Ro(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Un(this._values[e].property,this._scope,this._options)),this._values[e].value=new Tn(this._values[e].property,n===null?void 0:Ro(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let a=this._properties.properties;if(e)for(let l in e){let d=e[l];if(Qc(l,"-transition")){let f=l.slice(0,-11);a[f]&&this.setTransition(f,d)}else a.hasOwnProperty(l)&&this.setValue(l,d)}}getTransition(e){return Ro(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Un(this._values[e].property)),this._values[e].transition=Ro(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let l=this.getTransition(n);l!==void 0&&(e[`${n}-transition`]=l)}return e}transitioned(e,n){let a=new Lt(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(e,n._values[l]);return a}untransitioned(){let e=new Lt(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Qt{constructor(e,n,a,l,d){let f=l.delay||0,_=l.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+f,this.end=this.begin+_,e.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let l=e.now||0,d=this.value.possiblyEvaluate(e,n,a),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(e,n,a);{let _=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,n,a),d,ip(_))}}return d}}class Lt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let l=new sn(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,n,a);return l}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class qn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Ro(this._values[e].value)}setValue(e,n){this._values[e]=new Tn(this._values[e].property,n===null?void 0:Ro(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let l=new sn(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,n,a);return l}}class Yn{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,l){return this.property.evaluate(this.value,this.parameters,e,n,a,l)}}class sn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Fe{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let l=Jh[this.specification.type];return l?l(e,n,a):e}}class st{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,l){return new Yn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,l)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Yn(this,{kind:"constant",value:void 0},e.parameters);let l=Jh[this.specification.type];return l?new Yn(this,{kind:"constant",value:l(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,l,d,f){return e.kind==="constant"?e.value:e.evaluate(n,a,l,d,f)}}class Mr{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,l){return!!e.expression.evaluate(n,null,{},a,l)}interpolate(){return!1}}class Mn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Ot(0,{});for(let a in e){let l=e[a];l.specification.overridable&&this.overridableProperties.push(a);let d=this.defaultPropertyValues[a]=new Tn(l,void 0),f=this.defaultTransitionablePropertyValues[a]=new Un(l);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(n)}}}Q(st,"DataDrivenProperty"),Q(Fe,"DataConstantProperty"),Q(Mr,"ColorRampProperty");var we=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ei(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ii(t){if(Array.isArray(t))return t.map(ii);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=ii(t[n]);return e}return Ei(t)}function Lr(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Lr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function mi(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lr(t)||(t=No(t));let n=t,a=!0;try{a=function(b){if(!Ui(b))return b;let T=ii(b);return Ji(T),T=Pi(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let l=we[`filter_${e}`],d=B(a,l),f=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));f=(b,T,D)=>d.value.evaluate(b,T,{},D);let _=null,y=null;if(a!==n){let b=B(n,l);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,D,S,P,R)=>b.value.evaluate(T,D,{},S,void 0,void 0,P,R),y=!Us(b.value.expression)}return{filter:f,dynamicFilter:_||void 0,needGeometry:ts(a),needFeature:!!y}}function Pi(t){if(!Array.isArray(t))return t;let e=function(n){if(Vs.has(n[0])){for(let a=1;a<n.length;a++)if(Ui(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>Pi(n))}function Ji(t){let e=!1,n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||Ui(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Ui(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Ui(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)Ji(t[a])}function Ui(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Ui(t[n]))return!0;return!1}let Vs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function js(t,e){return t<e?-1:t>e?1:0}function ts(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(ts(t[e]))return!0;return!1}function No(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?ns(t[1],t[2],"=="):e==="!="?jl(ns(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ns(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(No))):e==="all"?["all"].concat(t.slice(1).map(No)):e==="none"?["all"].concat(t.slice(1).map(No).map(jl)):e==="in"?Vl(t[1],t.slice(2)):e==="!in"?jl(Vl(t[1],t.slice(2))):e==="has"?Pu(t[1]):e!=="!has"||jl(Pu(t[1]));var n}function ns(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Vl(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(js)]]:["filter-in-small",t,["literal",e]]}}function Pu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function jl(t){return["!",t]}let $l="";function _d(t,e){return e?`${t}${$l}${e}`:t}let yd="-transition",Na=new Set(["fill","line","background","hillshade","raster"]);class oi extends Sa{constructor(e,n,a,l,d){if(super(),this.id=e.id,this.fqid=_d(this.id,a),this.type=e.type,this.scope=a,this.lut=l,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new qn(n.layout,this.scope,d),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new An(n.paint,this.scope,d);for(let f in e.paint)this.setPaintProperty(f,e.paint[f]);for(let f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new sn(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Na.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Qc(e,yd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let a=this._transitionablePaint,l=a._properties.properties;if(Qc(e,yd)){let D=e.slice(0,-11);return l[D]&&a.setTransition(D,n||void 0),!1}if(!l[e])return!1;let d=a._values[e],f=d.value.isDataDriven(),_=d.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,b=y.isDataDriven(),T=Qc(e,"pattern")||e==="line-dasharray";return b||f||T||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Ea({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof Yn&&gd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=mi(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,l,d,f,_,y,b){}queryIntersectsMatchingFeature(e,n,a,l){}}let em={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ry{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function In(t,e=1){let n=0,a=0;return{members:t.map(l=>{let d=em[l.type].BYTES_PER_ELEMENT,f=n=SD(n,Math.max(e,d)),_=l.components||1;return a=Math.max(a,d),n+=d*_,{name:l.name,type:l.type,components:_,offset:f}}),size:SD(n,Math.max(a,e)),alignment:e}}function SD(t,e){return Math.ceil(t/e)*e}class rs extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let l=2*e;return this.int16[l+0]=n,this.int16[l+1]=a,e}}rs.prototype.bytesPerElement=4,Q(rs,"StructArrayLayout2i4");class iy extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,a)}emplace(e,n,a,l){let d=3*e;return this.int16[d+0]=n,this.int16[d+1]=a,this.int16[d+2]=l,e}}iy.prototype.bytesPerElement=6,Q(iy,"StructArrayLayout3i6");class Gl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,l)}emplace(e,n,a,l,d){let f=4*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=l,this.int16[f+3]=d,e}}Gl.prototype.bytesPerElement=8,Q(Gl,"StructArrayLayout4i8");class I1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,l,d)}emplace(e,n,a,l,d,f){let _=5*e;return this.int16[_+0]=n,this.int16[_+1]=a,this.int16[_+2]=l,this.int16[_+3]=d,this.int16[_+4]=f,e}}I1.prototype.bytesPerElement=10,Q(I1,"StructArrayLayout5i10");class D1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,l,d,f,_)}emplace(e,n,a,l,d,f,_,y){let b=6*e,T=12*e,D=3*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.uint8[T+4]=l,this.uint8[T+5]=d,this.uint8[T+6]=f,this.uint8[T+7]=_,this.float32[D+2]=y,e}}D1.prototype.bytesPerElement=12,Q(D1,"StructArrayLayout2i4ub1f12");class ql extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,l)}emplace(e,n,a,l,d){let f=4*e;return this.float32[f+0]=n,this.float32[f+1]=a,this.float32[f+2]=l,this.float32[f+3]=d,e}}ql.prototype.bytesPerElement=16,Q(ql,"StructArrayLayout4f16");class Hl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,a)}emplace(e,n,a,l){let d=3*e;return this.float32[d+0]=n,this.float32[d+1]=a,this.float32[d+2]=l,e}}Hl.prototype.bytesPerElement=12,Q(Hl,"StructArrayLayout3f12");class Wl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,l,d)}emplace(e,n,a,l,d,f){let _=6*e,y=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=a,this.uint16[_+2]=l,this.uint16[_+3]=d,this.float32[y+2]=f,e}}Wl.prototype.bytesPerElement=12,Q(Wl,"StructArrayLayout4ui1f12");class oy extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,l)}emplace(e,n,a,l,d){let f=4*e;return this.uint16[f+0]=n,this.uint16[f+1]=a,this.uint16[f+2]=l,this.uint16[f+3]=d,e}}oy.prototype.bytesPerElement=8,Q(oy,"StructArrayLayout4ui8");class sy extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,l,d,f)}emplace(e,n,a,l,d,f,_){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=l,this.int16[y+3]=d,this.int16[y+4]=f,this.int16[y+5]=_,e}}sy.prototype.bytesPerElement=12,Q(sy,"StructArrayLayout6i12");class S1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_,y,b,T,D,S){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,a,l,d,f,_,y,b,T,D,S)}emplace(e,n,a,l,d,f,_,y,b,T,D,S,P){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=a,this.int16[R+2]=l,this.int16[R+3]=d,this.uint16[R+4]=f,this.uint16[R+5]=_,this.uint16[R+6]=y,this.uint16[R+7]=b,this.int16[R+8]=T,this.int16[R+9]=D,this.int16[R+10]=S,this.int16[R+11]=P,e}}S1.prototype.bytesPerElement=24,Q(S1,"StructArrayLayout4i4ui4i24");class C1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,l,d,f)}emplace(e,n,a,l,d,f,_){let y=10*e,b=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=l,this.float32[b+2]=d,this.float32[b+3]=f,this.float32[b+4]=_,e}}C1.prototype.bytesPerElement=20,Q(C1,"StructArrayLayout3i3f20");class M1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}M1.prototype.bytesPerElement=4,Q(M1,"StructArrayLayout1ul4");class Ru extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Ru.prototype.bytesPerElement=4,Q(Ru,"StructArrayLayout1f4");class Zl extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let l=2*e;return this.uint16[l+0]=n,this.uint16[l+1]=a,e}}Zl.prototype.bytesPerElement=4,Q(Zl,"StructArrayLayout2ui4");class A1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_,y,b,T,D,S,P){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,l,d,f,_,y,b,T,D,S,P)}emplace(e,n,a,l,d,f,_,y,b,T,D,S,P,R){let k=20*e,N=10*e;return this.int16[k+0]=n,this.int16[k+1]=a,this.int16[k+2]=l,this.int16[k+3]=d,this.int16[k+4]=f,this.float32[N+3]=_,this.float32[N+4]=y,this.float32[N+5]=b,this.float32[N+6]=T,this.int16[k+14]=D,this.uint32[N+8]=S,this.uint16[k+18]=P,this.uint16[k+19]=R,e}}A1.prototype.bytesPerElement=40,Q(A1,"StructArrayLayout5i4f1i1ul2ui40");class ay extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,l,d,f,_)}emplace(e,n,a,l,d,f,_,y){let b=8*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+4]=d,this.int16[b+5]=f,this.int16[b+6]=_,this.int16[b+7]=y,e}}ay.prototype.bytesPerElement=16,Q(ay,"StructArrayLayout3i2i2i16");class P1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,l,d)}emplace(e,n,a,l,d,f){let _=4*e,y=8*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=l,this.int16[y+6]=d,this.int16[y+7]=f,e}}P1.prototype.bytesPerElement=16,Q(P1,"StructArrayLayout2f1f2i16");class R1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,l)}emplace(e,n,a,l,d){let f=12*e,_=3*e;return this.uint8[f+0]=n,this.uint8[f+1]=a,this.float32[_+1]=l,this.float32[_+2]=d,e}}R1.prototype.bytesPerElement=12,Q(R1,"StructArrayLayout2ub2f12");class Fr extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,a)}emplace(e,n,a,l){let d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=a,this.uint16[d+2]=l,e}}Fr.prototype.bytesPerElement=6,Q(Fr,"StructArrayLayout3ui6");class O1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V,Y,X,K,ae){let oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V,Y,X,K,ae)}emplace(e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V,Y,X,K,ae,oe){let fe=30*e,me=15*e,xe=60*e;return this.int16[fe+0]=n,this.int16[fe+1]=a,this.int16[fe+2]=l,this.float32[me+2]=d,this.float32[me+3]=f,this.uint16[fe+8]=_,this.uint16[fe+9]=y,this.uint32[me+5]=b,this.uint32[me+6]=T,this.uint32[me+7]=D,this.uint16[fe+16]=S,this.uint16[fe+17]=P,this.uint16[fe+18]=R,this.float32[me+10]=k,this.float32[me+11]=N,this.uint8[xe+48]=V,this.uint8[xe+49]=Y,this.uint8[xe+50]=X,this.uint32[me+13]=K,this.int16[fe+28]=ae,this.uint8[xe+58]=oe,e}}O1.prototype.bytesPerElement=60,Q(O1,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class L1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V,Y,X,K,ae,oe,fe,me,xe,Pe,De,ke,He,Oe,je,Re,$e,Ye){let Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V,Y,X,K,ae,oe,fe,me,xe,Pe,De,ke,He,Oe,je,Re,$e,Ye)}emplace(e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V,Y,X,K,ae,oe,fe,me,xe,Pe,De,ke,He,Oe,je,Re,$e,Ye,Ge){let at=22*e,We=44*e,Ke=88*e;return this.float32[at+0]=n,this.float32[at+1]=a,this.int16[We+4]=l,this.int16[We+5]=d,this.int16[We+6]=f,this.int16[We+7]=_,this.int16[We+8]=y,this.int16[We+9]=b,this.int16[We+10]=T,this.int16[We+11]=D,this.int16[We+12]=S,this.uint16[We+13]=P,this.uint16[We+14]=R,this.uint16[We+15]=k,this.uint16[We+16]=N,this.uint16[We+17]=V,this.uint16[We+18]=Y,this.uint16[We+19]=X,this.uint16[We+20]=K,this.uint16[We+21]=ae,this.uint16[We+22]=oe,this.uint16[We+23]=fe,this.uint16[We+24]=me,this.uint16[We+25]=xe,this.uint16[We+26]=Pe,this.uint16[We+27]=De,this.uint32[at+14]=ke,this.float32[at+15]=He,this.float32[at+16]=Oe,this.float32[at+17]=je,this.float32[at+18]=Re,this.float32[at+19]=$e,this.float32[at+20]=Ye,this.uint8[Ke+84]=Ge,e}}L1.prototype.bytesPerElement=88,Q(L1,"StructArrayLayout2f9i15ui1ul6f1ub88");class Ou extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,l,d)}emplace(e,n,a,l,d,f){let _=5*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=l,this.float32[_+3]=d,this.float32[_+4]=f,e}}Ou.prototype.bytesPerElement=20,Q(Ou,"StructArrayLayout5f20");class k1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,l,d,f,_)}emplace(e,n,a,l,d,f,_,y){let b=7*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=l,this.float32[b+3]=d,this.float32[b+4]=f,this.float32[b+5]=_,this.float32[b+6]=y,e}}k1.prototype.bytesPerElement=28,Q(k1,"StructArrayLayout7f28");class vd extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let l=2*e;return this.float32[l+0]=n,this.float32[l+1]=a,e}}vd.prototype.bytesPerElement=8,Q(vd,"StructArrayLayout2f8");class F1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,a,l)}emplace(e,n,a,l,d){let f=6*e;return this.uint32[3*e+0]=n,this.uint16[f+2]=a,this.uint16[f+3]=l,this.uint16[f+4]=d,e}}F1.prototype.bytesPerElement=12,Q(F1,"StructArrayLayout1ul3ui12");class tm extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}tm.prototype.bytesPerElement=2,Q(tm,"StructArrayLayout1ui2");class N1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N){let V=this.length;return this.resize(V+1),this.emplace(V,e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N)}emplace(e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V){let Y=16*e;return this.float32[Y+0]=n,this.float32[Y+1]=a,this.float32[Y+2]=l,this.float32[Y+3]=d,this.float32[Y+4]=f,this.float32[Y+5]=_,this.float32[Y+6]=y,this.float32[Y+7]=b,this.float32[Y+8]=T,this.float32[Y+9]=D,this.float32[Y+10]=S,this.float32[Y+11]=P,this.float32[Y+12]=R,this.float32[Y+13]=k,this.float32[Y+14]=N,this.float32[Y+15]=V,e}}N1.prototype.bytesPerElement=64,Q(N1,"StructArrayLayout16f64");class ly extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,l,d,f,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,l,d,f,_)}emplace(e,n,a,l,d,f,_,y){let b=10*e,T=5*e;return this.uint16[b+0]=n,this.uint16[b+1]=a,this.uint16[b+2]=l,this.uint16[b+3]=d,this.float32[T+2]=f,this.float32[T+3]=_,this.float32[T+4]=y,e}}ly.prototype.bytesPerElement=20,Q(ly,"StructArrayLayout4ui3f20");class z1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}z1.prototype.bytesPerElement=2,Q(z1,"StructArrayLayout1i2");class B1 extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}B1.prototype.bytesPerElement=1,Q(B1,"StructArrayLayout1ub1");class CD extends ry{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}CD.prototype.size=40;class U1 extends A1{get(e){return new CD(this,e)}}Q(U1,"CollisionBoxArray");class MD extends ry{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}MD.prototype.size=60;class AD extends O1{get(e){return new MD(this,e)}}Q(AD,"PlacedSymbolArray");class PD extends ry{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}PD.prototype.size=88;class RD extends L1{get(e){return new PD(this,e)}}Q(RD,"SymbolInstanceArray");class OD extends Ru{getoffsetX(e){return this.float32[1*e+0]}}Q(OD,"GlyphOffsetArray");class LD extends rs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Q(LD,"SymbolLineVertexArray");class kD extends ry{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kD.prototype.size=12;class FD extends F1{get(e){return new kD(this,e)}}Q(FD,"FeatureIndexArray");class ND extends Zl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Q(ND,"FillExtrusionCentroidArray");let FF=In([{name:"a_pos",components:2,type:"Int16"}],4),NF=In([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class sr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,l){let d=this.segments[this.segments.length-1];return e>sr.MAX_VERTEX_ARRAY_LENGTH&&yr(`Max vertices per segment is ${sr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>sr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}prepareSegment(e,n,a,l){return this._prepareSegment(e,n.length,a.length,l)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,l){return new sr([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function zD(t,e){return 256*(t=Zt(Math.floor(t),0,255))+Zt(Math.floor(e),0,255)}sr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Q(sr,"SegmentVector");let zF=In([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),BF=In([{name:"a_dash",components:4,type:"Uint16"}]);class nm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,l){this.ids.push(BD(e)),this.positions.push(n,a,l)}eachPosition(e,n){let a=BD(e),l=0,d=this.ids.length-1;for(;l<d;){let f=l+d>>1;this.ids[f]>=a?d=f:l=f+1}for(;this.ids[l]===a;)n(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,n){let a=new Float64Array(e.ids),l=new Uint32Array(e.positions);return V1(a,l,0,a.length-1),n&&(n.add(a.buffer),n.add(l.buffer)),{ids:a,positions:l}}static deserialize(e){let n=new nm,a;n.ids=e.ids,n.positions=e.positions;for(let l of n.ids)l!==a&&n.uniqueIds.push(l),a=l;return n.indexed=!0,n}}function BD(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ml(String(t))}function V1(t,e,n,a){for(;n<a;){let l=t[n+a>>1],d=n-1,f=a+1;for(;;){do d++;while(t[d]<l);do f--;while(t[f]>l);if(d>=f)break;cy(t,d,f),cy(e,3*d,3*f),cy(e,3*d+1,3*f+1),cy(e,3*d+2,3*f+2)}f-n<a-f?(V1(t,e,n,f),n=f+1):(V1(t,e,f+1,a),a=f)}}function cy(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}Q(nm,"FeaturePositionMap");class za{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class uy extends za{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Ri extends za{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ba extends za{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class j1 extends za{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class $1 extends za{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class UD extends za{constructor(e){super(e),this.current=_n.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let UF=new Float32Array(16);class rm extends za{constructor(e){super(e),this.current=UF}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let l=1;l<16;l++)if(a[l]!==this.current[l]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let VF=new Float32Array(9),jF=new Float32Array(4);class G1 extends za{constructor(e){super(e),this.current=jF}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let l=0;l<4;l++)if(a[l]!==this.current[l]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function q1(t){return[zD(255*t.r,255*t.g),zD(255*t.b,255*t.a)]}class im{constructor(e,n,a,l){this.value=e,this.uniformNames=n.map(d=>`u_${d}`),this.type=a,this.context=l}setUniform(e,n,a,l,d){let f=l.constantOr(this.value);n.set(e,d,f instanceof _n?f.toRenderColor(this.context.lut):f)}getBinding(e,n){return this.type==="color"?new UD(e):new Ri(e)}}class xd{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,l,d){let f=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;f&&n.set(e,d,f)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new $1(e):new Ri(e)}}class Ua{constructor(e,n,a,l){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,n,a,l,d,f,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new Ot(0,{brightness:f}),n,{},d,l,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b,this.context)}updatePaintArray(e,n,a,l,d,f,_){let y=this.expression.evaluate({zoom:0,brightness:_},a,l,void 0,d);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,a,l){if(this.type==="color"){let d=q1(a.toRenderColor(l.lut));for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(e,n,a,l,d,f){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=l,this.context=d,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,a,l,d,f,_){let y=this.expression.evaluate(new Ot(this.context.zoom,{brightness:f}),n,{},d,l,_),b=this.expression.evaluate(new Ot(this.context.zoom+1,{brightness:f}),n,{},d,l,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,b,this.context)}updatePaintArray(e,n,a,l,d,f,_){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:_},a,l,void 0,d),b=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},a,l,void 0,d);this._setPaintValue(e,n,y,b,this.context)}_setPaintValue(e,n,a,l,d){if(this.type==="color"){let f=q1(a.toRenderColor(d.lut)),_=q1(a.toRenderColor(d.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],_[0],_[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,l,d){let f=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=Zt(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);n.set(e,d,_)}getBinding(e,n){return new Ri(e)}}class Yl{constructor(e,n,a,l,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?BF:zF).members;for(let f=0;f<n.length;++f);this.paintVertexArray=new l}populatePaintArray(e,n,a,l){let d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,l,d,f,_){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,n,a,l){if(!l||!a)return;let d=l[a];if(!d)return;let{tl:f,br:_,pixelRatio:y}=d;for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,f[0],f[1],_[0],_[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Lu{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;let l=[];for(let d in e.paint._values){let f=e.paint.get(d);if(!a(d)||!(f instanceof Yn&&gd(f.property.specification)))continue;let _=GF(d,e.type),y=f.value,b=f.property.specification.type,T=!!f.property.useIntegerZoom,D=d==="line-dasharray"||d.endsWith("pattern"),S=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||S)if(y.kind==="source"||S||D){let P=VD(d,b,"source");this.binders[d]=D?new Yl(y,_,b,P,e.id):new Ua(y,_,b,P),l.push(`/a_${d}`)}else{let P=VD(d,b,"composite");this.binders[d]=new is(y,_,b,T,n,P),l.push(`/z_${d}`)}else this.binders[d]=D?new xd(y.value,_):new im(y.value,_,b,n),l.push(`/u_${d}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Ua||n instanceof is?n.maxValue:0}populatePaintArrays(e,n,a,l,d,f,_){for(let y in this.binders){let b=this.binders[y];b.context=this.context,(b instanceof Ua||b instanceof is||b instanceof Yl)&&b.populatePaintArray(e,n,a,l,d,f,_)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof xd&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,l,d,f,_,y){let b=!1,T=Object.keys(e),D=T.length!==0,S=D?T:n.uniqueIds;this.context.lut=d.lut;for(let P in this.binders){let R=this.binders[P];if(R.context=this.context,(R instanceof Ua||R instanceof is||R instanceof Yl)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let k=d.paint.get(P);R.expression=k.value;for(let N of S){let V=e[N.toString()];n.eachPosition(N,(Y,X,K)=>{let ae=l.feature(Y);R.updatePaintArray(X,K,ae,V,f,_,y)})}if(!D)for(let N of a.uniqueIds){let V=e[N.toString()];a.eachPosition(N,(Y,X,K)=>{let ae=l.feature(Y);R.updatePaintArray(X,K,ae,V,f,_,y)})}b=!0}}return b}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof im||a instanceof xd)&&e.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Ua||a instanceof is||a instanceof Yl)for(let l=0;l<a.paintVertexAttributes.length;l++)e.push(a.paintVertexAttributes[l].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof im||a instanceof xd||a instanceof is)for(let l of a.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let l=this.binders[a];if(l instanceof im||l instanceof xd||l instanceof is)for(let d of l.uniformNames)n.push({name:d,property:a,binding:l.getBinding(e,d)})}return n}setUniforms(e,n,a,l,d){for(let{name:f,property:_,binding:y}of a)this.binders[_].setUniform(e,y,d,l.get(_),f)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Ua||n instanceof is||n instanceof Yl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof Ua||a instanceof is||a instanceof Yl)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Ua||n instanceof is||n instanceof Yl)&&n.destroy()}}}class Xl{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let l of e)this.programConfigurations[l.id]=new Lu(l,n,a);this.needsUpload=!1,this._featureMap=new nm,this._featureMapWithoutIds=new nm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,l,d,f,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,l,d,f,_,y);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,l,d,f){for(let _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,_,l,d,f||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let $F={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function GF(t,e){return $F[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let qF={"line-pattern":{source:Wl,composite:Wl},"fill-pattern":{source:Wl,composite:Wl},"fill-extrusion-pattern":{source:Wl,composite:Wl},"line-dasharray":{source:oy,composite:oy}},HF={color:{source:vd,composite:ql},number:{source:Ru,composite:vd}};function VD(t,e,n){let a=qF[t];return a&&a[n]||HF[e][n]}Q(im,"ConstantBinder"),Q(xd,"PatternConstantBinder"),Q(Ua,"SourceExpressionBinder"),Q(Yl,"PatternCompositeBinder"),Q(is,"CompositeExpressionBinder"),Q(Lu,"ProgramConfiguration",{omit:["_buffers"]}),Q(Xl,"ProgramConfigurationSet");let Oi=Je/Math.PI/2,H1=5,jD=6,WF=16383,bd=64,W1=[bd,32,16],zo=-Oi,Bo=Oi;function wd(t,e,n,a=Oi){return n=rn(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function ku(t,e,n){return wd(Math.cos(rn(t)),Math.sin(rn(t)),e,n)}let Ed=63710088e-1,Z1=2*Math.PI*Ed;class pn{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pn(wa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,l=e.lat*n,d=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((e.lng-this.lng)*n);return Ed*Math.acos(Math.min(d,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Kl({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return ku(this.lat,this.lng,Oi+e*Oi/Ed)}static convert(e){if(e instanceof pn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new pn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new pn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Kl{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof pn?new pn(e.lng,e.lat):pn.convert(e),this}setSouthWest(e){return this._sw=e instanceof pn?new pn(e.lng,e.lat):pn.convert(e),this}extend(e){let n=this._sw,a=this._ne,l,d;if(e instanceof pn)l=e,d=e;else{if(!(e instanceof Kl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Kl.convert(e)):this.extend(pn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(pn.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new pn(l.lng,l.lat),this._ne=new pn(d.lng,d.lat)),this}getCenter(){return new pn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pn(this.getWest(),this.getNorth())}getSouthEast(){return new pn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=pn.convert(e),l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return!e||e instanceof Kl?e:new Kl(e)}}var $D={};(function(t,e){(function(n){function a(d,f,_){var y=l(256*d,256*(f=Math.pow(2,_)-f-1),_),b=l(256*(d+1),256*(f+1),_);return y[0]+","+y[1]+","+b[0]+","+b[1]}function l(d,f,_){var y=2*Math.PI*6378137/256/Math.pow(2,_);return[d*y-2*Math.PI*6378137/2,f*y-2*Math.PI*6378137/2]}n.getURL=function(d,f,_,y,b,T){return T=T||{},d+"?"+["bbox="+a(_,y,b),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+f].join("&")},n.getTileBBox=a,n.getMercCoords=l,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,$D);var ZF=$D;class Fu{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=om(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=ZF.getTileBBox(this.x,this.y,this.z),l=function(d,f,_){let y,b="";for(let T=d;T>0;T--)y=1<<T-1,b+=(f&y?1:0)+(_&y?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class GD{constructor(e,n){this.wrap=e,this.canonical=n,this.key=om(e,n.z,n.z,n.x,n.y)}}class Ar{constructor(e,n,a,l,d){this.overscaledZ=e,this.wrap=n,this.canonical=new Fu(a,+l,+d),this.key=n===0&&e===a?this.canonical.key:om(n,e,a,l,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Ar(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ar(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return om(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return om(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ar(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new Ar(n,this.wrap,n,a,l),new Ar(n,this.wrap,n,a+1,l),new Ar(n,this.wrap,n,a,l+1),new Ar(n,this.wrap,n,a+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ar(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ar(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new GD(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function om(t,e,n,a,l){let d=1<<Math.min(n,22),f=d*(l%d)+a%d;return t&&n<22&&(f+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*f+n)+(e-n)}let YF=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Ar(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Ar(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Ar(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Ar(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Q(Fu,"CanonicalTileID"),Q(Ar,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let XF=0,KF=25.5;function Y1(t){return Z1*Math.cos(t*Math.PI/180)}function $s(t){return(180+t)/360}function Gs(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Li(t,e){return t/Y1(e)}function Vi(t){return 360*t-180}function Hr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function qD(t,e){return t*Y1(Hr(e))}let xr=85.051129;function HD(t){return Math.cos(rn(Zt(t,-xr,xr)))}function Nu(t,e){let n=Zt(e,XF,KF),a=Math.pow(2,n);return HD(t)*Z1/(512*a)}function WD(t){return 1/Math.cos(t*Math.PI/180)}function hy(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/Je)/(1<<t.z)*2));return 80150034*n/(n*n+1)/Je/(1<<t.z)}class gi{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=pn.convert(e);return new gi($s(a.lng),Gs(a.lat),Li(n,a.lat))}toLngLat(){return new pn(Vi(this.x),Hr(this.y))}toAltitude(){return qD(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Z1*WD(Hr(this.y))}}function X1(t,e,n,a,l,d,f,_,y){let b=(e+a)/2,T=(n+l)/2,D=new rt(b,T);_(D),function(S,P,R,k,N,V){let Y=R-N,X=k-V;return Math.abs((k-P)*Y-(R-S)*X)/Math.hypot(Y,X)}(D.x,D.y,d.x,d.y,f.x,f.y)>=y?(X1(t,e,n,b,T,d,D,_,y),X1(t,b,T,a,l,D,f,_,y)):t.push(f)}function ZD(t,e,n){let a=t[0],l=a.x,d=a.y;e(a);let f=[a];for(let _=1;_<t.length;_++){let y=t[_],{x:b,y:T}=y;e(y),X1(f,l,d,b,T,a,y,e,n),l=b,d=T,a=y}return f}function K1(t,e,n,a){if(a(e,n)){let l=e.add(n)._mult(.5);K1(t,e,l,a),K1(t,l,n,a)}else t.push(n)}function QF(t,e){let n=t[0],a=[n];for(let l=1;l<t.length;l++){let d=t[l];K1(a,n,d,e),n=d}return a}let Q1=Math.pow(2,14)-1,YD=-Q1-1;function JF(t,e){let n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=Zt(n,YD,Q1),t.y=Zt(a,YD,Q1),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&yr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function os(t,e,n){let a=t.loadGeometry(),l=t.extent,d=Je/l;if(e&&n&&n.projection.isReprojectedInTileSpace){let f=1<<e.z,{scale:_,x:y,y:b,projection:T}=n,D=S=>{let P=Vi((e.x+S.x/l)/f),R=Hr((e.y+S.y/l)/f),k=T.project(P,R);S.x=(k.x*_-y)*l,S.y=(k.y*_-b)*l};for(let S=0;S<a.length;S++)if(t.type!==1)a[S]=ZD(a[S],D,1);else{let P=[];for(let R of a[S])R.x<0||R.x>=l||R.y<0||R.y>=l||(D(R),P.push(R));a[S]=P}}for(let f of a)for(let _ of f)JF(_,d);return a}function Va(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?os(t):[]}}function dy(t,e,n,a,l){t.emplaceBack(2*e+(a+1)/2,2*n+(l+1)/2)}function fy(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class J1{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new rs,this.indexArray=new Fr,this.segments=new sr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,l){let d=this.layers[0],f=[],_=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(let{feature:b,id:T,index:D,sourceLayerIndex:S}of e){let P=this.layers[0]._featureFilter.needGeometry,R=Va(b,P);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),R,a))continue;let k=_?_.evaluate(R,{},a):void 0,N={id:T,properties:b.properties,type:b.type,sourceLayerIndex:S,index:D,geometry:P?R.geometry:os(b,a,l),patterns:{},sortKey:k};f.push(N)}_&&f.sort((b,T)=>b.sortKey-T.sortKey);let y=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new sy,y=l.projection);for(let b of f){let{geometry:T,index:D,sourceLayerIndex:S}=b,P=e[D].feature;this.addFeature(b,T,D,n.availableImages,a,y,n.brightness),n.featureIndex.insert(P,T,D,S,this.index)}}update(e,n,a,l,d){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,a,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,FF.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,NF.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,l,d,f,_){for(let y of n)for(let b of y){let T=b.x,D=b.y;if(T<0||T>=Je||D<0||D>=Je)continue;if(f){let R=f.projectTilePoint(T,D,d),k=f.upVector(d,T,D),N=this.globeExtVertexArray;fy(N,R,k),fy(N,R,k),fy(N,R,k),fy(N,R,k)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=S.vertexLength;dy(this.layoutVertexArray,T,D,-1,-1),dy(this.layoutVertexArray,T,D,1,-1),dy(this.layoutVertexArray,T,D,1,1),dy(this.layoutVertexArray,T,D,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},l,d,_)}}function eb(t,e){for(let n=0;n<t.length;n++)if(Ql(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ql(t,e[n]))return!0;return!!tb(t,e)}function e3(t,e,n){return!!Ql(t,e)||!!nb(e,t,n)}function XD(t,e){if(t.length===1)return QD(e,t[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let l=0;l<a.length;l++)if(Ql(t,a[l]))return!0}for(let n=0;n<t.length;n++)if(QD(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(tb(t,e[n]))return!0;return!1}function t3(t,e,n){if(t.length>1){if(tb(t,e))return!0;for(let a=0;a<e.length;a++)if(nb(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(nb(t[a],e,n))return!0;return!1}function tb(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let a=t[n],l=t[n+1];for(let d=0;d<e.length-1;d++)if(n3(a,l,e[d],e[d+1]))return!0}return!1}function n3(t,e,n,a){return Oo(t,n,a)!==Oo(e,n,a)&&Oo(t,e,n)!==Oo(t,e,a)}function nb(t,e,n){let a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let l=1;l<e.length;l++)if(KD(t,e[l-1],e[l])<a)return!0;return!1}function KD(t,e,n){let a=e.distSqr(n);if(a===0)return t.distSqr(e);let l=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(l<0?e:l>1?n:n.sub(e)._mult(l)._add(e))}function QD(t,e){let n,a,l,d=!1;for(let f=0;f<t.length;f++){n=t[f];for(let _=0,y=n.length-1;_<n.length;y=_++)a=n[_],l=n[y],a.y>e.y!=l.y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(d=!d)}return d}function Ql(t,e){let n=!1;for(let a=0,l=t.length-1;a<t.length;l=a++){let d=t[a],f=t[l];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(n=!n)}return n}function JD(t,e,n,a,l){for(let f of t)if(e<=f.x&&n<=f.y&&a>=f.x&&l>=f.y)return!0;let d=[new rt(e,n),new rt(e,l),new rt(a,l),new rt(a,n)];if(t.length>2){for(let f of d)if(Ql(t,f))return!0}for(let f=0;f<t.length-1;f++)if(r3(t[f],t[f+1],d))return!0;return!1}function r3(t,e,n){let a=n[0],l=n[2];if(t.x<a.x&&e.x<a.x||t.x>l.x&&e.x>l.x||t.y<a.y&&e.y<a.y||t.y>l.y&&e.y>l.y)return!1;let d=Oo(t,e,n[0]);return d!==Oo(t,e,n[1])||d!==Oo(t,e,n[2])||d!==Oo(t,e,n[3])}function Td(t,e,n,a,l,d){let f=e.y-t.y,_=t.x-e.x;if(d=d||0){let y=f*f+_*_;if(y===0)return!0;let b=Math.sqrt(y);f/=b,_/=b}return!((n.x-t.x)*f+(n.y-t.y)*_-d<0||(a.x-t.x)*f+(a.y-t.y)*_-d<0||(l.x-t.x)*f+(l.y-t.y)*_-d<0)}function rb(t,e,n,a,l,d,f){return!(Td(t,e,a,l,d,f)||Td(e,n,a,l,d,f)||Td(n,t,a,l,d,f)||Td(a,l,t,e,n,f)||Td(l,d,t,e,n,f)||Td(d,a,t,e,n,f))}function Id(t,e,n){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function py(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function eS(t,e,n,a,l){if(!e[0]&&!e[1])return t;let d=rt.convert(e)._mult(l);n==="viewport"&&d._rotate(-a);let f=[];for(let _=0;_<t.length;_++)f.push(t[_].sub(d));return f}function tS(t,e,n,a){let l=rt.convert(t)._mult(a);return e==="viewport"&&l._rotate(-n),l}Q(J1,"CircleBucket",{omit:["layers"]});let i3=new Mn({"circle-sort-key":new st(we.layout_circle["circle-sort-key"]),visibility:new Fe(we.layout_circle.visibility)});var o3={paint:new Mn({"circle-radius":new st(we.paint_circle["circle-radius"]),"circle-color":new st(we.paint_circle["circle-color"]),"circle-blur":new st(we.paint_circle["circle-blur"]),"circle-opacity":new st(we.paint_circle["circle-opacity"]),"circle-translate":new Fe(we.paint_circle["circle-translate"]),"circle-translate-anchor":new Fe(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Fe(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Fe(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(we.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Fe(we.paint_circle["circle-emissive-strength"])}),layout:i3};class ib{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let l=r._.dot(n,this.dir);if(Math.abs(l)<1e-6)return!1;let d=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/l;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,n,a){if(r._.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[l,d,f]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],b=this.pos[2]-e[2],T=l*l+d*d+f*f,D=2*(_*l+y*d+b*f),S=D*D-4*T*(_*_+y*y+b*b-n*n);if(S<0){let P=Math.max(-D/2,0),R=_+l*P,k=y+d*P,N=b+f*P,V=Math.hypot(R,k,N);return a[0]=R*n/V,a[1]=k*n/V,a[2]=N*n/V,!1}{let P=(-D-Math.sqrt(S))/(2*T);if(P<0){let R=Math.hypot(_,y,b);return a[0]=_*n/R,a[1]=y*n/R,a[2]=b*n/R,!1}return a[0]=_+l*P,a[1]=y+d*P,a[2]=b+f*P,!0}}}class ob{constructor(e,n,a,l,d){this.TL=e,this.TR=n,this.BR=a,this.BL=l,this.horizon=d}static fromInvProjectionMatrix(e,n,a){let l=[-1,1,1],d=[1,1,1],f=[1,-1,1],_=[-1,-1,1],y=r._.transformMat4(l,l,e),b=r._.transformMat4(d,d,e),T=r._.transformMat4(f,f,e),D=r._.transformMat4(_,_,e);return new ob(y,b,T,D,n/a)}}function sm(t,e,n){let a=1/0,l=-1/0,d=[];for(let f of t){r._.sub(d,f,e);let _=r._.dot(d,n);a=Math.min(a,_),l=Math.max(l,_)}return[a,l]}function nS(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){let l=t.planes[a],d=0;for(let f=0;f<e.length;f++)d+=r._.dot(l,e[f])+l[3]>=0;if(d===0)return 0;d!==e.length&&(n=!1)}return n?2:1}function rS(t,e){for(let n of t.projections){let a=sm(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function iS(t,e){let n=0,a=[0,0,0,0];for(let l=0;l<t.length;l++)a[0]=t[l][0],a[1]=t[l][1],a[2]=t[l][2],a[3]=1,r.aA.dot(a,e)>=0&&n++;return n}class sb{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=ar.fromPoints(this.points),this.projections=[],this.frustumEdges=[r._.sub([],this.points[2],this.points[3]),r._.sub([],this.points[0],this.points[3]),r._.sub([],this.points[4],this.points[0]),r._.sub([],this.points[5],this.points[1]),r._.sub([],this.points[6],this.points[2]),r._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let l=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:l,projection:sm(this.points,this.points[0],l)}),this.projections.push({axis:d,projection:sm(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,n,a,l){let d=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let T=r.aA.transformMat4([],b,e),D=1/T[3]/n*d;return r.aA.mul(T,T,[D,D,l?1/T[3]:D,D])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let T=r._.sub([],f[b[0]],f[b[1]]),D=r._.sub([],f[b[2]],f[b[1]]),S=r._.normalize([],r._.cross([],T,D)),P=-r._.dot(S,f[b[1]]);return S.concat(P)}),y=[];for(let b=0;b<f.length;b++)y.push([f[b][0],f[b][1],f[b][2]]);return new sb(y,_)}intersectsPrecise(e,n,a){for(let l=0;l<n.length;l++)if(!iS(e,n[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!iS(e,this.planes[l]))return 0;for(let l of a)for(let d of this.frustumEdges){let f=r._.cross([],l,d),_=r._.length(f);if(_===0)continue;r._.scale(f,f,1/_);let y=sm(this.points,this.points[0],f),b=sm(e,this.points[0],f);if(y[0]>b[1]||b[0]>y[1])return 0}return 1}}class ar{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let l of e)r._.min(n,n,l),r._.max(a,a,l);return new ar(n,a)}static fromTileIdAndHeight(e,n,a){let l=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new ar([d/l,f/l,n],[(d+1)/l,(f+1)/l,a])}static applyTransform(e,n){let a=e.getCorners();for(let l=0;l<a.length;++l)r._.transformMat4(a[l],a[l],n);return ar.fromPoints(a)}static projectAabbCorners(e,n){let a=e.getCorners();for(let l=0;l<a.length;++l)r._.transformMat4(a[l],a[l],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=r._.scale([],r._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=r._.clone(this.min),l=r._.clone(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],l[d]=n[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new ar(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?nS(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?nS(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?rS(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?rS(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Q(ar,"Aabb");let s3=In([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:my}=s3,oS=In([{name:"a_pos_3",components:3,type:"Int16"}]);var am=In([{name:"a_pos",type:"Int16",components:2}]);function gy(t){return t*Oi/Ed}let a3=[new ar([zo,zo,zo],[Bo,Bo,Bo]),new ar([zo,zo,zo],[0,0,Bo]),new ar([0,zo,zo],[Bo,0,Bo]),new ar([zo,0,zo],[0,Bo,Bo]),new ar([0,0,zo],[Bo,Bo,Bo])];function sS(t,e,n,a=!0){let l=r._.scale([],t._camera.position,t.worldSize),d=[e,n,1,1];r.aA.transformMat4(d,d,t.pixelMatrixInverse),r.aA.scale(d,d,1/d[3]);let f=r._.sub([],d,l),_=r._.normalize([],f),y=t.globeMatrix,b=[y[12],y[13],y[14]],T=r._.sub([],b,l),D=r._.length(T),S=r._.normalize([],T),P=t.worldSize/(2*Math.PI),R=r._.dot(S,_),k=Math.asin(P/D);if(k<Math.acos(R)){if(!a)return null;let De=[],ke=[];r._.scale(De,_,D/R),r._.normalize(ke,r._.sub(ke,De,T)),r._.normalize(_,r._.add(_,T,r._.scale(_,ke,Math.tan(k)*D)))}let N=[];new ib(l,_).closestPointOnSphere(b,P,N);let V=r._.normalize([],tu(y,0)),Y=r._.normalize([],tu(y,1)),X=r._.normalize([],tu(y,2)),K=r._.dot(V,N),ae=r._.dot(Y,N),oe=r._.dot(X,N),fe=ti(Math.asin(-ae/P)),me=ti(Math.atan2(K,oe));me=t.center.lng+function(De,ke){let He=(ke-De+180)%360-180;return He<-180?He+360:He}(t.center.lng,me);let xe=$s(me),Pe=Zt(Gs(fe),0,1);return new gi(xe,Pe)}class l3{constructor(e,n,a){this.a=r._.sub([],e,a),this.b=r._.sub([],n,a),this.center=a;let l=r._.normalize([],this.a),d=r._.normalize([],this.b);this.angle=Math.acos(r._.dot(l,d))}}function ab(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,l,d,f){let _=Math.sin(d);return a*(Math.sin((1-f)*d)/_)+l*(Math.sin(f*d)/_)}(t.a[e],t.b[e],t.angle,Zt(n,0,1))+t.center[e]}function qs(t){if(t.z<=1)return a3[t.z+2*t.y+t.x];let e=lb(_y(t));return ar.fromPoints(e)}function ja(t,e,n){return r._.scale(t,t,1-n),r._.scaleAndAdd(t,t,e,n)}function aS(t,e){let n=$a(e.zoom);if(n===0)return qs(t);let a=_y(t),l=lb(a),d=$s(a.getWest())*e.worldSize,f=$s(a.getEast())*e.worldSize,_=Gs(a.getNorth())*e.worldSize,y=Gs(a.getSouth())*e.worldSize,b=[d,_,0],T=[f,_,0],D=[d,y,0],S=[f,y,0],P=r.ad.invert([],e.globeMatrix);return r._.transformMat4(b,b,P),r._.transformMat4(T,T,P),r._.transformMat4(D,D,P),r._.transformMat4(S,S,P),l[0]=ja(l[0],D,n),l[1]=ja(l[1],S,n),l[2]=ja(l[2],T,n),l[3]=ja(l[3],b,n),ar.fromPoints(l)}function lS(t,e,n){for(let a of t)r._.transformMat4(a,a,e),r._.scale(a,a,n)}function cS(t,e,n,a){let l=e/t.worldSize,d=t.globeMatrix;if(n.z<=1){let xe=qs(n).getCorners();return lS(xe,d,l),ar.fromPoints(xe)}let f=_y(n,a),_=lb(f,Oi+gy(t._tileCoverLift));lS(_,d,l);let y=Number.MAX_VALUE,b=[-y,-y,-y],T=[y,y,y];if(f.contains(t.center)){for(let De of _)r._.min(T,T,De),r._.max(b,b,De);b[2]=0;let xe=t.point,Pe=[xe.x*l,xe.y*l,0];return r._.min(T,T,Pe),r._.max(b,b,Pe),new ar(T,b)}if(t._tileCoverLift>0){for(let xe of _)r._.min(T,T,xe),r._.max(b,b,xe);return new ar(T,b)}let D=[d[12]*l,d[13]*l,d[14]*l],S=f.getCenter(),P=Zt(t.center.lat,-xr,xr),R=Zt(S.lat,-xr,xr),k=$s(t.center.lng),N=Gs(P),V=k-$s(S.lng),Y=N-Gs(R);V>.5?V-=1:V<-.5&&(V+=1);let X=0;if(Math.abs(V)>Math.abs(Y))X=V>=0?1:3;else{X=Y>=0?0:2;let xe=[d[4]*l,d[5]*l,d[6]*l],Pe=-Math.sin(rn(Y>=0?f.getSouth():f.getNorth()))*Oi;r._.scaleAndAdd(D,D,xe,Pe)}let K=_[X],ae=_[(X+1)%4],oe=new l3(K,ae,D),fe=[ab(oe,0)||K[0],ab(oe,1)||K[1],ab(oe,2)||K[2]],me=$a(t.zoom);if(me>0){let xe=function({x:De,y:ke,z:He},Oe,je,Re,$e){let Ye=1/(1<<He),Ge=De*Ye,at=Ge+Ye,We=ke*Ye,Ke=We+Ye,_t=0,mt=(Ge+at)/2-Re;return mt>.5?_t=-1:mt<-.5&&(_t=1),Ge=((Ge+_t)*Oe-(Re*=Oe))*je+Re,at=((at+_t)*Oe-Re)*je+Re,We=(We*Oe-($e*=Oe))*je+$e,Ke=(Ke*Oe-$e)*je+$e,[[Ge,Ke,0],[at,Ke,0],[at,We,0],[Ge,We,0]]}(n,e,t._pixelsPerMercatorPixel,k,N);for(let De=0;De<_.length;De++)ja(_[De],xe[De],me);let Pe=r._.add([],xe[X],xe[(X+1)%4]);r._.scale(Pe,Pe,.5),ja(fe,Pe,me)}for(let xe of _)r._.min(T,T,xe),r._.max(b,b,xe);return T[2]=Math.min(K[2],ae[2]),r._.min(T,T,fe),r._.max(b,b,fe),new ar(T,b)}function _y({x:t,y:e,z:n},a=!1){let l=1/(1<<n),d=new pn(Vi(t*l),e===(1<<n)-1&&a?-90:Hr((e+1)*l)),f=new pn(Vi((t+1)*l),e===0&&a?90:Hr(e*l));return new Kl(d,f)}function lb(t,e=Oi){let n=rn(t.getNorth()),a=rn(t.getSouth()),l=Math.cos(n),d=Math.cos(a),f=Math.sin(n),_=Math.sin(a),y=t.getWest(),b=t.getEast();return[wd(d,_,y,e),wd(d,_,b,e),wd(l,f,b,e),wd(l,f,y,e)]}function lm(t,e,n,a){let l=1<<n.z,d=(t/Je+n.x)/l;return ku(Hr((e/Je+n.y)/l),Vi(d),a)}function yy({min:t,max:e}){return WF/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let uS=new Float64Array(16);function cm(t){let e=yy(t),n=r.ad.fromScaling(uS,[e,e,e]);return r.ad.translate(n,n,r._.negate([],t.min))}function cb(t){let e=r.ad.fromTranslation(uS,t.min),n=1/yy(t);return r.ad.scale(e,e,[n,n,n])}function ub(t){let e=Je/(2*Math.PI);return t/(2*Math.PI)/e}function hS(t,e){return Je/(512*Math.pow(2,t))*yy(qs(e))}function dS(t,e,n,a,l){let d=ub(n),f=[t,e,-n/(2*Math.PI)],_=r.ad.identity(new Float64Array(16));return r.ad.translate(_,_,f),r.ad.scale(_,_,[d,d,d]),r.ad.rotateX(_,_,rn(-l)),r.ad.rotateY(_,_,rn(-a)),_}function $a(t){return ba(H1,jD,t)}function fS(t,e){let n=ku(e.lat,e.lng),a=function(d){let f=ku(d._center.lat,d._center.lng),_=r._.fromValues(0,1,0),y=r._.cross([],_,f),b=r.ad.fromRotation([],-d.angle,f);y=r._.transformMat4(y,y,b),r.ad.fromRotation(b,-d._pitch,y);let T=r._.normalize([],f);return r._.scale(T,T,gy(d.cameraToCenterDistance/d.pixelsPerMeter)),r._.transformMat4(T,T,b),r._.add([],f,T)}(t),l=r._.subtract([],a,n);return r._.angle(l,n)}function hb(t,e){return fS(t,e)>Math.PI/2*1.01}let pS=rn(85),c3=Math.cos(pS),u3=Math.sin(pS),h3=r.ad.create(),mS=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function gS(t,e,n,a,l,d,f,_,y){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(y*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,T=n.projection.upVectorScale(b,n.center.lat,n.worldSize).metersToTile;for(let D of e)for(let S of D){let P=S.add(_),R=l&&n.elevation?n.elevation.exaggeration()*l.getElevationAt(P.x,P.y,!0):0,k=n.projection.projectTilePoint(P.x,P.y,b);if(R>0){let X=n.projection.upVector(b,P.x,P.y);k.x+=X[0]*T*R,k.y+=X[1]*T*R,k.z+=X[2]*T*R}let N=d?P:d3(k.x,k.y,k.z,a),V=d?t.tilespaceRays.map(X=>p3(X,R)):t.queryGeometry.screenGeometry,Y=r.aA.transformMat4([],[k.x,k.y,k.z,1],a);if(!f&&d?y*=Y[3]/n.cameraToCenterDistance:f&&!d&&(y*=n.cameraToCenterDistance/Y[3]),d){let X=Hr((S.y/Je+b.y)/(1<<b.z));y/=n.projection.pixelsPerMeter(X,1)/Li(1,X)}if(e3(V,N,y))return!0}return!1}function d3(t,e,n,a){let l=r.aA.transformMat4([],[t,e,n,1],a);return new rt(l[0]/l[3],l[1]/l[3])}let _S=r._.fromValues(0,0,0),f3=r._.fromValues(0,0,1);function p3(t,e){let n=r._.create();return _S[2]=e,t.intersectsPlane(_S,f3,n),new rt(n[0],n[1])}class yS extends J1{}function vS(t,{width:e,height:n},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*n*a)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=l,t}function xS(t,e,n){let{width:a,height:l}=e;a===t.width&&l===t.height||(db(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,l)},n,null),t.width=a,t.height=l,t.data=e.data)}function db(t,e,n,a,l,d,f,_){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||n.x>t.width-l.width||n.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,b=e.data,T=d===4&&_;for(let D=0;D<l.height;D++){let S=((n.y+D)*t.width+n.x)*d,P=((a.y+D)*e.width+a.x)*d;if(T)for(let R=0;R<l.width;R++){let k=S+R*d+3,N=P+R*d;b[N+0]=255,b[N+1]=255,b[N+2]=255,b[N+3]=y[k]}else if(f)for(let R=0;R<l.width;R++){let k=S+R*d,N=P+R*d,V=y[k+3],Y=new _n(y[k+0]/255*V,y[k+1]/255*V,y[k+2]/255*V,V).toRenderColor(f).toArray();b[N+0]=Y[0],b[N+1]=Y[1],b[N+2]=Y[2],b[N+3]=Y[3]}else for(let R=0;R<l.width*d;R++)b[P+R]=y[S+R]}return e}Q(yS,"HeatmapBucket",{omit:["layers"]});class Jl{constructor(e,n){vS(this,e,1,n)}resize(e){xS(this,new Jl(e),1)}clone(){return new Jl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,l,d){db(e,n,a,l,d,1,null)}}class _o{constructor(e,n){vS(this,e,4,n)}resize(e){xS(this,new _o(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _o({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,l,d,f,_){db(e,n,a,l,d,4,f,_)}}class bS{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Q(Jl,"AlphaImage"),Q(_o,"RGBAImage");let m3=new Mn({visibility:new Fe(we.layout_heatmap.visibility)});var g3={paint:new Mn({"heatmap-radius":new st(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Fe(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mr(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Fe(we.paint_heatmap["heatmap-opacity"])}),layout:m3};function um(t){let e={},n=t.resolution||256,a=t.clips?t.clips.length:1,l=t.image||new _o({width:n,height:a}),d=(f,_,y)=>{e[t.evaluationKey]=y;let b=t.expression.evaluate(e);b&&(l.data[f+_+0]=Math.floor(255*b.r/b.a),l.data[f+_+1]=Math.floor(255*b.g/b.a),l.data[f+_+2]=Math.floor(255*b.b/b.a),l.data[f+_+3]=Math.floor(255*b.a))};if(t.clips)for(let f=0,_=0;f<a;++f,_+=4*n)for(let y=0,b=0;y<n;y++,b+=4){let T=y/(n-1),{start:D,end:S}=t.clips[f];d(_,b,D*(1-T)+S*T)}else for(let f=0,_=0;f<n;f++,_+=4)d(0,_,f/(n-1));return l}let _3=new Mn({visibility:new Fe(we.layout_hillshade.visibility)});var y3={paint:new Mn({"hillshade-illumination-direction":new Fe(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Fe(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Fe(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Fe(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Fe(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Fe(we.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Fe(we.paint_hillshade["hillshade-emissive-strength"])}),layout:_3};let v3=In([{name:"a_pos",components:2,type:"Int16"}],4),{members:x3}=v3;function hm(t,e,n=2){let a=e&&e.length,l=a?e[0]*n:t.length,d=wS(t,0,l,n,!0),f=[];if(!d||d.next===d.prev)return f;let _,y,b;if(a&&(d=function(T,D,S,P){let R=[];for(let k=0,N=D.length;k<N;k++){let V=wS(T,D[k]*P,k<N-1?D[k+1]*P:T.length,P,!1);V===V.next&&(V.steiner=!0),R.push(C3(V))}R.sort(I3);for(let k=0;k<R.length;k++)S=D3(R[k],S);return S}(t,e,d,n)),t.length>80*n){_=1/0,y=1/0;let T=-1/0,D=-1/0;for(let S=n;S<l;S+=n){let P=t[S],R=t[S+1];P<_&&(_=P),R<y&&(y=R),P>T&&(T=P),R>D&&(D=R)}b=Math.max(T-_,D-y),b=b!==0?32767/b:0}return dm(d,f,n,_,y,b,0),f}function wS(t,e,n,a,l){let d;if(l===function(f,_,y,b){let T=0;for(let D=_,S=y-b;D<y;D+=b)T+=(f[S]-f[D])*(f[D+1]+f[S+1]),S=D;return T}(t,e,n,a)>0)for(let f=e;f<n;f+=a)d=IS(f/a|0,t[f],t[f+1],d);else for(let f=n-a;f>=e;f-=a)d=IS(f/a|0,t[f],t[f+1],d);return d&&vy(d,d.next)&&(pm(d),d=d.next),d}function zu(t,e){if(!t)return t;e||(e=t);let n,a=t;do if(n=!1,a.steiner||!vy(a,a.next)&&Pr(a.prev,a,a.next)!==0)a=a.next;else{if(pm(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function dm(t,e,n,a,l,d,f){if(!t)return;!f&&d&&function(y,b,T,D){let S=y;do S.z===0&&(S.z=fb(S.x,S.y,b,T,D)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==y);S.prevZ.nextZ=null,S.prevZ=null,function(P){let R,k=1;do{let N,V=P;P=null;let Y=null;for(R=0;V;){R++;let X=V,K=0;for(let oe=0;oe<k&&(K++,X=X.nextZ,X);oe++);let ae=k;for(;K>0||ae>0&&X;)K!==0&&(ae===0||!X||V.z<=X.z)?(N=V,V=V.nextZ,K--):(N=X,X=X.nextZ,ae--),Y?Y.nextZ=N:P=N,N.prevZ=Y,Y=N;V=X}Y.nextZ=null,k*=2}while(R>1)}(S)}(t,a,l,d);let _=t;for(;t.prev!==t.next;){let y=t.prev,b=t.next;if(d?w3(t,a,l,d):b3(t))e.push(y.i,t.i,b.i),pm(t),t=b.next,_=b.next;else if((t=b)===_){f?f===1?dm(t=E3(zu(t),e),e,n,a,l,d,2):f===2&&T3(t,e,n,a,l,d):dm(zu(t),e,n,a,l,d,1);break}}}function b3(t){let e=t.prev,n=t,a=t.next;if(Pr(e,n,a)>=0)return!1;let l=e.x,d=n.x,f=a.x,_=e.y,y=n.y,b=a.y,T=l<d?l<f?l:f:d<f?d:f,D=_<y?_<b?_:b:y<b?y:b,S=l>d?l>f?l:f:d>f?d:f,P=_>y?_>b?_:b:y>b?y:b,R=a.next;for(;R!==e;){if(R.x>=T&&R.x<=S&&R.y>=D&&R.y<=P&&Dd(l,_,d,y,f,b,R.x,R.y)&&Pr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function w3(t,e,n,a){let l=t.prev,d=t,f=t.next;if(Pr(l,d,f)>=0)return!1;let _=l.x,y=d.x,b=f.x,T=l.y,D=d.y,S=f.y,P=_<y?_<b?_:b:y<b?y:b,R=T<D?T<S?T:S:D<S?D:S,k=_>y?_>b?_:b:y>b?y:b,N=T>D?T>S?T:S:D>S?D:S,V=fb(P,R,e,n,a),Y=fb(k,N,e,n,a),X=t.prevZ,K=t.nextZ;for(;X&&X.z>=V&&K&&K.z<=Y;){if(X.x>=P&&X.x<=k&&X.y>=R&&X.y<=N&&X!==l&&X!==f&&Dd(_,T,y,D,b,S,X.x,X.y)&&Pr(X.prev,X,X.next)>=0||(X=X.prevZ,K.x>=P&&K.x<=k&&K.y>=R&&K.y<=N&&K!==l&&K!==f&&Dd(_,T,y,D,b,S,K.x,K.y)&&Pr(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;X&&X.z>=V;){if(X.x>=P&&X.x<=k&&X.y>=R&&X.y<=N&&X!==l&&X!==f&&Dd(_,T,y,D,b,S,X.x,X.y)&&Pr(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;K&&K.z<=Y;){if(K.x>=P&&K.x<=k&&K.y>=R&&K.y<=N&&K!==l&&K!==f&&Dd(_,T,y,D,b,S,K.x,K.y)&&Pr(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function E3(t,e){let n=t;do{let a=n.prev,l=n.next.next;!vy(a,l)&&ES(a,n,n.next,l)&&fm(a,l)&&fm(l,a)&&(e.push(a.i,n.i,l.i),pm(n),pm(n.next),n=t=l),n=n.next}while(n!==t);return zu(n)}function T3(t,e,n,a,l,d){let f=t;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&M3(f,_)){let y=TS(f,_);return f=zu(f,f.next),y=zu(y,y.next),dm(f,e,n,a,l,d,0),void dm(y,e,n,a,l,d,0)}_=_.next}f=f.next}while(f!==t)}function I3(t,e){return t.x-e.x}function D3(t,e){let n=function(l,d){let f=d,_=l.x,y=l.y,b,T=-1/0;do{if(y<=f.y&&y>=f.next.y&&f.next.y!==f.y){let k=f.x+(y-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(k<=_&&k>T&&(T=k,b=f.x<f.next.x?f:f.next,k===_))return b}f=f.next}while(f!==d);if(!b)return null;let D=b,S=b.x,P=b.y,R=1/0;f=b;do{if(_>=f.x&&f.x>=S&&_!==f.x&&Dd(y<P?_:T,y,S,P,y<P?T:_,y,f.x,f.y)){let k=Math.abs(y-f.y)/(_-f.x);fm(f,l)&&(k<R||k===R&&(f.x>b.x||f.x===b.x&&S3(b,f)))&&(b=f,R=k)}f=f.next}while(f!==D);return b}(t,e);if(!n)return e;let a=TS(n,t);return zu(a,a.next),zu(n,n.next)}function S3(t,e){return Pr(t.prev,t,e.prev)<0&&Pr(e.next,t,t.next)<0}function fb(t,e,n,a,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function C3(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Dd(t,e,n,a,l,d,f,_){return(l-f)*(e-_)>=(t-f)*(d-_)&&(t-f)*(a-_)>=(n-f)*(e-_)&&(n-f)*(d-_)>=(l-f)*(a-_)}function M3(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){let l=n;do{if(l.i!==n.i&&l.next.i!==n.i&&l.i!==a.i&&l.next.i!==a.i&&ES(l,l.next,n,a))return!0;l=l.next}while(l!==n);return!1}(t,e)&&(fm(t,e)&&fm(e,t)&&function(n,a){let l=n,d=!1,f=(n.x+a.x)/2,_=(n.y+a.y)/2;do l.y>_!=l.next.y>_&&l.next.y!==l.y&&f<(l.next.x-l.x)*(_-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==n);return d}(t,e)&&(Pr(t.prev,t,e.prev)||Pr(t,e.prev,e))||vy(t,e)&&Pr(t.prev,t,t.next)>0&&Pr(e.prev,e,e.next)>0)}function Pr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function vy(t,e){return t.x===e.x&&t.y===e.y}function ES(t,e,n,a){let l=by(Pr(t,e,n)),d=by(Pr(t,e,a)),f=by(Pr(n,a,t)),_=by(Pr(n,a,e));return l!==d&&f!==_||!(l!==0||!xy(t,n,e))||!(d!==0||!xy(t,a,e))||!(f!==0||!xy(n,t,a))||!(_!==0||!xy(n,e,a))}function xy(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function by(t){return t>0?1:t<0?-1:0}function fm(t,e){return Pr(t.prev,t,t.next)<0?Pr(t,e,t.next)>=0&&Pr(t,t.prev,e)>=0:Pr(t,e,t.prev)<0||Pr(t,t.next,e)<0}function TS(t,e){let n=pb(t.i,t.x,t.y),a=pb(e.i,e.x,e.y),l=t.next,d=e.prev;return t.next=e,e.prev=t,n.next=l,l.prev=n,a.next=n,n.prev=a,d.next=a,a.prev=d,a}function IS(t,e,n,a){let l=pb(t,e,n);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function pm(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function pb(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function wy(t,e){let n=t.length;if(n<=1)return[t];let a=[],l,d;for(let f=0;f<n;f++){let _=fi(t[f]);_!==0&&(t[f].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(l&&a.push(l),l=[t[f]]):l.push(t[f]))}if(l&&a.push(l),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(d1(a[f],e,1,a[f].length-1,A3),a[f]=a[f].slice(0,e));return a}function A3(t,e){return e.area-t.area}function mb(t,e,n){let a=n.patternDependencies,l=!1;for(let d of e){let f=d.paint.get(`${t}-pattern`);f.isConstant()||(l=!0);let _=f.constantOr(null);_&&(l=!0,a[_]=!0)}return l}function gb(t,e,n,a,l){let d=l.patternDependencies;for(let f of e){let _=f.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:a},n,{},l.availableImages);y=y&&y.name?y.name:y,d[y]=!0,n.patterns[f.id]=y}}return n}class Ey{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rs,this.indexArray=new Fr,this.indexArray2=new Zl,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new sr,this.segments2=new sr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,a,l){this.hasPattern=mb("fill",this.layers,n);let d=this.layers[0].layout.get("fill-sort-key"),f=[];for(let{feature:_,id:y,index:b,sourceLayerIndex:T}of e){let D=this.layers[0]._featureFilter.needGeometry,S=Va(_,D);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),S,a))continue;let P=d?d.evaluate(S,{},a,n.availableImages):void 0,R={id:y,properties:_.properties,type:_.type,sourceLayerIndex:T,index:b,geometry:D?S.geometry:os(_,a,l),patterns:{},sortKey:P};f.push(R)}d&&f.sort((_,y)=>_.sortKey-y.sortKey);for(let _ of f){let{geometry:y,index:b,sourceLayerIndex:T}=_;if(this.hasPattern){let D=gb("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(_,y,b,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,n,a,l,d){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,a,l,d)}addFeatures(e,n,a,l,d,f){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,x3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,l,d,f=[],_){for(let y of wy(n,500)){let b=0;for(let k of y)b+=k.length;let T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),D=T.vertexLength,S=[],P=[];for(let k of y){if(k.length===0)continue;k!==y[0]&&P.push(S.length/2);let N=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),V=N.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(V+k.length-1,V),S.push(k[0].x),S.push(k[0].y);for(let Y=1;Y<k.length;Y++)this.layoutVertexArray.emplaceBack(k[Y].x,k[Y].y),this.indexArray2.emplaceBack(V+Y-1,V+Y),S.push(k[Y].x),S.push(k[Y].y);N.vertexLength+=k.length,N.primitiveLength+=k.length}let R=hm(S,P);for(let k=0;k<R.length;k+=3)this.indexArray.emplaceBack(D+R[k],D+R[k+1],D+R[k+2]);T.vertexLength+=b,T.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,l,_)}}Q(Ey,"FillBucket",{omit:["layers","patternFeatures"]});let P3=new Mn({"fill-sort-key":new st(we.layout_fill["fill-sort-key"]),visibility:new Fe(we.layout_fill.visibility)});var R3={paint:new Mn({"fill-antialias":new Fe(we.paint_fill["fill-antialias"]),"fill-opacity":new st(we.paint_fill["fill-opacity"]),"fill-color":new st(we.paint_fill["fill-color"]),"fill-outline-color":new st(we.paint_fill["fill-outline-color"]),"fill-translate":new Fe(we.paint_fill["fill-translate"]),"fill-translate-anchor":new Fe(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new st(we.paint_fill["fill-pattern"]),"fill-emissive-strength":new Fe(we.paint_fill["fill-emissive-strength"])}),layout:P3};class _b{constructor(e,n,a,l){if(this.triangleCount=n.length/3,this.min=new rt(0,0),this.max=new rt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[d,f]=[e[0].clone(),e[0].clone()];for(let D=1;D<e.length;++D){let S=e[D];d.x=Math.min(d.x,S.x),d.y=Math.min(d.y,S.y),f.x=Math.max(f.x,S.x),f.y=Math.max(f.y,S.y)}if(l){let D=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/l);a=Math.max(a,D)}if(a===0)return;this.min=d,this.max=f;let _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);let y=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/y)),this.cellsY=Math.max(1,Math.ceil(_.y/y)),this.xScale=1/y,this.yScale=1/y;let b=[];for(let D=0;D<this.triangleCount;D++){let S=e[n[3*D+0]].sub(this.min),P=e[n[3*D+1]].sub(this.min),R=e[n[3*D+2]].sub(this.min),k=Hs(Math.floor(Math.min(S.x,P.x,R.x)),this.xScale,this.cellsX),N=Hs(Math.floor(Math.max(S.x,P.x,R.x)),this.xScale,this.cellsX),V=Hs(Math.floor(Math.min(S.y,P.y,R.y)),this.yScale,this.cellsY),Y=Hs(Math.floor(Math.max(S.y,P.y,R.y)),this.yScale,this.cellsY),X=new rt(0,0),K=new rt(0,0),ae=new rt(0,0),oe=new rt(0,0);for(let fe=V;fe<=Y;++fe){X.y=K.y=fe*y,ae.y=oe.y=(fe+1)*y;for(let me=k;me<=N;++me)X.x=ae.x=me*y,K.x=oe.x=(me+1)*y,(rb(S,P,R,X,K,oe)||rb(S,P,R,X,oe,ae))&&b.push({cellIdx:fe*this.cellsX+me,triIdx:D})}}if(b.length===0)return;b.sort((D,S)=>D.cellIdx-S.cellIdx||D.triIdx-S.triIdx);let T=0;for(;T<b.length;){let D=b[T].cellIdx,S={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===D;)++S.len,this.payload.push(b[T++].triIdx);this.cells[D]=S}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=Hs(e.x-this.min.x,this.xScale,this.cellsX),l=Hs(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[l*this.cellsX+a];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){let _=this.payload[d.start+f],y=Math.floor(_/8),b=1<<_%8;if(!(this.lookup[y]&b)&&(this.lookup[y]|=b,n.push(_),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let l=Hs(e.x-this.min.x,this.xScale,this.cellsX),d=Hs(n.x-this.min.x,this.xScale,this.cellsX),f=Hs(e.y-this.min.y,this.yScale,this.cellsY),_=Hs(n.y-this.min.y,this.yScale,this.cellsY);for(let y=f;y<=_;y++)for(let b=l;b<=d;b++){let T=this.cells[y*this.cellsX+b];if(T)for(let D=0;D<T.len;D++){let S=this.payload[T.start+D],P=Math.floor(S/8),R=1<<S%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,a.push(S),a.length===this.triangleCount))return}}}}function Hs(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}Q(_b,"TriangleGridIndex");class DS{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,l){let d=[];for(let{feature:f,id:_,index:y,sourceLayerIndex:b}of e){let T=this.layers[0]._featureFilter.needGeometry,D=Va(f,T);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),D,a))continue;let S={id:_,properties:f.properties,type:f.type,sourceLayerIndex:b,index:y,geometry:T?D.geometry:os(f,a,l),patterns:{}};d.push(S)}for(let f of d){let{geometry:_,index:y,sourceLayerIndex:b}=f;this.addFeature(f,_,y,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,_,y,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,l,d){}destroy(){}addFeature(e,n,a,l,d,f=[],_){for(let y of wy(n,2)){let b=[],T=[],D=[],S=new rt(1/0,1/0),P=new rt(-1/0,-1/0);for(let N of y)if(N.length!==0){N!==y[0]&&D.push(T.length/2);for(let V=0;V<N.length;V++)T.push(N[V].x),T.push(N[V].y),b.push(N[V]),S.x=Math.min(S.x,N[V].x),S.y=Math.min(S.y,N[V].y),P.x=Math.max(P.x,N[V].x),P.y=Math.max(P.y,N[V].y)}let R=hm(T,D),k=new _b(b,R,8,256);this.footprints.push({vertices:b,indices:R,grid:k,min:S,max:P})}}}Q(DS,"ClipBucket",{omit:["layers"]});let O3=new Mn({"clip-layer-types":new Fe(we.layout_clip["clip-layer-types"])});var L3={paint:new Mn({}),layout:O3};let k3=In([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),F3=In([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),N3=In([{name:"a_centroid_pos",components:2,type:"Uint16"}]),z3=In([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),B3=In([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:U3}=k3;var Ty={},V3=Lh,SS=Sd;function Sd(t,e,n,a,l){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=l,t.readFields(j3,this,e)}function j3(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,l){for(var d=a.readVarint()+a.pos;a.pos<d;){var f=l._keys[a.readVarint()],_=l._values[a.readVarint()];l.properties[f]=_}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function $3(t){for(var e,n,a=0,l=0,d=t.length,f=d-1;l<d;f=l++)a+=((n=t[f]).x-(e=t[l]).x)*(e.y+n.y);return a}Sd.types=["Unknown","Point","LineString","Polygon"],Sd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,l=0,d=0,f=0,_=[];t.pos<n;){if(l<=0){var y=t.readVarint();a=7&y,l=y>>3}if(l--,a===1||a===2)d+=t.readSVarint(),f+=t.readSVarint(),a===1&&(e&&_.push(e),e=[]),e.push(new V3(d,f));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Sd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,l=0,d=0,f=1/0,_=-1/0,y=1/0,b=-1/0;t.pos<e;){if(a<=0){var T=t.readVarint();n=7&T,a=T>>3}if(a--,n===1||n===2)(l+=t.readSVarint())<f&&(f=l),l>_&&(_=l),(d+=t.readSVarint())<y&&(y=d),d>b&&(b=d);else if(n!==7)throw new Error("unknown command "+n)}return[f,y,_,b]},Sd.prototype.toGeoJSON=function(t,e,n){var a,l,d=this.extent*Math.pow(2,n),f=this.extent*t,_=this.extent*e,y=this.loadGeometry(),b=Sd.types[this.type];function T(P){for(var R=0;R<P.length;R++){var k=P[R];P[R]=[360*(k.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(k.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(a=0;a<y.length;a++)D[a]=y[a][0];T(y=D);break;case 2:for(a=0;a<y.length;a++)T(y[a]);break;case 3:for(y=function(P){var R=P.length;if(R<=1)return[P];for(var k,N,V=[],Y=0;Y<R;Y++){var X=$3(P[Y]);X!==0&&(N===void 0&&(N=X<0),N===X<0?(k&&V.push(k),k=[P[Y]]):k.push(P[Y]))}return k&&V.push(k),V}(y),a=0;a<y.length;a++)for(l=0;l<y[a].length;l++)T(y[a][l])}y.length===1?y=y[0]:b="Multi"+b;var S={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(S.id=this.id),S};var G3=SS,CS=MS;function MS(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(q3,this,e),this.length=this._features.length}function q3(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var l=null,d=a.readVarint()+a.pos;a.pos<d;){var f=a.readVarint()>>3;l=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}return l}(n))}MS.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new G3(this._pbf,e,this.extent,this._keys,this._values)};var H3=CS;function W3(t,e,n){if(t===3){var a=new H3(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var yb=Ty.VectorTile=function(t,e){this.layers=t.readFields(W3,{},e)},Iy=Ty.VectorTileFeature=SS;Ty.VectorTileLayer=CS;class Bu extends rt{constructor(e,n,a){super(e,n),this.z=a}}class AS extends Bu{constructor(e,n,a,l){super(e,n,a),this.w=l}}function Dy(t,e,n,a){let l=[],d=a===0?(f,_,y,b,T,D)=>{f.push(new rt(D,y+(D-_)/(b-_)*(T-y)))}:(f,_,y,b,T,D)=>{f.push(new rt(_+(D-y)/(T-y)*(b-_),D))};for(let f of t){let _=[];for(let y of f){if(y.length<=2)continue;let b=[];for(let S=0;S<y.length-1;S++){let P=y[S].x,R=y[S].y,k=y[S+1].x,N=y[S+1].y,V=a===0?P:R,Y=a===0?k:N;V<e?Y>e&&d(b,P,R,k,N,e):V>n?Y<n&&d(b,P,R,k,N,n):b.push(y[S]),Y<e&&V>=e&&d(b,P,R,k,N,e),Y>n&&V<=n&&d(b,P,R,k,N,n)}let T=y[y.length-1],D=a===0?T.x:T.y;D>=e&&D<=n&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),_.push(b))}_.length&&l.push(_)}return l}function PS(t,e,n,a){let l=n==="x"?"y":"x",d=(a-t[n])/(e[n]-t[n]);t[l]=t[l]+(e[l]-t[l])*d,t[n]=a,t.hasOwnProperty("z")&&(t.z=wt(t.z,e.z,d)),t.hasOwnProperty("w")&&(t.w=wt(t.w,e.w,d))}function RS(t,e,n,a){let l=n,d=a;for(let f of["x","y"]){let _=t,y=e;_[f]>=y[f]&&(_=e,y=t),_[f]<l&&y[f]>l&&PS(_,y,f,l),_[f]<d&&y[f]>d&&PS(y,_,f,d)}}function Sy(t,e){return t.x-e.x||t.y-e.y}function OS(t,e){return Sy(t.min,e.min)===0&&Sy(t.max,e.max)===0}function vb(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function xb(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!OS(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function LS(t,e,n){let a=1/Je,l=1/(1<<n.canonical.z),d=(e.x*a+n.canonical.x)*l+n.wrap,f=(e.y*a+n.canonical.y)*l;return{min:new rt((t.x*a+n.canonical.x)*l+n.wrap,(t.y*a+n.canonical.y)*l),max:new rt(d,f)}}function Z3(t,e,n){let a=1<<n.canonical.z,l=((e.x-n.wrap)*a-n.canonical.x)*Je,d=(e.y*a-n.canonical.y)*Je;return{min:new rt(((t.x-n.wrap)*a-n.canonical.x)*Je,(t.y*a-n.canonical.y)*Je),max:new rt(l,d)}}function kS(t,e,n,a,l,d,f){let _=t.indices,y=t.vertices,b=[];for(let T=a;T<a+l;T+=3){let D=e[n[T+0]+d],S=e[n[T+1]+d],P=e[n[T+2]+d],R=Math.min(D.x,S.x,P.x),k=Math.max(D.x,S.x,P.x),N=Math.min(D.y,S.y,P.y),V=Math.max(D.y,S.y,P.y);b.length=0,t.grid.query(new rt(R,N),new rt(k,V),b);for(let Y=0;Y<b.length;Y++){let X=b[Y];if(rb(y[_[3*X+0]],y[_[3*X+1]],y[_[3*X+2]],D,S,P,f))return!0}}return!1}function FS(t,e,n,a){if(!t||!n)return!1;let l=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return FS(n,a,t,e);let d=e.canonical,f=a.canonical,_=Math.pow(2,f.z-d.z);l=t.vertices.map(y=>new rt((y.x+d.x*Je)*_-f.x*Je,(y.y+d.y*Je)*_-f.y*Je))}return kS(n,l,t.indices,0,t.indices.length,0,0)}function NS(t,e,n,a){let l=Math.pow(2,a.z-n.z);return new rt((t+n.x*Je)*l-a.x*Je,(e+n.y*Je)*l-a.y*Je)}function zS(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let a=e.footprint.indices,l=e.footprint.vertices;for(let d=0;d<n.length;d++){let f=n[d];if(Ql([l[a[3*f+0]],l[a[3*f+1]],l[a[3*f+2]]],t))return!0}return!1}class BS{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function US(t,e,n,a){let l=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(a[f])<1e-15){if(n[f]<t[f]||n[f]>e[f])return null}else{let _=1/a[f],y=(t[f]-n[f])*_,b=(e[f]-n[f])*_;if(y>b){let T=y;y=b,b=T}if(y>l&&(l=y),b<d&&(d=b),l>d)return null}return l}function VS(t,e,n,a,l,d,f,_,y,b,T){let D=a-t,S=l-e,P=d-n,R=f-t,k=_-e,N=y-n,V=T[1]*N-T[2]*k,Y=T[2]*R-T[0]*N,X=T[0]*k-T[1]*R,K=D*V+S*Y+P*X;if(Math.abs(K)<1e-15)return null;let ae=1/K,oe=b[0]-t,fe=b[1]-e,me=b[2]-n,xe=(oe*V+fe*Y+me*X)*ae;if(xe<0||xe>1)return null;let Pe=fe*P-me*S,De=me*D-oe*P,ke=oe*S-fe*D,He=(T[0]*Pe+T[1]*De+T[2]*ke)*ae;return He<0||xe+He>1?null:(R*Pe+k*De+N*ke)*ae}function jS(t,e,n){return(t-e)/(n-e)}function $S(t,e,n,a,l,d,f,_,y){let b=1<<n,T=d-a,D=f-l,S=(t+1)/b*T+a,P=(e+0)/b*D+l,R=(e+1)/b*D+l;_[0]=(t+0)/b*T+a,_[1]=P,y[0]=S,y[1]=R}class GS{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(d){let f=Math.ceil(Math.log2(d.dim/8)),_=[],y=Math.ceil(Math.pow(2,f)),b=1/y,T=(P,R,k,N,V)=>{let Y=N?1:0,X=(P+1)*k-Y,K=R*k,ae=(R+1)*k-Y;V[0]=P*k,V[1]=K,V[2]=X,V[3]=ae},D=new BS(y),S=[];for(let P=0;P<y*y;P++){T(P%y,Math.floor(P/y),b,!1,S);let R=ec(S[0],S[1],d),k=ec(S[2],S[1],d),N=ec(S[2],S[3],d),V=ec(S[0],S[3],d);D.minimums.push(Math.min(R,k,N,V)),D.maximums.push(Math.max(R,k,N,V)),D.leaves.push(1)}for(_.push(D),y/=2;y>=1;y/=2){let P=_[_.length-1];D=new BS(y);for(let R=0;R<y*y;R++){T(R%y,Math.floor(R/y),2,!0,S);let k=P.getElevation(S[0],S[1]),N=P.getElevation(S[2],S[1]),V=P.getElevation(S[2],S[3]),Y=P.getElevation(S[0],S[3]),X=P.isLeaf(S[0],S[1]),K=P.isLeaf(S[2],S[1]),ae=P.isLeaf(S[2],S[3]),oe=P.isLeaf(S[0],S[3]),fe=Math.min(k.min,N.min,V.min,Y.min),me=Math.max(k.max,N.max,V.max,Y.max),xe=X&&K&&ae&&oe;D.maximums.push(me),D.minimums.push(fe),D.leaves.push(me-fe<=5&&xe?1:0)}_.push(D)}return _}(this.dem),a=n.length-1,l=n[a];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,l,d,f,_=1){return US([e,n,-100],[a,l,this.maximums[0]*_],d,f)}raycast(e,n,a,l,d,f,_=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,a,l,d,f,_);if(y==null)return null;let b=[],T=[],D=[],S=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:R,t:k,nodex:N,nodey:V,depth:Y}=P.pop();if(this.leaves[R]){$S(N,V,Y,e,n,a,l,D,S);let K=1<<Y,ae=(N+0)/K,oe=(N+1)/K,fe=(V+0)/K,me=(V+1)/K,xe=ec(ae,fe,this.dem)*_,Pe=ec(oe,fe,this.dem)*_,De=ec(oe,me,this.dem)*_,ke=ec(ae,me,this.dem)*_,He=VS(D[0],D[1],xe,S[0],D[1],Pe,S[0],S[1],De,d,f),Oe=VS(S[0],S[1],De,D[0],S[1],ke,D[0],D[1],xe,d,f),je=Math.min(He!==null?He:Number.MAX_VALUE,Oe!==null?Oe:Number.MAX_VALUE);if(je!==Number.MAX_VALUE)return je;{let Re=r._.scaleAndAdd([],d,f,k);if(qS(xe,Pe,ke,De,jS(Re[0],D[0],S[0]),jS(Re[1],D[1],S[1]))>=Re[2])return k}continue}let X=0;for(let K=0;K<this._siblingOffset.length;K++){$S((N<<1)+this._siblingOffset[K][0],(V<<1)+this._siblingOffset[K][1],Y+1,e,n,a,l,D,S),D[2]=-100,S[2]=this.maximums[this.childOffsets[R]+K]*_;let ae=US(D,S,d,f);if(ae!=null){let oe=ae;b[K]=oe;let fe=!1;for(let me=0;me<X&&!fe;me++)oe>=b[T[me]]&&(T.splice(me,0,K),fe=!0);fe||(T[X]=K),X++}}for(let K=0;K<X;K++){let ae=T[K];P.push({idx:this.childOffsets[R]+ae,t:b[ae],nodex:(N<<1)+this._siblingOffset[ae][0],nodey:(V<<1)+this._siblingOffset[ae][1],depth:Y+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,l,d){if(e[l].isLeaf(n,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let f=l-1,_=e[f],y=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){let D=2*n+this._siblingOffset[T][0],S=2*a+this._siblingOffset[T][1],P=_.getElevation(D,S),R=_.isLeaf(D,S),k=this._addNode(P.min,P.max,R);R&&(y|=1<<T),b||(b=k)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*a+this._siblingOffset[T][1],f,b+T)}}function qS(t,e,n,a,l,d){return wt(wt(t,n,d),wt(e,a,d),l)}function ec(t,e,n){let a=n.dim,l=Zt(t*a-.5,0,a-1),d=Zt(e*a-.5,0,a-1),f=Math.floor(l),_=Math.floor(d),y=Math.min(f+1,a-1),b=Math.min(_+1,a-1);return qS(n.get(f,_),n.get(y,_),n.get(f,b),n.get(y,b),l-f,d-_)}let Y3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function X3(t,e,n){return(256*t*256+256*e+n)/10-1e4}function K3(t,e,n){return 256*t+e+n/256-32768}class Cy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,l=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return yr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let d=this.dim=n.height-2,f=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let y=0;y<d;y++)f[this._idx(-1,y)]=f[this._idx(0,y)],f[this._idx(d,y)]=f[this._idx(d-1,y)],f[this._idx(y,-1)]=f[this._idx(y,0)],f[this._idx(y,d)]=f[this._idx(y,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}let _=a==="terrarium"?K3:X3;for(let y=0;y<f.length;++y){let b=4*y;this.floatView[y]=_(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=Gr.now()}_buildQuadTree(){this._tree=new GS(this)}get(e,n,a=!1){a&&(e=Zt(e,-1,this.dim),n=Zt(n,-1,this.dim));let l=this._idx(e,n);return this.floatView[l]}set(e,n,a){let l=this._idx(e,n),d=this.floatView[l];return this.floatView[l]=a,a-d}static getUnpackVector(e){return Y3[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],l=Cy.getUnpackVector(n),d=Math.floor((e+l[3])/l[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new bS({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=n*this.dim,d=n*this.dim+this.dim,f=a*this.dim,_=a*this.dim+this.dim;switch(n){case-1:l=d-1;break;case 1:d=l+1}switch(a){case-1:f=_-1;break;case 1:_=f+1}let y=-n*this.dim,b=-a*this.dim;for(let T=f;T<_;T++)for(let D=l;D<d;D++){let S=4*this._idx(D,T),P=4*this._idx(D+y,T+b);this.pixels[S+0]=e.pixels[P+0],this.pixels[S+1]=e.pixels[P+1],this.pixels[S+2]=e.pixels[P+2],this.pixels[S+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Q(Cy,"DEMData"),Q(GS,"DemMinMaxQuadTree",{omit:["dem"]});class Cd{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let l=a||e.findDEMTileFor(n);if(!l||!l.dem)return;let d=l.dem,f=l.tileID,_=1<<n.canonical.z-f.canonical.z;return new Cd(l,d.dim/Je/_,[(n.canonical.x/_-f.canonical.x)*d.dim,(n.canonical.y/_-f.canonical.y)*d.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new rt(l,d)}getElevationAt(e,n,a,l){let d=e*this._scale+this._offset[0],f=n*this._scale+this._offset[1],_=Math.floor(d),y=Math.floor(f),b=this._dem;return l=!!l,a?wt(wt(b.get(_,y,l),b.get(_,y+1,l),f-y),wt(b.get(_+1,y,l),b.get(_+1,y+1,l),f-y),d-_):b.get(_,y,l)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Li(1,e)*this._dem.stride}}let HS={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},Q3=Iy.types,J3=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],eN=["fill-extrusion-flood-light-ground-radius"],tN=Math.pow(2,13),nN=Math.pow(2,15)-1,WS=new rt(0,1),tc=2147483648;function mm(t,e,n,a,l,d,f,_){t.emplaceBack((e<<1)+f,(n<<1)+d,(Math.floor(a*tN)<<1)+l,Math.round(_))}function My(t,e,n,a,l,d){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+l,d)}function gm(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class ZS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class YS{constructor(){this.centroidXY=new rt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new rt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new rt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new rt(this.max.x-this.min.x,this.max.y-this.min.y)}}class XS{constructor(){this.acc=new rt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let l=!!this.borders;n.x<e.min.x?(e.min.x=n.x,l=!0):n.x>e.max.x&&(e.max.x=n.x,l=!0),n.y<e.min.y?(e.min.y=n.y,l=!0):n.y>e.max.y&&(e.max.y=n.y,l=!0),((n.x===0||n.x===Je)&&n.x===a.x)!=((n.y===0||n.y===Je)&&n.y===a.y)&&this.processBorderOverlap(n,a),l&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,wt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Je!=e.x>Je&&this.addBorderIntersection(1,wt(n.y,e.y,(Je-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,wt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Je!=e.y>Je&&this.addBorderIntersection(3,wt(n.x,e.x,(Je-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new rt(0,0):new rt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function KS(t,e){let n=t.add(e)._unit(),a=Zt(t.x*n.x+t.y*n.y,-1,1);var l,d,f;return l=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(l)))/4*nN*((d=t).x*(f=e).y-d.y*f.x<0?-1:1)}let rN=[t=>t.x<0,t=>t.x>Je,t=>t.y<0,t=>t.y>Je];function iN(t,e,n,a){let l=[4];if(a===0)return l;n._mult(a);let d=t.sub(n),f=e.sub(n),_=[t,e,d,f];for(let y=0;y<4;y++)for(let b of _)if(rN[y](b)){l.push(y);break}return l}class QS{constructor(e){this.vertexArray=new I1,this.indexArray=new Fr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut},n=>eN.includes(n)),this._segments=new sr,this.hiddenByLandmarkVertexArray=new B1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new sr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,l=!1){let d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length),y;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{let b=e[0],T=e[1];y=KS(b.sub(e[d-1])._perp()._unit(),T.sub(b)._perp()._unit())}for(let b=0;b<d;b++){let T=b===d-1?0:b+1,D=e[b],S=e[T],P=e[T===d-1?0:T+1],R=S.sub(D)._perp()._unit(),k=KS(R,P.sub(S)._perp()._unit()),N=y,V=k;if(bb(D,S,n)||l&&tC(D,n)&&tC(S,n)){y=k;continue}let Y=_.vertexLength;My(this.vertexArray,D,S,1,1,N),My(this.vertexArray,D,S,1,0,N),My(this.vertexArray,D,S,0,1,V),My(this.vertexArray,D,S,0,0,V),_.vertexLength+=4;let X=iN(D,S,R,a);for(let K of X)this._segmentToGroundQuads[f].push({id:Y,region:K}),this._segmentToRegionTriCounts[f][K]+=2,_.primitiveLength+=2;y=k}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((l,d)=>l.region-d.region);for(let a=0;a<n;a++){let l=this._segmentToGroundQuads[a],d=e[a],f=this._segmentToRegionTriCounts[a];f.reduce((y,b)=>y+b,0);let _=0;for(let y=0;y<=4;y++){let b=f[y];if(b!==0){let T=this.regionSegments[y];T||(T=this.regionSegments[y]=new sr);let D={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:b};T.get().push(D)}_+=b}for(let y=0;y<l.length;y++){let b=l[y].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,l,d,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,l,d,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,F3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,l,d,f){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,l,d,f)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&tc?1:0;for(let l=e.groundVertexArrayOffset;l<n;++l)this.hiddenByLandmarkVertexArray.emplace(l,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,z3.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class Ay{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Fr,this.footprintVertices=new rs,this.footprintSegments=[],this.layoutVertexArray=new Gl,this.centroidVertexArray=new ND,this.indexArray=new Fr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut},n=>J3.includes(n)),this.segments=new sr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new QS(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,l){this.features=[],this.hasPattern=mb("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=hy(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:d,id:f,index:_,sourceLayerIndex:y}of e){let b=this.layers[0]._featureFilter.needGeometry,T=Va(d,b);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),T,a))continue;let D={id:f,sourceLayerIndex:y,index:_,geometry:b?T.geometry:os(d,a,l),properties:d.properties,type:d.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(gb("fill-extrusion",this.layers,D,this.zoom,n)):this.addFeature(D,D.geometry,_,a,{},n.availableImages,l,n.brightness),n.featureIndex.insert(d,D.geometry,_,y,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,l,d,f){for(let _ of this.features){let{geometry:y}=_;this.addFeature(_,y,_.index,n,a,l,d,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,l,d){let f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;let _=f?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,_,a,l,d),this.groundEffect.update(e,n,_,a,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,U3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,B3.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,N3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,l,d,f,_,y){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new rt(0,0),new rt(Je,Je)],D=_.projection,S=D.name==="globe",P=Q3[e.type]==="Polygon",R=new XS;R.centroidDataIndex=this.centroidData.length;let k=new YS,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);k.height=V,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new sy);let Y=wy(n,500);for(let me=Y.length-1;me>=0;me--){let xe=Y[me];(xe.length===0||(X=xe[0]).every(Pe=>Pe.x<=0)||X.every(Pe=>Pe.x>=Je)||X.every(Pe=>Pe.y<=0)||X.every(Pe=>Pe.y>=Je))&&Y.splice(me,1)}var X;let K;if(S)K=oC(Y,T,l);else{K=[];for(let me of Y)K.push({polygon:me,bounds:T})}let ae=P?this.edgeRadius:0,oe=ae>0&&this.zoom<17,fe=(me,xe)=>{if(me.length===0)return!1;let Pe=me[me.length-1];return xe.x===Pe.x&&xe.y===Pe.y};for(let{polygon:me,bounds:xe}of K){let Pe=0,De=0;for(let je of me)P&&!je[0].equals(je[je.length-1])&&je.push(je[0]),De+=P?je.length-1:je.length;let ke=this.segments.prepareSegment((P?5:4)*De,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);let He={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Oe=new ZS;if(Oe.vertexOffset=this.footprintVertices.length,Oe.indexOffset=3*this.footprintIndices.length,Oe.ringIndices=[],P){let je=[],Re=[];Pe=ke.vertexLength;for(let Ye=0;Ye<me.length;Ye++){let Ge=me[Ye];Ge.length&&Ye!==0&&Re.push(je.length/2);let at=[],We,Ke;We=Ge[1].sub(Ge[0])._perp()._unit(),Oe.ringIndices.push(Ge.length-1);for(let _t=1;_t<Ge.length;_t++){let mt=Ge[_t],ft=Ge[_t===Ge.length-1?1:_t+1],Xe=mt.clone();if(ae){Ke=ft.sub(mt)._perp()._unit();let yt=We.add(Ke)._unit(),Ut=ae*Math.min(4,1/(We.x*yt.x+We.y*yt.y));Xe.x+=Ut*yt.x,Xe.y+=Ut*yt.y,Xe.x=Math.round(Xe.x),Xe.y=Math.round(Xe.y),We=Ke}!N||ae!==0&&!oe||fe(at,Xe)||at.push(Xe),mm(this.layoutVertexArray,Xe.x,Xe.y,0,0,1,1,0),ke.vertexLength++,this.footprintVertices.emplaceBack(mt.x,mt.y),je.push(mt.x,mt.y),S&&gm(this.layoutVertexExtArray,D.projectTilePoint(Xe.x,Xe.y,l),D.upVector(l,Xe.x,Xe.y))}N&&(ae===0||oe)&&(at.length!==0&&fe(at,at[0])&&at.pop(),this.groundEffect.addData(at,xe,b))}let $e=hm(je,Re);for(let Ye=0;Ye<$e.length;Ye+=3)this.footprintIndices.emplaceBack(Oe.vertexOffset+$e[Ye+0],Oe.vertexOffset+$e[Ye+1],Oe.vertexOffset+$e[Ye+2]),this.indexArray.emplaceBack(Pe+$e[Ye],Pe+$e[Ye+2],Pe+$e[Ye+1]),ke.primitiveLength++;Oe.indexCount+=$e.length,Oe.vertexCount+=this.footprintVertices.length-Oe.vertexOffset}for(let je=0;je<me.length;je++){let Re=me[je];R.startRing(k,Re[0]);let $e=Re.length>4&&nC(Re[Re.length-2],Re[0],Re[1]),Ye=ae?oN(Re[Re.length-2],Re[0],Re[1],ae):0,Ge=[],at,We,Ke;We=Re[1].sub(Re[0])._perp()._unit();let _t=!0;for(let mt=1,ft=0;mt<Re.length;mt++){let Xe=Re[mt-1],yt=Re[mt],Ut=Re[mt===Re.length-1?1:mt+1];if(R.appendEdge(k,yt,Xe),bb(yt,Xe,xe)){ae&&(We=Ut.sub(yt)._perp()._unit(),_t=!_t);continue}let Dt=yt.sub(Xe)._perp(),Ht=Dt.x/(Math.abs(Dt.x)+Math.abs(Dt.y)),Vt=Dt.y>0?1:0,Jt=Xe.dist(yt);if(ft+Jt>32768&&(ft=0),ae){Ke=Ut.sub(yt)._perp()._unit();let xn=eC(Xe,yt,Ut,JS(We,Ke),ae);isNaN(xn)&&(xn=0);let an=yt.sub(Xe)._unit();Xe=Xe.add(an.mult(Ye))._round(),yt=yt.add(an.mult(-xn))._round(),Ye=xn,We=Ke,N&&this.zoom>=17&&(fe(Ge,Xe)||Ge.push(Xe),fe(Ge,yt)||Ge.push(yt))}let Tt=ke.vertexLength,Nn=Re.length>4&&nC(Xe,yt,Ut),Fn=rC(ft,$e,_t);if(mm(this.layoutVertexArray,Xe.x,Xe.y,Ht,Vt,0,0,Fn),mm(this.layoutVertexArray,Xe.x,Xe.y,Ht,Vt,0,1,Fn),ft+=Jt,Fn=rC(ft,Nn,!_t),$e=Nn,mm(this.layoutVertexArray,yt.x,yt.y,Ht,Vt,0,0,Fn),mm(this.layoutVertexArray,yt.x,yt.y,Ht,Vt,0,1,Fn),ke.vertexLength+=4,this.indexArray.emplaceBack(Tt+0,Tt+1,Tt+2),this.indexArray.emplaceBack(Tt+1,Tt+3,Tt+2),ke.primitiveLength+=2,ae){let xn=Pe+(mt===1?Re.length-2:mt-2),an=mt===1?Pe:xn+1;if(this.indexArray.emplaceBack(Tt+1,xn,Tt+3),this.indexArray.emplaceBack(xn,an,Tt+3),ke.primitiveLength+=2,at===void 0&&(at=Tt),!bb(Ut,Re[mt],xe)){let bn=mt===Re.length-1?at:ke.vertexLength;this.indexArray.emplaceBack(Tt+2,Tt+3,bn),this.indexArray.emplaceBack(Tt+3,bn+1,bn),this.indexArray.emplaceBack(Tt+3,an,bn+1),ke.primitiveLength+=3}_t=!_t}if(S){let xn=this.layoutVertexExtArray,an=D.projectTilePoint(Xe.x,Xe.y,l),bn=D.projectTilePoint(yt.x,yt.y,l),Hn=D.upVector(l,Xe.x,Xe.y),Vn=D.upVector(l,yt.x,yt.y);gm(xn,an,Hn),gm(xn,an,Hn),gm(xn,bn,Vn),gm(xn,bn,Vn)}}P&&(Pe+=Re.length-1),N&&ae&&this.zoom>=17&&(Ge.length!==0&&fe(Ge,Ge[0])&&Ge.pop(),this.groundEffect.addData(Ge,xe,b,ae>0))}this.footprintSegments.push(Oe),He.triangleCount=this.indexArray.length-He.triangleArrayOffset,this.polygonSegments.push(He),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=R.borders?WS:this.encodeCentroid(R,k),this.centroidData.push(k),R.borders){this.featuresOnBorder.push(R);let me=this.featuresOnBorder.length-1;for(let xe=0;xe<R.borders.length;xe++)R.borders[xe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[xe].push(me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,l,y),this.groundEffect.addPaintPropertiesData(e,a,d,f,l,y),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let y=this.centroidData[_],b=+(y.min.y+y.max.y>Je),T=2*b+(+(y.min.x+y.max.x>Je)^b);for(let D=0;D<y.polygonSegLen;D++){let S=y.polygonSegIdx+D;e.push({centroidIdx:_,subtile:T,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let n=new Fr;e.sort((_,y)=>_.triangleSegmentIdx===y.triangleSegmentIdx?_.subtile-y.subtile:_.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,l=0,d=0;for(let _ of e){if(_.triangleSegmentIdx!==a)break;d++}let f=e.length;for(;l!==e.length;){a=e[l].triangleSegmentIdx;let _=0,y=l,b=l;for(let T=y;T<d&&e[T].subtile===_;T++)b++;for(;y!==d;){let T=e[y];_=T.subtile;let D=this.centroidData[T.centroidIdx].min.clone(),S=this.centroidData[T.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<b;R++){let k=e[R],N=this.polygonSegments[k.polygonSegmentIdx],V=this.centroidData[k.centroidIdx].min,Y=this.centroidData[k.centroidIdx].max,X=this.indexArray.uint16;for(let K=N.triangleArrayOffset;K<N.triangleArrayOffset+N.triangleCount;K++)n.emplaceBack(X[3*K],X[3*K+1],X[3*K+2]);P.primitiveLength+=N.triangleCount,D.x=Math.min(D.x,V.x),D.y=Math.min(D.y,V.y),S.x=Math.max(S.x,Y.x),S.y=Math.max(S.y,Y.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:D,max:S}),y=b;for(let R=y;R<d&&e[R].subtile===e[y].subtile;R++)b++}l=d;for(let T=l;T<f&&e[T].triangleSegmentIdx===e[l].triangleSegmentIdx;T++)d++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let l=0,d=0,f=1<<e.canonical.z;if(n){let k=n.getMinMaxForTile(e);k&&(l=k.min,d=k.max)}d+=this.maxHeight;let _=e.toUnwrapped(),y,b=[_.canonical.x/f+_.wrap,_.canonical.y/f],T=[(_.canonical.x+1)/f+_.wrap,(_.canonical.y+1)/f],D=new sr,S=(k,N,V)=>[k[0]*(1-V[0])+N[0]*V[0],k[1]*(1-V[1])+N[1]*V[1]],P=[],R=[];for(let k of this.triangleSubSegments){P[0]=k.min.x/Je,P[1]=k.min.y/Je,R[0]=k.max.x/Je,R[1]=k.max.y/Je;let N=S(b,T,P),V=S(b,T,R);if(new ar([N[0],N[1],l],[V[0],V[1],d]).intersectsPrecise(a)===0){y&&(D.segments.push(y),y=void 0);continue}let Y=k.segment;y&&y.vertexOffset!==Y.vertexOffset&&(D.segments.push(y),y=void 0),y?(y.vertexLength+=Y.vertexLength,y.primitiveLength+=Y.primitiveLength):y={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&D.segments.push(y),D}encodeCentroid(e,n){let a=e.centroid(),l=n.span(),d=Math.min(7,Math.round(l.x*this.tileToMeter/10)),f=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new rt(Zt(a.x,1,Je-1)<<3|d,Zt(a.y,1,Je-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new rt(0,0);let n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){let l=n[0][0]!==a?0:1;return new rt(6|(n[0][0]!==a?0:65528),(n[l][0]+n[l][1])/2<<3|6)}{let l=n[2][0]!==a?2:3;return new rt((n[l][0]+n[l][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=tc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,l=e.flags&tc?WS:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==l.y||d!==l.x){for(let f=n;f<a;++f)this.centroidVertexArray.emplace(f,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let l=n.getReplacementRegionsForTile(e.toUnwrapped());if(xb(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let f of this.centroidData)f.flags&=2147483647;let d=[];for(let f of this.activeReplacements){if(f.order<a)continue;let _=Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&tc||f.min.x>y.max.x||y.min.x>f.max.x||f.min.y>y.max.y||y.min.y>f.max.y))for(let b=0;b<y.footprintSegLen;b++){let T=this.footprintSegments[y.footprintSegIdx+b];if(d.length=0,sN(this.footprintVertices,T.vertexOffset,T.vertexCount,f.footprintTileId.canonical,e.canonical,d),kS(f.footprint,d,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-_)){y.flags|=tc;break}}}for(let f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let l=!1;for(let d=0;d<a.footprintSegLen;d++){let f=this.footprintSegments[a.footprintSegIdx+d],_=0;for(let y of f.ringIndices){for(let b=_,T=y+_-1;b<y+_;T=b++){let D=this.footprintVertices.int16[2*(b+f.vertexOffset)+0],S=this.footprintVertices.int16[2*(b+f.vertexOffset)+1],P=this.footprintVertices.int16[2*(T+f.vertexOffset)+1];S>n!=P>n&&e<(this.footprintVertices.int16[2*(T+f.vertexOffset)+0]-D)*(n-S)/(P-S)+D&&(l=!l)}_=y}}return l}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,l=!0,d=4*(e+Je)*Je+(n+Je);if(this.partLookup.hasOwnProperty(d)){let f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&tc)}:void 0}for(let f of this.centroidData)e>f.max.x||f.min.x>e||n>f.max.y||f.min.y>n||this.footprintContainsPoint(e,n,f)&&f&&f.height>a&&(a=f.height,this.partLookup[d]=f,l=!!(f.flags&tc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:l};this.partLookup[d]=void 0}}function JS(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function oN(t,e,n,a){let l=e.sub(t)._perp()._unit(),d=n.sub(e)._perp()._unit();return eC(t,e,n,JS(l,d),a)}function eC(t,e,n,a,l){let d=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,l*d/a)}function bb(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function tC(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function nC(t,e,n){if(t.x<0||t.x>=Je||e.x<0||e.x>=Je||n.x<0||n.x>=Je)return!1;let a=n.sub(e),l=a.perp(),d=t.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&l.x*d.x+l.y*d.y<0}function rC(t,e,n){let a=e?2|t:-3&t;return n?1|a:-2&a}function iC(){let t=Math.PI/32,e=Math.tan(t),n=Ed;return n*Math.sqrt(1+2*e*e)-n}function oC(t,e,n){let a=1<<n.z,l=Vi(n.x/a),d=Vi((n.x+1)/a),f=Hr(n.y/a),_=Hr((n.y+1)/a);return function(y,b,T,D,S=0,P){let R=[];if(!y.length||!T||!D)return R;let k=(oe,fe)=>{for(let me of oe)R.push({polygon:me,bounds:fe})},N=Math.ceil(Math.log2(T)),V=Math.ceil(Math.log2(D)),Y=N-V,X=[];for(let oe=0;oe<Math.abs(Y);oe++)X.push(Y>0?0:1);for(let oe=0;oe<Math.min(N,V);oe++)X.push(0),X.push(1);let K=y;if(K=Dy(K,b[0].y-S,b[1].y+S,1),K=Dy(K,b[0].x-S,b[1].x+S,0),!K.length)return R;let ae=[];for(X.length?ae.push({polygons:K,bounds:b,depth:0}):k(K,b);ae.length;){let oe=ae.pop(),fe=oe.depth,me=X[fe],xe=oe.bounds[0],Pe=oe.bounds[1],De=me===0?xe.x:xe.y,ke=me===0?Pe.x:Pe.y,He=P?P(me,De,ke):.5*(De+ke),Oe=Dy(oe.polygons,De-S,He+S,me),je=Dy(oe.polygons,He-S,ke+S,me);if(Oe.length){let Re=[xe,new rt(me===0?He:Pe.x,me===1?He:Pe.y)];X.length>fe+1?ae.push({polygons:Oe,bounds:Re,depth:fe+1}):k(Oe,Re)}if(je.length){let Re=[new rt(me===0?He:xe.x,me===1?He:xe.y),Pe];X.length>fe+1?ae.push({polygons:je,bounds:Re,depth:fe+1}):k(je,Re)}}return R}(t,e,Math.ceil((d-l)/11.25),Math.ceil((f-_)/11.25),1,(y,b,T)=>{if(y===0)return .5*(b+T);{let D=Hr((n.y+b/Je)/a);return(Gs(.5*(Hr((n.y+T/Je)/a)+D))*a-n.y)*Je}})}function sN(t,e,n,a,l,d){let f=Math.pow(2,a.z-l.z);for(let _=0;_<n;_++){let y=t.int16[2*(_+e)+0],b=t.int16[2*(_+e)+1];y=(y+l.x*Je)*f-a.x*Je,b=(b+l.y*Je)*f-a.y*Je,d.push(new rt(y,b))}}Q(Ay,"FillExtrusionBucket",{omit:["layers","features"]}),Q(YS,"PartData"),Q(ZS,"FootprintSegment"),Q(XS,"BorderCentroidData"),Q(QS,"GroundEffect");let aN=new Mn({visibility:new Fe(we["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Fe(we["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var lN={paint:new Mn({"fill-extrusion-opacity":new Fe(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Fe(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Fe(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new st(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Fe(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Fe(we["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Fe(we["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Fe(we["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Fe(we["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Fe(we["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Fe(we["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Fe(we["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new st(we["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new st(we["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Fe(we["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Fe(we["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Fe(we["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Fe(we["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Fe(we["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:aN};function _m(t,e){return t.x*e.x+t.y*e.y}function sC(t,e){if(t.length===1){let n=0,a=e[n++],l;for(;!l||a.equals(l);)if(l=e[n++],!l)return 1/0;for(;n<e.length;n++){let d=e[n],f=t[0],_=l.sub(a),y=d.sub(a),b=f.sub(a),T=_m(_,_),D=_m(_,y),S=_m(y,y),P=_m(b,_),R=_m(b,y),k=T*S-D*D,N=(S*P-D*R)/k,V=(T*R-D*P)/k,Y=a.z*(1-N-V)+l.z*N+d.z*V;if(isFinite(Y))return Y}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function aC(t,e,n,a,l,d,f,_){let y=f*l.getElevationAt(t,e,!0,!0),b=d[0]!==0,T=b?d[1]===0?f*(d[0]/7-450):f*function(D,S,P){let R=Math.floor(S[0]/8),k=Math.floor(S[1]/8),N=10*(S[0]-8*R),V=10*(S[1]-8*k),Y=D.getElevationAt(R,k,!0,!0),X=D.getMeterToDEM(P),K=Math.floor(.5*(N*X-1)),ae=Math.floor(.5*(V*X-1)),oe=D.tileCoordToPixel(R,k),fe=2*K+1,me=2*ae+1,xe=function(je,Re,$e,Ye,Ge){return[je.getElevationAtPixel(Re,$e,!0),je.getElevationAtPixel(Re+Ge,$e,!0),je.getElevationAtPixel(Re,$e+Ge,!0),je.getElevationAtPixel(Re+Ye,$e+Ge,!0)]}(D,oe.x-K,oe.y-ae,fe,me),Pe=Math.abs(xe[0]-xe[1]),De=Math.abs(xe[2]-xe[3]),ke=Math.abs(xe[0]-xe[2])+Math.abs(xe[1]-xe[3]),He=Math.min(.25,.5*X*(Pe+De)/fe),Oe=Math.min(.25,.5*X*ke/me);return Y+Math.max(He*N,Oe*V)}(l,d,_):y;return{base:y+(n===0)?-1:n,top:b?Math.max(T+a,y+n+2):y+a}}let cN=In([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:uN}=cN,hN=In([{name:"a_packed",components:4,type:"Float32"}]),{members:dN}=hN,fN=In([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:pN}=fN,mN=In([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gN=In([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_N=In([{name:"a_projected_pos",components:4,type:"Float32"}],4);In([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let wb=In([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),lC=In([{name:"a_z_offset",components:1,type:"Float32"}],4),yN=In([{name:"a_texb",components:2,type:"Uint16"}]),vN=In([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),xN=In([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let cC=In([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bN=In([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);In([{name:"triangle",components:3,type:"Uint16"}]),In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),In([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),In([{type:"Float32",name:"offsetX"}]),In([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class uC{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Jl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=op(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let l=[],d=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,_=!0;l.push({left:d,right:f,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){_=!_;let T=e[b];d=y*a,y+=T,f=y*a,l.push({left:d,right:f,isDash:_,zeroLength:T===0})}return l}addRoundDash(e,n,a){let l=n/2;for(let d=-a;d<=a;d++){let f=this.width*(this.nextRow+a+d),_=0,y=e[_];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++_]);let T=Math.abs(b-y.left),D=Math.abs(b-y.right),S=Math.min(T,D),P,R=d/a*(l+1);if(y.isDash){let k=l-Math.abs(R);P=Math.sqrt(S*S+k*k)}else P=l-Math.sqrt(S*S+R*R);this.image.data[f+b]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let b=e[y],T=e[y+1];b.zeroLength?e.splice(y,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(y,1))}let a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);let d=this.width*this.nextRow,f=0,_=e[f];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++f]);let b=Math.abs(y-_.left),T=Math.abs(y-_.right),D=Math.min(b,T);this.image.data[d+y]=Math.max(0,Math.min(255,(_.isDash?D:-D)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let l=n==="round",d=l?7:0,f=2*d+1;if(this.nextRow+f>this.height)return yr("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let T=0;T<e.length;T++)e[T]<0&&(yr("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),_+=e[T];if(_!==0){let T=this.width/_,D=this.getDashRanges(e,this.width,T);l?this.addRoundDash(D,T,d):this.addRegularDash(D,n==="square"?.5*T:0)}let y=this.nextRow+d;this.nextRow+=f;let b={tl:[y,d],br:[_,0]};return this.positions[a]=b,b}}Q(uC,"LineAtlas");let wN=Iy.types,EN=Math.cos(Math.PI/180*37.5),TN=Math.cos(Math.PI/180*5);class Py{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new D1,this.layoutVertexArray2=new ql,this.patternVertexArray=new Hl,this.indexArray=new Fr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new sr,this.maxLineLength=0,this.zOffsetVertexArray=new Ru,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Je/64}updateFootprints(e,n){}populate(e,n,a,l){this.hasPattern=mb("line",this.layers,n);let d=this.layers[0].layout.get("line-sort-key"),f=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!f.isConstant()||!!f.constantOr(0);let _=[];for(let{feature:D,id:S,index:P,sourceLayerIndex:R}of e){let k=this.layers[0]._featureFilter.needGeometry,N=Va(D,k);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),N,a))continue;let V=d?d.evaluate(N,{},a):void 0,Y={id:S,properties:D.properties,type:D.type,sourceLayerIndex:R,index:P,geometry:k?N.geometry:os(D,a,l),patterns:{},sortKey:V};_.push(Y)}d&&_.sort((D,S)=>D.sortKey-S.sortKey);let{lineAtlas:y,featureIndex:b}=n,T=this.addConstantDashes(y);for(let D of _){let{geometry:S,index:P,sourceLayerIndex:R}=D;if(T&&this.addFeatureDashes(D,y),this.hasPattern){let k=gb("line",this.layers,D,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(D,S,P,a,y.positions,n.availableImages,n.brightness);b.insert(e[P].feature,S,P,R,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let l=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(l.kind!=="constant"||d.kind!=="constant")n=!0;else{let f=d.value,_=l.value;if(!_)continue;e.addDash(_,f)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let l of this.layers){let d=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let _,y;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:a},e);y=f.kind==="constant"?f.value:f.evaluate({zoom:a},e),n.addDash(_,y),e.patterns[l.id]=n.getKey(_,y)}}update(e,n,a,l,d){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,a,l,d)}addFeatures(e,n,a,l,d,f){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,dN)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,pN)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,lC.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uN),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,l,d,f,_){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),D=y.get("line-miter-limit"),S=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,l,b,T,D,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,l,_)}addLine(e,n,a,l,d,f,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},b=this.layers[0].layout,T=l==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let D=wN[n.type]==="Polygon",S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let P=0;for(;P<S-1&&e[P].equals(e[P+1]);)P++;if(S<(D?3:2))return;l==="bevel"&&(f=1.05);let R=this.overscaling<=16?15*Je/(512*this.overscaling):0,k=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray),N,V,Y,X,K,ae;this.e1=this.e2=-1,D&&(N=e[S-2],K=e[P].sub(N)._unit()._perp());for(let oe=P;oe<S;oe++){if(Y=oe===S-1?D?e[P+1]:void 0:e[oe+1],Y&&e[oe].equals(Y))continue;if(K&&(X=K),N&&(V=N),N=e[oe],this.hasZOffset){let Re=b.get("line-z-offset").value;if(Re.kind==="constant")ae=Re.value;else{if(this.lineClips){let $e=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=($e*this.lineClips.start+this.distance+(V?V.dist(N):0))/$e}else yr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;ae=Re.evaluate(y,n)}ae=ae||0}K=Y?Y.sub(N)._unit()._perp():X,X=X||K;let fe=V&&Y,me=fe?l:D||T?"butt":d,xe=X.x*K.x+X.y*K.y;if(T){let Re=function($e){if($e.patternJoinNone){let Ye=$e.segmentPoints.length/2,Ge=$e.lineSoFar-$e.segmentStart;for(let at=0;at<Ye;++at){let We=$e.segmentPoints[2*at+1],Ke=Math.round($e.segmentPoints[2*at])+.5+.25*We;$e.patternVertexArray.emplaceBack(Ke,Ge,$e.segmentStart),$e.patternVertexArray.emplaceBack(Ke,Ge,$e.segmentStart)}$e.segmentPoints.length=0}$e.e1=$e.e2=-1};if(fe&&xe<TN){this.updateDistance(V,N),this.addCurrentVertex(N,X,1,1,k,ae),Re(this),this.addCurrentVertex(N,K,-1,-1,k,ae);continue}if(V){if(!Y){this.updateDistance(V,N),this.addCurrentVertex(N,X,1,1,k,ae),Re(this);continue}me="miter"}}let Pe=X.add(K);Pe.x===0&&Pe.y===0||Pe._unit();let De=Pe.x*K.x+Pe.y*K.y,ke=De!==0?1/De:1/0,He=2*Math.sqrt(2-2*De),Oe=De<EN&&V&&Y,je=X.x*K.y-X.y*K.x>0;if(Oe&&oe>P){let Re=N.dist(V);if(Re>2*R){let $e=N.sub(N.sub(V)._mult(R/Re)._round());this.updateDistance(V,$e),this.addCurrentVertex($e,X,0,0,k,ae),V=$e}}if(fe&&me==="round"&&(ke<_?me="miter":ke<=2&&(me="fakeround")),me==="miter"&&ke>f&&(me="bevel"),me==="bevel"&&(ke>2&&(me="flipbevel"),ke<f&&(me="miter")),V&&this.updateDistance(V,N),me==="miter")Pe._mult(ke),this.addCurrentVertex(N,Pe,0,0,k,ae);else if(me==="flipbevel"){if(ke>100)Pe=K.mult(-1);else{let Re=ke*X.add(K).mag()/X.sub(K).mag();Pe._perp()._mult(Re*(je?-1:1))}this.addCurrentVertex(N,Pe,0,0,k,ae),this.addCurrentVertex(N,Pe.mult(-1),0,0,k,ae)}else if(me==="bevel"||me==="fakeround"){let Re=-Math.sqrt(ke*ke-1),$e=je?Re:0,Ye=je?0:Re;if(V&&this.addCurrentVertex(N,X,$e,Ye,k,ae),me==="fakeround"){let Ge=Math.round(180*He/Math.PI/20);for(let at=1;at<Ge;at++){let We=at/Ge;if(We!==.5){let _t=We-.5;We+=We*_t*(We-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*_t*_t+(.848013+xe*(.215638*xe-1.06021)))}let Ke=K.sub(X)._mult(We)._add(X)._unit()._mult(je?-1:1);this.addHalfVertex(N,Ke.x,Ke.y,!1,je,0,k,ae)}}Y&&this.addCurrentVertex(N,K,-$e,-Ye,k,ae)}else me==="butt"?this.addCurrentVertex(N,Pe,0,0,k,ae):me==="square"?(V||this.addCurrentVertex(N,Pe,-1,-1,k,ae),this.addCurrentVertex(N,Pe,0,0,k,ae),V&&this.addCurrentVertex(N,Pe,1,1,k,ae)):me==="round"&&(V&&(this.addCurrentVertex(N,X,0,0,k,ae),this.addCurrentVertex(N,X,1,1,k,ae,!0)),Y&&(this.addCurrentVertex(N,K,-1,-1,k,ae,!0),this.addCurrentVertex(N,K,0,0,k,ae)));if(Oe&&oe<S-1){let Re=N.dist(Y);if(Re>2*R){let $e=N.add(Y.sub(N)._mult(R/Re)._round());this.updateDistance(N,$e),this.addCurrentVertex($e,K,0,0,k,ae),N=$e}}}}addVerticesTo(e,n,a,l,d,f,_,y,b,T){let D=(n.w-e.w)/this.tessellationStep|0;if(D>1){this.lineSoFar=e.w;let S=(n.x-e.x)/D,P=(n.y-e.y)/D,R=(n.z-e.z)/D,k=(n.w-e.w)/D;for(let N=1;N<D;++N)e.x+=S,e.y+=P,e.z+=R,this.lineSoFar+=k,this.addHalfVertex(e,a,l,T,!1,_,b,e.z),this.addHalfVertex(e,d,f,T,!0,-y,b,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,a,l,T,!1,_,b,n.z),this.addHalfVertex(n,d,f,T,!0,-y,b,n.z)}addCurrentVertex(e,n,a,l,d,f,_=!1){let y=n.x+n.y*a,b=n.y-n.x*a,T=n.y*l-n.x,D=-n.y-n.x*l;if(f!=null){let P=Je+10,R=f,k=new AS(e.x,e.y,R,this.lineSoFar),N=hC(e,-10,P),V=this.lineSoFar;if(this.currentVertex)if(N){let Y=this.currentVertexIsOutside,X=this.currentVertex,K=new AS(e.x,e.y,R,this.lineSoFar);RS(X,K,-10,P),hC(K,-10,P)||(Y&&(this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,y,b,_,!1,a,d,X.z),this.addHalfVertex(X,T,D,_,!0,-l,d,X.z)),this.addVerticesTo(X,K,y,b,T,D,a,l,d,_))}else{let Y=this.currentVertex;this.currentVertexIsOutside&&(RS(Y,k,-10,P),this.e1=this.e2=-1,this.lineSoFar=Y.w,this.addHalfVertex(Y,y,b,_,!1,a,d,Y.z),this.addHalfVertex(Y,T,D,_,!0,-l,d,Y.z)),this.addVerticesTo(Y,k,y,b,T,D,a,l,d,_)}else N||(this.addHalfVertex(e,y,b,_,!1,a,d,f),this.addHalfVertex(e,T,D,_,!0,-l,d,f));this.currentVertex=k,this.currentVertexIsOutside=N,this.lineSoFar=V}else this.addHalfVertex(e,y,b,_,!1,a,d,f),this.addHalfVertex(e,T,D,_,!0,-l,d,f)}addHalfVertex({x:e,y:n},a,l,d,f,_,y,b){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let T=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),y.primitiveLength++),f?this.e2=T:this.e1=T,b!=null&&this.zOffsetVertexArray.emplaceBack(b)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function hC(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}Q(Py,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let IN=new Mn({"line-cap":new st(we.layout_line["line-cap"]),"line-join":new st(we.layout_line["line-join"]),"line-miter-limit":new Fe(we.layout_line["line-miter-limit"]),"line-round-limit":new Fe(we.layout_line["line-round-limit"]),"line-sort-key":new st(we.layout_line["line-sort-key"]),"line-z-offset":new st(we.layout_line["line-z-offset"]),visibility:new Fe(we.layout_line.visibility)});var Ry={paint:new Mn({"line-opacity":new st(we.paint_line["line-opacity"]),"line-color":new st(we.paint_line["line-color"]),"line-translate":new Fe(we.paint_line["line-translate"]),"line-translate-anchor":new Fe(we.paint_line["line-translate-anchor"]),"line-width":new st(we.paint_line["line-width"]),"line-gap-width":new st(we.paint_line["line-gap-width"]),"line-offset":new st(we.paint_line["line-offset"]),"line-blur":new st(we.paint_line["line-blur"]),"line-dasharray":new st(we.paint_line["line-dasharray"]),"line-pattern":new st(we.paint_line["line-pattern"]),"line-gradient":new Mr(we.paint_line["line-gradient"]),"line-trim-offset":new Fe(we.paint_line["line-trim-offset"]),"line-trim-fade-range":new Fe(we.paint_line["line-trim-fade-range"]),"line-trim-color":new Fe(we.paint_line["line-trim-color"]),"line-emissive-strength":new Fe(we.paint_line["line-emissive-strength"]),"line-border-width":new st(we.paint_line["line-border-width"]),"line-border-color":new st(we.paint_line["line-border-color"]),"line-occlusion-opacity":new Fe(we.paint_line["line-occlusion-opacity"])}),layout:IN};function dC(t,e,n){return e*(Je/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function fC(t,e){return 1/dC(t,1,e.tileZoom)}function pC(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let mC=t=>{let e=[];gC(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",l=!!t.paint.get("line-pattern").constantOr(1);return a&&l&&e.push("LINE_JOIN_NONE"),e};function gC(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class _C{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var DN={read:function(t,e,n,a,l){var d,f,_=8*l-a-1,y=(1<<_)-1,b=y>>1,T=-7,D=n?l-1:0,S=n?-1:1,P=t[e+D];for(D+=S,d=P&(1<<-T)-1,P>>=-T,T+=_;T>0;d=256*d+t[e+D],D+=S,T-=8);for(f=d&(1<<-T)-1,d>>=-T,T+=a;T>0;f=256*f+t[e+D],D+=S,T-=8);if(d===0)d=1-b;else{if(d===y)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,a),d-=b}return(P?-1:1)*f*Math.pow(2,d-a)},write:function(t,e,n,a,l,d){var f,_,y,b=8*d-l-1,T=(1<<b)-1,D=T>>1,S=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=a?0:d-1,R=a?1:-1,k=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=T):(f=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-f))<1&&(f--,y*=2),(e+=f+D>=1?S/y:S*Math.pow(2,1-D))*y>=2&&(f++,y/=2),f+D>=T?(_=0,f=T):f+D>=1?(_=(e*y-1)*Math.pow(2,l),f+=D):(_=e*Math.pow(2,D-1)*Math.pow(2,l),f=0));l>=8;t[n+P]=255&_,P+=R,_/=256,l-=8);for(f=f<<l|_,b+=l;b>0;t[n+P]=255&f,P+=R,f/=256,b-=8);t[n+P-R]|=128*k}},yC=er,Oy=DN;function er(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}er.Varint=0,er.Fixed64=1,er.Bytes=2,er.Fixed32=5;var Eb=4294967296,vC=1/Eb,xC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ga(t){return t.type===er.Bytes?t.readVarint()+t.pos:t.pos+1}function Md(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function bC(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var l=n.pos-1;l>=t;l--)n.buf[l+a]=n.buf[l]}function SN(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function CN(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function MN(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function AN(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function PN(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function RN(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function ON(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function LN(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function kN(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Ly(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ad(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function wC(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}er.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),l=a>>3,d=this.pos;this.type=7&a,t(l,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ly(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wC(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ly(this.buf,this.pos)+Ly(this.buf,this.pos+4)*Eb;return this.pos+=8,t},readSFixed64:function(){var t=Ly(this.buf,this.pos)+wC(this.buf,this.pos+4)*Eb;return this.pos+=8,t},readFloat:function(){var t=Oy.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Oy.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(l,d,f){var _,y,b=f.buf;if(_=(112&(y=b[f.pos++]))>>4,y<128||(_|=(127&(y=b[f.pos++]))<<3,y<128)||(_|=(127&(y=b[f.pos++]))<<10,y<128)||(_|=(127&(y=b[f.pos++]))<<17,y<128)||(_|=(127&(y=b[f.pos++]))<<24,y<128)||(_|=(1&(y=b[f.pos++]))<<31,y<128))return Md(l,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&xC?function(n,a,l){return xC.decode(n.subarray(a,l))}(this.buf,e,t):function(n,a,l){for(var d="",f=a;f<l;){var _,y,b,T=n[f],D=null,S=T>239?4:T>223?3:T>191?2:1;if(f+S>l)break;S===1?T<128&&(D=T):S===2?(192&(_=n[f+1]))==128&&(D=(31&T)<<6|63&_)<=127&&(D=null):S===3?(y=n[f+2],(192&(_=n[f+1]))==128&&(192&y)==128&&((D=(15&T)<<12|(63&_)<<6|63&y)<=2047||D>=55296&&D<=57343)&&(D=null)):S===4&&(y=n[f+2],b=n[f+3],(192&(_=n[f+1]))==128&&(192&y)==128&&(192&b)==128&&((D=(15&T)<<18|(63&_)<<12|(63&y)<<6|63&b)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,S=1):D>65535&&(D-=65536,d+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),d+=String.fromCharCode(D),f+=S}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==er.Bytes)return t.push(this.readVarint(e));var n=Ga(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==er.Bytes)return t.push(this.readSVarint());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==er.Bytes)return t.push(this.readBoolean());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==er.Bytes)return t.push(this.readFloat());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==er.Bytes)return t.push(this.readDouble());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==er.Bytes)return t.push(this.readFixed32());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==er.Bytes)return t.push(this.readSFixed32());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==er.Bytes)return t.push(this.readFixed64());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==er.Bytes)return t.push(this.readSFixed64());var e=Ga(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===er.Varint)for(;this.buf[this.pos++]>127;);else if(e===er.Bytes)this.pos=this.readVarint()+this.pos;else if(e===er.Fixed32)this.pos+=4;else{if(e!==er.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ad(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ad(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ad(this.buf,-1&t,this.pos),Ad(this.buf,Math.floor(t*vC),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ad(this.buf,-1&t,this.pos),Ad(this.buf,Math.floor(t*vC),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,f,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(a,0,n),function(d,f){var _=(7&d)<<4;f.buf[f.pos++]|=_|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(l,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,l,d){for(var f,_,y=0;y<l.length;y++){if((f=l.charCodeAt(y))>55295&&f<57344){if(!_){f>56319||y+1===l.length?(a[d++]=239,a[d++]=191,a[d++]=189):_=f;continue}if(f<56320){a[d++]=239,a[d++]=191,a[d++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(a[d++]=239,a[d++]=191,a[d++]=189,_=null);f<128?a[d++]=f:(f<2048?a[d++]=f>>6|192:(f<65536?a[d++]=f>>12|224:(a[d++]=f>>18|240,a[d++]=f>>12&63|128),a[d++]=f>>6&63|128),a[d++]=63&f|128)}return d}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&bC(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Oy.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Oy.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&bC(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,er.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,SN,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,CN,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,PN,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,MN,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,AN,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,RN,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ON,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,LN,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,kN,e)},writeBytesField:function(t,e){this.writeTag(t,er.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,er.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,er.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,er.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,er.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,er.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,er.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,er.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,er.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,er.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Pd=ct(yC);let FN=["id","tile","layer","source","sourceLayer","state"];class EC{constructor(e,n,a,l,d){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=l,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of FN)this[n]!==void 0&&(e[n]=this[n]);return e}}class NN{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){let l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},ni(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let d in this.state[e])d!==l&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(let d in this.state[e][l])a[d]||(this.deletedStates[e][l][d]=null)}else for(let d in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][d]===null&&delete this.deletedStates[e][l][d]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;let l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){let a=String(n),l=ni({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let d=this.deletedStates[e][n];if(d===null)return{};for(let f in d)delete l[f]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let a={};for(let l in this.stateChanges){this.state[l]=this.state[l]||{};let d={};for(let f in this.stateChanges[l])this.state[l][f]||(this.state[l][f]={}),ni(this.state[l][f],this.stateChanges[l][f]),d[f]=this.state[l][f];a[l]=d}for(let l in this.deletedStates){this.state[l]=this.state[l]||{};let d={};if(this.deletedStates[l]===null)for(let f in this.state[l])d[f]={},this.state[l][f]={};else for(let f in this.deletedStates[l]){if(this.deletedStates[l][f]===null)this.state[l][f]={};else if(this.state[l][f])for(let _ of Object.keys(this.deletedStates[l][f]))delete this.state[l][f][_];d[f]=this.state[l][f]}a[l]=a[l]||{},ni(a[l],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let l in e)e[l].setFeatureState(a,n)}}class TC{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ue(Je,16,0),this.featureIndexArray=new FD,this.promoteId=n,this.is3DTile=!1}insert(e,n,a,l,d,f=0,_=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,d,f);let b=this.grid;for(let T=0;T<n.length;T++){let D=n[T],S=[1/0,1/0,-1/0,-1/0];for(let P=0;P<D.length;P++){let R=D[P];S[0]=Math.min(S[0],R.x),S[1]=Math.min(S[1],R.y),S[2]=Math.max(S[2],R.x),S[3]=Math.max(S[3],R.y)}_!==0&&(S[0]-=_,S[1]-=_,S[2]+=_,S[3]+=_),S[0]<Je&&S[1]<Je&&S[2]>=0&&S[3]>=0&&b.insert(y,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new yb(new Pd(this.rawTileData)).layers,this.sourceLayerCoder=new _C(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,l){this.loadVTLayers();let d=e.params||{},f=mi(d.filter),_=e.tileResult,y=e.transform,b=_.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(R,k,N,V)=>JD(_.bufferedTilespaceGeometry,R,k,N,V));T.sort(zN);let D=null;y.elevation&&T.length>0&&(D=Cd.create(y.elevation,this.tileID));let S={},P;for(let R=0;R<T.length;R++){let k=T[R];if(k===P)continue;P=k;let N=this.featureIndexArray.get(k),V=null;if(this.is3DTile){let Y=this.bucketLayerIDs[0][0],X=n[Y];if(X.type!=="model")continue;let{queryFeature:K,intersectionZ:ae}=X.queryIntersectsMatchingFeature(_,N.featureIndex,f,y);K&&this.appendToResult(S,Y,N.featureIndex,K,ae)}else this.loadMatchingFeature(S,N,f,d.layers,d.availableImages,n,a,l,(Y,X,K,ae=0)=>(V||(V=os(Y,this.tileID.canonical,e.tileTransform)),X.queryIntersectsFeature(_,Y,K,V,this.z,e.transform,e.pixelPosMatrix,D,ae)))}return S}loadMatchingFeature(e,n,a,l,d,f,_,y,b){let{featureIndex:T,bucketIndex:D,sourceLayerIndex:S,layoutVertexArrayOffset:P}=n,R=this.bucketLayerIDs[D];if(l&&!function(Y,X){for(let K=0;K<Y.length;K++)if(X.indexOf(Y[K])>=0)return!0;return!1}(l,R))return;let k=this.sourceLayerCoder.decode(S),N=this.vtLayers[k].feature(T);if(a.needGeometry){let Y=Va(N,!0);if(!a.filter(new Ot(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!a.filter(new Ot(this.tileID.overscaledZ),N))return;let V=this.getId(N,k);for(let Y=0;Y<R.length;Y++){let X=R[Y];if(l&&l.indexOf(X)<0)continue;let K=f[X];if(!K)continue;let ae={};V!==void 0&&y&&(ae=y.getState(K.sourceLayer||"_geojsonTileLayer",V));let oe=!b||b(N,K,ae,P);if(!oe)continue;let fe=new EC(N,this.z,this.x,this.y,V),me=ni({},_[X]);me.paint=IC(me.paint,K.paint,N,ae,d),me.layout=IC(me.layout,K.layout,N,ae,d),fe.layer=me,this.appendToResult(e,X,T,fe,oe)}}appendToResult(e,n,a,l,d){let f=e[n];f===void 0&&(f=e[n]=[]),f.push({featureIndex:a,feature:l,intersectionZ:d})}lookupSymbolFeatures(e,n,a,l,d,f,_,y){let b={};this.loadVTLayers();let T=mi(d);for(let D of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:l,featureIndex:D,layoutVertexArrayOffset:0},T,f,_,y,n);return b}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let l=this.sourceLayerCoder.decode(a),d=this.vtFeatures[l];if(d[n])return d[n];let f=this.vtLayers[l].feature(n);return d[n]=f,f}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];l!=null&&(a=e.properties[l]),typeof a=="boolean"&&(a=Number(a))}return a}}function IC(t,e,n,a,l){return wl(t,(d,f)=>{let _=e instanceof sn?e.get(f):null;return _&&_.evaluate?_.evaluate(n,a,l):_})}function zN(t,e){return e-t}Q(TC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var si=24;let ss=128;function Tb(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Ot(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:l}=n,d=0;for(;d<a.length&&a[d]<=t;)d++;d=Math.max(0,d-1);let f=d;for(;f<a.length&&a[f]<t+1;)f++;f=Math.min(a.length-1,f);let _=a[d],y=a[f];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:l}:{kind:"camera",minZoom:_,maxZoom:y,minSize:n.evaluate(new Ot(_)),maxSize:n.evaluate(new Ot(y)),interpolationType:l}}}function ky(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:l}){return t.kind==="source"?a/ss:t.kind==="composite"?wt(a/ss,l/ss,n):e}function Rd(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:l,minZoom:d,maxZoom:f}=t,_=l?Zt(Bi.interpolationFactor(l,e,d,f),0,1):0;t.kind==="camera"?a=wt(t.minSize,t.maxSize,_):n=_}return{uSizeT:n,uSize:a}}var BN=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ss,evaluateSizeForFeature:ky,evaluateSizeForZoom:Rd,getSizeData:Tb});function UN(t,e,n){return t.sections.forEach(a=>{a.text=function(l,d,f){let _=d.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?l=l.toLocaleUpperCase():_==="lowercase"&&(l=l.toLocaleLowerCase()),Cn.applyArabicShaping&&(l=Cn.applyArabicShaping(l)),l}(a.text,e,n)}),t}let ym={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function VN(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function jN(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let Ib=3;function $N(t,e,n){e.glyphs=[],t===1&&n.readMessage(GN,e)}function GN(t,e,n){if(t===3){let{id:a,bitmap:l,width:d,height:f,left:_,top:y,advance:b}=n.readMessage(qN,{});e.glyphs.push({id:a,bitmap:new Jl({width:d+2*Ib,height:f+2*Ib},l),metrics:{width:d,height:f,left:_,top:y,advance:b}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function qN(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let DC=Ib,yo={horizontal:1,vertical:2,horizontalOnly:3};class vm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new vm;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new vm;return n.imageName=e,n}}class Od{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new Od;for(let l=0;l<e.sections.length;l++){let d=e.sections[l];d.image?a.addImageSection(d):a.addTextSection(d,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let l="";for(let d=0;d<n.length;d++){let f=n.charCodeAt(d+1)||null,_=n.charCodeAt(d-1)||null;l+=!a&&(f&&Ne(f)&&!ym[n[d+1]]||_&&Ne(_)&&!ym[n[d-1]])||!ym[n[d]]?n[d]:ym[n[d]]}return l}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Fy[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Fy[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new Od;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(vm.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void yr("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(vm.forImage(n)),this.sectionIndex.push(this.sections.length-1)):yr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Db(t,e,n,a,l,d,f,_,y,b,T,D,S,P,R){let k=Od.fromFeature(t,l);D===yo.vertical&&k.verticalizePunctuation(S);let N=[],V=function(oe,fe,me,xe,Pe,De){if(!oe)return[];let ke=[],He=function($e,Ye,Ge,at,We,Ke){let _t=0;for(let mt=0;mt<$e.length();mt++){let ft=$e.getSection(mt);_t+=SC($e.getCodePoint(mt),ft,at,We,Ye,Ke)}return _t/Math.max(1,Math.ceil(_t/Ge))}(oe,fe,me,xe,Pe,De),Oe=oe.text.indexOf("\u200B")>=0,je=0;for(let $e=0;$e<oe.length();$e++){let Ye=oe.getSection($e),Ge=oe.getCodePoint($e);if(Fy[Ge]||(je+=SC(Ge,Ye,xe,Pe,fe,De)),$e<oe.length()-1){let at=!((Re=Ge)<11904||!(se["Bopomofo Extended"](Re)||se.Bopomofo(Re)||se["CJK Compatibility Forms"](Re)||se["CJK Compatibility Ideographs"](Re)||se["CJK Compatibility"](Re)||se["CJK Radicals Supplement"](Re)||se["CJK Strokes"](Re)||se["CJK Symbols and Punctuation"](Re)||se["CJK Unified Ideographs Extension A"](Re)||se["CJK Unified Ideographs"](Re)||se["Enclosed CJK Letters and Months"](Re)||se["Halfwidth and Fullwidth Forms"](Re)||se.Hiragana(Re)||se["Ideographic Description Characters"](Re)||se["Kangxi Radicals"](Re)||se["Katakana Phonetic Extensions"](Re)||se.Katakana(Re)||se["Vertical Forms"](Re)||se["Yi Radicals"](Re)||se["Yi Syllables"](Re)));(HN[Ge]||at||Ye.imageName)&&ke.push(MC($e+1,je,He,ke,WN(Ge,oe.getCodePoint($e+1),at&&Oe),!1))}}var Re;return AC(MC(oe.length(),je,He,ke,0,!0))}(k,b,d,e,a,P),{processBidirectionalText:Y,processStyledBidirectionalText:X}=Cn;if(Y&&k.sections.length===1){let oe=Y(k.toString(),V);for(let fe of oe){let me=new Od;me.text=fe,me.sections=k.sections;for(let xe=0;xe<fe.length;xe++)me.sectionIndex.push(0);N.push(me)}}else if(X){let oe=X(k.text,k.sectionIndex,V);for(let fe of oe){let me=new Od;me.text=fe[0],me.sectionIndex=fe[1],me.sections=k.sections,N.push(me)}}else N=function(oe,fe){let me=[],xe=oe.text,Pe=0;for(let De of fe)me.push(oe.substring(Pe,De)),Pe=De;return Pe<xe.length&&me.push(oe.substring(Pe,xe.length)),me}(k,V);let K=[],ae={positionedLines:K,text:k.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(oe,fe,me,xe,Pe,De,ke,He,Oe,je,Re,$e){let Ye=0,Ge=0,at=0,We=He==="right"?1:He==="left"?0:.5,Ke=!1;for(let Ut of Pe){let Dt=Ut.getSections();for(let Ht of Dt){if(Ht.imageName)continue;let Vt=fe[Ht.fontStack];if(Vt&&(Ke=Vt.ascender!==void 0&&Vt.descender!==void 0,!Ke))break}if(!Ke)break}let _t=0;for(let Ut of Pe){Ut.trim();let Dt=Ut.getMaxScale(),Ht=(Dt-1)*si,Vt={positionedGlyphs:[],lineOffset:0};oe.positionedLines[_t]=Vt;let Jt=Vt.positionedGlyphs,Tt=0;if(!Ut.length()){Ge+=De,++_t;continue}let Nn=0,Fn=0;for(let an=0;an<Ut.length();an++){let bn=Ut.getSection(an),Hn=Ut.getSectionIndex(an),Vn=Ut.getCodePoint(an),ur=bn.scale,lr=null,_i=null,pr=null,tr=si,Cr=0,Wr=!(Oe===yo.horizontal||!Re&&!Ue(Vn)||Re&&(Fy[Vn]||(mt=Vn,se.Arabic(mt)||se["Arabic Supplement"](mt)||se["Arabic Extended-A"](mt)||se["Arabic Presentation Forms-A"](mt)||se["Arabic Presentation Forms-B"](mt))));if(bn.imageName){let Zr=xe[bn.imageName];if(!Zr)continue;pr=bn.imageName,oe.iconsInText=oe.iconsInText||!0,_i=Zr.paddedRect;let $n=Zr.displaySize;ur=ur*si/$e,lr={width:$n[0],height:$n[1],left:0,top:-DC,advance:Wr?$n[1]:$n[0],localGlyph:!1},Cr=Ke?-lr.height*ur:Dt*si-17-$n[1]*ur,tr=lr.advance;let ki=(Wr?$n[0]:$n[1])*ur-si*Dt;ki>0&&ki>Tt&&(Tt=ki)}else{let Zr=me[bn.fontStack];if(!Zr)continue;Zr[Vn]&&(_i=Zr[Vn]);let $n=fe[bn.fontStack];if(!$n)continue;let ki=$n.glyphs[Vn];if(!ki)continue;if(lr=ki.metrics,tr=Vn!==8203?si:0,Ke){let Ha=$n.ascender!==void 0?Math.abs($n.ascender):0,jo=$n.descender!==void 0?Math.abs($n.descender):0,fs=(Ha+jo)*ur;Nn<fs&&(Nn=fs,Fn=(Ha-jo)/2*ur),Cr=-Ha*ur}else Cr=(Dt-ur)*si-17}Wr?(oe.verticalizable=!0,Jt.push({glyph:Vn,imageName:pr,x:Ye,y:Ge+Cr,vertical:Wr,scale:ur,localGlyph:lr.localGlyph,fontStack:bn.fontStack,sectionIndex:Hn,metrics:lr,rect:_i}),Ye+=tr*ur+je):(Jt.push({glyph:Vn,imageName:pr,x:Ye,y:Ge+Cr,vertical:Wr,scale:ur,localGlyph:lr.localGlyph,fontStack:bn.fontStack,sectionIndex:Hn,metrics:lr,rect:_i}),Ye+=lr.advance*ur+je)}Jt.length!==0&&(at=Math.max(Ye-je,at),Ke?PC(Jt,We,Tt,Fn,De*Dt/2):PC(Jt,We,Tt,0,De/2)),Ye=0;let xn=De*Dt+Tt;Vt.lineOffset=Math.max(Tt,Ht),Ge+=xn,++_t}var mt;let ft=Ge,{horizontalAlign:Xe,verticalAlign:yt}=Sb(ke);(function(Ut,Dt,Ht,Vt,Jt,Tt){let Nn=(Dt-Ht)*Jt,Fn=-Tt*Vt;for(let xn of Ut)for(let an of xn.positionedGlyphs)an.x+=Nn,an.y+=Fn})(oe.positionedLines,We,Xe,yt,at,ft),oe.top+=-yt*ft,oe.bottom=oe.top+ft,oe.left+=-Xe*at,oe.right=oe.left+at,oe.hasBaseline=Ke}(ae,e,n,a,N,f,_,y,D,b,S,R),!function(oe){for(let fe of oe)if(fe.positionedGlyphs.length!==0)return!1;return!0}(K)&&ae}let Fy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function SC(t,e,n,a,l,d){if(e.imageName){let f=a[e.imageName];return f?f.displaySize[0]*e.scale*si/d+l:0}{let f=n[e.fontStack],_=f&&f.glyphs[t];return _?_.metrics.advance*e.scale+l:0}}function CC(t,e,n,a){let l=Math.pow(t-e,2);return a?t<e?l/2:2*l:l+Math.abs(n)*n}function WN(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function MC(t,e,n,a,l,d){let f=null,_=CC(e,n,l,d);for(let y of a){let b=CC(e-y.x,n,l,d)+y.badness;b<=_&&(f=y,_=b)}return{index:t,x:e,priorBreak:f,badness:_}}function AC(t){return t?AC(t.priorBreak).concat(t.index):[]}function Sb(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function PC(t,e,n,a,l){if(!(e||n||a||l))return;let d=t.length-1,f=t[d],_=(f.x+f.metrics.advance*f.scale)*e;for(let y=0;y<=d;y++)t[y].x-=_,t[y].y+=n+a+l}function ZN(t,e,n,a){let{horizontalAlign:l,verticalAlign:d}=Sb(a),f=n[0]-t.displaySize[0]*l,_=n[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function RC(t,e,n,a,l,d){let f=t.imagePrimary,_;if(f.content){let N=f.content,V=f.pixelRatio||1;_=[N[0]/V,N[1]/V,f.displaySize[0]-N[2]/V,f.displaySize[1]-N[3]/V]}let y=e.left*d,b=e.right*d,T,D,S,P;n==="width"||n==="both"?(P=l[0]+y-a[3],D=l[0]+b+a[1]):(P=l[0]+(y+b-f.displaySize[0])/2,D=P+f.displaySize[0]);let R=e.top*d,k=e.bottom*d;return n==="height"||n==="both"?(T=l[1]+R-a[0],S=l[1]+k+a[2]):(T=l[1]+(R+k-f.displaySize[1])/2,S=T+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:T,right:D,bottom:S,left:P,collisionPadding:_}}class qa extends rt{constructor(e,n,a,l,d){super(e,n),this.angle=l,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new qa(this.x,this.y,this.z,this.angle,this.segment)}}function OC(t,e,n,a,l){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,_=0;for(;_>-n/2;){if(f--,f<0)return!1;_-=t[f].dist(d),d=t[f]}_+=t[f].dist(t[f+1]),f++;let y=[],b=0;for(;_<n/2;){let T=t[f],D=t[f+1];if(!D)return!1;let S=t[f-1].angleTo(T)-T.angleTo(D);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:S}),b+=S;_-y[0].distance>a;)b-=y.shift().angleDelta;if(b>l)return!1;f++,_+=T.dist(D)}return!0}function LC(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function kC(t,e,n){return t?.6*e*n:0}function FC(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function YN(t,e,n,a,l,d){let f=kC(n,l,d),_=FC(n,a)*d,y=0,b=LC(t)/2;for(let T=0;T<t.length-1;T++){let D=t[T],S=t[T+1],P=D.dist(S);if(y+P>b){let R=(b-y)/P,k=wt(D.x,S.x,R),N=wt(D.y,S.y,R),V=new qa(k,N,0,S.angleTo(D),T);return!f||OC(t,V,_,f,e)?V:void 0}y+=P}}function XN(t,e,n,a,l,d,f,_,y){let b=kC(a,d,f),T=FC(a,l),D=T*f,S=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-D<e/4&&(e=D+e/4),NC(t,S?e/2*_%e:(T/2+2*d)*f*_%e,e,b,n,D,S,!1,y)}function NC(t,e,n,a,l,d,f,_,y){let b=d/2,T=LC(t),D=0,S=e-n,P=[];for(let R=0;R<t.length-1;R++){let k=t[R],N=t[R+1],V=k.dist(N),Y=N.angleTo(k);for(;S+n<D+V;){S+=n;let X=(S-D)/V,K=wt(k.x,N.x,X),ae=wt(k.y,N.y,X);if(K>=0&&K<y&&ae>=0&&ae<y&&S-b>=0&&S+b<=T){let oe=new qa(K,ae,0,Y,R);a&&!OC(t,oe,d,a,l)||P.push(oe)}}D+=V}return _||P.length||f||(P=NC(t,D/2,n,a,l,d,f,!0,y)),P}function zC(t,e,n,a,l){let d=[];for(let f=0;f<t.length;f++){let _=t[f],y;for(let b=0;b<_.length-1;b++){let T=_[b],D=_[b+1];T.x<e&&D.x<e||(T.x<e?T=new rt(e,T.y+(e-T.x)/(D.x-T.x)*(D.y-T.y))._round():D.x<e&&(D=new rt(e,T.y+(e-T.x)/(D.x-T.x)*(D.y-T.y))._round()),T.y<n&&D.y<n||(T.y<n?T=new rt(T.x+(n-T.y)/(D.y-T.y)*(D.x-T.x),n)._round():D.y<n&&(D=new rt(T.x+(n-T.y)/(D.y-T.y)*(D.x-T.x),n)._round()),T.x>=a&&D.x>=a||(T.x>=a?T=new rt(a,T.y+(a-T.x)/(D.x-T.x)*(D.y-T.y))._round():D.x>=a&&(D=new rt(a,T.y+(a-T.x)/(D.x-T.x)*(D.y-T.y))._round()),T.y>=l&&D.y>=l||(T.y>=l?T=new rt(T.x+(l-T.y)/(D.y-T.y)*(D.x-T.x),l)._round():D.y>=l&&(D=new rt(T.x+(l-T.y)/(D.y-T.y)*(D.x-T.x),l)._round()),y&&T.equals(y[y.length-1])||(y=[T],d.push(y)),y.push(D)))))}}return d}function BC(t){let e=0,n=0;for(let f of t)e+=f.w*f.h,n=Math.max(n,f.w);t.sort((f,_)=>_.h-f.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],l=0,d=0;for(let f of t)for(let _=a.length-1;_>=0;_--){let y=a[_];if(!(f.w>y.w||f.h>y.h)){if(f.x=y.x,f.y=y.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===y.w&&f.h===y.h){let b=a.pop();_<a.length&&(a[_]=b)}else f.h===y.h?(y.x+=f.w,y.w-=f.w):f.w===y.w?(y.y+=f.h,y.h-=f.h):(a.push({x:y.x+f.w,y:y.y,w:y.w-f.w,h:f.h}),y.y+=f.h,y.h-=f.h);break}}return{w:l,h:d,fill:e/(l*d)||0}}Q(qa,"Anchor");let eo=1;class Cb{constructor(e,{pixelRatio:n,version:a,stretchX:l,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=l,this.stretchY=d,this.content=f,this.version=a}get tl(){return[this.paddedRect.x+eo,this.paddedRect.y+eo]}get br(){return[this.paddedRect.x+this.paddedRect.w-eo,this.paddedRect.y+this.paddedRect.h-eo]}get displaySize(){return[(this.paddedRect.w-2*eo)/this.pixelRatio,(this.paddedRect.h-2*eo)/this.pixelRatio]}}class UC{constructor(e,n,a){let l={},d={};this.haveRenderCallbacks=[];let f=[];this.addImages(e,l,f),this.addImages(n,d,f);let{w:_,h:y}=BC(f),b=new _o({width:_||1,height:y||1});for(let T in e){let D=e[T],S=l[T].paddedRect;_o.copy(D.data,b,{x:0,y:0},{x:S.x+eo,y:S.y+eo},D.data,a,D.sdf)}for(let T in n){let D=n[T],S=d[T].paddedRect,P=S.x+eo,R=S.y+eo,k=D.data.width,N=D.data.height;_o.copy(D.data,b,{x:0,y:0},{x:P,y:R},D.data,a),_o.copy(D.data,b,{x:0,y:N-1},{x:P,y:R-1},{width:k,height:1},a),_o.copy(D.data,b,{x:0,y:0},{x:P,y:R+N},{width:k,height:1},a),_o.copy(D.data,b,{x:k-1,y:0},{x:P-1,y:R},{width:1,height:N},a),_o.copy(D.data,b,{x:0,y:0},{x:P+k,y:R},{width:1,height:N},a)}this.image=b,this.iconPositions=l,this.patternPositions=d}addImages(e,n,a){for(let l in e){let d=e[l],f={x:0,y:0,w:d.data.width+2*eo,h:d.data.height+2*eo};a.push(f),n[l]=new Cb(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let l in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[l],e.getImage(l,a),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[l,d]=e.tl,f=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:f},{x:l,y:d})}}Q(Cb,"ImagePosition"),Q(UC,"ImageAtlas");let xm=1e20;function VC(t,e,n,a,l,d,f,_,y){for(let b=e;b<e+a;b++)jC(t,n*d+b,d,l,f,_,y);for(let b=n;b<n+l;b++)jC(t,b*d+e,1,a,f,_,y)}function jC(t,e,n,a,l,d,f){d[0]=0,f[0]=-xm,f[1]=xm,l[0]=t[e];for(let _=1,y=0,b=0;_<a;_++){l[_]=t[e+_*n];let T=_*_;do{let D=d[y];b=(l[_]-l[D]+T-D*D)/(_-D)/2}while(b<=f[y]&&--y>-1);y++,d[y]=_,f[y]=b,f[y+1]=xm}for(let _=0,y=0;_<a;_++){for(;f[y+1]<_;)y++;let b=d[y],T=_-b;t[e+_*n]=l[b]+T*T}}let as=2,Mb={none:0,ideographs:1,all:2};class Ld{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){let l=[],d=this.urls[n]||O.GLYPHS_URL;for(let f in e)for(let _ of e[f])l.push({stack:f,id:_});bl(l,({stack:f,id:_},y)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[_];if(T!==void 0)return void y(null,{stack:f,id:_,glyph:T});if(T=this._tinySDF(b,f,_),T)return b.glyphs[_]=T,void y(null,{stack:f,id:_,glyph:T});let D=Math.floor(_/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[D])return void y(null,{stack:f,id:_,glyph:T});let S=b.requests[D];S||(S=b.requests[D]=[],Ld.loadGlyphRange(f,D,d,this.requestManager,(P,R)=>{if(R){b.ascender=R.ascender,b.descender=R.descender;for(let k in R.glyphs)this._doesCharSupportLocalGlyph(+k)||(b.glyphs[+k]=R.glyphs[+k]);b.ranges[D]=!0}for(let k of S)k(P,R);delete b.requests[D]})),S.push((P,R)=>{P?y(P):R&&y(null,{stack:f,id:_,glyph:R.glyphs[_]||null})})},(f,_)=>{if(f)a(f);else if(_){let y={};for(let{stack:b,id:T,glyph:D}of _)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Mb.none&&(this.localGlyphMode===Mb.all?!!this.localFontFamily:!!this.localFontFamily&&(se["CJK Unified Ideographs"](e)||se["Hangul Syllables"](e)||se.Hiragana(e)||se.Katakana(e)||se["CJK Symbols and Punctuation"](e)||se["CJK Unified Ideographs Extension A"](e)||se["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){let l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let k="400";/bold/i.test(n)?k="900":/medium/i.test(n)?k="500":/light/i.test(n)&&(k="200"),d=e.tinySDF=new Ld.TinySDF({fontFamily:l,fontWeight:k,fontSize:24*as,buffer:3*as,radius:8*as}),d.fontWeight=k}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];let f=String.fromCodePoint(a),{data:_,width:y,height:b,glyphWidth:T,glyphHeight:D,glyphLeft:S,glyphTop:P,glyphAdvance:R}=d.draw(f);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Jl({width:y,height:b},_),metrics:{width:T/as,height:D/as,left:S/as,top:P/as-27,advance:R/as,localGlyph:!0}}}}Ld.loadGlyphRange=function(t,e,n,a,l){let d=256*e,f=d+255,_=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${d}-${f}`),Hh.Glyphs);Ia(_,(y,b)=>{if(y)l(y);else if(b){let T={},D=function(S){return new Pd(S).readFields($N,{})}(b);for(let S of D.glyphs)T[S.id]=S;l(null,{glyphs:T,ascender:D.ascender,descender:D.descender})}})},Ld.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let _=this.size=t+4*e,y=this._createCanvas(_),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${d} ${t}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(t),f=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),y=Math.min(this.size-this.buffer,f+Math.ceil(a)),b=_+2*this.buffer,T=y+2*this.buffer,D=Math.max(b*T,0),S=new Uint8ClampedArray(D),P={data:S,width:b,height:T,glyphWidth:_,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return P;let{ctx:R,buffer:k,gridInner:N,gridOuter:V}=this;R.clearRect(k,k,_,y),R.fillText(t,k,k+f);let Y=R.getImageData(k,k,_,y);V.fill(xm,0,D),N.fill(0,0,D);for(let X=0;X<y;X++)for(let K=0;K<_;K++){let ae=Y.data[4*(X*_+K)+3]/255;if(ae===0)continue;let oe=(X+k)*b+K+k;if(ae===1)V[oe]=0,N[oe]=xm;else{let fe=.5-ae;V[oe]=fe>0?fe*fe:0,N[oe]=fe<0?fe*fe:0}}VC(V,0,0,b,T,b,this.f,this.v,this.z),VC(N,k,k,_,y,b,this.f,this.v,this.z);for(let X=0;X<D;X++){let K=Math.sqrt(V[X])-Math.sqrt(N[X]);S[X]=Math.round(255-255*(K/this.radius+this.cutoff))}return P}};let nc=eo;function $C(t,e,n,a){let l=[],d=t.imagePrimary,f=d.pixelRatio,_=d.paddedRect.w-2*nc,y=d.paddedRect.h-2*nc,b=t.right-t.left,T=t.bottom-t.top,D=d.stretchX||[[0,_]],S=d.stretchY||[[0,y]],P=(De,ke)=>De+ke[1]-ke[0],R=D.reduce(P,0),k=S.reduce(P,0),N=_-R,V=y-k,Y=0,X=R,K=0,ae=k,oe=0,fe=N,me=0,xe=V;if(d.content&&a){let De=d.content;Y=Ny(D,0,De[0]),K=Ny(S,0,De[1]),X=Ny(D,De[0],De[2]),ae=Ny(S,De[1],De[3]),oe=De[0]-Y,me=De[1]-K,fe=De[2]-De[0]-X,xe=De[3]-De[1]-ae}let Pe=(De,ke,He,Oe)=>{let je=zy(De.stretch-Y,X,b,t.left),Re=By(De.fixed-oe,fe,De.stretch,R),$e=zy(ke.stretch-K,ae,T,t.top),Ye=By(ke.fixed-me,xe,ke.stretch,k),Ge=zy(He.stretch-Y,X,b,t.left),at=By(He.fixed-oe,fe,He.stretch,R),We=zy(Oe.stretch-K,ae,T,t.top),Ke=By(Oe.fixed-me,xe,Oe.stretch,k),_t=new rt(je,$e),mt=new rt(Ge,$e),ft=new rt(Ge,We),Xe=new rt(je,We),yt=new rt(Re/f,Ye/f),Ut=new rt(at/f,Ke/f),Dt=e*Math.PI/180;if(Dt){let Fn=Math.sin(Dt),xn=Math.cos(Dt),an=[xn,-Fn,Fn,xn];_t._matMult(an),mt._matMult(an),Xe._matMult(an),ft._matMult(an)}let Ht=De.stretch+De.fixed,Vt=He.stretch+He.fixed,Jt=ke.stretch+ke.fixed,Tt=Oe.stretch+Oe.fixed,Nn=t.imageSecondary;return{tl:_t,tr:mt,bl:Xe,br:ft,texPrimary:{x:d.paddedRect.x+nc+Ht,y:d.paddedRect.y+nc+Jt,w:Vt-Ht,h:Tt-Jt},texSecondary:Nn?{x:Nn.paddedRect.x+nc+Ht,y:Nn.paddedRect.y+nc+Jt,w:Vt-Ht,h:Tt-Jt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yt,pixelOffsetBR:Ut,minFontScaleX:fe/f/b,minFontScaleY:xe/f/T,isSDF:n}};if(a&&(d.stretchX||d.stretchY)){let De=GC(D,N,R),ke=GC(S,V,k);for(let He=0;He<De.length-1;He++){let Oe=De[He],je=De[He+1];for(let Re=0;Re<ke.length-1;Re++)l.push(Pe(Oe,ke[Re],je,ke[Re+1]))}}else l.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return l}function Ny(t,e,n){let a=0;for(let l of t)a+=Math.max(e,Math.min(n,l[1]))-Math.max(e,Math.min(n,l[0]));return a}function GC(t,e,n){let a=[{fixed:-nc,stretch:0}];for(let[l,d]of t){let f=a[a.length-1];a.push({fixed:l-f.stretch,stretch:f.stretch}),a.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return a.push({fixed:e+nc,stretch:n}),a}function zy(t,e,n,a){return t/e*n+a}function By(t,e,n,a){return t-e*n/a}function KN(t,e,n,a){let l=e+t.positionedLines[a].lineOffset;return a===0?n+l/2:n+(l+(e+t.positionedLines[a-1].lineOffset))/2}function QN(t,e=1,n=!1){let a=1/0,l=1/0,d=-1/0,f=-1/0,_=t[0];for(let P=0;P<_.length;P++){let R=_[P];(!P||R.x<a)&&(a=R.x),(!P||R.y<l)&&(l=R.y),(!P||R.x>d)&&(d=R.x),(!P||R.y>f)&&(f=R.y)}let y=Math.min(d-a,f-l),b=y/2,T=new Lp([],JN);if(y===0)return new rt(a,l);for(let P=a;P<d;P+=y)for(let R=l;R<f;R+=y)T.push(new kd(P+b,R+b,b,t));let D=function(P){let R=0,k=0,N=0,V=P[0];for(let Y=0,X=V.length,K=X-1;Y<X;K=Y++){let ae=V[Y],oe=V[K],fe=ae.x*oe.y-oe.x*ae.y;k+=(ae.x+oe.x)*fe,N+=(ae.y+oe.y)*fe,R+=3*fe}return new kd(k/R,N/R,0,P)}(t),S=T.length;for(;T.length;){let P=T.pop();(P.d>D.d||!D.d)&&(D=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,S)),P.max-D.d<=e||(b=P.h/2,T.push(new kd(P.p.x-b,P.p.y-b,b,t)),T.push(new kd(P.p.x+b,P.p.y-b,b,t)),T.push(new kd(P.p.x-b,P.p.y+b,b,t)),T.push(new kd(P.p.x+b,P.p.y+b,b,t)),S+=4)}return n&&(console.log(`num probes: ${S}`),console.log(`best distance: ${D.d}`)),D.p}function JN(t,e){return e.max-t.max}class kd{constructor(e,n,a,l){this.p=new rt(e,n),this.h=a,this.d=function(d,f){let _=!1,y=1/0;for(let b=0;b<f.length;b++){let T=f[b];for(let D=0,S=T.length,P=S-1;D<S;P=D++){let R=T[D],k=T[P];R.y>d.y!=k.y>d.y&&d.x<(k.x-R.x)*(d.y-R.y)/(k.y-R.y)+R.x&&(_=!_),y=Math.min(y,KD(d,R,k))}}return(_?1:-1)*Math.sqrt(y)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}let Ab=Number.POSITIVE_INFINITY,ez=Math.sqrt(2);function qC(t,[e,n]){let a=0,l=0;if(n===Ab){e<0&&(e=0);let d=e/ez;switch(t){case"top-right":case"top-left":l=d-7;break;case"bottom-right":case"bottom-left":l=7-d;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(t){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":l=n-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-n}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,l]}function Pb(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tz(t,e,n,a,l,d,f,_,y,b,T,D,S,P,R){let k=d.textMaxSize.evaluate(e,{},D);k===void 0&&(k=f);let N=t.layers[0].layout,V=N.get("icon-offset").evaluate(e,{},D),Y=WC(n.horizontal)||n.vertical,X=S.name==="globe",K=si,ae=f/K,oe=t.tilePixelRatio*k/K,fe=(je=t.overscaling,t.zoom>18&&je>2&&(je>>=1),Math.max(Je/(512*je),1)*N.get("symbol-spacing")),me=N.get("text-padding")*t.tilePixelRatio,xe=N.get("icon-padding")*t.tilePixelRatio,Pe=rn(N.get("text-max-angle")),De=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",ke=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",He=N.get("symbol-placement"),Oe=fe/2;var je;let Re=N.get("icon-text-fit").evaluate(e,{},D),$e=N.get("icon-text-fit-padding").evaluate(e,{},D),Ye=Re!=="none",Ge;t.hasAnyIconTextFit===!1&&Ye&&(t.hasAnyIconTextFit=!0),a&&Ye&&(t.allowVerticalPlacement&&n.vertical&&(Ge=RC(a,n.vertical,Re,$e,V,ae)),Y&&(a=RC(a,Y,Re,$e,V,ae)));let at=(We,Ke,_t)=>{if(Ke.x<0||Ke.x>=Je||Ke.y<0||Ke.y>=Je)return;let mt=null;if(X){let{x:ft,y:Xe,z:yt}=S.projectTilePoint(Ke.x,Ke.y,_t);mt={anchor:new qa(ft,Xe,yt,0,void 0),up:S.upVector(_t,Ke.x,Ke.y)}}(function(ft,Xe,yt,Ut,Dt,Ht,Vt,Jt,Tt,Nn,Fn,xn,an,bn,Hn,Vn,ur,lr,_i,pr,tr,Cr,Wr,Zr,$n,ki,Ha){let jo=ft.addToLineVertexArray(Xe,Ut),fs,cc,uc,qu,ZM,YM,XM,KM=0,QM=0,JM=0,eA=0,sw=-1,aw=-1,Ys={},tA=Ml(""),Hu=yt?yt.anchor:Xe,lw=Tt.layout.get("icon-text-fit").evaluate(tr,{},$n)!=="none",cw=0,uw=0;if(Tt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[cw,uw]=Tt.layout.get("text-offset").evaluate(tr,{},$n).map(no=>no*si):(cw=Tt.layout.get("text-radial-offset").evaluate(tr,{},$n)*si,uw=Ab),ft.allowVerticalPlacement&&Dt.vertical){let no=Dt.vertical;if(Hn)YM=Rb(no),Jt&&(XM=Rb(Jt));else{let ro=Tt.layout.get("text-rotate").evaluate(tr,{},$n)+90;uc=Uy(Nn,Hu,Xe,Fn,xn,an,no,bn,ro,Vn),Jt&&(qu=Uy(Nn,Hu,Xe,Fn,xn,an,Jt,lr,ro))}}if(Ht){let no=Tt.layout.get("icon-rotate").evaluate(tr,{},$n),ro=$C(Ht,no,Wr,lw),Gd=Jt?$C(Jt,no,Wr,lw):void 0;cc=Uy(Nn,Hu,Xe,Fn,xn,an,Ht,lr,no),KM=4*ro.length;let nA=ft.iconSizeData,Wu=null;nA.kind==="source"?(Wu=[ss*Tt.layout.get("icon-size").evaluate(tr,{},$n)],Wu[0]>rc&&yr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${bm}. Reduce your "icon-size".`)):nA.kind==="composite"&&(Wu=[ss*Cr.compositeIconSizes[0].evaluate(tr,{},$n),ss*Cr.compositeIconSizes[1].evaluate(tr,{},$n)],(Wu[0]>rc||Wu[1]>rc)&&yr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${bm}. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,ro,Wu,pr,_i,tr,!1,yt,Xe,jo.lineStartIndex,jo.lineLength,-1,Zr,$n,ki,Ha),sw=ft.icon.placedSymbolArray.length-1,Gd&&(QM=4*Gd.length,ft.addSymbols(ft.icon,Gd,Wu,pr,_i,tr,yo.vertical,yt,Xe,jo.lineStartIndex,jo.lineLength,-1,Zr,$n,ki,Ha),aw=ft.icon.placedSymbolArray.length-1)}for(let no in Dt.horizontal){let ro=Dt.horizontal[no];fs||(tA=Ml(ro.text),Hn?ZM=Rb(ro):fs=Uy(Nn,Hu,Xe,Fn,xn,an,ro,bn,Tt.layout.get("text-rotate").evaluate(tr,{},$n),Vn));let Gd=ro.positionedLines.length===1;if(JM+=HC(ft,yt,Xe,ro,Vt,Tt,Hn,tr,Vn,jo,Dt.vertical?yo.horizontal:yo.horizontalOnly,Gd?Object.keys(Dt.horizontal):[no],Ys,sw,Cr,Zr,$n,ki),Gd)break}Dt.vertical&&(eA+=HC(ft,yt,Xe,Dt.vertical,Vt,Tt,Hn,tr,Vn,jo,yo.vertical,["vertical"],Ys,aw,Cr,Zr,$n,ki));let hc=-1,hw=(no,ro)=>no?Math.max(no,ro):ro;hc=hw(ZM,hc),hc=hw(YM,hc),hc=hw(XM,hc);let xB=hc>-1?1:0;ft.glyphOffsetArray.length>=65535&&yr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tr.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,tr.sortKey),ft.symbolInstances.emplaceBack(Xe.x,Xe.y,Hu.x,Hu.y,Hu.z,Ys.right>=0?Ys.right:-1,Ys.center>=0?Ys.center:-1,Ys.left>=0?Ys.left:-1,Ys.vertical>=0?Ys.vertical:-1,sw,aw,tA,fs!==void 0?fs:ft.collisionBoxArray.length,fs!==void 0?fs+1:ft.collisionBoxArray.length,uc!==void 0?uc:ft.collisionBoxArray.length,uc!==void 0?uc+1:ft.collisionBoxArray.length,cc!==void 0?cc:ft.collisionBoxArray.length,cc!==void 0?cc+1:ft.collisionBoxArray.length,qu||ft.collisionBoxArray.length,qu?qu+1:ft.collisionBoxArray.length,Fn,JM,eA,KM,QM,xB,0,cw,uw,hc,0,1,1,lw?1:0)})(t,Ke,mt,We,n,a,l,Ge,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,me,De,y,0,xe,ke,V,e,d,b,T,D,P,R)};if(He==="line")for(let We of zC(e.geometry,0,0,Je,Je)){let Ke=XN(We,fe,Pe,n.vertical||Y,a,K,oe,t.overscaling,Je);for(let _t of Ke)Y&&nz(t,Y.text,Oe,_t)||at(We,_t,D)}else if(He==="line-center"){for(let We of e.geometry)if(We.length>1){let Ke=YN(We,Pe,n.vertical||Y,a,K,oe);Ke&&at(We,Ke,D)}}else if(e.type==="Polygon")for(let We of wy(e.geometry,0)){let Ke=QN(We,16);at(We[0],new qa(Ke.x,Ke.y,0,0,void 0),D)}else if(e.type==="LineString")for(let We of e.geometry)at(We,new qa(We[0].x,We[0].y,0,0,void 0),D);else if(e.type==="Point")for(let We of e.geometry)for(let Ke of We)at([Ke],new qa(Ke.x,Ke.y,0,0,void 0),D)}let bm=255,rc=bm*ss;function HC(t,e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N,V){let Y=function(ae,oe,fe,me,xe,Pe,De,ke){let He=[];if(oe.positionedLines.length===0)return He;let Oe=me.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,je=function(at){let We=at[0],Ke=at[1],_t=We*Ke;return _t>0?[We,-Ke]:_t<0?[-We,Ke]:We===0?[Ke,We]:[Ke,-We]}(fe),Re=Math.abs(oe.top-oe.bottom);for(let at of oe.positionedLines)Re-=at.lineOffset;let $e=oe.positionedLines.length,Ye=Re/$e,Ge=oe.top-fe[1];for(let at=0;at<$e;++at){let We=oe.positionedLines[at];Ge=KN(oe,Ye,Ge,at);for(let Ke of We.positionedGlyphs){if(!Ke.rect)continue;let _t=Ke.rect||{},mt=DC+1,ft=!0,Xe=1,yt=0;if(Ke.imageName){let pr=De[Ke.imageName];if(!pr)continue;if(pr.sdf){yr("SDF images are not supported in formatted text and will be ignored.");continue}ft=!1,Xe=pr.pixelRatio,mt=eo/Xe}let Ut=(xe||ke)&&Ke.vertical,Dt=Ke.metrics.advance*Ke.scale/2,Ht=Ke.metrics,Vt=Ke.rect;if(Vt===null)continue;ke&&oe.verticalizable&&(yt=Ke.imageName?Dt-Ke.metrics.width*Ke.scale/2:0);let Jt=xe?[Ke.x+Dt,Ke.y]:[0,0],Tt=[0,0],Nn=[0,0],Fn=!1;xe||(Ut?(Nn=[Ke.x+Dt+je[0],Ke.y+je[1]-yt],Fn=!0):Tt=[Ke.x+Dt+fe[0],Ke.y+fe[1]-yt]);let xn=Vt.w*Ke.scale/(Xe*(Ke.localGlyph?as:1)),an=Vt.h*Ke.scale/(Xe*(Ke.localGlyph?as:1)),bn,Hn,Vn,ur;if(Ut){let pr=Ke.y-Ge,tr=new rt(-Dt,Dt-pr),Cr=-Math.PI/2,Wr=new rt(...Nn);bn=new rt(-Dt+Tt[0],Tt[1]),bn._rotateAround(Cr,tr)._add(Wr),bn.x+=-pr+Dt,bn.y-=(Ht.left-mt)*Ke.scale;let Zr=Ke.imageName?Ht.advance*Ke.scale:si*Ke.scale,$n=String.fromCodePoint(Ke.glyph);VN($n)?bn.x+=(1-mt)*Ke.scale:jN($n)?bn.x+=Zr-Ht.height*Ke.scale+(-mt-1)*Ke.scale:bn.x+=Ke.imageName||Ht.width+2*mt===Vt.w&&Ht.height+2*mt===Vt.h?(Zr-an)/2:(Zr-(Ht.height+2*mt)*Ke.scale)/2,Hn=new rt(bn.x,bn.y-xn),Vn=new rt(bn.x+an,bn.y),ur=new rt(bn.x+an,bn.y-xn)}else{let pr=(Ht.left-mt)*Ke.scale-Dt+Tt[0],tr=(-Ht.top-mt)*Ke.scale+Tt[1],Cr=pr+xn,Wr=tr+an;bn=new rt(pr,tr),Hn=new rt(Cr,tr),Vn=new rt(pr,Wr),ur=new rt(Cr,Wr)}if(Oe){let pr;pr=xe?new rt(0,0):Fn?new rt(je[0],je[1]):new rt(fe[0],fe[1]),bn._rotateAround(Oe,pr),Hn._rotateAround(Oe,pr),Vn._rotateAround(Oe,pr),ur._rotateAround(Oe,pr)}let lr=new rt(0,0),_i=new rt(0,0);He.push({tl:bn,tr:Hn,bl:Vn,br:ur,texPrimary:_t,texSecondary:void 0,writingMode:oe.writingMode,glyphOffset:Jt,sectionIndex:Ke.sectionIndex,isSDF:ft,pixelOffsetTL:lr,pixelOffsetBR:_i,minFontScaleX:0,minFontScaleY:0})}}return He}(0,a,y,d,f,_,l,t.allowVerticalPlacement),X=t.textSizeData,K=null;X.kind==="source"?(K=[ss*d.layout.get("text-size").evaluate(_,{},N)],K[0]>rc&&yr(`${t.layerIds[0]}: Value for "text-size" is >= ${bm}. Reduce your "text-size".`)):X.kind==="composite"&&(K=[ss*R.compositeTextSizes[0].evaluate(_,{},N),ss*R.compositeTextSizes[1].evaluate(_,{},N)],(K[0]>rc||K[1]>rc)&&yr(`${t.layerIds[0]}: Value for "text-size" is >= ${bm}. Reduce your "text-size".`)),t.addSymbols(t.text,Y,K,y,f,_,T,e,n,b.lineStartIndex,b.lineLength,P,k,N,V,!1);for(let ae of D)S[ae]=t.text.placedSymbolArray.length-1;return 4*Y.length}function WC(t){for(let e in t)return t[e];return null}function Uy(t,e,n,a,l,d,f,_,y,b){let T=f.top,D=f.bottom,S=f.left,P=f.right,R=f.collisionPadding;if(R&&(S-=R[0],T-=R[1],P+=R[2],D+=R[3]),y){let k=new rt(S,T),N=new rt(P,T),V=new rt(S,D),Y=new rt(P,D),X=rn(y),K=new rt(0,0);b&&(K=new rt(b[0],b[1])),k._rotateAround(X,K),N._rotateAround(X,K),V._rotateAround(X,K),Y._rotateAround(X,K),S=Math.min(k.x,N.x,V.x,Y.x),P=Math.max(k.x,N.x,V.x,Y.x),T=Math.min(k.y,N.y,V.y,Y.y),D=Math.max(k.y,N.y,V.y,Y.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,S,T,P,D,_,a,l,d),t.length-1}function Rb(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function nz(t,e,n,a){let l=t.compareText;if(e in l){let d=l[e];for(let f=d.length-1;f>=0;f--)if(a.dist(d[f])<n)return!0}else l[e]=[];return l[e].push(a),!1}function ZC(t,e){let n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),d=Math.sin(n)*l/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),f=Math.sin(t._pitch)*d+l;return Math.min(1.01*f,l*(1/t._horizonShift))}function Uu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),a=t.x*n,l=(t.x+1)*n,d=t.y*n,f=(t.y+1)*n,_=Vi(a),y=Vi(l),b=Hr(d),T=Hr(f),D=e.project(_,b),S=e.project(y,b),P=e.project(y,T),R=e.project(_,T),k=Math.min(D.x,S.x,P.x,R.x),N=Math.min(D.y,S.y,P.y,R.y),V=Math.max(D.x,S.x,P.x,R.x),Y=Math.max(D.y,S.y,P.y,R.y),X=n/16;function K(oe,fe,me,xe,Pe,De){let ke=(me+Pe)/2,He=(xe+De)/2,Oe=e.project(Vi(ke),Hr(He)),je=Math.max(0,k-Oe.x,N-Oe.y,Oe.x-V,Oe.y-Y);k=Math.min(k,Oe.x),V=Math.max(V,Oe.x),N=Math.min(N,Oe.y),Y=Math.max(Y,Oe.y),je>X&&(K(oe,Oe,me,xe,ke,He),K(Oe,fe,ke,He,Pe,De))}K(D,S,a,d,l,d),K(S,P,l,d,l,f),K(P,R,l,f,a,f),K(R,D,a,f,a,d),k-=X,N-=X,V+=X,Y+=X;let ae=1/Math.max(V-k,Y-N);return{scale:ae,x:k*ae,y:N*ae,x2:V*ae,y2:Y*ae,projection:e}}function YC(t,{x:e,y:n},a=0){return new rt(((e-a)*t.scale-t.x)*Je,(n*t.scale-t.y)*Je)}let rz=r.ad.identity(new Float32Array(16));class ic{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new pn(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return Li(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return ZC(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,l){let d=e.horizonLineFromTop(!1),f=new rt(n,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,n,a){let l=new rt(n,a);if(e.elevation)return e.elevation.pointCoordinate(l);{let d=this.pointCoordinate(e,l.x,l.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return rz}createTileMatrix(e,n,a){let l,d,f,_=a.canonical,y=r.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=Uu(_,this);l=1,d=b.x+a.wrap*b.scale,f=b.y,r.ad.scale(y,y,[l/b.scale,l/b.scale,e.pixelsPerMeter/n])}else l=n/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*a.wrap)*l,f=_.y*l;return r.ad.translate(y,y,[d,f,0]),r.ad.scale(y,y,[l/Je,l/Je,1]),y}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class iz extends ic{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(rn(n));this.n=(l+Math.sin(rn(a)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c:l,r0:d}=this,f=rn(e-this.center[0]),_=rn(n),y=Math.sqrt(l-2*a*Math.sin(_))/a;return{x:y*Math.sin(f*a),y:y*Math.cos(f*a)-d,z:0}}unproject(e,n){let{n:a,c:l,r0:d}=this,f=d+n,_=Math.atan2(e,Math.abs(f))*Math.sign(f);f*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));let y=rn(this.center[0])*a;_=wa(_,-Math.PI-y,Math.PI-y);let b=Zt(ti(_/a)+this.center[0],-180,180),T=Math.asin(Zt((l-(e*e+f*f)*a*a)/(2*a),-1,1)),D=Zt(ti(T),-xr,xr);return new pn(b,D)}}let wm=1.340264,Em=-.081106,Tm=893e-6,Im=.003796,Vy=Math.sqrt(3)/2;class oz extends ic{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(Vy*Math.sin(n)),l=a*a,d=l*l*l;return{x:.5*(e*Math.cos(a)/(Vy*(wm+3*Em*l+d*(7*Tm+9*Im*l)))/Math.PI+.5),y:1-.5*(a*(wm+Em*l+d*(Tm+Im*l))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,l=a*a,d=l*l*l;for(let T,D,S,P=0;P<12&&(D=a*(wm+Em*l+d*(Tm+Im*l))-n,S=wm+3*Em*l+d*(7*Tm+9*Im*l),T=D/S,a=Zt(a-T,-Math.PI/3,Math.PI/3),l=a*a,d=l*l*l,!(Math.abs(T)<1e-12));++P);let f=Vy*e*(wm+3*Em*l+d*(7*Tm+9*Im*l))/Math.cos(a),_=Math.asin(Math.sin(a)/Vy),y=Zt(180*f/Math.PI,-180,180),b=Zt(180*_/Math.PI,-xr,xr);return new pn(y,b)}}class sz extends ic{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),l=Zt(360*(.5-n),-xr,xr);return new pn(a,l)}}let Fd=Math.PI/2;function jy(t){return Math.tan((Fd+t)/2)}class az extends ic{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],l=rn(n),d=rn(a);this.southernCenter=l+d<0,this.southernCenter&&(l=-l,d=-d);let f=Math.cos(l),_=jy(l);this.n=l===d?Math.sin(l):Math.log(f/Math.cos(d))/Math.log(jy(d)/_),this.f=f*Math.pow(jy(l),this.n)/this.n}project(e,n){n=rn(n),this.southernCenter&&(n=-n),e=rn(e-this.center[0]);let a=1e-6,{n:l,f:d}=this;d>0?n<-Fd+a&&(n=-Fd+a):n>Fd-a&&(n=Fd-a);let f=d/Math.pow(jy(n),l),_=f*Math.sin(l*e),y=d-f*Math.cos(l*e);return _=.5*(_/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:_,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:l}=this,d=l-n,f=Math.sign(d),_=Math.sign(a)*Math.sqrt(e*e+d*d),y=Math.atan2(e,Math.abs(d))*f;d*a<0&&(y-=Math.PI*Math.sign(e)*f);let b=Zt(ti(y/a)+this.center[0],-180,180),T=Zt(ti(2*Math.atan(Math.pow(l/_,1/a))-Fd),-xr,xr);return new pn(b,this.southernCenter?-T:T)}}class XC extends ic{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:$s(e),y:Gs(n),z:0}}unproject(e,n){let a=Vi(e),l=Hr(n);return new pn(a,l)}}let KC=rn(xr);class lz extends ic{project(e,n){let a=(n=rn(n))*n,l=a*a;return{x:.5*((e=rn(e))*(.8707-.131979*a+l*(l*(.003971*a-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+l*(.028874*a-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,l=25,d=0,f=a*a;do{f=a*a;let b=f*f;d=(a*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-n)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),a=Zt(a-d,-KC,KC)}while(Math.abs(d)>1e-6&&--l>0);f=a*a;let _=Zt(ti(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),y=ti(a);return new pn(_,y)}}let QC=rn(xr);class cz extends ic{project(e,n){n=rn(n),e=rn(e);let a=Math.cos(n),l=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),f=Math.sin(d)/d,_=.5*(e*l+2*a*Math.sin(e/2)/f)||0,y=.5*(n+Math.sin(n)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,l=n=(2*(1-n)-1)*Math.PI,d=25,f=1e-6,_=0,y=0;do{let b=Math.cos(l),T=Math.sin(l),D=2*T*b,S=T*T,P=b*b,R=Math.cos(a/2),k=Math.sin(a/2),N=2*R*k,V=k*k,Y=1-P*R*R,X=Y?1/Y:0,K=Y?Math.acos(b*R)*Math.sqrt(1/Y):0,ae=.5*(2*K*b*k+2*a/Math.PI)-e,oe=.5*(K*T+l)-n,fe=.5*X*(P*V+K*b*R*S)+1/Math.PI,me=X*(N*D/4-K*T*k),xe=.125*X*(D*k-K*T*P*N),Pe=.5*X*(S*R+K*V*b)+.5,De=me*xe-Pe*fe;_=(oe*me-ae*Pe)/De,y=(ae*xe-oe*fe)/De,a=Zt(a-_,-Math.PI,Math.PI),l=Zt(l-y,-QC,QC)}while((Math.abs(_)>f||Math.abs(y)>f)&&--d>0);return new pn(ti(a),ti(l))}}class JC extends ic{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(rn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:l}=this;return{x:rn(e)*l*a+.5,y:-Math.sin(rn(n))/l*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:l}=this,d=-(n-.5)/a,f=Zt(ti((e-.5)/a)/l,-180,180),_=Math.asin(Zt(d*l,-1,1)),y=Zt(ti(_),-xr,xr);return new pn(f,y)}}class uz extends XC{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let l=lm(e,n,a),d=cm(qs(a));return r._.transformMat4(l,l,d),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,n){let a=ku(n.lat,n.lng),l=r._.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,f=Li(1,0)*Je*d;r._.scaleAndAdd(a,a,l,f);let _=r.ad.identity(new Float64Array(16));return r.ad.multiply(_,e.pixelMatrix,e.globeMatrix),r._.transformMat4(a,a,_),new rt(a[0],a[1])}pixelsPerMeter(e,n){return Li(1,0)*n}pixelSpaceConversion(e,n,a){let l=Li(1,e)*n,d=wt(Li(1,45)*n,l,a);return this.pixelsPerMeter(e,n)/d}createTileMatrix(e,n,a){let l=cb(qs(a.canonical));return r.ad.multiply(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,n){let{center:a}=e,l=cm(qs(n));return r.ad.rotateY(l,l,rn(a.lng)),r.ad.rotateX(l,l,rn(a.lat)),r.ad.scale(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,n,a,l){return sS(e,n,a,!0)||new gi(0,0)}pointCoordinate3D(e,n,a){let l=this.pointCoordinate(e,n,a,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,n){return!sS(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(l,d){let f=l.cameraToCenterDistance,_=l._centerAltitude*d,y=l._camera,b=l._camera.forward(),T=r._.add([],r._.scale([],b,-f),[0,0,_]),D=l.worldSize/(2*Math.PI),S=[0,0,-D],P=l.width/l.height,R=Math.tan(l.fovAboveCenter),k=r._.scale([],y.up(),R),N=r._.scale([],y.right(),R*P),V=r._.normalize([],r._.add([],r._.add([],b,k),N)),Y=[],X;if(new ib(T,V).closestPointOnSphere(S,D,Y)){let K=r._.add([],Y,S),ae=r._.sub([],K,T);X=Math.cos(l.fovAboveCenter)*r._.length(ae)}else{let K=r._.sub([],T,S),ae=r._.sub([],S,T);r._.normalize(ae,ae);let oe=r._.length(K)-D;X=Math.sqrt(oe*(oe+2*D));let fe=Math.acos(X/(D+oe))-Math.acos(r._.dot(b,ae));X*=Math.cos(fe)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=$a(e.zoom);if(a>0){let l=ZC(e,Li(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wt(n,l+d*(1-Math.cos(f)),Math.pow(a,10))}return n}upVector(e,n,a){return lm(n,a,e,1)}upVectorScale(e){return{metersToTile:gy(yy(qs(e)))}}}function eM(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new XC(t);case"equirectangular":return new sz(t);case"naturalEarth":return new lz(t);case"equalEarth":return new oz(t);case"winkelTripel":return new cz(t);case"albers":return n?new JC(t):new iz(t);case"lambertConformalConic":return n?new JC(t):new az(t);case"globe":return new uz(t)}throw new Error(`Invalid projection name: ${t.name}`)}let hz=(()=>{class t{constructor(n,a,l,d){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let f=n.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||d||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class Nd{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}Nd.ReadOnly=!1,Nd.ReadWrite=!0,Nd.disabled=new Nd(519,Nd.ReadOnly,[0,1]);let Ob=7680;class Lb{constructor(e,n,a,l,d,f){this.test=e,this.ref=n,this.mask=a,this.fail=l,this.depthFail=d,this.pass=f}}Lb.disabled=new Lb({func:519,mask:0},0,0,Ob,Ob,Ob);let Dm=771;class to{constructor(e,n,a,l){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=l}}to.Replace=[1,0,1,0],to.disabled=new to(to.Replace,_n.transparent,[!1,!1,!1,!1]),to.unblended=new to(to.Replace,_n.transparent,[!0,!0,!0,!0]),to.alphaBlended=new to([1,Dm,1,Dm],_n.transparent,[!0,!0,!0,!0]),to.alphaBlendedNonPremultiplied=new to([770,Dm,770,Dm],_n.transparent,[!0,!0,!0,!0]),to.multiply=new to([774,0,774,0],_n.transparent,[!0,!0,!0,!0]);let kb=1029,Fb=2305;class ls{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}ls.disabled=new ls(!1,kb,Fb),ls.backCCW=new ls(!0,kb,Fb),ls.backCW=new ls(!0,kb,2304),ls.frontCW=new ls(!0,1028,2304),ls.frontCCW=new ls(!0,1028,Fb);let dz=Iy.types,fz=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $y(t,e,n,a,l,d,f,_,y,b,T,D,S){let P=_?Math.min(rc,Math.round(_[0])):0,R=_?Math.min(rc,Math.round(_[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*l),d,f,(P<<1)+(y?1:0),R,16*b,16*T,256*D,256*S)}function Gy(t,e,n){t.emplaceBack(e,n)}function qy(t,e,n,a,l,d,f){t.emplaceBack(e,n,a,l,d,f)}function Hy(t,e,n,a,l){t.emplaceBack(e,n,a,l),t.emplaceBack(e,n,a,l),t.emplaceBack(e,n,a,l),t.emplaceBack(e,n,a,l)}function pz(t){for(let e of t.sections)if(Le(e.text))return!0;return!1}class Nb{constructor(e){this.layoutVertexArray=new S1,this.indexArray=new Fr,this.programConfigurations=e,this.segments=new sr,this.dynamicLayoutVertexArray=new ql,this.opacityVertexArray=new M1,this.occlusionQueryOpacityVertexArray=new Ru,this.placedSymbolArray=new AD,this.iconTransitioningVertexArray=new Zl,this.globeExtVertexArray=new C1,this.zOffsetVertexArray=new Ru}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,l,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mN.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,_N.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,fz,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,wb.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,yN.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gN.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,lC.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Q(Nb,"SymbolBuffers");class zb{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new sr,this.collisionVertexArray=new R1,this.collisionVertexArrayExt=new ql}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vN.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,xN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Q(zb,"CollisionBuffers");class zd{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.ad.identity([]),this.placementViewportMatrix=r.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tb(this.zoom,n["text-size"]),this.iconSizeData=Tb(this.zoom,n["icon-size"]);let a=this.layers[0].layout,l=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(f=>yo[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Nb(new Xl(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new Nb(new Xl(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new OD,this.lineVertexArray=new LD,this.symbolInstances=new RD}calculateGlyphDependencies(e,n,a,l,d){for(let f=0;f<e.length;f++){let _=e.codePointAt(f);if(_===void 0)break;if(n[_]=!0,l&&d&&_<=65535){let y=ym[e.charAt(f)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!xb(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,l){let d=this.layers[0],f=d.layout,_=this.projection.name==="globe",y=f.get("text-font"),b=f.get("text-field"),T=f.get("icon-image"),D=(b.value.kind!=="constant"||b.value.value instanceof ri&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),S=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!D&&!S)return;let R=n.iconDependencies,k=n.glyphDependencies,N=n.availableImages,V=new Ot(this.zoom);for(let{feature:Y,id:X,index:K,sourceLayerIndex:ae}of e){let oe=d._featureFilter.needGeometry,fe=Va(Y,oe);if(!d._featureFilter.filter(V,fe,a))continue;if(oe||(fe.geometry=os(Y,a,l)),_&&Y.type!==1&&a.z<=5){let De=fe.geometry,ke=.98078528056,He=(Oe,je)=>{let Re=lm(Oe.x,Oe.y,a,1),$e=lm(je.x,je.y,a,1);return r._.dot(Re,$e)<ke};for(let Oe=0;Oe<De.length;Oe++)De[Oe]=QF(De[Oe],He)}let me,xe;if(D){let De=d.getValueAndResolveTokens("text-field",fe,a,N),ke=ri.factory(De);pz(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||on()==="unavailable"||this.hasRTLText&&Cn.isParsed())&&(me=UN(ke,d,fe))}if(S){let De=d.getValueAndResolveTokens("icon-image",fe,a,N);xe=De instanceof bi?De:bi.fromString(De)}if(!me&&!xe)continue;let Pe=this.sortFeaturesByKey?P.evaluate(fe,{},a):void 0;if(this.features.push({id:X,text:me,icon:xe,index:K,sourceLayerIndex:ae,geometry:fe.geometry,properties:Y.properties,type:dz[Y.type],sortKey:Pe}),xe&&(R[xe.namePrimary]=!0,xe.nameSecondary&&(R[xe.nameSecondary]=!0)),me){let De=y.evaluate(fe,{},a).join(","),ke=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(yo.vertical)>=0;for(let He of me.sections)if(He.image)R[He.image.namePrimary]=!0;else{let Oe=Te(me.toString()),je=He.fontStack||De,Re=k[je]=k[je]||{};this.calculateGlyphDependencies(He.text,Re,ke,this.allowVerticalPlacement,Oe)}}}f.get("symbol-placement")==="line"&&(this.features=function(Y){let X={},K={},ae=[],oe=0;function fe(De){ae.push(Y[De]),oe++}function me(De,ke,He){let Oe=K[De];return delete K[De],K[ke]=Oe,ae[Oe].geometry[0].pop(),ae[Oe].geometry[0]=ae[Oe].geometry[0].concat(He[0]),Oe}function xe(De,ke,He){let Oe=X[ke];return delete X[ke],X[De]=Oe,ae[Oe].geometry[0].shift(),ae[Oe].geometry[0]=He[0].concat(ae[Oe].geometry[0]),Oe}function Pe(De,ke,He){let Oe=He?ke[0][ke[0].length-1]:ke[0][0];return`${De}:${Oe.x}:${Oe.y}`}for(let De=0;De<Y.length;De++){let ke=Y[De],He=ke.geometry,Oe=ke.text?ke.text.toString():null;if(!Oe){fe(De);continue}let je=Pe(Oe,He),Re=Pe(Oe,He,!0);if(je in K&&Re in X&&K[je]!==X[Re]){let $e=xe(je,Re,He),Ye=me(je,Re,ae[$e].geometry);delete X[je],delete K[Re],K[Pe(Oe,ae[Ye].geometry,!0)]=Ye,ae[$e].geometry=null}else je in K?me(je,Re,He):Re in X?xe(je,Re,He):(fe(De),X[je]=oe-1,K[Re]=oe-1)}return ae.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,X)=>Y.sortKey-X.sortKey)}update(e,n,a,l,d){let f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;let _=f?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,_,a,l,d),this.icon.programConfigurations.updatePaintArrays(e,n,_,a,l,d)}updateOcclusionOpacities(e,n,a){if(!n.useOcclusionQueries)return!1;let l=this;if(l.projection.name==="globe")return!1;let d=!1;l.hasTextData()&&(d=d||l.text.occlusionQueryOpacityVertexArray.length!==0),l.hasIconData()&&(d=d||l.icon.occlusionQueryOpacityVertexArray.length!==0);let f=l.layers[0].paint,_=f.get("icon-occlusion-opacity").constantOr(0)!==1,y=f.get("text-occlusion-opacity").constantOr(0)!==1;if(!_&&!y)return!1;let b=!d;for(let P=0;P<l.symbolInstances.length;P++){let R=l.symbolInstances.get(P),k=R.occlusionOpacity;R.occlusionOpacity+=(R.occlusionState>.5?1:-1)*n.fadeSpeed*a*.001,R.occlusionOpacity=Zt(R.occlusionOpacity,0,1),b=b||R.occlusionOpacity!==k}if(!b)return!1;let T=0,D=0,S=(P,R,k,N)=>{let V=0,Y=0;k?(V=D,D+=N,Y=D):(V=T,T+=N,Y=T),Y>R.occlusionQueryOpacityVertexArray.length&&R.occlusionQueryOpacityVertexArray.resize(Y);let X=P.occlusionOpacity;for(let K=0;K<N;K++)R.occlusionQueryOpacityVertexArray.emplace(K+V,X)};for(let P=0;P<l.symbolInstances.length;P++){let R=l.symbolInstances.get(P),{numHorizontalGlyphVertices:k,numVerticalGlyphVertices:N,numIconVertices:V}=R,Y=V>0;if((k>0||N>0)&&(S(R,l.text,!1,k),S(R,l.text,!1,N)),Y){let{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:K}=R;X>=0&&S(R,l.icon,!0,V),K>=0&&S(R,l.icon,!0,R.numVerticalIconVertices)}}return l.hasTextData()&&l.text.occlusionQueryOpacityVertexBuffer&&(l.text.occlusionQueryOpacityVertexBuffer.length<l.text.occlusionQueryOpacityVertexArray.length?l.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(l.text.occlusionQueryOpacityVertexArray,wb.members,!0):l.text.occlusionQueryOpacityVertexBuffer.updateData(l.text.occlusionQueryOpacityVertexArray)),l.hasIconData()&&l.icon.occlusionQueryOpacityVertexBuffer&&(l.icon.occlusionQueryOpacityVertexBuffer.length<l.icon.occlusionQueryOpacityVertexArray.length?l.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(l.icon.occlusionQueryOpacityVertexArray,wb.members,!0):l.icon.occlusionQueryOpacityVertexBuffer.updateData(l.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(d,f,_)=>{a+=f,a>d.length&&d.resize(a);for(let y=-f;y<0;y++)d.emplace(y+a,_)},n=(d,f,_)=>{l+=f,l>d.length&&d.resize(l);for(let y=-f;y<0;y++)d.emplace(y+l,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,l=0;for(let d=0;d<this.symbolInstances.length;d++){let f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:y,numIconVertices:b}=f,T=f.zOffset,D=b>0;if((_>0||y>0)&&(e(this.text.zOffsetVertexArray,_,T),e(this.text.zOffsetVertexArray,y,T)),D){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:P}=f;S>=0&&n(this.icon.zOffsetVertexArray,b,T),P>=0&&n(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=eM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:l,y:d}of n)this.lineVertexArray.emplaceBack(l,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,l,d,f,_,y,b,T,D,S,P,R,k,N){let V=e.indexArray,Y=e.layoutVertexArray,X=e.globeExtVertexArray,K=e.segments.prepareSegment(4*n.length,Y,V,this.canOverlap?f.sortKey:void 0),ae=this.glyphOffsetArray.length,oe=K.vertexLength,fe=this.allowVerticalPlacement&&_===yo.vertical?Math.PI/2:0,me=f.text&&f.text.sections;for(let Pe=0;Pe<n.length;Pe++){let{tl:De,tr:ke,bl:He,br:Oe,texPrimary:je,texSecondary:Re,pixelOffsetTL:$e,pixelOffsetBR:Ye,minFontScaleX:Ge,minFontScaleY:at,glyphOffset:We,isSDF:Ke,sectionIndex:_t}=n[Pe],mt=K.vertexLength,ft=We[1];if($y(Y,b.x,b.y,De.x,ft+De.y,je.x,je.y,a,Ke,$e.x,$e.y,Ge,at),$y(Y,b.x,b.y,ke.x,ft+ke.y,je.x+je.w,je.y,a,Ke,Ye.x,$e.y,Ge,at),$y(Y,b.x,b.y,He.x,ft+He.y,je.x,je.y+je.h,a,Ke,$e.x,Ye.y,Ge,at),$y(Y,b.x,b.y,Oe.x,ft+Oe.y,je.x+je.w,je.y+je.h,a,Ke,Ye.x,Ye.y,Ge,at),y){let{x:Xe,y:yt,z:Ut}=y.anchor,[Dt,Ht,Vt]=y.up;qy(X,Xe,yt,Ut,Dt,Ht,Vt),qy(X,Xe,yt,Ut,Dt,Ht,Vt),qy(X,Xe,yt,Ut,Dt,Ht,Vt),qy(X,Xe,yt,Ut,Dt,Ht,Vt),Hy(e.dynamicLayoutVertexArray,Xe,yt,Ut,fe)}else Hy(e.dynamicLayoutVertexArray,b.x,b.y,b.z,fe);if(N){let Xe=Re||je;Gy(e.iconTransitioningVertexArray,Xe.x,Xe.y),Gy(e.iconTransitioningVertexArray,Xe.x+Xe.w,Xe.y),Gy(e.iconTransitioningVertexArray,Xe.x,Xe.y+Xe.h),Gy(e.iconTransitioningVertexArray,Xe.x+Xe.w,Xe.y+Xe.h)}V.emplaceBack(mt,mt+1,mt+2),V.emplaceBack(mt+1,mt+2,mt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(We[0]),Pe!==n.length-1&&_t===n[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,f,f.index,{},P,R,k,me&&me[_t])}let xe=y?y.anchor:b;e.placedSymbolArray.emplaceBack(xe.x,xe.y,xe.z,b.x,b.y,ae,this.glyphOffsetArray.length-ae,oe,T,D,b.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],_,0,!1,0,S,0)}_commitLayoutVertex(e,n,a,l,d,f,_){e.emplaceBack(n,a,l,d,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,a,l,d,f,_){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=y.vertexLength,T=_.tileAnchorX,D=_.tileAnchorY;for(let P=0;P<4;P++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,l,d,f,T,D,new rt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,d,f,T,D,new rt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,d,f,T,D,new rt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,l,d,f,T,D,new rt(e.x1,e.y2)),y.vertexLength+=4;let S=a.indexArray;S.emplaceBack(b,b+1),S.emplaceBack(b+1,b+2),S.emplaceBack(b+2,b+3),S.emplaceBack(b+3,b),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,l,d,f){for(let _=l;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,f,n,_);this._addCollisionDebugVertices(y,b,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,n,a,l,d,f){for(let _=l;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._addCollisionDebugVertices(y,b,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zb(ay,cC.members,Zl),this.iconCollisionBox=new zb(ay,cC.members,Zl);let a=Rd(this.iconSizeData,e),l=Rd(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let f=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(l,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(l,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(a,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(a,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,n,a,l){let d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:l),f=ky(this.textSizeData,e,d)/si;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,n,a){let l=this.icon.placedSymbolArray.get(a),d=ky(this.iconSizeData,e,l);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,a,l){e.emplaceBack(n,-a,-a,l),e.emplaceBack(n,a,-a,l),e.emplaceBack(n,a,a,l),e.emplaceBack(n,-a,a,l)}_updateTextDebugCollisionBoxes(e,n,a,l,d,f){for(let _=l;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceTextSize(e,f,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,y.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,l,d,f){for(let _=l;_<d;_++){let y=a.get(_),b=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding,f.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=Rd(this.iconSizeData,e),l=Rd(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let f=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(l,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(l,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(a,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._updateIconDebugCollisionBoxes(a,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,l,d,f,_,y,b){let T={};if(n<a){let{x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(n);T.textBox={x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.textFeatureIndex=ae}if(l<d){let{x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(l);T.verticalTextBox={x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.verticalTextFeatureIndex=ae}if(f<_){let{x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(f);T.iconBox={x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.iconFeatureIndex=ae}if(y<b){let{x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(y);T.verticalIconBox={x1:D,y1:S,x2:P,y2:R,padding:k,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.verticalIconFeatureIndex=ae}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),l=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<l;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),l=[],d=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);let y=this.symbolInstances.get(_);l.push(0|Math.round(n*y.tileAnchorX+a*y.tileAnchorY)),d.push(y.featureIndex)}return f.sort((_,y)=>l[_]-l[y]||d[y]-d[_]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:b}=a;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==l&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Q(zd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),zd.addDynamicAttributes=Hy;class Uo{constructor(e,n,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,a){let{width:l,height:d}=e,{context:f}=this,{gl:_}=f;if(_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===l&&this.size[1]===d){let{x:y,y:b}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,y,b,_.RGBA,_.UNSIGNED_BYTE,e);else{let T=this.format,D=_.UNSIGNED_BYTE;this.format===_.R32F&&(T=_.RED,D=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,y,b,l,d,T,D,e.data)}}else if(this.size=[l,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===_.R8&&(y=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,y,_.UNSIGNED_BYTE,e)}else{let y=this.format,b=this.format,T=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,T=_.UNSIGNED_SHORT),this.format===_.R8&&(b=_.RED),this.format===_.R32F&&(T=_.FLOAT,b=_.RED),_.texImage2D(_.TEXTURE_2D,0,y,l,d,0,b,T,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,a=!1){let{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,l){let{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),this.wrapS=a),l!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Wy{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,n),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Vo=32,Ws=33,oc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,l=0,d=0,f=0,_=0;for(1&e?l=d=f=Vo:n=a=_=Vo;(e>>=1)>1;){let b=n+l>>1,T=a+d>>1;1&e?(l=n,d=a,n=f,a=_):(n=l,a=d,l=f,d=_),f=b,_=T}let y=4*t;oc[y+0]=n,oc[y+1]=a,oc[y+2]=l,oc[y+3]=d}let Zs=new Uint16Array(2178),sc=new Uint8Array(1089),Zy=new Uint16Array(1089);function tM(t){return t===0?-.03125:t===32?.03125:0}var Yy=In([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),mz=In([{name:"a_index",type:"Int16",components:1}]);let nM={type:2,extent:Je,loadGeometry:()=>[[new rt(0,0),new rt(Je+1,0),new rt(Je+1,Je+1),new rt(0,Je+1),new rt(0,0)]]};class Xy{constructor(e,n,a,l,d){this.tileID=e,this.uid=kh(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,l&&l.style&&(this._lastUpdatedBrightness=l.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Gr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Uu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,d){let f={};if(!d)return f;for(let _ of l){let y=_.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(let b of y)f[b.fqid]=_}}return f}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let l in this.buckets){let d=this.buckets[l];if(d instanceof zd){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let l in this.buckets){let d=this.buckets[l];if(d instanceof zd&&d.hasRTLText){this.hasRTLText=!0,Cn.isLoading()||Cn.isLoaded()||on()!=="deferred"||tn();break}}this.queryPadding=0;for(let l in this.buckets){let d=this.buckets[l],f=n.style.getOwnLayer(l);if(!f)continue;let _=f.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new U1}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let l in this.buckets){let d=this.buckets[l];d.uploadPending()&&d.upload(e)}let n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let l=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new Uo(e,a.image,n.RGBA,{useMipmap:l}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Uo(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Uo(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let l=n.style.getBrightness();(this._lastUpdatedBrightness||l)&&(this._lastUpdatedBrightness&&l&&Math.abs(this._lastUpdatedBrightness-l)<.001||(this._lastUpdatedBrightness=l,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,l,d,f,_,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:_,transform:f,params:d,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let l=a.loadVTLayers(),d=n?n.sourceLayer:"",f=l._geojsonTileLayer||l[d];if(!f)return;let _=mi(n&&n.filter),{z:y,x:b,y:T}=this.tileID.canonical,D={z:y,x:b,y:T};for(let S=0;S<f.length;S++){let P=f.feature(S);if(_.needGeometry){let N=Va(P,!0);if(!_.filter(new Ot(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!_.filter(new Ot(this.tileID.overscaledZ),P))continue;let R=a.getId(P,d),k=new EC(P,y,b,T,R);k.tile=D,e.push(k)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let a=lp(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{let d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),l=n.style.listImages(),d=n.style.getBrightness();for(let f in this.buckets){if(!n.style.hasLayer(f))continue;let _=this.buckets[f],y=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],T={};if(e&&(T=e[y],!b||!T||Object.keys(T).length===0))continue;if(_.update(T,b,l,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),_ instanceof Py||_ instanceof Ey){let S=n.style.getOwnSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&S&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(S.id,this.tileID)}let D=n&&n.style&&n.style.getOwnLayer(f);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Gr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Gr.now()+e}setTexture(e,n){let a=n.context,l=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Uo?this.texture.update(e,{useMipmap:!0}):(this.texture=new Uo(a,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,n){let a={};for(let l of n)a[l]=!0;this.dependencies[e]=a}hasDependency(e,n){for(let a of e){let l=this.dependencies[a];if(l){for(let d of n)if(l[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let a=os(nM,this.tileID.canonical,this.tileTransform)[0],l=new rs,d=new tm;for(let f=0;f<a.length;f++){let{x:_,y}=a[f];l.emplaceBack(_,y),d.emplaceBack(f)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(l,am.members),this._tileDebugSegments=sr.simpleSegment(0,0,l.length,d.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let a=os(nM,this.tileID.canonical,this.tileTransform)[0],l,d;if(this.isRaster){let f=function(_,y){let b=Uu(_,y),T=Math.pow(2,_.z);for(let N=0;N<Ws;N++)for(let V=0;V<Ws;V++){let Y=Vi((_.x+(V+tM(V))/Vo)/T),X=Hr((_.y+(N+tM(N))/Vo)/T),K=y.project(Y,X),ae=N*Ws+V;Zs[2*ae+0]=Math.round((K.x*b.scale-b.x)*Je),Zs[2*ae+1]=Math.round((K.y*b.scale-b.y)*Je)}sc.fill(0),Zy.fill(0);for(let N=2045;N>=0;N--){let V=4*N,Y=oc[V+0],X=oc[V+1],K=oc[V+2],ae=oc[V+3],oe=Y+K>>1,fe=X+ae>>1,me=oe+fe-X,xe=fe+Y-oe,Pe=X*Ws+Y,De=ae*Ws+K,ke=fe*Ws+oe,He=Math.hypot((Zs[2*Pe+0]+Zs[2*De+0])/2-Zs[2*ke+0],(Zs[2*Pe+1]+Zs[2*De+1])/2-Zs[2*ke+1])>=16;sc[ke]=sc[ke]||(He?1:0),N<1022&&(sc[ke]=sc[ke]||sc[(X+xe>>1)*Ws+(Y+me>>1)]||sc[(ae+xe>>1)*Ws+(K+me>>1)])}let D=new Gl,S=new Fr,P=0;function R(N,V){let Y=V*Ws+N;return Zy[Y]===0&&(D.emplaceBack(Zs[2*Y+0],Zs[2*Y+1],N*Je/Vo,V*Je/Vo),Zy[Y]=++P),Zy[Y]-1}function k(N,V,Y,X,K,ae){let oe=N+Y>>1,fe=V+X>>1;if(Math.abs(N-K)+Math.abs(V-ae)>1&&sc[fe*Ws+oe])k(K,ae,N,V,oe,fe),k(Y,X,K,ae,oe,fe);else{let me=R(N,V),xe=R(Y,X),Pe=R(K,ae);S.emplaceBack(me,xe,Pe)}}return k(0,0,Vo,Vo,Vo,0),k(Vo,Vo,0,0,0,Vo),{vertices:D,indices:S}}(this.tileID.canonical,n);l=f.vertices,d=f.indices}else{l=new Gl,d=new Fr;for(let{x:_,y}of a)l.emplaceBack(_,y,0,0);let f=hm(l.int16,void 0,4);for(let _=0;_<f.length;_+=3)d.emplaceBack(f[_],f[_+1],f[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,Yy.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=sr.simpleSegment(0,0,l.length,d.length)}_makeGlobeTileDebugBuffers(e,n){let a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;let l=this.tileID.canonical,d=cm(aS(l,n)),f=$a(n.zoom),_;f>0&&(_=r.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,n,d,_,f),this._makeGlobeTileDebugTextBuffer(e,l,n,d,_,f)}_globePoint(e,n,a,l,d,f,_){let y=lm(e,n,a);if(f){let b=1<<a.z,T=$s(l.center.lng),D=Gs(l.center.lat),S=(a.x+.5)/b-T,P=0;S>.5?P=-1:S<-.5&&(P=1);let R=(e/Je+a.x)/b+P,k=(n/Je+a.y)/b;R=(R-T)*l._pixelsPerMercatorPixel+T,k=(k-D)*l._pixelsPerMercatorPixel+D;let N=[R*l.worldSize,k*l.worldSize,0];r._.transformMat4(N,N,f),y=ja(y,N,_)}return r._.transformMat4(y,y,d)}_makeGlobeTileDebugBorderBuffer(e,n,a,l,d,f){let _=new rs,y=new tm,b=new iy,T=(S,P,R,k,N)=>{let V=(R-S)/(N-1),Y=(k-P)/(N-1),X=_.length;for(let K=0;K<N;K++){let ae=S+K*V,oe=P+K*Y;_.emplaceBack(ae,oe);let fe=this._globePoint(ae,oe,n,a,l,d,f);b.emplaceBack(fe[0],fe[1],fe[2]),y.emplaceBack(X+K)}},D=Je;T(0,0,D,0,16),T(D,0,D,D,16),T(D,D,0,D,16),T(0,D,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(_,am.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,oS.members),this._tileDebugSegments=sr.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,a,l,d,f){let _=Je/4,y=new rs,b=new Fr,T=new iy,D=25;b.reserve(32),y.reserve(D),T.reserve(D);let S=(P,R)=>D*P+R;for(let P=0;P<D;P++){let R=P*_;for(let k=0;k<D;k++){let N=k*_;y.emplaceBack(N,R);let V=this._globePoint(N,R,n,a,l,d,f);T.emplaceBack(V[0],V[1],V[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){let k=S(P,R),N=S(P,R+1),V=S(P+1,R),Y=S(P+1,R+1);b.emplaceBack(k,N,V),b.emplaceBack(V,N,Y)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(y,am.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,oS.members),this._tileDebugTextSegments=sr.simpleSegment(0,0,D,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Uo&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Ft={read:function(t,e){return t.readFields(Ft._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(Ft.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Ft.Filter.read=function(t,e){return t.readFields(Ft.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Ft.Filter._readField=function(t,e,n){t===1?(e.delta_filter=Ft.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Ft.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Ft.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Ft.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},Ft.Filter.Delta={},Ft.Filter.Delta.read=function(t,e){return t.readFields(Ft.Filter.Delta._readField,{block_size:0},e)},Ft.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},Ft.Filter.Zigzag={},Ft.Filter.Zigzag.read=function(t,e){return t.readFields(Ft.Filter.Zigzag._readField,{},e)},Ft.Filter.Zigzag._readField=function(t,e,n){},Ft.Filter.BitShuffle={},Ft.Filter.BitShuffle.read=function(t,e){return t.readFields(Ft.Filter.BitShuffle._readField,{},e)},Ft.Filter.BitShuffle._readField=function(t,e,n){},Ft.Filter.ByteShuffle={},Ft.Filter.ByteShuffle.read=function(t,e){return t.readFields(Ft.Filter.ByteShuffle._readField,{},e)},Ft.Filter.ByteShuffle._readField=function(t,e,n){},Ft.Codec={},Ft.Codec.read=function(t,e){return t.readFields(Ft.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Ft.Codec._readField=function(t,e,n){t===1?(e.gzip_data=Ft.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Ft.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Ft.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=Ft.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},Ft.Codec.GzipData={},Ft.Codec.GzipData.read=function(t,e){return t.readFields(Ft.Codec.GzipData._readField,{},e)},Ft.Codec.GzipData._readField=function(t,e,n){},Ft.Codec.JpegImage={},Ft.Codec.JpegImage.read=function(t,e){return t.readFields(Ft.Codec.JpegImage._readField,{},e)},Ft.Codec.JpegImage._readField=function(t,e,n){},Ft.Codec.WebpImage={},Ft.Codec.WebpImage.read=function(t,e){return t.readFields(Ft.Codec.WebpImage._readField,{},e)},Ft.Codec.WebpImage._readField=function(t,e,n){},Ft.Codec.PngImage={},Ft.Codec.PngImage.read=function(t,e){return t.readFields(Ft.Codec.PngImage._readField,{},e)},Ft.Codec.PngImage._readField=function(t,e,n){},Ft.DataIndexEntry={},Ft.DataIndexEntry.read=function(t,e){return t.readFields(Ft.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Ft.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(Ft.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=Ft.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},Ft.Layer={},Ft.Layer.read=function(t,e){return t.readFields(Ft.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Ft.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(Ft.DataIndexEntry.read(n,n.readVarint()+n.pos))};let cs={read:function(t,e){return t.readFields(cs._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=cs.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=cs.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};cs.Uint32Values.read=function(t,e){return t.readFields(cs.Uint32Values._readField,{values:[]},e)},cs.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let l=function(f){return f.type===2?f.readVarint()+f.pos:f.pos+1}(a),d=a.pos;return a.pos=l,function(f){a.pos=d;let _=0;for(;a.pos<l;){let y=a.readVarint();f[_++]=y}return f}}(n))},cs.Fixed32Values={},cs.Fixed32Values.read=function(t,e){return t.readFields(cs.Fixed32Values._readField,{values:[]},e)},cs.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class gz{constructor(e=0,n=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(n=a.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,a=!1,l=this.resetTtl){let d;if(a||this.has(e)){if(d=this.items[e],d.value=n,a===!1&&l&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){let f=this.last,_=d.next,y=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,f.next=d,y!==null&&(y.next=_),_!==null&&(_.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=d:this.last.next=d;return this.last=d,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function _z(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){let l=a===1?1:0,d=a===2?1:0;for(let f=0;f<e[0];f++){let _=e[1]*f;for(let y=l;y<e[1];y++){let b=e[2]*(y+_);for(let T=d;T<e[2];T++){let D=e[3]*(T+b);for(let S=0;S<e[3];S++){let P=D+S;t[P]+=t[P-n]}}}}n*=e[a]}return t}function yz(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function vz(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let a=t[n],l=t[n+1];t[n]=(240&a)>>4|(61440&a)>>8|(240&l)<<4|61440&l,t[n+1]=15&a|(3840&a)>>4|(15&l)<<8|(3840&l)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let a=t[n],l=t[n+1],d=t[n+2],f=t[n+3];t[n+0]=(192&a)>>6|(192&l)>>4|(192&d)>>2|192&f,t[n+1]=(48&a)>>4|(48&l)>>2|48&d|(48&f)<<2,t[n+2]=(12&a)>>2|12&l|(12&d)<<2|(12&f)<<4,t[n+3]=3&a|(3&l)<<2|(3&d)<<4|(3&f)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class ac extends Error{constructor(e){super(e),this.name="MRTError"}}var vo=Uint8Array,Bd=Uint16Array,xz=Int32Array,rM=new vo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),iM=new vo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bz=new vo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),oM=function(t,e){for(var n=new Bd(31),a=0;a<31;++a)n[a]=e+=1<<t[a-1];var l=new xz(n[30]);for(a=1;a<30;++a)for(var d=n[a];d<n[a+1];++d)l[d]=d-n[a]<<5|a;return{b:n,r:l}},sM=oM(rM,2),aM=sM.b,wz=sM.r;aM[28]=258,wz[258]=28;for(var Ez=oM(iM,0).b,Bb=new Bd(32768),Er=0;Er<32768;++Er){var Ud=(43690&Er)>>1|(21845&Er)<<1;Bb[Er]=((65280&(Ud=(61680&(Ud=(52428&Ud)>>2|(13107&Ud)<<2))>>4|(3855&Ud)<<4))>>8|(255&Ud)<<8)>>1}var Sm=function(t,e,n){for(var a=t.length,l=0,d=new Bd(e);l<a;++l)t[l]&&++d[t[l]-1];var f,_=new Bd(e);for(l=1;l<e;++l)_[l]=_[l-1]+d[l-1]<<1;if(n){f=new Bd(1<<e);var y=15-e;for(l=0;l<a;++l)if(t[l])for(var b=l<<4|t[l],T=e-t[l],D=_[t[l]-1]++<<T,S=D|(1<<T)-1;D<=S;++D)f[Bb[D]>>y]=b}else for(f=new Bd(a),l=0;l<a;++l)t[l]&&(f[l]=Bb[_[t[l]-1]++]>>15-t[l]);return f},Cm=new vo(288);for(Er=0;Er<144;++Er)Cm[Er]=8;for(Er=144;Er<256;++Er)Cm[Er]=9;for(Er=256;Er<280;++Er)Cm[Er]=7;for(Er=280;Er<288;++Er)Cm[Er]=8;var lM=new vo(32);for(Er=0;Er<32;++Er)lM[Er]=5;var Tz=Sm(Cm,9,1),Iz=Sm(lM,5,1),Ub=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},us=function(t,e,n){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&n},Vb=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},Dz=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],hs=function(t,e,n){var a=new Error(e||Dz[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,hs),!n)throw a;return a},Sz=new vo(0),Cz=typeof TextDecoder<"u"&&new TextDecoder;try{Cz.decode(Sz,{stream:!0})}catch{}let Mz={gzip_data:"gzip"},Az={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Pz={uint32:1,uint16:2,uint8:4},Rz={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class jb{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new ac("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new ac(`Expected header with length >= ${a} but got buffer of length ${n.length}`);let l=new Pd(n.subarray(0,a)),d=Ft.read(l);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new ac(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let f of d.layers)this.layers[f.name]=new Oz(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],a=this.getLayer(e.layerName);for(let l=0;l<a.dataIndex.length;l++){let d=a.dataIndex[l],f=d.first_byte-e.firstByte,_=d.last_byte+1-e.firstByte;if(l<e.firstBlock||l>e.lastBlock||a._blocksInProgress.has(l))continue;let y={layerName:a.name,firstByte:f,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:l,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(b=>b.filter)};a._blocksInProgress.add(l),n.push(y)}return new cM(n,()=>{n.forEach(l=>a._blocksInProgress.delete(l.blockIndex))},(l,d)=>{if(n.forEach(f=>a._blocksInProgress.delete(f.blockIndex)),l)throw l;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class Oz{constructor({version:e,name:n,units:a,tilesize:l,pixel_format:d,buffer:f,data_index:_},y){if(this.version=e,this.version!==1)throw new ac(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=l,this.buffer=f,this.pixelFormat=Az[d],this.dataIndex=_,this.bandShape=[l+2*f,l+2*f,Pz[this.pixelFormat]],this._decodedBlocks=function(b=1e3,T=0,D=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof D!="boolean")throw new TypeError("Invalid resetTtl value");return new gz(b,T,D)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[a,l]of this.dataIndex.entries()){for(let[d,f]of l.bands.entries())if(f===e)return{bandIndex:n+d,blockIndex:a,blockBandIndex:d};n+=l.bands.length}break;case"number":for(let[a,l]of this.dataIndex.entries()){if(e>=n&&e<n+l.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=l.bands.length}break;default:throw new ac(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new ac(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0,l=1/0,d=-1/0;for(let f of e){let{blockIndex:_}=this.getBlockForBand(f);if(_<0)throw new ac(`Invalid band: ${JSON.stringify(f)}`);let y=this.dataIndex[_];l=Math.min(l,_),d=Math.max(d,_),n=Math.min(n,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:a,firstBlock:l,lastBlock:d}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),l=this._decodedBlocks.get(n.toString());if(!l)throw new ac(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let d=this.dataIndex[n],f=this.bandShape.reduce((b,T)=>b*T,1),_=a*f,y=l.subarray(_,_+f);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class cM{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}jb.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:a,firstByte:l,lastByte:d,pixelFormat:f,blockShape:_,blockIndex:y,filters:b,codec:T}=n,D=new Uint8Array(t).subarray(l,d+1),S=new Uint32Array(_[0]*_[1]*_[2]),P;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return P=function(R,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((X=function(oe){oe[0]==31&&oe[1]==139&&oe[2]==8||hs(6,"invalid gzip data");var fe=oe[3],me=10;4&fe&&(me+=2+(oe[10]|oe[11]<<8));for(var xe=(fe>>3&1)+(fe>>4&1);xe>0;xe-=!oe[me++]);return me+(2&fe)}(Y=R))+8>Y.length&&hs(6,"invalid gzip data"),function(oe,fe,me,xe){var Pe=oe.length;if(!Pe||fe.f&&!fe.l)return me||new vo(0);var De=!me,ke=De||fe.i!=2,He=fe.i;De&&(me=new vo(3*Pe));var Oe,je,Re=function(cc){var uc=me.length;if(cc>uc){var qu=new vo(Math.max(2*uc,cc));qu.set(me),me=qu}},$e=fe.f||0,Ye=fe.p||0,Ge=fe.b||0,at=fe.l,We=fe.d,Ke=fe.m,_t=fe.n,mt=8*Pe;do{if(!at){$e=us(oe,Ye,1);var ft=us(oe,Ye+1,3);if(Ye+=3,!ft){var Xe=oe[(an=4+((Ye+7)/8|0))-4]|oe[an-3]<<8,yt=an+Xe;if(yt>Pe){He&&hs(0);break}ke&&Re(Ge+Xe),me.set(oe.subarray(an,yt),Ge),fe.b=Ge+=Xe,fe.p=Ye=8*yt,fe.f=$e;continue}if(ft==1)at=Tz,We=Iz,Ke=9,_t=5;else if(ft==2){var Ut=us(oe,Ye,31)+257,Dt=us(oe,Ye+10,15)+4,Ht=Ut+us(oe,Ye+5,31)+1;Ye+=14;for(var Vt=new vo(Ht),Jt=new vo(19),Tt=0;Tt<Dt;++Tt)Jt[bz[Tt]]=us(oe,Ye+3*Tt,7);Ye+=3*Dt;var Nn=Ub(Jt),Fn=(1<<Nn)-1,xn=Sm(Jt,Nn,1);for(Tt=0;Tt<Ht;){var an,bn=xn[us(oe,Ye,Fn)];if(Ye+=15&bn,(an=bn>>4)<16)Vt[Tt++]=an;else{var Hn=0,Vn=0;for(an==16?(Vn=3+us(oe,Ye,3),Ye+=2,Hn=Vt[Tt-1]):an==17?(Vn=3+us(oe,Ye,7),Ye+=3):an==18&&(Vn=11+us(oe,Ye,127),Ye+=7);Vn--;)Vt[Tt++]=Hn}}var ur=Vt.subarray(0,Ut),lr=Vt.subarray(Ut);Ke=Ub(ur),_t=Ub(lr),at=Sm(ur,Ke,1),We=Sm(lr,_t,1)}else hs(1);if(Ye>mt){He&&hs(0);break}}ke&&Re(Ge+131072);for(var _i=(1<<Ke)-1,pr=(1<<_t)-1,tr=Ye;;tr=Ye){var Cr=(Hn=at[Vb(oe,Ye)&_i])>>4;if((Ye+=15&Hn)>mt){He&&hs(0);break}if(Hn||hs(2),Cr<256)me[Ge++]=Cr;else{if(Cr==256){tr=Ye,at=null;break}var Wr=Cr-254;Cr>264&&(Wr=us(oe,Ye,(1<<(ki=rM[Tt=Cr-257]))-1)+aM[Tt],Ye+=ki);var Zr=We[Vb(oe,Ye)&pr],$n=Zr>>4;if(Zr||hs(3),Ye+=15&Zr,lr=Ez[$n],$n>3){var ki=iM[$n];lr+=Vb(oe,Ye)&(1<<ki)-1,Ye+=ki}if(Ye>mt){He&&hs(0);break}ke&&Re(Ge+131072);var Ha=Ge+Wr;if(Ge<lr){var jo=0-lr,fs=Math.min(lr,Ha);for(jo+Ge<0&&hs(3);Ge<fs;++Ge)me[Ge]=(void 0)[jo+Ge]}for(;Ge<Ha;++Ge)me[Ge]=me[Ge-lr]}}fe.l=at,fe.p=tr,fe.b=Ge,fe.f=$e,at&&($e=1,fe.m=Ke,fe.d=We,fe.n=_t)}while(!$e);return Ge!=me.length&&De?(Oe=me,((je=Ge)==null||je>Oe.length)&&(je=Oe.length),new vo(Oe.subarray(0,je))):me.subarray(0,Ge)}(Y.subarray(X,-8),{i:2},new vo(((N=Y)[(V=N.length)-4]|N[V-3]<<8|N[V-2]<<16|N[V-1]<<24)>>>0))));var N,V,Y,X;let K=Mz[k];if(!K)throw new Error(`Unhandled codec: ${k}`);let ae=new globalThis.DecompressionStream(K);return new Response(new Blob([R]).stream().pipeThrough(ae)).arrayBuffer().then(oe=>new Uint8Array(oe))}(D,T).then(R=>{let k=cs.read(new Pd(R));if(k.values==="uint32_values")return k.uint32_values.readValuesInto(S),new Rz[f](S.buffer);throw new Error(`Unhandled numeric data "${k.values}"`)}),P.then(R=>{for(let k=b.length-1;k>=0;k--)switch(b[k]){case"delta_filter":_z(R,_);break;case"zigzag_filter":yz(R);break;case"bitshuffle_filter":vz(R,f);break;default:throw new Error(`Unhandled filter "${b[k]}"`)}return{layerName:a,blockIndex:y,data:R}}).catch(R=>{throw R})}))};class uM extends Xy{constructor(e,n,a,l,d){super(e,n,a,l,d),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let a=n.context,l=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Uo?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Uo(a,e,l.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let a=this._mrt=new jb(30),l=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Ia(l,(d,f,_,y)=>{if(d)n(d);else try{let b=a.getHeaderLength(f);if(b>e)return void(this.request=this.fetchHeader(b,n));a.parseHeader(f),this._isHeaderLoaded=!0;let T=0;for(let D of Object.values(a.layers))T=Math.max(T,D.dataIndex[D.dataIndex.length-1].last_byte);f.byteLength>=T&&(this.entireBuffer=f),n(null,this.entireBuffer||f,_,y)}catch(b){n(b)}}),this.request}fetchBand(e,n,a){let l=this._mrt;if(!this._isHeaderLoaded||!l)return void a(new Error("Tile header is not ready"));let d=this.actor;if(!d)return void a(new Error("Can't fetch tile band without an actor"));let f,_=(D,S)=>{f.complete(D,S),D?a(D):(this.updateTextureDescriptor(e,n),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(D,S)=>{if(D)return a(D);let P=d.send("decodeRasterArray",{buffer:S,task:f},_,void 0,!0);this._workQueue.push(()=>{P&&P.cancel(),f.cancel()})},b=l.getLayer(e);if(!b)return void a(new Error(`Unknown sourceLayer "${e}"`));if(b.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let T=b.getDataRange([n]);if(f=l.createDecodingTask(T),!f||f.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(T.firstByte,T.lastByte+1));else{let D=Object.assign({},this.requestParams,{headers:{Range:`bytes=${T.firstByte}-${T.lastByte}`}}),S=Ia(D,y);this._fetchQueue.push(()=>{S.cancel(),f.cancel()})}else a(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(n)||!a.hasDataForBand(n))return;let{bytes:l,tileSize:d,buffer:f,offset:_,scale:y}=a.getBandView(n),b=d+2*f,T={data:l,width:b,height:b},D=this.texture;D&&D instanceof Uo&&D.update(T,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:T,buffer:f,offset:_,tileSize:d,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class Lz{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){let l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);let d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){let f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let a=e.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][l];return this.data[a].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let a in this.data)for(let l of this.data[a])e(l.value)||n.push(l);for(let a of n)this.remove(a.value.tileID,a)}}class Vu extends Sa{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Lz(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new NN,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Xi(this._tiles).map(e=>e.tileID).sort(hM).map(e=>e.key)}getRenderableIds(e,n){let a=[];for(let l in this._tiles)this._isIdRenderable(+l,e,n)&&a.push(this._tiles[l]);return e?a.sort((l,d)=>{let f=l.tileID,_=d.tileID,y=new rt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new rt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||b.y-y.y||b.x-y.x}).map(l=>l.tileID.key):a.map(l=>l.tileID).sort(hM).map(l=>l.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new Kh(l,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new vi("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Gr.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new vi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let l=0;l<n.length;l++){let d=n[l];if(e.neighboringTiles&&e.neighboringTiles[d]){let f=this.getTileByID(d);a(e,f),a(f,e)}}function a(l,d){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let f=d.tileID.canonical.x-l.tileID.canonical.x,_=d.tileID.canonical.y-l.tileID.canonical.y,y=Math.pow(2,l.tileID.canonical.z),b=d.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),d.dem&&l.dem&&(l.dem.backfillBorder(d.dem,f,_),l.neighboringTiles&&l.neighboringTiles[b]&&(l.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,l){for(let d in this._tiles){let f=this._tiles[d];if(l[d]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>a)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){let b=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[b.key],f&&f.hasData()&&(_=b)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){l[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){let l=e.scaledTo(a),d=this._getLoadedTile(l);if(d)return d}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let a=Math.ceil(e.width/n)+1,l=Math.ceil(e.height/n)+1,d=Math.floor(a*l*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let a={};for(let l in this._tiles){let d=this._tiles[l];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(let l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(let l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,n,a,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Ar(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,d=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(d.push(new Ar(1,0,1,0,0)),d.push(new Ar(1,0,1,1,0)),d.push(new Ar(1,0,1,0,1)),d.push(new Ar(1,0,1,1,1)))}else if(d=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);d=d.filter(b=>y(b))}}else d=[];if(d.length>0&&this.castsShadows&&l&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!$b(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),b=Math.min(y,this._source.maxzoom),T=e.extendTileCoverForShadows(d,l,b);for(let D of T)this._shadowCasterTiles[D.key]=!0,d.push(D)}let f=this._updateRetainedTiles(d);if($b(this._source.type)&&d.length!==0){let y={},b={},T=Object.keys(f);for(let S of T){let P=f[S],R=this._tiles[S];if(!R||R.fadeEndTime&&R.fadeEndTime<=Gr.now())continue;let k=this.findLoadedParent(P,Math.max(P.overscaledZ-Vu.maxOverzooming,this._source.minzoom));k&&(this._addTile(k.tileID),y[k.tileID.key]=k.tileID),b[S]=P}let D=d[d.length-1].overscaledZ;for(let S in this._tiles){let P=this._tiles[S];if(f[S]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>D;){R=R.scaledTo(R.overscaledZ-1);let k=this._tiles[R.key];if(k&&k.hasData()&&b[R.key]){f[S]=P.tileID;break}}}for(let S in y)f[S]||(this._coveredTiles[S]=!0,f[S]=y[S])}for(let y in f)this._tiles[y].clearFadeHold();let _=function(y,b){let T=[];for(let D in y)D in b||T.push(D);return T}(this._tiles,f);for(let y of _){let b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let a={},l=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),d=e[0].overscaledZ,f=Math.max(d-Vu.maxOverzooming,this._source.minzoom),_=Math.max(d+Vu.maxUnderzooming,this._source.minzoom),y={};for(let b of e){let T=this._addTile(b);n[b.key]=b,T.hasData()||l<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,l,_,n);for(let b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){let S=b.children(this._source.maxzoom)[0],P=this.getTile(S);if(P&&P.hasData()){n[S.key]=S;continue}}else{let S=b.children(this._source.maxzoom);if(n[S[0].key]&&n[S[1].key]&&n[S[2].key]&&n[S[3].key])continue}let D=T.wasRequested();for(let S=b.overscaledZ-1;S>=f;--S){let P=b.scaledTo(S);if(a[P.key]||(a[P.key]=!0,T=this.getTile(P),!T&&D&&(T=this._addTile(P)),T&&(n[P.key]=P,D=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);let d=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;l=d}for(let d of n)this._loadedParentTiles[d]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let a=!!n;if(!a){let l=this.map?this.map.painter:null,d=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new uM(e,d,this.transform.tileZoom,l,this._isRaster):new Xy(e,d,this.transform.tileZoom,l,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new vi("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){let l=[],d=this.transform;if(!d)return l;let f=d.projection.name==="globe",_=$s(d.center.lng);for(let y in this._tiles){let b=this._tiles[y];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(f){let D=b.tileID.canonical;if(D.z===0){let S=[Math.abs(Zt(_,...Mm(D,-1))-_),Math.abs(Zt(_,...Mm(D,1))-_)];T=[0,2*S.indexOf(Math.min(...S))-1]}else{let S=[Math.abs(Zt(_,...Mm(D,-1))-_),Math.abs(Zt(_,...Mm(D,0))-_),Math.abs(Zt(_,...Mm(D,1))-_)];T=[S.indexOf(Math.min(...S))-1]}}else T=[0];for(let D of T){let S=e.containsTile(b,d,n,D);S&&l.push(S)}}return l}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let a=this.getRenderableIds(e,n).map(d=>this._tiles[d].tileID),l=this.transform.projection.name==="globe";for(let d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=l?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){let n=e.slice(),a=this.transform._camera.position,l=this.transform._camera.forward(),d={};for(let f of n){let _=1/(1<<f.canonical.z);d[f.key]=((f.canonical.x+.5)*_+f.wrap-a[0])*l[0]+((f.canonical.y+.5)*_-a[1])*l[1]-a[2]*l[2]}return n.sort((f,_)=>d[f.key]-d[_.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if($b(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Gr.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){let l=this._tiles[e];l&&l.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(let a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,n))};return void this._source.on("data",_)}let a=new Map,l=Array.isArray(e)?e:[e],d=this.map.painter.terrain,f=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(let _ of l){let y=_.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let b of y)a.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}bl(Array.from(a.values()),(_,y)=>{let b=new Xy(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),y(T,b)})},n)}}function hM(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function $b(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Mm(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Vu.maxOverzooming=10,Vu.maxUnderzooming=3;let dM=new class extends st{possiblyEvaluate(t,e){return e=new Ot(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=ni({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(Ry.paint.properties["line-width"].specification);function fM(t,e){return e>0?e+2*t:t}dM.useIntegerZoom=!0;let kz=new Mn({"symbol-placement":new Fe(we.layout_symbol["symbol-placement"]),"symbol-spacing":new Fe(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Fe(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Fe(we.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Fe(we.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Fe(we.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Fe(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new Fe(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Fe(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(we.layout_symbol["icon-size"]),"icon-text-fit":new st(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new st(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(we.layout_symbol["icon-image"]),"icon-rotate":new st(we.layout_symbol["icon-rotate"]),"icon-padding":new Fe(we.layout_symbol["icon-padding"]),"icon-keep-upright":new Fe(we.layout_symbol["icon-keep-upright"]),"icon-offset":new st(we.layout_symbol["icon-offset"]),"icon-anchor":new st(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Fe(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Fe(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Fe(we.layout_symbol["text-rotation-alignment"]),"text-field":new st(we.layout_symbol["text-field"]),"text-font":new st(we.layout_symbol["text-font"]),"text-size":new st(we.layout_symbol["text-size"]),"text-max-width":new st(we.layout_symbol["text-max-width"]),"text-line-height":new st(we.layout_symbol["text-line-height"]),"text-letter-spacing":new st(we.layout_symbol["text-letter-spacing"]),"text-justify":new st(we.layout_symbol["text-justify"]),"text-radial-offset":new st(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Fe(we.layout_symbol["text-variable-anchor"]),"text-anchor":new st(we.layout_symbol["text-anchor"]),"text-max-angle":new Fe(we.layout_symbol["text-max-angle"]),"text-writing-mode":new Fe(we.layout_symbol["text-writing-mode"]),"text-rotate":new st(we.layout_symbol["text-rotate"]),"text-padding":new Fe(we.layout_symbol["text-padding"]),"text-keep-upright":new Fe(we.layout_symbol["text-keep-upright"]),"text-transform":new st(we.layout_symbol["text-transform"]),"text-offset":new st(we.layout_symbol["text-offset"]),"text-allow-overlap":new Fe(we.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Fe(we.layout_symbol["text-ignore-placement"]),"text-optional":new Fe(we.layout_symbol["text-optional"]),visibility:new Fe(we.layout_symbol.visibility)});var Gb={paint:new Mn({"icon-opacity":new st(we.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new st(we.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new st(we.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new st(we.paint_symbol["text-emissive-strength"]),"icon-color":new st(we.paint_symbol["icon-color"]),"icon-halo-color":new st(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(we.paint_symbol["icon-halo-blur"]),"icon-translate":new Fe(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new Fe(we.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new st(we.paint_symbol["icon-image-cross-fade"]),"text-opacity":new st(we.paint_symbol["text-opacity"]),"text-occlusion-opacity":new st(we.paint_symbol["text-occlusion-opacity"]),"text-color":new st(we.paint_symbol["text-color"],{runtimeType:xi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new st(we.paint_symbol["text-halo-color"]),"text-halo-width":new st(we.paint_symbol["text-halo-width"]),"text-halo-blur":new st(we.paint_symbol["text-halo-blur"]),"text-translate":new Fe(we.paint_symbol["text-translate"]),"text-translate-anchor":new Fe(we.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Fe(we.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Fe(we.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Fe(we.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Fe(we.paint_symbol["icon-color-brightness-max"])}),layout:kz};class pM{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Pl,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Q(pM,"FormatSectionOverride",{omit:["defaultValue"]});class Ky extends oi{constructor(e,n,a,l){super(e,Gb,n,a,l),this._colorAdjustmentMatrix=r.ad.identity([])}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let l=[];for(let d of a)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,l){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(d,f,_,y){d=Vh(d),f=Uh(f);let b=r.ad.create(),T=d/3,D=1-2*T,S=[D,T,T,0,T,D,T,0,T,T,D,0,0,0,0,1],P=.5-.5*f,R=y-_;return r.ad.multiply(b,[R,0,0,0,0,R,0,0,0,0,R,0,_,_,_,1],[f,0,0,0,0,f,0,0,0,0,f,0,P,P,P,1]),r.ad.multiply(b,b,S),b}(e,n,a,l),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,l){let d=this.layout.get(e).evaluate(n,{},a,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||F(f.value)||!d?d:function(_,y){return y.replace(/{([^{}]+)}/g,(b,T)=>T in _?String(_[T]):"")}(n.properties,d)}createBucket(e){return new zd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Gb.paint.overridableProperties){if(!Ky.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new pM(n),l=new L(a,n.property.specification,this.scope,this.options),d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new U("source",l):new $("composite",l,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Yn(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Ky.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),l=Gb.paint.properties[n],d=!1,f=_=>{for(let y of _)if(l.overrides&&l.overrides.hasOverride(y))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ri)f(a.value.value.sections);else if(a.value.kind==="source"){let _=b=>{d||(b instanceof Jo&&Sr(b.value)===Ol?f(b.value.sections):b instanceof fu?f(b.sections):b.eachChild(_))},y=a.value;y._styleExpression&&_(y._styleExpression.expression)}return d}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n,a){return{config:new Lu(this,{zoom:n,lut:a}),overrideFog:!1}}}let Fz=new Mn({visibility:new Fe(we.layout_background.visibility)});var Nz={paint:new Mn({"background-color":new Fe(we.paint_background["background-color"]),"background-pattern":new Fe(we.paint_background["background-pattern"]),"background-opacity":new Fe(we.paint_background["background-opacity"]),"background-emissive-strength":new Fe(we.paint_background["background-emissive-strength"])}),layout:Fz};let zz=new Mn({visibility:new Fe(we.layout_raster.visibility)});var Bz={paint:new Mn({"raster-opacity":new Fe(we.paint_raster["raster-opacity"]),"raster-color":new Mr(we.paint_raster["raster-color"]),"raster-color-mix":new Fe(we.paint_raster["raster-color-mix"]),"raster-color-range":new Fe(we.paint_raster["raster-color-range"]),"raster-hue-rotate":new Fe(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Fe(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Fe(we.paint_raster["raster-brightness-max"]),"raster-saturation":new Fe(we.paint_raster["raster-saturation"]),"raster-contrast":new Fe(we.paint_raster["raster-contrast"]),"raster-resampling":new Fe(we.paint_raster["raster-resampling"]),"raster-fade-duration":new Fe(we.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Fe(we.paint_raster["raster-emissive-strength"]),"raster-array-band":new Fe(we.paint_raster["raster-array-band"]),"raster-elevation":new Fe(we.paint_raster["raster-elevation"])}),layout:zz};function Qy(t,e,n,a,l,d,f,_){let y=[t,e,1,n,a,1,l,d,1],b=[f,_,1],T=r.bC.adjoint([],y),[D,S,P]=r._.transformMat3(b,b,T);return r.bC.multiply(y,y,[D,0,0,0,S,0,0,0,P])}function mM(t,e,n,a,l,d,f,_){let y=function(b,T,D,S,P,R,k,N){let V=Qy(0,0,1,0,1,1,0,1),Y=Qy(b,T,D,S,P,R,k,N),X=r.bC.adjoint([],V);return r.bC.multiply(Y,Y,X)}(t,e,n,a,l,d,f,_);return[y[2]/y[8]/Je,y[5]/y[8]/Je]}function Jy(t){return[t[0],Math.min(Math.max(t[1],-xr),xr)]}class gM extends Sa{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new vi("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Os(this.map._requestManager.transformRequest(this.url,Hh.Image),(a,l)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Kh(a)):l&&(this.image=l instanceof HTMLImageElement?Gr.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Wy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new vi("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Wy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(let d of e)d[1]>a&&(a=d[1]),d[1]<n&&(n=d[1]);let l=(a+n)/2;if(l>xr?this.onNorthPole=!0:l<-xr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let d=e.map(gi.fromLngLat);this.tileID=function(f){let _=1/0,y=1/0,b=-1/0,T=-1/0;for(let k of f)_=Math.min(_,k.x),y=Math.min(y,k.y),b=Math.max(b,k.x),T=Math.max(T,k.y);let D=Math.max(b-_,T-y),S=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),P=Math.pow(2,S),R=Math.floor((_+b)/2*P);return R>1&&(R-=1),new Fu(S,R,Math.floor((y+T)/2*P))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new vi("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let N in this.tiles){let V=this.tiles[N];V.state!=="loaded"&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=Uu(new Fu(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){let V=N[1].x-N[0].x,Y=N[1].y-N[0].y,X=N[2].x-N[1].x,K=N[2].y-N[1].y,ae=N[3].x-N[2].x,oe=N[3].y-N[2].y,fe=N[0].x-N[3].x,me=N[0].y-N[3].y,xe=V*K-X*Y,Pe=X*oe-ae*K,De=ae*me-fe*oe,ke=fe*Y-V*me;return xe>0&&Pe>0&&De>0&&ke>0||xe<0&&Pe<0&&De<0&&ke<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let l=Uu(this.tileID,this.map.transform.projection),[d,f,_,y]=this.coordinates.map(N=>{let V=l.projection.project(N[0],N[1]);return YC(l,V)._round()});this.perspectiveTransform=mM(d.x,d.y,f.x,f.y,_.x,_.y,y.x,y.y);let b=this._boundsArray=new Gl;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(f.x,f.y,Je,0),b.emplaceBack(y.x,y.y,0,Je),b.emplaceBack(_.x,_.y,Je,Je),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,Yy.members),this.boundsSegments=sr.simpleSegment(0,0,4,2);let T=[],D=function(N){return[Jy(N[0]),Jy(N[1]),Jy(N[2]),Jy(N[3])]}(this.coordinates),[S,P,R,k]=function(N){let V=N[0][0],Y=V,X=N[0][1],K=X;for(let ae=1;ae<N.length;ae++)N[ae][0]<V?V=N[ae][0]:N[ae][0]>Y&&(Y=N[ae][0]),N[ae][1]<X?X=N[ae][1]:N[ae][1]>K&&(K=N[ae][1]);return[V,X,Y-V,K-X]}(D);{let N=new Gl,[V,Y,X,K]=function(Re){let $e=Re[0].x,Ye=$e,Ge=Re[0].y,at=Ge;for(let We=1;We<Re.length;We++)Re[We].x<$e?$e=Re[We].x:Re[We].x>Ye&&(Ye=Re[We].x),Re[We].y<Ge?Ge=Re[We].y:Re[We].y>at&&(at=Re[We].y);return[$e,Ge,Ye-$e,at-Ge]}(a),ae=Re=>[(Re.x-V)/X,(Re.y-Y)/K],[oe,fe,me,xe]=a.map(ae),Pe=function(Re,$e,Ye,Ge,at,We,Ke,_t){let mt=Qy(0,0,1,0,1,1,0,1),ft=Qy(Re,$e,Ye,Ge,at,We,Ke,_t),Xe=r.bC.adjoint([],ft);return r.bC.multiply(mt,mt,Xe)}(oe[0],oe[1],fe[0],fe[1],me[0],me[1],xe[0],xe[1]);this.elevatedGlobePerspectiveTransform=mM(oe[0],oe[1],fe[0],fe[1],me[0],me[1],xe[0],xe[1]);let De=(Re,$e)=>{T.push(Re.lng);let Ye=Math.round((Re.lng-S)/R*Je),Ge=Math.round((Re.lat-P)/k*Je),at=ae($e),We=r._.transformMat3([],[at[0],at[1],1],Pe),Ke=Math.round(We[0]/We[2]*Je),_t=Math.round(We[1]/We[2]*Je);N.emplaceBack(Ye,Ge,Ke,_t)},ke=a[3].x-a[0].x,He=a[3].y-a[0].y,Oe=a[2].x-a[1].x,je=a[2].y-a[1].y;for(let Re=0;Re<65;Re++){let $e=Re/64,Ye=[a[0].x+$e*ke,a[0].y+$e*He],Ge=[a[1].x+$e*Oe,a[1].y+$e*je],at=Ge[0]-Ye[0],We=Ge[1]-Ye[1];for(let Ke=0;Ke<65;Ke++){let _t=Ke/64,mt={x:Ye[0]+at*_t,y:Ye[1]+We*_t,z:0};De(n.projection.unproject(mt.x,mt.y),mt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,Yy.members)}{this.maxLongitudeTriangleSize=0;let N=[],V=new Fr,Y=(X,K,ae)=>{V.emplaceBack(X,K,ae);let oe=T[X],fe=T[K],me=T[ae],xe=Math.min(Math.min(oe,fe),me),Pe=Math.max(Math.max(oe,fe),me)-xe;Pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Pe),N.push(xe+Pe/2)};for(let X=0;X<64;X++)for(let K=0;K<64;K++){let ae=65*X+K,oe=ae+1,fe=ae+65,me=fe+1;Y(ae,fe,oe),Y(oe,fe,me)}[N,V]=function(X,K){let ae=Array.from({length:X.length},(me,xe)=>xe);ae.sort((me,xe)=>X[me]-X[xe]);let oe=[],fe=new Fr;for(let me=0;me<ae.length;me++){let xe=ae[me];oe.push(X[xe]);let Pe=3*xe,De=Pe+1;fe.emplaceBack(K.uint16[Pe],K.uint16[De],K.uint16[De+1])}return[oe,fe]}(N,V),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(V)}this.elevatedGlobeSegments=sr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/Je,0,k/Je,0,0,P,S,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof Wy||(this.texture?this.texture.update(this.image):(this.texture=new Uo(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,l=(d=e+180)+360*Math.round((a[0]-d)/360);var d;let f=new sr,_=(D,S)=>{f.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:n.segments[0].vertexLength,primitiveLength:S,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-l)<=y){let D=f_(a,0,a.length,l+y);return D===a.length||_(D,up(a,D+1,a.length,l+360-y)-D),f}l<a[0]&&(l+=360);let b=up(a,0,a.length,l-y);if(b===a.length)return _(0,a.length),f;_(0,b-0);let T=f_(a,b+1,a.length,l+y);return T!==a.length&&_(T,a.length-T),f}}let Uz=(Math.pow(256,2)-1)/16907520;class _M extends oi{constructor(e,n,a,l){super(e,Bz,n,a,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof gM&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[a,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(l)||a===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=um({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,l])}}let Vz=new Mn({visibility:new Fe(we["layout_raster-particle"].visibility)});var jz={paint:new Mn({"raster-particle-array-band":new Fe(we["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Fe(we["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Mr(we["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Fe(we["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Fe(we["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Fe(we["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Fe(we["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:Vz};class yM extends oi{constructor(e,n,a,l){super(e,jz,n,a,l),this._updateColorRamp(),this.lastInvalidatedAt=Gr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=um({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Gr.now()}}class $z extends oi{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let Gz=new Mn({visibility:new Fe(we.layout_sky.visibility)});var qz={paint:new Mn({"sky-type":new Fe(we.paint_sky["sky-type"]),"sky-atmosphere-sun":new Fe(we.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Fe(we.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Fe(we.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Fe(we.paint_sky["sky-gradient-radius"]),"sky-gradient":new Mr(we.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Fe(we.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Fe(we.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Fe(we.paint_sky["sky-opacity"])}),layout:Gz};function qb(t,e,n){let a=[0,0,1],l=r.av.identity([]);return r.av.rotateY(l,l,n?-rn(t)+Math.PI:rn(t)),r.av.rotateX(l,l,-rn(e)),r._.transformQuat(a,a,l),r._.normalize(a,a)}var Hz={paint:new Mn({})};function vM(t,e){let n=e0(t.projection,t.zoom,t.width,t.height),a=function(d,f,_,y,b){let T=new pn(_.lng-180*lc,_.lat),D=new pn(_.lng+180*lc,_.lat),S=d.project(T.lng,T.lat),P=d.project(D.lng,D.lat),R=-Math.atan2(P.y-S.y,P.x-S.x),k=gi.fromLngLat(_);k.y=Zt(k.y,-1+lc,1-lc);let N=k.toLngLat(),V=d.project(N.lng,N.lat),Y=gi.fromLngLat(N);Y.x+=lc;let X=Y.toLngLat(),K=d.project(X.lng,X.lat),ae=wM(K.x-V.x,K.y-V.y,R),oe=gi.fromLngLat(N);oe.y+=lc;let fe=oe.toLngLat(),me=d.project(fe.lng,fe.lat),xe=wM(me.x-V.x,me.y-V.y,R),Pe=Math.abs(ae.x)/Math.abs(xe.y),De=r.ad.identity([]);r.ad.rotateZ(De,De,-R*(1-(b?0:y)));let ke=r.ad.identity([]);return r.ad.scale(ke,ke,[1,1-(1-Pe)*y,1]),ke[4]=-xe.x/xe.y*y,r.ad.rotateZ(ke,ke,R),r.ad.multiply(ke,De,ke),ke}(t.projection,0,t.center,n,e),l=xM(t);return r.ad.scale(a,a,[l,l,1]),a}function xM(t){let e=t.projection,n=e0(t.projection,t.zoom,t.width,t.height),a=bM(e,t.center),l=bM(e,pn.convert(e.center));return Math.pow(2,a*n+(1-n)*l)}function e0(t,e,n,a,l=1/0){let d=t.range;if(!d)return 0;let f=Math.min(l,Math.max(n,a)),_=Math.log(f/1024)/Math.LN2;return ba(d[0]+_,d[1]+_,e)}let lc=1/4e4;function bM(t,e){let n=Zt(e.lat,-xr,xr),a=new pn(e.lng-180*lc,n),l=new pn(e.lng+180*lc,n),d=t.project(a.lng,n),f=t.project(l.lng,n),_=gi.fromLngLat(a),y=gi.fromLngLat(l),b=f.x-d.x,T=f.y-d.y,D=y.x-_.x,S=y.y-_.y,P=Math.sqrt((D*D+S*S)/(b*b+T*T));return Math.log(P)/Math.LN2}function wM(t,e,n){let a=Math.cos(n),l=Math.sin(n);return{x:t*a-e*l,y:t*l+e*a}}function EM(t,e,n){r.ad.identity(t),r.ad.rotateZ(t,t,rn(e[2])),r.ad.rotateX(t,t,rn(e[0])),r.ad.rotateY(t,t,rn(e[1])),r.ad.scale(t,t,n),r.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function t0(t,e,n,a,l,d,f,_){let y=[n[0]-e[0],n[1]-e[1],0],b=[a[0]-e[0],a[1]-e[1],0];if(r._.length(y)<1e-12||r._.length(b)<1e-12)return r.av.identity(t);let T=r._.cross([],y,b);r._.normalize(T,T),r._.subtract(b,a,e),y[2]=(d-l)*_,b[2]=(f-l)*_;let D=y;return r._.cross(D,y,b),r._.normalize(D,D),r.av.rotationTo(t,T,D)}function Hb(t,e,n=!1){let a=$a(e.zoom),l=function(d,f,_){let y=f.worldSize,b=[d[12],d[13],d[14]],T=Hr(b[1]/y),D=Vi(b[0]/y),S=r.ad.identity([]),P=Li(1,T)*y,R=Li(1,0)*y*Nu(T,f.zoom),k=1/ub(y),N=R*k;if(_){let K=e0(f.projection,f.zoom,f.width,f.height,1024);N=k*f.projection.pixelSpaceConversion(f.center.lat,y,K)}let V=ku(T,D);r._.add(V,V,r._.scale([],r._.normalize([],V),P*N*b[2]));let Y=function(K){let ae=[K[0],K[1],K[2]],oe=[0,1,0],fe=r._.cross([],oe,ae);return r._.cross(oe,ae,fe),r._.squaredLength(oe)===0&&(oe=[0,1,0],r._.cross(fe,ae,oe)),r._.normalize(fe,fe),r._.normalize(oe,oe),r._.normalize(ae,ae),[fe[0],fe[1],fe[2],0,oe[0],oe[1],oe[2],0,ae[0],ae[1],ae[2],0,K[0],K[1],K[2],1]}(V);r.ad.scale(S,S,[N,N,N*P]),r.ad.translate(S,S,[-b[0],-b[1],-b[2]]);let X=r.ad.multiply([],f.globeMatrix,Y);return r.ad.multiply(X,X,S),r.ad.multiply(X,X,d),X}(t,e,n);if(a>0){let d=function(f,_){let y=_.worldSize,b=Li(1,0)*y*Nu(_.center.lat,_.zoom)/ub(y),T=Li(1,_.center.lat)*y,D=r.ad.identity([]);return r.ad.rotateY(D,D,rn(_.center.lng)),r.ad.rotateX(D,D,rn(_.center.lat)),r.ad.translate(D,D,[0,0,Oi]),r.ad.scale(D,D,[b,b,b*T]),r.ad.translate(D,D,[_.point.x-.5*y,_.point.y-.5*y,0]),r.ad.multiply(D,D,f),r.ad.multiply(D,_.globeMatrix,D)}(t,e);return function(f,_,y){let b=(R,k,N)=>{let V=r._.length(R),Y=r._.length(k),X=ja(R,k,N);return r._.scale(X,X,1/r._.length(X)*wt(V,Y,N))},T=b([f[0],f[1],f[2]],[_[0],_[1],_[2]],y),D=b([f[4],f[5],f[6]],[_[4],_[5],_[6]],y),S=b([f[8],f[9],f[10]],[_[8],_[9],_[10]],y),P=ja([f[12],f[13],f[14]],[_[12],_[13],_[14]],y);return[T[0],T[1],T[2],0,D[0],D[1],D[2],0,S[0],S[1],S[2],0,P[0],P[1],P[2],1]}(l,d,a)}return l}function TM(t,e,n,a){let l=ar.projectAabbCorners(a,n),d=Number.MAX_VALUE,f=-1;for(let b=0;b<l.length;++b){let T=l[b];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<d&&(f=b,d=T[2])}let _=b=>new rt(l[b][0],l[b][1]),y;switch(f){case 0:case 6:y=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:y=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:y=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:y=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(eb(t,y))return d}let Wz=In([{name:"a_pos_3f",components:3,type:"Float32"}]),Zz=In([{name:"a_color_3f",components:3,type:"Float32"}]),Yz=In([{name:"a_color_4f",components:4,type:"Float32"}]),Xz=In([{name:"a_uv_2f",components:2,type:"Float32"}]),Kz=In([{name:"a_normal_3f",components:3,type:"Float32"}]),Qz=In([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Jz=In([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class n0{constructor(e,n,a,l){this.message=(e?`${e}: `:"")+a,l&&(this.identifier=l),n!=null&&n.__line__&&(this.line=n.__line__)}}function IM(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class DM{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class SM{constructor(){this.instancedDataArray=new N1,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Wb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,l){this.tileToMeter=hy(a);let d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:f,id:_,index:y,sourceLayerIndex:b}of e){let T=_??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),D=Va(f,d);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),D,a))continue;let S={id:T,sourceLayerIndex:b,index:y,geometry:d?D.geometry:os(f,a,l),properties:f.properties,type:f.type,patterns:{}},P=this.addFeature(S,S.geometry,D);P&&n.featureIndex.insert(f,S.geometry,y,b,this.index,this.instancesPerModel[P].instancedDataArray.length,Je/32)}this.lookup=null}update(e,n,a,l){for(let d in this.instancesPerModel){let f=this.instancesPerModel[d];for(let _ in e)f.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(f.features[f.idToFeaturesIndex[_]],e[_],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];for(let l of a.features){let d=this.layers[0],f=l.feature,_=this.canonical,y=d.paint.get("model-rotation").evaluate(f,{},_),b=d.paint.get("model-scale").evaluate(f,{},_),T=d.paint.get("model-translation").evaluate(f,{},_);r._.exactEquals(l.rotation,y)&&r._.exactEquals(l.scale,b)&&r._.exactEquals(l.translation,T)||(this.evaluate(l,l.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(xb(this.activeReplacements,l))return!1;this.activeReplacements=l;let d=!1;for(let f in this.instancesPerModel){let _=this.instancesPerModel[f],y=_.instancedDataArray;for(let b of _.features){let T=b.instancedDataOffset,D=b.instancedDataCount;for(let S=0;S<D;S++){let P=16*(S+T),R=y.float32[P+0];R=R>Je?R-Je:R;let k=Math.floor(R),N=y.float32[P+1],V=!1;for(let Y of this.activeReplacements)if(!(Y.order<a||Y.order===1/0)&&Y.clipMask&HS.Model&&!(Y.min.x>k||k>Y.max.x||Y.min.y>N||N>Y.max.y)&&(V=zS(NS(k,N,e.canonical,Y.footprintTileId.canonical),Y),V))break;y.float32[P]=V?R+Je:R,d=d||V}}}return d}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,Qz.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){let l=this.layers[0],d=l.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return yr(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),d;IM(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new SM);let f=this.instancesPerModel[d],_=f.instancedDataArray,y=new DM(a,_.length);for(let b of n)for(let T of b){if(T.x<0||T.x>=Je||T.y<0||T.y>=Je)continue;let D=(this.lookupDim-1)/Je,S=this.lookupDim*(T.y*D|0)+T.x*D|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let P=_.length;_.resize(P+1),f.instancesEvaluatedElevation.push(0),_.float32[16*P]=T.x,_.float32[16*P+1]=T.y}return y.instancedDataCount=f.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(y),this.evaluate(y,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,n,a,l){let d=this.layers[0],f=e.feature,_=this.canonical,y=e.rotation=d.paint.get("model-rotation").evaluate(f,n,_),b=e.scale=d.paint.get("model-scale").evaluate(f,n,_),T=e.translation=d.paint.get("model-translation").evaluate(f,n,_),D=d.paint.get("model-color").evaluate(f,n,_);D.a=d.paint.get("model-color-mix-intensity").evaluate(f,n,_);let S=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),EM(S,y,b);let P=Math.round(100*D.a)+D.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let k=e.instancedDataOffset+R,N=16*k,V=a.instancedDataArray.float32,Y=0;l&&(Y=V[N+6]-a.instancesEvaluatedElevation[k]);let X=0|V[N+1];V[N]=(0|V[N])+D.r/1.05,V[N+1]=X+D.g/1.05,V[N+2]=P,V[N+3]=1/(_.z>10?this.tileToMeter:hy(_,X)),V[N+4]=T[0],V[N+5]=T[1],V[N+6]=T[2]+Y,V[N+7]=S[0],V[N+8]=S[1],V[N+9]=S[2],V[N+10]=S[4],V[N+11]=S[5],V[N+12]=S[6],V[N+13]=S[8],V[N+14]=S[9],V[N+15]=S[10],a.instancesEvaluatedElevation[k]=T[2]}}}Q(Wb,"ModelBucket",{omit:["layers"]}),Q(SM,"PerModelAttributes"),Q(DM,"ModelFeature");let eB=new Mn({visibility:new Fe(we.layout_model.visibility),"model-id":new st(we.layout_model["model-id"])});var tB={paint:new Mn({"model-opacity":new Fe(we.paint_model["model-opacity"]),"model-rotation":new st(we.paint_model["model-rotation"]),"model-scale":new st(we.paint_model["model-scale"]),"model-translation":new st(we.paint_model["model-translation"]),"model-color":new st(we.paint_model["model-color"]),"model-color-mix-intensity":new st(we.paint_model["model-color-mix-intensity"]),"model-type":new Fe(we.paint_model["model-type"]),"model-cast-shadows":new Fe(we.paint_model["model-cast-shadows"]),"model-receive-shadows":new Fe(we.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Fe(we.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new st(we.paint_model["model-emissive-strength"]),"model-roughness":new st(we.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new st(we.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Fe(we.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Fe(we.paint_model["model-front-cutoff"])}),layout:eB};let ju=64,Vd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function CM(t,e,n,a,l,d,f,_,y,b=!1){let T=n.zoom,D=n.project(a),S=Nu(a.lat,T),P=1/S;r.ad.identity(t),r.ad.translate(t,t,[D.x+f[0]*P,D.y+f[1]*P,f[2]]);let R=1,k=1,N=n.worldSize;if(b){if(n.projection.name==="mercator"){let K=0;n.elevation&&(K=n.elevation.getAtPointOrZero(new gi(D.x/N,D.y/N),0));let ae=r.aA.transformMat4([],[D.x,D.y,K,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=ae,k=ae*Nu(n.center.lat,T)}else if(n.projection.name==="globe"){let K=Hb(t,n),ae=r.ad.multiply([],n.projMatrix,K),oe=[0,0,0,1];r.aA.transformMat4(oe,oe,ae);let fe=oe[3]/n.cameraToCenterDistance,me=$a(T),xe=n.projection.pixelsPerMeter(a.lat,N)*Nu(a.lat,T),Pe=n.projection.pixelsPerMeter(n.center.lat,N)*Nu(n.center.lat,T);R=fe/wt(xe,HD(n.center.lat),me),k=fe*S/xe,R*=Pe,k*=Pe}}else R=P;r.ad.scale(t,t,[R,R,k]);let V=[...t],Y=e.orientation,X=[];if(EM(X,[Y[0]+l[0],Y[1]+l[1],Y[2]+l[2]],d),r.ad.multiply(t,V,X),_&&n.elevation){let K=0,ae=[];if(y&&n.elevation){K=function(me,xe,Pe,De,ke){let He=xe.elevation;if(!He)return 0;let Oe=ar.projectAabbCorners(Pe,De),je=Li(1,ke.lat)*xe.worldSize,Re=function(yt,Ut){let Dt=[0,0,1],Ht=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Vt of Ht){let Jt=yt[Vt.corners[0]],Tt=yt[Vt.corners[1]],Nn=yt[Vt.corners[2]],Fn=[Tt[0]-Jt[0],Tt[1]-Jt[1],Ut*(Tt[2]-Jt[2])],xn=r._.cross(Fn,Fn,[Nn[0]-Jt[0],Nn[1]-Jt[1],Ut*(Nn[2]-Jt[2])]);r._.normalize(xn,xn),Vt.dotProductWithUp=r._.dot(xn,Dt)}return Ht.sort((Vt,Jt)=>Vt.dotProductWithUp-Jt.dotProductWithUp),Ht[0].corners}(Oe,je),$e=Oe[Re[0]],Ye=Oe[Re[1]],Ge=Oe[Re[2]],at=Oe[Re[3]],We=He.getAtPointOrZero(new gi($e[0]/xe.worldSize,$e[1]/xe.worldSize),0),Ke=He.getAtPointOrZero(new gi(Ye[0]/xe.worldSize,Ye[1]/xe.worldSize),0),_t=He.getAtPointOrZero(new gi(Ge[0]/xe.worldSize,Ge[1]/xe.worldSize),0),mt=He.getAtPointOrZero(new gi(at[0]/xe.worldSize,at[1]/xe.worldSize),0),ft=(We+mt)/2,Xe=(Ke+_t)/2;return ft>Xe?Ke<_t?t0(me,Ye,at,$e,Ke,mt,We,je):t0(me,Ge,$e,at,_t,We,mt,je):We<mt?t0(me,$e,Ye,Ge,We,Ke,_t,je):t0(me,at,Ge,Ye,mt,_t,Ke,je),Math.max(ft,Xe)}(ae,n,e.aabb,t,a);let oe=r.ad.fromQuat([],ae),fe=r.ad.multiply([],oe,X);r.ad.multiply(t,V,fe)}else K=n.elevation.getAtPointOrZero(new gi(D.x/N,D.y/N),0);K!==0&&(t[14]+=K)}}function Am(t,e,n=!1){t.uploaded||(t.gfxTexture=new Uo(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function nB(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,Wz.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,Kz.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,Xz.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?Zz:Yz).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,Jz.members,!0)),t.segments=sr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&Am(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Am(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Am(a.normalTexture,e),a.occlusionTexture&&Am(a.occlusionTexture,e,n),a.emissionTexture&&Am(a.emissionTexture,e)}function Zb(t,e,n){if(t.meshes)for(let a of t.meshes)nB(a,e,n);if(t.children)for(let a of t.children)Zb(a,e,n)}function r0(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)r0(e)}function Yb(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)Yb(n)}class rB{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class iB{constructor(){this.tasks={},this.taskQueue=[],Nh(["process"],this),this.invoker=new rB(this.process),this.nextId=0}add(e,n){let a=this.nextId++,l=function({type:d,isSymbolTile:f,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-_:d==="maybePrepare"&&f?400-_:500:200-_:100-_}(n);if(l===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:l,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let l=0;l<this.taskQueue.length;l++){let d=this.tasks[this.taskQueue[l]];d.priority<n&&(n=d.priority,e=l)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class MM{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Nh(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new iB}send(e,n,a,l,d=!1,f){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[_]=a);let y=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:pe(n,y)},y),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){let n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let l=this.cancelCallbacks[a];delete this.cancelCallbacks[a],l&&l.cancel()}else if(n.mustQueue||$r()){let l=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,n),l&&l.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Ee(n.error)):a(null,Ee(n.data)))}else{let a=new Set,l=n.hasCallback?(f,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?pe(f):null,data:pe(_,a)},a)}:f=>{},d=Ee(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,d,l);else if(this.parent.getWorkerSource){let f=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,f[0],d.source,d.scope)[f[1]](d,l)}else l(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Xb=(()=>{class t{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=kh();let l=this.workerPool.acquire(this.id);for(let d=0;d<l.length;d++){let f=new t.Actor(l[d],a,this.id);f.name=`Worker ${d}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,l){bl(this.actors,(d,f)=>{d.send(n,a,f)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=MM,t})();var Pm={workerUrl:"",workerClass:null,workerParams:void 0};function oB(){return Pm.workerClass!=null?new Pm.workerClass:new self.Worker(Pm.workerUrl,Pm.workerParams)}let Kb="mapboxgl_preloaded_worker_pool";class Rm{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Rm.workerCount;)this.workers.push(new oB);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kb]}numActive(){return Object.keys(this.active).length}}let Om;function i0(){return Om||(Om=new Rm),Om}Rm.workerCount=2;let o0,Qb,ds,jd,Jb,$d=null;function AM(){return $r()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Qb||O.DRACO_URL}function PM(){if($r()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(jd)return jd;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return jd=WebAssembly.validate(t)?O.MESHOPT_SIMD_URL:O.MESHOPT_URL,jd}let s0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sB={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Lm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function RM(t,e,n){let a=n.json.bufferViews.length,l=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:l,byteLength:t.byteLength},n.buffers[l]=t}let ew="KHR_draco_mesh_compression";function aB(t,e){let n=t.extensions&&t.extensions[ew];if(!n)return;let a=new ds.Decoder,l=FM(e,n.bufferView),d=new ds.Mesh;if(!a.DecodeArrayToMesh(l,l.byteLength,d))throw new Error("Failed to decode Draco mesh");let f=e.json.accessors[t.indices],_=s0[f.componentType],y=f.count*_.BYTES_PER_ELEMENT,b=ds._malloc(y);_===Uint16Array?a.GetTrianglesUInt16Array(d,y,b):a.GetTrianglesUInt32Array(d,y,b),RM(ds.memory.buffer.slice(b,b+y),f,e),ds._free(b);for(let T of Object.keys(n.attributes)){let D=a.GetAttributeByUniqueId(d,n.attributes[T]),S=e.json.accessors[t.attributes[T]],P=sB[S.componentType],R=S.count*Lm[S.type]*s0[S.componentType].BYTES_PER_ELEMENT,k=ds._malloc(R);a.GetAttributeDataArrayForAllPoints(d,D,ds[P],R,k),RM(ds.memory.buffer.slice(k,k+R),S,e),ds._free(k)}a.destroy(),d.destroy(),delete t.extensions[ew]}let a0="EXT_meshopt_compression";function lB(t,e){if(!t.extensions||!t.extensions[a0])return;let n=t.extensions[a0],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),l=new Uint8Array(n.count*n.byteStride);Jb.decodeGltfBuffer(l,n.count,n.byteStride,a,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=l.buffer,delete t.extensions[a0]}let OM=1179937895,LM=new TextDecoder("utf8");function kM(t,e){return new URL(t,e).href}function cB(t,e,n,a){return fetch(kM(t.uri,a)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[n]=l})}function FM(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function uB(t,e,n,a){if(t.uri){let l=kM(t.uri,a);return fetch(l).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[n]=d})}if(t.bufferView!==void 0){let l=FM(e,t.bufferView),d=new Blob([l],{type:t.mimeType});return createImageBitmap(d).then(f=>{e.images[n]=f})}}function NM(t,e=0,n){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===OM){let T=new Uint32Array(t,e),D=2,S=(T[D++]>>2)-3,P=T[D++]>>2;if(D++,a.json=JSON.parse(LM.decode(T.subarray(D,D+P))),D+=P,D<S){let R=T[D++];D++;let k=e+(D<<2);a.buffers[0]=t.slice(k,k+R)}}else a.json=JSON.parse(LM.decode(new Uint8Array(t,e)));let{buffers:l,images:d,meshes:f,extensionsUsed:_,bufferViews:y}=a.json,b=Promise.resolve();if(l){let T=[];for(let D=0;D<l.length;D++){let S=l[D];S.uri?T.push(cB(S,a,D,n)):a.buffers[D]||(a.buffers[D]=null)}b=Promise.all(T)}return b.then(()=>{let T=[],D=_&&_.includes(ew),S=_&&_.includes(a0);if(D&&T.push(function(){if(!ds)return o0||(o0=function(P){let R,k=null;function N(){R=new Uint8Array(k.buffer)}function V(){throw new Error("Unexpected Draco error.")}let Y={a:{a:V,d:function(X,K,ae){return R.copyWithin(X,K,K+ae)},c:function(X){let K=R.length,ae=Math.max(X>>>0,Math.ceil(1.2*K)),oe=Math.ceil((ae-K)/65536);try{return k.grow(oe),N(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,Y):P.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,Y))).then(X=>{let{Rb:K,Qb:ae,P:oe,T:fe,X:me,Ja:xe,La:Pe,Qa:De,Va:ke,Wa:He,eb:Oe,jb:je,f:Re,e:$e,yb:Ye,zb:Ge,Ab:at,Bb:We,Db:Ke,Gb:_t}=X.instance.exports;k=$e;let mt=(()=>{let ft=0,Xe=0,yt=0,Ut=0;return Dt=>{yt&&(K(Ut),K(ft),Xe+=yt,yt=ft=0),ft||(Xe+=128,ft=ae(Xe));let Ht=Dt.length+7&-8,Vt=ft;Ht>=Xe&&(yt=Ht,Vt=Ut=ae(Ht));for(let Jt=0;Jt<Dt.length;Jt++)R[Vt+Jt]=Dt[Jt];return Vt}})();return N(),Re(),{memory:$e,_free:K,_malloc:ae,Mesh:class{constructor(){this.ptr=oe()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=xe()}destroy(){je(this.ptr)}DecodeArrayToMesh(ft,Xe,yt){let Ut=mt(ft),Dt=Pe(this.ptr,Ut,Xe,yt.ptr);return!!me(Dt)}GetAttributeByUniqueId(ft,Xe){return{ptr:De(this.ptr,ft.ptr,Xe)}}GetTrianglesUInt16Array(ft,Xe,yt){ke(this.ptr,ft.ptr,Xe,yt)}GetTrianglesUInt32Array(ft,Xe,yt){He(this.ptr,ft.ptr,Xe,yt)}GetAttributeDataArrayForAllPoints(ft,Xe,yt,Ut,Dt){Oe(this.ptr,ft.ptr,Xe.ptr,yt,Ut,Dt)}},DT_INT8:Ye(),DT_UINT8:Ge(),DT_INT16:at(),DT_UINT16:We(),DT_UINT32:Ke(),DT_FLOAT32:_t()}})}(fetch(AM())),o0.then(P=>{ds=P,o0=void 0}))}()),S&&T.push(function(){if(Jb)return;let P=function(R){let k,N=WebAssembly.instantiateStreaming(R,{}).then(X=>{k=X.instance,k.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(X,K,ae,oe,fe,me){(function(xe,Pe,De,ke,He,Oe,je){let Re=xe.exports.sbrk,$e=ke+3&-4,Ye=Re($e*He),Ge=Re(Oe.length),at=new Uint8Array(xe.exports.memory.buffer);at.set(Oe,Ge);let We=Pe(Ye,ke,He,Ge,Oe.length);if(We===0&&je&&je(Ye,$e,He),De.set(at.subarray(Ye,Ye+ke*He)),Re(Ye-Re(0)),We!==0)throw new Error(`Malformed buffer data: ${We}`)})(k,k.exports[Y[fe]],X,K,ae,oe,k.exports[V[me]])}}}(fetch(PM()));return P.ready.then(()=>{Jb=P})}()),d)for(let P=0;P<d.length;P++)T.push(uB(d[P],a,P,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(D&&f)for(let{primitives:P}of f)for(let R of P)aB(R,a);if(S&&f&&y)for(let P of y)lB(P,a);return a})})}function $u(t,e){let n=t.json.bufferViews[e.bufferView],a=s0[e.componentType];return new a(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Lm[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:Lm[e.type]))}function tw(t,e,n,a){let l=s0[e.componentType],d=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),f=t.json.bufferViews[e.bufferView],_=f.byteStride?f.byteStride/l.BYTES_PER_ELEMENT:Lm[e.type],y=n.float32,b=y.length/n.capacity;for(let T=0,D=0;T<e.count*_;T+=_,D+=b)for(let S=0;S<b;S++)y[D+S]=a[T+S]*d;n._trim()}function hB(t,e,n){let a=t.indices,l=t.attributes,d={};d.indexArray=new Fr;let f=e.json.accessors[a],_=f.count/3;d.indexArray.reserve(_);let y=$u(e,f);for(let S=0;S<_;S++)d.indexArray.emplaceBack(y[3*S],y[3*S+1],y[3*S+2]);d.indexArray._trim(),d.vertexArray=new Hl;let b=e.json.accessors[l.POSITION];d.vertexArray.reserve(b.count);let T=$u(e,b);for(let S=0;S<b.count;S++)d.vertexArray.emplaceBack(T[3*S],T[3*S+1],T[3*S+2]);if(d.vertexArray._trim(),d.aabb=new ar(b.min,b.max),d.centroid=function(S,P){let R=[0,0,0],k=S.length;if(k>0){for(let N=0;N<k;N++){let V=3*S[N];R[0]+=P[V],R[1]+=P[V+1],R[2]+=P[V+2]}R[0]/=k,R[1]/=k,R[2]/=k}return R}(y,T),l.COLOR_0!==void 0){let S=e.json.accessors[l.COLOR_0],P=Lm[S.type],R=$u(e,S);d.colorArray=P===3?new Hl:new ql,d.colorArray.resize(S.count),tw(e,S,d.colorArray,R)}if(l.NORMAL!==void 0){d.normalArray=new Hl;let S=e.json.accessors[l.NORMAL];d.normalArray.resize(S.count);let P=$u(e,S);tw(e,S,d.normalArray,P)}if(l.TEXCOORD_0!==void 0&&n.length>0){d.texcoordArray=new vd;let S=e.json.accessors[l.TEXCOORD_0];d.texcoordArray.resize(S.count);let P=$u(e,S);tw(e,S,d.texcoordArray,P)}if(l._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=$u(e,S))}l._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array($u(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));let D=t.material;return d.material=function(S,P){let{emissiveFactor:R=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:N=.5,normalTexture:V,occlusionTexture:Y,emissiveTexture:X,doubleSided:K}=S,{baseColorFactor:ae=[1,1,1,1],metallicFactor:oe=1,roughnessFactor:fe=1,baseColorTexture:me,metallicRoughnessTexture:xe}=S.pbrMetallicRoughness||{},Pe=Y?P[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&Pe){let De=Y.extensions.KHR_texture_transform;Pe.offsetScale=[De.offset[0],De.offset[1],De.scale[0],De.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new _n(...ae),metallicFactor:oe,roughnessFactor:fe,baseColorTexture:me?P[me.index]:void 0,metallicRoughnessTexture:xe?P[xe.index]:void 0},doubleSided:K,emissiveFactor:R,alphaMode:k,alphaCutoff:N,normalTexture:V?P[V.index]:void 0,occlusionTexture:Pe,emissionTexture:X?P[X.index]:void 0,defined:S.defined===void 0}}(D!==void 0?e.json.materials[D]:{defined:!1},n),d}function zM(t,e,n){let{matrix:a,rotation:l,translation:d,scale:f,mesh:_,extras:y,children:b}=t,T={};if(T.matrix=a||r.ad.fromRotationTranslationScale([],l||[0,0,0,1],d||[0,0,0],f||[1,1,1]),_!==void 0){T.meshes=n[_];let D=T.anchor=[0,0];for(let S of T.meshes){let{min:P,max:R}=S.aabb;D[0]+=P[0]+R[0],D[1]+=P[1]+R[1]}D[0]=Math.floor(D[0]/T.meshes.length/2),D[1]=Math.floor(D[1]/T.meshes.length/2)}if(y&&(y.id&&(T.id=y.id),y.lights&&(T.lights=function(D){if(!D.length)return[];let S=function(V){let Y=atob(V),X=new Uint8Array(Y.length);for(let K=0;K<Y.length;K++)X[K]=Y.codePointAt(K);return X}(D),P=[],R=S.length/24,k=new Uint16Array(S.buffer),N=new Float32Array(S.buffer);for(let V=0;V<R;V++){let Y=k[2*V*6]/30,X=k[2*V*6+1]/30,K=k[2*V*6+10]/100,ae=N[6*V+1],oe=N[6*V+2],fe=N[6*V+3],me=N[6*V+4],xe=fe-ae,Pe=me-oe,De=Math.hypot(xe,Pe);P.push({pos:[ae+.5*xe,oe+.5*Pe,X],normal:[Pe/De,-xe/De,0],width:De,height:Y,depth:K,points:[ae,oe,fe,me]})}return P}(y.lights))),b){let D=[];for(let S of b)D.push(zM(e.json.nodes[S],e,n));T.children=D}return T}function dB(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new _b(t.vertices,t.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:a}}function fB(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let a=[];for(let f of n){if(!Array.isArray(f)||f.length!==2)continue;let _=f[0],y=f[1];typeof _=="number"&&typeof y=="number"&&a.push(new rt(_,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let l=0;for(let f=0;f<a.length;f++){let _=a[f],y=a[(f+1)%a.length],b=a[(f+2)%a.length];l+=(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)}l>0&&a.reverse();let d=hm(a.flatMap(f=>[f.x,f.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function pB(t,e){let n=[],a=[],l=0,d=[];for(let f of t){l=n.length;let _=f.vertexArray.float32,y=f.indexArray.uint16;for(let b=0;b<f.vertexArray.length;b++)d[0]=_[3*b+0],d[1]=_[3*b+1],d[2]=_[3*b+2],r._.transformMat4(d,d,e),n.push(new rt(d[0],d[1]));for(let b=0;b<3*f.indexArray.length;b++)a.push(y[b]+l)}if(a.length%3!=0)return null;for(let f=0;f<a.length;f+=3){let _=n[a[f+0]],y=n[a[f+1]],b=n[a[f+2]];(_.x-y.x)*(b.y-y.y)-(b.x-y.x)*(_.y-y.y)>0&&([a[f+1],a[f+2]]=[a[f+2],a[f+1]])}return{vertices:n,indices:a}}function BM(t){let e=function(y,b){let T=[],D=WebGL2RenderingContext;if(y.json.textures)for(let S of y.json.textures){let P={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};S.sampler!==void 0&&Object.assign(P,y.json.samplers[S.sampler]),T.push({image:b[S.source],sampler:P,uploaded:!1})}return T}(t,t.images),n=function(y,b){let T=[];for(let D of y.json.meshes){let S=[];for(let P of D.primitives)S.push(hB(P,y,b));T.push(S)}return T}(t,e),{scenes:a,scene:l,nodes:d}=t.json,f=a?a[l||0].nodes:d,_=[];for(let y of f)_.push(zM(d[y],t,n));return function(y,b,T){let D={},S=new Set;for(let P=0;P<y.length;P++){let R=T[b[P]];if(!R.extras)continue;let k=R.extras["mapbox:footprint:version"],N=R.extras["mapbox:footprint:id"];(k||N)&&S.add(P),k==="1.0.0"&&N&&(D[N]=P)}for(let P=0;P<y.length;P++){if(S.has(P))continue;let R=y[P],k=T[b[P]];if(!k.extras)continue;let N=null;R.id in D&&(N=pB(y[D[R.id]].meshes,R.matrix)),N||(N=fB(k)),N&&(R.footprint=dB(N))}if(S.size>0){let P=Array.from(S.values()).sort((R,k)=>R-k);for(let R=P.length-1;R>=0;R--)y.splice(P[R],1)}}(_,f,t.json.nodes),_}function mB(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,l=ju/(t.aabb.max[0]-n+2),d=ju/(t.aabb.max[1]-a+2);for(let f=0;f<e.length;f+=3){let _=e[f+2],y=(e[f+0]-n)*l|0,b=(e[f+1]-a)*d|0;_>t.heightmap[b*ju+y]&&(t.heightmap[b*ju+y]=_)}}function gB(t,e){let n={};n.indexArray=new Fr,n.indexArray.reserve(4*t.length),n.vertexArray=new Hl,n.vertexArray.reserve(10*t.length),n.colorArray=new ql,n.vertexArray.reserve(10*t.length);let a=0;for(let f of t){let _=Math.min(10,Math.max(4,1.3*f.height))*e,y=[-f.normal[1],f.normal[0],0],b=Math.min(.29,.1*f.width/f.depth),T=f.width-2*f.depth*e*(b+.01),D=r._.scaleAndAdd([],f.pos,y,T/2),S=r._.scaleAndAdd([],f.pos,y,-T/2),P=[D[0],D[1],D[2]+f.height],R=[S[0],S[1],S[2]+f.height],k=r._.scaleAndAdd([],f.normal,y,b);r._.scale(k,k,_);let N=r._.scaleAndAdd([],f.normal,y,-b);r._.scale(N,N,_),r._.add(k,D,k),r._.add(N,S,N),D[2]+=.1,S[2]+=.1,n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]);let V=T/_/2;n.colorArray.emplaceBack(-V-b,-1,V,.8),n.colorArray.emplaceBack(V+b,-1,V,.8),n.colorArray.emplaceBack(-V,0,V,1.3),n.colorArray.emplaceBack(V,0,V,1.3),n.colorArray.emplaceBack(V+b,-.8,V,.7),n.colorArray.emplaceBack(V+b,-.8,V,.7),n.colorArray.emplaceBack(0,0,V,1.3),n.colorArray.emplaceBack(0,0,V,1.3),n.colorArray.emplaceBack(V+b,-1.2,V,.8),n.colorArray.emplaceBack(V+b,-1.2,V,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let l={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=_n.white,l.pbrMetallicRoughness=d,n.material=l,n.aabb=new ar([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let nw=new Float32Array(262144),Gu=new Uint8Array(262144);function UM(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,UM(n));return e}function VM(t,e,n){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&n.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)VM(a,e,n)}let jM=["","wall","door","roof","window","lamp","logo"];class $M{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:UM(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ar([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new ar([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=ar.applyTransform(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class l0{constructor(e,n,a,l,d,f){this.id=n,this.modelTraits|=Vd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Vd.HasMapboxMeshFeatures),l&&(this.modelTraits|=Vd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new $M(_)),VM(_,f.featureIndexArray.length,f.grid),f.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,f.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let a of this.getNodesInfo()){let l=a.node;l.footprint&&n.push({footprint:l.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let a of n){let l=a.node;this.uploaded?this.updatePbrBuffer(l):Zb(l,e,!0)}for(let a of n)r0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){let l=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||km(a.paint.get("model-color").value,f)||km(a.paint.get("model-color-mix-intensity").value,f)||km(a.paint.get("model-roughness").value,f)||km(a.paint.get("model-emissive-strength").value,f)||km(a.paint.get("model-height-based-emissive-strength-multiplier").value,f))&&(this.projection=l,this.brightness=d,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),l=this.id.canonical;for(let d of a){let f=d.feature;d.evaluatedScale=n.paint.get("model-scale").evaluate(f,{},l)}}evaluate(e){let n=this.getNodesInfo();for(let a of n){if(!a.node.meshes)continue;let l=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,f=a.evaluatedColor[2],_=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let b=0;b<jM.length;b++){let T=jM[b];T.length&&(l.properties.part=T);let D=e.paint.get("model-color").evaluate(l,{},y).toRenderColor(null),S=e.paint.get("model-color-mix-intensity").evaluate(l,{},y);a.evaluatedColor[b]=[D.r,D.g,D.b,S],a.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(l,{},y),a.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y),a.evaluatedRMEA[b][3]=D.a,a.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},y),!a.hasTranslucentParts&&D.a<1&&(a.hasTranslucentParts=!0)}delete l.properties.part,yB(a,f!==a.evaluatedColor[2]||_!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(l,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,l){let d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;let f=Cd.create(e,a,d);if(!f)return;this.modelTraits&Vd.HasMapboxMeshFeatures&&this.updateDEM(e,f,a,l);for(let _ of this.getNodesInfo()){let y=_.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let b=y.footprint.vertices,T=f.getElevationAt(b[0].x,b[0].y,!0,!0);for(let D=1;D<b.length;D++)T=Math.min(T,f.getElevationAt(b[D].x,b[D].y,!0,!0));y.elevation=T}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,l){let d=n._dem._modifiedForSources[l];if(d===void 0&&(n._dem._modifiedForSources[l]=[],d=n._dem._modifiedForSources[l]),d.includes(a.canonical))return;let f=n._dem.dim;d.push(a.canonical);let _=!1;for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.grid)continue;let T=b.footprint.grid,D=n.tileCoordToPixel(T.min.x,T.min.y),S=n.tileCoordToPixel(T.max.x,T.max.y),P=Math.min(Math.min(f-S.y,D.x),Math.min(D.y,f-S.x));if(P<0)continue;let R=Zt(P,2,5),k=Math.max(0,D.x-R),N=Math.max(0,D.y-R),V=Math.min(S.x+R,f-1),Y=Math.min(S.y+R,f-1);for(let oe=N;oe<=Y;++oe)for(let fe=k;fe<=V;++fe)Gu[oe*f+fe]=255;let X=0,K=0;for(let oe=0;oe<T.cellsY;++oe)for(let fe=0;fe<T.cellsX;++fe){if(!T.cells[oe*T.cellsX+fe])continue;let me=n.tileCoordToPixel(T.min.x+fe/T.xScale,T.min.y+oe/T.yScale),xe=n.tileCoordToPixel(T.min.x+(fe+1)/T.xScale,T.min.y+(oe+1)/T.yScale);for(let Pe=me.y;Pe<=Math.min(xe.y+1,f-1);++Pe)for(let De=me.x;De<=Math.min(xe.x+1,f-1);++De)Gu[Pe*f+De]===255&&(Gu[Pe*f+De]=0,X+=n.getElevationAtPixel(De,Pe),K++)}let ae=X/K;k=Math.max(1,D.x-R),N=Math.max(1,D.y-R),V=Math.min(S.x+R,f-2),Y=Math.min(S.y+R,f-2),_=!0;for(let oe=N;oe<=Y;++oe)for(let fe=k;fe<=V;++fe)Gu[oe*f+fe]===0&&(nw[oe*f+fe]=n._dem.set(fe,oe,ae));for(let oe=1;oe<R;++oe){k=Math.max(1,D.x-oe),N=Math.max(1,D.y-oe),V=Math.min(S.x+oe,f-2),Y=Math.min(S.y+oe,f-2);for(let fe=N;fe<=Y;++fe)for(let me=k;me<=V;++me){let xe=fe*f+me;if(Gu[xe]===255){let Pe=0,De=0,ke=-1,He=-1;for(let Oe=-1;Oe<=1;++Oe)for(let je=-1;je<=1;++je){let Re=(fe+Oe)*f+me+je;if(Gu[Re]>=oe)continue;let $e=nw[Re],Ye=Math.abs($e);Ye>De&&(Pe=$e,De=Ye,ke=je,He=Oe)}if(De>.1){let Oe=1-(oe+.5*Math.abs(ke*He))/R,je=n._dem.get(me,fe)+Pe*Oe,Re=n._dem.get(me+ke,fe+He),$e=n._dem.get(me-ke,fe-He,!0);(je-Re)*(je-$e)>0&&(je=(Re+$e)/2),nw[xe]=n._dem.set(me,fe,je),Gu[xe]=oe}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Gr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)r0(n.node),Yb(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){let f=l[d].node;l[d].hiddenByReplacement=!!f.footprint&&!a.find(_=>_.footprint===f.footprint)}}getHeightAtTileCoord(e,n){let a=this.getNodesInfo(),l=[],d=[0,0,0],f=r.ad.identity([]);for(let _=0;_<this.nodesInfo.length;_++){let y=a[_],b=y.node.meshes[0],T=b.transformedAabb;if(e<T.min[0]||n<T.min[1]||e>T.max[0]||n>T.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};r.ad.invert(f,y.node.matrix),d[0]=e,d[1]=n,r._.transformMat4(d,d,f);let D=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*ju|0,S=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*ju|0)*ju+Math.min(63,D),P=b.heightmap[S];if(!(P<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:P,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new rt(e,n),new rt(e,n),l),l.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function km(t,e){return!t.isLightConstant&&e}function _B(t,e,n,a,l,d,f,_){let y=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;n[3]>0&&(y=wt(y,255*n[0],n[3]),b=wt(b,255*n[1],n[3]),T=wt(T,255*n[2],n[3]));let D=y<<8|b,S=T<<8|Math.floor(255*a[3]),P=function(oe){let fe=Zt(oe,0,2);return Math.min(Math.round(.5*fe*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],R=Zt(l[0],0,1),k=Zt(l[1],0,1),N=Zt(l[2],0,1),V=Zt(l[3],0,1),Y,X,K,ae;if(R!==k&&f!==d&&k!==R){let oe=f-d;X=1/(oe*(k-R)),K=-(d+oe*R)/(oe*(k-R));let fe=Zt(l[4],-1,1);ae=Math.pow(10,fe),Y=255*N<<8|255*V}else Y=65535,X=0,K=1,ae=1;if(t.emplaceBack(D,S,P,Y,X,K,ae),_){let oe=_.length;_.clear();for(let fe=0;fe<oe;fe++)_.emplaceBack(D,S,P,Y,X,K,ae)}}function yB(t,e,n){let a=t.node,l=0,d=n&Vd.HasMeshoptCompression;for(let f of a.meshes){if(a.lights&&a.lightMeshIndex===l||!f.featureData)continue;f.featureArray=new ly,f.featureArray.reserve(f.featureData.length);let _=e;for(let y of f.featureData){let b=d?65535&y:y>>16&65535,T=d?y>>16&65535:65535&y,D=(15&T)<8?15&T:0,S=t.evaluatedRMEA[D],P=t.evaluatedColor[D],R=t.emissionHeightBasedParams[D],k;if(_&&D===2&&a.lights&&(k=new ly,k.resize(10*a.lights.length)),_B(f.featureArray,b,P,S,R,f.aabb.min[2],f.aabb.max[2],k),k&&_){_=!1;let N=a.meshes[a.lightMeshIndex];N.featureArray=k,N.featureArray._trim()}}f.featureArray._trim(),l++}}function GM(t,e,n,a){let l=1<<t.z;e.lat=Hr((a/Je+t.y)/l),e.lng=Vi((n/Je+t.x)/l)}Q(l0,"Tiled3dModelBucket",{omit:["layers"]}),Q($M,"Tiled3dModelFeature");let vB={circle:class extends oi{constructor(t,e,n,a){super(t,o3,e,n,a)}createBucket(t){return new J1(t)}queryRadius(t){let e=t;return Id("circle-radius",this,e)+Id("circle-stroke-width",this,e)+py(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,l,d,f,_){let y=tS(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return gS(t,a,d,f,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let a=mS(this);return{config:new Lu(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends oi{createBucket(t){return new yS(t)}constructor(t,e,n,a){super(t,g3,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=um({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Id("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,l,d,f,_){let y=this.paint.get("heatmap-radius").evaluate(e,n);return gS(t,a,d,f,_,!0,!0,new rt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new Lu(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends oi{constructor(t,e,n,a){super(t,y3,e,n,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends oi{constructor(t,e,n,a){super(t,R3,e,n,a)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new Lu(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ey(t)}queryRadius(){return py(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,l,d){return!t.queryGeometry.isAboveHorizon&&XD(eS(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends oi{constructor(t,e,n,a){super(t,lN,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Ay(t)}queryRadius(){return py(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,l,d,f,_,y){let b=tS(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),D=this.paint.get("fill-extrusion-base").evaluate(e,n),S=[0,0],P=_&&d.elevation,R=d.elevation?d.elevation.exaggeration():1,k=t.tile.getBucket(this);if(P&&k instanceof Ay){let K=k.centroidVertexArray,ae=y+1;ae<K.length&&(S[0]=K.geta_centroid_pos0(ae),S[1]=K.geta_centroid_pos1(ae))}if(S[0]===0&&S[1]===1)return!1;d.projection.name==="globe"&&(a=oC([a],[new rt(0,0),new rt(Je,Je)],t.tileID.canonical).map(K=>K.polygon).flat());let N=P?_:null,[V,Y]=function(K,ae,oe,fe,me,xe,Pe,De,ke,He,Oe){return K.projection.name==="globe"?function(je,Re,$e,Ye,Ge,at,We,Ke,_t,mt,ft){let Xe=[],yt=[],Ut=je.projection.upVectorScale(ft,je.center.lat,je.worldSize).metersToTile,Dt=[0,0,0,1],Ht=[0,0,0,1],Vt=(Tt,Nn,Fn,xn)=>{Tt[0]=Nn,Tt[1]=Fn,Tt[2]=xn,Tt[3]=1},Jt=iC();$e>0&&($e+=Jt),Ye+=Jt;for(let Tt of Re){let Nn=[],Fn=[];for(let xn of Tt){let an=xn.x+Ge.x,bn=xn.y+Ge.y,Hn=je.projection.projectTilePoint(an,bn,ft),Vn=je.projection.upVector(ft,xn.x,xn.y),ur=$e,lr=Ye;if(We){let _i=aC(an,bn,$e,Ye,We,Ke,_t,mt);ur+=_i.base,lr+=_i.top}$e!==0?Vt(Dt,Hn.x+Vn[0]*Ut*ur,Hn.y+Vn[1]*Ut*ur,Hn.z+Vn[2]*Ut*ur):Vt(Dt,Hn.x,Hn.y,Hn.z),Vt(Ht,Hn.x+Vn[0]*Ut*lr,Hn.y+Vn[1]*Ut*lr,Hn.z+Vn[2]*Ut*lr),r._.transformMat4(Dt,Dt,at),r._.transformMat4(Ht,Ht,at),Nn.push(new Bu(Dt[0],Dt[1],Dt[2])),Fn.push(new Bu(Ht[0],Ht[1],Ht[2]))}Xe.push(Nn),yt.push(Fn)}return[Xe,yt]}(K,ae,oe,fe,me,xe,Pe,De,ke,He,Oe):Pe?function(je,Re,$e,Ye,Ge,at,We,Ke,_t){let mt=[],ft=[],Xe=[0,0,0,1];for(let yt of je){let Ut=[],Dt=[];for(let Ht of yt){let Vt=Ht.x+Ye.x,Jt=Ht.y+Ye.y,Tt=aC(Vt,Jt,Re,$e,at,We,Ke,_t);Xe[0]=Vt,Xe[1]=Jt,Xe[2]=Tt.base,Xe[3]=1,r.aA.transformMat4(Xe,Xe,Ge),Xe[3]=Math.max(Xe[3],1e-5);let Nn=new Bu(Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]);Xe[0]=Vt,Xe[1]=Jt,Xe[2]=Tt.top,Xe[3]=1,r.aA.transformMat4(Xe,Xe,Ge),Xe[3]=Math.max(Xe[3],1e-5);let Fn=new Bu(Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]);Ut.push(Nn),Dt.push(Fn)}mt.push(Ut),ft.push(Dt)}return[mt,ft]}(ae,oe,fe,me,xe,Pe,De,ke,He):function(je,Re,$e,Ye,Ge){let at=[],We=[],Ke=Ge[8]*Re,_t=Ge[9]*Re,mt=Ge[10]*Re,ft=Ge[11]*Re,Xe=Ge[8]*$e,yt=Ge[9]*$e,Ut=Ge[10]*$e,Dt=Ge[11]*$e;for(let Ht of je){let Vt=[],Jt=[];for(let Tt of Ht){let Nn=Tt.x+Ye.x,Fn=Tt.y+Ye.y,xn=Ge[0]*Nn+Ge[4]*Fn+Ge[12],an=Ge[1]*Nn+Ge[5]*Fn+Ge[13],bn=Ge[2]*Nn+Ge[6]*Fn+Ge[14],Hn=Ge[3]*Nn+Ge[7]*Fn+Ge[15],Vn=xn+Ke,ur=an+_t,lr=bn+mt,_i=Math.max(Hn+ft,1e-5),pr=xn+Xe,tr=an+yt,Cr=bn+Ut,Wr=Math.max(Hn+Dt,1e-5);Vt.push(new Bu(Vn/_i,ur/_i,lr/_i)),Jt.push(new Bu(pr/Wr,tr/Wr,Cr/Wr))}at.push(Vt),We.push(Jt)}return[at,We]}(ae,oe,fe,me,xe)}(d,a,D,T,b,f,N,S,R,d.center.lat,t.tileID.canonical),X=t.queryGeometry;return function(K,ae,oe){let fe=1/0;XD(oe,ae)&&(fe=sC(oe,ae[0]));for(let me=0;me<ae.length;me++){let xe=ae[me],Pe=K[me];for(let De=0;De<xe.length-1;De++){let ke=xe[De],He=[ke,xe[De+1],Pe[De+1],Pe[De],ke];eb(oe,He)&&(fe=Math.min(fe,sC(oe,He)))}}return fe!==1/0&&fe}(V,Y,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends oi{constructor(t,e,n,a){super(t,Ry,e,n,a),Ry.layout&&(this.layout=new sn(Ry.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Du,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=dM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Py(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let a=mC(this);return{config:new Lu(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(t){let e=t,n=fM(Id("line-width",this,e),Id("line-gap-width",this,e)),a=Id("line-offset",this,e);return n/2+Math.abs(a)+py(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,l,d){if(t.queryGeometry.isAboveHorizon)return!1;let f=eS(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*fM(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(a=function(b,T){let D=[],S=new rt(0,0);for(let P=0;P<b.length;P++){let R=b[P],k=[];for(let N=0;N<R.length;N++){let V=R[N],Y=R[N+1],X=N===0?S:V.sub(R[N-1])._unit()._perp(),K=N===R.length-1?S:Y.sub(V)._unit()._perp(),ae=X._add(K)._unit();ae._mult(1/(ae.x*K.x+ae.y*K.y)),k.push(ae._mult(T)._add(V))}D.push(k)}return D}(a,y*t.pixelToTileUnitsFactor)),function(b,T,D){for(let S=0;S<T.length;S++){let P=T[S];if(b.length>=3){for(let R=0;R<P.length;R++)if(Ql(b,P[R]))return!0}if(t3(b,P,D))return!0}return!1}(f,a,_)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:Ky,background:class extends oi{constructor(t,e,n,a){super(t,Nz,e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:_M,"raster-particle":yM,sky:class extends oi{constructor(t,e,n,a){super(t,qz,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=um({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),l=!a,d=t.style.light,f=d.properties.get("position");return l&&d.properties.get("anchor")==="viewport"&&yr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?qb(f.azimuthal,90-f.polar,e):qb(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return qb(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends oi{constructor(t,e,n,a){super(t,Hz,e,null)}},model:class extends oi{constructor(t,e,n,a){super(t,tB,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Wb(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof l0?Je-1:0}queryIntersectsFeature(t,e,n,a,l,d){if(!this.modelManager)return!1;let f=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof Wb))return!1;let y=_;for(let b in y.instancesPerModel){let T=y.instancesPerModel[b],D=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(D)){let S=T.features[T.idToFeaturesIndex[D]],P=f.getModel(b,this.scope);if(!P)return!1;let R=r.ad.create(),k=new pn(0,0),N=y.canonical,V=Number.MAX_VALUE;for(let Y=0;Y<S.instancedDataCount;++Y){let X=16*(S.instancedDataOffset+Y),K=T.instancedDataArray.float32,ae=[K[X+4],K[X+5],K[X+6]];GM(N,k,K[X],0|K[X+1]),CM(R,P,d,k,S.rotation,S.scale,ae,!1,!1,!1),d.projection.name==="globe"&&(R=Hb(R,d));let oe=r.ad.multiply([],d.projMatrix,R),fe=t.queryGeometry,me=TM(fe.isPointQuery()?fe.screenBounds:fe.screenGeometry,d,oe,P.aabb);me!=null&&(V=Math.min(me,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof $}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,a){let l=t.tile,d=l.getBucket(this),f=null,_=Number.MAX_VALUE;if(!(d&&d instanceof l0))return{queryFeature:f,intersectionZ:_};let y=d.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Ot(l.tileID.overscaledZ),y.feature,l.tileID.canonical))return{queryFeature:f,intersectionZ:_};let b=y.node,T=a.calculatePosMatrix(l.tileID.toUnwrapped(),a.worldSize),D=y.evaluatedScale,S=0;a.elevation&&b.elevation&&(S=b.elevation*a.elevation.exaggeration()),r.ad.translate(T,T,[(b.anchor?b.anchor[0]:0)*(D[0]-1),(b.anchor?b.anchor[1]:0)*(D[1]-1),S]),r.ad.scale(T,T,D),r.ad.multiply(T,T,b.matrix);let P=t.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,k=function(V){let Y=r.ad.multiply([],T,V.matrix),X=r.ad.multiply(Y,a.expandedFarZProjMatrix,Y);for(let K=0;K<V.meshes.length;++K){let ae=V.meshes[K];if(K===V.lightMeshIndex)continue;let oe=TM(R,a,X,ae.aabb);oe!=null&&(_=Math.min(oe,_))}if(V.children)for(let K of V.children)k(K)};if(k(b),_===Number.MAX_VALUE)return{queryFeature:f,intersectionZ:_};let N=new pn(0,0);return GM(l.tileID.canonical,N,y.node.anchor[0],y.node.anchor[1]),f={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:f,intersectionZ:_}}},clip:class extends oi{constructor(t,e,n,a){super(t,L3,e,n,a)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new DS(t)}isTileClipped(){return!0}is3D(){return!0}}};Q(cM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let qM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let d=qM[15&a];if(!d)throw new Error("Unrecognized array type.");let[f]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new rw(_,f,d,e)}constructor(e,n=64,a=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let d=qM.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return iw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:f,nodeSize:_}=this,y=[0,d.length-1,0],b=[];for(;y.length;){let T=y.pop()||0,D=y.pop()||0,S=y.pop()||0;if(D-S<=_){for(let N=S;N<=D;N++){let V=f[2*N],Y=f[2*N+1];V>=e&&V<=a&&Y>=n&&Y<=l&&b.push(d[N])}continue}let P=S+D>>1,R=f[2*P],k=f[2*P+1];R>=e&&R<=a&&k>=n&&k<=l&&b.push(d[P]),(T===0?e<=R:n<=k)&&(y.push(S),y.push(P-1),y.push(1-T)),(T===0?a>=R:l>=k)&&(y.push(P+1),y.push(D),y.push(1-T))}return b}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:d,nodeSize:f}=this,_=[0,l.length-1,0],y=[],b=a*a;for(;_.length;){let T=_.pop()||0,D=_.pop()||0,S=_.pop()||0;if(D-S<=f){for(let N=S;N<=D;N++)WM(d[2*N],d[2*N+1],e,n)<=b&&y.push(l[N]);continue}let P=S+D>>1,R=d[2*P],k=d[2*P+1];WM(R,k,e,n)<=b&&y.push(l[P]),(T===0?e-a<=R:n-a<=k)&&(_.push(S),_.push(P-1),_.push(1-T)),(T===0?e+a>=R:n+a>=k)&&(_.push(P+1),_.push(D),_.push(1-T))}return y}}function iw(t,e,n,a,l,d){if(l-a<=n)return;let f=a+l>>1;HM(t,e,f,a,l,d),iw(t,e,n,a,f-1,1-d),iw(t,e,n,f+1,l,1-d)}function HM(t,e,n,a,l,d){for(;l>a;){if(l-a>600){let b=l-a+1,T=n-a+1,D=Math.log(b),S=.5*Math.exp(2*D/3),P=.5*Math.sqrt(D*S*(b-S)/b)*(T-b/2<0?-1:1);HM(t,e,n,Math.max(a,Math.floor(n-T*S/b+P)),Math.min(l,Math.floor(n+(b-T)*S/b+P)),d)}let f=e[2*n+d],_=a,y=l;for(Fm(t,e,a,n),e[2*l+d]>f&&Fm(t,e,a,l);_<y;){for(Fm(t,e,_,y),_++,y--;e[2*_+d]<f;)_++;for(;e[2*y+d]>f;)y--}e[2*a+d]===f?Fm(t,e,a,y):(y++,Fm(t,e,y,l)),y<=n&&(a=y+1),n<=y&&(l=y-1)}}function Fm(t,e,n,a){ow(t,n,a),ow(e,2*n,2*a),ow(e,2*n+1,2*a+1)}function ow(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}function WM(t,e,n,a){let l=t-n,d=e-a;return l*l+d*d}r.$=ba,r.A=Eu,r.B=Us,r.C=_n,r.D=pi,r.E=Sa,r.G=Lr,r.H=u,r.I=hz,r.J=T1,r.K=function(t){let e=t.value,n=[];if(!e)return n;let a=Ma(e);return a!=="string"?(n=n.concat([new n0(t.key,e,`string expected, "${a}" found`)]),n):(IM(e,!0)||(n=n.concat([new n0(t.key,e,`invalid url "${e}"`)])),n)},r.L=we,r.M=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new pn(e[0],e[1]):new pn(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new ar([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let a=ar.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,a,l,d,f=!1){CM(this.matrix,this,t.transform,this.position,e,n,a,l,d,f)}upload(t){if(!this.uploaded){for(let e of this.nodes)Zb(e,t);for(let e of this.nodes)r0(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)Yb(t)}},r.N=Mn,r.O=Fe,r.P=rt,r.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Xo(t.expression.evaluate(e))}interpolate(t,e,n){return{x:wt(t.x,e.x,n),y:wt(t.y,e.y,n),z:wt(t.z,e.z,n),azimuthal:wt(t.azimuthal,e.azimuthal,n),polar:wt(t.polar,e.polar,n)}}},r.R=Hh,r.S=z1,r.T=Uo,r.U=An,r.V=n0,r.W=ni,r.X=Ot,r.Y=gi,r.Z=$,r.a=to,r.a$=function(t){let{x:e,y:n}=t.point,{lng:a,lat:l}=t._center;return dS(e,n,t.worldSize,a,l)},r.a0=sn,r.a1=$a,r.a2=wt,r.a3=Je,r.a4=I_,r.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){let l=Xo([1,n,a]);return{x:l.x,y:l.y,z:l.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:wt(t.x,e.x,n),y:wt(t.y,e.y,n),z:wt(t.z,e.z,n)}}},r.a6=rm,r.a7=uy,r.a8=Ba,r.a9=UD,r.aB=function(t,e){let{x:n,y:a}=t.point,l=dS(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.ad.multiply(l,l,cb(qs(e)))},r.aD=Rd,r.aE=yo,r.aF=ky,r.aG=function(t,e,n,a,l){let d=5*e+2;t.float32[d+0]=n,t.float32[d+1]=a,t.float32[d+2]=l},r.aH=Hy,r.aI=pn,r.aJ=eM,r.aK=GD,r.aL=Ar,r.aM=sb,r.aN=xM,r.aO=Fu,r.aP=cS,r.aQ=function(t,e,n,a,l,d,f,_,y){if(y.name==="globe")return cS(t,e,new Fu(n,a,l),!1);let b=Uu({z:n,x:a,y:l},y);return new ar([(d+b.x/b.scale)*e,e*(b.y/b.scale),f],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},r.aR=function(t,e,n){let a=0;for(let l=0;l<2;++l)t[l]>0&&(a+=(t[l]-0)*(t[l]-0)),e[l]<0&&(a+=(0-e[l])*(0-e[l]));return a},r.aS=xr,r.aT=ib,r.aU=jD,r.aV=function(t){let e=r.ad.identity(new Float64Array(16));r.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,zo,0],a=[0,Bo,0];return r._.transformMat4(n,n,e),r._.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!hb(t,new pn(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!hb(t,new pn(t.center.lat,-90))]},r.aW=function(t,e){let{scale:n}=t.tileTransform,a=n*Je/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.aX=e0,r.aY=vM,r.aZ=function(t){let e=vM(t,!0);return r.aC.invert([],[e[0],e[1],e[4],e[5]])},r.a_=ob,r.aa=Ri,r.ab=rn,r.ac=function(t,e,n){let a=Math.sqrt(t*t+e*e+n*n),l=a>0?Math.acos(n/a)*Xc:0,d=t!==0||e!==0?Math.atan2(-e,-t)*Xc+90:0;return d<0&&(d+=360),[a,d,l]},r.ae=Nd,r.af=ls,r.ag=Lb,r.ah=function(t,e){let n={};for(let a=0;a<e.length;a++){let l=e[a];l in t&&(n[l]=t[l])}return n},r.ai=Kl,r.aj=$s,r.ak=Gs,r.al=_d,r.am=function(t){Gh++,Gh>fp&&(t.getActor().send("enforceCacheSizeLimit",dp),Gh=0)},r.an=bp,r.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,a){let l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){let[d,f]=l.result;return this.scheduler?this.scheduler.add(()=>{a(d,f)},e):a(d,f),()=>{}}return l.callbacks.push(a),l.cancel||(l.cancel=n((d,f)=>{l.result=[d,f];for(let _ of l.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,f)},e):_(d,f);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(d=>d!==a),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}},r.ap=function(t,e,n){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{let d=Ia(t.request,(f,_,y,b)=>{f?l(f):_&&l(null,{vectorTile:n?void 0:new yb(new Pd(_)),rawData:_,cacheControl:y,expires:b})});return()=>{d.cancel(),l()}},e)},r.aq=j1,r.ar=class extends za{constructor(t){super(t),this.current=VF}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.as=$1,r.at=Zt,r.au=wa,r.aw=tu,r.ax=Li,r.ay=Hr,r.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.b=sr,r.b$=tc,r.b0=ti,r.b1=H1,r.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return d_[e]},r.b3=45,r.b4=Y1,r.b5=hy,r.b6=ar,r.b7=Xo,r.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.b9=ip,r.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bB=dC,r.bD=hS,r.bE=Vh,r.bF=Uh,r.bG=256,r.bH=function(t,e){let n=[0,0,0],a=cm(qs(e.canonical));return r._.transformMat4(n,n,a),r._.transformMat4(n,n,t),n},r.bI=t=>({u_camera_to_center_distance:new Ri(t),u_extrude_scale:new G1(t),u_device_pixel_ratio:new Ri(t),u_matrix:new rm(t),u_inv_rot_matrix:new rm(t),u_merc_center:new Ba(t),u_tile_id:new j1(t),u_zoom_transition:new Ri(t),u_up_dir:new j1(t),u_emissive_strength:new Ri(t)}),r.bJ=t=>({u_matrix:new rm(t),u_pixels_to_tile_units:new G1(t),u_device_pixel_ratio:new Ri(t),u_units_to_pixels:new Ba(t),u_dash_image:new uy(t),u_gradient_image:new uy(t),u_image_height:new Ri(t),u_texsize:new Ba(t),u_tile_units_to_pixels:new Ri(t),u_alpha_discard_threshold:new Ri(t),u_trim_offset:new Ba(t),u_trim_fade_range:new Ba(t),u_trim_color:new $1(t),u_emissive_strength:new Ri(t)}),r.bK=t=>({u_matrix:new rm(t),u_texsize:new Ba(t),u_pixels_to_tile_units:new G1(t),u_device_pixel_ratio:new Ri(t),u_image:new uy(t),u_units_to_pixels:new Ba(t),u_tile_units_to_pixels:new Ri(t),u_alpha_discard_threshold:new Ri(t),u_trim_offset:new Ba(t)}),r.bL=P1,r.bM=bN,r.bN=si,r.bO=BN,r.bP=qC,r.bQ=Sb,r.bR=mS,r.bS=(t,e,n,a,l,d)=>{let f=t.transform,_=f.projection.name==="globe",y;if(d.paint.get("circle-pitch-alignment")==="map")if(_){let T=hS(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=f.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(f.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Gr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:h3,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){b.u_inv_rot_matrix=a,b.u_merc_center=l,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=$a(f.zoom);let T=l[0]*Je,D=l[1]*Je;b.u_up_dir=f.projection.upVector(new Fu(0,0,0),T,D)}return b},r.bT=mC,r.bU=(t,e,n,a,l,d)=>{let f=t.transform;return{u_matrix:pC(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:fC(e,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},r.bV=(t,e,n,a,l,d,f)=>{let _=t.transform,y=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:pC(t,e,n,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:gC(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fC(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:f,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},r.bW=op,r.bX=um,r.bY=iC,r.bZ=YF,r.b_=Ay,r.ba=function(t,e,n){let a=$a(n.zoom),l=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!l&&!d},r.bb=function(t){let e=t.pixelsPerMeter,n=e/Li(1,t.center.lat),a=r.ad.identity(new Float64Array(16));return r.ad.translate(a,a,[t.point.x,t.point.y,0]),r.ad.scale(a,a,[n,n,e]),Float32Array.from(a)},r.bc=_y,r.bd=function(t){let e=xr-5;t=Zt(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(rn(t))),3);return Math.round(n*(W1.length-1))},r.be=function(t,e,n,a){let l=e.getNorth(),d=e.getSouth(),f=e.getWest(),_=e.getEast(),y=1<<t.z,b=_-f,T=l-d,D=b/bd,S=-T/W1[n],P=[0,D,0,S,0,0,l,f,0];if(t.z>0){let R=180/a;r.bC.multiply(P,P,[R/b+1,0,0,0,R/T+1,0,-.5*R/D,.5*R/S,1])}return P[2]=y,P[5]=t.x,P[8]=t.y,P},r.bf=cm,r.bg=qs,r.bh=function(t,e,n){let a=r.ad.identity(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return r.ad.rotateY(a,n.globeMatrix,l),Float32Array.from(a)},r.bi=Tl,r.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.bk=_M,r.bl=yM,r.bm=gM,r.bn=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){let l=document.createElement("source");__(t[a])||(n.crossOrigin="Anonymous"),l.src=t[a],n.appendChild(l)}return{cancel:()=>{}}},r.bo=Wy,r.bp=Nh,r.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,l=Math.floor(t.x),d=Math.floor((t.x-l)*a),f=Math.floor(t.y*a),_=this.findDEMTileFor(new Ar(n,l,n,d,f));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let l=a.getSource().maxzoom,d=1<<l,f=Math.floor(t.x),_=t.x-f,y=new Ar(l,f,l,Math.floor(_*d),Math.floor(t.y*d)),b=this.findDEMTileFor(y);if(!b||!b.dem)return e;let T=b.dem,D=1<<b.tileID.canonical.z,S=(_*D-b.tileID.canonical.x)*T.dim,P=(t.y*D-b.tileID.canonical.y)*T.dim,R=Math.floor(S),k=Math.floor(P);return(n?this.exaggeration():1)*wt(wt(T.get(R,k),T.get(R,k+1),P-k),wt(T.get(R+1,k),T.get(R+1,k+1),P-k),S-R)}getAtTileOffset(t,e,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new gi(t.wrap+(t.canonical.x+e/Je)/a,(t.canonical.y+n/Je)/a))}getAtTileOffsetFunc(t,e,n,a){return l=>{let d=this.getAtTileOffset(t,l.x,l.y),f=a.upVector(t.canonical,l.x,l.y),_=a.upVectorScale(t.canonical,e,n).metersToTile;return r._.scale(f,f,d*_),f}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;let l=Cd.create(this,t,a);return!!l&&(e.forEach(d=>{d[2]=this.exaggeration()*l.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,l=1<<t.canonical.z-a.canonical.z,d=t.canonical.x/l-a.canonical.x,f=t.canonical.y/l-a.canonical.y,_=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!n.leaves[_];y++){d*=2,f*=2;let b=2*Math.floor(f)+Math.floor(d);_=n.childOffsets[_]+b,d%=1,f%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let l of t){let d=this.getMinMaxForTile(l.tileID);d&&(n=Math.min(n,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:n,max:a}:null}},r.br=am,r.bs=gy,r.bt=rs,r.bu=Fr,r.bv=Vu,r.bw=Xb,r.bx=i0,r.by=Xy,r.bz=bS,r.c=BM,r.c$=ru,r.c0=450,r.c1=7,r.c2=Uz,r.c3=uM,r.c4=256,r.c5=aS,r.c6=cb,r.c7=In,r.c8=Hl,r.c9=Ou,r.cA=function(t){let e=1/0,n=1/0,a=-1/0,l=-1/0;for(let d of t)e=Math.min(e,d.x),n=Math.min(n,d.y),a=Math.max(a,d.x),l=Math.max(l,d.y);return{min:new rt(e,n),max:new rt(a,l)}},r.cB=Ql,r.cC=ZD,r.cD=Oi,r.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.cF=zC,r.cG=eb,r.cH=NS,r.cI=zS,r.cJ=Pb,r.cK=rw,r.cL=function(t){return t({pluginStatus:Ve,pluginURL:tt}),Bt.on("pluginStateChange",t),t},r.cM=Ld,r.cN=Mb,r.cO=Wh,r.cP=ut,r.cQ=Z,r.cR=hp,r.cS=Ml,r.cT=Ro,r.cU=function(t){let e=t.indexOf($l);return e>=0?t.slice(0,e):t},r.cV=function(t){return t.indexOf($l)>=0},r.cW=function(t){let e=t.indexOf($l);return e>=0?t.slice(e+1):""},r.cX=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cY=function(t,e,n,a){return t.type==="custom"?new $z(t,e):new vB[t.type](t,e,n,a)},r.cZ=Ea,r.c_=Bt,r.ca=1,r.cb=Dm,r.cc=0,r.cd=k1,r.ce=function(t,e,n,a,l){return Zt((t-e)/(n-e)*(l-a)+a,a,l)},r.cf=K_,r.cg=Nu,r.ch=class{constructor(t,e,n,a){this.context=t,this.format=a,this.size=n,this.texture=t.gl.createTexture();let[l,d,f]=this.size,{gl:_}=t;_.bindTexture(_.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,b=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,b=_.UNSIGNED_SHORT),this.format===_.R8&&(a=_.RED),this.format===_.R32F&&(b=_.FLOAT,a=_.RED),_.texImage3D(_.TEXTURE_3D,0,y,l,d,f,0,a,b,e.data)}bind(t,e){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},r.ci=Hb,r.cj=[1,1,1],r.ck=Cd,r.cl=Vd,r.cm=Zl,r.cn=vd,r.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new rt(1/0,1/0),max:new rt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=LS(new rt(0,0),new rt(Je,Je),t),a=[];if(e&&!vb(n,this._globalClipBounds))return a;for(let l of this._activeRegions){if(l.hiddenByOverlap||!vb(n,l))continue;let d=Z3(l.min,l.max,t);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask})}return a}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let a of e.cache.getVisibleCoordinates()){let l=e.cache.getTile(a).buckets[e.layer];l&&l.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),a=t.getClipMask();for(let l of e){if(!l.footprint)continue;let d=LS(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:n,clipMask:a})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Sy(e.min,n.min)||Sy(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],a=this._prevRegions[e];t=n.priority!==a.priority||!OS(n,a)||n.order!==a.order||n.clipMask!==a.clipMask,++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let a=this._activeRegions;if(n>=a.length)return n;let l=a[n].priority;for(;n<a.length&&a[n].priority===l;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let l=n,d=n;for(;l!==a;){let f=this._activeRegions[l];f.hiddenByOverlap=!1;for(let _=0;_<d;_++){let y=this._activeRegions[_];if(!y.hiddenByOverlap&&f.order===1/0&&vb(f,y)&&(f.hiddenByOverlap=FS(f.footprint,f.tileId,y.footprint,y.tileId),f.hiddenByOverlap))break}++l}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cp=Gl,r.cq=Yy,r.cr=tm,r.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new rs,a=new Fr,l=[],d=t+1+2,f=e[0]+1,_=e[0]+1+(1+e.length),y=(b,T,D)=>{let S=b===d-1?b-2:b===0?b:b-1;return S+=D?24575:0,[S,T]};for(let b=0;b<d;++b)n.emplaceBack(...y(b,0,!0));for(let b=0;b<f;++b)for(let T=0;T<d;++T)n.emplaceBack(...y(T,b,(T===0||T===d-1)&&!0));for(let b=0;b<e.length;++b){let T=e[b];for(let D=0;D<d;++D)n.emplaceBack(...y(D,T,!0))}for(let b=0;b<e.length;++b){let T=a.length,D=e[b]+1+2,S=new Fr;for(let k=0;k<D-1;k++){let N=k===D-2,V=N?d*(_-e.length+b-k):d;for(let Y=0;Y<d-1;Y++){let X=k*d+Y;k===0||N||Y===0||Y===d-2?(S.emplaceBack(X+1,X,X+V),S.emplaceBack(X+V,X+V+1,X+1)):(a.emplaceBack(X+1,X,X+V),a.emplaceBack(X+V,X+V+1,X+1))}}let P=sr.simpleSegment(0,T,n.length,a.length-T);for(let k=0;k<S.uint16.length;k+=3)a.emplaceBack(S.uint16[k],S.uint16[k+1],S.uint16[k+2]);let R=sr.simpleSegment(0,T,n.length,a.length-T);l.push({withoutSkirts:P,withSkirts:R})}return{vertices:n,indices:a,segments:l}}_createGrid(t){let e=this._fillGridMeshWithLods(bd,W1);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,am.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Fr;for(let f=0;f<=bd;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new Ou,a=new Ou,l=new Ou,d=new Ou;this._poleSegments=[];for(let f=0,_=0;f<H1;f++){let y=360/(1<<f);n.emplaceBack(0,-Oi,0,.5,0),a.emplaceBack(0,-Oi,0,.5,1),l.emplaceBack(0,-Oi,0,.5,.5),d.emplaceBack(0,-Oi,0,.5,.5);for(let b=0;b<=bd;b++){let T=b/bd,D=0,S=wt(0,y,T),[P,R,k]=wd(c3,u3,S,Oi);n.emplaceBack(P,R,k,T,D),a.emplaceBack(P,R,k,T,1-D);let N=rn(S);T=.5+.5*Math.sin(N),D=.5+.5*Math.cos(N),l.emplaceBack(P,R,k,T,D),d.emplaceBack(P,R,k,T,1-D)}this._poleSegments.push(sr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,my,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,my,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,my,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,my,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.ct=function(t){return lu.has(t)},r.cu=HS,r.cv=function(t,e,n=0,a=!0){let l=new rt(n,n),d=t.sub(l),f=e.add(l),_=[d,new rt(f.x,d.y),f,new rt(d.x,f.y)];return a&&_.push(d.clone()),_},r.cw=function(t,e){let n=[];for(let a=0;a<t.length;a++){let l=wa(a-1,-1,t.length-1),d=wa(a+1,-1,t.length-1),f=t[a],_=t[d],y=t[l].sub(f).unit(),b=_.sub(f).unit(),T=b.angleWithSep(y.x,y.y),D=y.add(b).unit().mult(-1*e/Math.sin(T/2));n.push(f.add(D))}return n},r.cx=YC,r.cy=JD,r.cz=function(t,e,n=0){return r._.fromValues(((e.x-n)*t.scale-t.x)*Je,(e.y*t.scale-t.y)*Je,qD(e.z,e.y))},r.d=Kh,r.d$=Lh,r.d0=Kc,r.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d2=xl,r.d3=WD,r.d4=ku,r.d5=function([t,e,n]){let a=Math.hypot(t,e,n),l=Math.atan2(t,n),d=.5*Math.PI-Math.acos(-e/a);return new pn(ti(l),ti(d))},r.d6=Vi,r.d7=Ed,r.d8=O,r.d9=hb,r.dA=function(t){let e=m_();if(!e)return;let n=e.delete(p_);t&&n.catch(t).then(()=>t())},r.dB=Pm,r.dC=AM,r.dD=function(t){Qb=Gr.resolveURL(t),$d||($d=new Xb(i0(),new Sa)),$d.broadcast("setDracoUrl",Qb)},r.dE=PM,r.dF=function(t){jd=Gr.resolveURL(t),$d||($d=new Xb(i0(),new Sa)),$d.broadcast("setMeshoptUrl",jd)},r.dG=Xi,r.dH=Q,r.dI=Jl,r.dJ=as,r.dK=Uu,r.dL=U1,r.dM=_C,r.dN=TC,r.dO=uC,r.dP=wl,r.dQ=UC,r.dR=zd,r.dS=function(t,e,n,a,l,d,f,_,y,b,T){t.createArrays(),t.tilePixelRatio=Je/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let D=t.layers[0].layout,S=t.layers[0]._unevaluatedLayout._values,P={};if(t.textSizeData.kind==="composite"){let{minZoom:V,maxZoom:Y}=t.textSizeData;P.compositeTextSizes=[S["text-size"].possiblyEvaluate(new Ot(V),_),S["text-size"].possiblyEvaluate(new Ot(Y),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:V,maxZoom:Y}=t.iconSizeData;P.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new Ot(V),_),S["icon-size"].possiblyEvaluate(new Ot(Y),_)]}P.layoutTextSize=S["text-size"].possiblyEvaluate(new Ot(y+1),_),P.layoutIconSize=S["icon-size"].possiblyEvaluate(new Ot(y+1),_),P.textMaxSize=S["text-size"].possiblyEvaluate(new Ot(18),_);let R=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",k=D.get("text-size"),N=!1;for(let V of t.features)if(V.icon&&V.icon.nameSecondary){N=!0;break}for(let V of t.features){let Y=D.get("text-font").evaluate(V,{},_).join(","),X=k.evaluate(V,{},_),K=P.layoutTextSize.evaluate(V,{},_),ae=(P.layoutIconSize.evaluate(V,{},_),{horizontal:{},vertical:void 0}),oe=V.text,fe,me=[0,0];if(oe){let De=oe.toString(),ke=D.get("text-letter-spacing").evaluate(V,{},_)*si,He=D.get("text-line-height").evaluate(V,{},_)*si,Oe=Se(De)?ke:0,je=D.get("text-anchor").evaluate(V,{},_),Re=D.get("text-variable-anchor");if(!Re){let We=D.get("text-radial-offset").evaluate(V,{},_);me=We?qC(je,[We*si,Ab]):D.get("text-offset").evaluate(V,{},_).map(Ke=>Ke*si)}let $e=R?"center":D.get("text-justify").evaluate(V,{},_),Ye=D.get("symbol-placement")==="point",Ge=Ye?D.get("text-max-width").evaluate(V,{},_)*si:1/0,at=We=>{t.allowVerticalPlacement&&Te(De)&&(ae.vertical=Db(oe,e,n,l,Y,Ge,He,je,We,Oe,me,yo.vertical,!0,K,X))};if(!R&&Re){let We=$e==="auto"?Re.map(_t=>Pb(_t)):[$e],Ke=!1;for(let _t=0;_t<We.length;_t++){let mt=We[_t];if(!ae.horizontal[mt])if(Ke)ae.horizontal[mt]=ae.horizontal[0];else{let ft=Db(oe,e,n,l,Y,Ge,He,"center",mt,Oe,me,yo.horizontal,!1,K,X);ft&&(ae.horizontal[mt]=ft,Ke=ft.positionedLines.length===1)}}at("left")}else{if($e==="auto"&&($e=Pb(je)),Ye||D.get("text-writing-mode").indexOf("horizontal")>=0||!Te(De)){let We=Db(oe,e,n,l,Y,Ge,He,je,$e,Oe,me,yo.horizontal,!1,K,X);We&&(ae.horizontal[$e]=We)}at(Ye?"left":$e)}}let xe=!1;if(V.icon&&V.icon.namePrimary){let De=a[V.icon.namePrimary];De&&(fe=ZN(l[V.icon.namePrimary],V.icon.nameSecondary?l[V.icon.nameSecondary]:void 0,D.get("icon-offset").evaluate(V,{},_),D.get("icon-anchor").evaluate(V,{},_)),xe=De.sdf,t.sdfIcons===void 0?t.sdfIcons=De.sdf:t.sdfIcons!==De.sdf&&yr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==t.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Pe=WC(ae.horizontal)||ae.vertical;t.iconsInText||(t.iconsInText=!!Pe&&Pe.iconsInText),(Pe||fe)&&tz(t,V,ae,fe,a,P,K,0,me,xe,f,_,b,T,N)}d&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dT=Py,r.dU=Ey,r.dV=yb,r.dW=Pd,r.dX=Cy,r.dY=jb,r.dZ=Iy,r.d_=Ty,r.da=fS,r.db=function(t){let e=[0,0,0],n=r.ad.identity(new Float64Array(16));return r.ad.multiply(n,t.pixelMatrix,t.globeMatrix),r._.transformMat4(e,e,n),new rt(e[0],e[1])},r.dc=ot,r.dd=qe,r.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(Bh==null){let a=n.navigator?n.navigator.userAgent:null;Bh=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Bh}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.df=kh,r.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",vp,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Z(t))return t;let n=uo(t);return n.params.push(`sdk=js-${E}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Z(t))return t;let n=uo(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Z(t))return t;let n=uo(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!Z(t))return t;let l=uo(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),n&&l.params.push(`language=${n}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){let l=uo(t);return Z(t)?(l.path=`/styles/v1${l.path}/sprite${e}${n}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${e}${n}`,Sl(l))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Z(t))return t;let a=uo(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${qh.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${O.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${O.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${O.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${O.TILE_URL_VERSION}${a.path}`);let l=this._customAccessToken||function(d){for(let f of d){let _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(a.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(t,e){let n=uo(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${n.path.replace(`/${O.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let l=n.params;return e&&(l=l.filter(d=>!d.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(t,e){let n=!!e&&Z(e),a=[];for(let l of t.tiles||[])z(l)?a.push(this.canonicalizeTileURL(l,n)):a.push(l);return a}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=uo(O.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!O.REQUIRE_ACCESS_TOKEN)return Sl(t);if(e=e||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Sl(t)}},r.dh=function(t,e){e?lu.add(t):lu.delete(t)},r.di=qh,r.dj=a1,r.dk=Xh,r.dl=xp,r.dm=x_,r.dn=s1,r.dp=function(t){lu.delete(t)},r.dq=Cl,r.dr=au,r.ds=bl,r.dt=E,r.du=function(t,e){dp=t,fp=e},r.dv=function(t,e,n=!1){if(Ve===et||Ve===it||Ve===nt)throw new Error("setRTLTextPlugin cannot be called multiple times.");tt=Gr.resolveURL(t),Ve=et,ze=e,At(),n||tn()},r.dw=on,r.dx=function(){i0().acquire(Kb)},r.dy=function(){let t=Om;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Kb),Om=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dz=Rm,r.e=Gr,r.e0=yC,r.e1=ct,r.e2=Ia,r.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==OM){let n=new Uint32Array(t,0,7),[,,a,l,d,f]=n;e=n.byteLength+l+d+f+d,(a!==t.byteLength||e>=t.byteLength)&&yr("Invalid b3dm header information.")}return NM(t,e)},r.e4=function(t,e){let n=BM(t);for(let a of n){for(let l of a.meshes)mB(l);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(gB(a.lights,e)))}return n},r.e5=l0,r.e6=MM,r.e7=Cn,r.e8=function(t){nu(),Qo&&Qo.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},r.f=vi,r.g=function(t,e){return ru(ni(t,{type:"json"}),e)},r.h=Os,r.i=_o,r.j=BC,r.k=Cb,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>NM(e,0,t))},r.m=class extends n0{},r.n=Ma,r.o=Ip,r.p=mz,r.q=gd,r.r=p,r.s=s,r.t=F,r.u=Ei,r.v=ii,r.w=yr,r.x=G,r.y=B,r.z=sd}),h(["./shared"],function(r){function E(ge){let j=ge?ge.url.toString():void 0;return j?performance.getEntriesByName(j):[]}function C(ge){if(typeof ge=="number"||typeof ge=="boolean"||typeof ge=="string"||ge==null)return JSON.stringify(ge);if(Array.isArray(ge)){let W="[";for(let ie of ge)W+=`${C(ie)},`;return`${W}]`}let j="{";for(let W of Object.keys(ge).sort())j+=`${W}:${C(ge[W])},`;return`${j}}`}function O(ge){let j="";for(let W of r.cE)j+=`/${C(ge[W])}`;return j}class z{constructor(j){this.keyCache={},this._layers={},this._layerConfigs={},j&&this.replace(j)}replace(j,W){this._layerConfigs={},this._layers={},this.update(j,[],W)}update(j,W,ie){this._options=ie;for(let de of j)this._layerConfigs[de.id]=de,(this._layers[de.id]=r.cY(de,this.scope,null,this._options)).compileFilter(),this.keyCache[de.id]&&delete this.keyCache[de.id];for(let de of W)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};let he=function(de,ve){let Ce={};for(let Me=0;Me<de.length;Me++){let Qe=ve&&ve[de[Me].id]||O(de[Me]);ve&&(ve[de[Me].id]=Qe);let Ze=Ce[Qe];Ze||(Ze=Ce[Qe]=[]),Ze.push(de[Me])}let _e=[];for(let Me in Ce)_e.push(Ce[Me]);return _e}(r.dG(this._layerConfigs),this.keyCache);for(let de of he){let ve=de.map(pt=>this._layers[pt.id]),Ce=ve[0];if(Ce.visibility==="none")continue;let _e=Ce.source||"",Me=this.familiesBySource[_e];Me||(Me=this.familiesBySource[_e]={});let Qe=Ce.sourceLayer||"_geojsonTileLayer",Ze=Me[Qe];Ze||(Ze=Me[Qe]=[]),Ze.push(ve)}}}let Z=1*r.dJ;class ce{constructor(j){let W={},ie=[];for(let Ce in j){let _e=j[Ce],Me=W[Ce]={};for(let Qe in _e.glyphs){let Ze=_e.glyphs[+Qe];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;let pt=Ze.metrics.localGlyph?Z:1,It={x:0,y:0,w:Ze.bitmap.width+2*pt,h:Ze.bitmap.height+2*pt};ie.push(It),Me[Qe]=It}}let{w:he,h:de}=r.j(ie),ve=new r.dI({width:he||1,height:de||1});for(let Ce in j){let _e=j[Ce];for(let Me in _e.glyphs){let Qe=_e.glyphs[+Me];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;let Ze=W[Ce][Me],pt=Qe.metrics.localGlyph?Z:1;r.dI.copy(Qe.bitmap,ve,{x:0,y:0},{x:Ze.x+pt,y:Ze.y+pt},Qe.bitmap)}}this.image=ve,this.positions=W}}r.dH(ce,"GlyphAtlas");class Ie{constructor(j){this.tileID=new r.aL(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.tileZoom=j.tileZoom,this.uid=j.uid,this.zoom=j.zoom,this.lut=j.lut,this.canonical=j.tileID.canonical,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.scope=j.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.promoteId=j.promoteId,this.isSymbolTile=j.isSymbolTile,this.tileTransform=r.dK(j.tileID.canonical,j.projection),this.projection=j.projection,this.brightness=j.brightness,this.extraShadowCaster=!!j.extraShadowCaster,this.tessellationStep=j.tessellationStep}parse(j,W,ie,he,de){this.status="parsing",this.data=j,this.collisionBoxArray=new r.dL;let ve=new r.dM(Object.keys(j.layers).sort()),Ce=new r.dN(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];let _e={},Me=new r.dO(256,256),Qe={featureIndex:Ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Me,availableImages:ie,brightness:this.brightness},Ze=W.familiesBySource[this.source];for(let ht in Ze){let Kn=j.layers[ht];if(!Kn)continue;let Ln=!1,un=!1,_r=!1;for(let Jr of Ze[ht])Jr[0].type==="symbol"?Ln=!0:un=!0,Jr[0].is3D()&&Jr[0].type!=="model"&&(_r=!0);if(this.extraShadowCaster&&!_r||this.isSymbolTile===!0&&!Ln||this.isSymbolTile===!1&&!un)continue;Kn.version===1&&r.w(`Vector tile source "${this.source}" layer "${ht}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Qn=ve.encode(ht),Dr=[];for(let Jr=0;Jr<Kn.length;Jr++){let ei=Kn.feature(Jr),va=Ce.getId(ei,ht);Dr.push({feature:ei,id:va,index:Jr,sourceLayerIndex:Qn})}for(let Jr of Ze[ht]){let ei=Jr[0];(!this.extraShadowCaster||ei.is3D()&&ei.type!=="model")&&(this.isSymbolTile!==void 0&&ei.type==="symbol"!==this.isSymbolTile||ei.minzoom&&this.zoom<Math.floor(ei.minzoom)||ei.maxzoom&&this.zoom>=ei.maxzoom||ei.visibility!=="none"&&(be(Jr,this.zoom,Qe.brightness,ie),(_e[ei.id]=ei.createBucket({index:Ce.bucketLayerIDs.length,layers:Jr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Dr,Qe,this.tileID.canonical,this.tileTransform),Ce.bucketLayerIDs.push(Jr.map(va=>va.id))))}}let pt,It,Wt,Kt;Me.trim();let kt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},nn=()=>{if(pt)return this.status="done",de(pt);if(this.extraShadowCaster)this.status="done",de(null,{buckets:r.dG(_e).filter(ht=>!ht.isEmpty()),featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Qe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(It&&Wt&&Kt){let ht=new ce(It),Kn=new r.dQ(Wt,Kt,this.lut);for(let Ln in _e){let un=_e[Ln];un instanceof r.dR?(be(un.layers,this.zoom,Qe.brightness,ie),r.dS(un,It,ht.positions,Wt,Kn.iconPositions,this.showCollisionBoxes,ie,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):un.hasPattern&&(un instanceof r.dT||un instanceof r.dU||un instanceof r.b_)&&(be(un.layers,this.zoom,Qe.brightness,ie),un.addFeatures(Qe,this.tileID.canonical,Kn.patternPositions,ie,this.tileTransform,this.brightness))}this.status="done",de(null,{buckets:r.dG(_e).filter(Ln=>!Ln.isEmpty()),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ht.image,lineAtlas:Me,imageAtlas:Kn,brightness:Qe.brightness})}};if(!this.extraShadowCaster){let ht=r.dP(Qe.glyphDependencies,un=>Object.keys(un).map(Number));Object.keys(ht).length?he.send("getGlyphs",{uid:this.uid,stacks:ht,scope:this.scope},(un,_r)=>{pt||(pt=un,It=_r,nn())},void 0,!1,kt):It={};let Kn=Object.keys(Qe.iconDependencies);Kn.length?he.send("getImages",{icons:Kn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(un,_r)=>{pt||(pt=un,Wt=_r,nn())},void 0,!1,kt):Wt={};let Ln=Object.keys(Qe.patternDependencies);Ln.length?he.send("getImages",{icons:Ln,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(un,_r)=>{pt||(pt=un,Kt=_r,nn())},void 0,!1,kt):Kt={}}nn()}}function be(ge,j,W,ie){let he=new r.X(j,{brightness:W});for(let de of ge)de.recalculate(he,ie)}class qe extends r.E{constructor(j,W,ie,he,de,ve){super(),this.actor=j,this.layerIndex=W,this.availableImages=ie,this.loadVectorData=de||r.ap,this.loading={},this.loaded={},this.deduped=new r.ao(j.scheduler),this.isSpriteLoaded=he,this.scheduler=j.scheduler,this.brightness=ve}loadTile(j,W){let ie=j.uid,he=j&&j.request,de=he&&he.collectResourceTiming,ve=this.loading[ie]=new Ie(j);ve.abort=this.loadVectorData(j,(Ce,_e)=>{let Me=!this.loading[ie];if(delete this.loading[ie],Me||Ce||!_e)return ve.status="done",Me||(this.loaded[ie]=ve),W(Ce);let Qe=_e.rawData,Ze={};_e.expires&&(Ze.expires=_e.expires),_e.cacheControl&&(Ze.cacheControl=_e.cacheControl),ve.vectorTile=_e.vectorTile||new r.dV(new r.dW(Qe));let pt=()=>{ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,(It,Wt)=>{if(It||!Wt)return W(It);let Kt={};if(de){let kt=E(he);kt.length>0&&(Kt.resourceTiming=JSON.parse(JSON.stringify(kt)))}W(null,r.W({rawTileData:Qe.slice(0)},Wt,Ze,Kt))})};this.isSpriteLoaded?pt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(pt,{type:"parseTile",isSymbolTile:j.isSymbolTile,zoom:j.tileZoom}):pt()}),this.loaded=this.loaded||{},this.loaded[ie]=ve})}reloadTile(j,W){let ie=this.loaded,he=j.uid;if(ie&&ie[he]){let de=ie[he];de.showCollisionBoxes=j.showCollisionBoxes,de.projection=j.projection,de.brightness=j.brightness,de.tileTransform=r.dK(j.tileID.canonical,j.projection),de.extraShadowCaster=j.extraShadowCaster,de.lut=j.lut;let ve=(Ce,_e)=>{let Me=de.reloadCallback;Me&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,Me)),W(Ce,_e)};de.status==="parsing"?de.reloadCallback=ve:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,ve):ve())}else W(null,void 0)}abortTile(j,W){let ie=j.uid,he=this.loading[ie];he&&(he.abort&&he.abort(),delete this.loading[ie]),W()}removeTile(j,W){let ie=this.loaded,he=j.uid;ie&&ie[he]&&delete ie[he],W()}}class ot{loadTile(j,W){let{uid:ie,encoding:he,rawImageData:de,padding:ve}=j,Ce=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,ve):de;W(null,new r.dX(ie,Ce,he,ve<1))}getImageData(j,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);let ie=this.offscreenCanvasContext.getImageData(-W,-W,j.width+2*W,j.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ie}}class dt{decodeRasterArray({task:j,buffer:W},ie){r.dY.performDecoding(W,j).then(he=>{ie(null,he)},he=>{ie(he)})}}let ct=r.dZ.prototype.toGeoJSON,bt=class{constructor(ge){this._feature=ge,this.extent=r.a3,this.type=ge.type,this.properties=ge.tags,"id"in ge&&!isNaN(ge.id)&&(this.id=parseInt(ge.id,10))}loadGeometry(){if(this._feature.type===1){let ge=[];for(let j of this._feature.geometry)ge.push([new r.P(j[0],j[1])]);return ge}{let ge=[];for(let j of this._feature.geometry){let W=[];for(let ie of j)W.push(new r.P(ie[0],ie[1]));ge.push(W)}return ge}}toGeoJSON(ge,j,W){return ct.call(this,ge,j,W)}},St=class{constructor(ge){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.a3,this.length=ge.length,this._features=ge}feature(ge){return new bt(this._features[ge])}},$t=64/4096;class dr{constructor(){this.features=new Map}clear(){this.features.clear()}load(j=[],W){for(let ie of j){let he=ie.id;if(he==null)continue;let de=this.features.get(he);de&&this.updateCache(de,W),ie.geometry?(de=ir(ie),this.updateCache(de,W),this.features.set(he,de)):this.features.delete(he),this.updateCache(de,W)}}updateCache(j,W){for(let{canonical:ie,uid:he}of Object.values(W)){let{z:de,x:ve,y:Ce}=ie;Xn(j,Math.pow(2,de),ve,Ce)&&delete W[he]}}getTile(j,W,ie){let he=Math.pow(2,j),de=[];for(let ve of this.features.values())Xn(ve,he,W,ie)&&de.push(fa(ve,he,W,ie));return{features:de}}getFeatures(){return[...this.features.values()]}}function Xn({minX:ge,minY:j,maxX:W,maxY:ie},he,de,ve){return ge<(de+1+$t)/he&&j<(ve+1+$t)/he&&W>(de-$t)/he&&ie>(ve-$t)/he}function ir(ge){let{id:j,geometry:W,properties:ie}=ge;if(!W)return;if(W.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:he,coordinates:de}=W,ve={id:j,type:1,geometry:[],tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ce=ve.geometry;if(he==="Point")Yt(de,Ce,ve);else if(he==="MultiPoint")for(let _e of de)Yt(_e,Ce,ve);else if(he==="LineString")ve.type=2,di(de,Ce,ve);else if(he==="MultiLineString")ve.type=2,Xt(de,Ce,ve);else if(he==="Polygon")ve.type=3,Xt(de,Ce,ve,!0);else{if(he!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ve.type=3;for(let _e of de)Xt(_e,Ce,ve,!0)}return ve}function Yt([ge,j],W,ie){let he=r.aj(ge),de=r.ak(j);de=de<0?0:de>1?1:de,W.push(he,de),ie.minX=Math.min(ie.minX,he),ie.minY=Math.min(ie.minY,de),ie.maxX=Math.max(ie.maxX,he),ie.maxY=Math.max(ie.maxY,de)}function di(ge,j,W,ie=!1,he=!1){let de=[];for(let ve of ge)Yt(ve,de,W);j.push(de),ie&&function(ve,Ce){let _e=0;for(let Me=0,Qe=ve.length,Ze=Qe-2;Me<Qe;Ze=Me,Me+=2)_e+=(ve[Me]-ve[Ze])*(ve[Me+1]+ve[Ze+1]);if(_e>0===Ce)for(let Me=0,Qe=ve.length;Me<Qe/2;Me+=2){let Ze=ve[Me],pt=ve[Me+1];ve[Me]=ve[Qe-2-Me],ve[Me+1]=ve[Qe-1-Me],ve[Qe-2-Me]=Ze,ve[Qe-1-Me]=pt}}(de,he)}function Xt(ge,j,W,ie=!1){for(let he=0;he<ge.length;he++)di(ge[he],j,W,ie,he===0)}function fa(ge,j,W,ie){let{id:he,type:de,geometry:ve,tags:Ce}=ge,_e=[];if(de===1)Ni(ve,j,W,ie,_e);else for(let Me of ve)_e.push(Ni(Me,j,W,ie));return{id:he,type:de,geometry:_e,tags:Ce}}function Ni(ge,j,W,ie,he=[]){for(let de=0;de<ge.length;de+=2)he.push(Is(ge[de],ge[de+1],j,W,ie));return he}function Is(ge,j,W,ie,he){return[Math.round(r.a3*(ge*W-ie)),Math.round(r.a3*(j*W-he))]}var On={exports:{}},Ds=r.d$,vt=r.d_.VectorTileFeature,Nt=Gt;function Gt(ge,j){this.options=j||{},this.features=ge,this.length=ge.length}function En(ge,j){this.id=typeof ge.id=="number"?ge.id:void 0,this.type=ge.type,this.rawGeometry=ge.type===1?[ge.geometry]:ge.geometry,this.properties=ge.tags,this.extent=j||4096}Gt.prototype.feature=function(ge){return new En(this.features[ge],this.options.extent)},En.prototype.loadGeometry=function(){var ge=this.rawGeometry;this.geometry=[];for(var j=0;j<ge.length;j++){for(var W=ge[j],ie=[],he=0;he<W.length;he++)ie.push(new Ds(W[he][0],W[he][1]));this.geometry.push(ie)}return this.geometry},En.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ge=this.geometry,j=1/0,W=-1/0,ie=1/0,he=-1/0,de=0;de<ge.length;de++)for(var ve=ge[de],Ce=0;Ce<ve.length;Ce++){var _e=ve[Ce];j=Math.min(j,_e.x),W=Math.max(W,_e.x),ie=Math.min(ie,_e.y),he=Math.max(he,_e.y)}return[j,ie,W,he]},En.prototype.toGeoJSON=vt.prototype.toGeoJSON;var zt=r.e0,Kr=Nt;function Zn(ge){var j=new zt;return function(W,ie){for(var he in W.layers)ie.writeMessage(3,zi,W.layers[he])}(ge,j),j.finish()}function zi(ge,j){var W;j.writeVarintField(15,ge.version||1),j.writeStringField(1,ge.name||""),j.writeVarintField(5,ge.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<ge.length;W++)ie.feature=ge.feature(W),j.writeMessage(2,or,ie);var he=ie.keys;for(W=0;W<he.length;W++)j.writeStringField(3,he[W]);var de=ie.values;for(W=0;W<de.length;W++)j.writeMessage(4,Qr,de[W])}function or(ge,j){var W=ge.feature;W.id!==void 0&&j.writeVarintField(1,W.id),j.writeMessage(2,pa,ge),j.writeVarintField(3,W.type),j.writeMessage(4,kn,W)}function pa(ge,j){var W=ge.feature,ie=ge.keys,he=ge.values,de=ge.keycache,ve=ge.valuecache;for(var Ce in W.properties){var _e=W.properties[Ce],Me=de[Ce];if(_e!==null){Me===void 0&&(ie.push(Ce),de[Ce]=Me=ie.length-1),j.writeVarint(Me);var Qe=typeof _e;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(_e=JSON.stringify(_e));var Ze=Qe+":"+_e,pt=ve[Ze];pt===void 0&&(he.push(_e),ve[Ze]=pt=he.length-1),j.writeVarint(pt)}}}function Ct(ge,j){return(j<<3)+(7&ge)}function wr(ge){return ge<<1^ge>>31}function kn(ge,j){for(var W=ge.loadGeometry(),ie=ge.type,he=0,de=0,ve=W.length,Ce=0;Ce<ve;Ce++){var _e=W[Ce],Me=1;ie===1&&(Me=_e.length),j.writeVarint(Ct(1,Me));for(var Qe=ie===3?_e.length-1:_e.length,Ze=0;Ze<Qe;Ze++){Ze===1&&ie!==1&&j.writeVarint(Ct(2,Qe-1));var pt=_e[Ze].x-he,It=_e[Ze].y-de;j.writeVarint(wr(pt)),j.writeVarint(wr(It)),he+=pt,de+=It}ie===3&&j.writeVarint(Ct(7,1))}}function Qr(ge,j){var W=typeof ge;W==="string"?j.writeStringField(1,ge):W==="boolean"?j.writeBooleanField(7,ge):W==="number"&&(ge%1!=0?j.writeDoubleField(3,ge):ge<0?j.writeSVarintField(6,ge):j.writeVarintField(5,ge))}On.exports=Zn,On.exports.fromVectorTileJs=Zn,On.exports.fromGeojsonVt=function(ge,j){j=j||{};var W={};for(var ie in ge)W[ie]=new Kr(ge[ie].features,j),W[ie].name=ie,W[ie].version=j.version,W[ie].extent=j.extent;return Zn({layers:W})},On.exports.GeoJSONWrapper=Kr;var Yo=r.e1(On.exports);let Ss={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},Uc=Math.fround||(ol=new Float32Array(1),ge=>(ol[0]=+ge,ol[0]));var ol;let lo=3,co=5,Vc=6;class Mt{constructor(j){this.options=Object.assign(Object.create(Ss),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){let{log:W,minZoom:ie,maxZoom:he}=this.options;W&&console.time("total time");let de=`prepare ${j.length} points`;W&&console.time(de),this.points=j;let ve=[];for(let _e=0;_e<j.length;_e++){let Me=j[_e];if(!Me.geometry)continue;let[Qe,Ze]=Me.geometry.coordinates,pt=Uc(Mi(Qe)),It=Uc(ma(Ze));ve.push(pt,It,1/0,_e,-1,1),this.options.reduce&&ve.push(0)}let Ce=this.trees[he+1]=this._createTree(ve);W&&console.timeEnd(de);for(let _e=he;_e>=ie;_e--){let Me=+Date.now();Ce=this.trees[_e]=this._createTree(this._cluster(Ce,_e)),W&&console.log("z%d: %d clusters in %dms",_e,Ce.numItems,+Date.now()-Me)}return W&&console.timeEnd("total time"),this}getClusters(j,W){let ie=((j[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,j[1])),de=j[2]===180?180:((j[2]+180)%360+360)%360-180,ve=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)ie=-180,de=180;else if(ie>de){let Ze=this.getClusters([ie,he,180,ve],W),pt=this.getClusters([-180,he,de,ve],W);return Ze.concat(pt)}let Ce=this.trees[this._limitZoom(W)],_e=Ce.range(Mi(ie),ma(ve),Mi(de),ma(he)),Me=Ce.data,Qe=[];for(let Ze of _e){let pt=this.stride*Ze;Qe.push(Me[pt+co]>1?Pt(Me,pt,this.clusterProps):this.points[Me[pt+lo]])}return Qe}getChildren(j){let W=this._getOriginId(j),ie=this._getOriginZoom(j),he="No cluster with the specified id.",de=this.trees[ie];if(!de)throw new Error(he);let ve=de.data;if(W*this.stride>=ve.length)throw new Error(he);let Ce=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),_e=de.within(ve[W*this.stride],ve[W*this.stride+1],Ce),Me=[];for(let Qe of _e){let Ze=Qe*this.stride;ve[Ze+4]===j&&Me.push(ve[Ze+co]>1?Pt(ve,Ze,this.clusterProps):this.points[ve[Ze+lo]])}if(Me.length===0)throw new Error(he);return Me}getLeaves(j,W,ie){let he=[];return this._appendLeaves(he,j,W=W||10,ie=ie||0,0),he}getTile(j,W,ie){let he=this.trees[this._limitZoom(j)],de=Math.pow(2,j),{extent:ve,radius:Ce}=this.options,_e=Ce/ve,Me=(ie-_e)/de,Qe=(ie+1+_e)/de,Ze={features:[]};return this._addTileFeatures(he.range((W-_e)/de,Me,(W+1+_e)/de,Qe),he.data,W,ie,de,Ze),W===0&&this._addTileFeatures(he.range(1-_e/de,Me,1,Qe),he.data,de,ie,de,Ze),W===de-1&&this._addTileFeatures(he.range(0,Me,_e/de,Qe),he.data,-1,ie,de,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(j){let W=this._getOriginZoom(j)-1;for(;W<=this.options.maxZoom;){let ie=this.getChildren(j);if(W++,ie.length!==1)break;j=ie[0].properties.cluster_id}return W}_appendLeaves(j,W,ie,he,de){let ve=this.getChildren(W);for(let Ce of ve){let _e=Ce.properties;if(_e&&_e.cluster?de+_e.point_count<=he?de+=_e.point_count:de=this._appendLeaves(j,_e.cluster_id,ie,he,de):de<he?de++:j.push(Ce),j.length===ie)break}return de}_createTree(j){let W=new r.cK(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<j.length;ie+=this.stride)W.add(j[ie],j[ie+1]);return W.finish(),W.data=j,W}_addTileFeatures(j,W,ie,he,de,ve){for(let Ce of j){let _e=Ce*this.stride,Me=W[_e+co]>1,Qe,Ze,pt;if(Me)Qe=sl(W,_e,this.clusterProps),Ze=W[_e],pt=W[_e+1];else{let Kt=this.points[W[_e+lo]];Qe=Kt.properties;let[kt,nn]=Kt.geometry.coordinates;Ze=Mi(kt),pt=ma(nn)}let It={type:1,geometry:[[Math.round(this.options.extent*(Ze*de-ie)),Math.round(this.options.extent*(pt*de-he))]],tags:Qe},Wt;Wt=Me||this.options.generateId?W[_e+lo]:this.points[W[_e+lo]].id,Wt!==void 0&&(It.id=Wt),ve.features.push(It)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,W){let{radius:ie,extent:he,reduce:de,minPoints:ve}=this.options,Ce=ie/(he*Math.pow(2,W)),_e=j.data,Me=[],Qe=this.stride;for(let Ze=0;Ze<_e.length;Ze+=Qe){if(_e[Ze+2]<=W)continue;_e[Ze+2]=W;let pt=_e[Ze],It=_e[Ze+1],Wt=j.within(_e[Ze],_e[Ze+1],Ce),Kt=_e[Ze+co],kt=Kt;for(let nn of Wt){let ht=nn*Qe;_e[ht+2]>W&&(kt+=_e[ht+co])}if(kt>Kt&&kt>=ve){let nn,ht=pt*Kt,Kn=It*Kt,Ln=-1,un=(Ze/Qe<<5)+(W+1)+this.points.length;for(let _r of Wt){let Qn=_r*Qe;if(_e[Qn+2]<=W)continue;_e[Qn+2]=W;let Dr=_e[Qn+co];ht+=_e[Qn]*Dr,Kn+=_e[Qn+1]*Dr,_e[Qn+4]=un,de&&(nn||(nn=this._map(_e,Ze,!0),Ln=this.clusterProps.length,this.clusterProps.push(nn)),de(nn,this._map(_e,Qn)))}_e[Ze+4]=un,Me.push(ht/kt,Kn/kt,1/0,un,-1,kt),de&&Me.push(Ln)}else{for(let nn=0;nn<Qe;nn++)Me.push(_e[Ze+nn]);if(kt>1)for(let nn of Wt){let ht=nn*Qe;if(!(_e[ht+2]<=W)){_e[ht+2]=W;for(let Kn=0;Kn<Qe;Kn++)Me.push(_e[ht+Kn])}}}}return Me}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,W,ie){if(j[W+co]>1){let ve=this.clusterProps[j[W+Vc]];return ie?Object.assign({},ve):ve}let he=this.points[j[W+lo]].properties,de=this.options.map(he);return ie&&de===he?Object.assign({},de):de}}function Pt(ge,j,W){return{type:"Feature",id:ge[j+lo],properties:sl(ge,j,W),geometry:{type:"Point",coordinates:[(ie=ge[j],360*(ie-.5)),al(ge[j+1])]}};var ie}function sl(ge,j,W){let ie=ge[j+co],he=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,de=ge[j+Vc],ve=de===-1?{}:Object.assign({},W[de]);return Object.assign(ve,{cluster:!0,cluster_id:ge[j+lo],point_count:ie,point_count_abbreviated:he})}function Mi(ge){return ge/360+.5}function ma(ge){let j=Math.sin(ge*Math.PI/180),W=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return W<0?0:W>1?1:W}function al(ge){let j=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function ll(ge,j,W,ie){let he=ie,de=j+(W-j>>1),ve,Ce=W-j,_e=ge[j],Me=ge[j+1],Qe=ge[W],Ze=ge[W+1];for(let pt=j+3;pt<W;pt+=3){let It=jc(ge[pt],ge[pt+1],_e,Me,Qe,Ze);if(It>he)ve=pt,he=It;else if(It===he){let Wt=Math.abs(pt-de);Wt<Ce&&(ve=pt,Ce=Wt)}}he>ie&&(ve-j>3&&ll(ge,j,ve,ie),ge[ve+2]=he,W-ve>3&&ll(ge,ve,W,ie))}function jc(ge,j,W,ie,he,de){let ve=he-W,Ce=de-ie;if(ve!==0||Ce!==0){let _e=((ge-W)*ve+(j-ie)*Ce)/(ve*ve+Ce*Ce);_e>1?(W=he,ie=de):_e>0&&(W+=ve*_e,ie+=Ce*_e)}return ve=ge-W,Ce=j-ie,ve*ve+Ce*Ce}function Cs(ge,j,W,ie){let he={id:ge??null,type:j,geometry:W,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")ga(he,W);else if(j==="Polygon")ga(he,W[0]);else if(j==="MultiLineString")for(let de of W)ga(he,de);else if(j==="MultiPolygon")for(let de of W)ga(he,de[0]);return he}function ga(ge,j){for(let W=0;W<j.length;W+=3)ge.minX=Math.min(ge.minX,j[W]),ge.minY=Math.min(ge.minY,j[W+1]),ge.maxX=Math.max(ge.maxX,j[W]),ge.maxY=Math.max(ge.maxY,j[W+1])}function cl(ge,j,W,ie){if(!j.geometry)return;let he=j.geometry.coordinates;if(he&&he.length===0)return;let de=j.geometry.type,ve=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),Ce=[],_e=j.id;if(W.promoteId?_e=j.properties[W.promoteId]:W.generateId&&(_e=ie||0),de==="Point")$c(he,Ce);else if(de==="MultiPoint")for(let Me of he)$c(Me,Ce);else if(de==="LineString")ul(he,Ce,ve,!1);else if(de==="MultiLineString"){if(W.lineMetrics){for(let Me of he)Ce=[],ul(Me,Ce,ve,!1),ge.push(Cs(_e,"LineString",Ce,j.properties));return}hl(he,Ce,ve,!1)}else if(de==="Polygon")hl(he,Ce,ve,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(let Me of j.geometry.geometries)cl(ge,{id:_e,geometry:Me,properties:j.properties},W,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Me of he){let Qe=[];hl(Me,Qe,ve,!0),Ce.push(Qe)}}ge.push(Cs(_e,de,Ce,j.properties))}function $c(ge,j){j.push(Wi(ge[0]),Mh(ge[1]),0)}function ul(ge,j,W,ie){let he,de,ve=0;for(let _e=0;_e<ge.length;_e++){let Me=Wi(ge[_e][0]),Qe=Mh(ge[_e][1]);j.push(Me,Qe,0),_e>0&&(ve+=ie?(he*Qe-Me*de)/2:Math.sqrt(Math.pow(Me-he,2)+Math.pow(Qe-de,2))),he=Me,de=Qe}let Ce=j.length-3;j[2]=1,ll(j,0,Ce,W),j[Ce+2]=1,j.size=Math.abs(ve),j.start=0,j.end=j.size}function hl(ge,j,W,ie){for(let he=0;he<ge.length;he++){let de=[];ul(ge[he],de,W,ie),j.push(de)}}function Wi(ge){return ge/360+.5}function Mh(ge){let j=Math.sin(ge*Math.PI/180),W=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return W<0?0:W>1?1:W}function Rt(ge,j,W,ie,he,de,ve,Ce){if(ie/=j,de>=(W/=j)&&ve<ie)return ge;if(ve<W||de>=ie)return null;let _e=[];for(let Me of ge){let Qe=Me.geometry,Ze=Me.type,pt=he===0?Me.minX:Me.minY,It=he===0?Me.maxX:Me.maxY;if(pt>=W&&It<ie){_e.push(Me);continue}if(It<W||pt>=ie)continue;let Wt=[];if(Ze==="Point"||Ze==="MultiPoint")Gc(Qe,Wt,W,ie,he);else if(Ze==="LineString")fr(Qe,Wt,W,ie,he,!1,Ce.lineMetrics);else if(Ze==="MultiLineString")_a(Qe,Wt,W,ie,he,!1);else if(Ze==="Polygon")_a(Qe,Wt,W,ie,he,!0);else if(Ze==="MultiPolygon")for(let Kt of Qe){let kt=[];_a(Kt,kt,W,ie,he,!0),kt.length&&Wt.push(kt)}if(Wt.length){if(Ce.lineMetrics&&Ze==="LineString"){for(let Kt of Wt)_e.push(Cs(Me.id,Ze,Kt,Me.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Wt.length===1?(Ze="LineString",Wt=Wt[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Wt.length===3?"Point":"MultiPoint"),_e.push(Cs(Me.id,Ze,Wt,Me.tags))}}return _e.length?_e:null}function Gc(ge,j,W,ie,he){for(let de=0;de<ge.length;de+=3){let ve=ge[de+he];ve>=W&&ve<=ie&&Mo(j,ge[de],ge[de+1],ge[de+2])}}function fr(ge,j,W,ie,he,de,ve){let Ce=dl(ge),_e=he===0?Ao:qc,Me,Qe,Ze=ge.start;for(let kt=0;kt<ge.length-3;kt+=3){let nn=ge[kt],ht=ge[kt+1],Kn=ge[kt+2],Ln=ge[kt+3],un=ge[kt+4],_r=he===0?nn:ht,Qn=he===0?Ln:un,Dr=!1;ve&&(Me=Math.sqrt(Math.pow(nn-Ln,2)+Math.pow(ht-un,2))),_r<W?Qn>W&&(Qe=_e(Ce,nn,ht,Ln,un,W),ve&&(Ce.start=Ze+Me*Qe)):_r>ie?Qn<ie&&(Qe=_e(Ce,nn,ht,Ln,un,ie),ve&&(Ce.start=Ze+Me*Qe)):Mo(Ce,nn,ht,Kn),Qn<W&&_r>=W&&(Qe=_e(Ce,nn,ht,Ln,un,W),Dr=!0),Qn>ie&&_r<=ie&&(Qe=_e(Ce,nn,ht,Ln,un,ie),Dr=!0),!de&&Dr&&(ve&&(Ce.end=Ze+Me*Qe),j.push(Ce),Ce=dl(ge)),ve&&(Ze+=Me)}let pt=ge.length-3,It=ge[pt],Wt=ge[pt+1],Kt=he===0?It:Wt;Kt>=W&&Kt<=ie&&Mo(Ce,It,Wt,ge[pt+2]),pt=Ce.length-3,de&&pt>=3&&(Ce[pt]!==Ce[0]||Ce[pt+1]!==Ce[1])&&Mo(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&j.push(Ce)}function dl(ge){let j=[];return j.size=ge.size,j.start=ge.start,j.end=ge.end,j}function _a(ge,j,W,ie,he,de){for(let ve of ge)fr(ve,j,W,ie,he,de,!1)}function Mo(ge,j,W,ie){ge.push(j,W,ie)}function Ao(ge,j,W,ie,he,de){let ve=(de-j)/(ie-j);return Mo(ge,de,W+(he-W)*ve,1),ve}function qc(ge,j,W,ie,he,de){let ve=(de-W)/(he-W);return Mo(ge,j+(ie-j)*ve,de,1),ve}function Ms(ge,j){let W=[];for(let ie=0;ie<ge.length;ie++){let he=ge[ie],de=he.type,ve;if(de==="Point"||de==="MultiPoint"||de==="LineString")ve=As(he.geometry,j);else if(de==="MultiLineString"||de==="Polygon"){ve=[];for(let Ce of he.geometry)ve.push(As(Ce,j))}else if(de==="MultiPolygon"){ve=[];for(let Ce of he.geometry){let _e=[];for(let Me of Ce)_e.push(As(Me,j));ve.push(_e)}}W.push(Cs(he.id,de,ve,he.tags))}return W}function As(ge,j){let W=[];W.size=ge.size,ge.start!==void 0&&(W.start=ge.start,W.end=ge.end);for(let ie=0;ie<ge.length;ie+=3)W.push(ge[ie]+j,ge[ie+1],ge[ie+2]);return W}function fl(ge,j){if(ge.transformed)return ge;let W=1<<ge.z,ie=ge.x,he=ge.y;for(let de of ge.features){let ve=de.geometry,Ce=de.type;if(de.geometry=[],Ce===1)for(let _e=0;_e<ve.length;_e+=2)de.geometry.push(pl(ve[_e],ve[_e+1],j,W,ie,he));else for(let _e=0;_e<ve.length;_e++){let Me=[];for(let Qe=0;Qe<ve[_e].length;Qe+=2)Me.push(pl(ve[_e][Qe],ve[_e][Qe+1],j,W,ie,he));de.geometry.push(Me)}}return ge.transformed=!0,ge}function pl(ge,j,W,ie,he,de){return[Math.round(W*(ge*ie-he)),Math.round(W*(j*ie-de))]}function Ah(ge,j,W,ie,he){let de=j===he.maxZoom?0:he.tolerance/((1<<j)*he.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:ge.length,source:null,x:W,y:ie,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ce of ge)ml(ve,Ce,de,he);return ve}function ml(ge,j,W,ie){let he=j.geometry,de=j.type,ve=[];if(ge.minX=Math.min(ge.minX,j.minX),ge.minY=Math.min(ge.minY,j.minY),ge.maxX=Math.max(ge.maxX,j.maxX),ge.maxY=Math.max(ge.maxY,j.maxY),de==="Point"||de==="MultiPoint")for(let Ce=0;Ce<he.length;Ce+=3)ve.push(he[Ce],he[Ce+1]),ge.numPoints++,ge.numSimplified++;else if(de==="LineString")Zi(ve,he,ge,W,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Ce=0;Ce<he.length;Ce++)Zi(ve,he[Ce],ge,W,de==="Polygon",Ce===0);else if(de==="MultiPolygon")for(let Ce=0;Ce<he.length;Ce++){let _e=he[Ce];for(let Me=0;Me<_e.length;Me++)Zi(ve,_e[Me],ge,W,!0,Me===0)}if(ve.length){let Ce=j.tags||null;if(de==="LineString"&&ie.lineMetrics){Ce={};for(let Me in j.tags)Ce[Me]=j.tags[Me];Ce.mapbox_clip_start=he.start/he.size,Ce.mapbox_clip_end=he.end/he.size}let _e={geometry:ve,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Ce};j.id!==null&&(_e.id=j.id),ge.features.push(_e)}}function Zi(ge,j,W,ie,he,de){let ve=ie*ie;if(ie>0&&j.size<(he?ve:ie))return void(W.numPoints+=j.length/3);let Ce=[];for(let _e=0;_e<j.length;_e+=3)(ie===0||j[_e+2]>ve)&&(W.numSimplified++,Ce.push(j[_e],j[_e+1])),W.numPoints++;he&&function(_e,Me){let Qe=0;for(let Ze=0,pt=_e.length,It=pt-2;Ze<pt;It=Ze,Ze+=2)Qe+=(_e[Ze]-_e[It])*(_e[Ze+1]+_e[It+1]);if(Qe>0===Me)for(let Ze=0,pt=_e.length;Ze<pt/2;Ze+=2){let It=_e[Ze],Wt=_e[Ze+1];_e[Ze]=_e[pt-2-Ze],_e[Ze+1]=_e[pt-1-Ze],_e[pt-2-Ze]=It,_e[pt-1-Ze]=Wt}}(Ce,de),ge.push(Ce)}let Ps={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Yi{constructor(j,W){let ie=(W=this.options=function(de,ve){for(let Ce in ve)de[Ce]=ve[Ce];return de}(Object.create(Ps),W)).debug;if(ie&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let he=function(de,ve){let Ce=[];if(de.type==="FeatureCollection")for(let _e=0;_e<de.features.length;_e++)cl(Ce,de.features[_e],ve,_e);else cl(Ce,de.type==="Feature"?de:{geometry:de},ve);return Ce}(j,W);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=function(de,ve){let Ce=ve.buffer/ve.extent,_e=de,Me=Rt(de,1,-1-Ce,Ce,0,-1,2,ve),Qe=Rt(de,1,1-Ce,2+Ce,0,-1,2,ve);return(Me||Qe)&&(_e=Rt(de,1,-Ce,1+Ce,0,-1,2,ve)||[],Me&&(_e=Ms(Me,1).concat(_e)),Qe&&(_e=_e.concat(Ms(Qe,-1)))),_e}(he,W),he.length&&this.splitTile(he,0,0,0),ie&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,W,ie,he,de,ve,Ce){let _e=[j,W,ie,he],Me=this.options,Qe=Me.debug;for(;_e.length;){he=_e.pop(),ie=_e.pop(),W=_e.pop(),j=_e.pop();let Ze=1<<W,pt=jr(W,ie,he),It=this.tiles[pt];if(!It&&(Qe>1&&console.time("creation"),It=this.tiles[pt]=Ah(j,W,ie,he,Me),this.tileCoords.push({z:W,x:ie,y:he}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,ie,he,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));let Dr=`z${W}`;this.stats[Dr]=(this.stats[Dr]||0)+1,this.total++}if(It.source=j,de==null){if(W===Me.indexMaxZoom||It.numPoints<=Me.indexMaxPoints)continue}else{if(W===Me.maxZoom||W===de)continue;if(de!=null){let Dr=de-W;if(ie!==ve>>Dr||he!==Ce>>Dr)continue}}if(It.source=null,j.length===0)continue;Qe>1&&console.time("clipping");let Wt=.5*Me.buffer/Me.extent,Kt=.5-Wt,kt=.5+Wt,nn=1+Wt,ht=null,Kn=null,Ln=null,un=null,_r=Rt(j,Ze,ie-Wt,ie+kt,0,It.minX,It.maxX,Me),Qn=Rt(j,Ze,ie+Kt,ie+nn,0,It.minX,It.maxX,Me);j=null,_r&&(ht=Rt(_r,Ze,he-Wt,he+kt,1,It.minY,It.maxY,Me),Kn=Rt(_r,Ze,he+Kt,he+nn,1,It.minY,It.maxY,Me),_r=null),Qn&&(Ln=Rt(Qn,Ze,he-Wt,he+kt,1,It.minY,It.maxY,Me),un=Rt(Qn,Ze,he+Kt,he+nn,1,It.minY,It.maxY,Me),Qn=null),Qe>1&&console.timeEnd("clipping"),_e.push(ht||[],W+1,2*ie,2*he),_e.push(Kn||[],W+1,2*ie,2*he+1),_e.push(Ln||[],W+1,2*ie+1,2*he),_e.push(un||[],W+1,2*ie+1,2*he+1)}}getTile(j,W,ie){j=+j,W=+W,ie=+ie;let he=this.options,{extent:de,debug:ve}=he;if(j<0||j>24)return null;let Ce=1<<j,_e=jr(j,W=W+Ce&Ce-1,ie);if(this.tiles[_e])return fl(this.tiles[_e],de);ve>1&&console.log("drilling down to z%d-%d-%d",j,W,ie);let Me,Qe=j,Ze=W,pt=ie;for(;!Me&&Qe>0;)Qe--,Ze>>=1,pt>>=1,Me=this.tiles[jr(Qe,Ze,pt)];return Me&&Me.source?(ve>1&&(console.log("found parent tile z%d-%d-%d",Qe,Ze,pt),console.time("drilling down")),this.splitTile(Me.source,Qe,Ze,pt,j,W,ie),ve>1&&console.timeEnd("drilling down"),this.tiles[_e]?fl(this.tiles[_e],de):null):null}}function jr(ge,j,W){return 32*((1<<ge)*W+j)+ge}function Ph(ge,j){let W=ge.tileID.canonical;if(!this._geoJSONIndex)return j(null,null);let ie=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ie)return j(null,null);let he=new St(ie.features),de=Yo(he);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),j(null,{vectorTile:he,rawData:de.buffer})}class ya extends qe{constructor(j,W,ie,he,de,ve){super(j,W,ie,he,Ph,ve),de&&(this.loadGeoJSON=de),this._dynamicIndex=new dr}loadData(j,W){let ie=j&&j.request,he=ie&&ie.collectResourceTiming;this.loadGeoJSON(j,(de,ve)=>{if(de||!ve)return W(de);if(typeof ve!="object")return W(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{try{if(j.filter){let _e=r.y(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));ve.features=ve.features.filter(Me=>_e.value.evaluate({zoom:0},Me))}j.dynamic?(ve.type==="Feature"&&(ve={type:"FeatureCollection",features:[ve]}),j.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ve.features,this.loaded),j.cluster&&(ve.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=j.cluster?new Mt(function({superclusterOptions:_e,clusterProperties:Me}){if(!Me||!_e)return _e;let Qe={},Ze={},pt={accumulated:null,zoom:0},It={properties:null},Wt=Object.keys(Me);for(let Kt of Wt){let[kt,nn]=Me[Kt],ht=r.y(nn),Kn=r.y(typeof kt=="string"?[kt,["accumulated"],["get",Kt]]:kt);Qe[Kt]=ht.value,Ze[Kt]=Kn.value}return _e.map=Kt=>{It.properties=Kt;let kt={};for(let nn of Wt)kt[nn]=Qe[nn].evaluate(pt,It);return kt},_e.reduce=(Kt,kt)=>{It.properties=kt;for(let nn of Wt)pt.accumulated=Kt[nn],Kt[nn]=Ze[nn].evaluate(pt,It)},_e}(j)).load(ve.features):j.dynamic?this._dynamicIndex:function(_e,Me){return new Yi(_e,Me)}(ve,j.geojsonVtOptions)}catch(_e){return W(_e)}let Ce={};if(he){let _e=E(ie);_e&&(Ce.resourceTiming={},Ce.resourceTiming[j.source]=JSON.parse(JSON.stringify(_e)))}W(null,Ce)}})}reloadTile(j,W){let ie=this.loaded;return ie&&ie[j.uid]?j.partial?W(null,void 0):super.reloadTile(j,W):this.loadTile(j,W)}loadGeoJSON(j,W){if(j.request)r.g(j.request,W);else{if(typeof j.data!="string")return W(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(j.data))}catch{return W(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(j,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(ie){W(ie)}}getClusterChildren(j,W){try{W(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(ie){W(ie)}}getClusterLeaves(j,W){try{W(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(ie){W(ie)}}}class gl{constructor(j,W){this.tileID=new r.aL(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.tileZoom=j.tileZoom,this.uid=j.uid,this.zoom=j.zoom,this.canonical=j.tileID.canonical,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=j.projection,this.brightness=W}parse(j,W,ie,he){this.status="parsing";let de=new r.aL(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),ve={},Ce=W.familiesBySource[ie.source],_e=new r.dN(de,ie.promoteId);return _e.bucketLayerIDs=[],_e.is3DTile=!0,r.e3(j).then(Me=>{if(!Me)return he(new Error("Could not parse tile"));let Qe=r.e4(Me,1/r.b5(ie.tileID.canonical)),Ze=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("MAPBOX_mesh_features")||Me.json.asset.extras&&Me.json.asset.extras.MAPBOX_mesh_features,pt=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("EXT_meshopt_compression"),It=new r.X(this.zoom,{brightness:this.brightness});for(let Wt in Ce)for(let Kt of Ce[Wt]){let kt=Kt[0];_e.bucketLayerIDs.push(Kt.map(ht=>ht.id)),kt.recalculate(It,[]);let nn=new r.e5(Qe,de,Ze,pt,this.brightness,_e);Ze||(nn.needsUpload=!0),ve[kt.fqid]=nn,nn.evaluate(kt)}this.status="done",he(null,{buckets:ve,featureIndex:_e})}).catch(Me=>he(new Error(Me.message)))}}class Hc{constructor(j,W,ie,he,de,ve){this.actor=j,this.layerIndex=W,this.brightness=ve,this.loading={},this.loaded={}}loadTile(j,W){let ie=j.uid,he=this.loading[ie]=new gl(j,this.brightness);r.e2(j.request,(de,ve)=>{let Ce=!this.loading[ie];return delete this.loading[ie],Ce||de?(he.status="done",Ce||(this.loaded[ie]=he),W(de)):ve&&ve.byteLength!==0?void he.parse(ve,this.layerIndex,j,(_e,Me)=>{he.status="done",this.loaded=this.loaded||{},this.loaded[ie]=he,_e||!Me?W(_e):W(null,Me)}):(he.status="done",this.loaded[ie]=he,W())})}reloadTile(j,W){let ie=this.loaded,he=j.uid;if(ie&&ie[he]){let de=ie[he];de.projection=j.projection,de.brightness=j.brightness;let ve=(Ce,_e)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(j,W)),W(Ce,_e)};de.status==="parsing"?de.reloadCallback=ve:de.status==="done"&&this.loadTile(j,W)}}abortTile(j,W){let ie=j.uid;this.loading[ie]&&delete this.loading[ie],W()}removeTile(j,W){let ie=this.loaded,he=j.uid;ie&&ie[he]&&delete ie[he],W()}}class _l{constructor(j){this.self=j,this.actor=new r.e6(j,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.aJ({name:"mercator"}),this.workerSourceTypes={vector:qe,geojson:ya,"batched-model":Hc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,ie)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=ie},this.self.registerRTLTextPlugin=W=>{if(r.e7.isParsed())throw new Error("RTL text plugin already registered.");r.e7.applyArabicShaping=W.applyArabicShaping,r.e7.processBidirectionalText=W.processBidirectionalText,r.e7.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(j,W,ie){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],delete this.rasterArrayWorkerSource,ie()}checkIfReady(j,W,ie){ie()}setReferrer(j,W){this.referrer=W}spriteLoaded(j,{scope:W,isLoaded:ie}){if(this.isSpriteLoaded[j]||(this.isSpriteLoaded[j]={}),this.isSpriteLoaded[j][W]=ie,this.workerSources[j]&&this.workerSources[j][W])for(let he in this.workerSources[j][W]){let de=this.workerSources[j][W][he];for(let ve in de){let Ce=de[ve];Ce instanceof qe&&(Ce.isSpriteLoaded=ie,Ce.fire(new r.f("isSpriteLoaded")))}}}setImages(j,{scope:W,images:ie},he){if(this.availableImages[j]||(this.availableImages[j]={}),this.availableImages[j][W]=ie,this.workerSources[j]&&this.workerSources[j][W]){for(let de in this.workerSources[j][W]){let ve=this.workerSources[j][W][de];for(let Ce in ve)ve[Ce].availableImages=ie}he()}else he()}setProjection(j,W){this.projections[j]=r.aJ(W)}setBrightness(j,W,ie){this.brightness=W,ie()}setLayers(j,W,ie){this.getLayerIndex(j,W.scope).replace(W.layers,W.options),ie()}updateLayers(j,W,ie){this.getLayerIndex(j,W.scope).update(W.layers,W.removedIds,W.options),ie()}loadTile(j,W,ie){W.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,W.type,W.source,W.scope).loadTile(W,ie)}loadDEMTile(j,W,ie){this.getDEMWorkerSource(j,W.source,W.scope).loadTile(W,ie)}decodeRasterArray(j,W,ie){this.getRasterArrayWorkerSource().decodeRasterArray(W,ie)}reloadTile(j,W,ie){W.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,W.type,W.source,W.scope).reloadTile(W,ie)}abortTile(j,W,ie){this.getWorkerSource(j,W.type,W.source,W.scope).abortTile(W,ie)}removeTile(j,W,ie){this.getWorkerSource(j,W.type,W.source,W.scope).removeTile(W,ie)}removeSource(j,W,ie){if(!(this.workerSources[j]&&this.workerSources[j][W.scope]&&this.workerSources[j][W.scope][W.type]&&this.workerSources[j][W.scope][W.type][W.source]))return;let he=this.workerSources[j][W.scope][W.type][W.source];delete this.workerSources[j][W.scope][W.type][W.source],he.removeSource!==void 0?he.removeSource(W,ie):ie()}loadWorkerSource(j,W,ie){try{this.self.importScripts(W.url),ie()}catch(he){ie(he.toString())}}syncRTLPluginState(j,W,ie){try{r.e7.setState(W);let he=r.e7.getPluginURL();if(r.e7.isLoaded()&&!r.e7.isParsed()&&he!=null){this.self.importScripts(he);let de=r.e7.isParsed();ie(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),de)}}catch(he){ie(he.toString())}}setDracoUrl(j,W){this.dracoUrl=W}getAvailableImages(j,W){this.availableImages[j]||(this.availableImages[j]={});let ie=this.availableImages[j][W];return ie||(ie=[]),ie}getLayerIndex(j,W){this.layerIndexes[j]||(this.layerIndexes[j]={});let ie=this.layerIndexes[j][W];return ie||(ie=this.layerIndexes[j][W]=new z,ie.scope=W),ie}getWorkerSource(j,W,ie,he){return this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][he]||(this.workerSources[j][he]={}),this.workerSources[j][he][W]||(this.workerSources[j][he][W]={}),this.isSpriteLoaded[j]||(this.isSpriteLoaded[j]={}),this.workerSources[j][he][W][ie]||(this.workerSources[j][he][W][ie]=new this.workerSourceTypes[W]({send:(de,ve,Ce,_e,Me,Qe)=>{this.actor.send(de,ve,Ce,j,Me,Qe)},scheduler:this.actor.scheduler},this.getLayerIndex(j,he),this.getAvailableImages(j,he),this.isSpriteLoaded[j][he],void 0,this.brightness)),this.workerSources[j][he][W][ie]}getDEMWorkerSource(j,W,ie){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][ie]||(this.demWorkerSources[j][ie]={}),this.demWorkerSources[j][ie][W]||(this.demWorkerSources[j][ie][W]=new ot),this.demWorkerSources[j][ie][W]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new dt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(j,W){r.e8(W)}getWorkerPerformanceMetrics(j,W,ie){ie(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new _l(self)),_l}),h(["./shared"],function(r){function E(p,s){if(Array.isArray(p)){if(!Array.isArray(s)||p.length!==s.length)return!1;for(let u=0;u<p.length;u++)if(!E(p[u],s[u]))return!1;return!0}if(typeof p=="object"&&p!==null&&s!==null){if(typeof s!="object"||Object.keys(p).length!==Object.keys(s).length)return!1;for(let u in p)if(!E(p[u],s[u]))return!1;return!0}return p===s}var C=O;function O(p){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(x);try{v=new Worker(w),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(w),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(z[u=s&&s.failIfMajorPerformanceCaveat]===void 0&&(z[u]=function(g){var v,x=function(w){var I=document.createElement("canvas"),M=Object.create(O.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=w,I.getContext("webgl2",M)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(u)),z[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var u}(p)}var z={};function Z(p,s,u){let g=document.createElement(p);return s!=null&&(g.className=s),u&&u.appendChild(g),g}function ce(p,s,u){let g=document.createElementNS("http://www.w3.org/2000/svg",p);for(let v of Object.keys(s))g.setAttributeNS(null,v,String(s[v]));return u&&u.appendChild(g),g}O.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Ie=typeof document<"u"?document.documentElement&&document.documentElement.style:null,be=Ie&&Ie.userSelect!==void 0?"userSelect":"WebkitUserSelect",qe;function ot(){Ie&&be&&(qe=Ie[be],Ie[be]="none")}function dt(){Ie&&be&&(Ie[be]=qe)}function ct(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",ct,!0)}function bt(){window.addEventListener("click",ct,!0),window.setTimeout(()=>{window.removeEventListener("click",ct,!0)},0)}function St(p,s){let u=p.getBoundingClientRect();return Xn(p,u,s)}function $t(p,s){let u=p.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(Xn(p,u,s[v]));return g}function dr(p){return window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Xn(p,s,u){let g=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new r.P((u.clientX-s.left)*g,(u.clientY-s.top)*g)}class ir{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,u){this._updatedSourceCaches[s]=u,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){let u=s.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(s.id),this.setDirty()}removeLayer(s){let u=s.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][s.id]=s,this._updatedLayers[u].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){let s={};for(let u in this._updatedLayers)s[u]=s[u]||{},s[u].updatedIds=Array.from(this._updatedLayers[u].values());for(let u in this._removedLayers)s[u]=s[u]||{},s[u].removedIds=Object.keys(this._removedLayers[u]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Yt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class di{constructor(s,u,g,v,x,w){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.instanceCount=w,this.context=s;let I=s.gl;this.buffer=I.createBuffer(),s.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let g=0;g<this.attributes.length;g++){let v=u.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,u,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],w=u.attributes[x.name];w!==void 0&&s.vertexAttribPointer(w,x.components,s[Yt[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,u,g){for(let v=0;v<this.attributes.length;v++){let x=u.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fa extends Xt{getDefault(){return r.C.transparent}set(s){let u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ni extends Xt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Is extends Xt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class On extends Xt{getDefault(){return[!0,!0,!0,!0]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ds extends Xt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class vt extends Xt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Nt extends Xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){let u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Gt extends Xt{getDefault(){let s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class En extends Xt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class zt extends Xt{getDefault(){return[0,1]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Kr extends Xt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class Zn extends Xt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class zi extends Xt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class or extends Xt{getDefault(){let s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class pa extends Xt{getDefault(){return r.C.transparent}set(s){let u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ct extends Xt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class wr extends Xt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class kn extends Xt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Qr extends Xt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let Yo=class extends Xt{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Ss extends Xt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Uc extends Xt{getDefault(){let s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ol extends Xt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class lo extends Xt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class co extends Xt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Vc extends Xt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Mt extends Xt{getDefault(){return null}set(s){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Pt extends Xt{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class sl extends Xt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Mi extends Xt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ma extends Xt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class al extends Xt{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class ll extends al{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class jc extends al{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Cs extends al{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class ga extends jc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class cl{constructor(s,u,g,v,x){this.context=s,this.width=u,this.height=g;let w=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new ll(s,w)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new jc(s,w):new Cs(s,w))}destroy(){let s=this.context.gl;if(this.colorAttachment){let u=this.colorAttachment.get();u&&s.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let u=this.depthAttachment.get();u&&s.deleteRenderbuffer(u)}else{let u=this.depthAttachment.get();u&&s.deleteTexture(u)}s.deleteFramebuffer(this.framebuffer)}}class $c{constructor(s,u){this.gl=s,this.clearColor=new fa(this),this.clearDepth=new Ni(this),this.clearStencil=new Is(this),this.colorMask=new On(this),this.depthMask=new Ds(this),this.stencilMask=new vt(this),this.stencilFunc=new Nt(this),this.stencilOp=new Gt(this),this.stencilTest=new En(this),this.depthRange=new zt(this),this.depthTest=new Kr(this),this.depthFunc=new Zn(this),this.blend=new zi(this),this.blendFunc=new or(this),this.blendColor=new pa(this),this.blendEquation=new Ct(this),this.cullFace=new wr(this),this.cullFaceSide=new kn(this),this.frontFace=new Qr(this),this.program=new Yo(this),this.activeTexture=new Ss(this),this.viewport=new Uc(this),this.bindFramebuffer=new ol(this),this.bindRenderbuffer=new lo(this),this.bindTexture=new co(this),this.bindVertexBuffer=new Vc(this),this.bindElementBuffer=new Mt(this),this.bindVertexArrayOES=new Pt(this),this.pixelStoreUnpack=new sl(this),this.pixelStoreUnpackPremultiplyAlpha=new Mi(this),this.pixelStoreUnpackFlipY=new ma(this),this.options=u?xt({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u,g){return new r.I(this,s,u,g)}createVertexBuffer(s,u,g,v,x){return new di(this,s,u,g,v,x)}createRenderbuffer(s,u,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,s,u,g),this.bindRenderbuffer.set(null),x}createFramebuffer(s,u,g,v){return new cl(this,s,u,g,v)}clear({color:s,depth:u,stencil:g,colorMask:v}){let x=this.gl,w=0;s&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),u!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),g!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(w)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){E(s.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ul{constructor(s){this._gl=s.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let s=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,s}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class hl{constructor(s){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,s.registerParameter(this,["Symbols"],"useOcclusionQueries"),s.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),s.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),s.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),s.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class Wi{constructor(s,u,g,v){let x={width:g[0],height:g[1],data:null},w=s.gl;this.targetColorTexture=new r.T(s,x,w.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(s,x,w.RGBA,{useMipmap:!1}),this.context=s,this.updateParticleTexture(u,v),this.lastInvalidatedAt=0}updateParticleTexture(s,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=u.width*u.height;this.particleTexture0=new r.T(this.context,u,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,u,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new r.S;x.reserve(v);for(let w=0;w<v;w++)x.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(x,r.p.members,!0),this.particleSegment=r.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=r.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Mh extends r.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,u){return r.l(this.requestManager.transformRequest(u,r.R.Model).url).then(g=>{if(!g)return;let v=r.c(g),x=new r.M(s,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new r.d(new Error(`Could not load model ${s} from ${u}: ${g.message}`)))})}load(s,u){this.models[u]||(this.models[u]={});let g=Object.keys(s);this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,s[x]));Promise.allSettled(v).then(x=>{for(let w=0;w<x.length;w++){let{status:I,value:M}=x[w];I==="fulfilled"&&M&&(this.models[u][g[w]]={model:M,numReferences:1})}this.numModelsLoading[u]-=g.length,this.fire(new r.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new r.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,u){return!!this.getModel(s,u)}getModel(s,u){return this.models[u]||(this.models[u]={}),this.models[u][s]?this.models[u][s].model:void 0}addModel(s,u,g){this.models[g]||(this.models[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.load({[s]:this.requestManager.normalizeModelURL(u)},g)}addModels(s,u){this.models[u]||(this.models[u]={});let g={};for(let v in s)this.models[u][v]={},g[v]=this.requestManager.normalizeModelURL(s[v]);this.load(g,u)}addModelsFromBucket(s,u){this.models[u]||(this.models[u]={});let g={};for(let v of s)this.hasModel(v,u)?this.models[u][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,u)}removeModel(s,u){if(this.models[u]&&this.models[u][s]&&(this.models[u][s].numReferences--,this.models[u][s].numReferences===0)){let g=this.models[u][s].model;delete this.models[u][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,u){this.models[u]||(this.models[u]={});for(let g in this.models[u])this.models[u][g].model&&this.models[u][g].model.upload(s.context)}}function Rt(p){let{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class Gc extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new r.i({width:1,height:1})}isLoaded(){for(let s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,u){if(this.loaded[u]!==s&&(this.loaded[u]=s,s)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,u,v);this.requestors=[]}}hasImage(s,u){return!!this.getImage(s,u)}getImage(s,u){return this.images[u][s]}addImage(s,u,g){this._validate(s,g)&&(this.images[u][s]=g)}_validate(s,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new r.d(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,u){if(!s)return!0;let g=0;for(let v of s){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(s,u){return!(s&&(s.length!==4||s[0]<0||u.data.width<s[0]||s[1]<0||u.data.height<s[1]||s[2]<0||u.data.width<s[2]||s[3]<0||u.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,u,g){g.version=this.images[u][s].version+1,this.images[u][s]=g,this.updatedImages[u][s]=!0}removeImage(s,u){let g=this.images[u][s];delete this.images[u][s],delete this.patterns[u][s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,u,g){let v=!0,x=!!this.loaded[u];if(!x)for(let w of s)this.images[u][w]||(v=!1);x||v?this._notify(s,u,g):this.requestors.push({ids:s,scope:u,callback:g})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,u,g){let v={};for(let x of s){this.images[u][x]||this.fire(new r.f("styleimagemissing",{id:x}));let w=this.images[u][x];w?v[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:r.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(s){let{width:u,height:g}=this.atlasImage[s];return{width:u,height:g}}getPattern(s,u,g){let v=this.patterns[u][s],x=this.getImage(s,u);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let w={w:x.data.width+2,h:x.data.height+2,x:0,y:0},I=new r.k(w,x);this.patterns[u][s]={bin:w,position:I}}return this._updatePatternAtlas(u,g),this.patterns[u][s].position}bind(s,u){let g=s.gl,v=this.atlasTexture[u];v?this.dirty&&(v.update(this.atlasImage[u]),this.dirty=!1):(v=new r.T(s,this.atlasImage[u],g.RGBA),this.atlasTexture[u]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,u){let g=[];for(let I in this.patterns[s])g.push(this.patterns[s][I].bin);let{w:v,h:x}=r.j(g),w=this.atlasImage[s];w.resize({width:v||1,height:x||1});for(let I in this.patterns[s]){let{bin:M}=this.patterns[s][I],A=M.x+1,L=M.y+1,F=this.images[s][I].data,B=F.width,U=F.height;r.i.copy(F,w,{x:0,y:0},{x:A,y:L},{width:B,height:U},u),r.i.copy(F,w,{x:0,y:U-1},{x:A,y:L-1},{width:B,height:1},u),r.i.copy(F,w,{x:0,y:0},{x:A,y:L+U},{width:B,height:1},u),r.i.copy(F,w,{x:B-1,y:0},{x:A-1,y:L},{width:1,height:U},u),r.i.copy(F,w,{x:0,y:0},{x:A+B,y:L},{width:1,height:U},u)}this.dirty=!0}beginFrame(){for(let s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,u){for(let g of s){if(this.callbackDispatchedThisFrame[u][g])continue;this.callbackDispatchedThisFrame[u][g]=!0;let v=this.images[u][g];Rt(v)&&this.updateImage(g,u,v)}}}function fr(p){let s=p.key,u=p.value,g=p.valueSpec||{},v=p.objectElementValidators||{},x=p.style,w=p.styleSpec,I=[],M=r.n(u);if(M!=="object")return[new r.V(s,u,`object expected, ${M} found`)];for(let A in u){let L=A.split(".")[0],F;v[L]?F=v[L]:g[L]?F=j:v["*"]?F=v["*"]:g["*"]&&(F=j),F?I=I.concat(F({key:(s&&`${s}.`)+A,value:u[A],valueSpec:g[L]||g["*"],style:x,styleSpec:w,object:u,objectKey:A},u)):I.push(new r.m(s,u[A],`unknown property "${A}"`))}for(let A in g)v[A]||g[A].required&&g[A].default===void 0&&u[A]===void 0&&I.push(new r.V(s,u,`missing required property "${A}"`));return I}function dl(p){let s=p.value,u=p.valueSpec,g=p.style,v=p.styleSpec,x=p.key,w=p.arrayElementValidator||j;if(r.n(s)!=="array")return[new r.V(x,s,`array expected, ${r.n(s)} found`)];if(u.length&&s.length!==u.length)return[new r.V(x,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new r.V(x,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let I={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};v.$version<7&&(I.function=u.function),r.n(u.value)==="object"&&(I=u.value);let M=[];for(let A=0;A<s.length;A++)M=M.concat(w({array:s,arrayIndex:A,value:s[A],valueSpec:I,style:g,styleSpec:v,key:`${x}[${A}]`},!0));return M}function _a(p){let s=p.key,u=p.value,g=p.valueSpec,v=r.n(u);if(v==="number"&&u!=u&&(v="NaN"),v!=="number")return[new r.V(s,u,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(r.n(g.minimum)==="array"&&(x=g.minimum[p.arrayIndex]),u<x)return[new r.V(s,u,`${u} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(r.n(g.maximum)==="array"&&(x=g.maximum[p.arrayIndex]),u>x)return[new r.V(s,u,`${u} is greater than the maximum value ${x}`)]}return[]}function Mo(p){let s=p.valueSpec,u=r.u(p.value.type),g,v,x,w={},I=u!=="categorical"&&p.value.property===void 0,M=!I,A=r.n(p.value.stops)==="array"&&r.n(p.value.stops[0])==="array"&&r.n(p.value.stops[0][0])==="object",L=fr({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(U){if(u==="identity")return[new r.V(U.key,U.value,'identity function may not have a "stops" property')];let $=[],G=U.value;return $=$.concat(dl({key:U.key,value:G,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:F})),r.n(G)==="array"&&G.length===0&&$.push(new r.V(U.key,G,"array must have at least one stop")),$},default:function(U){return j({key:U.key,value:U.value,valueSpec:s,style:U.style,styleSpec:U.styleSpec})}}});return u==="identity"&&I&&L.push(new r.V(p.key,p.value,'missing required property "property"')),u==="identity"||p.value.stops||L.push(new r.V(p.key,p.value,'missing required property "stops"')),u==="exponential"&&p.valueSpec.expression&&!r.s(p.valueSpec)&&L.push(new r.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(M&&!r.q(p.valueSpec)?L.push(new r.V(p.key,p.value,"property functions not supported")):I&&!r.r(p.valueSpec)&&L.push(new r.V(p.key,p.value,"zoom functions not supported"))),u!=="categorical"&&!A||p.value.property!==void 0||L.push(new r.V(p.key,p.value,'"property" property is required')),L;function F(U){let $=[],G=U.value,q=U.key;if(r.n(G)!=="array")return[new r.V(q,G,`array expected, ${r.n(G)} found`)];if(G.length!==2)return[new r.V(q,G,`array length 2 expected, length ${G.length} found`)];if(A){if(r.n(G[0])!=="object")return[new r.V(q,G,`object expected, ${r.n(G[0])} found`)];if(G[0].zoom===void 0)return[new r.V(q,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new r.V(q,G,"object stop key must have value")];let H=r.u(G[0].zoom);if(typeof H!="number")return[new r.V(q,G[0].zoom,"stop zoom values must be numbers")];if(x&&x>H)return[new r.V(q,G[0].zoom,"stop zoom values must appear in ascending order")];H!==x&&(x=H,v=void 0,w={}),$=$.concat(fr({key:`${q}[0]`,value:G[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:_a,value:B}}))}else $=$.concat(B({key:`${q}[0]`,value:G[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},G));return r.t(r.v(G[1]))?$.concat([new r.V(`${q}[1]`,G[1],"expressions are not allowed in function stops.")]):$.concat(j({key:`${q}[1]`,value:G[1],valueSpec:s,style:U.style,styleSpec:U.styleSpec}))}function B(U,$){let G=r.n(U.value),q=r.u(U.value),H=U.value!==null?U.value:$;if(g){if(G!==g)return[new r.V(U.key,H,`${G} stop domain type must match previous stop domain type ${g}`)]}else g=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new r.V(U.key,H,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&u!=="categorical"){let J=`number expected, ${G} found`;return r.q(s)&&u===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(U.key,H,J)]}return u!=="categorical"||G!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?u!=="categorical"&&G==="number"&&typeof q=="number"&&typeof v=="number"&&v!==void 0&&q<v?[new r.V(U.key,H,"stop domain values must appear in ascending order")]:(v=q,u==="categorical"&&q in w?[new r.V(U.key,H,"stop domain values must be unique")]:(w[q]=!0,[])):[new r.V(U.key,H,`integer expected, found ${String(q)}`)]}}function Ao(p){let s=(p.expressionContext==="property"?r.x:r.y)(r.v(p.value),p.valueSpec);if(s.result==="error")return s.value.map(g=>new r.V(`${p.key}${g.key}`,p.value,g.message));let u=s.value.expression||s.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!u.outputDefined())return[new r.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!r.z(u))return[new r.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return qc(u,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!r.A(u,["zoom","feature-state"]))return[new r.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!r.B(u))return[new r.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qc(p,s){let u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(let v of s.valueSpec.expression.parameters)u.delete(v);if(u.size===0)return[];let g=[];return p instanceof r.D&&u.has(p.name)?[new r.V(s.key,s.value,`["${p.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(p.eachChild(v=>{g.push(...qc(v,s))}),g)}function Ms(p){let s=p.key,u=p.value,g=p.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(r.u(u))===-1&&v.push(new r.V(s,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(r.u(u))===-1&&v.push(new r.V(s,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function As(p){return r.G(r.v(p.value))?Ao(r.o({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):fl(p)}function fl(p){let s=p.value,u=p.key;if(r.n(s)!=="array")return[new r.V(u,s,`array expected, ${r.n(s)} found`)];let g=p.styleSpec,v,x=[];if(s.length<1)return[new r.V(u,s,"filter array must have at least 1 element")];switch(x=x.concat(Ms({key:`${u}[0]`,value:s[0],valueSpec:g.filter_operator,style:p.style,styleSpec:p.styleSpec})),r.u(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&r.u(s[1])==="$type"&&x.push(new r.V(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new r.V(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=r.n(s[1]),v!=="string"&&x.push(new r.V(`${u}[1]`,s[1],`string expected, ${v} found`)));for(let w=2;w<s.length;w++)v=r.n(s[w]),r.u(s[1])==="$type"?x=x.concat(Ms({key:`${u}[${w}]`,value:s[w],valueSpec:g.geometry_type,style:p.style,styleSpec:p.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new r.V(`${u}[${w}]`,s[w],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)x=x.concat(fl({key:`${u}[${w}]`,value:s[w],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":v=r.n(s[1]),s.length!==2?x.push(new r.V(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new r.V(`${u}[1]`,s[1],`string expected, ${v} found`))}return x}function pl(p,s){let u=p.key,g=p.style,v=p.layer,x=p.styleSpec,w=p.value,I=p.objectKey,M=x[`${s}_${p.layerType}`];if(!M)return[];let A=I.match(/^(.*)-transition$/);if(s==="paint"&&A&&M[A[1]]&&M[A[1]].transition)return j({key:u,value:w,valueSpec:x.transition,style:g,styleSpec:x});let L=p.valueSpec||M[I];if(!L)return[new r.m(u,w,`unknown property "${I}"`)];let F;if(r.n(w)==="string"&&r.q(L)&&!L.tokens&&(F=/^{([^}]+)}$/.exec(w))){let U=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new r.V(u,w,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${U}.`)]}let B=[];if(p.layerType==="symbol")I!=="text-field"||!g||g.glyphs||g.imports||B.push(new r.V(u,w,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&r.H(r.v(w))&&r.u(w.type)==="identity"&&B.push(new r.V(u,w,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&s==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&r.q(L)&&(r.J(L)||r.r(L))){let U=r.x(r.v(w),L),$=U.value.expression||U.value._styleExpression.expression;$&&!r.A($,["measure-light"])&&(I==="model-emissive-strength"&&r.B($)&&r.z($)||B.push(new r.V(u,w,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(j({key:p.key,value:w,valueSpec:L,style:g,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:I}))}function Ah(p){return pl(p,"paint")}function ml(p){return pl(p,"layout")}function Zi(p){let s=[],u=p.value,g=p.key,v=p.style,x=p.styleSpec;u.type||u.ref||s.push(new r.V(g,u,'either "type" or "ref" is required'));let w=r.u(u.type),I=r.u(u.ref);if(u.id){let M=r.u(u.id);for(let A=0;A<p.arrayIndex;A++){let L=v.layers[A];r.u(L.id)===M&&s.push(new r.V(g,u.id,`duplicate layer id "${u.id}", previously used at line ${L.id.__line__}`))}}if("ref"in u){let M;["type","source","source-layer","filter","layout"].forEach(A=>{A in u&&s.push(new r.V(g,u[A],`"${A}" is prohibited for ref layers`))}),v.layers.forEach(A=>{r.u(A.id)===I&&(M=A)}),M?M.ref?s.push(new r.V(g,u.ref,"ref cannot reference another ref layer")):w=r.u(M.type):typeof I=="string"&&s.push(new r.V(g,u.ref,`ref layer "${I}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(u.source){let M=v.sources&&v.sources[u.source],A=M&&r.u(M.type);M?A==="vector"&&w==="raster"?s.push(new r.V(g,u.source,`layer "${u.id}" requires a raster source`)):A==="raster"&&w!=="raster"?s.push(new r.V(g,u.source,`layer "${u.id}" requires a vector source`)):A!=="vector"||u["source-layer"]?A==="raster-dem"&&w!=="hillshade"?s.push(new r.V(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||A==="geojson"&&M.lineMetrics?w==="raster-particle"&&A!=="raster-array"&&s.push(new r.V(g,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):s.push(new r.V(g,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new r.V(g,u.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new r.V(g,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new r.V(g,u.source,`source "${u.source}" not found`))}else s.push(new r.V(g,u,'missing required property "source"'));return s=s.concat(fr({key:g,value:u,valueSpec:x.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>j({key:`${g}.type`,value:u.type,valueSpec:x.layer.type,style:p.style,styleSpec:p.styleSpec,object:u,objectKey:"type"}),filter:M=>As(r.o({layerType:w},M)),layout:M=>fr({layer:u,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":A=>ml(r.o({layerType:w},A))}}),paint:M=>fr({layer:u,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":A=>Ah(r.o({layerType:w,layer:u},A))}})}})),s}function Ps(p){let s=p.value,u=p.key,g=r.n(s);return g!=="string"?[new r.V(u,s,`string expected, ${g} found`)]:[]}let Yi={promoteId:function({key:p,value:s}){if(r.n(s)==="string")return Ps({key:p,value:s});{let u=[];for(let g in s)u.push(...Ps({key:`${p}.${g}`,value:s[g]}));return u}}};function jr(p){let s=p.value,u=p.key,g=p.styleSpec,v=p.style;if(!s.type)return[new r.V(u,s,'"type" is required')];let x=r.u(s.type),w=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||w.push(new r.m(u,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(fr({key:u,value:s,valueSpec:g[`source_${x.replace("-","_")}`],style:p.style,styleSpec:g,objectElementValidators:Yi})),w;case"geojson":if(w=fr({key:u,value:s,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:Yi}),s.cluster)for(let I in s.clusterProperties){let[M,A]=s.clusterProperties[I],L=typeof M=="string"?[M,["accumulated"],["get",I]]:M;w.push(...Ao({key:`${u}.${I}.map`,value:A,expressionContext:"cluster-map"})),w.push(...Ao({key:`${u}.${I}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return w;case"video":return fr({key:u,value:s,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return fr({key:u,value:s,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new r.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ms({key:`${u}.type`,value:s.type,valueSpec:{values:Ph(g)},style:v,styleSpec:g})}}function Ph(p){return p.source.reduce((s,u)=>{let g=p[u];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values))),s},[])}function ya(p){let s=p.value,u=p.styleSpec,g=u.light,v=p.style,x=[],w=r.n(s);if(s===void 0)return x;if(w!=="object")return x=x.concat([new r.V("light",s,`object expected, ${w} found`)]),x;for(let I in s){let M=I.match(/^(.*)-transition$/);x=x.concat(M&&g[M[1]]&&g[M[1]].transition?j({key:I,value:s[I],valueSpec:u.transition,style:v,styleSpec:u}):g[I]?j({key:I,value:s[I],valueSpec:g[I],style:v,styleSpec:u}):[new r.V(I,s[I],`unknown property "${I}"`)])}return x}function gl(p){let s=p.value,u=[];if(!s)return u;let g=r.n(s);if(g!=="object")return u=u.concat([new r.V("light-3d",s,`object expected, ${g} found`)]),u;let v=p.styleSpec,x=v["light-3d"],w=p.key,I=p.style,M=p.style.lights;for(let F of["type","id"])if(!(F in s))return u=u.concat([new r.V("light-3d",s,`missing property ${F} on light`)]),u;if(s.type&&M)for(let F=0;F<p.arrayIndex;F++){let B=r.u(s.type),U=M[F];r.u(U.type)===B&&u.push(new r.V(w,s.id,`duplicate light type "${s.type}", previously defined at line ${U.id.__line__}`))}let A=`properties_light_${s.type}`;if(!(A in v))return u=u.concat([new r.V("light-3d",s,`Invalid light type ${s.type}`)]),u;let L=v[A];for(let F in s)if(F==="properties"){let B=s[F],U=r.n(B);if(U!=="object")return u=u.concat([new r.V("properties",B,`object expected, ${U} found`)]),u;for(let $ in B)u=u.concat(L[$]?j({key:$,value:B[$],valueSpec:L[$],style:I,styleSpec:v}):[new r.m(p.key,B[$],`unknown property "${$}"`)])}else{let B=F.match(/^(.*)-transition$/);u=u.concat(B&&x[B[1]]&&x[B[1]].transition?j({key:F,value:s[F],valueSpec:v.transition,style:I,styleSpec:v}):x[F]?j({key:F,value:s[F],valueSpec:x[F],style:I,styleSpec:v}):[new r.m(F,s[F],`unknown property "${F}"`)])}return u}function Hc(p){let s=p.value,u=p.key,g=p.style,v=p.styleSpec,x=v.terrain,w=[],I=r.n(s);if(s===void 0||I==="null")return w;if(I!=="object")return w=w.concat([new r.V("terrain",s,`object expected, ${I} found`)]),w;for(let M in s){let A=M.match(/^(.*)-transition$/);w=w.concat(A&&x[A[1]]&&x[A[1]].transition?j({key:M,value:s[M],valueSpec:v.transition,style:g,styleSpec:v}):x[M]?j({key:M,value:s[M],valueSpec:x[M],style:g,styleSpec:v}):[new r.m(M,s[M],`unknown property "${M}"`)])}if(s.source){let M=g.sources&&g.sources[s.source],A=M&&r.u(M.type);M?A!=="raster-dem"&&w.push(new r.V(u,s.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):w.push(new r.V(u,s.source,`source "${s.source}" not found`))}else w.push(new r.V(u,s,'terrain is missing required property "source"'));return w}function _l(p){let s=p.value,u=p.style,g=p.styleSpec,v=g.fog,x=[],w=r.n(s);if(s===void 0)return x;if(w!=="object")return x=x.concat([new r.V("fog",s,`object expected, ${w} found`)]),x;for(let I in s){let M=I.match(/^(.*)-transition$/);x=x.concat(M&&v[M[1]]&&v[M[1]].transition?j({key:I,value:s[I],valueSpec:g.transition,style:u,styleSpec:g}):v[I]?j({key:I,value:s[I],valueSpec:v[I],style:u,styleSpec:g}):[new r.m(I,s[I],`unknown property "${I}"`)])}return x}let ge={"*":()=>[],array:dl,boolean:function(p){let s=p.value,u=p.key,g=r.n(s);return g!=="boolean"?[new r.V(u,s,`boolean expected, ${g} found`)]:[]},number:_a,color:function(p){let s=p.key,u=p.value,g=r.n(u);return g!=="string"?[new r.V(s,u,`color expected, ${g} found`)]:r.F(u)===null?[new r.V(s,u,`color expected, "${u}" found`)]:[]},enum:Ms,filter:As,function:Mo,layer:Zi,object:fr,source:jr,model:r.K,light:ya,"light-3d":gl,terrain:Hc,fog:_l,string:Ps,formatted:function(p){return Ps(p).length===0?[]:Ao(p)},resolvedImage:function(p){return Ps(p).length===0?[]:Ao(p)},projection:function(p){let s=p.value,u=p.styleSpec,g=u.projection,v=p.style,x=[],w=r.n(s);if(w==="object")for(let I in s)x=x.concat(j({key:I,value:s[I],valueSpec:g[I],style:v,styleSpec:u}));else w!=="string"&&(x=x.concat([new r.V("projection",s,`object or string expected, ${w} found`)]));return x},import:function(p){let{value:s,styleSpec:u}=p,w=s,{data:g}=w,v=Xs(w,["data"]);Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let x=fr(r.o({},p,{value:v,valueSpec:u.import}));return r.u(v.id)===""&&x.push(new r.V(`${p.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(ie(g,u,{key:`${p.key}.data`}))),x}};function j(p,s=!1){let u=p.value,g=p.valueSpec,v=p.styleSpec;if(g.expression&&r.H(r.u(u)))return Mo(p);if(g.expression&&r.t(r.v(u)))return Ao(p);if(g.type&&ge[g.type]){let x=ge[g.type](p);return s===!0&&x.length>0&&r.n(p.value)==="array"?Ao(p):x}return fr(r.o({},p,{valueSpec:g.type?v[g.type]:g}))}function W(p){let s=p.value,u=p.key,g=Ps(p);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new r.V(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new r.V(u,s,'"glyphs" url must include a "{range}" token'))),g}function ie(p,s=r.L,u={}){return j({key:u.key||"",value:p,valueSpec:s.$root,styleSpec:s,style:p,objectElementValidators:{glyphs:W,"*":()=>[]}})}function he(p,s=r.L){return Kt(ie(p,s))}let de=p=>Kt(jr(p)),ve=p=>Kt(ya(p)),Ce=p=>Kt(gl(p)),_e=p=>Kt(Hc(p)),Me=p=>Kt(_l(p)),Qe=p=>Kt(Zi(p)),Ze=p=>Kt(As(p)),pt=p=>Kt(Ah(p)),It=p=>Kt(ml(p)),Wt=p=>Kt(r.K(p));function Kt(p){return p.slice().sort((s,u)=>s.line&&u.line?s.line-u.line:0)}function kt(p,s){let u=!1;if(s&&s.length)for(let g of s)g instanceof r.m?r.w(g.message):(p.fire(new r.d(new Error(g.message))),u=!0);return u}let nn=new r.N({anchor:new r.O(r.L.light.anchor),position:new r.Q(r.L.light.position),color:new r.O(r.L.light.color),intensity:new r.O(r.L.light.intensity)});class ht extends r.E{constructor(s,u="flat"){super(),this._transitionable=new r.U(nn),this.setLight(s,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u,g={}){this._validate(ve,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=u)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,g){return(!g||g.validate!==!1)&&kt(this,s.call(he,r.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}let Kn=new r.N({source:new r.O(r.L.terrain.source),exaggeration:new r.O(r.L.terrain.exaggeration)}),Ln=class extends r.E{constructor(p,s,u,g){super(),this.scope=u,this._transitionable=new r.U(Kn,u,g),this._transitionable.setTransitionOrValue(p,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(p,s){this._transitionable.setTransitionOrValue(p,s)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.X(p)).get("exaggeration")}isZoomDependent(){let p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.Z}},un=45,_r=65,Qn=.05;function Dr(p,s,u,g){let v=r.$(un,_r,u),[x,w]=Jr(p,g),I=1-Math.min(1,Math.exp((s-x)/(w-x)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*v*p.alpha}function Jr(p,s){let u=.5/Math.tan(.5*s);return[p.range[0]+u,p.range[1]+u]}function ei(p,s,u,g,v){let x=r._.transformMat4([],[s,u,g],v.mercatorFogMatrix);return Dr(p,r._.length(x),v.pitch,v._fov)}function va(p,s,u,g,v,x,w){let I=[[u,g,0],[v,g,0],[v,x,0],[u,x,0]],M=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let L of I){let F=r._.transformMat4([],L,s),B=r._.length(F);M=Math.min(M,B),A=Math.max(A,B)}return[Dr(p,M,w.pitch,w._fov),Dr(p,A,w.pitch,w._fov)]}let qf=new r.N({range:new r.O(r.L.fog.range),color:new r.O(r.L.fog.color),"high-color":new r.O(r.L.fog["high-color"]),"space-color":new r.O(r.L.fog["space-color"]),"horizon-blend":new r.O(r.L.fog["horizon-blend"]),"star-intensity":new r.O(r.L.fog["star-intensity"]),"vertical-range":new r.O(r.L.fog["vertical-range"])});class s_ extends r.E{constructor(s,u,g,v){super(),this._transitionable=new r.U(qf,g,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new r.a0(qf),this.scope=g}get state(){let s=this._transform,u=s.projection.name==="globe",g=r.a1(s.zoom),v=this.properties.get("range"),x=[.5,3];return{range:u?[r.a2(x[0],v[0],g),r.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,u,g={}){if(this._validate(Me,s,g))return;let v=r.W({},s);for(let x of Object.keys(r.L.fog))v[x]===void 0&&(v[x]=r.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;let u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.$(un,_r,s))*u.a}getOpacityAtLatLng(s,u){return this._transform.projection.supportsFog?function(g,v,x){let w=r.Y.fromLngLat(v),I=x.elevation?x.elevation.getAtPointOrZero(w):0;return ei(g,w.x,w.y,I,x)}(this.state,s,u):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];let u=this._transform.calculateFogTileMatrix(s.toUnwrapped());return va(this.state,u,0,0,r.a3,r.a3,this._transform)}getOpacityForBounds(s,u,g,v,x){return this._transform.projection.supportsFog?va(this.state,s,u,g,v,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?Jr(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;let u=[4,5,6,7];for(let g of u){let v=s.points[g],x;if(v[2]>=0)x=v;else{let w=s.points[g-4];x=r.a4(w,v,w[2]/(w[2]-v[2]))}if(ei(this.state,x[0],x[1],0,this._transform)>=Qn)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,g){return(!g||g.validate!==!1)&&kt(this,s.call(he,r.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}class Wc extends r.E{constructor(s,u,g,v){super(),this.scope=g,this._options=s,this.properties=new r.a0(u),this._transitionable=new r.U(u,g,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,u){this._options=s,this._transitionable.setTransitionOrValue(s.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let qt=new r.N({color:new r.O(r.L.properties_light_ambient.color),intensity:new r.O(r.L.properties_light_ambient.intensity)}),Hf=new r.N({direction:new r.a5(r.L.properties_light_directional.direction),color:new r.O(r.L.properties_light_directional.color),intensity:new r.O(r.L.properties_light_directional.intensity),"cast-shadows":new r.O(r.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.O(r.L.properties_light_directional["shadow-intensity"])});var Rs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Wf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Zf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Yf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Xf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Kf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Jf=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ep=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,tp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,a_=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let yl=[];vl(Rs,yl),vl(Zf,yl),vl(Wf,yl);let Rh={"_prelude_fog.vertex.glsl":Kf,"_prelude_terrain.vertex.glsl":Xf,"_prelude_shadow.vertex.glsl":tp,"_prelude_fog.fragment.glsl":Qf,"_prelude_shadow.fragment.glsl":a_,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Jf,"_prelude_raster_particle.glsl":ep},Oh={};en("",Xf),en(Qf,Kf),en(a_,tp),en(Jf,""),en(ep,"");let l_=en(Wf,Zf),c_=Rs;var u_={background:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:en("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:en(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:en(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:en("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:en("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:en("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:en(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:en(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:en(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:en(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:en("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:en("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:en(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:en(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:en(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:en(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:en("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:en(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Yf),skyboxGradient:en(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Yf),skyboxCapture:en(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:en(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:en(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:en(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:en("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function vl(p,s){let u=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of u)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)s.includes(x)||s.push(x)}}function en(p,s){let u=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(A=>{let L=A.split(" ");return L[L.length-1]}),v=[...new Set(v)]);let x={},w=[],I=[];if(p=p.replace(u,(A,L)=>(I.push(L),"")),(s=s.replace(u,(A,L)=>(w.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...yl];vl(p,M),vl(s,M);for(let A of[...w,...I])Rh[A]||console.error(`Undefined include: ${A}`),Oh[A]||(Oh[A]=[],vl(Rh[A],Oh[A])),M=[...M,...Oh[A]];return{fragmentSource:p=p.replace(g,(A,L,F,B,U)=>(x[U]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${F} ${B} ${U};
#else
uniform ${F} ${B} u_${U};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${F} ${B} ${U} = u_${U};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${B} ${U};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(g,(A,L,F,B,U)=>{let $=B==="float"?"vec2":B,G=U.match(/color/)?"color":$;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${F} ${B} a_${U};
#endif
`:x[U]?L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${F} ${$} a_${U};
out ${F} ${B} ${U};
#else
uniform ${F} ${B} u_${U};
#endif
`:L==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${F} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${G}(a_${U}, u_${U}_t);
#else
    ${F} ${B} ${U} = u_${U};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${B} a_${U};
    out ${F} ${B} ${U};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${F} ${$} a_${U};
#else
uniform ${F} ${B} u_${U};
#endif
`:L==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${F} ${B} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${$} a_${U};
#else
uniform ${F} ${B} u_${U};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${F} ${B} ${U} = a_${U};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${F} ${B} ${U} = a_${U};
#else
    ${F} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${F} ${B} ${U} = unpack_mix_${G}(a_${U}, u_${U}_t);
#else
    ${F} ${B} ${U} = u_${U};
#endif
`}),staticAttributes:v,usedDefines:M,vertexIncludes:w,fragmentIncludes:I}}class t1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,u,g,v,x,w,I,M){this.context=s;let A=this.boundPaintVertexBuffers.length!==v.length;for(let F=0;!A&&F<v.length;F++)this.boundPaintVertexBuffers[F]!==v[F]&&(A=!0);let L=this.boundDynamicVertexBuffers.length!==I.length;for(let F=0;!L&&F<I.length;F++)this.boundDynamicVertexBuffers[F]!==I[F]&&(L=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||A||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==w)this.freshBind(u,g,v,x,w,I,M);else{s.bindVertexArrayOES.set(this.vao);for(let F of I)F&&(F.bind(),M&&F.instanceCount&&F.setVertexAttribDivisor(s.gl,u,M));x&&x.dynamicDraw&&x.bind()}}freshBind(s,u,g,v,x,w,I){let M=s.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=w,u.enableAttributes(L,s),u.bind(),u.setVertexAttribPointers(L,s,x);for(let F of g)F.enableAttributes(L,s),F.bind(),F.setVertexAttribPointers(L,s,x);for(let F of w)F&&(F.enableAttributes(L,s),F.bind(),F.setVertexAttribPointers(L,s,x),I&&F.instanceCount&&F.setVertexAttribDivisor(L,s,I));v&&v.bind(),A.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function n1(p,s){let u=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new r.Y(0,g/u).toLngLat().lat,new r.Y(0,(g+1)/u).toLngLat().lat]}function r1(p,s,u,g,v,x,w){let I=p.context,M=I.gl,A=u.hillshadeFBO;if(!A)return;p.prepareDrawTile();let L=p.isTileAffectedByFog(s),F=p.getOrCreateProgram("hillshade",{overrideFog:L});I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,A.colorAttachment.get());let B=((q,H,J,ee)=>{let te=J.paint.get("hillshade-shadow-color"),ue=J.paint.get("hillshade-highlight-color"),le=J.paint.get("hillshade-accent-color"),Q=J.paint.get("hillshade-emissive-strength"),ne=r.ab(J.paint.get("hillshade-illumination-direction"));if(J.paint.get("hillshade-illumination-anchor")==="viewport")ne-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){let pe=q.style.directionalLight.properties.get("direction"),Ee=r.ac(pe.x,pe.y,pe.z);ne=r.ab(Ee[1])}let re=!q.options.moving;return{u_matrix:ee||q.transform.calculateProjMatrix(H.tileID.toUnwrapped(),re),u_image:0,u_latrange:n1(0,H.tileID),u_light:[J.paint.get("hillshade-exaggeration"),ne],u_shadow:te.toRenderColor(J.lut),u_highlight:ue.toRenderColor(J.lut),u_emissive_strength:Q,u_accent:le.toRenderColor(J.lut)}})(p,u,g,p.terrain?s.projMatrix:null);p.uploadCommonUniforms(I,F,s.toUnwrapped());let{tileBoundsBuffer:U,tileBoundsIndexBuffer:$,tileBoundsSegments:G}=p.getTileBoundsBuffers(u);F.draw(p,M.TRIANGLES,v,x,w,r.af.disabled,B,g.id,U,$,G)}function np(p,s,u){if(!s.needsDEMTextureUpload)return;let g=p.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(u.stride);let x=u.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new r.T(g,x,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Po(p,s,u){let g=p.context,v=g.gl;if(!s.dem)return;let x=s.dem;if(g.activeTexture.set(v.TEXTURE1),np(p,s,x),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let w=x.dim;g.activeTexture.set(v.TEXTURE0);let I=s.hillshadeFBO;if(!I){let B=new r.T(g,{width:w,height:w,data:null},v.RGBA);B.bind(v.LINEAR,v.CLAMP_TO_EDGE),I=s.hillshadeFBO=g.createFramebuffer(w,w,!0,"renderbuffer"),I.colorAttachment.set(B.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,w,w]);let{tileBoundsBuffer:M,tileBoundsIndexBuffer:A,tileBoundsSegments:L}=p.getMercatorTileBoundsBuffers(),F=[];p.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(p,v.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,((B,U)=>{let $=U.stride,G=r.ad.create();return r.ad.ortho(G,0,r.a3,-r.a3,0,0,1),r.ad.translate(G,G,[0,-r.a3,0]),{u_matrix:G,u_image:1,u_dimension:[$,$],u_zoom:B.overscaledZ}})(s.tileID,x),u.id,M,A,L),s.needsHillshadePrepare=!1}function rp(p,s,u,g,v){let x=function(w,I){if(w)return v(w);if(I){if(p.url&&I.tiles&&p.tiles&&delete p.tiles,I.variants){if(!Array.isArray(I.variants))return v(new Error("variants must be an array"));for(let A of I.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return v(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){I=r.W(I,A);break}}}let M=r.ah(r.W(I,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(M.vectorLayers=I.vector_layers,M.vectorLayerIds=M.vectorLayers.map(A=>A.id)),I.raster_layers&&(M.rasterLayers=I.raster_layers,M.rasterLayerIds=M.rasterLayers.map(A=>A.id)),M.tiles=s.canonicalizeTileset(M,p.url),v(null,M)}};return p.url?r.g(s.transformRequest(s.normalizeSourceURL(p.url,null,u,g),r.R.Source),x):r.e.frame(()=>x(null,p))}class Zc{constructor(s,u,g){this.bounds=r.ai.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){let u=Math.pow(2,s.z),g=Math.floor(r.aj(this.bounds.getWest())*u),v=Math.floor(r.ak(this.bounds.getNorth())*u),x=Math.ceil(r.aj(this.bounds.getEast())*u),w=Math.ceil(r.ak(this.bounds.getSouth())*u);return s.x>=g&&s.x<x&&s.y>=v&&s.y<w}}class Yc extends r.E{constructor(s,u,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.W({type:"raster"},u),r.W(this,r.ah(u,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._tileJSONRequest=rp(this._options,this.map._requestManager,null,null,(u,g)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new r.d(u)):g&&(r.W(this,g),g.bounds&&(this.tileBounds=new Zc(g.bounds,this.minzoom,this.maxzoom)),r.an(g.tiles),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(u)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,u){let g=r.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=r.h(this.map._requestManager.transformRequest(v,r.R.Tile),(x,w,I,M)=>(delete s.request,s.aborted?(s.state="unloaded",u(null)):x?(s.state="errored",u(x)):w?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:I,expires:M}),s.setTexture(w,this.map.painter),s.state="loaded",r.am(this.dispatcher),void u(null)):u(null)))}abortTile(s,u){s.request&&(s.request.cancel(),delete s.request),u&&u()}unloadTile(s,u){s.texture&&s.texture instanceof r.T?(s.destroy(!0),s.texture&&s.texture instanceof r.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Lh extends r.E{constructor(s,u,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.W(this,r.ah(u,["url","scheme","tileSize","promoteId"])),this._options=r.W({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.ao}load(s){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=rp(this._options,this.map._requestManager,u,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new r.d(v))):x&&(r.W(this,x),x.bounds&&(this.tileBounds=new Zc(x.bounds,this.minzoom,this.maxzoom)),r.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();let s=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}loadTile(s,u){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,w={request:v,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(w.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=u:s.request=s.actor.send("reloadTile",w,I.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",w,I.bind(this),void 0,!0);else{let M=r.ap.call({deduped:this._deduped},w,(A,L)=>{A||!L?I.call(this,A):(w.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},s.actor&&s.actor.send("loadTile",w,I.bind(this),void 0,!0))},!0);s.request={cancel:M}}function I(M,A){return delete s.request,s.aborted?u(null):M&&M.status!==404?u(M):(A&&A.resourceTiming&&(s.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&s.setExpiryData(A),s.loadVectorData(A,this.map.painter),r.am(this.dispatcher),u(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,u){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let xa=p=>({u_matrix:new r.a6(p),u_image0:new r.a7(p),u_skirt_height:new r.aa(p),u_ground_shadow_factor:new r.aq(p)}),rt=(p,s,u)=>({u_matrix:p,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:u}),h_=(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:w,u_frustum_tr:I,u_frustum_br:M,u_frustum_bl:A,u_globe_pos:L,u_globe_radius:F,u_viewport:B,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:$});class Xc{constructor(s=0,u=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=g,this.right=v}interpolate(s,u,g){return u.top!=null&&s.top!=null&&(this.top=r.a2(s.top,u.top,g)),u.bottom!=null&&s.bottom!=null&&(this.bottom=r.a2(s.bottom,u.bottom,g)),u.left!=null&&s.left!=null&&(this.left=r.a2(s.left,u.left,g)),u.right!=null&&s.right!=null&&(this.right=r.a2(s.right,u.right,g)),this}getCenter(s,u){let g=r.at((this.left+s-this.right)/2,0,s),v=r.at((this.top+u-this.bottom)/2,0,u);return new r.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Xc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function rn(p,s){let u=r.aw(p,3);r.ad.fromQuat(p,s),r.az(p,3,u)}function ti(p,s){let u=r.av.identity([]);return r.av.rotateZ(u,u,-s),r.av.rotateX(u,u,-p),u}function d_(p,s){let u=[p[0],p[1],0],g=[s[0],s[1],0];if(r._.length(u)>=1e-15){let w=r._.normalize([],u);r._.scale(g,w,r._.dot(g,w)),s[0]=g[0],s[1]=g[1]}let v=r._.cross([],s,p);if(r._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return ti(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),x)}class ip{constructor(s,u){this.position=s,this.orientation=u}get position(){return this._position}set position(s){if(s){let u=s instanceof r.Y?s:new r.Y(s[0],s[1],s[2]);this._renderWorldCopies&&(u.x=r.au(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(s,u){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.Y.fromLngLat(s)):0,x=r.Y.fromLngLat(s,v),w=[x.x-g.x,x.y-g.y,x.z-g.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=d_(w,u)}setPitchBearing(s,u){this.orientation=ti(r.ab(s),r.ab(-u))}}class Kc{constructor(s,u){this._transform=r.ad.identity([]),this.orientation=u,this.position=s}get mercatorPosition(){let s=this.position;return new r.Y(s[0],s[1],s[2])}get position(){let s=r.aw(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var u;s&&r.az(this._transform,3,[(u=s)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||r.av.identity([]),s&&rn(this._transform,this._orientation)}getPitchBearing(){let s=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,u){this._orientation=ti(s,u),rn(this._transform,this._orientation)}forward(){let s=r.aw(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){let s=r.aw(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){let s=r.aw(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,u){let g=new Float64Array(16);return r.ad.invert(g,this.getWorldToCamera(s,u)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,u,g){let v=this.position;r._.scale(v,v,-s);let x=new Float64Array(16);return r.ad.fromScaling(x,[g,g,g]),r.ad.translate(x,x,v),x[10]*=u,x}getWorldToCamera(s,u){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return r.av.conjugate(v,this._orientation),r._.scale(x,x,-s),r.ad.fromQuat(g,v),r.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(s,u,g,v){let x=new Float64Array(16);return r.ad.perspective(x,s,u,g,v),x}getCameraToClipOrthographic(s,u,g,v,x,w){let I=new Float64Array(16);return r.ad.ortho(I,s,u,g,v,x,w),I}getDistanceToElevation(s,u=!1){let g=s===0?0:r.ax(s,u?r.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Kc([...this.position],[...this.orientation])}}let xl={unknown:0,flipRequired:1,flipNotRequired:2},Zt=Math.tan(85*Math.PI/180);function ba(p,s,u,g,v,x,w){let I=r.ad.create();if(u)if(x.name==="globe"){let M=r.aB(v,s);r.ad.multiply(I,I,M)}else{let M=r.aC.invert([],w);I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],g||r.ad.rotateZ(I,I,v.angle)}else r.ad.multiply(I,v.labelPlaneMatrix,p);return I}function wa(p,s,u,g,v,x,w){let I=ba(p,s,u,g,v,x,w);return x.name==="globe"&&u||(I[2]=I[6]=I[10]=I[14]=0),I}function bl(p,s,u,g,v,x,w){if(u){if(x.name==="globe"){let I=ba(p,s,u,g,v,x,w);return r.ad.invert(I,I),r.ad.multiply(I,p,I),I}{let I=r.ad.clone(p),M=r.ad.identity([]);return M[0]=w[0],M[1]=w[1],M[4]=w[2],M[5]=w[3],r.ad.multiply(I,I,M),g||r.ad.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function Xi(p,s,u,g){let v=[p,s,u,1];u?r.aA.transformMat4(v,v,g):Ro(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function ni(p,s){return Math.min(.5+p/s*.5,1.5)}function i1(p,s){let u=p[0]/p[3],g=p[1]/p[3];return u>=-s[0]&&u<=s[0]&&g>=-s[1]&&g<=s[1]}function kh(p,s,u,g,v,x,w,I,M,A){let L=u.transform,F=g?p.textSizeData:p.iconSizeData,B=r.aD(F,u.transform.zoom),U=L.projection.name==="globe",$=[256/u.width*2+1,256/u.height*2+1],G=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;G.clear();let q=null;U&&(q=g?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);let H=p.lineVertexArray,J=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,ee=u.transform.width/u.transform.height,te,ue=!1;for(let le=0;le<J.length;le++){let Q=J.get(le),{numGlyphs:ne,writingMode:re}=Q;if(re!==r.aE.vertical||ue||te===r.aE.horizontal||(ue=!0),te=re,(Q.hidden||re===r.aE.vertical)&&!ue){Ea(ne,G);continue}ue=!1;let pe=new r.P(Q.tileAnchorX,Q.tileAnchorY),{x:Ee,y:se,z:Te}=L.projection.projectTilePoint(pe.x,pe.y,A.canonical);if(M){let[nt,ze,Ve]=M(pe);Ee+=nt,se+=ze,Te+=Ve}let Se=[Ee,se,Te,1];if(r.aA.transformMat4(Se,Se,s),!i1(Se,$)){Ea(ne,G);continue}let Be=Se[3],Ue=ni(u.transform.getCameraToCenterDistance(L.projection),Be),Ne=r.aF(F,B,Q),ye=w?Ne/Ue:Ne*Ue,Ae=Xi(Ee,se,Te,v);if(Ae[3]<=0){Ea(ne,G);continue}let Le={},et=w?null:M,it=sp(Q,ye,!1,I,s,v,x,p.glyphOffsetArray,H,G,q,Ae,pe,Le,ee,et,L.projection,A,w);ue=it.useVertical,et&&it.needsFlipping&&(Le={}),(it.notEnoughRoom||ue||it.needsFlipping&&sp(Q,ye,!0,I,s,v,x,p.glyphOffsetArray,H,G,q,Ae,pe,Le,ee,et,L.projection,A,w).notEnoughRoom)&&Ea(ne,G)}g?(p.text.dynamicLayoutVertexBuffer.updateData(G),q&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(q)):(p.icon.dynamicLayoutVertexBuffer.updateData(G),q&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(q))}function Fh(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G){let{lineStartIndex:q,glyphStartIndex:H,segment:J}=I,ee=H+I.numGlyphs,te=q+I.lineLength,ue=s.getoffsetX(H),le=s.getoffsetX(ee-1),Q=wl(p*ue,u,g,v,x,w,J,q,te,M,A,L,F,B,!0,U,$,G);if(!Q)return null;let ne=wl(p*le,u,g,v,x,w,J,q,te,M,A,L,F,B,!0,U,$,G);return ne?{first:Q,last:ne}:null}function op(p,s,u,g){return p===r.aE.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:p===r.aE.vertical?g>0?{needsFlipping:!0}:null:s!==xl.unknown&&function(v,x){return v===0||Math.abs(x/v)>Zt}(u,g)?s===xl.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function sp(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q,H,J){let ee=s/24,te=p.lineOffsetX*ee,ue=p.lineOffsetY*ee,{lineStartIndex:le,glyphStartIndex:Q,numGlyphs:ne,segment:re,writingMode:pe,flipState:Ee}=p,se=le+p.lineLength,Te=Se=>{if(L){let[ye,Ae,Le]=Se.up,et=A.length;r.aG(L,et+0,ye,Ae,Le),r.aG(L,et+1,ye,Ae,Le),r.aG(L,et+2,ye,Ae,Le),r.aG(L,et+3,ye,Ae,Le)}let[Be,Ue,Ne]=Se.point;r.aH(A,Be,Ue,Ne,Se.angle)};if(ne>1){let Se=Fh(ee,I,te,ue,u,F,B,p,M,x,U,G,!1,q,H,J);if(!Se)return{notEnoughRoom:!0};if(g&&!u){let[Be,Ue,Ne]=Se.first.point,[ye,Ae,Le]=Se.last.point;[Be,Ue]=Xi(Be,Ue,Ne,w),[ye,Ae]=Xi(ye,Ae,Le,w);let et=op(pe,Ee,(ye-Be)*$,Ae-Ue);if(p.flipState=et&&et.needsFlipping?xl.flipRequired:xl.flipNotRequired,et)return et}Te(Se.first);for(let Be=Q+1;Be<Q+ne-1;Be++){let Ue=wl(ee*I.getoffsetX(Be),te,ue,u,F,B,re,le,se,M,x,U,G,!1,!1,q,H,J);if(!Ue)return A.length-=4*(Be-Q),{notEnoughRoom:!0};Te(Ue)}Te(Se.last)}else{if(g&&!u){let Be=Xi(B.x,B.y,0,v),Ue=le+re+1,Ne=new r.P(M.getx(Ue),M.gety(Ue)),ye=Xi(Ne.x,Ne.y,0,v),Ae=ye[3]>0?ye:Qc(B,Ne,Be,1,v,void 0,q,H.canonical),Le=op(pe,Ee,(Ae[0]-Be[0])*$,Ae[1]-Be[1]);if(p.flipState=Le&&Le.needsFlipping?xl.flipRequired:xl.flipNotRequired,Le)return Le}let Se=wl(ee*I.getoffsetX(Q),te,ue,u,F,B,re,le,se,M,x,U,G,!1,!1,q,H,J);if(!Se)return{notEnoughRoom:!0};Te(Se)}return{}}function Nh(p,s,u,g,v){let{x,y:w,z:I}=g.projectTilePoint(p.x,p.y,s);if(!v)return Xi(x,w,I,u);let[M,A,L]=v(p);return Xi(x+M,w+A,I+L,u)}function Qc(p,s,u,g,v,x,w,I){let M=Nh(p.sub(s)._unit()._add(p),I,v,w,x);return r._.sub(M,u,M),r._.normalize(M,M),r._.scaleAndAdd(M,u,M,g)}function wl(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q,H){let J=g?p-s:p+s,ee=J>0?1:-1,te=0;g&&(ee*=-1,te=Math.PI),ee<0&&(te+=Math.PI);let ue=I+w+(ee>0?0:1)|0,le=v,Q=v,ne=0,re=0,pe=Math.abs(J),Ee=[],se=[],Te=x,Se=Te,Be=()=>Qc(Se,Te,Q,pe-ne+1,L,B,G,q.canonical);for(;ne+re<=pe;){if(ue+=ee,ue<I||ue>=M)return null;if(Q=le,Se=Te,Ee.push(Q),U&&se.push(Se),Te=new r.P(A.getx(ue),A.gety(ue)),le=F[ue],!le){let ze=Nh(Te,q.canonical,L,G,B);le=ze[3]>0?F[ue]=ze:Be()}ne+=re,re=r._.distance(Q,le)}$&&B&&(F[ue]&&(le=Be(),re=r._.distance(Q,le)),F[ue]=le);let Ue=(pe-ne)/re,Ne=Te.sub(Se)._mult(Ue)._add(Se),ye=r._.sub([],le,Q),Ae=r._.scaleAndAdd([],Q,ye,Ue),Le=[0,0,1],et=ye[0],it=ye[1];if(H&&(Le=G.upVector(q.canonical,Ne.x,Ne.y),Le[0]!==0||Le[1]!==0||Le[2]!==1)){let ze=[Le[2],0,-Le[0]],Ve=r._.cross([],Le,ze);r._.normalize(ze,ze),r._.normalize(Ve,Ve),et=r._.dot(ye,ze),it=r._.dot(ye,Ve)}if(u){let ze=r._.cross([],Le,ye);r._.normalize(ze,ze),r._.scaleAndAdd(Ae,Ae,ze,u*ee)}let nt=te+Math.atan2(it,et);return Ee.push(Ae),U&&se.push(Ne),{point:Ae,angle:nt,path:Ee,tilePath:se,up:Le}}function Ea(p,s){let u=s.length,g=u+4*p;s.resize(g),s.float32.fill(-1/0,4*u,4*g)}function Ro(p,s,u){let g=s[0],v=s[1];return p[0]=u[0]*g+u[4]*v+u[12],p[1]=u[1]*g+u[5]*v+u[13],p[3]=u[3]*g+u[7]*v+u[15],p}let ap=(p,s,u)=>(1-u)*p+u*s,yr=p=>p*p*p*p*p;class Oo{constructor(s,u,g,v,x,w,I){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(w),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Kc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let s=new Oo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,u=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return r.ah(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};let u=this.projection?this.getProjection():void 0;this.projection=r.aJ(this.projectionOptions);let g=!E(u,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){let s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.aJ({name:"mercator"});let u=s!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){let s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.au(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){let u=-s*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=r.aC.create(),r.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){let u=r.at(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=r.ab(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){let u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){let s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let s=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let w=0;w<u.length;w++){let I=new r.P(u[w][0]*this.width,g+u[w][1]*(this.height-g)),M=s.pointCoordinate(I);if(!M)continue;let A=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);v+=M[3]*A,x+=A}return x===0?NaN:v/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let s=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){let u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude())),g;g=s.z<this._camera.position[2]?[u.x,u.y,u.z]:[s.x,s.y,s.z];let v=r._.length(r._.sub([],this._camera.position,g));return r.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let u=!1;if(s.orientation&&!r.av.exactEquals(s.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(s.orientation)),s.position){let g=[s.position.x,s.position.y,s.position.z];r._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let s=this._camera.position,u=new ip;return u.position=new r.Y(s[0],s[1],s[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(s){if(!r.av.length(s))return!1;r.av.normalize(s,s);let u=r._.transformQuat([],[0,0,-1],s),g=r._.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;let v=d_(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){let u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=r.at(s[2],v/g,v/u),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,g){this._unmodified=!1,this._edgeInsets.interpolate(s,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){let u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(s){let u=[new r.aK(0,s)];if(this.renderWorldCopies){let g=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),w=this.pointCoordinate(new r.P(0,this.height)),I=Math.floor(Math.min(g.x,v.x,x.x,w.x)),M=Math.floor(Math.max(g.x,v.x,x.x,w.x)),A=1;for(let L=I-A;L<=M+A;L++)L!==0&&u.push(new r.aK(L,s))}return u}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(s,u,g){let v=[];if(u[0]===0&&u[1]===0)return v;for(let w of s){let I=w.canonical,M=w.overscaledZ,A=w.wrap,L=1<<I.z,F=I.x+1<L,B=I.x>0,U=I.y+1<L,$=I.y>0,G=w.wrap-(B?0:1),q=w.wrap+(F?0:1),H=B?I.x-1:L-1,J=F?I.x+1:0;u[0]<0?(v.push(new r.aL(M,q,I.z,J,I.y)),u[1]<0&&U&&(v.push(new r.aL(M,A,I.z,I.x,I.y+1)),v.push(new r.aL(M,q,I.z,J,I.y+1))),u[1]>0&&$&&(v.push(new r.aL(M,A,I.z,I.x,I.y-1)),v.push(new r.aL(M,q,I.z,J,I.y-1)))):u[0]>0?(v.push(new r.aL(M,G,I.z,H,I.y)),u[1]<0&&U&&(v.push(new r.aL(M,A,I.z,I.x,I.y+1)),v.push(new r.aL(M,G,I.z,H,I.y+1))),u[1]>0&&$&&(v.push(new r.aL(M,A,I.z,I.x,I.y-1)),v.push(new r.aL(M,G,I.z,H,I.y-1)))):u[1]<0&&U?v.push(new r.aL(M,A,I.z,I.x,I.y+1)):$&&v.push(new r.aL(M,A,I.z,I.x,I.y-1))}if(v.length>1){v.sort((M,A)=>M.overscaledZ-A.overscaledZ||M.wrap-A.wrap||M.canonical.z-A.canonical.z||M.canonical.x-A.canonical.x||M.canonical.y-A.canonical.y);let w=0,I=0;for(;I<v.length;)v[I].equals(v[w])?++I:v[++w]=v[I++];v.length=w+1}let x=[];for(let w of v)v.some(I=>w.isChildOf(I))||x.push(w);return v=x.filter(w=>!s.some(I=>!!(w.overscaledZ<g&&I.isChildOf(w))||w.equals(I)||w.isChildOf(I))),v}coveringTiles(s){let u=this.coveringZoomLevel(s),g=u,v=this.elevation&&this.elevation.exaggeration(),x=v&&!s.isTerrainDEM,w=this.projection.name==="mercator";if(s.minzoom!==void 0&&u<s.minzoom)return[];s.maxzoom!==void 0&&u>s.maxzoom&&(u=s.maxzoom);let I=this.locationCoordinate(this.center),M=this.center.lat,A=1<<u,L=[A*I.x,A*I.y,0],F=this.projection.name==="globe",B=!F,U=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),$=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=A*r.ax(1,this.center.lat),q=this._camera.position[2]/r.ax(1,this.center.lat),H=[A*$.x,A*$.y,q*(B?1:G)],J=F||v,ee=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),te=this.isLODDisabled(!0)?u:0,ue;if(this._elevation&&s.isTerrainDEM)ue=1e4*this._elevation.exaggeration();else if(this._elevation){let ye=this._elevation.getMinMaxForVisibleTiles();ue=ye?ye.max:this._centerAltitude}else ue=this._centerAltitude;let le=s.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,Q=this.projection.isReprojectedInTileSpace?r.aN(this):1,ne=ye=>{let Le=new r.Y(ye.x+25e-6,ye.y,ye.z),et=new r.Y(ye.x,ye.y+25e-6,ye.z),it=ye.toLngLat(),nt=Le.toLngLat(),ze=et.toLngLat(),Ve=this.locationCoordinate(it),tt=this.locationCoordinate(nt),ut=this.locationCoordinate(ze),At=Math.hypot(tt.x-Ve.x,tt.y-Ve.y),Bt=Math.hypot(ut.x-Ve.x,ut.y-Ve.y);return Math.sqrt(At*Bt)*Q/25e-6},re=ye=>{let Ae=ue,Le=le;return{aabb:r.aQ(this,A,0,0,0,ye,Le,Ae,this.projection),zoom:0,x:0,y:0,minZ:Le,maxZ:Ae,wrap:ye,fullyVisible:!1}},pe=[],Ee=[],se=u,Te=s.reparseOverscaled?g:u,Se=ye=>ye*ye,Be=Se((q-this._centerAltitude)*G),Ue=ye=>{if(!this._elevation||!ye.tileID||!w)return;let Ae=this._elevation.getMinMaxForTile(ye.tileID),Le=ye.aabb;Ae?(Le.min[2]=Ae.min,Le.max[2]=Ae.max,Le.center[2]=(Le.min[2]+Le.max[2])/2):(ye.shouldSplit=Ne(ye),ye.shouldSplit||(Le.min[2]=Le.max[2]=Le.center[2]=this._centerAltitude))},Ne=ye=>{if(ye.zoom<te)return!0;if(ye.zoom===se)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;let Ae=ye.aabb.distanceX(H),Le=ye.aabb.distanceY(H),et=Be,it=1;if(F){et=Se(ye.aabb.distanceZ(H));let Ve=Math.pow(2,ye.zoom),tt=r.ay((ye.y+1)/Ve),ut=r.ay(ye.y/Ve),At=Math.min(Math.max(M,tt),ut),Bt=r.b4(At)/r.b4(M);if(it=At===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bt/this._mercatorScaleRatio),this.zoom<=r.b1&&ye.zoom===se-1&&Bt>=.9)return!0}else if(x&&(et=Se(ye.aabb.distanceZ(H)*G)),this.projection.isReprojectedInTileSpace&&g<=5){let Ve=Math.pow(2,ye.zoom),tt=ne(new r.Y((ye.x+.5)/Ve,(ye.y+.5)/Ve));it=tt>.85?1:tt}let nt=Ae*Ae+Le*Le+et,ze=Se((1<<se-ye.zoom)*ee*it*((Ve,tt)=>{if(tt*Se(.707)<Ve)return 1;let ut=Math.sqrt(tt/Ve);return ut/(1.4144271570014144+(Math.pow(1.1,ut-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(et,Be),nt));return nt<ze};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)pe.push(re(-ye)),pe.push(re(ye));for(pe.push(re(0));pe.length>0;){let ye=pe.pop(),Ae=ye.x,Le=ye.y,et=ye.fullyVisible,it=()=>this.projection.name==="globe"&&(ye.y===0||ye.y===(1<<ye.zoom)-1);if(!et){let nt=J?ye.aabb.intersects(U):ye.aabb.intersectsFlat(U);if(nt===0&&it()){let ze=new r.aO(ye.zoom,Ae,Le);nt=r.aP(this,A,ze,!0).intersects(U)}if(nt===0)continue;et=nt===2}if(ye.zoom!==se&&Ne(ye))for(let nt=0;nt<4;nt++){let ze=(Ae<<1)+nt%2,Ve=(Le<<1)+(nt>>1),tt={aabb:w?ye.aabb.quadrant(nt):r.aQ(this,A,ye.zoom+1,ze,Ve,ye.wrap,ye.minZ,ye.maxZ,this.projection),zoom:ye.zoom+1,x:ze,y:Ve,wrap:ye.wrap,fullyVisible:et,tileID:void 0,shouldSplit:void 0,minZ:ye.minZ,maxZ:ye.maxZ};x&&!F&&(tt.tileID=new r.aL(ye.zoom+1===se?Te:ye.zoom+1,ye.wrap,ye.zoom+1,ze,Ve),Ue(tt)),pe.push(tt)}else{let nt=ye.zoom===se?Te:ye.zoom;if(s.minzoom&&s.minzoom>nt)continue;if(!et){let ut=J?ye.aabb.intersectsPrecise(U):ye.aabb.intersectsPreciseFlat(U);if(ut===0&&it()){let At=new r.aO(ye.zoom,Ae,Le);ut=r.aP(this,A,At,!0).intersectsPrecise(U)}if(ut===0)continue}let ze=L[0]-(.5+Ae+(ye.wrap<<ye.zoom))*(1<<u-ye.zoom),Ve=L[1]-.5-Le,tt=ye.tileID?ye.tileID:new r.aL(nt,ye.wrap,ye.zoom,Ae,Le);Ee.push({tileID:tt,distanceSq:ze*ze+Ve*Ve})}}if(this.fogCullDistSq){let ye=this.fogCullDistSq,Ae=this.horizonLineFromTop();Ee=Ee.filter(Le=>{let et=[0,0,0,1],it=[r.a3,r.a3,0,1],nt=this.calculateFogTileMatrix(Le.tileID.toUnwrapped());r.aA.transformMat4(et,et,nt),r.aA.transformMat4(it,it,nt);let ze=r.aA.min([],et,it),Ve=r.aA.max([],et,it),tt=r.aR(ze,Ve);if(tt===0)return!0;let ut=!1,At=this._elevation;if(At&&tt>ye&&Ae!==0){let Bt=this.calculateProjMatrix(Le.tileID.toUnwrapped()),on;s.isTerrainDEM||(on=At.getMinMaxForTile(Le.tileID)),on||(on={min:le,max:ue});let tn=r.b2(this.rotation),Cn=[tn[0]*r.a3,tn[1]*r.a3,on.max];r._.transformMat4(Cn,Cn,Bt),ut=(1-Cn[1])*this.height*.5<Ae}return tt<ye||ut})}return Ee.sort((ye,Ae)=>ye.distanceSq-Ae.distanceSq).map(ye=>ye.tileID)}resize(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){let u=r.at(s.lat,-r.aS,r.aS),g=this.projection.project(s.lng,u);return new r.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,u){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let I=this.worldSize;g=(u.x-x.x)/I,v=(u.y-x.y)/I}else{let I=this.pointCoordinate(u),M=this.pointCoordinate(x);g=I.x-M.x,v=I.y-M.y}let w=this.locationCoordinate(s);this.setLocation(new r.Y(w.x-g,w.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,u){let g=u?r.ax(u,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new r.Y(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,u){let g=u??this._centerAltitude,v=[s.x,s.y,0,1],x=[s.x,s.y,1,1];r.aA.transformMat4(v,v,this.pixelMatrixInverse),r.aA.transformMat4(x,x,this.pixelMatrixInverse);let w=x[3];r.aA.scale(v,v,1/v[3]),r.aA.scale(x,x,1/w);let I=v[2],M=x[2];return{p0:v,p1:x,t:I===M?0:(g-I)/(M-I)}}screenPointToMercatorRay(s){let u=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return r.aA.transformMat4(u,u,this.pixelMatrixInverse),r.aA.transformMat4(g,g,this.pixelMatrixInverse),r.aA.scale(u,u,1/u[3]),r.aA.scale(g,g,1/g[3]),u[2]=r.ax(u[2],this._center.lat)*this.worldSize,g[2]=r.ax(g[2],this._center.lat)*this.worldSize,r.aA.scale(u,u,1/this.worldSize),r.aA.scale(g,g,1/this.worldSize),new r.aT([u[0],u[1],u[2]],r._.normalize([],r._.sub([],g,u)))}rayIntersectionCoordinate(s){let{p0:u,p1:g,t:v}=s,x=r.ax(u[2],this._center.lat),w=r.ax(g[2],this._center.lat);return new r.Y(r.a2(u[0],g[0],v)/this.worldSize,r.a2(u[1],g[1],v)/this.worldSize,r.a2(x,w,v))}pointCoordinate(s,u=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,u)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let u=this.projection.pointCoordinate3D(this,s.x,s.y);if(u)return new r.Y(u[0],u[1],u[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);let x=.02*v,w=s.clone();for(let I=0;I<10&&v-g>x;I++){w.y=r.a2(g,v,.66);let M=this.projection.pointCoordinate3D(this,w.x,w.y);M?(v=w.y,u=M):g=w.y}return u?new r.Y(u[0],u[1],u[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=r.aU)return!this.isPointAboveHorizon(s);let u=this.pointCoordinate(s);return u.y>=0&&u.y<=1}_coordinatePoint(s,u){let g=u&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return r.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:s,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(u,s)),w=this.pointLocation3D(new r.P(v,s)),I=this.pointLocation3D(new r.P(v,g)),M=this.pointLocation3D(new r.P(u,g)),A=Math.min(x.lng,w.lng,I.lng,M.lng),L=Math.max(x.lng,w.lng,I.lng,M.lng),F=Math.min(x.lat,w.lat,I.lat,M.lat),B=Math.max(x.lat,w.lat,I.lat,M.lat),U=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,G=(q,H,J,ee,te)=>{let ue=(q+J)/2,le=(H+ee)/2,Q=new r.P(ue,le),{lng:ne,lat:re}=this.pointLocation3D(Q),pe=Math.max(0,A-ne,F-re,ne-L,re-B);A=Math.min(A,ne),L=Math.max(L,ne),F=Math.min(F,re),B=Math.max(B,re),(te<$||pe>U)&&(G(q,H,ue,le,te+1),G(ue,le,J,ee,te+1))};if(G(u,s,v,s,1),G(v,s,v,g,1),G(v,g,u,g,1),G(u,g,u,s,1),this.projection.name==="globe"){let[q,H]=r.aV(this);q?(B=90,L=180,A=-180):H&&(F=-90,L=180,A=-180)}return new r.ai(new r.aI(A,F),new r.aI(L,B))}_getBoundsRectangular(s,u){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,I=new r.P(v,g),M=new r.P(w,g),A=new r.P(w,x),L=new r.P(v,x),F=this.pointCoordinate(I,s),B=this.pointCoordinate(M,s),U=this.pointCoordinate(A,u),$=this.pointCoordinate(L,u),G=(q,H)=>(H.y-q.y)/(H.x-q.x);return F.y>1&&B.y>=0?F=new r.Y((1-$.y)/G($,F)+$.x,1):F.y<0&&B.y<=1&&(F=new r.Y(-$.y/G($,F)+$.x,0)),B.y>1&&F.y>=0?B=new r.Y((1-U.y)/G(U,B)+U.x,1):B.y<0&&F.y<=1&&(B=new r.Y(-U.y/G(U,B)+U.x,0)),new r.ai().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){let s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);let u=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*s.exaggeration(),u.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){let u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-r.aS,this.maxLat=r.aS,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aj(this.minLng)*this.tileSize,this.worldMaxX=r.aj(this.maxLng)*this.tileSize,this.worldMinY=r.ak(this.maxLat)*this.tileSize,this.worldMaxY=r.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,u){return this.projection.createTileMatrix(this,u,s)}calculateDistanceTileData(s){let u=s.key,g=this._distanceTileDataCache;if(g[u])return g[u];let v=s.canonical,x=1/this.height,w=this.cameraWorldSize,I=w/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*s.wrap)*I,A=v.y*I,L=this.point;L.x*=w/this.worldSize,L.y*=w/this.worldSize;let F=this.angle,B=Math.sin(-F),U=-Math.cos(-F);return g[u]={bearing:[B,U],center:[(L.x-M)*x,(L.y-A)*x],scale:I/r.a3*x},g[u]}calculateFogTileMatrix(s){let u=s.key,g=this._fogTileMatrixCache;if(g[u])return g[u];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return r.ad.multiply(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(s,u=!1,g=!1){let v=s.key,x;if(x=g?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let w=this.calculatePosMatrix(s,this.worldSize),I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,r.ad.multiply(w,I,w),x[v]=new Float32Array(w),x[v]}calculatePixelsToTileUnitsMatrix(s){let u=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];let v=r.aW(s,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let s=1/this.worldSize,u=r.ad.fromScaling([],[s,s,s]);return r.ad.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let s=this._elevation;this._updateCameraState();let u=r.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),x=r.ax(1,this._center.lat);g[2]/=x,v[2]/=x,r._.normalize(v,v);let w=s.raycast(g,v,s.exaggeration());if(w){let I=r._.scaleAndAdd([],g,v,w),M=new r.Y(I[0],I[1],r.ax(I[2],r.ay(I[1]))),A=(M.z+r._.length([M.x-g[0],M.y-g[1],M.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;let u=this._elevation,g=r.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=u.getAtPointOrZero(new r.Y(...v)),w=this.pixelsPerMeter/this.worldSize*x,I=this._minimumHeightOverTerrain(),M=v[2]-w;if(M<=I)if(M<0||s){let A=this.locationCoordinate(this._center,this._centerAltitude),L=[v[0],v[1],A.z-v[2]],F=r._.length(L);L[2]-=(I-M)/this._pixelsPerMercatorPixel;let B=r._.length(L);if(B===0)return;r._.scale(L,L,F/B*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],A.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){let B=this.center;return B.lat=r.at(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(B.lng=r.at(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}let u=this._unmodified,{x:g,y:v}=this.point,x=0,w=g,I=v,M=this.width/2,A=this.height/2,L=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(v-A<L&&(I=L+A),v+A>F&&(I=F-A),F-L<this.height&&(x=Math.max(x,this.height/(F-L)),I=(F+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let B=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,$=this.worldSize/2-(B+U)/2;w=(g+$+this.worldSize)%this.worldSize-$,w-M<B&&(w=B+M),w+M>U&&(w=U-M),U-B<this.width&&(x=Math.max(x,this.width/(U-B)),w=(U+B)/2)}w===g&&I===v||(this.center=this.unproject(new r.P(w,I))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let s=this.centerOffset,u=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ax(1,this.center.lat)/r.ax(1,r.b3));let v=r.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,w=this._camera.getWorldToCamera(this.worldSize,x),I,M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-s.x/this.width,M[9]=2*s.y/this.height,this.isOrthographic){let re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),pe=re*this.aspect,Ee=-pe,se=-re;pe-=s.x,Ee-=s.x,re+=s.y,se+=s.y,I=this._camera.getCameraToClipOrthographic(Ee,pe,se,re,this._nearZ,this._farZ),((Te,Se,Be,Ue)=>{for(let Ne=0;Ne<16;Ne++)Te[Ne]=ap(Se[Ne],Be[Ne],Ue)})(I,I,M,yr(this.pitch>=15?1:this.pitch/15))}else I=M;let A=r.ad.mul([],M,w),L=r.ad.mul([],I,w);if(this.projection.isReprojectedInTileSpace){let re=this.locationCoordinate(this.center),pe=r.ad.identity([]);r.ad.translate(pe,pe,[re.x*this.worldSize,re.y*this.worldSize,0]),r.ad.multiply(pe,pe,r.aY(this)),r.ad.translate(pe,pe,[-re.x*this.worldSize,-re.y*this.worldSize,0]),r.ad.multiply(L,L,pe),r.ad.multiply(A,A,pe),this.inverseAdjustmentMatrix=r.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ad.scale([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=r.ad.invert(new Float64Array(16),this.projMatrix),u){let re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);re[8]=2*-s.x/this.width,re[9]=2*s.y/this.height,this.expandedFarZProjMatrix=r.ad.mul([],re,w)}else this.expandedFarZProjMatrix=this.projMatrix;let F=r.ad.invert([],I);this.frustumCorners=r.a_.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);let B=new Float32Array(16);r.ad.identity(B),r.ad.scale(B,B,[1,-1,1]),r.ad.rotateX(B,B,this._pitch),r.ad.rotateZ(B,B,this.angle);let U=r.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ad.clone(U);let $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-s.x/this.width,U[9]=2*(s.y+$)/this.height,this.skyboxMatrix=r.ad.multiply(B,U,B);let G=this.point,q=G.x,H=G.y,J=this.width%2/2,ee=this.height%2/2,te=Math.cos(this.angle),ue=Math.sin(this.angle),le=q-Math.round(q)+te*J+ue*ee,Q=H-Math.round(H)+te*ee+ue*J,ne=new Float64Array(L);if(r.ad.translate(ne,ne,[le>.5?le-1:le,Q>.5?Q-1:Q,0]),this.alignedProjMatrix=ne,L=r.ad.create(),r.ad.scale(L,L,[this.width/2,-this.height/2,1]),r.ad.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=r.ad.create(),r.ad.scale(L,L,[1,-1,1]),r.ad.translate(L,L,[-1,-1,0]),r.ad.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=r.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},L=r.ad.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.a$(this);let re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r._.transformMat4(re,re,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let s=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,u];r._.scale(x,x,v),r._.scale(g,g,-1),r._.multiply(g,g,x);let w=r.ad.create();r.ad.translate(w,w,g),r.ad.scale(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,u,v)}_computeCameraPosition(s){let u=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,s/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){let u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((u-g)/v,1)),this._camera.position=r._.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){let s=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=r.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ab(this._maxPitch)),I=Math.max((s[2]-x)/Math.cos(g),w),M=this._zoomFromMercatorZ(I);r._.scaleAndAdd(s,s,u,I),this._pitch=r.at(g,r.ab(this.minPitch),r.ab(this.maxPitch)),this.angle=r.au(v,-Math.PI,Math.PI),this._setZoom(r.at(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.Y(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){let s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let u=0,g=r.aU,v=0,x=1/0;for(;g-u>1e-6&&g>u;){let w=u+.5*(g-u),I=this.tileSize*Math.pow(2,w),M=this.getCameraToCenterDistance(this.projection,w,I),A=this.scaleZoom(M/(s*this.tileSize)),L=Math.abs(w-A);L<x&&(x=L,v=w),w<A?u=w:g=w}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,u){let g=Math.min(s.x,u.x),v=Math.max(s.x,u.x),x=Math.min(s.y,u.y),w=Math.max(s.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let I=[new r.P(g,x),new r.P(v,w),new r.P(g,w),new r.P(v,x)],M=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let L of I){let F=this.pointRayIntersection(L);if(F.t<0)return!0;let B=this.rayIntersectionCoordinate(F);if(B.x<M||B.y<0||B.x>A||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(s,u){let g=r._.length(r._.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let s=function([u,g,v],x){let w=[u,g,v,1];r.aA.transformMat4(w,w,x);let I=w[3]=Math.max(w[3],1e-6);return w[0]/=I,w[1]/=I,w[2]/=I,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(s[0],s[1])}{let s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,s))}}getCameraToCenterDistance(s,u=this.zoom,g=this.worldSize){let v=r.aX(s,u,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,g,v),w=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(w=ap(1,w,yr(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){let s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ad.multiply(s,s,this.globeMatrix),s}getFrustum(s){return r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}let fi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Xo=(p,s)=>{if(s>0&&p.terrain&&r.w("Cutoff is currently disabled on terrain"),s<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let u=p.transform,g=Math.max(Math.abs(u._zoom-(p.minCutoffZoom-1)),1),v=u.isLODDisabled(!1)?r.$(60,45,u.pitch):r.$(30,15,u.pitch),x=u._farZ-u._nearZ,w=s*u.height,I=((1-(M=v))*u.cameraToCenterDistance+M*(u._farZ+w))*g;var M;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(I-u._nearZ)/x,(I-w-u._nearZ)/x]}}},$r={cascadeCount:2,shadowMapResolution:2048};class lp{constructor(s,u){this.aabb=s,this.lastCascade=u}}class cp{add(s,u){let g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],u.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],u.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],u.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],u.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],u.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],u.max[2])):this.receivers[s.key]=new lp(u,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,u,g){let v=r.b6.fromPoints(s.points),x=0;for(let w in this.receivers){let I=this.receivers[w];if(!I||!v.intersectsAabb(I.aabb))continue;I.aabb.min=v.closestPoint(I.aabb.min),I.aabb.max=v.closestPoint(I.aabb.max);let M=I.aabb.getCorners();for(let A=0;A<g.length;A++){let L=!0;for(let F of M){let B=[F[0]*u,F[1]*u,F[2]];if(r._.transformMat4(B,B,g[A].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(I.lastCascade=A,x=Math.max(x,A),L)break}}return x+1}}class zh{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new cp,this._depthMode=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter($r,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter($r,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,u){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;let v=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce(($,G)=>{let q=g.style._mergedLayers[G];return $+(q.hasShadowPass()&&!q.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,w=$r.shadowMapResolution,I=$r.shadowMapResolution;if(this._cascades.length===0||$r.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<$r.cascadeCount;++$){let G=g._shadowMapDebug,q=x.gl,H=x.createFramebuffer(w,I,G,"texture"),J=new r.T(x,{width:w,height:I,data:null},q.DEPTH_COMPONENT);if(H.depthAttachment.set(J.texture),G){let ee=new r.T(x,{width:w,height:I,data:null},q.RGBA);H.colorAttachment.set(ee.texture)}this._cascades.push({framebuffer:H,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.aM,scale:0})}}this.shadowDirection=Jc(u);let M=0;if(s.elevation){let $=s.elevation,G=[1e4,-1e4];$.visibleDemTiles.filter(q=>q.dem).forEach(q=>{let H=q.dem.tree;G[0]=Math.min(G[0],H.minimums[0]),G[1]=Math.max(G[1],H.maximums[0])}),G[0]!==1e4&&(M=(G[1]-G[0])*$.exaggeration())}let A=1.5*s.cameraToCenterDistance,L=3*A,F=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){let G=this._cascades[$],q=s.height/50,H=1;$r.cascadeCount===1?H=L:$===0?H=A:(q=A,H=L);let[J,ee]=eu(s,this.shadowDirection,q,H,$r.shadowMapResolution,M);G.scale=s.scale,G.matrix=J,G.boundingSphereRadius=ee,r.ad.invert(F,G.matrix),G.frustum=r.aM.fromInvProjectionMatrix(F,1,0,!0),G.far=H}let B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/$r.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=$r.shadowMapResolution,this._uniformValues.u_shadowmap_0=fi.ShadowMap0,this._uniformValues.u_shadowmap_1=fi.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let U=g.transform.elevation;for(let $ of this._groundShadowTiles){let G={min:0,max:0};if(U){let q=U.getMinMaxForTile($);q&&(G=q)}this.addShadowReceiver($.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,u){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,$r.shadowMapResolution,$r.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:r.C.white,depth:1});for(let w of s.order){let I=s._mergedLayers[w];if(!I.hasShadowPass()||I.isHidden(g.transform.zoom))continue;let M=s.getLayerSourceCache(I),A=M?u[M.id]:void 0;(I.type==="model"||A&&A.length)&&g.renderLayer(g,M,I,A)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let s=this.painter,u=s.style,g=s.context,v=u.directionalLight,x=u.ambientLight;if(!v||!x)return;let w=[],I=Xo(s,s.longestCutoffRange);I.shouldRenderCutoff&&w.push("RENDER_CUTOFF");let M=Ko(u,v,x),A=new r.ae(g.gl.LEQUAL,r.ae.ReadOnly,s.depthRangeFor3D);for(let L of this._groundShadowTiles){let F=L.toUnwrapped(),B=s.isTileAffectedByFog(L),U=s.getOrCreateProgram("groundShadow",{defines:w,overrideFog:B});this.setupShadows(F,U),s.uploadCommonUniforms(g,U,F,null,I);let $={u_matrix:s.transform.calculateProjMatrix(F),u_ground_shadow_factor:M};U.draw(s,g.gl.TRIANGLES,A,r.ag.disabled,r.a.multiply,r.af.disabled,$,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){let u=this.painter.transform,g=u.calculatePosMatrix(s,u.worldSize);return r.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return r.ad.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,u,g,v=0){if(!this.enabled)return;let x=this.painter.transform,w=this.painter.context,I=w.gl,M=this._uniformValues,A=new Float64Array(16),L=x.calculatePosMatrix(s,x.worldSize);for(let F=0;F<this._cascades.length;F++)r.ad.multiply(A,this._cascades[F].matrix,L),M[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),w.activeTexture.set(I.TEXTURE0+fi.ShadowMap0+F),this._cascades[F].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let F=r.b5(s.canonical),B=2/x.tileSize*r.a3/$r.shadowMapResolution,U=B*this._cascades[0].boundingSphereRadius,$=B*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(g==="vector-tile"?1:3)/Math.pow(2,v-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));M.u_shadow_normal_offset=[F,U*G,$*G],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(w,M)}setupShadowsFromMatrix(s,u,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,w=this._uniformValues,I=new Float64Array(16);for(let M=0;M<$r.cascadeCount;M++)r.ad.multiply(I,this._cascades[M].matrix,s),w[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),v.activeTexture.set(x.TEXTURE0+fi.ShadowMap0+M),this._cascades[M].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(w.u_shadow_normal_offset=[1,5,5],w.u_shadow_bias=[6e-5,.0012,.012]):w.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(v,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,u,g,v){if(v[2]>=0)return{};let x=function(M,A,L){let F=L/(1<<M.canonical.z);return new r.b6([M.canonical.x*F+M.wrap*L,M.canonical.y*F+M.wrap*L,0],[(M.canonical.x+1)*F+M.wrap*L,(M.canonical.y+1)*F+M.wrap*L,A])}(s,u,g).getCorners(),w=u/-v[2];v[0]<0?(r._.add(x[0],x[0],[v[0]*w,0,0]),r._.add(x[3],x[3],[v[0]*w,0,0])):v[0]>0&&(r._.add(x[1],x[1],[v[0]*w,0,0]),r._.add(x[2],x[2],[v[0]*w,0,0])),v[1]<0?(r._.add(x[0],x[0],[0,v[1]*w,0]),r._.add(x[1],x[1],[0,v[1]*w,0])):v[1]>0&&(r._.add(x[2],x[2],[0,v[1]*w,0]),r._.add(x[3],x[3],[0,v[1]*w,0]));let I={};return I.vertices=x,I.planes=[El(x[1],x[0],x[4]),El(x[2],x[1],x[5]),El(x[3],x[2],x[6]),El(x[0],x[3],x[7])],I}addShadowReceiver(s,u,g){this._receivers.add(s,r.b6.fromTileIdAndHeight(s,u,g))}getMaxCascadeForTile(s){let u=this._receivers.get(s);return u&&u.lastCascade?u.lastCascade:0}}function El(p,s,u){let g=r._.sub([],u,s),v=r._.sub([],p,s),x=r._.cross([],g,v),w=r._.length(x);return w===0?[0,0,1,0]:(r._.scale(x,x,1/w),[x[0],x[1],x[2],-r._.dot(x,s)])}function Jc(p){let s=p.properties.get("direction"),u=r.ac(s.x,s.y,s.z);u[2]=r.at(u[2],0,75);let g=r.b7([u[0],u[1],u[2]]);return r._.fromValues(g.x,g.y,g.z)}function Ko(p,s,u){let g=s.properties.get("color"),v=s.properties.get("intensity"),x=s.properties.get("direction"),w=[x.x,x.y,x.z],I=u.properties.get("color"),M=u.properties.get("intensity"),A=Math.max(r._.dot([0,0,1],w),0),L=[0,0,0];r._.scale(L,I.toRenderColor(p.getLut(s.scope)).toArray01Linear().slice(0,3),M);let F=[0,0,0];return r._.scale(F,g.toRenderColor(p.getLut(u.scope)).toArray01Linear().slice(0,3),A*v),r.b8([L[0]>0?L[0]/(L[0]+F[0]):0,L[1]>0?L[1]/(L[1]+F[1]):0,L[2]>0?L[2]/(L[2]+F[2]):0])}function eu(p,s,u,g,v,x){let w=p.zoom,I=p.scale,M=p.worldSize,A=1/M,L=p.aspect,F=Math.sqrt(1+L*L)*Math.tan(.5*p.fovX),B=F*F,U=g-u,$=g+u,G,q;B>U/$?(G=g,q=g*F):(G=.5*$*(1+B),q=.5*Math.sqrt(U*U+2*(g*g+u*u)*B+$*$*B*B));let H=p.projection.pixelsPerMeter(p.center.lat,M),J=p._camera.getCameraToWorldMercator(),ee=[0,0,-G*A];r._.transformMat4(ee,ee,J);let te=q*A,ue=p._edgeInsets;if(!(ue.left===0&&ue.top===0&&ue.right===0&&ue.bottom===0||ue.left===ue.right&&ue.top===ue.bottom)){let et=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?H:1),it=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,u,g);it[8]=2*-p.centerOffset.x/p.width,it[9]=2*p.centerOffset.y/p.height;let nt=new Float64Array(16);r.ad.mul(nt,it,et);let ze=new Float64Array(16);r.ad.invert(ze,nt);let Ve=r.aM.fromInvProjectionMatrix(ze,M,w,!0);for(let tt of Ve.points){let ut=((le=tt)[0]/=I,le[1]/=I,le[2]=r.ax(le[2],p._center.lat),le);te=Math.max(te,r._.len(r._.subtract([],ee,ut)))}}var le;te*=v/(v-1);let Q=Math.acos(s[2]),ne=Math.atan2(-s[0],-s[1]),re=new Kc;re.position=ee,re.setPitchBearing(Q,ne);let pe=re.getWorldToCamera(M,H),Ee=te*M,se=Math.min(p._mercatorZfromZoom(17)*M*-2,-2*Ee),Te=re.getCameraToClipOrthographic(-Ee,Ee,-Ee,Ee,se,(Ee+x*H)/s[2]),Se=new Float64Array(16);r.ad.multiply(Se,Te,pe);let Be=r._.fromValues(Math.floor(1e6*ee[0])/1e6*M,Math.floor(1e6*ee[1])/1e6*M,0),Ue=.5*v,Ne=[0,0,0];r._.transformMat4(Ne,Be,Se),r._.scale(Ne,Ne,Ue);let ye=[Math.floor(Ne[0]),Math.floor(Ne[1]),Math.floor(Ne[2])],Ae=[0,0,0];r._.sub(Ae,Ne,ye),r._.scale(Ae,Ae,-1/Ue);let Le=new Float64Array(16);return r.ad.identity(Le),r.ad.translate(Le,Le,Ae),r.ad.multiply(Se,Le,Se),[Se,Ee]}function Bh(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}let Ta=new class{constructor(){this.operations={}}newMorphing(p,s,u,g,v){if(p in this.operations){let x=this.operations[p];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[p]={startTime:g,phase:0,duration:v,from:s,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;let s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(let s in this.operations){let u=this.operations[s];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},tu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function up(p,s,u){if(s===0)return 0;let g=s<1&&u===514?.25/s:1;return 6*Math.pow(1.5,22-p)*Math.max(s,1)*g}function f_(p,s){let u=1<<p.z;return!s&&(p.x===0||p.x===u-1)||p.y===0||p.y===u-1}let Uh=p=>({u_matrix:p});function Vh(p,s,u,g,v){if(v>0){let x=r.e.now(),w=(x-p.timeAdded)/v,I=s?(x-s.timeAdded)/v:-1,M=u.getSource(),A=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),L=!s||Math.abs(s.tileID.overscaledZ-A)>Math.abs(p.tileID.overscaledZ-A),F=L&&p.refreshedUponExpiration?1:r.at(L?w:1-I,0,1);return p.refreshedUponExpiration&&w>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Tl extends Yc{constructor(s,u,g,v){super(s,u,g,v),this.type="raster-array",this.maxzoom=22,this._options=r.W({type:"raster-array"},u)}triggerRepaint(s){let u=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);u&&u.enabled&&g&&u._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,u){let g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,r.R.Tile);s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(x,w,I,M)=>{if(delete s.request,s.aborted)return s.state="unloaded",u(null);if(x)return x.code===20?void 0:(s.state="errored",u(x));this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:I,expires:M}),s.state="empty",u(null)})}unloadTile(s,u){let g=s.texture;g&&g instanceof r.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,u,g){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(u,g,(v,x)=>{if(v)return s.state="errored",this.fire(new r.d(v)),void this.triggerRepaint(s);x&&(s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;let u=this.rasterLayers.find(({id:x})=>x===s),g=u&&u.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(s,u,g){if(!s)return;let v=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;u instanceof r.bk?x=u.paint.get("raster-array-band"):u instanceof r.bl&&(x=u.paint.get("raster-particle-array-band"));let w=x||this.getInitialBand(v);if(w!=null)if(s.textureDescriptor){if(!s.updateNeeded(v,w)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,w)}}let Gr={vector:Lh,raster:Yc,"raster-dem":class extends Yc{constructor(p,s,u,g){super(p,s,u,g),this.type="raster-dem",this.maxzoom=22,this._options=r.W({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){let u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(p.state="errored",s(v)),x&&(p.dem=x,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=r.h(this.map._requestManager.transformRequest(u,r.R.Tile),(function(v,x,w,I){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(v)p.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:w,expires:I});let M=ImageBitmap&&x instanceof ImageBitmap&&r.bi(),A=1-(x.width-r.bj(x.width))/2;A<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));let L=M?x:r.e.getImageData(x,A),F={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:A};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",F,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){let s=p.canonical,u=Math.pow(2,s.z),g=(s.x-1+u)%u,v=s.x===0?p.wrap-1:p.wrap,x=(s.x+1+u)%u,w=s.x+1===u?p.wrap+1:p.wrap,I={};return I[new r.aL(p.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},I[new r.aL(p.overscaledZ,w,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(I[new r.aL(p.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},I[new r.aL(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new r.aL(p.overscaledZ,w,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<u&&(I[new r.aL(p.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},I[new r.aL(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new r.aL(p.overscaledZ,w,s.z,x,s.y+1).key]={backfilled:!1}),I}},"raster-array":Tl,geojson:class extends r.E{constructor(p,s,u,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=s.data,this._options=r.W({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;let v=r.a3/this.tileSize;this.workerOptions=r.W({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:r.a3,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:r.a3,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){return this._options.dynamic?typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection")?this.fire(new r.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...p.features):this._data=p,this._updateWorkerData(!0),this):this.fire(new r.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterLeaves(p,s,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:s,offset:u},g),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.f("dataloading",{dataType:"source"})),this._loaded=!1;let s=r.W({append:p},this.workerOptions);s.scope=this.scope;let u=this._data;typeof u=="string"?(s.request=this.map._requestManager.transformRequest(r.e.resolveURL(u),r.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new r.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new r.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,s){let u=p.actor?"reloadTile":"loadTile";p.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};p.request=this.actor.send(u,x,(w,I)=>v&&!I?(p.state="loaded",s(null)):(delete p.request,p.destroy(),p.aborted?s(null):w?s(w):(p.loadVectorData(I,this.map.painter,u==="reloadTile"),s(null))),void 0,u==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,s){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.bm{constructor(p,s,u,g){super(p,s,u,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;let p=this.options;this.urls=[];for(let s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,r.R.Source).url);r.bn(this.urls,(s,u)=>{this._loaded=!0,s?this.fire(new r.d(s)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){let s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new r.d(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(p,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.bm,model:class extends r.E{constructor(p,s,u,g){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){let p=[];for(let s in this._options.models){let u=this._options.models[s],g=r.l(this.map._requestManager.transformRequest(u.uri,r.R.Model).url).then(v=>{if(!v)return;let x=r.c(v),w=new r.M(s,u.position,u.orientation,x);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(v=>{this.fire(new r.d(new Error(`Could not load model ${s} from ${u.uri}: ${v.message}`)))});p.push(g)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new r.d(new Error(`Could not load models: ${s.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,s){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(p,s,u,g){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=rp(this._options,this.map._requestManager,s,u,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.d(g))):v&&(r.W(this,v),v.bounds&&(this.tileBounds=new Zc(v.bounds,this.minzoom,this.maxzoom)),r.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),p&&p(g)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,s){let u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,r.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=s;else{if(p.buckets){let x=Object.values(p.buckets);for(let w of x)w.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",g,v.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,w){return p.aborted?s(null):x&&x.status!==404?s(x):(w&&(w.resourceTiming&&(p.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(w),p.buckets=xt(xt({},p.buckets),w.buckets),w.featureIndex&&(p.latestFeatureIndex=w.featureIndex)),p.state="loaded",void s(null))}}serialize(){return r.W({},this._options)}},canvas:class extends r.bm{constructor(p,s,u,g){super(p,s,u,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new r.d(new r.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.d(new r.V(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new r.d(new r.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new r.d(new r.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.d(new r.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let s=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.E{constructor(p,s,u,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zc(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),r.W(this,r.ah(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){let{x:s,y:u,z:g}=p.canonical;return this._implementation.hasTile({x:s,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){let{x:u,y:g,z:v}=p.tileID.canonical,x=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:v},{signal:x.signal})).then((function(w){return delete p.request,p.aborted?(p.state="unloaded",s(null)):w===void 0?(p.state="errored",s(null)):w===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(w)?(this.loadTileData(p,w),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(p.state="errored",s(w))}),p.request.cancel=()=>x.abort()}loadTileData(p,s){p.setTexture(s,this._map.painter)}unloadTile(p,s){if(p.texture&&p.texture instanceof r.T?(p.destroy(!0),p.texture&&p.texture instanceof r.T&&this._map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){let{x:u,y:g,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:v})}s&&s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){let p=r.al(this.id,this.scope);this._map.style.clearSource(p)}_update(){this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}}},jh=function(p,s,u,g){let v=new Gr[s.type](p,s,u,g);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return r.bp(["load","abort","unload","serialize","prepare"],v),v};class hp extends r.bv{constructor(s){let u={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new r.bw(r.bx(),null),v=jh("mock-dem",u,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,u){s.state="loaded",u(null)}}class p_ extends r.bv{constructor(s){let u=jh("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new r.bw(r.bx(),null),s.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,u,g){if(s.freezeTileCoverage)return;this.transform=s;let v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){let I=new r.by(w,this._source.tileSize*w.overscaleFactor(),s.tileZoom);I.state="loaded",this._tiles[w.key]=I}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){let u=this.proxyCachedFBO[s];if(u!==void 0){let g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dp extends r.aL{constructor(s,u,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class fp extends r.bq{constructor(s,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(M){let A=new r.bt,L=new r.bu,F=131;A.reserve(17161),L.reserve(33800);let B=r.a3/128,U=r.a3+B/2,$=U+B;for(let q=-B;q<$;q+=B)for(let H=-B;H<$;H+=B){let J=H<0||H>U||q<0||q>U?24575:0,ee=r.at(Math.round(H),0,r.a3),te=r.at(Math.round(q),0,r.a3);A.emplaceBack(ee+J,te)}let G=(q,H)=>{let J=H*F+q;L.emplaceBack(J+1,J,J+F),L.emplaceBack(J+F,J+F+1,J+1)};for(let q=1;q<129;q++)for(let H=1;H<129;H++)G(H,q);return[0,129].forEach(q=>{for(let H=0;H<130;H++)G(H,q),G(q,H)}),[A,L,32768]}(),w=s.context;this.gridBuffer=w.createVertexBuffer(g,r.br.members),this.gridIndexBuffer=w.createIndexBuffer(v),this.gridSegments=r.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=r.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new p_(u.map),this.orthoMatrix=r.ad.create(),r.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.a3,0,r.a3,0,1);let I=w.gl;this._overlapStencilMode=new r.ag({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new hp(u.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,u,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);let v=s.terrain.properties,x=s.terrain.drapeRenderMode===0,w=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.e.now();let I=s.terrain&&s.terrain.scope,M=v.get("source"),A=x?this._mockSourceCache:s.getSourceCache(M,I);if(!A)return void r.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=A,this._exaggeration=w?this.calculateExaggeration(u):v.get("exaggeration"),!u.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;let L=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(u,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(s){let u=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;let v=u!=null?g-u:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=s.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(x);let I=x-this._previousZoom,M=this._previousUpdateTimestamp,A=x;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(x-A)>.5&&(I=.5*(x-A+I)),I*v<0&&(A+=I)),this._evaluationZoom=A;let L=w.getExaggeration(A),F=L===w.getExaggeration(Math.max(0,A-.1));if(F&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-M));return(F||L<.1||Math.abs(I)<1e-4)&&(B=Math.min(.2,4*B)),r.a2(this._exaggeration,L,B)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(r.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=u.getIds().map(M=>{let A=u.getTileByID(M).tileID;return A.projMatrix=g.calculateProjMatrix(A.toUnwrapped()),A});(function(M,A){let L=A.transform.pointCoordinate(A.transform.getCameraPoint()),F=new r.P(L.x,L.y);M.sort((B,U)=>{if(U.overscaledZ-B.overscaledZ)return U.overscaledZ-B.overscaledZ;let $=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),G=new r.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),q=F.mult(1<<B.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr($)-q.distSqr(G)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};let w=this._style._mergedSourceCaches;for(let M in w){let A=w[M];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,s[M],x),A.usedForTerrain))continue;let L=s[M];A.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[u.id]=v.map(M=>new dp(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let I={};this._visibleDemTiles=[];for(let M of this.proxyCoords){let A=this.terrainTileForTile[M.key];if(!A)continue;let L=A.tileID.key;L in I||(this._visibleDemTiles.push(A),I[L]=L)}}_assignTerrainTiles(s){this._initializing||s.forEach(u=>{if(this.terrainTileForTile[u.key])return;let g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){let s=this.painter.context,u=s.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(u.TEXTURE1),np(this.painter,v,x))}}_prepareDemTileUniforms(s,u,g,v){if(!u||u.demTexture==null)return!1;let x=s.tileID.canonical,w=Math.pow(2,u.tileID.canonical.z-x.z),I=v||"";return g[`u_dem_tl${I}`]=[x.x*w%1,x.y*w%1],g[`u_dem_scale${I}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let s=this.painter.context,u=s.gl;if(!this._emptyDepthBufferTexture){let g=new r.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(s,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0,u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&s++,g+x},0);return s?u/s:0}_updateEmptyDEMTexture(){let s=this.painter.context,u=s.gl;s.activeTexture.set(u.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let I=new r.bz({width:1,height:1},new Float32Array([g]));return[u.R32F,I]})();this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new r.T(s,x,v,{premultiply:!1}),w}setupElevationDraw(s,u,g){let v=this.painter.context,x=v.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};w.u_exaggeration=this.exaggeration();let I=null,M=null,A=1;if(g&&g.morphing&&this._useVertexMorphing){let U=g.morphing.srcDemTile,$=g.morphing.dstDemTile;A=g.morphing.phase,U&&$&&(this._prepareDemTileUniforms(s,U,w,"_prev")&&(M=U),this._prepareDemTileUniforms(s,$,w)&&(I=$))}let L=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,F=null;var B;if(this.enabled?M&&I?(F=I.demTexture,v.activeTexture.set(x.TEXTURE4),M.demTexture.bind(L(M),x.CLAMP_TO_EDGE),w.u_dem_lerp=A):(I=this.terrainTileForTile[s.tileID.key],F=this._prepareDemTileUniforms(s,I,w)?I.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),F&&(w.u_dem_size=(B=F).size[0]===1?1:B.size[0]-2,F.bind(L(I),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&I){let U=(1<<I.tileID.canonical.z)*r.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=U}if(g&&g.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,w),this.painter.transform.projection.name==="globe"){let U=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(v,U)}}globeUniformValues(s,u,g){let v=s.projection;return{u_tile_tl_up:v.upVector(u,0,0),u_tile_tr_up:v.upVector(u,r.a3,0),u_tile_br_up:v.upVector(u,r.a3,r.a3),u_tile_bl_up:v.upVector(u,0,r.a3),u_tile_up_scale:g?r.bs(1):v.upVectorScale(u,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){let u=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,w,I,M){if(v.transform.projection.name==="globe")(function(A,L,F,B,U){let $=A.context,G=$.gl,q,H,J=A.transform,ee=r.ba(A,$,J),te=(Te,Se)=>{if(H===Se)return;let Be=[tu[Se],"PROJECTION_GLOBE_VIEW"];ee&&Be.push("CUSTOM_ANTIALIASING");let Ue=A.isTileAffectedByFog(Te);q=A.getOrCreateProgram("globeRaster",{defines:Be,overrideFog:Ue}),H=Se},ue=A.colorModeForRenderPass(),le=new r.ae(G.LEQUAL,r.ae.ReadWrite,A.depthRangeFor3D);Ta.update(U);let Q=r.bb(J),ne=[r.aj(J.center.lng),r.ak(J.center.lat)],re=A.globeSharedBuffers,pe=[J.width*r.e.devicePixelRatio,J.height*r.e.devicePixelRatio],Ee=Float32Array.from(J.globeMatrix),se={useDenormalizedUpVectorScale:!0};{let Te=A.transform,Se=up(Te.zoom,L.exaggeration(),L.sourceCache._source.tileSize);H=-1;let Be=G.TRIANGLES;for(let Ue of B){let Ne=F.getTile(Ue),ye=r.ag.disabled,Ae=L.prevTerrainTileForTile[Ue.key],Le=L.terrainTileForTile[Ue.key];Bh(Ae,Le)&&Ta.newMorphing(Ue.key,Ae,Le,U,250),$.activeTexture.set(G.TEXTURE0),Ne.texture&&Ne.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let et=Ta.getMorphValuesForProxy(Ue.key),it=et?1:0;et&&r.o(se,{morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:r.b9(et.phase)}});let nt=r.bc(Ue.canonical),ze=r.bd(nt.getCenter().lat),Ve=r.be(Ue.canonical,nt,ze,Te.worldSize/Te._pixelsPerMercatorPixel),tt=r.bf(r.bg(Ue.canonical)),ut=h_(Te.expandedFarZProjMatrix,Ee,Q,tt,r.a1(Te.zoom),ne,Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.globeCenterInViewSpace,Te.globeRadius,pe,Se,Te._farZ,Ve);if(te(Ue,it),q&&(L.setupElevationDraw(Ne,q,se),A.uploadCommonUniforms($,q,Ue.toUnwrapped()),re)){let[At,Bt,on]=re.getGridBuffers(ze,Se!==0);q.draw(A,Be,le,ye,ue,r.af.backCCW,ut,"globe_raster",At,Bt,on)}}}if(re&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){let Te=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&Te.push("CUSTOM_ANTIALIASING"),q=A.getOrCreateProgram("globeRaster",{defines:Te});for(let Se of B){let{x:Be,y:Ue,z:Ne}=Se.canonical,ye=Ue===0,Ae=Ue===(1<<Ne)-1,[Le,et,it,nt]=re.getPoleBuffers(Ne,!1);if(nt&&(ye||Ae)){let ze=F.getTile(Se);$.activeTexture.set(G.TEXTURE0),ze.texture&&ze.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let Ve=r.bh(Ne,Be,J),tt=r.bf(r.bg(Se.canonical)),ut=(At,Bt)=>At.draw(A,G.TRIANGLES,le,r.ag.disabled,ue,r.af.disabled,h_(J.expandedFarZProjMatrix,Ve,Ve,tt,0,ne,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,pe,0,J._farZ),"globe_pole_raster",Bt,it,nt);L.setupElevationDraw(ze,q,se),A.uploadCommonUniforms($,q,Se.toUnwrapped()),ye&&A.renderDefaultNorthPole&&ut(q,Le),Ae&&A.renderDefaultSouthPole&&(Ve=r.ad.scale(r.ad.create(),Ve,[1,-1,1]),ut(q,et))}}}})(v,x,w,I,M);else{let A=v.context,L=A.gl,F,B,U=v.shadowRenderer,$=Xo(v,v.longestCutoffRange),G=ue=>{if(B===ue)return;let le=[];le.push(tu[ue]),$.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),F=v.getOrCreateProgram("terrainRaster",{defines:le}),B=ue},q=v.colorModeForRenderPass(),H=new r.ae(L.LEQUAL,r.ae.ReadWrite,v.depthRangeFor3D);Ta.update(M);let J=v.transform,ee=up(J.zoom,x.exaggeration(),x.sourceCache._source.tileSize),te=[0,0,0];if(U){let ue=v.style.directionalLight,le=v.style.ambientLight;ue&&le&&(te=Ko(v.style,ue,le))}{B=-1;let ue=L.TRIANGLES,[le,Q]=[x.gridIndexBuffer,x.gridSegments];for(let ne of I){let re=w.getTile(ne),pe=r.ag.disabled,Ee=x.prevTerrainTileForTile[ne.key],se=x.terrainTileForTile[ne.key];Bh(Ee,se)&&Ta.newMorphing(ne.key,Ee,se,M,250),A.activeTexture.set(L.TEXTURE0),re.texture&&re.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);let Te=Ta.getMorphValuesForProxy(ne.key),Se=Te?1:0,Be;Te&&(Be={morphing:{srcDemTile:Te.from,dstDemTile:Te.to,phase:r.b9(Te.phase)}});let Ue=rt(ne.projMatrix,f_(ne.canonical,J.renderWorldCopies)?ee/10:ee,te);if(G(Se),!F)continue;x.setupElevationDraw(re,F,Be);let Ne=ne.toUnwrapped();U&&U.setupShadows(Ne,F),v.uploadCommonUniforms(A,F,Ne,null,$),F.draw(v,ue,H,pe,q,r.af.backCCW,Ue,"terrain_raster",x.gridBuffer,le,Q)}}}}(u,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;let u=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],w=this._drapedRenderBatches.shift(),I=u.style.order,M=[],A=0;for(let L of x){let F=v.getTileByID(L.proxyTileKey),B=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][s]:void 0,U=B!==void 0?v.renderCache[B]:this.pool[A++],$=B!==void 0;if(F.texture=U.tex,$&&!U.dirty){M.push(F.tileID);continue}let G;g.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(g.clear({color:r.C.transparent,stencil:0}),U.dirty=!1);for(let q=w.start;q<=w.end;++q){let H=u.style._mergedLayers[I[q]];if(H.isHidden(u.transform.zoom))continue;let J=u.style.getLayerSourceCache(H),ee=J?this.proxyToSource[L.key][J.id]:[L];if(!ee)continue;let te=ee;g.viewport.set([0,0,U.fb.width,U.fb.height]),G!==(J?J.id:null)&&(this._setupStencil(U,ee,H,J),G=J?J.id:null),u.renderLayer(u,J,H,te)}if(this._drapedRenderBatches.length===0)for(let q of this._pendingGroundEffectLayers){let H=u.style._mergedLayers[I[q]];if(H.isHidden(u.transform.zoom))continue;let J=u.style.getLayerSourceCache(H),ee=J?this.proxyToSource[L.key][J.id]:[L];if(!ee)continue;let te=ee;g.viewport.set([0,0,U.fb.width,U.fb.height]),G!==(J?J.id:null)&&(this._setupStencil(U,ee,H,J),G=J?J.id:null),u.renderLayer(u,J,H,te)}this.renderedToTile?(U.dirty=!0,M.push(F.tileID)):$||--A,A===5&&(A=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),w.end+1}postRender(){}isLayerOrderingCorrect(s){let u=s.order.length,g=-1,v=u;for(let x=0;x<u;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{s=Math.min(s,u.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,u,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let w=x.tileID,I=1<<w.overscaledZ,{x:M,y:A}=w.canonical,L=M/I,F=(M+1)/I,B=A/I,U=(A+1)/I;return{minx:L,miny:B,maxx:F,maxy:U,t:x.dem.tree.raycastRoot(L,B,F,U,s,u,g),tile:x}});v.sort((x,w)=>(x.t!==null?x.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,u,g);if(w!=null)return w}return null}_createFBO(){let s=this.painter.context,u=s.gl,g=this.drapeBufferSize;s.activeTexture.set(u.TEXTURE0);let v=new r.T(s,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);let x=s.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new ga(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{let u=this._style._mergedLayers[s],g=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!g&&u.shouldRedrape():!g&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(let g of this._style.getSources())if(g instanceof Lh){s=!0;break}if(!s)return;let u={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!u[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.Z){u[x.id]=!0;for(let w of this.proxyCoords){let I=this.proxyToSource[w.key][x.id];if(I)for(let M of I)this._clearRenderCacheForTile(x.id,M)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Yc){s=!0;break}if(!s)return;let u={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||u[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let w=v.paint.get("raster-fade-duration");for(let I of this.proxyCoords){let M=this.proxyToSource[I.key][x.id];if(M)for(let A of M){let L=Vh(x.getTile(A),x.findLoadedParent(A,0),x,this.painter.transform,w);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,A)}}}}_setupDrapedRenderBatches(){let s=this._style.order,u=s.length;if(u===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,w=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<u;)w=this._style._mergedLayers[s[x]];for(;x<u;++x){let I=this._style._mergedLayers[s[x]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=x):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let I=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>I.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){let u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){let w=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let I=0;I<w.length;++I){let M=Object.values(w[I]);u.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let w=g.length-1;w>=0;w--){let I=g[w];if(u.getTileByID(I.key),u.proxyCachedFBO[I.key]!==void 0){let M=s[I.key],A=this.proxyToSource[I.key],L=0;for(let F in A){let B=A[F],U=M[F];if(!U||U.length!==B.length||B.some(($,G)=>$!==U[G]||v[F]&&v[F].hasOwnProperty($.key))){L=-1;break}++L}for(let F in u.proxyCachedFBO[I.key])u.renderCache[u.proxyCachedFBO[I.key][F]].dirty=L<0||L!==Object.values(M).length}}let x=[...this._drapedRenderBatches];x.sort((w,I)=>I.end-I.start-(w.end-w.start));for(let w of x)for(let I of g){if(u.proxyCachedFBO[I.key])continue;let M=u.renderCachePool.pop();M===void 0&&u.renderCache.length<50&&(M=u.renderCache.length,u.renderCache.push(this._createFBO())),M!==void 0&&(u.proxyCachedFBO[I.key]={},u.proxyCachedFBO[I.key][w.start]=M,u.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(s,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,w=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=u.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):r.ag.disabled}_renderTileClippingMasks(s,u){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let w=g.getOrCreateProgram("clippingMask");for(let I of s){let M=g._tileClippingMaskIDs[I.key]=--u;w.draw(g,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,Uh(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){let u=this.painter.transform;if(s.x<0||s.x>u.width||s.y<0||s.y>u.height)return null;let g=[s.x,s.y,1,1];r.aA.transformMat4(g,g,u.pixelMatrixInverse),r.aA.scale(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;let v=u._camera.position,x=r.ax(1,u.center.lat),w=[v[0],v[1],v[2]/x,0],I=r._.subtract([],g.slice(0,3),w);r._.normalize(I,I);let M=this.raycast(w,I,this._exaggeration);return M!==null&&M?(r._.scaleAndAdd(w,w,I,M),w[3]=w[2],w[2]*=x,w):null}drawDepth(){let s=this.painter,u=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let w=u.gl,I=u.createFramebuffer(v,x,!0,"renderbuffer");u.activeTexture.set(w.TEXTURE0);let M=new r.T(u,{width:v,height:x,data:null},w.RGBA);M.bind(w.NEAREST,w.CLAMP_TO_EDGE),I.colorAttachment.set(M.texture);let A=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,x);I.depthAttachment.set(A),this._depthFBO=I,this._depthTexture=M}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,x]),function(w,I,M,A){if(w.transform.projection.name==="globe")return;let L=w.context,F=L.gl;L.clear({depth:1});let B=w.getOrCreateProgram("terrainDepth"),U=new r.ae(F.LESS,r.ae.ReadWrite,w.depthRangeFor3D);for(let $ of A){let G=M.getTile($),q=rt($.projMatrix,0,[0,0,0]);I.setupElevationDraw(G,B),B.draw(w,F.TRIANGLES,U,r.ag.disabled,r.a.unblended,r.af.backCCW,q,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,u,g){if(s.getSource()instanceof r.bm)return this._setupProxiedCoordsForImageSource(s,u,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let M=0;M<x.length;M++){let A=x[M],L=this._findTileCoveringTileID(A,s);if(L){let F=this._createProxiedId(A,L,g[A.key]&&g[A.key][s.id]);v.push(F),this.proxyToSource[A.key][s.id]=[F]}}let w=!1,I=new Set;for(let M=0;M<u.length;M++){let A=s.getTile(u[M]);if(!A||!A.hasData())continue;let L=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==A.tileID.canonical.z){let F=this.proxyToSource[L.tileID.key][s.id],B=this._createProxiedId(L.tileID,A,g[L.tileID.key]&&g[L.tileID.key][s.id]);F?F.splice(F.length-1,0,B):this.proxyToSource[L.tileID.key][s.id]=[B];let U=this.proxyToSource[L.tileID.key][s.id];I.has(U)||I.add(U),v.push(B),w=!0}}if(this._sourceTilesOverlap[s.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(let M of I)M.sort((A,L)=>L.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(s,u,g){if(!s.getSource().loaded())return;let v=this.proxiedCoords[s.id]=[],x=this.proxyCoords,w=s.getSource(),I=w.tileID;if(!I)return;let M=new r.P(I.x,I.y)._div(1<<I.z),A=w.coordinates.map(r.Y.fromLngLat).reduce((F,B)=>(F.min.x=Math.min(F.min.x,B.x-M.x),F.min.y=Math.min(F.min.y,B.y-M.y),F.max.x=Math.max(F.max.x,B.x-M.x),F.max.y=Math.max(F.max.y,B.y-M.y),F),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(F,B)=>{let U=F.wrap+F.canonical.x/(1<<F.canonical.z),$=F.canonical.y/(1<<F.canonical.z),G=r.a3/(1<<F.canonical.z),q=B.wrap+B.canonical.x/(1<<B.canonical.z),H=B.canonical.y/(1<<B.canonical.z);return U+G<q+A.min.x||U>q+A.max.x||$+G<H+A.min.y||$>H+A.max.y};for(let F=0;F<x.length;F++){let B=x[F];for(let U=0;U<u.length;U++){let $=s.getTile(u[U]);if(!$||!$.hasData()||L(B,$.tileID))continue;let G=this._createProxiedId(B,$,g[B.key]&&g[B.key][s.id]),q=this.proxyToSource[B.key][s.id];q?q.push(G):this.proxyToSource[B.key][s.id]=[G],v.push(G)}}}_createProxiedId(s,u,g){let v=this.orthoMatrix;if(g){let x=g.find(w=>w.key===u.tileID.key);if(x)return x}if(u.tileID.key!==s.key){let x=s.canonical.z-u.tileID.canonical.z,w,I,M;v=r.ad.create();let A=u.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(w=r.a3>>x,I=w*((u.tileID.canonical.x<<x)-s.canonical.x+A),M=w*((u.tileID.canonical.y<<x)-s.canonical.y)):(w=r.a3<<-x,I=r.a3*(u.tileID.canonical.x-(s.canonical.x+A<<-x)),M=r.a3*(u.tileID.canonical.y-(s.canonical.y<<-x))),r.ad.ortho(v,0,w,0,w,0,1),r.ad.translate(v,v,[I,M,0])}return new dp(u.tileID,s.key,v)}_findTileCoveringTileID(s,u){let g=u.getTile(s);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[u.id],x=v[s.key];if(g=x?u.getTileByID(x):null,g&&g.hasData()||x===null)return g;let w=g?g.tileID:s,I=w.overscaledZ,M=u.getSource().minzoom,A=[];if(!x){let F=u.getSource().maxzoom;if(s.canonical.z>=F){let B=s.canonical.z-F;u.getSource().reparseOverscaled?(I=Math.max(s.canonical.z+2,u.transform.tileZoom),w=new r.aL(I,s.wrap,F,s.canonical.x>>B,s.canonical.y>>B)):B!==0&&(I=F,w=new r.aL(I,s.wrap,F,s.canonical.x>>B,s.canonical.y>>B))}w.key!==s.key&&(A.push(w.key),g=u.getTile(w))}let L=F=>{A.forEach(B=>{v[B]=F}),A.length=0};for(I-=1;I>=M&&(!g||!g.hasData());I--){g&&L(g.tileID.key);let F=w.calculateScaledKey(I);if(g=u.getTileByID(F),g&&g.hasData())break;let B=v[F];if(B===null)break;B===void 0?A.push(F):g=u.getTileByID(B)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,u){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[u.key]=!0}}function Qo(p,s,u){let g=function(I,M,A){let L=r._.dot(M,I),F=r._.dot(A,[.2126,.7152,.0722]),B=($,G,q)=>(1-q)*$+q*G,U=B(1-.3*Math.min(F,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(r.at(M[2],-1,1))/Math.PI+.5)*U}(p,[0,0,1],s),v=[0,0,0];r._.scale(v,u.slice(0,3),g);let x=[0,0,0];r._.scale(x,s.slice(0,3),p[2]);let w=[0,0,0];return r._.add(w,v,x),r.b8(w)}let $h=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],m_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class nu{static cacheKey(s,u,g,v){let x=`${u}${v?v.cacheKey:""}`;for(let w of g)s.usedDefines.includes(w)&&(x+=`/${w}`);return x}constructor(s,u,g,v,x,w){let I=s.gl;this.program=I.createProgram(),this.configuration=v,this.name=u,this.fixedDefines=[...w];let M=v?v.getBinderAttributes():[],A=(g.staticAttributes||[]).concat(M),L=v?v.defines():[];L=L.concat(w.map(q=>`#define ${q}`));let F=`#version 300 es
`,B=F+L.concat("precision mediump float;",c_,l_.fragmentSource).join(`
`);for(let q of g.fragmentIncludes)B+=`
${Rh[q]}`;B+=`
${g.fragmentSource}`;let U=F+L.concat("precision highp float;",c_,l_.vertexSource).join(`
`);for(let q of g.vertexIncludes)U+=`
${Rh[q]}`;U+=`
${g.vertexSource}`;let $=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource($,B),I.compileShader($),I.attachShader(this.program,$);let G=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(G,U),I.compileShader(G),I.attachShader(this.program,G),this.attributes={},this.numAttributes=A.length;for(let q=0;q<this.numAttributes;q++)if(A[q]){let H=A[q].startsWith("a_")?A[q]:`a_${A[q]}`;I.bindAttribLocation(this.program,q,H),this.attributes[H]=q}I.linkProgram(this.program),I.deleteShader(G),I.deleteShader($),this.fixedUniforms=x(s),this.binderUniforms=v?v.getUniforms(s):[],w.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new r.a7(q),u_dem_prev:new r.a7(q),u_dem_tl:new r.a8(q),u_dem_scale:new r.aa(q),u_dem_tl_prev:new r.a8(q),u_dem_scale_prev:new r.aa(q),u_dem_size:new r.aa(q),u_dem_lerp:new r.aa(q),u_exaggeration:new r.aa(q),u_depth:new r.a7(q),u_depth_size_inv:new r.a8(q),u_meter_to_dem:new r.aa(q),u_label_plane_matrix_inv:new r.a6(q)}))(s)),w.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new r.aq(q),u_tile_tr_up:new r.aq(q),u_tile_br_up:new r.aq(q),u_tile_bl_up:new r.aq(q),u_tile_up_scale:new r.aa(q)}))(s)),w.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new r.a6(q),u_fog_range:new r.a8(q),u_fog_color:new r.as(q),u_fog_horizon_blend:new r.aa(q),u_fog_vertical_limit:new r.a8(q),u_fog_temporal_offset:new r.aa(q),u_frustum_tl:new r.aq(q),u_frustum_tr:new r.aq(q),u_frustum_br:new r.aq(q),u_frustum_bl:new r.aq(q),u_globe_pos:new r.aq(q),u_globe_radius:new r.aa(q),u_globe_transition:new r.aa(q),u_is_globe:new r.a7(q),u_viewport:new r.a8(q)}))(s)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new r.as(q)}))(s)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new r.aq(q),u_lighting_directional_dir:new r.aq(q),u_lighting_directional_color:new r.aq(q),u_ground_radiance:new r.aq(q)}))(s)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new r.a6(q),u_light_matrix_1:new r.a6(q),u_fade_range:new r.a8(q),u_shadow_normal_offset:new r.aq(q),u_shadow_intensity:new r.aa(q),u_shadow_texel_size:new r.aa(q),u_shadow_map_resolution:new r.aa(q),u_shadow_direction:new r.aq(q),u_shadow_bias:new r.aq(q),u_shadowmap_0:new r.a7(q),u_shadowmap_1:new r.a7(q)}))(s))}}setTerrainUniformValues(s,u){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in u)g[v]&&g[v].set(this.program,v,u[v])}}setGlobeUniformValues(s,u){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in u)g[v]&&g[v].set(this.program,v,u[v])}}setFogUniformValues(s,u){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in u)g[v].set(this.program,v,u[v])}}setCutoffUniformValues(s,u){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in u)g[v].set(this.program,v,u[v])}}setLightsUniformValues(s,u){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(let v in u)g[v].set(this.program,v,u[v])}}setShadowUniformValues(s,u){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;s.program.set(this.program);for(let v in u)g[v].set(this.program,v,u[v])}_drawDebugWireframe(s,u,g,v,x,w,I,M,A,L){let F=s.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let B=s.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||s._terrain&&s._terrain.renderingToTexture||!$h.includes(this.name))||!(!F.layers3D||!m_.includes(this.name))))return;let U=B.gl,$=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,B);if(!$)return;let G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");let q=s.getOrCreateProgram(this.name,{config:this.configuration,defines:G});B.program.set(q.program);let H=(te,ue,le)=>{if(ue[te]&&le[te])for(let Q in ue[te])le[te][Q]&&le[te][Q].set(le.program,Q,ue[te][Q].current)};A&&A.setUniforms(q.program,B,q.binderUniforms,I,{zoom:M}),H("fixedUniforms",this,q),H("terrainUniforms",this,q),H("globeUniforms",this,q),H("fogUniforms",this,q),H("lightsUniforms",this,q),H("shadowUniforms",this,q),$.bind(),B.setColorMode(new r.a([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],r.C.transparent,[!0,!0,!0,!1])),B.setDepthMode(new r.ae(u.func===U.LESS?U.LEQUAL:u.func,r.ae.ReadOnly,u.range)),B.setStencilMode(r.ag.disabled);let J=3*w.primitiveLength*2,ee=3*w.primitiveOffset*2*2;L&&L>1?U.drawElementsInstanced(U.LINES,J,U.UNSIGNED_SHORT,ee,L):U.drawElements(U.LINES,J,U.UNSIGNED_SHORT,ee),x.bind(),B.program.set(this.program),B.setDepthMode(u),B.setStencilMode(g),B.setColorMode(v)}draw(s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q){let H=s.context,J=H.gl;if(this.failedToCreate)return;H.program.set(this.program),H.setDepthMode(g),H.setStencilMode(v),H.setColorMode(x),H.setCullFace(w);for(let ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,I[ue]);$&&$.setUniforms(this.program,H,this.binderUniforms,B,{zoom:U});let ee={[J.POINTS]:1,[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[u],te=q&&q>0?1:void 0;for(let ue of F.get()){let le=ue.vaos||(ue.vaos={});(le[M]||(le[M]=new t1)).bind(H,this,A,$?$.getPaintVertexBuffers():[],L,ue.vertexOffset,G||[],te),q&&q>1?J.drawElementsInstanced(u,ue.primitiveLength*ee,J.UNSIGNED_SHORT,ue.primitiveOffset*ee*2,q):L?J.drawElements(u,ue.primitiveLength*ee,J.UNSIGNED_SHORT,ue.primitiveOffset*ee*2):J.drawArrays(u,ue.vertexOffset,ue.vertexLength),u===J.TRIANGLES&&L&&this._drawDebugWireframe(s,g,v,x,L,ue,B,U,$,q)}}}function Gh(p,s){let u=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,p.transform.tileZoom)/u,v=g*(s.tileID.canonical.x+s.tileID.wrap*u),x=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.bB(s,1,p.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let qh=r.ad.create(),Il=(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G)=>{let q=s.style.light,H=q.properties.get("position"),J=[H.x,H.y,H.z],ee=r.bC.create();q.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(ee,-s.transform.angle),r._.transformMat3(J,J,ee));let te=q.properties.get("color"),ue=s.transform,le={u_matrix:p,u_lightpos:J,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:F,u_vertical_scale:B,u_flood_light_intensity:U,u_ground_shadow_factor:$,u_emissive_strength:G};return ue.projection.name==="globe"&&(le.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],le.u_zoom_transition=M,le.u_inv_rot_matrix=L,le.u_merc_center=A,le.u_up_dir=ue.projection.upVector(new r.aO(0,0,0),A[0]*r.a3,A[1]*r.a3),le.u_height_lift=I),le},Dl=(p,s,u)=>({u_matrix:p,u_edge_radius:s,u_vertical_scale:u}),pp=(p,s,u,g,v,x,w,I,M,A,L,F,B,U)=>{let $=Il(p,s,u,g,v,x,w,M,A,L,F,B,U,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,w.overscaledZ)/I.tileSize/8};return r.W($,Gh(s,I),G)},mp=(p,s)=>({u_matrix:p,u_emissive_strength:s}),gp=(p,s,u,g)=>r.W(mp(p,s),Gh(u,g)),g_=(p,s,u)=>({u_matrix:p,u_world:u,u_emissive_strength:s}),Hh=(p,s,u,g,v)=>r.W(gp(p,s,u,g),{u_world:v}),_p=(p,s,u,g)=>{let v=r.a3/u.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},Wh=(p,s,u=1)=>({u_matrix:p,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:u}),ru=r.ad.create(),Ia=(p,s,u,g,v,x,w)=>{let I=p.transform,M=I.projection.name==="globe",A=M?r.bD(I.zoom,s.canonical)*I._pixelsPerMercatorPixel:r.bB(u,1,x),L={u_matrix:s.projMatrix,u_extrude_scale:A,u_intensity:w,u_inv_rot_matrix:ru,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){L.u_inv_rot_matrix=g,L.u_merc_center=v,L.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],L.u_zoom_transition=r.a1(I.zoom);let F=v[0]*r.a3,B=v[1]*r.a3;L.u_up_dir=I.projection.upVector(new r.aO(0,0,0),F,B)}return L};function __(p,[s,u,g,v],[x,w]){if(x===w)return[0,0,0,0];let I=255*(p-1)/(p*(w-x));return[s*I,u*I,g*I,v*I]}function yp(p,s,[u,g]){return u===g?0:.5/p+(s-u)*(p-1)/(p*(g-u))}let iu=(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q,H,J,ee,te)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:r.bE(F.paint.get("raster-saturation")),u_contrast_factor:r.bF(F.paint.get("raster-contrast")),u_spin_weights:ou(F.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:U,u_zoom_transition:w,u_merc_center:I,u_cutoff_params:M,u_colorization_mix:__(r.bG,G,H),u_colorization_offset:yp(r.bG,q,H),u_color_ramp:$,u_texture_offset:[ee/(J+2*ee),J/(J+2*ee)],u_texture_res:[J+2*ee,J+2*ee],u_emissive_strength:te});function ou(p){p*=Math.PI/180;let s=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}let Os=.15,vp=(p,s,u,g,v,x,w,I,M,A,L,F)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:u,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:w,u_merc_center:I,u_cutoff_params:M}),xp=(p,s,u,g,v,x,w,I,M,A)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_tile_offset:u,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:w,u_uv_offset:I,u_data_scale:M,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Os,Os]}),o1=(p,s,u,g,v,x,w,I,M,A)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_velocity:u,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:M,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Os,Os]}),uo=r.ad.create(),Sl=(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q,H)=>{let J=v.transform,ee={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:J.getCameraToCenterDistance(G),u_rotate_symbol:+u,u_aspect_ratio:J.width/J.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+g,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:uo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:uo,u_up_vector:[0,-1,0],u_color_adj_mat:q,u_icon_transition:H||0};return G.name==="globe"&&(ee.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],ee.u_zoom_transition=F,ee.u_inv_rot_matrix=U,ee.u_merc_center=B,ee.u_camera_forward=J._camera.forward(),ee.u_ecef_origin=r.bH(J.globeMatrix,L.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(J.globeMatrix),ee.u_up_vector=$),ee},Zh=(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q)=>r.W(Sl(p,s,u,g,v,x,w,I,M,A,F,B,U,$,G,q),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(q)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.e.devicePixelRatio,u_is_halo:+L,undefined:void 0}),y_=(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G)=>r.W(Zh(p,s,u,g,v,x,w,I,!0,M,!0,L,F,B,U,$,G),{u_texsize_icon:A,u_texture_icon:1}),su=(p,s,u,g)=>({u_matrix:p,u_emissive_strength:s,u_opacity:u,u_color:g}),v_=(p,s,u,g,v,x,w,I)=>r.W(function(M,A,L,F,B){let{width:U,height:$}=F.imageManager.getPixelSize(A),G=Math.pow(2,B.tileID.overscaledZ),q=B.tileSize*Math.pow(2,F.transform.tileZoom)/G,H=q*(B.tileID.canonical.x+B.tileID.wrap*G),J=q*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[U,$],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/r.bB(B,1,F.transform.tileZoom),u_pixel_coord_upper:[H>>16,J>>16],u_pixel_coord_lower:[65535&H,65535&J]}}(0,x,w,g,I),{u_matrix:p,u_emissive_strength:s,u_opacity:u}),bp=new Float32Array(r.ad.identity([])),au=(p,s,u,g,v,x,w,I,M,A,L,F,B,U=[0,0,0],$)=>{let G=v.style.light,q=G.properties.get("position"),H=[-q.x,-q.y,q.z],J=r.bC.create();G.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(J,-v.transform.angle),r._.transformMat3(H,H,J));let ee=L.alphaMode==="MASK",te=G.properties.get("color").toRenderColor(null),ue=B.paint.get("model-ambient-occlusion-intensity"),le=B.paint.get("model-color").constantOr(r.C.white).toRenderColor(null),Q=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:s,u_normal_matrix:u,u_node_matrix:g||bp,u_lightpos:H,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_camera_pos:U,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ee,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:M,u_roughnessFactor:A,u_baseColorTexture:fi.BaseColor,u_metallicRoughnessTexture:fi.MetallicRoughness,u_normalTexture:fi.Normal,u_occlusionTexture:fi.Occlusion,u_emissionTexture:fi.Emission,u_lutTexture:fi.LUT,u_color_mix:[le.r,le.g,le.b,Q],u_aoIntensity:ue,u_emissive_strength:F,u_occlusionTextureTransform:$||[0,0,0,0]}},x_=(p,s=bp,u=bp)=>({u_matrix:p,u_instance:s,u_node_matrix:u}),b_=(p,s,u,g,v)=>({u_matrix:Float32Array.from(p),u_anchorPos:s,u_screenSizePx:u,u_occluderSizePx:g,u_color:v}),s1={fillExtrusion:p=>({u_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_vertical_gradient:new r.aa(p),u_opacity:new r.aa(p),u_edge_radius:new r.aa(p),u_ao:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_up_dir:new r.aq(p),u_height_lift:new r.aa(p),u_flood_light_color:new r.aq(p),u_vertical_scale:new r.aa(p),u_flood_light_intensity:new r.aa(p),u_ground_shadow_factor:new r.aq(p),u_emissive_strength:new r.aa(p)}),fillExtrusionDepth:p=>({u_matrix:new r.a6(p),u_edge_radius:new r.aa(p),u_vertical_scale:new r.aa(p)}),fillExtrusionPattern:p=>({u_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_vertical_gradient:new r.aa(p),u_height_factor:new r.aa(p),u_edge_radius:new r.aa(p),u_ao:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_up_dir:new r.aq(p),u_height_lift:new r.aa(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p),u_opacity:new r.aa(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.a6(p),u_opacity:new r.aa(p),u_ao_pass:new r.aa(p),u_meter_to_tile:new r.aa(p),u_ao:new r.a8(p),u_flood_light_intensity:new r.aa(p),u_flood_light_color:new r.aq(p),u_attenuation:new r.aa(p),u_edge_radius:new r.aa(p),u_fb:new r.a7(p),u_fb_size:new r.aa(p)}),fill:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p)}),fillPattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),fillOutline:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_world:new r.a8(p)}),fillOutlinePattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_world:new r.a8(p),u_image:new r.a7(p),u_texsize:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),circle:r.bI,collisionBox:p=>({u_matrix:new r.a6(p),u_camera_to_center_distance:new r.aa(p),u_extrude_scale:new r.a8(p)}),collisionCircle:p=>({u_matrix:new r.a6(p),u_inv_matrix:new r.a6(p),u_camera_to_center_distance:new r.aa(p),u_viewport_size:new r.a8(p)}),debug:p=>({u_color:new r.a9(p),u_matrix:new r.a6(p),u_overlay:new r.a7(p),u_overlay_scale:new r.aa(p)}),clippingMask:p=>({u_matrix:new r.a6(p)}),heatmap:p=>({u_extrude_scale:new r.aa(p),u_intensity:new r.aa(p),u_matrix:new r.a6(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_up_dir:new r.aq(p)}),heatmapTexture:p=>({u_image:new r.a7(p),u_color_ramp:new r.a7(p),u_opacity:new r.aa(p)}),hillshade:p=>({u_matrix:new r.a6(p),u_image:new r.a7(p),u_latrange:new r.a8(p),u_light:new r.a8(p),u_shadow:new r.a9(p),u_highlight:new r.a9(p),u_emissive_strength:new r.aa(p),u_accent:new r.a9(p)}),hillshadePrepare:p=>({u_matrix:new r.a6(p),u_image:new r.a7(p),u_dimension:new r.a8(p),u_zoom:new r.aa(p)}),line:r.bJ,linePattern:r.bK,raster:p=>({u_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_grid_matrix:new r.ar(p),u_tl_parent:new r.a8(p),u_scale_parent:new r.aa(p),u_fade_t:new r.aa(p),u_opacity:new r.aa(p),u_image0:new r.a7(p),u_image1:new r.a7(p),u_brightness_low:new r.aa(p),u_brightness_high:new r.aa(p),u_saturation_factor:new r.aa(p),u_contrast_factor:new r.aa(p),u_spin_weights:new r.aq(p),u_perspective_transform:new r.a8(p),u_raster_elevation:new r.aa(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_cutoff_params:new r.as(p),u_colorization_mix:new r.as(p),u_colorization_offset:new r.aa(p),u_color_ramp:new r.a7(p),u_texture_offset:new r.a8(p),u_texture_res:new r.a8(p),u_emissive_strength:new r.aa(p)}),rasterParticle:p=>({u_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_grid_matrix:new r.ar(p),u_tl_parent:new r.a8(p),u_scale_parent:new r.aa(p),u_fade_t:new r.aa(p),u_opacity:new r.aa(p),u_image0:new r.a7(p),u_image1:new r.a7(p),u_raster_elevation:new r.aa(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_cutoff_params:new r.as(p)}),rasterParticleTexture:p=>({u_texture:new r.a7(p),u_opacity:new r.aa(p)}),rasterParticleDraw:p=>({u_particle_texture:new r.a7(p),u_particle_texture_side_len:new r.aa(p),u_tile_offset:new r.a8(p),u_velocity:new r.a7(p),u_color_ramp:new r.a7(p),u_velocity_res:new r.a8(p),u_max_speed:new r.aa(p),u_uv_offset:new r.a8(p),u_data_scale:new r.as(p),u_data_offset:new r.aa(p),u_particle_pos_scale:new r.aa(p),u_particle_pos_offset:new r.a8(p)}),rasterParticleUpdate:p=>({u_particle_texture:new r.a7(p),u_particle_texture_side_len:new r.aa(p),u_velocity:new r.a7(p),u_velocity_res:new r.a8(p),u_max_speed:new r.aa(p),u_speed_factor:new r.aa(p),u_reset_rate:new r.aa(p),u_rand_seed:new r.aa(p),u_uv_offset:new r.a8(p),u_data_scale:new r.as(p),u_data_offset:new r.aa(p),u_particle_pos_scale:new r.aa(p),u_particle_pos_offset:new r.a8(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_camera_forward:new r.aq(p),u_tile_matrix:new r.a6(p),u_up_vector:new r.aq(p),u_ecef_origin:new r.aq(p),u_texture:new r.a7(p),u_icon_transition:new r.aa(p),u_color_adj_mat:new r.a6(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_texture:new r.a7(p),u_gamma_scale:new r.aa(p),u_device_pixel_ratio:new r.aa(p),u_tile_id:new r.aq(p),u_zoom_transition:new r.aa(p),u_inv_rot_matrix:new r.a6(p),u_merc_center:new r.a8(p),u_camera_forward:new r.aq(p),u_tile_matrix:new r.a6(p),u_up_vector:new r.aq(p),u_ecef_origin:new r.aq(p),u_is_halo:new r.a7(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new r.a7(p),u_is_size_feature_constant:new r.a7(p),u_size_t:new r.aa(p),u_size:new r.aa(p),u_camera_to_center_distance:new r.aa(p),u_rotate_symbol:new r.a7(p),u_aspect_ratio:new r.aa(p),u_fade_change:new r.aa(p),u_matrix:new r.a6(p),u_label_plane_matrix:new r.a6(p),u_coord_matrix:new r.a6(p),u_is_text:new r.a7(p),u_pitch_with_map:new r.a7(p),u_texsize:new r.a8(p),u_texsize_icon:new r.a8(p),u_texture:new r.a7(p),u_texture_icon:new r.a7(p),u_gamma_scale:new r.aa(p),u_device_pixel_ratio:new r.aa(p),u_is_halo:new r.a7(p)}),background:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_opacity:new r.aa(p),u_color:new r.a9(p)}),backgroundPattern:p=>({u_matrix:new r.a6(p),u_emissive_strength:new r.aa(p),u_opacity:new r.aa(p),u_image:new r.a7(p),u_pattern_tl:new r.a8(p),u_pattern_br:new r.a8(p),u_texsize:new r.a8(p),u_pattern_size:new r.a8(p),u_pixel_coord_upper:new r.a8(p),u_pixel_coord_lower:new r.a8(p),u_tile_units_to_pixels:new r.aa(p)}),terrainRaster:xa,terrainDepth:xa,skybox:p=>({u_matrix:new r.a6(p),u_sun_direction:new r.aq(p),u_cubemap:new r.a7(p),u_opacity:new r.aa(p),u_temporal_offset:new r.aa(p)}),skyboxGradient:p=>({u_matrix:new r.a6(p),u_color_ramp:new r.a7(p),u_center_direction:new r.aq(p),u_radius:new r.aa(p),u_opacity:new r.aa(p),u_temporal_offset:new r.aa(p)}),skyboxCapture:p=>({u_matrix_3f:new r.ar(p),u_sun_direction:new r.aq(p),u_sun_intensity:new r.aa(p),u_color_tint_r:new r.as(p),u_color_tint_m:new r.as(p),u_luminance:new r.aa(p)}),globeRaster:p=>({u_proj_matrix:new r.a6(p),u_globe_matrix:new r.a6(p),u_normalize_matrix:new r.a6(p),u_merc_matrix:new r.a6(p),u_zoom_transition:new r.aa(p),u_merc_center:new r.a8(p),u_image0:new r.a7(p),u_grid_matrix:new r.ar(p),u_skirt_height:new r.aa(p),u_far_z_cutoff:new r.aa(p),u_frustum_tl:new r.aq(p),u_frustum_tr:new r.aq(p),u_frustum_br:new r.aq(p),u_frustum_bl:new r.aq(p),u_globe_pos:new r.aq(p),u_globe_radius:new r.aa(p),u_viewport:new r.a8(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.aq(p),u_frustum_tr:new r.aq(p),u_frustum_br:new r.aq(p),u_frustum_bl:new r.aq(p),u_horizon:new r.aa(p),u_transition:new r.aa(p),u_fadeout_range:new r.aa(p),u_color:new r.as(p),u_high_color:new r.as(p),u_space_color:new r.as(p),u_temporal_offset:new r.aa(p),u_horizon_angle:new r.aa(p)}),model:p=>({u_matrix:new r.a6(p),u_lighting_matrix:new r.a6(p),u_normal_matrix:new r.a6(p),u_node_matrix:new r.a6(p),u_lightpos:new r.aq(p),u_lightintensity:new r.aa(p),u_lightcolor:new r.aq(p),u_camera_pos:new r.aq(p),u_opacity:new r.aa(p),u_baseColorFactor:new r.as(p),u_emissiveFactor:new r.as(p),u_metallicFactor:new r.aa(p),u_roughnessFactor:new r.aa(p),u_baseTextureIsAlpha:new r.a7(p),u_alphaMask:new r.a7(p),u_alphaCutoff:new r.aa(p),u_baseColorTexture:new r.a7(p),u_metallicRoughnessTexture:new r.a7(p),u_normalTexture:new r.a7(p),u_occlusionTexture:new r.a7(p),u_emissionTexture:new r.a7(p),u_lutTexture:new r.a7(p),u_color_mix:new r.as(p),u_aoIntensity:new r.aa(p),u_emissive_strength:new r.aa(p),u_occlusionTextureTransform:new r.as(p)}),modelDepth:p=>({u_matrix:new r.a6(p),u_instance:new r.a6(p),u_node_matrix:new r.a6(p)}),groundShadow:p=>({u_matrix:new r.a6(p),u_ground_shadow_factor:new r.aq(p)}),stars:p=>({u_matrix:new r.a6(p),u_up:new r.aq(p),u_right:new r.aq(p),u_intensity_multiplier:new r.aa(p)}),occlusion:p=>({u_matrix:new r.a6(p),u_anchorPos:new r.aq(p),u_screenSizePx:new r.a8(p),u_occluderSizePx:new r.a8(p),u_color:new r.as(p)})};function Yh(p,s,u){let g=s.createTileMatrix(p,p.worldSize,u.toUnwrapped());return r.ad.multiply(new Float32Array(16),p.projMatrix,g)}function a1(p,s,u){if(s.projection.name===u.projection.name)return p.projMatrix;let g=u.clone();return g.setProjection(s.projection),Yh(g,s.getProjection(),p)}function Cl(p,s,u){return s.name===u.projection.name?p.projMatrix:Yh(u,s,p)}let Xh;function lu(p,s,u,g,v,x,w){let I=p.context,M=I.gl,A=p.transform,L=p.getOrCreateProgram("collisionBox"),F=[],B=0,U=0;for(let te=0;te<g.length;te++){let ue=g[te],le=s.getTile(ue),Q=le.getBucket(u);if(!Q)continue;let ne=a1(ue,Q,A),re=ne;v[0]===0&&v[1]===0||(re=p.translatePosMatrix(ne,le,v,x));let pe=w?Q.textCollisionBox:Q.iconCollisionBox,Ee=Q.collisionCircleArray;if(Ee.length>0){let se=r.ad.create(),Te=re;r.ad.mul(se,Q.placementInvProjMatrix,A.glCoordMatrix),r.ad.mul(se,se,Q.placementViewportMatrix),F.push({circleArray:Ee,circleOffset:U,transform:Te,invTransform:se,projection:Q.getProjection()}),B+=Ee.length/4,U=B}pe&&(p.terrain&&p.terrain.setupElevationDraw(le,L),L.draw(p,M.LINES,r.ae.disabled,r.ag.disabled,p.colorModeForRenderPass(),r.af.disabled,_p(re,A,le,Q.getProjection()),u.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,A.zoom,null,[pe.collisionVertexBuffer,pe.collisionVertexBufferExt]))}if(!w||!F.length)return;let $=p.getOrCreateProgram("collisionCircle"),G=new r.bL;G.resize(4*B),G._trim();let q=0;for(let te of F)for(let ue=0;ue<te.circleArray.length/4;ue++){let le=4*ue,Q=te.circleArray[le+0],ne=te.circleArray[le+1],re=te.circleArray[le+2],pe=te.circleArray[le+3];G.emplace(q++,Q,ne,re,pe,0),G.emplace(q++,Q,ne,re,pe,1),G.emplace(q++,Q,ne,re,pe,2),G.emplace(q++,Q,ne,re,pe,3)}(!Xh||Xh.length<2*B)&&(Xh=function(te){let ue=2*te,le=new r.bu;le.resize(ue),le._trim();for(let Q=0;Q<ue;Q++){let ne=6*Q;le.uint16[ne+0]=4*Q+0,le.uint16[ne+1]=4*Q+1,le.uint16[ne+2]=4*Q+2,le.uint16[ne+3]=4*Q+2,le.uint16[ne+4]=4*Q+3,le.uint16[ne+5]=4*Q+0}return le}(B));let H=I.createIndexBuffer(Xh,!0),J=I.createVertexBuffer(G,r.bM.members,!0);for(let te of F){let ue={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ee=A).getCameraToCenterDistance(te.projection),u_viewport_size:[ee.width,ee.height]};$.draw(p,M.TRIANGLES,r.ae.disabled,r.ag.disabled,p.colorModeForRenderPass(),r.af.disabled,ue,u.id,J,H,r.b.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,A.zoom)}var ee;J.destroy(),H.destroy()}let Da=r.ad.create();function w_(p){let s=p._camera.getWorldToCamera(p.worldSize,1),u=r.ad.multiply([],s,p.globeMatrix);r.ad.invert(u,u);let g=[0,0,0],v=[0,1,0,0];return r.aA.transformMat4(v,v,u),g[0]=v[0],g[1]=v[1],g[2]=v[2],r._.normalize(g,g),g}function l1({width:p,height:s,anchor:u,textOffset:g,textScale:v},x){let{horizontalAlign:w,verticalAlign:I}=r.bQ(u),M=-(w-.5)*p,A=-(I-.5)*s,L=r.bP(u,g);return new r.P((M/v+L[0])*x,(A/v+L[1])*x)}function E_(p,s,u,g,v,x,w,I,M,A,L){let F=p.text.placedSymbolArray,B=p.text.dynamicLayoutVertexArray,U=p.icon.dynamicLayoutVertexArray,$={},G=p.getProjection(),q=Cl(I,G,x),H=x.elevation,J=G.upVectorScale(I.canonical,x.center.lat,x.worldSize).metersToTile;B.clear();for(let ee=0;ee<F.length;ee++){let te=F.get(ee),{tileAnchorX:ue,tileAnchorY:le,numGlyphs:Q}=te,ne=te.hidden||!te.crossTileID||p.allowVerticalPlacement&&!te.placedOrientation?null:g[te.crossTileID];if(ne){let re=0,pe=0,Ee=0;if(H){let Le=H?H.getAtTileOffset(I,ue,le):0,[et,it,nt]=G.upVector(I.canonical,ue,le);re=Le*et*J,pe=Le*it*J,Ee=Le*nt*J}let[se,Te,Se,Be]=Xi(te.projectedAnchorX+re,te.projectedAnchorY+pe,te.projectedAnchorZ+Ee,u?q:w),Ue=ni(x.getCameraToCenterDistance(G),Be),Ne=v.evaluateSizeForFeature(p.textSizeData,A,te)*Ue/r.bN;u&&(Ne*=p.tilePixelRatio/M);let ye=l1(ne,Ne);u?({x:se,y:Te,z:Se}=G.projectTilePoint(ue+ye.x,le+ye.y,I.canonical),[se,Te,Se]=Xi(se+re,Te+pe,Se+Ee,w)):(s&&ye._rotate(-x.angle),se+=ye.x,Te+=ye.y,Se=0);let Ae=p.allowVerticalPlacement&&te.placedOrientation===r.aE.vertical?Math.PI/2:0;for(let Le=0;Le<Q;Le++)r.aH(B,se,Te,Se,Ae);L&&te.associatedIconIndex>=0&&($[te.associatedIconIndex]={x:se,y:Te,z:Se,angle:Ae})}else Ea(Q,B)}if(L){U.clear();let ee=p.icon.placedSymbolArray;for(let te=0;te<ee.length;te++){let ue=ee.get(te),{numGlyphs:le}=ue,Q=$[te];if(ue.hidden||!Q)Ea(le,U);else{let{x:ne,y:re,z:pe,angle:Ee}=Q;for(let se=0;se<le;se++)r.aH(U,ne,re,pe,Ee)}}p.icon.dynamicLayoutVertexBuffer.updateData(U)}p.text.dynamicLayoutVertexBuffer.updateData(B)}function wp(p,s,u,g,v,x,w={}){let I=u.paint.get("icon-translate"),M=u.paint.get("text-translate"),A=u.paint.get("icon-translate-anchor"),L=u.paint.get("text-translate-anchor"),F=u.layout.get("icon-rotation-alignment"),B=u.layout.get("text-rotation-alignment"),U=u.layout.get("icon-pitch-alignment"),$=u.layout.get("text-pitch-alignment"),G=u.layout.get("icon-keep-upright"),q=u.layout.get("text-keep-upright"),H=u.paint.get("icon-color-saturation"),J=u.paint.get("icon-color-contrast"),ee=u.paint.get("icon-color-brightness-min"),te=u.paint.get("icon-color-brightness-max"),ue=u.paint.get("icon-occlusion-opacity").constantOr(0),le=u.paint.get("text-occlusion-opacity").constantOr(0),Q=p.context,ne=Q.gl,re=p.transform,pe=F==="map",Ee=B==="map",se=U==="map",Te=$==="map",Se=ue!==1||le!==1,Be=u.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ue=!1,Ne=p.depthModeForSublayer(0,r.ae.ReadOnly),ye=[r.aj(re.center.lng),r.ak(re.center.lat)],Ae=u.layout.get("text-variable-anchor"),Le=re.projection.name==="globe",et=[],it=[0,-1,0];for(let nt of g){let ze=s.getTile(nt),Ve=ze.getBucket(u);if(!Ve||Ve.projection.name==="mercator"&&Le||Ve.fullyClipped)continue;let tt=Ve.projection.name==="globe",ut=tt?r.a1(re.zoom):0,At=Cl(nt,Ve.getProjection(),re),Bt=re.calculatePixelsToTileUnitsMatrix(ze),on=Ae&&Ve.hasTextData(),tn=Ve.hasIconTextFit()&&on&&Ve.hasIconData(),Cn=Ve.getProjection().createInversionMatrix(re,nt.canonical),Ot=()=>{let sn=pe&&u.layout.get("symbol-placement")!=="point",Fe=[];Se&&p.symbolParams.useOcclusionQueries&&!tt&&!Le&&Fe.push("OCCLUSION_QUERIES");let st=sn||tn,Mr=u.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&se&&Fe.push("PITCH_WITH_MAP_TERRAIN"),tt&&(Fe.push("PROJECTION_GLOBE_VIEW"),st&&Fe.push("PROJECTED_POS_ON_VIEWPORT")),Mr>0&&Fe.push("ICON_TRANSITION"),Ve.icon.zOffsetVertexBuffer&&Fe.push("Z_OFFSET"),H===0&&J===0&&ee===0&&te===1||Fe.push("COLOR_ADJUSTMENT");let Mn=Ve.icon.programConfigurations.get(u.id),we=p.getOrCreateProgram(Ve.sdfIcons?"symbolSDF":"symbolIcon",{config:Mn,defines:Fe}),Ei,ii=ze.imageAtlasTexture?ze.imageAtlasTexture.size:[0,0],Lr=Ve.iconSizeData,mi=r.aD(Lr,re.zoom),Pi=se||re.pitch!==0,Ji=ba(At,ze.tileID.canonical,se,pe,re,Ve.getProjection(),Bt),Ui=bl(At,ze.tileID.canonical,se,pe,re,Ve.getProjection(),Bt),Vs=p.translatePosMatrix(Ui,ze,I,A,!0),js=p.translatePosMatrix(At,ze,I,A),ts=st?Da:Ji,No=pe&&!se&&!sn,ns=it;!Le&&!re.mercatorFromTransition||pe||(ns=w_(re));let Vl=tt?ns:it;if(Ve.sdfIcons&&!Ve.iconsInText)Ei=Zh(Lr.kind,mi,No,se,p,js,ts,Vs,!1,ii,!0,nt,ut,ye,Cn,Vl,Ve.getProjection());else{let Na=u.getColorAdjustmentMatrix(H,J,ee,te);Ei=Sl(Lr.kind,mi,No,se,p,js,ts,Vs,!1,ii,nt,ut,ye,Cn,Vl,Ve.getProjection(),Na,Mr)}let Pu=ze.imageAtlasTexture?ze.imageAtlasTexture:null,jl=u.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear,$l=Ve.sdfIcons||p.options.rotating||p.options.zooming||jl||Pi?ne.LINEAR:ne.NEAREST,_d=Ve.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,yd=p.terrain&&se&&sn?r.ad.invert(r.ad.create(),Ji):Da;if(sn&&Ve.icon){let Na=re.elevation,oi=Na?Na.getAtTileOffsetFunc(nt,re.center.lat,re.worldSize,Ve.getProjection()):null,em=wa(At,ze.tileID.canonical,se,pe,re,Ve.getProjection(),Bt);kh(Ve,At,p,!1,em,Ui,se,G,oi,nt)}return{program:we,buffers:Ve.icon,uniformValues:Ei,atlasTexture:Pu,atlasTextureIcon:null,atlasInterpolation:$l,atlasInterpolationIcon:null,isSDF:Ve.sdfIcons,hasHalo:_d,tile:ze,labelPlaneMatrixInv:yd}},Tn=()=>{let sn=Ee&&u.layout.get("symbol-placement")!=="point",Fe=[],st=sn||Ae||tn;Se&&p.symbolParams.useOcclusionQueries&&!tt&&!Le&&Fe.push("OCCLUSION_QUERIES"),p.terrainRenderModeElevated()&&Te&&Fe.push("PITCH_WITH_MAP_TERRAIN"),tt&&(Fe.push("PROJECTION_GLOBE_VIEW"),st&&Fe.push("PROJECTED_POS_ON_VIEWPORT")),Ve.text.zOffsetVertexBuffer&&Fe.push("Z_OFFSET");let Mr=Ve.text.programConfigurations.get(u.id),Mn=p.getOrCreateProgram(Ve.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Mr,defines:Fe}),we,Ei=[0,0],ii=null,Lr=Ve.textSizeData;Ve.iconsInText&&(Ei=ze.imageAtlasTexture?ze.imageAtlasTexture.size:[0,0],ii=ze.imageAtlasTexture?ze.imageAtlasTexture:null,we=Te||re.pitch!==0||p.options.rotating||p.options.zooming||Lr.kind==="composite"||Lr.kind==="camera"?ne.LINEAR:ne.NEAREST);let mi=ze.glyphAtlasTexture?ze.glyphAtlasTexture.size:[0,0],Pi=r.aD(Lr,re.zoom),Ji=ba(At,ze.tileID.canonical,Te,Ee,re,Ve.getProjection(),Bt),Ui=bl(At,ze.tileID.canonical,Te,Ee,re,Ve.getProjection(),Bt),Vs=p.translatePosMatrix(Ui,ze,M,L,!0),js=p.translatePosMatrix(At,ze,M,L),ts=st?Da:Ji,No=Ee&&!Te&&!sn,ns=it;!Le&&!re.mercatorFromTransition||Ee||(ns=w_(re));let Vl=tt?ns:it,Pu;Pu=Ve.iconsInText?y_(Lr.kind,Pi,No,Te,p,js,ts,Vs,mi,Ei,nt,ut,ye,Cn,Vl,Ve.getProjection()):Zh(Lr.kind,Pi,No,Te,p,js,ts,Vs,!0,mi,!0,nt,ut,ye,Cn,Vl,Ve.getProjection());let jl=ze.glyphAtlasTexture?ze.glyphAtlasTexture:null,$l=ne.LINEAR,_d=u.paint.get("text-halo-width").constantOr(1)!==0,yd=p.terrain&&Te&&sn?r.ad.invert(r.ad.create(),Ji):Da;if(sn&&Ve.text){let Na=re.elevation,oi=Na?Na.getAtTileOffsetFunc(nt,re.center.lat,re.worldSize,Ve.getProjection()):null,em=wa(At,ze.tileID.canonical,Te,Ee,re,Ve.getProjection(),Bt);kh(Ve,At,p,!0,em,Ui,Te,q,oi,nt)}return{program:Mn,buffers:Ve.text,uniformValues:Pu,atlasTexture:jl,atlasTextureIcon:ii,atlasInterpolation:$l,atlasInterpolationIcon:we,isSDF:!0,hasHalo:_d,tile:ze,labelPlaneMatrixInv:yd}},Un=Ve.icon.segments.get().length,An=Ve.text.segments.get().length,Qt=Un&&!w.onlyText?Ot():null,Lt=An&&!w.onlyIcons?Tn():null,qn=u.paint.get("icon-opacity").constantOr(1),Yn=u.paint.get("text-opacity").constantOr(1);if(Be&&Ve.canOverlap){Ue=!0;let sn=qn&&!w.onlyText?Ve.icon.segments.get():[],Fe=Yn&&!w.onlyIcons?Ve.text.segments.get():[];for(let st of sn)et.push({segments:new r.b([st]),sortKey:st.sortKey,state:Qt});for(let st of Fe)et.push({segments:new r.b([st]),sortKey:st.sortKey,state:Lt})}else w.onlyText||et.push({segments:qn?Ve.icon.segments:new r.b([]),sortKey:0,state:Qt}),w.onlyIcons||et.push({segments:Yn?Ve.text.segments:new r.b([]),sortKey:0,state:Lt})}Ue&&et.sort((nt,ze)=>nt.sortKey-ze.sortKey);for(let nt of et){let ze=nt.state;if(ze)if(p.terrain&&p.terrain.setupElevationDraw(ze.tile,ze.program,{useDepthForOcclusion:!1,labelPlaneMatrixInv:ze.labelPlaneMatrixInv}),Q.activeTexture.set(ne.TEXTURE0),ze.atlasTexture&&ze.atlasTexture.bind(ze.atlasInterpolation,ne.CLAMP_TO_EDGE,!0),ze.atlasTextureIcon&&(Q.activeTexture.set(ne.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,ne.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,ze.program),ze.hasHalo){let Ve=ze.uniformValues;Ve.u_is_halo=1,Ml(ze.buffers,nt.segments,u,p,ze.program,Ne,v,x,Ve,2),Ve.u_is_halo=0}else{if(ze.isSDF){let Ve=ze.uniformValues;ze.hasHalo&&(Ve.u_is_halo=1,Ml(ze.buffers,nt.segments,u,p,ze.program,Ne,v,x,Ve,1)),Ve.u_is_halo=0}Ml(ze.buffers,nt.segments,u,p,ze.program,Ne,v,x,ze.uniformValues,1)}}}function Ml(p,s,u,g,v,x,w,I,M,A){let L=g.context.gl,F=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];p.occlusionQueryOpacityVertexBuffer.length>0&&F.push(p.occlusionQueryOpacityVertexBuffer),v.draw(g,L.TRIANGLES,x,w,I,r.af.disabled,M,u.id,p.layoutVertexBuffer,p.indexBuffer,s,u.paint,g.transform.zoom,p.programConfigurations.get(u.id),F,A)}function Ep(p,s,u,g,v,x,w){let I=p.context.gl,M=u.paint.get("fill-pattern"),A=M&&M.constantOr(1),L,F,B,U,$;w?(F=A&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=I.LINES):(F=A?"fillPattern":"fill",L=I.TRIANGLES);for(let G of g){let q=s.getTile(G);if(A&&!q.patternsLoaded())continue;let H=q.getBucket(u);if(!H)continue;p.prepareDrawTile();let J=H.programConfigurations.get(u.id),ee=p.isTileAffectedByFog(G),te=p.getOrCreateProgram(F,{config:J,overrideFog:ee});A&&(p.context.activeTexture.set(I.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),J.updatePaintBuffers());let ue=M.constantOr(null);if(ue&&q.imageAtlas){let ne=q.imageAtlas.patternPositions[ue.toString()];ne&&J.setConstantPatternPositions(ne)}let le=p.translatePosMatrix(G.projMatrix,q,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),Q=u.paint.get("fill-emissive-strength");if(w){U=H.indexBuffer2,$=H.segments2;let ne=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];B=F==="fillOutlinePattern"&&A?Hh(le,Q,p,q,ne):g_(le,Q,ne)}else U=H.indexBuffer,$=H.segments,B=A?gp(le,Q,p,q):mp(le,Q);p.uploadCommonUniforms(p.context,te,G.toUnwrapped()),te.draw(p,L,v,p.stencilModeForClipping(G),x,r.af.disabled,B,u.id,H.layoutVertexBuffer,U,$,u.paint,p.transform.zoom,J,void 0)}}function Al(p,s,u,g,v,x,w,I){u.resetLayerRenderingStats(p);let M=p.context,A=M.gl,L=p.transform,F=u.paint.get("fill-extrusion-pattern"),B=F.constantOr(1),U=u.paint.get("fill-extrusion-opacity"),$=p.style.enable3dLights(),G=u.paint.get($&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],H=u.layout.get("fill-extrusion-edge-radius"),J=H>0&&!u.paint.get("fill-extrusion-rounded-roof"),ee=J?0:H,te=L.projection.name==="globe"?r.bY():0,ue=L.projection.name==="globe",le=ue?r.a1(L.zoom):0,Q=[r.aj(L.center.lng),r.ak(L.center.lat)],ne=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),re=u.paint.get("fill-extrusion-flood-light-intensity"),pe=u.paint.get("fill-extrusion-vertical-scale"),Ee=Xo(p,u.paint.get("fill-extrusion-cutoff-fade-range")),se=u.paint.get("fill-extrusion-emissive-strength"),Te=[],Se;ue&&Te.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Te.push("FAUX_AO"),J&&Te.push("ZERO_ROOF_RADIUS"),I&&Te.push("HAS_CENTROID"),re>0&&Te.push("FLOOD_LIGHT"),Ee.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");let Be=p.renderPass==="shadow",Ue=p.shadowRenderer,Ne=Be&&!!Ue;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let ye=[0,0,0];if(Ue){let et=p.style.directionalLight,it=p.style.ambientLight;et&&it&&(ye=Ko(p.style,et,it)),Se=Te.concat(["SHADOWS_SINGLE_CASCADE"])}let Ae=Ne?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",Le=u.getLayerRenderingStats();for(let et of g){let it=s.getTile(et),nt=it.getBucket(u);if(!nt||nt.projection.name!==L.projection.name)continue;let ze=!1;Ue&&(ze=Ue.getMaxCascadeForTile(et.toUnwrapped())===0);let Ve=p.isTileAffectedByFog(et),tt=nt.programConfigurations.get(u.id),ut=p.getOrCreateProgram(Ae,{config:tt,defines:ze?Se:Te,overrideFog:Ve});if(p.terrain&&p.terrain.setupElevationDraw(it,ut,{useMeterToDem:!0}),!nt.centroidVertexBuffer){let Ot=ut.attributes.a_centroid_pos;Ot!==void 0&&A.vertexAttrib2f(Ot,0,0)}!Be&&Ue&&Ue.setupShadows(it.tileID.toUnwrapped(),ut,"vector-tile",it.tileID.overscaledZ),B&&(p.context.activeTexture.set(A.TEXTURE0),it.imageAtlasTexture&&it.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),tt.updatePaintBuffers());let At=F.constantOr(null);if(At&&it.imageAtlas){let Ot=it.imageAtlas.patternPositions[At.toString()];Ot&&tt.setConstantPatternPositions(Ot)}let Bt=u.paint.get("fill-extrusion-vertical-gradient"),on;if(Be&&Ue){if(Tp(it.tileID,nt,p))continue;let Ot=Ue.calculateShadowPassMatrixFromTile(it.tileID.toUnwrapped());on=Dl(Ot,ee,pe)}else{let Ot=p.translatePosMatrix(et.expandedProjMatrix,it,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Tn=L.projection.createInversionMatrix(L,et.canonical);on=B?pp(Ot,p,Bt,U,q,ee,et,it,te,le,Q,Tn,ne,pe):Il(Ot,p,Bt,U,q,ee,et,te,le,Q,Tn,ne,pe,re,ye,se)}p.uploadCommonUniforms(M,ut,et.toUnwrapped(),null,Ee);let tn=nt.segments;if(L.projection.name==="mercator"&&!Be&&(tn=nt.getVisibleSegments(it.tileID,p.terrain,p.transform.getFrustum(0)),!tn.get().length))continue;if(Le)if(Be)for(let Ot of tn.get())Le.numRenderedVerticesInShadowPass+=Ot.primitiveLength;else for(let Ot of tn.get())Le.numRenderedVerticesInTransparentPass+=Ot.primitiveLength;let Cn=[];(p.terrain||I)&&Cn.push(nt.centroidVertexBuffer),ue&&Cn.push(nt.layoutVertexExtBuffer),ut.draw(p,M.gl.TRIANGLES,v,x,w,r.af.backCCW,on,u.id,nt.layoutVertexBuffer,nt.indexBuffer,tn,u.paint,p.transform.zoom,tt,Cn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function vi(p,s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q,H,J){let ee=p.context,te=ee.gl,ue=p.transform,le=p.transform.zoom,Q=[],ne=Xo(p,u.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(Q.push("CLEAR_SUBPASS"),J&&(Q.push("CLEAR_FROM_TEXTURE"),ee.activeTexture.set(te.TEXTURE0),J.bind(te.LINEAR,te.CLAMP_TO_EDGE))):A==="sdf"&&Q.push("SDF_SUBPASS"),q&&Q.push("HAS_CENTROID"),ne.shouldRenderCutoff&&Q.push("RENDER_CUTOFF");let re=u.layout.get("fill-extrusion-edge-radius"),pe=(Ee,se,Te,Se,Be)=>{let Ue=se.programConfigurations.get(u.id),Ne=p.isTileAffectedByFog(Ee),ye=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:Q,overrideFog:Ne}),Ae=((et,it,nt,ze,Ve,tt,ut,At,Bt,on,tn)=>({u_matrix:it,u_opacity:nt,u_ao_pass:ze?1:0,u_meter_to_tile:Ve,u_ao:tt,u_flood_light_intensity:ut,u_flood_light_color:At,u_attenuation:Bt,u_edge_radius:on,u_fb:0,u_fb_size:tn}))(0,Se,L,M,Be,[F,B*Be],U,$,G,le>=17?0:re*Be,J?J.size[0]:0),Le=[];q&&Le.push(se.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(ee,ye,Ee.toUnwrapped(),null,ne),ye.draw(p,ee.gl.TRIANGLES,v,x,w,I,Ae,u.id,se.vertexBuffer,se.indexBuffer,Te,u.paint,le,Ue,Le)};for(let Ee of g){let se=s.getTile(Ee),Te=se.getBucket(u);if(!Te||Te.projection.name!==ue.projection.name||!Te.groundEffect||Te.groundEffect&&!Te.groundEffect.hasData())continue;let Se=Te.groundEffect,Be=1/Te.tileToMeter;{let Ue=p.translatePosMatrix(Ee.projMatrix,se,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ne=Se.getDefaultSegment();pe(Ee,Se,Ne,Ue,Be)}if(H)for(let Ue=0;Ue<4;Ue++){let Ne=r.bZ[Ue](Ee),ye=s.getTile(Ne);if(!ye)continue;let Ae=ye.getBucket(u);if(!Ae||Ae.projection.name!==ue.projection.name||!Ae.groundEffect||Ae.groundEffect&&!Ae.groundEffect.hasData())continue;let Le=Ae.groundEffect,et,it;Ue===0?(et=[-r.a3,0,0],it=1):Ue===1?(et=[r.a3,0,0],it=0):Ue===2?(et=[0,-r.a3,0],it=3):(et=[0,r.a3,0],it=2);let nt=Le.regionSegments[it];if(!nt)continue;let ze=new Float32Array(16);r.ad.translate(ze,Ee.projMatrix,et),pe(Ee,Le,nt,p.translatePosMatrix(ze,se,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Be)}}}function Kh(p,s,u,g,v,x,w){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let I=x?x.findDEMTileFor(u):null;if(!(I&&I.dem||w))return;let M=H=>new r.P(Math.ceil((H+r.c0)*r.c1),0),A=H=>{let J=s.getSource().minzoom,ee=ue=>{let le=s.getTileByID(ue);if(le&&le.hasData())return le.getBucket(v)},te=[0,-1,1];for(let ue of te){if(H.overscaledZ+ue<J)continue;let le=ee(H.calculateScaledKey(H.overscaledZ+ue));if(le)return le}},L=[0,0,0],F=(H,J)=>(L[0]=Math.min(H.min.y,J.min.y),L[1]=Math.max(H.max.y,J.max.y),L[2]=r.a3-J.min.x>H.max.x?J.min.x-r.a3:H.max.x,L),B=(H,J)=>(L[0]=Math.min(H.min.x,J.min.x),L[1]=Math.max(H.max.x,J.max.x),L[2]=r.a3-J.min.y>H.max.y?J.min.y-r.a3:H.max.y,L),U=[(H,J)=>F(H,J),(H,J)=>F(J,H),(H,J)=>B(H,J),(H,J)=>B(J,H)],$=(H,J,ee,te,ue,le,Q)=>{if(!x)return 0;let ne=[[le?ee:H,le?H:ee,0],[le?ee:J,le?J:ee,0]],re=Q<0?r.a3+Q:Q,pe=[le?re:(H+J)/2,le?(H+J)/2:re,0];return ee===0&&Q<0||ee!==0&&Q>0?x.getForTilePoints(ue,[pe],!0,te):ne.push(pe),x.getForTilePoints(u,ne,!0,I),Math.max(ne[0][2],ne[1][2],pe[2])/x.exaggeration()};for(let H=0;H<4;H++){let J=g.borderFeatureIndices[H];if(J.length===0)continue;let ee=r.bZ[H](u),te=A(ee);if(!(te&&te instanceof r.b_)||g.borderDoneWithNeighborZ[H]===te.canonical.z)continue;te.centroidVertexArray.length===0&&te.createCentroidsBuffer();let ue=x?x.findDEMTileFor(ee):null;if(!(ue&&ue.dem||w))continue;let le=(H<2?1:5)-H,Q=te.borderDoneWithNeighborZ[le]!==g.canonical.z,ne=te.borderFeatureIndices[le],re=0;if(g.canonical.z!==te.canonical.z){for(let pe of J)g.showCentroid(g.featuresOnBorder[pe]);if(Q)for(let pe of ne)te.showCentroid(te.featuresOnBorder[pe]);g.borderDoneWithNeighborZ[H]=te.canonical.z,te.borderDoneWithNeighborZ[le]=g.canonical.z}for(let pe of J){let Ee=g.featuresOnBorder[pe],se=g.centroidData[Ee.centroidDataIndex],Te=Ee.borders[H],Se;for(;re<ne.length;){Se=te.featuresOnBorder[ne[re]];let Be=Se.borders[le];if(Be[1]>Te[0]+3||Be[0]>Te[0]-3)break;te.showCentroid(Se),re++}if(Se&&re<ne.length){let Be=re,Ue=0;for(;!(Se.borders[le][0]>Te[1]-3)&&(Ue++,++re!==ne.length);)Se=te.featuresOnBorder[ne[re]];if(Se=te.featuresOnBorder[ne[Be]],Ue>1){let Ae=Se.borders[le];Math.abs(Te[0]-Ae[0])<3&&Math.abs(Te[1]-Ae[1])<3&&(Ue=1,re=Be+1)}else if(Ue===0){g.showCentroid(Ee);continue}let Ne=te.centroidData[Se.centroidDataIndex];w&&Ue===1&&(((G=se).flags|(q=Ne).flags)&r.b$?(G.flags|=r.b$,q.flags|=r.b$):(G.flags&=~r.b$,q.flags&=~r.b$));let ye=Ee.intersectsCount()>1||Se.intersectsCount()>1;if(Ue>1)re=Be,se.centroidXY=Ne.centroidXY=new r.P(0,0);else if(ue&&ue.dem&&!ye){let Ae=U[H](se,Ne),Le=H%2?r.a3-1:0,et=$(Ae[0],Math.min(r.a3-1,Ae[1]),Le,ue,ee,H<2,Ae[2]);se.centroidXY=Ne.centroidXY=M(et)}else ye?se.centroidXY=Ne.centroidXY=new r.P(0,0):(se.centroidXY=g.encodeBorderCentroid(Ee),Ne.centroidXY=te.encodeBorderCentroid(Se));g.writeCentroidToBuffer(se),te.writeCentroidToBuffer(Ne)}else g.showCentroid(Ee)}g.borderDoneWithNeighborZ[H]=te.canonical.z,te.borderDoneWithNeighborZ[le]=g.canonical.z}var G,q;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(p)}let Sa=[1,0,0],T_=[0,1,0],Qh=[0,0,1];function Tp(p,s,u){let g=u.transform,v=u.shadowRenderer;if(!v)return!0;let x=p.toUnwrapped(),w=g.tileSize*v._cascades[u.currentShadowCascade].scale,I=s.maxHeight;if(g.elevation){let G=g.elevation.getMinMaxForTile(p);G&&(I+=G.max)}let M=[...v.shadowDirection];M[2]=-M[2];let A=v.computeSimplifiedTileShadowVolume(x,I,w,M);if(!A)return!1;let L=[Sa,T_,Qh,M,[M[0],0,M[2]],[0,M[1],M[2]]],F=g.projection.name==="globe",B=g.scaleZoom(w),U=r.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,B,!F),$=v.getCurrentCascadeFrustum();return U.intersectsPrecise(A.vertices,A.planes,L)===0||$.intersectsPrecise(A.vertices,A.planes,L)===0}function cu(p){return[p[0]*r.c2,p[1]*r.c2,p[2]*r.c2,0]}function uu(p,s,u,g,v,x,w,I,M){let A=g.getSource(),L=u.globeSharedBuffers;if(!L)return;let F,B,U;if(s&&(F=g.getTile(s)),A instanceof r.bm?(B=A.texture,U=r.bh(0,0,u.transform)):F&&s&&(B=F.texture,U=r.bh(s.canonical.z,s.canonical.x,u.transform)),!B||!U)return;p||(U=r.ad.scale(r.ad.create(),U,[1,-1,1]));let $=u.context,G=$.gl,q=v.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,H=u.colorModeForDrapableLayerRenderPass(x),J=w.defines;J.push("GLOBE_POLES");let ee=new r.ae(G.LEQUAL,r.ae.ReadWrite,u.depthRangeFor3D),te=Float32Array.from(u.transform.expandedFarZProjMatrix),ue=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),$.activeTexture.set(G.TEXTURE0),B.bind(q,G.CLAMP_TO_EDGE),$.activeTexture.set(G.TEXTURE1),B.bind(q,G.CLAMP_TO_EDGE),B.useMipmap&&$.extTextureFilterAnisotropic&&u.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);let[le,Q,ne,re]=s?L.getPoleBuffers(s.canonical.z,!1):L.getPoleBuffers(0,!0),pe=v.paint.get("raster-elevation"),Ee;p?(Ee=le,u.renderDefaultNorthPole=pe!==0):(Ee=Q,u.renderDefaultSouthPole=pe!==0);let se=cu(w.mix),Te=((Be,Ue,Ne,ye,Ae,Le,et,it,nt,ze,Ve,tt,ut)=>iu(Be,Ue,Ne,new Float32Array(16),new Float32Array(9),[0,0],ye,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Le,[0,0],it,2,ze,Ve,tt,1,0,ut))(te,ue,U,r.a1(u.transform.zoom),0,v,0,pe,0,se,w.offset,w.range,x),Se=u.getOrCreateProgram("raster",{defines:J});u.uploadCommonUniforms($,Se,null),Se.draw(u,G.TRIANGLES,ee,M,H,I,Te,v.id,Ee,ne,re)}function _n(p){let s=p._nearZ,u=p.projection.farthestPixelDistance(p),g=u-s,v=.2*p.height,x=s+v;return[s,u,(x-v-s)/g,(x-s)/g]}function c1(p,s,u,g){if(p)return s instanceof Tl&&p instanceof r.c3?s.getTextureDescriptor(p,u,!0):{texture:p.texture,mix:cu(g.mix),offset:g.offset,buffer:0,tileSize:1}}function wt(p,s,u){if(!p)return null;let g=s.getTextureDescriptor(p,u,!0);if(!g)return null;let{texture:v,mix:x,offset:w,tileSize:I,buffer:M,format:A}=g;if(!v||!A)return null;let L=!1;return A==="uint32"&&(L=!0,x[3]=0,x=__(r.c4,x,[0,u.paint.get("raster-particle-max-speed")]),w=yp(r.c4,w,[0,u.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[M/(I+2*M),I/(I+2*M)],tileSize:I,scalarData:L,scale:x,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function I_(p){let s=p._nearZ,u=p.projection.farthestPixelDistance(p),g=u-s,v=.2*p.height,x=s+v;return[s,u,(x-v-s)/g,(x-s)/g]}let Jh=new r.C(1,0,0,1),Ip=new r.C(0,1,0,1),Lo=new r.C(0,0,1,1),Dp=new r.C(1,0,1,1),Pl=new r.C(0,1,1,1);function lt(p,s,u,g,v,x,w){let I=p.context,M=p.transform,A=I.gl,L=M.projection.name==="globe",F=L?["PROJECTION_GLOBE_VIEW"]:[],B=r.ad.clone(u.projMatrix);if(L&&r.a1(M.zoom)>0){let se=r.c5(u.canonical,M),Te=r.c6(se);B=r.ad.multiply(new Float32Array(16),M.globeMatrix,Te),r.ad.multiply(B,M.projMatrix,B)}let U=r.ad.create();U[12]+=2*v/(r.e.devicePixelRatio*M.width),U[13]+=2*x/(r.e.devicePixelRatio*M.height),r.ad.multiply(B,U,B);let $=p.getOrCreateProgram("debug",{defines:F}),G=s.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(G,$);let q=r.ae.disabled,H=r.ag.disabled,J=p.colorModeForRenderPass(),ee="$debug";I.activeTexture.set(A.TEXTURE0),p.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),L?G._makeGlobeTileDebugBuffers(p.context,M):G._makeDebugTileBoundsBuffers(p.context,M.projection);let te=G._tileDebugBuffer||p.debugBuffer,ue=G._tileDebugIndexBuffer||p.debugIndexBuffer,le=G._tileDebugSegments||p.debugSegments;if($.draw(p,A.LINE_STRIP,q,H,J,r.af.disabled,Wh(B,g),ee,te,ue,le,null,null,null,[G._globeTileDebugBorderBuffer]),w){let se=G.latestRawTileData,Te=Math.floor((se&&se.byteLength||0)/1024),Se=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Se+=` => ${u.overscaledZ}`),Se+=` ${G.state}`,Se+=` ${Te}kb`,function(Be,Ue){Be.initDebugOverlayCanvas();let Ne=Be.debugOverlayCanvas,ye=Be.context.gl,Ae=Be.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,Ne.width,Ne.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(Ue,5,5),Ae.strokeText(Ue,5,5),Be.debugOverlayTexture.update(Ne),Be.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(p,Se)}let Q=s.getTile(u).tileSize,ne=512/Math.min(Q,512)*(u.overscaledZ/M.zoom)*.5,re=G._tileDebugTextBuffer||p.debugBuffer,pe=G._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ee=G._tileDebugTextSegments||p.debugSegments;$.draw(p,A.TRIANGLES,q,H,r.a.alphaBlended,r.af.disabled,Wh(B,r.C.transparent,ne),ee,re,pe,Ee,null,null,null,[G._globeTileDebugTextBuffer])}function yn(p,s,u,g){xi(p,0,s+u/2,p.transform.width,u,g)}function vn(p,s,u,g){xi(p,s-u/2,0,u,p.transform.height,g)}function xi(p,s,u,g,v,x){let w=p.context,I=w.gl;I.enable(I.SCISSOR_TEST),I.scissor(s*r.e.devicePixelRatio,u*r.e.devicePixelRatio,g*r.e.devicePixelRatio,v*r.e.devicePixelRatio),w.clear({color:x}),I.disable(I.SCISSOR_TEST)}let Rl=r.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:fn}=Rl;function ho(p,s,u,g){p.emplaceBack(s,u,g)}class Ol{constructor(s){this.vertexArray=new r.c8,this.indices=new r.bu,ho(this.vertexArray,-1,-1,1),ho(this.vertexArray,1,-1,1),ho(this.vertexArray,-1,1,1),ho(this.vertexArray,1,1,1),ho(this.vertexArray,-1,-1,-1),ho(this.vertexArray,1,-1,-1),ho(this.vertexArray,-1,1,-1),ho(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,fn),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=r.b.simpleSegment(0,0,36,12)}}function ko(p,s,u,g,v,x){let w=p.context.gl,I=s.paint.get("sky-atmosphere-color"),M=s.paint.get("sky-atmosphere-halo-color"),A=s.paint.get("sky-atmosphere-sun-intensity"),L=((F,B,U,$,G)=>({u_matrix_3f:F,u_sun_direction:B,u_sun_intensity:U,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(r.bC.fromMat4(r.bC.create(),g),v,A,I,M);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),u.draw(p,w.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.frontCW,L,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}let Ai=r.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class vr{constructor(s){let u=new r.c9;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);let g=new r.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(u,Ai.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=r.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let u1=r.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class hu{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Sp{constructor(s){this.colorModeAlphaBlendedWriteRGB=new r.a([r.ca,r.cb,r.ca,r.cb],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.ca,r.cc,r.ca,r.cc],r.C.transparent,[!1,!1,!1,!0]),this.params=new hu,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){let u=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new vr(u);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(L){let F=r.cf(30),B=[];for(let U=0;U<L;++U){let $=2*Math.PI*F(),G=Math.acos(1-2*F())-.5*Math.PI;B.push(r._.fromValues(Math.cos(G)*Math.cos($),Math.cos(G)*Math.sin($),Math.sin(G)))}return B}(this.params.starsCount),w=r.cf(300),I=new r.cd,M=new r.bu,A=0;for(let L=0;L<x.length;++L){let F=r._.scale([],x[L],200),B=Math.max(0,1+.01*g*(1*w()-.5)),U=Math.max(0,1+.01*v*(1*w()-.5));I.emplaceBack(F[0],F[1],F[2],-1,-1,B,U),I.emplaceBack(F[0],F[1],F[2],1,-1,B,U),I.emplaceBack(F[0],F[1],F[2],1,1,B,U),I.emplaceBack(F[0],F[1],F[2],-1,1,B,U),M.emplaceBack(A+0,A+1,A+2),M.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=u.createVertexBuffer(I,u1.members),this.starsIdx=u.createIndexBuffer(M),this.starsSegments=r.b.simpleSegment(0,0,I.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,u){let g=s.context,v=g.gl,x=s.transform,w=new r.ae(v.LEQUAL,r.ae.ReadOnly,[0,1]),I=r.a1(x.zoom),M=s.style.getLut(u.scope),A=u.properties.get("color").toRenderColor(M).toArray01(),L=u.properties.get("high-color").toRenderColor(M).toArray01(),F=u.properties.get("space-color").toRenderColor(M).toArray01PremultipliedAlpha(),B=5e-4,U=r.ce(u.properties.get("horizon-blend"),0,1,B,.25),$=r.ba(s,g,x)&&U===B?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,G=s.frameCounter/1e3%1,q=r._.length(x.globeCenterInViewSpace),H=Math.sqrt(Math.pow(q,2)-Math.pow($,2)),J=Math.acos(H/q),ee=te=>{let ue=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];te&&ue.push("ALPHA_PASS");let le=s.getOrCreateProgram("globeAtmosphere",{defines:ue}),Q=((re,pe,Ee,se,Te,Se,Be,Ue,Ne,ye,Ae,Le)=>({u_frustum_tl:re,u_frustum_tr:pe,u_frustum_br:Ee,u_frustum_bl:se,u_horizon:Te,u_transition:Se,u_fadeout_range:Be,u_color:Ue,u_high_color:Ne,u_space_color:ye,u_temporal_offset:Ae,u_horizon_angle:Le}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,I,U,A,L,F,G,J);s.uploadCommonUniforms(g,le);let ne=this.atmosphereBuffer;ne&&le.draw(s,v.TRIANGLES,w,r.ag.disabled,te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.af.backCW,Q,te?"atmosphere_glow_alpha":"atmosphere_glow",ne.vertexBuffer,ne.indexBuffer,ne.segments)};ee(!1),ee(!0)}drawStars(s,u){let g=r.at(u.properties.get("star-intensity"),0,1);if(g===0)return;let v=s.context,x=v.gl,w=s.transform,I=s.getOrCreateProgram("stars"),M=r.av.identity([]);r.av.rotateX(M,M,-w._pitch),r.av.rotateZ(M,M,-w.angle),r.av.rotateX(M,M,r.ab(w._center.lat)),r.av.rotateY(M,M,-r.ab(w._center.lng));let A=r.ad.fromQuat(new Float32Array(16),M),L=r.ad.multiply([],w.starsProjMatrix,A),F=r.bC.fromMat4([],A),B=r.bC.invert([],F),U=[0,1,0];r._.transformMat3(U,U,B),r._.scale(U,U,this.params.sizeMultiplier);let $=[1,0,0];r._.transformMat3($,$,B),r._.scale($,$,this.params.sizeMultiplier);let G=(q=U,H=$,J=g,{u_matrix:Float32Array.from(L),u_up:q,u_right:H,u_intensity_multiplier:J});var q,H,J;s.uploadCommonUniforms(v,I),this.starsVx&&this.starsIdx&&I.draw(s,x.TRIANGLES,r.ae.disabled,r.ag.disabled,this.colorModeAlphaBlendedWriteRGB,r.af.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ll(p,s){let u=[...p],g=s.cameraWorldSizeForFog/s.worldSize,v=r.ad.identity([]);return r.ad.scale(v,v,[g,g,1]),r.ad.multiply(u,v,u),r.ad.multiply(u,s.worldToFogMatrix,u),u}function du(p,s,u,g,v){let x=u.material,w=g.context,{baseColorTexture:I,metallicRoughnessTexture:M}=x.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:L,emissionTexture:F}=x;function B(U,$,G){if(U&&(p.push($),w.activeTexture.set(w.gl.TEXTURE0+G),U.gfxTexture)){let{minFilter:q,magFilter:H,wrapS:J,wrapT:ee}=U.sampler;U.gfxTexture.bindExtraParam(q,H,J,ee)}}B(I,"HAS_TEXTURE_u_baseColorTexture",fi.BaseColor),B(M,"HAS_TEXTURE_u_metallicRoughnessTexture",fi.MetallicRoughness),B(A,"HAS_TEXTURE_u_normalTexture",fi.Normal),B(L,"HAS_TEXTURE_u_occlusionTexture",fi.Occlusion),B(F,"HAS_TEXTURE_u_emissionTexture",fi.Emission),v&&(v.texture||(v.texture=new r.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],w.gl.RGBA)),w.activeTexture.set(w.gl.TEXTURE0+fi.LUT),v.texture&&v.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(u.texcoordBuffer)),u.colorBuffer&&(p.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(u.colorBuffer)),u.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(u.normalBuffer)),u.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(u.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function Ca(p,s,u,g,v,x){let w=u.paint.get("model-opacity"),I=s.context,M=new r.ae(s.context.gl.LEQUAL,r.ae.ReadWrite,s.depthRangeFor3D),A=s.transform,L=p.mesh,F=L.material,B=F.pbrMetallicRoughness,U=s.style.fog,$;$=s.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.ad.multiply([],g.zScaleMatrix,p.nodeModelMatrix),r.ad.multiply($,g.negCameraPosMatrix,$);let G=r.ad.invert([],$);r.ad.transpose(G,G);let q=u.paint.get("model-emissive-strength").constantOr(0),H=au(new Float32Array(p.worldViewProjection),new Float32Array($),new Float32Array(G),null,s,w,B.baseColorFactor.toRenderColor(null),F.emissiveFactor,B.metallicFactor,B.roughnessFactor,F,q,u),J={defines:[]},ee=[];du(J.defines,ee,L,s,u.lut);let te=s.shadowRenderer;te&&(te.useNormalOffset=!1);let ue=null;if(U){let ne=Ll(p.nodeModelMatrix,s.transform);if(ue=new Float32Array(ne),A.projection.name!=="globe"){let re=L.aabb.min,pe=L.aabb.max,[Ee,se]=U.getOpacityForBounds(ne,re[0],re[1],pe[0],pe[1]);J.overrideFog=Ee>=Qn||se>=Qn}}let le=Xo(s,u.paint.get("model-cutoff-fade-range"));le.shouldRenderCutoff&&J.defines.push("RENDER_CUTOFF");let Q=s.getOrCreateProgram("model",J);s.uploadCommonUniforms(I,Q,null,ue,le),s.renderPass!=="shadow"&&te&&te.setupShadowsFromMatrix(p.nodeModelMatrix,Q),Q.draw(s,I.gl.TRIANGLES,M,v,x,L.material.doubleSided?r.af.disabled:r.af.backCCW,H,u.id,L.vertexBuffer,L.indexBuffer,L.segments,u.paint,s.transform.zoom,void 0,ee)}function ri(p,s,u,g,v,x,w){let I;I=p.projection.name==="globe"?r.ci(u,p):[...u],r.ad.multiply(I,I,s.matrix);let M=r.ad.multiply([],g,I);if(s.meshes)for(let A of s.meshes){if(A.material.alphaMode!=="BLEND"){w.push({mesh:A,depth:0,modelIndex:v,worldViewProjection:M,nodeModelMatrix:I});continue}let L=r._.transformMat4([],A.centroid,M);L[2]>0&&x.push({mesh:A,depth:L[2],modelIndex:v,worldViewProjection:M,nodeModelMatrix:I})}if(s.children)for(let A of s.children)ri(p,A,u,g,v,x,w)}function bi(p,s,u,g){let v=u.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),w=v.getShadowPassColorMode(),I=v.calculateShadowPassMatrixFromMatrix(s),M=x_(I);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,x,r.ag.disabled,w,r.af.backCCW,M,g.id,p.vertexBuffer,p.indexBuffer,p.segments,g.paint,u.transform.zoom,void 0,void 0)}function D_(p,s,u){let g=s.updateZoomBasedPaintProperties(),v=function(x,w,I){let M,A,L,F=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&F>0){let B=x.terrain,U=B.findDEMTileFor(I);U&&U.dem?M=r.ck.create(B,I,U):F=0}if(F===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),F===w.validForExaggeration&&(F===0||M&&M._demTile&&M._demTile.tileID===w.validForDEMTile.id&&M._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(let B in w.instancesPerModel){let U=w.instancesPerModel[B];for(let $=0;$<U.instancedDataArray.length;++$){let G=(M?F*M.getElevationAt(0|U.instancedDataArray.float32[16*$],0|U.instancedDataArray.float32[16*$+1],!0,!0):0)+U.instancesEvaluatedElevation[$];U.instancedDataArray.float32[16*$+6]=G,A=A?Math.min(w.terrainElevationMin,G):G,L=L?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=A||0,w.terrainElevationMax=L||0,w.validForExaggeration=F,w.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,s,u);(g||v)&&(s.uploaded=!1,s.upload(p.context))}let wi={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.b6([0,0,0],[r.a3,r.a3,0])};function Sr(p,s){let u=1<<p.canonical.z,g=s.getFreeCameraOptions().position,v=s.elevation,x=p.canonical.x/u,w=(p.canonical.x+1)/u,I=p.canonical.y/u,M=(p.canonical.y+1)/u,A=s._centerAltitude;if(v){let U=v.getMinMaxForTile(p);U&&U.max>A&&(A=U.max)}let L=r.at(g.x,x,w)-g.x,F=r.at(g.y,I,M)-g.y,B=r.ax(A,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(L*L+F*F+B*B))}function Ki(p,s,u,g,v,x,w){let I=p.context,M=p.renderPass==="shadow",A=p.shadowRenderer,L=M&&A?A.getShadowPassDepthMode():new r.ae(I.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D),F=p.isTileAffectedByFog(x);if(u.meshes)for(let B of u.meshes){let U=["MODEL_POSITION_ON_GPU"],$=[],G,q,H;g.instancedDataArray.length>20&&U.push("INSTANCED_ARRAYS");let J=Xo(p,s.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&U.push("RENDER_CUTOFF"),M&&A)G=p.getOrCreateProgram("modelDepth",{defines:U}),q=x_(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(u.matrix)),H=A.getShadowPassColorMode();else{du(U,$,B,p,s.lut),G=p.getOrCreateProgram("model",{defines:U,overrideFog:F});let te=B.material,ue=te.pbrMetallicRoughness,le=s.paint.get("model-opacity"),Q=s.paint.get("model-emissive-strength").constantOr(0);q=au(x.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,p,le,ue.baseColorFactor.toRenderColor(null),te.emissiveFactor,ue.metallicFactor,ue.roughnessFactor,te,Q,s,v),A&&(w.shadowUniformsInitialized?G.setShadowUniformValues(I,A.getShadowUniformValues()):(A.setupShadows(x.toUnwrapped(),G,"model-tile",x.overscaledZ),w.shadowUniformsInitialized=!0)),H=J.shouldRenderCutoff||le<1||te.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}p.uploadCommonUniforms(I,G,x.toUnwrapped(),null,J);let ee=B.material.doubleSided?r.af.disabled:r.af.backCCW;if(g.instancedDataArray.length>20)$.push(g.instancedDataBuffer),G.draw(p,I.gl.TRIANGLES,L,r.ag.disabled,H,ee,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,p.transform.zoom,void 0,$,g.instancedDataArray.length);else{let te=M?"u_instance":"u_normal_matrix";for(let ue=0;ue<g.instancedDataArray.length;++ue)q[te]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ue,16),G.draw(p,I.gl.TRIANGLES,L,r.ag.disabled,H,ee,q,s.id,B.vertexBuffer,B.indexBuffer,B.segments,s.paint,p.transform.zoom,void 0,$)}}if(u.children)for(let B of u.children)Ki(p,s,B,g,v,x,w)}let Jo=[1,-1,1];function Or(p,s,u,g){if(!u.modelManager)return!0;let v=u.modelManager;if(!u.shadowRenderer)return!0;let x=u.shadowRenderer,w=s.aabb,I=!0,M=p.maxHeight;if(M===0){let L=0;for(let F in p.instancesPerModel){let B=v.getModel(F,g);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):I=!1}M=p.maxScale*L*1.41+p.maxVerticalOffset,I&&(p.maxHeight=M)}w.max[2]=M,w.min[2]+=p.terrainElevationMin,w.max[2]+=p.terrainElevationMax,r._.transformMat4(w.min,w.min,s.tileMatrix),r._.transformMat4(w.max,w.max,s.tileMatrix);let A=w.intersects(x.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=A===2),A===0}function Cp(p,s){let u=p.uniformValues.u_cutoff_params[0],g=p.uniformValues.u_cutoff_params[1],v=p.uniformValues.u_cutoff_params[2],x=p.uniformValues.u_cutoff_params[3];return g===u||x===v?1:r.at(((s-u)/(g-u)-v)/(x-v),0,1)}function fo(p,s,u,g){if(s.pitch<20)return 1;let v=s.getWorldToCameraMatrix(),x=r.ad.multiply([],v,p),w=[...u.min,1],I=r.aA.transformMat4([],w,x),M=I,A=I;w[1]=u.max[1],I=r.aA.transformMat4([],w,x),M=I[1]<M[1]?I:M,A=I[1]>A[1]?I:A,w[0]=u.max[0],I=r.aA.transformMat4([],w,x),M=I[1]<M[1]?I:M,A=I[1]>A[1]?I:A,w[1]=u.min[1],I=r.aA.transformMat4([],w,x),M=I[1]<M[1]?I:M,A=I[1]>A[1]?I:A;let L=r.at(g[0],0,1),F=100*s.pixelsPerMeter*r.at(g[1],0,1),B=r.at(g[2],0,1),U=r._.lerp([],M,A,L),$=Math.tan(.5*s.fovX),G=-U[2]*$;if(F===0)return U[1]<-Math.abs(G)?B:1;let q=(-Math.abs(G)-U[1])/F,H=(ee,te,ue)=>(1-ue)*ee+ue*te,J=r.at(H(1,B,q),B,1);return H(1,J,r.at((s.pitch-20)/20,0,1))}class fu{}class pu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,u,g){{let F=this._storage.get(u.id);if(F)return F.lastUsedFrameIdx=s,F.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),w=new ArrayBuffer(x),I=new Int16Array(w);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));let M=new r.cm;for(let F=0;F<x/2;F+=3){let B=I[F],U=I[F+1],$=I[F+2];M.emplaceBack(B,U),M.emplaceBack(U,$),M.emplaceBack($,B)}let A=g.bindVertexArrayOES.current,L=new fu;return L.buf=new r.I(g,M),L.lastUsedFrameIdx=s,this._storage.set(u.id,L),g.bindVertexArrayOES.set(A),L.buf}update(s){for(let[u,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(u))}destroy(){for(let[s,u]of this._storage)u.buf.destroy(),this._storage.delete(s)}}let Ma=r.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class h1{constructor(s){let u=new r.cn,g=new r.bu;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=r.b.simpleSegment(0,0,u.length,g.length),this.vx=s.createVertexBuffer(u,Ma.members),this.idx=s.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let po={symbol:function(p,s,u,g,v){if(p.renderPass!=="translucent")return;let x=r.ag.disabled,w=p.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(A,L,F,B,U,$,G){let q=L.transform,H=U==="map",J=$==="map";for(let ee of A){let te=B.getTile(ee),ue=te.getBucket(F);if(!ue||!ue.text||!ue.text.segments.get().length)continue;let le=r.aD(ue.textSizeData,q.zoom),Q=Cl(ee,ue.getProjection(),q),ne=q.calculatePixelsToTileUnitsMatrix(te),re=ba(Q,te.tileID.canonical,J,H,q,ue.getProjection(),ne),pe=ue.hasIconTextFit()&&ue.hasIconData();if(le){let Ee=Math.pow(2,q.zoom-te.tileID.overscaledZ);E_(ue,H,J,G,r.bO,q,re,ee,Ee,le,pe)}}}(g,p,u,s,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v);let I=u.paint.get("icon-opacity").constantOr(1)!==0,M=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||M)?wp(p,s,u,g,x,w):(I&&wp(p,s,u,g,x,w,{onlyIcons:!0}),M&&wp(p,s,u,g,x,w,{onlyText:!0}),function(A,L,F,B){if(!A.symbolParams.useOcclusionQueries)return;let U=A.context.gl,$=A.transform,G=F.paint,q=G.get("icon-occlusion-opacity").constantOr(0)!==1,H=G.get("text-occlusion-opacity").constantOr(0)!==1;if(!q&&!H)return;let J=$.projection.name==="globe";for(let ee of B){let te=L.getTile(ee),ue=te.getBucket(F);if(!ue||ue.projection.name==="mercator"&&J||ue.fullyClipped)continue;if(ue.projection.name==="globe"){r.w(`Occlusion not supported for globe mode. Layer: ${F.type}`);continue}let le=Cl(ee,ue.getProjection(),$),Q=r.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,A.symbolParams.depthOffset,1),ne=r.ad.multiply([],Q,le),re=A.symbolParams.visualizeOcclusions!=="none"?1:A.symbolParams.occlusionQueryFrameWindow;for(let pe=0;pe<ue.symbolInstances.length;pe++){let Ee=ue.symbolInstances.get(pe),se=A.style.placement.opacities[Ee.crossTileID];if(se&&se.isHidden()||(A.frameCounter+pe)%re!=0)continue;let Te=Ee.tileAnchorX,Se=Ee.tileAnchorY,Be=Ee.zOffset,Ue;if(A.symbolParams.visualizeOcclusions==="none"){let et=ue.queries.get(pe);if(et){if(!et.isFree()){if(!et.isResultAvailable())continue;let it=et.consumeResult();Ee.occlusionState=it===0?0:1;continue}Ue=et}else Ue=new ul(A.context),ue.queries.set(pe,Ue)}let Ne=A.getOrCreateProgram("occlusion"),ye=A.symbolParams.occluderSize,Ae=b_(ne,[Te,Se,Be],[$.width,$.height],[ye,ye],A.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);A.terrain&&A.terrain.setupElevationDraw(te,Ne,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),A.symbolParams.visualizeOcclusions==="none"&&Ue&&Ue.begin();let Le=new r.ae(A.symbolParams.visualizeOcclusions==="zPass"?A.context.gl.ALWAYS:A.context.gl.LEQUAL,r.ae.ReadOnly,A.depthRangeFor3D);Ne.draw(A,U.TRIANGLES,Le,r.ag.disabled,A.symbolParams.visualizeOcclusions!=="none"?r.a.alphaBlendedNonPremultiplied:r.a.disabled,r.af.disabled,Ae,"occlusion",A.occlusionBuffers.vx,A.occlusionBuffers.idx,A.occlusionBuffers.segments),A.symbolParams.visualizeOcclusions==="none"&&Ue&&Ue.end()}}}(p,s,u,g)),s.map.showCollisionBoxes&&(lu(p,s,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),lu(p,s,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,u,g){if(p.renderPass!=="translucent")return;let v=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),w=u.paint.get("circle-stroke-opacity"),I=u.layout.get("circle-sort-key").constantOr(1)!==void 0,M=u.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||w.constantOr(1)===0))return;let A=p.context,L=A.gl,F=p.transform,B=p.depthModeForSublayer(0,r.ae.ReadOnly),U=r.ag.disabled,$=p.colorModeForDrapableLayerRenderPass(M),G=F.projection.name==="globe",q=[r.aj(F.center.lng),r.ak(F.center.lat)],H=[];for(let ee=0;ee<g.length;ee++){let te=g[ee],ue=s.getTile(te),le=ue.getBucket(u);if(!le||le.projection.name!==F.projection.name)continue;let Q=le.programConfigurations.get(u.id),ne=r.bR(u),re=p.isTileAffectedByFog(te);G&&ne.push("PROJECTION_GLOBE_VIEW");let pe=p.getOrCreateProgram("circle",{config:Q,defines:ne,overrideFog:re}),Ee=le.layoutVertexBuffer,se=le.globeExtVertexBuffer,Te=le.indexBuffer,Se=F.projection.createInversionMatrix(F,te.canonical),Be={programConfiguration:Q,program:pe,layoutVertexBuffer:Ee,globeExtVertexBuffer:se,indexBuffer:Te,uniformValues:r.bS(p,te,ue,Se,q,u),tile:ue};if(I){let Ue=le.segments.get();for(let Ne of Ue)H.push({segments:new r.b([Ne]),sortKey:Ne.sortKey,state:Be})}else H.push({segments:le.segments,sortKey:0,state:Be})}I&&H.sort((ee,te)=>ee.sortKey-te.sortKey);let J={useDepthForOcclusion:F.depthOcclusionForCircles};for(let ee of H){let{programConfiguration:te,program:ue,layoutVertexBuffer:le,globeExtVertexBuffer:Q,indexBuffer:ne,uniformValues:re,tile:pe}=ee.state,Ee=ee.segments;p.terrain&&p.terrain.setupElevationDraw(pe,ue,J),p.uploadCommonUniforms(A,ue,pe.tileID.toUnwrapped()),ue.draw(p,L.TRIANGLES,B,U,$,r.af.disabled,re,u.id,le,ne,Ee,u.paint,F.zoom,te,[Q])}},heatmap:function(p,s,u,g){if(u.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){let v=p.context,x=v.gl,w=r.ag.disabled,I=new r.a([x.ONE,x.ONE,x.ONE,x.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(U,$,G,q){let H=U.gl,J=$.width*q,ee=$.height*q;U.activeTexture.set(H.TEXTURE1),U.viewport.set([0,0,J,ee]);let te=G.heatmapFbo;if(!te||te&&(te.width!==J||te.height!==ee)){te&&te.destroy();let ue=H.createTexture();H.bindTexture(H.TEXTURE_2D,ue),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),te=G.heatmapFbo=U.createFramebuffer(J,ee,!0,null),function(le,Q,ne,re,pe,Ee){let se=le.gl;se.texImage2D(se.TEXTURE_2D,0,le.extRenderToTextureHalfFloat?se.RGBA16F:se.RGBA,pe,Ee,0,se.RGBA,le.extRenderToTextureHalfFloat?se.HALF_FLOAT:se.UNSIGNED_BYTE,null),re.colorAttachment.set(ne)}(U,0,ue,te,J,ee)}else H.bindTexture(H.TEXTURE_2D,te.colorAttachment.get()),U.bindFramebuffer.set(te.framebuffer)})(v,p,u,p.transform.projection.name==="globe"?.5:.25),v.clear({color:r.C.transparent});let M=p.transform,A=M.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:[],F=A?r.af.frontCCW:r.af.disabled,B=[r.aj(M.center.lng),r.ak(M.center.lat)];for(let U=0;U<g.length;U++){let $=g[U];if(s.hasRenderableParent($))continue;let G=s.getTile($),q=G.getBucket(u);if(!q||q.projection.name!==M.projection.name)continue;let H=p.isTileAffectedByFog($),J=q.programConfigurations.get(u.id),ee=p.getOrCreateProgram("heatmap",{config:J,defines:L,overrideFog:H}),{zoom:te}=p.transform;p.terrain&&p.terrain.setupElevationDraw(G,ee),p.uploadCommonUniforms(v,ee,$.toUnwrapped());let ue=M.projection.createInversionMatrix(M,$.canonical);ee.draw(p,x.TRIANGLES,r.ae.disabled,w,I,F,Ia(p,$,G,ue,B,te,u.paint.get("heatmap-intensity")),u.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,u.paint,p.transform.zoom,J,A?[q.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,x){let w=v.context,I=w.gl,M=x.heatmapFbo;if(!M)return;w.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),w.activeTexture.set(I.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new r.T(w,x.colorRamp,I.RGBA)),A.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,I.TRIANGLES,r.ae.disabled,r.ag.disabled,v.colorModeForRenderPass(),r.af.disabled,((L,F,B,U)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(p,u))},line:function(p,s,u,g){if(p.renderPass!=="translucent")return;let v=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let w=u.paint.get("line-emissive-strength"),I=u.paint.get("line-occlusion-opacity"),M=p.context,A=M.gl,L=u.layout.get("line-z-offset"),F=!L.isConstant()||!!L.constantOr(0),B=F?new r.ae(p.depthOcclusion?A.GREATER:A.LEQUAL,r.ae.ReadOnly,p.depthRangeFor3D):p.depthModeForSublayer(0,r.ae.ReadOnly),U=p.colorModeForDrapableLayerRenderPass(w),$=p.terrain&&p.terrain.renderingToTexture,G=$?1:r.e.devicePixelRatio,q=u.paint.get("line-dasharray"),H=q.constantOr(1),J=u.layout.get("line-cap"),ee=q.constantOr(null),te=J.constantOr(null),ue=u.paint.get("line-pattern"),le=ue.constantOr(1),Q=ue.constantOr(null),ne=u.paint.get("line-opacity").constantOr(1),re=!le&&ne!==1||p.depthOcclusion&&I>0&&I<1,pe=u.paint.get("line-gradient"),Ee=le?"linePattern":"line",se=r.bT(u),Te;if($&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(re=!1),I!==0&&p.depthOcclusion){let Be=u.paint._values["line-opacity"];Be&&Be.value&&Be.value.kind==="constant"?Te=Be.value:r.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}if(F&&(p.forceTerrainMode=!0),!F&&I!==0&&p.terrain&&!$)return void r.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Se=re&&F?p.stencilModeFor3D():r.ag.disabled;for(let Be of g){let Ue=s.getTile(Be);if(le&&!Ue.patternsLoaded())continue;let Ne=Ue.getBucket(u);if(!Ne)continue;p.prepareDrawTile();let ye=Ne.programConfigurations.get(u.id),Ae=p.isTileAffectedByFog(Be),Le=p.getOrCreateProgram(Ee,{config:ye,defines:F?[...se,"ELEVATED"]:se,overrideFog:Ae});if(Q&&Ue.imageAtlas){let tt=Ue.imageAtlas.patternPositions[Q.toString()];tt&&ye.setConstantPatternPositions(tt)}if(!le&&ee&&te&&Ue.lineAtlas){let tt=Ue.lineAtlas.getDash(ee,te);tt&&ye.setConstantPatternPositions(tt)}let[et,it]=u.paint.get("line-trim-offset");(te==="round"||te==="square")&&et!==it&&(et===0&&(et-=1),it===1&&(it+=1));let nt=$?Be.projMatrix:null,ze=le?r.bU(p,Ue,u,nt,G,[et,it]):r.bV(p,Ue,u,nt,Ne.lineClipsArray.length,G,[et,it]);if(pe){let tt=Ne.gradients[u.id],ut=tt.texture;if(u.gradientVersion!==tt.version){let At=256;if(u.stepInterpolant){let Bt=s.getSource().maxzoom,on=Be.canonical.z===Bt?Math.ceil(1<<p.transform.maxZoom-Be.canonical.z):1;At=r.at(r.bW(Ne.maxLineLength/r.a3*1024*on),256,M.maxTextureSize)}tt.gradient=r.bX({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:At,image:tt.gradient||void 0,clips:Ne.lineClipsArray}),tt.texture?tt.texture.update(tt.gradient):tt.texture=new r.T(M,tt.gradient,A.RGBA),tt.version=u.gradientVersion,ut=tt.texture}M.activeTexture.set(A.TEXTURE1),ut.bind(u.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}H&&(M.activeTexture.set(A.TEXTURE0),Ue.lineAtlasTexture&&Ue.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),ye.updatePaintBuffers()),le&&(M.activeTexture.set(A.TEXTURE0),Ue.imageAtlasTexture&&Ue.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ye.updatePaintBuffers()),F&&p.terrain.setupElevationDraw(Ue,Le),p.uploadCommonUniforms(M,Le,Be.toUnwrapped());let Ve=tt=>{Te!=null&&(Te.value=ne*I),Le.draw(p,A.TRIANGLES,B,tt,U,r.af.disabled,ze,u.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,u.paint,p.transform.zoom,ye,[Ne.layoutVertexBuffer2,Ne.patternVertexBuffer,Ne.zOffsetVertexBuffer]),Te!=null&&(Te.value=ne)};if(re&&!F){let tt=p.stencilModeForClipping(Be).ref;tt===0&&$&&M.clear({stencil:0});let ut={func:A.EQUAL,mask:255};ze.u_alpha_discard_threshold=.8,Ve(new r.ag(ut,tt,255,A.KEEP,A.KEEP,A.INVERT)),ze.u_alpha_discard_threshold=0,Ve(new r.ag(ut,tt,255,A.KEEP,A.KEEP,A.KEEP))}else re&&F&&(ze.u_alpha_discard_threshold=.001),Ve(F?Se:p.stencilModeForClipping(Be))}re&&(p.resetStencilClippingMasks(),$&&M.clear({stencil:0})),I===0||p.depthOcclusion||$||p.layersWithOcclusionOpacity.push(p.currentLayer),F&&(p.forceTerrainMode=!1)},fill:function(p,s,u,g){let v=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let w=u.paint.get("fill-emissive-strength"),I=p.colorModeForDrapableLayerRenderPass(w),M=u.paint.get("fill-pattern"),A=p.opaquePassEnabledForLayer()&&!M.constantOr(1)&&v.constantOr(r.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===A){let L=p.depthModeForSublayer(1,p.renderPass==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly);Ep(p,s,u,g,L,I,!1)}if(p.renderPass==="translucent"&&u.paint.get("fill-antialias")){let L=p.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,r.ae.ReadOnly);Ep(p,s,u,g,L,I,!0)}},"fill-extrusion":function(p,s,u,g){let v=u.paint.get("fill-extrusion-opacity"),x=p.context,w=x.gl,I=p.terrain,M=I&&I.renderingToTexture;if(v===0)return;let A=p.conflationActive&&p.style.isLayerClipped(u,s.getSource()),L=p.style.order.indexOf(u.fqid);if(A&&function(F,B,U,$,G){for(let q of $){let H=B.getTile(q).getBucket(U);H&&(H.updateReplacement(q,F.replacementSource,G),H.uploadCentroid(F.context))}}(p,s,u,g,L),I||A)for(let F of g){let B=s.getTile(F).getBucket(u);B&&Kh(p.context,s,F,B,u,I,A)}if(p.renderPass==="shadow"&&p.shadowRenderer){let F=p.shadowRenderer;if(I&&v<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let B=F.getShadowPassDepthMode(),U=F.getShadowPassColorMode();Al(p,s,u,g,B,r.ag.disabled,U,A)}else if(p.renderPass==="translucent"){let F=!u.paint.get("fill-extrusion-pattern").constantOr(1),B=u.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!M&&B.a!==0){let U=new r.ae(p.context.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D);v===1&&F?Al(p,s,u,g,U,r.ag.disabled,r.a.unblended,A):(Al(p,s,u,g,U,r.ag.disabled,r.a.disabled,A),Al(p,s,u,g,U,p.stencilModeFor3D(),p.colorModeForRenderPass(),A),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&F&&(!I&&p.transform.projection.name!=="globe"||M)){let U=u.paint.get("fill-extrusion-opacity"),$=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=u.paint.get("fill-extrusion-flood-light-intensity"),H=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),J=$>0&&G>0,ee=q>0,te=(le,Q,ne)=>(1-ne)*le+ne*Q,ue=le=>{let Q=p.depthModeForSublayer(1,r.ae.ReadOnly,w.LEQUAL,!0),ne=u.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),re=te(.1,3,ne),pe=p._showOverdrawInspector;if(!pe){let Ee=new r.ag({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),se=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0],w.MIN);vi(p,s,u,g,Q,Ee,se,r.af.disabled,le,"sdf",U,$,G,q,H,re,A,!1)}{let Ee=pe?r.ag.disabled:new r.ag({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),se=pe?p.colorModeForRenderPass():new r.a([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],r.C.transparent,[!0,!0,!0,!0]);vi(p,s,u,g,Q,Ee,se,r.af.disabled,le,"color",U,$,G,q,H,re,A,!1)}};if(M){let le=(Q,ne,re)=>{let pe=p.depthModeForSublayer(1,r.ae.ReadOnly,w.LEQUAL,!1),Ee=u.paint.get(Q?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),se=te(.1,3,Ee);{let Te=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0]);vi(p,s,u,g,pe,r.ag.disabled,Te,r.af.disabled,Q,"clear",U,$,G,q,H,se,A,ne)}{let Te=new r.ag({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Se=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0],w.MIN);vi(p,s,u,g,pe,Te,Se,r.af.disabled,Q,"sdf",U,$,G,q,H,se,A,ne)}{let Te=Q?w.ZERO:w.ONE_MINUS_DST_ALPHA,Se=new r.ag({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Be=new r.a([Te,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],r.C.transparent,[!0,!0,!0,!0]);vi(p,s,u,g,pe,Se,Be,r.af.disabled,Q,"color",U,$,G,q,H,se,A,ne)}{let Te=new r.a([w.ONE,w.ONE,w.ONE,Q?w.ZERO:w.ONE],r.C.transparent,[!1,!1,!1,!0],Q?w.FUNC_ADD:w.MAX);vi(p,s,u,g,pe,r.ag.disabled,Te,r.af.disabled,Q,"clear",U,$,G,q,H,se,A,ne,re)}};if(J||ee){let Q;if(p.prepareDrawTile(),I){let ne=I.drapeBufferSize[0],re=I.drapeBufferSize[1];Q=I.framebufferCopyTexture,Q&&(!Q||Q.size[0]===ne&&Q.size[1]===re)||(Q&&Q.destroy(),Q=I.framebufferCopyTexture=new r.T(x,new r.i({width:ne,height:re}),w.RGBA)),Q.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,0,0,ne,re,0)}J&&le(!0,!1,Q),ee&&le(!1,!0,Q)}}else J&&ue(!0),ee&&ue(!1)}}},hillshade:function(p,s,u,g){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;let v=p.context,x=p.terrain&&p.terrain.renderingToTexture,[w,I]=p.renderPass!=="translucent"||x?[{},g]:p.stencilConfigForOverlap(g);for(let M of I){let A=s.getTile(M);if(A.needsHillshadePrepare&&p.renderPass==="offscreen")Po(p,A,u);else if(p.renderPass==="translucent"){let L=p.depthModeForSublayer(0,r.ae.ReadOnly),F=u.paint.get("hillshade-emissive-strength"),B=p.colorModeForDrapableLayerRenderPass(F),U=x&&p.terrain?p.terrain.stencilModeForRTTOverlap(M):w[M.overscaledZ];r1(p,M,A,u,L,U,B)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,u,g,v,x){if(p.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;let w=p.transform.projection.name==="globe",I=u.paint.get("raster-elevation")!==0,M=I&&w;if(p.renderElevatedRasterBackface&&!M)return;let A=p.context,L=A.gl,F=s.getSource(),B=function(le,Q,ne,re){let pe=Q.paint.get("raster-color"),Ee=le.type==="raster-array",se=[],Te=Q.paint.get("raster-resampling"),Se=Q.paint.get("raster-color-mix"),Be=Q.paint.get("raster-color-range"),Ue=[Se[0],Se[1],Se[2],0],Ne=Se[3],ye=Te==="nearest"?re.NEAREST:re.LINEAR;if(Ee&&(se.push("RASTER_ARRAY"),pe||se.push("RASTER_COLOR"),Te==="linear"&&se.push("RASTER_ARRAY_LINEAR"),ye=re.NEAREST,!Be&&le.rasterLayers)){let Ae=le.rasterLayers.find(({id:Le})=>Le===Q.sourceLayer);Ae&&Ae.fields&&Ae.fields.range&&(Be=Ae.fields.range)}if(Be=Be||[0,1],pe){se.push("RASTER_COLOR"),ne.activeTexture.set(re.TEXTURE2),Q.updateColorRamp(Be);let Ae=Q.colorRampTexture;Ae||(Ae=Q.colorRampTexture=new r.T(ne,Q.colorRamp,re.RGBA)),Ae.bind(re.LINEAR,re.CLAMP_TO_EDGE)}return{mix:Ue,range:Be,offset:Ne,defines:se,resampling:ye}}(F,u,A,L);if(F instanceof r.bm&&!g.length&&!w)return;let U=u.paint.get("raster-emissive-strength"),$=p.colorModeForDrapableLayerRenderPass(U),G=p.terrain&&p.terrain.renderingToTexture,q=!p.options.moving,H=u.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(F instanceof r.bm&&!g.length&&(F.onNorthPole||F.onSouthPole)){let le=I?p.stencilModeFor3D():r.ag.disabled;return void uu(!!F.onNorthPole,null,p,s,u,U,B,r.af.disabled,le)}if(!g.length)return;let[J,ee]=F instanceof r.bm||G?[{},g]:p.stencilConfigForOverlap(g),te=ee[ee.length-1].overscaledZ;M&&B.defines.push("PROJECTION_GLOBE_VIEW"),I&&B.defines.push("RENDER_CUTOFF");let ue=(le,Q,ne)=>{for(let re of le){let pe=re.toUnwrapped(),Ee=s.getTile(re);if(G&&(!Ee||!Ee.hasData()))continue;A.activeTexture.set(L.TEXTURE0);let se=c1(Ee,F,u,B);if(!se||!se.texture)continue;let{texture:Te,mix:Se,offset:Be,tileSize:Ue,buffer:Ne}=se,ye,Ae;G?(ye=r.ae.disabled,Ae=re.projMatrix):I?(ye=new r.ae(L.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D),Ae=w?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(pe,q)):(ye=p.depthModeForSublayer(re.overscaledZ-te,u.paint.get("raster-opacity")===1?r.ae.ReadWrite:r.ae.ReadOnly,L.LESS),Ae=p.transform.calculateProjMatrix(pe,q));let Le=p.terrain&&G?p.terrain.stencilModeForRTTOverlap(re):J[re.overscaledZ],et=x?0:u.paint.get("raster-fade-duration");Ee.registerFadeDuration(et);let it=s.findLoadedParent(re,0),nt=Vh(Ee,it,s,p.transform,et),ze,Ve;p.terrain&&p.terrain.prepareDrawTile(),A.activeTexture.set(L.TEXTURE0),Te.bind(H,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE1),it?(it.texture&&it.texture.bind(H,L.CLAMP_TO_EDGE),ze=Math.pow(2,it.tileID.overscaledZ-Ee.tileID.overscaledZ),Ve=[Ee.tileID.canonical.x*ze%1,Ee.tileID.canonical.y*ze%1]):Te.bind(H,L.CLAMP_TO_EDGE),Te.useMipmap&&A.extTextureFilterAnisotropic&&p.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let tt=p.transform,ut,At=I?_n(tt):[0,0,0,0],Bt,on,tn,Cn,Ot,Tn=0;if(M&&F instanceof r.bm&&F.coordinates.length>3)Bt=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0)))),on=Float32Array.from(tt.globeMatrix),tn=Float32Array.from(r.bb(tt)),Cn=[r.aj(tt.center.lng),r.ak(tt.center.lat)],ut=F.elevatedGlobePerspectiveTransform,Ot=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){let Lt=r.bc(re.canonical);Tn=r.bd(Lt.getCenter().lat),Bt=Float32Array.from(r.bf(r.bg(re.canonical))),on=Float32Array.from(tt.globeMatrix),tn=Float32Array.from(r.bb(tt)),Cn=[r.aj(tt.center.lng),r.ak(tt.center.lat)],ut=[0,0],Ot=Float32Array.from(r.be(re.canonical,Lt,Tn,tt.worldSize/tt._pixelsPerMercatorPixel))}else ut=F instanceof r.bm?F.perspectiveTransform:[0,0],Bt=new Float32Array(16),on=new Float32Array(9),tn=new Float32Array(16),Cn=[0,0],Ot=new Float32Array(9);let Un=iu(Ae,Bt,on,tn,Ot,Ve||[0,0],r.a1(p.transform.zoom),Cn,At,ze||1,nt,u,ut,I?u.paint.get("raster-elevation"):0,2,Se,Be,B.range,Ue,Ne,U),An=p.isTileAffectedByFog(re),Qt=p.getOrCreateProgram("raster",{defines:B.defines,overrideFog:An});if(p.uploadCommonUniforms(A,Qt,pe),F instanceof r.bm){let Lt=F.elevatedGlobeVertexBuffer,qn=F.elevatedGlobeIndexBuffer;if(G||!w)F.boundsBuffer&&F.boundsSegments&&Qt.draw(p,L.TRIANGLES,ye,r.ag.disabled,$,r.af.disabled,Un,u.id,F.boundsBuffer,p.quadTriangleIndexBuffer,F.boundsSegments);else if(Lt&&qn){let Yn=tt.zoom<=r.b1?F.elevatedGlobeSegments:F.getSegmentsForLongitude(tt.center.lng);Yn&&Qt.draw(p,L.TRIANGLES,ye,r.ag.disabled,$,Q,Un,u.id,Lt,qn,Yn)}}else if(M){ye=new r.ae(L.LEQUAL,r.ae.ReadOnly,p.depthRangeFor3D);let Lt=p.globeSharedBuffers;if(Lt){let[qn,Yn,sn]=Lt.getGridBuffers(Tn,!1);Qt.draw(p,L.TRIANGLES,ye,ne||Le,p.colorModeForRenderPass(),Q,Un,u.id,qn,Yn,sn)}}else{let{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:qn,tileBoundsSegments:Yn}=p.getTileBoundsBuffers(Ee);Qt.draw(p,L.TRIANGLES,ye,Le,$,r.af.disabled,Un,u.id,Lt,qn,Yn)}}if(!(F instanceof r.bm)&&M)for(let re of le){let pe=re.canonical.y===(1<<re.canonical.z)-1;re.canonical.y===0&&uu(!0,re,p,s,u,U,B,Q,ne||r.ag.disabled),pe&&uu(!1,re,p,s,u,U,B,Q===r.af.frontCW?r.af.backCW:r.af.frontCW,ne||r.ag.disabled)}};M?ue(ee,p.renderElevatedRasterBackface?r.af.backCW:r.af.frontCW,p.stencilModeFor3D()):ue(ee,r.af.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,s,u,g,v,x){p.renderPass==="offscreen"&&function(w,I,M,A){if(!A.length)return;let L=w.context,F=L.gl,B=I.getSource();if(!(B instanceof Tl))return;let U=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count"))),$=M.particlePositionRGBAImage;if(!$||$.width!==U){let ee=function(te){let ue=te*te,le=new Uint8Array(4*ue),Q=function(re){return re|=0,re=Math.imul(2747636419^re,2654435769),re=Math.imul(re^re>>>16,2654435769),((re=Math.imul(re^re>>>16,2654435769))>>>0)/4294967296},ne=1/1.3;for(let re=0;re<ue;re++){let pe=ne*(Q(2*re+0)+Os),Ee=ne*(Q(2*re+1)+Os),se=255*pe%1,Te=255*Ee%1,Se=se,Be=Ee-Te/255,Ue=Te;le[4*re+0]=255*(pe-se/255),le[4*re+1]=255*Se,le[4*re+2]=255*Be,le[4*re+3]=255*Ue}return le}(U);$=M.particlePositionRGBAImage=new r.i({width:U,height:U},ee)}let G=M.particleFramebuffer;G?G.width!==U&&(G.destroy(),G=M.particleFramebuffer=L.createFramebuffer(U,U,!0,null)):G=M.particleFramebuffer=L.createFramebuffer(U,U,!0,null);let q=[];for(let ee of A){let te=I.getTile(ee);if(!(te instanceof r.c3))continue;let ue=wt(te,B,M);if(!ue)continue;let le=[te.tileSize,te.tileSize],Q=M.tileFramebuffer;Q||(Q=M.tileFramebuffer=L.createFramebuffer(le[0],le[1],!0,null));let ne=te.rasterParticleState;ne||(ne=te.rasterParticleState=new Wi(L,ee,le,$));let re=ne.update(M.lastInvalidatedAt);ne.particleTextureDimension!==U&&ne.updateParticleTexture(ee,$);let pe=ne.targetColorTexture;ne.targetColorTexture=ne.backgroundColorTexture,ne.backgroundColorTexture=pe;let Ee=ne.particleTexture0;ne.particleTexture0=ne.particleTexture1,ne.particleTexture1=Ee,q.push([ee,ue,ne,re])}if(q.length===0)return;let H=r.e.now(),J=M.previousDrawTimestamp?.001*(H-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=H,M.hasColorMap()){L.activeTexture.set(F.TEXTURE0+2);let ee=M.colorRampTexture;ee||(ee=M.colorRampTexture=new r.T(L,M.colorRamp,F.RGBA)),ee.bind(F.LINEAR,F.CLAMP_TO_EDGE)}L.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(ee,te,ue){let le=ee.context,Q=le.gl,ne=te.tileFramebuffer;le.activeTexture.set(Q.TEXTURE0);let re={u_texture:0,u_opacity:1.05*(Ee=te.paint.get("raster-particle-fade-opacity-factor"))/(Ee+.05)},pe=ee.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ee;for(let se of ue){let[,,Te,Se]=se;ne.colorAttachment.set(Te.targetColorTexture.texture),le.viewport.set([0,0,ne.width,ne.height]),le.clear({color:r.C.transparent}),Se&&(Te.backgroundColorTexture.bind(Q.NEAREST,Q.CLAMP_TO_EDGE),pe.draw(ee,Q.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,re,te.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments))}}(w,M,q),function(ee,te,ue,le){let Q=ee.context,ne=Q.gl,re=ue.tileFramebuffer,pe=ee.transform.projection.name==="globe",Ee=ue.paint.get("raster-particle-max-speed");for(let se of le){let[Te,Se,Be]=se;Q.activeTexture.set(ne.TEXTURE0+0),Se.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),re.colorAttachment.set(Be.targetColorTexture.texture);let Ue=ee.getOrCreateProgram("rasterParticleDraw",{defines:Se.defines,overrideFog:!1});Q.activeTexture.set(ne.TEXTURE0+1);let Ne=Se.scalarData?[]:[0,1,2,3].map(Le=>r.bZ[Le](Te));Ne.push(Te);let ye=Te.canonical.x,Ae=Te.canonical.y;for(let Le of Ne){let et=te.getTile(pe?Le.wrapped():Le);if(!et)continue;let it=et.rasterParticleState;if(!it)continue;let nt=Le.canonical.x+(1<<Le.canonical.z)*(Le.wrap-Te.wrap),ze=Le.canonical.y;it.particleTexture0.bind(ne.NEAREST,ne.CLAMP_TO_EDGE);let Ve=xp(1,it.particleTexture0.size[0],[nt-ye,ze-Ae],0,Se.texture.size,2,Ee,Se.textureOffset,Se.scale,Se.offset);Ue.draw(ee,ne.POINTS,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,Ve,ue.id,it.particleIndexBuffer,void 0,it.particleSegment)}}}(w,I,M,q),L.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(ee,te,ue,le){let Q=ee.context,ne=Q.gl,re=te.paint.get("raster-particle-max-speed"),pe=le*te.paint.get("raster-particle-speed-factor")*.15,Ee=function(Te){return Math.pow(Te,6)}(.01+1*te.paint.get("raster-particle-reset-rate-factor")),se=te.particleFramebuffer;Q.viewport.set([0,0,se.width,se.height]);for(let Te of ue){let[,Se,Be]=Te;Q.activeTexture.set(ne.TEXTURE0+0),Se.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Q.activeTexture.set(ne.TEXTURE0+1);let Ue=Be.particleTexture0;Ue.bind(ne.NEAREST,ne.CLAMP_TO_EDGE);let Ne=o1(1,Ue.size[0],0,Se.texture.size,re,pe,Ee,Se.textureOffset,Se.scale,Se.offset);se.colorAttachment.set(Be.particleTexture1.texture),Q.clear({color:r.C.transparent}),ee.getOrCreateProgram("rasterParticleUpdate",{defines:Se.defines}).draw(ee,ne.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,Ne,te.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments)}}(w,M,q,J)}(p,s,u,g),p.renderPass==="translucent"&&(function(w,I,M,A,L){let F=w.context,B=F.gl,U=!w.options.moving,$=w.transform.projection.name==="globe";if(!A.length)return;let[G,q]=w.stencilConfigForOverlap(A),H=[];$&&H.push("PROJECTION_GLOBE_VIEW");let J=w.stencilModeFor3D();for(let ee of q){let te=ee.toUnwrapped(),ue=I.getTile(ee);if(!ue.rasterParticleState)continue;let le=ue.rasterParticleState,Q=100;ue.registerFadeDuration(Q);let ne=I.findLoadedParent(ee,0),re=Vh(ue,ne,I,w.transform,Q),pe,Ee;w.terrain&&w.terrain.prepareDrawTile(),F.activeTexture.set(B.TEXTURE0),le.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),F.activeTexture.set(B.TEXTURE1),ne&&ne.rasterParticleState?(ne.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),pe=Math.pow(2,ne.tileID.overscaledZ-ue.tileID.overscaledZ),Ee=[ue.tileID.canonical.x*pe%1,ue.tileID.canonical.y*pe%1]):le.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);let se=$?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(te,U),Te=w.transform,Se=I_(Te),Be=r.bc(ee.canonical),Ue=r.bd(Be.getCenter().lat),Ne,ye,Ae,Le,et;$?(Ne=Float32Array.from(r.bf(r.bg(ee.canonical))),ye=Float32Array.from(Te.globeMatrix),Ae=Float32Array.from(r.bb(Te)),Le=[r.aj(Te.center.lng),r.ak(Te.center.lat)],et=Float32Array.from(r.be(ee.canonical,Be,Ue,Te.worldSize/Te._pixelsPerMercatorPixel))):(Ne=new Float32Array(16),ye=new Float32Array(9),Ae=new Float32Array(16),Le=[0,0],et=new Float32Array(9));let it=vp(se,Ne,ye,Ae,et,Ee||[0,0],r.a1(w.transform.zoom),Le,Se,pe||1,re,250),nt=w.isTileAffectedByFog(ee),ze=w.getOrCreateProgram("rasterParticle",{defines:H,overrideFog:nt});if(w.uploadCommonUniforms(F,ze,te),$){let Ve=new r.ae(B.LEQUAL,r.ae.ReadWrite,w.depthRangeFor3D),tt=0,ut=w.globeSharedBuffers;if(ut){let[At,Bt,on]=ut.getGridBuffers(Ue,tt!==0);ze.draw(w,B.TRIANGLES,Ve,J,r.a.alphaBlended,r.af.backCCW,it,M.id,At,Bt,on)}}else{let Ve=w.depthModeForSublayer(0,r.ae.ReadOnly),tt=G[ee.overscaledZ],{tileBoundsBuffer:ut,tileBoundsIndexBuffer:At,tileBoundsSegments:Bt}=w.getTileBoundsBuffers(ue);ze.draw(w,B.TRIANGLES,Ve,tt,r.a.alphaBlended,r.af.disabled,it,M.id,ut,At,Bt)}}w.resetStencilClippingMasks()}(p,s,u,g),p.style.map.triggerRepaint())},background:function(p,s,u,g){let v=u.paint.get("background-color"),x=u.paint.get("background-opacity"),w=u.paint.get("background-emissive-strength");if(x===0)return;let I=p.context,M=I.gl,A=p.transform,L=A.tileSize,F=u.paint.get("background-pattern"),B;if(F!==void 0&&(F===null||(B=p.imageManager.getPattern(F.toString(),u.scope,p.style.getLut(u.scope)),!B)))return;let U=!F&&v.a===1&&x===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==U)return;let $=r.ag.disabled,G=p.depthModeForSublayer(0,U==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly),q=p.colorModeForDrapableLayerRenderPass(w),H=F?"backgroundPattern":"background",J,ee=g;ee||(J=p.getBackgroundTiles(),ee=Object.values(J).map(te=>te.tileID)),F&&(I.activeTexture.set(M.TEXTURE0),p.imageManager.bind(p.context,u.scope));for(let te of ee){let ue=p.isTileAffectedByFog(te),le=p.getOrCreateProgram(H,{overrideFog:ue}),Q=te.toUnwrapped(),ne=g?te.projMatrix:p.transform.calculateProjMatrix(Q);p.prepareDrawTile();let re=s?s.getTile(te):J?J[te.key]:new r.by(te,L,A.zoom,p),pe=F?v_(ne,w,x,p,0,u.scope,B,{tileID:te,tileSize:L}):su(ne,w,x,v.toRenderColor(u.lut));p.uploadCommonUniforms(I,le,Q);let{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:se,tileBoundsSegments:Te}=p.getTileBoundsBuffers(re);le.draw(p,M.TRIANGLES,G,$,q,r.af.disabled,pe,u.id,Ee,se,Te)}},sky:function(p,s,u){let g=p._atmosphere?r.a1(p.transform.zoom):1,v=u.paint.get("sky-opacity")*g;if(v===0)return;let x=p.context,w=u.paint.get("sky-type"),I=new r.ae(x.gl.LEQUAL,r.ae.ReadOnly,[0,1]),M=p.frameCounter/1e3%1;w==="atmosphere"?p.renderPass==="offscreen"?u.needsSkyboxCapture(p)&&(function(A,L,F,B){let U=A.context,$=U.gl,G=L.skyboxFbo;if(!G){G=L.skyboxFbo=U.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Ol(U),L.skyboxTexture=U.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,L.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let ee=0;ee<6;++ee)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(G.framebuffer),U.viewport.set([0,0,32,32]);let q=L.getCenter(A,!0),H=A.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);r.ad.identity(J),r.ad.rotateY(J,J,.5*-Math.PI),ko(A,L,H,J,q,0),r.ad.identity(J),r.ad.rotateY(J,J,.5*Math.PI),ko(A,L,H,J,q,1),r.ad.identity(J),r.ad.rotateX(J,J,.5*-Math.PI),ko(A,L,H,J,q,2),r.ad.identity(J),r.ad.rotateX(J,J,.5*Math.PI),ko(A,L,H,J,q,3),r.ad.identity(J),ko(A,L,H,J,q,4),r.ad.identity(J),r.ad.rotateY(J,J,Math.PI),ko(A,L,H,J,q,5),U.viewport.set([0,0,A.width,A.height])}(p,u),u.markSkyboxValid(p)):p.renderPass==="sky"&&function(A,L,F,B,U){let $=A.context,G=$.gl,q=A.transform,H=A.getOrCreateProgram("skybox");$.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,L.skyboxTexture);let J=((ee,te,ue,le,Q)=>({u_matrix:ee,u_sun_direction:te,u_cubemap:0,u_opacity:le,u_temporal_offset:Q}))(q.skyboxMatrix,L.getCenter(A,!1),0,B,U);A.uploadCommonUniforms($,H),H.draw(A,G.TRIANGLES,F,r.ag.disabled,A.colorModeForRenderPass(),r.af.backCW,J,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(p,u,I,v,M):w==="gradient"&&p.renderPass==="sky"&&function(A,L,F,B,U){let $=A.context,G=$.gl,q=A.transform,H=A.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Ol($)),$.activeTexture.set(G.TEXTURE0);let J=L.colorRampTexture;J||(J=L.colorRampTexture=new r.T($,L.colorRamp,G.RGBA)),J.bind(G.LINEAR,G.CLAMP_TO_EDGE);let ee=((te,ue,le,Q,ne)=>({u_matrix:te,u_color_ramp:0,u_center_direction:ue,u_radius:r.ab(le),u_opacity:Q,u_temporal_offset:ne}))(q.skyboxMatrix,L.getCenter(A,!1),L.paint.get("sky-gradient-radius"),B,U);A.uploadCommonUniforms($,H),H.draw(A,G.TRIANGLES,F,r.ag.disabled,A.colorModeForRenderPass(),r.af.backCW,ee,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(p,u,I,v,M)},debug:function(p,s,u,g,v,x){for(let w=0;w<u.length;w++)if(v){let A=new r.C(g.r*.8,g.g*.8,g.b*.8,1);lt(p,s,u[w],g,-1,-1,x),lt(p,s,u[w],g,-1,1,x),lt(p,s,u[w],g,1,1,x),lt(p,s,u[w],g,1,-1,x),lt(p,s,u[w],A,0,0,x)}else lt(p,s,u[w],g,0,0,x)},custom:function(p,s,u,g){let v=p.context,x=u.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&u.isDraped(s)){if(p.renderPass==="offscreen"){let w=x.prerender;if(w){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){let I=p.transform.pointMerc;w.call(x,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a1(p.transform.zoom),[I.x,I.y],p.transform.pixelsPerMeterRatio)}else w.call(x,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){let I=x.renderToTile;if(I){let M=g[0].canonical,A=new r.Y(M.x+g[0].wrap*(1<<M.z),M.y,M.z);v.setDepthMode(r.ae.disabled),v.setStencilMode(r.ag.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),I.call(x,v.gl,A),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(r.ag.disabled);let w=x.renderingMode==="3d"?new r.ae(p.context.gl.LEQUAL,r.ae.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,r.ae.ReadOnly);if(v.setDepthMode(w),p.transform.projection.name==="globe"){let I=p.transform.pointMerc;x.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a1(p.transform.zoom),[I.x,I.y],p.transform.pixelsPerMeterRatio)}else x.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,s,u,g){if(p.renderPass==="opaque")return;let v=u.paint.get("model-opacity");if(v===0)return;let x=u.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!x||p.terrain&&v<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let w=p.shadowRenderer,I=u.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,I||(w.enabled=!1));let M=()=>{w&&(w.useNormalOffset=!0,I||(w.enabled=!0))},A=s.getSource();if(p.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(H,J,ee,te,ue){let le=H.transform;if(le.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${le.projection.name} projection is not yet implemented`);let Q=le.getFreeCameraOptions().position;if(!H.modelManager)return;let ne=H.modelManager;ee.modelManager=ne;let re=H.shadowRenderer;if(!ee._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let pe=ee._unevaluatedLayout._values["model-id"],Ee=xt({},ee.layout.get("model-id").parameters),se=H.style.order.indexOf(ee.fqid);for(let Te of te){let Se=J.getTile(Te).getBucket(ee);if(!Se||Se.projection.name!==le.projection.name)continue;let Be=Se.getModelUris();Be&&!Se.modelsRequested&&(ne.addModelsFromBucket(Be,ue),Se.modelsRequested=!0);let Ue=Sr(Te,le);Ee.zoom=Ue;let Ne=pe.possiblyEvaluate(Ee);if(D_(H,Se,Te),wi.shadowUniformsInitialized=!1,wi.useSingleShadowCascade=!!re&&re.getMaxCascadeForTile(Te.toUnwrapped())===0,H.renderPass==="shadow"&&re){if(H.currentShadowCascade===1&&Se.isInsideFirstShadowMapFrustum)continue;let Le=le.calculatePosMatrix(Te.toUnwrapped(),le.worldSize);if(wi.tileMatrix.set(Le),wi.shadowTileMatrix=Float32Array.from(re.calculateShadowPassMatrixFromMatrix(Le)),wi.aabb.min.fill(0),wi.aabb.max[0]=wi.aabb.max[1]=r.a3,wi.aabb.max[2]=0,Or(Se,wi,H,ee.scope))continue}let ye=1<<Te.canonical.z,Ae=[((Q.x-Te.wrap)*ye-Te.canonical.x)*r.a3,(Q.y*ye-Te.canonical.y)*r.a3,Q.z*ye*r.a3];H.conflationActive&&Object.keys(Se.instancesPerModel).length>0&&H.style.isLayerClipped(ee,J.getSource())&&Se.updateReplacement(Te,H.replacementSource,se)&&(Se.uploaded=!1,Se.upload(H.context));for(let Le in Se.instancesPerModel){let et=Se.instancesPerModel[Le];et.features.length>0&&(Le=Ne.evaluate(et.features[0].feature,{}));let it=ne.getModel(Le,ue);if(it&&it.uploaded)for(let nt of it.nodes)Ki(H,ee,nt,et,Ae,Te,wi)}}}(p,s,u,g,A.type==="vector"?u.scope:""),void M();if(!A.loaded())return;if(A.type==="batched-model")return function(H,J,ee,te){ee.resetLayerRenderingStats(H);let ue=H.context,le=H.transform,Q=H.style.fog,ne=H.shadowRenderer;if(le.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${le.projection.name} projection is not yet implemented`);let re=H.transform.getFreeCameraOptions().position,pe=r._.scale([],[re.x,re.y,re.z],H.transform.worldSize);r._.negate(pe,pe);let Ee=r.ad.identity([]),se=r.cg(le.center.lat,le.zoom),Te=r.ad.fromScaling([],[1,1,1/se]);r.ad.translate(Ee,Ee,pe);let Se=ee.paint.get("model-opacity"),Be=new r.ae(ue.gl.LEQUAL,r.ae.ReadWrite,H.depthRangeFor3D),Ue=new r.ae(ue.gl.LEQUAL,r.ae.ReadOnly,H.depthRangeFor3D),Ne=new r.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ye=H.renderPass==="shadow",Ae=ye&&ne?ne.getCurrentCascadeFrustum():le.getFrustum(le.scaleZoom(le.worldSize)),Le=ee.paint.get("model-front-cutoff"),et=Le[2]<1,it=Xo(H,ee.paint.get("model-cutoff-fade-range")),nt=ee.getLayerRenderingStats();(function(ze,Ve,tt,ut){let At=ze.terrain?ze.terrain.exaggeration():0,Bt=ze.transform.zoom;for(let on of ut){let tn=Ve.getTile(on).getBucket(tt);tn&&(ze.conflationActive&&tn.updateReplacement(on,ze.replacementSource),tn.evaluateScale(ze,tt),ze.terrain&&At>0&&tn.elevationUpdate(ze.terrain,At,on,tt.source),tn.needsReEvaluation(ze,Bt,tt)&&tn.evaluate(tt))}})(H,J,ee,te),function(){let ze,Ve,tt;et?(ze=te.length-1,Ve=-1,tt=-1):(ze=0,Ve=te.length,tt=1);for(let ut=ze;ut!==Ve;ut+=tt){let At=te[ut],Bt=J.getTile(At).getBucket(ee);if(!Bt||!Bt.uploaded)continue;let on=!1;ne&&(on=ne.getMaxCascadeForTile(At.toUnwrapped())===0);let tn=le.calculatePosMatrix(At.toUnwrapped(),le.worldSize),Cn=Bt.modelTraits,Ot=[];for(let Tn of Bt.getNodesInfo()){if(Tn.hiddenByReplacement||!Tn.node.meshes)continue;let Un=Tn.node,An=0;H.terrain&&Un.elevation&&(An=Un.elevation*H.terrain.exaggeration());let Qt=Tn.evaluatedScale;if(Qt[0]<=1&&Qt[1]<=1&&Qt[2]<=1&&(()=>{let we=Tn.aabb;return Ne.min=[...we.min],Ne.max=[...we.max],Ne.min[2]+=An,Ne.max[2]+=An,r._.transformMat4(Ne.min,Ne.min,tn),r._.transformMat4(Ne.max,Ne.max,tn),Ne})().intersects(Ae)===0)continue;let Lt=[...tn],qn=Un.anchor?Un.anchor[0]:0,Yn=Un.anchor?Un.anchor[1]:0;r.ad.translate(Lt,Lt,[qn*(Qt[0]-1),Yn*(Qt[1]-1),An]),r._.exactEquals(Qt,r.cj)||r.ad.scale(Lt,Lt,Qt);let sn=r.ad.multiply([],Lt,Un.matrix),Fe=r.ad.multiply([],le.expandedFarZProjMatrix,sn),st=r.ad.multiply([],le.expandedFarZProjMatrix,Lt),Mr=r.aA.transformMat4([],[qn,Yn,An,1],Fe)[2];Un.hidden=!1;let Mn=Se;ye||(et&&(Mn*=fo(Lt,le,Tn.aabb,Le)),Mn*=Cp(it,Mr)),Mn!==0?Ot.push({nodeInfo:Tn,depth:Mr,opacity:Mn,wvpForNode:Fe,wvpForTile:st,nodeModelMatrix:sn,tileModelMatrix:Lt}):Un.hidden=!0}ye||Ot.sort((Tn,Un)=>!et||Tn.opacity===1&&Un.opacity===1?Tn.depth<Un.depth?-1:1:Tn.opacity===1?-1:Un.opacity===1?1:Tn.depth>Un.depth?-1:1);for(let Tn of Ot){let Un=Tn.nodeInfo,An=Un.node,Qt=r.ad.multiply([],Te,Tn.tileModelMatrix);r.ad.multiply(Qt,Ee,Qt);let Lt=r.ad.invert([],Qt);r.ad.transpose(Lt,Lt),r.ad.scale(Lt,Lt,Jo),Qt=r.ad.multiply(Qt,Qt,An.matrix);let qn=H.renderPass==="light-beam",Yn=Cn&r.cl.HasMapboxMeshFeatures,sn=Yn?0:Un.evaluatedRMEA[0][2];for(let Fe=0;Fe<An.meshes.length;++Fe){let st=An.meshes[Fe],Mr=Fe===An.lightMeshIndex,Mn=Tn.wvpForNode;if(Mr){if(!qn&&!H.terrain&&H.shadowRenderer){H.currentLayer<H.firstLightBeamLayer&&(H.firstLightBeamLayer=H.currentLayer);continue}Mn=Tn.wvpForTile}else if(qn)continue;let we={defines:[]},Ei=[];if(du(we.defines,Ei,st,H,ee.lut),Yn||we.defines.push("DIFFUSE_SHADED"),on&&we.defines.push("SHADOWS_SINGLE_CASCADE"),nt&&(ye?nt.numRenderedVerticesInShadowPass+=st.vertexArray.length:nt.numRenderedVerticesInTransparentPass+=st.vertexArray.length),ye){bi(st,Tn.nodeModelMatrix,H,ee);continue}let ii=null;if(Q){let Vs=Ll(Tn.nodeModelMatrix,H.transform);if(ii=new Float32Array(Vs),le.projection.name!=="globe"){let js=st.aabb.min,ts=st.aabb.max,[No,ns]=Q.getOpacityForBounds(Vs,js[0],js[1],ts[0],ts[1]);we.overrideFog=No>=Qn||ns>=Qn}}let Lr=st.material,mi;Lr.occlusionTexture&&Lr.occlusionTexture.offsetScale&&(mi=Lr.occlusionTexture.offsetScale,we.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ye&&ne&&(ne.useNormalOffset=!!st.normalBuffer);let Pi=H.getOrCreateProgram("model",we);!ye&&ne&&ne.setupShadowsFromMatrix(Tn.tileModelMatrix,Pi,ne.useNormalOffset),H.uploadCommonUniforms(ue,Pi,null,ii);let Ji=Lr.pbrMetallicRoughness;Ji.metallicFactor=.9,Ji.roughnessFactor=.5;let Ui=au(new Float32Array(Mn),new Float32Array(Qt),new Float32Array(Lt),new Float32Array(An.matrix),H,Tn.opacity,Ji.baseColorFactor.toRenderColor(null),Lr.emissiveFactor,Ji.metallicFactor,Ji.roughnessFactor,Lr,sn,ee,[0,0,0],mi);!Mr&&(Un.hasTranslucentParts||Tn.opacity<1)&&Pi.draw(H,ue.gl.TRIANGLES,Be,r.ag.disabled,r.a.disabled,r.af.backCCW,Ui,ee.id,st.vertexBuffer,st.indexBuffer,st.segments,ee.paint,H.transform.zoom,void 0,Ei),Pi.draw(H,ue.gl.TRIANGLES,Mr?Ue:Be,r.ag.disabled,Mr||Tn.opacity<1||Un.hasTranslucentParts?r.a.alphaBlended:r.a.unblended,r.af.backCCW,Ui,ee.id,st.vertexBuffer,st.indexBuffer,st.segments,ee.paint,H.transform.zoom,void 0,Ei)}}}}()}(p,s,u,g),void M();let L=A.getModels(),F=[],B=p.transform.getFreeCameraOptions().position,U=r._.scale([],[B.x,B.y,B.z],p.transform.worldSize);r._.negate(U,U);let $=[],G=[],q=0;for(let H of L){let J=u.paint.get("model-rotation").constantOr(null),ee=u.paint.get("model-scale").constantOr(null),te=u.paint.get("model-translation").constantOr(null);H.computeModelMatrix(p,J,ee,te,!0,!0,!1);let ue=r.ad.identity([]),le=r.cg(H.position.lat,p.transform.zoom),Q=r.ad.fromScaling([],[1,1,1/le]);r.ad.translate(ue,ue,U),F.push({zScaleMatrix:Q,negCameraPosMatrix:ue});for(let ne of H.nodes)ri(p.transform,ne,H.matrix,p.transform.expandedFarZProjMatrix,q,$,G);q++}if($.sort((H,J)=>J.depth-H.depth),p.renderPass!=="shadow"){if(v===1)for(let H of G)Ca(H,p,u,F[H.modelIndex],r.ag.disabled,p.colorModeForRenderPass());else{for(let H of G)Ca(H,p,u,F[H.modelIndex],r.ag.disabled,r.a.disabled);for(let H of G)Ca(H,p,u,F[H.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(let H of $)Ca(H,p,u,F[H.modelIndex],r.ag.disabled,p.colorModeForRenderPass());M()}else{for(let H of G)bi(H.mesh,H.nodeModelMatrix,p,u);for(let H of $)bi(H.mesh,H.nodeModelMatrix,p,u);M()}}},S_={model:function(p,s,u){let g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,g.type==="vector"?p.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(u.context)},raster:function(p,s,u){let g=s.getSource();if(!(g instanceof Tl&&g.loaded()))return;let v=p.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=p.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let w=s.getIds().map(I=>s.getTileByID(I));for(let I of w)I.updateNeeded(v,x)&&g.prepareTile(I,v,x)},"raster-particle":function(p,s,u){let g=s.getSource();if(!(g instanceof Tl&&g.loaded()))return;let v=p.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=p.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let w=s.getIds().map(I=>s.getTileByID(I));for(let I of w)I.updateNeeded(v,x)&&g.prepareTile(I,v,x)}};class C_{constructor(s,u,g,v){this.context=new $c(s,u),this.occlusionBuffers=new h1(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=r.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let w of x)this._debugParams.enabledLayers[w]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let w of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],w);this.symbolParams=new hl(v),this.setup(),this.numSublayers=r.bv.maxUnderzooming+r.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new zh(this),this._wireframeDebugCache=new pu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(s,u){let g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fp(this,s));let v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,u),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){let u=s.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new fp(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,u){if(this.width=s*r.e.devicePixelRatio,this.height=u*r.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let s=this.context,u=new r.bt;u.emplaceBack(0,0),u.emplaceBack(r.a3,0),u.emplaceBack(0,r.a3),u.emplaceBack(r.a3,r.a3),this.tileExtentBuffer=s.createVertexBuffer(u,r.br.members),this.tileExtentSegments=r.b.simpleSegment(0,0,4,2);let g=new r.bt;g.emplaceBack(0,0),g.emplaceBack(r.a3,0),g.emplaceBack(0,r.a3),g.emplaceBack(r.a3,r.a3),this.debugBuffer=s.createVertexBuffer(g,r.br.members),this.debugSegments=r.b.simpleSegment(0,0,4,5);let v=new r.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,r.br.members),this.viewportSegments=r.b.simpleSegment(0,0,4,2);let x=new r.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(r.a3,0,r.a3,0),x.emplaceBack(0,r.a3,0,r.a3),x.emplaceBack(r.a3,r.a3,r.a3,r.a3),this.mercatorBoundsBuffer=s.createVertexBuffer(x,r.cq.members),this.mercatorBoundsSegments=r.b.simpleSegment(0,0,4,2);let w=new r.bu;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(w);let I=new r.cr;for(let A of[0,1,3,2,0])I.emplaceBack(A);this.debugIndexBuffer=s.createIndexBuffer(I),this.emptyTexture=new r.T(s,new r.i({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=r.ad.create();let M=this.context.gl;this.stencilClearMode=new r.ag({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,r.ae.disabled,this.stencilClearMode,r.a.disabled,r.af.disabled,Uh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,u,g){if(!u||this.currentStencilSource===u.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(let M of g)if(this._tileClippingMaskIDs[M.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=u.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let I of g){let M=u.getTile(I),A=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:B}=this.getTileBoundsBuffers(M);w.draw(this,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,Uh(I.projMatrix),"$clipping",L,F,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let s=this.nextStencilID++,u=this.context.gl;return new r.ag({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);let u=this.context.gl;return new r.ag({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(s){let u=this.context.gl,g=s.sort((w,I)=>I.overscaledZ-w.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let w={};for(let I=0;I<x;I++)w[I+v]=new r.ag({func:u.GEQUAL,mask:255},I+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[w,g]}return[{[v]:r.ag.disabled},g]}colorModeForRenderPass(){let s=this.context.gl;return this._showOverdrawInspector?new r.a([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(s){let u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new r.a([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,u,g,v=!1){if(this.depthOcclusion)return new r.ae(this.context.gl.GREATER,r.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return r.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new r.ae(g||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,u)=>s+u/this._fpsHistory.length,0))}render(s,u){let g=r.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=u;let v=this.style._mergedLayers,x=this.style.order.filter(ne=>{let re=v[ne];return!(re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[re.type]}),w=x.map(ne=>v[ne]),I=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(r.e.now()),this.imageManager.beginFrame();let M=0,A=!1;for(let ne in I){let re=I[ne];re.used&&(re.prepare(this.context),re.getSource().usedInConflation&&++M)}let L=!1;for(let ne of w)ne.isHidden(this.transform.zoom)||(ne.type==="clip"&&(L=!0),this.prepareLayer(ne));let F={},B={},U={},$={},G={};for(let ne in I){let re=I[ne];F[ne]=re.getVisibleCoordinates(),B[ne]=F[ne].slice().reverse(),U[ne]=re.getVisibleCoordinates(!0).reverse(),$[ne]=re.getShadowCasterCoordinates(),G[ne]=re.sortCoordinatesByDistance(F[ne])}let q=ne=>{let re=this.style.getLayerSourceCache(ne);return re&&re.used?re.getSource():null};if(M||L){let ne=[],re=[],pe=0;for(let Ee of w)this.isSourceForClippingOrConflation(Ee,q(Ee))&&(ne.push(Ee),re.push(pe)),pe++;if(ne&&(L||ne.length>1)){let Ee=[];for(let se=0;se<ne.length;se++){let Te=ne[se],Se=re[se],Be=this.style.getLayerSourceCache(Te);if(!Be||!Be.used||!Be.getSource().usedInConflation&&Te.type!=="clip")continue;let Ue=1/0,Ne=r.cu.None;if(Te.type==="clip"){Ue=Se;for(let ye of Te.layout.get("clip-layer-types"))Ne|=ye==="model"?r.cu.Model:ye==="symbol"?r.cu.Symbol:r.cu.FillExtrusion}Ee.push({layer:Te.fqid,cache:Be,order:Ue,clipMask:Ne})}this.replacementSource.setSources(Ee),A=!0}}A||this.replacementSource.clear(),this.conflationActive=A,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ne=0;ne<w.length;ne++){let re=w[ne],pe=re.cutoffRange();if(this.longestCutoffRange=Math.max(pe,this.longestCutoffRange),pe>0){let Ee=q(re);Ee&&(this.minCutoffZoom=Math.max(Ee.minzoom,this.minCutoffZoom)),re.minzoom&&(this.minCutoffZoom=Math.max(re.minzoom,this.minCutoffZoom))}re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ne),this._lastOcclusionLayer=ne)}let H=this.style&&this.style.fog;H?(this._fogVisible=H.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=H.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0);let J=this._shadowRenderer;if(J){J.updateShadowParameters(this.transform,this.style.directionalLight);for(let ne in I)for(let re of F[ne]){let pe={min:0,max:0};this.terrain&&(pe=this.terrain.getMinMaxForTile(re)||pe),J.addShadowReceiver(re.toUnwrapped(),pe.min,pe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Sp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.ct(this.context.gl))return;this.renderPass="offscreen";for(let ne of w){let re=s.getLayerSourceCache(ne);if(!ne.hasOffscreenPass()||ne.isHidden(this.transform.zoom))continue;let pe=re?B[re.id]:void 0;(ne.type==="custom"||ne.type==="raster"||ne.type==="raster-particle"||ne.isSky()||pe&&pe.length)&&this.renderLayer(this,re,ne,pe)}this.depthRangeFor3D=[0,1-(w.length+2)*this.numSublayers*this.depthEpsilon];let ee=this.terrain;ee&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&ee.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,$)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let te=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ue=(()=>{if(u.showOverdrawInspector)return r.C.black;let ne=this.style.fog;if(ne&&this.transform.projection.supportsFog){let re=this.style.getLut(ne.scope);if(!te){let pe=ne.properties.get("color").toRenderColor(re).toArray01();return new r.C(...pe)}if(te){let pe=ne.properties.get("space-color").toRenderColor(re).toArray01();return new r.C(...pe)}}return r.C.transparent})();if(this.context.clear({color:ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&te&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let ne=w[this.currentLayer],re=s.getLayerSourceCache(ne);if(ne.isSky())continue;let pe=re?(ne.is3D()?G:B)[re.id]:void 0;this._renderTileClippingMasks(ne,re,pe),this.renderLayer(this,re,ne,pe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&te&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let ne=w[this.currentLayer],re=s.getLayerSourceCache(ne);ne.isSky()&&this.renderLayer(this,re,ne,re?B[re.id]:void 0)}function le(ne,re){let pe;return re&&(pe=(ne.type==="symbol"?U:ne.is3D()?G:B)[re.id]),pe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let ne=w[this.currentLayer];if(ne.type==="raster"){let re=s.getLayerSourceCache(ne);this.renderLayer(this,re,ne,le(ne,re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Q=0;for(J&&(Q=J.getShadowCastingLayerCount());this.currentLayer<x.length;){let ne=w[this.currentLayer],re=s.getLayerSourceCache(ne);if(ne.isSky())++this.currentLayer;else if(ee&&this.style.isLayerDraped(ne)){if(ne.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=ee.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(ne.is3D()||this.terrain||this._renderTileClippingMasks(ne,re,re?F[re.id]:void 0),this.renderLayer(this,re,ne,le(ne,re)),!ee&&J&&Q>0&&ne.hasShadowPass()&&--Q==0&&(J.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let pe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=pe;this.currentLayer++){let Ee=w[this.currentLayer];if(!Ee.hasLightBeamPass())continue;let se=s.getLayerSourceCache(Ee);this.renderLayer(this,se,Ee,se?B[se.id]:void 0)}this.currentLayer=pe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let pe=this.currentLayer;this.depthOcclusion=!0;for(let Ee of this.layersWithOcclusionOpacity){this.currentLayer=Ee;let se=w[this.currentLayer],Te=s.getLayerSourceCache(se),Se=Te?B[Te.id]:void 0;se.is3D()||this.terrain||this._renderTileClippingMasks(se,Te,Te?F[Te.id]:void 0),this.renderLayer(this,Te,se,Se)}this.depthOcclusion=!1,this.currentLayer=pe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ne=null;w.forEach(re=>{let pe=s.getLayerSourceCache(re);pe&&!re.isHidden(this.transform.zoom)&&pe.getVisibleCoordinates().length&&(!ne||ne.getSource().maxzoom<pe.getSource().maxzoom)&&(ne=pe)}),ne&&this.options.showTileBoundaries&&po.debug(this,ne,ne.getVisibleCoordinates(),r.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&po.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ne){let re=ne.transform.padding;yn(ne,ne.transform.height-(re.top||0),3,Jh),yn(ne,re.bottom||0,3,Ip),vn(ne,re.left||0,3,Lo),vn(ne,ne.transform.width-(re.right||0),3,Dp);let pe=ne.transform.centerPoint;(function(Ee,se,Te,Se){xi(Ee,se-1,Te-10,2,20,Se),xi(Ee,se-10,Te-1,20,2,Se)})(ne,pe.x,ne.transform.height-pe.y,Pl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),A||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);let{unsupportedLayers:u}=this.transform.projection,g=!u||!u.includes(s.type);if(S_[s.type]&&(g||this.terrain&&s.type==="custom")){let v=this.style.getLayerSourceCache(s);S_[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,u,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||po[g.type](s,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;let u=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(u.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let s=this.context.extTimerQuery,u=this.context.gl,g=u.createQuery();this.deferredRenderGpuTimeQueries.push(g),u.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){let s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){let u={};for(let g in s){let v=s[g],x=this.context.extTimerQuery,w=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),u[g]=w}return u}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;let u=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of s)v+=u.getQueryParameter(x,g.QUERY_RESULT)/1e6,u.deleteQueryEXT(x);return v}translatePosMatrix(s,u,g,v,x){if(!g[0]&&!g[1])return s;let w=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(w){let A=Math.sin(w),L=Math.cos(w);g=[g[0]*L-g[1]*A,g[0]*A+g[1]*L]}let I=[x?g[0]:r.bB(u,g[0],this.transform.zoom),x?g[1]:r.bB(u,g[1],this.transform.zoom),0],M=new Float32Array(16);return r.ad.translate(M,s,I),M}saveTileTexture(s){let u=s.size[0],g=this._tileTextures[u];g?g.push(s):this._tileTextures[u]=[s]}getTileTexture(s){let u=this._tileTextures[s];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,u,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||u!==void 0&&!u||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(s,u){this.cache=this.cache||{};let g=u&&u.defines||[],v=u&&u.config,x=this.currentGlobalDefines(s,u&&u.overrideFog,u&&u.overrideRtt).concat(g),w=nu.cacheKey(u_[s],s,x,v);return this.cache[w]||(this.cache[w]=new nu(this.context,s,u_[s],v,s1[s],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,u){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((w,I,M)=>{let A=w.properties.get("direction"),L=w.properties.get("color").toRenderColor(M.getLut(w.scope)).toArray01(),F=w.properties.get("intensity"),B=I.properties.get("color").toRenderColor(M.getLut(I.scope)).toArray01(),U=I.properties.get("intensity"),$=[A.x,A.y,A.z],G=r.bA(B,U),q=r.bA(L,F);return{u_lighting_ambient_color:G,u_lighting_directional_dir:$,u_lighting_directional_color:q,u_ground_radiance:Qo($,q,G)}})(g,v,this.style);u.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,u,g,v,x){if(this.uploadCommonLightUniforms(s,u),this.terrain&&this.terrain.renderingToTexture)return;let w=this.style.fog;if(w){let I=w.getOpacity(this.transform.pitch),M=((A,L,F,B,U,$,G,q,H,J,ee,te)=>{let ue=A.transform,le=L.properties.get("color").toRenderColor(A.style.getLut(L.scope)).toArray01();le[3]=B;let Q=A.frameCounter/1e3%1,[ne,re]=L.properties.get("vertical-range");return{u_fog_matrix:F?ue.calculateFogTileMatrix(F):te||A.identityMat,u_fog_range:L.getFovAdjustedRange(ue._fov),u_fog_color:le,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ne,re),re],u_fog_temporal_offset:Q,u_frustum_tl:U,u_frustum_tr:$,u_frustum_br:G,u_frustum_bl:q,u_globe_pos:H,u_globe_radius:J,u_viewport:ee,u_globe_transition:r.a1(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,w,g,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.e.devicePixelRatio,this.transform.height*r.e.devicePixelRatio],v);u.setFogUniformValues(s,M)}x&&u.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){let s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){let s=this.context.gl,u=s.createTexture();return s.bindTexture(s.TEXTURE_2D,u),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let s=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)u[v.key]=s[v.key]||new r.by(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,u){return!(!s.is3D()||s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||s.sourceLayer!=="building")&&s.type!=="clip"&&(!u||u.type!=="batched-model"))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[s.key];return u||(this._cachedTileFogOpacities[s.key]=u=this.style.fog.getOpacityForTile(s)),u[0]>=Qn||u[1]>=Qn}}class pi{constructor(s,u,g,v){this.screenBounds=s,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,u){let g,v;if(s instanceof r.P||typeof s[0]=="number"){let x=r.P.convert(s);g=[x],v=u.isPointAboveHorizon(x)}else{let x=r.P.convert(s[0]),w=r.P.convert(s[1]);g=[x,w],v=r.cv(x,w).every(I=>u.isPointAboveHorizon(I))}return new pi(g,u.getCameraPoint(),v,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return r.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){let u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),r.cw(v,s)}bufferedCameraGeometryGlobe(s){let u=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(u,g,s),x=this.cameraPoint.clone();switch(3*((x.y>u.y)+(x.y>g.y))+((x.x>u.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(s,u,g,v=0){let x=s.queryPadding/u._pixelsPerMercatorPixel+1,w=g?this._bufferedCameraMercator(x,u):this._bufferedScreenMercator(x,u),I=s.tileID.wrap+(w.unwrapped?v:0),M=w.polygon.map(q=>r.cx(s.tileTransform,q,I));if(!r.cy(M,0,0,r.a3,r.a3))return;I=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let A=this.screenGeometryMercator.polygon.map(q=>r.cz(s.tileTransform,q,I)),L=A.map(q=>new r.P(q[0],q[1])),F=u.getFreeCameraOptions().position||new r.Y(0,0,0),B=r.cz(s.tileTransform,F,I),U=A.map(q=>{let H=r._.sub(q,q,B);return r._.normalize(H,H),new r.aT(B,H)}),$=r.bB(s,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:U,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(G=r.cA(M),G.min.x=r.at(G.min.x,0,r.a3),G.min.y=r.at(G.min.y,0,r.a3),G.max.x=r.at(G.max.x,0,r.a3),G.max.y=r.at(G.max.y,0,r.a3),G),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:$};var G}_bufferedScreenMercator(s,u){let g=Ap(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),u):{polygon:this.bufferedScreenGeometry(s).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,u){let g=Ap(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),u):{polygon:this.bufferedCameraGeometry(s).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,u){let g=function(x,w){let I=r.ad.multiply([],w.pixelMatrix,w.globeMatrix),M=[0,-r.cD,0,1],A=[0,r.cD,0,1],L=[0,0,0,1];r.aA.transformMat4(M,M,I),r.aA.transformMat4(A,A,I),r.aA.transformMat4(L,L,I);let F=new r.P(M[0]/M[3],M[1]/M[3]),B=new r.P(A[0]/A[3],A[1]/A[3]),U=r.cB(x,F)&&M[3]<L[3],$=r.cB(x,B)&&A[3]<L[3];if(!U&&!$)return null;let G=function(Q,ne,re){for(let pe=1;pe<Q.length;pe++){let Ee=Ls(ne.pointCoordinate3D(Q[pe-1]).x),se=Ls(ne.pointCoordinate3D(Q[pe]).x);if(re<0){if(Ee<se)return{idx:pe,t:-Ee/(se-1-Ee)}}else if(se<Ee)return{idx:pe,t:(1-Ee)/(se+1-Ee)}}return null}(x,w,U?-1:1);if(!G)return null;let{idx:q,t:H}=G,J=q>1?Mp(x.slice(0,q),w):[],ee=q<x.length?Mp(x.slice(q),w):[];J=J.map(Q=>new r.P(Ls(Q.x),Q.y)),ee=ee.map(Q=>new r.P(Ls(Q.x),Q.y));let te=[...J];te.length===0&&te.push(ee[ee.length-1]);let ue=r.a2(te[te.length-1].y,(ee.length===0?J[0]:ee[0]).y,H),le;return le=U?[new r.P(0,ue),new r.P(0,0),new r.P(1,0),new r.P(1,ue)]:[new r.P(1,ue),new r.P(1,1),new r.P(0,1),new r.P(0,ue)],te.push(...le),ee.length===0?te.push(J[0]):te.push(...ee),{polygon:te.map(Q=>new r.Y(Q.x,Q.y)),unwrapped:!1}}(s,u);if(g)return g;let v=function(x,w){let I=!1,M=-1/0,A=0;for(let F=0;F<x.length-1;F++)x[F].x>M&&(M=x[F].x,A=F);for(let F=0;F<x.length-1;F++){let B=(A+F)%(x.length-1),U=x[B],$=x[B+1];Math.abs(U.x-$.x)>.5&&(U.x<$.x?(U.x+=1,B===0&&(x[x.length-1].x+=1)):($.x+=1,B+1===x.length-1&&(x[0].x+=1)),I=!0)}let L=r.aj(w.center.lng);return I&&L<Math.abs(L-1)&&x.forEach(F=>{F.x-=1}),{polygon:x,unwrapped:I}}(Mp(s,u).map(x=>new r.P(Ls(x.x),x.y)),u);return{polygon:v.polygon.map(x=>new r.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function Mp(p,s){return r.cC(p,u=>{let g=s.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function Ls(p){return p<0?1+p%1:p%1}function Ap(p){return 100*p|0}function d1(p,s){let u=r.ad.identity([]);return r.ad.scale(u,u,[.5*p.width,.5*-p.height,1]),r.ad.translate(u,u,[1,-1,0]),r.ad.multiply(u,u,p.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(u)}function f1(p,s,u,g,v,x,w,I=!1){let M=p.tilesIn(g,w,I);M.sort(kl);let A=[];for(let F of M)A.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(s,u,p._state,F,v,x,d1(p.transform,F.tile.tileID),I)});let L=function(F){let B={},U={};for(let $ of F){let G=$.queryResults,q=$.wrappedTileID,H=U[q]=U[q]||{};for(let J in G){let ee=G[J],te=H[J]=H[J]||{},ue=B[J]=B[J]||[];for(let le of ee)te[le.featureIndex]||(te[le.featureIndex]=!0,ue.push(le))}}return B}(A);for(let F in L)L[F].forEach(B=>{let U=B.feature,$=U.layer;$&&$.type!=="background"&&$.type!=="sky"&&$.type!=="slot"&&(U.source=$.source,$["source-layer"]&&(U.sourceLayer=$["source-layer"]),U.state=U.id!==void 0?p.getFeatureState($["source-layer"],U.id):{})});return L}function mu(p,s){let u=p.getRenderableIds().map(x=>p.getTileByID(x)),g=[],v={};for(let x=0;x<u.length;x++){let w=u[x],I=w.tileID.canonical.key;v[I]||(v[I]=!0,w.querySourceFeatures(g,s))}return g}function kl(p,s){let u=p.tileID,g=s.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}class p1{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let s=!1,u=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:s,visibilityChanged:u});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:s,visibilityChanged:u})}}}onNewFrame(s){this.layersGotHidden=!1;for(let u of this.layers){let g=u.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(s)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&u.visible,u.visible=v}}updateZOffset(s,u){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,w=this.style.getLayerSourceCache(x),I=1;x.type==="fill-extrusion"&&(I=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let M=w?w.getTile(u):null;if(!M&&w&&u.canonical.z>w.getSource().minzoom){let A=u.scaledTo(Math.min(w.getSource().maxzoom,u.overscaledZ-1));for(;A.overscaledZ>=w.getSource().minzoom&&(M=w.getTile(A),!M&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(x):null,tileID:M?M.tileID:u,verticalScale:I})}s.hasAnyZOffset=!1;let g=!1;for(let v=0;v<s.symbolInstances.length;v++){let x=s.symbolInstances.get(v),w=x.zOffset,I=this._getHeightAtTileOffset(u,x.tileAnchorX,x.tileAnchorY);x.zOffset=I!==Number.NEGATIVE_INFINITY?I:w,g||w===x.zOffset||(g=!0),s.hasAnyZOffset||x.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,u,g,v){let x=u,w=g;if(s.canonical.z!==v.canonical.z){let I=v.canonical,M=1/(1<<s.canonical.z-I.z);x=(u+s.canonical.x*r.a3)*M-I.x*r.a3|0,w=(g+s.canonical.y*r.a3)*M-I.y*r.a3|0}return{tileX:x,tileY:w}}_getHeightAtTileOffset(s,u,g){let v,x;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;let{bucket:I,tileID:M,verticalScale:A}=this.currentBuildingBuckets[w];if(!I)continue;let{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(s,u,g,M),B=I.getHeightAtTileCoord(L,F);B&&B.height!==void 0&&(B.hidden?v=B.height:x=Math.max(B.height*A,x||0))}if(x!==void 0)return x;for(let w=0;w<this.layers.length;++w){let I=this.layers[w];if(I.layer.type!=="model"||!I.visible)continue;let{bucket:M,tileID:A}=this.currentBuildingBuckets[w];if(!M)continue;let{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(s,u,g,A),B=M.getHeightAtTileCoord(L,F);if(B&&!B.hidden)return B.height===void 0&&v!==void 0?Math.min(B.maxHeight,v)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Fl(p,s){let u={};for(let g in p)g!=="ref"&&(u[g]=p[g]);return r.cE.forEach(g=>{g in s&&(u[g]=s[g])}),u}function Pp(p){p=p.slice();let s=Object.create(null);for(let u=0;u<p.length;u++)s[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=Fl(p[u],s[p[u].ref]));return p}let hn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function es(p,s,u){u.push({command:hn.addSource,args:[p,s[p]]})}function M_(p,s,u){s.push({command:hn.removeSource,args:[p]}),u[p]=!0}function m1(p,s,u,g){M_(p,u,g),es(p,s,u)}function g1(p,s,u){let g;for(g in p[u])if(p[u].hasOwnProperty(g)&&g!=="data"&&!E(p[u][g],s[u][g]))return!1;for(g in s[u])if(s[u].hasOwnProperty(g)&&g!=="data"&&!E(p[u][g],s[u][g]))return!1;return!0}function gu(p,s,u,g,v,x){let w;for(w in s=s||{},p=p||{})p.hasOwnProperty(w)&&(E(p[w],s[w])||u.push({command:x,args:[g,w,s[w],v]}));for(w in s)s.hasOwnProperty(w)&&!p.hasOwnProperty(w)&&(E(p[w],s[w])||u.push({command:x,args:[g,w,s[w],v]}))}function ed(p){return p.id}function Nl(p,s){return p[s.id]=s,p}class A_{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=r.at(s,0,1);let u=1,g=this._distances[u],v=s*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];let x=u-1,w=this._distances[x],I=g-w,M=I>0?(v-w)/I:0;return this.points[x].mult(1-M).add(this.points[u].mult(M))}}class Rp{constructor(s,u,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(u/g);for(let w=0;w<this.xCellCount*this.yCellCount;w++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,g,v,x){this._forEachCell(u,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(s,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,u,g,v,x,w){this.boxCells[x].push(w)}_insertCircleCell(s,u,g,v,x,w){this.circleCells[x].push(w)}_query(s,u,g,v,x,w){if(g<0||s>this.width||v<0||u>this.height)return!x&&[];let I=[];if(s<=0&&u<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){let A=this.circles[3*M],L=this.circles[3*M+1],F=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:A-F,y1:L-F,x2:A+F,y2:L+F})}return w?I.filter(w):I}return this._forEachCell(s,u,g,v,this._queryCell,I,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?I.length>0:I}_queryCircle(s,u,g,v,x){let w=s-g,I=s+g,M=u-g,A=u+g;if(I<0||w>this.width||A<0||M>this.height)return!v&&[];let L=[];return this._forEachCell(w,M,I,A,this._queryCellCircle,L,{hitTest:v,circle:{x:s,y:u,radius:g},seenUids:{box:{},circle:{}}},x),v?L.length>0:L}query(s,u,g,v,x){return this._query(s,u,g,v,!1,x)}hitTest(s,u,g,v,x){return this._query(s,u,g,v,!0,x)}hitTestCircle(s,u,g,v){return this._queryCircle(s,u,g,!0,v)}_queryCell(s,u,g,v,x,w,I,M){let A=I.seenUids,L=this.boxCells[x];if(L!==null){let B=this.bboxes;for(let U of L)if(!A.box[U]){A.box[U]=!0;let $=4*U;if(s<=B[$+2]&&u<=B[$+3]&&g>=B[$+0]&&v>=B[$+1]&&(!M||M(this.boxKeys[U]))){if(I.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[U],x1:B[$],y1:B[$+1],x2:B[$+2],y2:B[$+3]})}}}let F=this.circleCells[x];if(F!==null){let B=this.circles;for(let U of F)if(!A.circle[U]){A.circle[U]=!0;let $=3*U;if(this._circleAndRectCollide(B[$],B[$+1],B[$+2],s,u,g,v)&&(!M||M(this.circleKeys[U]))){if(I.hitTest)return w.push(!0),!0;{let G=B[$],q=B[$+1],H=B[$+2];w.push({key:this.circleKeys[U],x1:G-H,y1:q-H,x2:G+H,y2:q+H})}}}}}_queryCellCircle(s,u,g,v,x,w,I,M){let A=I.circle,L=I.seenUids,F=this.boxCells[x];if(F!==null){let U=this.bboxes;for(let $ of F)if(!L.box[$]){L.box[$]=!0;let G=4*$;if(this._circleAndRectCollide(A.x,A.y,A.radius,U[G+0],U[G+1],U[G+2],U[G+3])&&(!M||M(this.boxKeys[$])))return w.push(!0),!0}}let B=this.circleCells[x];if(B!==null){let U=this.circles;for(let $ of B)if(!L.circle[$]){L.circle[$]=!0;let G=3*$;if(this._circlesCollide(U[G],U[G+1],U[G+2],A.x,A.y,A.radius)&&(!M||M(this.circleKeys[$])))return w.push(!0),!0}}}_forEachCell(s,u,g,v,x,w,I,M){let A=this._convertToXCellCoord(s),L=this._convertToYCellCoord(u),F=this._convertToXCellCoord(g),B=this._convertToYCellCoord(v);for(let U=A;U<=F;U++)for(let $=L;$<=B;$++)if(x.call(this,s,u,g,v,this.xCellCount*$+U,w,I,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,g,v,x,w){let I=v-s,M=x-u,A=g+w;return A*A>I*I+M*M}_circleAndRectCollide(s,u,g,v,x,w,I){let M=(w-v)/2,A=Math.abs(s-(v+M));if(A>M+g)return!1;let L=(I-x)/2,F=Math.abs(u-(x+L));if(F>L+g)return!1;if(A<=M||F<=L)return!0;let B=A-M,U=F-L;return B*B+U*U<=g*g}}let mo=100;class P_{constructor(s,u,g=new Rp(s.width+200,s.height+200,25),v=new Rp(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+mo,this.screenBottomBoundary=s.height+mo,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=u}placeCollisionBox(s,u,g,v,x,w,I,M){let A=g.projectedAnchorX,L=g.projectedAnchorY,F=g.projectedAnchorZ,B=g.elevation,U=g.tileID,$=s.getProjection();if(B&&U){let[le,Q,ne]=$.upVector(U.canonical,g.tileAnchorX,g.tileAnchorY),re=$.upVectorScale(U.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=le*B*re,L+=Q*B*re,F+=ne*B*re}let G=this.projectAndGetPerspectiveRatio(I,A,L,F,g.tileID,$.name==="globe"||!!B||this.transform.pitch>0,$),q=w*G.perspectiveRatio,H=(g.x1*u+v.x-g.padding)*q+G.point.x,J=(g.y1*u+v.y-g.padding)*q+G.point.y,ee=(g.x2*u+v.x+g.padding)*q+G.point.x,te=(g.y2*u+v.y+g.padding)*q+G.point.y,ue=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(H,J,ee,te)||!x&&this.grid.hitTest(H,J,ee,te,M)||ue?{box:[],offscreen:!1,occluded:G.occluded}:{box:[H,J,ee,te],offscreen:this.isOffscreen(H,J,ee,te),occluded:!1}}placeCollisionCircles(s,u,g,v,x,w,I,M,A,L,F,B,U,$,G){let q=[],H=this.transform.elevation,J=s.getProjection(),ee=H?H.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,J):null,te=new r.P(g.tileAnchorX,g.tileAnchorY),{x:ue,y:le,z:Q}=J.projectTilePoint(te.x,te.y,G.canonical);if(ee){let[Ne,ye,Ae]=ee(te);ue+=Ne,le+=ye,Q+=Ae}let ne=J.name==="globe",re=this.projectAndGetPerspectiveRatio(I,ue,le,Q,G,ne||!!H||this.transform.pitch>0,J),{perspectiveRatio:pe}=re,Ee=(F?w/pe:w*pe)/r.bN,se=Xi(ue,le,Q,M),Te=re.signedDistanceFromCamera>0?Fh(Ee,x,g.lineOffsetX*Ee,g.lineOffsetY*Ee,!1,se,te,g,v,M,{},H&&!F?ee:null,F&&!!H,J,G,F):null,Se=!1,Be=!1,Ue=!0;if(Te&&!re.occluded){let Ne=.5*U*pe+$,ye=new r.P(-100,-100),Ae=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Le=new A_,{first:et,last:it}=Te,nt=et.path.length,ze=[];for(let ut=nt-1;ut>=1;ut--)ze.push(et.path[ut]);for(let ut=1;ut<it.path.length;ut++)ze.push(it.path[ut]);let Ve=2.5*Ne;A&&(ze=ze.map(([ut,At,Bt],on)=>(ee&&!ne&&(Bt=ee(on<nt-1?et.tilePath[nt-1-on]:it.tilePath[on-nt+2])[2]),Xi(ut,At,Bt,A))),ze.some(ut=>ut[3]<=0)&&(ze=[]));let tt=[];if(ze.length>0){let ut=1/0,At=-1/0,Bt=1/0,on=-1/0;for(let tn of ze)ut=Math.min(ut,tn[0]),Bt=Math.min(Bt,tn[1]),At=Math.max(At,tn[0]),on=Math.max(on,tn[1]);At>=ye.x&&ut<=Ae.x&&on>=ye.y&&Bt<=Ae.y&&(tt=[ze.map(tn=>new r.P(tn[0],tn[1]))],(ut<ye.x||At>Ae.x||Bt<ye.y||on>Ae.y)&&(tt=r.cF(tt,ye.x,ye.y,Ae.x,Ae.y)))}for(let ut of tt){Le.reset(ut,.25*Ne);let At=0;At=Le.length<=.5*Ne?1:Math.ceil(Le.paddedLength/Ve)+1;for(let Bt=0;Bt<At;Bt++){let on=Bt/Math.max(At-1,1),tn=Le.lerp(on),Cn=tn.x+mo,Ot=tn.y+mo;q.push(Cn,Ot,Ne,0);let Tn=Cn-Ne,Un=Ot-Ne,An=Cn+Ne,Qt=Ot+Ne;if(Ue=Ue&&this.isOffscreen(Tn,Un,An,Qt),Be=Be||this.isInsideGrid(Tn,Un,An,Qt),!u&&this.grid.hitTestCircle(Cn,Ot,Ne,B)&&(Se=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Se,occluded:!1}}}}return{circles:!L&&Se||!Be?[]:q,offscreen:Ue,collisionDetected:Se,occluded:re.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],g=1/0,v=1/0,x=-1/0,w=-1/0;for(let L of s){let F=new r.P(L.x+mo,L.y+mo);g=Math.min(g,F.x),v=Math.min(v,F.y),x=Math.max(x,F.x),w=Math.max(w,F.y),u.push(F)}let I=this.grid.query(g,v,x,w).concat(this.ignoredGrid.query(g,v,x,w)),M={},A={};for(let L of I){let F=L.key;if(M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]={}),M[F.bucketInstanceId][F.featureIndex])continue;let B=[new r.P(L.x1,L.y1),new r.P(L.x2,L.y1),new r.P(L.x2,L.y2),new r.P(L.x1,L.y2)];r.cG(u,B)&&(M[F.bucketInstanceId][F.featureIndex]=!0,A[F.bucketInstanceId]===void 0&&(A[F.bucketInstanceId]=[]),A[F.bucketInstanceId].push(F.featureIndex))}return A}insertCollisionBox(s,u,g,v,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,g,v,x){let w=u?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let M=0;M<s.length;M+=4)w.insertCircle(I,s[M],s[M+1],s[M+2])}projectAndGetPerspectiveRatio(s,u,g,v,x,w,I){let M=[u,g,v,1],A=!1;v||this.transform.pitch>0?(r.aA.transformMat4(M,M,s),this.fogState&&x&&I.name!=="globe"&&(A=function(B,U,$,G,q,H){let J=H.calculateFogTileMatrix(q),ee=[U,$,G];return r._.transformMat4(ee,ee,J),Dr(B,r._.length(ee),H.pitch,H._fov)}(this.fogState,u,g,v,x.toUnwrapped(),this.transform)>.9)):Ro(M,M,s);let L=M[3];return{point:new r.P((M[0]/L+1)/2*this.transform.width+mo,(-M[1]/L+1)/2*this.transform.height+mo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/L*.5,1.5),signedDistanceFromCamera:L,occluded:w&&M[2]>L||A}}isOffscreen(s,u,g,v){return g<mo||s>=this.screenRightBoundary||v<mo||u>this.screenBottomBoundary}isInsideGrid(s,u,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let s=r.ad.identity([]);return r.ad.translate(s,s,[-100,-100,0]),s}}class ks{constructor(s,u,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Fs{constructor(s,u,g,v,x,w=!1){this.text=new ks(s?s.text:null,u,g,x),this.icon=new ks(s?s.icon:null,u,v,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class td{constructor(s,u,g,v=!1){this.text=s,this.icon=u,this.skipFade=g,this.clipped=v}}class R_{constructor(){this.invProjMatrix=r.ad.create(),this.viewportMatrix=r.ad.create(),this.circles=[]}}class _u{constructor(s,u,g,v,x){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class yu{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){let u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[s]}}function Op(p,s,u,g,v){let{horizontalAlign:x,verticalAlign:w}=r.bQ(p),I=-(x-.5)*s,M=-(w-.5)*u,A=r.bP(p,g);return new r.P(I+A[0]*v,M+A[1]*v)}function vu(p,s,u,g,v){let x=new r.P(p,s);return u&&x._rotate(g?v:-v),x}class Qi{constructor(s,u,g,v,x,w){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new P_(this.transform,x),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new yu(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,u,g,v){let x=g.getBucket(u),w=g.latestFeatureIndex;if(!x||!w||u.fqid!==x.layerIds[0])return;let I=x.layers[0].layout,M=g.collisionBoxArray,A=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/r.a3,F=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let B=(U=g.tileID,$=x.getProjection(),G=this.transform,$.name===this.projection?G.calculateProjMatrix(U.toUnwrapped()):Yh(G,$,U));var U,$,G;let q=I.get("text-pitch-alignment")==="map",H=I.get("text-rotation-alignment")==="map";u.compileFilter();let J=u.dynamicFilter(),ee=u.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(g),ue=wa(B,g.tileID.canonical,q,H,this.transform,x.getProjection(),te),le=null;if(q){let re=bl(B,g.tileID.canonical,q,H,this.transform,x.getProjection(),te);le=r.ad.multiply([],this.transform.labelPlaneMatrix,re)}let Q=null;J&&g.latestFeatureIndex&&(Q={unwrappedTileID:F,dynamicFilter:J,dynamicFilterNeedsFeature:ee,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new _u(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,g.tileID);let ne={bucket:x,layout:I,posMatrix:B,textLabelPlaneMatrix:ue,labelToScreenMatrix:le,clippingData:Q,scale:A,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:r.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let re of x.sortKeyRanges){let{sortKey:pe,symbolInstanceStart:Ee,symbolInstanceEnd:se}=re;s.push({sortKey:pe,symbolInstanceStart:Ee,symbolInstanceEnd:se,parameters:ne})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ne})}attemptAnchorPlacement(s,u,g,v,x,w,I,M,A,L,F,B,U,$,G,q,H,J){let{textOffset0:ee,textOffset1:te,crossTileID:ue}=B,le=[ee,te],Q=Op(s,g,v,le,x),ne=this.collisionIndex.placeCollisionBox($,x,u,vu(Q.x,Q.y,w,I,this.transform.angle),F,M,A,L.predicate);if(q){let re=$.getSymbolInstanceIconSize(J,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,re,q,vu(Q.x,Q.y,w,I,this.transform.angle),F,M,A,L.predicate).box.length===0)return}if(ne.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(re=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:le,width:g,height:v,anchor:s,textScale:x,prevAnchor:re},this.markUsedJustification($,s,B,G),$.allowVerticalPlacement&&(this.markUsedOrientation($,G,B),this.placedOrientations[ue]=G),{shift:Q,placedGlyphBoxes:ne}}}placeLayerBucketPart(s,u,g,v){let{bucket:x,layout:w,posMatrix:I,textLabelPlaneMatrix:M,labelToScreenMatrix:A,clippingData:L,textPixelRatio:F,holdingForFade:B,collisionBoxArray:U,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:G,collisionGroup:q}=s.parameters,H=w.get("text-optional"),J=w.get("icon-optional"),ee=w.get("text-allow-overlap"),te=w.get("icon-allow-overlap"),ue=w.get("text-rotation-alignment")==="map",le=w.get("text-pitch-alignment")==="map",Q=w.get("symbol-z-order")==="viewport-y",ne=w.get("symbol-z-elevate");this.transform.setProjection(x.projection);let re=ee&&(te||!x.hasIconData()||J),pe=te&&(ee||!x.hasTextData()||H);!x.collisionArrays&&U&&x.deserializeCollisionBoxes(U),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,U);let Ee=(se,Te,Se)=>{let{crossTileID:Be,numVerticalGlyphVertices:Ue}=se;if(L){let An={zoom:this.transform.zoom,pitch:this.transform.pitch},Qt=null;if(L.dynamicFilterNeedsFeature){let Lt=this.retainedQueryData[x.bucketInstanceId];Qt=L.featureIndex.loadFeature({featureIndex:se.featureIndex,bucketIndex:Lt.bucketIndex,sourceLayerIndex:Lt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(An,Qt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(se.tileAnchorX,se.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Be]=new td(!1,!1,!1,!0),void u.add(Be)}if(u.has(Be))return;if(B)return void(this.placements[Be]=new td(!1,!1,!1));let Ne=!1,ye=!1,Ae=!0,Le=!1,et=!1,it=null,nt={box:null,offscreen:null,occluded:null},ze={box:null,offscreen:null,occluded:null},Ve=null,tt=null,ut=null,At=0,Bt=0,on=0;Se.textFeatureIndex?At=Se.textFeatureIndex:se.useRuntimeCollisionCircles&&(At=se.featureIndex),Se.verticalTextFeatureIndex&&(Bt=Se.verticalTextFeatureIndex);let tn=An=>{An.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Qt=this.transform.elevation;An.elevation=se.zOffset+(Qt?Qt.getAtTileOffset(An.tileID,An.tileAnchorX,An.tileAnchorY):0)},Cn=Se.textBox;if(Cn){tn(Cn);let An=Lt=>{let qn=r.aE.horizontal;if(x.allowVerticalPlacement&&!Lt&&this.prevPlacement){let Yn=this.prevPlacement.placedOrientations[Be];Yn&&(this.placedOrientations[Be]=Yn,qn=Yn,this.markUsedOrientation(x,qn,se))}return qn},Qt=(Lt,qn)=>{if(x.allowVerticalPlacement&&Ue>0&&Se.verticalTextBox){for(let Yn of x.writingModes)if(Yn===r.aE.vertical?(nt=qn(),ze=nt):nt=Lt(),nt&&nt.box&&nt.box.length)break}else nt=Lt()};if(w.get("text-variable-anchor")){let Lt=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Be]){let sn=this.prevPlacement.variableOffsets[Be];Lt.indexOf(sn.anchor)>0&&(Lt=Lt.filter(Fe=>Fe!==sn.anchor),Lt.unshift(sn.anchor))}let qn=(sn,Fe,st)=>{let Mr=x.getSymbolInstanceTextSize($,se,this.transform.zoom,Te),Mn=(sn.x2-sn.x1)*Mr+2*sn.padding,we=(sn.y2-sn.y1)*Mr+2*sn.padding,Ei=se.hasIconTextFit&&!te?Fe:null;Ei&&tn(Ei);let ii={box:[],offscreen:!1,occluded:!1},Lr=ee?2*Lt.length:Lt.length;for(let mi=0;mi<Lr;++mi){let Pi=this.attemptAnchorPlacement(Lt[mi%Lt.length],sn,Mn,we,Mr,ue,le,F,I,q,mi>=Lt.length,se,Te,x,st,Ei,$,G);if(Pi&&(ii=Pi.placedGlyphBoxes,ii&&ii.box&&ii.box.length)){Ne=!0,it=Pi.shift;break}}return ii};Qt(()=>qn(Cn,Se.iconBox,r.aE.horizontal),()=>{let sn=Se.verticalTextBox;return sn&&tn(sn),x.allowVerticalPlacement&&!(nt&&nt.box&&nt.box.length)&&Ue>0&&sn?qn(sn,Se.verticalIconBox,r.aE.vertical):{box:null,offscreen:null,occluded:null}}),nt&&(Ne=nt.box,Ae=nt.offscreen,Le=nt.occluded);let Yn=An(!(!nt||!nt.box));if(!Ne&&this.prevPlacement){let sn=this.prevPlacement.variableOffsets[Be];sn&&(this.variableOffsets[Be]=sn,this.markUsedJustification(x,sn.anchor,se,Yn))}}else{let Lt=(qn,Yn)=>{let sn=x.getSymbolInstanceTextSize($,se,this.transform.zoom,Te),Fe=this.collisionIndex.placeCollisionBox(x,sn,qn,new r.P(0,0),ee,F,I,q.predicate);return Fe&&Fe.box&&Fe.box.length&&(this.markUsedOrientation(x,Yn,se),this.placedOrientations[Be]=Yn),Fe};Qt(()=>Lt(Cn,r.aE.horizontal),()=>{let qn=Se.verticalTextBox;return x.allowVerticalPlacement&&Ue>0&&qn?(tn(qn),Lt(qn,r.aE.vertical)):{box:null,offscreen:null,occluded:null}}),An(!!(nt&&nt.box&&nt.box.length))}}if(Ve=nt,Ne=Ve&&Ve.box&&Ve.box.length>0,Ae=Ve&&Ve.offscreen,Le=Ve&&Ve.occluded,se.useRuntimeCollisionCircles){let An=x.text.placedSymbolArray.get(se.centerJustifiedTextSymbolIndex>=0?se.centerJustifiedTextSymbolIndex:se.verticalPlacedTextSymbolIndex),Qt=r.aF(x.textSizeData,$,An),Lt=w.get("text-padding");tt=this.collisionIndex.placeCollisionCircles(x,ee,An,x.lineVertexArray,x.glyphOffsetArray,Qt,I,M,A,g,le,q.predicate,se.collisionCircleDiameter*Qt/r.bN,Lt,this.retainedQueryData[x.bucketInstanceId].tileID),Ne=ee||tt.circles.length>0&&!tt.collisionDetected,Ae=Ae&&tt.offscreen,Le=tt.occluded}if(Se.iconFeatureIndex&&(on=Se.iconFeatureIndex),Se.iconBox){let An=Qt=>{tn(Qt);let Lt=se.hasIconTextFit&&it?vu(it.x,it.y,ue,le,this.transform.angle):new r.P(0,0),qn=x.getSymbolInstanceIconSize(G,this.transform.zoom,se.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,qn,Qt,Lt,te,F,I,q.predicate)};ze&&ze.box&&ze.box.length&&Se.verticalIconBox?(ut=An(Se.verticalIconBox),ye=ut.box.length>0):(ut=An(Se.iconBox),ye=ut.box.length>0),Ae=Ae&&ut.offscreen,et=ut.occluded}let Ot=H||se.numHorizontalGlyphVertices===0&&Ue===0,Tn=J||se.numIconVertices===0;if(Ot||Tn?Tn?Ot||(ye=ye&&Ne):Ne=ye&&Ne:ye=Ne=ye&&Ne,Ne&&Ve&&Ve.box&&this.collisionIndex.insertCollisionBox(Ve.box,w.get("text-ignore-placement"),x.bucketInstanceId,ze&&ze.box&&Bt?Bt:At,q.ID),ye&&ut&&this.collisionIndex.insertCollisionBox(ut.box,w.get("icon-ignore-placement"),x.bucketInstanceId,on,q.ID),tt&&(Ne&&this.collisionIndex.insertCollisionCircles(tt.circles,w.get("text-ignore-placement"),x.bucketInstanceId,At,q.ID),g)){let An=x.bucketInstanceId,Qt=this.collisionCircleArrays[An];Qt===void 0&&(Qt=this.collisionCircleArrays[An]=new R_);for(let Lt=0;Lt<tt.circles.length;Lt+=4)Qt.circles.push(tt.circles[Lt+0]),Qt.circles.push(tt.circles[Lt+1]),Qt.circles.push(tt.circles[Lt+2]),Qt.circles.push(tt.collisionDetected?1:0)}let Un=x.projection.name!=="globe";re=re&&(Un||!Le),pe=pe&&(Un||!et),this.placements[Be]=new td(Ne||re,ye||pe,Ae||x.justReloaded),u.add(Be)};if(ne&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),Q){let se=x.getSortedSymbolIndexes(this.transform.angle);for(let Te=se.length-1;Te>=0;--Te){let Se=se[Te];Ee(x.symbolInstances.get(Se),Se,x.collisionArrays[Se])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let se=x.getSortedIndexesByZOffset();for(let Te=0;Te<se.length;++Te){let Se=se[Te];Ee(x.symbolInstances.get(Se),Se,x.collisionArrays[Se])}}else for(let se=s.symbolInstanceStart;se<s.symbolInstanceEnd;se++)Ee(x.symbolInstances.get(se),se,x.collisionArrays[se]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let se=this.collisionCircleArrays[x.bucketInstanceId];r.ad.invert(se.invProjMatrix,I),se.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,u,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:M,crossTileID:A}=g,L=r.cJ(u),F=v===r.aE.vertical?M:L==="left"?x:L==="center"?w:L==="right"?I:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:A),w>=0&&(s.text.placedSymbolArray.get(w).crossTileID=F>=0&&w!==F?0:A),I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=F>=0&&I!==F?0:A),M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=F>=0&&M!==F?0:A)}markUsedOrientation(s,u,g){let v=u===r.aE.horizontal||u===r.aE.horizontalOnly?u:0,x=u===r.aE.vertical?u:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:A}=g,L=s.text.placedSymbolArray;w>=0&&(L.get(w).placedOrientation=v),I>=0&&(L.get(I).placedOrientation=v),M>=0&&(L.get(M).placedOrientation=v),A>=0&&(L.get(A).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let v=u?u.symbolFadeChange(s):1,x=u?u.opacities:{},w=u?u.variableOffsets:{},I=u?u.placedOrientations:{};for(let M in this.placements){let A=this.placements[M],L=x[M];L?(this.opacities[M]=new Fs(L,v,A.text,A.icon,null,A.clipped),g=g||A.text!==L.text.placed||A.icon!==L.icon.placed):(this.opacities[M]=new Fs(null,v,A.text,A.icon,A.skipFade,A.clipped),g=g||A.text||A.icon)}for(let M in x){let A=x[M];if(!this.opacities[M]){let L=new Fs(A,v,!1,!1);L.isHidden()||(this.opacities[M]=L,g=g||A.text.placed||A.icon.placed)}}for(let M in w)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=w[M]);for(let M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u,g,v){let x=new Set;for(let w of u){let I=w.getBucket(s);I&&w.latestFeatureIndex&&s.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,x,w.collisionBoxArray,g,v,w.tileID),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,w.tileID),I.updateZOffset()))}}updateBucketOpacities(s,u,g,v,x,w){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();let I=s.layers[0].layout,M=!!s.layers[0].dynamicFilter(),A=new Fs(null,0,!1,!1,!0),L=I.get("text-allow-overlap"),F=I.get("icon-allow-overlap"),B=I.get("text-variable-anchor"),U=I.get("text-rotation-alignment")==="map",$=I.get("text-pitch-alignment")==="map",G=new Fs(null,0,L&&(F||!s.hasIconData()||I.get("icon-optional")),F&&(L||!s.hasTextData()||I.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);let q=(J,ee,te)=>{for(let ue=0;ue<ee/4;ue++)J.opacityVertexArray.emplaceBack(te)},H=0;x&&s.updateReplacement(w,x);for(let J=0;J<s.symbolInstances.length;J++){let ee=s.symbolInstances.get(J),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ue,crossTileID:le,numIconVertices:Q,tileAnchorX:ne,tileAnchorY:re}=ee,pe=u.has(le),Ee=this.opacities[le];pe?Ee=A:Ee||(Ee=G,this.opacities[le]=Ee),u.add(le);let se=te>0||ue>0,Te=Q>0,Se=this.placedOrientations[le],Be=Se===r.aE.vertical,Ue=Se===r.aE.horizontal||Se===r.aE.horizontalOnly;!se&&!Te||Ee.isHidden()||H++;let Ne=!1;if((se||Te)&&x)for(let ye of s.activeReplacements){if(ye.order<v||ye.order===1/0||!(ye.clipMask&r.cu.Symbol)||ye.min.x>ne||ne>ye.max.x||ye.min.y>re||re>ye.max.y)continue;let Ae=r.cH(ne,re,w.canonical,ye.footprintTileId.canonical);if(Ne=r.cI(Ae,ye),Ne)break}if(se){let ye=Ne?Ns:Fo(Ee.text);q(s.text,te,Be?Ns:ye),q(s.text,ue,Ue?Ns:ye);let Ae=Ee.text.isHidden(),{leftJustifiedTextSymbolIndex:Le,centerJustifiedTextSymbolIndex:et,rightJustifiedTextSymbolIndex:it,verticalPlacedTextSymbolIndex:nt}=ee,ze=s.text.placedSymbolArray,Ve=Ae||Be?1:0;Le>=0&&(ze.get(Le).hidden=Ve),et>=0&&(ze.get(et).hidden=Ve),it>=0&&(ze.get(it).hidden=Ve),nt>=0&&(ze.get(nt).hidden=Ae||Ue?1:0);let tt=this.variableOffsets[le];tt&&this.markUsedJustification(s,tt.anchor,ee,Se);let ut=this.placedOrientations[le];ut&&(this.markUsedJustification(s,"left",ee,ut),this.markUsedOrientation(s,ut,ee))}if(Te){let ye=Ne?Ns:Fo(Ee.icon),{placedIconSymbolIndex:Ae,verticalPlacedIconSymbolIndex:Le}=ee,et=s.icon.placedSymbolArray,it=Ee.icon.isHidden()?1:0;Ae>=0&&(q(s.icon,Q,Be?Ns:ye),et.get(Ae).hidden=it),Le>=0&&(q(s.icon,ee.numVerticalIconVertices,Ue?Ns:ye),et.get(Le).hidden=it)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){let ye=s.collisionArrays[J];if(ye){let Ae=new r.P(0,0),Le=!0;if(ye.textBox||ye.verticalTextBox){if(B){let it=this.variableOffsets[le];it?(Ae=Op(it.anchor,it.width,it.height,it.textOffset,it.textScale),U&&Ae._rotate($?this.transform.angle:-this.transform.angle)):Le=!1}M&&(Le=!Ee.clipped),ye.textBox&&xu(s.textCollisionBox.collisionVertexArray,Ee.text.placed,!Le||Be,Ae.x,Ae.y),ye.verticalTextBox&&xu(s.textCollisionBox.collisionVertexArray,Ee.text.placed,!Le||Ue,Ae.x,Ae.y)}let et=Le&&!!(!Ue&&ye.verticalIconBox);ye.iconBox&&xu(s.iconCollisionBox.collisionVertexArray,Ee.icon.placed,et,ee.hasIconTextFit?Ae.x:0,ee.hasIconTextFit?Ae.y:0),ye.verticalIconBox&&xu(s.iconCollisionBox.collisionVertexArray,Ee.icon.placed,!et,ee.hasIconTextFit?Ae.x:0,ee.hasIconTextFit?Ae.y:0)}}}if(s.fullyClipped=H===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){let J=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=J.invProjMatrix,s.placementViewportMatrix=J.viewportMatrix,s.collisionCircleArray=J.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){let g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function xu(p,s,u,g,v){p.emplaceBack(s?1:0,u?1:0,g||0,v||0),p.emplaceBack(s?1:0,u?1:0,g||0,v||0),p.emplaceBack(s?1:0,u?1:0,g||0,v||0),p.emplaceBack(s?1:0,u?1:0,g||0,v||0)}let Lp=Math.pow(2,25),Je=Math.pow(2,24),O_=Math.pow(2,17),kp=Math.pow(2,16),Fp=Math.pow(2,9),L_=Math.pow(2,8),nd=Math.pow(2,1);function Fo(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;let s=p.placed?1:0,u=Math.floor(127*p.opacity);return u*Lp+s*Je+u*O_+s*kp+u*Fp+s*L_+u*nd+s}let Ns=0;class Aa{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,u,g,v,x){let w=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(w,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((I,M)=>I.sortKey-M.sortKey));this._currentPartIndex<w.length;){let I=w[this._currentPartIndex];if(u.placeLayerBucketPart(I,this._seenCrossTileIDs,g,I.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class rd{constructor(s,u,g,v,x,w,I,M,A){this.placement=new Qi(s,x,w,I,M,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,u,g,v){let x=r.e.now(),w=()=>{let I=r.e.now()-x;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){let I=u[s[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=M)&&(!I.maxzoom||I.maxzoom>M)){let A=I,L=A.layout.get("symbol-z-elevate"),F=this._inProgressLayer=this._inProgressLayer||new Aa(A),B=r.al(I.source,I.scope);if(F.continuePlacement(L?v[B]:g[B],this.placement,this._showCollisionBoxes,I,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}let zs=512/r.a3/2;class _1{constructor(s,u,g){this.tileID=s,this.bucketInstanceId=g,this.index=new r.cK(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=s.canonical.x*r.a3,x=s.canonical.y*r.a3;for(let w=0;w<u.length;w++){let{key:I,crossTileID:M,tileAnchorX:A,tileAnchorY:L}=u.get(w),F=Math.floor((v+A)*zs),B=Math.floor((x+L)*zs);this.index.add(F,B),this.keys.push(I),this.crossTileIDs.push(M)}this.index.finish()}findMatches(s,u,g){let v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),x=zs/Math.pow(2,u.canonical.z-this.tileID.canonical.z),w=u.canonical.x*r.a3,I=u.canonical.y*r.a3;for(let M=0;M<s.length;M++){let A=s.get(M);if(A.crossTileID)continue;let{key:L,tileAnchorX:F,tileAnchorY:B}=A,U=Math.floor((w+F)*x),$=Math.floor((I+B)*x),G=this.index.range(U-v,$-v,U+v,$+v);for(let q of G){let H=this.crossTileIDs[q];if(this.keys[q]===L&&!g.has(H)){g.add(H),A.crossTileID=H;break}}}}}class y1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Np{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){let u=Math.round((s-this.lng)/360);if(u!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let w in v){let I=v[w];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+u),x[I.tileID.key]=I}this.indexes[g]=x}this.lng=s}addBucket(s,u,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);let v=this.usedCrossTileIDs[s.overscaledZ];for(let x in this.indexes){let w=this.indexes[x];if(Number(x)>s.overscaledZ)for(let I in w){let M=w[I];M.tileID.isChildOf(s)&&M.findMatches(u.symbolInstances,s,v)}else{let I=w[s.scaledTo(Number(x)).key];I&&I.findMatches(u.symbolInstances,s,v)}}for(let x=0;x<u.symbolInstances.length;x++){let w=u.symbolInstances.get(x);w.crossTileID||(w.crossTileID=g.generate(),v.add(w.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new _1(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(let g of u.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let u=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)s[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],u=!0)}return u}}class v1{constructor(){this.layerIndexes={},this.crossTileIDs=new y1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,g,v){let x=this.layerIndexes[s.fqid];x===void 0&&(x=this.layerIndexes[s.fqid]=new Np);let w=!1,I={};v.name!=="globe"&&x.handleWrapJump(g);for(let M of u){let A=M.getBucket(s);A&&s.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(M.tileID,A,this.crossTileIDs)&&(w=!0),I[A.bucketInstanceId]=!0)}return x.removeStaleBuckets(I)&&(w=!0),w}pruneUnusedLayers(s){let u={};s.forEach(g=>{u[g]=!0});for(let g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}let k_=new r.N({data:new r.O(r.L.colorTheme.data)}),Bs=(p,s)=>kt(p,s&&s.filter(u=>u.identifier!=="source.canvas")),zp=r.ah(hn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),x1=r.ah(hn,["setCenter","setZoom","setBearing","setPitch"]),F_={version:8,layers:[],sources:{}},N_={duration:300,delay:0};class go extends r.E{constructor(s,u={}){super(),this.map=s,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=r.W({},N_),this._buildingIndex=new p1(this),this.crossTileSymbolIndex=new v1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new ir,this.dispatcher=u.dispatcher?u.dispatcher:new r.bw(r.bx(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Gc,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new r.cM(s._requestManager,u.localFontFamily?r.cN.all:u.localIdeographFontFamily?r.cN.ideographs:r.cN.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new Mh(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",r.cO());let g=this;this._rtlTextPluginCallback=go.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,w)=>{if(r.cP(x),w&&w.every(I=>I))for(let I in g._sourceCaches){let M=g._sourceCaches[I],A=M.getSource().type;A!=="vector"&&A!=="geojson"||M.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let w in this._layers){let I=this._layers[w];I.source===x.id&&this._validateLayer(I)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(r.cQ(s))return s;let u=r.cR(s);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${r.cS(JSON.stringify(s))}`}_diffStyle(s,u,g){this.globalId=this._getGlobalId(s);let v=(x,w)=>{try{w(null,this.setState(x,g))}catch(I){w(I,!1)}};if(typeof s=="string"){let x=this.map._requestManager.normalizeStyleURL(s),w=this.map._requestManager.transformRequest(x,r.R.Style);r.g(w,(I,M)=>{I?this.fire(new r.d(I)):M&&v(M,u)})}else typeof s=="object"&&v(s,u)}loadURL(s,u={}){this.fire(new r.f("dataloading",{dataType:"style"}));let g=typeof u.validate=="boolean"?u.validate:!r.cQ(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,u.accessToken),this.resolvedImports.add(s);let v=this.importsCache.get(s);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(s,r.R.Style);this._request=r.g(x,(w,I)=>{if(this._request=null,w)this.fire(new r.d(w));else if(I)return this.importsCache.set(s,I),this._load(I,g)})}loadJSON(s,u={}){this.fire(new r.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=r.e.frame(()=>{this._request=null,this._load(s,u.validate!==!1)})}loadEmpty(){this.fire(new r.f("dataloading",{dataType:"style"})),this._load(F_,!1)}_loadImports(s,u,g){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of s){let w=this._createFragmentStyle(x),I=new Promise(L=>{w.once("style.import.load",L),w.once("error",L)}).then(()=>this.mergeAll());if(v.push(I),this.resolvedImports.has(x.url)){w.loadEmpty();continue}let M=x.data||this.importsCache.get(x.url);M?(w.loadJSON(M,{validate:u}),this._isInternalStyle(M)&&(w.globalId=null)):x.url?w.loadURL(x.url,{validate:u}):w.loadEmpty();let A={style:w,id:x.id,config:x.config};if(g){let L=this.fragments.findIndex(({id:F})=>F===g);this.fragments=this.fragments.slice(0,L).concat(A).concat(this.fragments.slice(L))}else this.fragments.push(A)}return Promise.allSettled(v)}getImportGlobalIds(s=this,u=new Set){for(let g of s.fragments)g.style.globalId&&u.add(g.style.globalId),this.getImportGlobalIds(g.style,u);return[...u.values()]}_createFragmentStyle(s){let u=this.scope?r.al(s.id,this.scope):s.id,g,v=this._initialConfig&&this._initialConfig[u];(s.config||v)&&(g=r.W({},s.config,v));let x=new go(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,u){let g=s.schema;if(this._isInternalStyle(s)){let w=r.W({},F_,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(w,u)}if(this.updateConfig(this._config,g),u&&Bs(this,he(s)))return;this._loaded=!0,this.stylesheet=r.cT(s);let v=()=>{for(let A in s.sources)this.addSource(A,s.sources[A],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);let w=Pp(this.stylesheet.layers);if(this._order=w.map(A=>A.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let A=this.stylesheet.lights[0];this.light=new ht(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ht(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let A of w){let L=r.cY(A,this.scope,this._styleColorTheme.lut,this.options);L.isConfigDependent&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize();let F=this.getOwnLayerSourceCache(L),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&L.canCastShadows()&&B&&(F.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.f("data",{dataType:"style"}));let M=this.isRootStyle();s.imports?this._loadImports(s.imports,u).then(()=>{this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.f(M?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let w=this._evaluateColorThemeData(x);this._loadColorTheme(w).then(()=>{v()}).catch(I=>{r.w(`Couldn't load color theme from the stylesheet: ${I}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,u,g,v,x,w,I,M,A={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(s=L.light),L.stylesheet.lights)for(let F of L.stylesheet.lights)F.type==="ambient"&&L.ambientLight!=null&&(u=L.ambientLight),F.type==="directional"&&L.directionalLight!=null&&(g=L.directionalLight);v=this._prioritizeTerrain(v,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(x=L.fog),L.stylesheet.camera!=null&&(M=L.stylesheet.camera),L.stylesheet.projection!=null&&(w=L.stylesheet.projection),L.stylesheet.transition!=null&&(I=L.stylesheet.transition),A[L.scope]=L._styleColorTheme}}),this.light=s,this.ambientLight=u,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=A,v===null?delete this.terrain:this.terrain=v,this.camera=M||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=r.W({},N_,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){let u=g=>{for(let v of g.fragments)u(v.style);s(g)};u(this)}_prioritizeTerrain(s,u,g){let v=s&&s.drapeRenderMode===0;return g===null?u&&u.drapeRenderMode===0?u:v?s:null:u!=null&&(!s||v||u&&u.drapeRenderMode===1)?u:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{s=this._prioritizeTerrain(s,u.terrain,u.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(s=u.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){let s={},u={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let w=r.al(x,v.scope);s[w]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let w=r.al(x,v.scope);u[w]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let w=r.al(x,v.scope);g[w]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=g}mergeLayers(){let s={},u=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(let I of w._order){let M=w._layers[I];if(M.type==="slot"){let A=r.cU(I);if(s[A])continue;s[A]=[]}M.slot&&s[M.slot]?s[M.slot].push(M):u.push(M)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(w=[])=>{for(let I of w)if(I.type==="slot"){let M=r.cU(I.id);s[M]&&x(s[M]),this._mergedSlots.push(M)}else{let M=r.al(I.id,I.scope);this._mergedOrder.push(M),g[M]=I,I.is3D()&&(this._has3DLayers=!0),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(u),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=r.W({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(u,g,v){let x=r.W({},g);for(let I of Object.keys(r.L.colorTheme))x[I]===void 0&&(x[I]=r.L.colorTheme[I].default);let w=new r.U(k_,u,new Map(v));return w.setTransitionOrValue(x,v),w.untransitioned().possiblyEvaluate(new r.X(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){return this._styleColorTheme.lutLoading=!0,new Promise((u,g)=>{let v="data:image/png;base64,";if(s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();s.startsWith(v)||(s=v+s);let x="mapbox-reserved-lut",w=new Image;w.src=s,w.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},w.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:I,height:M,data:A}=r.e.getImageData(w);if(M>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(I!==M*M)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new r.i({width:I,height:M},A),pixelRatio:1,sdf:!1,version:0});let L=this.imageManager.getImage(x,this.scope);L?(this._styleColorTheme.lut={image:L.data,data:s},u()):g(new Error("Missing LUT image."))}})}getLut(s){let u=this._styleColorThemeForScope[s];return u?u.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(u,g,v){let x,w,I,M=r.e.devicePixelRatio>1?"@2x":"",A=r.g(g.transformRequest(g.normalizeSpriteURL(u,M,".json"),r.R.SpriteJSON),(B,U)=>{A=null,I||(I=B,x=U,F())}),L=r.h(g.transformRequest(g.normalizeSpriteURL(u,M,".png"),r.R.SpriteImage),(B,U)=>{L=null,I||(I=B,w=U,F())});function F(){if(I)v(I);else if(x&&w){let B=r.e.getImageData(w),U={};for(let $ in x){let{width:G,height:q,x:H,y:J,sdf:ee,pixelRatio:te,stretchX:ue,stretchY:le,content:Q}=x[$],ne=new r.i({width:G,height:q});r.i.copy(B,ne,{x:H,y:J},{x:0,y:0},{width:G,height:q},null),U[$]={data:ne,pixelRatio:te,sdf:ee,stretchX:ue,stretchY:le,content:Q}}v(null,U)}}return{cancel(){A&&(A.cancel(),A=null),L&&(L.cancel(),L=null)}}}(s,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new r.d(u));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.f("data",{dataType:"style"}))})}_validateLayer(s){let u=this.getOwnSource(s.source);if(!u)return;let g=s.sourceLayer;g&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(g)===-1)&&this.fire(new r.d(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,u)=>{let g=this.fragments[u];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){let s={};for(let u in this._sourceCaches){let g=this._sourceCaches[u].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){let u=[];for(let g of s){let v=this._layers[g];v&&v.type!=="custom"&&u.push(v.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(let s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){let u=this.getOwnLayer(s);if(u)return u;this.fire(new r.d(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){let u=this.getOwnSource(s);if(u)return u;this.fire(new r.d(new Error(`The source '${s}' does not exist in the map's style.`)))}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);let u=this.calculateLightsBrightness();s.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let w=this._changes.getLayerUpdatesByScope();for(let I in w){let{updatedIds:M,removedIds:A}=w[I];(M||A)&&(this._updateWorkerLayers(I,M,A),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}let x={};for(let w in this._mergedSourceCaches){let I=this._mergedSourceCaches[w];x[w]=I.used,I.used=!1,I.tileCoverLift=0}for(let w of this._mergedOrder){let I=this._mergedLayers[w];if(I.recalculate(s,this._availableImages),!I.isHidden(s.zoom)){let M=this.getLayerSourceCache(I);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,I.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let M=I.minzoom||0;M<(I.maxzoom||25.5);M++){let A=this.map.painter;if(A){let L=I.getProgramIds();if(!L)continue;for(let F of L){let B=I.getDefaultProgramParams(F,s.zoom,this._styleColorTheme.lut);B&&(A.style=this,this.fog&&(A._fogVisible=!0,B.overrideFog=!0,A.getOrCreateProgram(F,B)),A._fogVisible=!1,B.overrideFog=!1,A.getOrCreateProgram(F,B),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(B.overrideRtt=!0,A.getOrCreateProgram(F,B)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let w in x){let I=this._mergedSourceCaches[w];x[w]!==I.used&&I.getSource().fire(new r.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new r.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let s=this._changes.getUpdatedImages();if(s.length){for(let u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,u,g){let v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:u?v._serializeLayers(u):[],scope:s,removedIds:g||[],options:v.options})}setState(s,u){if(this._checkLoaded(),Bs(this,he(s)))return!1;(s=r.cT(s)).layers=Pp(s.layers);let g=function(w,I){if(!w)return[{command:hn.setStyle,args:[I]}];let M=[];try{if(!E(w.version,I.version))return[{command:hn.setStyle,args:[I]}];if(E(w.center,I.center)||M.push({command:hn.setCenter,args:[I.center]}),E(w.zoom,I.zoom)||M.push({command:hn.setZoom,args:[I.zoom]}),E(w.bearing,I.bearing)||M.push({command:hn.setBearing,args:[I.bearing]}),E(w.pitch,I.pitch)||M.push({command:hn.setPitch,args:[I.pitch]}),E(w.sprite,I.sprite)||M.push({command:hn.setSprite,args:[I.sprite]}),E(w.glyphs,I.glyphs)||M.push({command:hn.setGlyphs,args:[I.glyphs]}),E(w.imports,I.imports)||function(U=[],$=[],G){$=$||[];let q=(U=U||[]).map(ed),H=$.map(ed),J=U.reduce(Nl,{}),ee=$.reduce(Nl,{}),te=q.slice(),ue,le,Q,ne;for(ue=0,le=0;ue<q.length;ue++)Q=q[ue],ee.hasOwnProperty(Q)?le++:(G.push({command:hn.removeImport,args:[Q]}),te.splice(te.indexOf(Q,le),1));for(ue=0,le=0;ue<H.length;ue++)Q=H[H.length-1-ue],te[te.length-1-ue]!==Q&&(J.hasOwnProperty(Q)?(G.push({command:hn.removeImport,args:[Q]}),te.splice(te.lastIndexOf(Q,te.length-le),1)):le++,ne=te[te.length-ue],G.push({command:hn.addImport,args:[ee[Q],ne]}),te.splice(te.length-ue,0,Q));for(let re of $){let pe=J[re.id];pe&&!E(pe,re)&&G.push({command:hn.updateImport,args:[re.id,re]})}}(w.imports,I.imports,M),E(w.transition,I.transition)||M.push({command:hn.setTransition,args:[I.transition]}),E(w.light,I.light)||M.push({command:hn.setLight,args:[I.light]}),E(w.fog,I.fog)||M.push({command:hn.setFog,args:[I.fog]}),E(w.projection,I.projection)||M.push({command:hn.setProjection,args:[I.projection]}),E(w.lights,I.lights)||M.push({command:hn.setLights,args:[I.lights]}),E(w.camera,I.camera)||M.push({command:hn.setCamera,args:[I.camera]}),!E(w["color-theme"],I["color-theme"]))return[{command:hn.setStyle,args:[I]}];let A={},L=[];(function(U,$,G,q){let H;for(H in $=$||{},U=U||{})U.hasOwnProperty(H)&&($.hasOwnProperty(H)||M_(H,G,q));for(H in $){if(!$.hasOwnProperty(H))continue;let J=$[H];U.hasOwnProperty(H)?E(U[H],J)||(U[H].type==="geojson"&&J.type==="geojson"&&g1(U,$,H)?G.push({command:hn.setGeoJSONSourceData,args:[H,J.data]}):m1(H,$,G,q)):es(H,$,G)}})(w.sources,I.sources,L,A);let F=[];w.layers&&w.layers.forEach(U=>{U.source&&A[U.source]?M.push({command:hn.removeLayer,args:[U.id]}):F.push(U)});let B=w.terrain;B&&A[B.source]&&(M.push({command:hn.setTerrain,args:[void 0]}),B=void 0),M=M.concat(L),E(B,I.terrain)||M.push({command:hn.setTerrain,args:[I.terrain]}),function(U,$,G){$=$||[];let q=(U=U||[]).map(ed),H=$.map(ed),J=U.reduce(Nl,{}),ee=$.reduce(Nl,{}),te=q.slice(),ue=Object.create(null),le,Q,ne,re,pe,Ee,se;for(le=0,Q=0;le<q.length;le++)ne=q[le],ee.hasOwnProperty(ne)?Q++:(G.push({command:hn.removeLayer,args:[ne]}),te.splice(te.indexOf(ne,Q),1));for(le=0,Q=0;le<H.length;le++)ne=H[H.length-1-le],te[te.length-1-le]!==ne&&(J.hasOwnProperty(ne)?(G.push({command:hn.removeLayer,args:[ne]}),te.splice(te.lastIndexOf(ne,te.length-Q),1)):Q++,Ee=te[te.length-le],G.push({command:hn.addLayer,args:[ee[ne],Ee]}),te.splice(te.length-le,0,ne),ue[ne]=!0);for(le=0;le<H.length;le++)if(ne=H[le],re=J[ne],pe=ee[ne],!ue[ne]&&!E(re,pe))if(E(re.source,pe.source)&&E(re["source-layer"],pe["source-layer"])&&E(re.type,pe.type)){for(se in gu(re.layout,pe.layout,G,ne,null,hn.setLayoutProperty),gu(re.paint,pe.paint,G,ne,null,hn.setPaintProperty),E(re.slot,pe.slot)||G.push({command:hn.setSlot,args:[ne,pe.slot]}),E(re.filter,pe.filter)||G.push({command:hn.setFilter,args:[ne,pe.filter]}),E(re.minzoom,pe.minzoom)&&E(re.maxzoom,pe.maxzoom)||G.push({command:hn.setLayerZoomRange,args:[ne,pe.minzoom,pe.maxzoom]}),re)re.hasOwnProperty(se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&se!=="slot"&&(se.indexOf("paint.")===0?gu(re[se],pe[se],G,ne,se.slice(6),hn.setPaintProperty):E(re[se],pe[se])||G.push({command:hn.setLayerProperty,args:[ne,se,pe[se]]}));for(se in pe)pe.hasOwnProperty(se)&&!re.hasOwnProperty(se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&se!=="slot"&&(se.indexOf("paint.")===0?gu(re[se],pe[se],G,ne,se.slice(6),hn.setPaintProperty):E(re[se],pe[se])||G.push({command:hn.setLayerProperty,args:[ne,se,pe[se]]}))}else G.push({command:hn.removeLayer,args:[ne]}),Ee=te[te.lastIndexOf(ne)+1],G.push({command:hn.addLayer,args:[pe,Ee]})}(F,I.layers,M)}catch(A){console.warn("Unable to compute style diff:",A),M=[{command:hn.setStyle,args:[I]}]}return M}(this.serialize(),s).filter(w=>!(w.command in x1));if(g.length===0)return!1;let v=g.filter(w=>!(w.command in zp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);let x=[];return g.forEach(w=>{x.push(this[w.command].apply(this,w.args))}),u&&Promise.all(x).then(u),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,u){return this.getImage(s)?this.fire(new r.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,u),this._afterImageUpdated(s),this)}updateImage(s,u){this.imageManager.updateImage(s,this.scope,u)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new r.d(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,u,g={}){return this._checkLoaded(),this._validate(Wt,`models.${s}`,u,null,g)||(this.modelManager.addModel(s,u,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new r.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,u,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(de,`sources.${s}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let v=jh(s,u,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=w=>{let I=(w?"symbol:":"other:")+v.id,M=r.al(I,this.scope),A=this._sourceCaches[I]=new r.bv(M,v,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=A,A.onAdd(this.map)};x(!1),u.type!=="vector"&&u.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();let u=this.getOwnSource(s);if(!u)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new r.d(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(s);for(let v of g){let x=r.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,u){this._checkLoaded(),this.getOwnSource(s).setData(u),this._changes.setDirty()}getOwnSource(s){let u=this.getOwnSourceCache(s);return u&&u.getSource()}getOwnSources(){let s=[];for(let u in this._otherSourceCaches){let g=this.getOwnSourceCache(u);g&&s.push(g.getSource())}return s}areTilesLoaded(){let s=this._mergedSourceCaches;for(let u in s){let g=s[u]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;let u=this._getTransitionParameters();for(let v of s){if(this._validate(Ce,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(u)}else this.ambientLight=new Wc(v,qt,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(u)}else this.directionalLight=new Wc(v,Hf,this.scope,this.options)}}let g=new r.X(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let s=this.directionalLight,u=this.ambientLight;if(!s||!u)return;let g=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),x=s.properties.get("intensity"),w=s.properties.get("direction"),I=1-r.ac(w.x,w.y,w.z)[2]/90,M=g(v)*x*I,A=u.properties.get("color").toRenderColor(null).toArray01(),L=u.properties.get("intensity");return(M+g(A)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(r.cV(s)){let u=r.cW(s),g=this.fragments.find(({id:x})=>x===u);if(!g)throw new Error(`Style import not found: ${s}`);let v=r.cU(s);return g.style.getFragmentStyle(v)}{let u=this.fragments.find(({id:g})=>g===s);if(!u)throw new Error(`Style import not found: ${s}`);return u.style}}getConfigProperty(s,u){let g=this.getFragmentStyle(s);if(!g)return null;let v=r.al(u,g.scope),x=g.options.get(v),w=x?x.value||x.default:null;return w?w.serialize():null}setConfigProperty(s,u,g){let v=this.getFragmentStyle(s);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[u])return;let w=r.y(g);if(w.result!=="success")return void Bs(this,w.value);let I=w.value.expression,M=r.al(u,v.scope),A=v.options.get(M);if(!A)return;let L,{minValue:F,maxValue:B,stepValue:U,type:$,values:G}=x[u],q=r.y(x[u].default);q.result==="success"&&(L=q.value.expression),L?(this.options.set(M,Tr(xt({},A),{value:I,default:L,minValue:F,maxValue:B,stepValue:U,type:$,values:G})),this.updateConfigDependencies()):this.fire(new r.d(new Error(`No schema defined for the config option "${u}" in the "${s}" fragment.`)))}getConfig(s){let u=this.getFragmentStyle(s);if(!u)return null;let g=u.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let w=r.al(x,u.scope),I=u.options.get(w),M=I?I.value||I.default:null;v[x]=M?M.serialize():null}return v}setConfig(s,u){let g=this.getFragmentStyle(s);g&&(g.updateConfig(u,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){let u=this.getFragmentStyle(s);return u?u.stylesheet.schema:null}setSchema(s,u){let g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=u,g.updateConfig(g._config,u),this.updateConfigDependencies())}updateConfig(s,u){if(this._config=s,s||u)if(u)for(let g in u){let v,x,w=r.y(u[g].default);if(w.result==="success"&&(v=w.value.expression),s&&s[g]!==void 0){let B=r.y(s[g]);B.result==="success"&&(x=B.value.expression)}let{minValue:I,maxValue:M,stepValue:A,type:L,values:F}=u[g];if(v){let B=r.al(g,this.scope);this.options.set(B,{default:v,value:x,minValue:I,maxValue:M,stepValue:A,type:L,values:F})}else this.fire(new r.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new r.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let s of this._configDependentLayers){let u=this.getLayer(s);u&&(u.possiblyEvaluateVisibility(),this._updateLayer(u))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){let u=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut||s._styleColorTheme.lut&&u!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(s,u,g={}){this._checkLoaded();let v=s.id;if(this._layers[v])return void this.fire(new r.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(s.type==="custom"){if(Bs(this,r.cX(s)))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=r.cT(s),s=r.W(s,{source:v})),this._validate(Qe,`layers.${v}`,s,{arrayIndex:-1},g))return;x=r.cY(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let w=this._order.length;if(u){let L=this._order.indexOf(u);if(L===-1)return void this.fire(new r.d(new Error(`Layer with id "${u}" does not exist on this map.`)));x.slot===this._layers[u].slot?w=L:r.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let I=this.getOwnLayerSourceCache(x),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&x.canCastShadows()&&M&&(I.castsShadows=!0);let A=this._changes.getRemovedLayer(x);if(A&&x.source&&I&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let L=r.al(x.source,x.scope);A.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),I.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,u){this._checkLoaded();let g=this._checkLayer(s);if(!g||s===u)return;let v=this._order.indexOf(s);this._order.splice(v,1);let x=this._order.length;if(u){let w=this._order.indexOf(u);if(w===-1)return void this.fire(new r.d(new Error(`Layer with id "${u}" does not exist on this map.`)));g.slot===this._layers[u].slot?x=w:r.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();let u=this._checkLayer(s);if(!u)return;u.setEventedParent(null);let g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],delete this._serializedLayers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);let v=this.getOwnLayerSourceCache(u);if(v&&v.castsShadows){let x=!1;for(let w in this._layers)if(this._layers[w].source===u.source&&this._layers[w].canCastShadows()){x=!0;break}v.castsShadows=x}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(let u in this._layers)if(this._layers[u].type===s)return!0;return!1}setLayerZoomRange(s,u,g){this._checkLoaded();let v=this._checkLayer(s);v&&(v.minzoom===u&&v.maxzoom===g||(u!=null&&(v.minzoom=u),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,u){this._checkLoaded();let g=this._checkLayer(s);g&&g.slot!==u&&(g.slot=u,this._updateLayer(g))}setFilter(s,u,g={}){this._checkLoaded();let v=this._checkLayer(s);if(v&&!E(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Ze,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=r.cT(u),this._updateLayer(v)))}getFilter(s){let u=this._checkLayer(s);if(u)return r.cT(u.filter)}setLayoutProperty(s,u,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(x&&!E(x.getLayoutProperty(u),g)){if(g!=null&&(!v||v.validate!==!1)&&Bs(x,It.call(he,{key:`layers.${s}.layout.${u}`,layerType:x.type,objectKey:u,value:g,styleSpec:r.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(u,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,u){let g=this._checkLayer(s);if(g)return g.getLayoutProperty(u)}setPaintProperty(s,u,g,v={}){this._checkLoaded();let x=this._checkLayer(s);if(!x||E(x.getPaintProperty(u),g)||g!=null&&(!v||v.validate!==!1)&&Bs(x,pt.call(he,{key:`layers.${s}.paint.${u}`,layerType:x.type,objectKey:u,value:g,styleSpec:r.L})))return;let w=x.setPaintProperty(u,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),w&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,u){let g=this._checkLayer(s);if(g)return g.getPaintProperty(u)}setFeatureState(s,u){this._checkLoaded();let g=s.source,v=s.sourceLayer,x=this._checkSource(g);if(!x)return;let w=x.type;if(w==="geojson"&&v)return void this.fire(new r.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!v)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided.")));let I=this.getOwnSourceCaches(g);for(let M of I)M.setFeatureState(v,s.id,u)}removeFeatureState(s,u){this._checkLoaded();let g=s.source,v=this._checkSource(g);if(!v)return;let x=v.type,w=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!w)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new r.d(new Error("A feature id is required to remove its specific state property.")));let I=this.getOwnSourceCaches(g);for(let M of I)M.removeFeatureState(w,s.id,u)}getFeatureState(s){this._checkLoaded();let u=s.source,g=s.sourceLayer,v=this._checkSource(u);if(v){if(v.type!=="vector"||g)return s.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(g,s.id);this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=r.W({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return r.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let s=this.getTerrain(),u=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return r.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(s){this._changes.updateLayer(s);let u=this.getLayerSourceCache(s),g=r.al(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[g]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),u.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){let u=I=>this._mergedLayers[I].type==="fill-extrusion"||this._mergedLayers[I].type==="model",g=this.order,v={},x=[];for(let I=g.length-1;I>=0;I--){let M=g[I];if(u(M)){v[M]=I;for(let A of s){let L=A[M];if(L)for(let F of L)x.push(F)}}}x.sort((I,M)=>M.intersectionZ-I.intersectionZ);let w=[];for(let I=g.length-1;I>=0;I--){let M=g[I];if(u(M))for(let A=x.length-1;A>=0;A--){let L=x[A].feature;if(L.layer&&v[L.layer.id]<I)break;w.push(L),x.pop()}else for(let A of s){let L=A[M];if(L)for(let F of L)w.push(F.feature)}}return w}queryRenderedFeatures(s,u,g){u&&u.filter&&this._validate(Ze,"queryRenderedFeatures.filter",u.filter,null,u),u.scope=this.scope,u.availableImages=this._availableImages,u.serializedLayers=this._serializedLayers;let v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new r.d(new Error("parameters.layers must be an Array."))),[];for(let A of u.layers){let L=this._mergedLayers[A];if(!L)return this.fire(new r.d(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[L.source]=!0}}let x=[],w=u.serializedLayers||{},I=u&&u.layers?u.layers.some(A=>{let L=this.getLayer(A);return L&&L.is3D()}):this.has3DLayers(),M=pi.createFromScreenPoints(s,g);for(let A in this._mergedSourceCaches){let L=this._mergedSourceCaches[A].getSource();if(!L||L.scope!==u.scope)continue;let F=this._mergedSourceCaches[A].getSource().id;u.layers&&!v[F]||x.push(f1(this._mergedSourceCaches[A],this._mergedLayers,w,M,u,g,I,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,L,F,B,U,$,G){let q={},H=$.queryRenderedSymbols(B),J=[];for(let ee of Object.keys(H).map(Number))J.push(G[ee]);J.sort(kl);for(let ee of J){let te=ee.featureIndex.lookupSymbolFeatures(H[ee.bucketInstanceId],L,ee.bucketIndex,ee.sourceLayerIndex,U.filter,U.layers,U.availableImages,A);for(let ue in te){let le=q[ue]=q[ue]||[],Q=te[ue];Q.sort((ne,re)=>{let pe=ee.featureSortOrder;if(pe){let Ee=pe.indexOf(ne.featureIndex);return pe.indexOf(re.featureIndex)-Ee}return re.featureIndex-ne.featureIndex});for(let ne of Q)le.push(ne)}}for(let ee in q)q[ee].forEach(te=>{let ue=te.feature,le=F(A[ee]);if(!le)return;let Q=le.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=Q});return q}(this._mergedLayers,w,this.getLayerSourceCache.bind(this),M.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,u){u&&u.filter&&this._validate(Ze,"querySourceFeatures.filter",u.filter,null,u);let g=this.getOwnSourceCaches(s),v=[];for(let x of g)v=v.concat(mu(x,u));return v}addSourceType(s,u,g){return go.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(go.setSourceType(s,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:u.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,u,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let I in s)if(!E(s[I],v[I])){x=!0;break}if(!x)return;let w=this._getTransitionParameters();this.light.setLight(s,u,g),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,u=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()&&u!==0||delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s,v=s.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let I="terrain-dem-src";this.addSource(I,g.source),g=r.cT(g),g=r.W(g,{source:I})}let x=r.W({},g),w={};if(this.terrain&&v){x.source=this.terrain.get().source;let I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(w.style=I.serialize())}if(this._validate(_e,"terrain",x,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&u!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,u),this.fire(new r.f("data",{dataType:"style"}))}else{let x=this.terrain,w=x.get();for(let I of Object.keys(r.L.terrain))!g.hasOwnProperty(I)&&r.L.terrain[I].default&&(g[I]=r.L.terrain[I].default);for(let I in s)if(!E(s[I],w[I])){x.set(s,this.options),this.stylesheet.terrain=s;let M=this._getTransitionParameters({duration:0});x.updateTransitions(M),this.fire(new r.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){let u=this.fog=new s_(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();let g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let u=this.fog;if(!E(u.get(),s)){u.set(s,this.options),this.stylesheet.fog=u.get();let g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}setColorTheme(s){this._checkLoaded();let u=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=s,!s)return this._styleColorTheme.lut=null,void u();let g=this._evaluateColorThemeData(s);this._loadColorTheme(g).then(()=>{u()}).catch(v=>{r.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(s){return{now:r.e.now(),transition:r.W(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;let s=[],u=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?s.push(g):u.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...u)}_createTerrain(s,u){let g=this.terrain=new Ln(s,u,this.scope,this.options);u===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let s in this._layers){let u=this._layers[s];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(let s in this._layers){let u=this._layers[s];u.type==="symbol"&&this._updateLayer(u)}}_validate(s,u,g,v,x={}){if(x&&x.validate===!1)return!1;let w=r.W({},this.serialize());return Bs(this,s.call(he,r.W({key:u,style:w,value:g,styleSpec:r.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){let u=this.getSourceCaches(s);for(let g of u)g.clearTiles()}clearSources(){for(let s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){let u=this.getSourceCaches(s);for(let g of u)g.resume(),g.reload()}reloadSources(){for(let s of this.getSources())s.reload&&s.reload()}updateSources(s){let u;this.directionalLight&&(u=Jc(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,u)}_generateCollisionBoxes(){for(let s in this._sourceCaches){let u=this._sourceCaches[s];u.resume(),u.reload()}}_updatePlacement(s,u,g,v,x,w,I=!1){let M=!1,A=!1,L={},F={};for(let U of this._mergedOrder){let $=this._mergedLayers[U];if($.type!=="symbol")continue;let G=r.al($.source,$.scope),q=L[G];if(!q){let J=this.getLayerSourceCache($);if(!J)continue;let ee=J.getRenderableIds(!0).map(te=>J.getTileByID(te));F[G]=ee.slice(),q=L[G]=ee.sort((te,ue)=>ue.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ue.tileID)?-1:1))}let H=this.crossTileSymbolIndex.addLayer($,q,u.center.lng,u.projection);M=M||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new r.f("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.e.now(),u.zoom))&&(this.pauseablePlacement=new rd(u,this._mergedOrder,I,g,v,x,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.e.now()),A=!0),M&&this.pauseablePlacement.placement.setStale()),A||M){this._buildingIndex.onNewFrame(u.zoom);for(let U=0;U<this._mergedOrder.length;U++){let $=this._mergedLayers[this._mergedOrder[U]];if($.type!=="symbol")continue;let G=this.isLayerClipped($)&&this._clipLayerIndices.some(q=>U<q);this.placement.updateLayerOpacities($,L[r.al($.source,$.scope)],U,G?w:null)}}let B=!1;for(let U of this._mergedOrder){let $=this._mergedLayers[U];if($.type!=="symbol")continue;let G=L[r.al($.source,$.scope)];for(let q of G){let H=q.getBucket($);H&&q.latestFeatureIndex&&$.fqid===H.layerIds[0]&&(B=H.updateOcclusionOpacities(s.context,s.symbolParams,s._dt)||B)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.e.now())||B,occlusionQueryBasedOpacityChanged:B}}_releaseSymbolFadeTiles(){for(let s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,u){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===s.id)!==-1)return void this.fire(new r.d(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!u)return g.push(s),this._loadImports([s],!0);let v=g.findIndex(({id:x})=>x===u);return v===-1&&this.fire(new r.d(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(s).concat(g.slice(v)),this._loadImports([s],!0,u)}updateImport(s,u){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);return v===-1?this:typeof u=="string"?(this.setImportUrl(s,u),this):(u.url&&u.url!==g[v].url&&this.setImportUrl(s,u.url),E(u.config,g[v].config)||this.setImportConfig(s,u.config),E(u.data,g[v].data)||this.setImportData(s,u.data),this)}moveImport(s,u){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;let x=this.getImportIndex(u);if(x===-1)return this;let w=g[v],I=this.fragments[v];return g=g.filter(({id:M})=>M!==s),this.fragments=this.fragments.filter(({id:M})=>M!==s),this.stylesheet.imports=g.slice(0,x).concat(w).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(I).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,u){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;g[v].url=u;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(u),this}setImportData(s,u){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];return g===-1?this:u?(this.fragments[g].style.setState(u),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(s,v[g].url))}setImportConfig(s,u){this._checkLoaded();let g=this.getImportIndex(s),v=this.stylesheet.imports||[];if(g===-1)return this;u?v[g].config=u:delete v[g].config;let x=this.fragments[g],w=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=u,x.style.updateConfig(u,w),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();let u=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(u.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){let u=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return u===-1&&this.fire(new r.d(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),u}getLayer(s){return this._mergedLayers[s]}getSources(){let s=[];for(let u in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[u];g&&s.push(g.getSource())}return s}getSource(s,u){let g=this.getSourceCache(s,u);return g&&g.getSource()}getLayerSource(s){let u=this.getLayerSourceCache(s);return u&&u.getSource()}getSourceCache(s,u){let g=r.al(s,u);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){let u=r.al(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);let u=[];return this._mergedOtherSourceCaches[s]&&u.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&u.push(this._mergedSymbolSourceCaches[s]),u}updateSourceCaches(){let s=this._changes.getUpdatedSourceCaches();for(let u in s){let g=s[u];g==="reload"?this.reloadSource(u):g==="clear"&&this.clearSource(u)}}updateLayers(s){let u=this._changes.getUpdatedPaintProperties();for(let g of u){let v=this.getLayer(g);v&&v.updateTransitions(s)}}getImages(s,u,g){this.imageManager.getImages(u.icons,u.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(s,u,g){this.glyphManager.getGlyphs(u.stacks,u.scope,g)}getResource(s,u,g){return r.c$(u,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){let u=[];return this._otherSourceCaches[s]&&u.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&u.push(this._symbolSourceCaches[s]),u}_isSourceCacheLoaded(s){let u=this.getOwnSourceCaches(s);return u.length===0?(this.fire(new r.d(new Error(`There is no source with ID '${s}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,u){if(this._clipLayerIndices.length===0&&s.type!=="fill-extrusion")return!1;let g=s.type==="fill-extrusion"&&s.sourceLayer==="building",v=0;if(s.is3D()){if(g||u&&u.type==="batched-model")return!0;s.type==="model"&&(v=r.cu.Model)}else s.type==="symbol"&&(v=r.cu.Symbol);for(let x of this._clipLayerIndices){let w=this._mergedLayers[this._mergedOrder[x]];if(!w)continue;let I=[];for(let M of w.layout.get("clip-layer-types"))I.push(M==="model"?r.cu.Model:M==="symbol"?r.cu.Symbol:r.cu.FillExtrusion);for(let M of I)if(v&M)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Bp(p,s){let u=!1,g=null,v=()=>{g=null,u&&(p(),g=setTimeout(v,s),u=!1)};return()=>(u=!0,g||v(),g)}go.getSourceType=function(p){return Gr[p]},go.setSourceType=function(p,s){Gr[p]=s},go.registerForPluginStateChange=r.cL;class b1{constructor(s){this._hashName=s&&encodeURIComponent(s),r.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Bp(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let s=this._map;if(!s)return"";let u=bu(s);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(w=>{let I=w.split("=")[0];return I===g?(v=!0,`${I}=${u}`):w}).filter(w=>w);return v||x.push(`${g}=${u}`),`#${x.join("&")}`}return`#${u}`}_getCurrentHash(){let s=location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return s.split("/")}_onHashChange(){let s=this._map;if(!s)return!1;let u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(g))){let g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(u[3]||0):s.getBearing();return s.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function bu(p,s){let u=p.getCenter(),g=Math.round(100*p.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),w=Math.round(u.lng*x)/x,I=Math.round(u.lat*x)/x,M=p.getBearing(),A=p.getPitch(),L=s?`/${w}/${I}/${g}`:`${g}/${I}/${w}`;return(M||A)&&(L+="/"+Math.round(10*M)/10),A&&(L+=`/${Math.round(A)}`),L}let id={linearity:.3,easing:r.d0(0,0,.3,1)},z_=r.W({deceleration:2500,maxSpeed:1400},id),Up=r.W({deceleration:20,maxSpeed:1400},id),od=r.W({deceleration:1e3,maxSpeed:360},id),Vp=r.W({deceleration:1e3,maxSpeed:90},id);class Pa{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.e.now(),settings:s})}_drainInertiaBuffer(){let s=this._inertiaBuffer,u=r.e.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let u={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){let x=wu(u.pan.mag(),g,r.W({},z_,s||{}));v.offset=u.pan.mult(x.amount/u.pan.mag()),v.center=this._map.transform.center,zl(v,x)}if(u.zoom){let x=wu(u.zoom,g,Up);v.zoom=this._map.transform.zoom+x.amount,zl(v,x)}if(u.bearing){let x=wu(u.bearing,g,od);v.bearing=this._map.transform.bearing+r.at(x.amount,-179,179),zl(v,x)}if(u.pitch){let x=wu(u.pitch,g,Vp);v.pitch=this._map.transform.pitch+x.amount,zl(v,x)}if(v.zoom||v.bearing){let x=u.pinchAround===void 0?u.around:u.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function zl(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function wu(p,s,u){let{maxSpeed:g,linearity:v,deceleration:x}=u,w=r.at(p*v/(s/1e3),-g,g),I=Math.abs(w)/(x*v);return{easing:u.easing,duration:1e3*I,amount:w*(I/2)}}class qr extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,g,v={}){let x=St(u.getCanvasContainer(),g),w=u.unproject(x);super(s,r.W({point:x,lngLat:w,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class Us extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,g){let v=s==="touchend"?g.changedTouches:g.touches,x=$t(u.getCanvasContainer(),v),w=x.map(M=>u.unproject(M)),I=x.reduce((M,A,L,F)=>M.add(A.div(F.length)),new r.P(0,0));super(s,{points:x,point:I,lngLats:w,lngLat:u.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class sd extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class jp{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new sd(s.type,this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new qr(s.type,this._map,s))}mouseup(s){this._map.fire(new qr(s.type,this._map,s))}preclick(s){let u=r.W({},s);u.type="preclick",this._map.fire(new qr(u.type,this._map,u))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(s),this._map.fire(new qr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new qr(s.type,this._map,s))}mouseover(s){this._map.fire(new qr(s.type,this._map,s))}mouseout(s){this._map.fire(new qr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Us(s.type,this._map,s))}touchmove(s){this._map.fire(new Us(s.type,this._map,s))}touchend(s){this._map.fire(new Us(s.type,this._map,s))}touchcancel(s){this._map.fire(new Us(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eu{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new qr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new qr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ad{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(ot(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;let g=u,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=Z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));let w=Math.min(v.x,g.x),I=Math.max(v.x,g.x),M=Math.min(v.y,g.y),A=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${M}px)`,this._box.style.width=I-w+"px",this._box.style.height=A-M+"px")})}mouseupWindow(s,u){if(!this._active)return;let g=this._startPos,v=u;if(g&&s.button===0){if(this.reset(),bt(),g.x!==v.x||g.y!==v.y)return this._map.fire(new r.f("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),dt(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new r.f(s,{originalEvent:u}))}}function Tu(p,s){let u={};for(let g=0;g<p.length;g++)u[p[g].identifier]=s[g];return u}class B_{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new r.P(0,0);for(let w of v)x._add(w);return x.div(v.length)}(u),this.touches=Tu(g,u)))}touchmove(s,u,g){if(this.aborted||!this.centroid)return;let v=Tu(g,u);for(let x in this.touches){let w=v[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,u,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Iu{constructor(s){this.singleTap=new B_(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,u,g){this.singleTap.touchstart(s,u,g)}touchmove(s,u,g){this.singleTap.touchmove(s,u,g)}touchend(s,u,g){let v=this.singleTap.touchend(s,u,g);if(v){let x=s.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(v)<30;if(x&&w||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class ld{constructor(){this._zoomIn=new Iu({numTouches:1,numTaps:2}),this._zoomOut=new Iu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,g){this._zoomIn.touchstart(s,u,g),this._zoomOut.touchstart(s,u,g)}touchmove(s,u,g){this._zoomIn.touchmove(s,u,g),this._zoomOut.touchmove(s,u,g)}touchend(s,u,g){let v=this._zoomIn.touchend(s,u,g),x=this._zoomOut.touchend(s,u,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(v)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Du={0:1,2:2};class cd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,u){return!1}_move(s,u){return{}}mousedown(s,u){if(this._lastPoint)return;let g=dr(s);this._correctButton(s,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(s,u){let g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(v,x){let w=Du[x];return v.buttons===void 0||(v.buttons&w)!==w}(s,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}}mouseupWindow(s){this._lastPoint&&dr(s)===this._eventButton&&(this._moved&&bt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class U_ extends cd{mousedown(s,u){super.mousedown(s,u),this._lastPoint&&(this._active=!0)}_correctButton(s,u){return u===0&&!s.ctrlKey}_move(s,u){return{around:u,panDelta:u.sub(s)}}}class $p extends cd{_correctButton(s,u){return u===0&&s.ctrlKey||u===2}_move(s,u){let g=.8*(u.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Ra extends cd{_correctButton(s,u){return u===0&&s.ctrlKey||u===2}_move(s,u){let g=-.5*(u.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class V_{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),r.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(s,u,g){return this._calculateTransform(s,u,g)}touchmove(s,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!r.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,u,g)}}touchend(s,u,g){this._calculateTransform(s,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,g){g.length>0&&(this._active=!0);let v=Tu(g,u),x=new r.P(0,0),w=new r.P(0,0),I=0;for(let A in v){let L=v[A],F=this._touches[A];F&&(x._add(L),w._add(L.sub(F)),I++,v[A]=L)}if(this._touches=v,I<this._minTouches||!w.mag())return;let M=w.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Gp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,u,g){return{}}touchstart(s,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,g){let v=this._firstTwoTouches;if(!v)return;s.preventDefault();let[x,w]=v,I=ud(g,u,x),M=ud(g,u,w);if(!I||!M)return;let A=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],A,s)}touchend(s,u,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,w=ud(g,u,v),I=ud(g,u,x);w&&I||(this._active&&bt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ud(p,s,u){for(let g=0;g<p.length;g++)if(p[g].identifier===u)return s[g]}function j_(p,s){return Math.log(p/s)/Math.LN2}class qp extends Gp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){let g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(j_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:j_(this._distance,g),pinchAround:u}}}function hd(p,s){return 180*p.angleWith(s)/Math.PI}class Hp extends Gp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u){let g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:hd(this._vector,g),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());let u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=hd(s,g);return Math.abs(v)<u}}function Su(p){return Math.abs(p.y)>Math.abs(p.x)}class $_ extends Gp{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Su(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,g){let v=this._lastPoints;if(!v)return;let x=s[0].sub(v[0]),w=s[1].sub(v[1]);return this._map._cooperativeGestures&&!r.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,w,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+w.y)/2*-.5})}gestureBeginsVertically(s,u,g){if(this._valid!==void 0)return this._valid;let v=s.mag()>=2,x=u.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let w=s.y>0==u.y>0;return Su(s)&&Su(u)&&w}}let G_={panStep:100,bearingStep:15,pitchStep:10};class w1{constructor(){let s=G_;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,g=0,v=0,x=0,w=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),w=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:I=>{let M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Cu,zoom:u?Math.round(M)+u*(s.shiftKey?2:1):M,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:I.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cu(p){return p*(2-p)}let Bl=4.000244140625,q_=1/450;class Bi{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=q_,r.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||r.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,g=r.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,u!==0&&u%Bl==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=St(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let u=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>Bl?this._wheelZoomRate:this._defaultZoomRate,L=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&L!==0&&(L=1/L);let F=u(),B=Math.pow(2,F),U=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(U*L))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:u(),v=this._startZoom,x=this._easing,w,I=!1;if(this._type==="wheel"&&v&&x){let A=Math.min((r.e.now()-this._lastWheelEventTime)/200,1),L=x(A);w=r.a2(v,g,L),A<1?this._frameId||(this._frameId=!0):I=!0}else w=g,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=w-u();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=r.d2;if(this._prevEase){let g=this._prevEase,v=(r.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),w=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-w*w);u=r.d0(w,I,.25,1)}return this._prevEase={start:r.e.now(),duration:s,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Wp{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,u){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fd{constructor(){this._tap=new Iu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,u,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,u,g))}touchmove(s,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=u[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,u,g)}touchend(s,u,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,u,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zp{constructor(s,u,g){this._el=s,this._mousePan=u,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yp{constructor(s,u,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pd{constructor(s,u,g,v){this._el=s,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Ul=p=>p.zoom||p.drag||p.pitch||p.rotate;class Xp extends r.f{}class md{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,u){let g=r._.sub([],u,s);this.radius=r._.length(g[2]<0?r._.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){r._.div(s,s,this.constants),r._.normalize(s,s),r._.mul(s,s,this.constants);let u=r._.scale([],s,this.radius);if(u[2]>0){let g=r._.scale([],[0,0,1],r._.dot(u,[0,0,1])),v=r._.scale([],r._.normalize([],[u[0],u[1],0]),this.radius),x=r._.add([],u,r._.scale([],r._.sub([],r._.add([],v,g),u),2));u[0]=x[0],u[1]=x[1]}return u}}function Mu(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class H_{constructor(s,u){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pa(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new md,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),r.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,w]of this._listeners){let I=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,I,w)}}destroy(){for(let[s,u,g]of this._listeners){let v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(u,v,g)}}_addDefaultHandlers(s){let u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new jp(u,s));let v=u.boxZoom=new ad(u,s);this._add("boxZoom",v);let x=new ld,w=new dd;u.doubleClickZoom=new Wp(w,x),this._add("tapZoom",x),this._add("clickZoom",w);let I=new fd;this._add("tapDragZoom",I);let M=u.touchPitch=new $_(u);this._add("touchPitch",M);let A=new $p(s),L=new Ra(s);u.dragRotate=new Yp(s,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);let F=new U_(s),B=new V_(u,s);u.dragPan=new Zp(g,F,B),this._add("mousePan",F),this._add("touchPan",B,["touchZoom","touchRotate"]);let U=new Hp,$=new qp;u.touchZoomRotate=new pd(g,$,U,I),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Eu(u));let G=u.scrollZoom=new Bi(u,this);this._add("scrollZoom",G,["mousePan"]);let q=u.keyboard=new w1;this._add("keyboard",q);for(let H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[H]&&u[H].enable(s[H])}_add(s,u,g){this._handlers.push({handlerName:s,handler:u,allowed:g}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ul(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,u,g){for(let v in s)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){let u=[];for(let g of s)this._el.contains(g.target)&&u.push(g);return u}handleEvent(s,u){this._updatingCamera=!0;let g=s.type==="renderFrame",v=g?void 0:s,x={needsRenderFrame:!1},w={},I={},M=s.touches?this._getMapTouches(s.touches):void 0,A=M?$t(this._el,M):g?void 0:St(this._el,s);for(let{handlerName:B,handler:U,allowed:$}of this._handlers){if(!U.isEnabled())continue;let G;this._blockedByActive(I,$,B)?U.reset():U[u||s.type]&&(G=U[u||s.type](s,A,M),this.mergeHandlerResult(x,w,G,B,v),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||U.isActive())&&(I[B]=U)}let L={};for(let B in this._previousActiveHandlers)I[B]||(L[B]=v);this._previousActiveHandlers=I,(Object.keys(L).length||Mu(x))&&(this._changes.push([x,w,L]),this._triggerRenderFrame()),(Object.keys(I).length||Mu(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=x;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(s,u,g,v,x){if(!g)return;r.W(s,g);let w={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(u.zoom=w),g.panDelta!==void 0&&(u.drag=w),g.pitchDelta!==void 0&&(u.pitch=w),g.bearingDelta!==void 0&&(u.rotate=w)}_applyChanges(){let s={},u={},g={};for(let[v,x,w]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),r.W(u,x),r.W(g,w);this._updateMapTransform(s,u,g),this._changes=[]}_updateMapTransform(s,u,g){let v=this._map,x=v.transform,w=J=>[J.x,J.y,J.z];if((J=>{let ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!Mu(s)){let J=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),J!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!Mu(s))return void this._fireEvents(u,g,!0);let{panDelta:I,zoomDelta:M,bearingDelta:A,pitchDelta:L,around:F,aroundCoord:B,pinchAround:U}=s;x._isCameraConstrained&&(M>0&&(M=0),x._isCameraConstrained=!1),U!==void 0&&(F=U),(M||(J=>u[J]&&!this._eventsInProgress[J])("drag"))&&F&&(this._dragOrigin=w(x.pointCoordinate3D(F)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),F=F||v.transform.centerPoint,A&&(x.bearing+=A),L&&(x.pitch+=L),x._updateCameraState();let $=[0,0,0];if(I)if(x.projection.name==="mercator"){let J=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F).dir),ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F.sub(I)).dir);$[0]=ee[0]-J[0],$[1]=ee[1]-J[1]}else{let J=x.pointCoordinate(F);if(x.projection.name==="globe"){I=I.rotate(-x.angle);let ee=x._pixelsPerMercatorPixel/x.worldSize;$[0]=-I.x*r.d3(r.ay(J.y))*ee,$[1]=-I.y*r.d3(x.center.lat)*ee}else{let ee=x.pointCoordinate(F.sub(I));J&&ee&&($[0]=ee.x-J.x,$[1]=ee.y-J.y)}}let G=x.zoom,q=[0,0,0];if(M){let J=w(B||x.pointCoordinate3D(F)),ee={dir:r._.normalize([],r._.sub([],J,x._camera.position))};if(ee.dir[2]<0){let te=x.zoomDeltaToMovement(J,M);r._.scale(q,ee.dir,te)}}let H=r._.add($,$,q);x._translateCameraConstrained(H),M&&Math.abs(x.zoom-G)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,g,!0)}_fireEvents(s,u,g){let v=Ul(this._eventsInProgress),x=Ul(s),w={};for(let L in s){let{originalEvent:F}=s[L];this._eventsInProgress[L]||(w[`${L}start`]=F),this._eventsInProgress[L]=s[L]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let L in w)this._fireEvent(L,w[L]);x&&this._fireEvent("move",x.originalEvent);for(let L in s){let{originalEvent:F}=s[L];this._fireEvent(L,F)}let I={},M;for(let L in this._eventsInProgress){let{handlerName:F,originalEvent:B}=this._eventsInProgress[L];this._handlersById[F].isActive()||(delete this._eventsInProgress[L],M=u[F]||B,I[`${L}end`]=M)}for(let L in I)this._fireEvent(L,I[L]);let A=Ul(this._eventsInProgress);if(g&&(v||x)&&!A){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(F(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:M})):(this._map.fire(new r.f("moveend",{originalEvent:M})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new r.f(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Xp("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Oa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class E1 extends r.E{constructor(s,u){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,r.bp(["_renderFrameCallback"],this)}getCenter(){return new r.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}panBy(s,u,g){return s=r.P.convert(s).mult(-1),this.panTo(this.transform.center,r.W({offset:s},u),g)}panTo(s,u,g){return this.easeTo(r.W({center:s},u),g)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,g){return this.easeTo(r.W({zoom:s},u),g)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,g){return this.easeTo(r.W({bearing:s},u),g)}resetNorth(s,u){return this.rotateTo(0,r.W({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(r.W({bearing:0,pitch:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}cameraForBounds(s,u){s=r.ai.convert(s);let g=u&&u.bearing||0,v=u&&u.pitch||0,x=s.getNorthWest(),w=s.getSouthEast();return this._cameraForBounds(this.transform,x,w,g,v,u)}_extendPadding(s){let u={top:0,right:0,bottom:0,left:0};return s==null?r.W({},u,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:r.W({},u,s)}_extendCameraOptions(s){return(s=r.W({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,u){let g=u.max[0]-u.min[0],v=u.max[1]-u.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,u,g,v,x,w){let I=s.clone(),M=this._extendCameraOptions(w);I.bearing=v,I.pitch=x;let A=r.aI.convert(u),L=r.aI.convert(g),F=.5*(A.lat+L.lat),B=.5*(A.lng+L.lng),U=r.d4(F,B),$=r._.normalize([],U),G=r._.normalize([],r._.cross([],$,[0,1,0])),q=r._.cross([],G,$),H=[G[0],G[1],G[2],0,q[0],q[1],q[2],0,$[0],$[1],$[2],0,0,0,0,1],J=[U,r.d4(A.lat,A.lng),r.d4(L.lat,A.lng),r.d4(L.lat,L.lng),r.d4(A.lat,L.lng),r.d4(F,A.lng),r.d4(F,L.lng),r.d4(A.lat,B),r.d4(L.lat,B)],ee=r.b6.fromPoints(J.map(Le=>[r._.dot(G,Le),r._.dot(q,Le),r._.dot($,Le)])),te=r._.transformMat4([],ee.center,H);r._.squaredLength(te)===0&&r._.set(te,0,0,1),r._.normalize(te,te),r._.scale(te,te,r.cD),I.center=r.d5(te);let ue=I.getWorldToCameraMatrix(),le=r.ad.invert(new Float64Array(16),ue);ee=r.b6.applyTransform(ee,r.ad.multiply([],ue,H));let Q=this._extendAABB(ee,I,M,v);if(!Q)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=Q,r._.transformMat4(te,te,ue);let ne=.5*(ee.max[2]-ee.min[2]),re=this._minimumAABBFrustumDistance(I,ee),pe=r._.scale([],[0,0,1],ne),Ee=r._.add(pe,te,pe),se=re+(I.pitch===0?0:r._.distance(te,Ee)),Te=I.globeCenterInViewSpace,Se=r._.sub([],te,[Te[0],Te[1],Te[2]]);r._.normalize(Se,Se),r._.scale(Se,Se,se);let Be=r._.add([],te,Se);r._.transformMat4(Be,Be,le);let Ue=r.d7/r.cD,Ne=r._.length(Be),ye=r.ax(Math.max(Ne*Ue-r.d7,Number.EPSILON),0),Ae=Math.min(I.zoomFromMercatorZAdjusted(ye),M.maxZoom);return Ae>.5*(r.b1+r.aU)?(I.setProjection({name:"mercator"}),I.zoom=Ae,this._cameraForBounds(I,u,g,v,x,w)):{center:I.center,zoom:Ae,bearing:v,pitch:x}}_extendAABB(s,u,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),w=.5*((g.padding.top||0)+(g.padding.bottom||0)),I=w,M=x,A=x,L=w,F=u.width-(M+A),B=u.height-(I+L),U=r._.sub([],s.max,s.min),$=Math.min(F/U[0],B/U[1]),G=Math.min(u.scaleZoom(u.scale*$),g.maxZoom);if(isNaN(G))return null;let q=u.scale/u.zoomScale(G),H=new r.b6([s.min[0]-M*q,s.min[1]-L*q,s.min[2]],[s.max[0]+A*q,s.max[1]+I*q,s.max[2]]),J=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new r.P(g.offset.x,g.offset.y):r.P.convert(g.offset)).rotate(-r.ab(v));return H.center[0]-=J.x*q,H.center[1]+=J.y*q,H}queryTerrainElevation(s,u){let g=this.transform.elevation;return g?(u=r.W({},{exaggerated:!0},u),g.getAtPoint(r.Y.fromLngLat(s),null,u.exaggerated)):null}_cameraForBounds(s,u,g,v,x,w){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,u,g,v,x,w);let I=s.clone(),M=this._extendCameraOptions(w);I.bearing=v,I.pitch=x;let A=r.aI.convert(u),L=r.aI.convert(g),F=new r.aI(A.lng,L.lat),B=new r.aI(L.lng,A.lat),U=I.project(A),$=I.project(L),G=this.queryTerrainElevation(A),q=this.queryTerrainElevation(L),H=this.queryTerrainElevation(F),J=this.queryTerrainElevation(B),ee=[[U.x,U.y,Math.min(G||0,q||0,H||0,J||0)],[$.x,$.y,Math.max(G||0,q||0,H||0,J||0)]],te=r.b6.fromPoints(ee),ue=I.getWorldToCameraMatrix(),le=r.ad.invert(new Float64Array(16),ue);te=r.b6.applyTransform(te,ue);let Q=this._extendAABB(te,I,M,v);if(!Q)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=Q;let ne=.5*r._.sub([],te.max,te.min)[2],re=this._minimumAABBFrustumDistance(I,te),pe=[0,0,1,0];r.aA.transformMat4(pe,pe,ue),r.aA.normalize(pe,pe);let Ee=r._.scale([],pe,re+ne),se=r._.add([],te.center,Ee);r._.transformMat4(te.center,te.center,le),r._.transformMat4(se,se,le);let Te=[te.center[0],te.center[1],se[2]*I.pixelsPerMeter];r._.scale(Te,Te,1/I.worldSize);let Se=r.d6(Te[0]),Be=r.ay(Te[1]),Ue=Math.min(I._zoomFromMercatorZ(Te[2]),M.maxZoom),Ne=new r.aI(Se,Be);return I.mercatorFromTransition&&Ue<.5*(r.b1+r.aU)?(I.setProjection({name:"globe"}),I.zoom=Ue,this._cameraForBounds(I,u,g,v,x,w)):{center:Ne,zoom:Ue,bearing:v,pitch:x}}fitBounds(s,u,g){let v=this.cameraForBounds(s,u);return this._fitInternal(v,u,g)}fitScreenCoordinates(s,u,g,v,x){let w=r.P.convert(s),I=r.P.convert(u),M=new r.P(Math.min(w.x,I.x),Math.min(w.y,I.y)),A=new r.P(Math.max(w.x,I.x),Math.max(w.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,I))return this;let L=this.transform.pointLocation3D(M),F=this.transform.pointLocation3D(A),B=this.transform.pointLocation3D(new r.P(M.x,A.y)),U=this.transform.pointLocation3D(new r.P(A.x,M.y)),$=[Math.min(L.lng,F.lng,B.lng,U.lng),Math.min(L.lat,F.lat,B.lat,U.lat)],G=[Math.max(L.lng,F.lng,B.lng,U.lng),Math.max(L.lat,F.lat,B.lat,U.lat)],q=v&&v.pitch?v.pitch:this.getPitch(),H=this._cameraForBounds(this.transform,$,G,g,q,v);return this._fitInternal(H,v,x)}_fitInternal(s,u,g){return s?(u=r.W(s,u)).linear?this.easeTo(u,g):this.flyTo(u,g):this}jumpTo(s,u){this.stop();let g=s.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,w=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=r.aI.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(x=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(w=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new r.f("movestart",u)).fire(new r.f("move",u)),v&&this.fire(new r.f("zoomstart",u)).fire(new r.f("zoom",u)).fire(new r.f("zoomend",u)),x&&this.fire(new r.f("rotatestart",u)).fire(new r.f("rotate",u)).fire(new r.f("rotateend",u)),w&&this.fire(new r.f("pitchstart",u)).fire(new r.f("pitch",u)).fire(new r.f("pitchend",u)),this.fire(new r.f("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Oa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,u){let g=this.transform;if(!g.projection.supportsFreeCamera)return r.w(Oa),this;this.stop();let v=g.zoom,x=g.pitch,w=g.bearing;g.setFreeCameraOptions(s);let I=v!==g.zoom,M=x!==g.pitch,A=w!==g.bearing;return this.fire(new r.f("movestart",u)).fire(new r.f("move",u)),I&&this.fire(new r.f("zoomstart",u)).fire(new r.f("zoom",u)).fire(new r.f("zoomend",u)),A&&this.fire(new r.f("rotatestart",u)).fire(new r.f("rotate",u)).fire(new r.f("rotateend",u)),M&&this.fire(new r.f("pitchstart",u)).fire(new r.f("pitch",u)).fire(new r.f("pitchend",u)),this.fire(new r.f("moveend",u)),this}easeTo(s,u){this._stop(!1,s.easeId),((s=r.W({offset:[0,0],duration:500,easing:r.d2},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),w=this.getPitch(),I=this.getPadding(),M="zoom"in s?+s.zoom:v,A="bearing"in s?this._normalizeBearing(s.bearing,x):x,L="pitch"in s?+s.pitch:w,F=this._extendPadding(s.padding),B=r.P.convert(s.offset),U,$,G;if(g.projection.name==="globe"){let re=r.Y.fromLngLat(g.center),pe=B.rotate(-g.angle);re.x+=pe.x/g.worldSize,re.y+=pe.y/g.worldSize;let Ee=re.toLngLat(),se=r.aI.convert(s.center||Ee);this._normalizeCenter(se),U=g.centerPoint.add(pe),$=new r.P(re.x,re.y).mult(g.worldSize),G=new r.P(r.aj(se.lng),r.ak(se.lat)).mult(g.worldSize).sub($)}else{U=g.centerPoint.add(B);let re=g.pointLocation(U),pe=r.aI.convert(s.center||re);this._normalizeCenter(pe),$=g.project(re),G=g.project(pe).sub($)}let q=g.zoomScale(M-v),H,J;s.around&&(H=r.aI.convert(s.around),J=g.locationPoint(H));let ee=this._zooming||M!==v,te=this._rotating||x!==A,ue=this._pitching||L!==w,le=!g.isPaddingEqual(F),Q=re=>pe=>{if(ee&&(re.zoom=r.a2(v,M,pe)),te&&(re.bearing=r.a2(x,A,pe)),ue&&(re.pitch=r.a2(w,L,pe)),le&&(re.interpolatePadding(I,F,pe),U=re.centerPoint.add(B)),H)re.setLocationAtPoint(H,J);else{let Ee=re.zoomScale(re.zoom-v),se=M>v?Math.min(2,q):Math.max(.5,q),Te=Math.pow(se,1-pe),Se=re.unproject($.add(G.mult(pe*Te)).mult(Ee));re.setLocationAtPoint(re.renderWorldCopies?Se.wrap():Se,U)}return s.preloadOnly||this._fireMoveEvents(u),re};if(s.preloadOnly){let re=this._emulate(Q,s.duration,g);return this._preloadTiles(re),this}let ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ee,this._rotating=te,this._pitching=ue,this._padding=le,this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,ne),this._ease(Q(g),re=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(u,re)},s),this}_prepareEase(s,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||g.moving||this.fire(new r.f("movestart",s)),this._zooming&&!g.zooming&&this.fire(new r.f("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new r.f("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new r.f("pitchstart",s))}_fireMoveEvents(s){this.fire(new r.f("move",s)),this._zooming&&this.fire(new r.f("zoom",s)),this._rotating&&this.fire(new r.f("rotate",s)),this._pitching&&this.fire(new r.f("pitch",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new r.f("zoomend",s)),v&&this.fire(new r.f("rotateend",s)),x&&this.fire(new r.f("pitchend",s)),this.fire(new r.f("moveend",s))}flyTo(s,u){if(this._prefersReducedMotion(s)){let Ae=r.ah(s,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ae,u)}this.stop(),s=r.W({offset:[0,0],speed:1.2,curve:1.42,easing:r.d2},s);let g=this.transform,v=this.getZoom(),x=this.getBearing(),w=this.getPitch(),I=this.getPadding(),M="zoom"in s?r.at(+s.zoom,g.minZoom,g.maxZoom):v,A="bearing"in s?this._normalizeBearing(s.bearing,x):x,L="pitch"in s?+s.pitch:w,F=this._extendPadding(s.padding),B=g.zoomScale(M-v),U=r.P.convert(s.offset),$=g.centerPoint.add(U),G=g.pointLocation($),q=r.aI.convert(s.center||G);this._normalizeCenter(q);let H=g.project(G),J=g.project(q).sub(H),ee=s.curve,te=Math.max(g.width,g.height),ue=te/B,le=J.mag();if("minZoom"in s){let Ae=r.at(Math.min(s.minZoom,v,M),g.minZoom,g.maxZoom),Le=te/g.zoomScale(Ae-v);ee=Math.sqrt(Le/le*2)}let Q=ee*ee;function ne(Ae){let Le=(ue*ue-te*te+(Ae?-1:1)*Q*Q*le*le)/(2*(Ae?ue:te)*Q*le);return Math.log(Math.sqrt(Le*Le+1)-Le)}function re(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function pe(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}let Ee=ne(0),se=function(Ae){return pe(Ee)/pe(Ee+ee*Ae)},Te=function(Ae){return te*((pe(Ee)*(re(Le=Ee+ee*Ae)/pe(Le))-re(Ee))/Q)/le;var Le},Se=(ne(1)-Ee)/ee;if(Math.abs(le)<1e-6||!isFinite(Se)){if(Math.abs(te-ue)<1e-6)return this.easeTo(s,u);let Ae=ue<te?-1:1;Se=Math.abs(Math.log(ue/te))/ee,Te=function(){return 0},se=function(Le){return Math.exp(Ae*ee*Le)}}s.duration="duration"in s?+s.duration:1e3*Se/("screenSpeed"in s?+s.screenSpeed/ee:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);let Be=x!==A,Ue=L!==w,Ne=!g.isPaddingEqual(F),ye=Ae=>Le=>{let et=Le*Se,it=1/se(et);Ae.zoom=Le===1?M:v+Ae.scaleZoom(it),Be&&(Ae.bearing=r.a2(x,A,Le)),Ue&&(Ae.pitch=r.a2(w,L,Le)),Ne&&(Ae.interpolatePadding(I,F,Le),$=Ae.centerPoint.add(U));let nt=Le===1?q:Ae.unproject(H.add(J.mult(Te(et))).mult(it));return Ae.setLocationAtPoint(Ae.renderWorldCopies?nt.wrap():nt,$),Ae._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(u),Ae};if(s.preloadOnly){let Ae=this._emulate(ye,s.duration,g);return this._preloadTiles(Ae),this}return this._zooming=!0,this._rotating=Be,this._pitching=Ue,this._padding=Ne,this._prepareEase(u,!1),this._ease(ye(g),()=>this._afterEase(u),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!s){let g=this.handlers;g&&g.stop(!1)}return this}_ease(s,u,g){g.animate===!1||g.duration===0?(s(1),u()):(this._easeStart=r.e.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let s=Math.min((r.e.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,u){s=r.au(s,-180,180);let g=Math.abs(s-u);return Math.abs(s-360-u)<g&&(s-=360),Math.abs(s+360-u)<g&&(s+=360),s}_normalizeCenter(s){let u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;let g=s.lng-u.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&r.e.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,u,g){let v=Math.ceil(15*u/1e3),x=[],w=s(g.clone());for(let I=0;I<=v;I++){let M=w(I/v);x.push(M.clone())}return x}_preloadTiles(s,u){}}class W_{constructor(s={}){this.options=s,r.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){let u=this.options&&this.options.compact;return this._map=s,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z("button","mapboxgl-ctrl-attrib-button",this._container),Z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,u){let g=this._map._getUIString(`AttributionControl.${u}`);s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));let u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d8.ACCESS_TOKEN}];if(s){let g=u.reduce((v,x,w)=>(x.value&&(v+=`${x.key}=${x.value}${w<u.length-1?"&":""}`),v),"?");s.href=`${r.d8.FEEDBACK_URL}/${g}#${bu(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let u=this._map.style._mergedSourceCaches;for(let v in u){let x=u[v];if(x.used){let w=x.getSource();w.attribution&&s.indexOf(w.attribution)<0&&s.push(w.attribution)}}s.sort((v,x)=>v.length-x.length),s=s.filter((v,x)=>{for(let w=x+1;w<s.length;w++)if(s[w].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));let g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Z_{constructor(){r.bp(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=Z("div","mapboxgl-ctrl");let u=Z("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(let u in s){let g=s[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let s=this._container.children;if(s.length){let u=s[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Y_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){let u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){let u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(let v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){let u=this._currentlyRunning=this._queue;this._queue=[];for(let g of u)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function X_(p,s,u){if(p=new r.aI(p.lng,p.lat),s){let g=new r.aI(p.lng-360,p.lat),v=new r.aI(p.lng+360,p.lat),x=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),w=u.locationPoint(p).distSqr(s),I=s.x<0||s.y<0||s.x>u.width||s.y>u.height;u.locationPoint(g).distSqr(s)<w&&(I||Math.abs(g.lng-u.center.lng)<x)?p=g:u.locationPoint(v).distSqr(s)<w&&(I||Math.abs(v.lng-u.center.lng)<x)&&(p=v)}for(;Math.abs(p.lng-u.center.lng)>180;){let g=u.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}let Kp={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Au extends r.E{constructor(s,u){if(super(),(s instanceof HTMLElement||u)&&(s=r.W({element:s},u)),r.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=r.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z("div");let x=41,w=27,I=ce("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),M=ce("radialGradient",{id:"shadowGradient"},ce("defs",{},I));ce("stop",{offset:"10%","stop-opacity":.4},M),ce("stop",{offset:"100%","stop-opacity":.05},M),ce("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),ce("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),ce("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),ce("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=r.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in Kp)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=s&&s.className?s.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){let s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=r.aI.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){let u=s.code,g=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){let u=s.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let s=this._map,u=this._pos;if(!s||!u)return!1;let g=s.unproject(u),v=s.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let s=this._map;if(!s)return;let u=this._pos;if(!u||u.x<0||u.x>s.transform.width||u.y<0||u.y>s.transform.height)return void this._clearFadeTimer();let g=s.unproject(u),v;s._showingGlobe()&&r.d9(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let s=this._pos;if(!s||!this._map)return;let u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Kp[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){let s=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!s||g!=="map")return"";if(!u._showingGlobe()){let M=u.getPitch();return M?`rotateX(${M}deg)`:""}let v=r.b0(r.da(u.transform,this._lngLat)),x=s.sub(r.db(u.transform)),w=Math.abs(x.x)+Math.abs(x.y);if(w===0)return"";let I=v/w;return`rotateX(${-x.y*I}deg) rotateY(${x.x*I}deg)`}_calculateZTransform(){let s=this._pos,u=this._map;if(!u||!s)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(u._showingGlobe()){let x=u.project(new r.aI(this._lngLat.lng,this._lngLat.lat+.001)),w=u.project(new r.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=r.b0(Math.atan2(w.y,w.x))-90}else g=-u.getBearing();else if(v==="horizon"){let x=r.$(4,6,u.getZoom()),w=r.db(u.transform);w.y+=x*u.transform.height;let I=s.sub(w),M=r.b0(Math.atan2(I.y,I.x));g=(M>90?M-270:M+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);let u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=X_(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=r.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){let u=this._map;if(!u)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||u._clickTolerance;if(s.point.dist(g)<x)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.f("dragstart"))),this.fire(new r.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.f("dragend")),this._state="inactive"}_addDragHandler(s){let u=this._map,g=this._pos;u&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;let u=this._map;return u&&(s?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Qp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},K_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function La(p=new r.P(0,0),s="bottom"){if(typeof p=="number"){let u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new r.P(0,p);case"top-left":return new r.P(u,u);case"top-right":return new r.P(-u,u);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(u,-u);case"bottom-right":return new r.P(-u,-u);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[s]||[0,0])}class Q_{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;let u=r.b9((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,u,g){this._start=this.getValue(u),this._end=s,this._startTime=u,this._endTime=u+g}}let J_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ey{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let Jp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},ka={showCompass:!0,showZoom:!0,visualizePitch:!1};class ty{constructor(s,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new $p({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Ra({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),r.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(s,u){this.mouseRotate.mousedown(s,u),this.mousePitch&&this.mousePitch.mousedown(s,u),ot()}move(s,u){let g=this.map,v=this.mouseRotate.mousemoveWindow(s,u),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let w=this.mousePitch.mousemoveWindow(s,u),I=w&&w.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){let s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){dt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(r.W({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),St(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,St(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$t(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=$t(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Fa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ny={maxWidth:100,unit:"metric"},gd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dt,supported:C,setRTLTextPlugin:r.dv,getRTLTextPluginStatus:r.dw,Map:class extends E1{constructor(p){r.dc.mark(r.dd.create);let s=p;if((p=r.W({},Jp,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.de(window)&&(p.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Oo(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Y_,this._domRenderTaskQueue=new Y_,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.df(),this._locale=r.W({},J_,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Q_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new r.dg(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?xt({},p.contextCreateOptions):{},typeof p.container=="string"){let u=document.getElementById(p.container);if(!u)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=u}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),r.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new ey),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new H_(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.d8.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new b1(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});let u=p.bounds;u&&(this.resize(),this.fitBounds(u,r.W({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new W_({customAttribution:p.customAttribution})),this._logoControl=new Z_,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new r.f(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new r.f(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=p.onAdd(this);this._controls.push(p);let g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let s=!this._moving;return s&&this.fire(new r.f("movestart",p)).fire(new r.f("move",p)),this.fire(new r.f("resize",p)),s&&this.fire(new r.f("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.ai.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(s=>s==="auto"?navigator.language:s):p}setLanguage(p){let s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(let u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let p=this.transform,s=p.projection.name,u;s==="globe"&&p.zoom>=r.aU?(p.setMercatorFromTransition(),u=!0):s==="mercator"&&p.zoom<r.aU&&(p.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;return s=p.name==="globe"&&this.transform.zoom>=r.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(r.aI.convert(p))}unproject(p){return this.transform.pointLocation3D(r.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,u){if(p==="mouseenter"||p==="mouseover"){let g=!1,v=w=>{let I=s.filter(A=>this.getLayer(A)),M=I.length?this.queryRenderedFeatures(w.point,{layers:I}):[];M.length?g||(g=!0,u.call(this,new qr(p,this,w.originalEvent,{features:M}))):g=!1},x=()=>{g=!1};return{layers:new Set(s),listener:u,delegates:{mousemove:v,mouseout:x}}}if(p==="mouseleave"||p==="mouseout"){let g=!1,v=w=>{let I=s.filter(M=>this.getLayer(M));(I.length?this.queryRenderedFeatures(w.point,{layers:I}):[]).length?g=!0:g&&(g=!1,u.call(this,new qr(p,this,w.originalEvent)))},x=w=>{g&&(g=!1,u.call(this,new qr(p,this,w.originalEvent)))};return{layers:new Set(s),listener:u,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=s.filter(I=>this.getLayer(I)),w=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];w.length&&(v.features=w,u.call(this,v),delete v.features)};return{layers:new Set(s),listener:u,delegates:{[p]:g}}}}on(p,s,u){if(typeof s=="function"||u===void 0)return super.on(p,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(p,s,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(p,s,u){if(typeof s=="function"||u===void 0)return super.once(p,s);if(Array.isArray(s)||(s=[s]),s){for(let v of s)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(p,s,u);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(p,s,u){if(typeof s=="function"||u===void 0)return super.off(p,s);let g=new Set(Array.isArray(s)?s:[s]);for(let w of g)if(!this._isValidId(w))return this;let v=(w,I)=>{if(w.size!==I.size)return!1;for(let M of w)if(!I.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(w=>{for(let I=0;I<w.length;I++){let M=w[I];if(M.listener===u&&v(M.layers,g)){for(let A in M.delegates)this.off(A,M.delegates[A]);return w.splice(I,1),this}}})(x),this}queryRenderedFeatures(p,s){if(!this.style)return[];if(s!==void 0||p===void 0||p instanceof r.P||Array.isArray(p)||(s=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(s=s||{}).layers&&Array.isArray(s.layers)){for(let u of s.layers)if(!this._isValidId(u))return[]}return this.style.queryRenderedFeatures(p,s,this.transform)}querySourceFeatures(p,s){return this._isValidId(p)?this.style.querySourceFeatures(p,s):[]}isPointOnSurface(p){let{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&r.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}setStyle(p,s){return s=r.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&p&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(p,(u,g)=>{u?(r.w(`Unable to perform style diff: ${String(u.message||u.error||u)}. Rebuilding the style from scratch.`),this._updateStyle(p,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){let s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){let u=r.W({},s);s&&s.config&&(u.initialConfig=s.config,delete u.config),this.style=new go(this,u).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new go(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.d(new Error("IDs can't be empty."))),!1):!r.cV(p)||(this.fire(new r.d(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,s){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,s,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,u)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,s,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:x,content:w}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){let{width:I,height:M,data:A}=r.e.getImageData(s);this.style.addImage(p,{data:new r.i({width:I,height:M},A),pixelRatio:u,stretchX:v,stretchY:x,content:w,sdf:g,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new r.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:I,height:M}=s,A=s;this.style.addImage(p,{data:new r.i({width:I,height:M},new Uint8Array(A.data)),pixelRatio:u,stretchX:v,stretchY:x,content:w,sdf:g,version:0,userImage:A}),A.onAdd&&A.onAdd(this,p)}}updateImage(p,s){this._lazyInitEmptyStyle();let u=this.style.getImage(p);if(!u)return void this.fire(new r.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?r.e.getImageData(s):s,{width:v,height:x,data:w}=g;if(v===void 0||x===void 0)return void this.fire(new r.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==u.data.width||x!==u.data.height)return void this.fire(new r.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));let I=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);u.data.replace(w,I),this.style.updateImage(p,u)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new r.d(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,s){r.h(this._requestManager.transformRequest(p,r.R.Image),(u,g)=>{s(u,g instanceof HTMLImageElement?r.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(p,s){this._lazyInitEmptyStyle(),this.style.addModel(p,s)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.d(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,s){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)):this}getSlot(p){let s=this.getLayer(p);return s&&s.slot||null}setSlot(p,s){return this.style.setSlot(p,s),this.style.mergeLayers(),this._update(!0)}addImport(p,s){return this.style.addImport(p,s),this}updateImport(p,s){return typeof s!="string"&&s.id!==p?(this.removeImport(p),this.addImport(s)):(this.style.updateImport(p,s),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,s){return this.style.moveImport(p,s),this._update(!0)}moveLayer(p,s){return this._isValidId(p)?(this.style.moveLayer(p,s),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){return this._isValidId(p)?this.style.getOwnLayer(p):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,s,u){return this._isValidId(p)?(this.style.setLayerZoomRange(p,s,u),this._update(!0)):this}setFilter(p,s,u={}){return this._isValidId(p)?(this.style.setFilter(p,s,u),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,s,u,g={}){return this._isValidId(p)?(this.style.setPaintProperty(p,s,u,g),this._update(!0)):this}getPaintProperty(p,s){return this._isValidId(p)?this.style.getPaintProperty(p,s):null}setLayoutProperty(p,s,u,g={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,s,u,g),this._update(!0)):this}getLayoutProperty(p,s){return this._isValidId(p)?this.style.getLayoutProperty(p,s):null}getSchema(p){return this.style.getSchema(p)}setSchema(p,s){return this.style.setSchema(p,s),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,s){return this.style.setConfig(p,s),this._update(!0)}getConfigProperty(p,s){return this.style.getConfigProperty(p,s)}setConfigProperty(p,s,u){return this.style.setConfigProperty(p,s,u),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){let s=p[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aI.convert(p),this.transform):0}setFeatureState(p,s){return this._isValidId(p.source)?(this.style.setFeatureState(p,s),this._update()):this}removeFeatureState(p,s){return this._isValidId(p.source)?(this.style.removeFeatureState(p,s),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;let p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300,u,g,v,x=this._container;for(;x&&(!g||!v);){let w=window.getComputedStyle(x).transform;w&&w!=="none"&&(u=w.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(g=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(v=u[3])),x=x.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();let s=this._canvasContainer=Z("div","mapboxgl-canvas-container",p);this._canvas=Z("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let u=this._controlContainer=Z("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Z("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){let u=r.e.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){let s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){let s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){let p=r.W({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",p);s?(r.dh(s,!0),this.painter=new C_(s,this._contextCreateOptions,this.transform,this._tp),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.di.testSupport(s)):this.fire(new r.d(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.f("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new r.f("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;this.fire(new r.f("renderstart")),++this._frameId;let u=this.painter.context.extTimerQuery,g=r.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(u.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let A=this.transform.zoom,L=this.transform.pitch,F=r.e.now(),B=new r.X(A,{now:F,fadeDuration:x,pitch:L,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(g);let I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(I&&(this._placementDirty=I.needsRerender,this._occlusionOpacityChanged=I.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.dc.mark(r.dd.load),this.fire(new r.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){let A=r.e.now()-g;v.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{let L=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new r.f("gpu-timing-frame",{cpuTime:A,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){let A=this.painter.collectGpuTimers();setTimeout(()=>{let L=this.painter.queryGpuTimers(A);this.fire(new r.f("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){let A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let L=this.painter.queryGpuTimeDeferredRender(A);this.fire(new r.f("gpu-timing-deferred-render",{gpuTime:L}))},50)}let M=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||w;if((this._sourcesDirty||this._styleDirty||w||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),M||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let A=!this.isMoving()&&this.loaded();if(A&&(w=this._updateAverageElevation(g,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new r.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let L=this._calculateSpeedIndex();this.fire(new r.f("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!M&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,r.dc.mark(r.dd.fullLoad),this._performanceMetricsCollection&&r.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(let s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(let s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){let u=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;let w=Math.abs(v-x);if(w>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,p,300)}else if(w>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){r.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===r.dl||p.status===401)){let s=this.painter.context.gl;r.dh(s,!1),this._logoControl instanceof Z_&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){let p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());let u=this.painter.context.gl,g=u.createFramebuffer();function v(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);let w=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,w),w}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(p),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(p,s,u){let g=u[1]-u[0],v=p.length/4;for(let x=0;x<s.length;x++){let w=s[x],I=0;for(let M=0;M<w.length;M+=4)w[M]===p[M]&&w[M+1]===p[M+1]&&w[M+2]===p[M+2]&&w[M+3]===p[M+3]&&(I+=1);g+=(u[x+2]-u[x+1])*(1-I/v)}return g}remove(){this._hash&&this._hash.remove();for(let s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dp(this.painter.context.gl),r.dq.remove(),r.dr.remove(),this._removed=!0,this.fire(new r.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.e.frame(s=>{let u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(s)}))}_preloadTiles(p){let s=this.style?this.style.getSourceCaches():[];return r.ds(s,(u,g)=>u._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,s){r.du(p,s)}_occlusionCriteriaSatisfied(){let p=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&p&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return r.dt}},NavigationControl:class{constructor(p){this.options=r.W({},ka,p),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(r.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),Z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),Z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{let u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:s}):u.resetNorth({},{originalEvent:s}))}),this._compassIcon=Z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let p=this._map;if(!p)return;let s=p.getZoom(),u=s===p.getMaxZoom(),g=s===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let p=this._map;if(!p)return;let s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ty(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){let p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){let u=Z("button",p,this._container);return u.type="button",u.addEventListener("click",s),u}_setButtonTitle(p,s){if(!this._map)return;let u=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends r.E{constructor(p){super();let s=navigator.geolocation;this.options=r.W({geolocation:s},Fa,p),r.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Bp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){let s=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,p(u)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>s(u.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){let s=this._map.getMaxBounds(),u=p.coords;return!!s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.f("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("geolocate",p)),this._finish()}}_updateCamera(p){let s=new r.aI(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,g=this._map.getBearing(),v=r.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(u),v,{geolocateSource:!0})}_updateMarker(p){if(p){let s=new r.aI(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let p=this._map.transform,s=r.ax(1,p._center.lat)*p.worldSize,u=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=Z("button","mapboxgl-ctrl-geolocate",this._container),Z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{let s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z("div","mapboxgl-user-location"),this._dotElement.appendChild(Z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Au({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Au({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.f("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:W_,ScaleControl:class{constructor(p){this.options=r.W({},ny,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let p=this.options.maxWidth||100,s=this._map,u=s._containerHeight/2,g=s._containerWidth/2-p/2,v=s.unproject([g,u]),x=s.unproject([g+p,u]),w=v.distanceTo(x);if(this.options.unit==="imperial"){let I=3.2808*w;I>5280?this._setScale(p,I/5280,"mile"):this._setScale(p,I,"foot")}else this.options.unit==="nautical"?this._setScale(p,w/1852,"nautical-mile"):w>=1e3?this._setScale(p,w/1e3,"kilometer"):this._setScale(p,w,"meter")}_setScale(p,s,u){this._map._requestDomTask(()=>{let g=function(x){let w=Math.pow(10,`${Math.floor(x)}`.length-1),I=x/w;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){let A=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*A)/A}(I),w*I}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(g):`${g}&nbsp;${gd[u]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.w("Full screen control 'container' must be a DOM element.")),r.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let p=this._fullscreenButton=Z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(p){super(),this.options=r.W(Object.create(Qp),p),r.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.f("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.aI.convert(p),this._pos=null,this._trackPointer=!1,this._update();let s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){let s=document.createDocumentFragment(),u=document.createElement("body"),g;for(u.innerHTML=p;g=u.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=Z("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){let u=this._closeButton=Z("button","mapboxgl-popup-close-button",s);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;let s=this._map,u=this._container,g=this._pos;if(!s||!u||!g)return"bottom";let v=u.offsetWidth,x=u.offsetHeight,w=g.x<v/2,I=g.x>s.transform.width-v/2;if(g.y+p<x)return w?"top-left":I?"top-right":"top";if(g.y>s.transform.height-x){if(w)return"bottom-left";if(I)return"bottom-right"}return w?"left":I?"right":"bottom"}_updateClassList(){let p=this._container;if(!p)return;let s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){let s=this._map,u=this._content;if(!s||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=Z("div","mapboxgl-popup",s.getContainer()),this._tip=Z("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=X_(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){let v=this._pos=this._trackPointer&&p?p:s.project(this._lngLat),x=La(this.options.offset),w=this._anchor=this._getAnchor(x.y),I=La(this.options.offset,w),M=v.add(I).round();s._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Kp[w]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&s._showingGlobe()){let v=r.d9(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let p=this._container.querySelector(K_);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Au,Style:go,LngLat:r.aI,LngLatBounds:r.ai,Point:r.P,MercatorCoordinate:r.Y,FreeCameraOptions:ip,Evented:r.E,config:r.d8,prewarm:r.dx,clearPrewarmedResources:r.dy,get accessToken(){return r.d8.ACCESS_TOKEN},set accessToken(p){r.d8.ACCESS_TOKEN=p},get baseApiUrl(){return r.d8.API_URL},set baseApiUrl(p){r.d8.API_URL=p},get workerCount(){return r.dz.workerCount},set workerCount(p){r.dz.workerCount=p},get maxParallelImageRequests(){return r.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.d8.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.dA(p)},get workerUrl(){return r.dB.workerUrl},set workerUrl(p){r.dB.workerUrl=p},get workerClass(){return r.dB.workerClass},set workerClass(p){r.dB.workerClass=p},get workerParams(){return r.dB.workerParams},set workerParams(p){r.dB.workerParams=p},get dracoUrl(){return r.dC()},set dracoUrl(p){r.dD(p)},get meshoptUrl(){return r.dE()},set meshoptUrl(p){r.dF(p)},setNow:r.e.setNow,restoreNow:r.e.restoreNow}});var m=c;return m})});var oA=null;var mw=1,sA=Symbol("SIGNAL");function nr(o){let i=oA;return oA=o,i}var aA={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function MB(o){if(!(yw(o)&&!o.dirty)&&!(!o.dirty&&o.lastCleanEpoch===mw)){if(!o.producerMustRecompute(o)&&!gw(o)){o.dirty=!1,o.lastCleanEpoch=mw;return}o.producerRecomputeValue(o),o.dirty=!1,o.lastCleanEpoch=mw}}function lA(o){return o&&(o.nextProducerIndex=0),nr(o)}function cA(o,i){if(nr(i),!(!o||o.producerNode===void 0||o.producerIndexOfThis===void 0||o.producerLastReadVersion===void 0)){if(yw(o))for(let c=o.nextProducerIndex;c<o.producerNode.length;c++)_w(o.producerNode[c],o.producerIndexOfThis[c]);for(;o.producerNode.length>o.nextProducerIndex;)o.producerNode.pop(),o.producerLastReadVersion.pop(),o.producerIndexOfThis.pop()}}function gw(o){u0(o);for(let i=0;i<o.producerNode.length;i++){let c=o.producerNode[i],h=o.producerLastReadVersion[i];if(h!==c.version||(MB(c),h!==c.version))return!0}return!1}function uA(o){if(u0(o),yw(o))for(let i=0;i<o.producerNode.length;i++)_w(o.producerNode[i],o.producerIndexOfThis[i]);o.producerNode.length=o.producerLastReadVersion.length=o.producerIndexOfThis.length=0,o.liveConsumerNode&&(o.liveConsumerNode.length=o.liveConsumerIndexOfThis.length=0)}function _w(o,i){if(AB(o),u0(o),o.liveConsumerNode.length===1)for(let h=0;h<o.producerNode.length;h++)_w(o.producerNode[h],o.producerIndexOfThis[h]);let c=o.liveConsumerNode.length-1;if(o.liveConsumerNode[i]=o.liveConsumerNode[c],o.liveConsumerIndexOfThis[i]=o.liveConsumerIndexOfThis[c],o.liveConsumerNode.length--,o.liveConsumerIndexOfThis.length--,i<o.liveConsumerNode.length){let h=o.liveConsumerIndexOfThis[i],m=o.liveConsumerNode[i];u0(m),m.producerIndexOfThis[h]=i}}function yw(o){return o.consumerIsAlwaysLive||(o?.liveConsumerNode?.length??0)>0}function u0(o){o.producerNode??=[],o.producerIndexOfThis??=[],o.producerLastReadVersion??=[]}function AB(o){o.liveConsumerNode??=[],o.liveConsumerIndexOfThis??=[]}function PB(){throw new Error}var RB=PB;function hA(o){RB=o}function Dn(o){return typeof o=="function"}function qd(o){let c=o(h=>{Error.call(h),h.stack=new Error().stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}var h0=qd(o=>function(c){o(this),this.message=c?`${c.length} errors occurred during unsubscription:
${c.map((h,m)=>`${m+1}) ${h.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=c});function zm(o,i){if(o){let c=o.indexOf(i);0<=c&&o.splice(c,1)}}var ai=class o{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;let{_parentage:c}=this;if(c)if(this._parentage=null,Array.isArray(c))for(let r of c)r.remove(this);else c.remove(this);let{initialTeardown:h}=this;if(Dn(h))try{h()}catch(r){i=r instanceof h0?r.errors:[r]}let{_finalizers:m}=this;if(m){this._finalizers=null;for(let r of m)try{dA(r)}catch(E){i=i??[],E instanceof h0?i=[...i,...E.errors]:i.push(E)}}if(i)throw new h0(i)}}add(i){var c;if(i&&i!==this)if(this.closed)dA(i);else{if(i instanceof o){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=(c=this._finalizers)!==null&&c!==void 0?c:[]).push(i)}}_hasParent(i){let{_parentage:c}=this;return c===i||Array.isArray(c)&&c.includes(i)}_addParent(i){let{_parentage:c}=this;this._parentage=Array.isArray(c)?(c.push(i),c):c?[c,i]:i}_removeParent(i){let{_parentage:c}=this;c===i?this._parentage=null:Array.isArray(c)&&zm(c,i)}remove(i){let{_finalizers:c}=this;c&&zm(c,i),i instanceof o&&i._removeParent(this)}};ai.EMPTY=(()=>{let o=new ai;return o.closed=!0,o})();var vw=ai.EMPTY;function d0(o){return o instanceof ai||o&&"closed"in o&&Dn(o.remove)&&Dn(o.add)&&Dn(o.unsubscribe)}function dA(o){Dn(o)?o():o.unsubscribe()}var ps={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Hd={setTimeout(o,i,...c){let{delegate:h}=Hd;return h?.setTimeout?h.setTimeout(o,i,...c):setTimeout(o,i,...c)},clearTimeout(o){let{delegate:i}=Hd;return(i?.clearTimeout||clearTimeout)(o)},delegate:void 0};function f0(o){Hd.setTimeout(()=>{let{onUnhandledError:i}=ps;if(i)i(o);else throw o})}function Bm(){}var fA=xw("C",void 0,void 0);function pA(o){return xw("E",void 0,o)}function mA(o){return xw("N",o,void 0)}function xw(o,i,c){return{kind:o,value:i,error:c}}var Zu=null;function Wd(o){if(ps.useDeprecatedSynchronousErrorHandling){let i=!Zu;if(i&&(Zu={errorThrown:!1,error:null}),o(),i){let{errorThrown:c,error:h}=Zu;if(Zu=null,c)throw h}}else o()}function gA(o){ps.useDeprecatedSynchronousErrorHandling&&Zu&&(Zu.errorThrown=!0,Zu.error=o)}var Yu=class extends ai{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,d0(i)&&i.add(this)):this.destination=kB}static create(i,c,h){return new Wa(i,c,h)}next(i){this.isStopped?ww(mA(i),this):this._next(i)}error(i){this.isStopped?ww(pA(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?ww(fA,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},OB=Function.prototype.bind;function bw(o,i){return OB.call(o,i)}var Ew=class{constructor(i){this.partialObserver=i}next(i){let{partialObserver:c}=this;if(c.next)try{c.next(i)}catch(h){p0(h)}}error(i){let{partialObserver:c}=this;if(c.error)try{c.error(i)}catch(h){p0(h)}else p0(i)}complete(){let{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(c){p0(c)}}},Wa=class extends Yu{constructor(i,c,h){super();let m;if(Dn(i)||!i)m={next:i??void 0,error:c??void 0,complete:h??void 0};else{let r;this&&ps.useDeprecatedNextContext?(r=Object.create(i),r.unsubscribe=()=>this.unsubscribe(),m={next:i.next&&bw(i.next,r),error:i.error&&bw(i.error,r),complete:i.complete&&bw(i.complete,r)}):m=i}this.destination=new Ew(m)}};function p0(o){ps.useDeprecatedSynchronousErrorHandling?gA(o):f0(o)}function LB(o){throw o}function ww(o,i){let{onStoppedNotification:c}=ps;c&&Hd.setTimeout(()=>c(o,i))}var kB={closed:!0,next:Bm,error:LB,complete:Bm};var Zd=typeof Symbol=="function"&&Symbol.observable||"@@observable";function xo(o){return o}function Tw(...o){return Iw(o)}function Iw(o){return o.length===0?xo:o.length===1?o[0]:function(c){return o.reduce((h,m)=>m(h),c)}}var rr=(()=>{class o{constructor(c){c&&(this._subscribe=c)}lift(c){let h=new o;return h.source=this,h.operator=c,h}subscribe(c,h,m){let r=NB(c)?c:new Wa(c,h,m);return Wd(()=>{let{operator:E,source:C}=this;r.add(E?E.call(r,C):C?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(c){try{return this._subscribe(c)}catch(h){c.error(h)}}forEach(c,h){return h=_A(h),new h((m,r)=>{let E=new Wa({next:C=>{try{c(C)}catch(O){r(O),E.unsubscribe()}},error:r,complete:m});this.subscribe(E)})}_subscribe(c){var h;return(h=this.source)===null||h===void 0?void 0:h.subscribe(c)}[Zd](){return this}pipe(...c){return Iw(c)(this)}toPromise(c){return c=_A(c),new c((h,m)=>{let r;this.subscribe(E=>r=E,E=>m(E),()=>h(r))})}}return o.create=i=>new o(i),o})();function _A(o){var i;return(i=o??ps.Promise)!==null&&i!==void 0?i:Promise}function FB(o){return o&&Dn(o.next)&&Dn(o.error)&&Dn(o.complete)}function NB(o){return o&&o instanceof Yu||FB(o)&&d0(o)}function Dw(o){return Dn(o?.lift)}function jn(o){return i=>{if(Dw(i))return i.lift(function(c){try{return o(c,this)}catch(h){this.error(h)}});throw new TypeError("Unable to lift unknown Observable type")}}function Wn(o,i,c,h,m){return new Sw(o,i,c,h,m)}var Sw=class extends Yu{constructor(i,c,h,m,r,E){super(i),this.onFinalize=r,this.shouldUnsubscribe=E,this._next=c?function(C){try{c(C)}catch(O){i.error(O)}}:super._next,this._error=m?function(C){try{m(C)}catch(O){i.error(O)}finally{this.unsubscribe()}}:super._error,this._complete=h?function(){try{h()}catch(C){i.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:c}=this;super.unsubscribe(),!c&&((i=this.onFinalize)===null||i===void 0||i.call(this))}}};function Yd(){return jn((o,i)=>{let c=null;o._refCount++;let h=Wn(i,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount){c=null;return}let m=o._connection,r=c;c=null,m&&(!r||m===r)&&m.unsubscribe(),i.unsubscribe()});o.subscribe(h),h.closed||(c=o.connect())})}var Xd=class extends rr{constructor(i,c){super(),this.source=i,this.subjectFactory=c,this._subject=null,this._refCount=0,this._connection=null,Dw(i)&&(this.lift=i.lift)}_subscribe(i){return this.getSubject().subscribe(i)}getSubject(){let i=this._subject;return(!i||i.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:i}=this;this._subject=this._connection=null,i?.unsubscribe()}connect(){let i=this._connection;if(!i){i=this._connection=new ai;let c=this.getSubject();i.add(this.source.subscribe(Wn(c,void 0,()=>{this._teardown(),c.complete()},h=>{this._teardown(),c.error(h)},()=>this._teardown()))),i.closed&&(this._connection=null,i=ai.EMPTY)}return i}refCount(){return Yd()(this)}};var yA=qd(o=>function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ti=(()=>{class o extends rr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(c){let h=new m0(this,this);return h.operator=c,h}_throwIfClosed(){if(this.closed)throw new yA}next(c){Wd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let h of this.currentObservers)h.next(c)}})}error(c){Wd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=c;let{observers:h}=this;for(;h.length;)h.shift().error(c)}})}complete(){Wd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:c}=this;for(;c.length;)c.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var c;return((c=this.observers)===null||c===void 0?void 0:c.length)>0}_trySubscribe(c){return this._throwIfClosed(),super._trySubscribe(c)}_subscribe(c){return this._throwIfClosed(),this._checkFinalizedStatuses(c),this._innerSubscribe(c)}_innerSubscribe(c){let{hasError:h,isStopped:m,observers:r}=this;return h||m?vw:(this.currentObservers=null,r.push(c),new ai(()=>{this.currentObservers=null,zm(r,c)}))}_checkFinalizedStatuses(c){let{hasError:h,thrownError:m,isStopped:r}=this;h?c.error(m):r&&c.complete()}asObservable(){let c=new rr;return c.source=this,c}}return o.create=(i,c)=>new m0(i,c),o})(),m0=class extends Ti{constructor(i,c){super(),this.destination=i,this.source=c}next(i){var c,h;(h=(c=this.destination)===null||c===void 0?void 0:c.next)===null||h===void 0||h.call(c,i)}error(i){var c,h;(h=(c=this.destination)===null||c===void 0?void 0:c.error)===null||h===void 0||h.call(c,i)}complete(){var i,c;(c=(i=this.destination)===null||i===void 0?void 0:i.complete)===null||c===void 0||c.call(i)}_subscribe(i){var c,h;return(h=(c=this.source)===null||c===void 0?void 0:c.subscribe(i))!==null&&h!==void 0?h:vw}};var li=class extends Ti{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){let c=super._subscribe(i);return!c.closed&&i.next(this._value),c}getValue(){let{hasError:i,thrownError:c,_value:h}=this;if(i)throw c;return this._throwIfClosed(),h}next(i){super.next(this._value=i)}};var bo=new rr(o=>o.complete());function vA(o){return o&&Dn(o.schedule)}function xA(o){return o[o.length-1]}function bA(o){return Dn(xA(o))?o.pop():void 0}function dc(o){return vA(xA(o))?o.pop():void 0}function EA(o,i,c,h){function m(r){return r instanceof c?r:new c(function(E){E(r)})}return new(c||(c=Promise))(function(r,E){function C(Z){try{z(h.next(Z))}catch(ce){E(ce)}}function O(Z){try{z(h.throw(Z))}catch(ce){E(ce)}}function z(Z){Z.done?r(Z.value):m(Z.value).then(C,O)}z((h=h.apply(o,i||[])).next())})}function wA(o){var i=typeof Symbol=="function"&&Symbol.iterator,c=i&&o[i],h=0;if(c)return c.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&h>=o.length&&(o=void 0),{value:o&&o[h++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xu(o){return this instanceof Xu?(this.v=o,this):new Xu(o)}function TA(o,i,c){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h=c.apply(o,i||[]),m,r=[];return m={},C("next"),C("throw"),C("return",E),m[Symbol.asyncIterator]=function(){return this},m;function E(be){return function(qe){return Promise.resolve(qe).then(be,ce)}}function C(be,qe){h[be]&&(m[be]=function(ot){return new Promise(function(dt,ct){r.push([be,ot,dt,ct])>1||O(be,ot)})},qe&&(m[be]=qe(m[be])))}function O(be,qe){try{z(h[be](qe))}catch(ot){Ie(r[0][3],ot)}}function z(be){be.value instanceof Xu?Promise.resolve(be.value.v).then(Z,ce):Ie(r[0][2],be)}function Z(be){O("next",be)}function ce(be){O("throw",be)}function Ie(be,qe){be(qe),r.shift(),r.length&&O(r[0][0],r[0][1])}}function IA(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],c;return i?i.call(o):(o=typeof wA=="function"?wA(o):o[Symbol.iterator](),c={},h("next"),h("throw"),h("return"),c[Symbol.asyncIterator]=function(){return this},c);function h(r){c[r]=o[r]&&function(E){return new Promise(function(C,O){E=o[r](E),m(C,O,E.done,E.value)})}}function m(r,E,C,O){Promise.resolve(O).then(function(z){r({value:z,done:C})},E)}}var g0=o=>o&&typeof o.length=="number"&&typeof o!="function";function _0(o){return Dn(o?.then)}function y0(o){return Dn(o[Zd])}function v0(o){return Symbol.asyncIterator&&Dn(o?.[Symbol.asyncIterator])}function x0(o){return new TypeError(`You provided ${o!==null&&typeof o=="object"?"an invalid object":`'${o}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function zB(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var b0=zB();function w0(o){return Dn(o?.[b0])}function E0(o){return TA(this,arguments,function*(){let c=o.getReader();try{for(;;){let{value:h,done:m}=yield Xu(c.read());if(m)return yield Xu(void 0);yield yield Xu(h)}}finally{c.releaseLock()}})}function T0(o){return Dn(o?.getReader)}function Nr(o){if(o instanceof rr)return o;if(o!=null){if(y0(o))return BB(o);if(g0(o))return UB(o);if(_0(o))return VB(o);if(v0(o))return DA(o);if(w0(o))return jB(o);if(T0(o))return $B(o)}throw x0(o)}function BB(o){return new rr(i=>{let c=o[Zd]();if(Dn(c.subscribe))return c.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function UB(o){return new rr(i=>{for(let c=0;c<o.length&&!i.closed;c++)i.next(o[c]);i.complete()})}function VB(o){return new rr(i=>{o.then(c=>{i.closed||(i.next(c),i.complete())},c=>i.error(c)).then(null,f0)})}function jB(o){return new rr(i=>{for(let c of o)if(i.next(c),i.closed)return;i.complete()})}function DA(o){return new rr(i=>{GB(o,i).catch(c=>i.error(c))})}function $B(o){return DA(E0(o))}function GB(o,i){var c,h,m,r;return EA(this,void 0,void 0,function*(){try{for(c=IA(o);h=yield c.next(),!h.done;){let E=h.value;if(i.next(E),i.closed)return}}catch(E){m={error:E}}finally{try{h&&!h.done&&(r=c.return)&&(yield r.call(c))}finally{if(m)throw m.error}}i.complete()})}function io(o,i,c,h=0,m=!1){let r=i.schedule(function(){c(),m?o.add(this.schedule(null,h)):this.unsubscribe()},h);if(o.add(r),!m)return r}function I0(o,i=0){return jn((c,h)=>{c.subscribe(Wn(h,m=>io(h,o,()=>h.next(m),i),()=>io(h,o,()=>h.complete(),i),m=>io(h,o,()=>h.error(m),i)))})}function D0(o,i=0){return jn((c,h)=>{h.add(o.schedule(()=>c.subscribe(h),i))})}function SA(o,i){return Nr(o).pipe(D0(i),I0(i))}function CA(o,i){return Nr(o).pipe(D0(i),I0(i))}function MA(o,i){return new rr(c=>{let h=0;return i.schedule(function(){h===o.length?c.complete():(c.next(o[h++]),c.closed||this.schedule())})})}function AA(o,i){return new rr(c=>{let h;return io(c,i,()=>{h=o[b0](),io(c,i,()=>{let m,r;try{({value:m,done:r}=h.next())}catch(E){c.error(E);return}r?c.complete():c.next(m)},0,!0)}),()=>Dn(h?.return)&&h.return()})}function S0(o,i){if(!o)throw new Error("Iterable cannot be null");return new rr(c=>{io(c,i,()=>{let h=o[Symbol.asyncIterator]();io(c,i,()=>{h.next().then(m=>{m.done?c.complete():c.next(m.value)})},0,!0)})})}function PA(o,i){return S0(E0(o),i)}function RA(o,i){if(o!=null){if(y0(o))return SA(o,i);if(g0(o))return MA(o,i);if(_0(o))return CA(o,i);if(v0(o))return S0(o,i);if(w0(o))return AA(o,i);if(T0(o))return PA(o,i)}throw x0(o)}function zr(o,i){return i?RA(o,i):Nr(o)}function ln(...o){let i=dc(o);return zr(o,i)}function Za(o,i){let c=Dn(o)?o:()=>o,h=m=>m.error(c());return new rr(i?m=>i.schedule(h,0,m):h)}function Cw(o){return!!o&&(o instanceof rr||Dn(o.lift)&&Dn(o.subscribe))}var Ya=qd(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});function Pn(o,i){return jn((c,h)=>{let m=0;c.subscribe(Wn(h,r=>{h.next(o.call(i,r,m++))}))})}var{isArray:qB}=Array;function HB(o,i){return qB(i)?o(...i):o(i)}function OA(o){return Pn(i=>HB(o,i))}var{isArray:WB}=Array,{getPrototypeOf:ZB,prototype:YB,keys:XB}=Object;function LA(o){if(o.length===1){let i=o[0];if(WB(i))return{args:i,keys:null};if(KB(i)){let c=XB(i);return{args:c.map(h=>i[h]),keys:c}}}return{args:o,keys:null}}function KB(o){return o&&typeof o=="object"&&ZB(o)===YB}function kA(o,i){return o.reduce((c,h,m)=>(c[h]=i[m],c),{})}function C0(...o){let i=dc(o),c=bA(o),{args:h,keys:m}=LA(o);if(h.length===0)return zr([],i);let r=new rr(QB(h,i,m?E=>kA(m,E):xo));return c?r.pipe(OA(c)):r}function QB(o,i,c=xo){return h=>{FA(i,()=>{let{length:m}=o,r=new Array(m),E=m,C=m;for(let O=0;O<m;O++)FA(i,()=>{let z=zr(o[O],i),Z=!1;z.subscribe(Wn(h,ce=>{r[O]=ce,Z||(Z=!0,C--),C||h.next(c(r.slice()))},()=>{--E||h.complete()}))},h)},h)}}function FA(o,i,c){o?io(c,o,i):i()}function NA(o,i,c,h,m,r,E,C){let O=[],z=0,Z=0,ce=!1,Ie=()=>{ce&&!O.length&&!z&&i.complete()},be=ot=>z<h?qe(ot):O.push(ot),qe=ot=>{r&&i.next(ot),z++;let dt=!1;Nr(c(ot,Z++)).subscribe(Wn(i,ct=>{m?.(ct),r?be(ct):i.next(ct)},()=>{dt=!0},void 0,()=>{if(dt)try{for(z--;O.length&&z<h;){let ct=O.shift();E?io(i,E,()=>qe(ct)):qe(ct)}Ie()}catch(ct){i.error(ct)}}))};return o.subscribe(Wn(i,be,()=>{ce=!0,Ie()})),()=>{C?.()}}function ci(o,i,c=1/0){return Dn(i)?ci((h,m)=>Pn((r,E)=>i(h,r,m,E))(Nr(o(h,m))),c):(typeof i=="number"&&(c=i),jn((h,m)=>NA(h,m,o,c)))}function Mw(o=1/0){return ci(xo,o)}function zA(){return Mw(1)}function Kd(...o){return zA()(zr(o,dc(o)))}function M0(o){return new rr(i=>{Nr(o()).subscribe(i)})}function wo(o,i){return jn((c,h)=>{let m=0;c.subscribe(Wn(h,r=>o.call(i,r,m++)&&h.next(r)))})}function Ks(o){return jn((i,c)=>{let h=null,m=!1,r;h=i.subscribe(Wn(c,void 0,void 0,E=>{r=Nr(o(E,Ks(o)(i))),h?(h.unsubscribe(),h=null,r.subscribe(c)):m=!0})),m&&(h.unsubscribe(),h=null,r.subscribe(c))})}function BA(o,i,c,h,m){return(r,E)=>{let C=c,O=i,z=0;r.subscribe(Wn(E,Z=>{let ce=z++;O=C?o(O,Z,ce):(C=!0,Z),h&&E.next(O)},m&&(()=>{C&&E.next(O),E.complete()})))}}function fc(o,i){return Dn(i)?ci(o,i,1):ci(o,1)}function pc(o){return jn((i,c)=>{let h=!1;i.subscribe(Wn(c,m=>{h=!0,c.next(m)},()=>{h||c.next(o),c.complete()}))})}function Xa(o){return o<=0?()=>bo:jn((i,c)=>{let h=0;i.subscribe(Wn(c,m=>{++h<=o&&(c.next(m),o<=h&&c.complete())}))})}function Aw(o){return Pn(()=>o)}function A0(o=JB){return jn((i,c)=>{let h=!1;i.subscribe(Wn(c,m=>{h=!0,c.next(m)},()=>h?c.complete():c.error(o())))})}function JB(){return new Ya}function Qs(o){return jn((i,c)=>{try{i.subscribe(c)}finally{c.add(o)}})}function Js(o,i){let c=arguments.length>=2;return h=>h.pipe(o?wo((m,r)=>o(m,r,h)):xo,Xa(1),c?pc(i):A0(()=>new Ya))}function Qd(o){return o<=0?()=>bo:jn((i,c)=>{let h=[];i.subscribe(Wn(c,m=>{h.push(m),o<h.length&&h.shift()},()=>{for(let m of h)c.next(m);c.complete()},void 0,()=>{h=null}))})}function Pw(o,i){let c=arguments.length>=2;return h=>h.pipe(o?wo((m,r)=>o(m,r,h)):xo,Qd(1),c?pc(i):A0(()=>new Ya))}function Rw(o,i){return jn(BA(o,i,arguments.length>=2,!0))}function Lw(o={}){let{connector:i=()=>new Ti,resetOnError:c=!0,resetOnComplete:h=!0,resetOnRefCountZero:m=!0}=o;return r=>{let E,C,O,z=0,Z=!1,ce=!1,Ie=()=>{C?.unsubscribe(),C=void 0},be=()=>{Ie(),E=O=void 0,Z=ce=!1},qe=()=>{let ot=E;be(),ot?.unsubscribe()};return jn((ot,dt)=>{z++,!ce&&!Z&&Ie();let ct=O=O??i();dt.add(()=>{z--,z===0&&!ce&&!Z&&(C=Ow(qe,m))}),ct.subscribe(dt),!E&&z>0&&(E=new Wa({next:bt=>ct.next(bt),error:bt=>{ce=!0,Ie(),C=Ow(be,c,bt),ct.error(bt)},complete:()=>{Z=!0,Ie(),C=Ow(be,h),ct.complete()}}),Nr(ot).subscribe(E))})(r)}}function Ow(o,i,...c){if(i===!0){o();return}if(i===!1)return;let h=new Wa({next:()=>{h.unsubscribe(),o()}});return Nr(i(...c)).subscribe(h)}function kw(...o){let i=dc(o);return jn((c,h)=>{(i?Kd(o,c,i):Kd(o,c)).subscribe(h)})}function Eo(o,i){return jn((c,h)=>{let m=null,r=0,E=!1,C=()=>E&&!m&&h.complete();c.subscribe(Wn(h,O=>{m?.unsubscribe();let z=0,Z=r++;Nr(o(O,Z)).subscribe(m=Wn(h,ce=>h.next(i?i(O,ce,Z,z++):ce),()=>{m=null,C()}))},()=>{E=!0,C()}))})}function Fw(o){return jn((i,c)=>{Nr(o).subscribe(Wn(c,()=>c.complete(),Bm)),!c.closed&&i.subscribe(c)})}function Yr(o,i,c){let h=Dn(o)||i||c?{next:o,error:i,complete:c}:o;return h?jn((m,r)=>{var E;(E=h.subscribe)===null||E===void 0||E.call(h);let C=!0;m.subscribe(Wn(r,O=>{var z;(z=h.next)===null||z===void 0||z.call(h,O),r.next(O)},()=>{var O;C=!1,(O=h.complete)===null||O===void 0||O.call(h),r.complete()},O=>{var z;C=!1,(z=h.error)===null||z===void 0||z.call(h,O),r.error(O)},()=>{var O,z;C&&((O=h.unsubscribe)===null||O===void 0||O.call(h)),(z=h.finalize)===null||z===void 0||z.call(h)}))}):xo}var w2="https://g.co/ng/security#xss",gt=class extends Error{constructor(i,c){super(nv(i,c)),this.code=i}};function nv(o,i){return`${`NG0${Math.abs(o)}`}${i?": "+i:""}`}function Qm(o){return{toString:o}.toString()}var P0="__parameters__";function e5(o){return function(...c){if(o){let h=o(...c);for(let m in h)this[m]=h[m]}}}function E2(o,i,c){return Qm(()=>{let h=e5(i);function m(...r){if(this instanceof m)return h.apply(this,r),this;let E=new m(...r);return C.annotation=E,C;function C(O,z,Z){let ce=O.hasOwnProperty(P0)?O[P0]:Object.defineProperty(O,P0,{value:[]})[P0];for(;ce.length<=Z;)ce.push(null);return(ce[Z]=ce[Z]||[]).push(E),O}}return c&&(m.prototype=Object.create(c.prototype)),m.prototype.ngMetadataName=o,m.annotationCls=m,m})}var Um=globalThis;function mr(o){for(let i in o)if(o[i]===mr)return i;throw Error("Could not find renamed property on target object.")}function oo(o){if(typeof o=="string")return o;if(Array.isArray(o))return"["+o.map(oo).join(", ")+"]";if(o==null)return""+o;if(o.overriddenName)return`${o.overriddenName}`;if(o.name)return`${o.name}`;let i=o.toString();if(i==null)return""+i;let c=i.indexOf(`
`);return c===-1?i:i.substring(0,c)}function UA(o,i){return o==null||o===""?i===null?"":i:i==null||i===""?o:o+" "+i}var t5=mr({__forward_ref__:mr});function T2(o){return o.__forward_ref__=T2,o.toString=function(){return oo(this())},o}function ji(o){return I2(o)?o():o}function I2(o){return typeof o=="function"&&o.hasOwnProperty(t5)&&o.__forward_ref__===T2}function jt(o){return{token:o.token,providedIn:o.providedIn||null,factory:o.factory,value:void 0}}function xc(o){return{providers:o.providers||[],imports:o.imports||[]}}function rv(o){return VA(o,S2)||VA(o,C2)}function D2(o){return rv(o)!==null}function VA(o,i){return o.hasOwnProperty(i)?o[i]:null}function n5(o){let i=o&&(o[S2]||o[C2]);return i||null}function jA(o){return o&&(o.hasOwnProperty($A)||o.hasOwnProperty(r5))?o[$A]:null}var S2=mr({\u0275prov:mr}),$A=mr({\u0275inj:mr}),C2=mr({ngInjectableDef:mr}),r5=mr({ngInjectorDef:mr}),gn=class{constructor(i,c){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof c=="number"?this.__NG_ELEMENT_ID__=c:c!==void 0&&(this.\u0275prov=jt({token:this,providedIn:c.providedIn||"root",factory:c.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function M2(o){return o&&!!o.\u0275providers}var i5=mr({\u0275cmp:mr}),o5=mr({\u0275dir:mr}),s5=mr({\u0275pipe:mr}),a5=mr({\u0275mod:mr}),N0=mr({\u0275fac:mr}),Vm=mr({__NG_ELEMENT_ID__:mr}),GA=mr({__NG_ENV_ID__:mr});function gc(o){return typeof o=="string"?o:o==null?"":String(o)}function l5(o){return typeof o=="function"?o.name||o.toString():typeof o=="object"&&o!=null&&typeof o.type=="function"?o.type.name||o.type.toString():gc(o)}function c5(o,i){let c=i?`. Dependency path: ${i.join(" > ")} > ${o}`:"";throw new gt(-200,o)}function LE(o,i){throw new gt(-201,!1)}var zn=function(o){return o[o.Default=0]="Default",o[o.Host=1]="Host",o[o.Self=2]="Self",o[o.SkipSelf=4]="SkipSelf",o[o.Optional=8]="Optional",o}(zn||{}),Yw;function A2(){return Yw}function $o(o){let i=Yw;return Yw=o,i}function P2(o,i,c){let h=rv(o);if(h&&h.providedIn=="root")return h.value===void 0?h.value=h.factory():h.value;if(c&zn.Optional)return null;if(i!==void 0)return i;LE(o,"Injector")}var u5={},jm=u5,Xw="__NG_DI_FLAG__",z0="ngTempTokenPath",h5="ngTokenPath",d5=/\n/gm,f5="\u0275",qA="__source",nf;function p5(){return nf}function mc(o){let i=nf;return nf=o,i}function m5(o,i=zn.Default){if(nf===void 0)throw new gt(-203,!1);return nf===null?P2(o,void 0,i):nf.get(o,i&zn.Optional?null:void 0,i)}function cn(o,i=zn.Default){return(A2()||m5)(ji(o),i)}function Et(o,i=zn.Default){return cn(o,iv(i))}function iv(o){return typeof o>"u"||typeof o=="number"?o:0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)}function Kw(o){let i=[];for(let c=0;c<o.length;c++){let h=ji(o[c]);if(Array.isArray(h)){if(h.length===0)throw new gt(900,!1);let m,r=zn.Default;for(let E=0;E<h.length;E++){let C=h[E],O=g5(C);typeof O=="number"?O===-1?m=C.token:r|=O:m=C}i.push(cn(m,r))}else i.push(cn(h))}return i}function R2(o,i){return o[Xw]=i,o.prototype[Xw]=i,o}function g5(o){return o[Xw]}function _5(o,i,c,h){let m=o[z0];throw i[qA]&&m.unshift(i[qA]),o.message=y5(`
`+o.message,m,c,h),o[h5]=m,o[z0]=null,o}function y5(o,i,c,h=null){o=o&&o.charAt(0)===`
`&&o.charAt(1)==f5?o.slice(2):o;let m=oo(i);if(Array.isArray(i))m=i.map(oo).join(" -> ");else if(typeof i=="object"){let r=[];for(let E in i)if(i.hasOwnProperty(E)){let C=i[E];r.push(E+":"+(typeof C=="string"?JSON.stringify(C):oo(C)))}m=`{${r.join(", ")}}`}return`${c}${h?"("+h+")":""}[${m}]: ${o.replace(d5,`
  `)}`}var ff=R2(E2("Optional"),8);var Jm=R2(E2("SkipSelf"),4);function of(o,i){let c=o.hasOwnProperty(N0);return c?o[N0]:null}function kE(o,i){o.forEach(c=>Array.isArray(c)?kE(c,i):i(c))}function O2(o,i,c){i>=o.length?o.push(c):o.splice(i,0,c)}function B0(o,i){return i>=o.length-1?o.pop():o.splice(i,1)[0]}var $m={},ea=[],sf=new gn(""),L2=new gn("",-1),k2=new gn(""),U0=class{get(i,c=jm){if(c===jm){let h=new Error(`NullInjectorError: No provider for ${oo(i)}!`);throw h.name="NullInjectorError",h}return c}},F2=function(o){return o[o.OnPush=0]="OnPush",o[o.Default=1]="Default",o}(F2||{}),ra=function(o){return o[o.Emulated=0]="Emulated",o[o.None=2]="None",o[o.ShadowDom=3]="ShadowDom",o}(ra||{}),ia=function(o){return o[o.None=0]="None",o[o.SignalBased=1]="SignalBased",o[o.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",o}(ia||{});function v5(o,i,c){let h=o.length;for(;;){let m=o.indexOf(i,c);if(m===-1)return m;if(m===0||o.charCodeAt(m-1)<=32){let r=i.length;if(m+r===h||o.charCodeAt(m+r)<=32)return m}c=m+1}}function Qw(o,i,c){let h=0;for(;h<c.length;){let m=c[h];if(typeof m=="number"){if(m!==0)break;h++;let r=c[h++],E=c[h++],C=c[h++];o.setAttribute(i,E,C,r)}else{let r=m,E=c[++h];b5(r)?o.setProperty(i,r,E):o.setAttribute(i,r,E),h++}}return h}function x5(o){return o===3||o===4||o===6}function b5(o){return o.charCodeAt(0)===64}function FE(o,i){if(!(i===null||i.length===0))if(o===null||o.length===0)o=i.slice();else{let c=-1;for(let h=0;h<i.length;h++){let m=i[h];typeof m=="number"?c=m:c===0||(c===-1||c===2?HA(o,c,m,null,i[++h]):HA(o,c,m,null,null))}}return o}function HA(o,i,c,h,m){let r=0,E=o.length;if(i===-1)E=-1;else for(;r<o.length;){let C=o[r++];if(typeof C=="number"){if(C===i){E=-1;break}else if(C>i){E=r-1;break}}}for(;r<o.length;){let C=o[r];if(typeof C=="number")break;if(C===c){if(h===null){m!==null&&(o[r+1]=m);return}else if(h===o[r+1]){o[r+2]=m;return}}r++,h!==null&&r++,m!==null&&r++}E!==-1&&(o.splice(E,0,i),r=E+1),o.splice(r++,0,c),h!==null&&o.splice(r++,0,h),m!==null&&o.splice(r++,0,m)}var N2="ng-template";function w5(o,i,c,h){let m=0;if(h){for(;m<i.length&&typeof i[m]=="string";m+=2)if(i[m]==="class"&&v5(i[m+1].toLowerCase(),c,0)!==-1)return!0}else if(NE(o))return!1;if(m=i.indexOf(1,m),m>-1){let r;for(;++m<i.length&&typeof(r=i[m])=="string";)if(r.toLowerCase()===c)return!0}return!1}function NE(o){return o.type===4&&o.value!==N2}function E5(o,i,c){let h=o.type===4&&!c?N2:o.value;return i===h}function T5(o,i,c){let h=4,m=o.attrs,r=m!==null?S5(m):0,E=!1;for(let C=0;C<i.length;C++){let O=i[C];if(typeof O=="number"){if(!E&&!ms(h)&&!ms(O))return!1;if(E&&ms(O))continue;E=!1,h=O|h&1;continue}if(!E)if(h&4){if(h=2|h&1,O!==""&&!E5(o,O,c)||O===""&&i.length===1){if(ms(h))return!1;E=!0}}else if(h&8){if(m===null||!w5(o,m,O,c)){if(ms(h))return!1;E=!0}}else{let z=i[++C],Z=I5(O,m,NE(o),c);if(Z===-1){if(ms(h))return!1;E=!0;continue}if(z!==""){let ce;if(Z>r?ce="":ce=m[Z+1].toLowerCase(),h&2&&z!==ce){if(ms(h))return!1;E=!0}}}}return ms(h)||E}function ms(o){return(o&1)===0}function I5(o,i,c,h){if(i===null)return-1;let m=0;if(h||!c){let r=!1;for(;m<i.length;){let E=i[m];if(E===o)return m;if(E===3||E===6)r=!0;else if(E===1||E===2){let C=i[++m];for(;typeof C=="string";)C=i[++m];continue}else{if(E===4)break;if(E===0){m+=4;continue}}m+=r?1:2}return-1}else return C5(i,o)}function D5(o,i,c=!1){for(let h=0;h<i.length;h++)if(T5(o,i[h],c))return!0;return!1}function S5(o){for(let i=0;i<o.length;i++){let c=o[i];if(x5(c))return i}return o.length}function C5(o,i){let c=o.indexOf(4);if(c>-1)for(c++;c<o.length;){let h=o[c];if(typeof h=="number")return-1;if(h===i)return c;c++}return-1}function WA(o,i){return o?":not("+i.trim()+")":i}function M5(o){let i=o[0],c=1,h=2,m="",r=!1;for(;c<o.length;){let E=o[c];if(typeof E=="string")if(h&2){let C=o[++c];m+="["+E+(C.length>0?'="'+C+'"':"")+"]"}else h&8?m+="."+E:h&4&&(m+=" "+E);else m!==""&&!ms(E)&&(i+=WA(r,m),m=""),h=E,r=r||!ms(h);c++}return m!==""&&(i+=WA(r,m)),i}function A5(o){return o.map(M5).join(",")}function P5(o){let i=[],c=[],h=1,m=2;for(;h<o.length;){let r=o[h];if(typeof r=="string")m===2?r!==""&&i.push(r,o[++h]):m===8&&c.push(r);else{if(!ms(m))break;m=r}h++}return{attrs:i,classes:c}}function Br(o){return Qm(()=>{let i=j2(o),c=Tr(xt({},i),{decls:o.decls,vars:o.vars,template:o.template,consts:o.consts||null,ngContentSelectors:o.ngContentSelectors,onPush:o.changeDetection===F2.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&o.dependencies||null,getStandaloneInjector:null,signals:o.signals??!1,data:o.data||{},encapsulation:o.encapsulation||ra.Emulated,styles:o.styles||ea,_:null,schemas:o.schemas||null,tView:null,id:""});$2(c);let h=o.dependencies;return c.directiveDefs=YA(h,!1),c.pipeDefs=YA(h,!0),c.id=L5(c),c})}function R5(o){return Ju(o)||z2(o)}function O5(o){return o!==null}function bc(o){return Qm(()=>({type:o.type,bootstrap:o.bootstrap||ea,declarations:o.declarations||ea,imports:o.imports||ea,exports:o.exports||ea,transitiveCompileScopes:null,schemas:o.schemas||null,id:o.id||null}))}function ZA(o,i){if(o==null)return $m;let c={};for(let h in o)if(o.hasOwnProperty(h)){let m=o[h],r,E,C=ia.None;Array.isArray(m)?(C=m[0],r=m[1],E=m[2]??r):(r=m,E=m),i?(c[r]=C!==ia.None?[h,C]:h,i[r]=E):c[r]=h}return c}function wc(o){return Qm(()=>{let i=j2(o);return $2(i),i})}function Ju(o){return o[i5]||null}function z2(o){return o[o5]||null}function B2(o){return o[s5]||null}function U2(o){let i=Ju(o)||z2(o)||B2(o);return i!==null?i.standalone:!1}function V2(o,i){let c=o[a5]||null;if(!c&&i===!0)throw new Error(`Type ${oo(o)} does not have '\u0275mod' property.`);return c}function j2(o){let i={};return{type:o.type,providersResolver:null,factory:null,hostBindings:o.hostBindings||null,hostVars:o.hostVars||0,hostAttrs:o.hostAttrs||null,contentQueries:o.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:o.inputs||$m,exportAs:o.exportAs||null,standalone:o.standalone===!0,signals:o.signals===!0,selectors:o.selectors||ea,viewQuery:o.viewQuery||null,features:o.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ZA(o.inputs,i),outputs:ZA(o.outputs),debugInfo:null}}function $2(o){o.features?.forEach(i=>i(o))}function YA(o,i){if(!o)return null;let c=i?B2:R5;return()=>(typeof o=="function"?o():o).map(h=>c(h)).filter(O5)}function L5(o){let i=0,c=[o.selectors,o.ngContentSelectors,o.hostVars,o.hostAttrs,o.consts,o.vars,o.decls,o.encapsulation,o.standalone,o.signals,o.exportAs,JSON.stringify(o.inputs),JSON.stringify(o.outputs),Object.getOwnPropertyNames(o.type.prototype),!!o.contentQueries,!!o.viewQuery].join("|");for(let m of c)i=Math.imul(31,i)+m.charCodeAt(0)<<0;return i+=2147483648,"c"+i}function Ec(o){return{\u0275providers:o}}function k5(...o){return{\u0275providers:G2(!0,o),\u0275fromNgModule:!0}}function G2(o,...i){let c=[],h=new Set,m,r=E=>{c.push(E)};return kE(i,E=>{let C=E;Jw(C,r,[],h)&&(m||=[],m.push(C))}),m!==void 0&&q2(m,r),c}function q2(o,i){for(let c=0;c<o.length;c++){let{ngModule:h,providers:m}=o[c];zE(m,r=>{i(r,h)})}}function Jw(o,i,c,h){if(o=ji(o),!o)return!1;let m=null,r=jA(o),E=!r&&Ju(o);if(!r&&!E){let O=o.ngModule;if(r=jA(O),r)m=O;else return!1}else{if(E&&!E.standalone)return!1;m=o}let C=h.has(m);if(E){if(C)return!1;if(h.add(m),E.dependencies){let O=typeof E.dependencies=="function"?E.dependencies():E.dependencies;for(let z of O)Jw(z,i,c,h)}}else if(r){if(r.imports!=null&&!C){h.add(m);let z;try{kE(r.imports,Z=>{Jw(Z,i,c,h)&&(z||=[],z.push(Z))})}finally{}z!==void 0&&q2(z,i)}if(!C){let z=of(m)||(()=>new m);i({provide:m,useFactory:z,deps:ea},m),i({provide:k2,useValue:m,multi:!0},m),i({provide:sf,useValue:()=>cn(m),multi:!0},m)}let O=r.providers;if(O!=null&&!C){let z=o;zE(O,Z=>{i(Z,z)})}}else return!1;return m!==o&&o.providers!==void 0}function zE(o,i){for(let c of o)M2(c)&&(c=c.\u0275providers),Array.isArray(c)?zE(c,i):i(c)}var F5=mr({provide:String,useValue:mr});function H2(o){return o!==null&&typeof o=="object"&&F5 in o}function N5(o){return!!(o&&o.useExisting)}function z5(o){return!!(o&&o.useFactory)}function af(o){return typeof o=="function"}function B5(o){return!!o.useClass}var ov=new gn(""),R0={},U5={},Nw;function BE(){return Nw===void 0&&(Nw=new U0),Nw}var so=class{},Gm=class extends so{get destroyed(){return this._destroyed}constructor(i,c,h,m){super(),this.parent=c,this.source=h,this.scopes=m,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,tE(i,E=>this.processProvider(E)),this.records.set(L2,Jd(void 0,this)),m.has("environment")&&this.records.set(so,Jd(void 0,this));let r=this.records.get(ov);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(k2,ea,zn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let i=nr(null);try{for(let h of this._ngOnDestroyHooks)h.ngOnDestroy();let c=this._onDestroyHooks;this._onDestroyHooks=[];for(let h of c)h()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),nr(i)}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();let c=mc(this),h=$o(void 0),m;try{return i()}finally{mc(c),$o(h)}}get(i,c=jm,h=zn.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(GA))return i[GA](this);h=iv(h);let m,r=mc(this),E=$o(void 0);try{if(!(h&zn.SkipSelf)){let O=this.records.get(i);if(O===void 0){let z=q5(i)&&rv(i);z&&this.injectableDefInScope(z)?O=Jd(eE(i),R0):O=null,this.records.set(i,O)}if(O!=null)return this.hydrate(i,O)}let C=h&zn.Self?BE():this.parent;return c=h&zn.Optional&&c===jm?null:c,C.get(i,c)}catch(C){if(C.name==="NullInjectorError"){if((C[z0]=C[z0]||[]).unshift(oo(i)),r)throw C;return _5(C,i,"R3InjectorError",this.source)}else throw C}finally{$o(E),mc(r)}}resolveInjectorInitializers(){let i=nr(null),c=mc(this),h=$o(void 0),m;try{let r=this.get(sf,ea,zn.Self);for(let E of r)E()}finally{mc(c),$o(h),nr(i)}}toString(){let i=[],c=this.records;for(let h of c.keys())i.push(oo(h));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new gt(205,!1)}processProvider(i){i=ji(i);let c=af(i)?i:ji(i&&i.provide),h=j5(i);if(!af(i)&&i.multi===!0){let m=this.records.get(c);m||(m=Jd(void 0,R0,!0),m.factory=()=>Kw(m.multi),this.records.set(c,m)),c=i,m.multi.push(i)}this.records.set(c,h)}hydrate(i,c){let h=nr(null);try{return c.value===R0&&(c.value=U5,c.value=c.factory()),typeof c.value=="object"&&c.value&&G5(c.value)&&this._ngOnDestroyHooks.add(c.value),c.value}finally{nr(h)}}injectableDefInScope(i){if(!i.providedIn)return!1;let c=ji(i.providedIn);return typeof c=="string"?c==="any"||this.scopes.has(c):this.injectorDefTypes.has(c)}removeOnDestroy(i){let c=this._onDestroyHooks.indexOf(i);c!==-1&&this._onDestroyHooks.splice(c,1)}};function eE(o){let i=rv(o),c=i!==null?i.factory:of(o);if(c!==null)return c;if(o instanceof gn)throw new gt(204,!1);if(o instanceof Function)return V5(o);throw new gt(204,!1)}function V5(o){if(o.length>0)throw new gt(204,!1);let c=n5(o);return c!==null?()=>c.factory(o):()=>new o}function j5(o){if(H2(o))return Jd(void 0,o.useValue);{let i=W2(o);return Jd(i,R0)}}function W2(o,i,c){let h;if(af(o)){let m=ji(o);return of(m)||eE(m)}else if(H2(o))h=()=>ji(o.useValue);else if(z5(o))h=()=>o.useFactory(...Kw(o.deps||[]));else if(N5(o))h=()=>cn(ji(o.useExisting));else{let m=ji(o&&(o.useClass||o.provide));if($5(o))h=()=>new m(...Kw(o.deps));else return of(m)||eE(m)}return h}function Jd(o,i,c=!1){return{factory:o,value:i,multi:c?[]:void 0}}function $5(o){return!!o.deps}function G5(o){return o!==null&&typeof o=="object"&&typeof o.ngOnDestroy=="function"}function q5(o){return typeof o=="function"||typeof o=="object"&&o instanceof gn}function tE(o,i){for(let c of o)Array.isArray(c)?tE(c,i):c&&M2(c)?tE(c.\u0275providers,i):i(c)}function Qa(o,i){o instanceof Gm&&o.assertNotDestroyed();let c,h=mc(o),m=$o(void 0);try{return i()}finally{mc(h),$o(m)}}function H5(){return A2()!==void 0||p5()!=null}function W5(o){return typeof o=="function"}var Ja=0,Gn=1,mn=2,Fi=3,gs=4,vs=5,V0=6,qm=7,_s=8,lf=9,ys=10,Ii=11,Hm=12,XA=13,pf=14,oa=15,sv=16,ef=17,cf=18,av=19,Z2=20,_c=21,zw=22,eh=23,sa=25,Y2=1;var th=7,j0=8,$0=9,Go=10,UE=function(o){return o[o.None=0]="None",o[o.HasTransplantedViews=2]="HasTransplantedViews",o}(UE||{});function Ku(o){return Array.isArray(o)&&typeof o[Y2]=="object"}function el(o){return Array.isArray(o)&&o[Y2]===!0}function VE(o){return(o.flags&4)!==0}function lv(o){return o.componentOffset>-1}function cv(o){return(o.flags&1)===1}function mf(o){return!!o.template}function Z5(o){return(o[mn]&512)!==0}var nE=class{constructor(i,c,h){this.previousValue=i,this.currentValue=c,this.firstChange=h}isFirstChange(){return this.firstChange}};function X2(o,i,c,h){i!==null?i.applyValueToInputSignal(i,h):o[c]=h}function eg(){return K2}function K2(o){return o.type.prototype.ngOnChanges&&(o.setInput=X5),Y5}eg.ngInherit=!0;function Y5(){let o=J2(this),i=o?.current;if(i){let c=o.previous;if(c===$m)o.previous=i;else for(let h in i)c[h]=i[h];o.current=null,this.ngOnChanges(i)}}function X5(o,i,c,h,m){let r=this.declaredInputs[h],E=J2(o)||K5(o,{previous:$m,current:null}),C=E.current||(E.current={}),O=E.previous,z=O[r];C[r]=new nE(z&&z.currentValue,c,O===$m),X2(o,i,m,c)}var Q2="__ngSimpleChanges__";function J2(o){return o[Q2]||null}function K5(o,i){return o[Q2]=i}var KA=null;var ta=function(o,i,c){KA?.(o,i,c)},Q5="svg",J5="math",e4=!1;function t4(){return e4}function aa(o){for(;Array.isArray(o);)o=o[Ja];return o}function n4(o,i){return aa(i[o])}function xs(o,i){return aa(i[o.index])}function eP(o,i){return o.data[i]}function r4(o,i){return o[i]}function Tc(o,i){let c=i[o];return Ku(c)?c:c[Ja]}function jE(o){return(o[mn]&128)===128}function i4(o){return el(o[Fi])}function uf(o,i){return i==null?null:o[i]}function tP(o){o[ef]=0}function o4(o){o[mn]&1024||(o[mn]|=1024,jE(o)&&Wm(o))}function s4(o,i){for(;o>0;)i=i[pf],o--;return i}function $E(o){return!!(o[mn]&9216||o[eh]?.dirty)}function rE(o){o[ys].changeDetectionScheduler?.notify(1),$E(o)?Wm(o):o[mn]&64&&(t4()?(o[mn]|=1024,Wm(o)):o[ys].changeDetectionScheduler?.notify())}function Wm(o){o[ys].changeDetectionScheduler?.notify();let i=Zm(o);for(;i!==null&&!(i[mn]&8192||(i[mn]|=8192,!jE(i)));)i=Zm(i)}function nP(o,i){if((o[mn]&256)===256)throw new gt(911,!1);o[_c]===null&&(o[_c]=[]),o[_c].push(i)}function a4(o,i){if(o[_c]===null)return;let c=o[_c].indexOf(i);c!==-1&&o[_c].splice(c,1)}function Zm(o){let i=o[Fi];return el(i)?i[Fi]:i}var Bn={lFrame:dP(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function l4(){return Bn.lFrame.elementDepthCount}function c4(){Bn.lFrame.elementDepthCount++}function u4(){Bn.lFrame.elementDepthCount--}function rP(){return Bn.bindingsEnabled}function h4(){return Bn.skipHydrationRootTNode!==null}function d4(o){return Bn.skipHydrationRootTNode===o}function f4(){Bn.skipHydrationRootTNode=null}function br(){return Bn.lFrame.lView}function qo(){return Bn.lFrame.tView}function sh(o){return Bn.lFrame.contextLView=o,o[_s]}function ah(o){return Bn.lFrame.contextLView=null,o}function To(){let o=iP();for(;o!==null&&o.type===64;)o=o.parent;return o}function iP(){return Bn.lFrame.currentTNode}function p4(){let o=Bn.lFrame,i=o.currentTNode;return o.isParent?i:i.parent}function lh(o,i){let c=Bn.lFrame;c.currentTNode=o,c.isParent=i}function GE(){return Bn.lFrame.isParent}function oP(){Bn.lFrame.isParent=!1}function m4(){return Bn.lFrame.contextLView}function g4(){let o=Bn.lFrame,i=o.bindingRootIndex;return i===-1&&(i=o.bindingRootIndex=o.tView.bindingStartIndex),i}function sP(){return Bn.lFrame.bindingIndex}function _4(o){return Bn.lFrame.bindingIndex=o}function aP(){return Bn.lFrame.bindingIndex++}function lP(o){let i=Bn.lFrame,c=i.bindingIndex;return i.bindingIndex=i.bindingIndex+o,c}function y4(){return Bn.lFrame.inI18n}function v4(o,i){let c=Bn.lFrame;c.bindingIndex=c.bindingRootIndex=o,iE(i)}function x4(){return Bn.lFrame.currentDirectiveIndex}function iE(o){Bn.lFrame.currentDirectiveIndex=o}function cP(o){Bn.lFrame.currentQueryIndex=o}function b4(o){let i=o[Gn];return i.type===2?i.declTNode:i.type===1?o[vs]:null}function uP(o,i,c){if(c&zn.SkipSelf){let m=i,r=o;for(;m=m.parent,m===null&&!(c&zn.Host);)if(m=b4(r),m===null||(r=r[pf],m.type&10))break;if(m===null)return!1;i=m,o=r}let h=Bn.lFrame=hP();return h.currentTNode=i,h.lView=o,!0}function qE(o){let i=hP(),c=o[Gn];Bn.lFrame=i,i.currentTNode=c.firstChild,i.lView=o,i.tView=c,i.contextLView=o,i.bindingIndex=c.bindingStartIndex,i.inI18n=!1}function hP(){let o=Bn.lFrame,i=o===null?null:o.child;return i===null?dP(o):i}function dP(o){let i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:o,child:null,inI18n:!1};return o!==null&&(o.child=i),i}function fP(){let o=Bn.lFrame;return Bn.lFrame=o.parent,o.currentTNode=null,o.lView=null,o}var pP=fP;function HE(){let o=fP();o.isParent=!0,o.tView=null,o.selectedIndex=-1,o.contextLView=null,o.elementDepthCount=0,o.currentDirectiveIndex=-1,o.currentNamespace=null,o.bindingRootIndex=-1,o.bindingIndex=-1,o.currentQueryIndex=0}function w4(o){return(Bn.lFrame.contextLView=s4(o,Bn.lFrame.contextLView))[_s]}function tg(){return Bn.lFrame.selectedIndex}function nh(o){Bn.lFrame.selectedIndex=o}function mP(){let o=Bn.lFrame;return eP(o.tView,o.selectedIndex)}function E4(){return Bn.lFrame.currentNamespace}var gP=!0;function uv(){return gP}function hv(o){gP=o}function T4(o,i,c){let{ngOnChanges:h,ngOnInit:m,ngDoCheck:r}=i.type.prototype;if(h){let E=K2(i);(c.preOrderHooks??=[]).push(o,E),(c.preOrderCheckHooks??=[]).push(o,E)}m&&(c.preOrderHooks??=[]).push(0-o,m),r&&((c.preOrderHooks??=[]).push(o,r),(c.preOrderCheckHooks??=[]).push(o,r))}function dv(o,i){for(let c=i.directiveStart,h=i.directiveEnd;c<h;c++){let r=o.data[c].type.prototype,{ngAfterContentInit:E,ngAfterContentChecked:C,ngAfterViewInit:O,ngAfterViewChecked:z,ngOnDestroy:Z}=r;E&&(o.contentHooks??=[]).push(-c,E),C&&((o.contentHooks??=[]).push(c,C),(o.contentCheckHooks??=[]).push(c,C)),O&&(o.viewHooks??=[]).push(-c,O),z&&((o.viewHooks??=[]).push(c,z),(o.viewCheckHooks??=[]).push(c,z)),Z!=null&&(o.destroyHooks??=[]).push(c,Z)}}function O0(o,i,c){_P(o,i,3,c)}function L0(o,i,c,h){(o[mn]&3)===c&&_P(o,i,c,h)}function Bw(o,i){let c=o[mn];(c&3)===i&&(c&=16383,c+=1,o[mn]=c)}function _P(o,i,c,h){let m=h!==void 0?o[ef]&65535:0,r=h??-1,E=i.length-1,C=0;for(let O=m;O<E;O++)if(typeof i[O+1]=="number"){if(C=i[O],h!=null&&C>=h)break}else i[O]<0&&(o[ef]+=65536),(C<r||r==-1)&&(I4(o,c,i,O),o[ef]=(o[ef]&4294901760)+O+2),O++}function QA(o,i){ta(4,o,i);let c=nr(null);try{i.call(o)}finally{nr(c),ta(5,o,i)}}function I4(o,i,c,h){let m=c[h]<0,r=c[h+1],E=m?-c[h]:c[h],C=o[E];m?o[mn]>>14<o[ef]>>16&&(o[mn]&3)===i&&(o[mn]+=16384,QA(C,r)):QA(C,r)}var rf=-1,rh=class{constructor(i,c,h){this.factory=i,this.resolving=!1,this.canSeeViewProviders=c,this.injectImpl=h}};function D4(o){return o instanceof rh}function S4(o){return(o.flags&8)!==0}function C4(o){return(o.flags&16)!==0}function yP(o){return o!==rf}function G0(o){return o&32767}function M4(o){return o>>16}function q0(o,i){let c=M4(o),h=i;for(;c>0;)h=h[pf],c--;return h}var oE=!0;function JA(o){let i=oE;return oE=o,i}var A4=256,vP=A4-1,xP=5,P4=0,na={};function R4(o,i,c){let h;typeof c=="string"?h=c.charCodeAt(0)||0:c.hasOwnProperty(Vm)&&(h=c[Vm]),h==null&&(h=c[Vm]=P4++);let m=h&vP,r=1<<m;i.data[o+(m>>xP)]|=r}function H0(o,i){let c=bP(o,i);if(c!==-1)return c;let h=i[Gn];h.firstCreatePass&&(o.injectorIndex=i.length,Uw(h.data,o),Uw(i,null),Uw(h.blueprint,null));let m=WE(o,i),r=o.injectorIndex;if(yP(m)){let E=G0(m),C=q0(m,i),O=C[Gn].data;for(let z=0;z<8;z++)i[r+z]=C[E+z]|O[E+z]}return i[r+8]=m,r}function Uw(o,i){o.push(0,0,0,0,0,0,0,0,i)}function bP(o,i){return o.injectorIndex===-1||o.parent&&o.parent.injectorIndex===o.injectorIndex||i[o.injectorIndex+8]===null?-1:o.injectorIndex}function WE(o,i){if(o.parent&&o.parent.injectorIndex!==-1)return o.parent.injectorIndex;let c=0,h=null,m=i;for(;m!==null;){if(h=DP(m),h===null)return rf;if(c++,m=m[pf],h.injectorIndex!==-1)return h.injectorIndex|c<<16}return rf}function sE(o,i,c){R4(o,i,c)}function wP(o,i,c){if(c&zn.Optional||o!==void 0)return o;LE(i,"NodeInjector")}function EP(o,i,c,h){if(c&zn.Optional&&h===void 0&&(h=null),!(c&(zn.Self|zn.Host))){let m=o[lf],r=$o(void 0);try{return m?m.get(i,h,c&zn.Optional):P2(i,h,c&zn.Optional)}finally{$o(r)}}return wP(h,i,c)}function TP(o,i,c,h=zn.Default,m){if(o!==null){if(i[mn]&2048&&!(h&zn.Self)){let E=N4(o,i,c,h,na);if(E!==na)return E}let r=IP(o,i,c,h,na);if(r!==na)return r}return EP(i,c,h,m)}function IP(o,i,c,h,m){let r=k4(c);if(typeof r=="function"){if(!uP(i,o,h))return h&zn.Host?wP(m,c,h):EP(i,c,h,m);try{let E;if(E=r(h),E==null&&!(h&zn.Optional))LE(c);else return E}finally{pP()}}else if(typeof r=="number"){let E=null,C=bP(o,i),O=rf,z=h&zn.Host?i[oa][vs]:null;for((C===-1||h&zn.SkipSelf)&&(O=C===-1?WE(o,i):i[C+8],O===rf||!t2(h,!1)?C=-1:(E=i[Gn],C=G0(O),i=q0(O,i)));C!==-1;){let Z=i[Gn];if(e2(r,C,Z.data)){let ce=O4(C,i,c,E,h,z);if(ce!==na)return ce}O=i[C+8],O!==rf&&t2(h,i[Gn].data[C+8]===z)&&e2(r,C,i)?(E=Z,C=G0(O),i=q0(O,i)):C=-1}}return m}function O4(o,i,c,h,m,r){let E=i[Gn],C=E.data[o+8],O=h==null?lv(C)&&oE:h!=E&&(C.type&3)!==0,z=m&zn.Host&&r===C,Z=L4(C,E,c,O,z);return Z!==null?hf(i,E,Z,C):na}function L4(o,i,c,h,m){let r=o.providerIndexes,E=i.data,C=r&1048575,O=o.directiveStart,z=o.directiveEnd,Z=r>>20,ce=h?C:C+Z,Ie=m?C+Z:z;for(let be=ce;be<Ie;be++){let qe=E[be];if(be<O&&c===qe||be>=O&&qe.type===c)return be}if(m){let be=E[O];if(be&&mf(be)&&be.type===c)return O}return null}function hf(o,i,c,h){let m=o[c],r=i.data;if(D4(m)){let E=m;E.resolving&&c5(l5(r[c]));let C=JA(E.canSeeViewProviders);E.resolving=!0;let O,z=E.injectImpl?$o(E.injectImpl):null,Z=uP(o,h,zn.Default);try{m=o[c]=E.factory(void 0,r,o,h),i.firstCreatePass&&c>=h.directiveStart&&T4(c,r[c],i)}finally{z!==null&&$o(z),JA(C),E.resolving=!1,pP()}}return m}function k4(o){if(typeof o=="string")return o.charCodeAt(0)||0;let i=o.hasOwnProperty(Vm)?o[Vm]:void 0;return typeof i=="number"?i>=0?i&vP:F4:i}function e2(o,i,c){let h=1<<o;return!!(c[i+(o>>xP)]&h)}function t2(o,i){return!(o&zn.Self)&&!(o&zn.Host&&i)}var Qu=class{constructor(i,c){this._tNode=i,this._lView=c}get(i,c,h){return TP(this._tNode,this._lView,i,iv(h),c)}};function F4(){return new Qu(To(),br())}function ZE(o){return Qm(()=>{let i=o.prototype.constructor,c=i[N0]||aE(i),h=Object.prototype,m=Object.getPrototypeOf(o.prototype).constructor;for(;m&&m!==h;){let r=m[N0]||aE(m);if(r&&r!==c)return r;m=Object.getPrototypeOf(m)}return r=>new r})}function aE(o){return I2(o)?()=>{let i=aE(ji(o));return i&&i()}:of(o)}function N4(o,i,c,h,m){let r=o,E=i;for(;r!==null&&E!==null&&E[mn]&2048&&!(E[mn]&512);){let C=IP(r,E,c,h|zn.Self,na);if(C!==na)return C;let O=r.parent;if(!O){let z=E[Z2];if(z){let Z=z.get(c,na,h);if(Z!==na)return Z}O=DP(E),E=E[pf]}r=O}return m}function DP(o){let i=o[Gn],c=i.type;return c===2?i.declTNode:c===1?o[vs]:null}function n2(o,i=null,c=null,h){let m=SP(o,i,c,h);return m.resolveInjectorInitializers(),m}function SP(o,i=null,c=null,h,m=new Set){let r=[c||ea,k5(o)];return h=h||(typeof o=="object"?void 0:oo(o)),new Gm(r,i||BE(),h||null,m)}var ng=(()=>{let i=class i{static create(h,m){if(Array.isArray(h))return n2({name:""},m,h,"");{let r=h.name??"";return n2({name:r},h.parent,h.providers,r)}}};i.THROW_IF_NOT_FOUND=jm,i.NULL=new U0,i.\u0275prov=jt({token:i,providedIn:"any",factory:()=>cn(L2)}),i.__NG_ELEMENT_ID__=-1;let o=i;return o})();var z4="ngOriginalError";function Vw(o){return o[z4]}var Ka=class{constructor(){this._console=console}handleError(i){let c=this._findOriginalError(i);this._console.error("ERROR",i),c&&this._console.error("ORIGINAL ERROR",c)}_findOriginalError(i){let c=i&&Vw(i);for(;c&&Vw(c);)c=Vw(c);return c||null}},CP=new gn("",{providedIn:"root",factory:()=>Et(Ka).handleError.bind(void 0)}),MP=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=B4,i.__NG_ENV_ID__=h=>h;let o=i;return o})(),lE=class extends MP{constructor(i){super(),this._lView=i}onDestroy(i){return nP(this._lView,i),()=>a4(this._lView,i)}};function B4(){return new lE(br())}function U4(){return fv(To(),br())}function fv(o,i){return new ch(xs(o,i))}var ch=(()=>{let i=class i{constructor(h){this.nativeElement=h}};i.__NG_ELEMENT_ID__=U4;let o=i;return o})();var cE=class extends Ti{constructor(i=!1){super(),this.destroyRef=void 0,this.__isAsync=i,H5()&&(this.destroyRef=Et(MP,{optional:!0})??void 0)}emit(i){let c=nr(null);try{super.next(i)}finally{nr(c)}}subscribe(i,c,h){let m=i,r=c||(()=>null),E=h;if(i&&typeof i=="object"){let O=i;m=O.next?.bind(O),r=O.error?.bind(O),E=O.complete?.bind(O)}this.__isAsync&&(r=jw(r),m&&(m=jw(m)),E&&(E=jw(E)));let C=super.subscribe({next:m,error:r,complete:E});return i instanceof ai&&i.add(C),C}};function jw(o){return i=>{setTimeout(o,void 0,i)}}var $i=cE;function AP(o){return(o.flags&128)===128}var PP=new Map,V4=0;function j4(){return V4++}function $4(o){PP.set(o[av],o)}function G4(o){PP.delete(o[av])}var r2="__ngContext__";function yc(o,i){Ku(i)?(o[r2]=i[av],$4(i)):o[r2]=i}function RP(o){return LP(o[Hm])}function OP(o){return LP(o[gs])}function LP(o){for(;o!==null&&!el(o);)o=o[gs];return o}var uE;function kP(o){uE=o}function q4(){if(uE!==void 0)return uE;if(typeof document<"u")return document;throw new gt(210,!1)}var YE=new gn("",{providedIn:"root",factory:()=>H4}),H4="ng",XE=new gn(""),Ic=new gn("",{providedIn:"platform",factory:()=>"unknown"});var KE=new gn(""),QE=new gn("",{providedIn:"root",factory:()=>q4().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var W4="h",Z4="b";var Y4=()=>null;function JE(o,i,c=!1){return Y4(o,i,c)}var FP=!1,X4=new gn("",{providedIn:"root",factory:()=>FP});var W0=class{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${w2})`}};function eT(o){return o instanceof W0?o.changingThisBreaksApplicationSecurity:o}function NP(o,i){let c=K4(o);if(c!=null&&c!==i){if(c==="ResourceURL"&&i==="URL")return!0;throw new Error(`Required a safe ${i}, got a ${c} (see ${w2})`)}return c===i}function K4(o){return o instanceof W0&&o.getTypeName()||null}var Q4=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function zP(o){return o=String(o),o.match(Q4)?o:"unsafe:"+o}var tT=function(o){return o[o.NONE=0]="NONE",o[o.HTML=1]="HTML",o[o.STYLE=2]="STYLE",o[o.SCRIPT=3]="SCRIPT",o[o.URL=4]="URL",o[o.RESOURCE_URL=5]="RESOURCE_URL",o}(tT||{});function BP(o){let i=J4();return i?i.sanitize(tT.URL,o)||"":NP(o,"URL")?eT(o):zP(gc(o))}function J4(){let o=br();return o&&o[ys].sanitizer}var eU=/^>|^->|<!--|-->|--!>|<!-$/g,tU=/(<|>)/g,nU="\u200B$1\u200B";function rU(o){return o.replace(eU,i=>i.replace(tU,nU))}function UP(o){return o instanceof Function?o():o}var Dc=function(o){return o[o.Important=1]="Important",o[o.DashCase=2]="DashCase",o}(Dc||{}),iU;function nT(o,i){return iU(o,i)}function tf(o,i,c,h,m){if(h!=null){let r,E=!1;el(h)?r=h:Ku(h)&&(E=!0,h=h[Ja]);let C=aa(h);o===0&&c!==null?m==null?qP(i,c,C):Z0(i,c,C,m||null,!0):o===1&&c!==null?Z0(i,c,C,m||null,!0):o===2?wU(i,C,E):o===3&&i.destroyNode(C),r!=null&&TU(i,o,r,c,m)}}function oU(o,i){return o.createText(i)}function sU(o,i,c){o.setValue(i,c)}function aU(o,i){return o.createComment(rU(i))}function VP(o,i,c){return o.createElement(i,c)}function lU(o,i){jP(o,i),i[Ja]=null,i[vs]=null}function cU(o,i,c,h,m,r){h[Ja]=m,h[vs]=i,mv(o,h,c,1,m,r)}function jP(o,i){i[ys].changeDetectionScheduler?.notify(1),mv(o,i,i[Ii],2,null,null)}function uU(o){let i=o[Hm];if(!i)return $w(o[Gn],o);for(;i;){let c=null;if(Ku(i))c=i[Hm];else{let h=i[Go];h&&(c=h)}if(!c){for(;i&&!i[gs]&&i!==o;)Ku(i)&&$w(i[Gn],i),i=i[Fi];i===null&&(i=o),Ku(i)&&$w(i[Gn],i),c=i&&i[gs]}i=c}}function hU(o,i,c,h){let m=Go+h,r=c.length;h>0&&(c[m-1][gs]=i),h<r-Go?(i[gs]=c[m],O2(c,Go+h,i)):(c.push(i),i[gs]=null),i[Fi]=c;let E=i[sv];E!==null&&c!==E&&dU(E,i);let C=i[cf];C!==null&&C.insertView(o),rE(i),i[mn]|=128}function dU(o,i){let c=o[$0],m=i[Fi][Fi][oa];i[oa]!==m&&(o[mn]|=UE.HasTransplantedViews),c===null?o[$0]=[i]:c.push(i)}function $P(o,i){let c=o[$0],h=c.indexOf(i);c.splice(h,1)}function hE(o,i){if(o.length<=Go)return;let c=Go+i,h=o[c];if(h){let m=h[sv];m!==null&&m!==o&&$P(m,h),i>0&&(o[c-1][gs]=h[gs]);let r=B0(o,Go+i);lU(h[Gn],h);let E=r[cf];E!==null&&E.detachView(r[Gn]),h[Fi]=null,h[gs]=null,h[mn]&=-129}return h}function GP(o,i){if(!(i[mn]&256)){let c=i[Ii];c.destroyNode&&mv(o,i,c,3,null,null),uU(i)}}function $w(o,i){if(i[mn]&256)return;let c=nr(null);try{i[mn]&=-129,i[mn]|=256,i[eh]&&uA(i[eh]),pU(o,i),fU(o,i),i[Gn].type===1&&i[Ii].destroy();let h=i[sv];if(h!==null&&el(i[Fi])){h!==i[Fi]&&$P(h,i);let m=i[cf];m!==null&&m.detachView(o)}G4(i)}finally{nr(c)}}function fU(o,i){let c=o.cleanup,h=i[qm];if(c!==null)for(let r=0;r<c.length-1;r+=2)if(typeof c[r]=="string"){let E=c[r+3];E>=0?h[E]():h[-E].unsubscribe(),r+=2}else{let E=h[c[r+1]];c[r].call(E)}h!==null&&(i[qm]=null);let m=i[_c];if(m!==null){i[_c]=null;for(let r=0;r<m.length;r++){let E=m[r];E()}}}function pU(o,i){let c;if(o!=null&&(c=o.destroyHooks)!=null)for(let h=0;h<c.length;h+=2){let m=i[c[h]];if(!(m instanceof rh)){let r=c[h+1];if(Array.isArray(r))for(let E=0;E<r.length;E+=2){let C=m[r[E]],O=r[E+1];ta(4,C,O);try{O.call(C)}finally{ta(5,C,O)}}else{ta(4,m,r);try{r.call(m)}finally{ta(5,m,r)}}}}}function mU(o,i,c){return gU(o,i.parent,c)}function gU(o,i,c){let h=i;for(;h!==null&&h.type&40;)i=h,h=i.parent;if(h===null)return c[Ja];{let{componentOffset:m}=h;if(m>-1){let{encapsulation:r}=o.data[h.directiveStart+m];if(r===ra.None||r===ra.Emulated)return null}return xs(h,c)}}function Z0(o,i,c,h,m){o.insertBefore(i,c,h,m)}function qP(o,i,c){o.appendChild(i,c)}function i2(o,i,c,h,m){h!==null?Z0(o,i,c,h,m):qP(o,i,c)}function _U(o,i,c,h){o.removeChild(i,c,h)}function rT(o,i){return o.parentNode(i)}function yU(o,i){return o.nextSibling(i)}function vU(o,i,c){return bU(o,i,c)}function xU(o,i,c){return o.type&40?xs(o,c):null}var bU=xU,o2;function pv(o,i,c,h){let m=mU(o,h,i),r=i[Ii],E=h.parent||i[vs],C=vU(E,h,i);if(m!=null)if(Array.isArray(c))for(let O=0;O<c.length;O++)i2(r,m,c[O],C,!1);else i2(r,m,c,C,!1);o2!==void 0&&o2(r,h,i,c,m)}function k0(o,i){if(i!==null){let c=i.type;if(c&3)return xs(i,o);if(c&4)return dE(-1,o[i.index]);if(c&8){let h=i.child;if(h!==null)return k0(o,h);{let m=o[i.index];return el(m)?dE(-1,m):aa(m)}}else{if(c&32)return nT(i,o)()||aa(o[i.index]);{let h=HP(o,i);if(h!==null){if(Array.isArray(h))return h[0];let m=Zm(o[oa]);return k0(m,h)}else return k0(o,i.next)}}}return null}function HP(o,i){if(i!==null){let h=o[oa][vs],m=i.projection;return h.projection[m]}return null}function dE(o,i){let c=Go+o+1;if(c<i.length){let h=i[c],m=h[Gn].firstChild;if(m!==null)return k0(h,m)}return i[th]}function wU(o,i,c){let h=rT(o,i);h&&_U(o,h,i,c)}function iT(o,i,c,h,m,r,E){for(;c!=null;){let C=h[c.index],O=c.type;if(E&&i===0&&(C&&yc(aa(C),h),c.flags|=2),(c.flags&32)!==32)if(O&8)iT(o,i,c.child,h,m,r,!1),tf(i,o,m,C,r);else if(O&32){let z=nT(c,h),Z;for(;Z=z();)tf(i,o,m,Z,r);tf(i,o,m,C,r)}else O&16?EU(o,i,h,c,m,r):tf(i,o,m,C,r);c=E?c.projectionNext:c.next}}function mv(o,i,c,h,m,r){iT(c,h,o.firstChild,i,m,r,!1)}function EU(o,i,c,h,m,r){let E=c[oa],O=E[vs].projection[h.projection];if(Array.isArray(O))for(let z=0;z<O.length;z++){let Z=O[z];tf(i,o,m,Z,r)}else{let z=O,Z=E[Fi];AP(h)&&(z.flags|=128),iT(o,i,z,Z,m,r,!0)}}function TU(o,i,c,h,m){let r=c[th],E=aa(c);r!==E&&tf(i,o,h,r,m);for(let C=Go;C<c.length;C++){let O=c[C];mv(O[Gn],O,o,i,h,r)}}function IU(o,i,c){o.setAttribute(i,"style",c)}function WP(o,i,c){c===""?o.removeAttribute(i,"class"):o.setAttribute(i,"class",c)}function ZP(o,i,c){let{mergedAttrs:h,classes:m,styles:r}=c;h!==null&&Qw(o,i,h),m!==null&&WP(o,i,m),r!==null&&IU(o,i,r)}var la={};function hr(o=1){YP(qo(),br(),tg()+o,!1)}function YP(o,i,c,h){if(!h)if((i[mn]&3)===3){let r=o.preOrderCheckHooks;r!==null&&O0(i,r,c)}else{let r=o.preOrderHooks;r!==null&&L0(i,r,0,c)}nh(c)}function gr(o,i=zn.Default){let c=br();if(c===null)return cn(o,i);let h=To();return TP(h,c,ji(o),i)}function XP(o,i,c,h,m,r){let E=nr(null);try{let C=null;m&ia.SignalBased&&(C=i[h][sA]),C!==null&&C.transformFn!==void 0&&(r=C.transformFn(r)),m&ia.HasDecoratorInputTransform&&(r=o.inputTransforms[h].call(i,r)),o.setInput!==null?o.setInput(i,C,r,c,h):X2(i,C,h,r)}finally{nr(E)}}function DU(o,i){let c=o.hostBindingOpCodes;if(c!==null)try{for(let h=0;h<c.length;h++){let m=c[h];if(m<0)nh(~m);else{let r=m,E=c[++h],C=c[++h];v4(E,r);let O=i[r];C(2,O)}}}finally{nh(-1)}}function gv(o,i,c,h,m,r,E,C,O,z,Z){let ce=i.blueprint.slice();return ce[Ja]=m,ce[mn]=h|4|128|8|64,(z!==null||o&&o[mn]&2048)&&(ce[mn]|=2048),tP(ce),ce[Fi]=ce[pf]=o,ce[_s]=c,ce[ys]=E||o&&o[ys],ce[Ii]=C||o&&o[Ii],ce[lf]=O||o&&o[lf]||null,ce[vs]=r,ce[av]=j4(),ce[V0]=Z,ce[Z2]=z,ce[oa]=i.type==2?o[oa]:ce,ce}function rg(o,i,c,h,m){let r=o.data[i];if(r===null)r=SU(o,i,c,h,m),y4()&&(r.flags|=32);else if(r.type&64){r.type=c,r.value=h,r.attrs=m;let E=p4();r.injectorIndex=E===null?-1:E.injectorIndex}return lh(r,!0),r}function SU(o,i,c,h,m){let r=iP(),E=GE(),C=E?r:r&&r.parent,O=o.data[i]=RU(o,C,c,i,h,m);return o.firstChild===null&&(o.firstChild=O),r!==null&&(E?r.child==null&&O.parent!==null&&(r.child=O):r.next===null&&(r.next=O,O.prev=r)),O}function KP(o,i,c,h){if(c===0)return-1;let m=i.length;for(let r=0;r<c;r++)i.push(h),o.blueprint.push(h),o.data.push(null);return m}function QP(o,i,c,h,m){let r=tg(),E=h&2;try{nh(-1),E&&i.length>sa&&YP(o,i,sa,!1),ta(E?2:0,m),c(h,m)}finally{nh(r),ta(E?3:1,m)}}function oT(o,i,c){if(VE(i)){let h=nr(null);try{let m=i.directiveStart,r=i.directiveEnd;for(let E=m;E<r;E++){let C=o.data[E];if(C.contentQueries){let O=c[E];C.contentQueries(1,O,E)}}}finally{nr(h)}}}function sT(o,i,c){rP()&&(zU(o,i,c,xs(c,i)),(c.flags&64)===64&&nR(o,i,c))}function aT(o,i,c=xs){let h=i.localNames;if(h!==null){let m=i.index+1;for(let r=0;r<h.length;r+=2){let E=h[r+1],C=E===-1?c(i,o):o[E];o[m++]=C}}}function JP(o){let i=o.tView;return i===null||i.incompleteFirstPass?o.tView=lT(1,null,o.template,o.decls,o.vars,o.directiveDefs,o.pipeDefs,o.viewQuery,o.schemas,o.consts,o.id):i}function lT(o,i,c,h,m,r,E,C,O,z,Z){let ce=sa+h,Ie=ce+m,be=CU(ce,Ie),qe=typeof z=="function"?z():z;return be[Gn]={type:o,blueprint:be,template:c,queries:null,viewQuery:C,declTNode:i,data:be.slice().fill(null,ce),bindingStartIndex:ce,expandoStartIndex:Ie,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof E=="function"?E():E,firstChild:null,schemas:O,consts:qe,incompleteFirstPass:!1,ssrId:Z}}function CU(o,i){let c=[];for(let h=0;h<i;h++)c.push(h<o?null:la);return c}function MU(o,i,c,h){let r=h.get(X4,FP)||c===ra.ShadowDom,E=o.selectRootElement(i,r);return AU(E),E}function AU(o){PU(o)}var PU=()=>null;function RU(o,i,c,h,m,r){let E=i?i.injectorIndex:-1,C=0;return h4()&&(C|=128),{type:c,index:h,insertBeforeIndex:null,injectorIndex:E,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:C,providerIndexes:0,value:m,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function s2(o,i,c,h,m){for(let r in i){if(!i.hasOwnProperty(r))continue;let E=i[r];if(E===void 0)continue;h??={};let C,O=ia.None;Array.isArray(E)?(C=E[0],O=E[1]):C=E;let z=r;if(m!==null){if(!m.hasOwnProperty(r))continue;z=m[r]}o===0?a2(h,c,z,C,O):a2(h,c,z,C)}return h}function a2(o,i,c,h,m){let r;o.hasOwnProperty(c)?(r=o[c]).push(i,h):r=o[c]=[i,h],m!==void 0&&r.push(m)}function OU(o,i,c){let h=i.directiveStart,m=i.directiveEnd,r=o.data,E=i.attrs,C=[],O=null,z=null;for(let Z=h;Z<m;Z++){let ce=r[Z],Ie=c?c.get(ce):null,be=Ie?Ie.inputs:null,qe=Ie?Ie.outputs:null;O=s2(0,ce.inputs,Z,O,be),z=s2(1,ce.outputs,Z,z,qe);let ot=O!==null&&E!==null&&!NE(i)?WU(O,Z,E):null;C.push(ot)}O!==null&&(O.hasOwnProperty("class")&&(i.flags|=8),O.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=C,i.inputs=O,i.outputs=z}function LU(o){return o==="class"?"className":o==="for"?"htmlFor":o==="formaction"?"formAction":o==="innerHtml"?"innerHTML":o==="readonly"?"readOnly":o==="tabindex"?"tabIndex":o}function eR(o,i,c,h,m,r,E,C){let O=xs(i,c),z=i.inputs,Z;!C&&z!=null&&(Z=z[h])?(uT(o,c,Z,h,m),lv(i)&&kU(c,i.index)):i.type&3?(h=LU(h),m=E!=null?E(m,i.value||"",h):m,r.setProperty(O,h,m)):i.type&12}function kU(o,i){let c=Tc(i,o);c[mn]&16||(c[mn]|=64)}function cT(o,i,c,h){if(rP()){let m=h===null?null:{"":-1},r=UU(o,c),E,C;r===null?E=C=null:[E,C]=r,E!==null&&tR(o,i,c,E,m,C),m&&VU(c,h,m)}c.mergedAttrs=FE(c.mergedAttrs,c.attrs)}function tR(o,i,c,h,m,r){for(let z=0;z<h.length;z++)sE(H0(c,i),o,h[z].type);$U(c,o.data.length,h.length);for(let z=0;z<h.length;z++){let Z=h[z];Z.providersResolver&&Z.providersResolver(Z)}let E=!1,C=!1,O=KP(o,i,h.length,null);for(let z=0;z<h.length;z++){let Z=h[z];c.mergedAttrs=FE(c.mergedAttrs,Z.hostAttrs),GU(o,c,i,O,Z),jU(O,Z,m),Z.contentQueries!==null&&(c.flags|=4),(Z.hostBindings!==null||Z.hostAttrs!==null||Z.hostVars!==0)&&(c.flags|=64);let ce=Z.type.prototype;!E&&(ce.ngOnChanges||ce.ngOnInit||ce.ngDoCheck)&&((o.preOrderHooks??=[]).push(c.index),E=!0),!C&&(ce.ngOnChanges||ce.ngDoCheck)&&((o.preOrderCheckHooks??=[]).push(c.index),C=!0),O++}OU(o,c,r)}function FU(o,i,c,h,m){let r=m.hostBindings;if(r){let E=o.hostBindingOpCodes;E===null&&(E=o.hostBindingOpCodes=[]);let C=~i.index;NU(E)!=C&&E.push(C),E.push(c,h,r)}}function NU(o){let i=o.length;for(;i>0;){let c=o[--i];if(typeof c=="number"&&c<0)return c}return 0}function zU(o,i,c,h){let m=c.directiveStart,r=c.directiveEnd;lv(c)&&qU(i,c,o.data[m+c.componentOffset]),o.firstCreatePass||H0(c,i),yc(h,i);let E=c.initialInputs;for(let C=m;C<r;C++){let O=o.data[C],z=hf(i,o,C,c);if(yc(z,i),E!==null&&HU(i,C-m,z,O,c,E),mf(O)){let Z=Tc(c.index,i);Z[_s]=hf(i,o,C,c)}}}function nR(o,i,c){let h=c.directiveStart,m=c.directiveEnd,r=c.index,E=x4();try{nh(r);for(let C=h;C<m;C++){let O=o.data[C],z=i[C];iE(C),(O.hostBindings!==null||O.hostVars!==0||O.hostAttrs!==null)&&BU(O,z)}}finally{nh(-1),iE(E)}}function BU(o,i){o.hostBindings!==null&&o.hostBindings(1,i)}function UU(o,i){let c=o.directiveRegistry,h=null,m=null;if(c)for(let r=0;r<c.length;r++){let E=c[r];if(D5(i,E.selectors,!1))if(h||(h=[]),mf(E))if(E.findHostDirectiveDefs!==null){let C=[];m=m||new Map,E.findHostDirectiveDefs(E,C,m),h.unshift(...C,E);let O=C.length;fE(o,i,O)}else h.unshift(E),fE(o,i,0);else m=m||new Map,E.findHostDirectiveDefs?.(E,h,m),h.push(E)}return h===null?null:[h,m]}function fE(o,i,c){i.componentOffset=c,(o.components??=[]).push(i.index)}function VU(o,i,c){if(i){let h=o.localNames=[];for(let m=0;m<i.length;m+=2){let r=c[i[m+1]];if(r==null)throw new gt(-301,!1);h.push(i[m],r)}}}function jU(o,i,c){if(c){if(i.exportAs)for(let h=0;h<i.exportAs.length;h++)c[i.exportAs[h]]=o;mf(i)&&(c[""]=o)}}function $U(o,i,c){o.flags|=1,o.directiveStart=i,o.directiveEnd=i+c,o.providerIndexes=i}function GU(o,i,c,h,m){o.data[h]=m;let r=m.factory||(m.factory=of(m.type,!0)),E=new rh(r,mf(m),gr);o.blueprint[h]=E,c[h]=E,FU(o,i,h,KP(o,c,m.hostVars,la),m)}function qU(o,i,c){let h=xs(i,o),m=JP(c),r=o[ys].rendererFactory,E=16;c.signals?E=4096:c.onPush&&(E=64);let C=_v(o,gv(o,m,null,E,h,i,null,r.createRenderer(h,c),null,null,null));o[i.index]=C}function HU(o,i,c,h,m,r){let E=r[i];if(E!==null)for(let C=0;C<E.length;){let O=E[C++],z=E[C++],Z=E[C++],ce=E[C++];XP(h,c,O,z,Z,ce)}}function WU(o,i,c){let h=null,m=0;for(;m<c.length;){let r=c[m];if(r===0){m+=4;continue}else if(r===5){m+=2;continue}if(typeof r=="number")break;if(o.hasOwnProperty(r)){h===null&&(h=[]);let E=o[r];for(let C=0;C<E.length;C+=3)if(E[C]===i){h.push(r,E[C+1],E[C+2],c[m+1]);break}}m+=2}return h}function rR(o,i,c,h){return[o,!0,0,i,null,h,null,c,null,null]}function iR(o,i){let c=o.contentQueries;if(c!==null){let h=nr(null);try{for(let m=0;m<c.length;m+=2){let r=c[m],E=c[m+1];if(E!==-1){let C=o.data[E];cP(r),C.contentQueries(2,i[E],E)}}}finally{nr(h)}}}function _v(o,i){return o[Hm]?o[XA][gs]=i:o[Hm]=i,o[XA]=i,i}function pE(o,i,c){cP(0);let h=nr(null);try{i(o,c)}finally{nr(h)}}function ZU(o){return o[qm]||(o[qm]=[])}function YU(o){return o.cleanup||(o.cleanup=[])}function oR(o,i){let c=o[lf],h=c?c.get(Ka,null):null;h&&h.handleError(i)}function uT(o,i,c,h,m){for(let r=0;r<c.length;){let E=c[r++],C=c[r++],O=c[r++],z=i[E],Z=o.data[E];XP(Z,z,h,C,O,m)}}function hT(o,i,c){let h=n4(i,o);sU(o[Ii],h,c)}function XU(o,i){let c=Tc(i,o),h=c[Gn];KU(h,c);let m=c[Ja];m!==null&&c[V0]===null&&(c[V0]=JE(m,c[lf])),dT(h,c,c[_s])}function KU(o,i){for(let c=i.length;c<o.blueprint.length;c++)i.push(o.blueprint[c])}function dT(o,i,c){qE(i);try{let h=o.viewQuery;h!==null&&pE(1,h,c);let m=o.template;m!==null&&QP(o,i,m,1,c),o.firstCreatePass&&(o.firstCreatePass=!1),i[cf]?.finishViewCreation(o),o.staticContentQueries&&iR(o,i),o.staticViewQueries&&pE(2,o.viewQuery,c);let r=o.components;r!==null&&QU(i,r)}catch(h){throw o.firstCreatePass&&(o.incompleteFirstPass=!0,o.firstCreatePass=!1),h}finally{i[mn]&=-5,HE()}}function QU(o,i){for(let c=0;c<i.length;c++)XU(o,i[c])}function JU(o,i,c,h){let m=nr(null);try{let r=i.tView,C=o[mn]&4096?4096:16,O=gv(o,r,c,C,null,i,null,null,h?.injector??null,h?.embeddedViewInjector??null,h?.dehydratedView??null),z=o[i.index];O[sv]=z;let Z=o[cf];return Z!==null&&(O[cf]=Z.createEmbeddedView(r)),dT(r,O,c),O}finally{nr(m)}}function l2(o,i){return!i||i.firstChild===null||AP(o)}function eV(o,i,c,h=!0){let m=i[Gn];if(hU(m,i,o,c),h){let E=dE(c,o),C=i[Ii],O=rT(C,o[th]);O!==null&&cU(m,o[vs],C,i,O,E)}let r=i[V0];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function Y0(o,i,c,h,m=!1){for(;c!==null;){let r=i[c.index];r!==null&&h.push(aa(r)),el(r)&&tV(r,h);let E=c.type;if(E&8)Y0(o,i,c.child,h);else if(E&32){let C=nT(c,i),O;for(;O=C();)h.push(O)}else if(E&16){let C=HP(i,c);if(Array.isArray(C))h.push(...C);else{let O=Zm(i[oa]);Y0(O[Gn],O,C,h,!0)}}c=m?c.projectionNext:c.next}return h}function tV(o,i){for(let c=Go;c<o.length;c++){let h=o[c],m=h[Gn].firstChild;m!==null&&Y0(h[Gn],h,m,i)}o[th]!==o[Ja]&&i.push(o[th])}var sR=[];function nV(o){return o[eh]??rV(o)}function rV(o){let i=sR.pop()??Object.create(oV);return i.lView=o,i}function iV(o){o.lView[eh]!==o&&(o.lView=null,sR.push(o))}var oV=Tr(xt({},aA),{consumerIsAlwaysLive:!0,consumerMarkedDirty:o=>{Wm(o.lView)},consumerOnSignalRead(){this.lView[eh]=this}}),aR=100;function lR(o,i=!0,c=0){let h=o[ys],m=h.rendererFactory,r=!1;r||m.begin?.();try{sV(o,c)}catch(E){throw i&&oR(o,E),E}finally{r||(m.end?.(),h.inlineEffectRunner?.flush())}}function sV(o,i){mE(o,i);let c=0;for(;$E(o);){if(c===aR)throw new gt(103,!1);c++,mE(o,1)}}function aV(o,i,c,h){let m=i[mn];if((m&256)===256)return;let r=!1;!r&&i[ys].inlineEffectRunner?.flush(),qE(i);let E=null,C=null;!r&&lV(o)&&(C=nV(i),E=lA(C));try{tP(i),_4(o.bindingStartIndex),c!==null&&QP(o,i,c,2,h);let O=(m&3)===3;if(!r)if(O){let ce=o.preOrderCheckHooks;ce!==null&&O0(i,ce,null)}else{let ce=o.preOrderHooks;ce!==null&&L0(i,ce,0,null),Bw(i,0)}if(cV(i),cR(i,0),o.contentQueries!==null&&iR(o,i),!r)if(O){let ce=o.contentCheckHooks;ce!==null&&O0(i,ce)}else{let ce=o.contentHooks;ce!==null&&L0(i,ce,1),Bw(i,1)}DU(o,i);let z=o.components;z!==null&&hR(i,z,0);let Z=o.viewQuery;if(Z!==null&&pE(2,Z,h),!r)if(O){let ce=o.viewCheckHooks;ce!==null&&O0(i,ce)}else{let ce=o.viewHooks;ce!==null&&L0(i,ce,2),Bw(i,2)}if(o.firstUpdatePass===!0&&(o.firstUpdatePass=!1),i[zw]){for(let ce of i[zw])ce();i[zw]=null}r||(i[mn]&=-73)}catch(O){throw Wm(i),O}finally{C!==null&&(cA(C,E),iV(C)),HE()}}function lV(o){return o.type!==2}function cR(o,i){for(let c=RP(o);c!==null;c=OP(c))for(let h=Go;h<c.length;h++){let m=c[h];uR(m,i)}}function cV(o){for(let i=RP(o);i!==null;i=OP(i)){if(!(i[mn]&UE.HasTransplantedViews))continue;let c=i[$0];for(let h=0;h<c.length;h++){let m=c[h],r=m[Fi];o4(m)}}}function uV(o,i,c){let h=Tc(i,o);uR(h,c)}function uR(o,i){jE(o)&&mE(o,i)}function mE(o,i){let h=o[Gn],m=o[mn],r=o[eh],E=!!(i===0&&m&16);if(E||=!!(m&64&&i===0),E||=!!(m&1024),E||=!!(r?.dirty&&gw(r)),r&&(r.dirty=!1),o[mn]&=-9217,E)aV(h,o,h.template,o[_s]);else if(m&8192){cR(o,1);let C=h.components;C!==null&&hR(o,C,1)}}function hR(o,i,c){for(let h=0;h<i.length;h++)uV(o,i[h],c)}function fT(o){for(o[ys].changeDetectionScheduler?.notify();o;){o[mn]|=64;let i=Zm(o);if(Z5(o)&&!i)return o;o=i}return null}var ih=class{get rootNodes(){let i=this._lView,c=i[Gn];return Y0(c,i,c.firstChild,[])}constructor(i,c,h=!0){this._lView=i,this._cdRefInjectingView=c,this.notifyErrorHandler=h,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[_s]}set context(i){this._lView[_s]=i}get destroyed(){return(this._lView[mn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let i=this._lView[Fi];if(el(i)){let c=i[j0],h=c?c.indexOf(this):-1;h>-1&&(hE(i,h),B0(c,h))}this._attachedToViewContainer=!1}GP(this._lView[Gn],this._lView)}onDestroy(i){nP(this._lView,i)}markForCheck(){fT(this._cdRefInjectingView||this._lView)}detach(){this._lView[mn]&=-129}reattach(){rE(this._lView),this._lView[mn]|=128}detectChanges(){this._lView[mn]|=1024,lR(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new gt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,jP(this._lView[Gn],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new gt(902,!1);this._appRef=i,rE(this._lView)}},yv=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=fV;let o=i;return o})(),hV=yv,dV=class extends hV{constructor(i,c,h){super(),this._declarationLView=i,this._declarationTContainer=c,this.elementRef=h}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,c){return this.createEmbeddedViewImpl(i,c)}createEmbeddedViewImpl(i,c,h){let m=JU(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:c,dehydratedView:h});return new ih(m)}};function fV(){return dR(To(),br())}function dR(o,i){return o.type&4?new dV(i,o,fv(o,i)):null}var CK=new RegExp(`^(\\d+)*(${Z4}|${W4})*(.*)`);var pV=()=>null;function c2(o,i){return pV(o,i)}var Ym=class{},gE=class{},X0=class{};function mV(o){let i=Error(`No component factory found for ${oo(o)}.`);return i[gV]=o,i}var gV="ngComponent";var _E=class{resolveComponentFactory(i){throw mV(i)}},vv=(()=>{let i=class i{};i.NULL=new _E;let o=i;return o})(),oh=class{},gf=(()=>{let i=class i{constructor(){this.destroyNode=null}};i.__NG_ELEMENT_ID__=()=>_V();let o=i;return o})();function _V(){let o=br(),i=To(),c=Tc(i.index,o);return(Ku(c)?c:o)[Ii]}var yV=(()=>{let i=class i{};i.\u0275prov=jt({token:i,providedIn:"root",factory:()=>null});let o=i;return o})(),Gw={};var u2=new Set;function ig(o){u2.has(o)||(u2.add(o),performance?.mark?.("mark_feature_usage",{detail:{feature:o}}))}function h2(...o){}function vV(){let o=typeof Um.requestAnimationFrame=="function",i=Um[o?"requestAnimationFrame":"setTimeout"],c=Um[o?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&i&&c){let h=i[Zone.__symbol__("OriginalDelegate")];h&&(i=h);let m=c[Zone.__symbol__("OriginalDelegate")];m&&(c=m)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:c}}var Rr=class o{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:c=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new $i(!1),this.onMicrotaskEmpty=new $i(!1),this.onStable=new $i(!1),this.onError=new $i(!1),typeof Zone>"u")throw new gt(908,!1);Zone.assertZonePatched();let m=this;m._nesting=0,m._outer=m._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(m._inner=m._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(m._inner=m._inner.fork(Zone.longStackTraceZoneSpec)),m.shouldCoalesceEventChangeDetection=!h&&c,m.shouldCoalesceRunChangeDetection=h,m.lastRequestAnimationFrameId=-1,m.nativeRequestAnimationFrame=vV().nativeRequestAnimationFrame,wV(m)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!o.isInAngularZone())throw new gt(909,!1)}static assertNotInAngularZone(){if(o.isInAngularZone())throw new gt(909,!1)}run(i,c,h){return this._inner.run(i,c,h)}runTask(i,c,h,m){let r=this._inner,E=r.scheduleEventTask("NgZoneEvent: "+m,i,xV,h2,h2);try{return r.runTask(E,c,h)}finally{r.cancelTask(E)}}runGuarded(i,c,h){return this._inner.runGuarded(i,c,h)}runOutsideAngular(i){return this._outer.run(i)}},xV={};function pT(o){if(o._nesting==0&&!o.hasPendingMicrotasks&&!o.isStable)try{o._nesting++,o.onMicrotaskEmpty.emit(null)}finally{if(o._nesting--,!o.hasPendingMicrotasks)try{o.runOutsideAngular(()=>o.onStable.emit(null))}finally{o.isStable=!0}}}function bV(o){o.isCheckStableRunning||o.lastRequestAnimationFrameId!==-1||(o.lastRequestAnimationFrameId=o.nativeRequestAnimationFrame.call(Um,()=>{o.fakeTopEventTask||(o.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{o.lastRequestAnimationFrameId=-1,yE(o),o.isCheckStableRunning=!0,pT(o),o.isCheckStableRunning=!1},void 0,()=>{},()=>{})),o.fakeTopEventTask.invoke()}),yE(o))}function wV(o){let i=()=>{bV(o)};o._inner=o._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(c,h,m,r,E,C)=>{if(EV(C))return c.invokeTask(m,r,E,C);try{return d2(o),c.invokeTask(m,r,E,C)}finally{(o.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||o.shouldCoalesceRunChangeDetection)&&i(),f2(o)}},onInvoke:(c,h,m,r,E,C,O)=>{try{return d2(o),c.invoke(m,r,E,C,O)}finally{o.shouldCoalesceRunChangeDetection&&i(),f2(o)}},onHasTask:(c,h,m,r)=>{c.hasTask(m,r),h===m&&(r.change=="microTask"?(o._hasPendingMicrotasks=r.microTask,yE(o),pT(o)):r.change=="macroTask"&&(o.hasPendingMacrotasks=r.macroTask))},onHandleError:(c,h,m,r)=>(c.handleError(m,r),o.runOutsideAngular(()=>o.onError.emit(r)),!1)})}function yE(o){o._hasPendingMicrotasks||(o.shouldCoalesceEventChangeDetection||o.shouldCoalesceRunChangeDetection)&&o.lastRequestAnimationFrameId!==-1?o.hasPendingMicrotasks=!0:o.hasPendingMicrotasks=!1}function d2(o){o._nesting++,o.isStable&&(o.isStable=!1,o.onUnstable.emit(null))}function f2(o){o._nesting--,pT(o)}function EV(o){return!Array.isArray(o)||o.length!==1?!1:o[0].data?.__ignore_ng_zone__===!0}var fR=(()=>{let i=class i{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let h=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let m of h)m()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};i.\u0275prov=jt({token:i,providedIn:"root",factory:()=>new i});let o=i;return o})();function K0(o,i,c){let h=c?o.styles:null,m=c?o.classes:null,r=0;if(i!==null)for(let E=0;E<i.length;E++){let C=i[E];if(typeof C=="number")r=C;else if(r==1)m=UA(m,C);else if(r==2){let O=C,z=i[++E];h=UA(h,O+": "+z+";")}}c?o.styles=h:o.stylesWithoutHost=h,c?o.classes=m:o.classesWithoutHost=m}var Q0=class extends vv{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){let c=Ju(i);return new Xm(c,this.ngModule)}};function p2(o){let i=[];for(let c in o){if(!o.hasOwnProperty(c))continue;let h=o[c];h!==void 0&&i.push({propName:Array.isArray(h)?h[0]:h,templateName:c})}return i}function TV(o){let i=o.toLowerCase();return i==="svg"?Q5:i==="math"?J5:null}var vE=class{constructor(i,c){this.injector=i,this.parentInjector=c}get(i,c,h){h=iv(h);let m=this.injector.get(i,Gw,h);return m!==Gw||c===Gw?m:this.parentInjector.get(i,c,h)}},Xm=class extends X0{get inputs(){let i=this.componentDef,c=i.inputTransforms,h=p2(i.inputs);if(c!==null)for(let m of h)c.hasOwnProperty(m.propName)&&(m.transform=c[m.propName]);return h}get outputs(){return p2(this.componentDef.outputs)}constructor(i,c){super(),this.componentDef=i,this.ngModule=c,this.componentType=i.type,this.selector=A5(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!c}create(i,c,h,m){let r=nr(null);try{m=m||this.ngModule;let E=m instanceof so?m:m?.injector;E&&this.componentDef.getStandaloneInjector!==null&&(E=this.componentDef.getStandaloneInjector(E)||E);let C=E?new vE(i,E):i,O=C.get(oh,null);if(O===null)throw new gt(407,!1);let z=C.get(yV,null),Z=C.get(fR,null),ce=C.get(Ym,null),Ie={rendererFactory:O,sanitizer:z,inlineEffectRunner:null,afterRenderEventManager:Z,changeDetectionScheduler:ce},be=O.createRenderer(null,this.componentDef),qe=this.componentDef.selectors[0][0]||"div",ot=h?MU(be,h,this.componentDef.encapsulation,C):VP(be,qe,TV(qe)),dt=512;this.componentDef.signals?dt|=4096:this.componentDef.onPush||(dt|=16);let ct=null;ot!==null&&(ct=JE(ot,C,!0));let bt=lT(0,null,null,1,0,null,null,null,null,null,null),St=gv(null,bt,null,dt,null,null,Ie,be,C,null,ct);qE(St);let $t,dr;try{let Xn=this.componentDef,ir,Yt=null;Xn.findHostDirectiveDefs?(ir=[],Yt=new Map,Xn.findHostDirectiveDefs(Xn,ir,Yt),ir.push(Xn)):ir=[Xn];let di=IV(St,ot),Xt=DV(di,ot,Xn,ir,St,Ie,be);dr=eP(bt,sa),ot&&MV(be,Xn,ot,h),c!==void 0&&AV(dr,this.ngContentSelectors,c),$t=CV(Xt,Xn,ir,Yt,St,[PV]),dT(bt,St,null)}finally{HE()}return new xE(this.componentType,$t,fv(dr,St),St,dr)}finally{nr(r)}}},xE=class extends gE{constructor(i,c,h,m,r){super(),this.location=h,this._rootLView=m,this._tNode=r,this.previousInputValues=null,this.instance=c,this.hostView=this.changeDetectorRef=new ih(m,void 0,!1),this.componentType=i}setInput(i,c){let h=this._tNode.inputs,m;if(h!==null&&(m=h[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),c))return;let r=this._rootLView;uT(r[Gn],r,m,i,c),this.previousInputValues.set(i,c);let E=Tc(this._tNode.index,r);fT(E)}}get injector(){return new Qu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}};function IV(o,i){let c=o[Gn],h=sa;return o[h]=i,rg(c,h,2,"#host",null)}function DV(o,i,c,h,m,r,E){let C=m[Gn];SV(h,o,i,E);let O=null;i!==null&&(O=JE(i,m[lf]));let z=r.rendererFactory.createRenderer(i,c),Z=16;c.signals?Z=4096:c.onPush&&(Z=64);let ce=gv(m,JP(c),null,Z,m[o.index],o,r,z,null,null,O);return C.firstCreatePass&&fE(C,o,h.length-1),_v(m,ce),m[o.index]=ce}function SV(o,i,c,h){for(let m of o)i.mergedAttrs=FE(i.mergedAttrs,m.hostAttrs);i.mergedAttrs!==null&&(K0(i,i.mergedAttrs,!0),c!==null&&ZP(h,c,i))}function CV(o,i,c,h,m,r){let E=To(),C=m[Gn],O=xs(E,m);tR(C,m,E,c,null,h);for(let Z=0;Z<c.length;Z++){let ce=E.directiveStart+Z,Ie=hf(m,C,ce,E);yc(Ie,m)}nR(C,m,E),O&&yc(O,m);let z=hf(m,C,E.directiveStart+E.componentOffset,E);if(o[_s]=m[_s]=z,r!==null)for(let Z of r)Z(z,i);return oT(C,E,m),z}function MV(o,i,c,h){if(h)Qw(o,c,["ng-version","17.3.11"]);else{let{attrs:m,classes:r}=P5(i.selectors[0]);m&&Qw(o,c,m),r&&r.length>0&&WP(o,c,r.join(" "))}}function AV(o,i,c){let h=o.projection=[];for(let m=0;m<i.length;m++){let r=c[m];h.push(r!=null?Array.from(r):null)}}function PV(){let o=To();dv(br()[Gn],o)}var uh=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=RV;let o=i;return o})();function RV(){let o=To();return LV(o,br())}var OV=uh,pR=class extends OV{constructor(i,c,h){super(),this._lContainer=i,this._hostTNode=c,this._hostLView=h}get element(){return fv(this._hostTNode,this._hostLView)}get injector(){return new Qu(this._hostTNode,this._hostLView)}get parentInjector(){let i=WE(this._hostTNode,this._hostLView);if(yP(i)){let c=q0(i,this._hostLView),h=G0(i),m=c[Gn].data[h+8];return new Qu(m,c)}else return new Qu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){let c=m2(this._lContainer);return c!==null&&c[i]||null}get length(){return this._lContainer.length-Go}createEmbeddedView(i,c,h){let m,r;typeof h=="number"?m=h:h!=null&&(m=h.index,r=h.injector);let E=c2(this._lContainer,i.ssrId),C=i.createEmbeddedViewImpl(c||{},r,E);return this.insertImpl(C,m,l2(this._hostTNode,E)),C}createComponent(i,c,h,m,r){let E=i&&!W5(i),C;if(E)C=c;else{let qe=c||{};C=qe.index,h=qe.injector,m=qe.projectableNodes,r=qe.environmentInjector||qe.ngModuleRef}let O=E?i:new Xm(Ju(i)),z=h||this.parentInjector;if(!r&&O.ngModule==null){let ot=(E?z:this.parentInjector).get(so,null);ot&&(r=ot)}let Z=Ju(O.componentType??{}),ce=c2(this._lContainer,Z?.id??null),Ie=ce?.firstChild??null,be=O.create(z,m,Ie,r);return this.insertImpl(be.hostView,C,l2(this._hostTNode,ce)),be}insert(i,c){return this.insertImpl(i,c,!0)}insertImpl(i,c,h){let m=i._lView;if(i4(m)){let C=this.indexOf(i);if(C!==-1)this.detach(C);else{let O=m[Fi],z=new pR(O,O[vs],O[Fi]);z.detach(z.indexOf(i))}}let r=this._adjustIndex(c),E=this._lContainer;return eV(E,m,r,h),i.attachToViewContainerRef(),O2(qw(E),r,i),i}move(i,c){return this.insert(i,c)}indexOf(i){let c=m2(this._lContainer);return c!==null?c.indexOf(i):-1}remove(i){let c=this._adjustIndex(i,-1),h=hE(this._lContainer,c);h&&(B0(qw(this._lContainer),c),GP(h[Gn],h))}detach(i){let c=this._adjustIndex(i,-1),h=hE(this._lContainer,c);return h&&B0(qw(this._lContainer),c)!=null?new ih(h):null}_adjustIndex(i,c=0){return i??this.length+c}};function m2(o){return o[j0]}function qw(o){return o[j0]||(o[j0]=[])}function LV(o,i){let c,h=i[o.index];return el(h)?c=h:(c=rR(h,i,null,o),i[o.index]=c,_v(i,c)),FV(c,i,o,h),new pR(c,o,i)}function kV(o,i){let c=o[Ii],h=c.createComment(""),m=xs(i,o),r=rT(c,m);return Z0(c,r,h,yU(c,m),!1),h}var FV=BV,NV=()=>!1;function zV(o,i,c){return NV(o,i,c)}function BV(o,i,c,h){if(o[th])return;let m;c.type&8?m=aa(h):m=kV(i,c),o[th]=m}var vc=class{},Km=class{};var bE=class extends vc{constructor(i,c,h){super(),this._parent=c,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Q0(this);let m=V2(i);this._bootstrapComponents=UP(m.bootstrap),this._r3Injector=SP(i,c,[{provide:vc,useValue:this},{provide:vv,useValue:this.componentFactoryResolver},...h],oo(i),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(i)}get injector(){return this._r3Injector}destroy(){let i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(c=>c()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}},wE=class extends Km{constructor(i){super(),this.moduleType=i}create(i){return new bE(this.moduleType,i,[])}};var J0=class extends vc{constructor(i){super(),this.componentFactoryResolver=new Q0(this),this.instance=null;let c=new Gm([...i.providers,{provide:vc,useValue:this},{provide:vv,useValue:this.componentFactoryResolver}],i.parent||BE(),i.debugName,new Set(["environment"]));this.injector=c,i.runEnvironmentInitializers&&c.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}};function mT(o,i,c=null){return new J0({providers:o,parent:i,debugName:c,runEnvironmentInitializers:!0}).injector}var hh=(()=>{let i=class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new li(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let h=this.taskId++;return this.pendingTasks.add(h),h}remove(h){this.pendingTasks.delete(h),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function mR(o){return gT(o)?Array.isArray(o)||!(o instanceof Map)&&Symbol.iterator in o:!1}function UV(o,i){if(Array.isArray(o))for(let c=0;c<o.length;c++)i(o[c]);else{let c=o[Symbol.iterator](),h;for(;!(h=c.next()).done;)i(h.value)}}function gT(o){return o!==null&&(typeof o=="function"||typeof o=="object")}function VV(o,i,c){return o[i]=c}function df(o,i,c){let h=o[i];return Object.is(h,c)?!1:(o[i]=c,!0)}function gR(o,i,c,h){let m=df(o,i,c);return df(o,i+1,h)||m}function jV(o,i,c,h,m){let r=gR(o,i,c,h);return df(o,i+2,m)||r}function $V(o){return(o.flags&32)===32}function GV(o,i,c,h,m,r,E,C,O){let z=i.consts,Z=rg(i,o,4,E||null,uf(z,C));cT(i,c,Z,uf(z,O)),dv(i,Z);let ce=Z.tView=lT(2,Z,h,m,r,i.directiveRegistry,i.pipeRegistry,null,i.schemas,z,null);return i.queries!==null&&(i.queries.template(i,Z),ce.queries=i.queries.embeddedTView(Z)),Z}function bs(o,i,c,h,m,r,E,C){let O=br(),z=qo(),Z=o+sa,ce=z.firstCreatePass?GV(Z,z,O,i,c,h,m,r,E):z.data[Z];lh(ce,!1);let Ie=qV(z,O,ce,o);uv()&&pv(z,O,Ie,ce),yc(Ie,O);let be=rR(Ie,O,Ie,ce);return O[Z]=be,_v(O,be),zV(be,ce,O),cv(ce)&&sT(z,O,ce),E!=null&&aT(O,ce,C),bs}var qV=HV;function HV(o,i,c,h){return hv(!0),i[Ii].createComment("")}function _R(o,i,c,h){return df(o,aP(),c)?i+gc(c)+h:la}function WV(o,i,c,h,m,r){let E=sP(),C=gR(o,E,c,m);return lP(2),C?i+gc(c)+h+gc(m)+r:la}function ZV(o,i,c,h,m,r,E,C){let O=sP(),z=jV(o,O,c,m,E);return lP(3),z?i+gc(c)+h+gc(m)+r+gc(E)+C:la}function kr(o,i,c){let h=br(),m=aP();if(df(h,m,i)){let r=qo(),E=mP();eR(r,E,h,o,i,h[Ii],c,!1)}return kr}function g2(o,i,c,h,m){let r=i.inputs,E=m?"class":"style";uT(o,c,r[E],E,h)}function YV(o,i,c,h,m,r){let E=i.consts,C=uf(E,m),O=rg(i,o,2,h,C);return cT(i,c,O,uf(E,r)),O.attrs!==null&&K0(O,O.attrs,!1),O.mergedAttrs!==null&&K0(O,O.mergedAttrs,!0),i.queries!==null&&i.queries.elementStart(i,O),O}function wn(o,i,c,h){let m=br(),r=qo(),E=sa+o,C=m[Ii],O=r.firstCreatePass?YV(E,r,m,i,c,h):r.data[E],z=XV(r,m,O,C,i,o);m[E]=z;let Z=cv(O);return lh(O,!0),ZP(C,z,O),!$V(O)&&uv()&&pv(r,m,z,O),l4()===0&&yc(z,m),c4(),Z&&(sT(r,m,O),oT(r,O,m)),h!==null&&aT(m,O),wn}function Sn(){let o=To();GE()?oP():(o=o.parent,lh(o,!1));let i=o;d4(i)&&f4(),u4();let c=qo();return c.firstCreatePass&&(dv(c,o),VE(o)&&c.queries.elementEnd(o)),i.classesWithoutHost!=null&&S4(i)&&g2(c,i,br(),i.classesWithoutHost,!0),i.stylesWithoutHost!=null&&C4(i)&&g2(c,i,br(),i.stylesWithoutHost,!1),Sn}function Ir(o,i,c,h){return wn(o,i,c,h),Sn(),Ir}var XV=(o,i,c,h,m,r)=>(hv(!0),VP(h,m,E4()));function KV(o,i,c,h,m){let r=i.consts,E=uf(r,h),C=rg(i,o,8,"ng-container",E);E!==null&&K0(C,E,!0);let O=uf(r,m);return cT(i,c,C,O),i.queries!==null&&i.queries.elementStart(i,C),C}function xv(o,i,c){let h=br(),m=qo(),r=o+sa,E=m.firstCreatePass?KV(r,m,h,i,c):m.data[r];lh(E,!0);let C=QV(m,h,E,o);return h[r]=C,uv()&&pv(m,h,C,E),yc(C,h),cv(E)&&(sT(m,h,E),oT(m,E,h)),c!=null&&aT(h,E),xv}function bv(){let o=To(),i=qo();return GE()?oP():(o=o.parent,lh(o,!1)),i.firstCreatePass&&(dv(i,o),VE(o)&&i.queries.elementEnd(o)),bv}function wv(o,i,c){return xv(o,i,c),bv(),wv}var QV=(o,i,c,h)=>(hv(!0),aU(i[Ii],""));function og(){return br()}var ev="en-US";var JV=ev;function ej(o){typeof o=="string"&&(JV=o.toLowerCase().replace(/_/g,"-"))}function Gi(o,i,c,h){let m=br(),r=qo(),E=To();return nj(r,m,m[Ii],E,o,i,h),Gi}function tj(o,i,c,h){let m=o.cleanup;if(m!=null)for(let r=0;r<m.length-1;r+=2){let E=m[r];if(E===c&&m[r+1]===h){let C=i[qm],O=m[r+2];return C.length>O?C[O]:null}typeof E=="string"&&(r+=2)}return null}function nj(o,i,c,h,m,r,E){let C=cv(h),z=o.firstCreatePass&&YU(o),Z=i[_s],ce=ZU(i),Ie=!0;if(h.type&3||E){let ot=xs(h,i),dt=E?E(ot):ot,ct=ce.length,bt=E?$t=>E(aa($t[h.index])):h.index,St=null;if(!E&&C&&(St=tj(o,i,m,h.index)),St!==null){let $t=St.__ngLastListenerFn__||St;$t.__ngNextListenerFn__=r,St.__ngLastListenerFn__=r,Ie=!1}else{r=y2(h,i,Z,r,!1);let $t=c.listen(dt,m,r);ce.push(r,$t),z&&z.push(m,bt,ct,ct+1)}}else r=y2(h,i,Z,r,!1);let be=h.outputs,qe;if(Ie&&be!==null&&(qe=be[m])){let ot=qe.length;if(ot)for(let dt=0;dt<ot;dt+=2){let ct=qe[dt],bt=qe[dt+1],dr=i[ct][bt].subscribe(r),Xn=ce.length;ce.push(r,dr),z&&z.push(m,h.index,Xn,-(Xn+1))}}}function _2(o,i,c,h){let m=nr(null);try{return ta(6,i,c),c(h)!==!1}catch(r){return oR(o,r),!1}finally{ta(7,i,c),nr(m)}}function y2(o,i,c,h,m){return function r(E){if(E===Function)return h;let C=o.componentOffset>-1?Tc(o.index,i):i;fT(C);let O=_2(i,c,h,E),z=r.__ngNextListenerFn__;for(;z;)O=_2(i,c,z,E)&&O,z=z.__ngNextListenerFn__;return m&&O===!1&&E.preventDefault(),O}}function dh(o=1){return w4(o)}function Sc(o,i,c){return yR(o,"",i,"",c),Sc}function yR(o,i,c,h,m){let r=br(),E=_R(r,i,c,h);if(E!==la){let C=qo(),O=mP();eR(C,O,r,o,E,r[Ii],m,!1)}return yR}function sg(o){let i=m4();return r4(i,sa+o)}function Ur(o,i=""){let c=br(),h=qo(),m=o+sa,r=h.firstCreatePass?rg(h,m,1,i,null):h.data[m],E=rj(h,c,r,i,o);c[m]=E,uv()&&pv(h,c,E,r),lh(r,!1)}var rj=(o,i,c,h,m)=>(hv(!0),oU(i[Ii],h));function Cc(o,i,c){let h=br(),m=_R(h,o,i,c);return m!==la&&hT(h,tg(),m),Cc}function Ev(o,i,c,h,m){let r=br(),E=WV(r,o,i,c,h,m);return E!==la&&hT(r,tg(),E),Ev}function _T(o,i,c,h,m,r,E){let C=br(),O=ZV(C,o,i,c,h,m,r,E);return O!==la&&hT(C,tg(),O),_T}function ij(o,i,c){let h=qo();if(h.firstCreatePass){let m=mf(o);EE(c,h.data,h.blueprint,m,!0),EE(i,h.data,h.blueprint,m,!1)}}function EE(o,i,c,h,m){if(o=ji(o),Array.isArray(o))for(let r=0;r<o.length;r++)EE(o[r],i,c,h,m);else{let r=qo(),E=br(),C=To(),O=af(o)?o:ji(o.provide),z=W2(o),Z=C.providerIndexes&1048575,ce=C.directiveStart,Ie=C.providerIndexes>>20;if(af(o)||!o.multi){let be=new rh(z,m,gr),qe=Ww(O,i,m?Z:Z+Ie,ce);qe===-1?(sE(H0(C,E),r,O),Hw(r,o,i.length),i.push(O),C.directiveStart++,C.directiveEnd++,m&&(C.providerIndexes+=1048576),c.push(be),E.push(be)):(c[qe]=be,E[qe]=be)}else{let be=Ww(O,i,Z+Ie,ce),qe=Ww(O,i,Z,Z+Ie),ot=be>=0&&c[be],dt=qe>=0&&c[qe];if(m&&!dt||!m&&!ot){sE(H0(C,E),r,O);let ct=aj(m?sj:oj,c.length,m,h,z);!m&&dt&&(c[qe].providerFactory=ct),Hw(r,o,i.length,0),i.push(O),C.directiveStart++,C.directiveEnd++,m&&(C.providerIndexes+=1048576),c.push(ct),E.push(ct)}else{let ct=vR(c[m?qe:be],z,!m&&h);Hw(r,o,be>-1?be:qe,ct)}!m&&h&&dt&&c[qe].componentProviders++}}}function Hw(o,i,c,h){let m=af(i),r=B5(i);if(m||r){let O=(r?ji(i.useClass):i).prototype.ngOnDestroy;if(O){let z=o.destroyHooks||(o.destroyHooks=[]);if(!m&&i.multi){let Z=z.indexOf(c);Z===-1?z.push(c,[h,O]):z[Z+1].push(h,O)}else z.push(c,O)}}}function vR(o,i,c){return c&&o.componentProviders++,o.multi.push(i)-1}function Ww(o,i,c,h){for(let m=c;m<h;m++)if(i[m]===o)return m;return-1}function oj(o,i,c,h){return TE(this.multi,[])}function sj(o,i,c,h){let m=this.multi,r;if(this.providerFactory){let E=this.providerFactory.componentProviders,C=hf(c,c[Gn],this.providerFactory.index,h);r=C.slice(0,E),TE(m,r);for(let O=E;O<C.length;O++)r.push(C[O])}else r=[],TE(m,r);return r}function TE(o,i){for(let c=0;c<o.length;c++){let h=o[c];i.push(h())}return i}function aj(o,i,c,h,m){let r=new rh(o,c,gr);return r.multi=[],r.index=i,r.componentProviders=0,vR(r,m,h&&!c),r}function xR(o,i=[]){return c=>{c.providersResolver=(h,m)=>ij(h,m?m(o):o,i)}}var lj=(()=>{let i=class i{constructor(h){this._injector=h,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(h){if(!h.standalone)return null;if(!this.cachedInjectors.has(h)){let m=G2(!1,h.type),r=m.length>0?mT([m],this._injector,`Standalone[${h.type.name}]`):null;this.cachedInjectors.set(h,r)}return this.cachedInjectors.get(h)}ngOnDestroy(){try{for(let h of this.cachedInjectors.values())h!==null&&h.destroy()}finally{this.cachedInjectors.clear()}}};i.\u0275prov=jt({token:i,providedIn:"environment",factory:()=>new i(cn(so))});let o=i;return o})();function Vr(o){ig("NgStandalone"),o.getStandaloneInjector=i=>i.get(lj).getOrCreateStandaloneInjector(o)}function _f(o,i,c,h){return uj(br(),g4(),o,i,c,h)}function cj(o,i){let c=o[i];return c===la?void 0:c}function uj(o,i,c,h,m,r){let E=i+c;return df(o,E,m)?VV(o,E+1,r?h.call(r,m):h(m)):cj(o,E+1)}function ag(o,i){return dR(o,i)}var Tv=(()=>{let i=class i{log(h){console.log(h)}warn(h){console.warn(h)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"platform"});let o=i;return o})();var bR=new gn("");function lg(o){return!!o&&typeof o.then=="function"}function wR(o){return!!o&&typeof o.subscribe=="function"}var ER=new gn(""),TR=(()=>{let i=class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,m)=>{this.resolve=h,this.reject=m}),this.appInits=Et(ER,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let h=[];for(let r of this.appInits){let E=r();if(lg(E))h.push(E);else if(wR(E)){let C=new Promise((O,z)=>{E.subscribe({complete:O,error:z})});h.push(C)}}let m=()=>{this.done=!0,this.resolve()};Promise.all(h).then(()=>{m()}).catch(r=>{this.reject(r)}),h.length===0&&m(),this.initialized=!0}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),Iv=new gn("");function hj(){hA(()=>{throw new gt(600,!1)})}function dj(o){return o.isBoundToModule}function fj(o,i,c){try{let h=c();return lg(h)?h.catch(m=>{throw i.runOutsideAngular(()=>o.handleError(m)),m}):h}catch(h){throw i.runOutsideAngular(()=>o.handleError(h)),h}}var yf=(()=>{let i=class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Et(CP),this.afterRenderEffectManager=Et(fR),this.externalTestViews=new Set,this.beforeRender=new Ti,this.afterTick=new Ti,this.componentTypes=[],this.components=[],this.isStable=Et(hh).hasPendingTasks.pipe(Pn(h=>!h)),this._injector=Et(so)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(h,m){let r=h instanceof X0;if(!this._injector.get(TR).done){let be=!r&&U2(h),qe=!1;throw new gt(405,qe)}let C;r?C=h:C=this._injector.get(vv).resolveComponentFactory(h),this.componentTypes.push(C.componentType);let O=dj(C)?void 0:this._injector.get(vc),z=m||C.selector,Z=C.create(ng.NULL,[],z,O),ce=Z.location.nativeElement,Ie=Z.injector.get(bR,null);return Ie?.registerApplication(ce),Z.onDestroy(()=>{this.detachView(Z.hostView),Zw(this.components,Z),Ie?.unregisterApplication(ce)}),this._loadComponent(Z),Z}tick(){this._tick(!0)}_tick(h){if(this._runningTick)throw new gt(101,!1);let m=nr(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(h)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,nr(m)}}detectChangesInAttachedViews(h){let m=0,r=this.afterRenderEffectManager;for(;;){if(m===aR)throw new gt(103,!1);if(h){let E=m===0;this.beforeRender.next(E);for(let{_lView:C,notifyErrorHandler:O}of this._views)pj(C,E,O)}if(m++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:E})=>IE(E))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:E})=>IE(E))))break}}attachView(h){let m=h;this._views.push(m),m.attachToAppRef(this)}detachView(h){let m=h;Zw(this._views,m),m.detachFromAppRef()}_loadComponent(h){this.attachView(h.hostView),this.tick(),this.components.push(h);let m=this._injector.get(Iv,[]);[...this._bootstrapListeners,...m].forEach(r=>r(h))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(h=>h()),this._views.slice().forEach(h=>h.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(h){return this._destroyListeners.push(h),()=>Zw(this._destroyListeners,h)}destroy(){if(this._destroyed)throw new gt(406,!1);let h=this._injector;h.destroy&&!h.destroyed&&h.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function Zw(o,i){let c=o.indexOf(i);c>-1&&o.splice(c,1)}function pj(o,i,c){!i&&!IE(o)||mj(o,c,i)}function IE(o){return $E(o)}function mj(o,i,c){let h;c?(h=0,o[mn]|=1024):o[mn]&64?h=0:h=1,lR(o,i,h)}var DE=class{constructor(i,c){this.ngModuleFactory=i,this.componentFactories=c}},yT=(()=>{let i=class i{compileModuleSync(h){return new wE(h)}compileModuleAsync(h){return Promise.resolve(this.compileModuleSync(h))}compileModuleAndAllComponentsSync(h){let m=this.compileModuleSync(h),r=V2(h),E=UP(r.declarations).reduce((C,O)=>{let z=Ju(O);return z&&C.push(new Xm(z)),C},[]);return new DE(m,E)}compileModuleAndAllComponentsAsync(h){return Promise.resolve(this.compileModuleAndAllComponentsSync(h))}clearCache(){}clearCacheFor(h){}getModuleId(h){}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var gj=(()=>{let i=class i{constructor(){this.zone=Et(Rr),this.applicationRef=Et(yf)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function _j(o){return[{provide:Rr,useFactory:o},{provide:sf,multi:!0,useFactory:()=>{let i=Et(gj,{optional:!0});return()=>i.initialize()}},{provide:sf,multi:!0,useFactory:()=>{let i=Et(bj);return()=>{i.initialize()}}},{provide:CP,useFactory:yj}]}function yj(){let o=Et(Rr),i=Et(Ka);return c=>o.runOutsideAngular(()=>i.handleError(c))}function vj(o){let i=_j(()=>new Rr(xj(o)));return Ec([[],i])}function xj(o){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:o?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:o?.runCoalescing??!1}}var bj=(()=>{let i=class i{constructor(){this.subscription=new ai,this.initialized=!1,this.zone=Et(Rr),this.pendingTasks=Et(hh)}initialize(){if(this.initialized)return;this.initialized=!0;let h=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(h=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Rr.assertNotInAngularZone(),queueMicrotask(()=>{h!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(h),h=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Rr.assertInAngularZone(),h??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function wj(){return typeof $localize<"u"&&$localize.locale||ev}var vT=new gn("",{providedIn:"root",factory:()=>Et(vT,zn.Optional|zn.SkipSelf)||wj()});var IR=new gn("");var F0=null;function Ej(o=[],i){return ng.create({name:i,providers:[{provide:ov,useValue:"platform"},{provide:IR,useValue:new Set([()=>F0=null])},...o]})}function Tj(o=[]){if(F0)return F0;let i=Ej(o);return F0=i,hj(),Ij(i),i}function Ij(o){o.get(XE,null)?.forEach(c=>c())}var cg=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=Dj;let o=i;return o})();function Dj(o){return Sj(To(),br(),(o&16)===16)}function Sj(o,i,c){if(lv(o)&&!c){let h=Tc(o.index,i);return new ih(h,h)}else if(o.type&47){let h=i[oa];return new ih(h,i)}return null}var SE=class{constructor(){}supports(i){return mR(i)}create(i){return new CE(i)}},Cj=(o,i)=>i,CE=class{constructor(i){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=i||Cj}forEachItem(i){let c;for(c=this._itHead;c!==null;c=c._next)i(c)}forEachOperation(i){let c=this._itHead,h=this._removalsHead,m=0,r=null;for(;c||h;){let E=!h||c&&c.currentIndex<v2(h,m,r)?c:h,C=v2(E,m,r),O=E.currentIndex;if(E===h)m--,h=h._nextRemoved;else if(c=c._next,E.previousIndex==null)m++;else{r||(r=[]);let z=C-m,Z=O-m;if(z!=Z){for(let Ie=0;Ie<z;Ie++){let be=Ie<r.length?r[Ie]:r[Ie]=0,qe=be+Ie;Z<=qe&&qe<z&&(r[Ie]=be+1)}let ce=E.previousIndex;r[ce]=Z-z}}C!==O&&i(E,C,O)}}forEachPreviousItem(i){let c;for(c=this._previousItHead;c!==null;c=c._nextPrevious)i(c)}forEachAddedItem(i){let c;for(c=this._additionsHead;c!==null;c=c._nextAdded)i(c)}forEachMovedItem(i){let c;for(c=this._movesHead;c!==null;c=c._nextMoved)i(c)}forEachRemovedItem(i){let c;for(c=this._removalsHead;c!==null;c=c._nextRemoved)i(c)}forEachIdentityChange(i){let c;for(c=this._identityChangesHead;c!==null;c=c._nextIdentityChange)i(c)}diff(i){if(i==null&&(i=[]),!mR(i))throw new gt(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let c=this._itHead,h=!1,m,r,E;if(Array.isArray(i)){this.length=i.length;for(let C=0;C<this.length;C++)r=i[C],E=this._trackByFn(C,r),c===null||!Object.is(c.trackById,E)?(c=this._mismatch(c,r,E,C),h=!0):(h&&(c=this._verifyReinsertion(c,r,E,C)),Object.is(c.item,r)||this._addIdentityChange(c,r)),c=c._next}else m=0,UV(i,C=>{E=this._trackByFn(m,C),c===null||!Object.is(c.trackById,E)?(c=this._mismatch(c,C,E,m),h=!0):(h&&(c=this._verifyReinsertion(c,C,E,m)),Object.is(c.item,C)||this._addIdentityChange(c,C)),c=c._next,m++}),this.length=m;return this._truncate(c),this.collection=i,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let i;for(i=this._previousItHead=this._itHead;i!==null;i=i._next)i._nextPrevious=i._next;for(i=this._additionsHead;i!==null;i=i._nextAdded)i.previousIndex=i.currentIndex;for(this._additionsHead=this._additionsTail=null,i=this._movesHead;i!==null;i=i._nextMoved)i.previousIndex=i.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(i,c,h,m){let r;return i===null?r=this._itTail:(r=i._prev,this._remove(i)),i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(h,null),i!==null?(Object.is(i.item,c)||this._addIdentityChange(i,c),this._reinsertAfter(i,r,m)):(i=this._linkedRecords===null?null:this._linkedRecords.get(h,m),i!==null?(Object.is(i.item,c)||this._addIdentityChange(i,c),this._moveAfter(i,r,m)):i=this._addAfter(new ME(c,h),r,m)),i}_verifyReinsertion(i,c,h,m){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(h,null);return r!==null?i=this._reinsertAfter(r,i._prev,m):i.currentIndex!=m&&(i.currentIndex=m,this._addToMoves(i,m)),i}_truncate(i){for(;i!==null;){let c=i._next;this._addToRemovals(this._unlink(i)),i=c}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(i,c,h){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(i);let m=i._prevRemoved,r=i._nextRemoved;return m===null?this._removalsHead=r:m._nextRemoved=r,r===null?this._removalsTail=m:r._prevRemoved=m,this._insertAfter(i,c,h),this._addToMoves(i,h),i}_moveAfter(i,c,h){return this._unlink(i),this._insertAfter(i,c,h),this._addToMoves(i,h),i}_addAfter(i,c,h){return this._insertAfter(i,c,h),this._additionsTail===null?this._additionsTail=this._additionsHead=i:this._additionsTail=this._additionsTail._nextAdded=i,i}_insertAfter(i,c,h){let m=c===null?this._itHead:c._next;return i._next=m,i._prev=c,m===null?this._itTail=i:m._prev=i,c===null?this._itHead=i:c._next=i,this._linkedRecords===null&&(this._linkedRecords=new tv),this._linkedRecords.put(i),i.currentIndex=h,i}_remove(i){return this._addToRemovals(this._unlink(i))}_unlink(i){this._linkedRecords!==null&&this._linkedRecords.remove(i);let c=i._prev,h=i._next;return c===null?this._itHead=h:c._next=h,h===null?this._itTail=c:h._prev=c,i}_addToMoves(i,c){return i.previousIndex===c||(this._movesTail===null?this._movesTail=this._movesHead=i:this._movesTail=this._movesTail._nextMoved=i),i}_addToRemovals(i){return this._unlinkedRecords===null&&(this._unlinkedRecords=new tv),this._unlinkedRecords.put(i),i.currentIndex=null,i._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=i,i._prevRemoved=null):(i._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=i),i}_addIdentityChange(i,c){return i.item=c,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=i:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=i,i}},ME=class{constructor(i,c){this.item=i,this.trackById=c,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},AE=class{constructor(){this._head=null,this._tail=null}add(i){this._head===null?(this._head=this._tail=i,i._nextDup=null,i._prevDup=null):(this._tail._nextDup=i,i._prevDup=this._tail,i._nextDup=null,this._tail=i)}get(i,c){let h;for(h=this._head;h!==null;h=h._nextDup)if((c===null||c<=h.currentIndex)&&Object.is(h.trackById,i))return h;return null}remove(i){let c=i._prevDup,h=i._nextDup;return c===null?this._head=h:c._nextDup=h,h===null?this._tail=c:h._prevDup=c,this._head===null}},tv=class{constructor(){this.map=new Map}put(i){let c=i.trackById,h=this.map.get(c);h||(h=new AE,this.map.set(c,h)),h.add(i)}get(i,c){let h=i,m=this.map.get(h);return m?m.get(i,c):null}remove(i){let c=i.trackById;return this.map.get(c).remove(i)&&this.map.delete(c),i}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function v2(o,i,c){let h=o.previousIndex;if(h===null)return h;let m=0;return c&&h<c.length&&(m=c[h]),h+i+m}var PE=class{constructor(){}supports(i){return i instanceof Map||gT(i)}create(){return new RE}},RE=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(i){let c;for(c=this._mapHead;c!==null;c=c._next)i(c)}forEachPreviousItem(i){let c;for(c=this._previousMapHead;c!==null;c=c._nextPrevious)i(c)}forEachChangedItem(i){let c;for(c=this._changesHead;c!==null;c=c._nextChanged)i(c)}forEachAddedItem(i){let c;for(c=this._additionsHead;c!==null;c=c._nextAdded)i(c)}forEachRemovedItem(i){let c;for(c=this._removalsHead;c!==null;c=c._nextRemoved)i(c)}diff(i){if(!i)i=new Map;else if(!(i instanceof Map||gT(i)))throw new gt(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let c=this._mapHead;if(this._appendAfter=null,this._forEach(i,(h,m)=>{if(c&&c.key===m)this._maybeAddToChanges(c,h),this._appendAfter=c,c=c._next;else{let r=this._getOrCreateRecordForKey(m,h);c=this._insertBeforeOrAppend(c,r)}}),c){c._prev&&(c._prev._next=null),this._removalsHead=c;for(let h=c;h!==null;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(i,c){if(i){let h=i._prev;return c._next=i,c._prev=h,i._prev=c,h&&(h._next=c),i===this._mapHead&&(this._mapHead=c),this._appendAfter=i,i}return this._appendAfter?(this._appendAfter._next=c,c._prev=this._appendAfter):this._mapHead=c,this._appendAfter=c,null}_getOrCreateRecordForKey(i,c){if(this._records.has(i)){let m=this._records.get(i);this._maybeAddToChanges(m,c);let r=m._prev,E=m._next;return r&&(r._next=E),E&&(E._prev=r),m._next=null,m._prev=null,m}let h=new OE(i);return this._records.set(i,h),h.currentValue=c,this._addToAdditions(h),h}_reset(){if(this.isDirty){let i;for(this._previousMapHead=this._mapHead,i=this._previousMapHead;i!==null;i=i._next)i._nextPrevious=i._next;for(i=this._changesHead;i!==null;i=i._nextChanged)i.previousValue=i.currentValue;for(i=this._additionsHead;i!=null;i=i._nextAdded)i.previousValue=i.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(i,c){Object.is(c,i.currentValue)||(i.previousValue=i.currentValue,i.currentValue=c,this._addToChanges(i))}_addToAdditions(i){this._additionsHead===null?this._additionsHead=this._additionsTail=i:(this._additionsTail._nextAdded=i,this._additionsTail=i)}_addToChanges(i){this._changesHead===null?this._changesHead=this._changesTail=i:(this._changesTail._nextChanged=i,this._changesTail=i)}_forEach(i,c){i instanceof Map?i.forEach(c):Object.keys(i).forEach(h=>c(i[h],h))}},OE=class{constructor(i){this.key=i,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function x2(){return new xT([new SE])}var xT=(()=>{let i=class i{constructor(h){this.factories=h}static create(h,m){if(m!=null){let r=m.factories.slice();h=h.concat(r)}return new i(h)}static extend(h){return{provide:i,useFactory:m=>i.create(h,m||x2()),deps:[[i,new Jm,new ff]]}}find(h){let m=this.factories.find(r=>r.supports(h));if(m!=null)return m;throw new gt(901,!1)}};i.\u0275prov=jt({token:i,providedIn:"root",factory:x2});let o=i;return o})();function b2(){return new Dv([new PE])}var Dv=(()=>{let i=class i{constructor(h){this.factories=h}static create(h,m){if(m){let r=m.factories.slice();h=h.concat(r)}return new i(h)}static extend(h){return{provide:i,useFactory:m=>i.create(h,m||b2()),deps:[[i,new Jm,new ff]]}}find(h){let m=this.factories.find(r=>r.supports(h));if(m)return m;throw new gt(901,!1)}};i.\u0275prov=jt({token:i,providedIn:"root",factory:b2});let o=i;return o})();function DR(o){try{let{rootComponent:i,appProviders:c,platformProviders:h}=o,m=Tj(h),r=[vj(),...c||[]],C=new J0({providers:r,parent:m,debugName:"",runEnvironmentInitializers:!1}).injector,O=C.get(Rr);return O.run(()=>{C.resolveInjectorInitializers();let z=C.get(Ka,null),Z;O.runOutsideAngular(()=>{Z=O.onError.subscribe({next:be=>{z.handleError(be)}})});let ce=()=>C.destroy(),Ie=m.get(IR);return Ie.add(ce),C.onDestroy(()=>{Z.unsubscribe(),Ie.delete(ce)}),fj(z,O,()=>{let be=C.get(TR);return be.runInitializers(),be.donePromise.then(()=>{let qe=C.get(vT,ev);ej(qe||ev);let ot=C.get(yf);return i!==void 0&&ot.bootstrap(i),ot})})})}catch(i){return Promise.reject(i)}}var OR=null;function vf(){return OR}function LR(o){OR??=o}var Sv=class{};var Xr=new gn(""),kR=(()=>{let i=class i{historyGo(h){throw new Error("")}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>Et(Rj),providedIn:"platform"});let o=i;return o})();var Rj=(()=>{let i=class i extends kR{constructor(){super(),this._doc=Et(Xr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return vf().getBaseHref(this._doc)}onPopState(h){let m=vf().getGlobalEventTarget(this._doc,"window");return m.addEventListener("popstate",h,!1),()=>m.removeEventListener("popstate",h)}onHashChange(h){let m=vf().getGlobalEventTarget(this._doc,"window");return m.addEventListener("hashchange",h,!1),()=>m.removeEventListener("hashchange",h)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(h){this._location.pathname=h}pushState(h,m,r){this._history.pushState(h,m,r)}replaceState(h,m,r){this._history.replaceState(h,m,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(h=0){this._history.go(h)}getState(){return this._history.state}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>new i,providedIn:"platform"});let o=i;return o})();function FR(o,i){if(o.length==0)return i;if(i.length==0)return o;let c=0;return o.endsWith("/")&&c++,i.startsWith("/")&&c++,c==2?o+i.substring(1):c==1?o+i:o+"/"+i}function SR(o){let i=o.match(/#|\?|$/),c=i&&i.index||o.length,h=c-(o[c-1]==="/"?1:0);return o.slice(0,h)+o.slice(c)}function fh(o){return o&&o[0]!=="?"?"?"+o:o}var Cv=(()=>{let i=class i{historyGo(h){throw new Error("")}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>Et(NR),providedIn:"root"});let o=i;return o})(),Oj=new gn(""),NR=(()=>{let i=class i extends Cv{constructor(h,m){super(),this._platformLocation=h,this._removeListenerFns=[],this._baseHref=m??this._platformLocation.getBaseHrefFromDOM()??Et(Xr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(h){this._removeListenerFns.push(this._platformLocation.onPopState(h),this._platformLocation.onHashChange(h))}getBaseHref(){return this._baseHref}prepareExternalUrl(h){return FR(this._baseHref,h)}path(h=!1){let m=this._platformLocation.pathname+fh(this._platformLocation.search),r=this._platformLocation.hash;return r&&h?`${m}${r}`:m}pushState(h,m,r,E){let C=this.prepareExternalUrl(r+fh(E));this._platformLocation.pushState(h,m,C)}replaceState(h,m,r,E){let C=this.prepareExternalUrl(r+fh(E));this._platformLocation.replaceState(h,m,C)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(h=0){this._platformLocation.historyGo?.(h)}};i.\u0275fac=function(m){return new(m||i)(cn(kR),cn(Oj,8))},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var ug=(()=>{let i=class i{constructor(h){this._subject=new $i,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=h;let m=this._locationStrategy.getBaseHref();this._basePath=Fj(SR(CR(m))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(h=!1){return this.normalize(this._locationStrategy.path(h))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(h,m=""){return this.path()==this.normalize(h+fh(m))}normalize(h){return i.stripTrailingSlash(kj(this._basePath,CR(h)))}prepareExternalUrl(h){return h&&h[0]!=="/"&&(h="/"+h),this._locationStrategy.prepareExternalUrl(h)}go(h,m="",r=null){this._locationStrategy.pushState(r,"",h,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(h+fh(m)),r)}replaceState(h,m="",r=null){this._locationStrategy.replaceState(r,"",h,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(h+fh(m)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(h=0){this._locationStrategy.historyGo?.(h)}onUrlChange(h){return this._urlChangeListeners.push(h),this._urlChangeSubscription??=this.subscribe(m=>{this._notifyUrlChangeListeners(m.url,m.state)}),()=>{let m=this._urlChangeListeners.indexOf(h);this._urlChangeListeners.splice(m,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(h="",m){this._urlChangeListeners.forEach(r=>r(h,m))}subscribe(h,m,r){return this._subject.subscribe({next:h,error:m,complete:r})}};i.normalizeQueryParams=fh,i.joinWithSlash=FR,i.stripTrailingSlash=SR,i.\u0275fac=function(m){return new(m||i)(cn(Cv))},i.\u0275prov=jt({token:i,factory:()=>Lj(),providedIn:"root"});let o=i;return o})();function Lj(){return new ug(cn(Cv))}function kj(o,i){if(!o||!i.startsWith(o))return i;let c=i.substring(o.length);return c===""||["/",";","?","#"].includes(c[0])?c:i}function CR(o){return o.replace(/\/index.html$/,"")}function Fj(o){if(new RegExp("^(https?:)?//").test(o)){let[,c]=o.split(/\/\/[^\/]+/);return c}return o}function Mv(o,i){i=encodeURIComponent(i);for(let c of o.split(";")){let h=c.indexOf("="),[m,r]=h==-1?[c,""]:[c.slice(0,h),c.slice(h+1)];if(m.trim()===i)return decodeURIComponent(r)}return null}var bT=/\s+/,MR=[],bf=(()=>{let i=class i{constructor(h,m){this._ngEl=h,this._renderer=m,this.initialClasses=MR,this.stateMap=new Map}set klass(h){this.initialClasses=h!=null?h.trim().split(bT):MR}set ngClass(h){this.rawClass=typeof h=="string"?h.trim().split(bT):h}ngDoCheck(){for(let m of this.initialClasses)this._updateState(m,!0);let h=this.rawClass;if(Array.isArray(h)||h instanceof Set)for(let m of h)this._updateState(m,!0);else if(h!=null)for(let m of Object.keys(h))this._updateState(m,!!h[m]);this._applyStateDiff()}_updateState(h,m){let r=this.stateMap.get(h);r!==void 0?(r.enabled!==m&&(r.changed=!0,r.enabled=m),r.touched=!0):this.stateMap.set(h,{enabled:m,changed:!0,touched:!0})}_applyStateDiff(){for(let h of this.stateMap){let m=h[0],r=h[1];r.changed?(this._toggleClass(m,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(m,!1),this.stateMap.delete(m)),r.touched=!1}}_toggleClass(h,m){h=h.trim(),h.length>0&&h.split(bT).forEach(r=>{m?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}};i.\u0275fac=function(m){return new(m||i)(gr(ch),gr(gf))},i.\u0275dir=wc({type:i,selectors:[["","ngClass",""]],inputs:{klass:[ia.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let o=i;return o})();var wT=class{constructor(i,c,h,m){this.$implicit=i,this.ngForOf=c,this.index=h,this.count=m}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Av=(()=>{let i=class i{set ngForOf(h){this._ngForOf=h,this._ngForOfDirty=!0}set ngForTrackBy(h){this._trackByFn=h}get ngForTrackBy(){return this._trackByFn}constructor(h,m,r){this._viewContainer=h,this._template=m,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(h){h&&(this._template=h)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let h=this._ngForOf;if(!this._differ&&h)if(0)try{}catch{}else this._differ=this._differs.find(h).create(this.ngForTrackBy)}if(this._differ){let h=this._differ.diff(this._ngForOf);h&&this._applyChanges(h)}}_applyChanges(h){let m=this._viewContainer;h.forEachOperation((r,E,C)=>{if(r.previousIndex==null)m.createEmbeddedView(this._template,new wT(r.item,this._ngForOf,-1,-1),C===null?void 0:C);else if(C==null)m.remove(E===null?void 0:E);else if(E!==null){let O=m.get(E);m.move(O,C),AR(O,r)}});for(let r=0,E=m.length;r<E;r++){let O=m.get(r).context;O.index=r,O.count=E,O.ngForOf=this._ngForOf}h.forEachIdentityChange(r=>{let E=m.get(r.currentIndex);AR(E,r)})}static ngTemplateContextGuard(h,m){return!0}};i.\u0275fac=function(m){return new(m||i)(gr(uh),gr(yv),gr(xT))},i.\u0275dir=wc({type:i,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let o=i;return o})();function AR(o,i){o.context.$implicit=i.item}var Pv=(()=>{let i=class i{constructor(h,m){this._viewContainer=h,this._context=new ET,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=m}set ngIf(h){this._context.$implicit=this._context.ngIf=h,this._updateView()}set ngIfThen(h){PR("ngIfThen",h),this._thenTemplateRef=h,this._thenViewRef=null,this._updateView()}set ngIfElse(h){PR("ngIfElse",h),this._elseTemplateRef=h,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(h,m){return!0}};i.\u0275fac=function(m){return new(m||i)(gr(uh),gr(yv))},i.\u0275dir=wc({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let o=i;return o})(),ET=class{constructor(){this.$implicit=null,this.ngIf=null}};function PR(o,i){if(!!!(!i||i.createEmbeddedView))throw new Error(`${o} must be a TemplateRef, but received '${oo(i)}'.`)}var zR=(()=>{let i=class i{constructor(h,m,r){this._ngEl=h,this._differs=m,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(h){this._ngStyle=h,!this._differ&&h&&(this._differ=this._differs.find(h).create())}ngDoCheck(){if(this._differ){let h=this._differ.diff(this._ngStyle);h&&this._applyChanges(h)}}_setStyle(h,m){let[r,E]=h.split("."),C=r.indexOf("-")===-1?void 0:Dc.DashCase;m!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,E?`${m}${E}`:m,C):this._renderer.removeStyle(this._ngEl.nativeElement,r,C)}_applyChanges(h){h.forEachRemovedItem(m=>this._setStyle(m.key,null)),h.forEachAddedItem(m=>this._setStyle(m.key,m.currentValue)),h.forEachChangedItem(m=>this._setStyle(m.key,m.currentValue))}};i.\u0275fac=function(m){return new(m||i)(gr(ch),gr(Dv),gr(gf))},i.\u0275dir=wc({type:i,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let o=i;return o})(),BR=(()=>{let i=class i{constructor(h){this._viewContainerRef=h,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(h){if(this._shouldRecreateView(h)){let m=this._viewContainerRef;if(this._viewRef&&m.remove(m.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let r=this._createContextForwardProxy();this._viewRef=m.createEmbeddedView(this.ngTemplateOutlet,r,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(h){return!!h.ngTemplateOutlet||!!h.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(h,m,r)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,m,r):!1,get:(h,m,r)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,m,r)}})}};i.\u0275fac=function(m){return new(m||i)(gr(uh))},i.\u0275dir=wc({type:i,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[eg]});let o=i;return o})();var Di=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=bc({type:i}),i.\u0275inj=xc({});let o=i;return o})(),UR="browser",Nj="server";function Rv(o){return o===Nj}var xf=class{};var dg=class{},Lv=class{},ph=class o{constructor(i){this.normalizedNames=new Map,this.lazyUpdate=null,i?typeof i=="string"?this.lazyInit=()=>{this.headers=new Map,i.split(`
`).forEach(c=>{let h=c.indexOf(":");if(h>0){let m=c.slice(0,h),r=m.toLowerCase(),E=c.slice(h+1).trim();this.maybeSetNormalizedName(m,r),this.headers.has(r)?this.headers.get(r).push(E):this.headers.set(r,[E])}})}:typeof Headers<"u"&&i instanceof Headers?(this.headers=new Map,i.forEach((c,h)=>{this.setHeaderEntries(h,c)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(i).forEach(([c,h])=>{this.setHeaderEntries(c,h)})}:this.headers=new Map}has(i){return this.init(),this.headers.has(i.toLowerCase())}get(i){this.init();let c=this.headers.get(i.toLowerCase());return c&&c.length>0?c[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(i){return this.init(),this.headers.get(i.toLowerCase())||null}append(i,c){return this.clone({name:i,value:c,op:"a"})}set(i,c){return this.clone({name:i,value:c,op:"s"})}delete(i,c){return this.clone({name:i,value:c,op:"d"})}maybeSetNormalizedName(i,c){this.normalizedNames.has(c)||this.normalizedNames.set(c,i)}init(){this.lazyInit&&(this.lazyInit instanceof o?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(i=>this.applyUpdate(i)),this.lazyUpdate=null))}copyFrom(i){i.init(),Array.from(i.headers.keys()).forEach(c=>{this.headers.set(c,i.headers.get(c)),this.normalizedNames.set(c,i.normalizedNames.get(c))})}clone(i){let c=new o;return c.lazyInit=this.lazyInit&&this.lazyInit instanceof o?this.lazyInit:this,c.lazyUpdate=(this.lazyUpdate||[]).concat([i]),c}applyUpdate(i){let c=i.name.toLowerCase();switch(i.op){case"a":case"s":let h=i.value;if(typeof h=="string"&&(h=[h]),h.length===0)return;this.maybeSetNormalizedName(i.name,c);let m=(i.op==="a"?this.headers.get(c):void 0)||[];m.push(...h),this.headers.set(c,m);break;case"d":let r=i.value;if(!r)this.headers.delete(c),this.normalizedNames.delete(c);else{let E=this.headers.get(c);if(!E)return;E=E.filter(C=>r.indexOf(C)===-1),E.length===0?(this.headers.delete(c),this.normalizedNames.delete(c)):this.headers.set(c,E)}break}}setHeaderEntries(i,c){let h=(Array.isArray(c)?c:[c]).map(r=>r.toString()),m=i.toLowerCase();this.headers.set(m,h),this.maybeSetNormalizedName(i,m)}forEach(i){this.init(),Array.from(this.normalizedNames.keys()).forEach(c=>i(this.normalizedNames.get(c),this.headers.get(c)))}};var IT=class{encodeKey(i){return VR(i)}encodeValue(i){return VR(i)}decodeKey(i){return decodeURIComponent(i)}decodeValue(i){return decodeURIComponent(i)}};function Uj(o,i){let c=new Map;return o.length>0&&o.replace(/^\?/,"").split("&").forEach(m=>{let r=m.indexOf("="),[E,C]=r==-1?[i.decodeKey(m),""]:[i.decodeKey(m.slice(0,r)),i.decodeValue(m.slice(r+1))],O=c.get(E)||[];O.push(C),c.set(E,O)}),c}var Vj=/%(\d[a-f0-9])/gi,jj={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function VR(o){return encodeURIComponent(o).replace(Vj,(i,c)=>jj[c]??i)}function Ov(o){return`${o}`}var Mc=class o{constructor(i={}){if(this.updates=null,this.cloneFrom=null,this.encoder=i.encoder||new IT,i.fromString){if(i.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=Uj(i.fromString,this.encoder)}else i.fromObject?(this.map=new Map,Object.keys(i.fromObject).forEach(c=>{let h=i.fromObject[c],m=Array.isArray(h)?h.map(Ov):[Ov(h)];this.map.set(c,m)})):this.map=null}has(i){return this.init(),this.map.has(i)}get(i){this.init();let c=this.map.get(i);return c?c[0]:null}getAll(i){return this.init(),this.map.get(i)||null}keys(){return this.init(),Array.from(this.map.keys())}append(i,c){return this.clone({param:i,value:c,op:"a"})}appendAll(i){let c=[];return Object.keys(i).forEach(h=>{let m=i[h];Array.isArray(m)?m.forEach(r=>{c.push({param:h,value:r,op:"a"})}):c.push({param:h,value:m,op:"a"})}),this.clone(c)}set(i,c){return this.clone({param:i,value:c,op:"s"})}delete(i,c){return this.clone({param:i,value:c,op:"d"})}toString(){return this.init(),this.keys().map(i=>{let c=this.encoder.encodeKey(i);return this.map.get(i).map(h=>c+"="+this.encoder.encodeValue(h)).join("&")}).filter(i=>i!=="").join("&")}clone(i){let c=new o({encoder:this.encoder});return c.cloneFrom=this.cloneFrom||this,c.updates=(this.updates||[]).concat(i),c}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(i=>this.map.set(i,this.cloneFrom.map.get(i))),this.updates.forEach(i=>{switch(i.op){case"a":case"s":let c=(i.op==="a"?this.map.get(i.param):void 0)||[];c.push(Ov(i.value)),this.map.set(i.param,c);break;case"d":if(i.value!==void 0){let h=this.map.get(i.param)||[],m=h.indexOf(Ov(i.value));m!==-1&&h.splice(m,1),h.length>0?this.map.set(i.param,h):this.map.delete(i.param)}else{this.map.delete(i.param);break}}}),this.cloneFrom=this.updates=null)}};var DT=class{constructor(){this.map=new Map}set(i,c){return this.map.set(i,c),this}get(i){return this.map.has(i)||this.map.set(i,i.defaultValue()),this.map.get(i)}delete(i){return this.map.delete(i),this}has(i){return this.map.has(i)}keys(){return this.map.keys()}};function $j(o){switch(o){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function jR(o){return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer}function $R(o){return typeof Blob<"u"&&o instanceof Blob}function GR(o){return typeof FormData<"u"&&o instanceof FormData}function Gj(o){return typeof URLSearchParams<"u"&&o instanceof URLSearchParams}var hg=class o{constructor(i,c,h,m){this.url=c,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=i.toUpperCase();let r;if($j(this.method)||m?(this.body=h!==void 0?h:null,r=m):r=h,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new ph,this.context??=new DT,!this.params)this.params=new Mc,this.urlWithParams=c;else{let E=this.params.toString();if(E.length===0)this.urlWithParams=c;else{let C=c.indexOf("?"),O=C===-1?"?":C<c.length-1?"&":"";this.urlWithParams=c+O+E}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||jR(this.body)||$R(this.body)||GR(this.body)||Gj(this.body)?this.body:this.body instanceof Mc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||GR(this.body)?null:$R(this.body)?this.body.type||null:jR(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Mc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(i={}){let c=i.method||this.method,h=i.url||this.url,m=i.responseType||this.responseType,r=i.transferCache??this.transferCache,E=i.body!==void 0?i.body:this.body,C=i.withCredentials??this.withCredentials,O=i.reportProgress??this.reportProgress,z=i.headers||this.headers,Z=i.params||this.params,ce=i.context??this.context;return i.setHeaders!==void 0&&(z=Object.keys(i.setHeaders).reduce((Ie,be)=>Ie.set(be,i.setHeaders[be]),z)),i.setParams&&(Z=Object.keys(i.setParams).reduce((Ie,be)=>Ie.set(be,i.setParams[be]),Z)),new o(c,h,E,{params:Z,headers:z,context:ce,reportProgress:O,responseType:m,withCredentials:C,transferCache:r})}},Ef=function(o){return o[o.Sent=0]="Sent",o[o.UploadProgress=1]="UploadProgress",o[o.ResponseHeader=2]="ResponseHeader",o[o.DownloadProgress=3]="DownloadProgress",o[o.Response=4]="Response",o[o.User=5]="User",o}(Ef||{}),fg=class{constructor(i,c=Nv.Ok,h="OK"){this.headers=i.headers||new ph,this.status=i.status!==void 0?i.status:c,this.statusText=i.statusText||h,this.url=i.url||null,this.ok=this.status>=200&&this.status<300}},ST=class o extends fg{constructor(i={}){super(i),this.type=Ef.ResponseHeader}clone(i={}){return new o({headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},kv=class o extends fg{constructor(i={}){super(i),this.type=Ef.Response,this.body=i.body!==void 0?i.body:null}clone(i={}){return new o({body:i.body!==void 0?i.body:this.body,headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},Fv=class extends fg{constructor(i){super(i,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${i.url||"(unknown url)"}`:this.message=`Http failure response for ${i.url||"(unknown url)"}: ${i.status} ${i.statusText}`,this.error=i.error||null}},Nv=function(o){return o[o.Continue=100]="Continue",o[o.SwitchingProtocols=101]="SwitchingProtocols",o[o.Processing=102]="Processing",o[o.EarlyHints=103]="EarlyHints",o[o.Ok=200]="Ok",o[o.Created=201]="Created",o[o.Accepted=202]="Accepted",o[o.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",o[o.NoContent=204]="NoContent",o[o.ResetContent=205]="ResetContent",o[o.PartialContent=206]="PartialContent",o[o.MultiStatus=207]="MultiStatus",o[o.AlreadyReported=208]="AlreadyReported",o[o.ImUsed=226]="ImUsed",o[o.MultipleChoices=300]="MultipleChoices",o[o.MovedPermanently=301]="MovedPermanently",o[o.Found=302]="Found",o[o.SeeOther=303]="SeeOther",o[o.NotModified=304]="NotModified",o[o.UseProxy=305]="UseProxy",o[o.Unused=306]="Unused",o[o.TemporaryRedirect=307]="TemporaryRedirect",o[o.PermanentRedirect=308]="PermanentRedirect",o[o.BadRequest=400]="BadRequest",o[o.Unauthorized=401]="Unauthorized",o[o.PaymentRequired=402]="PaymentRequired",o[o.Forbidden=403]="Forbidden",o[o.NotFound=404]="NotFound",o[o.MethodNotAllowed=405]="MethodNotAllowed",o[o.NotAcceptable=406]="NotAcceptable",o[o.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",o[o.RequestTimeout=408]="RequestTimeout",o[o.Conflict=409]="Conflict",o[o.Gone=410]="Gone",o[o.LengthRequired=411]="LengthRequired",o[o.PreconditionFailed=412]="PreconditionFailed",o[o.PayloadTooLarge=413]="PayloadTooLarge",o[o.UriTooLong=414]="UriTooLong",o[o.UnsupportedMediaType=415]="UnsupportedMediaType",o[o.RangeNotSatisfiable=416]="RangeNotSatisfiable",o[o.ExpectationFailed=417]="ExpectationFailed",o[o.ImATeapot=418]="ImATeapot",o[o.MisdirectedRequest=421]="MisdirectedRequest",o[o.UnprocessableEntity=422]="UnprocessableEntity",o[o.Locked=423]="Locked",o[o.FailedDependency=424]="FailedDependency",o[o.TooEarly=425]="TooEarly",o[o.UpgradeRequired=426]="UpgradeRequired",o[o.PreconditionRequired=428]="PreconditionRequired",o[o.TooManyRequests=429]="TooManyRequests",o[o.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",o[o.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",o[o.InternalServerError=500]="InternalServerError",o[o.NotImplemented=501]="NotImplemented",o[o.BadGateway=502]="BadGateway",o[o.ServiceUnavailable=503]="ServiceUnavailable",o[o.GatewayTimeout=504]="GatewayTimeout",o[o.HttpVersionNotSupported=505]="HttpVersionNotSupported",o[o.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",o[o.InsufficientStorage=507]="InsufficientStorage",o[o.LoopDetected=508]="LoopDetected",o[o.NotExtended=510]="NotExtended",o[o.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",o}(Nv||{});function TT(o,i){return{body:i,headers:o.headers,context:o.context,observe:o.observe,params:o.params,reportProgress:o.reportProgress,responseType:o.responseType,withCredentials:o.withCredentials,transferCache:o.transferCache}}var CT=(()=>{let i=class i{constructor(h){this.handler=h}request(h,m,r={}){let E;if(h instanceof hg)E=h;else{let z;r.headers instanceof ph?z=r.headers:z=new ph(r.headers);let Z;r.params&&(r.params instanceof Mc?Z=r.params:Z=new Mc({fromObject:r.params})),E=new hg(h,m,r.body!==void 0?r.body:null,{headers:z,context:r.context,params:Z,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let C=ln(E).pipe(fc(z=>this.handler.handle(z)));if(h instanceof hg||r.observe==="events")return C;let O=C.pipe(wo(z=>z instanceof kv));switch(r.observe||"body"){case"body":switch(E.responseType){case"arraybuffer":return O.pipe(Pn(z=>{if(z.body!==null&&!(z.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return z.body}));case"blob":return O.pipe(Pn(z=>{if(z.body!==null&&!(z.body instanceof Blob))throw new Error("Response is not a Blob.");return z.body}));case"text":return O.pipe(Pn(z=>{if(z.body!==null&&typeof z.body!="string")throw new Error("Response is not a string.");return z.body}));case"json":default:return O.pipe(Pn(z=>z.body))}case"response":return O;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(h,m={}){return this.request("DELETE",h,m)}get(h,m={}){return this.request("GET",h,m)}head(h,m={}){return this.request("HEAD",h,m)}jsonp(h,m){return this.request("JSONP",h,{params:new Mc().append(m,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(h,m={}){return this.request("OPTIONS",h,m)}patch(h,m,r={}){return this.request("PATCH",h,TT(r,m))}post(h,m,r={}){return this.request("POST",h,TT(r,m))}put(h,m,r={}){return this.request("PUT",h,TT(r,m))}};i.\u0275fac=function(m){return new(m||i)(cn(dg))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})();function ZR(o,i){return i(o)}function qj(o,i){return(c,h)=>i.intercept(c,{handle:m=>o(m,h)})}function Hj(o,i,c){return(h,m)=>Qa(c,()=>i(h,r=>o(r,m)))}var Wj=new gn(""),MT=new gn(""),Zj=new gn(""),Yj=new gn("");function Xj(){let o=null;return(i,c)=>{o===null&&(o=(Et(Wj,{optional:!0})??[]).reduceRight(qj,ZR));let h=Et(hh),m=h.add();return o(i,c).pipe(Qs(()=>h.remove(m)))}}var qR=(()=>{let i=class i extends dg{constructor(h,m){super(),this.backend=h,this.injector=m,this.chain=null,this.pendingTasks=Et(hh);let r=Et(Yj,{optional:!0});this.backend=r??h}handle(h){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(MT),...this.injector.get(Zj,[])]));this.chain=r.reduceRight((E,C)=>Hj(E,C,this.injector),ZR)}let m=this.pendingTasks.add();return this.chain(h,r=>this.backend.handle(r)).pipe(Qs(()=>this.pendingTasks.remove(m)))}};i.\u0275fac=function(m){return new(m||i)(cn(Lv),cn(so))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})();var Kj=/^\)\]\}',?\n/;function Qj(o){return"responseURL"in o&&o.responseURL?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):null}var HR=(()=>{let i=class i{constructor(h){this.xhrFactory=h}handle(h){if(h.method==="JSONP")throw new gt(-2800,!1);let m=this.xhrFactory;return(m.\u0275loadImpl?zr(m.\u0275loadImpl()):ln(null)).pipe(Eo(()=>new rr(E=>{let C=m.build();if(C.open(h.method,h.urlWithParams),h.withCredentials&&(C.withCredentials=!0),h.headers.forEach((dt,ct)=>C.setRequestHeader(dt,ct.join(","))),h.headers.has("Accept")||C.setRequestHeader("Accept","application/json, text/plain, */*"),!h.headers.has("Content-Type")){let dt=h.detectContentTypeHeader();dt!==null&&C.setRequestHeader("Content-Type",dt)}if(h.responseType){let dt=h.responseType.toLowerCase();C.responseType=dt!=="json"?dt:"text"}let O=h.serializeBody(),z=null,Z=()=>{if(z!==null)return z;let dt=C.statusText||"OK",ct=new ph(C.getAllResponseHeaders()),bt=Qj(C)||h.url;return z=new ST({headers:ct,status:C.status,statusText:dt,url:bt}),z},ce=()=>{let{headers:dt,status:ct,statusText:bt,url:St}=Z(),$t=null;ct!==Nv.NoContent&&($t=typeof C.response>"u"?C.responseText:C.response),ct===0&&(ct=$t?Nv.Ok:0);let dr=ct>=200&&ct<300;if(h.responseType==="json"&&typeof $t=="string"){let Xn=$t;$t=$t.replace(Kj,"");try{$t=$t!==""?JSON.parse($t):null}catch(ir){$t=Xn,dr&&(dr=!1,$t={error:ir,text:$t})}}dr?(E.next(new kv({body:$t,headers:dt,status:ct,statusText:bt,url:St||void 0})),E.complete()):E.error(new Fv({error:$t,headers:dt,status:ct,statusText:bt,url:St||void 0}))},Ie=dt=>{let{url:ct}=Z(),bt=new Fv({error:dt,status:C.status||0,statusText:C.statusText||"Unknown Error",url:ct||void 0});E.error(bt)},be=!1,qe=dt=>{be||(E.next(Z()),be=!0);let ct={type:Ef.DownloadProgress,loaded:dt.loaded};dt.lengthComputable&&(ct.total=dt.total),h.responseType==="text"&&C.responseText&&(ct.partialText=C.responseText),E.next(ct)},ot=dt=>{let ct={type:Ef.UploadProgress,loaded:dt.loaded};dt.lengthComputable&&(ct.total=dt.total),E.next(ct)};return C.addEventListener("load",ce),C.addEventListener("error",Ie),C.addEventListener("timeout",Ie),C.addEventListener("abort",Ie),h.reportProgress&&(C.addEventListener("progress",qe),O!==null&&C.upload&&C.upload.addEventListener("progress",ot)),C.send(O),E.next({type:Ef.Sent}),()=>{C.removeEventListener("error",Ie),C.removeEventListener("abort",Ie),C.removeEventListener("load",ce),C.removeEventListener("timeout",Ie),h.reportProgress&&(C.removeEventListener("progress",qe),O!==null&&C.upload&&C.upload.removeEventListener("progress",ot)),C.readyState!==C.DONE&&C.abort()}})))}};i.\u0275fac=function(m){return new(m||i)(cn(xf))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),YR=new gn(""),Jj="XSRF-TOKEN",e6=new gn("",{providedIn:"root",factory:()=>Jj}),t6="X-XSRF-TOKEN",n6=new gn("",{providedIn:"root",factory:()=>t6}),zv=class{},r6=(()=>{let i=class i{constructor(h,m,r){this.doc=h,this.platform=m,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let h=this.doc.cookie||"";return h!==this.lastCookieString&&(this.parseCount++,this.lastToken=Mv(h,this.cookieName),this.lastCookieString=h),this.lastToken}};i.\u0275fac=function(m){return new(m||i)(cn(Xr),cn(Ic),cn(e6))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})();function i6(o,i){let c=o.url.toLowerCase();if(!Et(YR)||o.method==="GET"||o.method==="HEAD"||c.startsWith("http://")||c.startsWith("https://"))return i(o);let h=Et(zv).getToken(),m=Et(n6);return h!=null&&!o.headers.has(m)&&(o=o.clone({headers:o.headers.set(m,h)})),i(o)}var XR=function(o){return o[o.Interceptors=0]="Interceptors",o[o.LegacyInterceptors=1]="LegacyInterceptors",o[o.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",o[o.NoXsrfProtection=3]="NoXsrfProtection",o[o.JsonpSupport=4]="JsonpSupport",o[o.RequestsMadeViaParent=5]="RequestsMadeViaParent",o[o.Fetch=6]="Fetch",o}(XR||{});function o6(o,i){return{\u0275kind:o,\u0275providers:i}}function s6(...o){let i=[CT,HR,qR,{provide:dg,useExisting:qR},{provide:Lv,useExisting:HR},{provide:MT,useValue:i6,multi:!0},{provide:YR,useValue:!0},{provide:zv,useClass:r6}];for(let c of o)i.push(...c.\u0275providers);return Ec(i)}var WR=new gn("");function a6(){return o6(XR.LegacyInterceptors,[{provide:WR,useFactory:Xj},{provide:MT,useExisting:WR,multi:!0}])}var KR=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=bc({type:i}),i.\u0275inj=xc({providers:[s6(a6())]});let o=i;return o})();var RT=class extends Sv{constructor(){super(...arguments),this.supportsDOMEvents=!0}},OT=class o extends RT{static makeCurrent(){LR(new o)}onAndCancel(i,c,h){return i.addEventListener(c,h),()=>{i.removeEventListener(c,h)}}dispatchEvent(i,c){i.dispatchEvent(c)}remove(i){i.parentNode&&i.parentNode.removeChild(i)}createElement(i,c){return c=c||this.getDefaultDocument(),c.createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,c){return c==="window"?window:c==="document"?i:c==="body"?i.body:null}getBaseHref(i){let c=c6();return c==null?null:u6(c)}resetBaseElement(){pg=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return Mv(document.cookie,i)}},pg=null;function c6(){return pg=pg||document.querySelector("base"),pg?pg.getAttribute("href"):null}function u6(o){return new URL(o,document.baseURI).pathname}var h6=(()=>{let i=class i{build(){return new XMLHttpRequest}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),LT=new gn(""),eO=(()=>{let i=class i{constructor(h,m){this._zone=m,this._eventNameToPlugin=new Map,h.forEach(r=>{r.manager=this}),this._plugins=h.slice().reverse()}addEventListener(h,m,r){return this._findPluginFor(m).addEventListener(h,m,r)}getZone(){return this._zone}_findPluginFor(h){let m=this._eventNameToPlugin.get(h);if(m)return m;if(m=this._plugins.find(E=>E.supports(h)),!m)throw new gt(5101,!1);return this._eventNameToPlugin.set(h,m),m}};i.\u0275fac=function(m){return new(m||i)(cn(LT),cn(Rr))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),Bv=class{constructor(i){this._doc=i}},AT="ng-app-id",tO=(()=>{let i=class i{constructor(h,m,r,E={}){this.doc=h,this.appId=m,this.nonce=r,this.platformId=E,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Rv(E),this.resetHostNodes()}addStyles(h){for(let m of h)this.changeUsageCount(m,1)===1&&this.onStyleAdded(m)}removeStyles(h){for(let m of h)this.changeUsageCount(m,-1)<=0&&this.onStyleRemoved(m)}ngOnDestroy(){let h=this.styleNodesInDOM;h&&(h.forEach(m=>m.remove()),h.clear());for(let m of this.getAllStyles())this.onStyleRemoved(m);this.resetHostNodes()}addHost(h){this.hostNodes.add(h);for(let m of this.getAllStyles())this.addStyleToHost(h,m)}removeHost(h){this.hostNodes.delete(h)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(h){for(let m of this.hostNodes)this.addStyleToHost(m,h)}onStyleRemoved(h){let m=this.styleRef;m.get(h)?.elements?.forEach(r=>r.remove()),m.delete(h)}collectServerRenderedStyles(){let h=this.doc.head?.querySelectorAll(`style[${AT}="${this.appId}"]`);if(h?.length){let m=new Map;return h.forEach(r=>{r.textContent!=null&&m.set(r.textContent,r)}),m}return null}changeUsageCount(h,m){let r=this.styleRef;if(r.has(h)){let E=r.get(h);return E.usage+=m,E.usage}return r.set(h,{usage:m,elements:[]}),m}getStyleElement(h,m){let r=this.styleNodesInDOM,E=r?.get(m);if(E?.parentNode===h)return r.delete(m),E.removeAttribute(AT),E;{let C=this.doc.createElement("style");return this.nonce&&C.setAttribute("nonce",this.nonce),C.textContent=m,this.platformIsServer&&C.setAttribute(AT,this.appId),h.appendChild(C),C}}addStyleToHost(h,m){let r=this.getStyleElement(h,m),E=this.styleRef,C=E.get(m)?.elements;C?C.push(r):E.set(m,{elements:[r],usage:1})}resetHostNodes(){let h=this.hostNodes;h.clear(),h.add(this.doc.head)}};i.\u0275fac=function(m){return new(m||i)(cn(Xr),cn(YE),cn(QE,8),cn(Ic))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),PT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},FT=/%COMP%/g,nO="%COMP%",d6=`_nghost-${nO}`,f6=`_ngcontent-${nO}`,p6=!0,m6=new gn("",{providedIn:"root",factory:()=>p6});function g6(o){return f6.replace(FT,o)}function _6(o){return d6.replace(FT,o)}function rO(o,i){return i.map(c=>c.replace(FT,o))}var Uv=(()=>{let i=class i{constructor(h,m,r,E,C,O,z,Z=null){this.eventManager=h,this.sharedStylesHost=m,this.appId=r,this.removeStylesOnCompDestroy=E,this.doc=C,this.platformId=O,this.ngZone=z,this.nonce=Z,this.rendererByCompId=new Map,this.platformIsServer=Rv(O),this.defaultRenderer=new mg(h,C,z,this.platformIsServer)}createRenderer(h,m){if(!h||!m)return this.defaultRenderer;this.platformIsServer&&m.encapsulation===ra.ShadowDom&&(m=Tr(xt({},m),{encapsulation:ra.Emulated}));let r=this.getOrCreateRenderer(h,m);return r instanceof Vv?r.applyToHost(h):r instanceof gg&&r.applyStyles(),r}getOrCreateRenderer(h,m){let r=this.rendererByCompId,E=r.get(m.id);if(!E){let C=this.doc,O=this.ngZone,z=this.eventManager,Z=this.sharedStylesHost,ce=this.removeStylesOnCompDestroy,Ie=this.platformIsServer;switch(m.encapsulation){case ra.Emulated:E=new Vv(z,Z,m,this.appId,ce,C,O,Ie);break;case ra.ShadowDom:return new kT(z,Z,h,m,C,O,this.nonce,Ie);default:E=new gg(z,Z,m,ce,C,O,Ie);break}r.set(m.id,E)}return E}ngOnDestroy(){this.rendererByCompId.clear()}};i.\u0275fac=function(m){return new(m||i)(cn(eO),cn(tO),cn(YE),cn(m6),cn(Xr),cn(Ic),cn(Rr),cn(QE))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),mg=class{constructor(i,c,h,m){this.eventManager=i,this.doc=c,this.ngZone=h,this.platformIsServer=m,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(i,c){return c?this.doc.createElementNS(PT[c]||c,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,c){(QR(i)?i.content:i).appendChild(c)}insertBefore(i,c,h){i&&(QR(i)?i.content:i).insertBefore(c,h)}removeChild(i,c){i&&i.removeChild(c)}selectRootElement(i,c){let h=typeof i=="string"?this.doc.querySelector(i):i;if(!h)throw new gt(-5104,!1);return c||(h.textContent=""),h}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,c,h,m){if(m){c=m+":"+c;let r=PT[m];r?i.setAttributeNS(r,c,h):i.setAttribute(c,h)}else i.setAttribute(c,h)}removeAttribute(i,c,h){if(h){let m=PT[h];m?i.removeAttributeNS(m,c):i.removeAttribute(`${h}:${c}`)}else i.removeAttribute(c)}addClass(i,c){i.classList.add(c)}removeClass(i,c){i.classList.remove(c)}setStyle(i,c,h,m){m&(Dc.DashCase|Dc.Important)?i.style.setProperty(c,h,m&Dc.Important?"important":""):i.style[c]=h}removeStyle(i,c,h){h&Dc.DashCase?i.style.removeProperty(c):i.style[c]=""}setProperty(i,c,h){i!=null&&(i[c]=h)}setValue(i,c){i.nodeValue=c}listen(i,c,h){if(typeof i=="string"&&(i=vf().getGlobalEventTarget(this.doc,i),!i))throw new Error(`Unsupported event target ${i} for event ${c}`);return this.eventManager.addEventListener(i,c,this.decoratePreventDefault(h))}decoratePreventDefault(i){return c=>{if(c==="__ngUnwrap__")return i;(this.platformIsServer?this.ngZone.runGuarded(()=>i(c)):i(c))===!1&&c.preventDefault()}}};function QR(o){return o.tagName==="TEMPLATE"&&o.content!==void 0}var kT=class extends mg{constructor(i,c,h,m,r,E,C,O){super(i,r,E,O),this.sharedStylesHost=c,this.hostEl=h,this.shadowRoot=h.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let z=rO(m.id,m.styles);for(let Z of z){let ce=document.createElement("style");C&&ce.setAttribute("nonce",C),ce.textContent=Z,this.shadowRoot.appendChild(ce)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,c){return super.appendChild(this.nodeOrShadowRoot(i),c)}insertBefore(i,c,h){return super.insertBefore(this.nodeOrShadowRoot(i),c,h)}removeChild(i,c){return super.removeChild(this.nodeOrShadowRoot(i),c)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},gg=class extends mg{constructor(i,c,h,m,r,E,C,O){super(i,r,E,C),this.sharedStylesHost=c,this.removeStylesOnCompDestroy=m,this.styles=O?rO(O,h.styles):h.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Vv=class extends gg{constructor(i,c,h,m,r,E,C,O){let z=m+"-"+h.id;super(i,c,h,r,E,C,O,z),this.contentAttr=g6(z),this.hostAttr=_6(z)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,c){let h=super.createElement(i,c);return super.setAttribute(h,this.contentAttr,""),h}},y6=(()=>{let i=class i extends Bv{constructor(h){super(h)}supports(h){return!0}addEventListener(h,m,r){return h.addEventListener(m,r,!1),()=>this.removeEventListener(h,m,r)}removeEventListener(h,m,r){return h.removeEventListener(m,r)}};i.\u0275fac=function(m){return new(m||i)(cn(Xr))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),JR=["alt","control","meta","shift"],v6={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},x6={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey},b6=(()=>{let i=class i extends Bv{constructor(h){super(h)}supports(h){return i.parseEventName(h)!=null}addEventListener(h,m,r){let E=i.parseEventName(m),C=i.eventCallback(E.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>vf().onAndCancel(h,E.domEventName,C))}static parseEventName(h){let m=h.toLowerCase().split("."),r=m.shift();if(m.length===0||!(r==="keydown"||r==="keyup"))return null;let E=i._normalizeKey(m.pop()),C="",O=m.indexOf("code");if(O>-1&&(m.splice(O,1),C="code."),JR.forEach(Z=>{let ce=m.indexOf(Z);ce>-1&&(m.splice(ce,1),C+=Z+".")}),C+=E,m.length!=0||E.length===0)return null;let z={};return z.domEventName=r,z.fullKey=C,z}static matchEventFullKeyCode(h,m){let r=v6[h.key]||h.key,E="";return m.indexOf("code.")>-1&&(r=h.code,E="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),JR.forEach(C=>{if(C!==r){let O=x6[C];O(h)&&(E+=C+".")}}),E+=r,E===m)}static eventCallback(h,m,r){return E=>{i.matchEventFullKeyCode(E,h)&&r.runGuarded(()=>m(E))}}static _normalizeKey(h){return h==="esc"?"escape":h}};i.\u0275fac=function(m){return new(m||i)(cn(Xr))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})();function iO(o,i){return DR(xt({rootComponent:o},w6(i)))}function w6(o){return{appProviders:[...S6,...o?.providers??[]],platformProviders:D6}}function E6(){OT.makeCurrent()}function T6(){return new Ka}function I6(){return kP(document),document}var D6=[{provide:Ic,useValue:UR},{provide:XE,useValue:E6,multi:!0},{provide:Xr,useFactory:I6,deps:[]}];var S6=[{provide:ov,useValue:"root"},{provide:Ka,useFactory:T6,deps:[]},{provide:LT,useClass:y6,multi:!0,deps:[Xr,Rr,Ic]},{provide:LT,useClass:b6,multi:!0,deps:[Xr]},Uv,tO,eO,{provide:oh,useExisting:Uv},{provide:xf,useClass:h6,deps:[]},[]];var oO=(()=>{let i=class i{constructor(h){this._doc=h}getTitle(){return this._doc.title}setTitle(h){this._doc.title=h||""}};i.\u0275fac=function(m){return new(m||i)(cn(Xr))},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Rn="primary",Pg=Symbol("RouteTitle"),VT=class{constructor(i){this.params=i||{}}has(i){return Object.prototype.hasOwnProperty.call(this.params,i)}get(i){if(this.has(i)){let c=this.params[i];return Array.isArray(c)?c[0]:c}return null}getAll(i){if(this.has(i)){let c=this.params[i];return Array.isArray(c)?c:[c]}return[]}get keys(){return Object.keys(this.params)}};function Cf(o){return new VT(o)}function M6(o,i,c){let h=c.path.split("/");if(h.length>o.length||c.pathMatch==="full"&&(i.hasChildren()||h.length<o.length))return null;let m={};for(let r=0;r<h.length;r++){let E=h[r],C=o[r];if(E.startsWith(":"))m[E.substring(1)]=C;else if(E!==C.path)return null}return{consumed:o.slice(0,h.length),posParams:m}}function A6(o,i){if(o.length!==i.length)return!1;for(let c=0;c<o.length;++c)if(!ca(o[c],i[c]))return!1;return!0}function ca(o,i){let c=o?jT(o):void 0,h=i?jT(i):void 0;if(!c||!h||c.length!=h.length)return!1;let m;for(let r=0;r<c.length;r++)if(m=c[r],!hO(o[m],i[m]))return!1;return!0}function jT(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function hO(o,i){if(Array.isArray(o)&&Array.isArray(i)){if(o.length!==i.length)return!1;let c=[...o].sort(),h=[...i].sort();return c.every((m,r)=>h[r]===m)}else return o===i}function dO(o){return o.length>0?o[o.length-1]:null}function Rc(o){return Cw(o)?o:lg(o)?zr(Promise.resolve(o)):ln(o)}var P6={exact:pO,subset:mO},fO={exact:R6,subset:O6,ignored:()=>!0};function sO(o,i,c){return P6[c.paths](o.root,i.root,c.matrixParams)&&fO[c.queryParams](o.queryParams,i.queryParams)&&!(c.fragment==="exact"&&o.fragment!==i.fragment)}function R6(o,i){return ca(o,i)}function pO(o,i,c){if(!gh(o.segments,i.segments)||!Gv(o.segments,i.segments,c)||o.numberOfChildren!==i.numberOfChildren)return!1;for(let h in i.children)if(!o.children[h]||!pO(o.children[h],i.children[h],c))return!1;return!0}function O6(o,i){return Object.keys(i).length<=Object.keys(o).length&&Object.keys(i).every(c=>hO(o[c],i[c]))}function mO(o,i,c){return gO(o,i,i.segments,c)}function gO(o,i,c,h){if(o.segments.length>c.length){let m=o.segments.slice(0,c.length);return!(!gh(m,c)||i.hasChildren()||!Gv(m,c,h))}else if(o.segments.length===c.length){if(!gh(o.segments,c)||!Gv(o.segments,c,h))return!1;for(let m in i.children)if(!o.children[m]||!mO(o.children[m],i.children[m],h))return!1;return!0}else{let m=c.slice(0,o.segments.length),r=c.slice(o.segments.length);return!gh(o.segments,m)||!Gv(o.segments,m,h)||!o.children[Rn]?!1:gO(o.children[Rn],i,r,h)}}function Gv(o,i,c){return i.every((h,m)=>fO[c](o[m].parameters,h.parameters))}var Ac=class{constructor(i=new cr([],{}),c={},h=null){this.root=i,this.queryParams=c,this.fragment=h}get queryParamMap(){return this._queryParamMap??=Cf(this.queryParams),this._queryParamMap}toString(){return F6.serialize(this)}},cr=class{constructor(i,c){this.segments=i,this.children=c,this.parent=null,Object.values(c).forEach(h=>h.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return qv(this)}},mh=class{constructor(i,c){this.path=i,this.parameters=c}get parameterMap(){return this._parameterMap??=Cf(this.parameters),this._parameterMap}toString(){return yO(this)}};function L6(o,i){return gh(o,i)&&o.every((c,h)=>ca(c.parameters,i[h].parameters))}function gh(o,i){return o.length!==i.length?!1:o.every((c,h)=>c.path===i[h].path)}function k6(o,i){let c=[];return Object.entries(o.children).forEach(([h,m])=>{h===Rn&&(c=c.concat(i(m,h)))}),Object.entries(o.children).forEach(([h,m])=>{h!==Rn&&(c=c.concat(i(m,h)))}),c}var pI=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>new Wv,providedIn:"root"});let o=i;return o})(),Wv=class{parse(i){let c=new GT(i);return new Ac(c.parseRootSegment(),c.parseQueryParams(),c.parseFragment())}serialize(i){let c=`/${_g(i.root,!0)}`,h=B6(i.queryParams),m=typeof i.fragment=="string"?`#${N6(i.fragment)}`:"";return`${c}${h}${m}`}},F6=new Wv;function qv(o){return o.segments.map(i=>yO(i)).join("/")}function _g(o,i){if(!o.hasChildren())return qv(o);if(i){let c=o.children[Rn]?_g(o.children[Rn],!1):"",h=[];return Object.entries(o.children).forEach(([m,r])=>{m!==Rn&&h.push(`${m}:${_g(r,!1)}`)}),h.length>0?`${c}(${h.join("//")})`:c}else{let c=k6(o,(h,m)=>m===Rn?[_g(o.children[Rn],!1)]:[`${m}:${_g(h,!1)}`]);return Object.keys(o.children).length===1&&o.children[Rn]!=null?`${qv(o)}/${c[0]}`:`${qv(o)}/(${c.join("//")})`}}function _O(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function jv(o){return _O(o).replace(/%3B/gi,";")}function N6(o){return encodeURI(o)}function $T(o){return _O(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Hv(o){return decodeURIComponent(o)}function aO(o){return Hv(o.replace(/\+/g,"%20"))}function yO(o){return`${$T(o.path)}${z6(o.parameters)}`}function z6(o){return Object.entries(o).map(([i,c])=>`;${$T(i)}=${$T(c)}`).join("")}function B6(o){let i=Object.entries(o).map(([c,h])=>Array.isArray(h)?h.map(m=>`${jv(c)}=${jv(m)}`).join("&"):`${jv(c)}=${jv(h)}`).filter(c=>c);return i.length?`?${i.join("&")}`:""}var U6=/^[^\/()?;#]+/;function NT(o){let i=o.match(U6);return i?i[0]:""}var V6=/^[^\/()?;=#]+/;function j6(o){let i=o.match(V6);return i?i[0]:""}var $6=/^[^=?&#]+/;function G6(o){let i=o.match($6);return i?i[0]:""}var q6=/^[^&#]+/;function H6(o){let i=o.match(q6);return i?i[0]:""}var GT=class{constructor(i){this.url=i,this.remaining=i}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new cr([],{}):new cr([],this.parseChildren())}parseQueryParams(){let i={};if(this.consumeOptional("?"))do this.parseQueryParam(i);while(this.consumeOptional("&"));return i}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let i=[];for(this.peekStartsWith("(")||i.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),i.push(this.parseSegment());let c={};this.peekStartsWith("/(")&&(this.capture("/"),c=this.parseParens(!0));let h={};return this.peekStartsWith("(")&&(h=this.parseParens(!1)),(i.length>0||Object.keys(c).length>0)&&(h[Rn]=new cr(i,c)),h}parseSegment(){let i=NT(this.remaining);if(i===""&&this.peekStartsWith(";"))throw new gt(4009,!1);return this.capture(i),new mh(Hv(i),this.parseMatrixParams())}parseMatrixParams(){let i={};for(;this.consumeOptional(";");)this.parseParam(i);return i}parseParam(i){let c=j6(this.remaining);if(!c)return;this.capture(c);let h="";if(this.consumeOptional("=")){let m=NT(this.remaining);m&&(h=m,this.capture(h))}i[Hv(c)]=Hv(h)}parseQueryParam(i){let c=G6(this.remaining);if(!c)return;this.capture(c);let h="";if(this.consumeOptional("=")){let E=H6(this.remaining);E&&(h=E,this.capture(h))}let m=aO(c),r=aO(h);if(i.hasOwnProperty(m)){let E=i[m];Array.isArray(E)||(E=[E],i[m]=E),E.push(r)}else i[m]=r}parseParens(i){let c={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let h=NT(this.remaining),m=this.remaining[h.length];if(m!=="/"&&m!==")"&&m!==";")throw new gt(4010,!1);let r;h.indexOf(":")>-1?(r=h.slice(0,h.indexOf(":")),this.capture(r),this.capture(":")):i&&(r=Rn);let E=this.parseChildren();c[r]=Object.keys(E).length===1?E[Rn]:new cr([],E),this.consumeOptional("//")}return c}peekStartsWith(i){return this.remaining.startsWith(i)}consumeOptional(i){return this.peekStartsWith(i)?(this.remaining=this.remaining.substring(i.length),!0):!1}capture(i){if(!this.consumeOptional(i))throw new gt(4011,!1)}};function vO(o){return o.segments.length>0?new cr([],{[Rn]:o}):o}function xO(o){let i={};for(let[h,m]of Object.entries(o.children)){let r=xO(m);if(h===Rn&&r.segments.length===0&&r.hasChildren())for(let[E,C]of Object.entries(r.children))i[E]=C;else(r.segments.length>0||r.hasChildren())&&(i[h]=r)}let c=new cr(o.segments,i);return W6(c)}function W6(o){if(o.numberOfChildren===1&&o.children[Rn]){let i=o.children[Rn];return new cr(o.segments.concat(i.segments),i.children)}return o}function Mf(o){return o instanceof Ac}function Z6(o,i,c=null,h=null){let m=bO(o);return wO(m,i,c,h)}function bO(o){let i;function c(r){let E={};for(let O of r.children){let z=c(O);E[O.outlet]=z}let C=new cr(r.url,E);return r===o&&(i=C),C}let h=c(o.root),m=vO(h);return i??m}function wO(o,i,c,h){let m=o;for(;m.parent;)m=m.parent;if(i.length===0)return zT(m,m,m,c,h);let r=Y6(i);if(r.toRoot())return zT(m,m,new cr([],{}),c,h);let E=X6(r,m,o),C=E.processChildren?xg(E.segmentGroup,E.index,r.commands):TO(E.segmentGroup,E.index,r.commands);return zT(m,E.segmentGroup,C,c,h)}function Zv(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function Eg(o){return typeof o=="object"&&o!=null&&o.outlets}function zT(o,i,c,h,m){let r={};h&&Object.entries(h).forEach(([O,z])=>{r[O]=Array.isArray(z)?z.map(Z=>`${Z}`):`${z}`});let E;o===i?E=c:E=EO(o,i,c);let C=vO(xO(E));return new Ac(C,r,m)}function EO(o,i,c){let h={};return Object.entries(o.children).forEach(([m,r])=>{r===i?h[m]=c:h[m]=EO(r,i,c)}),new cr(o.segments,h)}var Yv=class{constructor(i,c,h){if(this.isAbsolute=i,this.numberOfDoubleDots=c,this.commands=h,i&&h.length>0&&Zv(h[0]))throw new gt(4003,!1);let m=h.find(Eg);if(m&&m!==dO(h))throw new gt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Y6(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new Yv(!0,0,o);let i=0,c=!1,h=o.reduce((m,r,E)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let C={};return Object.entries(r.outlets).forEach(([O,z])=>{C[O]=typeof z=="string"?z.split("/"):z}),[...m,{outlets:C}]}if(r.segmentPath)return[...m,r.segmentPath]}return typeof r!="string"?[...m,r]:E===0?(r.split("/").forEach((C,O)=>{O==0&&C==="."||(O==0&&C===""?c=!0:C===".."?i++:C!=""&&m.push(C))}),m):[...m,r]},[]);return new Yv(c,i,h)}var Df=class{constructor(i,c,h){this.segmentGroup=i,this.processChildren=c,this.index=h}};function X6(o,i,c){if(o.isAbsolute)return new Df(i,!0,0);if(!c)return new Df(i,!1,NaN);if(c.parent===null)return new Df(c,!0,0);let h=Zv(o.commands[0])?0:1,m=c.segments.length-1+h;return K6(c,m,o.numberOfDoubleDots)}function K6(o,i,c){let h=o,m=i,r=c;for(;r>m;){if(r-=m,h=h.parent,!h)throw new gt(4005,!1);m=h.segments.length}return new Df(h,!1,m-r)}function Q6(o){return Eg(o[0])?o[0].outlets:{[Rn]:o}}function TO(o,i,c){if(o??=new cr([],{}),o.segments.length===0&&o.hasChildren())return xg(o,i,c);let h=J6(o,i,c),m=c.slice(h.commandIndex);if(h.match&&h.pathIndex<o.segments.length){let r=new cr(o.segments.slice(0,h.pathIndex),{});return r.children[Rn]=new cr(o.segments.slice(h.pathIndex),o.children),xg(r,0,m)}else return h.match&&m.length===0?new cr(o.segments,{}):h.match&&!o.hasChildren()?qT(o,i,c):h.match?xg(o,0,m):qT(o,i,c)}function xg(o,i,c){if(c.length===0)return new cr(o.segments,{});{let h=Q6(c),m={};if(Object.keys(h).some(r=>r!==Rn)&&o.children[Rn]&&o.numberOfChildren===1&&o.children[Rn].segments.length===0){let r=xg(o.children[Rn],i,c);return new cr(o.segments,r.children)}return Object.entries(h).forEach(([r,E])=>{typeof E=="string"&&(E=[E]),E!==null&&(m[r]=TO(o.children[r],i,E))}),Object.entries(o.children).forEach(([r,E])=>{h[r]===void 0&&(m[r]=E)}),new cr(o.segments,m)}}function J6(o,i,c){let h=0,m=i,r={match:!1,pathIndex:0,commandIndex:0};for(;m<o.segments.length;){if(h>=c.length)return r;let E=o.segments[m],C=c[h];if(Eg(C))break;let O=`${C}`,z=h<c.length-1?c[h+1]:null;if(m>0&&O===void 0)break;if(O&&z&&typeof z=="object"&&z.outlets===void 0){if(!cO(O,z,E))return r;h+=2}else{if(!cO(O,{},E))return r;h++}m++}return{match:!0,pathIndex:m,commandIndex:h}}function qT(o,i,c){let h=o.segments.slice(0,i),m=0;for(;m<c.length;){let r=c[m];if(Eg(r)){let O=e8(r.outlets);return new cr(h,O)}if(m===0&&Zv(c[0])){let O=o.segments[i];h.push(new mh(O.path,lO(c[0]))),m++;continue}let E=Eg(r)?r.outlets[Rn]:`${r}`,C=m<c.length-1?c[m+1]:null;E&&C&&Zv(C)?(h.push(new mh(E,lO(C))),m+=2):(h.push(new mh(E,{})),m++)}return new cr(h,{})}function e8(o){let i={};return Object.entries(o).forEach(([c,h])=>{typeof h=="string"&&(h=[h]),h!==null&&(i[c]=qT(new cr([],{}),0,h))}),i}function lO(o){let i={};return Object.entries(o).forEach(([c,h])=>i[c]=`${h}`),i}function cO(o,i,c){return o==c.path&&ca(i,c.parameters)}var bg="imperative",Si=function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o}(Si||{}),Ho=class{constructor(i,c){this.id=i,this.url=c}},Tg=class extends Ho{constructor(i,c,h="imperative",m=null){super(i,c),this.type=Si.NavigationStart,this.navigationTrigger=h,this.restoredState=m}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},_h=class extends Ho{constructor(i,c,h){super(i,c),this.urlAfterRedirects=h,this.type=Si.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Do=function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o}(Do||{}),HT=function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o}(HT||{}),Pc=class extends Ho{constructor(i,c,h,m){super(i,c),this.reason=h,this.code=m,this.type=Si.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},yh=class extends Ho{constructor(i,c,h,m){super(i,c),this.reason=h,this.code=m,this.type=Si.NavigationSkipped}},Ig=class extends Ho{constructor(i,c,h,m){super(i,c),this.error=h,this.target=m,this.type=Si.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Xv=class extends Ho{constructor(i,c,h,m){super(i,c),this.urlAfterRedirects=h,this.state=m,this.type=Si.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},WT=class extends Ho{constructor(i,c,h,m){super(i,c),this.urlAfterRedirects=h,this.state=m,this.type=Si.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ZT=class extends Ho{constructor(i,c,h,m,r){super(i,c),this.urlAfterRedirects=h,this.state=m,this.shouldActivate=r,this.type=Si.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},YT=class extends Ho{constructor(i,c,h,m){super(i,c),this.urlAfterRedirects=h,this.state=m,this.type=Si.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},XT=class extends Ho{constructor(i,c,h,m){super(i,c),this.urlAfterRedirects=h,this.state=m,this.type=Si.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},KT=class{constructor(i){this.route=i,this.type=Si.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},QT=class{constructor(i){this.route=i,this.type=Si.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},JT=class{constructor(i){this.snapshot=i,this.type=Si.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},eI=class{constructor(i){this.snapshot=i,this.type=Si.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},tI=class{constructor(i){this.snapshot=i,this.type=Si.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},nI=class{constructor(i){this.snapshot=i,this.type=Si.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Dg=class{},Sg=class{constructor(i){this.url=i}};var rI=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Rf,this.attachRef=null}},Rf=(()=>{let i=class i{constructor(){this.contexts=new Map}onChildOutletCreated(h,m){let r=this.getOrCreateContext(h);r.outlet=m,this.contexts.set(h,r)}onChildOutletDestroyed(h){let m=this.getContext(h);m&&(m.outlet=null,m.attachRef=null)}onOutletDeactivated(){let h=this.contexts;return this.contexts=new Map,h}onOutletReAttached(h){this.contexts=h}getOrCreateContext(h){let m=this.getContext(h);return m||(m=new rI,this.contexts.set(h,m)),m}getContext(h){return this.contexts.get(h)||null}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),Kv=class{constructor(i){this._root=i}get root(){return this._root.value}parent(i){let c=this.pathFromRoot(i);return c.length>1?c[c.length-2]:null}children(i){let c=iI(i,this._root);return c?c.children.map(h=>h.value):[]}firstChild(i){let c=iI(i,this._root);return c&&c.children.length>0?c.children[0].value:null}siblings(i){let c=oI(i,this._root);return c.length<2?[]:c[c.length-2].children.map(m=>m.value).filter(m=>m!==i)}pathFromRoot(i){return oI(i,this._root).map(c=>c.value)}};function iI(o,i){if(o===i.value)return i;for(let c of i.children){let h=iI(o,c);if(h)return h}return null}function oI(o,i){if(o===i.value)return[i];for(let c of i.children){let h=oI(o,c);if(h.length)return h.unshift(i),h}return[]}var Io=class{constructor(i,c){this.value=i,this.children=c}toString(){return`TreeNode(${this.value})`}};function If(o){let i={};return o&&o.children.forEach(c=>i[c.value.outlet]=c),i}var Qv=class extends Kv{constructor(i,c){super(i),this.snapshot=c,gI(this,i)}toString(){return this.snapshot.toString()}};function IO(o){let i=t8(o),c=new li([new mh("",{})]),h=new li({}),m=new li({}),r=new li({}),E=new li(""),C=new Af(c,h,r,E,m,Rn,o,i.root);return C.snapshot=i.root,new Qv(new Io(C,[]),i)}function t8(o){let i={},c={},h={},m="",r=new Cg([],i,h,m,c,Rn,o,null,{});return new Jv("",new Io(r,[]))}var Af=class{constructor(i,c,h,m,r,E,C,O){this.urlSubject=i,this.paramsSubject=c,this.queryParamsSubject=h,this.fragmentSubject=m,this.dataSubject=r,this.outlet=E,this.component=C,this._futureSnapshot=O,this.title=this.dataSubject?.pipe(Pn(z=>z[Pg]))??ln(void 0),this.url=i,this.params=c,this.queryParams=h,this.fragment=m,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Pn(i=>Cf(i))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Pn(i=>Cf(i))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function mI(o,i,c="emptyOnly"){let h,{routeConfig:m}=o;return i!==null&&(c==="always"||m?.path===""||!i.component&&!i.routeConfig?.loadComponent)?h={params:xt(xt({},i.params),o.params),data:xt(xt({},i.data),o.data),resolve:xt(xt(xt(xt({},o.data),i.data),m?.data),o._resolvedData)}:h={params:xt({},o.params),data:xt({},o.data),resolve:xt(xt({},o.data),o._resolvedData??{})},m&&SO(m)&&(h.resolve[Pg]=m.title),h}var Cg=class{get title(){return this.data?.[Pg]}constructor(i,c,h,m,r,E,C,O,z){this.url=i,this.params=c,this.queryParams=h,this.fragment=m,this.data=r,this.outlet=E,this.component=C,this.routeConfig=O,this._resolve=z}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Cf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Cf(this.queryParams),this._queryParamMap}toString(){let i=this.url.map(h=>h.toString()).join("/"),c=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${i}', path:'${c}')`}},Jv=class extends Kv{constructor(i,c){super(c),this.url=i,gI(this,c)}toString(){return DO(this._root)}};function gI(o,i){i.value._routerState=o,i.children.forEach(c=>gI(o,c))}function DO(o){let i=o.children.length>0?` { ${o.children.map(DO).join(", ")} } `:"";return`${o.value}${i}`}function BT(o){if(o.snapshot){let i=o.snapshot,c=o._futureSnapshot;o.snapshot=c,ca(i.queryParams,c.queryParams)||o.queryParamsSubject.next(c.queryParams),i.fragment!==c.fragment&&o.fragmentSubject.next(c.fragment),ca(i.params,c.params)||o.paramsSubject.next(c.params),A6(i.url,c.url)||o.urlSubject.next(c.url),ca(i.data,c.data)||o.dataSubject.next(c.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function sI(o,i){let c=ca(o.params,i.params)&&L6(o.url,i.url),h=!o.parent!=!i.parent;return c&&!h&&(!o.parent||sI(o.parent,i.parent))}function SO(o){return typeof o.title=="string"||o.title===null}var _I=(()=>{let i=class i{constructor(){this.activated=null,this._activatedRoute=null,this.name=Rn,this.activateEvents=new $i,this.deactivateEvents=new $i,this.attachEvents=new $i,this.detachEvents=new $i,this.parentContexts=Et(Rf),this.location=Et(uh),this.changeDetector=Et(cg),this.environmentInjector=Et(so),this.inputBinder=Et(yI,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(h){if(h.name){let{firstChange:m,previousValue:r}=h.name;if(m)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(h){return this.parentContexts.getContext(h)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let h=this.parentContexts.getContext(this.name);h?.route&&(h.attachRef?this.attach(h.attachRef,h.route):this.activateWith(h.route,h.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new gt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new gt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new gt(4012,!1);this.location.detach();let h=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(h.instance),h}attach(h,m){this.activated=h,this._activatedRoute=m,this.location.insert(h.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(h.instance)}deactivate(){if(this.activated){let h=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(h)}}activateWith(h,m){if(this.isActivated)throw new gt(4013,!1);this._activatedRoute=h;let r=this.location,C=h.snapshot.component,O=this.parentContexts.getOrCreateContext(this.name).children,z=new aI(h,O,r.injector);this.activated=r.createComponent(C,{index:r.length,injector:z,environmentInjector:m??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=wc({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[eg]});let o=i;return o})(),aI=class o{__ngOutletInjector(i){return new o(this.route,this.childContexts,i)}constructor(i,c,h){this.route=i,this.childContexts=c,this.parent=h}get(i,c){return i===Af?this.route:i===Rf?this.childContexts:this.parent.get(i,c)}},yI=new gn("");function n8(o,i,c){let h=Mg(o,i._root,c?c._root:void 0);return new Qv(h,i)}function Mg(o,i,c){if(c&&o.shouldReuseRoute(i.value,c.value.snapshot)){let h=c.value;h._futureSnapshot=i.value;let m=r8(o,i,c);return new Io(h,m)}else{if(o.shouldAttach(i.value)){let r=o.retrieve(i.value);if(r!==null){let E=r.route;return E.value._futureSnapshot=i.value,E.children=i.children.map(C=>Mg(o,C)),E}}let h=i8(i.value),m=i.children.map(r=>Mg(o,r));return new Io(h,m)}}function r8(o,i,c){return i.children.map(h=>{for(let m of c.children)if(o.shouldReuseRoute(h.value,m.value.snapshot))return Mg(o,h,m);return Mg(o,h)})}function i8(o){return new Af(new li(o.url),new li(o.params),new li(o.queryParams),new li(o.fragment),new li(o.data),o.outlet,o.component,o)}var CO="ngNavigationCancelingError";function MO(o,i){let{redirectTo:c,navigationBehaviorOptions:h}=Mf(i)?{redirectTo:i,navigationBehaviorOptions:void 0}:i,m=AO(!1,Do.Redirect);return m.url=c,m.navigationBehaviorOptions=h,m}function AO(o,i){let c=new Error(`NavigationCancelingError: ${o||""}`);return c[CO]=!0,c.cancellationCode=i,c}function o8(o){return PO(o)&&Mf(o.url)}function PO(o){return!!o&&o[CO]}var s8=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=Br({type:i,selectors:[["ng-component"]],standalone:!0,features:[Vr],decls:1,vars:0,template:function(m,r){m&1&&Ir(0,"router-outlet")},dependencies:[_I],encapsulation:2});let o=i;return o})();function a8(o,i){return o.providers&&!o._injector&&(o._injector=mT(o.providers,i,`Route: ${o.path}`)),o._injector??i}function vI(o){let i=o.children&&o.children.map(vI),c=i?Tr(xt({},o),{children:i}):xt({},o);return!c.component&&!c.loadComponent&&(i||c.loadChildren)&&c.outlet&&c.outlet!==Rn&&(c.component=s8),c}function ua(o){return o.outlet||Rn}function l8(o,i){let c=o.filter(h=>ua(h)===i);return c.push(...o.filter(h=>ua(h)!==i)),c}function Rg(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let i=o.parent;i;i=i.parent){let c=i.routeConfig;if(c?._loadedInjector)return c._loadedInjector;if(c?._injector)return c._injector}return null}var c8=(o,i,c,h)=>Pn(m=>(new lI(i,m.targetRouterState,m.currentRouterState,c,h).activate(o),m)),lI=class{constructor(i,c,h,m,r){this.routeReuseStrategy=i,this.futureState=c,this.currState=h,this.forwardEvent=m,this.inputBindingEnabled=r}activate(i){let c=this.futureState._root,h=this.currState?this.currState._root:null;this.deactivateChildRoutes(c,h,i),BT(this.futureState.root),this.activateChildRoutes(c,h,i)}deactivateChildRoutes(i,c,h){let m=If(c);i.children.forEach(r=>{let E=r.value.outlet;this.deactivateRoutes(r,m[E],h),delete m[E]}),Object.values(m).forEach(r=>{this.deactivateRouteAndItsChildren(r,h)})}deactivateRoutes(i,c,h){let m=i.value,r=c?c.value:null;if(m===r)if(m.component){let E=h.getContext(m.outlet);E&&this.deactivateChildRoutes(i,c,E.children)}else this.deactivateChildRoutes(i,c,h);else r&&this.deactivateRouteAndItsChildren(c,h)}deactivateRouteAndItsChildren(i,c){i.value.component&&this.routeReuseStrategy.shouldDetach(i.value.snapshot)?this.detachAndStoreRouteSubtree(i,c):this.deactivateRouteAndOutlet(i,c)}detachAndStoreRouteSubtree(i,c){let h=c.getContext(i.value.outlet),m=h&&i.value.component?h.children:c,r=If(i);for(let E of Object.values(r))this.deactivateRouteAndItsChildren(E,m);if(h&&h.outlet){let E=h.outlet.detach(),C=h.children.onOutletDeactivated();this.routeReuseStrategy.store(i.value.snapshot,{componentRef:E,route:i,contexts:C})}}deactivateRouteAndOutlet(i,c){let h=c.getContext(i.value.outlet),m=h&&i.value.component?h.children:c,r=If(i);for(let E of Object.values(r))this.deactivateRouteAndItsChildren(E,m);h&&(h.outlet&&(h.outlet.deactivate(),h.children.onOutletDeactivated()),h.attachRef=null,h.route=null)}activateChildRoutes(i,c,h){let m=If(c);i.children.forEach(r=>{this.activateRoutes(r,m[r.value.outlet],h),this.forwardEvent(new nI(r.value.snapshot))}),i.children.length&&this.forwardEvent(new eI(i.value.snapshot))}activateRoutes(i,c,h){let m=i.value,r=c?c.value:null;if(BT(m),m===r)if(m.component){let E=h.getOrCreateContext(m.outlet);this.activateChildRoutes(i,c,E.children)}else this.activateChildRoutes(i,c,h);else if(m.component){let E=h.getOrCreateContext(m.outlet);if(this.routeReuseStrategy.shouldAttach(m.snapshot)){let C=this.routeReuseStrategy.retrieve(m.snapshot);this.routeReuseStrategy.store(m.snapshot,null),E.children.onOutletReAttached(C.contexts),E.attachRef=C.componentRef,E.route=C.route.value,E.outlet&&E.outlet.attach(C.componentRef,C.route.value),BT(C.route.value),this.activateChildRoutes(i,null,E.children)}else{let C=Rg(m.snapshot);E.attachRef=null,E.route=m,E.injector=C,E.outlet&&E.outlet.activateWith(m,E.injector),this.activateChildRoutes(i,null,E.children)}}else this.activateChildRoutes(i,null,h)}},ex=class{constructor(i){this.path=i,this.route=this.path[this.path.length-1]}},Sf=class{constructor(i,c){this.component=i,this.route=c}};function u8(o,i,c){let h=o._root,m=i?i._root:null;return yg(h,m,c,[h.value])}function h8(o){let i=o.routeConfig?o.routeConfig.canActivateChild:null;return!i||i.length===0?null:{node:o,guards:i}}function Of(o,i){let c=Symbol(),h=i.get(o,c);return h===c?typeof o=="function"&&!D2(o)?o:i.get(o):h}function yg(o,i,c,h,m={canDeactivateChecks:[],canActivateChecks:[]}){let r=If(i);return o.children.forEach(E=>{d8(E,r[E.value.outlet],c,h.concat([E.value]),m),delete r[E.value.outlet]}),Object.entries(r).forEach(([E,C])=>wg(C,c.getContext(E),m)),m}function d8(o,i,c,h,m={canDeactivateChecks:[],canActivateChecks:[]}){let r=o.value,E=i?i.value:null,C=c?c.getContext(o.value.outlet):null;if(E&&r.routeConfig===E.routeConfig){let O=f8(E,r,r.routeConfig.runGuardsAndResolvers);O?m.canActivateChecks.push(new ex(h)):(r.data=E.data,r._resolvedData=E._resolvedData),r.component?yg(o,i,C?C.children:null,h,m):yg(o,i,c,h,m),O&&C&&C.outlet&&C.outlet.isActivated&&m.canDeactivateChecks.push(new Sf(C.outlet.component,E))}else E&&wg(i,C,m),m.canActivateChecks.push(new ex(h)),r.component?yg(o,null,C?C.children:null,h,m):yg(o,null,c,h,m);return m}function f8(o,i,c){if(typeof c=="function")return c(o,i);switch(c){case"pathParamsChange":return!gh(o.url,i.url);case"pathParamsOrQueryParamsChange":return!gh(o.url,i.url)||!ca(o.queryParams,i.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!sI(o,i)||!ca(o.queryParams,i.queryParams);case"paramsChange":default:return!sI(o,i)}}function wg(o,i,c){let h=If(o),m=o.value;Object.entries(h).forEach(([r,E])=>{m.component?i?wg(E,i.children.getContext(r),c):wg(E,null,c):wg(E,i,c)}),m.component?i&&i.outlet&&i.outlet.isActivated?c.canDeactivateChecks.push(new Sf(i.outlet.component,m)):c.canDeactivateChecks.push(new Sf(null,m)):c.canDeactivateChecks.push(new Sf(null,m))}function Og(o){return typeof o=="function"}function p8(o){return typeof o=="boolean"}function m8(o){return o&&Og(o.canLoad)}function g8(o){return o&&Og(o.canActivate)}function _8(o){return o&&Og(o.canActivateChild)}function y8(o){return o&&Og(o.canDeactivate)}function v8(o){return o&&Og(o.canMatch)}function RO(o){return o instanceof Ya||o?.name==="EmptyError"}var $v=Symbol("INITIAL_VALUE");function Pf(){return Eo(o=>C0(o.map(i=>i.pipe(Xa(1),kw($v)))).pipe(Pn(i=>{for(let c of i)if(c!==!0){if(c===$v)return $v;if(c===!1||c instanceof Ac)return c}return!0}),wo(i=>i!==$v),Xa(1)))}function x8(o,i){return ci(c=>{let{targetSnapshot:h,currentSnapshot:m,guards:{canActivateChecks:r,canDeactivateChecks:E}}=c;return E.length===0&&r.length===0?ln(Tr(xt({},c),{guardsResult:!0})):b8(E,h,m,o).pipe(ci(C=>C&&p8(C)?w8(h,r,o,i):ln(C)),Pn(C=>Tr(xt({},c),{guardsResult:C})))})}function b8(o,i,c,h){return zr(o).pipe(ci(m=>S8(m.component,m.route,c,i,h)),Js(m=>m!==!0,!0))}function w8(o,i,c,h){return zr(i).pipe(fc(m=>Kd(T8(m.route.parent,h),E8(m.route,h),D8(o,m.path,c),I8(o,m.route,c))),Js(m=>m!==!0,!0))}function E8(o,i){return o!==null&&i&&i(new tI(o)),ln(!0)}function T8(o,i){return o!==null&&i&&i(new JT(o)),ln(!0)}function I8(o,i,c){let h=i.routeConfig?i.routeConfig.canActivate:null;if(!h||h.length===0)return ln(!0);let m=h.map(r=>M0(()=>{let E=Rg(i)??c,C=Of(r,E),O=g8(C)?C.canActivate(i,o):Qa(E,()=>C(i,o));return Rc(O).pipe(Js())}));return ln(m).pipe(Pf())}function D8(o,i,c){let h=i[i.length-1],r=i.slice(0,i.length-1).reverse().map(E=>h8(E)).filter(E=>E!==null).map(E=>M0(()=>{let C=E.guards.map(O=>{let z=Rg(E.node)??c,Z=Of(O,z),ce=_8(Z)?Z.canActivateChild(h,o):Qa(z,()=>Z(h,o));return Rc(ce).pipe(Js())});return ln(C).pipe(Pf())}));return ln(r).pipe(Pf())}function S8(o,i,c,h,m){let r=i&&i.routeConfig?i.routeConfig.canDeactivate:null;if(!r||r.length===0)return ln(!0);let E=r.map(C=>{let O=Rg(i)??m,z=Of(C,O),Z=y8(z)?z.canDeactivate(o,i,c,h):Qa(O,()=>z(o,i,c,h));return Rc(Z).pipe(Js())});return ln(E).pipe(Pf())}function C8(o,i,c,h){let m=i.canLoad;if(m===void 0||m.length===0)return ln(!0);let r=m.map(E=>{let C=Of(E,o),O=m8(C)?C.canLoad(i,c):Qa(o,()=>C(i,c));return Rc(O)});return ln(r).pipe(Pf(),OO(h))}function OO(o){return Tw(Yr(i=>{if(Mf(i))throw MO(o,i)}),Pn(i=>i===!0))}function M8(o,i,c,h){let m=i.canMatch;if(!m||m.length===0)return ln(!0);let r=m.map(E=>{let C=Of(E,o),O=v8(C)?C.canMatch(i,c):Qa(o,()=>C(i,c));return Rc(O)});return ln(r).pipe(Pf(),OO(h))}var Ag=class{constructor(i){this.segmentGroup=i||null}},tx=class extends Error{constructor(i){super(),this.urlTree=i}};function Tf(o){return Za(new Ag(o))}function A8(o){return Za(new gt(4e3,!1))}function P8(o){return Za(AO(!1,Do.GuardRejected))}var cI=class{constructor(i,c){this.urlSerializer=i,this.urlTree=c}lineralizeSegments(i,c){let h=[],m=c.root;for(;;){if(h=h.concat(m.segments),m.numberOfChildren===0)return ln(h);if(m.numberOfChildren>1||!m.children[Rn])return A8(i.redirectTo);m=m.children[Rn]}}applyRedirectCommands(i,c,h){let m=this.applyRedirectCreateUrlTree(c,this.urlSerializer.parse(c),i,h);if(c.startsWith("/"))throw new tx(m);return m}applyRedirectCreateUrlTree(i,c,h,m){let r=this.createSegmentGroup(i,c.root,h,m);return new Ac(r,this.createQueryParams(c.queryParams,this.urlTree.queryParams),c.fragment)}createQueryParams(i,c){let h={};return Object.entries(i).forEach(([m,r])=>{if(typeof r=="string"&&r.startsWith(":")){let C=r.substring(1);h[m]=c[C]}else h[m]=r}),h}createSegmentGroup(i,c,h,m){let r=this.createSegments(i,c.segments,h,m),E={};return Object.entries(c.children).forEach(([C,O])=>{E[C]=this.createSegmentGroup(i,O,h,m)}),new cr(r,E)}createSegments(i,c,h,m){return c.map(r=>r.path.startsWith(":")?this.findPosParam(i,r,m):this.findOrReturn(r,h))}findPosParam(i,c,h){let m=h[c.path.substring(1)];if(!m)throw new gt(4001,!1);return m}findOrReturn(i,c){let h=0;for(let m of c){if(m.path===i.path)return c.splice(h),m;h++}return i}},uI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function R8(o,i,c,h,m){let r=xI(o,i,c);return r.matched?(h=a8(i,h),M8(h,i,c,m).pipe(Pn(E=>E===!0?r:xt({},uI)))):ln(r)}function xI(o,i,c){if(i.path==="**")return O8(c);if(i.path==="")return i.pathMatch==="full"&&(o.hasChildren()||c.length>0)?xt({},uI):{matched:!0,consumedSegments:[],remainingSegments:c,parameters:{},positionalParamSegments:{}};let m=(i.matcher||M6)(c,o,i);if(!m)return xt({},uI);let r={};Object.entries(m.posParams??{}).forEach(([C,O])=>{r[C]=O.path});let E=m.consumed.length>0?xt(xt({},r),m.consumed[m.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:m.consumed,remainingSegments:c.slice(m.consumed.length),parameters:E,positionalParamSegments:m.posParams??{}}}function O8(o){return{matched:!0,parameters:o.length>0?dO(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function uO(o,i,c,h){return c.length>0&&F8(o,c,h)?{segmentGroup:new cr(i,k8(h,new cr(c,o.children))),slicedSegments:[]}:c.length===0&&N8(o,c,h)?{segmentGroup:new cr(o.segments,L8(o,c,h,o.children)),slicedSegments:c}:{segmentGroup:new cr(o.segments,o.children),slicedSegments:c}}function L8(o,i,c,h){let m={};for(let r of c)if(nx(o,i,r)&&!h[ua(r)]){let E=new cr([],{});m[ua(r)]=E}return xt(xt({},h),m)}function k8(o,i){let c={};c[Rn]=i;for(let h of o)if(h.path===""&&ua(h)!==Rn){let m=new cr([],{});c[ua(h)]=m}return c}function F8(o,i,c){return c.some(h=>nx(o,i,h)&&ua(h)!==Rn)}function N8(o,i,c){return c.some(h=>nx(o,i,h))}function nx(o,i,c){return(o.hasChildren()||i.length>0)&&c.pathMatch==="full"?!1:c.path===""}function z8(o,i,c,h){return ua(o)!==h&&(h===Rn||!nx(i,c,o))?!1:xI(i,o,c).matched}function B8(o,i,c){return i.length===0&&!o.children[c]}var hI=class{};function U8(o,i,c,h,m,r,E="emptyOnly"){return new dI(o,i,c,h,m,E,r).recognize()}var V8=31,dI=class{constructor(i,c,h,m,r,E,C){this.injector=i,this.configLoader=c,this.rootComponentType=h,this.config=m,this.urlTree=r,this.paramsInheritanceStrategy=E,this.urlSerializer=C,this.applyRedirects=new cI(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(i){return new gt(4002,`'${i.segmentGroup}'`)}recognize(){let i=uO(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(i).pipe(Pn(c=>{let h=new Cg([],Object.freeze({}),Object.freeze(xt({},this.urlTree.queryParams)),this.urlTree.fragment,{},Rn,this.rootComponentType,null,{}),m=new Io(h,c),r=new Jv("",m),E=Z6(h,[],this.urlTree.queryParams,this.urlTree.fragment);return E.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(E),this.inheritParamsAndData(r._root,null),{state:r,tree:E}}))}match(i){return this.processSegmentGroup(this.injector,this.config,i,Rn).pipe(Ks(h=>{if(h instanceof tx)return this.urlTree=h.urlTree,this.match(h.urlTree.root);throw h instanceof Ag?this.noMatchError(h):h}))}inheritParamsAndData(i,c){let h=i.value,m=mI(h,c,this.paramsInheritanceStrategy);h.params=Object.freeze(m.params),h.data=Object.freeze(m.data),i.children.forEach(r=>this.inheritParamsAndData(r,h))}processSegmentGroup(i,c,h,m){return h.segments.length===0&&h.hasChildren()?this.processChildren(i,c,h):this.processSegment(i,c,h,h.segments,m,!0).pipe(Pn(r=>r instanceof Io?[r]:[]))}processChildren(i,c,h){let m=[];for(let r of Object.keys(h.children))r==="primary"?m.unshift(r):m.push(r);return zr(m).pipe(fc(r=>{let E=h.children[r],C=l8(c,r);return this.processSegmentGroup(i,C,E,r)}),Rw((r,E)=>(r.push(...E),r)),pc(null),Pw(),ci(r=>{if(r===null)return Tf(h);let E=LO(r);return j8(E),ln(E)}))}processSegment(i,c,h,m,r,E){return zr(c).pipe(fc(C=>this.processSegmentAgainstRoute(C._injector??i,c,C,h,m,r,E).pipe(Ks(O=>{if(O instanceof Ag)return ln(null);throw O}))),Js(C=>!!C),Ks(C=>{if(RO(C))return B8(h,m,r)?ln(new hI):Tf(h);throw C}))}processSegmentAgainstRoute(i,c,h,m,r,E,C){return z8(h,m,r,E)?h.redirectTo===void 0?this.matchSegmentAgainstRoute(i,m,h,r,E):this.allowRedirects&&C?this.expandSegmentAgainstRouteUsingRedirect(i,m,c,h,r,E):Tf(m):Tf(m)}expandSegmentAgainstRouteUsingRedirect(i,c,h,m,r,E){let{matched:C,consumedSegments:O,positionalParamSegments:z,remainingSegments:Z}=xI(c,m,r);if(!C)return Tf(c);m.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>V8&&(this.allowRedirects=!1));let ce=this.applyRedirects.applyRedirectCommands(O,m.redirectTo,z);return this.applyRedirects.lineralizeSegments(m,ce).pipe(ci(Ie=>this.processSegment(i,h,c,Ie.concat(Z),E,!1)))}matchSegmentAgainstRoute(i,c,h,m,r){let E=R8(c,h,m,i,this.urlSerializer);return h.path==="**"&&(c.children={}),E.pipe(Eo(C=>C.matched?(i=h._injector??i,this.getChildConfig(i,h,m).pipe(Eo(({routes:O})=>{let z=h._loadedInjector??i,{consumedSegments:Z,remainingSegments:ce,parameters:Ie}=C,be=new Cg(Z,Ie,Object.freeze(xt({},this.urlTree.queryParams)),this.urlTree.fragment,G8(h),ua(h),h.component??h._loadedComponent??null,h,q8(h)),{segmentGroup:qe,slicedSegments:ot}=uO(c,Z,ce,O);if(ot.length===0&&qe.hasChildren())return this.processChildren(z,O,qe).pipe(Pn(ct=>ct===null?null:new Io(be,ct)));if(O.length===0&&ot.length===0)return ln(new Io(be,[]));let dt=ua(h)===r;return this.processSegment(z,O,qe,ot,dt?Rn:r,!0).pipe(Pn(ct=>new Io(be,ct instanceof Io?[ct]:[])))}))):Tf(c)))}getChildConfig(i,c,h){return c.children?ln({routes:c.children,injector:i}):c.loadChildren?c._loadedRoutes!==void 0?ln({routes:c._loadedRoutes,injector:c._loadedInjector}):C8(i,c,h,this.urlSerializer).pipe(ci(m=>m?this.configLoader.loadChildren(i,c).pipe(Yr(r=>{c._loadedRoutes=r.routes,c._loadedInjector=r.injector})):P8(c))):ln({routes:[],injector:i})}};function j8(o){o.sort((i,c)=>i.value.outlet===Rn?-1:c.value.outlet===Rn?1:i.value.outlet.localeCompare(c.value.outlet))}function $8(o){let i=o.value.routeConfig;return i&&i.path===""}function LO(o){let i=[],c=new Set;for(let h of o){if(!$8(h)){i.push(h);continue}let m=i.find(r=>h.value.routeConfig===r.value.routeConfig);m!==void 0?(m.children.push(...h.children),c.add(m)):i.push(h)}for(let h of c){let m=LO(h.children);i.push(new Io(h.value,m))}return i.filter(h=>!c.has(h))}function G8(o){return o.data||{}}function q8(o){return o.resolve||{}}function H8(o,i,c,h,m,r){return ci(E=>U8(o,i,c,h,E.extractedUrl,m,r).pipe(Pn(({state:C,tree:O})=>Tr(xt({},E),{targetSnapshot:C,urlAfterRedirects:O}))))}function W8(o,i){return ci(c=>{let{targetSnapshot:h,guards:{canActivateChecks:m}}=c;if(!m.length)return ln(c);let r=new Set(m.map(O=>O.route)),E=new Set;for(let O of r)if(!E.has(O))for(let z of kO(O))E.add(z);let C=0;return zr(E).pipe(fc(O=>r.has(O)?Z8(O,h,o,i):(O.data=mI(O,O.parent,o).resolve,ln(void 0))),Yr(()=>C++),Qd(1),ci(O=>C===E.size?ln(c):bo))})}function kO(o){let i=o.children.map(c=>kO(c)).flat();return[o,...i]}function Z8(o,i,c,h){let m=o.routeConfig,r=o._resolve;return m?.title!==void 0&&!SO(m)&&(r[Pg]=m.title),Y8(r,o,i,h).pipe(Pn(E=>(o._resolvedData=E,o.data=mI(o,o.parent,c).resolve,null)))}function Y8(o,i,c,h){let m=jT(o);if(m.length===0)return ln({});let r={};return zr(m).pipe(ci(E=>X8(o[E],i,c,h).pipe(Js(),Yr(C=>{r[E]=C}))),Qd(1),Aw(r),Ks(E=>RO(E)?bo:Za(E)))}function X8(o,i,c,h){let m=Rg(i)??h,r=Of(o,m),E=r.resolve?r.resolve(i,c):Qa(m,()=>r(i,c));return Rc(E)}function UT(o){return Eo(i=>{let c=o(i);return c?zr(c).pipe(Pn(()=>i)):ln(i)})}var FO=(()=>{let i=class i{buildTitle(h){let m,r=h.root;for(;r!==void 0;)m=this.getResolvedTitleForRoute(r)??m,r=r.children.find(E=>E.outlet===Rn);return m}getResolvedTitleForRoute(h){return h.data[Pg]}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>Et(K8),providedIn:"root"});let o=i;return o})(),K8=(()=>{let i=class i extends FO{constructor(h){super(),this.title=h}updateTitle(h){let m=this.buildTitle(h);m!==void 0&&this.title.setTitle(m)}};i.\u0275fac=function(m){return new(m||i)(cn(oO))},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),bI=new gn("",{providedIn:"root",factory:()=>({})}),wI=new gn(""),Q8=(()=>{let i=class i{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Et(yT)}loadComponent(h){if(this.componentLoaders.get(h))return this.componentLoaders.get(h);if(h._loadedComponent)return ln(h._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(h);let m=Rc(h.loadComponent()).pipe(Pn(NO),Yr(E=>{this.onLoadEndListener&&this.onLoadEndListener(h),h._loadedComponent=E}),Qs(()=>{this.componentLoaders.delete(h)})),r=new Xd(m,()=>new Ti).pipe(Yd());return this.componentLoaders.set(h,r),r}loadChildren(h,m){if(this.childrenLoaders.get(m))return this.childrenLoaders.get(m);if(m._loadedRoutes)return ln({routes:m._loadedRoutes,injector:m._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(m);let E=J8(m,this.compiler,h,this.onLoadEndListener).pipe(Qs(()=>{this.childrenLoaders.delete(m)})),C=new Xd(E,()=>new Ti).pipe(Yd());return this.childrenLoaders.set(m,C),C}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function J8(o,i,c,h){return Rc(o.loadChildren()).pipe(Pn(NO),ci(m=>m instanceof Km||Array.isArray(m)?ln(m):zr(i.compileModuleAsync(m))),Pn(m=>{h&&h(o);let r,E,C=!1;return Array.isArray(m)?(E=m,C=!0):(r=m.create(c).injector,E=r.get(wI,[],{optional:!0,self:!0}).flat()),{routes:E.map(vI),injector:r}}))}function e$(o){return o&&typeof o=="object"&&"default"in o}function NO(o){return e$(o)?o.default:o}var EI=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>Et(t$),providedIn:"root"});let o=i;return o})(),t$=(()=>{let i=class i{shouldProcessUrl(h){return!0}extract(h){return h}merge(h,m){return h}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),n$=new gn("");var r$=(()=>{let i=class i{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ti,this.transitionAbortSubject=new Ti,this.configLoader=Et(Q8),this.environmentInjector=Et(so),this.urlSerializer=Et(pI),this.rootContexts=Et(Rf),this.location=Et(ug),this.inputBindingEnabled=Et(yI,{optional:!0})!==null,this.titleStrategy=Et(FO),this.options=Et(bI,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Et(EI),this.createViewTransition=Et(n$,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>ln(void 0),this.rootComponentType=null;let h=r=>this.events.next(new KT(r)),m=r=>this.events.next(new QT(r));this.configLoader.onLoadEndListener=m,this.configLoader.onLoadStartListener=h}complete(){this.transitions?.complete()}handleNavigationRequest(h){let m=++this.navigationId;this.transitions?.next(Tr(xt(xt({},this.transitions.value),h),{id:m}))}setupNavigations(h,m,r){return this.transitions=new li({id:0,currentUrlTree:m,currentRawUrl:m,extractedUrl:this.urlHandlingStrategy.extract(m),urlAfterRedirects:this.urlHandlingStrategy.extract(m),rawUrl:m,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:bg,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(wo(E=>E.id!==0),Pn(E=>Tr(xt({},E),{extractedUrl:this.urlHandlingStrategy.extract(E.rawUrl)})),Eo(E=>{let C=!1,O=!1;return ln(E).pipe(Eo(z=>{if(this.navigationId>E.id)return this.cancelNavigationTransition(E,"",Do.SupersededByNewNavigation),bo;this.currentTransition=E,this.currentNavigation={id:z.id,initialUrl:z.rawUrl,extractedUrl:z.extractedUrl,trigger:z.source,extras:z.extras,previousNavigation:this.lastSuccessfulNavigation?Tr(xt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let Z=!h.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),ce=z.extras.onSameUrlNavigation??h.onSameUrlNavigation;if(!Z&&ce!=="reload"){let Ie="";return this.events.next(new yh(z.id,this.urlSerializer.serialize(z.rawUrl),Ie,HT.IgnoredSameUrlNavigation)),z.resolve(null),bo}if(this.urlHandlingStrategy.shouldProcessUrl(z.rawUrl))return ln(z).pipe(Eo(Ie=>{let be=this.transitions?.getValue();return this.events.next(new Tg(Ie.id,this.urlSerializer.serialize(Ie.extractedUrl),Ie.source,Ie.restoredState)),be!==this.transitions?.getValue()?bo:Promise.resolve(Ie)}),H8(this.environmentInjector,this.configLoader,this.rootComponentType,h.config,this.urlSerializer,this.paramsInheritanceStrategy),Yr(Ie=>{E.targetSnapshot=Ie.targetSnapshot,E.urlAfterRedirects=Ie.urlAfterRedirects,this.currentNavigation=Tr(xt({},this.currentNavigation),{finalUrl:Ie.urlAfterRedirects});let be=new Xv(Ie.id,this.urlSerializer.serialize(Ie.extractedUrl),this.urlSerializer.serialize(Ie.urlAfterRedirects),Ie.targetSnapshot);this.events.next(be)}));if(Z&&this.urlHandlingStrategy.shouldProcessUrl(z.currentRawUrl)){let{id:Ie,extractedUrl:be,source:qe,restoredState:ot,extras:dt}=z,ct=new Tg(Ie,this.urlSerializer.serialize(be),qe,ot);this.events.next(ct);let bt=IO(this.rootComponentType).snapshot;return this.currentTransition=E=Tr(xt({},z),{targetSnapshot:bt,urlAfterRedirects:be,extras:Tr(xt({},dt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=be,ln(E)}else{let Ie="";return this.events.next(new yh(z.id,this.urlSerializer.serialize(z.extractedUrl),Ie,HT.IgnoredByUrlHandlingStrategy)),z.resolve(null),bo}}),Yr(z=>{let Z=new WT(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot);this.events.next(Z)}),Pn(z=>(this.currentTransition=E=Tr(xt({},z),{guards:u8(z.targetSnapshot,z.currentSnapshot,this.rootContexts)}),E)),x8(this.environmentInjector,z=>this.events.next(z)),Yr(z=>{if(E.guardsResult=z.guardsResult,Mf(z.guardsResult))throw MO(this.urlSerializer,z.guardsResult);let Z=new ZT(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot,!!z.guardsResult);this.events.next(Z)}),wo(z=>z.guardsResult?!0:(this.cancelNavigationTransition(z,"",Do.GuardRejected),!1)),UT(z=>{if(z.guards.canActivateChecks.length)return ln(z).pipe(Yr(Z=>{let ce=new YT(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(ce)}),Eo(Z=>{let ce=!1;return ln(Z).pipe(W8(this.paramsInheritanceStrategy,this.environmentInjector),Yr({next:()=>ce=!0,complete:()=>{ce||this.cancelNavigationTransition(Z,"",Do.NoDataFromResolver)}}))}),Yr(Z=>{let ce=new XT(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(ce)}))}),UT(z=>{let Z=ce=>{let Ie=[];ce.routeConfig?.loadComponent&&!ce.routeConfig._loadedComponent&&Ie.push(this.configLoader.loadComponent(ce.routeConfig).pipe(Yr(be=>{ce.component=be}),Pn(()=>{})));for(let be of ce.children)Ie.push(...Z(be));return Ie};return C0(Z(z.targetSnapshot.root)).pipe(pc(null),Xa(1))}),UT(()=>this.afterPreactivation()),Eo(()=>{let{currentSnapshot:z,targetSnapshot:Z}=E,ce=this.createViewTransition?.(this.environmentInjector,z.root,Z.root);return ce?zr(ce).pipe(Pn(()=>E)):ln(E)}),Pn(z=>{let Z=n8(h.routeReuseStrategy,z.targetSnapshot,z.currentRouterState);return this.currentTransition=E=Tr(xt({},z),{targetRouterState:Z}),this.currentNavigation.targetRouterState=Z,E}),Yr(()=>{this.events.next(new Dg)}),c8(this.rootContexts,h.routeReuseStrategy,z=>this.events.next(z),this.inputBindingEnabled),Xa(1),Yr({next:z=>{C=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new _h(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects))),this.titleStrategy?.updateTitle(z.targetRouterState.snapshot),z.resolve(!0)},complete:()=>{C=!0}}),Fw(this.transitionAbortSubject.pipe(Yr(z=>{throw z}))),Qs(()=>{!C&&!O&&this.cancelNavigationTransition(E,"",Do.SupersededByNewNavigation),this.currentTransition?.id===E.id&&(this.currentNavigation=null,this.currentTransition=null)}),Ks(z=>{if(O=!0,PO(z))this.events.next(new Pc(E.id,this.urlSerializer.serialize(E.extractedUrl),z.message,z.cancellationCode)),o8(z)?this.events.next(new Sg(z.url)):E.resolve(!1);else{this.events.next(new Ig(E.id,this.urlSerializer.serialize(E.extractedUrl),z,E.targetSnapshot??void 0));try{E.resolve(h.errorHandler(z))}catch(Z){this.options.resolveNavigationPromiseOnError?E.resolve(!1):E.reject(Z)}}return bo}))}))}cancelNavigationTransition(h,m,r){let E=new Pc(h.id,this.urlSerializer.serialize(h.extractedUrl),m,r);this.events.next(E),h.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function i$(o){return o!==bg}var o$=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>Et(s$),providedIn:"root"});let o=i;return o})(),fI=class{shouldDetach(i){return!1}store(i,c){}shouldAttach(i){return!1}retrieve(i){return null}shouldReuseRoute(i,c){return i.routeConfig===c.routeConfig}},s$=(()=>{let i=class i extends fI{};i.\u0275fac=(()=>{let h;return function(r){return(h||(h=ZE(i)))(r||i)}})(),i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),zO=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:()=>Et(a$),providedIn:"root"});let o=i;return o})(),a$=(()=>{let i=class i extends zO{constructor(){super(...arguments),this.location=Et(ug),this.urlSerializer=Et(pI),this.options=Et(bI,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Et(EI),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Ac,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=IO(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(h){return this.location.subscribe(m=>{m.type==="popstate"&&h(m.url,m.state)})}handleRouterEvent(h,m){if(h instanceof Tg)this.stateMemento=this.createStateMemento();else if(h instanceof yh)this.rawUrlTree=m.initialUrl;else if(h instanceof Xv){if(this.urlUpdateStrategy==="eager"&&!m.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl);this.setBrowserUrl(r,m)}}else h instanceof Dg?(this.currentUrlTree=m.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl),this.routerState=m.targetRouterState,this.urlUpdateStrategy==="deferred"&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m))):h instanceof Pc&&(h.code===Do.GuardRejected||h.code===Do.NoDataFromResolver)?this.restoreHistory(m):h instanceof Ig?this.restoreHistory(m,!0):h instanceof _h&&(this.lastSuccessfulId=h.id,this.currentPageId=this.browserPageId)}setBrowserUrl(h,m){let r=this.urlSerializer.serialize(h);if(this.location.isCurrentPathEqualTo(r)||m.extras.replaceUrl){let E=this.browserPageId,C=xt(xt({},m.extras.state),this.generateNgRouterState(m.id,E));this.location.replaceState(r,"",C)}else{let E=xt(xt({},m.extras.state),this.generateNgRouterState(m.id,this.browserPageId+1));this.location.go(r,"",E)}}restoreHistory(h,m=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,E=this.currentPageId-r;E!==0?this.location.historyGo(E):this.currentUrlTree===h.finalUrl&&E===0&&(this.resetState(h),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(m&&this.resetState(h),this.resetUrlToCurrentUrlTree())}resetState(h){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,h.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(h,m){return this.canceledNavigationResolution==="computed"?{navigationId:h,\u0275routerPageId:m}:{navigationId:h}}};i.\u0275fac=(()=>{let h;return function(r){return(h||(h=ZE(i)))(r||i)}})(),i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})(),vg=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(vg||{});function l$(o,i){o.events.pipe(wo(c=>c instanceof _h||c instanceof Pc||c instanceof Ig||c instanceof yh),Pn(c=>c instanceof _h||c instanceof yh?vg.COMPLETE:(c instanceof Pc?c.code===Do.Redirect||c.code===Do.SupersededByNewNavigation:!1)?vg.REDIRECTING:vg.FAILED),wo(c=>c!==vg.REDIRECTING),Xa(1)).subscribe(()=>{i()})}function c$(o){throw o}var u$={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},h$={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},rx=(()=>{let i=class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Et(Tv),this.stateManager=Et(zO),this.options=Et(bI,{optional:!0})||{},this.pendingTasks=Et(hh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Et(r$),this.urlSerializer=Et(pI),this.location=Et(ug),this.urlHandlingStrategy=Et(EI),this._events=new Ti,this.errorHandler=this.options.errorHandler||c$,this.navigated=!1,this.routeReuseStrategy=Et(o$),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Et(wI,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Et(yI,{optional:!0}),this.eventsSubscription=new ai,this.isNgZoneEnabled=Et(Rr)instanceof Rr&&Rr.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:h=>{this.console.warn(h)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let h=this.navigationTransitions.events.subscribe(m=>{try{let r=this.navigationTransitions.currentTransition,E=this.navigationTransitions.currentNavigation;if(r!==null&&E!==null){if(this.stateManager.handleRouterEvent(m,E),m instanceof Pc&&m.code!==Do.Redirect&&m.code!==Do.SupersededByNewNavigation)this.navigated=!0;else if(m instanceof _h)this.navigated=!0;else if(m instanceof Sg){let C=this.urlHandlingStrategy.merge(m.url,r.currentRawUrl),O={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||i$(r.source)};this.scheduleNavigation(C,bg,null,O,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}f$(m)&&this._events.next(m)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(h)}resetRootComponentType(h){this.routerState.root.component=h,this.navigationTransitions.rootComponentType=h}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),bg,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((h,m)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(h,"popstate",m)},0)})}navigateToSyncWithBrowser(h,m,r){let E={replaceUrl:!0},C=r?.navigationId?r:null;if(r){let z=xt({},r);delete z.navigationId,delete z.\u0275routerPageId,Object.keys(z).length!==0&&(E.state=z)}let O=this.parseUrl(h);this.scheduleNavigation(O,m,C,E)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(h){this.config=h.map(vI),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(h,m={}){let{relativeTo:r,queryParams:E,fragment:C,queryParamsHandling:O,preserveFragment:z}=m,Z=z?this.currentUrlTree.fragment:C,ce=null;switch(O){case"merge":ce=xt(xt({},this.currentUrlTree.queryParams),E);break;case"preserve":ce=this.currentUrlTree.queryParams;break;default:ce=E||null}ce!==null&&(ce=this.removeEmptyProps(ce));let Ie;try{let be=r?r.snapshot:this.routerState.snapshot.root;Ie=bO(be)}catch{(typeof h[0]!="string"||!h[0].startsWith("/"))&&(h=[]),Ie=this.currentUrlTree.root}return wO(Ie,h,ce,Z??null)}navigateByUrl(h,m={skipLocationChange:!1}){let r=Mf(h)?h:this.parseUrl(h),E=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(E,bg,null,m)}navigate(h,m={skipLocationChange:!1}){return d$(h),this.navigateByUrl(this.createUrlTree(h,m),m)}serializeUrl(h){return this.urlSerializer.serialize(h)}parseUrl(h){try{return this.urlSerializer.parse(h)}catch{return this.urlSerializer.parse("/")}}isActive(h,m){let r;if(m===!0?r=xt({},u$):m===!1?r=xt({},h$):r=m,Mf(h))return sO(this.currentUrlTree,h,r);let E=this.parseUrl(h);return sO(this.currentUrlTree,E,r)}removeEmptyProps(h){return Object.entries(h).reduce((m,[r,E])=>(E!=null&&(m[r]=E),m),{})}scheduleNavigation(h,m,r,E,C){if(this.disposed)return Promise.resolve(!1);let O,z,Z;C?(O=C.resolve,z=C.reject,Z=C.promise):Z=new Promise((Ie,be)=>{O=Ie,z=be});let ce=this.pendingTasks.add();return l$(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(ce))}),this.navigationTransitions.handleNavigationRequest({source:m,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:h,extras:E,resolve:O,reject:z,promise:Z,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Z.catch(Ie=>Promise.reject(Ie))}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function d$(o){for(let i=0;i<o.length;i++)if(o[i]==null)throw new gt(4008,!1)}function f$(o){return!(o instanceof Dg)&&!(o instanceof Sg)}var p$=new gn("");function BO(o,...i){return Ec([{provide:wI,multi:!0,useValue:o},[],{provide:Af,useFactory:m$,deps:[rx]},{provide:Iv,multi:!0,useFactory:g$},i.map(c=>c.\u0275providers)])}function m$(o){return o.routerState.root}function g$(){let o=Et(ng);return i=>{let c=o.get(yf);if(i!==c.components[0])return;let h=o.get(rx),m=o.get(_$);o.get(y$)===1&&h.initialNavigation(),o.get(v$,null,zn.Optional)?.setUpPreloading(),o.get(p$,null,zn.Optional)?.init(),h.resetRootComponentType(c.componentTypes[0]),m.closed||(m.next(),m.complete(),m.unsubscribe())}}var _$=new gn("",{factory:()=>new Ti}),y$=new gn("",{providedIn:"root",factory:()=>1});var v$=new gn("");var VO=(()=>{let i=class i{handleMenuClick(h,m){h.cancelBubble=!0}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=Br({type:i,selectors:[["app-sensor-overview"]],standalone:!0,features:[Vr],decls:0,vars:0,template:function(m,r){},dependencies:[Di]});let o=i;return o})();var jO=[{path:"",children:[{path:"sensors",component:VO,data:{animation:"sensorsPage"}}]}];var Lg=class{},x$=(()=>{let i=class i extends Lg{constructor(h){super(),this.http=h}getSvg(h){return this.http.get(h,{responseType:"text"})}};i.\u0275fac=function(m){return new(m||i)(cn(CT))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),b$=new gn("SERVER_URL"),TI=(()=>{let i=class i{constructor(){this.loader=Et(Lg),this.serverUrl=Et(b$,{optional:!0}),this.document=Et(Xr),this.iconsByUrl=new Map,this.iconsLoadingByUrl=new Map}addSvg(h,m){if(!this.iconsByUrl.has(h)){let r=this.document.createElement("DIV");r.innerHTML=m;let E=r.querySelector("svg");this.iconsByUrl.set(h,E)}}loadSvg(h,m=h){if(this.serverUrl&&h.match(/^(http(s)?):/)===null&&(h=this.serverUrl+h,m=h),this.iconsByUrl.has(m))return ln(this.iconsByUrl.get(m));if(this.iconsLoadingByUrl.has(m))return this.iconsLoadingByUrl.get(m);let r=this.loader.getSvg(h).pipe(Pn(E=>{let C=this.document.createElement("DIV");return C.innerHTML=E,C.querySelector("svg")}),Yr(E=>this.iconsByUrl.set(m,E)),Ks(E=>(console.error(E),Za(E))),Qs(()=>this.iconsLoadingByUrl.delete(m)),Lw());return this.iconsLoadingByUrl.set(m,r),r}getSvgByName(h){return this.iconsByUrl.has(h)?ln(this.iconsByUrl.get(h)):this.iconsLoadingByUrl.has(h)?this.iconsLoadingByUrl.get(h):Za(`No svg with name '${h}' has been loaded`)}unloadSvg(h){this.iconsByUrl.has(h)&&this.iconsByUrl.delete(h)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})();function w$(o){return o||new TI}var E$={provide:TI,deps:[[new ff,new Jm,TI]],useFactory:w$};function $O(o={}){return Ec([E$,o.loader||{provide:Lg,useClass:x$}])}var dn=function(o){return o[o.State=0]="State",o[o.Transition=1]="Transition",o[o.Sequence=2]="Sequence",o[o.Group=3]="Group",o[o.Animate=4]="Animate",o[o.Keyframes=5]="Keyframes",o[o.Style=6]="Style",o[o.Trigger=7]="Trigger",o[o.Reference=8]="Reference",o[o.AnimateChild=9]="AnimateChild",o[o.AnimateRef=10]="AnimateRef",o[o.Query=11]="Query",o[o.Stagger=12]="Stagger",o}(dn||{}),ws="*";function Fg(o,i){return{type:dn.Trigger,name:o,definitions:i,options:{}}}function Lf(o,i=null){return{type:dn.Animate,styles:i,timings:o}}function ix(o,i=null){return{type:dn.Group,steps:o,options:i}}function GO(o,i=null){return{type:dn.Sequence,steps:o,options:i}}function qi(o){return{type:dn.Style,styles:o,offset:null}}function II(o){return{type:dn.Keyframes,steps:o}}function Ng(o,i,c=null){return{type:dn.Transition,expr:o,animation:i,options:c}}function DI(o,i=null){return{type:dn.Reference,animation:o,options:i}}function ox(o=null){return{type:dn.AnimateChild,options:o}}function qO(o,i=null){return{type:dn.AnimateRef,animation:o,options:i}}function Lc(o,i,c=null){return{type:dn.Query,selector:o,animation:i,options:c}}var Oc=class{constructor(i=0,c=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=i+c}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(i=>i()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(i){this._position=this.totalTime?i*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(i){let c=i=="start"?this._onStartFns:this._onDoneFns;c.forEach(h=>h()),c.length=0}},kg=class{constructor(i){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=i;let c=0,h=0,m=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(E=>{E.onDone(()=>{++c==r&&this._onFinish()}),E.onDestroy(()=>{++h==r&&this._onDestroy()}),E.onStart(()=>{++m==r&&this._onStart()})}),this.totalTime=this.players.reduce((E,C)=>Math.max(E,C.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this.players.forEach(i=>i.init())}onStart(i){this._onStartFns.push(i)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(i=>i()),this._onStartFns=[])}onDone(i){this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(i=>i.play())}pause(){this.players.forEach(i=>i.pause())}restart(){this.players.forEach(i=>i.restart())}finish(){this._onFinish(),this.players.forEach(i=>i.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(i=>i.destroy()),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this.players.forEach(i=>i.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(i){let c=i*this.totalTime;this.players.forEach(h=>{let m=h.totalTime?Math.min(1,c/h.totalTime):1;h.setPosition(m)})}getPosition(){let i=this.players.reduce((c,h)=>c===null||h.totalTime>c.totalTime?h:c,null);return i!=null?i.getPosition():0}beforeDestroy(){this.players.forEach(i=>{i.beforeDestroy&&i.beforeDestroy()})}triggerCallback(i){let c=i=="start"?this._onStartFns:this._onDoneFns;c.forEach(h=>h()),c.length=0}},sx="!";function HO(o){return new gt(3e3,!1)}function T$(){return new gt(3100,!1)}function I$(){return new gt(3101,!1)}function D$(o){return new gt(3001,!1)}function S$(o){return new gt(3003,!1)}function C$(o){return new gt(3004,!1)}function M$(o,i){return new gt(3005,!1)}function A$(){return new gt(3006,!1)}function P$(){return new gt(3007,!1)}function R$(o,i){return new gt(3008,!1)}function O$(o){return new gt(3002,!1)}function L$(o,i,c,h,m){return new gt(3010,!1)}function k$(){return new gt(3011,!1)}function F$(){return new gt(3012,!1)}function N$(){return new gt(3200,!1)}function z$(){return new gt(3202,!1)}function B$(){return new gt(3013,!1)}function U$(o){return new gt(3014,!1)}function V$(o){return new gt(3015,!1)}function j$(o){return new gt(3016,!1)}function $$(o,i){return new gt(3404,!1)}function G$(o){return new gt(3502,!1)}function q$(o){return new gt(3503,!1)}function H$(){return new gt(3300,!1)}function W$(o){return new gt(3504,!1)}function Z$(o){return new gt(3301,!1)}function Y$(o,i){return new gt(3302,!1)}function X$(o){return new gt(3303,!1)}function K$(o,i){return new gt(3400,!1)}function Q$(o){return new gt(3401,!1)}function J$(o){return new gt(3402,!1)}function eG(o,i){return new gt(3505,!1)}function kc(o){switch(o.length){case 0:return new Oc;case 1:return o[0];default:return new kg(o)}}function sL(o,i,c=new Map,h=new Map){let m=[],r=[],E=-1,C=null;if(i.forEach(O=>{let z=O.get("offset"),Z=z==E,ce=Z&&C||new Map;O.forEach((Ie,be)=>{let qe=be,ot=Ie;if(be!=="offset")switch(qe=o.normalizePropertyName(qe,m),ot){case sx:ot=c.get(be);break;case ws:ot=h.get(be);break;default:ot=o.normalizeStyleValue(be,qe,ot,m);break}ce.set(qe,ot)}),Z||r.push(ce),C=ce,E=z}),m.length)throw G$(m);return r}function YI(o,i,c,h){switch(i){case"start":o.onStart(()=>h(c&&SI(c,"start",o)));break;case"done":o.onDone(()=>h(c&&SI(c,"done",o)));break;case"destroy":o.onDestroy(()=>h(c&&SI(c,"destroy",o)));break}}function SI(o,i,c){let h=c.totalTime,m=!!c.disabled,r=XI(o.element,o.triggerName,o.fromState,o.toState,i||o.phaseName,h??o.totalTime,m),E=o._data;return E!=null&&(r._data=E),r}function XI(o,i,c,h,m="",r=0,E){return{element:o,triggerName:i,fromState:c,toState:h,phaseName:m,totalTime:r,disabled:!!E}}function Co(o,i,c){let h=o.get(i);return h||o.set(i,h=c),h}function WO(o){let i=o.indexOf(":"),c=o.substring(1,i),h=o.slice(i+1);return[c,h]}var tG=typeof document>"u"?null:document.documentElement;function KI(o){let i=o.parentNode||o.host||null;return i===tG?null:i}function nG(o){return o.substring(1,6)=="ebkit"}var vh=null,ZO=!1;function rG(o){vh||(vh=iG()||{},ZO=vh.style?"WebkitAppearance"in vh.style:!1);let i=!0;return vh.style&&!nG(o)&&(i=o in vh.style,!i&&ZO&&(i="Webkit"+o.charAt(0).toUpperCase()+o.slice(1)in vh.style)),i}function iG(){return typeof document<"u"?document.body:null}function aL(o,i){for(;i;){if(i===o)return!0;i=KI(i)}return!1}function lL(o,i,c){if(c)return Array.from(o.querySelectorAll(i));let h=o.querySelector(i);return h?[h]:[]}var QI=(()=>{let i=class i{validateStyleProperty(h){return rG(h)}containsElement(h,m){return aL(h,m)}getParentElement(h){return KI(h)}query(h,m,r){return lL(h,m,r)}computeStyle(h,m,r){return r||""}animate(h,m,r,E,C,O=[],z){return new Oc(r,E)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})(),nD=class nD{};nD.NOOP=new QI;var wh=nD,Eh=class{};var oG=1e3,cL="{{",sG="}}",uL="ng-enter",OI="ng-leave",ax="ng-trigger",dx=".ng-trigger",YO="ng-animating",LI=".ng-animating";function tl(o){if(typeof o=="number")return o;let i=o.match(/^(-?[\.\d]+)(m?s)/);return!i||i.length<2?0:kI(parseFloat(i[1]),i[2])}function kI(o,i){switch(i){case"s":return o*oG;default:return o}}function fx(o,i,c){return o.hasOwnProperty("duration")?o:aG(o,i,c)}function aG(o,i,c){let h=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,m,r=0,E="";if(typeof o=="string"){let C=o.match(h);if(C===null)return i.push(HO(o)),{duration:0,delay:0,easing:""};m=kI(parseFloat(C[1]),C[2]);let O=C[3];O!=null&&(r=kI(parseFloat(O),C[4]));let z=C[5];z&&(E=z)}else m=o;if(!c){let C=!1,O=i.length;m<0&&(i.push(T$()),C=!0),r<0&&(i.push(I$()),C=!0),C&&i.splice(O,0,HO(o))}return{duration:m,delay:r,easing:E}}function lG(o){return o.length?o[0]instanceof Map?o:o.map(i=>new Map(Object.entries(i))):[]}function ha(o,i,c){i.forEach((h,m)=>{let r=JI(m);c&&!c.has(m)&&c.set(m,o.style[r]),o.style[r]=h})}function bh(o,i){i.forEach((c,h)=>{let m=JI(h);o.style[m]=""})}function zg(o){return Array.isArray(o)?o.length==1?o[0]:GO(o):o}function cG(o,i,c){let h=i.params||{},m=hL(o);m.length&&m.forEach(r=>{h.hasOwnProperty(r)||c.push(D$(r))})}var FI=new RegExp(`${cL}\\s*(.+?)\\s*${sG}`,"g");function hL(o){let i=[];if(typeof o=="string"){let c;for(;c=FI.exec(o);)i.push(c[1]);FI.lastIndex=0}return i}function Ug(o,i,c){let h=`${o}`,m=h.replace(FI,(r,E)=>{let C=i[E];return C==null&&(c.push(S$(E)),C=""),C.toString()});return m==h?o:m}var uG=/-+([a-z0-9])/g;function JI(o){return o.replace(uG,(...i)=>i[1].toUpperCase())}function hG(o,i){return o===0||i===0}function dG(o,i,c){if(c.size&&i.length){let h=i[0],m=[];if(c.forEach((r,E)=>{h.has(E)||m.push(E),h.set(E,r)}),m.length)for(let r=1;r<i.length;r++){let E=i[r];m.forEach(C=>E.set(C,eD(o,C)))}}return i}function So(o,i,c){switch(i.type){case dn.Trigger:return o.visitTrigger(i,c);case dn.State:return o.visitState(i,c);case dn.Transition:return o.visitTransition(i,c);case dn.Sequence:return o.visitSequence(i,c);case dn.Group:return o.visitGroup(i,c);case dn.Animate:return o.visitAnimate(i,c);case dn.Keyframes:return o.visitKeyframes(i,c);case dn.Style:return o.visitStyle(i,c);case dn.Reference:return o.visitReference(i,c);case dn.AnimateChild:return o.visitAnimateChild(i,c);case dn.AnimateRef:return o.visitAnimateRef(i,c);case dn.Query:return o.visitQuery(i,c);case dn.Stagger:return o.visitStagger(i,c);default:throw C$(i.type)}}function eD(o,i){return window.getComputedStyle(o)[i]}var fG=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),px=class extends Eh{normalizePropertyName(i,c){return JI(i)}normalizeStyleValue(i,c,h,m){let r="",E=h.toString().trim();if(fG.has(c)&&h!==0&&h!=="0")if(typeof h=="number")r="px";else{let C=h.match(/^[+-]?[\d\.]+([a-z]*)$/);C&&C[1].length==0&&m.push(M$(i,h))}return E+r}};var mx="*";function pG(o,i){let c=[];return typeof o=="string"?o.split(/\s*,\s*/).forEach(h=>mG(h,c,i)):c.push(o),c}function mG(o,i,c){if(o[0]==":"){let O=gG(o,c);if(typeof O=="function"){i.push(O);return}o=O}let h=o.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(h==null||h.length<4)return c.push(V$(o)),i;let m=h[1],r=h[2],E=h[3];i.push(XO(m,E));let C=m==mx&&E==mx;r[0]=="<"&&!C&&i.push(XO(E,m))}function gG(o,i){switch(o){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(c,h)=>parseFloat(h)>parseFloat(c);case":decrement":return(c,h)=>parseFloat(h)<parseFloat(c);default:return i.push(j$(o)),"* => *"}}var lx=new Set(["true","1"]),cx=new Set(["false","0"]);function XO(o,i){let c=lx.has(o)||cx.has(o),h=lx.has(i)||cx.has(i);return(m,r)=>{let E=o==mx||o==m,C=i==mx||i==r;return!E&&c&&typeof m=="boolean"&&(E=m?lx.has(o):cx.has(o)),!C&&h&&typeof r=="boolean"&&(C=r?lx.has(i):cx.has(i)),E&&C}}var dL=":self",_G=new RegExp(`s*${dL}s*,?`,"g");function fL(o,i,c,h){return new NI(o).build(i,c,h)}var KO="",NI=class{constructor(i){this._driver=i}build(i,c,h){let m=new zI(c);return this._resetContextStyleTimingState(m),So(this,zg(i),m)}_resetContextStyleTimingState(i){i.currentQuerySelector=KO,i.collectedStyles=new Map,i.collectedStyles.set(KO,new Map),i.currentTime=0}visitTrigger(i,c){let h=c.queryCount=0,m=c.depCount=0,r=[],E=[];return i.name.charAt(0)=="@"&&c.errors.push(A$()),i.definitions.forEach(C=>{if(this._resetContextStyleTimingState(c),C.type==dn.State){let O=C,z=O.name;z.toString().split(/\s*,\s*/).forEach(Z=>{O.name=Z,r.push(this.visitState(O,c))}),O.name=z}else if(C.type==dn.Transition){let O=this.visitTransition(C,c);h+=O.queryCount,m+=O.depCount,E.push(O)}else c.errors.push(P$())}),{type:dn.Trigger,name:i.name,states:r,transitions:E,queryCount:h,depCount:m,options:null}}visitState(i,c){let h=this.visitStyle(i.styles,c),m=i.options&&i.options.params||null;if(h.containsDynamicStyles){let r=new Set,E=m||{};h.styles.forEach(C=>{C instanceof Map&&C.forEach(O=>{hL(O).forEach(z=>{E.hasOwnProperty(z)||r.add(z)})})}),r.size&&c.errors.push(R$(i.name,[...r.values()]))}return{type:dn.State,name:i.name,style:h,options:m?{params:m}:null}}visitTransition(i,c){c.queryCount=0,c.depCount=0;let h=So(this,zg(i.animation),c),m=pG(i.expr,c.errors);return{type:dn.Transition,matchers:m,animation:h,queryCount:c.queryCount,depCount:c.depCount,options:xh(i.options)}}visitSequence(i,c){return{type:dn.Sequence,steps:i.steps.map(h=>So(this,h,c)),options:xh(i.options)}}visitGroup(i,c){let h=c.currentTime,m=0,r=i.steps.map(E=>{c.currentTime=h;let C=So(this,E,c);return m=Math.max(m,c.currentTime),C});return c.currentTime=m,{type:dn.Group,steps:r,options:xh(i.options)}}visitAnimate(i,c){let h=bG(i.timings,c.errors);c.currentAnimateTimings=h;let m,r=i.styles?i.styles:qi({});if(r.type==dn.Keyframes)m=this.visitKeyframes(r,c);else{let E=i.styles,C=!1;if(!E){C=!0;let z={};h.easing&&(z.easing=h.easing),E=qi(z)}c.currentTime+=h.duration+h.delay;let O=this.visitStyle(E,c);O.isEmptyStep=C,m=O}return c.currentAnimateTimings=null,{type:dn.Animate,timings:h,style:m,options:null}}visitStyle(i,c){let h=this._makeStyleAst(i,c);return this._validateStyleAst(h,c),h}_makeStyleAst(i,c){let h=[],m=Array.isArray(i.styles)?i.styles:[i.styles];for(let C of m)typeof C=="string"?C===ws?h.push(C):c.errors.push(O$(C)):h.push(new Map(Object.entries(C)));let r=!1,E=null;return h.forEach(C=>{if(C instanceof Map&&(C.has("easing")&&(E=C.get("easing"),C.delete("easing")),!r)){for(let O of C.values())if(O.toString().indexOf(cL)>=0){r=!0;break}}}),{type:dn.Style,styles:h,easing:E,offset:i.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(i,c){let h=c.currentAnimateTimings,m=c.currentTime,r=c.currentTime;h&&r>0&&(r-=h.duration+h.delay),i.styles.forEach(E=>{typeof E!="string"&&E.forEach((C,O)=>{let z=c.collectedStyles.get(c.currentQuerySelector),Z=z.get(O),ce=!0;Z&&(r!=m&&r>=Z.startTime&&m<=Z.endTime&&(c.errors.push(L$(O,Z.startTime,Z.endTime,r,m)),ce=!1),r=Z.startTime),ce&&z.set(O,{startTime:r,endTime:m}),c.options&&cG(C,c.options,c.errors)})})}visitKeyframes(i,c){let h={type:dn.Keyframes,styles:[],options:null};if(!c.currentAnimateTimings)return c.errors.push(k$()),h;let m=1,r=0,E=[],C=!1,O=!1,z=0,Z=i.steps.map(ct=>{let bt=this._makeStyleAst(ct,c),St=bt.offset!=null?bt.offset:xG(bt.styles),$t=0;return St!=null&&(r++,$t=bt.offset=St),O=O||$t<0||$t>1,C=C||$t<z,z=$t,E.push($t),bt});O&&c.errors.push(F$()),C&&c.errors.push(N$());let ce=i.steps.length,Ie=0;r>0&&r<ce?c.errors.push(z$()):r==0&&(Ie=m/(ce-1));let be=ce-1,qe=c.currentTime,ot=c.currentAnimateTimings,dt=ot.duration;return Z.forEach((ct,bt)=>{let St=Ie>0?bt==be?1:Ie*bt:E[bt],$t=St*dt;c.currentTime=qe+ot.delay+$t,ot.duration=$t,this._validateStyleAst(ct,c),ct.offset=St,h.styles.push(ct)}),h}visitReference(i,c){return{type:dn.Reference,animation:So(this,zg(i.animation),c),options:xh(i.options)}}visitAnimateChild(i,c){return c.depCount++,{type:dn.AnimateChild,options:xh(i.options)}}visitAnimateRef(i,c){return{type:dn.AnimateRef,animation:this.visitReference(i.animation,c),options:xh(i.options)}}visitQuery(i,c){let h=c.currentQuerySelector,m=i.options||{};c.queryCount++,c.currentQuery=i;let[r,E]=yG(i.selector);c.currentQuerySelector=h.length?h+" "+r:r,Co(c.collectedStyles,c.currentQuerySelector,new Map);let C=So(this,zg(i.animation),c);return c.currentQuery=null,c.currentQuerySelector=h,{type:dn.Query,selector:r,limit:m.limit||0,optional:!!m.optional,includeSelf:E,animation:C,originalSelector:i.selector,options:xh(i.options)}}visitStagger(i,c){c.currentQuery||c.errors.push(B$());let h=i.timings==="full"?{duration:0,delay:0,easing:"full"}:fx(i.timings,c.errors,!0);return{type:dn.Stagger,animation:So(this,zg(i.animation),c),timings:h,options:null}}};function yG(o){let i=!!o.split(/\s*,\s*/).find(c=>c==dL);return i&&(o=o.replace(_G,"")),o=o.replace(/@\*/g,dx).replace(/@\w+/g,c=>dx+"-"+c.slice(1)).replace(/:animating/g,LI),[o,i]}function vG(o){return o?xt({},o):null}var zI=class{constructor(i){this.errors=i,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function xG(o){if(typeof o=="string")return null;let i=null;if(Array.isArray(o))o.forEach(c=>{if(c instanceof Map&&c.has("offset")){let h=c;i=parseFloat(h.get("offset")),h.delete("offset")}});else if(o instanceof Map&&o.has("offset")){let c=o;i=parseFloat(c.get("offset")),c.delete("offset")}return i}function bG(o,i){if(o.hasOwnProperty("duration"))return o;if(typeof o=="number"){let r=fx(o,i).duration;return CI(r,0,"")}let c=o;if(c.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=CI(0,0,"");return r.dynamic=!0,r.strValue=c,r}let m=fx(c,i);return CI(m.duration,m.delay,m.easing)}function xh(o){return o?(o=xt({},o),o.params&&(o.params=vG(o.params))):o={},o}function CI(o,i,c){return{duration:o,delay:i,easing:c}}function tD(o,i,c,h,m,r,E=null,C=!1){return{type:1,element:o,keyframes:i,preStyleProps:c,postStyleProps:h,duration:m,delay:r,totalTime:m+r,easing:E,subTimeline:C}}var Vg=class{constructor(){this._map=new Map}get(i){return this._map.get(i)||[]}append(i,c){let h=this._map.get(i);h||this._map.set(i,h=[]),h.push(...c)}has(i){return this._map.has(i)}clear(){this._map.clear()}},wG=1,EG=":enter",TG=new RegExp(EG,"g"),IG=":leave",DG=new RegExp(IG,"g");function pL(o,i,c,h,m,r=new Map,E=new Map,C,O,z=[]){return new BI().buildKeyframes(o,i,c,h,m,r,E,C,O,z)}var BI=class{buildKeyframes(i,c,h,m,r,E,C,O,z,Z=[]){z=z||new Vg;let ce=new UI(i,c,z,m,r,Z,[]);ce.options=O;let Ie=O.delay?tl(O.delay):0;ce.currentTimeline.delayNextStep(Ie),ce.currentTimeline.setStyles([E],null,ce.errors,O),So(this,h,ce);let be=ce.timelines.filter(qe=>qe.containsAnimation());if(be.length&&C.size){let qe;for(let ot=be.length-1;ot>=0;ot--){let dt=be[ot];if(dt.element===c){qe=dt;break}}qe&&!qe.allowOnlyTimelineStyles()&&qe.setStyles([C],null,ce.errors,O)}return be.length?be.map(qe=>qe.buildKeyframes()):[tD(c,[],[],[],0,Ie,"",!1)]}visitTrigger(i,c){}visitState(i,c){}visitTransition(i,c){}visitAnimateChild(i,c){let h=c.subInstructions.get(c.element);if(h){let m=c.createSubContext(i.options),r=c.currentTimeline.currentTime,E=this._visitSubInstructions(h,m,m.options);r!=E&&c.transformIntoNewTimeline(E)}c.previousNode=i}visitAnimateRef(i,c){let h=c.createSubContext(i.options);h.transformIntoNewTimeline(),this._applyAnimationRefDelays([i.options,i.animation.options],c,h),this.visitReference(i.animation,h),c.transformIntoNewTimeline(h.currentTimeline.currentTime),c.previousNode=i}_applyAnimationRefDelays(i,c,h){for(let m of i){let r=m?.delay;if(r){let E=typeof r=="number"?r:tl(Ug(r,m?.params??{},c.errors));h.delayNextStep(E)}}}_visitSubInstructions(i,c,h){let r=c.currentTimeline.currentTime,E=h.duration!=null?tl(h.duration):null,C=h.delay!=null?tl(h.delay):null;return E!==0&&i.forEach(O=>{let z=c.appendInstructionToTimeline(O,E,C);r=Math.max(r,z.duration+z.delay)}),r}visitReference(i,c){c.updateOptions(i.options,!0),So(this,i.animation,c),c.previousNode=i}visitSequence(i,c){let h=c.subContextCount,m=c,r=i.options;if(r&&(r.params||r.delay)&&(m=c.createSubContext(r),m.transformIntoNewTimeline(),r.delay!=null)){m.previousNode.type==dn.Style&&(m.currentTimeline.snapshotCurrentStyles(),m.previousNode=gx);let E=tl(r.delay);m.delayNextStep(E)}i.steps.length&&(i.steps.forEach(E=>So(this,E,m)),m.currentTimeline.applyStylesToKeyframe(),m.subContextCount>h&&m.transformIntoNewTimeline()),c.previousNode=i}visitGroup(i,c){let h=[],m=c.currentTimeline.currentTime,r=i.options&&i.options.delay?tl(i.options.delay):0;i.steps.forEach(E=>{let C=c.createSubContext(i.options);r&&C.delayNextStep(r),So(this,E,C),m=Math.max(m,C.currentTimeline.currentTime),h.push(C.currentTimeline)}),h.forEach(E=>c.currentTimeline.mergeTimelineCollectedStyles(E)),c.transformIntoNewTimeline(m),c.previousNode=i}_visitTiming(i,c){if(i.dynamic){let h=i.strValue,m=c.params?Ug(h,c.params,c.errors):h;return fx(m,c.errors)}else return{duration:i.duration,delay:i.delay,easing:i.easing}}visitAnimate(i,c){let h=c.currentAnimateTimings=this._visitTiming(i.timings,c),m=c.currentTimeline;h.delay&&(c.incrementTime(h.delay),m.snapshotCurrentStyles());let r=i.style;r.type==dn.Keyframes?this.visitKeyframes(r,c):(c.incrementTime(h.duration),this.visitStyle(r,c),m.applyStylesToKeyframe()),c.currentAnimateTimings=null,c.previousNode=i}visitStyle(i,c){let h=c.currentTimeline,m=c.currentAnimateTimings;!m&&h.hasCurrentStyleProperties()&&h.forwardFrame();let r=m&&m.easing||i.easing;i.isEmptyStep?h.applyEmptyStep(r):h.setStyles(i.styles,r,c.errors,c.options),c.previousNode=i}visitKeyframes(i,c){let h=c.currentAnimateTimings,m=c.currentTimeline.duration,r=h.duration,C=c.createSubContext().currentTimeline;C.easing=h.easing,i.styles.forEach(O=>{let z=O.offset||0;C.forwardTime(z*r),C.setStyles(O.styles,O.easing,c.errors,c.options),C.applyStylesToKeyframe()}),c.currentTimeline.mergeTimelineCollectedStyles(C),c.transformIntoNewTimeline(m+r),c.previousNode=i}visitQuery(i,c){let h=c.currentTimeline.currentTime,m=i.options||{},r=m.delay?tl(m.delay):0;r&&(c.previousNode.type===dn.Style||h==0&&c.currentTimeline.hasCurrentStyleProperties())&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=gx);let E=h,C=c.invokeQuery(i.selector,i.originalSelector,i.limit,i.includeSelf,!!m.optional,c.errors);c.currentQueryTotal=C.length;let O=null;C.forEach((z,Z)=>{c.currentQueryIndex=Z;let ce=c.createSubContext(i.options,z);r&&ce.delayNextStep(r),z===c.element&&(O=ce.currentTimeline),So(this,i.animation,ce),ce.currentTimeline.applyStylesToKeyframe();let Ie=ce.currentTimeline.currentTime;E=Math.max(E,Ie)}),c.currentQueryIndex=0,c.currentQueryTotal=0,c.transformIntoNewTimeline(E),O&&(c.currentTimeline.mergeTimelineCollectedStyles(O),c.currentTimeline.snapshotCurrentStyles()),c.previousNode=i}visitStagger(i,c){let h=c.parentContext,m=c.currentTimeline,r=i.timings,E=Math.abs(r.duration),C=E*(c.currentQueryTotal-1),O=E*c.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":O=C-O;break;case"full":O=h.currentStaggerTime;break}let Z=c.currentTimeline;O&&Z.delayNextStep(O);let ce=Z.currentTime;So(this,i.animation,c),c.previousNode=i,h.currentStaggerTime=m.currentTime-ce+(m.startTime-h.currentTimeline.startTime)}},gx={},UI=class o{constructor(i,c,h,m,r,E,C,O){this._driver=i,this.element=c,this.subInstructions=h,this._enterClassName=m,this._leaveClassName=r,this.errors=E,this.timelines=C,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=gx,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=O||new _x(this._driver,c,0),C.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(i,c){if(!i)return;let h=i,m=this.options;h.duration!=null&&(m.duration=tl(h.duration)),h.delay!=null&&(m.delay=tl(h.delay));let r=h.params;if(r){let E=m.params;E||(E=this.options.params={}),Object.keys(r).forEach(C=>{(!c||!E.hasOwnProperty(C))&&(E[C]=Ug(r[C],E,this.errors))})}}_copyOptions(){let i={};if(this.options){let c=this.options.params;if(c){let h=i.params={};Object.keys(c).forEach(m=>{h[m]=c[m]})}}return i}createSubContext(i=null,c,h){let m=c||this.element,r=new o(this._driver,m,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(m,h||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(i),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(i){return this.previousNode=gx,this.currentTimeline=this.currentTimeline.fork(this.element,i),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(i,c,h){let m={duration:c??i.duration,delay:this.currentTimeline.currentTime+(h??0)+i.delay,easing:""},r=new VI(this._driver,i.element,i.keyframes,i.preStyleProps,i.postStyleProps,m,i.stretchStartingKeyframe);return this.timelines.push(r),m}incrementTime(i){this.currentTimeline.forwardTime(this.currentTimeline.duration+i)}delayNextStep(i){i>0&&this.currentTimeline.delayNextStep(i)}invokeQuery(i,c,h,m,r,E){let C=[];if(m&&C.push(this.element),i.length>0){i=i.replace(TG,"."+this._enterClassName),i=i.replace(DG,"."+this._leaveClassName);let O=h!=1,z=this._driver.query(this.element,i,O);h!==0&&(z=h<0?z.slice(z.length+h,z.length):z.slice(0,h)),C.push(...z)}return!r&&C.length==0&&E.push(U$(c)),C}},_x=class o{constructor(i,c,h,m){this._driver=i,this.element=c,this.startTime=h,this._elementTimelineStylesLookup=m,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(c),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(c,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(i){let c=this._keyframes.size===1&&this._pendingStyles.size;this.duration||c?(this.forwardTime(this.currentTime+i),c&&this.snapshotCurrentStyles()):this.startTime+=i}fork(i,c){return this.applyStylesToKeyframe(),new o(this._driver,i,c||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=wG,this._loadKeyframe()}forwardTime(i){this.applyStylesToKeyframe(),this.duration=i,this._loadKeyframe()}_updateStyle(i,c){this._localTimelineStyles.set(i,c),this._globalTimelineStyles.set(i,c),this._styleSummary.set(i,{time:this.currentTime,value:c})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(i){i&&this._previousKeyframe.set("easing",i);for(let[c,h]of this._globalTimelineStyles)this._backFill.set(c,h||ws),this._currentKeyframe.set(c,ws);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(i,c,h,m){c&&this._previousKeyframe.set("easing",c);let r=m&&m.params||{},E=SG(i,this._globalTimelineStyles);for(let[C,O]of E){let z=Ug(O,r,h);this._pendingStyles.set(C,z),this._localTimelineStyles.has(C)||this._backFill.set(C,this._globalTimelineStyles.get(C)??ws),this._updateStyle(C,z)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((i,c)=>{this._currentKeyframe.set(c,i)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((i,c)=>{this._currentKeyframe.has(c)||this._currentKeyframe.set(c,i)}))}snapshotCurrentStyles(){for(let[i,c]of this._localTimelineStyles)this._pendingStyles.set(i,c),this._updateStyle(i,c)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let i=[];for(let c in this._currentKeyframe)i.push(c);return i}mergeTimelineCollectedStyles(i){i._styleSummary.forEach((c,h)=>{let m=this._styleSummary.get(h);(!m||c.time>m.time)&&this._updateStyle(h,c.value)})}buildKeyframes(){this.applyStylesToKeyframe();let i=new Set,c=new Set,h=this._keyframes.size===1&&this.duration===0,m=[];this._keyframes.forEach((C,O)=>{let z=new Map([...this._backFill,...C]);z.forEach((Z,ce)=>{Z===sx?i.add(ce):Z===ws&&c.add(ce)}),h||z.set("offset",O/this.duration),m.push(z)});let r=[...i.values()],E=[...c.values()];if(h){let C=m[0],O=new Map(C);C.set("offset",0),O.set("offset",1),m=[C,O]}return tD(this.element,m,r,E,this.duration,this.startTime,this.easing,!1)}},VI=class extends _x{constructor(i,c,h,m,r,E,C=!1){super(i,c,E.delay),this.keyframes=h,this.preStyleProps=m,this.postStyleProps=r,this._stretchStartingKeyframe=C,this.timings={duration:E.duration,delay:E.delay,easing:E.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let i=this.keyframes,{delay:c,duration:h,easing:m}=this.timings;if(this._stretchStartingKeyframe&&c){let r=[],E=h+c,C=c/E,O=new Map(i[0]);O.set("offset",0),r.push(O);let z=new Map(i[0]);z.set("offset",QO(C)),r.push(z);let Z=i.length-1;for(let ce=1;ce<=Z;ce++){let Ie=new Map(i[ce]),be=Ie.get("offset"),qe=c+be*h;Ie.set("offset",QO(qe/E)),r.push(Ie)}h=E,c=0,m="",i=r}return tD(this.element,i,this.preStyleProps,this.postStyleProps,h,c,m,!0)}};function QO(o,i=3){let c=Math.pow(10,i-1);return Math.round(o*c)/c}function SG(o,i){let c=new Map,h;return o.forEach(m=>{if(m==="*"){h??=i.keys();for(let r of h)c.set(r,ws)}else for(let[r,E]of m)c.set(r,E)}),c}function JO(o,i,c,h,m,r,E,C,O,z,Z,ce,Ie){return{type:0,element:o,triggerName:i,isRemovalTransition:m,fromState:c,fromStyles:r,toState:h,toStyles:E,timelines:C,queriedElements:O,preStyleProps:z,postStyleProps:Z,totalTime:ce,errors:Ie}}var MI={},yx=class{constructor(i,c,h){this._triggerName=i,this.ast=c,this._stateStyles=h}match(i,c,h,m){return CG(this.ast.matchers,i,c,h,m)}buildStyles(i,c,h){let m=this._stateStyles.get("*");return i!==void 0&&(m=this._stateStyles.get(i?.toString())||m),m?m.buildStyles(c,h):new Map}build(i,c,h,m,r,E,C,O,z,Z){let ce=[],Ie=this.ast.options&&this.ast.options.params||MI,be=C&&C.params||MI,qe=this.buildStyles(h,be,ce),ot=O&&O.params||MI,dt=this.buildStyles(m,ot,ce),ct=new Set,bt=new Map,St=new Map,$t=m==="void",dr={params:mL(ot,Ie),delay:this.ast.options?.delay},Xn=Z?[]:pL(i,c,this.ast.animation,r,E,qe,dt,dr,z,ce),ir=0;return Xn.forEach(Yt=>{ir=Math.max(Yt.duration+Yt.delay,ir)}),ce.length?JO(c,this._triggerName,h,m,$t,qe,dt,[],[],bt,St,ir,ce):(Xn.forEach(Yt=>{let di=Yt.element,Xt=Co(bt,di,new Set);Yt.preStyleProps.forEach(Ni=>Xt.add(Ni));let fa=Co(St,di,new Set);Yt.postStyleProps.forEach(Ni=>fa.add(Ni)),di!==c&&ct.add(di)}),JO(c,this._triggerName,h,m,$t,qe,dt,Xn,[...ct.values()],bt,St,ir))}};function CG(o,i,c,h,m){return o.some(r=>r(i,c,h,m))}function mL(o,i){let c=xt({},i);return Object.entries(o).forEach(([h,m])=>{m!=null&&(c[h]=m)}),c}var jI=class{constructor(i,c,h){this.styles=i,this.defaultParams=c,this.normalizer=h}buildStyles(i,c){let h=new Map,m=mL(i,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((E,C)=>{E&&(E=Ug(E,m,c));let O=this.normalizer.normalizePropertyName(C,c);E=this.normalizer.normalizeStyleValue(C,O,E,c),h.set(C,E)})}),h}};function MG(o,i,c){return new $I(o,i,c)}var $I=class{constructor(i,c,h){this.name=i,this.ast=c,this._normalizer=h,this.transitionFactories=[],this.states=new Map,c.states.forEach(m=>{let r=m.options&&m.options.params||{};this.states.set(m.name,new jI(m.style,r,h))}),eL(this.states,"true","1"),eL(this.states,"false","0"),c.transitions.forEach(m=>{this.transitionFactories.push(new yx(i,m,this.states))}),this.fallbackTransition=AG(i,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(i,c,h,m){return this.transitionFactories.find(E=>E.match(i,c,h,m))||null}matchStyles(i,c,h){return this.fallbackTransition.buildStyles(i,c,h)}};function AG(o,i,c){let h=[(E,C)=>!0],m={type:dn.Sequence,steps:[],options:null},r={type:dn.Transition,animation:m,matchers:h,options:null,queryCount:0,depCount:0};return new yx(o,r,i)}function eL(o,i,c){o.has(i)?o.has(c)||o.set(c,o.get(i)):o.has(c)&&o.set(i,o.get(c))}var PG=new Vg,GI=class{constructor(i,c,h){this.bodyNode=i,this._driver=c,this._normalizer=h,this._animations=new Map,this._playersById=new Map,this.players=[]}register(i,c){let h=[],m=[],r=fL(this._driver,c,h,m);if(h.length)throw q$(h);m.length&&void 0,this._animations.set(i,r)}_buildPlayer(i,c,h){let m=i.element,r=sL(this._normalizer,i.keyframes,c,h);return this._driver.animate(m,r,i.duration,i.delay,i.easing,[],!0)}create(i,c,h={}){let m=[],r=this._animations.get(i),E,C=new Map;if(r?(E=pL(this._driver,c,r,uL,OI,new Map,new Map,h,PG,m),E.forEach(Z=>{let ce=Co(C,Z.element,new Map);Z.postStyleProps.forEach(Ie=>ce.set(Ie,null))})):(m.push(H$()),E=[]),m.length)throw W$(m);C.forEach((Z,ce)=>{Z.forEach((Ie,be)=>{Z.set(be,this._driver.computeStyle(ce,be,ws))})});let O=E.map(Z=>{let ce=C.get(Z.element);return this._buildPlayer(Z,new Map,ce)}),z=kc(O);return this._playersById.set(i,z),z.onDestroy(()=>this.destroy(i)),this.players.push(z),z}destroy(i){let c=this._getPlayer(i);c.destroy(),this._playersById.delete(i);let h=this.players.indexOf(c);h>=0&&this.players.splice(h,1)}_getPlayer(i){let c=this._playersById.get(i);if(!c)throw Z$(i);return c}listen(i,c,h,m){let r=XI(c,"","","");return YI(this._getPlayer(i),h,r,m),()=>{}}command(i,c,h,m){if(h=="register"){this.register(i,m[0]);return}if(h=="create"){let E=m[0]||{};this.create(i,c,E);return}let r=this._getPlayer(i);switch(h){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(m[0]));break;case"destroy":this.destroy(i);break}}},tL="ng-animate-queued",RG=".ng-animate-queued",AI="ng-animate-disabled",OG=".ng-animate-disabled",LG="ng-star-inserted",kG=".ng-star-inserted",FG=[],gL={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},NG={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Es="__ng_removed",jg=class{get params(){return this.options.params}constructor(i,c=""){this.namespaceId=c;let h=i&&i.hasOwnProperty("value"),m=h?i.value:i;if(this.value=BG(m),h){let r=i,{value:E}=r,C=Xs(r,["value"]);this.options=C}else this.options={};this.options.params||(this.options.params={})}absorbOptions(i){let c=i.params;if(c){let h=this.options.params;Object.keys(c).forEach(m=>{h[m]==null&&(h[m]=c[m])})}}},Bg="void",PI=new jg(Bg),qI=class{constructor(i,c,h){this.id=i,this.hostElement=c,this._engine=h,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+i,Wo(c,this._hostClassName)}listen(i,c,h,m){if(!this._triggers.has(c))throw Y$(h,c);if(h==null||h.length==0)throw X$(c);if(!UG(h))throw K$(h,c);let r=Co(this._elementListeners,i,[]),E={name:c,phase:h,callback:m};r.push(E);let C=Co(this._engine.statesByElement,i,new Map);return C.has(c)||(Wo(i,ax),Wo(i,ax+"-"+c),C.set(c,PI)),()=>{this._engine.afterFlush(()=>{let O=r.indexOf(E);O>=0&&r.splice(O,1),this._triggers.has(c)||C.delete(c)})}}register(i,c){return this._triggers.has(i)?!1:(this._triggers.set(i,c),!0)}_getTrigger(i){let c=this._triggers.get(i);if(!c)throw Q$(i);return c}trigger(i,c,h,m=!0){let r=this._getTrigger(c),E=new $g(this.id,c,i),C=this._engine.statesByElement.get(i);C||(Wo(i,ax),Wo(i,ax+"-"+c),this._engine.statesByElement.set(i,C=new Map));let O=C.get(c),z=new jg(h,this.id);if(!(h&&h.hasOwnProperty("value"))&&O&&z.absorbOptions(O.options),C.set(c,z),O||(O=PI),!(z.value===Bg)&&O.value===z.value){if(!$G(O.params,z.params)){let ot=[],dt=r.matchStyles(O.value,O.params,ot),ct=r.matchStyles(z.value,z.params,ot);ot.length?this._engine.reportError(ot):this._engine.afterFlush(()=>{bh(i,dt),ha(i,ct)})}return}let Ie=Co(this._engine.playersByElement,i,[]);Ie.forEach(ot=>{ot.namespaceId==this.id&&ot.triggerName==c&&ot.queued&&ot.destroy()});let be=r.matchTransition(O.value,z.value,i,z.params),qe=!1;if(!be){if(!m)return;be=r.fallbackTransition,qe=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:c,transition:be,fromState:O,toState:z,player:E,isFallbackTransition:qe}),qe||(Wo(i,tL),E.onStart(()=>{kf(i,tL)})),E.onDone(()=>{let ot=this.players.indexOf(E);ot>=0&&this.players.splice(ot,1);let dt=this._engine.playersByElement.get(i);if(dt){let ct=dt.indexOf(E);ct>=0&&dt.splice(ct,1)}}),this.players.push(E),Ie.push(E),E}deregister(i){this._triggers.delete(i),this._engine.statesByElement.forEach(c=>c.delete(i)),this._elementListeners.forEach((c,h)=>{this._elementListeners.set(h,c.filter(m=>m.name!=i))})}clearElementCache(i){this._engine.statesByElement.delete(i),this._elementListeners.delete(i);let c=this._engine.playersByElement.get(i);c&&(c.forEach(h=>h.destroy()),this._engine.playersByElement.delete(i))}_signalRemovalForInnerTriggers(i,c){let h=this._engine.driver.query(i,dx,!0);h.forEach(m=>{if(m[Es])return;let r=this._engine.fetchNamespacesByElement(m);r.size?r.forEach(E=>E.triggerLeaveAnimation(m,c,!1,!0)):this.clearElementCache(m)}),this._engine.afterFlushAnimationsDone(()=>h.forEach(m=>this.clearElementCache(m)))}triggerLeaveAnimation(i,c,h,m){let r=this._engine.statesByElement.get(i),E=new Map;if(r){let C=[];if(r.forEach((O,z)=>{if(E.set(z,O.value),this._triggers.has(z)){let Z=this.trigger(i,z,Bg,m);Z&&C.push(Z)}}),C.length)return this._engine.markElementAsRemoved(this.id,i,!0,c,E),h&&kc(C).onDone(()=>this._engine.processLeaveNode(i)),!0}return!1}prepareLeaveAnimationListeners(i){let c=this._elementListeners.get(i),h=this._engine.statesByElement.get(i);if(c&&h){let m=new Set;c.forEach(r=>{let E=r.name;if(m.has(E))return;m.add(E);let O=this._triggers.get(E).fallbackTransition,z=h.get(E)||PI,Z=new jg(Bg),ce=new $g(this.id,E,i);this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:E,transition:O,fromState:z,toState:Z,player:ce,isFallbackTransition:!0})})}}removeNode(i,c){let h=this._engine;if(i.childElementCount&&this._signalRemovalForInnerTriggers(i,c),this.triggerLeaveAnimation(i,c,!0))return;let m=!1;if(h.totalAnimations){let r=h.players.length?h.playersByQueriedElement.get(i):[];if(r&&r.length)m=!0;else{let E=i;for(;E=E.parentNode;)if(h.statesByElement.get(E)){m=!0;break}}}if(this.prepareLeaveAnimationListeners(i),m)h.markElementAsRemoved(this.id,i,!1,c);else{let r=i[Es];(!r||r===gL)&&(h.afterFlush(()=>this.clearElementCache(i)),h.destroyInnerAnimations(i),h._onRemovalComplete(i,c))}}insertNode(i,c){Wo(i,this._hostClassName)}drainQueuedTransitions(i){let c=[];return this._queue.forEach(h=>{let m=h.player;if(m.destroyed)return;let r=h.element,E=this._elementListeners.get(r);E&&E.forEach(C=>{if(C.name==h.triggerName){let O=XI(r,h.triggerName,h.fromState.value,h.toState.value);O._data=i,YI(h.player,C.phase,O,C.callback)}}),m.markedForDestroy?this._engine.afterFlush(()=>{m.destroy()}):c.push(h)}),this._queue=[],c.sort((h,m)=>{let r=h.transition.ast.depCount,E=m.transition.ast.depCount;return r==0||E==0?r-E:this._engine.driver.containsElement(h.element,m.element)?1:-1})}destroy(i){this.players.forEach(c=>c.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,i)}},HI=class{_onRemovalComplete(i,c){this.onRemovalComplete(i,c)}constructor(i,c,h){this.bodyNode=i,this.driver=c,this._normalizer=h,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(m,r)=>{}}get queuedPlayers(){let i=[];return this._namespaceList.forEach(c=>{c.players.forEach(h=>{h.queued&&i.push(h)})}),i}createNamespace(i,c){let h=new qI(i,c,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,c)?this._balanceNamespaceList(h,c):(this.newHostElements.set(c,h),this.collectEnterElement(c)),this._namespaceLookup[i]=h}_balanceNamespaceList(i,c){let h=this._namespaceList,m=this.namespacesByHostElement;if(h.length-1>=0){let E=!1,C=this.driver.getParentElement(c);for(;C;){let O=m.get(C);if(O){let z=h.indexOf(O);h.splice(z+1,0,i),E=!0;break}C=this.driver.getParentElement(C)}E||h.unshift(i)}else h.push(i);return m.set(c,i),i}register(i,c){let h=this._namespaceLookup[i];return h||(h=this.createNamespace(i,c)),h}registerTrigger(i,c,h){let m=this._namespaceLookup[i];m&&m.register(c,h)&&this.totalAnimations++}destroy(i,c){i&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let h=this._fetchNamespace(i);this.namespacesByHostElement.delete(h.hostElement);let m=this._namespaceList.indexOf(h);m>=0&&this._namespaceList.splice(m,1),h.destroy(c),delete this._namespaceLookup[i]}))}_fetchNamespace(i){return this._namespaceLookup[i]}fetchNamespacesByElement(i){let c=new Set,h=this.statesByElement.get(i);if(h){for(let m of h.values())if(m.namespaceId){let r=this._fetchNamespace(m.namespaceId);r&&c.add(r)}}return c}trigger(i,c,h,m){if(ux(c)){let r=this._fetchNamespace(i);if(r)return r.trigger(c,h,m),!0}return!1}insertNode(i,c,h,m){if(!ux(c))return;let r=c[Es];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let E=this.collectedLeaveElements.indexOf(c);E>=0&&this.collectedLeaveElements.splice(E,1)}if(i){let E=this._fetchNamespace(i);E&&E.insertNode(c,h)}m&&this.collectEnterElement(c)}collectEnterElement(i){this.collectedEnterElements.push(i)}markElementAsDisabled(i,c){c?this.disabledNodes.has(i)||(this.disabledNodes.add(i),Wo(i,AI)):this.disabledNodes.has(i)&&(this.disabledNodes.delete(i),kf(i,AI))}removeNode(i,c,h){if(ux(c)){let m=i?this._fetchNamespace(i):null;m?m.removeNode(c,h):this.markElementAsRemoved(i,c,!1,h);let r=this.namespacesByHostElement.get(c);r&&r.id!==i&&r.removeNode(c,h)}else this._onRemovalComplete(c,h)}markElementAsRemoved(i,c,h,m,r){this.collectedLeaveElements.push(c),c[Es]={namespaceId:i,setForRemoval:m,hasAnimation:h,removedBeforeQueried:!1,previousTriggersValues:r}}listen(i,c,h,m,r){return ux(c)?this._fetchNamespace(i).listen(c,h,m,r):()=>{}}_buildInstruction(i,c,h,m,r){return i.transition.build(this.driver,i.element,i.fromState.value,i.toState.value,h,m,i.fromState.options,i.toState.options,c,r)}destroyInnerAnimations(i){let c=this.driver.query(i,dx,!0);c.forEach(h=>this.destroyActiveAnimationsForElement(h)),this.playersByQueriedElement.size!=0&&(c=this.driver.query(i,LI,!0),c.forEach(h=>this.finishActiveQueriedAnimationOnElement(h)))}destroyActiveAnimationsForElement(i){let c=this.playersByElement.get(i);c&&c.forEach(h=>{h.queued?h.markedForDestroy=!0:h.destroy()})}finishActiveQueriedAnimationOnElement(i){let c=this.playersByQueriedElement.get(i);c&&c.forEach(h=>h.finish())}whenRenderingDone(){return new Promise(i=>{if(this.players.length)return kc(this.players).onDone(()=>i());i()})}processLeaveNode(i){let c=i[Es];if(c&&c.setForRemoval){if(i[Es]=gL,c.namespaceId){this.destroyInnerAnimations(i);let h=this._fetchNamespace(c.namespaceId);h&&h.clearElementCache(i)}this._onRemovalComplete(i,c.setForRemoval)}i.classList?.contains(AI)&&this.markElementAsDisabled(i,!1),this.driver.query(i,OG,!0).forEach(h=>{this.markElementAsDisabled(h,!1)})}flush(i=-1){let c=[];if(this.newHostElements.size&&(this.newHostElements.forEach((h,m)=>this._balanceNamespaceList(h,m)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let h=0;h<this.collectedEnterElements.length;h++){let m=this.collectedEnterElements[h];Wo(m,LG)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let h=[];try{c=this._flushAnimations(h,i)}finally{for(let m=0;m<h.length;m++)h[m]()}}else for(let h=0;h<this.collectedLeaveElements.length;h++){let m=this.collectedLeaveElements[h];this.processLeaveNode(m)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(h=>h()),this._flushFns=[],this._whenQuietFns.length){let h=this._whenQuietFns;this._whenQuietFns=[],c.length?kc(c).onDone(()=>{h.forEach(m=>m())}):h.forEach(m=>m())}}reportError(i){throw J$(i)}_flushAnimations(i,c){let h=new Vg,m=[],r=new Map,E=[],C=new Map,O=new Map,z=new Map,Z=new Set;this.disabledNodes.forEach(vt=>{Z.add(vt);let Nt=this.driver.query(vt,RG,!0);for(let Gt=0;Gt<Nt.length;Gt++)Z.add(Nt[Gt])});let ce=this.bodyNode,Ie=Array.from(this.statesByElement.keys()),be=iL(Ie,this.collectedEnterElements),qe=new Map,ot=0;be.forEach((vt,Nt)=>{let Gt=uL+ot++;qe.set(Nt,Gt),vt.forEach(En=>Wo(En,Gt))});let dt=[],ct=new Set,bt=new Set;for(let vt=0;vt<this.collectedLeaveElements.length;vt++){let Nt=this.collectedLeaveElements[vt],Gt=Nt[Es];Gt&&Gt.setForRemoval&&(dt.push(Nt),ct.add(Nt),Gt.hasAnimation?this.driver.query(Nt,kG,!0).forEach(En=>ct.add(En)):bt.add(Nt))}let St=new Map,$t=iL(Ie,Array.from(ct));$t.forEach((vt,Nt)=>{let Gt=OI+ot++;St.set(Nt,Gt),vt.forEach(En=>Wo(En,Gt))}),i.push(()=>{be.forEach((vt,Nt)=>{let Gt=qe.get(Nt);vt.forEach(En=>kf(En,Gt))}),$t.forEach((vt,Nt)=>{let Gt=St.get(Nt);vt.forEach(En=>kf(En,Gt))}),dt.forEach(vt=>{this.processLeaveNode(vt)})});let dr=[],Xn=[];for(let vt=this._namespaceList.length-1;vt>=0;vt--)this._namespaceList[vt].drainQueuedTransitions(c).forEach(Gt=>{let En=Gt.player,zt=Gt.element;if(dr.push(En),this.collectedEnterElements.length){let wr=zt[Es];if(wr&&wr.setForMove){if(wr.previousTriggersValues&&wr.previousTriggersValues.has(Gt.triggerName)){let kn=wr.previousTriggersValues.get(Gt.triggerName),Qr=this.statesByElement.get(Gt.element);if(Qr&&Qr.has(Gt.triggerName)){let Yo=Qr.get(Gt.triggerName);Yo.value=kn,Qr.set(Gt.triggerName,Yo)}}En.destroy();return}}let Kr=!ce||!this.driver.containsElement(ce,zt),Zn=St.get(zt),zi=qe.get(zt),or=this._buildInstruction(Gt,h,zi,Zn,Kr);if(or.errors&&or.errors.length){Xn.push(or);return}if(Kr){En.onStart(()=>bh(zt,or.fromStyles)),En.onDestroy(()=>ha(zt,or.toStyles)),m.push(En);return}if(Gt.isFallbackTransition){En.onStart(()=>bh(zt,or.fromStyles)),En.onDestroy(()=>ha(zt,or.toStyles)),m.push(En);return}let pa=[];or.timelines.forEach(wr=>{wr.stretchStartingKeyframe=!0,this.disabledNodes.has(wr.element)||pa.push(wr)}),or.timelines=pa,h.append(zt,or.timelines);let Ct={instruction:or,player:En,element:zt};E.push(Ct),or.queriedElements.forEach(wr=>Co(C,wr,[]).push(En)),or.preStyleProps.forEach((wr,kn)=>{if(wr.size){let Qr=O.get(kn);Qr||O.set(kn,Qr=new Set),wr.forEach((Yo,Ss)=>Qr.add(Ss))}}),or.postStyleProps.forEach((wr,kn)=>{let Qr=z.get(kn);Qr||z.set(kn,Qr=new Set),wr.forEach((Yo,Ss)=>Qr.add(Ss))})});if(Xn.length){let vt=[];Xn.forEach(Nt=>{vt.push(eG(Nt.triggerName,Nt.errors))}),dr.forEach(Nt=>Nt.destroy()),this.reportError(vt)}let ir=new Map,Yt=new Map;E.forEach(vt=>{let Nt=vt.element;h.has(Nt)&&(Yt.set(Nt,Nt),this._beforeAnimationBuild(vt.player.namespaceId,vt.instruction,ir))}),m.forEach(vt=>{let Nt=vt.element;this._getPreviousPlayers(Nt,!1,vt.namespaceId,vt.triggerName,null).forEach(En=>{Co(ir,Nt,[]).push(En),En.destroy()})});let di=dt.filter(vt=>oL(vt,O,z)),Xt=new Map;rL(Xt,this.driver,bt,z,ws).forEach(vt=>{oL(vt,O,z)&&di.push(vt)});let Ni=new Map;be.forEach((vt,Nt)=>{rL(Ni,this.driver,new Set(vt),O,sx)}),di.forEach(vt=>{let Nt=Xt.get(vt),Gt=Ni.get(vt);Xt.set(vt,new Map([...Nt?.entries()??[],...Gt?.entries()??[]]))});let Is=[],On=[],Ds={};E.forEach(vt=>{let{element:Nt,player:Gt,instruction:En}=vt;if(h.has(Nt)){if(Z.has(Nt)){Gt.onDestroy(()=>ha(Nt,En.toStyles)),Gt.disabled=!0,Gt.overrideTotalTime(En.totalTime),m.push(Gt);return}let zt=Ds;if(Yt.size>1){let Zn=Nt,zi=[];for(;Zn=Zn.parentNode;){let or=Yt.get(Zn);if(or){zt=or;break}zi.push(Zn)}zi.forEach(or=>Yt.set(or,zt))}let Kr=this._buildAnimation(Gt.namespaceId,En,ir,r,Ni,Xt);if(Gt.setRealPlayer(Kr),zt===Ds)Is.push(Gt);else{let Zn=this.playersByElement.get(zt);Zn&&Zn.length&&(Gt.parentPlayer=kc(Zn)),m.push(Gt)}}else bh(Nt,En.fromStyles),Gt.onDestroy(()=>ha(Nt,En.toStyles)),On.push(Gt),Z.has(Nt)&&m.push(Gt)}),On.forEach(vt=>{let Nt=r.get(vt.element);if(Nt&&Nt.length){let Gt=kc(Nt);vt.setRealPlayer(Gt)}}),m.forEach(vt=>{vt.parentPlayer?vt.syncPlayerEvents(vt.parentPlayer):vt.destroy()});for(let vt=0;vt<dt.length;vt++){let Nt=dt[vt],Gt=Nt[Es];if(kf(Nt,OI),Gt&&Gt.hasAnimation)continue;let En=[];if(C.size){let Kr=C.get(Nt);Kr&&Kr.length&&En.push(...Kr);let Zn=this.driver.query(Nt,LI,!0);for(let zi=0;zi<Zn.length;zi++){let or=C.get(Zn[zi]);or&&or.length&&En.push(...or)}}let zt=En.filter(Kr=>!Kr.destroyed);zt.length?VG(this,Nt,zt):this.processLeaveNode(Nt)}return dt.length=0,Is.forEach(vt=>{this.players.push(vt),vt.onDone(()=>{vt.destroy();let Nt=this.players.indexOf(vt);this.players.splice(Nt,1)}),vt.play()}),Is}afterFlush(i){this._flushFns.push(i)}afterFlushAnimationsDone(i){this._whenQuietFns.push(i)}_getPreviousPlayers(i,c,h,m,r){let E=[];if(c){let C=this.playersByQueriedElement.get(i);C&&(E=C)}else{let C=this.playersByElement.get(i);if(C){let O=!r||r==Bg;C.forEach(z=>{z.queued||!O&&z.triggerName!=m||E.push(z)})}}return(h||m)&&(E=E.filter(C=>!(h&&h!=C.namespaceId||m&&m!=C.triggerName))),E}_beforeAnimationBuild(i,c,h){let m=c.triggerName,r=c.element,E=c.isRemovalTransition?void 0:i,C=c.isRemovalTransition?void 0:m;for(let O of c.timelines){let z=O.element,Z=z!==r,ce=Co(h,z,[]);this._getPreviousPlayers(z,Z,E,C,c.toState).forEach(be=>{let qe=be.getRealPlayer();qe.beforeDestroy&&qe.beforeDestroy(),be.destroy(),ce.push(be)})}bh(r,c.fromStyles)}_buildAnimation(i,c,h,m,r,E){let C=c.triggerName,O=c.element,z=[],Z=new Set,ce=new Set,Ie=c.timelines.map(qe=>{let ot=qe.element;Z.add(ot);let dt=ot[Es];if(dt&&dt.removedBeforeQueried)return new Oc(qe.duration,qe.delay);let ct=ot!==O,bt=jG((h.get(ot)||FG).map(ir=>ir.getRealPlayer())).filter(ir=>{let Yt=ir;return Yt.element?Yt.element===ot:!1}),St=r.get(ot),$t=E.get(ot),dr=sL(this._normalizer,qe.keyframes,St,$t),Xn=this._buildPlayer(qe,dr,bt);if(qe.subTimeline&&m&&ce.add(ot),ct){let ir=new $g(i,C,ot);ir.setRealPlayer(Xn),z.push(ir)}return Xn});z.forEach(qe=>{Co(this.playersByQueriedElement,qe.element,[]).push(qe),qe.onDone(()=>zG(this.playersByQueriedElement,qe.element,qe))}),Z.forEach(qe=>Wo(qe,YO));let be=kc(Ie);return be.onDestroy(()=>{Z.forEach(qe=>kf(qe,YO)),ha(O,c.toStyles)}),ce.forEach(qe=>{Co(m,qe,[]).push(be)}),be}_buildPlayer(i,c,h){return c.length>0?this.driver.animate(i.element,c,i.duration,i.delay,i.easing,h):new Oc(i.duration,i.delay)}},$g=class{constructor(i,c,h){this.namespaceId=i,this.triggerName=c,this.element=h,this._player=new Oc,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(i){this._containsRealPlayer||(this._player=i,this._queuedCallbacks.forEach((c,h)=>{c.forEach(m=>YI(i,h,void 0,m))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(i.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(i){this.totalTime=i}syncPlayerEvents(i){let c=this._player;c.triggerCallback&&i.onStart(()=>c.triggerCallback("start")),i.onDone(()=>this.finish()),i.onDestroy(()=>this.destroy())}_queueEvent(i,c){Co(this._queuedCallbacks,i,[]).push(c)}onDone(i){this.queued&&this._queueEvent("done",i),this._player.onDone(i)}onStart(i){this.queued&&this._queueEvent("start",i),this._player.onStart(i)}onDestroy(i){this.queued&&this._queueEvent("destroy",i),this._player.onDestroy(i)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(i){this.queued||this._player.setPosition(i)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(i){let c=this._player;c.triggerCallback&&c.triggerCallback(i)}};function zG(o,i,c){let h=o.get(i);if(h){if(h.length){let m=h.indexOf(c);h.splice(m,1)}h.length==0&&o.delete(i)}return h}function BG(o){return o??null}function ux(o){return o&&o.nodeType===1}function UG(o){return o=="start"||o=="done"}function nL(o,i){let c=o.style.display;return o.style.display=i??"none",c}function rL(o,i,c,h,m){let r=[];c.forEach(O=>r.push(nL(O)));let E=[];h.forEach((O,z)=>{let Z=new Map;O.forEach(ce=>{let Ie=i.computeStyle(z,ce,m);Z.set(ce,Ie),(!Ie||Ie.length==0)&&(z[Es]=NG,E.push(z))}),o.set(z,Z)});let C=0;return c.forEach(O=>nL(O,r[C++])),E}function iL(o,i){let c=new Map;if(o.forEach(C=>c.set(C,[])),i.length==0)return c;let h=1,m=new Set(i),r=new Map;function E(C){if(!C)return h;let O=r.get(C);if(O)return O;let z=C.parentNode;return c.has(z)?O=z:m.has(z)?O=h:O=E(z),r.set(C,O),O}return i.forEach(C=>{let O=E(C);O!==h&&c.get(O).push(C)}),c}function Wo(o,i){o.classList?.add(i)}function kf(o,i){o.classList?.remove(i)}function VG(o,i,c){kc(c).onDone(()=>o.processLeaveNode(i))}function jG(o){let i=[];return _L(o,i),i}function _L(o,i){for(let c=0;c<o.length;c++){let h=o[c];h instanceof kg?_L(h.players,i):i.push(h)}}function $G(o,i){let c=Object.keys(o),h=Object.keys(i);if(c.length!=h.length)return!1;for(let m=0;m<c.length;m++){let r=c[m];if(!i.hasOwnProperty(r)||o[r]!==i[r])return!1}return!0}function oL(o,i,c){let h=c.get(o);if(!h)return!1;let m=i.get(o);return m?h.forEach(r=>m.add(r)):i.set(o,h),c.delete(o),!0}var Nf=class{constructor(i,c,h){this._driver=c,this._normalizer=h,this._triggerCache={},this.onRemovalComplete=(m,r)=>{},this._transitionEngine=new HI(i.body,c,h),this._timelineEngine=new GI(i.body,c,h),this._transitionEngine.onRemovalComplete=(m,r)=>this.onRemovalComplete(m,r)}registerTrigger(i,c,h,m,r){let E=i+"-"+m,C=this._triggerCache[E];if(!C){let O=[],z=[],Z=fL(this._driver,r,O,z);if(O.length)throw $$(m,O);z.length&&void 0,C=MG(m,Z,this._normalizer),this._triggerCache[E]=C}this._transitionEngine.registerTrigger(c,m,C)}register(i,c){this._transitionEngine.register(i,c)}destroy(i,c){this._transitionEngine.destroy(i,c)}onInsert(i,c,h,m){this._transitionEngine.insertNode(i,c,h,m)}onRemove(i,c,h){this._transitionEngine.removeNode(i,c,h)}disableAnimations(i,c){this._transitionEngine.markElementAsDisabled(i,c)}process(i,c,h,m){if(h.charAt(0)=="@"){let[r,E]=WO(h),C=m;this._timelineEngine.command(r,c,E,C)}else this._transitionEngine.trigger(i,c,h,m)}listen(i,c,h,m,r){if(h.charAt(0)=="@"){let[E,C]=WO(h);return this._timelineEngine.listen(E,c,C,r)}return this._transitionEngine.listen(i,c,h,m,r)}flush(i=-1){this._transitionEngine.flush(i)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(i){this._transitionEngine.afterFlushAnimationsDone(i)}};function GG(o,i){let c=null,h=null;return Array.isArray(i)&&i.length?(c=RI(i[0]),i.length>1&&(h=RI(i[i.length-1]))):i instanceof Map&&(c=RI(i)),c||h?new WI(o,c,h):null}var Ff=class Ff{constructor(i,c,h){this._element=i,this._startStyles=c,this._endStyles=h,this._state=0;let m=Ff.initialStylesByElement.get(i);m||Ff.initialStylesByElement.set(i,m=new Map),this._initialStyles=m}start(){this._state<1&&(this._startStyles&&ha(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ha(this._element,this._initialStyles),this._endStyles&&(ha(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Ff.initialStylesByElement.delete(this._element),this._startStyles&&(bh(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(bh(this._element,this._endStyles),this._endStyles=null),ha(this._element,this._initialStyles),this._state=3)}};Ff.initialStylesByElement=new WeakMap;var WI=Ff;function RI(o){let i=null;return o.forEach((c,h)=>{qG(h)&&(i=i||new Map,i.set(h,c))}),i}function qG(o){return o==="display"||o==="position"}var vx=class{constructor(i,c,h,m){this.element=i,this.keyframes=c,this.options=h,this._specialStyles=m,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=h.duration,this._delay=h.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let i=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,i,this.options),this._finalKeyframe=i.length?i[i.length-1]:new Map;let c=()=>this._onFinish();this.domPlayer.addEventListener("finish",c),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",c)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(i){let c=[];return i.forEach(h=>{c.push(Object.fromEntries(h))}),c}_triggerWebAnimation(i,c,h){return i.animate(this._convertKeyframesToObject(c),h)}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(i=>i()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}setPosition(i){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=i*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let i=new Map;this.hasStarted()&&this._finalKeyframe.forEach((h,m)=>{m!=="offset"&&i.set(m,this._finished?h:eD(this.element,m))}),this.currentSnapshot=i}triggerCallback(i){let c=i==="start"?this._onStartFns:this._onDoneFns;c.forEach(h=>h()),c.length=0}},xx=class{validateStyleProperty(i){return!0}validateAnimatableStyleProperty(i){return!0}containsElement(i,c){return aL(i,c)}getParentElement(i){return KI(i)}query(i,c,h){return lL(i,c,h)}computeStyle(i,c,h){return eD(i,c)}animate(i,c,h,m,r,E=[]){let C=m==0?"both":"forwards",O={duration:h,delay:m,fill:C};r&&(O.easing=r);let z=new Map,Z=E.filter(be=>be instanceof vx);hG(h,m)&&Z.forEach(be=>{be.currentSnapshot.forEach((qe,ot)=>z.set(ot,qe))});let ce=lG(c).map(be=>new Map(be));ce=dG(i,ce,z);let Ie=GG(i,ce);return new vx(i,ce,O,Ie)}};var hx="@",yL="@.disabled",bx=class{constructor(i,c,h,m){this.namespaceId=i,this.delegate=c,this.engine=h,this._onDestroy=m,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(i){this.delegate.destroyNode?.(i)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(i,c){return this.delegate.createElement(i,c)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}appendChild(i,c){this.delegate.appendChild(i,c),this.engine.onInsert(this.namespaceId,c,i,!1)}insertBefore(i,c,h,m=!0){this.delegate.insertBefore(i,c,h),this.engine.onInsert(this.namespaceId,c,i,m)}removeChild(i,c,h){this.engine.onRemove(this.namespaceId,c,this.delegate)}selectRootElement(i,c){return this.delegate.selectRootElement(i,c)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,c,h,m){this.delegate.setAttribute(i,c,h,m)}removeAttribute(i,c,h){this.delegate.removeAttribute(i,c,h)}addClass(i,c){this.delegate.addClass(i,c)}removeClass(i,c){this.delegate.removeClass(i,c)}setStyle(i,c,h,m){this.delegate.setStyle(i,c,h,m)}removeStyle(i,c,h){this.delegate.removeStyle(i,c,h)}setProperty(i,c,h){c.charAt(0)==hx&&c==yL?this.disableAnimations(i,!!h):this.delegate.setProperty(i,c,h)}setValue(i,c){this.delegate.setValue(i,c)}listen(i,c,h){return this.delegate.listen(i,c,h)}disableAnimations(i,c){this.engine.disableAnimations(i,c)}},ZI=class extends bx{constructor(i,c,h,m,r){super(c,h,m,r),this.factory=i,this.namespaceId=c}setProperty(i,c,h){c.charAt(0)==hx?c.charAt(1)=="."&&c==yL?(h=h===void 0?!0:!!h,this.disableAnimations(i,h)):this.engine.process(this.namespaceId,i,c.slice(1),h):this.delegate.setProperty(i,c,h)}listen(i,c,h){if(c.charAt(0)==hx){let m=HG(i),r=c.slice(1),E="";return r.charAt(0)!=hx&&([r,E]=WG(r)),this.engine.listen(this.namespaceId,m,r,E,C=>{let O=C._data||-1;this.factory.scheduleListenerCallback(O,h,C)})}return this.delegate.listen(i,c,h)}};function HG(o){switch(o){case"body":return document.body;case"document":return document;case"window":return window;default:return o}}function WG(o){let i=o.indexOf("."),c=o.substring(0,i),h=o.slice(i+1);return[c,h]}var wx=class{constructor(i,c,h){this.delegate=i,this.engine=c,this._zone=h,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,c.onRemovalComplete=(m,r)=>{let E=r?.parentNode(m);E&&r.removeChild(E,m)}}createRenderer(i,c){let h="",m=this.delegate.createRenderer(i,c);if(!i||!c?.data?.animation){let z=this._rendererCache,Z=z.get(m);if(!Z){let ce=()=>z.delete(m);Z=new bx(h,m,this.engine,ce),z.set(m,Z)}return Z}let r=c.id,E=c.id+"-"+this._currentId;this._currentId++,this.engine.register(E,i);let C=z=>{Array.isArray(z)?z.forEach(C):this.engine.registerTrigger(r,E,i,z.name,z)};return c.data.animation.forEach(C),new ZI(this,E,m,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,c,h){if(i>=0&&i<this._microtaskId){this._zone.run(()=>c(h));return}let m=this._animationCallbacksBuffer;m.length==0&&queueMicrotask(()=>{this._zone.run(()=>{m.forEach(r=>{let[E,C]=r;E(C)}),this._animationCallbacksBuffer=[]})}),m.push([c,h])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var YG=(()=>{let i=class i extends Nf{constructor(h,m,r){super(h,m,r,Et(Ym,{optional:!0}))}ngOnDestroy(){this.flush()}};i.\u0275fac=function(m){return new(m||i)(cn(Xr),cn(wh),cn(Eh))},i.\u0275prov=jt({token:i,factory:i.\u0275fac});let o=i;return o})();function XG(){return new px}function KG(o,i,c){return new wx(o,i,c)}var vL=[{provide:Eh,useFactory:XG},{provide:Nf,useClass:YG},{provide:oh,useFactory:KG,deps:[Uv,Nf,Rr]}],QG=[{provide:wh,useFactory:()=>new xx},{provide:KE,useValue:"BrowserAnimations"},...vL],BJ=[{provide:wh,useClass:QI},{provide:KE,useValue:"NoopAnimations"},...vL];function xL(){return ig("NgEagerAnimations"),[...QG]}var bL={providers:[BO(jO),$O(),xL()]};var JG={value:()=>{}};function EL(){for(var o=0,i=arguments.length,c={},h;o<i;++o){if(!(h=arguments[o]+"")||h in c||/[\s.]/.test(h))throw new Error("illegal type: "+h);c[h]=[]}return new Ex(c)}function Ex(o){this._=o}function eq(o,i){return o.trim().split(/^|\s+/).map(function(c){var h="",m=c.indexOf(".");if(m>=0&&(h=c.slice(m+1),c=c.slice(0,m)),c&&!i.hasOwnProperty(c))throw new Error("unknown type: "+c);return{type:c,name:h}})}Ex.prototype=EL.prototype={constructor:Ex,on:function(o,i){var c=this._,h=eq(o+"",c),m,r=-1,E=h.length;if(arguments.length<2){for(;++r<E;)if((m=(o=h[r]).type)&&(m=tq(c[m],o.name)))return m;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++r<E;)if(m=(o=h[r]).type)c[m]=wL(c[m],o.name,i);else if(i==null)for(m in c)c[m]=wL(c[m],o.name,null);return this},copy:function(){var o={},i=this._;for(var c in i)o[c]=i[c].slice();return new Ex(o)},call:function(o,i){if((m=arguments.length-2)>0)for(var c=new Array(m),h=0,m,r;h<m;++h)c[h]=arguments[h+2];if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(r=this._[o],h=0,m=r.length;h<m;++h)r[h].value.apply(i,c)},apply:function(o,i,c){if(!this._.hasOwnProperty(o))throw new Error("unknown type: "+o);for(var h=this._[o],m=0,r=h.length;m<r;++m)h[m].value.apply(i,c)}};function tq(o,i){for(var c=0,h=o.length,m;c<h;++c)if((m=o[c]).name===i)return m.value}function wL(o,i,c){for(var h=0,m=o.length;h<m;++h)if(o[h].name===i){o[h]=JG,o=o.slice(0,h).concat(o.slice(h+1));break}return c!=null&&o.push({name:i,value:c}),o}var rD=EL;var Tx="http://www.w3.org/1999/xhtml",iD={svg:"http://www.w3.org/2000/svg",xhtml:Tx,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function nl(o){var i=o+="",c=i.indexOf(":");return c>=0&&(i=o.slice(0,c))!=="xmlns"&&(o=o.slice(c+1)),iD.hasOwnProperty(i)?{space:iD[i],local:o}:o}function nq(o){return function(){var i=this.ownerDocument,c=this.namespaceURI;return c===Tx&&i.documentElement.namespaceURI===Tx?i.createElement(o):i.createElementNS(c,o)}}function rq(o){return function(){return this.ownerDocument.createElementNS(o.space,o.local)}}function Ix(o){var i=nl(o);return(i.local?rq:nq)(i)}function iq(){}function Th(o){return o==null?iq:function(){return this.querySelector(o)}}function TL(o){typeof o!="function"&&(o=Th(o));for(var i=this._groups,c=i.length,h=new Array(c),m=0;m<c;++m)for(var r=i[m],E=r.length,C=h[m]=new Array(E),O,z,Z=0;Z<E;++Z)(O=r[Z])&&(z=o.call(O,O.__data__,Z,r))&&("__data__"in O&&(z.__data__=O.__data__),C[Z]=z);return new ui(h,this._parents)}function oD(o){return o==null?[]:Array.isArray(o)?o:Array.from(o)}function oq(){return[]}function Gg(o){return o==null?oq:function(){return this.querySelectorAll(o)}}function sq(o){return function(){return oD(o.apply(this,arguments))}}function IL(o){typeof o=="function"?o=sq(o):o=Gg(o);for(var i=this._groups,c=i.length,h=[],m=[],r=0;r<c;++r)for(var E=i[r],C=E.length,O,z=0;z<C;++z)(O=E[z])&&(h.push(o.call(O,O.__data__,z,E)),m.push(O));return new ui(h,m)}function qg(o){return function(){return this.matches(o)}}function Dx(o){return function(i){return i.matches(o)}}var aq=Array.prototype.find;function lq(o){return function(){return aq.call(this.children,o)}}function cq(){return this.firstElementChild}function DL(o){return this.select(o==null?cq:lq(typeof o=="function"?o:Dx(o)))}var uq=Array.prototype.filter;function hq(){return Array.from(this.children)}function dq(o){return function(){return uq.call(this.children,o)}}function SL(o){return this.selectAll(o==null?hq:dq(typeof o=="function"?o:Dx(o)))}function CL(o){typeof o!="function"&&(o=qg(o));for(var i=this._groups,c=i.length,h=new Array(c),m=0;m<c;++m)for(var r=i[m],E=r.length,C=h[m]=[],O,z=0;z<E;++z)(O=r[z])&&o.call(O,O.__data__,z,r)&&C.push(O);return new ui(h,this._parents)}function Sx(o){return new Array(o.length)}function ML(){return new ui(this._enter||this._groups.map(Sx),this._parents)}function Hg(o,i){this.ownerDocument=o.ownerDocument,this.namespaceURI=o.namespaceURI,this._next=null,this._parent=o,this.__data__=i}Hg.prototype={constructor:Hg,appendChild:function(o){return this._parent.insertBefore(o,this._next)},insertBefore:function(o,i){return this._parent.insertBefore(o,i)},querySelector:function(o){return this._parent.querySelector(o)},querySelectorAll:function(o){return this._parent.querySelectorAll(o)}};function AL(o){return function(){return o}}function fq(o,i,c,h,m,r){for(var E=0,C,O=i.length,z=r.length;E<z;++E)(C=i[E])?(C.__data__=r[E],h[E]=C):c[E]=new Hg(o,r[E]);for(;E<O;++E)(C=i[E])&&(m[E]=C)}function pq(o,i,c,h,m,r,E){var C,O,z=new Map,Z=i.length,ce=r.length,Ie=new Array(Z),be;for(C=0;C<Z;++C)(O=i[C])&&(Ie[C]=be=E.call(O,O.__data__,C,i)+"",z.has(be)?m[C]=O:z.set(be,O));for(C=0;C<ce;++C)be=E.call(o,r[C],C,r)+"",(O=z.get(be))?(h[C]=O,O.__data__=r[C],z.delete(be)):c[C]=new Hg(o,r[C]);for(C=0;C<Z;++C)(O=i[C])&&z.get(Ie[C])===O&&(m[C]=O)}function mq(o){return o.__data__}function PL(o,i){if(!arguments.length)return Array.from(this,mq);var c=i?pq:fq,h=this._parents,m=this._groups;typeof o!="function"&&(o=AL(o));for(var r=m.length,E=new Array(r),C=new Array(r),O=new Array(r),z=0;z<r;++z){var Z=h[z],ce=m[z],Ie=ce.length,be=gq(o.call(Z,Z&&Z.__data__,z,h)),qe=be.length,ot=C[z]=new Array(qe),dt=E[z]=new Array(qe),ct=O[z]=new Array(Ie);c(Z,ce,ot,dt,ct,be,i);for(var bt=0,St=0,$t,dr;bt<qe;++bt)if($t=ot[bt]){for(bt>=St&&(St=bt+1);!(dr=dt[St])&&++St<qe;);$t._next=dr||null}}return E=new ui(E,h),E._enter=C,E._exit=O,E}function gq(o){return typeof o=="object"&&"length"in o?o:Array.from(o)}function RL(){return new ui(this._exit||this._groups.map(Sx),this._parents)}function OL(o,i,c){var h=this.enter(),m=this,r=this.exit();return typeof o=="function"?(h=o(h),h&&(h=h.selection())):h=h.append(o+""),i!=null&&(m=i(m),m&&(m=m.selection())),c==null?r.remove():c(r),h&&m?h.merge(m).order():m}function LL(o){for(var i=o.selection?o.selection():o,c=this._groups,h=i._groups,m=c.length,r=h.length,E=Math.min(m,r),C=new Array(m),O=0;O<E;++O)for(var z=c[O],Z=h[O],ce=z.length,Ie=C[O]=new Array(ce),be,qe=0;qe<ce;++qe)(be=z[qe]||Z[qe])&&(Ie[qe]=be);for(;O<m;++O)C[O]=c[O];return new ui(C,this._parents)}function kL(){for(var o=this._groups,i=-1,c=o.length;++i<c;)for(var h=o[i],m=h.length-1,r=h[m],E;--m>=0;)(E=h[m])&&(r&&E.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(E,r),r=E);return this}function FL(o){o||(o=_q);function i(ce,Ie){return ce&&Ie?o(ce.__data__,Ie.__data__):!ce-!Ie}for(var c=this._groups,h=c.length,m=new Array(h),r=0;r<h;++r){for(var E=c[r],C=E.length,O=m[r]=new Array(C),z,Z=0;Z<C;++Z)(z=E[Z])&&(O[Z]=z);O.sort(i)}return new ui(m,this._parents).order()}function _q(o,i){return o<i?-1:o>i?1:o>=i?0:NaN}function NL(){var o=arguments[0];return arguments[0]=this,o.apply(null,arguments),this}function zL(){return Array.from(this)}function BL(){for(var o=this._groups,i=0,c=o.length;i<c;++i)for(var h=o[i],m=0,r=h.length;m<r;++m){var E=h[m];if(E)return E}return null}function UL(){let o=0;for(let i of this)++o;return o}function VL(){return!this.node()}function jL(o){for(var i=this._groups,c=0,h=i.length;c<h;++c)for(var m=i[c],r=0,E=m.length,C;r<E;++r)(C=m[r])&&o.call(C,C.__data__,r,m);return this}function yq(o){return function(){this.removeAttribute(o)}}function vq(o){return function(){this.removeAttributeNS(o.space,o.local)}}function xq(o,i){return function(){this.setAttribute(o,i)}}function bq(o,i){return function(){this.setAttributeNS(o.space,o.local,i)}}function wq(o,i){return function(){var c=i.apply(this,arguments);c==null?this.removeAttribute(o):this.setAttribute(o,c)}}function Eq(o,i){return function(){var c=i.apply(this,arguments);c==null?this.removeAttributeNS(o.space,o.local):this.setAttributeNS(o.space,o.local,c)}}function $L(o,i){var c=nl(o);if(arguments.length<2){var h=this.node();return c.local?h.getAttributeNS(c.space,c.local):h.getAttribute(c)}return this.each((i==null?c.local?vq:yq:typeof i=="function"?c.local?Eq:wq:c.local?bq:xq)(c,i))}function Cx(o){return o.ownerDocument&&o.ownerDocument.defaultView||o.document&&o||o.defaultView}function Tq(o){return function(){this.style.removeProperty(o)}}function Iq(o,i,c){return function(){this.style.setProperty(o,i,c)}}function Dq(o,i,c){return function(){var h=i.apply(this,arguments);h==null?this.style.removeProperty(o):this.style.setProperty(o,h,c)}}function GL(o,i,c){return arguments.length>1?this.each((i==null?Tq:typeof i=="function"?Dq:Iq)(o,i,c??"")):Fc(this.node(),o)}function Fc(o,i){return o.style.getPropertyValue(i)||Cx(o).getComputedStyle(o,null).getPropertyValue(i)}function Sq(o){return function(){delete this[o]}}function Cq(o,i){return function(){this[o]=i}}function Mq(o,i){return function(){var c=i.apply(this,arguments);c==null?delete this[o]:this[o]=c}}function qL(o,i){return arguments.length>1?this.each((i==null?Sq:typeof i=="function"?Mq:Cq)(o,i)):this.node()[o]}function HL(o){return o.trim().split(/^|\s+/)}function sD(o){return o.classList||new WL(o)}function WL(o){this._node=o,this._names=HL(o.getAttribute("class")||"")}WL.prototype={add:function(o){var i=this._names.indexOf(o);i<0&&(this._names.push(o),this._node.setAttribute("class",this._names.join(" ")))},remove:function(o){var i=this._names.indexOf(o);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(o){return this._names.indexOf(o)>=0}};function ZL(o,i){for(var c=sD(o),h=-1,m=i.length;++h<m;)c.add(i[h])}function YL(o,i){for(var c=sD(o),h=-1,m=i.length;++h<m;)c.remove(i[h])}function Aq(o){return function(){ZL(this,o)}}function Pq(o){return function(){YL(this,o)}}function Rq(o,i){return function(){(i.apply(this,arguments)?ZL:YL)(this,o)}}function XL(o,i){var c=HL(o+"");if(arguments.length<2){for(var h=sD(this.node()),m=-1,r=c.length;++m<r;)if(!h.contains(c[m]))return!1;return!0}return this.each((typeof i=="function"?Rq:i?Aq:Pq)(c,i))}function Oq(){this.textContent=""}function Lq(o){return function(){this.textContent=o}}function kq(o){return function(){var i=o.apply(this,arguments);this.textContent=i??""}}function KL(o){return arguments.length?this.each(o==null?Oq:(typeof o=="function"?kq:Lq)(o)):this.node().textContent}function Fq(){this.innerHTML=""}function Nq(o){return function(){this.innerHTML=o}}function zq(o){return function(){var i=o.apply(this,arguments);this.innerHTML=i??""}}function QL(o){return arguments.length?this.each(o==null?Fq:(typeof o=="function"?zq:Nq)(o)):this.node().innerHTML}function Bq(){this.nextSibling&&this.parentNode.appendChild(this)}function JL(){return this.each(Bq)}function Uq(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ek(){return this.each(Uq)}function tk(o){var i=typeof o=="function"?o:Ix(o);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function Vq(){return null}function nk(o,i){var c=typeof o=="function"?o:Ix(o),h=i==null?Vq:typeof i=="function"?i:Th(i);return this.select(function(){return this.insertBefore(c.apply(this,arguments),h.apply(this,arguments)||null)})}function jq(){var o=this.parentNode;o&&o.removeChild(this)}function rk(){return this.each(jq)}function $q(){var o=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(o,this.nextSibling):o}function Gq(){var o=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(o,this.nextSibling):o}function ik(o){return this.select(o?Gq:$q)}function ok(o){return arguments.length?this.property("__data__",o):this.node().__data__}function qq(o){return function(i){o.call(this,i,this.__data__)}}function Hq(o){return o.trim().split(/^|\s+/).map(function(i){var c="",h=i.indexOf(".");return h>=0&&(c=i.slice(h+1),i=i.slice(0,h)),{type:i,name:c}})}function Wq(o){return function(){var i=this.__on;if(i){for(var c=0,h=-1,m=i.length,r;c<m;++c)r=i[c],(!o.type||r.type===o.type)&&r.name===o.name?this.removeEventListener(r.type,r.listener,r.options):i[++h]=r;++h?i.length=h:delete this.__on}}}function Zq(o,i,c){return function(){var h=this.__on,m,r=qq(i);if(h){for(var E=0,C=h.length;E<C;++E)if((m=h[E]).type===o.type&&m.name===o.name){this.removeEventListener(m.type,m.listener,m.options),this.addEventListener(m.type,m.listener=r,m.options=c),m.value=i;return}}this.addEventListener(o.type,r,c),m={type:o.type,name:o.name,value:i,listener:r,options:c},h?h.push(m):this.__on=[m]}}function sk(o,i,c){var h=Hq(o+""),m,r=h.length,E;if(arguments.length<2){var C=this.node().__on;if(C){for(var O=0,z=C.length,Z;O<z;++O)for(m=0,Z=C[O];m<r;++m)if((E=h[m]).type===Z.type&&E.name===Z.name)return Z.value}return}for(C=i?Zq:Wq,m=0;m<r;++m)this.each(C(h[m],i,c));return this}function ak(o,i,c){var h=Cx(o),m=h.CustomEvent;typeof m=="function"?m=new m(i,c):(m=h.document.createEvent("Event"),c?(m.initEvent(i,c.bubbles,c.cancelable),m.detail=c.detail):m.initEvent(i,!1,!1)),o.dispatchEvent(m)}function Yq(o,i){return function(){return ak(this,o,i)}}function Xq(o,i){return function(){return ak(this,o,i.apply(this,arguments))}}function lk(o,i){return this.each((typeof i=="function"?Xq:Yq)(o,i))}function*ck(){for(var o=this._groups,i=0,c=o.length;i<c;++i)for(var h=o[i],m=0,r=h.length,E;m<r;++m)(E=h[m])&&(yield E)}var Kq=[null];function ui(o,i){this._groups=o,this._parents=i}function uk(){return new ui([[document.documentElement]],Kq)}function Qq(){return this}ui.prototype=uk.prototype={constructor:ui,select:TL,selectAll:IL,selectChild:DL,selectChildren:SL,filter:CL,data:PL,enter:ML,exit:RL,join:OL,merge:LL,selection:Qq,order:kL,sort:FL,call:NL,nodes:zL,node:BL,size:UL,empty:VL,each:jL,attr:$L,style:GL,property:qL,classed:XL,text:KL,html:QL,raise:JL,lower:ek,append:tk,insert:nk,remove:rk,clone:ik,datum:ok,on:sk,dispatch:lk,[Symbol.iterator]:ck};var rl=uk;function Mx(o,i,c){o.prototype=i.prototype=c,c.constructor=o}function aD(o,i){var c=Object.create(o.prototype);for(var h in i)c[h]=i[h];return c}function Yg(){}var Wg=.7,Rx=1/Wg,zf="\\s*([+-]?\\d+)\\s*",Zg="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",da="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Jq=/^#([0-9a-f]{3,8})$/,eH=new RegExp(`^rgb\\(${zf},${zf},${zf}\\)$`),tH=new RegExp(`^rgb\\(${da},${da},${da}\\)$`),nH=new RegExp(`^rgba\\(${zf},${zf},${zf},${Zg}\\)$`),rH=new RegExp(`^rgba\\(${da},${da},${da},${Zg}\\)$`),iH=new RegExp(`^hsl\\(${Zg},${da},${da}\\)$`),oH=new RegExp(`^hsla\\(${Zg},${da},${da},${Zg}\\)$`),hk={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Mx(Yg,Nc,{copy(o){return Object.assign(new this.constructor,this,o)},displayable(){return this.rgb().displayable()},hex:dk,formatHex:dk,formatHex8:sH,formatHsl:aH,formatRgb:fk,toString:fk});function dk(){return this.rgb().formatHex()}function sH(){return this.rgb().formatHex8()}function aH(){return vk(this).formatHsl()}function fk(){return this.rgb().formatRgb()}function Nc(o){var i,c;return o=(o+"").trim().toLowerCase(),(i=Jq.exec(o))?(c=i[1].length,i=parseInt(i[1],16),c===6?pk(i):c===3?new ao(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):c===8?Ax(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):c===4?Ax(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=eH.exec(o))?new ao(i[1],i[2],i[3],1):(i=tH.exec(o))?new ao(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=nH.exec(o))?Ax(i[1],i[2],i[3],i[4]):(i=rH.exec(o))?Ax(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=iH.exec(o))?_k(i[1],i[2]/100,i[3]/100,1):(i=oH.exec(o))?_k(i[1],i[2]/100,i[3]/100,i[4]):hk.hasOwnProperty(o)?pk(hk[o]):o==="transparent"?new ao(NaN,NaN,NaN,0):null}function pk(o){return new ao(o>>16&255,o>>8&255,o&255,1)}function Ax(o,i,c,h){return h<=0&&(o=i=c=NaN),new ao(o,i,c,h)}function lH(o){return o instanceof Yg||(o=Nc(o)),o?(o=o.rgb(),new ao(o.r,o.g,o.b,o.opacity)):new ao}function Bf(o,i,c,h){return arguments.length===1?lH(o):new ao(o,i,c,h??1)}function ao(o,i,c,h){this.r=+o,this.g=+i,this.b=+c,this.opacity=+h}Mx(ao,Bf,aD(Yg,{brighter(o){return o=o==null?Rx:Math.pow(Rx,o),new ao(this.r*o,this.g*o,this.b*o,this.opacity)},darker(o){return o=o==null?Wg:Math.pow(Wg,o),new ao(this.r*o,this.g*o,this.b*o,this.opacity)},rgb(){return this},clamp(){return new ao(Dh(this.r),Dh(this.g),Dh(this.b),Ox(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mk,formatHex:mk,formatHex8:cH,formatRgb:gk,toString:gk}));function mk(){return`#${Ih(this.r)}${Ih(this.g)}${Ih(this.b)}`}function cH(){return`#${Ih(this.r)}${Ih(this.g)}${Ih(this.b)}${Ih((isNaN(this.opacity)?1:this.opacity)*255)}`}function gk(){let o=Ox(this.opacity);return`${o===1?"rgb(":"rgba("}${Dh(this.r)}, ${Dh(this.g)}, ${Dh(this.b)}${o===1?")":`, ${o})`}`}function Ox(o){return isNaN(o)?1:Math.max(0,Math.min(1,o))}function Dh(o){return Math.max(0,Math.min(255,Math.round(o)||0))}function Ih(o){return o=Dh(o),(o<16?"0":"")+o.toString(16)}function _k(o,i,c,h){return h<=0?o=i=c=NaN:c<=0||c>=1?o=i=NaN:i<=0&&(o=NaN),new Ts(o,i,c,h)}function vk(o){if(o instanceof Ts)return new Ts(o.h,o.s,o.l,o.opacity);if(o instanceof Yg||(o=Nc(o)),!o)return new Ts;if(o instanceof Ts)return o;o=o.rgb();var i=o.r/255,c=o.g/255,h=o.b/255,m=Math.min(i,c,h),r=Math.max(i,c,h),E=NaN,C=r-m,O=(r+m)/2;return C?(i===r?E=(c-h)/C+(c<h)*6:c===r?E=(h-i)/C+2:E=(i-c)/C+4,C/=O<.5?r+m:2-r-m,E*=60):C=O>0&&O<1?0:E,new Ts(E,C,O,o.opacity)}function xk(o,i,c,h){return arguments.length===1?vk(o):new Ts(o,i,c,h??1)}function Ts(o,i,c,h){this.h=+o,this.s=+i,this.l=+c,this.opacity=+h}Mx(Ts,xk,aD(Yg,{brighter(o){return o=o==null?Rx:Math.pow(Rx,o),new Ts(this.h,this.s,this.l*o,this.opacity)},darker(o){return o=o==null?Wg:Math.pow(Wg,o),new Ts(this.h,this.s,this.l*o,this.opacity)},rgb(){var o=this.h%360+(this.h<0)*360,i=isNaN(o)||isNaN(this.s)?0:this.s,c=this.l,h=c+(c<.5?c:1-c)*i,m=2*c-h;return new ao(lD(o>=240?o-240:o+120,m,h),lD(o,m,h),lD(o<120?o+240:o-120,m,h),this.opacity)},clamp(){return new Ts(yk(this.h),Px(this.s),Px(this.l),Ox(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let o=Ox(this.opacity);return`${o===1?"hsl(":"hsla("}${yk(this.h)}, ${Px(this.s)*100}%, ${Px(this.l)*100}%${o===1?")":`, ${o})`}`}}));function yk(o){return o=(o||0)%360,o<0?o+360:o}function Px(o){return Math.max(0,Math.min(1,o||0))}function lD(o,i,c){return(o<60?i+(c-i)*o/60:o<180?c:o<240?i+(c-i)*(240-o)/60:i)*255}function cD(o,i,c,h,m){var r=o*o,E=r*o;return((1-3*o+3*r-E)*i+(4-6*r+3*E)*c+(1+3*o+3*r-3*E)*h+E*m)/6}function bk(o){var i=o.length-1;return function(c){var h=c<=0?c=0:c>=1?(c=1,i-1):Math.floor(c*i),m=o[h],r=o[h+1],E=h>0?o[h-1]:2*m-r,C=h<i-1?o[h+2]:2*r-m;return cD((c-h/i)*i,E,m,r,C)}}function wk(o){var i=o.length;return function(c){var h=Math.floor(((c%=1)<0?++c:c)*i),m=o[(h+i-1)%i],r=o[h%i],E=o[(h+1)%i],C=o[(h+2)%i];return cD((c-h/i)*i,m,r,E,C)}}var uD=o=>()=>o;function uH(o,i){return function(c){return o+c*i}}function hH(o,i,c){return o=Math.pow(o,c),i=Math.pow(i,c)-o,c=1/c,function(h){return Math.pow(o+h*i,c)}}function Ek(o){return(o=+o)==1?Lx:function(i,c){return c-i?hH(i,c,o):uD(isNaN(i)?c:i)}}function Lx(o,i){var c=i-o;return c?uH(o,c):uD(isNaN(o)?i:o)}var kx=function o(i){var c=Ek(i);function h(m,r){var E=c((m=Bf(m)).r,(r=Bf(r)).r),C=c(m.g,r.g),O=c(m.b,r.b),z=Lx(m.opacity,r.opacity);return function(Z){return m.r=E(Z),m.g=C(Z),m.b=O(Z),m.opacity=z(Z),m+""}}return h.gamma=o,h}(1);function Tk(o){return function(i){var c=i.length,h=new Array(c),m=new Array(c),r=new Array(c),E,C;for(E=0;E<c;++E)C=Bf(i[E]),h[E]=C.r||0,m[E]=C.g||0,r[E]=C.b||0;return h=o(h),m=o(m),r=o(r),C.opacity=1,function(O){return C.r=h(O),C.g=m(O),C.b=r(O),C+""}}}var dH=Tk(bk),fH=Tk(wk);function Zo(o,i){return o=+o,i=+i,function(c){return o*(1-c)+i*c}}var dD=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,hD=new RegExp(dD.source,"g");function pH(o){return function(){return o}}function mH(o){return function(i){return o(i)+""}}function fD(o,i){var c=dD.lastIndex=hD.lastIndex=0,h,m,r,E=-1,C=[],O=[];for(o=o+"",i=i+"";(h=dD.exec(o))&&(m=hD.exec(i));)(r=m.index)>c&&(r=i.slice(c,r),C[E]?C[E]+=r:C[++E]=r),(h=h[0])===(m=m[0])?C[E]?C[E]+=m:C[++E]=m:(C[++E]=null,O.push({i:E,x:Zo(h,m)})),c=hD.lastIndex;return c<i.length&&(r=i.slice(c),C[E]?C[E]+=r:C[++E]=r),C.length<2?O[0]?mH(O[0].x):pH(i):(i=O.length,function(z){for(var Z=0,ce;Z<i;++Z)C[(ce=O[Z]).i]=ce.x(z);return C.join("")})}var Ik=180/Math.PI,Fx={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function pD(o,i,c,h,m,r){var E,C,O;return(E=Math.sqrt(o*o+i*i))&&(o/=E,i/=E),(O=o*c+i*h)&&(c-=o*O,h-=i*O),(C=Math.sqrt(c*c+h*h))&&(c/=C,h/=C,O/=C),o*h<i*c&&(o=-o,i=-i,O=-O,E=-E),{translateX:m,translateY:r,rotate:Math.atan2(i,o)*Ik,skewX:Math.atan(O)*Ik,scaleX:E,scaleY:C}}var Nx;function Dk(o){let i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(o+"");return i.isIdentity?Fx:pD(i.a,i.b,i.c,i.d,i.e,i.f)}function Sk(o){return o==null?Fx:(Nx||(Nx=document.createElementNS("http://www.w3.org/2000/svg","g")),Nx.setAttribute("transform",o),(o=Nx.transform.baseVal.consolidate())?(o=o.matrix,pD(o.a,o.b,o.c,o.d,o.e,o.f)):Fx)}function Ck(o,i,c,h){function m(z){return z.length?z.pop()+" ":""}function r(z,Z,ce,Ie,be,qe){if(z!==ce||Z!==Ie){var ot=be.push("translate(",null,i,null,c);qe.push({i:ot-4,x:Zo(z,ce)},{i:ot-2,x:Zo(Z,Ie)})}else(ce||Ie)&&be.push("translate("+ce+i+Ie+c)}function E(z,Z,ce,Ie){z!==Z?(z-Z>180?Z+=360:Z-z>180&&(z+=360),Ie.push({i:ce.push(m(ce)+"rotate(",null,h)-2,x:Zo(z,Z)})):Z&&ce.push(m(ce)+"rotate("+Z+h)}function C(z,Z,ce,Ie){z!==Z?Ie.push({i:ce.push(m(ce)+"skewX(",null,h)-2,x:Zo(z,Z)}):Z&&ce.push(m(ce)+"skewX("+Z+h)}function O(z,Z,ce,Ie,be,qe){if(z!==ce||Z!==Ie){var ot=be.push(m(be)+"scale(",null,",",null,")");qe.push({i:ot-4,x:Zo(z,ce)},{i:ot-2,x:Zo(Z,Ie)})}else(ce!==1||Ie!==1)&&be.push(m(be)+"scale("+ce+","+Ie+")")}return function(z,Z){var ce=[],Ie=[];return z=o(z),Z=o(Z),r(z.translateX,z.translateY,Z.translateX,Z.translateY,ce,Ie),E(z.rotate,Z.rotate,ce,Ie),C(z.skewX,Z.skewX,ce,Ie),O(z.scaleX,z.scaleY,Z.scaleX,Z.scaleY,ce,Ie),z=Z=null,function(be){for(var qe=-1,ot=Ie.length,dt;++qe<ot;)ce[(dt=Ie[qe]).i]=dt.x(be);return ce.join("")}}}var mD=Ck(Dk,"px, ","px)","deg)"),gD=Ck(Sk,", ",")",")");var Uf=0,Kg=0,Xg=0,Ak=1e3,zx,Qg,Bx=0,Sh=0,Ux=0,Jg=typeof performance=="object"&&performance.now?performance:Date,Pk=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(o){setTimeout(o,17)};function t_(){return Sh||(Pk(gH),Sh=Jg.now()+Ux)}function gH(){Sh=0}function e_(){this._call=this._time=this._next=null}e_.prototype=Vx.prototype={constructor:e_,restart:function(o,i,c){if(typeof o!="function")throw new TypeError("callback is not a function");c=(c==null?t_():+c)+(i==null?0:+i),!this._next&&Qg!==this&&(Qg?Qg._next=this:zx=this,Qg=this),this._call=o,this._time=c,_D()},stop:function(){this._call&&(this._call=null,this._time=1/0,_D())}};function Vx(o,i,c){var h=new e_;return h.restart(o,i,c),h}function Rk(){t_(),++Uf;for(var o=zx,i;o;)(i=Sh-o._time)>=0&&o._call.call(void 0,i),o=o._next;--Uf}function Mk(){Sh=(Bx=Jg.now())+Ux,Uf=Kg=0;try{Rk()}finally{Uf=0,yH(),Sh=0}}function _H(){var o=Jg.now(),i=o-Bx;i>Ak&&(Ux-=i,Bx=o)}function yH(){for(var o,i=zx,c,h=1/0;i;)i._call?(h>i._time&&(h=i._time),o=i,i=i._next):(c=i._next,i._next=null,i=o?o._next=c:zx=c);Qg=o,_D(h)}function _D(o){if(!Uf){Kg&&(Kg=clearTimeout(Kg));var i=o-Sh;i>24?(o<1/0&&(Kg=setTimeout(Mk,o-Jg.now()-Ux)),Xg&&(Xg=clearInterval(Xg))):(Xg||(Bx=Jg.now(),Xg=setInterval(_H,Ak)),Uf=1,Pk(Mk))}}function jx(o,i,c){var h=new e_;return i=i==null?0:+i,h.restart(m=>{h.stop(),o(m+i)},i,c),h}var vH=rD("start","end","cancel","interrupt"),xH=[],kk=0,Ok=1,Gx=2,$x=3,Lk=4,qx=5,n_=6;function zc(o,i,c,h,m,r){var E=o.__transition;if(!E)o.__transition={};else if(c in E)return;bH(o,c,{name:i,index:h,group:m,on:vH,tween:xH,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:kk})}function r_(o,i){var c=hi(o,i);if(c.state>kk)throw new Error("too late; already scheduled");return c}function Ci(o,i){var c=hi(o,i);if(c.state>$x)throw new Error("too late; already running");return c}function hi(o,i){var c=o.__transition;if(!c||!(c=c[i]))throw new Error("transition not found");return c}function bH(o,i,c){var h=o.__transition,m;h[i]=c,c.timer=Vx(r,0,c.time);function r(z){c.state=Ok,c.timer.restart(E,c.delay,c.time),c.delay<=z&&E(z-c.delay)}function E(z){var Z,ce,Ie,be;if(c.state!==Ok)return O();for(Z in h)if(be=h[Z],be.name===c.name){if(be.state===$x)return jx(E);be.state===Lk?(be.state=n_,be.timer.stop(),be.on.call("interrupt",o,o.__data__,be.index,be.group),delete h[Z]):+Z<i&&(be.state=n_,be.timer.stop(),be.on.call("cancel",o,o.__data__,be.index,be.group),delete h[Z])}if(jx(function(){c.state===$x&&(c.state=Lk,c.timer.restart(C,c.delay,c.time),C(z))}),c.state=Gx,c.on.call("start",o,o.__data__,c.index,c.group),c.state===Gx){for(c.state=$x,m=new Array(Ie=c.tween.length),Z=0,ce=-1;Z<Ie;++Z)(be=c.tween[Z].value.call(o,o.__data__,c.index,c.group))&&(m[++ce]=be);m.length=ce+1}}function C(z){for(var Z=z<c.duration?c.ease.call(null,z/c.duration):(c.timer.restart(O),c.state=qx,1),ce=-1,Ie=m.length;++ce<Ie;)m[ce].call(o,Z);c.state===qx&&(c.on.call("end",o,o.__data__,c.index,c.group),O())}function O(){c.state=n_,c.timer.stop(),delete h[i];for(var z in h)return;delete o.__transition}}function Hx(o,i){var c=o.__transition,h,m,r=!0,E;if(c){i=i==null?null:i+"";for(E in c){if((h=c[E]).name!==i){r=!1;continue}m=h.state>Gx&&h.state<qx,h.state=n_,h.timer.stop(),h.on.call(m?"interrupt":"cancel",o,o.__data__,h.index,h.group),delete c[E]}r&&delete o.__transition}}function Fk(o){return this.each(function(){Hx(this,o)})}function wH(o,i){var c,h;return function(){var m=Ci(this,o),r=m.tween;if(r!==c){h=c=r;for(var E=0,C=h.length;E<C;++E)if(h[E].name===i){h=h.slice(),h.splice(E,1);break}}m.tween=h}}function EH(o,i,c){var h,m;if(typeof c!="function")throw new Error;return function(){var r=Ci(this,o),E=r.tween;if(E!==h){m=(h=E).slice();for(var C={name:i,value:c},O=0,z=m.length;O<z;++O)if(m[O].name===i){m[O]=C;break}O===z&&m.push(C)}r.tween=m}}function Nk(o,i){var c=this._id;if(o+="",arguments.length<2){for(var h=hi(this.node(),c).tween,m=0,r=h.length,E;m<r;++m)if((E=h[m]).name===o)return E.value;return null}return this.each((i==null?wH:EH)(c,o,i))}function Vf(o,i,c){var h=o._id;return o.each(function(){var m=Ci(this,h);(m.value||(m.value={}))[i]=c.apply(this,arguments)}),function(m){return hi(m,h).value[i]}}function Wx(o,i){var c;return(typeof i=="number"?Zo:i instanceof Nc?kx:(c=Nc(i))?(i=c,kx):fD)(o,i)}function TH(o){return function(){this.removeAttribute(o)}}function IH(o){return function(){this.removeAttributeNS(o.space,o.local)}}function DH(o,i,c){var h,m=c+"",r;return function(){var E=this.getAttribute(o);return E===m?null:E===h?r:r=i(h=E,c)}}function SH(o,i,c){var h,m=c+"",r;return function(){var E=this.getAttributeNS(o.space,o.local);return E===m?null:E===h?r:r=i(h=E,c)}}function CH(o,i,c){var h,m,r;return function(){var E,C=c(this),O;return C==null?void this.removeAttribute(o):(E=this.getAttribute(o),O=C+"",E===O?null:E===h&&O===m?r:(m=O,r=i(h=E,C)))}}function MH(o,i,c){var h,m,r;return function(){var E,C=c(this),O;return C==null?void this.removeAttributeNS(o.space,o.local):(E=this.getAttributeNS(o.space,o.local),O=C+"",E===O?null:E===h&&O===m?r:(m=O,r=i(h=E,C)))}}function zk(o,i){var c=nl(o),h=c==="transform"?gD:Wx;return this.attrTween(o,typeof i=="function"?(c.local?MH:CH)(c,h,Vf(this,"attr."+o,i)):i==null?(c.local?IH:TH)(c):(c.local?SH:DH)(c,h,i))}function AH(o,i){return function(c){this.setAttribute(o,i.call(this,c))}}function PH(o,i){return function(c){this.setAttributeNS(o.space,o.local,i.call(this,c))}}function RH(o,i){var c,h;function m(){var r=i.apply(this,arguments);return r!==h&&(c=(h=r)&&PH(o,r)),c}return m._value=i,m}function OH(o,i){var c,h;function m(){var r=i.apply(this,arguments);return r!==h&&(c=(h=r)&&AH(o,r)),c}return m._value=i,m}function Bk(o,i){var c="attr."+o;if(arguments.length<2)return(c=this.tween(c))&&c._value;if(i==null)return this.tween(c,null);if(typeof i!="function")throw new Error;var h=nl(o);return this.tween(c,(h.local?RH:OH)(h,i))}function LH(o,i){return function(){r_(this,o).delay=+i.apply(this,arguments)}}function kH(o,i){return i=+i,function(){r_(this,o).delay=i}}function Uk(o){var i=this._id;return arguments.length?this.each((typeof o=="function"?LH:kH)(i,o)):hi(this.node(),i).delay}function FH(o,i){return function(){Ci(this,o).duration=+i.apply(this,arguments)}}function NH(o,i){return i=+i,function(){Ci(this,o).duration=i}}function Vk(o){var i=this._id;return arguments.length?this.each((typeof o=="function"?FH:NH)(i,o)):hi(this.node(),i).duration}function zH(o,i){if(typeof i!="function")throw new Error;return function(){Ci(this,o).ease=i}}function jk(o){var i=this._id;return arguments.length?this.each(zH(i,o)):hi(this.node(),i).ease}function BH(o,i){return function(){var c=i.apply(this,arguments);if(typeof c!="function")throw new Error;Ci(this,o).ease=c}}function $k(o){if(typeof o!="function")throw new Error;return this.each(BH(this._id,o))}function Gk(o){typeof o!="function"&&(o=qg(o));for(var i=this._groups,c=i.length,h=new Array(c),m=0;m<c;++m)for(var r=i[m],E=r.length,C=h[m]=[],O,z=0;z<E;++z)(O=r[z])&&o.call(O,O.__data__,z,r)&&C.push(O);return new Hi(h,this._parents,this._name,this._id)}function qk(o){if(o._id!==this._id)throw new Error;for(var i=this._groups,c=o._groups,h=i.length,m=c.length,r=Math.min(h,m),E=new Array(h),C=0;C<r;++C)for(var O=i[C],z=c[C],Z=O.length,ce=E[C]=new Array(Z),Ie,be=0;be<Z;++be)(Ie=O[be]||z[be])&&(ce[be]=Ie);for(;C<h;++C)E[C]=i[C];return new Hi(E,this._parents,this._name,this._id)}function UH(o){return(o+"").trim().split(/^|\s+/).every(function(i){var c=i.indexOf(".");return c>=0&&(i=i.slice(0,c)),!i||i==="start"})}function VH(o,i,c){var h,m,r=UH(i)?r_:Ci;return function(){var E=r(this,o),C=E.on;C!==h&&(m=(h=C).copy()).on(i,c),E.on=m}}function Hk(o,i){var c=this._id;return arguments.length<2?hi(this.node(),c).on.on(o):this.each(VH(c,o,i))}function jH(o){return function(){var i=this.parentNode;for(var c in this.__transition)if(+c!==o)return;i&&i.removeChild(this)}}function Wk(){return this.on("end.remove",jH(this._id))}function Zk(o){var i=this._name,c=this._id;typeof o!="function"&&(o=Th(o));for(var h=this._groups,m=h.length,r=new Array(m),E=0;E<m;++E)for(var C=h[E],O=C.length,z=r[E]=new Array(O),Z,ce,Ie=0;Ie<O;++Ie)(Z=C[Ie])&&(ce=o.call(Z,Z.__data__,Ie,C))&&("__data__"in Z&&(ce.__data__=Z.__data__),z[Ie]=ce,zc(z[Ie],i,c,Ie,z,hi(Z,c)));return new Hi(r,this._parents,i,c)}function Yk(o){var i=this._name,c=this._id;typeof o!="function"&&(o=Gg(o));for(var h=this._groups,m=h.length,r=[],E=[],C=0;C<m;++C)for(var O=h[C],z=O.length,Z,ce=0;ce<z;++ce)if(Z=O[ce]){for(var Ie=o.call(Z,Z.__data__,ce,O),be,qe=hi(Z,c),ot=0,dt=Ie.length;ot<dt;++ot)(be=Ie[ot])&&zc(be,i,c,ot,Ie,qe);r.push(Ie),E.push(Z)}return new Hi(r,E,i,c)}var $H=rl.prototype.constructor;function Xk(){return new $H(this._groups,this._parents)}function GH(o,i){var c,h,m;return function(){var r=Fc(this,o),E=(this.style.removeProperty(o),Fc(this,o));return r===E?null:r===c&&E===h?m:m=i(c=r,h=E)}}function Kk(o){return function(){this.style.removeProperty(o)}}function qH(o,i,c){var h,m=c+"",r;return function(){var E=Fc(this,o);return E===m?null:E===h?r:r=i(h=E,c)}}function HH(o,i,c){var h,m,r;return function(){var E=Fc(this,o),C=c(this),O=C+"";return C==null&&(O=C=(this.style.removeProperty(o),Fc(this,o))),E===O?null:E===h&&O===m?r:(m=O,r=i(h=E,C))}}function WH(o,i){var c,h,m,r="style."+i,E="end."+r,C;return function(){var O=Ci(this,o),z=O.on,Z=O.value[r]==null?C||(C=Kk(i)):void 0;(z!==c||m!==Z)&&(h=(c=z).copy()).on(E,m=Z),O.on=h}}function Qk(o,i,c){var h=(o+="")=="transform"?mD:Wx;return i==null?this.styleTween(o,GH(o,h)).on("end.style."+o,Kk(o)):typeof i=="function"?this.styleTween(o,HH(o,h,Vf(this,"style."+o,i))).each(WH(this._id,o)):this.styleTween(o,qH(o,h,i),c).on("end.style."+o,null)}function ZH(o,i,c){return function(h){this.style.setProperty(o,i.call(this,h),c)}}function YH(o,i,c){var h,m;function r(){var E=i.apply(this,arguments);return E!==m&&(h=(m=E)&&ZH(o,E,c)),h}return r._value=i,r}function Jk(o,i,c){var h="style."+(o+="");if(arguments.length<2)return(h=this.tween(h))&&h._value;if(i==null)return this.tween(h,null);if(typeof i!="function")throw new Error;return this.tween(h,YH(o,i,c??""))}function XH(o){return function(){this.textContent=o}}function KH(o){return function(){var i=o(this);this.textContent=i??""}}function eF(o){return this.tween("text",typeof o=="function"?KH(Vf(this,"text",o)):XH(o==null?"":o+""))}function QH(o){return function(i){this.textContent=o.call(this,i)}}function JH(o){var i,c;function h(){var m=o.apply(this,arguments);return m!==c&&(i=(c=m)&&QH(m)),i}return h._value=o,h}function tF(o){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(o==null)return this.tween(i,null);if(typeof o!="function")throw new Error;return this.tween(i,JH(o))}function nF(){for(var o=this._name,i=this._id,c=Zx(),h=this._groups,m=h.length,r=0;r<m;++r)for(var E=h[r],C=E.length,O,z=0;z<C;++z)if(O=E[z]){var Z=hi(O,i);zc(O,o,c,z,E,{time:Z.time+Z.delay+Z.duration,delay:0,duration:Z.duration,ease:Z.ease})}return new Hi(h,this._parents,o,c)}function rF(){var o,i,c=this,h=c._id,m=c.size();return new Promise(function(r,E){var C={value:E},O={value:function(){--m===0&&r()}};c.each(function(){var z=Ci(this,h),Z=z.on;Z!==o&&(i=(o=Z).copy(),i._.cancel.push(C),i._.interrupt.push(C),i._.end.push(O)),z.on=i}),m===0&&r()})}var e9=0;function Hi(o,i,c,h){this._groups=o,this._parents=i,this._name=c,this._id=h}function iF(o){return rl().transition(o)}function Zx(){return++e9}var il=rl.prototype;Hi.prototype=iF.prototype={constructor:Hi,select:Zk,selectAll:Yk,selectChild:il.selectChild,selectChildren:il.selectChildren,filter:Gk,merge:qk,selection:Xk,transition:nF,call:il.call,nodes:il.nodes,node:il.node,size:il.size,empty:il.empty,each:il.each,on:Hk,attr:zk,attrTween:Bk,style:Qk,styleTween:Jk,text:eF,textTween:tF,remove:Wk,tween:Nk,delay:Uk,duration:Vk,ease:jk,easeVarying:$k,end:rF,[Symbol.iterator]:il[Symbol.iterator]};function Yx(o){return((o*=2)<=1?o*o*o:(o-=2)*o*o+2)/2}var t9={time:null,delay:0,duration:250,ease:Yx};function n9(o,i){for(var c;!(c=o.__transition)||!(c=c[i]);)if(!(o=o.parentNode))throw new Error(`transition ${i} not found`);return c}function oF(o){var i,c;o instanceof Hi?(i=o._id,o=o._name):(i=Zx(),(c=t9).time=t_(),o=o==null?null:o+"");for(var h=this._groups,m=h.length,r=0;r<m;++r)for(var E=h[r],C=E.length,O,z=0;z<C;++z)(O=E[z])&&zc(O,o,i,z,E,c||n9(O,i));return new Hi(h,this._parents,o,i)}rl.prototype.interrupt=Fk;rl.prototype.transition=oF;var{abs:Fie,max:Nie,min:zie}=Math;function sF(o){return[+o[0],+o[1]]}function r9(o){return[sF(o[0]),sF(o[1])]}var Bie={name:"x",handles:["w","e"].map(yD),input:function(o,i){return o==null?null:[[+o[0],i[0][1]],[+o[1],i[1][1]]]},output:function(o){return o&&[o[0][0],o[1][0]]}},Uie={name:"y",handles:["n","s"].map(yD),input:function(o,i){return o==null?null:[[i[0][0],+o[0]],[i[1][0],+o[1]]]},output:function(o){return o&&[o[0][1],o[1][1]]}},Vie={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(yD),input:function(o){return o==null?null:r9(o)},output:function(o){return o}};function yD(o){return{type:o}}function Bc(o,i,c){this.k=o,this.x=i,this.y=c}Bc.prototype={constructor:Bc,scale:function(o){return o===1?this:new Bc(this.k*o,this.x,this.y)},translate:function(o,i){return o===0&i===0?this:new Bc(this.k,this.x+this.k*o,this.y+this.k*i)},apply:function(o){return[o[0]*this.k+this.x,o[1]*this.k+this.y]},applyX:function(o){return o*this.k+this.x},applyY:function(o){return o*this.k+this.y},invert:function(o){return[(o[0]-this.x)/this.k,(o[1]-this.y)/this.k]},invertX:function(o){return(o-this.x)/this.k},invertY:function(o){return(o-this.y)/this.k},rescaleX:function(o){return o.copy().domain(o.range().map(this.invertX,this).map(o.invert,o))},rescaleY:function(o){return o.copy().domain(o.range().map(this.invertY,this).map(o.invert,o))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var vD=new Bc(1,0,0);xD.prototype=Bc.prototype;function xD(o){for(;!o.__zoom;)if(!(o=o.parentNode))return vD;return o.__zoom}function aF(o){return typeof o=="string"}function lF(o){return typeof o=="number"&&Number(o)==o}function cF(o,i){let c=o.length;for(let h=0;h<c;++h)if(o[h]===i)return h;return-1}function Qx(o,i=0,c="0"){return typeof o!="string"&&(o=o.toString()),i>o.length?Array(i-o.length+1).join(c)+o:o}function wD(o){let i,c,h,m=o.h,r=o.s,E=o.l;if(r==0)i=c=h=E;else{let C=function(ce,Ie,be){return be<0&&(be+=1),be>1&&(be-=1),be<.16666666666666666?ce+(Ie-ce)*6*be:be<.5?Ie:be<.6666666666666666?ce+(Ie-ce)*(.6666666666666666-be)*6:ce},O=E<.5?E*(1+r):E+r-E*r,z=2*E-O;i=C(z,O,m+1/3),c=C(z,O,m),h=C(z,O,m-1/3)}return{r:Math.round(i*255),g:Math.round(c*255),b:Math.round(h*255)}}function ED(o){let i=o.r/255,c=o.g/255,h=o.b/255,m=Math.max(i,c,h),r=Math.min(i,c,h),E=0,C=0,O=(m+r)/2;if(m===r)E=C=0;else{let z=m-r;switch(C=O>.5?z/(2-m-r):z/(m+r),m){case i:E=(c-h)/z+(c<h?6:0);break;case c:E=(h-i)/z+2;break;case h:E=(i-c)/z+4;break}E/=6}return{h:E,s:C,l:O}}function hF(o,i){return o&&{r:Math.max(0,Math.min(255,o.r+Kx(o.r,i))),g:Math.max(0,Math.min(255,o.g+Kx(o.g,i))),b:Math.max(0,Math.min(255,o.b+Kx(o.b,i))),a:o.a}}function Kx(o,i){let c=i>0?255-o:o;return Math.round(c*i)}function dF(o,i){if(o){let c=Math.min(Math.max(o.r,o.g,o.b),230),h=Kx(c,i);return{r:Math.max(0,Math.min(255,Math.round(o.r+h))),g:Math.max(0,Math.min(255,Math.round(o.g+h))),b:Math.max(0,Math.min(255,Math.round(o.b+h))),a:o.a}}else return o}function uF(o){return(o.r*299+o.g*587+o.b*114)/1e3>=128}function fF(o,i){if(o===void 0||i==1)return o;let c=ED(o);return c.s=i,wD(c)}function pF(o,i={r:255,g:255,b:255},c={r:255,g:255,b:255}){let h=i,m=c;return uF(c)&&(h=c,m=i),uF(o)?m:h}function mF(o){return o[0]==="#"&&(o=o.substr(1)),o.length==3&&(o=o[0].repeat(2)+o[1].repeat(2)+o[2].repeat(2)),parseInt(o,16)}function f9(o){o=o.replace(/[ ]/g,"");let i=o.match(/^rgb\(([0-9]*),([0-9]*),([0-9]*)\)/i);if(i)i.push("1");else if(i=o.match(/^rgba\(([0-9]*),([0-9]*),([0-9]*),([.0-9]*)\)/i),!i)return 0;let c="";for(let h=1;h<=3;h++){let m=parseInt(i[h]).toString(16);m.length==1&&(m="0"+m),c+=m}return mF(c)}function jf(o){return i_.fromAny(o)}var i_=class o{constructor(i){Object.defineProperty(this,"_hex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hex=i|0}get hex(){return this._hex}get r(){return this._hex>>>16}get g(){return this._hex>>8&255}get b(){return this._hex&255}toCSS(i=1){return"rgba("+this.r+", "+this.g+", "+this.b+", "+i+")"}toCSSHex(){return"#"+Qx(this.r.toString(16),2)+Qx(this.g.toString(16),2)+Qx(this.b.toString(16),2)}toHSL(i=1){return ED({r:this.r,g:this.g,b:this.b,a:i})}static fromHSL(i,c,h){let m=wD({h:i,s:c,l:h});return this.fromRGB(m.r,m.g,m.b)}toString(){return this.toCSSHex()}static fromHex(i){return new o(i)}static fromRGB(i,c,h){return new o((h|0)+(c<<8)+(i<<16))}static fromString(i){return new o(mF(i))}static fromCSS(i){return new o(f9(i))}static fromAny(i){if(aF(i)){if(i[0]=="#")return o.fromString(i);if(i.substr(0,3)=="rgb")return o.fromCSS(i)}else{if(lF(i))return o.fromHex(i);if(i instanceof o)return o.fromHex(i.hex)}throw new Error("Unknown color syntax: "+i)}static alternative(i,c,h){let m=pF({r:i.r,g:i.g,b:i.b},c?{r:c.r,g:c.g,b:c.b}:void 0,h?{r:h.r,g:h.g,b:h.b}:void 0);return this.fromRGB(m.r,m.g,m.b)}static interpolate(i,c,h,m="rgb"){if(m=="hsl"){let r=c.toHSL(),E=h.toHSL();return o.fromHSL(Ch(i,r.h,E.h),Ch(i,r.s,E.s),Ch(i,r.l,E.l))}else return o.fromRGB(Ch(i,c.r,h.r),Ch(i,c.g,h.g),Ch(i,c.b,h.b))}static lighten(i,c){let h=hF({r:i.r,g:i.g,b:i.b},c);return o.fromRGB(h.r,h.g,h.b)}static brighten(i,c){let h=dF({r:i.r,g:i.g,b:i.b},c);return o.fromRGB(h.r,h.g,h.b)}static saturate(i,c){let h=fF({r:i.r,g:i.g,b:i.b},c);return o.fromRGB(h.r,h.g,h.b)}};function Ch(o,i,c){return i+o*(c-i)}var ase=[{name:"Root",children:[{name:"Sed et nulla a enim tincidunt gravida",shortName:"Gravida",color:jf(8824281),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:80},{name:"Third",value:100},{name:"New",value:50,action:"add",color:jf(13688048),radius:35}]},{name:"Fusce ut nisi eu nibh laoreet scelerisque",shortName:"Fusce ut nisi",color:jf(8285892),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:25},{name:"Third",value:100},{name:"New",value:50,action:"add",color:jf(14210285),radius:35}]}]}];var _F=pw(Jx());var vF=pw(Jx());var DD=(()=>{let i=class i{constructor(){this.url="http://localhost:3000/places"}getAllLocations(){return Nm(this,null,function*(){let m=yield(yield fetch(this.url)).text();return JSON.parse(m)??[]})}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function o_(o,i,c,h=!1){return{width:100,height:100,data:new Uint8ClampedArray(100*100*4),context:null,map:i,canvas:c,onAdd:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.context=c.getContext("2d")},render:function(){let r=this.width/2*.3,E=this.context,C=1e3,O=performance.now()%C/C;if(E){if(h){let z=this.width/2*.7*O+r;E.clearRect(0,0,this.width,this.height),E.beginPath(),E.arc(this.width/2,this.height/2,z,0,Math.PI*2),E.fillStyle=`${m9(o,O)}`,E.fill()}E.beginPath(),E.arc(this.width/2,this.height/2,r,0,Math.PI*2),E.fillStyle=o,E.strokeStyle="white",h?E.lineWidth=2+4*(1-O):E.lineWidth=4,E.fill(),E.stroke(),this.data=E.getImageData(0,0,this.width,this.height).data}return this.map?.triggerRepaint(),!0}}}function m9(o,i){let c=i-.1,h=1-c>.1?1-c:.1,m=Math.round(Math.min(Math.max(h??1,0),1)*255);return o+m.toString(16).toUpperCase()}var g9=[{id:"1",latitude:50.05423456789012,longitude:19.93845678901234},{id:"2",latitude:50.051601681737964,longitude:19.94527204613522},{id:"3",latitude:50.05773375024379,longitude:19.943222265625},{id:"4",latitude:50.05490381469543,longitude:19.93778991699219},{id:"5",latitude:50.05760487599164,longitude:19.937191009521484},{id:"6",latitude:50.05824547073284,longitude:19.930737670577457},{id:"7",latitude:50.05684123456789,longitude:19.93645678012345},{id:"8",latitude:50.05567891234567,longitude:19.94123456789012},{id:"9",latitude:50.05345678901234,longitude:19.93987654321098},{id:"10",latitude:50.05234567890123,longitude:19.93876543210987},{id:"11",latitude:50.05123456789012,longitude:19.94098765432109},{id:"12",latitude:50.05987654321098,longitude:19.93567890123456},{id:"13",latitude:50.05876543210987,longitude:19.94456789012345},{id:"14",latitude:50.05432109876543,longitude:19.94234567890123},{id:"15",latitude:50.05543210987654,longitude:19.94345678901234},{id:"16",latitude:50.05754321098765,longitude:19.94198765432109},{id:"17",latitude:50.05643210987654,longitude:19.93912345678901},{id:"18",latitude:50.05321098765432,longitude:19.9380123456789},{id:"19",latitude:50.05210987654321,longitude:19.93765432109876},{id:"20",latitude:50.05198765432109,longitude:19.93654321098765},{id:"21",latitude:50.05123456789012,longitude:19.93712345678901},{id:"22",latitude:50.05234567890123,longitude:19.94123456789012},{id:"23",latitude:50.05345678901234,longitude:19.94234567890123},{id:"24",latitude:50.05456789012345,longitude:19.93845678901234},{id:"25",latitude:50.05567890123456,longitude:19.93956789012345},{id:"26",latitude:50.05678901234567,longitude:19.94067890123456},{id:"27",latitude:50.05789012345678,longitude:19.93578901234567},{id:"28",latitude:50.05890123456789,longitude:19.93689012345678},{id:"29",latitude:50.0590123456789,longitude:19.94112345678901},{id:"30",latitude:50.05112345678901,longitude:19.94323456789012},{id:"31",latitude:50.05223456789012,longitude:19.93734567890123},{id:"32",latitude:50.05334567890123,longitude:19.94245678901234},{id:"33",latitude:50.05445678901234,longitude:19.93856789012345},{id:"34",latitude:50.05556789012345,longitude:19.93967890123456},{id:"35",latitude:50.05667890123456,longitude:19.94078901234567},{id:"36",latitude:50.05778901234567,longitude:19.93589012345678},{id:"37",latitude:50.05889012345678,longitude:19.93690123456789},{id:"38",latitude:50.05990123456789,longitude:19.9410123456789},{id:"39",latitude:50.0510123456789,longitude:19.94312345678901},{id:"40",latitude:50.05212345678901,longitude:19.93723456789012},{id:"41",latitude:50.05323456789012,longitude:19.94234567890123},{id:"42",latitude:50.05434567890123,longitude:19.93845678901234},{id:"43",latitude:50.05545678901234,longitude:19.93956789012345},{id:"44",latitude:50.05656789012345,longitude:19.94067890123456},{id:"45",latitude:50.05767890123456,longitude:19.93578901234567},{id:"46",latitude:50.05878901234567,longitude:19.93689012345678},{id:"47",latitude:50.05989012345678,longitude:19.9410123456789},{id:"48",latitude:50.05190123456789,longitude:19.94312345678901},{id:"49",latitude:50.0520123456789,longitude:19.93723456789012},{id:"50",latitude:50.05312345678901,longitude:19.94234567890123}],xF=g9;var bF=pw(Jx());var e1=(()=>{let i=class i{constructor(){this.ACCESS_TOKEN="pk.eyJ1Ijoidml0YWxpaS1iaWxpbnNreWkiLCJhIjoiY2x5OGZqZDdsMDVjMjJucGh5Z2w3MmgzZSJ9.nKkXDgd7Q8u4sBZt_bsRrQ",this.mapStyle="mapbox://styles/vitalii-bilinskyi/cly8fp05900fz01pfaajw4fqa",this.map=null,this.source=null,this.layers=[],this.icons=[],this.showSensorData=new li(!1)}setMap(h){this.map||(this.map=h)}setSource(h){this.source=h}setMapStyle(h){this.mapStyle=h}initializeMap(h){let O=h,{container:m,zoom:r,center:E}=O,C=Xs(O,["container","zoom","center"]);this.map=new bF.default.Map(xt({accessToken:this.ACCESS_TOKEN,container:m,style:this.mapStyle,zoom:r??12,center:E},C))}addSource(h,m){if(!this.map)throw new Error("Set map before adding source!");let Z=m,{data:r,cluster:E,clusterMaxZoom:C,clusterRadius:O}=Z,z=Xs(Z,["data","cluster","clusterMaxZoom","clusterRadius"]);this.map.addSource(h,xt({type:"geojson",data:r,cluster:E,clusterMaxZoom:C??13,clusterRadius:O??100},z)),this.source=h}generatePointLayer(h){if(this.showUnconfiguredMapServiceErrors("creating point layer!"),Array.isArray(h))for(let m of h)this.createPointLayer(m);else this.createPointLayer(h)}createPointLayer(h){let Z=h,{id:m,iconId:r,filter:E,layout:C,onPointClickHandler:O}=Z,z=Xs(Z,["id","iconId","filter","layout","onPointClickHandler"]);this.map.addLayer(xt({id:m,type:"symbol",source:this.source,filter:E,layout:xt({"icon-image":r,"icon-allow-overlap":!0},C)},z)),O&&this.map.on("click",m,ce=>{O(ce,this.map,m),this.showSensorData.next(!0)}),this.layers.push(h.id),this.icons.push(h.iconId)}generateClusterLayer(h){if(this.showUnconfiguredMapServiceErrors("creating cluster layer!"),Array.isArray(h))for(let m of h)this.createClusterLayer(m);else this.createClusterLayer(h)}createClusterLayer(h){let z=h,{id:m,filter:r,paint:E,onClusterClickHandler:C}=z,O=Xs(z,["id","filter","paint","onClusterClickHandler"]);this.map.addLayer(xt({id:m,type:"circle",source:this.source,filter:r,paint:xt({"circle-color":"#cd5dfc","circle-radius":20},E)},O)),this.layers.push(h.id),C&&this.map.on("click",m,Z=>C(Z,this.map,m))}showUnconfiguredMapServiceErrors(h){if(!this.map)throw new Error(`Set map before ${h}`);if(!this.source)throw new Error(`Set source before ${h}`)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=jt({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var TF=(()=>{let i=class i{constructor(h,m){this.mockDataService=h,this.mapService=m,this.showSensorDetails=new $i,this.lat=50.049683,this.lng=19.944544,this.dotSize=100,this.context=null,this.pulsingDot_low=null,this.pulsingDot_moderate=null,this.pulsingDot_high=null,this.pulsingDot_sevire=null,this.canvas_low=document.createElement("canvas"),this.canvas_moderate=document.createElement("canvas"),this.canvas_high=document.createElement("canvas"),this.canvas_sevire=document.createElement("canvas")}ngOnInit(){this.mockDataService.getAllLocations().then(h=>{this.mockData=EF([...h]),this.renderMap()}).catch(h=>{console.error("Failed to fetch mock data",h),this.mockData=EF([...xF]),this.renderMap()})}renderMap(){this.mapService.initializeMap({container:"map",zoom:12,minZoom:4,center:[this.lng,this.lat]}),this.createPusingDots(),this.onMapLoadHandler()}createPusingDots(){this.checkMapInitialization(),this.canvas_low.className="canvas_low",this.pulsingDot_low=o_("#B3ECCD",this.mapService.map,this.canvas_low),this.canvas_moderate.className="canvas_moderate",this.pulsingDot_moderate=o_("#FFEB82",this.mapService.map,this.canvas_moderate),this.canvas_high.className="canvas_high",this.pulsingDot_high=o_("#ffb682",this.mapService.map,this.canvas_high),this.canvas_sevire.className="canvas_sevire",this.pulsingDot_sevire=o_("#ECC6EF",this.mapService.map,this.canvas_sevire,!0)}onMapLoadHandler(){this.checkMapInitialization(),this.mapService.map.on("load",()=>{this.pulsingDot_low&&this.mapService.map.addImage("pulsingDot_low",this.pulsingDot_low,{pixelRatio:2}),this.pulsingDot_moderate&&this.mapService.map.addImage("pulsingDot_moderate",this.pulsingDot_moderate,{pixelRatio:2}),this.pulsingDot_high&&this.mapService.map.addImage("pulsingDot_high",this.pulsingDot_high,{pixelRatio:2}),this.pulsingDot_sevire&&this.mapService.map.addImage("pulsingDot_sevire",this.pulsingDot_sevire,{pixelRatio:2}),this.mapService.addSource("workspaces",{data:this.mockData,cluster:!0}),this.drawData()})}drawData(){this.mapService.generateClusterLayer({id:"clusters",filter:["has","point_count"],paint:{"circle-radius":20},onClusterClickHandler:this.onClusterClickHandler}),this.mapService.map.addLayer({id:"cluster-count",type:"symbol",source:"workspaces",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"white"}});let h=[{id:"unclustered-point-animated-sevire",filter:["==","alarmLevel","sevire"],iconId:"pulsingDot_sevire",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-high",filter:["==","alarmLevel","high"],iconId:"pulsingDot_high",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-moderate",filter:["==","alarmLevel","moderate"],iconId:"pulsingDot_moderate",onPointClickHandler:this.onUnlcusteredPointClickHandler},{id:"unclustered-point-animated-low",filter:["==","alarmLevel","low"],iconId:"pulsingDot_low",onPointClickHandler:this.onUnlcusteredPointClickHandler}];this.mapService.generatePointLayer(h)}onClusterClickHandler(h,m,r){let E=m.queryRenderedFeatures(h.point,{layers:[r]});if(E&&E[0]&&E[0]?.properties){let C=E[0]?.properties.cluster_id;C&&m.getSource("workspaces")?.getClusterExpansionZoom(C,(z,Z)=>{z||!Z||E[0].geometry.type==="Point"&&m.easeTo({center:E[0].geometry.coordinates,zoom:Z})})}}onUnlcusteredPointClickHandler(h,m,r,E){let C=m.queryRenderedFeatures(h.point,{layers:[r]});if(C&&C[0]){let O=C[0];if(console.log(O),O.geometry.type==="Point"){let z={center:[O.geometry.coordinates[0],O.geometry.coordinates[1]],zoom:18};m.flyTo(Tr(xt({},z),{duration:3e3,essential:!0}))}}}checkMapInitialization(){if(!this.mapService.map)throw new Error("Map is not initialized")}};i.\u0275fac=function(m){return new(m||i)(gr(DD),gr(e1))},i.\u0275cmp=Br({type:i,selectors:[["map-view"]],outputs:{showSensorDetails:"showSensorDetails"},standalone:!0,features:[xR([]),Vr],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(m,r){m&1&&Ir(0,"div",0)},dependencies:[KR,Di],styles:['.match-parent[_ngcontent-%COMP%]{width:100%;height:100%}#map[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;display:block;z-index:10;pointer-events:none;-webkit-box-shadow:inset 0 0 70px 60px white;-moz-box-shadow:inset 0 0 70px 60px white;box-shadow:inset 0 0 70px 60px #fff}']});let o=i;return o})(),EF=o=>{let i=[],c=[],h=["high","moderate","low"];return o.forEach(m=>{i.push({type:"Feature",properties:{id:m.id,color:"yellow",numberOfDevices:m.devices?.length,alarmLevel:m.id==="6"?"sevire":h[Math.floor(Math.random()*h.length)]},geometry:{type:"Point",coordinates:[m.longitude,m.latitude]}})}),{type:"FeatureCollection",features:[...i]}};var y9=o=>({active:o}),v9=o=>({item:o}),x9=o=>({"crossed-out":o});function b9(o,i){o&1&&wv(0)}function w9(o,i){if(o&1){let c=og();wn(0,"div",10),Gi("click",function(m){sh(c);let r=dh(2);return ah(r.handleMenuClick(m))}),wn(1,"div",11),Gi("click",function(){let m=sh(c).index,r=dh(2);return ah(r.handleActive(m))}),Ur(2),Sn(),wn(3,"div",12),wv(4,13),Sn()()}if(o&2){let c=i.$implicit;dh();let h=sg(3),m=sg(5);Sc("ngClass",c.statusLevel),kr("ngClass",_f(8,y9,c.active)),hr(),Sc("ngClass",c.statusLevel),hr(),Ev(" ",c.alarmCount," ",c.labelText," "),hr(),Sc("ngClass",c.statusLevel),hr(),kr("ngTemplateOutlet",c.alarmsDetails?h:m)("ngTemplateOutletContext",_f(10,v9,c))}}function E9(o,i){if(o&1&&(xv(0),wn(1,"div",16),Ur(2),Ir(3,"img",17),Sn(),bv()),o&2){let c=i.$implicit;hr(),kr("ngClass",_f(4,x9,c.addedToCheckout)),hr(),Ev(" ",c.alarmCount," ",c.labelText," "),hr(),kr("src",c.addedToCheckout?"../../../assets/alert-close.svg":"../../../assets/alert-add.svg",BP)}}function T9(o,i){if(o&1&&(Ir(0,"hr",14),bs(1,E9,4,6,"ng-container",15)),o&2){let c=i.item;Sc("ngClass",c.active?"dotted":"dotted-closed"),hr(),kr("ngForOf",c.alarmsDetails)}}function I9(o,i){o&1&&(wn(0,"div"),Ur(1," No alarms specified "),Sn())}function D9(o,i){if(o&1&&(wn(0,"div",8),bs(1,w9,5,12,"div",9),Sn(),bs(2,T9,2,2,"ng-template",null,2,ag)(4,I9,2,0,"ng-template",null,3,ag)),o&2){let c=dh();hr(),kr("ngForOf",c.menuItems)}}function S9(o,i){o&1&&(wn(0,"div",18),Ir(1,"img",19),wn(2,"span",20),Ur(3," 7 "),Sn()(),wn(4,"div",21),Ur(5," 3 "),Sn(),wn(6,"div",22),Ur(7," 8 "),Sn(),wn(8,"div",23),Ur(9," 29"),Sn(),wn(10,"div",24),Ur(11," 3 "),Sn())}var IF=(()=>{let i=class i{constructor(h){this.docoment=h,this.opened=!1,this.bar=null,this.menuElements=[],this.menuItems=[{alarmCount:7,labelText:"tasks to delegate",statusLevel:$f.none},{alarmCount:3,labelText:"critical alerts",statusLevel:$f.critical},{alarmCount:8,labelText:"high priority alerts",statusLevel:$f.high,alarmsDetails:[{alarmCount:4,labelText:"mice to be released",addedToCheckout:!1},{alarmCount:2,labelText:"batteries to be replaced",addedToCheckout:!1},{alarmCount:2,labelText:"roofs to be cleared of snow",addedToCheckout:!0}]},{alarmCount:29,labelText:"regular statuses",statusLevel:$f.regular},{alarmCount:3,labelText:"low priority statuses",statusLevel:$f.low}]}toggleSidebar(h){this.bar=this.docoment.querySelector(".right-bar"),this.menuElements=Array.from(this.bar.querySelectorAll(".menu-element")),this.opened=!this.opened,this.opened?this.openMenu(h):this.closeMenu()}openMenu(h){this.bar.classList.add("menu-opened"),this.menuElements.forEach(m=>{m.classList.add("menu-item-opened")})}closeMenu(){this.handleActive(-1),this.menuElements.forEach(h=>{h.classList.remove("menu-item-opened")}),this.bar.classList.remove("menu-opened")}handleMenuClick(h){h.cancelBubble=!0}handleActive(h){this.menuItems=this.menuItems.map(m=>(cF(this.menuItems,m)!==h?m.active=!1:this.menuItems[h].active?this.menuItems[h].active=!1:this.menuItems[h].active=!0,m))}};i.\u0275fac=function(m){return new(m||i)(gr(Xr))},i.\u0275cmp=Br({type:i,selectors:[["app-right-bar"]],standalone:!0,features:[Vr],decls:8,vars:4,consts:[["openedTemplate",""],["closedTemplate",""],["alarmsDetailsTemplate",""],["emptyTemplate",""],[1,"bar-container"],["src","../../../assets/arrow-close.svg",3,"click","ngClass"],["id","rightBar",1,"right-bar",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["id","container"],["class","item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"item",3,"click","ngClass"],[1,"heading",3,"click","ngClass"],[1,"content",3,"ngClass"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"dotted",3,"ngClass"],[4,"ngFor","ngForOf"],[2,"text-align","start","font-size","100%","display","flex","align-items","center","justify-content","space-between",3,"ngClass"],[3,"src"],[1,"normal","menu-element"],["src","../../../assets/top-right-arrow.svg",1,"right-arrow"],[1,"alarm-count"],[1,"critical","menu-element"],[1,"high","menu-element"],[1,"regular","menu-element"],[1,"low","menu-element"]],template:function(m,r){if(m&1){let E=og();wn(0,"div",4)(1,"img",5),Gi("click",function(O){return sh(E),ah(r.toggleSidebar(O))}),Sn(),wn(2,"div",6),Gi("click",function(O){return sh(E),r.toggleSidebar(O),ah(O.stopPropagation())}),bs(3,b9,1,0,"ng-container",7),Sn()(),bs(4,D9,6,1,"ng-template",null,0,ag)(6,S9,12,0,"ng-template",null,1,ag)}if(m&2){let E=sg(5),C=sg(7);hr(),kr("ngClass",r.opened?"closing-arrow":"opening-arrow"),hr(2),kr("ngIf",!r.opened)("ngIfThen",C)("ngIfElse",E)}},dependencies:[Di,bf,Av,Pv,BR],styles:[".bar-container[_ngcontent-%COMP%]{display:flex}.right-bar[_ngcontent-%COMP%]{position:fixed;width:30px;background-color:#fff0!important;border-left:1px solid #bbb;padding-left:20px;padding-right:20px;top:25%;height:40%;right:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:95;transition:all .8s}.right-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:hover{cursor:pointer}.right-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center;vertical-align:baseline;line-height:30px;font-size:80%}.right-bar[_ngcontent-%COMP%]   div.normal[_ngcontent-%COMP%]{background-color:#fff}.right-bar[_ngcontent-%COMP%]   div.normal[_ngcontent-%COMP%]   span.alarm-count[_ngcontent-%COMP%]{position:absolute;color:#c3c3c3;margin-top:-6px;font-size:90%}.right-bar[_ngcontent-%COMP%]   img.right-arrow[_ngcontent-%COMP%]{margin-top:10px;margin-left:-10px;scale:.7}.menu-element[_ngcontent-%COMP%]{justify-self:center;border-radius:10px;text-wrap:nowrap;border:2px solid #bbb;width:100%;margin:1vh 0;height:30px}.menu-opened[_ngcontent-%COMP%]{top:25%;height:40%;width:60%}.dotted[_ngcontent-%COMP%]{border-top:2px dotted #000;margin-right:10px;border-bottom:none}.add-icon[_ngcontent-%COMP%]{position:fixed;right:25px}#container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%}.item[_ngcontent-%COMP%]{width:100%;border:2px solid #bbb;height:fit-content;margin:1vh 0;border-radius:9px;cursor:pointer}.item[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{line-height:30px;text-wrap:nowrap;font-size:100%;border-radius:7px;padding:0 10px;height:30px;display:flex;align-items:center;transition:all .5s}.item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:0 10px;text-align:start!important;overflow:hidden;max-height:0;transition:all .5s}.item.active[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{line-height:30px;font-size:100%;border-radius:7px 7px 0 0;transition:all .5s}.item.active[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{line-height:30px;font-size:100%;max-height:100px;text-align:start!important;overflow:hidden;padding-bottom:10px;border-radius:0 0 7px 7px;transition:all .5s}.critical[_ngcontent-%COMP%]{background-color:#ecc6ef}.high[_ngcontent-%COMP%]{background-color:#ffeb82}.regular[_ngcontent-%COMP%]{background-color:#b3eccd}.low[_ngcontent-%COMP%]{background-color:#eaebed}.none[_ngcontent-%COMP%]{background-color:#fff}.dotted[_ngcontent-%COMP%]{border-top:2px dotted #000;border-bottom:none;transition:all .5s}.dotted-close[_ngcontent-%COMP%]{border-top:none;border-bottom:none;transition:all .5s}.alarms-detailed-text[_ngcontent-%COMP%]{text-align:start}.opening-arrow[_ngcontent-%COMP%]{z-index:105;position:absolute;right:80px;top:43%;transform:rotate(180deg);transition:all .8s}.closing-arrow[_ngcontent-%COMP%]{z-index:105;position:absolute;right:65%;top:43%;transform:rotate(0);transition:all .8s}.crossed-out[_ngcontent-%COMP%]{text-decoration-line:line-through}"]});let o=i;return o})(),$f=function(o){return o.critical="critical",o.high="high",o.regular="regular",o.low="low",o.none="none",o}($f||{});var DF=(()=>{let i=class i{constructor(h){this.router=h}navigate(h){this.router.navigateByUrl(h)}};i.\u0275fac=function(m){return new(m||i)(gr(rx))},i.\u0275cmp=Br({type:i,selectors:[["app-left-bar"]],standalone:!0,features:[Vr],decls:6,vars:0,consts:[[1,"left-bar"],["src","../../../assets/menu-globe.svg",1,"menu-item"],[1,"solid"],["src","../../../assets/menu-map.svg",1,"menu-item"],["src","../../../assets/menu-cube.svg",1,"menu-item",3,"click"],["src","../../../assets/menu-stars.svg",1,"menu-item"]],template:function(m,r){m&1&&(wn(0,"div",0),Ir(1,"img",1)(2,"hr",2)(3,"img",3),wn(4,"img",4),Gi("click",function(){return r.navigate("/sensors")}),Sn(),Ir(5,"img",5),Sn())},styles:[".left-bar[_ngcontent-%COMP%]{opacity:1;background-color:#fff0!important;position:fixed;width:fit-content;background-color:#fff;padding:10px 20px 0;height:220px;z-index:95;top:30%;left:0;display:flex;flex-direction:column;align-items:center}.left-bar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{justify-self:center;width:30px;height:30px;margin-top:30%;margin-bottom:30%}.left-bar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{cursor:pointer}.left-bar[_ngcontent-%COMP%]   hr.solid[_ngcontent-%COMP%]{border-top:3px solid #bbb;width:130%;margin-left:-15%}"]});let o=i;return o})();var SF=(()=>{let i=class i{constructor(){this.addMenuOpened=!1}toggleAddMenu(){this.addMenuOpened=!this.addMenuOpened}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=Br({type:i,selectors:[["app-footer"]],standalone:!0,features:[Vr],decls:9,vars:1,consts:[[1,"timeline"],["src","../../assets/timeline.svg"],[1,"add-sensor",3,"click"],["src","../../assets/add-icon.svg"],[1,"add-sensor-menu",3,"ngClass"],[1,"add-qr-wrapper"],["src","../../../assets/add-qr.svg"],[1,"add-nfc-wrapper"],["src","../../../assets/add-nfc.svg"]],template:function(m,r){m&1&&(wn(0,"div",0),Ir(1,"img",1),Sn(),wn(2,"div",2),Gi("click",function(){return r.toggleAddMenu()}),Ir(3,"img",3),Sn(),wn(4,"div",4)(5,"div",5),Ir(6,"img",6),Sn(),wn(7,"div",7),Ir(8,"img",8),Sn()()),m&2&&(hr(4),kr("ngClass",r.addMenuOpened?"opened":"closed"))},dependencies:[Di,bf],styles:[".timeline[_ngcontent-%COMP%]{position:fixed;padding-left:20px;padding-bottom:20px;left:0;bottom:0;z-index:95}.timeline[_ngcontent-%COMP%]:hover{cursor:pointer}.add-sensor[_ngcontent-%COMP%]{z-index:95;width:50px;height:50px;background-color:#eaebed;position:fixed;margin-bottom:20px;margin-right:5px;border-radius:50%;right:0;bottom:0;display:flex;align-items:center;justify-content:center}.add-sensor-menu[_ngcontent-%COMP%]{z-index:90;position:fixed;right:0;bottom:0;padding-bottom:30px;padding-right:30px}.add-sensor-menu[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border-radius:50%;width:60px;height:60px;background-color:#fff}.add-sensor-menu[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:hover{cursor:pointer}.add-sensor-menu[_ngcontent-%COMP%]   .add-nfc-wrapper[_ngcontent-%COMP%]{margin-left:-40px}.add-sensor[_ngcontent-%COMP%]:hover{cursor:pointer}.closed[_ngcontent-%COMP%]{scale:0%;transition:.5s}.opened[_ngcontent-%COMP%]{scale:100%;transition:.5s}"]});let o=i;return o})();var C9=o=>({width:o}),CF=(()=>{let i=class i{constructor(){this.batteryLevel=58,this.batteryCondition=Gf.Medium}ngOnInit(){this.batteryCondition=this.calculateBatteryCondition(this.batteryLevel)}calculateBatteryCondition(h){return h>75?Gf.Good:h>50?Gf.Medium:h>25?Gf.Low:Gf.Critical}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=Br({type:i,selectors:[["app-battery-level"]],inputs:{batteryLevel:"batteryLevel"},standalone:!0,features:[Vr],decls:6,vars:5,consts:[[1,"battery-label"],[1,"battery-container"],[1,"battery-level",3,"ngStyle"]],template:function(m,r){m&1&&(wn(0,"div",0),Ur(1,"Battery Level"),Sn(),wn(2,"div",1)(3,"div",2),Ur(4),Sn(),Ur(5),Sn()),m&2&&(hr(3),kr("ngStyle",_f(3,C9,r.batteryLevel+"%")),hr(),Cc(" ",r.batteryLevel,"%"),hr(),Cc(" ",r.batteryCondition,`
`))},dependencies:[Di,zR],styles:[".battery-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#c2baba;border-radius:25px;display:flex;align-items:center;padding-right:10px;justify-content:space-between}.battery-container[_ngcontent-%COMP%]   .battery-level[_ngcontent-%COMP%]{height:inherit;display:flex;align-items:center;justify-content:center;border-radius:25px;background-color:#ecc6ef}.battery-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}"]});let o=i;return o})(),Gf=function(o){return o.Good="GOOD",o.Medium="MEDIUM",o.Low="LOW",o.Critical="CRITICAL",o}(Gf||{});function M9(o,i){if(o&1&&(wn(0,"div",11),Ur(1),Sn()),o&2){let c=i.$implicit;Sc("ngClass",c.alarmLevel),hr(),Cc(" ",c.alarmCount," ")}}var MF=(()=>{let i=class i{constructor(){this.showSensorDetails=!1,this.sensorId="Sensor #471",this.responsible="Deratex Polska",this.alarmsData=[{alarmLevel:"critical",alarmCount:3},{alarmLevel:"high",alarmCount:1},{alarmLevel:"low",alarmCount:2}],this.batteryLevel=78,this.location={street:"ul. Malborska",building:"85",city:"Krak\xF3w",additionalInfo:"2 pi\u0119tro, zaraz za winklem"},this.hideDetails=new $i}emitHideDetails(){this.hideDetails.emit(!0)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=Br({type:i,selectors:[["app-sensor-details"]],inputs:{showSensorDetails:"showSensorDetails",sensorId:"sensorId",responsible:"responsible",alarmsData:"alarmsData",batteryLevel:"batteryLevel",location:"location"},outputs:{hideDetails:"hideDetails"},standalone:!0,features:[Vr],decls:17,vars:7,consts:[[1,"close",3,"click"],[1,"overlay-container"],[1,"sensor-container"],[1,"responsible-label"],[1,"responsible-container"],[1,"alarms-label"],[1,"alarms-container"],["class","alarm",3,"ngClass",4,"ngFor","ngForOf"],[3,"batteryLevel"],[1,"localization-label"],[1,"localization-container"],[1,"alarm",3,"ngClass"]],template:function(m,r){m&1&&(wn(0,"a",0),Gi("click",function(){return r.emitHideDetails()}),Sn(),wn(1,"div",1)(2,"div",2),Ur(3),Sn(),wn(4,"div",3),Ur(5,"Responsible"),Sn(),wn(6,"div",4),Ur(7),Sn(),wn(8,"div",5),Ur(9,"Alarms"),Sn(),wn(10,"div",6),bs(11,M9,2,2,"div",7),Sn(),Ir(12,"app-battery-level",8),wn(13,"div",9),Ur(14,"Localization"),Sn(),wn(15,"div",10),Ur(16),Sn()()),m&2&&(hr(3),Cc(" ",r.sensorId," "),hr(4),Cc(" ",r.responsible," "),hr(4),kr("ngForOf",r.alarmsData),hr(),kr("batteryLevel",r.batteryLevel),hr(4),_T(" ",r.location.street," ",r.location.building,", ",r.location.city," "))},dependencies:[Di,bf,Av,CF],styles:['.overlay-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:60%;height:100%;z-index:100;background-color:#fff;opacity:.9;padding-left:20%;padding-right:20%;text-wrap:nowrap;display:flex;flex-direction:column;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif;transition:all .5s}.overlay-container[_ngcontent-%COMP%]   .sensor-container[_ngcontent-%COMP%]{width:100%;margin-top:10vh;font-size:150%}.overlay-container[_ngcontent-%COMP%]   .responsible-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:10vh}.overlay-container[_ngcontent-%COMP%]   .responsible-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.overlay-container[_ngcontent-%COMP%]   .alarms-label[_ngcontent-%COMP%]{width:99%;padding-left:1%;margin-top:30px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:20px}.overlay-container[_ngcontent-%COMP%]   .alarms-container[_ngcontent-%COMP%]   .alarm[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:40px;border-radius:50%}.overlay-container[_ngcontent-%COMP%]   .localization-label[_ngcontent-%COMP%]{margin-top:30px;width:99%;padding-left:1%}.overlay-container[_ngcontent-%COMP%]   .localization-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:99%;padding-left:1%;height:50px;border-radius:10px;border:solid 2px grey}.critical[_ngcontent-%COMP%]{background-color:#ecc6ef}.high[_ngcontent-%COMP%]{background-color:#ffeb82}.low[_ngcontent-%COMP%]{background-color:#eaebed}.close[_ngcontent-%COMP%]{position:absolute;z-index:105;right:32px;top:20px;width:20px;height:20px;scale:.7}.close[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}.close[_ngcontent-%COMP%]:before, .close[_ngcontent-%COMP%]:after{z-index:105;position:absolute;left:15px;content:" ";height:33px;width:2px;background-color:#333}.close[_ngcontent-%COMP%]:before{transform:rotate(45deg)}.close[_ngcontent-%COMP%]:after{transform:rotate(-45deg)}']});let o=i;return o})();function AF(o,i){return[...i&&i.animateChildren==="before"?[Lc("@*",ox(),{optional:!0})]:[],ix([qO(o),...!i||!i.animateChildren||i.animateChildren==="together"?[Lc("@*",ox(),{optional:!0})]:[]]),...i&&i.animateChildren==="after"?[Lc("@*",ox(),{optional:!0})]:[]]}var A9=()=>DI([Lf("{{duration}}ms {{delay}}ms",II([qi({visibility:"visible",opacity:0,easing:"ease",offset:0}),qi({opacity:1,easing:"ease",offset:1})]))]);var P9=1e3;function PF(o){return Fg(o&&o.anchor||"fadeInOnEnter",[Ng(":enter",[qi({visibility:"hidden"}),...AF(A9(),o)],{params:{delay:o&&o.delay||0,duration:o&&o.duration||P9}})])}var R9=()=>DI([Lf("{{duration}}ms {{delay}}ms",II([qi({opacity:1,easing:"ease",offset:0}),qi({opacity:0,easing:"ease",offset:1})]))]);var O9=1e3;function RF(o){return Fg(o&&o.anchor||"fadeOutOnLeave",[Ng(":leave",[...AF(R9(),o)],{params:{delay:o&&o.delay||0,duration:o&&o.duration||O9}})])}function L9(o,i){if(o&1){let c=og();wn(0,"app-sensor-details",2),Gi("hideDetails",function(m){sh(c);let r=dh();return ah(r.hideDetails(m))}),Sn()}o&2&&kr("@enter",void 0)("@fadeOutOnLeave",void 0)}var OF=(()=>{let i=class i{constructor(h){this.mapService=h,this.showSensorDetails=!1,this.mapService.showSensorData?.subscribe(m=>{this.showSensorDetails=m})}hideDetails(h){this.showSensorDetails=!h}};i.\u0275fac=function(m){return new(m||i)(gr(e1))},i.\u0275cmp=Br({type:i,selectors:[["app-app-concept-view"]],standalone:!0,features:[Vr],decls:3,vars:1,consts:[[2,"width","100%","height","100%"],[3,"hideDetails",4,"ngIf"],[3,"hideDetails"]],template:function(m,r){m&1&&(wn(0,"div",0),Ir(1,"map-view"),bs(2,L9,1,2,"app-sensor-details",1),Sn()),m&2&&(hr(2),kr("ngIf",r.showSensorDetails))},dependencies:[TF,Di,Pv,MF],styles:[".match-parent[_ngcontent-%COMP%]{width:100%;height:700px}.link[_ngcontent-%COMP%]{stroke:#b752e2;stroke-width:1.5px}"],data:{animation:[PF({anchor:"enter",delay:1e3,duration:500}),RF()]}});let o=i;return o})();var LF=Fg("slideInAnimation",[Ng("* <=> *",[Lc(":enter, :leave",qi({position:"fixed",width:"100%",zIndex:2}),{optional:!0}),ix([Lc(":enter",[qi({transform:"translateX(100%)"}),Lf("0.5s ease-out",qi({transform:"translateX(0%)"}))],{optional:!0}),Lc(":leave",[qi({transform:"translateX(0%)"}),Lf("0.5s ease-out",qi({transform:"translateX(-100%)"}))],{optional:!0})])])]);var kF=(()=>{let i=class i{constructor(h){this.contexts=h,this.title="GraphVizualization"}};i.\u0275fac=function(m){return new(m||i)(gr(Rf))},i.\u0275cmp=Br({type:i,selectors:[["app-root"]],standalone:!0,features:[Vr],decls:7,vars:1,consts:[[2,"height","100vh","width","100vw","overflow","hidden","position","absolute","top","0","left","0"]],template:function(m,r){m&1&&(wn(0,"div",0),Ir(1,"app-app-concept-view"),Sn(),Ir(2,"app-right-bar")(3,"app-left-bar")(4,"app-footer"),wn(5,"div"),Ir(6,"router-outlet"),Sn()),m&2&&(hr(5),kr("@slideInAnimation",void 0))},dependencies:[Di,_I,OF,DF,IF,SF],data:{animation:[LF]}});let o=i;return o})();iO(kF,bL).catch(o=>console.error(o));
